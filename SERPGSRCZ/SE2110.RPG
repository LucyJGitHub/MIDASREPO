     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Split todays actns for book posn')            *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                        *
     F*                                                               *
     F*  SE2110 - SPLIT TODAY'S ACTIONS FOR BOOK POSITIONS            *
     F*                                                               *
     F*  Function: This program identifies what book positions have   *
     F*   (COB)    changed today and generates book position action   *
     F*            records for the changes involved.                  *
     F*                                                               *
     F*            There are 3 types of change affecting book posns:  *
     F*            1. A Security event due (e.g. coupon or dividend). *
     F*            2. A change to the nominal on trade input.         *
     F*            3. A change to average price.                      *
     F*                                                               *
     F*            A record is written to either the Current or the   *
     F*            Backvalued Book Position Action file depending on  *
     F*            the relationship of the event date to the last     *
     F*            position date on the Book Positions Header file.   *
     F*                                                               *
     F*  Called by: SEC0602F - Split Today's Actions by Book Posn     *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CSE105             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CAS006             Date 21Jan03               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 210390             Date 29Oct02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSD010             Date 03May02               *
      *                 203061             Date 29May02               *
      *                 CSE031             Date 09Nov01               *
      *                 182505             Date 13Sep00               *
      *                 188670             Date 22Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 193556             Date 17Jul01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 16May01               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 11Nov98               *
      *                 130862             Date 16Oct98               *
      *                 103409             Date 26Feb98               *
      *                 CEU017             Date 02Apr98               *
     F*                 CSE007             Date 17Mar98               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 112418             DATE 07APR97               *
     F*                 091803             DATE 19AUG96               *
     F*                 100228             DATE 31MAY96               *
     F*                 101284             DATE 01APR96               *
     F*                 S01408             DATE 05MAR96               *
     F*                 CPM004             DATE 08FEB96               *
     F*                 091254             DATE 20OCT95               *
     F*                 S01486 RS          DATE 27OCT94               *
     F*                 S01510             DATE 10AUG94               *
     F*                 056512             DATE 12JUL94               *
     F*                 060715             DATE 18MAR94               *
     F*                 054257             DATE 10JAN94               *
     F*                 052254             DATE 10JAN94               *
     F*                 S01401             DATE 16JUN93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E37527             DATE 31MAR92               *
     F*                 E29170             DATE 05NOV91               *
     F*                 E29231             DATE 08OCT91               *
     F*                 E29229             DATE 08OCT91               *
     F*                 E29207             DATE 08OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 06JUN91               *
     F*                 S01269             DATE 01AUG90               *
     F*                 S01288             DATE 06JUL90               *
     F*                 E22957             DATE 02AUG90               *
     F*                 E21639             DATE 24APR90               *
     F*                 E21579             DATE 11APR90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21132             DATE 14FEB90               *
     F*                 E20651             DATE 30JAN90               *
     F*                 E20845             DATE 15JAN90               *
     F*                 E19434             DATE 07NOV89               *
     F*                 E20085             DATE 07NOV89               *
     F*                 E18652             DATE 04/07/89              *
     F*                 E16772             DATE 31/05/89              *
     F*                 E15965             DATE 31/10/88              *
     F*                 E15549             DATE 04/10/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CSE105 - Portuguese Upgrade - Discount/Premium Amortisation  *
      *           on Trade Date                                       *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CAS006 - Hedge Accounting Phase B.                           *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  210390 - If CSE031 is 'on' and business day convention of    *
      *           security is not 'N', upon backvaluation, last       *
      *           coupon used is not always correct.  Fix is to use   *
      *           last coupon of action if action is a backvaluation. *
      *  CSD010 - Collateralised Lending (Securities and FX Pricing)  *
      *  203061 - 193556 causes looping if record from BKPOS is first *
     F*           record on file.                                     *
     F*  CSE031 - Coupon Fixing for Floating Rate Notes.              *
     F*  182505 - Interest rate change that falls on holiday was not  *
     F*           adjusted in accordance with CSE005 (Business Day    *
     F*           Convention).                                        *
      *  188670 - Message error issued by system during input of      *
      *           price was due to incosistency of PF/PRICED and      *
      *           PF/SEPRICPD.  Fix is to update SEPRICPD everytime   *
      *           PRICED is being updated.                            *
     F*  193556 - Correct 103409. Due to this fix, no record output   *
     F*           any more to BPACBD/BPACCD for back valued dividends *
     F*           if last and ex-coupon nominal positions are zero.   *
      *  CSD006 - Market Data Feed (Recompile)                        *
      *  CAC005 - PCA-SE Enhancement.                                 *
     F*  130862 - Recompiled over changed ZLCDZ1.                     *
     F*  103409 - Problem with Mark-to-Market                         *
     F*           1. Unable to Mark-to-Market it a trade is value on  *
     F*              MM date for a new position.                      *
     F*           2. Caused DB error in SE0740 when a trade for a new *
     F*              position value on the same date as input and     *
     F*              Mark-to-Market date deleted on the same day.     *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*  CSE007 - Corporate Actions                                   *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  112418 - COB component SEC1004 FOOB for BPACHD.              *
     F*  091803 - MARK TO MARKET REVALUATION SHOULD BE DONE IF A      *
     F*           MARKET PRICE EXISTS ALTHOUGH EQUAL TO ZERO.         *
     F*  100228 - RECOMPILED FOR CHANGES TO SR ZLCDZ1.                *
     F*  101284 - TREAT TYPE 'CP' IN THE SAME WAY AS FIX 056512       *
     F*           TREATS TYPE 'IR'.                                   *
     F*  S01408 - Addition core hook SE2110FFP1.                      *
     F*           Addition core hook SE2110EEP1.                      *
     F*           Addition core hook SE2110CCP1.                      *
     F*           Addition core hook SE2110CCP2.                      *
     F*           Addition core hook SE2110CCP3.                      *
     F*           Addition core hook SE2110CCP4.                      *
     F*           Addition core hook SE2110CCP5.                      *
     F*           Addition core hook SE2110CCP6.                      *
     F*  CPM004 - Bank Portfolios                                     *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1\& ZNCDZ3              *
     F*  S01486 - PORTFOLIO MANAGEMENT ENHANCEMENT                    *  *
     F*  S01510 - Dividend payments based on ex-date                  *
     F*  056512 - For interest rate change, if it is back valued to   *
     F*           LPCD, it should not count as backvalue action.      *
     F*  060715 - Do not do Mark-to-Market Revaluation if ICD value   *
     F*           is blank.                                           *
     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
     F*           to 10,9                                             *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files.               *
     F*  E37527 - Recompiled for corrections to Audit Print File.     *
     F*  E29170 - Report Control Facility changes                     *
     F*  E29231 - Reversal of Security Diary Action not effected      *
     F*           properly. ld  BPACHD records not deleted, FCOOB     *
     F*  E29229 - LPCD referenced when file BKPHDD not accessed       *
     F*           - This can cause DB Errors IN SE2230                *
     F*  E29207 - Discount amortization                               *
     F*           - Amortization wrong if back-valuation done prior   *
     F*             to LATD but after LPCD. (No records are read into *
     F*             the reversal run of SE2220 as there are no actions*
     F*             to reaction.Solved by generating dummy actions).  *
     F*           - Amortization wrong if first day accruals          *
     F*           - Amortization wrong if trade deleted.              *
     F*           - Trading again on a flat position causes           *
     F*             discount amortization to be wrong.                *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  S01269 - Trade authorisation: recompile over changed file    *
     F*           TABSE.                                              *
     F*  S01288 - Recompiled over changed LF/BKPHJ1:                  *
     F*           Allows lower of book or market price on Mark to     *
     F*           Market Revaluation.                                 *
     F*  E22957 - Redefine Backvalued actions as being before Last    *
     F*           Chg Date (LPCD)                                     *
     F*         - Find coupon on or Before Trades Value Date not      *
     F*           ON Event Date.                                      *
     F*         - Removed setting of Trade sequence as done by SE2250 *
     F*  E21639 - Dividends should be produced on Trade Date Positions*
     F*  E21579 - User entered a Trade Valued today, then amended it  *
     F*           to be Backvalued. Because SE2110 wrote Action to    *
     F*           BPACCD, SE2230 did not delete original BKPOS record,*
     F*           which threw off SE0720/30 on a later Date.          *
     F*         - For existing Discount-based Positions, all B/V Trade*
     F*           Actions must go to BPACBD. SE2230 must read these   *
     F*           Actions and reset BKPHD to enable SE2220 and SE2210 *
     F*           to adjust Amortization and Average Prices correctly.*
     F*           Note:                                               *
     F*           Need to examine impact of applying this change to   *
     F*           other Positions, especially in Amortizing Books.    *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21132 - Full Coupon posted by Rate changes/Trades done on   *
     F*           Coupon Date due to mis-setting of 'Last Coupon Date'*
     F*  E20651 - DB Error Numbers used in more than one place.       *
     F*           New Error Numbers as follows:                       *
     F*           DB ERROR 08 -> 11                                   *
     F*           DB ERROR 08 -> 12                                   *
     F*           DB ERROR 09 -> 13                                   *
     F*           DB ERROR 09 -> 14                                   *
     F*           DB ERROR 10 -> 15                                   *
     F*           DB ERROR 10 -> 16                                   *
     F*           DB ERROR 10 -> 17                                   *
     F*  E20845 - Use Event Date, not Action Date to split Security   *
     F*           Actions.                                            *
     F*  E19434 - Wrong investment type on some trade actions.        *
     F*  E20085 - Interest and Coupon Calculations Rewrite:           *
     F*           - Use SR/ZLCD to set Previous Coupon Date.          *
     F*  E18652 - Changes to process Trades done on Coupon Date.      *
     F*  E16772 - The Dividend Payment Amount fields have been        *
     F*           increased in size from 9,4 to 13,8. Hence the field *
     F*           SDAU has been replaced by SDUN, BBAU by BBUN and    *
     F*           BCAU by BCUN.                                       *
     F*  E15965 - Mark to market revaluation                          *
     F*  E15549 - FIXES CONNECTED WITH REDELIVERY OF POSITION         *
     F*           SETTLEMENT PROGRAMS FROM CD.                        *
     F*           1. SET 'CURRENT LAST COUPON DATE' ON BOOK POSN      *
     F*              ACTIONS.                                         *
     F*           2. ACTIONS INCORRECTLY CLASSIFIED AS BACK-VALUED    *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     FSECACD  IF  E           K        DISK
     FTRDACD  IF  E           K        DISK
     FPRICED  UF  E           K        DISK
     FSEPRICL2UF  E           K        DISK                               188670
     FSECACA  IF  E           K        DISK
     FTRDACA  IF  E           K        DISK
     F***CEA  IF  E           K        DISK
     FPRICEA  UF  E           K        DISK
     FBKPHD   IF  E           K        DISK
     F***BKPOS***IF**E           K        DISK                            E21579
     FSECTY   IF  E           K        DISK                               E15549
     F***SECEO***IF**E           K        DISK                     E15549 E20085
     FBKPHJ1  IF  E           K        DISK                               E15965
     FSEBKPHJ1IF  E           K        DISK                               CAC005
     FBKRVL   IF  E           K        DISK                               E15965
     FBKPOS   IF  E           K        DISK                               103409
     FBPACTTRDIF  E           K        DISK                               103409
     F            BPACCDF                           KRENAMEBPACCDFX       103409
     F            BPACBDF                           KRENAMEBPACBDFX       103409
     FBPACBD  O   E           K        DISK         KINFDS CBDDS
     F                                              KINFSR CBDSR
     FBPACCD  O   E           K        DISK         KINFDS CCDDS
     F                                              KINFSR CCDSR
     FBPACBA  O   E           K        DISK         KINFDS CBADS
     F                                              KINFSR CBASR
     FBPACCA  O   E           K        DISK         KINFDS CCADS
     F                                              KINFSR CCASR
     FSE2110AUO   E                    PRINTER
     FTABSE   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICDSE     TABTB36F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F*********** TABTG10F                          KIGNORE               S01486
     F            TABTG20F                          KIGNORE
     F            TABLETAF                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********** TABLETJF                          KIGNORE               S01117
     F            TABLETLF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETKF                          KIGNORE
     F            TABLETPF                          KIGNORE
     FPMHSEXPDIF  E           K        DISK                           UC  S01486
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE2110FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   21  - NO RECORDS IN PRICED FILE                             *   091803
     F*   22  - PRICE RECORD EXISTS FOR A SECURITY                    *   091803
     F****30**-*WRITE*OUT*TO*BPACBD*IF*ON,*ELSE*WRITE*TO*BPACCD********   E15549
     F*   30  - WRITE OUT TO BPACCD IF ON, ELSE WRITE TO BPACBD       *   E15549
     F****50**-*CHAIN*TO*SECTY,*SECEO***************************** E15549 E20085
     F*   50  - CHAIN TO SECTY                                        *   E20085
     F*   80  - ERROR ON CHAIN                                        *
     F*   87  - END OF FILE ON SECACD                                 *
     F*   88  - END OF FILE ON TRDACD                                 *
     F*   89  - END OF FILE ON PRICED                                 *
     F*                                                               *
     F* 90-99 - USED IN Z-SUBROUTINES                                 *
     F*                                                               *
     F*   U7  - DATABASE ERROR                                        *
     F*   U8  - DATABASE ERROR                                        *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  FIRST  - ACCESSES ICD 1,2 AND SE                             *
     F*  P01    - IDENTIFY POSITIONS AFFECTED BY SECURITY ACTION      *
     F*  P02    - IDENTIFY POSITIONS AFFECTED BY TRADE ACTION         *
     F*  P03    - IDENTIFY POSITIONS AFFECTED BY PRICE CHANGE         *
     F***PRCOUP*-*DETERMINE*COUPON*DATE*PRIOR*TO*ACTION*DATE****** E15549 E20085
     F*  W01    - WRITES BOOK POSITION FOR SECURITY                   *
     F*  W02    - WRITES BOOK POSITION FOR TRADE                      *
     F*  W03    - WRITES BOOK POSITION FOR PRICE                      *
     F*  AUDIT  - OUTPUTS CONTROL REPORT                              *
     F*  BPDSR,BPASR,  ERROR ROUTINES                                 *
     F*  *PSSR  - Error handling                                      *   S01117
     F*                                                               *   E20085
     F*  ZDATE1 - VALIDATES DATES AND CONVERTS TO NO. OF DAYS         *   E20085
     F*  ZDATE2 - CONVERTS A DAY NUMBER TO DATE FORMATS.              *   E20085
     F*  ZEVCD  - CALCULATES EVENT CONTROL DATE                       *
     F*  ZICD2  - ACCESSES ICD 2                                      *
     F*  ZLCD   - CALCULATES LAST COUPON DATE                         *   E20085
     F*  ZSYSTM - ACCESSES ICD 1                                      *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZDATE2Z1                                               E20085
     E/COPY ZSRSRC,ZNCDZ1                                                 E20085
     E                    CPY@    1   1 80
     E                    POWER   1   7  7 3             POWER ARRAY      S01486
     E*                                                                   S01408
     E/COPY WNCPYSRC,SE2110EEP1                                           S01408
     E*                                                                   S01408
     E/COPY ZSRSRC,ZHOLE                                                  182505
      /EJECT
     ITRDACDF                                                                                 CAS006
     I              CNTN                            TCNTN                                     CAS006
     I              INAN                            TINAN                                     CAS006
     I              PCHN                            TPCHN                                     CAS006
     IBPACCDFX                                                            103409
     I              LCCP                            LCCPX                 103409
     IBPACBDFX                                                            103409
     I              LCCP                            LCCPX                 103409
     I*                                                            E15549 E20085
     I***SNDEVDF*                                                  E15549 E20085
     I***********   SNSN                            SDSN           E15549 E20085
     I***********   SNDT                            SDED           E15549 E20085
     I***********   SNET                            SDET           E15549 E20085
     I***SEDEVDF*                                                  E15549 E20085
     I***********   SDCP                            XXSDCP         E15549 E20085
      *
     I/COPY ZSRSRC,ZNCDZ2                                                 E20085
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR BPACCD 'KEY' FIELDS
     I*
     I                                        1  16 ACCK
     I                                        1  10 BCSS
     I***********                            11  130BCBR                  S01117
     I                                       11  13 BCBA                  S01117
     I                                       14  14 BCMK
     I                                       15  16 BCBO
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR BPACBD 'KEY' FIELDS
     I*
     I                                        1  16 ACBK
     I                                        1  10 BBSS
     I***********                            11  130BBBR                  S01117
     I                                       11  13 BBBA                  S01117
     I                                       14  14 BBMK
     I                                       15  16 BBBK
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR TABLE FILE KEY
     I*
     I                                        1  12 TKEY
     I                                        1   20RECT
     I                                        3  10 ZZ008
     I                                       11  120RCDE
     I                                        3   8 ZZ006
     I                                        9  11 RCCY
     I                                       12  12 ZZ001
     I*                                                                   193556
     I            DS                                                      193556
     I*                                                                   193556
     I* DATA STRUCTURE FOR BKPOS READ Previous control.                   193556
     I*                                                                   193556
     I                                        1  17 BPKSV1                193556
     I                                        1  10 BPSC                  193556
     I                                       11  13 BPBA                  193556
     I                                       14  15 BPBK                  193556
     I                                       16  16 BPMK                  193556
     I                                       17  17 BPTV                  193556
     I***********                                                         E21579
     I*****DATA*STRUCTURE*FOR*BKPOS*POSITION***************************   E21579
     I***********                                                         E21579
     I*********** DS                                                      E21579
     I***********                             1  17 BPPOS                 E21579
     I***********                             1  10 BPSC                  E21579
     I***********                            11  130BPBR                  E21579
     I***********                            14  15 BPBK                  E21579
     I***********                            16  16 BPMK                  E21579
     I***********                            17  17 BPTV                  E21579
     I***********                                                         E21579
     I*****DATA*STRUCTURE*FOR*TRDACD*POSITION**************************   E21579
     I***********                                                         E21579
     I*********** DS                                                      E21579
     I***********                             1  17 TRPOS                 E21579
     I***********                             1  10 TDSS                  E21579
     I***********                            11  130TDBR                  E21579
     I***********                            14  15 TDBK                  E21579
     I***********                            16  16 TDMI                  E21579
     I***********                            17  17 TVDA                  E21579
     I*
     I* DATA STRUCTURES FOR RPG 01021 ERROR HANDLING
     I*
     ICBDDS       DS                            366
     I                                     *STATUS  STSCBD
     I*
     ICBADS       DS                            366
     I                                     *STATUS  STSCBA
     I*
     ICCDDS       DS                            366
     I                                     *STATUS  STSCCD
     I*
     ICCADS       DS                            366
     I                                     *STATUS  STSCCA
     I*
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*LDA******* UDS                            256                      S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I*
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I**                                                                  S01486
     I**  EXTERNAL DS FOR MMOD acces object                               S01486
     ISDMMOD    E DSSDMMODPD                                              S01486
     I** S01510 & S01486                                                  S01486
     ISCSARD    E DSSCSARDPD                                              S01510
     I** SAR file                                                         S01510
     I*  S01510 & S01486                                                  S01510
     ISDPORT    E DSSDPORTPD                                              CPM004
     I**  SD Portfolio Management ICD details                             CPM004
     I*                                                                   CPM004
     IDSFDY     E DSDSFDY                                                 S01510
     I** Short data structure for access programs                         S01510
     I*                                                                   S01510
     I              'DiscPremAmortPostn  'C         SVALKK                                    CSE105
      *                                                                                       CSE105
     I/COPY ZSRSRC,ZHOLI                                                  182505
     I/COPY ZSRSRC,ZHOLDS                                                 182505
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C* KEY LISTS FOR CHAINING TO :-
     C*
     C* TABLES
     C*
     C           TABKEY    KLIST
     C                     KFLD           TKEY
     C*
     C* BOOK HEADER FROM SECURITY ACTIONS
     C*
     C           BPHK1     KLIST
     C                     KFLD           SASN
     C*
     C* BOOK HEADER FROM TRADE ACTIONS
     C*
     C           BPHK2     KLIST
     C                     KFLD           TDSS
     C***********          KFLD           TDBR                            S01117
     C                     KFLD           TDBA                            S01117
     C                     KFLD           TDBK
     C                     KFLD           TDMI
     C                     KFLD           TVDA
     C*
     C* BOOK HEADER FROM PRICES
     C*
     C           BPHK3     KLIST
     C                     KFLD           PSSN
     C***********          KFLD           PBRC                            S01117
     C                     KFLD           PBRA                            S01117
     C                     KFLD           PBOK
     C                     KFLD           PMKT
     C                     KFLD           TYPE
     C*                                                                   103409
     C** Book Position from Book Position Header                          103409
     C*                                                                   103409
     C           BPKEY     KLIST                                          103409
     C                     KFLD           BHSC                            103409
     C                     KFLD           BHBA                            103409
     C                     KFLD           BHBK                            103409
     C                     KFLD           BHMK                            103409
     C                     KFLD           BHTV                            103409
     C                     KFLD           LPSD                            103409
     C*                                                                   103409
     C** Today Trade Action from position                                 103409
     C*                                                                   103409
     C           TRDKY     KLIST                                          103409
     C                     KFLD           WBHSC                           103409
     C                     KFLD           WBHBA                           103409
     C                     KFLD           WBHBK                           103409
     C                     KFLD           WBHMK                           103409
     C                     KFLD           WBHTV                           103409
     C*                                                                   103409
     C           TRDK2     KLIST                                          103409
     C                     KFLD           BHSC                            103409
     C                     KFLD           BHBA                            103409
     C                     KFLD           BHBK                            103409
     C                     KFLD           BHMK                            103409
     C                     KFLD           BHTV                            103409
     C*
     C* BOOK POSITION FROM TRADE ACTIONS
     C*
     C           BPOK1     KLIST
     C                     KFLD           TDSS
     C***********          KFLD           TDBR                            S01117
     C                     KFLD           TDBA                            S01117
     C                     KFLD           TDBK
     C                     KFLD           TDMI
     C                     KFLD           TVDA
     C                     KFLD           RUND
     C***********                                                  E15549 E20085
     C***KEY*TO*SET*POINTER*FOR*READ*OF*SECEO********************* E15549 E20085
     C***********                                                  E15549 E20085
     C***********KSECEO    KLIST                                   E15549 E20085
     C***********          KFLD           SECUR                    E15549 E20085
     C***********          KFLD           COUPTP                   E15549 E20085
     C***********          KFLD           EVNTDT                   E15549 E20085
     C*                                                                   E15965
     C* BOOK POSITIONS FOR REVALUATION                                    E15965
     C*                                                                   E15965
     C           BPHJ1K    KLIST                                          E15965
     C                     KFLD           BHSC                            E15965
     C***********          KFLD           BHBR                     E15965 S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK                            E15965
     C*                                                                   091803
     C** PRICED FILE KEY                                                  091803
     C*                                                                   091803
     C           PKEY      KLIST                                          091803
     C                     KFLD           PSSN                            091803
     C                     KFLD           PPRT                            091803
     C                     KFLD           PVDT                            091803
     C*                                                                   S01486
     C           HSEXKY    KLIST                                          S01486
     C                     KFLD           SETCY                           S01486
     C                     KFLD           EVTD                            S01486
      *                                                                   188670
     C           KEY1      KLIST                                          188670
     C                     KFLD           PSSN                            188670
     C                     KFLD           PCNM                            188670
     C                     KFLD           PMKT                            188670
     C                     KFLD           PBRA                            188670
     C                     KFLD           PBOK                            188670
     C                     KFLD           PPRT                            188670
     C                     KFLD           PTFR                            188670
     C*                                                                   103409
     C           *LIKE     DEFN BHSC      WBHSC                           103409
     C           *LIKE     DEFN BHBA      WBHBA                           103409
     C           *LIKE     DEFN BHBK      WBHBK                           103409
     C           *LIKE     DEFN BHMK      WBHMK                           103409
     C           *LIKE     DEFN BHTV      WBHTV                           103409
     C*
     C* PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE2110'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C* CLEAR COUNTS AND WORKFIELDS
     C*
     C                     Z-ADD0         ISEC
     C                     Z-ADD0         ITRDT
     C                     Z-ADD0         ITRDV
     C                     Z-ADD0         IPRI
     C                     Z-ADD0         UPRI
     C                     Z-ADD0         OACB
     C                     Z-ADD0         OACC
     C*
     C*  FIRST CYCLE PROCESS
     C*
     C                     EXSR FIRST
     C*
     C**** THE SECURITY ACTION PROCESS IS BEING MOVED AFTER TRADE         103409
     C**** ACTION                                                         103409
     C***P*R*O*C*E*S*S**S*E*C*U*R*I*T*Y**A*C*T*I*O*N*S**F*I*L*E******     103409
     C***************************************************************     103409
     C***READ*FILE***************************************************     103409
     C************         MOVEL'Y'       SECACT  1                E18652 103409
     C************         READ SECACD                   89               103409
     C***************************************************************     103409
     C***DO*UNTIL*EOF************************************************     103409
     C***************************************************************     103409
     C********** *IN89     DOWEQ'0'**********************************     103409
     C***************************************************************     103409
     C***INCREMENT COUNT*********************************************     103409
     C***************************************************************     103409
     C****************     ADD  1         ISEC    50                      103409
     C*** - Save RECI before overwrite  by Security RECI           E22957 103409
     C***************************************************************     103409
     C****************     MOVE RECI      RECIS   1                E22957 103409
     C*************************************************************E15549 103409
     C**ON*CHANGE*OF*SECURITY*ACCESS*SECURITY*DETAILS*(FOR*PRCOUP) E15549 E20085
     C**ON*CHANGE*OF*SECURITY*ACCESS*SECURITY*DETAILS*(FOR SR/ZLCD)E20085 103409
     C*************************************************************E15549 103409
     C***********SASN      IFNE PSASN                              E15549 103409
     C***********SASN      CHAINSECTY                50            E15549 103409
     C********** *IN50     IFEQ '1'                                E15549 103409
     C**********           MOVE '1'       *INU7                    E15549 103409
     C**********           MOVE '1'       *INU8                    E15549 103409
     C********** *LOCK     IN   LDA                                S01117 103409
     C**********           MOVE 'SECTY'   DBFILE      *************E15549 103409
     C**********           MOVELSASN      DBKEY       * DB ERROR 04E15549 103409
     C**********           Z-ADD4         DBASE       *************E15549 103409
     C**********           OUT  LDA                                S01117 103409
     C**********           EXSR *PSSR                              S01117 103409
     C**********           GOTO EAUDIT                             E15549 103409
     C**********           END                                     E15549 103409
     C**********           MOVELSASN      PSASN  10                E15549 103409
     C**********           END                                     E15549 103409
     C***************************************************************
     C*
     C**ONLY*PROCESS*RECORDS*WHERE*POSN*SETTL*REQD*NOT*=*'Y'***********   E15549
     C***********PSRI      IFNE 'Y'                                       E15549
     C*
     C***************************************************************     103409
     C**ONLY*PROCESS*RECORDS*WHERE*A/C*KEYS*REQD*=*'Y'***************     E15549
     C***************************************************************     103409
     C********** AKRI      IFEQ 'Y'                                E15549 103409
     C***********          MOVE RECI      RECIS   1                E15549 103409
     C********** SAAS      IFEQ '05'                               E15549 103409
     C********** SAAS      OREQ '20'                               E15549 103409
     C********** SAAS      OREQ '35'                               E15549 103409
     C********** SAAS      OREQ '50'                               E15549 103409
     C*************************************************************E15549 103409
     C**DETERMINE*COUPON*DATE*PRIOR*TO*ACTION**********************E15549 103409
     C*************************************************************E15549 103409
     C**********           MOVELSASN      SECUR  10                E15549 103409
     C***********          Z-ADDSAED      EVNTDT  50               E15549 E20085
     C***********          EXSR PRCOUP                             E15549 E20085
     C********** SAAS      IFEQ '50'                               E21132 103409
     C**********           Z-ADDSAED      ZECD                     E21132 103409
     C**********           ELSE                                    E21132 103409
     C********** SAED      SUB  1         ZECD                     E20085 103409
     C**********           END                                     E21132 103409
     C**********           EXSR ZLCD                               E20085 103409
     C**********           Z-ADDZZLCD     LCCP                     E20085 103409
     C**********           END                                     E15549 103409
     C**********           EXSR P01                                       103409
     C**********           END                                            103409
     C***************************************************************     103409
     C** READ*NEXT*RECORD********************************************     103409
     C***************************************************************     103409
     C**********           READ SECACD                   89               103409
     C***************************************************************     103409
     C**********           END                                            103409
     C**********           MOVEL' '       SECACT                   E18652 103409
     C*
     C** P R O C E S S   T R A D E    A C T I O N    F I L E
     C*
     C*  READ FILE
     C*
     C                     READ TRDACD                   89
     C*
     C*  DO UNTIL EOF
     C*
     C           *IN89     DOWEQ'0'
     C*
     C*  INCREMENT COUNT
     C*
     C           TVDA      IFEQ 'T'
     C                     ADD  1         ITRDT   50
     C                     ELSE
     C                     ADD  1         ITRDV   50
     C                     END
     C*                                                                   E15549
     C**ON*CHANGE*OF*SECURITY*ACCESS*SECURITY*DETAILS*(FOR*PRCOUP) E15549 E20085
     C* ON CHANGE OF SECURITY ACCESS SECURITY DETAILS (FOR SR/ZLCD)       E20085
     C*                                                                   E15549
     C           TDSS      IFNE PTDSS                                     E15549
     C           TDSS      CHAINSECTY                50                   E15549
     C           *IN50     IFEQ '1'                                       E15549
     C                     MOVE '1'       *INU7                           E15549
     C                     MOVE '1'       *INU8                           E15549
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SECTY'   DBFILE           ***************E15549
     C                     MOVELSASN      DBKEY            * DB ERROR 05 *E15549
     C                     Z-ADD5         DBASE            ***************E15549
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EAUDIT                                    E15549
     C                     END                                            E15549
     C                     MOVELTDSS      PTDSS  10                       E15549
     C                     END                                            E15549
     C*
     C* ONLY PROCESS RECORDS WHERE ACTION SEQ NE 11 OR 70
     C*
     C           ACTS      IFNE '11'
     C           ACTS      ANDNE'70'
     C*                                                                   E15549
     C* DETERMINE COUPON DATE PRIOR TO ACTION                             E15549
     C*                                                                   E15549
     C                     MOVELTDSS      SECUR                           E15549
     C***********          Z-ADDEVTD      EVNTDT                   E15549 E20085
     C***********          EXSR PRCOUP                             E15549 E20085
     C***********EVTD      SUB  1         ZECD                     E20085 E21132
     C*                                                                   E22957
     C*** On Trade Date Position find Coupon before OTHER DATE.           E22957
     C*                                                                   E22957
     C           TVDA      IFEQ 'T'                                       E22957
     C                     Z-ADDOTRD      ZECD                            E22957
     C                     ELSE                                           E22957
     C                     Z-ADDEVTD      ZECD                            E21132
     C                     END                                            E22957
     C*                                                                   E22957
     C                     EXSR ZLCD                                      E20085
     C                     Z-ADDZZLCD     LCCP                            E20085
     C                     EXSR P02
     C                     END
     C*
     C*  READ NEXT RECORD
     C*
     C                     READ TRDACD                   89
     C*
     C                     END
     C** P R O C E S S    S E C U R I T Y    A C T I O N S    F I L E     103409
     C*                                                                   103409
     C*  READ FILE                                                        103409
     C                     MOVEL'Y'       SECACT  1                       103409
     C                     READ SECACD                   89               103409
     C*                                                                   103409
     C*  DO UNTIL EOF                                                     103409
     C*                                                                   103409
     C           *IN89     DOWEQ'0'                                       103409
     C*                                                                   103409
     C*  INCREMENT COUNT                                                  103409
     C*                                                                   103409
     C                     ADD  1         ISEC    50                      103409
     C*** - Save RECI before overwrite by security RECI                   103409
     C*                                                                   103409
     C                     MOVE RECI      RECIS   1                       103409
     C*                                                                   103409
     C*  ON CHANGE OF SECURITY ACCESS SECURITY DETAILS (FOR SR/ZLCD)      103409
     C*                                                                   103409
     C           SASN      IFNE PSASN                                     103409
     C           SASN      CHAINSECTY                50                   103409
     C           *IN50     IFEQ '1'                                       103409
     C                     MOVE '1'       *INU7                           103409
     C                     MOVE '1'       *INU8                           103409
     C           *LOCK     IN   LDA                                       103409
     C                     MOVE 'SECTY'   DBFILE           ***************103409
     C                     MOVELSASN      DBKEY            * DB ERROR 04 *103409
     C                     Z-ADD4         DBASE            ***************103409
     C                     OUT  LDA                                       103409
     C                     EXSR *PSSR                                     103409
     C                     GOTO EAUDIT                                    103409
     C                     END                                            103409
     C                     MOVELSASN      PSASN  10                       103409
     C                     END                                            103409
     C*                                                                   103409
     C*  ONLY PROCESS RECORDS WHERE A/C KEYS REQD = 'Y'                   103409
     C*                                                                   103409
     C           AKRI      IFEQ 'Y'                                       103409
     C           SAAS      IFEQ '05'                                      103409
     C           SAAS      OREQ '20'                                      103409
     C           SAAS      OREQ '35'                                      103409
     C           SAAS      OREQ '50'                                      103409
     C*                                                                   103409
     C*  DETERMINE COUPON DATE PRIOR TO ACTION                            103409
     C*                                                                   103409
     C                     MOVELSASN      SECUR   10                      103409
     C           SAAS      IFEQ '50'                                      103409
     C*                                                                   182505
     C           BCNV      IFNE ' '                                       182505
     C           BCNV      ANDNE'N'                                       CSE031
     C                     Z-ADDSAED      ZDAYNO                          182505
     C                     MOVE NMCY      ZCCY                            182505
     C                     MOVE *BLANKS   ZLOC                            182505
     C                     Z-ADD1         ZNRDYS                          182505
     C                     EXSR ZFWDT                                     182505
     C                     Z-ADDZDYNBR    ZECD                            182505
     C                     ELSE                                           182505
     C                     Z-ADDSAED      ZECD                            103409
     C                     ENDIF                                          182505
     C*                                                                   182505
     C                     Z-ADDSAED      ZECD                            103409
     C                     ELSE                                           103409
     C           SAED      SUB  1         ZECD                            103409
     C                     END                                            103409
     C                     EXSR ZLCD                                      103409
     C                     Z-ADDZZLCD     LCCP                            103409
     C                     END                                            103409
     C                     EXSR P01                                       103409
     C                     END                                            103409
      *
      *** Save value of last coupon date before ZLCD                                          210390
      *** processing.                                                                         210390
      *                                                                                       210390
     C                     Z-ADD*ZERO     XXLCCP  50                                          210390
     C                     Z-ADDLCCP      XXLCCP                                              210390
     C*                                                                   103409
     C*  READ NEXT RECORD                                                 103409
     C*                                                                   103409
     C                     READ SECACD                   89               103409
     C*                                                                   103409
     C                     END                                            103409
     C                     MOVEL' '       SECACT                          103409
     C*
     C** P R O C E S S    P R I C E   C H A N G E S    F I L E
     C*
     C*  READ FILE
     C*
     C                     READ PRICED                   89
     C*
     C*  DO UNTIL EOF
     C*
     C           *IN89     DOWEQ'0'
     C           RECI      IFNE '*'
     C*
     C*  INCREMENT COUNT
     C*
     C                     ADD  1         IPRI    50
     C*
     C* ONLY PROCESS RECORDS WHERE PRICE TYPE = 'DT' OR 'DV'
     C*
     C           PPRT      IFEQ 'DT'
     C           PPRT      OREQ 'DV'
     C                     EXSR P03
     C                     END
     C*
     C                     END
     C*
     C*  READ NEXT RECORD
     C                     READ PRICED                   89
     C*
     C                     END
     C*                                                                   E15965
     C** B O O K   P O S I T I O N S   F O R   R E V A L U A T I O N      E15965
     C*                                                                   E15965
     C*  (DONE ONLY IF FIFO ACCOUNTING INDICATOR IS OFF)                  E15965
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2110CCP1                                           S01408
     C*                                                                   E15965
     C*  IF NEXT MARK TO MARKET REVALUATION DATE IS LESS THAN OR          E15965
     C*  EQUAL TO THE EVENT CONTROL DATE,                                 E15965
     C*  PREPARE ALL BOOK POSITIONS FOR REVALUATION                       E15965
     C*                                                                   E15965
     C/COPY WNCPYSRC,SE2110CCP2                                           S01408
     C*                                                                   S01408
     C           FIFO      IFNE 'Y'                                       E15965
     C           MMND      IFLE ECD                                       E15965
     C           MMKF      ANDNE*BLANKS                                   060715
     C                     MOVEL'Y'       MMREVL  1                       E15965
     C                     Z-ADDMMND      MRVLDT  50                      E15965
     C                     EXSR P04                                       E15965
     C                     ELSE                                           E15965
     C                     Z-ADDRUND      MRVLDT                          E15965
     C*                                                                   E15965
     C*  OTHERWISE, CHECK FOR REQUESTED BOOK POSITIONS FOR REVALUATION    E15965
     C*                                                                   E15965
     C                     READ BKRVL                    89               E15965
     C*                                                                   E15965
     C*  DO UNTIL EOF                                                     E15965
     C*                                                                   E15965
     C           *IN89     DOWEQ'0'                                       E15965
     C                     ADD  1         IRVL    50                      E15965
     C                     EXSR P04                                       E15965
     C                     READ BKRVL                    89               E15965
     C                     END                                            E15965
     C*                                                                   E15965
     C                     END                                            E15965
     C                     END                                            E15965
     C*
     C/COPY WNCPYSRC,SE2110CCP3                                           S01408
     C*                                                                   S01408
     C* OUTPUT CONTROL REPORT AND WRITE AUDIT RECORD
     C*
     C           EAUDIT    TAG                             ** EAUDIT **
     C*
     C                     EXSR AUDIT
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C                     SETON                     LR
      *                                                               *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  FIRST  - Subroutine to access ICD 1, 2 and SE.               *
      *                                                               *
      *  Calls: ZSYSTM, ZICD2, ZICDSE                                 *
      *                                                               *
      *****************************************************************
      *
     C           FIRST     BEGSR                           *** FIRST  ***
     C*
     C                     EXSR ZSYSTM
     C*
     C* ERROR IN ZSYSTM
     C*
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C                     Z-ADD1         DBASE            * DB ERROR 01 *
     C                     MOVEL'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C*
     C                     ELSE
     C*
     C                     EXSR ZICD2
     C*
     C* ERROR IN ZICD2
     C*
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD2         DBASE            ***************
     C                     MOVEL'TABLE'   DBFILE           * DB ERROR 02 *
     C                     MOVELTKEY      DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C*
     C                     END
     C                     END
     C*
     C* ACCESS ICD FOR SE (TABTB36), UNLESS ERROR ON PREVIOUS TABLES
     C*
     C           *IN99     IFEQ '0'
     C                     EXSR ZICDSE
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVEL'ICDSE'   DBKEY            * DB ERROR 03 *
     C                     Z-ADD3         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C                     END
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVE '1'       *INU7                           S01486
     C                     MOVE '1'       *INU8                           S01486
     C                     MOVEL'SDMMODPD'DBFILE           ***************S01486
     C                     MOVEL*BLANKS   DBKEY            ** DB ERROR 20 S01486
     C                     Z-ADD20        DBASE            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     EXSR *PSSR                                     S01486
     C                     ENDIF                                          S01486
     C** PORTFOLIO MANAGEMENT ON THEN                                     S01486
     C*                                                                   S01486
     C* OPEN PMHSEXPD                                                     S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C                     OPEN PMHSEXPD                                  S01486
     C                     ENDIF                                          S01486
     C*                                                                   S01486
     C* ACCESS DECIMAL PLACES OF BASE CURRENCY RATE                       S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C**                                                                  S01486
     C           *IN99     IFEQ '0'                                       S01486
     C                     MOVEL'20      'ZTABKY                          S01486
     C                     MOVELBCCY      WRK4    4                       S01486
     C                     MOVE '1'       WRK4                            S01486
     C                     MOVE WRK4      ZTABKY                          S01486
     C           ZTABKY    CHAINTABTG10F             99                   S01486
     C           *IN99     IFEQ '1'                                       S01486
     C           RECI      ORNE 'D'                                       S01486
     C                     MOVE '1'       *INU7                           S01486
     C                     MOVE '1'       *INU8                           S01486
     C                     MOVE 'TABLE'   DBFILE           ***************S01486
     C                     MOVEL'TG10F'   DBKEY            ** DB ERROR 21 S01486
     C                     Z-ADD21        DBASE            ***************S01486
     C                     ELSE                                           S01486
     C                     Z-ADDCDP       BCDP    10                      S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   CPM004
     C** IF PORTFOLIO MANAGEMENT SWITCHED ON                              CPM004
     C*                                                                   CPM004
     C           BGPFMG    IFEQ 'Y'                                       CPM004
     C*                                                                   CPM004
     C**  Access Portfolio Management ICD                                 CPM004
     C*                                                                   CPM004
     C                     CALL 'AOPORTR0'                                CPM004
     C                     PARM *BLANKS   @RTCD                           CPM004
     C                     PARM '*FIRST'  @OPTN                           CPM004
     C           SDPORT    PARM SDPORT    DSFDY                           CPM004
     C*                                                                   CPM004
     C           @RTCD     IFNE *BLANKS                                   CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVE '1'       *INU7                           CPM004
     C                     MOVE '1'       *INU8            ***************CPM004
     C                     Z-ADD40        DBASE            * DB ERROR 40 *CPM004
     C                     MOVEL'SDPORTPD'DBFILE           ***************CPM004
     C                     MOVEL'*FIRST'  DBKEY                           CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
     C                     END                                            CPM004
     C*
     C** GET EVENT CONTROL DATE
     C*
     C                     Z-ADDDNWD      ZZDNWD                          S01117
     C                     Z-ADDAPDA      ZZAPDT                          S01117
     C                     EXSR ZEVCD
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2110CCP4                                           S01408
      *                                                                                       CSE105
      ** Access SAR details file to see if feature CSE105 is installed.                       CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSARDR0'                                                    CSE105
     C                     PARM '       ' @RTCD                                               CSE105
     C                     PARM '*VERIFY' @OPTN                                               CSE105
     C                     PARM 'CSE105'  @SARD                                               CSE105
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE105
      *                                                                                       CSE105
     C           @RTCD     IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'Y'       CSE105  1                                           CSE105
     C                     ELSE                                                               CSE105
     C                     MOVE 'N'       CSE105                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** Check system values if CSE105 is switched on                                         CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSVALR0'                                                    CSE105
     C                     PARM *BLANKS   @RTCD                                               CSE105
     C                     PARM SVALKK    SVALK1 20                                           CSE105
     C                     PARM           SVAL1 200                                           CSE105
     C                     PARM *BLANK    SVALK2 20                                           CSE105
     C                     PARM           SVAL2 200                                           CSE105
     C                     PARM *BLANK    SVALK3 20                                           CSE105
     C                     PARM           SVAL3 200                                           CSE105
     C                     PARM *BLANK    SVALK4 20                                           CSE105
     C                     PARM           SVAL4 200                                           CSE105
     C                     PARM *BLANK    SVALK5 20                                           CSE105
     C                     PARM           SVAL5 200                                           CSE105
     C                     PARM *BLANK    SVALK6 20                                           CSE105
     C                     PARM           SVAL6 200                                           CSE105
     C                     PARM *BLANK    SVALK7 20                                           CSE105
     C                     PARM           SVAL7 200                                           CSE105
     C                     PARM *BLANK    SVALK8 20                                           CSE105
     C                     PARM           SVAL8 200                                           CSE105
     C                     PARM *BLANK    SVALK9 20                                           CSE105
     C                     PARM           SVAL9 200                                           CSE105
     C                     PARM *BLANK    SVALK0 20                                           CSE105
     C                     PARM           SVAL10200                                           CSE105
      *                                                                                       CSE105
     C           @RTCD     IFNE *BLANKS                                                       CSE105
     C           *LOCK     IN   LDA                                                           CSE105
     C                     MOVE 'SDSVALPD'DBFILE                                              CSE105
     C                     MOVELSVALK1    DBKEY                                               CSE105
     C                     Z-ADD15        DBASE                                               CSE105
     C                     OUT  LDA                                                           CSE105
     C                     EXSR *PSSR                                                         CSE105
     C                     SETON                       U7U8                                   CSE105
     C                     ELSE                                                               CSE105
     C                     MOVELSVAL1     SESVAL  1                                           CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C           SESVAL    IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'V'       SESVAL                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD   7                                           CSE035
     C                     PARM '*VERIFY' @OPTN   7                                           CSE035
     C                     PARM 'CSE035'  @SARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
     C*                                                                   S01510
     C** Check if S01510 (Dividend Payments) is active                    S01510
     C*                                                                   S01510
     C                     CALL 'AOSARDR0'                                S01510
     C                     PARM *BLANKS   @RTCD   7                       S01510
     C                     PARM '*VERIFY' @OPTN   7                       S01510
     C                     PARM 'S01510'  @SARD   6                       S01510
     C           SCSARD    PARM SCSARD    DSFDY                           S01510
     C*                                                                   S01510
     C           @RTCD     IFEQ *BLANK                                    S01510
     C                     MOVE 'Y'       S01510  1                       S01510
     C                     ELSE                                           S01510
     C                     MOVE 'N'       S01510                          S01510
     C*                                                                   S01510
     C** database error (return code other than *NRF)                     S01510
     C*                                                                   S01510
     C           @RTCD     IFNE '*NRF   '                                 S01510
     C           *LOCK     IN   LDA                                       S01510
     C                     MOVEL'SCSARDPD'DBFILE           ***************S01510
     C                     MOVEL'*VERIFY' DBKEY            * DB ERROR 18 *S01510
     C                     Z-ADD18        DBASE            ***************S01510
     C                     SETON                     U7U8                 S01510
     C                     OUT  LDA                                       S01510
     C                     EXSR *PSSR                                     S01510
     C                     END                                            S01510
     C                     END                                            S01510
      *                                                                   CAC005
      ***  Check if CAC005 - PCA-SE Enhancement is on.                    CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*VERIFY' @OPTN   7                       CAC005
     C                     PARM 'CAC005'  @SARD   6                       CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                                       CSD010
      **  Access SAR details file to see if CSD010 is installed.                              CSD010
      *                                                                                       CSD010
     C                     CALL 'AOSARDR0'                                                    CSD010
     C                     PARM *BLANKS   PRTCD   7                                           CSD010
     C                     PARM '*VERIFY' POPTN   7                                           CSD010
     C                     PARM 'CSD010'  PSARD   6                                           CSD010
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD010
      *                                                                                       CSD010
     C           PRTCD     IFNE *BLANKS                                                       CSD010
     C           PRTCD     ANDNE'*NRF    '                                                    CSD010
     C           *LOCK     IN   LDA                                                           CSD010
     C                     MOVE 'SCSARDPD'DBFILE                                              CSD010
     C                     Z-ADD46        DBASE                                               CSD010
     C                     MOVEL'CSD010'  DBKEY                                               CSD010
     C                     MOVE *ON       *INU7                                               CSD010
     C                     MOVE *ON       *INU8                                               CSD010
     C                     OUT  LDA                                                           CSD010
     C                     EXSR *PSSR                                                         CSD010
     C                     ENDIF                                                              CSD010
      *                                                                                       CSD010
     C           PRTCD     IFEQ *BLANKS                                                       CSD010
     C                     MOVE 'Y'       CSD010  1                                           CSD010
     C                     ELSE                                                               CSD010
     C                     MOVE 'N'       CSD010                                              CSD010
     C                     ENDIF                                                              CSD010
     C*
      *                                                                                       CAS006
      **  Access SAR details file to see if CAS006 is installed.                              CAS006
      *                                                                                       CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   PRTCD   7                                           CAS006
     C                     PARM '*VERIFY' POPTN   7                                           CAS006
     C                     PARM 'CAS006'  PSARD   6                                           CAS006
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS006
      *                                                                                       CAS006
     C           PRTCD     IFNE *BLANKS                                                       CAS006
     C           PRTCD     ANDNE'*NRF    '                                                    CAS006
     C           *LOCK     IN   LDA                                                           CAS006
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS006
     C                     Z-ADD47        DBASE                                               CAS006
     C                     MOVEL'CAS006'  DBKEY                                               CAS006
     C                     MOVE *ON       *INU7                                               CAS006
     C                     MOVE *ON       *INU8                                               CAS006
     C                     OUT  LDA                                                           CAS006
     C                     EXSR *PSSR                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           PRTCD     IFEQ *BLANKS                                                       CAS006
     C                     MOVE 'Y'       CAS006  1                                           CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'N'       CAS006                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Output the Control Report.            *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR                           *** AUDIT  ***
     C*
     C* READ SECACD AUDIT RECORD
     C*
     C           *INU8     IFEQ '0'
     C                     READ SECACA                   89
     C           *IN89     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C***********          Z-ADD10        DBASE            **DB*ERROR*10**E20651
     C                     Z-ADD15        DBASE            * DB ERROR 15 *E20651
     C                     MOVEL'SECACA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C                     Z-ADDNORE      SNORE   50
     C*
     C* IF RECORD COUNT NOT EQUAL TO AUDIT COUNT
     C*
     C           SNORE     IFNE ISEC
     C                     SETON                     57U8
     C                     END
     C                     END
     C                     END
     C*
     C* READ TRDACD AUDIT RECORD
     C*
     C           *INU8     IFEQ '0'
     C                     READ TRDACA                   89
     C           *IN89     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C***********          Z-ADD10        DBASE            **DB*ERROR*10**E20651
     C                     Z-ADD16        DBASE            * DB ERROR 16 *E20651
     C                     MOVEL'TRDACA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C*
     C* IF RECORD COUNT NOT EQUAL TO AUDIT COUNT
     C*
     C           NORT      IFNE ITRDT
     C                     SETON                     58U8
     C                     END
     C           NRDT      IFNE ITRDV
     C                     SETON                     59U8
     C                     END
     C                     END
     C                     END
     C*
     C* READ PRICED AUDIT RECORD
     C*
     C           *INU8     IFEQ '0'
     C                     READ PRICEA                   89
     C           *IN89     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C***********          Z-ADD10        DBASE            **DB*ERROR*10**E20651
     C                     Z-ADD17        DBASE            * DB ERROR 17 *E20651
     C                     MOVEL'PRICEA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C                     Z-ADDNORE      PNORE   50
     C*
     C* IF RECORD COUNT NOT EQUAL TO AUDIT COUNT
     C*
     C           PNORE     IFNE IPRI
     C                     SETON                     60U8
     C                     END
     C*
     C* Update audit file with deleted records if no errors
     C*
     C           *INU8     IFEQ '0'
     C                     SUB  UPRI      SLRB
     C                     SUB  UPRI      NORE
     C                     UPDATPRICEAF
     C                     END
     C*
     C                     END
     C                     END
     C*
     C* OUTPUT CONTROL REPORT
     C*
     C                     WRITEHEADR
     C*
     C           *INU7     IFEQ '0'
     C***********ISEC      IFEQ 0                                         E29170
     C***********ITRDT     ANDEQ0                                         E29170
     C***********ITRDV     ANDEQ0                                         E29170
     C***********IPRI      ANDEQ0                                         E29170
     C***********          WRITENONE                                      E29170
     C***********          ELSE                                           E29170
     C                     WRITECONTROL
     C***********          END                                            E29170
     C                     ELSE
     C*
     C                     WRITEERROR
     C                     END
     C***********                                                         E29170
     C***********          WRITETRAIL                                     E29170
     C*
     C* WRITE BPACBA RECORD
     C*
     C           *INU8     IFEQ '0'
     C                     MOVE OACB      NORE
     C                     WRITEBPACBAF
     C                     END
     C*
     C* WRITE BPACCA RECORD
     C*
     C           *INU8     IFEQ '0'
     C                     MOVE OACC      NORE
     C                     WRITEBPACCAF
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  P01    - Subroutine to Identify the Positions affected by a  *
      *           Security Action.                                    *
      *                                                               *
      *****************************************************************
      *
     C           P01       BEGSR                           ***  P01   ***
     C*
     C**  PROCESS ALL BOOK POSITION HEADERS FOR THIS SECURITY
     C*
     C           BPHK1     SETLLBKPHD
     C           BPHK1     READEBKPHD                    80
     C           *IN80     DOWEQ'0'
     C           RECI      IFNE '*'
     C*                                                                   103409
     C                     MOVE BHSC      WBHSC                           103409
     C                     MOVE BHBA      WBHBA                           103409
     C                     MOVE BHBK      WBHBK                           103409
     C                     MOVE BHMK      WBHMK                           103409
     C                     MOVE BHTV      WBHTV                           103409
     C*                                                                   103409
     C***  Check position hold is zero, if it is then need to check       103409
     C***  if there are any trade actions for today.                      103409
     C*                                                                   103409
     C           BPKEY     CHAINBKPOS                34                   103409
     C           *IN34     IFEQ '1'                                       103409
     C                     MOVE '1'       *INU7                           103409
     C                     MOVE '1'       *INU8                           103409
     C           *LOCK     IN   LDA                                       103409
     C                     MOVE 'BKPOS'   DBFILE           ***************103409
     C                     MOVELBHSC      DBKEY            * DB ERROR 43 *103409
     C                     Z-ADD43        DBASE            ***************103409
     C                     OUT  LDA                                       103409
     C                     EXSR *PSSR                                     103409
     C                     GOTO EAUDIT                                    103409
     C                     END                                            103409
     C                     MOVE 'Y'       MMREQ                           103409
     C           NPSN      IFEQ 0                                         103409
     C           ECNP      ANDEQ0                                         103409
     C           TRDK2     CHAINBPACTTRD             34                   103409
     C           *IN34     IFEQ '1'                                       103409
     C                     MOVE BPKSV1    BPKSV2 17                       193556
     C                     MOVE '0'       *IN34                                               203061
     C           NPSN      DOWEQ0                                         193556
     C           ECNP      ANDEQ0                                         193556
     C           BPKSV1    ANDEQBPKSV2                                    193556
     C           *IN34     ANDEQ'0'                                                           203061
     C                     READPBKPOS                    34               193556
     C                     END                                            193556
     C           NPSN      IFEQ 0                                         193556
     C           ECNP      ANDEQ0                                         193556
     C           BPKSV1    ORNE BPKSV2                                    193556
     C                     MOVE 'N'       MMREQ   1                       103409
     C                     END                                            193556
     C                     END                                            103409
     C                     END                                            103409
     C*                                                                   103409
     C***  Only output if it is needed.                                   103409
     C***  (No for zero position and position record generated with       103409
     C***  trade input today but deleted)                                 103409
     C*                                                                   103409
     C           MMREQ     IFEQ 'Y'                                       103409
     C*
     C** If S01510 is active, if dividend event, use ex-dividend date     S01510
     C*                                                                   S01510
     C           SAAT      IFEQ 'DV'                                      S01510
     C           S01510    ANDEQ'Y'                                       S01510
     C                     Z-ADDSAEXD     SAED                            S01510
     C                     END                                            S01510
     C*
     C** IF TR/VAL DATE BASIS = 'T'
     C*
     C           BHTV      IFEQ 'T'
     C*
     C** IF ACTION TYPE IS 'PP' OR 'MA'
     C*
     C           SAAT      IFEQ 'PP'
     C           SAAT      OREQ 'MA'
     C           SAAT      OREQ 'DV'                                      E21639
     C*
     C** IF SEC ACTION DATE LT LATEST POSN DATE
     C*
     C***********SAAC      IFGT LPSD                                      E20845
     C***********SAED      IFGT LPSD                               E20845 E22957
     C/COPY WNCPYSRC,SE2110C001
      *                                                                                       CSE105
      ** Access SAR details file to see if feature CSE105 is installed.                       CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'N'                                                           CSE105
     C           SESVAL    OREQ 'V'                                                           CSE105
     C           SAAT      OREQ 'DV'                                                          CSE105
      *                                                                                       CSE105
     C           SAED      IFGT LPCD                                      E22957
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '0'       *IN30
     C                     Z-ADDXXLCCP    LCCP                                                210390
     C                     END
     C/COPY WNCPYSRC,SE2110C002
      *                                                                                       CSE105
     C                     ELSE                                                               CSE105
      *                                                                                       CSE105
     C           ACLD      IFEQ 'Y'                                                           CSE105
     C                     ADD  1         LATD                                                CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C           SAED      IFGT LPCD                                                          CSE105
     C           SAED      ANDGELATD                                                          CSE105
     C                     MOVE '1'       *IN30                                               CSE105
     C                     ELSE                                                               CSE105
     C                     MOVE '0'       *IN30                                               CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     EXSR W01
     C                     END
     C*
     C* ELSE TR/VAL BASIS = 'V'
     C*
     C                     ELSE
     C           ACLD      IFEQ 'Y'                                       E29207
     C                     ADD  1         LATD                            E29207
     C                     END                                            E29207
     C           SAAT      IFNE 'DV'                                      E21639
     C***********SAAC      IFGT LPSD                                      E20845
     C***********SAED      IFGT LPSD                               E20845 E22957
     C           SAED      IFGT LPCD                                      E22957
     C           SAED      ANDGELATD                                      E29207
     C           SAAT      ANDNE'IR'                                      056512
     C           SAAT      ANDNE'CP'                                      101284
     C           SAAT      OREQ 'IR'                                      056512
     C           SAED      ANDGELPCD                                      056512
     C           RECIS     ANDNE'R'                                       112418
     C           SAAT      OREQ 'CP'                                      101284
     C           SAED      ANDGELPCD                                      101284
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '0'       *IN30
     C                     Z-ADDXXLCCP    LCCP                                                210390
     C                     END
     C                     EXSR W01
     C                     END
     C                     END                                            E21639
     C*
     C                     END
     C                     END                                            103409
     C*                                                                   103409
     C*
     C*  READ NEXT BOOK HEADER FOR THIS SECURITY
     C*
     C           BPHK1     READEBKPHD                    80
     C*                                                                   103409
     C*** Check today trade action to see if Value Date Security action   103409
     C*** is needed when no value date record found in BKPHDD.            103409
     C*                                                                   103409
     C           BHSC      IFNE WBHSC                                     103409
     C           BHBA      ORNE WBHBA                                     103409
     C           BHBK      ORNE WBHBK                                     103409
     C           BHMK      ORNE WBHMK                                     103409
     C           *IN80     OREQ '1'                                       103409
     C           WBHTV     IFNE 'V'                                       103409
     C                     MOVE 'V'       WBHTV                           103409
     C           TRDKY     CHAINBPACTTRD             34                   103409
     C           *IN34     IFEQ '0'                                       103409
     C                     MOVE 'Y'       GENMM   1                       103409
     C                     MOVE '1'       *IN30                           103409
     C                     EXSR W01                                       103409
     C                     MOVE 'N'       GENMM                           103409
     C                     END                                            103409
     C                     END                                            103409
     C                     END                                            103409
     C*
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  P02    - Subroutine to Identify the Positions affected by a  *
      *           Trade Action.                                       *
      *                                                               *
      *****************************************************************
      *
     C           P02       BEGSR                           ***  P02   ***
     C*
     C**  READ BOOK POSITION HEADER FOR THIS TRADE
     C*
     C           BPHK2     CHAINBKPHD                80
     C*
     C           *IN80     IFEQ '1'
     C           RECI      OREQ '*'
     C                     MOVE TDSS      BHSC
     C***********          Z-ADDTDBR      BHBR                            S01117
     C                     MOVE TDBA      BHBA                            S01117
     C                     MOVE TDMI      BHMK
     C                     MOVE TDBK      BHBK
     C                     MOVE TVDA      BHTV
      *                                                                   E19434
      ***  If no live BKPHD record found, use Investment Type from        E19434
      ***  Security. (Note: SR/W02 moves INVT into BBIT or BCIT.)         E19434
      *                                                                   E19434
     C                     MOVE SITP      INVT                            E19434
      *                                                                   E19434
     C*********************END                                            E29229
     C                     SETON                     30                   E29229
     C                     ELSE                                           E29229
     C*
     C**Fetch*position*date*prior*to*today*****************************   E21579
     C**-*if*not*found*or*event*date*is*later,*write*to*BPACCD*********   E21579
     C****ELSE,*write*to*BPACBD****************************************   E21579
     C*
      **  Write ALL backvalued actions to BPACBD.                         E21579
     C*
     C***********BPOK1     SETLLBKPOSDF                                   E21579
     C***********          READPBKPOSDF                  80               E21579
     C*
     C************IN80     IFEQ '1'                                       E21579
     C***********          SETON                     30                   E21579
     C***********          ELSE                                           E21579
     C***********TRPOS     IFNE BPPOS                                     E21579
     C***********          SETON                     30                   E21579
     C***********          ELSE                                           E21579
     C***********EVTD      IFGT BPPD                                      E21579
     C***********EVTD      IFGE RUND                               E21579 E22957
     C           ACLD      IFEQ 'Y'                                       E29207
     C                     ADD  1         LATD                            E29207
     C                     END                                            E29207
     C           EVTD      IFGT LPCD                                      E22957
     C           EVTD      ANDGELATD                                      E29207
     C                     SETON                     30
     C                     ELSE
     C                     SETOF                     30
     C                     END
     C***********          END                                            E21579
     C***********          END                                            E21579
     C                     END                                            E29229
     C*
     C                     EXSR W02
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2110CCP5                                           S01408
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  P03    - Subroutine to Identify the Positions affected by a  *
      *           Price Change.                                       *
      *                                                               *
      *****************************************************************
      *
     C           P03       BEGSR                           ***  P03   ***
     C*
     C** ONLY PROCESS IF VALUE DATE (PRICED) LE EVENT CONTROL DATE
     C*
     C           PVDT      IFLE ECD
      *                                                                                       CSD010
      ** If CSD010 is installed, Mid-price will be overwritten with the                       CSD010
      ** Closing Price                                                                        CSD010
      *                                                                                       CSD010
     C           CSD010    IFEQ 'Y'                                                           CSD010
     C                     Z-ADDPRCLPR    PPRC                                                CSD010
     C                     ENDIF                                                              CSD010
     C*
     C** IF TRADE DATE AVG PRICE (I.E. PRICE TYPE = DT)
     C*
     C           PPRT      IFEQ 'DT'
     C*
     C** READ BOOK POSITION HEADER FOR THIS PRICE, TR/VAL = 'T'
     C*
     C                     MOVE 'T'       TYPE    1
     C           BPHK3     CHAINBKPHD                80
     C           *IN80     IFEQ '0'
     C           RECI      ANDNE'*'
     C*                                                                   103409
     C*** Check position hold is zero, if it is then need to check        103409
     C*** if there are any trade action for today.                        103409
     C*                                                                   103409
     C           BPKEY     CHAINBKPOS                34                   103409
     C           *IN34     IFEQ '1'                                       103409
     C                     MOVE '1'       *INU7                           103409
     C                     MOVE '1'       *INU8                           103409
     C           *LOCK     IN   LDA                                       103409
     C                     MOVE 'BKPOS'   DBFILE           ***************103409
     C                     MOVELBHSC      DBKEY            * DB ERROR 44 *103409
     C                     Z-ADD44        DBASE            ***************103409
     C                     OUT  LDA                                       103409
     C                     EXSR *PSSR                                     103409
     C                     GOTO EAUDIT                                    103409
     C                     END                                            103409
     C                     MOVE 'Y'       MMREQ                           103409
     C           NPSN      IFEQ 0                                         103409
     C           TRDK2     CHAINBPACTTRD             34                   103409
     C           *IN34     IFEQ '1'                                       103409
     C                     MOVE 'N'       MMREQ   1                       103409
     C                     END                                            103409
     C                     END                                            103409
     C*                                                                   103409
     C*                                                                   103409
     C*** Only output an DT action if it is needed.                       103409
     C*** (No DT for zero position and position record generated with     103409
     C***  trade input today but deleted).                                103409
     C*                                                                   103409
     C           MMREQ     IFEQ 'Y'                                       103409
     C*
     C***IF*VALUE*DATE*LT*LATEST*POSN*DATE*******                         E22957
     C** IF VALUE DATE LT LATEST POSN CHANGE DATE                         E22957
     C********** PVDT      IFGT LPSD                                      E22957
     C           PVDT      IFGT LPCD                                      E22957
     C*
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '0'       *IN30
     C                     END
     C                     EXSR W03
     C*
     C                     END
     C                     END                                            103409
     C*
     C*  ELSE  (PRICE TYPE  = DV)
     C*
     C                     ELSE
     C*
     C** READ BOOK POSITION HEADER FOR THIS PRICE, TR/VAL = 'T'
     C*
     C                     MOVE 'V'       TYPE
     C           BPHK3     CHAINBKPHD                80
     C           *IN80     IFEQ '0'
     C           RECI      ANDNE'*'
     C*                                                                   103409
     C*** Check position hold is zero, if it is then need to check        103409
     C*** if there are any trade action for today.                        103409
     C*                                                                   103409
     C           BPKEY     CHAINBKPOS                34                   103409
     C           *IN34     IFEQ '1'                                       103409
     C                     MOVE '1'       *INU7                           103409
     C                     MOVE '1'       *INU8                           103409
     C           *LOCK     IN   LDA                                       103409
     C                     MOVE 'BKPOS'   DBFILE           ***************103409
     C                     MOVELBHSC      DBKEY            * DB ERROR 45 *103409
     C                     Z-ADD45        DBASE            ***************103409
     C                     OUT  LDA                                       103409
     C                     EXSR *PSSR                                     103409
     C                     GOTO EAUDIT                                    103409
     C                     END                                            103409
     C                     MOVE 'Y'       MMREQ                           103409
     C           NPSN      IFEQ 0                                         103409
     C           TRDK2     CHAINBPACTTRD             34                   103409
     C           *IN34     IFEQ '1'                                       103409
     C                     MOVE 'N'       MMREQ   1                       103409
     C                     END                                            103409
     C                     END                                            103409
     C*                                                                   103409
     C*                                                                   103409
     C*** Only output an DV action if it is needed.                       103409
     C*** (No DV for zero position and position record generated with     103409
     C***  trade input today but deleted).                                103409
     C*                                                                   103409
     C           MMREQ     IFEQ 'Y'                                       103409
     C*                                                                   103409
     C           ACLD      IFEQ 'Y'                                       E29207
     C                     ADD  1         LATD                            E29207
     C                     END                                            E29207
     C*
     C***IF*VALUE*DATE*LT*LATEST*POSN*DATE*******                         E22957
     C** IF VALUE DATE LT LATEST POSN CHANGE DATE                         E22957
     C********** PVDT      IFGT LPSD                                      E22957
     C           PVDT      IFGT LPCD                                      E22957
     C           PVDT      ANDGELATD                                      E29207
     C*
     C                     MOVE '1'       *IN30
     C                     ELSE
     C                     MOVE '0'       *IN30
     C                     END
     C                     EXSR W03
     C*
     C                     END
     C*
     C                     END
     C                     END                                            103409
     C*
     C**  UPDATE RECORD IND TO '*'
     C*
     C                     MOVE '*'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVE 'U'       CHTP
     C                     UPDATPRICEDF
     C                     ADD  1         UPRI    50
      *                                                                   188670
     C           CAC005    IFEQ 'Y'                                       188670
     C           KEY1      CHAINSEPRICD0             40                   188670
     C                     MOVE RUND      LCD                             188670
     C                     MOVE 'U'       CHTP                            188670
     C                     MOVE '*'       RECI                            188670
     C                     UPDATSEPRICD0                                  188670
     C                     ENDIF                                          188670
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              E15965
      *****************************************************************   E15965
      *                                                               *   E15965
      *  P04    - Subroutine to Identify the Positions affected by a  *   E15965
      *           Mark to Market Revaluation.                         *   E15965
      *                                                               *   E15965
      *****************************************************************   E15965
      *                                                                   E15965
     C           P04       BEGSR                           ***  P04   *** E15965
      *                                                                   E15965
     C                     MOVEL*BLANK    PBHSC                           E15965
     C                     MOVE 'N'       GENMM                           103409
     C*                                                                   E15965
     C**  PROCESS ALL BOOK POSITION HEADERS                               E15965
     C**  OR ONLY BOOK POSITION HEADERS REQUESTED FOR REVALUATION         E15965
     C**  DEPENDING ON WHETHER MARK TO MARKET REVALUATION IS DUE          E15965
     C*                                                                   E15965
     C           CAC005    IFEQ 'Y'                                       CAC005
      *                                                                   CAC005
     C           MMREVL    IFEQ 'Y'                                       CAC005
     C                     READ SEBKPHJ1                 80               CAC005
     C                     ELSE                                           CAC005
     C           BPHJ1K    SETLLSEBKPHJ1                                  CAC005
     C           BPHJ1K    READESEBKPHJ1                 80               CAC005
     C                     END                                            CAC005
      *                                                                   CAC005
     C                     ELSE                                           CAC005
      *                                                                   CAC005
     C           MMREVL    IFEQ 'Y'                                       E15965
     C                     READ BKPHJ1                   80               E15965
     C                     ELSE                                           E15965
     C           BPHJ1K    SETLLBKPHJ1                                    E15965
     C           BPHJ1K    READEBKPHJ1                   80               E15965
     C                     END                                            E15965
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
     C*                                                                   E15965
     C           *IN80     DOWEQ'0'                                       E15965
     C*                                                                   103409
     C                     MOVE BHSC      WBHSC                           103409
     C                     MOVE BHBA      WBHBA                           103409
     C                     MOVE BHBK      WBHBK                           103409
     C                     MOVE BHMK      WBHMK                           103409
     C                     MOVE BHTV      WBHTV                           103409
     C*                                                                   103409
     C*** Check position hold is zero, if it is then need to check        103409
     C*** if there are any trade action for today.                        103409
     C*                                                                   103409
     C           BPKEY     CHAINBKPOS                34                   103409
     C           *IN34     IFEQ '1'                                       103409
     C                     MOVE '1'       *INU7                           103409
     C                     MOVE '1'       *INU8                           103409
     C           *LOCK     IN   LDA                                       103409
     C                     MOVE 'BKPOS'   DBFILE           ***************103409
     C                     MOVELBHSC      DBKEY            * DB ERROR 43 *103409
     C                     Z-ADD43        DBASE            ***************103409
     C                     OUT  LDA                                       103409
     C                     EXSR *PSSR                                     103409
     C                     GOTO EAUDIT                                    103409
     C                     END                                            103409
     C                     MOVE 'Y'       MMREQ                           103409
     C           NPSN      IFEQ 0                                         103409
     C           TRDK2     CHAINBPACTTRD             34                   103409
     C           *IN34     IFEQ '1'                                       103409
     C                     MOVE 'N'       MMREQ   1                       103409
     C                     END                                            103409
     C                     END                                            103409
     C*                                                                   103409
     C*** Only output an MM action if it is needed.                       103409
     C*** (No MM for zero position and position record generated with     103409
     C***  trade input today but deleted).                                103409
     C*                                                                   103409
     C           MMREQ     IFEQ 'Y'                                       103409
     C*                                                                   E15965
     C**ON*CHANGE*OF*SECURITY*ACCESS*SECURITY*DETAILS*(FOR*PRCOUP*&*MKPR) E20085
      ***  On change of Security, obtain the Security details (for        E20085
      ***  SR/ZLCD and MKPR).                                             E20085
     C*                                                                   E15965
     C           BHSC      IFNE PBHSC                                     E15965
     C           BHSC      CHAINSECTY                50                   E15965
     C           *IN50     IFEQ '1'                                       E15965
     C                     MOVE '1'       *INU7                           E15965
     C                     MOVE '1'       *INU8                           E15965
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SECTY'   DBFILE           ***************E15965
     C                     MOVELBHSC      DBKEY            * DB ERROR 06 *E15965
     C                     Z-ADD6         DBASE            ***************E15965
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EAUDIT                                    E15965
     C                     END                                            E15965
     C                     MOVELBHSC      PBHSC  10                       E15965
     C                     MOVELSITP      INVT                            E15965
     C*                                                                   091803
     C** IF MARKET PRICE EQUALS TO ZERO CHAIN TO PRICED FILE IF A         091803
     C** PRICE EXISTS.                                                    091803
     C*                                                                   091803
     C                     SETOF                     22                   091803
     C*                                                                   091803
     C           MKPR      IFEQ 0                                         091803
     C*                                                                   091803
     C                     MOVE BHSC      PSSN                            091803
     C                     MOVE 'V '      PPRT                            091803
     C                     Z-ADDECD       PVDT                            091803
     C*                                                                   091803
     C           PKEY      SETGTPRICED                                    091803
     C                     READPPRICED                   21               091803
     C*                                                                   091803
     C           *IN21     IFEQ *OFF                                      091803
     C           PSSN      ANDEQBHSC                                      091803
     C           PPRT      ANDEQ'V '                                      091803
     C           PPRC      ANDEQ0                                         091803
     C                     SETON                         22               091803
     C                     END                                            091803
     C*                                                                   091803
     C                     END                                            091803
     C                     END                                            E15965
     C*                                                                   E15965
     C* OUTPUT TO BPACBD OR BPACCD DEPENDING ON MARK TO MARKET DATE       E15965
     C*                                                                   E15965
     C***********MRVLDT    IFGT LPSD                               E15965 E22957
     C           ACLD      IFEQ 'Y'                                       E29207
     C                     ADD  1         LATD                            E29207
     C                     END                                            E29207
     C           MRVLDT    IFGT LPCD                               E15965 E22957
     C           MRVLDT    ANDGELATD                                      E29207
     C                     MOVE '1'       *IN30                           E15965
     C                     ELSE                                           E15965
     C                     MOVE '0'       *IN30                           E15965
     C                     END                                            E15965
     C*                                                                   E15965
     C* DETERMINE COUPON DATE PRIOR TO REVALUATION                        E15965
     C*                                                                   E15965
     C                     MOVELBHSC      SECUR                           E15965
     C***********          Z-ADDMRVLDT    EVNTDT                   E15549 E20085
     C***********          EXSR PRCOUP                             E15549 E20085
     C           MRVLDT    SUB  1         ZECD                            E20085
     C                     EXSR ZLCD                                      E20085
     C                     Z-ADDZZLCD     LCCP                            E20085
     C*                                                                   091803
     C           MKPR      IFNE 0                                         091803
     C           MKPR      OREQ 0                                         091803
     C           *IN22     ANDEQ*ON                                       091803
     C                     EXSR W04                                       E15965
     C*                                                                   103409
     C                     END                                            103409
     C*                                                                   103409
     C                     END                                            091803
     C*                                                                   091803
     C           CAC005    IFEQ 'Y'                                       CAC005
      *                                                                   CAC005
     C           MMREVL    IFEQ 'Y'                                       CAC005
     C                     READ SEBKPHJ1                 80               CAC005
     C                     ELSE                                           CAC005
     C           BPHJ1K    READESEBKPHJ1                 80               CAC005
     C                     END                                            CAC005
      *                                                                   CAC005
     C                     ELSE                                           CAC005
      *                                                                   CAC005
     C           MMREVL    IFEQ 'Y'                                       E15965
     C                     READ BKPHJ1                   80               E15965
     C                     ELSE                                           E15965
     C           BPHJ1K    READEBKPHJ1                   80               E15965
     C                     END                                            E15965
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
     C*                                                                   103409
     C*** Check today Trade Action to see if Mark-to-Market is required   103409
     C*** when there is no value date record found.                       103409
     C*                                                                   103409
     C           BHSC      IFNE WBHSC                                     103409
     C           BHBA      ORNE WBHBA                                     103409
     C           BHBK      ORNE WBHBK                                     103409
     C           BHMK      ORNE WBHMK                                     103409
     C           *IN80     OREQ '1'                                       103409
     C           WBHTV     IFNE 'V'                                       103409
     C                     MOVE 'V'       WBHTV                           103409
     C           TRDKY     CHAINBPACTTRD             34                   103409
     C           *IN34     IFEQ '0'                                       103409
     C                     MOVE 'Y'       GENMM   1                       103409
     C                     MOVE '1'       *IN30                           103409
     C                     EXSR W04                                       103409
     C                     MOVE 'N'       GENMM                           103409
     C                     END                                            103409
     C                     END                                            103409
     C                     END                                            103409
     C*                                                                   E15965
     C                     END                                            E15965
     C*                                                                   E15965
     C                     ENDSR                                          E15965
      *                                                                   E15965
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2110CCP6                                           S01408
     C*                                                                   S01408
      *****************************************************************   E15549
      /EJECT
     C************************************************************ E15549 E20085
      ***  THIS SUBROUTINE REPLACED BY SR/ZLCD                     E15549 E20085
     C***********                                                  E15549 E20085
     C**SUBROUTINE*TO*DETERMINE*COUPON*DATE*PRIOR*TO*ACTION********E15549 E20085
     C***********                                                  E15549 E20085
     C*************************************************************E15549 E20085
     C***********                                                  E15549 E20085
     C***********PRCOUP    BEGSR                           ** PRCOUP 5549 E20085
     C***********                                                  E15549 E20085
     C**IF*LAST*COUPON*DATE*=*0*,*OR*EVENT*DATE*<*FIRST*COUPON*DATE 15549 E20085
     C***USE*INITIAL*DATE******************************************E15549 E20085
     C***********                                                  E15549 E20085
     C***********LCPN      IFEQ *ZERO                              E15549 E20085
     C***********EVNTDT    ORLT FCPN                               E15549 E20085
     C***********          Z-ADDITLD      LCCP                     E15549 E20085
     C***********          GOTO EPRCOP                             E15549 E20085
     C***********          END                                     E15549 E20085
     C***********                                                  E15549 E20085
     C**IF*LAST*COUPON*DATE*<*EVENT*DATE************************** E15549 E20085
     C***USE*LAST*COUPON*DATE************************************* E15549 E20085
     C***********                                                  E15549 E20085
     C***********LCPN      IFLT EVNTDT                             E15549 E20085
     C***********          Z-ADDLCPN      LCCP                     E15549 E20085
     C***********          GOTO EPRCOP                             E15549 E20085
     C***********          END                                     E15549 E20085
     C***********                                                  E15549 E20085
     C**GET*FIRST*COUPON*DATE*PRIOR*TO*THIS*EVENT*DATE************ E15549 E20085
     C***********                                                  E15549 E20085
     C***********          MOVEL'CP'      COUPTP  2                E15549 E20085
     C***********KSECEO    CHAINSECEO                50            E15549 E20085
     C***********          READPSECEO                    50        E15549 E20085
     C***********                                                  E15549 E20085
     C************IN50     DOWNE'1'                                E15549 E20085
     C***********SDSN      ANDEQSECUR                              E15549 E20085
     C***********SDET      ANDEQCOUPTP                             E15549 E20085
     C***********                                                  E15549 E20085
     C***********SDED      IFLT EVNTDT                             E15549 E20085
     C***********          Z-ADDSDED      LCCP                     E15549 E20085
     C***********          GOTO EPRCOP                             E15549 E20085
     C***********          ELSE                                    E15549 E20085
     C***********          READPSECEO                    50        E15549 E20085
     C***********          END                                     E15549 E20085
     C***********          END                                     E15549 E20085
     C***********                                                  E15549 E20085
     C***ELSE*USE*'PREVIOUS*COUPON*DATE'*AT*LAST*COUPON*DATE****** E15549 E20085
     C***********                                                  E15549 E20085
     C***********          Z-ADDLCPN      EVNTDT                   E15549 E20085
     C***********KSECEO    CHAINSECEO                50            E15549 E20085
     C***50******          Z-ADD*ZERO     LCCP                     E15549 E20085
     C***********                                                  E15549 E20085
     C***********EPRCOP    ENDSR                                   E15549 E20085
      ***********                                                  E15549 E20085
      ************************************************************ E15549 E20085
      /EJECT
      *****************************************************************
      *                                                               *
      *  W01    - Subroutine to Write Book Position Records - Security*
      *                                                               *
      *****************************************************************
      *
     C           W01       BEGSR                           ***  W01   ***
     C*
     C***IF**IN30*ON,*WRITE*RECORD*TO*BPACBD***************************   E15549
     C************IN30     IFEQ '1'                                       E15549
     C*
     C*  IF *IN30 OFF, WRITE RECORD TO BPACBD                             E15549
     C           GENMM     IFEQ 'Y'                                       103409
     C                     MOVELWBHSC     BBSS                            103409
     C                     MOVE WBHBA     BBBA                            103409
     C                     MOVE WBHMK     BBMK                            103409
     C                     MOVE WBHBK     BBBK                            103409
     C                     MOVELWBHTV     BBTV                            103409
     C                     ELSE                                           103409
     C                     MOVELBHSC      BBSS                            103409
     C                     MOVE BHBA      BBBA                            103409
     C                     MOVE BHMK      BBMK                            103409
     C                     MOVE BHBK      BBBK                            103409
     C                     MOVELBHTV      BBTV                            103409
     C                     END                                            103409
     C*                                                                   103409
     C*
     C           *IN30     IFEQ '0'                                       E15549
     C                     MOVE 'D'       RECI
     C***********          MOVELBHSC      BBSS                            103409
     C***********          MOVE BHBR      BBBR                            S01117
     C***********          MOVE BHBA      BBBA                     S01117 103409
     C***********          MOVE BHMK      BBMK                            103409
     C***********          MOVE BHBK      BBBK                            103409
     C                     Z-ADDSAED      BBAD
     C                     MOVELSAAS      BBAS
     C                     MOVELSAAT      BBTP
     C                     MOVELINVT      BBIT
     C*********************Z-ADDSDAU      BBAU                            E16772
     C                     Z-ADDSDUN      BBUN                            E16772
     C                     MOVELSDCA      BBCA
     C                     Z-ADDSTCA      BBTA
     C                     Z-ADDSACF      BBCF
     C                     Z-ADDPCFA      BBPC
     C                     Z-ADDSDCR      BBNC
     C                     MOVELSDNR      BBNR
     C                     Z-ADDSAOD      BBOD
     C*********************MOVELBHTV      BBTV                            103409
     C*********************MOVE *BLANKS   BBTR                            E29231
     C                     MOVE '000000'  BBTR                            E29231
     C                     MOVE *BLANKS   BBTS
     C                     MOVE *BLANKS   BBPS
     C                     Z-ADD0         BBNM
     C                     Z-ADD0         BBCN
     C                     Z-ADD0         BBRA
     C                     Z-ADD0         BBCC
     C                     Z-ADD0         BBCT
     C                     Z-ADD0         BBPT
     C           RECIS     IFEQ 'R'
     C                     MOVE 'Y'       BBRI
     C                     ELSE
     C                     MOVE ' '       BBRI
     C                     END
     C                     Z-ADD0         INAJ
     C                     Z-ADD0         PCHI
     C/COPY WNCPYSRC,SE2110C003
     C                     MOVE *BLANKS   RMIP
     C                     Z-ADD0         CNTP
     C                     MOVE *BLANKS   ACRI
     C                     MOVE *BLANKS   TRCP
     C**********           Z-ADD0         BBTO
     C                     Z-ADD0         BBPR
     C*                                                                   CSE007
     C                     MOVE *BLANKS   BBCOAF                          CSE007
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD0         BBPN                                                CAS006
     C                     Z-ADD0         INAN                                                CAS006
     C                     Z-ADD0         PCHN                                                CAS006
     C                     Z-ADD0         CNTN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*
     C* WRITE RECORD TO BPACBD
     C*
     C                     WRITEBPACBDF
     C*
     C** COUNT RECORD
     C*
     C                     ADD  1         OACB    50
     C*
     C* ELSE WRITE OUT TO BPACCD
     C*
     C                     ELSE
     C                     MOVE 'D'       RECI
     C***********          MOVELBHSC      BCSS                            103409
     C***********          MOVE BHBR      BCBR                            S01117
     C***********          MOVE BHBA      BCBA                     S01117 103409
     C***********          MOVE BHMK      BCMK                            103409
     C***********          MOVE BHBK      BCBO                            103409
     C                     MOVELBBSS      BCSS                            103409
     C                     MOVE BBBA      BCBA                            103409
     C                     MOVE BBMK      BCMK                            103409
     C                     MOVE BBBK      BCBO                            103409
     C                     MOVELBBTV      BCTV                            103409
     C                     Z-ADDSAED      BCAD
     C                     MOVELSAAS      BCAS
     C                     MOVELSAAT      BCTP
     C                     MOVELINVT      BCIT
     C*********************Z-ADDSDAU      BCAU                            E16772
     C                     Z-ADDSDUN      BCUN                            E16772
     C                     MOVELSDCA      BCCP
     C                     Z-ADDSTCA      BCTA
     C                     Z-ADDSACF      BCCF
     C                     Z-ADDPCFA      BCPC
     C                     Z-ADDSDCR      BCNC
     C                     MOVELSDNR      BCNR
     C                     Z-ADDSAOD      BCOT
     C************         MOVELBHTV      BCTV                            103409
     C                     MOVE '000000'  BCTR
     C                     MOVE '0'       BCTS
     C                     MOVE *BLANKS   BCPS
     C                     Z-ADD0         BCNL
     C                     Z-ADD0         BCCN
     C                     Z-ADD0         BCRA
     C                     Z-ADD0         BCCC
     C                     Z-ADD0         BCCT
     C                     Z-ADD0         BCTD
     C           RECIS     IFEQ 'R'
     C                     MOVE 'Y'       BCRV
     C                     ELSE
     C                     MOVE ' '       BCRV
     C                     END
     C                     Z-ADD0         INAJ
     C                     Z-ADD0         PCHI
     C/COPY WNCPYSRC,SE2110C004
     C                     MOVE *BLANKS   RMIP
     C                     Z-ADD0         CNTP
     C                     MOVE *BLANKS   ACRI
     C                     MOVE *BLANKS   TRCP
     C                     Z-ADD0         BCPR
     C*                                                                   CSE007
     C                     MOVE *BLANKS   BCCOAF                          CSE007
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD0         BCPN                                                CAS006
     C                     Z-ADD0         INAN                                                CAS006
     C                     Z-ADD0         PCHN                                                CAS006
     C                     Z-ADD0         CNTN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*
     C* WRITE RECORD TO BPACCD
     C*
     C                     WRITEBPACCDF
     C*
     C** COUNT RECORD
     C*
     C                     ADD  1         OACC    50
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  W02    - Subroutine to Write Book Position Records - Trades  *
      *                                                               *
      *****************************************************************
      *
     C           W02       BEGSR                           ***  W02   ***
     C*
     C** IF *IN30 OFF, WRITE RECORD TO BPACBD
     C*
     C           *IN30     IFEQ '0'
     C                     MOVE 'D'       RECI
     C                     MOVELBHSC      BBSS
     C***********          MOVE BHBR      BBBR                            S01117
     C                     MOVE BHBA      BBBA                            S01117
     C                     MOVE BHMK      BBMK
     C                     MOVE BHBK      BBBK
     C                     Z-ADDEVTD      BBAD
     C***********          MOVEL'10'      BBAS                            E18652
     C                     MOVEL'40'      BBAS                            E18652
     C                     MOVE TDTS      BBTP
     C                     MOVELINVT      BBIT
     C***********          Z-ADD0         BBAU                            E16772
     C                     Z-ADD0         BBUN                            E16772
     C***********          MOVEL0         BBCA                            E15549
     C                     Z-ADD0         BBCA                            E15549
     C                     Z-ADD0         BBTA
     C                     MOVE STCA      BBTA
     C                     Z-ADDSDCP      BBCF
     C                     Z-ADD0         BBPC
     C                     Z-ADDCPNR      BBNC
     C                     MOVE *BLANKS   BBNR
     C                     Z-ADDOTRD      BBOD
     C                     MOVELBHTV      BBTV
     C                     MOVE TDRF      BBTR
     C*                                                                   E22957
     C***  Remove redundant code as BBTS is set by SE2250                 E22957
     C*
     C**IF*SUMMARISE*DAILY*TRADES*=*'Y'*************************          E22957
     C**AND*PURCH/SALE*=*'P'*MOVE*1*TO*ACTION*SEQ*ELSE*BLANK****          E22957
     C***********                                                         E22957
     C***********SMDT      IFEQ 'Y'                                       E22957
     C***********PRSL      IFEQ 'P'                                       E22957
     C***********          MOVE '1'       BBTS                            E22957
     C***********          ELSE                                           E22957
     C***********          MOVE '2'       BBTS                            E22957
     C***********          END                                            E22957
     C***********          ELSE                                           E22957
     C                     MOVE *BLANKS   BBTS
     C***********          END                                            E22957
     C*
     C                     MOVE PRSL      BBPS
     C                     Z-ADDNOML      BBNM
     C                     Z-ADDCNSD      BBCN
     C                     Z-ADDRALL      BBRA
     C                     Z-ADDCCTL      BBCC
     C                     Z-ADDCCCT      BBCT
     C                     Z-ADDTRPR      BBPT
     C                     MOVE RVLI      BBRI
     C                     Z-ADDINAJ      INAJ
     C                     Z-ADDPCHI      PCHI
     C/COPY WNCPYSRC,SE2110C005
     C                     MOVE RMIP      RMIP
     C                     Z-ADDCNTP      CNTP
     C                     MOVE ACRI      ACRI
     C                     MOVE TRCP      TRCP
     C**********           Z-ADDOTRD      BBTO
     C                     Z-ADD0         BBPR
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C*                                                                   CPM004
     C** IF BANK PORTFOLIOS INSTALLED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C*                                                                   CPM004
     C** CALCULATE BOOK COST IN PORTFOLIO CURRENCY                        CPM004
     C*                                                                   CPM004
     C                     EXSR CALBKC                                    CPM004
     C**                                                                  S01486
     C                     ELSE                                           CPM004
     C*                                                                   S01486
     C* CALCULATE BOOK COST IN BASE CCY                                   S01486
     C           SETCY     IFNE BCCY                                      S01486
     C           HSEXKY    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 99               S01486
     C           *IN99     IFEQ '1'                                       S01486
     C           Q8CCY     ORNE SETCY                                     S01486
     C           HSEXKY    SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 99               S01486
     C           *IN99     IFEQ '1'                                       S01486
     C           Q8CCY     ORNE SETCY                                     S01486
     C                     MOVE '1'       *INU7                           S01486
     C                     MOVE '1'       *INU8                           S01486
     C                     Z-ADD22        DBASE             ************  S01486
     C                     MOVEL'HSEXPD'  DBFILE            * DATABASE *  S01486
     C                     MOVELSETCY     DBKEY             * ERROR 22 *  S01486
     C                     MOVE EVTD      DBKEY             ************  S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C           *IN99     IFEQ '0'                                       S01486
     C                     Z-ADDSETAM     ZAMTF                           S01486
     C                     Z-ADDQ8SPOT    ZCRSRT                          S01486
     C                     MOVE Q8MDV1    ZCRSMD                          S01486
     C                     Z-ADDQ8CDP     ZCDPF                           S01486
     C                     Z-ADDBCDP      ZCDPT                           S01486
     C                     EXSR ZCCYXR                                    S01486
     C                     Z-ADDZAMTT     CFAP                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C                     Z-ADDSETAM     CFAP                            S01486
     C                     END                                            S01486
     C                     END                                            CPM004
     C                     END                                            S01486
     C*                                                                   CSE007
     C                     MOVE COAF      BBCOAF                          CSE007
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD0         BBPN                                                CAS006
     C                     Z-ADDTINAN     INAN                                                CAS006
     C                     Z-ADDTPCHN     PCHN                                                CAS006
     C                     Z-ADDTCNTN     CNTN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*
     C* WRITE RECORD TO BPACBD
     C*
     C                     WRITEBPACBDF
     C*
     C** COUNT RECORD
     C*
     C                     ADD  1         OACB    50
     C*
     C* ELSE WRITE OUT TO BPACCD
     C*
     C                     ELSE
     C                     MOVE 'D'       RECI
     C                     MOVELBHSC      BCSS
     C***********          MOVE BHBR      BCBR                            S01117
     C                     MOVE BHBA      BCBA                            S01117
     C                     MOVE BHMK      BCMK
     C                     MOVE BHBK      BCBO
     C                     Z-ADDEVTD      BCAD
     C***********          MOVEL'10'      BCAS                            E18652
     C                     MOVEL'40'      BCAS                            E18652
     C                     MOVE TDTS      BCTP
     C                     MOVELINVT      BCIT
     C***********          Z-ADD0         BCAU                            E16772
     C                     Z-ADD0         BCUN                            E16772
     C***********          MOVEL0         BCCP                            E15549
     C                     Z-ADD0         BCCP                            E15549
     C                     Z-ADD0         BCTA
     C                     MOVE STCA      BCTA
     C                     Z-ADDSDCP      BCCF
     C                     Z-ADD0         BCPC
     C                     Z-ADDCPNR      BCNC
     C                     MOVE *BLANKS   BCNR
     C                     Z-ADDOTRD      BCOT
     C                     MOVELBHTV      BCTV
     C                     MOVELTDRF      BCTR
     C*                                                                   E22957
     C***  Remove redundant code as BCTS is set by SE2250                 E22957
     C*
     C**IF*SUMMARISE*DAILY*TRADES*=*'Y'*************************          E22957
     C**AND*PURCH/SALE*=*'P'*MOVE*1*TO*ACTION*SEQ*ELSE*BLANK****          E22957
     C*                                                                   E22957
     C***********SMDT      IFEQ 'Y'                                       E22957
     C***********PRSL      ANDEQ'P'                                       E22957
     C***********          MOVE '1'       BCTS                            E22957
     C***********          ELSE                                           E22957
     C                     MOVE *BLANKS   BCTS
     C***********          END                                            E22957
     C                     MOVE PRSL      BCPS
     C                     Z-ADDNOML      BCNL
     C                     Z-ADDCNSD      BCCN
     C                     Z-ADDRALL      BCRA
     C                     Z-ADDCCTL      BCCC
     C                     Z-ADDCCCT      BCCT
     C                     Z-ADDTRPR      BCTD
     C                     MOVE RVLI      BCRV
     C                     Z-ADDINAJ      INAJ
     C                     Z-ADDPCHI      PCHI
     C/COPY WNCPYSRC,SE2110C006
     C                     MOVE RMIP      RMIP
     C                     Z-ADDCNTP      CNTP
     C                     MOVE ACRI      ACRI
     C                     MOVE TRCP      TRCP
     C                     Z-ADD0         BCPR
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C*                                                                   CPM004
     C** IF BANK PORTFOLIOS INSTALLED                                     CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C*                                                                   CPM004
     C** CALCULATE BOOK COST IN PORTFOLIO CURRENCY                        CPM004
     C*                                                                   CPM004
     C                     EXSR CALBKC                                    CPM004
     C**                                                                  S01486
     C                     ELSE                                           CPM004
     C*                                                                   S01486
     C* CALCULATE BOOK COST IN BASE CCY                                   S01486
     C           SETCY     IFNE BCCY                                      S01486
     C           HSEXKY    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 99               S01486
     C           *IN99     IFEQ '1'                                       S01486
     C           Q8CCY     ORNE SETCY                                     S01486
     C           HSEXKY    SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 99               S01486
     C           *IN99     IFEQ '1'                                       S01486
     C           Q8CCY     ORNE SETCY                                     S01486
     C                     MOVE '1'       *INU7                           S01486
     C                     MOVE '1'       *INU8                           S01486
     C                     Z-ADD23        DBASE             ************  S01486
     C                     MOVEL'HSEXPD'  DBFILE            * DATABASE *  S01486
     C                     MOVELSETCY     DBKEY             * ERROR 23 *  S01486
     C                     MOVE EVTD      DBKEY             ************  S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C           *IN99     IFEQ '0'                                       S01486
     C                     Z-ADDSETAM     ZAMTF                           S01486
     C                     Z-ADDQ8SPOT    ZCRSRT                          S01486
     C                     MOVE Q8MDV1    ZCRSMD                          S01486
     C                     Z-ADDQ8CDP     ZCDPF                           S01486
     C                     Z-ADDBCDP      ZCDPT                           S01486
     C                     EXSR ZCCYXR                                    S01486
     C                     Z-ADDZAMTT     CFAP                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C                     Z-ADDSETAM     CFAP                            S01486
     C                     END                                            S01486
     C                     END                                            CPM004
     C                     END                                            S01486
     C*                                                                   CSE007
     C                     MOVE COAF      BCCOAF                          CSE007
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD0         BBPN                                                CAS006
     C                     Z-ADDTINAN     INAN                                                CAS006
     C                     Z-ADDTPCHN     PCHN                                                CAS006
     C                     Z-ADDTCNTN     CNTN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*
     C* WRITE RECORD TO BPACCD
     C*
     C                     WRITEBPACCDF
     C*
     C** COUNT RECORD
     C*
     C                     ADD  1         OACC    50
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  W03    - Subroutine to Write Book Position Records - Prices  *
      *                                                               *
      *****************************************************************
      *
     C           W03       BEGSR                           ***  W03   ***
     C*
     C***IF**IN30*ON,*WRITE*RECORD*TO*BPACBD******                        E15549
     C************IN30     IFEQ '1'                                       E15549
     C*
     C** IF *IN30 OFF, WRITE RECORD TO BPACBD                             E15549
     C*
     C           *IN30     IFEQ '0'                                       E15549
     C                     MOVE 'D'       RECI
     C                     MOVELBHSC      BBSS
     C***********          MOVE BHBR      BBBR                            S01117
     C                     MOVE BHBA      BBBA                            S01117
     C                     MOVE BHMK      BBMK
     C                     MOVE BHBK      BBBK
     C                     Z-ADDPVDT      BBAD
     C                     MOVEL'60'      BBAS
     C                     MOVE PPRT      BBTP
     C                     MOVELINVT      BBIT
     C***********          Z-ADD0         BBAU                            E16772
     C                     Z-ADD0         BBUN                            E16772
     C***********          MOVEL0         BBCA                            E15549
     C                     Z-ADD0         BBCA                            E15549
     C                     Z-ADD0         BBTA
     C                     Z-ADD0         BBCF
     C                     Z-ADD0         BBPC
     C                     Z-ADD0         BBNC
     C                     MOVE *BLANKS   BBNR
     C                     Z-ADD0         BBOD
     C                     MOVELBHTV      BBTV
     C                     MOVELTDRF      BBTR
     C                     MOVE '0'       BBTS
     C                     MOVE *BLANKS   BBPS
     C                     Z-ADD0         BBNM
     C                     Z-ADD0         BBCN
     C                     Z-ADD0         BBRA
     C                     Z-ADD0         BBCC
     C                     Z-ADD0         BBCT
     C                     Z-ADD0         BBPT
     C                     MOVE ' '       BBRI
     C                     Z-ADD0         INAJ
     C                     Z-ADD0         PCHI
     C/COPY WNCPYSRC,SE2110C007
     C                     MOVE *BLANKS   RMIP
     C                     Z-ADD0         CNTP
     C                     MOVE *BLANKS   ACRI
     C                     MOVE *BLANKS   TRCP
     C**********           Z-ADD0         BBTO
     C                     Z-ADDPPRC      BBPR
     C*                                                                   CSE007
     C                     MOVE *BLANKS   BBCOAF                          CSE007
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           PRCRSK    ADD  PRLQPR    BBPN                                                CAS006
     C                     ADD  PPRC      BBPN                                                CAS006
     C                     Z-ADD0         INAN                                                CAS006
     C                     Z-ADD0         PCHN                                                CAS006
     C                     Z-ADD0         CNTN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*
     C* WRITE RECORD TO BPACBD
     C*
     C                     WRITEBPACBDF
     C*
     C** COUNT RECORD
     C*
     C                     ADD  1         OACB    50
     C*
     C* ELSE WRITE OUT TO BPACCD
     C*
     C                     ELSE
     C                     MOVE 'D'       RECI
     C                     MOVELBHSC      BCSS
     C***********          MOVE BHBR      BCBR                            S01117
     C                     MOVE BHBA      BCBA                            S01117
     C                     MOVE BHMK      BCMK
     C                     MOVE BHBK      BCBO
     C                     Z-ADDPVDT      BCAD
     C                     MOVEL'60'      BCAS
     C                     MOVE PPRT      BCTP
     C                     MOVELINVT      BCIT
     C***********          Z-ADD0         BCAU                            E16772
     C                     Z-ADD0         BCUN                            E16772
     C***********          MOVEL0         BCCP                            E15549
     C                     Z-ADD0         BCCP                            E15549
     C                     Z-ADD0         BCTA
     C                     Z-ADD0         BCCF
     C                     Z-ADD0         BCPC
     C                     Z-ADD0         BCNC
     C                     MOVE *BLANKS   BCNR
     C                     Z-ADD0         BCOT
     C                     MOVELBHTV      BCTV
     C                     MOVE *BLANKS   BCTR
     C                     MOVE '0'       BCTS
     C                     MOVE *BLANKS   BCPS
     C                     Z-ADD0         BCNL
     C                     Z-ADD0         BCCN
     C                     Z-ADD0         BCRA
     C                     Z-ADD0         BCCC
     C                     Z-ADD0         BCCT
     C                     Z-ADD0         BCTD
     C                     MOVE ' '       BCRV
     C                     Z-ADD0         INAJ
     C                     Z-ADD0         PCHI
     C/COPY WNCPYSRC,SE2110C008
     C                     MOVE *BLANKS   RMIP
     C                     Z-ADD0         CNTP
     C                     MOVE *BLANKS   ACRI
     C                     MOVE *BLANKS   TRCP
     C                     Z-ADDPPRC      BCPR
     C*                                                                   CSE007
     C                     MOVE *BLANKS   BCCOAF                          CSE007
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD0         BCPN                                                CAS006
     C                     Z-ADDTINAN     INAN                                                CAS006
     C                     Z-ADDTPCHN     PCHN                                                CAS006
     C                     Z-ADDTCNTN     CNTN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*
     C* WRITE RECORD TO BPACCD
     C*
     C                     WRITEBPACCDF
     C*
     C** COUNT RECORD
     C*
     C                     ADD  1         OACC    50
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              E15965
      *****************************************************************   E15965
      *                                                               *   E15965
      *  W03    - Subroutine to Write Book Position Records -         *   E15965
      *           Revaluation.                                        *   E15965
      *                                                               *   E15965
      *****************************************************************   E15965
      *                                                                   E15965
     C           W04       BEGSR                           ***  W04   *** E15965
     C*                                                                   E15965
     C*  IF NO PRICE PRESENT THEN FINISH                                  E15965
     C*                                                                   E15965
     C***********MKPR      CABEQ*ZERO     EW04                     E15965 091803
     C*                                                                   103409
     C           GENMM     IFEQ 'Y'                                       103409
     C                     MOVELWBHSC     BBSS                            103409
     C                     MOVE WBHBA     BBBA                            103409
     C                     MOVE WBHMK     BBMK                            103409
     C                     MOVE WBHBK     BBBK                            103409
     C                     MOVELWBHTV     BBTV                            103409
     C                     ELSE                                           103409
     C                     MOVELBHSC      BBSS                            103409
     C                     MOVE BHBA      BBBA                            103409
     C                     MOVE BHMK      BBMK                            103409
     C                     MOVE BHBK      BBBK                            103409
     C                     MOVELBHTV      BBTV                            103409
     C                     END                                            103409
     C*                                                                   E15965
     C*  IF *IN30 OFF, WRITE RECORD TO BPACBD                             E15965
     C*                                                                   E15965
     C           *IN30     IFEQ '0'                                       E15965
     C                     MOVE 'D'       RECI                            E15965
     C***********          MOVELBHSC      BBSS                     E15965 103409
     C***********          MOVE BHBR      BBBR                     E15965 S01117
     C***********          MOVE BHBA      BBBA                     E15965 103409
     C***********          MOVE BHMK      BBMK                     E15965 103409
     C***********          MOVE BHBK      BBBK                     E15965 103409
     C                     Z-ADDMRVLDT    BBAD                            E15965
     C                     MOVEL'60'      BBAS                            E15965
     C                     MOVEL'MM'      BBTP                            E15965
     C                     MOVELINVT      BBIT                            E15965
     C***********          Z-ADD0         BBAU                      E15965E16772
     C                     Z-ADD0         BBUN                            E16772
     C                     Z-ADD0         BBCA                            E15965
     C                     Z-ADD0         BBTA                            E15965
     C                     Z-ADD0         BBCF                            E15965
     C                     Z-ADD0         BBPC                            E15965
     C                     Z-ADD0         BBNC                            E15965
     C                     MOVEL*BLANK    BBNR                            E15965
     C                     Z-ADD0         BBOD                            E15965
     C***********          MOVELBHTV      BBTV                     E15965 103409
     C                     MOVE *BLANK    BBTR                            E15965
     C                     MOVE *BLANK    BBTS                            E15965
     C                     MOVE *BLANK    BBPS                            E15965
     C                     Z-ADD0         BBNM                            E15965
     C                     Z-ADD0         BBCN                            E15965
     C                     Z-ADD0         BBRA                            E15965
     C                     Z-ADD0         BBCC                            E15965
     C                     Z-ADD0         BBCT                            E15965
     C                     Z-ADD0         BBPT                            E15965
     C                     MOVE *BLANK    BBRI                            E15965
     C                     Z-ADD0         INAJ                            E15965
     C                     Z-ADD0         PCHI                            E15965
     C/COPY WNCPYSRC,SE2110C009
     C                     MOVE *BLANK    RMIP                            E15965
     C                     Z-ADD*ZERO     CNTP                            E15965
     C                     MOVE *BLANK    ACRI                            E15965
     C**********           Z-ADD0         TRCP                                         E15965 CSD027
     C                     MOVE *BLANKS   TRCP                                                CSD027
     C                     Z-ADDMKPR      BBPR                            E15965
     C*                                                                   CSE007
     C                     MOVE *BLANKS   BBCOAF                          CSE007
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD0         BCPN                                                CAS006
     C                     Z-ADDTINAN     INAN                                                CAS006
     C                     Z-ADDTPCHN     PCHN                                                CAS006
     C                     Z-ADDTCNTN     CNTN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*                                                                   E15965
     C* WRITE RECORD TO BPACBD                                            E15965
     C*                                                                   E15965
     C                     WRITEBPACBDF                                   E15965
     C*                                                                   E15965
     C** COUNT RECORD                                                     E15965
     C*                                                                   E15965
     C                     ADD  1         OACB    50                      E15965
     C*                                                                   E15965
     C* ELSE WRITE OUT TO BPACCD                                          E15965
     C*                                                                   E15965
     C                     ELSE                                           E15965
     C                     MOVE 'D'       RECI                            E15965
     C***********          MOVELBHSC      BCSS                     E15965 103409
     C***********          MOVE BHBR      BCBR                     E15965 S01117
     C***********          MOVE BHBA      BCBA                     E15965 103409
     C***********          MOVE BHMK      BCMK                     E15965 103409
     C***********          MOVE BHBK      BCBO                     E15965 103409
     C                     MOVELBBSS      BCSS                            103409
     C                     MOVE BBBA      BCBA                            103409
     C                     MOVE BBMK      BCMK                            103409
     C                     MOVE BBBK      BCBO                            103409
     C                     MOVELBBTV      BCTV                            103409
     C                     Z-ADDMRVLDT    BCAD                            E15965
     C                     MOVEL'60'      BCAS                            E15965
     C                     MOVEL'MM'      BCTP                            E15965
     C                     MOVELINVT      BCIT                            E15965
     C***********          Z-ADD0         BCAU                      E15965E16772
     C                     Z-ADD0         BCUN                            E16672
     C                     Z-ADD0         BCCP                            E15965
     C                     Z-ADD0         BCTA                            E15965
     C                     Z-ADD0         BCCF                            E15965
     C                     Z-ADD0         BCPC                            E15965
     C                     Z-ADD0         BCNC                            E15965
     C                     MOVE *BLANK    BCNR                            E15965
     C                     Z-ADD0         BCOT                            E15965
     C***********          MOVELBHTV      BCTV                     E15965 103409
     C                     MOVE *BLANK    BCTR                            E15965
     C                     MOVE *BLANK    BCTS                            E15965
     C                     MOVE *BLANK    BCPS                            E15965
     C                     Z-ADD0         BCNL                            E15965
     C                     Z-ADD0         BCCN                            E15965
     C                     Z-ADD0         BCRA                            E15965
     C                     Z-ADD0         BCCC                            E15965
     C                     Z-ADD0         BCCT                            E15965
     C                     Z-ADD0         BCTD                            E15965
     C                     MOVE *BLANK    BCRV                            E15965
     C                     Z-ADD0         INAJ                            E15965
     C                     Z-ADD0         PCHI                            E15965
     C/COPY WNCPYSRC,SE2110C010
     C                     MOVE *BLANK    RMIP                            E15965
     C                     Z-ADD*ZERO     CNTP                            E15965
     C                     MOVE *BLANK    ACRI                            E15965
     C**********           Z-ADD0         TRCP                                         E15965 CSD027
     C                     MOVE *BLANKS   TRCP                                                CSD027
     C                     Z-ADDMKPR      BCPR                            E15965
     C*                                                                   CSE007
     C                     MOVE *BLANKS   BCCOAF                          CSE007
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           PRCRSK    ADD  PRLQPR    BBPN                                                CAS006
     C                     ADD  PPRC      BBPN                                                CAS006
     C                     Z-ADD0         INAN                                                CAS006
     C                     Z-ADD0         PCHN                                                CAS006
     C                     Z-ADD0         CNTN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*                                                                   E15965
     C* WRITE RECORD TO BPACCD                                            E15965
     C*                                                                   E15965
     C                     WRITEBPACCDF                                   E15965
     C*                                                                   E15965
     C** COUNT RECORD                                                     E15965
     C*                                                                   E15965
     C                     ADD  1         OACC    50                      E15965
     C                     END                                            E15965
     C*                                                                   E15965
     C           EW04      ENDSR                                          E15965
      *                                                                   E15965
      *****************************************************************   E15965
      /EJECT                                                              CPM004
      *****************************************************************   CPM004
      *                                                               *   CPM004
      *  CALBKC - Calculate Book Cost in Portfolio Currency           *   CPM004
      *                                                               *   CPM004
      *****************************************************************   CPM004
      *                                                                   CPM004
     C           CALBKC    BEGSR                                          CPM004
      *                                                                   CPM004
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELPSBKCD    ##BOOK                          CAC005
     C                     ELSE                                           CAC005
     C                     MOVELBHBK      ##BOOK                          CAC005
     C                     ENDIF                                          CAC005
      *
     C                     CALL 'PMZPCT'                                  CPM004
     C                     PARM BHBA      ##BRCH  3        Branch         CPM004
     C***********          PARM BHBK      ##BOOK  2        Book    CPM004 CAC005
     C                     PARM           ##BOOK  2                       CAC005
     C                     PARM SETCY     ##CCY   3        Currency       CPM004
     C                     PARM FCR997    ##R997  4        '9997' Ref     CPM004
     C                     PARM EVTD      ##IDAT  50       In Date        CPM004
     C                     PARM SETAM     ##IAMT 150       In Amount      CPM004
     C                     PARM SPXR      ##IRAT 138       In Rate        CPM004
     C                     PARM SPMD      ##IMDI  1        In M/D Ind     CPM004
     C                     PARM *ZERO     ##OAMT 150       Out Amount     CPM004
     C                     PARM *ZERO     ##ORAT 138       Out Rate       CPM004
     C                     PARM *BLANK    ##OMDI  1        Out M/D Ind    CPM004
     C                     PARM *BLANK    ##OPTR  4        Out Port.Ref.  CPM004
     C                     PARM *BLANK    ##OPTC  3        Out Port.Ccy.  CPM004
     C                     PARM *BLANK    ##RETC  6                       CPM004
      *                                                                   CPM004
      ** ERROR IN CALLED PROGRAM                                          CPM004
      *                                                                   CPM004
     C           ##RETC    IFNE *BLANKS                                   CPM004
     C                     MOVE '1'       *INU7                           CPM004
     C                     MOVE '1'       *INU8                           CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVE 'PMZPCT  'DBFILE           ***************CPM004
     C                     MOVELTDRF      DBKEY            * DB ERROR 41 *CPM004
     C                     Z-ADD41        DBASE            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     EXSR *PSSR                                     CPM004
     C                     END                                            CPM004
      *                                                                   CPM004
     C                     Z-ADD##OAMT    CFAP                            CPM004
      *                                                                   CPM004
     C                     ENDSR                                          CPM004
      *****************************************************************   CPM004
      /EJECT
      *****************************************************************
      *                                                               *
      *  CBDSR  - Subroutine for Error Handling of BPACBD.            *
      *                                                               *
      *****************************************************************
      *
     C           CBDSR     BEGSR                           *** CBDSR  ***
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BPACB'   DBFILE
     C                     MOVEL'?????'   DBKEY            ***************
     C***********          Z-ADD8         DBASE            **DB*ERROR*08**E20651
     C                     Z-ADD11        DBASE            * DB ERROR 11 *E20651
     C                     MOVE STSCBD    DBSTAT           ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  CCDSR  - Subroutine for Error Handling of BPACCD.            *
      *                                                               *
      *****************************************************************
      *
     C           CCDSR     BEGSR                           *** CCDSR  ***
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BPACC'   DBFILE
     C                     MOVEL'?????'   DBKEY            ***************
     C***********          Z-ADD8         DBASE            **DB*ERROR*08**E20651
     C                     Z-ADD12        DBASE            * DB ERROR 12 *E20651
     C                     MOVE STSCCD    DBSTAT           ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  CBASR  - Subroutine for Error Handling of BPACBA.            *
      *                                                               *
      *****************************************************************
      *
     C           CBASR     BEGSR                           *** CBASR  ***
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BPACB'   DBFILE
     C                     MOVEL'AUDIT'   DBKEY            ***************
     C***********          Z-ADD9         DBASE            **DB*ERROR*09**E20651
     C                     Z-ADD13        DBASE            * DB ERROR 13 *E20651
     C                     MOVE STSCBA    DBSTAT           ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  CCASR  - Subroutine for Error Handling of BPACCA.            *
      *                                                               *
      *****************************************************************
      *
     C           CCASR     BEGSR                           *** CCASR  ***
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BPACC'   DBFILE
     C                     MOVEL'AUDIT'   DBKEY            ***************
     C***********          Z-ADD9         DBASE            **DB*ERROR*09**E20651
     C                     Z-ADD14        DBASE            * DB ERROR 14 *E20651
     C                     MOVE STSCCA    DBSTAT           ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      *****************************************************************
      /EJECT                                                              E20085
     C/COPY ZSRSRC,ZDATE1Z2                                               E20085
      /EJECT                                                              E20085
     C/COPY ZSRSRC,ZDATE2Z4                                               E20085
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E20085
     C/COPY ZSRSRC,ZLCDZ1                                                 E20085
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT
     C/COPY ZSRSRC,ZCCYXR                                                 S01486
      /EJECT                                                              S01486
     C/COPY ZSRSRC,ZACCH                                                  182505
      /EJECT                                                              182505
     C/COPY ZSRSRC,ZFWDT                                                  182505
      ***
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                       S01486
0000001
0000010
0000100
0001000
0010000
0100000
1000000
