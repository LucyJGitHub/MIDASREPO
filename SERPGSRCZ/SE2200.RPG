     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Generate a/c keys - depot movements')         *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE2200 - GENERATE A/C KEYS - DEPOT MOVEMENTS                 *
     F*                                                               *
     F*  Function: Depot movements input via SE0070 and effective     *
     F*   (COB)    today are processed by this program.  A/c keys are *
     F*            generated, and movements on user and customer      *
     F*            depot positions, which require action later in the *
     F*            Close of Business, are identified.                 *
     F*            A/c keys are not produced for depot movements with *
     F*            processing types 2, 4, or 7.                       *
     F*            The record id and accounting indicators on         *
     F*            PF/DPTMVD are updated to prevent duplicate         *
     F*            processing.                                        *
     F*                                                               *
     F*  Called by: SEC0602E - Generate A/c Keys Depot Movements      *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. 226449             Date 24Jun15               *
      *  Prev Amend No. MD034776           Date 09Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CPK027             Date 17Apr07               *
      *                 243410             Date 14Nov06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSE093             Date 30Jan06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL031             Date 05Jul04               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 219624             Date 11Jul03               *
      *                 203725             Date 11Feb02               *
      *                 226570             Date 27Jun04               *
      *                 221801 (BUG2852)   Date 14Dec04               *
      *                 211786 (BUG2852)   Date 14Dec04               *
      *                 CGL029             Date 01Sep03               *
      *                 CGP001             Date 14Oct03               *
      *                 222727             Date 05Nov03               *
      *                 211407             Date 07Jan03               *
      *                 207543             Date 17JUL02               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 CGL020             Date 12Dec02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 207006             Date 18Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 04Oct01               *
      *                 186560             Date 15May01               *
      * Midas DBA 3.03 -----------------------------------------------*
     F*                 140272             Date 20Apr00               *
      *                 179686             Date 30May00               *
      *                 178376             Date 26Apr00               *
      *                 CSE018             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 175842             Date 02Mar00               *
      *                 175720             Date 29Feb00               *
      *                 CSE015             Date 06Dec99               *
      *                 CSE017             Date 20Oct99               *
     F*                 CSE006             Date 31AUG99               *
     F*                 CPB001             DATE 18Jun99               *
      *                 CSE012             Date 16Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
     F*                 CEU017             Date 03Mar98               *
     F*                 CSE007             Date 03Feb98               *
     F*                 102494             Date 19Feb98
     F*                 102542             Date 19Feb98
     F*                 CSE005             DATE 04FEB97               *  *
     F*                 CAC002             Date 15Sep96               *
     F*                 S01408             Date 02Sep96               *  *
     F*                 091814             Date 13Aug96               *  *
     F*                 084704             Date 01Aug96               *
     F*                 083039             Date 01Aug96               *
     F*                 059110             Date 25Jul96               *
     F*                 098249             Date 03Jul96               *
     F*                 097790             DATE 03JUL96               *
     F*                 088047             DATE 26JUN96               *
     F*                 100228             DATE 31MAY96               *
     F*                 103204             DATE 14MAY96               *
     F*                 046800             DATE 09MAY96               *
     F*                 049901             DATE 01MAY96               *
     F*                 049869             DATE 01MAY96               *
     F*                 099545             DATE 18APR96               *
     F*                 102132             DATE 18APR96               *
     F*                 100255             DATE 18APR96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 100099             DATE 16APR96               *
     F*                 S01408             DATE 12MAR96               *
     F*                 S01408             DATE 08MAR96               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 086491             DATE 15JUN95               *
     F*                 S01486             DATE 18NOV94               *
     F*                 053103             DATE 18NOV94               *
     F*                 064575             DATE 15AUG94               *
     F*                 065301             DATE 05MAY94               *
     F*                 066306             DATE 29JAN94               *
     F*                 052254             DATE 10JAN94               *
     F*                 S01446             DATE 18OCT93               *
     F*                 S01445             DATE 18OCT93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 047922             DATE 01FEB93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E32674             DATE 03DEC91               *
     F*                 E29170             DATE 06NOV91               *
     F*                 E25293             DATE 25OCT91               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 28MAY91               *
     F*                 S01269             DATE 01AUG90               *
     F*                 S01271             DATE 11JUN90               *
     F*                 E23697             DATE 05OCT90               *
     F*                 E23561             DATE 13SEP90               *
     F*                 E22963             DATE 14AUG90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21480             DATE 21MAR90               *
     F*                 E21118             DATE 13FEB90               *
     F*                 E20651             DATE 30JAN90               *
     F*                 E20601             DATE 18DEC89               *
     F*                 E20488             DATE 01DEC89               *
     F*                 E19975             DATE 23NOV89               *
     F*                 E18988             DATE 05SEP89               *
     F*                 E19032             DATE 15AUG89               *
     F*                 E18033             DATE 15AUG88               *
     F*                 E16772             DATE 19/06/89              *
     F*                 E16932             DATE 08/11/88              *
     F*                 S01176             DATE 08/11/88              *
     F*                 E15678             DATE 25/10/88              *
     F*                 E14839             DATE 06/10/88              *
     F*                 E15430             DATE 28/09/88              *
     F*                 E14961             DATE 13/09/88              *
     F*                 E14548             DATE 12/08/88              *
     F*                 E13817             DATE 20/06/88              *
     F*                 E13792             DATE 20/06/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  CPK027 - Errors in compiling MP1_3_TTTS - DPID/DPOD now 6A   *
      *  243410 - Failed component SEC0606J due to imbalance security *
      *           positions. Amended program to ensure that customer  *
      *           depot movement record trade date event is created   *
      *           only if TACI bit 2 is off. Corrected fix 211786.    *
      *         - Apply 229525 in subr/MOVFLD as preventative fix.    *
      *  CSE093 - Depot Movements Account Keys                        *
      *           Upgrade of LBV027 to Midas Plus.                    *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  219624 - IF A DEPOT MOVEMENT WAS INPUT AND DELETED THE SAME  *
      *           DAY NOTHING SHOULD BE DONE                          *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  203725 - Do not reset REPI flag generated by SEC7560. This   *
      *           component runs before. So, if reset it never goes   *
      *           to ToF through Meridian.                            *
      *  221801 - Trade date position not updated correctly for       *
      *           future valued walk-in/walk-out.                     *
      *  211786 - Records produced in file CDPMVD if value date of    *
      *           depot movement (forward)equals DNWD.                *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGP001 - Global Processing.                                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  CGL020 - Compliance Watch - Addtl A/C Postings Information   *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  207006 - Add Counterparty & Market Centre to SSI             *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
     F*  CSE031 - Coupon Fixing for Floating Rate Notes.              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  180707 - No Position Settlements generated. Recompile over   *
     F*           changes in /COPY ZNCDZ3.                            *
      *  CPK014 - Release 4 packaging.  Timestamp field needs to be   *
     F*           renamed.                                            *
      *  186560 - Do not process futures WO/WI generated by Early     *
      *           Redemption or Corporate Actions.                    *
     F*  140272 - Recompile over changed ZYLDZ2                       *
     F*  179686 - Unable to generate reversal for old depot movement  *
     F*           which may be input before CSE015 is on.             *
     F*  178376 - Wrong date being used by CSE015 and caused trade    *
     F*           date position and a/c key not being generated.      *
     F*  CSE018 - Deletion of Walk-in and Walk-out depot movement     *
     F*           after passed movement date.                         *
     F*  175842 - Reversal being done even unnecessary                *
     F*  175720 - Bit 2 of TACI not being updated correctly for some  *
     F*           security caused SEC0606J out of balance.            *
      *  CSE015 - Forward Valued Depot Movement                       *
      *  CSE017 - Cum/Ex Indicator on Depot Movements                 *
     F*  CSE006 - Repurchase Agreements (REPOs) enhancement           *
     F*  CPB001 - 'Private Banking' Module                            *
      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*  CSE007 - Corporate Actions                                   *
     F*  102494 - Problem with value date Repo position for securities*
     F*           with processing type 2, 4 and 7. TACI need to be    *
     F*           set on when they are being processed.               *
     F*  102542 - Problem with I/C fields for Repo, Bond lending and  *
     F*           Pledge deposit not able to update correctly if input*
     F*           today, value on next working date and tomorrow is   *
     F*           Holiday.                                            *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*           If Analytical Accounting is available, define the   *
     F*           profit centre for posting.                          *
     F*  S01408 - Addition of hooks SE2200CCP7                        *
     F*         - Addition of hooks SE2200CCP6                        *
     F*  091814 - Forward dated depot transfer being doubled during   *  *
     F*           holiday processing.                                 *  *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  097790 - Correct amounts shown in enquiries on value date.   *
     F*  098249 - Depot Movement Repo Processing                      *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  103204 - Changes required for FX Rates on Depot movements.   *
     F*  046800 - Check Record ID (RECI) not equal to reverse  during *
     F*           counting records in.                                *
     F*  049901 - FOR DEPOT MOVEMENTS, MOVE DEPOT NUMBER IN OUR DEPOT *
     F*           CUSTOMER NUMBER OTHERWISE AMOUNT IS POSTED ON       *
     F*           SUSPENSE ACCOUNT
     F*  049869 - Repos and Reverse Repos trailer management          *
     F*         - Biton '0' only if value date (OUT or IN) is reached *
     F*           (Depot Date is GE rund and LT Dnwd) or (Depot date  *
     F*           LT Xored)                                           *
     F*  099545 - No account key should be generated for processing   *
     F*           type 2,4,7.                                         *
     F*  102132 - 100255 is incorrect as classification of 'K' should *
     F*           be the same as Depot, and also the setup of the     *
     F*           field PFOIND is wrong for key 'FR'.                 *
     F*  100255 - A/c key CDCL_CIN____S_____BL generated instead of   *
     F*           CDCL_XIN____S_____BL (note the 6th position, should *
     F*           be 'X' instead of 'C').  This position represents   *
     F*           the classification from PF/CLINTSE field C1DI.      *
     F*           Fix is to make it 'X' if classification not equal   *
     F*           to 'M', 'S', 'D' and 'K'.                           *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  100099 - When depot movement is input on the month end/      *
     F*           before Holiday, user depot movement being generated *
     F*           twice. This is because this program is run twice.   *
     F*  S01408 - Addition of core hook SE220CCP4
     F*         - Addition of core hook SE220CCP5
     F*  S01408 - Addition of core hook SE220FFP1
     F*           Addition of core hook SE220CCP1
     F*           Addition of core hook SE220CCP2
     F*           Addition of core hook SE220CCP3
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  S01486 - Incorporation of PM Enhancements (S01313)           *
     F*  053103 - Depot Movement type output to PEV1 in PF/SEKEYD     *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  066306 - Rename NMCY field on Diary/Non Diary events files.  *
     F*           This prevents problems with partly paids generating *
     F*           account keys with wrong nominal and event currency. *
     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
     F*  S01446 - Customer Commissions (Courtage). Take group charge  *
     F*           code from charge code of depot mvmnt if Charge Acct *
     F*           key to be written.                                  *
     F*  S01445 - Depot Movement Charges. If depot mvmnt is WI or WI, *
     F*           and charge amount not zero, write Charge Acct Key.  *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           SR. ZYLD)                                           *
     F*         - /COPY subroutine ZCNSDZ1 added (called from SR.ZYLD)*
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  047922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files and SR/ZYLD.   *
     F*  E32674 - Recompiled due to error in DPTMVD                   *
     F*  E29170 - Report Control Facility changes                     *
     F*  E25293 - Repo balances are incorrect                         *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  S01269 - Trade authorisation: recompile over changed file    *
     F*           TABSE.                                              *
     F*  S01271 - Input Cycle Pay receive processing - move OTHSTD    *
     F*           Other Settlement processing to SE3310.              *
     F*  E23697 - Recompiled over changed PF/OTHSTD                   *
     F*  E23561 - Account keys should be generated with appropriate   *
     F*           Depot regardless of depot movement type.            *
     F*  E22963 - Other settlement report entries for depot movements *
     F*           should not be flagged as amendments.                *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21480 - CPRC needs Percentage Price, but MKTP is P/D/Y.     *
     F*  E21118 - Erroneous records are being written to PF/UDPMVD in *
     F*           SR/REPO.                                            *
     F*  E20651 - DB Error Numbers used in more than one place.       *
     F*           New Error Numbers as follows:                       *
     F*           DB ERROR 09 -> 14                                   *
     F*           DB ERROR 09 -> 15                                   *
     F*  E20601 - The Depot No. for the Out Leg of a 'BL' transaction *
     F*           is incorrect. It should be the Out Depot Number.    *
     F*           Date, not Depot variables should be compared with   *
     F*           Date of Next Working Day.                           *
     F*  E20488 - For Depot Movements, Movement Type should use the   *
     F*           Types used in Input in the other Settlement Report, *
     F*           i.e. SE0486.                                        *
     F*  E19975 - ISSR shouldn't be zeroized before writing SEKEYD as *
     F*           this field is needed for Posting References 4 and 5.*
     F*  E18988 - Wrong DBFILE given at DBASE Error 11.               *
     F*  E19032 - Depot Movement Account Keys should only be posted   *
     F*           for User Transfers and Walk-Ins/Outs if the Post No *
     F*           Depot Movements (PNDM) field = 'N'.                 *
     F*  E18803 - Set Account Key Sequence Number to zero to allow    *
     F*           for Multibranch Systems.                            *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  E16932 - PLEDGED DEPOSITS ARE GENERATING 'RA' AMOUNT CODES   *
     F*           IN THE A/C KEY BUT S/B 'PD'                         *
     F*  S01176 - SECURITIES TRADING 3.1 (DEPOT MOVEMENTS RECORDS     *
     F*           OUTPUT TO OTHER SETTLEMENTS FILE PF/OTHSTD).        *
     F*           SECURITIES TRADING 3.1 (AUSTRALIA)                  *
     F*           CREATE ACCOUNT KEYS FOR PLEDGED DEPOSITS AND        *
     F*           AND PLEDGED LOANS.                                  *
     F*  E15678 - PROGRAM RECOMPILED OVER NEW PRINTER FILE.           *
     F*  E14839 - Update Mvmts as 'S' after proc if not cancelled.    *
     F*  E15430 - CONVERTIBLE IND. ON ACCOUNT KEY MUST BE 'Y' OR ' '. *
     F*  E14961 - SECOND LEG OF REPOS/REVERSE REPOS,BOND BORROWING,   *
     F*           BOND LENDING DO NOT UPDATE DEPOT POSITIONS.         *
     F*  E14548 - Update Mvmts as '*' after proc ignoring PROT.       *
     F*  E13817 - OUTPUT 'FV' KEY WITH NOMINAL CURRENCY AND           *
     F*           NOMINAL DECIMAL PLACES.                             *
     F*  E13792 - UPDATE ALL DEPOT MOVEMENTS AS '*' AFTER PROCESSING. *
     F*                                                               *
     F*****************************************************************
      *
     FDPTMV   UP  E           K        DISK
     FDPTMVA  UF  E                    DISK
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCBF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     FSECTY   IF  E           K        DISK
     FSECOATL0IF  E           K        DISK                               CSE007
     FINVTP   IF  E           K        DISK
     FSECED   IF  E           K        DISK
     F            SEDEVDF                           KRENAMESEDEVDX        E21480
     F            SNDEVDF                           KRENAMESNDEVDX        E21480
     FSEDEV   IF  E           K        DISK                               E21480
     FSECEO   IF  E           K        DISK                               E21480
     F            SEDEVDF                           KRENAMESEDEVDO        E21480
     F            SNDEVDF                           KRENAMESNDEVDO        E21480
     FTABSE   IF  E           K        DISK
     F            TABLETAF                          KIGNORE
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICD SE    TABTB36F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F************TABTG10F                          KIGNORE               E13817
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F**** HOLS **TABLETJF                          KIGNORE               E21480
     F            TABLETKF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F************TABLETRF                          KIGNORE               S01176
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTB40F                          KIGNORE
     FSOBDMVL0IF  E           K        DISK                               CSE015
     FDPTMVR  IF  E           K        DISK                               CSE015
     F            DPTMVDF                           KRENAMEDPTMVRF        CSE015
     FDPTMVDY2IF  E           K        DISK                                                   CGL020
      *                                                                                       CGL020
     FSEKEYD  O   E                    DISK                      A
     FSEKEYA  O   E                    DISK                      A
     FUDPMVD  O   E                    DISK                      A
     FUDPMVA  UF  E                    DISK
     FCDPMVD  O   E                    DISK                      A
     FCDPMVA  UF  E                    DISK
     F***OTHSTD**O   E                    DISK                  A   S01176S01271
     F***OTHSTA**O   E                    DISK                      S01176S01271
     FSE2200AUO   E                    PRINTER
     F*
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE2200FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01 - Non-diary event record                                 *
     F*   02 - Diary event record                                     *
     F*   33 - General work indicator                                 *
     F*   35 - Processing required                                    *
     F*   36 - Movement records required to be written out            *
     F*   37 - Update Depot movement record                           *
     F*   41 - Indicator for LOKUP operation                          *   S01176
     F*   42 - Indicator for LOKUP operation                          *   S01176
     F*   43 - Chain indicator to TABLETR                             *   S01176
      *   44 - Chain indicator to SOBDMVD                             *   CSE015
      *   45 - TACI  Indicator on SOBMDVD                             *   CSE015
      *   46 - TACI  Indicator on DPTMVD                              *   CSE015
      *   47 - Chain indicator to DPTMVR                              *   CSE015
     F*   69 - Used to Control first cycle processing                 *
     F*   73 - Print difference message on audit report               *
     F*                                                               *
     F*98-99 - Used in standard sub-routines                          *
     F*                                                               *
     F*   U7 - Database error                                         *
     F*   U8 - Database / Control error                               *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*   ACKEY  - Write out generated a/c key records                *
     F*   AMTPST - Calculate amount to post                           *
     F****CLIENT*-*Chain*to*CLINTSE******************************  S01176 S01271
     F*   CUSDPM - Write out Customer depot movements                 *
     F****OTHDPM*-*Write*out*Other*Settlements*depot*movements***  S01176 S01271
     F*   REPO   - Processing for BL, BB, RP or RR movement type recd *
     F*   USRDPM - Write out User depot movements                     *
     F*   USRTFR - Processing DT movement type record                 *
     F*   WALKIO - Processing for WI or WO movement type record       *
     F*   CHGKEY - Setup and write charge account key                 *   S01445
     F*   NWKEY  - Setup new a/c for Repo                             *   CSE006
     F*   FEAMT  - Generate fee amount                                *   CSE006
      *   MOVFLD - Move fields from the Start of Business file to     *   CSE015
      *            working fields for SR/GENENT                       *   CSE015
      *   GENENT - Generate reversal entries for SR/ACKEY, SR/CUSDPM  *   CSE015
     F*                                                               *
     F****XDATE3*-*Calculate working days basckward            *   E21480 S01117
     F*   ZACCH  - Access holidays file                               *
     F*   ZACCR  - Calculate interest accrued between 2 dates         *   E21480
     F*   ZACCZ  - Calculate interest accrued between specified dates *   E21480
     F*   ZBKDT  - Calculate working days backwards                   *   S01117
     F*   ZCALCD - Calculate long term CD price from yield            *   E39495
     F*   ZCNSD  - Calculate consideration                            *   E39495
     F*   ZDATE1 - Convert date to dayno.                             *   E21480
     F*   ZDATE2 - Convert dayno. to date                             *   E21480
     F*   ZDAYS  - Calculate no. of days between two dates            *   E21480
     F*   ZDYYR  - Calculate no. of dasy in interest year             *   E21480
     F*   ZD5DYS - Calculate no days in coupon period div basis 5     *   S01117
     F*   ZEVCD  - Determine Event Control date                       *
     F*   ZHASH  - Calculate hash value for run control               *
     F*   ZICDSE - Access ICD record for Securities Trading           *
     F*   ZICD2  - Access ICD record 2                                *
     F*   ZLCD   - Determine previous coupon date                     *   E21480
     F*   ZNCD   - Determine next coupon date                         *   E21480
     F*   ZPRCI  - Output price as %price                             *   E21480
     F*   ZRATE  - Determine effective rate                           *   E21480
     F*   ZSYSTM - Access ICD record                                  *
     F*   ZYCE   - Set up cum/ex parameter for Australian yields      *   E21480
     F*   ZYLD   - Set up paramters for ZYIELD routine                *   S01117
     F*   ZYLDI  - Output yield as percentage                         *   E21480
     F*   *PSSR  - Exception error routine                            *   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E                    INA         3  6 0             DEPOTS INVTP     S01176
     E                    TBA        10  6 0             DEPOTS TABTB36   S01176
     E                    SEA        10  6               DEPOTS CLINTSE   S01176
     E                    SCA         3 12               SEC. REF SECTY   S01176
     E*COPY*ZSRSRC*ZDATE6Z1                                        E21480 S01195
     E/COPY ZSRSRC,ZHASHZ1
     E/COPY WNCPYSRC,SE2200E001
     E/COPY ZSRSRC,ZPOWER8Z1                                              E13817
     E/COPY ZSRSRC,ZNCDZ1                                                 E21480
     E/COPY ZSRSRC,ZDATE2Z1                                               E21480
     E/COPY ZSRSRC,ZDAYSZ1                                                E21480
     E/COPY ZSRSRC,ZHOLE                                                  S01117
      /EJECT
      *                                                                                       203725
     ISECTYDF                                                                                 203725
     I              REPI                            SEREPI                                    203725
      *                                                                                       203725
     IDPTMVDF
     I              RECI                            DRECI
     I              DPMV                            XDPMV
     I              ORED                            XORED
     I              LCD                             XLCD
     I              CHTP                            XCHTP
     I              PTFR                            XPTFR                 S01486
     I              SPXR                            XSPXR                 103204
     I              SPMD                            XSPMD                 103204
      *                                                                   CSE015
     IDPTMVRF                                                             CSE015
     I              RECI                            DRECI                 CSE015
     I              DPMV                            XDPMV                 CSE015
     I              ORED                            XORED                 CSE015
     I              LCD                             XLCD                  CSE015
     I              CHTP                            XCHTP                 CSE015
     I              PTFR                            XPTFR                 CSE015
     I              SPXR                            XSPXR                 CSE015
     I              SPMD                            XSPMD                 CSE015
      *                                                                   CSE015
     ISOBDMVDF                                                            CSE015
     I              RECI                            SORECI                CSE015
     I              DPSS                            SODPSS                CSE015
     I              DPRN                            SODPRN                CSE015
     I              DPMV                            SODPMV                CSE015
     I              DPID                            SODPID                CSE015
     I              DPMD                            SODPMD                CSE015
     I              DPOD                            SODPOD                CSE015
     I              DPDO                            SODPDO                CSE015
     I              DPBA                            SODPBA                CSE015
     I              ORBR                            SOORBR                CSE015
     I              DPBK                            SOBPBK                CSE015
     I              DPMK                            SODPMK                CSE015
     I              DPBN                            SODPBN                CSE015
     I              DPNA                            SODPNA                CSE015
     I              DPNR                            SODPNR                CSE015
     I              MKTP                            SOMKTP                CSE015
     I              DPAD                            SODPAD                CSE015
     I              SWRF                            SOSWRF                CSE015
     I              SIOI                            SOSIOI                CSE015
     I              DPMS                            SODPMS                CSE015
     I              DCFR                            SODCFR                CSE015
     I              TACI                            SOTACI                CSE015
     I              DPR1                            SODPR1                CSE015
     I              DPR2                            SODPR2                CSE015
     I              ORED                            SOORED                CSE015
     I              LCD                             SOLCD                 CSE015
     I              CHTP                            SOCHTP                CSE015
     I              TNLU                            SOTNLU                CSE015
     I              RPIN                            SORPIN                CSE015
     I              DPPC                            SODPPC                CSE015
     I              DCHC                            SODCHC                CSE015
     I              DCCE                            SODCCE                CSE015
     I              DCHA                            SODCHA                CSE015
     I              DCSE                            SODCSE                CSE015
     I              DCAB                            SODCAB                CSE015
     I              DCAT                            SODCAT                CSE015
     I              DPVD                            SODPVD                CSE015
     I              SPXR                            SOSPXR                CSE015
     I              SPMD                            SOSPMD                CSE015
     I              PTFR                            SOPTFR                CSE015
     I              CYLD                            SOCYLD                CSE015
     I              CWDI                            SOCWDI                CSE015
     I              COAF                            SOCOAF                CSE015
     I              DMFRNT                          SOFRNT                CSE015
     I              DMAFRT                          SOAFRT                CSE015
     I              DMREPA                          SOREPA                CSE015
     I              MSTP                            SOMSTP                CSE015
     I              ACIN                            SOACIN                CSE015
     I              PINT                            SOPINT                CSE015
     I              REPI                            SOREPI                CSE015
     I              DVIN                            SODVIN                CSE015
     I              DMIN                            SODMIN                CSE015
     I              DEXRT                           SODEXR                CSE015
     I              DFROM                           SODFRM                CSE015
     I              DPNR2                           SODPN2                CSE015
     I              DPNR3                           SODPN3                CSE015
     I              DPNR4                           SODPN4                CSE015
     I              DPNR5                           SODPN5                CSE015
     I              DPIN                            SODPIN                CSE015
     I              DPAP                            SODPAP                CSE015
     I              DMTD                            SODMTD                CSE015
     I              CPTY                            SOCPTY                                    207006
     I              MRKT                            SOMRKT                                    207006
     I              FSPR                            SOFSPR                                    CGL031
     I              FSPP                            SOFSPP                                    CGL031
     I              OPDT                            SOOPDT                                    CGL031
     I              OPIN                            SOOPIN                                    CGL031
      *                                                                   CSE037
     IINVTPDF                                                             CSE037
     I              SFLG                            ISFLG                 CSE037
      *                                                                   CSE037
     I*NDEVDF*****01                                                      E21480
     I*EDEVDF*****02                                                      E21480
     ISNDEVDX     01                                                      E21480
     ISEDEVDX     02                                                      E21480
     I              NMCY                            SNMCY                 066306
     ISEDEVDF                                                             066306
     I              NMCY                            SNMCY                 066306
     ISEDEVDO                                                             066306
     I              NMCY                            SNMCY                 066306
     I/COPY WNCPYSRC,SE2200I002
     I*                                                                   S01486
     IDEPOT     E DSDPTMVD                                                CSE015
     I              RECI                            DRECI                 CSE015
     I              DPMV                            XDPMV                 CSE015
     I              ORED                            XORED                 CSE015
     I              LCD                             XLCD                  CSE015
     I              CHTP                            XCHTP                 CSE015
     I              PTFR                            XPTFR                 CSE015
     I              SPXR                            XSPXR                 CSE015
     I              SPMD                            XSPMD                 CSE015
     I              DPNR                            XDPNR                 CSE015
     ISDMMOD    E DSSDMMODPD                                              S01486
     I** DS for access to Modules File                                    S01486
     I*                                                                   CAC002
     ISDSTRD    E DSSDSTRDPD                                              CAC002
     I**  Securities Trading Details                                      CAC002
     I*                                                                   CSE006
     ISCSARD    E DSSCSARDPD                                              CSE006
     I** Switchable features file                                         CSE006
     I*                                                                   S01486
     IDSFDY     E DSDSFDY                                                 S01486
     I** DS for access programs, short data structure                     S01486
     I*                                                                   S01446
     ISECGT     E DSSECGTD                                                S01446
     I**  EXTERNAL DS FOR CHARGE TYPE DETAILS                             S01446
     I              RECI                            SRECI                 S01446
     I              LCD                             SLCD                  S01446
     I              CHTP                            SCHTP                 S01446
     I              TNLU                            STNLU                 S01446
     I              PRFC                            SPRFC                 CAC002
     I              ZONE                            ZONEC                                     CGP001
      *                                                                   CSE015
     I***SOBDM**E*DSSOBDMVD                     430                                    CSE015 207006
     I***SOBDM**   E DSSOBDMVD                     438                                 207006 CGL029
     ISOBDM     E DSSOBDMVD                                                                   CGL029
     I              RECI                            SORECI                CSE015
     I              DPSS                            SODPSS                CSE015
     I              DPRN                            SODPRN                CSE015
     I              DPMV                            SODPMV                CSE015
     I              DPID                            SODPID                CSE015
     I              DPMD                            SODPMD                CSE015
     I              DPOD                            SODPOD                CSE015
     I              DPDO                            SODPDO                CSE015
     I              DPBA                            SODPBA                CSE015
     I              ORBR                            SOORBR                CSE015
     I              DPBK                            SOBPBK                CSE015
     I              DPMK                            SODPMK                CSE015
     I              DPBN                            SODPBN                CSE015
     I              DPNA                            SODPNA                CSE015
     I              DPNR                            SODPNR                CSE015
     I              MKTP                            SOMKTP                CSE015
     I              DPAD                            SODPAD                CSE015
     I              SWRF                            SOSWRF                CSE015
     I              SIOI                            SOSIOI                CSE015
     I              DPMS                            SODPMS                CSE015
     I              DCFR                            SODCFR                CSE015
     I              TACI                            SOTACI                CSE015
     I              DPR1                            SODPR1                CSE015
     I              DPR2                            SODPR2                CSE015
     I              ORED                            SOORED                CSE015
     I              LCD                             SOLCD                 CSE015
     I              CHTP                            SOCHTP                CSE015
     I              TNLU                            SOTNLU                CSE015
     I              RPIN                            SORPIN                CSE015
     I              DPPC                            SODPPC                CSE015
     I              DCHC                            SODCHC                CSE015
     I              DCCE                            SODCCE                CSE015
     I              DCHA                            SODCHA                CSE015
     I              DCSE                            SODCSE                CSE015
     I              DCAB                            SODCAB                CSE015
     I              DCAT                            SODCAT                CSE015
     I              DPVD                            SODPVD                CSE015
     I              SPXR                            SOSPXR                CSE015
     I              SPMD                            SOSPMD                CSE015
     I              PTFR                            SOPTFR                CSE015
     I              CYLD                            SOCYLD                CSE015
     I              CWDI                            SOCWDI                CSE015
     I              COAF                            SOCOAF                CSE015
     I              DMFRNT                          SOFRNT                CSE015
     I              DMAFRT                          SOAFRT                CSE015
     I              DMREPA                          SOREPA                CSE015
     I              MSTP                            SOMSTP                CSE015
     I              ACIN                            SOACIN                CSE015
     I              PINT                            SOPINT                CSE015
     I              REPI                            SOREPI                CSE015
     I              DVIN                            SODVIN                CSE015
     I              DMIN                            SODMIN                CSE015
     I              DEXRT                           SODEXR                CSE015
     I              DFROM                           SODFRM                CSE015
     I              DPNR2                           SODPN2                CSE015
     I              DPNR3                           SODPN3                CSE015
     I              DPNR4                           SODPN4                CSE015
     I              DPNR5                           SODPN5                CSE015
     I              DPIN                            SODPIN                CSE015
     I              DPAP                            SODPAP                CSE015
     I              DMTD                            SODMTD                CSE015
     I              CPTY                            SOCPTY                                    207006
     I              MRKT                            SOMRKT                                    207006
     I              FSPR                            SOFSPR                                    CGL031
     I              FSPP                            SOFSPP                                    CGL031
     I              OPDT                            SOOPDT                                    CGL031
     I              OPIN                            SOOPIN                                    CGL031
     I              DMTMST                          XXTMST                                    CPK014
     I              DCATQQ                          QQDCA1                                    CGL029
      *                                                                   CSE015
      *** Rename fields which exist already on other records              S01446
     I*                                                                   S01446
     ILDA         DS                            256                       S01117
     I*                                                                   S01117
     I**  Local Data Area used for Database Error reporting               S01117
     I*                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I***********LDA        UDS                            256            S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I            DS
     I                                        1  20 ACKY
     I                                        1   3 INVTYP
     I                                        4   4 EVTCOD
     I                                        5   5 EVTDAT                CSE015
     I                                        6   6 PFOIND
     I                                        7   8 BOOKCD
     I                                        9  10 SUBTYP                CSE007
     I                                       11  12 CHGCOD                S01445
     I                                       13  13 MARKET
     I                                       14  14 CONVRT
     I                                       15  15 NEGIND
     I/COPY WNCPYSRC,SE2200I003
     I                                       19  20 AMTCOD
     I            DS                                                      S01176
     I* DEPOTS ON INVTP                                                   S01176
     I                                        1  18 INA                   S01176
     I**********                              1   60SDC1                               S01176 CSD027
     I**********                              7  120SDC2                               S01176 CSD027
     I**********                             13  180SDC3                               S01176 CSD027
     I                                        1   6 SDC1                                      CSD027
     I                                        7  12 SDC2                                      CSD027
     I                                       13  18 SDC3                                      CSD027
     I            DS                                                      S01176
     I* DEPOTS ON TABTB36                                                 S01176
     I                                        1  60 TBA                   S01176
     I**********                              1   60DC01                               S01176 CSD027
     I**********                              7  120DC02                               S01176 CSD027
     I**********                             13  180DC03                               S01176 CSD027
     I**********                             19  240DC04                               S01176 CSD027
     I**********                             25  300DC05                               S01176 CSD027
     I**********                             31  360DC06                               S01176 CSD027
     I**********                             37  420DC07                               S01176 CSD027
     I**********                             43  480DC08                               S01176 CSD027
     I**********                             49  540DC09                               S01176 CSD027
     I**********                             55  600DC10                               S01176 CSD027
     I                                        1   6 DC01                                      CSD027
     I                                        7  12 DC02                                      CSD027
     I                                       13  18 DC03                                      CSD027
     I                                       19  24 DC04                                      CSD027
     I                                       25  30 DC05                                      CSD027
     I                                       31  36 DC06                                      CSD027
     I                                       37  42 DC07                                      CSD027
     I                                       43  48 DC08                                      CSD027
     I                                       49  54 DC09                                      CSD027
     I                                       55  60 DC10                                      CSD027
     I            DS                                                      S01176
     I*  DEPOTS ON CLINTSE                                                S01176
     I                                        1  60 SEA                   S01176
     I                                        1   6 C101                  S01176
     I                                        7  12 C102                  S01176
     I                                       13  18 C103                  S01176
     I                                       19  24 C104                  S01176
     I                                       25  30 C105                  S01176
     I                                       31  36 C106                  S01176
     I                                       37  42 C107                  S01176
     I                                       43  48 C108                  S01176
     I                                       49  54 C109                  S01176
     I                                       55  60 C110                  S01176
     I            DS                                                      S01176
     I* SECURITY REFERENCES ON SECTY                                      S01176
     I                                        1  36 SCA                   S01176
     I                                        1  12 DASR                  S01176
     I                                       13  24 DCSR                  S01176
     I                                       25  36 DDSR                  S01176
     I            DS                                                      CSE007
     I* NARRATIVE ON DPTMVD                                               CSE007
     I                                        1  35 DPNR                  CSE007
     I                                       30  31 WWTYPE                CSE007
     I*
     ICPYR@#      DS
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                                       CGL020
     I              'ZAAMLSETSE'          C         ZAAMLP                                    CGL020
      *                                                                                       CGL020
     I/COPY ZSRSRC,ZNCDZ2                                                 E21480
     I/COPY ZSRSRC,ZYLDZ1                                                 E21480
     I/COPY ZSRSRC,ZHASHZ2
     I/COPY ZSRSRC,ZHOLI                                                  S01117
     I/COPY ZSRSRC,ZHOLDS                                                 S01117
     I/COPY WNCPYSRC,SE2200I001
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
     C/COPY WNCPYSRC,SE2200C001
      ** Access CAR details file to determine if feature is installed                         CSE093
     C                     CALL 'AOSARDR0'                                                    CSE093
     C                     PARM *BLANKS   @RTCD   7                                           CSE093
     C                     PARM '*VERIFY' @OPTN   7                                           CSE093
     C                     PARM 'CSE093'  @SARD   6                                           CSE093
     C                     PARM *BLANKS   DSFDY                                               CSE093
      *                                                                                       CSE093
     C           @RTCD     IFEQ *BLANKS                                                       CSE093
     C                     MOVE 'Y'       CSE093  1                                           CSE093
     C                     ENDIF                                                              CSE093
     C           *IN69     IFEQ '0'
     C*
     C* Prepare LDA
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBLOT
     C                     MOVE 'SE2200  'DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C* Get Installation Control Data record 1
     C*
     C                     EXSR ZSYSTM
     C*
     C* If error in ZSYSTM, terminate program.
     C*
     C           *IN99     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                        **           **S01117
     C***********          MOVE '01'      DBASE            **DB ERROR 01**S01117
     C                     Z-ADD01        DBASE            **DB ERROR 01**S01117
     C                     MOVEL'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     SETON                     U7U8LR
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     RETRN
     C                     END
     C*
     C* Get Installation Control Data 2
     C*
     C                     EXSR ZICD2
     C*
     C* If error in ZICD2, terminate program
     C*
     C           *IN99     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                        **           **S01117
     C************         MOVE '02'      DBASE            **DB ERROR 02**S01117
     C                     Z-ADD02        DBASE            **DB ERROR 02**S01117
     C                     MOVEL'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     SETON                     U7U8LR
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     RETRN
     C                     END
     C*
     C* Get Installation Control Data record for Securities Trading
     C*
     C                     EXSR ZICDSE
     C*
     C* If error in ZICDSE, terminate program
     C*
     C           *IN99     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                        **           **S01117
     C***********          MOVE '03'      DBASE            **DB ERROR 03**S01117
     C                     Z-ADD03        DBASE            **DB ERROR 03**S01117
     C                     MOVEL'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     SETON                     U7U8LR
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     RETRN
     C                     END
      *                                                                   S01445
      *** Check S01445 has been installed                                 S01445
      *                                                                   S01445
     C                     CALL 'AOSARDR0'                                S01445
     C                     PARM *BLANKS   @RTCD   7                       S01445
     C                     PARM '*VERIFY' @OPTN   7                       S01445
     C                     PARM 'S01445'  WSARD   6                       S01445
      *                                                                   S01445
     C           @RTCD     IFEQ *BLANK                                    S01445
     C                     MOVE 'Y'       S01445  1                       S01445
     C                     ELSE                                           S01445
     C                     MOVE 'N'       S01445                          S01445
     C                     END                                            S01445
      *                                                                   S01446
      *** Check S01446 has been installed                                 S01446
      *                                                                   S01446
     C                     CALL 'AOSARDR0'                                S01446
     C                     PARM *BLANKS   @RTCD                           S01446
     C                     PARM '*VERIFY' @OPTN                           S01446
     C                     PARM 'S01446'  WSARD                           S01446
      *                                                                   S01446
     C           @RTCD     IFEQ *BLANK                                    S01446
     C                     MOVE 'Y'       S01446  1                       S01446
     C                     ELSE                                           S01446
     C                     MOVE 'N'       S01446                          S01446
     C                     END                                            S01446
      *                                                                   CSE007
      *** Check CSE007 has been installed                                 CSE007
      *                                                                   CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM *BLANKS   @RTCD   7                       CSE007
     C                     PARM '*VERIFY' @OPTN   7                       CSE007
     C                     PARM 'CSE007'  WSARD   6                       CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANK                                    CSE007
     C                     MOVE 'Y'       CSE007  1                       CSE007
     C                     ELSE                                           CSE007
     C                     MOVE 'N'       CSE007                          CSE007
     C                     END                                            CSE007
      *                                                                   CEU017
      *** Check CEU017 has been installed                                 CEU017
      *                                                                   CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM *BLANKS   @RTCD   7                       CEU017
     C                     PARM '*VERIFY' @OPTN   7                       CEU017
     C                     PARM 'CEU017'  WSARD   6                       CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANK                                    CEU017
     C                     MOVE 'Y'       CEU017  1                       CEU017
     C                     ELSE                                           CEU017
     C                     MOVE 'N'       CEU017                          CEU017
     C                     END                                            CEU017
      *                                                                   CSE006
      *** Check if Repurchase Agreement switchable feature is installed   CSE006
      *                                                                   CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM *BLANKS   @RTCD                           CSE006
     C                     PARM '*VERIFY' @OPTN                           CSE006
     C                     PARM 'CSE006'  @SARD   6                       CSE006
     C           SCSARD    PARM SCSARD    DSFDY                           CSE006
      *                                                                   CSE006
      * Database Error                                                    CSE006
      *                                                                   CSE006
     C           @RTCD     IFNE *BLANKS                                   CSE006
     C           @RTCD     ANDNE'*NRF'                                    CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVE 'SCSARDPD'DBFILE           ***************CSE006
     C                     MOVE *BLANKS   DBKEY            * DB ERROR 21 *CSE006
     C                     Z-ADD21        DBASE            ***************CSE006
     C                     WRITEHEADAU                                    CSE006
     C                     WRITEERROR                                     CSE006
     C                     OUT  LDA                                       CSE006
     C                     SETON                     U7U8LR               CSE006
     C                     DUMP                                           CSE006
     C                     RETRN                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           @RTCD     IFEQ *BLANK                                    CSE006
     C                     MOVEL'Y'       CSE006  1                       CSE006
     C                     ELSE                                           CSE006
     C                     MOVEL'N'       CSE006                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE017
      **  Determine if feature CSE017 is installed.                       CSE017
      *                                                                   CSE017
     C                     MOVE 'N'       CSE017  1                       CSE017
     C                     CALL 'AOSARDR0'                                CSE017
     C                     PARM '       ' @RTCD                           CSE017
     C                     PARM '*VERIFY' @OPTN                           CSE017
     C                     PARM 'CSE017'  WSARD                           CSE017
      *                                                                   CSE017
     C           @RTCD     IFEQ *BLANK                                    CSE017
     C                     MOVE 'Y'       CSE017                          CSE017
     C                     ELSE                                           CSE017
     C                     MOVE 'N'       CSE017                          CSE017
      *                                                                   CSE017
      ** Database Error (return code other than *NRF)                     CSE017
      *                                                                   CSE017
     C           @RTCD     IFNE '*NRF   '                                 CSE017
     C           *LOCK     IN   LDA                                       CSE017
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE017
     C                     MOVEL'CSE017'  DBKEY            * DB ERROR 21 *CSE017
     C                     Z-ADD21        DBASE            ***************CSE017
     C                     OUT  LDA                                       CSE017
     C                     MOVE *ON       *INU7                           CSE017
     C                     MOVE *ON       *INU8                           CSE017
     C                     MOVE *ON       *INLR                           CSE017
     C                     EXSR *PSSR                                     CSE017
     C                     ENDIF                                          CSE017
      *                                                                   CSE017
     C                     ENDIF                                          CSE017
      *                                                                   CSE015
      **  Determine if feature CSE015 is installed.                       CSE015
      *                                                                   CSE015
     C                     MOVE 'N'       CSE015  1                       CSE015
     C                     CALL 'AOSARDR0'                                CSE015
     C                     PARM '       ' @RTCD                           CSE015
     C                     PARM '*VERIFY' @OPTN                           CSE015
     C                     PARM 'CSE015'  WSARD                           CSE015
      *                                                                   CSE015
     C           @RTCD     IFEQ *BLANK                                    CSE015
     C                     MOVE 'Y'       CSE015                          CSE015
     C                     ELSE                                           CSE015
     C                     MOVE 'N'       CSE015                          CSE015
      *                                                                   CSE015
      ** Database Error (return code other than *NRF)                     CSE015
      *                                                                   CSE015
     C           @RTCD     IFNE '*NRF   '                                 CSE015
     C           *LOCK     IN   LDA                                       CSE015
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE015
     C                     MOVEL'CSE015'  DBKEY            * DB ERROR 22 *CSE015
     C                     Z-ADD22        DBASE            ***************CSE015
     C                     OUT  LDA                                       CSE015
     C                     MOVE *ON       *INU7                           CSE015
     C                     MOVE *ON       *INU8                           CSE015
     C                     MOVE *ON       *INLR                           CSE015
     C                     EXSR *PSSR                                     CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE018
      *** Check if Deletion of Walk-in and Walk-out are allowed after     CSE018
      *** movement date.                                                  CSE018
      *                                                                   CSE018
     C                     CALL 'AOSARDR0'                                CSE018
     C                     PARM *BLANKS   @RTCD                           CSE018
     C                     PARM '*VERIFY' @OPTN                           CSE018
     C                     PARM 'CSE018'  @SARD   6                       CSE018
     C           SCSARD    PARM SCSARD    DSFDY                           CSE018
      *                                                                   CSE018
      * Database Error                                                    CSE018
      *                                                                   CSE018
     C           @RTCD     IFNE *BLANKS                                   CSE018
     C           @RTCD     ANDNE'*NRF'                                    CSE018
     C           *LOCK     IN   LDA                                       CSE018
     C                     MOVE 'SCSARDPD'DBFILE           ***************CSE018
     C                     MOVE *BLANKS   DBKEY            * DB ERROR 23 *CSE018
     C                     Z-ADD23        DBASE            ***************CSE018
     C                     WRITEHEADAU                                    CSE018
     C                     WRITEERROR                                     CSE018
     C                     OUT  LDA                                       CSE018
     C                     SETON                     U7U8LR               CSE018
     C                     DUMP                                           CSE018
     C                     RETRN                                          CSE018
     C                     ENDIF                                          CSE018
      *                                                                   CSE018
     C           @RTCD     IFEQ *BLANK                                    CSE018
     C                     MOVEL'Y'       CSE018  1                       CSE018
     C                     ELSE                                           CSE018
     C                     MOVEL'N'       CSE018                          CSE018
     C                     ENDIF                                          CSE018
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                                       207006
      **  Determine if feature CSE029 is installed                                            207006
      *                                                                                       207006
     C                     MOVE 'N'       CSE029  1                                           207006
     C                     CALL 'AOSARDR0'                                                    207006
     C                     PARM '       ' @RTCD                                               207006
     C                     PARM '*VERIFY' @OPTN                                               207006
     C                     PARM 'CSE029'  WSARD                                               207006
      *                                                                                       207006
      ** Database Error (return code other than *NRF)                                         207006
      *                                                                                       207006
     C           @RTCD     IFNE '*NRF   '                                                     207006
     C           @RTCD     ANDNE*BLANKS                                                       207006
     C           *LOCK     IN   LDA                                                           207006
     C                     MOVEL'SCSARDPD'DBFILE                                              207006
     C                     MOVEL'CSE029'  DBKEY                                               207006
     C                     Z-ADD22        DBASE                                               207006
     C                     OUT  LDA                                                           207006
     C                     MOVE *ON       *INU7                                               207006
     C                     MOVE *ON       *INU8                                               207006
     C                     MOVE *ON       *INLR                                               207006
     C                     EXSR *PSSR                                                         207006
     C                     ENDIF                                                              207006
      *                                                                                       207006
     C           @RTCD     IFEQ *BLANKS                                                       207006
     C                     MOVE 'Y'       CSE029                                              207006
     C                     ENDIF                                                              207006
      *                                                                                       CGL031
      ** Check if Taxation of Savings Income (CGL031) is installed                            CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD   7                                           CGL031
     C                     PARM '*VERIFY' POPTN   7                                           CGL031
     C                     PARM 'CGL031'  PSARD   6                                           CGL031
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL031
      *                                                                                       CGL031
      ** Database Error                                                                       CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           PRTCD     ANDNE'*NRF'                                                        CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVE 'SCSARDPD'DBFILE                                              CGL031
     C                     MOVE 'CGL031'  DBKEY                                               CGL031
     C                     Z-ADD27        DBASE                                               CGL031
     C                     WRITEHEADAU                                                        CGL031
     C                     WRITEERROR                                                         CGL031
     C                     OUT  LDA                                                           CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     MOVE *ON       *INLR                                               CGL031
     C                     DUMP                                                               CGL031
     C                     RETRN                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANK                                                        CGL031
     C                     MOVEL'Y'       CGL031  1                                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVEL'N'       CGL031                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                   S01408
     C/COPY WNCPYSRC,SE2200CCP6                                           S01408
      *                                                                   S01408
     C*                                                                   S01486
     C**  Check if S01486 is installed.                                   S01486
     C*                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C           *LOCK     IN   LDA                        ***************S01486
     C                     Z-ADD17        DBASE            * DB ERROR 17 *S01486
     C                     MOVE 'SDMMODPD'DBFILE           ***************S01486
     C                     MOVE *BLANKS   DBKEY                           S01486
     C                     WRITEHEADAU                                    S01486
     C                     WRITEERROR                                     S01486
     C                     SETON                     U7U8LR               S01486
     C                     OUT  LDA                                       S01486
     C                     DUMP                                           S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C*                                                                   CAC002
     C**  Access Securities Trading details                               CAC002
     C*                                                                   CAC002
     C                     CALL 'AOSTRDR0'                                CAC002
     C                     PARM '*MSG   ' @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDSTRD    PARM SDSTRD    DSSDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD18        DBASE            ************   CAC002
     C                     MOVEL'SDSTRDPD'DBFILE           * DBERR 18 *   CAC002
     C                     MOVEL@OPTN     DBKEY            ************   CAC002
     C                     OUT  LDA                                       CAC002
     C                     WRITEHEADAU                                    CAC002
     C                     WRITEERROR                                     CAC002
     C                     SETON                     U7U8LR               CAC002
     C                     DUMP                                           CAC002
     C                     RETRN                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                                       CGL020
      ** Determine if Midas Compliance Watch is installed                                     CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM '       ' @RTCD                                               CGL020
     C                     PARM '*VERIFY' @OPTN                                               CGL020
     C                     PARM 'CGL020'  @SARD   6                                           CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           @RTCD     IFNE *BLANK                                                        CGL020
     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     MOVEL'027'     DBASE                                               CGL020
     C                     MOVEL@SARD     DBKEY                                               CGL020
     C                     WRITEHEADAU                                                        CGL020
     C                     WRITEERROR                                                         CGL020
     C                     MOVE *ON       *INU7                                               CGL020
     C                     MOVE *ON       *INU8                                               CGL020
     C                     MOVE *ON       *INLR                                               CGL020
     C                     OUT  LDA                                                           CGL020
     C                     DUMP                                                               CGL020
     C                     RETRN                                                              CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* Calculate Event Control Date
     C*
     C* Setup input parameters of accrual/profit date and                 S01117
     C* date next working day                                             S01117
     C*                                                                   S01117
     C                     Z-ADDDNWD      ZZDNWD                          S01117
     C                     Z-ADDAPDA      ZZAPDT                          S01117
     C*                                                                   S01117
     C                     EXSR ZEVCD
     C*
     C                     Z-ADD*ZEROS    ZZAMT
     C*
     C* Key to access Investment Type
     C*
     C           INVTKA    KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2200CCP1                                           S01408
     C*                                                                   S01408
     C*
     C* Key to position pointer on Security Events file
     C*
     C           SECEKA    KLIST
     C                     KFLD           DPSS
     C                     KFLD           MOVDAT
     C*
     C                     SETON                     69
     C                     END
      *                                                                   CSE015
      ** Key to position pointer on Start of Business Depot               CSE015
      ** Movement File and Depot Movement File                            CSE015
      *                                                                   CSE015
     C           KDEPOT    KLIST                                          CSE015
     C                     KFLD           DPSS                            CSE015
     C                     KFLD           DPRN                            CSE015
     C*
     C* DEFINE WORK FIELDS                                                E20488
     C*
     C           *LIKE     DEFN XDPMV     SDPMV                           E20488
     C           *LIKE     DEFN CFCT      FACTOR                          052254
     C*
     C* Count records in
     C*
     C           DRECI     IFNE '*'
     C           DRECI     ANDNE'R'                                       046800
     C                     ADD  1         DMRRD
     C                     END
     C*
     C* Count live records
     C*
     C           DRECI     IFEQ 'D'
     C           DRECI     OREQ 'S'                                       E14839
     C                     ADD  1         DMLIV
     C                     END
     C*
     C* Count reversed records
     C*
     C           DRECI     IFEQ 'R'
     C                     ADD  1         DMREV
     C                     END
     C*
     C**Process*records*if*not*already*deleted*************************   E14839
     C* Process records if not already deleted or settled                 E14839
     C*
     C           DRECI     IFNE '*'
     C           DRECI     ANDNE'S'                                       E14839
     C*
     C* Fetch Security
     C*
     C           DPSS      CHAINSECTYDF              33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                        **           **S01117
     C***********          MOVE '04'      DBASE            **DB ERROR 04**S01117
     C                     Z-ADD04        DBASE            **DB ERROR 04**S01117
     C                     MOVEL'SECTY'   DBFILE           ***************
     C                     MOVELDPSS      DBKEY
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     SETON                     U7U8LR
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     RETRN
     C                     END
     C*
     C* Fetch Processing type from Investment Type file
     C*
     C           INVTKA    CHAININVTPDF              33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                        **           **S01117
     C***********          MOVE '05'      DBASE            **DB ERROR 05**S01117
     C                     Z-ADD05        DBASE            **DB ERROR 05**S01117
     C                     MOVEL'INVTP'   DBFILE           ***************
     C                     MOVELNMCY      WORK6A  6
     C                     MOVE SITP      WORK6A
     C                     MOVELWORK6A    DBKEY
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     SETON                     U7U8LR
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     RETRN
     C                     END
     C*                                                                   E13817
     C* Fetch Nominal currency decimal places                             E13817
     C*                                                                   E13817
     C                     MOVELNMCY      WK4     4                       E13817
     C                     MOVEL'20      'TKEY   12                       E13817
     C                     MOVE 1         WK4                             E13817
     C                     MOVE WK4       TKEY                            E13817
     C           TKEY      CHAINTABTG10F             86                   E13817
     C  N86      RECI      COMP 'D'                  8686                 E13817
     C           *IN86     IFEQ '1'                                       E13817
     C           *LOCK     IN   LDA                        **           **S01117
     C                     MOVEL'TABSE'   DBFILE           ***************E13817
     C                     MOVELTKEY      DBKEY            * DB ERROR 98 *E13817
     C***********          MOVEL'98'      DBASE            ********E13817 S01117
     C                     Z-ADD98        DBASE                           S01117
     C                     WRITEHEADAU                                    E13817
     C                     WRITEERROR                                     E13817
     C***********          WRITETRAILAU                             E13817E29170
     C                     SETON                     U7U8LR               E13817
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     RETRN                                          E13817
     C                     END                                            E13817
     C*
     C* Generate keys and movements according to movement type
     C*
     C* User transfer
     C*
     C           XDPMV     IFEQ 'DT'
     C                     EXSR USRTFR
     C                     END
     C*
     C* Walk In/Walk Out
     C*
     C           XDPMV     IFEQ 'WI'
     C           XDPMV     OREQ 'WO'
     C                     EXSR WALKIO
     C                     END
     C*
     C* Repo
     C*
     C           XDPMV     IFEQ 'BL'
     C           XDPMV     OREQ 'BB'
     C           XDPMV     OREQ 'RP'
     C           XDPMV     OREQ 'RR'
     C           XDPMV     OREQ 'PD'                                      S01176
     C           XDPMV     OREQ 'PL'                                      S01176
     C*                                                                   100099
     C*** Condition now moved into Subroutine REPO                        102542
     C***Test*if*movement*being*generated*for*today*************** 100099 102542
     C*                                                            100099 102542
     C***********          TESTB'0'       TACI           43        100099 102542
     C************IN43     IFEQ '1'                                100099 102542
     C***********DRECI     ANDEQ'D'                                100099 102542
     C***********XORED     ANDEQRUND                               100099 102542
     C***********          MOVE '1'       *IN43                    100099 102542
     C***********          ELSE                                    100099 102542
     C***********          MOVE '0'       *IN43                    100099 102542
     C***********          END                                     100099 102542
     C*                                                                   100099
     C************IN43     IFEQ '0'                                100099 102542
     C                     EXSR REPO
     C************         END                                     100099 102542
     C*                                                                   100099
     C                     END
     C*
     C                     END
     C*
     C* LR - Audit process
     C*
     CLR                   DO
     C*
     C* If no records read, perform 1st time calcs for audit report
     C*
     CL0         DMRRD     IFEQ *ZEROS
     C*
     C* Prepare LDA
     C*
     CL0         *NAMVAR   DEFN           LDA                             S01117
     CL0         *LOCK     IN   LDA                                       S01117
     CL0                   MOVE *BLANKS   DBLOT
     CL0                   MOVE 'SE2200  'DBPGM
     CL0                   OUT  LDA                                       S01117
     C*
     C* Get Installation Control Data record 1
     C*
     CL0                   EXSR ZSYSTM
     C*
     C* If error in ZSYSTM, terminate program.
     C*
     CL0         *IN99     IFEQ '1'                        ***************
     CL0         *LOCK     IN   LDA                        **           **S01117
     C**L0*******          MOVE '06'      DBASE            **DB*ERROR*06**S01117
     CL0                   Z-ADD06        DBASE            **DB ERROR 06**S01117
     CL0                   MOVEL'TABLE'   DBFILE           ***************
     CL0                   MOVELZTABKY    DBKEY
     CL0                   WRITEHEADAU
     CL0                   WRITEERROR
     C*0*********          WRITETRAILAU                                   E29170
     CL0                   SETON                     U7U8LR
     CL0                   OUT  LDA                                       S01117
     CL0                   DUMP                                           S01117
     CL0                   RETRN
     CL0                   END
     C*
     CL0                   END
     C*
     C* Fetch Depot Movements audit file
     C*
     CL0         1         CHAINDPTMVAF              33
     CL0         *IN33     IFEQ '1'                        ***************
     CL0         *LOCK     IN   LDA                        **           **S01117
     C**L0*******          MOVEL'07'      DBASE            **DB*ERROR*07**S01117
     CL0                   Z-ADD07        DBASE            **DB ERROR 07**S01117
     CL0                   MOVEL'DPTMV'   DBFILE           ***************
     CL0                   MOVEL'AUDIT'   DBKEY
     CL0                   WRITEHEADAU
     CL0                   WRITEERROR
     C*0*********          WRITETRAILAU                                   E29170
     CL0                   SETON                     U7U8
     CL0                   OUT  LDA                                       S01117
     CL0                   DUMP                                           S01117
     CL0                   RETRN
     CL0                   ELSE
     C*
     C* Compare control total to number of records read
     C*
     CL0         NORE      COMP DMRRD                U8U8
     CL0 U8                SETON                     73
     C*
     C* Calculate output fields
     C*
     CL0                   Z-ADDNORE      DMRNO
      *    Reversed  REPO or reversed REVERSE REPO have been already      098249
      *    substracted from the trailer DPTMVA --> useless to do it again.098249
      *                                                                   098249
     C*****L0    NORE      SUB  DMDEL     DMNEW                           098249
     CL0                   Z-ADDNORE      DMNEW                           098249
     C*
     C* If totals same, update audit record
     C*
     CL0         *INU8     IFEQ '0'
     CL0                   Z-ADDDMNEW     SLRB
     CL0                   Z-ADDDMNEW     NORE
     CL0                   UPDATDPTMVAF
     C*
     C* Write audit record for generated account keys
     C*
     CL0                   Z-ADDACKEYS    NORE
     CL0                   Z-ADDHSHINT    HRWN
     CL0                   Z-ADDHSHDEC    HRDC
     CL0                   WRITESEKEYAF
     C*
     C* Update audit record for generated account keys
     C*
     CL0                   READ UDPMVA                   33
     CL0         *IN33     IFEQ '1'                        ***************
     CL0         *LOCK     IN   LDA                        **           **S01117
     C**L0*******          MOVEL'08'      DBASE            **DB*ERROR*08**S01117
     CL0                   Z-ADD08        DBASE            **DB ERROR 08**S01117
     CL0                   MOVEL'UDPMV'   DBFILE           ***************
     CL0                   MOVEL'AUDIT'   DBKEY
     CL0                   WRITEHEADAU
     CL0                   WRITEERROR
     C*0*********          WRITETRAILAU                                   E29170
     CL0                   SETON                     U7U8
     CL0                   OUT  LDA                                       S01117
     CL0                   DUMP                                           S01117
     CL0                   RETRN
     CL0                   ELSE
     CL0                   ADD  UDPMTS    NORE
     CL0                   UPDATUDPMVAF
     C*
     C* Update audit record for generated account keys
     C*
     CL0                   READ CDPMVA                   33
     CL0         *IN33     IFEQ '1'                        ***************
     CL0         *LOCK     IN   LDA                        **           **S01117
     C**L0*******          MOVEL'09'      DBASE            **DB*ERROR*09**E20651
     C**L0*******          MOVEL'14'      DBASE     **DB*ERROR*14**E20651
     CL0                   Z-ADD14        DBASE            **DB ERROR 14**S01117
     CL0                   MOVEL'CDPMV'   DBFILE           ***************
     CL0                   MOVEL'AUDIT'   DBKEY
     CL0                   WRITEHEADAU
     CL0                   WRITEERROR
     C*0*********          WRITETRAILAU                                   E29170
     CL0                   SETON                     U7U8
     CL0                   OUT  LDA                                       S01117
     CL0                   DUMP                                           S01117
     CL0                   RETRN
     CL0                   ELSE
     CL0                   ADD  CDPMTS    NORE
     CL0                   UPDATCDPMVAF
     CL0                   END
     C*                                                                   S01176
     C**Write*audit*record*for*Other*Settlement*details*file       S01176 S01271
     C**********                                                   S01176 S01271
     C***L0*****           Z-ADDOTHMTS    NORE                     S01176 S01271
     C***L0*****           WRITEOTHSTAF                            S01176 S01271
     C*                                                                   S01271
     CL0                   END
     C*
     CL0                   END
     C*
     C* Print audit report
     C*
     CL0                   WRITEHEADAU
     CL0                   WRITEDETLAU
     C*0*********          WRITETRAILAU                                   E29170
     C*
     CL0                   END
     C*
     CLR                   END
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* ACKEY SR. Writes out the generated account key records        *
     C*                                                               *
     C*****************************************************************
     C*
     C           ACKEY     BEGSR
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE SITP      INVTYP
     C                     MOVE 'L'       EVTCOD
     C                     MOVE DPBK      BOOKCD
     C                     MOVE DPMK      MARKET
     C                     MOVE ' '       CONVRT
     C           CIAK      IFEQ 'Y'
     C           SCVI      ANDEQ'Y'                                       E15430
     C                     MOVE SCVI      CONVRT
     C                     END
     C                     MOVE DPRN      TRFR
     C           CSE006    IFEQ 'Y'                                       CSE006
     C           DFROM     ANDNE' '                                       CSE006
     C                     MOVE DPAD      TRFR                            CSE006
     C                     END                                            CSE006
     C***********          Z-ADDDPBC      BRCH                            S01117
     C                     MOVE DPBA      BRHA                            S01117
     C***********          Z-ADD1         ASQN                            E18803
     C                     Z-ADD0         ASQN                            E18803
     C                     MOVE NMCY      EVCY
     C                     Z-ADD*ZEROS    STLT
     C                     MOVE *BLANKS   STLA
     C           DRECI     IFEQ 'D'
     C                     MOVE '0'       RVRS
     C                     ELSE
     C                     MOVE '1'       RVRS
     C                     END
      *                                                                   CSE015
     C           WREV      IFEQ 'Y'                                       CSE015
     C           CSE015    ANDEQ'Y'                                       CSE015
     C                     MOVE '1'       RVRS                            CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C***********          Z-ADD*ZEROS    ISSR                            E19975
     C                     Z-ADD*ZEROS    KNCA
     C***********          MOVE *BLANKS   KCCY                            S01176
     C                     MOVE NMCY      KCCY                            S01176
     C                     Z-ADD*ZEROS    KBCA
     C                     MOVE DPSS      SESH
     C*                                                                   S01117
     C** Settlement Branch needs to be blankk                             S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SEBR                            S01117
     C*                                                                   S01117
     C** Use Depot Movement Profit Centre for A/c Key                     S01117
     C*                                                                   S01117
     C                     MOVE DPPC      PRFC                            S01117
      *                                                                   CAC002
      ** If Analytical Accounting is installed, define the profit         CAC002
      ** centre for each posting.                                         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           XDPMV     IFEQ 'WI'                                      CAC002
     C           XDPMV     OREQ 'WO'                                      CAC002
     C                     MOVE DPPC      PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE BVSEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   S01486
     C**  Check if the amount code on the account key is face value.      S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           AMTCOD    ANDEQ'FV'                                      S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           AMTCOD    ANDEQ'FV'                                      CPB001
     C*                                                                   S01486
     C**  Set Portfolio Ref. equal to the value from depot movement.      S01486
     C*                                                                   S01486
     C                     MOVE XPTFR     PTFR                            S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANKS   PTFR                            S01486
     C                     END                                            S01486
     C*                                                                   053103
     C*          BGPFMG    IFEQ 'Y'                                       053103
     C                     MOVE XDPMV     PEV1                            053103
     C*                    END                                            053103
      *                                                                   CSE006
      *** New code for REPOs enhancement - movement types 'FR' and 'FP'   CSE006
      *                                                                   CSE006
     C           AMTCOD    IFEQ 'FP'                                      CSE006
     C           AMTCOD    OREQ 'FR'                                      CSE006
      *                                                                   CSE006
     C           DCSE      IFNE *ZERO                                     CSE006
     C                     Z-ADDDCSE      STLT                            CSE006
     C                     MOVE DCAT      STLA                            CSE006
     C                     MOVE DCAB      SEBR                            CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                                       CGL020
      ** If Midas Compliance Watch (CGL020) is on                                             CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   CSE006
     C/COPY WNCPYSRC,SE2200C011
     C*
     C                     WRITESEKEYDF
     C*
     C* Keep total for audit record
     C*
     C                     ADD  1         ACKEYS
     C*
     C* Fetch and keep hash totals for audit record
     C*
     C                     Z-ADDEVAM      ZZAMT
     C                     Z-ADD1         S
     C                     Z-ADD1         Z
     C                     EXSR ZHASH
     C                     Z-ADDINT,S     HSHINT
     C                     Z-ADDDEC,S     HSHDEC
      *                                                                   S01408
     C/COPY WNCPYSRC,SE2200CCP4                                           S01408
      *                                                                   S01408
      ** Only perform if Switchable feature is enabled                                        CSE093
     C           CSE093    IFEQ 'Y'                                                           CSE093
      *                                                                                       CSE093
      * Change the amount code                                                                CSE093
     C           AMTCOD    IFEQ 'BL'                                                          CSE093
     C           AMTCOD    OREQ 'BB'                                                          CSE093
     C           AMTCOD    OREQ 'RA'                                                          CSE093
     C           AMTCOD    OREQ 'RV'                                                          CSE093
     C           AMTCOD    OREQ 'PL'                                                          CSE093
     C           AMTCOD    OREQ 'PD'                                                          CSE093
      *                                                                                       CSE093
     C           AMTCOD    IFEQ 'BL'                                                          CSE093
     C                     MOVE 'CL'      AMTCOD                                              CSE093
     C                     ENDIF                                                              CSE093
     C           AMTCOD    IFEQ 'BB'                                                          CSE093
     C                     MOVE 'CB'      AMTCOD                                              CSE093
     C                     ENDIF                                                              CSE093
     C           AMTCOD    IFEQ 'RA'                                                          CSE093
     C                     MOVE 'XA'      AMTCOD                                              CSE093
     C                     ENDIF                                                              CSE093
     C           AMTCOD    IFEQ 'RV'                                                          CSE093
     C                     MOVE 'XV'      AMTCOD                                              CSE093
     C                     ENDIF                                                              CSE093
     C           AMTCOD    IFEQ 'PL'                                                          CSE093
     C                     MOVE 'XL'      AMTCOD                                              CSE093
     C                     ENDIF                                                              CSE093
     C           AMTCOD    IFEQ 'PD'                                                          CSE093
     C                     MOVE 'XD'      AMTCOD                                              CSE093
     C                     ENDIF                                                              CSE093
      *                                                                                       CSE093
      * Depot nominal amount --> Nominal                                                      CSE093
     C                     Z-ADDDPNA      ZNOML                                               CSE093
      * Depot market price --> Trade price                                                    CSE093
     C                     Z-ADDMKTP      ZPRC                                                CSE093
      * Nominal currency decimal places                                                       CSE093
     C                     Z-ADDCDP       ZCDP                                                CSE093
      *                                                                                       CSE093
      * If the depot market price is zero, set the price supplied to                          CSE093
      * the subroutine ZCNSD as follows:                                                      CSE093
     C           MKTP      IFEQ 0                                                             CSE093
      * If Percentage basis = 'P'                                                             CSE093
     C           SPBS      IFEQ 'P'                                                           CSE093
     C                     Z-ADD100       ZPRC                                                CSE093
     C                     ELSE                                                               CSE093
     C                     Z-ADD1         ZPRC                                                CSE093
     C                     ENDIF                                                              CSE093
     C                     ENDIF                                                              CSE093
      *                                                                                       CSE093
      * Use standard subroutine ZCNSD to calculate consideration                              CSE093
     C                     EXSR ZCNSD                                                         CSE093
      * Now put Consideration into Event amount                                               CSE093
     C                     Z-ADDZCONS     EVAM                                                CSE093
      *                                                                                       CSE093
      * Write new acount key record                                                           CSE093
     C                     WRITESEKEYDF                                                       CSE093
      *                                                                                       CSE093
      * Keep total for audit record                                                           CSE093
     C                     ADD  1         ACKEYS                                              CSE093
      *                                                                                       CSE093
      * Fetch and keep hash totals for audit record                                           CSE093
     C                     Z-ADDEVAM      ZZAMT                                               CSE093
     C                     Z-ADD1         S                                                   CSE093
     C                     Z-ADD1         Z                                                   CSE093
     C                     EXSR ZHASH                                                         CSE093
     C                     Z-ADDINT,S     HSHINT                                              CSE093
     C                     Z-ADDDEC,S     HSHDEC                                              CSE093
      *                                                                                       CSE093
     C                     ENDIF                                                              CSE093
      *                                                                                       CSE093
     C                     ENDIF                                                              CSE093
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  AMTPST - Subroutine to calculate the Amount to Post.         *
      *                                                               *
      *****************************************************************
      *
     C           AMTPST    BEGSR                           *** AMTPST  ***
     C*
     C* Set amount to post
     C*
     C                     Z-ADDDPNA      AMPOST 150
     C*
     C* Fetch movement date
     C*
     C           XDPMV     IFEQ 'DT'
     C           XDPMV     OREQ 'WI'
     C           XDPMV     OREQ 'BB'
     C           XDPMV     OREQ 'RR'
     C           XDPMV     OREQ 'PL'                                      S01176
     C                     Z-ADDDPMD      MOVDAT  50
     C                     ELSE
     C           XDPMV     IFEQ 'WO'
     C           XDPMV     OREQ 'BL'
     C           XDPMV     OREQ 'RP'
     C           XDPMV     OREQ 'PD'                                      S01176
     C                     Z-ADDDPDO      MOVDAT
     C                     END
     C                     END
     C*
     C* If Partly-paid security, fetch total PP call amount/% as at the
     C* date
     C*
     C           PPDI      IFEQ 'Y'
     C*
     C* If on or after run date, use current call amount/% from security
     C*
     C           MOVDAT    IFGE RUND
     C                     Z-ADDCPDP      CALAMT 150
     C                     ELSE
     C*
     C* Else fetch latest call amount/% for the date from the event file
     C*
     C                     Z-ADD*ZEROS    CALAMT
     C           SECEKA    SETGTSECED
     C                     SETOF                     33
     C           *IN33     DOWEQ'0'
     C                     READPSECED                    33
     C           *IN33     IFEQ '0'
     C           RECI      ANDNE'*'
     C*
     C* Non-diary event record
     C*
     C           *IN01     IFEQ '1'
     C           SNSN      IFEQ DPSS
     C           SNET      IFEQ 'CP'
     C           SNET      OREQ 'IR'
     C           SNET      OREQ 'PP'
     C           SNET      OREQ 'MP'
     C           SNCP      IFNE *ZEROS
     C                     Z-ADDSNCP      CALAMT     33
     C                     END
     C                     END
     C                     ELSE
     C                     SETON                     33
     C                     END
     C                     END
     C*
     C* Diary event record
     C*
     C           *IN02     IFEQ '1'
     C           SDSN      IFEQ DPSS
     C           SDET      IFEQ 'CP'
     C           SDET      OREQ 'IR'
     C           SDET      OREQ 'PP'
     C           SDET      OREQ 'MP'
     C           SDCP      IFNE *ZEROS
     C                     Z-ADDSDTA      CALAMT     33
     C                     END
     C                     END
     C                     ELSE
     C                     SETON                     33
     C                     END
     C                     END
     C*
     C                     END
     C                     END
     C*
     C* If not found, use current value from security
     C*
     C           CALAMT    IFEQ *ZEROS
     C                     Z-ADDCPDP      CALAMT
     C                     END
     C*
     C                     END
     C*
     C* Multiply amount to post by call amount/% obtained
     C*
     C           AMPOST    MULT CALAMT    AMPOST
     C*
     C                     END
     C*
     C* If a mortgage-backed security, obtain current factor as at date
     C* defined above
     C*
     C           PROT      IFEQ '8'
     C*
     C* If date on or after run date, use factor from security
     C*
     C           MOVDAT    IFGE RUND
     C**********           Z-ADDCFCT      FACTOR  98                      052254
     C                     Z-ADDCFCT      FACTOR                          052254
     C                     ELSE
     C*
     C* Else obtain it from latest security event to the movement date
     C*
     C                     Z-ADD*ZEROS    FACTOR
     C           SECEKA    SETGTSECED
     C                     SETOF                     33
     C           *IN33     DOWEQ'0'
     C                     READPSECED                    33
     C           *IN33     IFEQ '0'
     C           RECI      ANDNE'*'
     C*
     C* Non-diary event record
     C*
     C           *IN01     IFEQ '1'
     C           SNSN      IFEQ DPSS
     C           SNET      IFEQ 'CP'
     C           SNET      OREQ 'IR'
     C           SNET      OREQ 'PP'
     C           SNET      OREQ 'MP'
     C           SNCP      IFNE *ZEROS
     C                     Z-ADDSNCF      FACTOR     33
     C                     END
     C                     END
     C                     ELSE
     C                     SETON                     33
     C                     END
     C                     END
     C*
     C* Diary event record
     C*
     C           *IN02     IFEQ '1'
     C           SDSN      IFEQ DPSS
     C           SDET      IFEQ 'CP'
     C           SDET      OREQ 'IR'
     C           SDET      OREQ 'PP'
     C           SDET      OREQ 'MP'
     C           SDCP      IFNE *ZEROS
     C                     Z-ADDSDCP      FACTOR     33
     C                     END
     C                     END
     C                     ELSE
     C                     SETON                     33
     C                     END
     C                     END
     C*
     C                     END
     C                     END
     C*
     C* If not found, use current value from security
     C*
     C           FACTOR    IFEQ *ZEROS
     C                     Z-ADDCFCT      FACTOR
     C                     END
     C*
     C                     END
     C*
     C* Multiply amount to post by factor obtained
     C*
     C           AMPOST    MULT FACTOR    AMPOST
     C*
     C                     END
     C*                                                                   S01176
     C/COPY WNCPYSRC,SE2200C002
     C           AMPOST    IFNE *ZEROS                                    S01176
     C           5         SUB  NMDP      ZI      10                      S01176
     C                     ADD  CDP       ZI      10                      S01176
     C                     MULT POWER8,ZI AMPOST    H                     S01176
     C                     END                                            S01176
     C*
     C/COPY WNCPYSRC,SE2200C003
     C                     ENDSR
      *
      ***/EJECT*************************************************** S01176 S01271
      ************************************************************ S01176 S01271
      ***CLIENT*-*Subroutine*to*obtain*record*from*PF/CLINTSE.**** S01176 S01271
      ************************************************************ S01176 S01271
     C********** CLIENT    BEGSR                    *** CLIENT *** S01176 S01271
     C********** CLKEY     CHAINCLINTSEF             33            S01176 S01271
     C**N33***** RECI      COMP '*'                      33        S01176 S01271
     C********** *IN33     IFEQ '1'                 ***************S01176 S01271
     C**********           MOVE '12'      DBASE     **DB ERROR 12**S01176 S01271
     C**********           MOVEL'CLINT'   DBFILE    ***************S01176 S01271
     C**********           MOVELCLKEY     DBKEY                    S01176 S01271
     C**********           WRITEHEADAU                             S01176 S01271
     C**********           WRITEERROR                              S01176 S01271
     C**********           WRITETRAILAU                            S01176 S01271
     C**********           SETON                     U7U8LR        S01176 S01271
     C**********           RETRN                                   S01176 S01271
     C**********           END                                     S01176 S01271
     C**********                                                   S01176 S01271
     C**********           ENDSR                                   S01176 S01271
     C**********                                                   S01176 S01271
     C***/EJECT                                                    S01176 S01271
     C**********           ENDSR                                   S01176 S01271
      *************************************************************S01176 S01271
      *************************************************************S01176 S01271
      /EJECT
      *****************************************************************
      *                                                               *
      *  CUSDPM - Subroutine to write out Customer Depot Movement     *
      *           records.                                            *
      *                                                               *
      *****************************************************************
      *
     C           CUSDPM    BEGSR                           *** CUSDPM ****
     C*
     C                     MOVE 'D'       RECI
     C***********          Z-ADDDPBC      CPBC                            S01117
     C                     MOVE DPBA      CPBA                            S01117
     C                     MOVE DPSS      CPSS
     C**********           Z-ADDDPBN      CCRT                                                CSD027
     C                     MOVE DPBN      CCRT                                                CSD027
     C                     MOVE DPMK      CMRT
     C                     MOVE DPRN      CDMR
     C                     Z-ADDDPNA      CMNA
     C           DRECI     IFEQ 'D'
     C                     MOVE ' '       CRIN
     C                     ELSE
     C                     MOVE 'Y'       CRIN
     C                     END
      *                                                                   CSE015
     C           WREV      IFEQ 'Y'                                       CSE015
     C           CSE015    ANDEQ'Y'                                       CSE015
     C                     MOVE 'Y'       CRIN                            CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C***********          Z-ADDMKTP      CPRC                            E21480
     C                     Z-ADDMKTP      ZPRCIN                          E21480
     C                     Z-ADDDPMD      ZFDATE                          E21480
     C                     Z-ADDDPNA      ZNOML  150                      E21480
     C*                                                                   E21480
     C*     Set up parameters for Australian Yields mod                   E21480
     C*                                                                   E21480
     C           STBS      IFEQ 'Y'                                       E21480
     C           SYBS      ANDEQ'AU'                                      E21480
     C                     Z-ADDDPMD      ZECD                            E21480
     C                     EXSR ZLCD                                      E21480
     C                     Z-ADDDPMD      ECD                             E21480
     C                     EXSR ZNCD                                      E21480
     C                     Z-ADDZZLCD     ZDCSDT                          E21480
     C                     Z-ADDDPMD      ZDCEDT                          E21480
     C                     Z-ADDZNOML     ZAMT                            E21480
     C*                                                                   S01117
     C**  Set the currency dec. places parameter for call to SR.ZACCR     S01117
     C*                                                                   S01117
     C                     Z-ADDCDP       ZCDP                            S01117
     C*                                                                   S01117
     C                     EXSR ZACCZ                                     E21480
     C                     Z-ADDDPMD      WRKD    50                      E21480
     C           ZDCINT    DIV  ZNOML     WRKPI                           E21480
     C*                                                                   S01117
     C**  Set the location parameter to blanks for call to SR.ZBKDT       S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   ZLOC                            S01117
     C*                                                                   S01117
     C                     EXSR ZYCE                                      E21480
     C*                                                                   E21480
     C*  IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST            E21480
     C*     TILL NCD AND IS NEGATIVE                                      E21480
     C*                                                                   E21480
     C           SCUMEX    IFEQ 'X'                                       E21480
     C                     Z-ADDZZLCD     ZDCSDT                          E21480
     C                     Z-ADDNCD       ZDCEDT                          E21480
     C                     EXSR ZACCZ                                     E21480
     C           ZDCINT    DIV  ZNOML     WKWPI  159                      E21480
     C           WRKPI     SUB  WKWPI     WRKPI                           E21480
     C                     END                                            E21480
     C                     ELSE                                           E21480
     C                     MOVE 'C'       SCUMEX  1                       E21480
     C                     Z-ADD0         WRKPI                           E21480
     C                     END                                            E21480
     C*                                                                   E21480
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2200CCP2                                           S01408
     C*                                                                   S01408
     C                     EXSR ZPRCI                                     E21480
      *                                                                                       CSE035
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE2200C012
     C                     Z-ADDZPRCOT    CPRC                            E21480
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C           XDPMV     ANDEQ'WI'                                                          CGL031
     C                     Z-ADDFSPP      CPFP                                                CGL031
     C                     ENDIF                                                              CGL031
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2200CCP3                                           S01408
     C*                                                                   S01408
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C                     MOVE XPTFR     PTFR                            S01486
     C                     Z-ADDXSPXR     SPXR                            103204
     C                     MOVE XSPMD     SPMD                            103204
     C                     ELSE                                           CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE XPTFR     PTFR                            CPB001
     C                     ENDIF                                          CPB001
     C                     END                                            S01486
      *                                                                   CSE017
     C                     MOVEL*BLANKS   CPIN                            CSE017
     C           CSE017    IFEQ 'Y'                                       CSE017
     C                     MOVE DPIN      CPIN                            CSE017
     C                     ENDIF                                          CSE017
      *                                                                   CSE017
     C                     WRITECDPMVDF
     C*
     C* Accumulate total of records added
     C*
     C                     ADD  1         CDPMTS
     C*
     C                     ENDSR
      *
      *****************************************************************
      ***/EJECT****************************************************S01176 S01271
      ************************************************************ S01176 S01271
      ***OTHDPM*-*Subroutine*to*write*out*Other*Settlement*Depot** S01176 S01271
      ************Movement*records.******************************* S01176 S01271
      ************************************************************ S01176 S01271
      **********                                                   S01176 S01271
     C***********OTHDPM****BEGSR*********************** OTHDPM *** S01176 S01271
     C**Record*ID************************************************  S01176 S01271
     C**********           MOVE 'D'       RECI                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Branch*Code*********************************************** S01176 S01271
     C**********           MOVE DPBC      BRCD                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Our*Depot************************************************* S01176 S01271
     C********** DPMV      IFEQ 'UO'                               S01176 S01271
     C********** DPMV      OREQ 'CO'                               S01176 S01271
     C**********           Z-ADDDPOD      OUDP                     S01176 S01271
     C**********           ELSE                                    S01176 S01271
     C**********           Z-ADDDPID      OUDP                     S01176 S01271
     C**********           END                                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Movement*Origin******************************************* S01176 S01271
     C**********           Z-ADD2         MOVO                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Security*Reference**************************************** S01176 S01271
     C**********           Z-ADD1         ZX      20               S01176 S01271
     C********** OUDP      LOKUPINA,ZX                   41        S01176 S01271
     C**N41*****           MOVE *BLANK    SCYR                     S01176 S01271
     C***41*****           MOVELSCA,ZX    SCYR                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Security*Shortname**************************************** S01176 S01271
     C**********           MOVELDPSS      SCSN                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Counterparty*Depot**************************************** S01176 S01271
     C********** DPMV      IFEQ 'CI'                               S01176 S01271
     C********** DPMV      OREQ 'CO'                               S01176 S01271
     C**********           Z-ADD*ZERO     CDTN                     S01176 S01271
     C**********           ELSE                                    S01176 S01271
     C********** DPMV      IFEQ 'UO'                               S01176 S01271
     C**********           Z-ADDDPID      CDTN                     S01176 S01271
     C**********           ELSE                                    S01176 S01271
     C**********           Z-ADDDPOD      CDTN                     S01176 S01271
     C**********           END                                     S01176 S01271
     C**********           END                                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Counterparty*Depot*Reference****************************** S01176 S01271
     C********** DPMV      IFEQ 'CI'                               S01176 S01271
     C********** DPMV      OREQ 'CO'                               S01176 S01271
     C**********           MOVE *BLANK    CDTR                     S01176 S01271
     C**********           ELSE                                    S01176 S01271
     C**********           Z-ADDOUDP      CLKEY   60               S01176 S01271
     C**********           EXSR CLIENT                             S01176 S01271
     C**********           Z-ADD1         ZX      20               S01176 S01271
     C********** CDTN      LOKUPTBA,ZX                   42        S01176 S01271
     C**N42*****           MOVE *BLANK    CDTR                     S01176 S01271
     C***42*****           MOVELSEA,ZX    CDTR                     S01176 S01271
     C**********           END                                     S01176 S01271
     C**********                                                   S01176 S01271
     C**For*Account*Of******************************************** S01176 S01271
     C********** DPMV      IFEQ 'CI'                               S01176 S01271
     C********** DPMV      OREQ 'CO'                               S01176 S01271
     C**********           MOVE *BLANK    TRKEY  12                S01176 S01271
     C**********           MOVEL'10'      TRKEY                    S01176 S01271
     C**********           MOVE DPBC      TRKEY                    S01176 S01271
     C********** TRKEY     CHAINTABLETRF             43            S01176 S01271
     C**N43***** RECI      COMP '*'                      43        S01176 S01271
     C********** *IN43     IFEQ '1'                 ***************S01176 S01271
     C**********           MOVE '13'      DBASE     **DB ERROR 13**S01176 S01271
     C**********           MOVEL'TABLE'   DBFILE    ***************S01176 S01271
     C**********           MOVELTRKEY     DBKEY                    S01176 S01271
     C**********           WRITEHEADAU                             S01176 S01271
     C**********           WRITEERROR                              S01176 S01271
     C**********           WRITETRAILAU                            S01176 S01271
     C**********           SETON                     U7U8LR        S01176 S01271
     C**********           RETRN                                   S01176 S01271
     C**********           END                                     S01176 S01271
     C**********           Z-ADDBICN      FAON                     S01176 S01271
     C**********           ELSE                                    S01176 S01271
     C**********           Z-ADDDPBN      FAON                     S01176 S01271
     C**********           END                                     S01176 S01271
     C**********                                                   S01176 S01271
     C**For*Account*Of*Reference********************************** S01176 S01271
     C********** DPMV      IFEQ 'UO'                               S01176 S01271
     C********** DPMV      OREQ 'UI'                               S01176 S01271
     C**********           Z-ADDOUDP      CLKEY                    S01176 S01271
     C**********           ELSE                                    S01176 S01271
     C**********           Z-ADDFAON      CLKEY                    S01176 S01271
     C**********           END                                     S01176 S01271
     C**********                                                   S01176 S01271
     C**********           EXSR CLIENT                             S01176 S01271
     C**********           Z-ADD1         ZX                       S01176 S01271
     C********** OUDP      LOKUPTBA,ZX                   42        S01176 S01271
     C**N42*****           MOVE *BLANK    FAOR                     S01176 S01271
     C***42*****           MOVELSEA,ZX    FAOR                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Trade*Reference******************************************* S01176 S01271
     C*********            MOVELDPRN      TDRF                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Nominal*************************************************** S01176 S01271
     C**********           Z-ADDDPNA      NOML                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Payment*Code********************************************** S01176 S01271
     C**********           MOVE *BLANK    PAYC                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Cash*Amount*********************************************** S01176 S01271
     C**********           Z-ADD*ZERO     CASA                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Value*Currency******************************************** S01176 S01271
     C**********           MOVE *BLANK    VCCY                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Action*Code*********************************************** S01176 S01271
     C********** DRECI     IFEQ 'D'                                S01176 S01271
     C***********          MOVE 'A'       ACTO                     S01176 E22963
     C**********           MOVE 'I'       ACTO                     E22963 S01271
     C**********           END                                     S01176 S01271
     C********** DRECI     IFEQ 'R'                                S01176 S01271
     C**********           MOVE 'C'       ACTO                     S01176 S01271
     C**********           END                                     S01176 S01271
     C**********                                                   S01176 S01271
     C**Write*record*to*PF/OTHSTD********************************* S01176 S01271
     C**********                                                   S01176 S01271
     C**RESTORE*BACK*THE*ORIGINAL*DEPOT*MOVEMENT*TYPE*CODES*FOR*THE E20488S01271
     C**OTHER*SETTLEMENT*FILE*(FOR*REPORT*SE0486)***************** E20488 S01271
     C**********                                                   S01176 S01271
     C**********           MOVE DPMV      SDPMV                    E20488 S01271
     C**********           MOVE XDPMV     DPMV                     E20488 S01271
     C**********           WRITEOTHSTDF                            S01176 S01271
     C**********           MOVE SDPMV     DPMV                     E20488 S01271
     C**********                                                   S01176 S01271
     C**********           ADD  1         OTHMTS                   S01176 S01271
     C**********                                                   S01176 S01271
     C**********           ENDSR                                   S01176 S01271
      **********                                                   S01176 S01271
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************
      *                                                               *
      *  REPO   - Subroutine to generate Keys and User Depot Movements*
      *           for each BL, BB, RP, PD, PL or RR record read.      *
      *                                                               *
      *****************************************************************
      *
     C           REPO      BEGSR                           **** REPO  ****
     C*
     C* Determine whether any processing required, setting on Ind. 35
     C*
     C                     SETOF                     3537
     C           DRECI     IFEQ 'D'
     C*
     C** Check Original Entry date against Run date
     C*
     C           XORED     IFEQ RUND
     C                     SETON                     35
     C                     END
     C*
     C** If Depot Movement is Bond Lending, Repo, or Pledged Deposit
     C*
     C           XDPMV     IFEQ 'BL'
     C           XDPMV     OREQ 'RP'
     C           XDPMV     OREQ 'PD'                                      S01176
     C*
     C* Check Movement Date against Date Next Working Day
     C*
     C                     TESTB'0'       TACI       33
     C           *IN33     IFEQ '1'
     C***********DPOD      ANDLEDNWD                                      E20601
     C           DPDO      ANDLEDNWD                                      E20601
     C                     SETON                     35
     C                     END
     C*
     C***********DPID      IFLE DNWD                                      E20601
     C           DPMD      IFLE DNWD                                      E20601
     C                     SETON                     35
     C                     END
     C*
     C                     ELSE
     C*
     C**  Other Depot Movements
     C**  Check Movement Date against Date Next Working Day
     C*
     C                     TESTB'0'       TACI       33
     C           *IN33     IFEQ '1'
     C***********DPID      ANDLEDNWD                                      E20601
     C           DPMD      ANDLEDNWD                                      E20601
     C                     SETON                     35
     C                     END
     C*
     C***********DPOD      IFLE DNWD                                      E20601
     C           DPDO      IFLE DNWD                                      E20601
     C                     SETON                     35
     C                     END
     C*
     C                     END
     C*
     C                     ELSE
     C*
     C** If Depot Movement is reversed
     C*
     C           DRECI     IFEQ 'R'
     C*
     C** Check Original Entry Date against Run Date
     C*
     C           XORED     IFEQ RUND
     C                     MOVE '*'       DRECI
     C                     SETON                     37
     C*
     C** Add 1 to No of Records Deleted
     C*
     C                     ADD  1         DMDEL
     C                     ELSE
     C*
     C                     SETON                     35
     C                     END
     C                     END
     C*
     C                     END
     C*
     C* Processing required
     C*
     C           *IN35     IFEQ '1'
     C*
     C* Write User depot movement for trade date basis if required
     C* (Need to check if it is not being done before)                    091814
     C*
     C                     SETOF                     36
     C                     TESTB'1'       TACI       35                   091814
     C           *IN35     IFEQ '1'                                       091814
     C           *IN35     OREQ '0'                                       091814
     C           DRECI     ANDEQ'R'                                       091814
     C*                                                                   091814
     C           DRECI     IFEQ 'D'
     C           XORED     ANDEQRUND
     C           *IN33     ANDEQ'1'                                       102542
     C                     SETON                     36
     C                     ELSE
     C           DRECI     IFEQ 'R'
     C           XORED     ANDLTRUND
     C                     SETON                     36
     C                     END
     C                     END
     C*                                                                   091814
     C                     END                                            091814
     C*
     C*    Movement records required to be written out
     C*
     C           *IN36     IFEQ '1'
     C           DPNA      ANDNE*ZEROS
     C**********           Z-ADDDPID      DDEP                                                CSD027
     C                     MOVE DPID      DDEP                                                CSD027
     C           DRECI     IFEQ 'R'
     C                     Z-ADDXORED     DADA
     C           XDPMV     IFEQ 'BL'                                      098249
     C           XDPMV     OREQ 'RP'                                      098249
     C           XDPMV     OREQ 'PD'                                      098249
     C           DPDO      IFLT DADA                                      098249
     C                     Z-ADDDPDO      DADA                            098249
     C                     END                                            098249
     C                     MOVE 'RO'      DPMV                            098249
     C                     ELSE                                           098249
     C           DPMD      IFLT DADA                                      098249
     C                     Z-ADDDPMD      DADA                            098249
     C                     END                                            098249
     C                     MOVE 'RI'      DPMV                            098249
     C                     END                                            098249
     C                     MOVE 'T'       DDBA                            098249
     C                     ELSE
     C           DRECI     IFEQ 'D'
     C                     Z-ADDRUND      DADA
     C           XDPMV     IFEQ 'BL'
     C           XDPMV     OREQ 'RP'
     C           XDPMV     OREQ 'PD'                                      S01176
     C           DPDO      IFLT DADA
     C                     Z-ADDDPDO      DADA
     C                     END
     C                     MOVE 'RO'      DPMV
     C***********          Z-ADDDPDO      VALD                     S01176 S01271
     C***********          MOVE 'D'       DERE                     S01176 S01271
     C                     ELSE
     C           DPMD      IFLT DADA
     C                     Z-ADDDPMD      DADA
     C                     END
     C                     MOVE 'RI'      DPMV
     C***********          Z-ADDDPMD      VALD                     S01176 S01271
     C***********          MOVE 'R'       DERE                     S01176 S01271
     C                     END
     C                     MOVE 'T'       DDBA
     C                     END
     C*
     C                     END
     C                     EXSR USRDPM                                    E21118
     C***********          EXSR OTHDPM                      S01176 E21118 S01271
     C                     END
     C*
     C***********          EXSR USRDPM                                    E21118
     C***********          EXSR OTHDPM                             S01176 E21118
     C                     END
     C*
     C* Fetch 1st and 2nd movement date
     C*
     C           XDPMV     IFEQ 'BL'
     C           XDPMV     OREQ 'RP'
     C           XDPMV     OREQ 'PD'                                      S01176
     C                     Z-ADDDPDO      FIRSTD  50
     C                     Z-ADDDPMD      SECDAT  50
     C                     ELSE
     C                     Z-ADDDPMD      FIRSTD
     C                     Z-ADDDPDO      SECDAT
     C                     END
     C*
     C* Process 1st movement date if required
     C*
     C                     SETOF                     36
     C           DRECI     IFEQ 'D'
     C                     TESTB'0'       TACI       33
     C           *IN33     IFEQ '1'
     C           FIRSTD    ANDLEDNWD
     C                     SETON                     36
     C                     END
     C                     END
     C*
     C           DRECI     IFEQ 'R'
     C                     TESTB'0'       TACI           33
     C           *IN33     IFEQ '1'
     C                     SETON                     36
     C                     ELSE                                           098249
     C                     MOVE '*'       DRECI                           098249
     C                     ADD  1         DMDEL                           098249
     C                     SETON                     37                   098249
     C                     END
     C                     END
     C*
     C           *IN36     IFEQ '1'
     C*
     C* If 1st date not equal to Date Next Working Day
     C*
     C           FIRSTD    IFNE DNWD
     C*                                                                   099545
     C* If processing type not 2, 4 or 7                                  099545
     C*                                                                   099545
     C           PROT      IFNE '2'                                       099545
     C           PROT      ANDNE'4'                                       099545
     C           PROT      ANDNE'7'                                       099545
     C*
     C* Calculate amount to post
     C*
     C                     EXSR AMTPST
     C*
     C* If not zero, generate a/c key
     C*
     C           AMPOST    IFNE *ZEROS
     C                     MOVE *BLANKS   ACKY
     C*
     C* Fetch discretionary indicator for Beneficial customer
     C*
     C           DPBN      CHAINCLINTSEF             33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                        **           **S01117
     C***********          MOVE '09'      DBASE            **DB*ERROR*09**E20651
     C***********          MOVE '15'      DBASE     **DB*ERROR*15**E20651
     C                     Z-ADD15        DBASE            **DB ERROR 15**S01117
     C                     MOVEL'CLINT'   DBFILE           ***************
     C                     MOVELDPBN      DBKEY
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     SETON                     U7U8LR
     C                     DUMP                                           S01117
     C                     OUT  LDA                                       S01117
     C                     RETRN
     C                     END
     C           C1DI      IFEQ 'M'
     C                     MOVE *BLANKS   PFOIND
     C                     ELSE
     C           C1DI      IFEQ 'S'                                       100255
     C           C1DI      OREQ 'D'                                       100255
     C***********C1DI      OREQ 'K'                                100255 102132
     C                     MOVE C1DI      PFOIND
     C                     ELSE                                           100255
     C                     MOVE 'X'       PFOIND                          100255
     C                     END                                            100255
     C                     END
     C                     MOVE ' '       NEGIND
     C           XDPMV     IFEQ 'BL'
     C           XDPMV     OREQ 'BB'
     C           XDPMV     OREQ 'PL'                                      S01176
     C           XDPMV     OREQ 'PD'                                      E16932
     C                     MOVE XDPMV     AMTCOD
     C                     ELSE
     C           XDPMV     IFEQ 'RP'
     C***********XDPMV     OREQ 'PD'                                      E16932
     C                     MOVE 'RA'      AMTCOD
     C                     ELSE
     C                     MOVE 'RV'      AMTCOD
     C                     END
     C                     END
     C**********           Z-ADDDPBN      CSTN                                                CSD027
     C                     MOVE DPBN      CSTN                                                CSD027
     C                     Z-ADDFIRSTD    EVDT
     C                     Z-ADDAMPOST    EVAM
     C*                                                                   E20601
     C**FOR*'BL'*'RP'*'PD'*AND*FIRST*MOVEMENT*DATE,*USE*OUT*DEPOT*TOE20601E23561
     C**GENERATE*ACCOUNT*KEY.***************************************E20601E23561
     C*                                                                   E20601
     C***********XDPMV     IFEQ 'BL'                                E20601E23561
     C***********XDPMV     OREQ 'RP'                                E20601E23561
     C***********XDPMV     OREQ 'PD'                                E20601E23561
     C***********          Z-ADDDPOD      KCUST                     E20601E23561
     C***********          ELSE                                     E20601E23561
     C**********           Z-ADDDPID      KCUST                                               CSD027
     C                     MOVE DPID      KCUST                                               CSD027
     C***********          END                                      E20601E23561
     C                     EXSR ACKEY
     C*                                                                   102542
     C* Update A/C posted indicator                                       102542
     C*** (This need to be done even A/C key is not being generated)      102494
     C*                                                                   102542
     C********** PROT      IFNE '2'                                102542 102494
     C********** PROT      ANDNE'4'                                102542 102494
     C********** PROT      ANDNE'7'                                102542 102494
     C**********           BITON'0'       TACI                     102542 102494
     C**********           END                                     102542 102494
     C                     END
      *                                                                   CSE006
      *** If REPO'S switchable feature is on call new subroutine to       CSE006
      *** generate new account keys.                                      CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C                     EXSR NWKEY                                     CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     END                                            099545
     C*                                                                   102494
     C                     BITON'0'       TACI                            102542
     C*                                                                   102494
     C***********          END                                            098249
     C***********                                                         097790
     C**Write*User*depot*movement**                                       097790
     C***********                                                         097790
     C***********          Z-ADDDPID      DDEP                            097790
     C***********          Z-ADDFIRSTD    DADA                            097790
     C***********XDPMV     IFEQ 'BL'                                      097790
     C***********XDPMV     OREQ 'RP'                                      097790
     C***********XDPMV     OREQ 'PD'                                S01176097790
     C***********          MOVE 'RO'      DPMV                            097790
     C***********          ELSE                                           097790
     C***********          MOVE 'RI'      DPMV                            097790
     C***********          END                                            097790
     C***********          MOVE 'V'       DDBA                            097790
     C***********          EXSR USRDPM                                    097790
     C*
     C* Update depot movement record
     C*
     C***********PROT      IFNE '2'                                       102542
     C***********PROT      ANDNE'4'                                       102542
     C***********PROT      ANDNE'7'                                       102542
     C**********           BITON'0'       TACI                            049869
     C           XDPMV     IFEQ 'BL'                                      049869
     C           XDPMV     OREQ 'RP'                                      049869
     C           XDPMV     OREQ 'PD'                                      049869
     C           DPDO      IFGE RUND                                      049869
     C           DPDO      ANDLTDNWD                                      049869
     C           DPDO      ORLT XORED                                     049869
     C                     BITON'0'       TACI                            049869
     C                     END                                            049869
     C                     ELSE                                           049869
     C           DPMD      IFGE RUND                                      049869
     C           DPMD      ANDLTDNWD                                      049869
     C           DPMD      ORLT XORED                                     049869
     C                     BITON'0'       TACI                            049869
     C                     END                                            049869
     C                     END                                            049869
      *                                                                   049869
     C***********          END                                            102542
     C           DRECI     IFEQ 'R'
     C                     MOVE '*'       DRECI
     C                     ADD  1         DMDEL
     C                     END
     C**********           UPDATDPTMVDF
     C                     SETON                     37
     C*
     C                     END                                            098247
     C*                                                                   097790
     C* Write User depot movement                                         097790
     C*                                                                   097790
     C**********           Z-ADDDPID      DDEP                                         097790 CSD027
     C                     MOVE DPID      DDEP                                                CSD027
     C                     Z-ADDFIRSTD    DADA                            097790
     C           XDPMV     IFEQ 'BL'                                      097790
     C           XDPMV     OREQ 'RP'                                      097790
     C           XDPMV     OREQ 'PD'                                      097790
     C                     MOVE 'RO'      DPMV                            097790
     C                     ELSE                                           097790
     C                     MOVE 'RI'      DPMV                            097790
     C                     END                                            097790
     C                     MOVE 'V'       DDBA                            097790
     C                     EXSR USRDPM                                    097790
     C*                                                                   097790
     C                     END
     C*
     C* Process 2nd movement date if required
     C*
     C                     SETOF                     36
     C           DRECI     IFEQ 'D'
     C                     TESTB'1'       TACI       33
     C           *IN33     IFEQ '1'
     C           SECDAT    ANDLEDNWD
     C                     SETON                     36
     C                     END
     C                     END
     C*
     C           *IN36     IFEQ '1'
     C*
     C* If 2nd date not equal to DNWD
     C*
     C           SECDAT    IFNE DNWD
     C*
     C* If processing type not 2, 4 or 7
     C*
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C*
     C* Calculate amount to post
     C*
     C                     EXSR AMTPST
     C*
     C* If not zero, generate a/c key
     C*
     C           AMPOST    IFNE *ZEROS
     C                     MOVE *BLANKS   ACKY
     C*                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           COAF      ANDEQ'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           COAF      ANDEQ'Y'                                       CEU017
     C*                                                                   CSE007
     C           WWTYPE    CHAINSECOATL0             33                   CSE007
     C*                                                                   CSE007
     C           *IN33     IFEQ '1'                                       CSE007
     C           *LOCK     IN   LDA                        ***************CSE007
     C                     Z-ADD20        DBASE            **DB ERROR 20**CSE007
     C                     MOVEL'SECOATL0'DBFILE           ***************CSE007
     C                     MOVELWWTYPE    DBKEY                           CSE007
     C                     WRITEHEADAU                                    CSE007
     C                     WRITEERROR                                     CSE007
     C                     SETON                     U7U8LR               CSE007
     C                     OUT  LDA                                       CSE007
     C                     DUMP                                           CSE007
     C                     RETRN                                          CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C* INCLUDE TRADE SUB-TYPE IN CORPORATE ACTION KEY                    CSE007
     C*                                                                   CSE007
     C           BVCOTA    IFEQ 'Y'                                       CSE007
     C                     MOVE MMTSUB    SUBTYP                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVE *BLANKS   SUBTYP                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C*
     C* Fetch discretionary indicator for Beneficial customer
     C*
     C           DPBN      CHAINCLINTSEF             33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                        **           **S01117
     C***********          MOVE '10'      DBASE            **DB*ERROR*10**S01117
     C                     Z-ADD10        DBASE            **DB ERROR 10**S01117
     C                     MOVEL'INVTP'   DBFILE           ***************
     C                     MOVELDPBN      DBKEY
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     SETON                     U7U8LR
     C                     DUMP                                           S01117
     C                     OUT  LDA                                       S01117
     C                     RETRN
     C                     END
     C           C1DI      IFEQ 'M'
     C                     MOVE *BLANKS   PFOIND
     C                     ELSE
     C           C1DI      IFEQ 'S'                                       100255
     C           C1DI      OREQ 'D'                                       100255
     C***********C1DI      OREQ 'K'                                100255 102132
     C                     MOVE C1DI      PFOIND
     C                     ELSE                                           100255
     C                     MOVE 'X'       PFOIND                          100255
     C                     END                                            100255
     C                     END
     C                     MOVE 'N'       NEGIND
     C           XDPMV     IFEQ 'BL'
     C           XDPMV     OREQ 'BB'
     C                     MOVE XDPMV     AMTCOD
     C                     ELSE
     C           XDPMV     IFEQ 'RP'
     C           XDPMV     OREQ 'PD'                                      S01176
     C                     MOVE 'RA'      AMTCOD
     C                     ELSE
     C                     MOVE 'RV'      AMTCOD
     C                     END
     C                     END
     C**********           Z-ADDDPBN      CSTN                                                CSD027
     C                     MOVE DPBN      CSTN                                                CSD027
     C                     Z-ADDSECDAT    EVDT
     C                     Z-ADDAMPOST    EVAM
     C*                                                                   E20601
     C**FOR*'BL'*'RP'*'PD'*AND*SECOND*MOVEMENT*DATE,*USE*IN*DEPOT*TOE20601E23561
     C**GENERATE*ACCOUNT*KEY.***************************************E20601E23561
     C**************************************************************E20601E23561
     C***********XDPMV     IFEQ 'BL'                                E20601E23561
     C***********XDPMV     OREQ 'RP'                                E20601E23561
     C***********XDPMV     OREQ 'PD'                                E20601E23561
     C**********           Z-ADDDPID      KCUST                                               CSD027
     C                     MOVE DPID      KCUST                                               CSD027
     C***********          ELSE                                     E20601E23561
     C***********          Z-ADDDPOD      KCUST                     E20601E23561
     C***********          END                                      E20601E23561
     C                     EXSR ACKEY
     C                     END
      *                                                                   CSE006
      *** If REPO'S switchable feature is on call new subroutine to       CSE006
      *** generate new account keys and fee amount.                       CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C                     EXSR NWKEY                                     CSE006
     C                     EXSR FEAMT                                     CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     END
     C*
     C* Update depot movement record
     C*
     C***********PROT      IFNE '2'                                       102494
     C***********PROT      ANDNE'4'                                       102494
     C***********PROT      ANDNE'7'                                       102494
     C                     BITON'1'       TACI
     C***********          END                                            102494
     C           DRECI     IFNE '*'
     C**********           MOVE '*'       DRECI                           E14839
     C                     MOVE 'S'       DRECI                           E14839
     C**********           ADD  1         DMDEL                           E14839
     C                     END
     C**********           UPDATDPTMVDF
     C                     SETON                     37
     C                     END
     C*
     C* Write User depot movement
     C*
     C**********           Z-ADDDPID      DDEP                                                CSD027
     C                     MOVE DPID      DDEP                                                CSD027
     C                     Z-ADDSECDAT    DADA
     C           XDPMV     IFEQ 'BL'
     C           XDPMV     OREQ 'RP'
     C           XDPMV     OREQ 'PD'                                      S01176
     C                     MOVE 'RI'      DPMV
     C***********          Z-ADDDPMD      VALD                     S01176 S01271
     C***********          MOVE 'R'       DERE                     S01176 S01271
     C                     ELSE
     C                     MOVE 'RO'      DPMV
     C***********          Z-ADDDPDO      VALD                     S01176 S01271
     C***********          MOVE 'D'       DERE                     S01176 S01271
     C                     END
     C***********          MOVE 'A'       DDBA                            E14961
     C                     MOVE 'B'       DDBA                            E14961
     C                     EXSR USRDPM
     C***********          EXSR OTHDPM                             S01176 S01271
     C*
     C                     END
     C*
     C   37                UPDATDPTMVDF
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  USRDPM - Subroutine to write out User Depot Movement records.*
      *                                                               *
      *****************************************************************
      *
     C           USRDPM    BEGSR                           *** USRDPM  ***
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE DPMK      DMRT
     C                     MOVE DPRN      DMRF
     C                     Z-ADDDPNA      DMNA
     C           DRECI     IFEQ 'D'
     C           DRECI     OREQ 'S'                                       E25293
     C                     MOVE ' '       DRIN
     C                     ELSE
     C                     MOVE 'Y'       DRIN
     C                     END
     C                     WRITEUDPMVDF
     C*
     C* Accumulate total of records added
     C*
     C                     ADD  1         UDPMTS
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  USRTFR - Subroutine to generate Keys and User Depot Movements*
      *           for each 'DT' record read.                          *
      *                                                               *
      *****************************************************************
      *
     C           USRTFR    BEGSR                           *** USRTFR  ***
     C*
     C* If processing type not 2,4 or 7
     C* AND POST NO DEPOT MOVEMENTS FIELD NOT = 'Y'                       E19032
     C*
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C           PNDM      ANDNE'Y'                                       E19032
     C*
     C* and In date is on or before Event control date
     C*
     C           DPMD      ANDLEECD
     C/COPY WNCPYSRC,SE2200C010
     C*
     C* Calculate amount to post
     C*
     C                     EXSR AMTPST
     C*
     C* If amount is not zero, write out two account keys
     C*
     C           AMPOST    IFNE *ZEROS
     C*
     C* Set common fields
     C*
     C                     MOVE *BLANKS   ACKY
     C                     MOVE 'FV'      AMTCOD
     C                     Z-ADDDPMD      EVDT
     C**********           Z-ADD*ZEROS    KCUST                                               CSD027
     C                     MOVE *BLANKS   KCUST                                               CSD027
     C***********5         SUB  NMDP      ZI      10                E13817S01176
     C***********          ADD  CDP       ZI      10                E13817S01176
     C***********          MULT POWER8,ZI AMPOST    H               E13817S01176
     C*
     C* 'Out' depot a/c key
     C*
     C**********           Z-ADDDPOD      CSTN                                                CSD027
     C**********           Z-ADDDPOD      KCUST                                        049901 CSD027
     C                     MOVE DPOD      CSTN                                                CSD027
     C                     MOVE DPOD      KCUST                                               CSD027
     C                     Z-SUBAMPOST    EVAM
     C                     EXSR ACKEY
     C*
     C* 'In' depot a/c key
     C*
     C**********           Z-ADDDPID      CSTN                                                CSD027
     C**********           Z-ADDDPID      KCUST                                        049901 CSD027
     C                     MOVE DPID      CSTN                                                CSD027
     C                     MOVE DPID      KCUST                                               CSD027
     C                     Z-ADDAMPOST    EVAM
     C                     EXSR ACKEY
     C*
     C                     END
     C                     END
     C*
     C* Write User Depot movements for Trade date basis if required
     C*
     C                     SETOF                     36
     C           DRECI     IFEQ 'D'
     C           XORED     ANDEQRUND
     C                     SETON                     36
     C                     ELSE
     C           DRECI     IFEQ 'R'
     C           XORED     ANDLTRUND
     C                     SETON                     36
     C                     END
     C                     END
     C*
     C           *IN36     IFEQ '1'
     C           DPNA      ANDNE*ZEROS
     C*
     C* Set common fields
     C*
     C                     MOVE 'T'       DDBA
     C           DRECI     IFEQ 'R'
     C                     Z-ADDXORED     DADA
     C                     ELSE
     C           DRECI     IFEQ 'D'
     C                     Z-ADDRUND      DADA
     C           DPMD      IFLT DADA
     C                     Z-ADDDPMD      DADA
     C                     END
     C                     END
     C                     END
     C*
     C* Write record for transfer out
     C*
     C                     MOVE 'UO'      DPMV
     C**********           Z-ADDDPOD      DDEP                                                CSD027
     C                     MOVE DPOD      DDEP                                                CSD027
     C                     EXSR USRDPM
     C**************       Z-ADDDPMD      VALD                     S01176 S01271
     C**************       MOVE 'D'       DERE                     S01176 S01271
     C**************       EXSR OTHDPM                             S01176 S01271
     C*
     C* Write record for transfer out
     C*
     C                     MOVE 'UI'      DPMV
     C**********           Z-ADDDPID      DDEP                                                CSD027
     C                     MOVE DPID      DDEP                                                CSD027
     C                     EXSR USRDPM
     C**************       MOVE 'R'       DERE                     S01176 S01271
     C**************       EXSR OTHDPM                             S01176 S01271
     C*
     C                     BITON'1'       TACI                            091814
     C                     END
     C*
     C* Write User Depot movements for Value date basis if required
     C*
     C           DRECI     IFEQ 'D'
     C           DPMD      ANDLEDNWD
     C           DPNA      ANDNE*ZEROS
     C*
     C* Set common fields
     C*
     C                     MOVE 'C'       DDBA
     C                     Z-ADDDPMD      DADA
     C*
     C* for transfer out
     C*
     C                     MOVE 'UO'      DPMV
     C**********           Z-ADDDPOD      DDEP                                                CSD027
     C                     MOVE DPOD      DDEP                                                CSD027
     C                     EXSR USRDPM
     C*
     C* for transfer in
     C*
     C                     MOVE 'UI'      DPMV
     C**********           Z-ADDDPID      DDEP                                                CSD027
     C                     MOVE DPID      DDEP                                                CSD027
     C                     EXSR USRDPM
     C*
     C                     END
     C*
     C* Update Depot movement
     C*
     C           DPMD      IFLE ECD
     C***********PROT      ANDNE'2'                                       E14548
     C***********PROT      ANDNE'4'                                       E14548
     C***********PROT      ANDNE'7'                                       E14548
     C                     BITON'0'       TACI
     C           DRECI     IFNE '*'
     C**********           MOVE '*'       DRECI                           E14839
     C                     MOVE 'S'       DRECI                           E14839
     C**********           ADD  1         DMDEL                           E14839
     C                     END
     C*
     C                     END                                            E13792
     C*
     C                     UPDATDPTMVDF
     C*
     C**********           END                                            E13792
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  WALKIO - Subroutine to generate Keys and Customer Depot      *
      *           Movements for each 'WI' or 'WO' record read.        *
      *                                                               *
      *****************************************************************
      *
     C           WALKIO    BEGSR                           *** WALKIO  ***
     C*
     C* Ignore if record id is 'R'
     C*
     C           DRECI     IFNE 'R'
      *                                                                                      211786
      ** Consider WI/WO if value date = DNWD (only for position                              211786
      ** not for accounting + include trade date posit. & accounting)                        211786
      ** Bit 2 'ON' or ind.46 means trade date A/KEY already processed                       211786
      *                                                                                      211786
     C           XDPMV     ANDEQ'WO'                                      186560
     C********** DPDO      ANDLEECD                                                   186560 211786
     C           DPDO      ANDLEDNWD                                                         211786
     C           DRECI     ORNE 'R'                                       186560
     C           XDPMV     ANDEQ'WI'                                      186560
     C********** DPMD      ANDLEECD                                                   186560 211786
     C           DPMD      ANDLEDNWD                                                         211786
     C           DRECI     ORNE 'R'                                                          211786
     C           DMTD      ANDLEECD                                                          211786
      *                                                                   CSE015
     C           CSE015    IFEQ 'Y'                                       CSE015
     C           DPMD      IFEQ *ZEROS                                    CSE015
     C                     Z-ADDDPDO      WDEPDT  50                      CSE015
     C                     ELSE                                           CSE015
     C                     Z-ADDDPMD      WDEPDT                          CSE015
     C                     ENDIF                                          CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C                     TESTB'2'       TACI       46                   CSE015
      *                                                                   CSE015
      ** If Last change type is 'A', reverse account keys                 CSE015
      *                                                                   CSE015
     C           CSE015    IFEQ 'Y'                                       CSE015
     C           XCHTP     ANDEQ'A'                                       CSE015
     C************IN46     ANDEQ*OFF                               CSE015 175842
     C           *IN46     ANDEQ*ON                                       175842
     C           XORED     ANDNEXLCD                                      175842
      *                                                                   CSE015
     C                     MOVELDPRN      WDPRN   6                       CSE015
     C                     MOVELDPSS      WDPSS  10                       CSE015
      *                                                                   CSE015
      ** Access LF/SOBDMVD to get the start of day information            CSE015
      *                                                                   CSE015
     C           KDEPOT    CHAINSOBDMVDF             44                   CSE015
     C           *IN44     IFEQ *OFF                                      CSE015
     C           SORECI    COMP '*'                      44               CSE015
     C                     ENDIF                                          CSE015
     C           *IN44     IFEQ *ON                                       CSE015
     C           *LOCK     IN   LDA                                       CSE015
     C                     Z-ADD23        DBASE                           CSE015
     C                     MOVEL'SOBDMVD' DBFILE                          CSE015
     C                     MOVELDPRN      DBKEY                           CSE015
     C                     WRITEHEADAU                                    CSE015
     C                     WRITEERROR                                     CSE015
     C                     MOVE *ON       *INU7                           CSE015
     C                     MOVE *ON       *INU8                           CSE015
     C                     MOVE *ON       *INLR                           CSE015
     C                     DUMP                                           CSE015
     C                     OUT  LDA                                       CSE015
     C                     RETRN                                          CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
      ** If TACI Bit 2 is On (SOBDMVD file), generate a reversal          CSE015
      ** trade date account key and reversal Customer Depot               CSE015
      ** Movement record                                                  CSE015
      *                                                                   CSE015
     C                     TESTB'2'       SOTACI         45               CSE015
     C           *IN45     IFEQ *ON                                       CSE015
     C           SOBDM     ANDNEDEPOT                                     CSE015
      *                                                                   CSE015
     C                     MOVE 'Y'       WREV    1                       CSE015
      *                                                                   CSE015
      ** Move fields from Start of Business file to working               CSE015
      ** fields in SR/ACKEY and SR/CUSDPM (SR/MOVFLD)                     CSE015
      *                                                                   CSE015
     C                     EXSR MOVFLD                                    CSE015
      *                                                                   CSE015
      ** Generate reversal entries (SR/GENENT)                            CSE015
      *                                                                   CSE015
     C                     EXSR GENENT                                    CSE015
      *                                                                   CSE015
     C                     MOVE *BLANKS   WREV                            CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C                     ENDIF                                          CSE015
     C/COPY WNCPYSRC,SE2200C004
     C*
     C* If processing type is NE 2, 4 or 7, generate account key
     C*
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C/COPY WNCPYSRC,SE2200C005
     C*
     C* Calculate amount to post
     C*
     C                     EXSR AMTPST
     C*
     C* If amount is not zero
     C*
     C           AMPOST    IFNE *ZEROS
     C*
     C* Write out account key
     C*
     C                     MOVE *BLANKS   ACKY
     C*
     C* Fetch discretionary indicator for Beneficial customer
     C*
     C           DPBN      CHAINCLINTSEF             33
     C  N33      RECI      COMP '*'                      33
     C           *IN33     IFEQ '1'                        ***************
     C           *LOCK     IN   LDA                        **           **S01117
     C***********          MOVE '11'      DBASE            **DB*ERROR*11**S01117
     C                     Z-ADD11        DBASE            **DB ERROR 11**S01117
     C***********          MOVEL'INVTP'   DBFILE           ***************
     C                     MOVEL'CLINT'   DBFILE           ***************E18988
     C                     MOVELDPBN      DBKEY
     C                     WRITEHEADAU
     C                     WRITEERROR
     C***********          WRITETRAILAU                                   E29170
     C                     SETON                     U7U8LR
     C                     DUMP                                           S01117
     C                     OUT  LDA                                       S01117
     C                     RETRN
     C                     END
     C           C1DI      IFEQ 'M'
     C                     MOVE *BLANKS   PFOIND
     C                     ELSE
     C           C1DI      IFEQ 'S'                                       100255
     C           C1DI      OREQ 'D'                                       100255
     C***********C1DI      OREQ 'K'                                100255 102132
     C                     MOVE C1DI      PFOIND
     C                     ELSE                                           100255
     C                     MOVE 'X'       PFOIND                          100255
     C                     END                                            100255
     C                     END
     C                     MOVE ' '       NEGIND
     C                     MOVE 'FV'      AMTCOD
     C**********           Z-ADDDPBN      CSTN                                                CSD027
     C                     MOVE DPBN      CSTN                                                CSD027
     C           XDPMV     IFEQ 'WI'
     C                     Z-ADDDPMD      EVDT
     C                     Z-ADDAMPOST    EVAM
     C**********           Z-ADDDPID      KCUST                                               CSD027
     C                     MOVE DPID      KCUST                                               CSD027
     C                     ELSE
     C                     Z-ADDDPDO      EVDT
     C                     Z-SUBAMPOST    EVAM
     C**********           Z-ADDDPOD      KCUST                                               CSD027
     C                     MOVE DPOD      KCUST                                               CSD027
     C                     END
      *                                                                   CSE015
      ** If CSE015 is installed, generate Trade date account key          CSE015
      *                                                                   CSE015
     C           CSE015    IFEQ 'Y'                                       CSE015
      *                                                                   CSE015
      ** If accounting Indicator (TACI) is off, process only              CSE015
      ** if RECI is 'D' or 'R'                                            CSE015
      *                                                                   CSE015
     C                     TESTB'2'       TACI       46                   CSE015
     C           *IN46     IFEQ *ON                                       CSE015
     C           DRECI     ANDEQ'D'                                       CSE015
      *                                                                   CSE015
      ** If Trade Date is equal to Event Control Date                     CSE015
      *                                                                   CSE015
     C***********DMTD      IFLE ECD                                CSE015 178376
     C           DMTD      IFLT DNWD                                      178376
     C                     Z-ADDDMTD      EVDT                            CSE015
     C                     MOVE 'T'       EVTDAT                          CSE015
     C                     EXSR ACKEY                                     CSE015
     C                     MOVE *BLANKS   EVTDAT                          CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C***********          BITON'2'       TACI                     CSE015 175720
      *                                                                   CSE015
     C                     ENDIF                                          CSE015
     C                     ENDIF                                          CSE015
     C*
     C*  ONLY POST ACCOUNT KEY IF POST NO DEPOT MOVEMENT = 'N'            E19032
     C*
     C           PNDM      IFEQ 'N'                                       E19032
     C           BGPFMG    OREQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
      *                                                                   CSE015
      ** If CSE015 is installed, generate value date account key if       CSE015
      ** Depot Movement Date is equal to or less than Event control       CSE015
      ** date                                                             CSE015
      *                                                                   CSE015
     C           CSE015    IFEQ 'N'                                       CSE015
     C           CSE015    OREQ 'Y'                                       CSE015
     C***********WDEPDT    ANDLEECD                                CSE015 178376
     C           WDEPDT    ANDLTDNWD                                      178376
     C                     EXSR ACKEY
     C                     ENDIF                                          CSE015
     C                     END                                            E19032
     C*
     C                     END
     C/COPY WNCPYSRC,SE2200C006
     C                     END
     C/COPY WNCPYSRC,SE2200C007
      *                                                                   S01445
      *** Generate Charge account key if Autocharges and S01445 are ON,   S01445
      *** AND charge amount of the depot movement is not zero.  Note that S01445
      *** Charge Account keys are generated regardless of value of PNDM   S01445
      *** and Processing Type.                                            S01445
      *                                                                   S01445
     C           AUMO      IFEQ 'Y'                                       S01445
     C           S01445    ANDEQ'Y'                                       S01445
     C           DCHA      ANDNE*ZERO                                     S01445
     C/COPY WNCPYSRC,SE2200C008
     C                     EXSR CHGKEY                                    S01445
     C                     END                                            S01445
      *                                                                   S01408
     C/COPY WNCPYSRC,SE2200CCP7                                           S01408
      *                                                                   S01408
     C*
     C* Write Customer depot movement - if nominal amount not zero
     C*
     C           DPNA      IFNE *ZEROS
     C           XDPMV     IFEQ 'WI'
     C**********           Z-ADDDPID      CDEP                                                CSD027
     C                     MOVE DPID      CDEP                                                CSD027
     C                     Z-ADDDPMD      CADA
     C                     MOVE 'CI'      CPMV
     C***********          MOVE 'CI'      DPMV                     S01176 S01271
     C***********          Z-ADDDPMD      VALD                     S01176 S01271
     C***********          MOVE 'R'       DERE                     S01176 S01271
     C                     ELSE
     C**********           Z-ADDDPOD      CDEP                                                CSD027
     C                     MOVE DPOD      CDEP                                                CSD027
     C                     Z-ADDDPDO      CADA
     C                     MOVE 'CO'      CPMV
     C************         MOVE 'CO'      DPMV                     S01176 S01271
     C************         Z-ADDDPDO      VALD                     S01176 S01271
     C************         MOVE 'D'       DERE                     S01176 S01271
     C                     END
      *                                                                   CSE015
      ** If CSE015 is installed and Depot Movement Date is equal          CSE015
      ** to Event Control Date, the generate a Customer Depot             CSE015
      ** Movement record with CDBA = 'C'                                  CSE015
      *                                                                   CSE015
     C           CSE015    IFEQ 'Y'                                       CSE015
     C           DRECI     IFEQ 'D'                                       CSE015
     C***********WDEPDT    IFLE ECD                                CSE015 178376
      *                                                                                      211786
      ** Consider WI/WO if value date = DNWD (only for position                              211786
      ** not for accounting)                                                                 211786
      *                                                                                      211786
     C********** WDEPDT    IFLT DNWD                                                  178376 211786
     C********** WDEPDT    IFLE DNWD                                                   211786 243410
     C           WDEPDT    IFLT DNWD                                                          243410
     C                     MOVE 'C'       CDBA                            CSE015
     C                     EXSR CUSDPM                                    CSE015
     C                     ENDIF                                          CSE015
     C                     ENDIF                                          CSE015
     C                     ELSE                                           CSE015
     C                     MOVE 'A'       CDBA
     C                     EXSR CUSDPM
     C************         EXSR OTHDPM                             S01176 S01271
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
      ** If CSE015 is installed and Trade Date is equal to                CSE015
      ** Event Control Date, generate a Customer Depot                    CSE015
      ** movement record with CDBA = 'T'                                  CSE015
      *                                                                   CSE015
     C           CSE015    IFEQ 'Y'                                       CSE015
     C********** *IN46     ANDEQ*ON                                                   CSE015 211786
     C***********DMTD      ANDLEECD                                CSE015 178376
     C********** DMTD      ANDLTDNWD                                                  178376 211786
      *                                                                                       243410
      ** Trade Date cannot be greater than rundate. Therefore,                                243410
      ** the condition (DMTD <= DNWD) is wrong.                                               243410
      *                                                                                       243410
     C********** DMTD      ANDLEDNWD                                                   211786 243410
     C           DMTD      ANDLTDNWD                                                          243410
     C           *IN46     ANDEQ*ON                                                           243410
     C                     MOVE 'T'       CDBA                            CSE015
     C                     Z-ADDDMTD      CADA                            CSE015
     C                     EXSR CUSDPM                                    CSE015
     C                     ENDIF                                          CSE015
     C                     END
     C*
     C* Update Depot movement
     C*
     C***********PROT      IFNE '2'                                       E14548
     C***********PROT      ANDNE'4'                                       E14548
     C***********PROT      ANDNE'7'                                       E14548
      *                                                                                      211786
      ** Consider WI/WO if value date = DNWD (only for position not                          211786
      ** for accounting)                                                                     211786
      *                                                                                      211786
     C           CSE015    IFEQ 'Y'                                                          211786
     C           WDEPDT    ANDLTDNWD                                                         211786
     C                     BITON'0'       TACI
     C                     ENDIF                                                             211786
     C           DMTD      IFLT DNWD                                                         221801
     C                     BITON'2'       TACI                            175720
     C                     ENDIF                                                             221801
     C/COPY WNCPYSRC,SE2200C014
     C           DRECI     IFNE '*'
      *                                                                   CSE015
      ** RECI = 'S' if value date is less than or equal to Event          CSE015
      ** Control Date                                                     CSE015
      *                                                                   CSE015
     C           CSE015    IFEQ 'N'                                       CSE015
     C           CSE015    OREQ 'Y'                                       CSE015
     C***********WDEPDT    ANDLEECD                                CSE015 178376
     C           WDEPDT    ANDLTDNWD                                      178376
     C**********           MOVE '*'       DRECI                           E14839
     C                     MOVE 'S'       DRECI                           E14839
     C**********           ADD  1         DMDEL                           E14839
     C                     ENDIF                                          CSE015
     C                     END
     C/COPY WNCPYSRC,SE2200C015
     C*
     C***********          END                                            E14548
      *                                                                                       207006
     C           CSE029    IFEQ 'Y'                                                           207006
     C                     MOVE BVCOTC    CPTY                                                207006
     C                     MOVE SMCC      MRKT                                                207006
     C                     ENDIF                                                              207006
     C*
     C                     UPDATDPTMVDF
     C*
     C**********           END                                            E13792
      *                                                                   CSE015
      ** If CSE015 is installed and RECI is equal to 'R'                  CSE015
      ** or if CSE018 is installed.                                       CSE018
      *                                                                   CSE015
     C                     ELSE                                           CSE015
     C           CSE015    IFEQ 'Y'                                       CSE015
     C           DRECI     ANDEQ'R'                                       CSE015
     C           XCHTP     ANDEQ'D'                                       CSE015
     C           XORED     ANDNERUND                                                          219624
     C*                                                                   CSE018
     C           CSE018    OREQ 'Y'                                       CSE018
     C           DRECI     ANDEQ'R'                                       CSE018
     C           XCHTP     ANDEQ'D'                                       CSE018
     C           XORED     ANDNERUND                                                          219624
      *                                                                   CSE015
     C                     MOVELDPRN      WDPRN   6                       CSE015
     C                     MOVELDPSS      WDPSS  10                       CSE015
      *                                                                   CSE015
      ** Access LF/SOBDMVD to get the start of day information            CSE015
      ** Only if CSE015 is installed                                      CSE018
      *                                                                   CSE015
     C           CSE015    IFEQ 'Y'                                       CSE018
     C*                                                                   CSE018
     C           KDEPOT    CHAINSOBDMVDF             44                   CSE015
     C           *IN44     IFEQ *OFF                                      CSE015
     C           SORECI    COMP '*'                      44               CSE015
     C                     ENDIF                                          CSE015
     C           *IN44     IFEQ *ON                                       CSE015
     C           *LOCK     IN   LDA                                       CSE015
     C                     Z-ADD24        DBASE                           CSE015
     C                     MOVEL'SOBDMVD' DBFILE                          CSE015
     C                     MOVELDPRN      DBKEY                           CSE015
     C                     WRITEHEADAU                                    CSE015
     C                     WRITEERROR                                     CSE015
     C                     MOVE *ON       *INU7                           CSE015
     C                     MOVE *ON       *INU8                           CSE015
     C                     MOVE *ON       *INLR                           CSE015
     C                     DUMP                                           CSE015
     C                     OUT  LDA                                       CSE015
     C                     RETRN                                          CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
      ** Checking for bit 2 is not necessary as the movement date         CSE018
      ** will be used in SR GENENT to generate reversal.                  CSE018
     C***If*TACI*Bit*2*is*On*(SOBDMVD*file),*generate*a*reversal***CSE015 CSE018
     C***trade*date*account*key*and*reversal*Customer*Depot********CSE015 CSE018
     C***Movement*record*******************************************CSE015 CSE018
     C************                                                 CSE015 CSE018
     C************         TESTB'2'       SOTACI         45        CSE015 CSE018
     C                     ENDIF                                          CSE018
     C*                                                                   CSE018
     C************IN45     IFEQ *ON                                CSE015 CSE018
      *                                                                   CSE015
      ** Move fields from Start of Business file to working               CSE015
      ** fields in SR/ACKEY and SR/CUSDPM (SR/MOVFLD)                     CSE015
      ** Only if CSE015 is Installed.                                     CSE018
      *                                                                   CSE015
     C           CSE015    IFEQ 'Y'                                       CSE018
     C                     EXSR MOVFLD                                    CSE015
     C                     ENDIF                                          CSE018
      *                                                                   CSE015
      ** Generate reversal entries (SR/GENENT)                            CSE015
      *                                                                   CSE015
     C                     EXSR GENENT                                    CSE015
      *                                                                   CSE015
     C                     BITON'0'       TACI                            CSE015
     C                     BITON'2'       TACI                            175720
     C                     MOVE '*'       DRECI                           CSE015
      *                                                                                       207006
     C           CSE029    IFEQ 'Y'                                                           207006
     C                     MOVE BVCOTC    CPTY                                                207006
     C                     MOVE SMCC      MRKT                                                207006
     C                     ENDIF                                                              207006
      *                                                                   CSE015
     C                     UPDATDPTMVDF                                   CSE015
     C***********          ENDIF                                   CSE015 CSE018
     C                     ENDIF                                          CSE015
     C*
     C                     END
     C*
     C                     ENDSR
      *
     C*****************************************************************
      /EJECT                                                              CSE015
      *****************************************************************   CSE015
      *                                                               *   CSE015
      *  GENENT        Subroutine to generate reversal entries for    *   CSE015
      *                SR/ACKEY and SR/CUSDPM                         *   CSE015
      *                                                               *   CSE015
      *  Called by:    WALKIO                                         *   CSE015
      *                                                               *   CSE015
      *  Calls:        ACKEY                                          *   CSE015
      *                CUSDPM                                         *   CSE015
      *                                                               *   CSE015
      *****************************************************************   CSE015
     C           GENENT    BEGSR                                          CSE015
      *                                                                   CSE015
     C           SODPMD    IFEQ *ZEROS                                    CSE015
     C                     Z-ADDSODPDO    WODPDT  50                      CSE015
     C                     ELSE                                           CSE015
     C                     Z-ADDSODPMD    WODPDT                          CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
      ** If processing type is NE 2, 4 or 7, generate account key         CSE015
      *                                                                   CSE015
     C           PROT      IFNE '2'                                       CSE015
     C           PROT      ANDNE'4'                                       CSE015
     C           PROT      ANDNE'7'                                       CSE015
      *                                                                   CSE015
      ** Calculate amount to post                                         CSE015
      *                                                                   CSE015
     C                     EXSR AMTPST                                    CSE015
      *                                                                   CSE015
      ** If amount is not zero                                            CSE015
      *                                                                   CSE015
     C           AMPOST    IFNE *ZEROS                                    CSE015
      *                                                                   CSE015
      ** Write out account key                                            CSE015
      *                                                                   CSE015
     C                     MOVE *BLANKS   ACKY                            CSE015
      *                                                                   CSE015
      ** Fetch discretionary indicator for Beneficial customer            CSE015
      *                                                                   CSE015
     C           DPBN      CHAINCLINTSEF             33                   CSE015
     C           *IN33     IFEQ *OFF                                      CSE015
     C           RECI      COMP '*'                      33               CSE015
     C                     ENDIF                                          CSE015
     C           *IN33     IFEQ '1'                        ***            CSE015
     C           *LOCK     IN   LDA                                       CSE015
     C                     Z-ADD25        DBASE                           CSE015
     C                     MOVEL'CLINT'   DBFILE                          CSE015
     C                     MOVELDPBN      DBKEY                           CSE015
     C                     WRITEHEADAU                                    CSE015
     C                     WRITEERROR                                     CSE015
     C                     SETON                     U7U8LR               CSE015
     C                     DUMP                                           CSE015
     C                     OUT  LDA                                       CSE015
     C                     RETRN                                          CSE015
     C                     END                                            CSE015
     C           C1DI      IFEQ 'M'                                       CSE015
     C                     MOVE *BLANKS   PFOIND                          CSE015
     C                     ELSE                                           CSE015
     C           C1DI      IFEQ 'S'                                       CSE015
     C           C1DI      OREQ 'D'                                       CSE015
     C                     MOVE C1DI      PFOIND                          CSE015
     C                     ELSE                                           CSE015
     C                     MOVE 'X'       PFOIND                          CSE015
     C                     END                                            CSE015
     C                     END                                            CSE015
     C                     MOVE ' '       NEGIND                          CSE015
     C                     MOVE 'FV'      AMTCOD                          CSE015
     C**********           Z-ADDDPBN      CSTN                                         CSE015 CSD027
     C                     MOVE DPBN      CSTN                                                CSD027
     C           XDPMV     IFEQ 'WI'                                      CSE015
     C                     Z-ADDDPMD      EVDT                            CSE015
     C                     Z-ADDAMPOST    EVAM                            CSE015
     C**********           Z-ADDDPID      KCUST                                        CSE015 CSD027
     C                     MOVE DPID      KCUST                                               CSD027
     C                     ELSE                                           CSE015
     C                     Z-ADDDPDO      EVDT                            CSE015
     C                     Z-SUBAMPOST    EVAM                            CSE015
     C**********           Z-ADDDPOD      KCUST                                        CSE015 CSD027
     C                     MOVE DPOD      KCUST                                               CSD027
     C                     END                                            CSE015
     C*                                                                   CSE018
     C** Output reversal A/C key for value date if movement date          CSE018
     C** is less then RUND.                                               CSE018
     C*                                                                   CSE018
     C           EVDT      IFLT RUND                                      CSE018
     C                     EXSR ACKEY                                     CSE018
     C                     ENDIF                                          CSE018
      *                                                                   CSE015
      ** If Trade Date is equal to Event Control Date, reverse            CSE015
      ** the trade date account key                                       CSE015
      ** Only if CSE015 is present.                                       CSE018
      *                                                                   CSE015
     C***********DMTD      IFLE ECD                                CSE015 178376
     C           DMTD      IFLT RUND                                      178376
     C           CSE015    ANDEQ'Y'                                       CSE018
     C                     Z-ADDDMTD      EVDT                            CSE015
     C                     MOVE 'T'       EVTDAT                          CSE015
     C                     EXSR ACKEY                                     CSE015
     C                     MOVE *BLANKS   EVTDAT                          CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C                     END                                            CSE015
     C                     END                                            CSE015
      *                                                                   CSE015
     C           XDPMV     IFEQ 'WI'                                      CSE015
     C**********           Z-ADDDPID      CDEP                                         CSE015 CSD027
     C                     MOVE DPID      CDEP                                                CSD027
     C                     Z-ADDDPMD      CADA                            CSE015
     C                     MOVE 'CI'      CPMV                            CSE015
     C                     ELSE                                           CSE015
     C**********           Z-ADDDPOD      CDEP                                         CSE015 CSD027
     C                     MOVE DPOD      CDEP                                                CSD027
     C                     Z-ADDDPDO      CADA                            CSE015
     C                     MOVE 'CO'      CPMV                            CSE015
     C                     END                                            CSE015
      *                                                                   CSE015
      ** Reversal for Value Date Customer Depot Movement entry            CSE015
      *                                                                   CSE015
     C           DPNA      IFNE *ZEROS                                    CSE015
     C***********WODPDT    ANDLEECD                                CSE015 178376
     C           WODPDT    ANDLTRUND                                      178376
     C           CSE015    IFEQ 'Y'                                       CSE018
     C           DMTD      ANDNE0                                         179686
     C                     MOVE 'C'       CDBA                            CSE015
     C                     ELSE                                           CSE018
     C                     MOVE 'A'       CDBA                            CSE018
     C                     END                                            CSE018
     C                     EXSR CUSDPM                                    CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
      ** Reversal of Trade Date Customer Depot Movement Record            CSE015
      *                                                                   CSE015
     C           DPNA      IFNE *ZEROS                                    CSE015
     C***********DMTD      ANDLEECD                                CSE015 178376
     C           DMTD      ANDLTRUND                                      178376
     C           DMTD      ANDNE0                                         CSE018
     C           CSE015    ANDEQ'Y'                                       CSE018
     C                     MOVE 'T'       CDBA                            CSE015
     C                     Z-ADDDMTD      CADA                            CSE015
     C                     EXSR CUSDPM                                    CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
      ** Chain to LF/DPTMVR                                               CSE015
      *                                                                   CSE015
     C           WDPRN     CHAINDPTMVRF              47                   CSE015
     C           *IN47     IFEQ *ON                                       CSE015
     C           DPSS      ORNE WDPSS                                     CSE015
     C           *LOCK     IN   LDA                                       CSE015
     C                     Z-ADD26        DBASE                           CSE015
     C                     MOVEL'DPTMVR'  DBFILE                          CSE015
     C                     MOVELWDPRN     DBKEY                           CSE015
     C                     WRITEHEADAU                                    CSE015
     C                     WRITEERROR                                     CSE015
     C                     SETON                     U7U8LR               CSE015
     C                     DUMP                                           CSE015
     C                     OUT  LDA                                       CSE015
     C                     RETRN                                          CSE015
     C                     ENDIF                                          CSE015
      *                                                                   CSE015
     C                     ENDSR                                          CSE015
      *****************************************************************   CSE015
      /EJECT                                                              CSE015
      *****************************************************************   CSE015
      *                                                               *   CSE015
      *  MOVFLD        Move fields from the Start of Business file    *   CSE015
      *                to working fields for SR/GENENT                *   CSE015
      *                                                               *   CSE015
      *  Called by:    WALKIO                                         *   CSE015
      *                                                               *   CSE015
      *  Calls:        NONE                                           *   CSE015
      *                                                               *   CSE015
      *****************************************************************   CSE015
     C           MOVFLD    BEGSR                                          CSE015
      *                                                                   CSE015
     C                     MOVELSODPRN    DPRN                            CSE015
     C                     MOVELSODPBA    DPBA                            CSE015
     C                     MOVELSODPSS    DPSS                            CSE015
     C                     MOVELSODPPC    DPPC                            CSE015
     C                     MOVELSOPTFR    XPTFR                           CSE015
     C                     MOVELSODPMV    XDPMV                           CSE015
     C                     MOVELSODPMK    DPMK                            CSE015
     C**********           Z-ADDSODPBN    DPBN                                         CSE015 CSD027
     C                     MOVE SODPBN    DPBN                                                CSD027
     C                     Z-ADDSODPNA    DPNA                            CSE015
     C                     Z-ADDSOMKTP    MKTP                            CSE015
     C                     Z-ADDSODPMD    DPMD                            CSE015
     C                     Z-ADDSOSPXR    XSPXR                           CSE015
     C                     MOVELSOSPMD    XSPMD                           CSE015
     C                     MOVELSODPIN    DPIN                            CSE015
     C                     Z-ADDSOCYLD    CYLD                            CSE015
     C                     Z-ADDSOTNLU    TNLU                            CSE015
     C                     Z-ADDSODMTD    DMTD                            CSE015
     C**********           Z-ADDSODPID    DPID                                         243410 CPK027
     C**********           Z-ADDSODPOD    DPOD                                         243410 CPK027
     C                     MOVELSODPID    DPID                                                CPK027
     C                     MOVELSODPOD    DPOD                                                CPK027
     C                     Z-ADDSODPDO    DPDO                                                243410
      *                                                                   CSE015
     C                     ENDSR                                          CSE015
      *****************************************************************   CSE015
      /EJECT                                                              S01445
      *****************************************************************   S01445
      *                                                               *   S01445
      *  CHGKEY        Create Depot Charge Account Key Record         *   S01445
      *                                                               *   S01445
      *  CALLED BY:    WALKIO                                         *   S01445
      *  CALLS:        NONE                                           *   S01445
      *                                                               *   S01445
      *****************************************************************   S01445
      *                                                                   S01445
     C           CHGKEY    BEGSR                                          S01445
      *                                                                   S01445
      *** Clear key before setting new a/c key fields                     S01445
      *                                                                   S01445
     C                     MOVE *BLANKS   ACKY                            S01445
      *                                                                   S01445
     C           XDPMV     IFEQ 'WI'                       *B1            S01445
     C                     Z-ADDDPMD      EVDT                            S01445
     C**********           Z-ADDDPID      KCUST                                        S01445 CSD027
     C                     MOVE DPID      KCUST                                               CSD027
     C                     ELSE                            *X1            S01445
     C                     Z-ADDDPDO      EVDT                            S01445
     C**********           Z-ADDDPOD      KCUST                                        S01445 CSD027
     C                     MOVE DPOD      KCUST                                               CSD027
     C                     END                             *E1            S01445
      *                                                                   S01445
     C           S01446    IFEQ 'Y'                        *B1            S01446
     C           BGN0ST    OREQ 'Y'                                       CAC002
      *                                                                   S01446
     C                     CALL 'AOCHGTR0'                                S01446
     C                     PARM *BLANKS   @RTCD                           S01446
     C                     PARM '*KEY'    @OPTN                           S01446
     C                     PARM DCCE      @CCY    3                       S01446
     C                     PARM DCHC      @CCOM   2                       S01446
     C           SECGT     PARM SECGT     DSSDY                           S01446
      *                                                                   S01446
     C           @RTCD     IFNE *BLANK                     *B2            S01446
     C           *LOCK     IN   LDA                        ***************S01446
     C                     Z-ADD16        DBASE            **DB ERROR 16**S01446
     C                     MOVEL'SECGT'   DBFILE           ***************S01446
     C                     MOVEL@CCY      DBKEY                           S01446
     C                     MOVE @CCOM     DBKEY                           S01446
     C                     WRITEHEADAU                                    S01446
     C                     WRITEERROR                                     S01446
     C                     SETON                     U7U8LR               S01446
     C                     DUMP                                           S01446
     C                     OUT  LDA                                       S01446
     C                     RETRN                                          S01446
      *                                                                   S01446
     C                     ELSE                            *X2            S01446
      *                                                                   CAC002
     C           S01446    IFEQ 'Y'                                       CAC002
     C                     MOVE GCCO      CHGCOD                          S01446
     C                     ELSE                                           CAC002
     C                     MOVE DCHC      CHGCOD                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      ** If Analytical Accounting is installed, define a Profit Centre.   CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
     C           S01446    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
      ** Access charges codes file for Group charge code.                 CAC002
      *                                                                   CAC002
     C                     CALL 'AOCHGTR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY'    @OPTN                           CAC002
     C                     PARM DCCE      @CCY                            CAC002
     C                     PARM GCCO      @CCOM                           CAC002
     C           SECGT     PARM SECGT     DSSDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANK                                    CAC002
     C           *LOCK     IN   LDA                        ************   CAC002
     C                     Z-ADD19        DBASE            * DBERR 19 *   CAC002
     C                     MOVEL'SECGT'   DBFILE           ************   CAC002
     C                     MOVEL@CCY      DBKEY                           CAC002
     C                     MOVE @CCOM     DBKEY                           CAC002
     C                     OUT  LDA                                       CAC002
     C                     WRITEHEADAU                                    CAC002
     C                     WRITEERROR                                     CAC002
     C                     SETON                     U7U8LR               CAC002
     C                     DUMP                                           CAC002
     C                     RETRN                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C           BOTR      IFEQ 'T'                                       CAC002
     C           BOTR      OREQ 'B'                                       CAC002
     C                     MOVE DPPC      PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE SPRFC     PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     END                             *E2            S01446
     C                     ELSE                            *X1            S01446
      *                                                                   S01446
     C                     MOVE DCHC      CHGCOD                          S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
     C           DRECI     IFEQ 'D'                        *B1            S01445
     C                     MOVE '0'       RVRS                            S01445
     C                     ELSE                            *X1            S01445
     C                     MOVE '1'       RVRS                            S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
     C           CIAK      IFEQ 'Y'                        *B1            S01445
     C           SCVI      ANDEQ'Y'                                       S01445
     C                     MOVE 'Y'       CONVRT                          S01445
     C                     ELSE                            *X1            S01445
     C                     MOVE *BLANKS   CONVRT                          S01445
     C                     END                             *E1            S01445
      *                                                                   S01445
      *** Setup all other fields on account key                           S01445
      *                                                                   S01445
     C                     MOVE 'D'       RECI                            S01445
      *** Setup AKEY                                                      S01445
     C                     MOVE SITP      INVTYP                          S01445
     C                     MOVE 'L'       EVTCOD                          S01445
     C           C1DI      IFEQ 'S'                                       100255
     C           C1DI      OREQ 'D'                                       100255
     C***********C1DI      OREQ 'K'                                100255 102132
     C***********C1DI      OREQ 'M'                                100255 102132
     C                     MOVE C1DI      PFOIND                          S01445
     C                     ELSE                                           100255
     C           C1DI      IFEQ 'M'                                       102132
     C                     MOVE ' '       PFOIND                          102132
     C                     ELSE                                           102132
     C                     MOVE 'X'       PFOIND                          100255
     C                     END                                            102132
     C                     END                                            100255
     C                     MOVE DPBK      BOOKCD                          S01445
     C                     MOVE DPMK      MARKET                          S01445
     C                     MOVE *BLANKS   NEGIND                          S01445
     C                     MOVE 'FR'      AMTCOD                          S01445
      *                                                                   S01445
     C                     MOVE DPRN      TRFR                            S01445
     C           CSE006    IFEQ 'Y'                                       CSE006
     C           DFROM     ANDNE' '                                       CSE006
     C                     MOVE DPAD      TRFR                            CSE006
     C                     END                                            CSE006
     C                     MOVE DPBN      CSTN                            S01445
     C                     MOVE DPBA      BRHA                            S01445
     C                     Z-ADD*ZERO     ASQN                            S01445
     C/COPY WNCPYSRC,SE2200C016
     C                     MOVE DCHA      EVAM                            S01445
     C                     MOVE DCCE      EVCY                            S01445
     C                     MOVE DCSE      STLT                            S01445
     C                     MOVE DCAT      STLA                            S01445
     C                     MOVE DCAB      SEBR                            S01445
     C**********           Z-ADD*ZERO     ISSR                                         S01445 CSD027
     C                     MOVE *BLANKS   ISSR                                                CSD027
     C                     Z-ADD*ZERO     KNCA                            S01445
     C                     MOVE NMCY      KCCY                            S01445
     C                     Z-ADD*ZERO     KBCA                            S01445
     C                     MOVE DPSS      SESH                            S01445
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'N'                                       CAC002
     C                     MOVE DPPC      PRFC                            S01445
     C                     ENDIF                                          CAC002
     C*                                                                   053103
     C*          BGPFMG    IFEQ 'Y'                                       053103
     C                     MOVE XDPMV     PEV1                            053103
     C*                    END                                            053103
      *                                                                                       CGL020
      ** If Midas Compliance Watch (CGL020) is installed                                      CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                   S01445
     C/COPY WNCPYSRC,SE2200C013
     C                     WRITESEKEYDF                                   S01445
      *                                                                   S01445
      *** Keep total for audit record                                     S01445
      *                                                                   S01445
     C                     ADD  1         ACKEYS                          S01445
      *                                                                   S01445
      *** Fetch and keep hash totals for audit record                     S01445
      *                                                                   S01445
     C                     Z-ADDEVAM      ZZAMT                           S01445
     C                     Z-ADD1         S                               S01445
     C                     Z-ADD1         Z                               S01445
     C                     EXSR ZHASH                                     S01445
     C                     Z-ADDINT,S     HSHINT                          S01445
     C                     Z-ADDDEC,S     HSHDEC                          S01445
      *                                                                   S01445
     C/COPY WNCPYSRC,SE2200C009
     C                     ENDSR                                          S01445
      *                                                                   S01445
     C*****************************************************************   S01445
      /EJECT                                                              CSE006
      *****************************************************************   CSE006
      *                                                               *   CSE006
      *  NWKEY     Setup new A/C for Repo                             *   CSE006
      *                                                               *   CSE006
      *  CALLED BY:    REPO                                           *   CSE006
      *  CALLS:        ZPRCI                                          *   CSE006
      *                ZCNSD                                          *   CSE006
      *                ACKEY                                          *   CSE006
      *                                                               *   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           NWKEY     BEGSR                           *** NWKEY ***  CSE006
      *                                                                   CSE006
      *** Calculate price of the security                                 CSE006
      *                                                                   CSE006
     C                     Z-ADDMKTP      ZPRCIN                          CSE006
     C                     Z-ADDDPMD      ZFDATE                          CSE006
     C                     Z-ADDDPMD      ZFDATE                          CSE006
     C                     Z-ADDDPNA      ZNOML  150                      CSE006
     C                     EXSR ZPRCI                                     CSE006
     C                     MOVE ZPRCOT    SEPRIC 158                      CSE006
      *                                                                   CSE006
      *** Using calculated security price find the consideration          CSE006
      *                                                                   CSE006
     C                     Z-ADDZPRCOT    ZPRC                            CSE006
     C                     Z-ADDCDP       ZCDP                            CSE006
     C                     EXSR ZCNSD                                     CSE006
     C                     Z-ADDZCONS     XCONS  150                      CSE006
      *                                                                   CSE006
      *** Put event amount equal to the consideration                     CSE006
      *                                                                   CSE006
     C                     Z-ADDZCONS     EVAM                            CSE006
      *                                                                   CSE006
      *** Use SEcurity details from CLINTSE to set up classification      CSE006
      *                                                                   CSE006
     C           C1DI      IFEQ 'M'                                       CSE006
     C                     MOVE *BLANKS   PFOIND                          CSE006
     C                     ELSE                                           CSE006
     C           C1DI      IFEQ 'S'                                       CSE006
     C           C1DI      OREQ 'D'                                       CSE006
     C                     MOVE C1DI      PFOIND                          CSE006
     C                     ELSE                                           CSE006
     C                     MOVE 'X'       PFOIND                          CSE006
     C                     ENDIF                                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Depot Movement type used to set up a/c key field, AMTCOD        CSE006
      *                                                                   CSE006
     C           XDPMV     IFEQ 'RR'                                      CSE006
     C                     MOVE 'RC'      AMTCOD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           XDPMV     IFEQ 'RP'                                      CSE006
     C                     MOVE 'PC'      AMTCOD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           XDPMV     IFEQ 'BL'                                      CSE006
     C                     MOVE 'LC'      AMTCOD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           XDPMV     IFEQ 'BB'                                      CSE006
     C                     MOVE 'BC'      AMTCOD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           XDPMV     IFEQ 'PL'                                      CSE006
     C                     MOVE 'CL'      AMTCOD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           XDPMV     IFEQ 'PD'                                      CSE006
     C                     MOVE 'CD'      AMTCOD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Generate A/C Keys                                               CSE006
      *                                                                   CSE006
     C                     EXSR ACKEY                                     CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *                                                                   CSE006
      *****************************************************************   CSE006
      /EJECT                                                              CSE006
      *****************************************************************   CSE006
      *                                                               *   CSE006
      *  FEAMT     Generate A/C Keys - Depot Movement                 *   CSE006
      *                                                               *   CSE006
      *  CALLED BY:    REPO                                           *   CSE006
      *  CALLS:        ACKEY                                          *   CSE006
      *                                                               *   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           FEAMT     BEGSR                           *** FEAMT ***  CSE006
      *                                                                   CSE006
      *** Only generate fee amount if Charge amount and movement type     CSE006
      *** are relevant                                                    CSE006
      *                                                                   CSE006
     C           DCHA      IFNE 0                                         CSE006
     C           XDPMV     IFEQ 'BL'                                      CSE006
     C           XDPMV     OREQ 'BB'                                      CSE006
      *                                                                   CSE006
      *** Set up A/C key fields                                           CSE006
      *                                                                   CSE006
     C           XDPMV     IFEQ 'BL'                                      CSE006
     C                     MOVE 'FR'      AMTCOD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           XDPMV     IFEQ 'BB'                                      CSE006
     C                     MOVE 'FP'      AMTCOD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     Z-ADDDCHA      EVAM                            CSE006
     C                     MOVE DCCE      EVCY                            CSE006
      *                                                                   CSE006
     C                     EXSR ACKEY                                     CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *                                                                   CSE006
      *****************************************************************   CSE006
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      * SRAMPR - Determine AML Pay/Receive Instructions               *                       CGL020
      *                                                               *                       CGL020
      * Called by: ACKEY, CHGKEY                                      *                       CGL020
      *                                                               *                       CGL020
      * Calls: ZAAMLSETSE                                             *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
      *                                                                                       CGL020
     C           SRAMPR    BEGSR                           ** SRAMPR **                       CGL020
      *                                                                                       CGL020
      ** If account key is Pay Charges or Receive Charges                                     CGL020
      *                                                                                       CGL020
     C           AMTCOD    IFEQ 'FR'                                                          CGL020
     C           AMTCOD    OREQ 'FP'                                                          CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDDCHA      F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE *BLANKS   F1FFLG                                              CGL020
     C                     Z-ADD0         F1FVAL                                              CGL020
     C                     Z-ADD0         F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      ** Check settlement account field                                                       CGL020
      *                                                                                       CGL020
     C           STLA      IFEQ *BLANKS                                                       CGL020
     C                     MOVE *BLANKS   F1RACT                                              CGL020
     C                     MOVE *BLANKS   F1RCTY                                              CGL020
     C                     MOVE *BLANKS   F1RBNK                                              CGL020
     C                     MOVE *BLANKS   F1RCDE                                              CGL020
     C                     MOVE *BLANKS   F1PACT                                              CGL020
     C                     MOVE *BLANKS   F1PCTY                                              CGL020
     C                     MOVE *BLANKS   F1PBNK                                              CGL020
     C                     MOVE *BLANKS   F1PCDE                                              CGL020
     C                     MOVE *BLANKS   F1DACT                                              CGL020
     C                     MOVE *BLANKS   F1DCTY                                              CGL020
     C                     MOVE *BLANKS   F1DBNK                                              CGL020
     C                     Z-ADD*ZEROS    F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
      *                                                                                       CGL020
     C           DPTMY2    KLIST                                                              CGL020
     C                     KFLD           DPSS                                                CGL020
     C                     KFLD           DPRN                                                CGL020
     C                     KFLD           WWHEN   1                                           CGL020
      *                                                                                       CGL020
      ** Check is record exist on Depot Movement Ext Settlement File                          CGL020
      *                                                                                       CGL020
     C                     MOVE 'S'       WWHEN                                               CGL020
     C           DPTMY2    CHAINDPTMVDY2             32                                       CGL020
      *                                                                                       CGL020
      ** If record found, setup new fields                                                    CGL020
      *                                                                                       CGL020
     C           *IN32     IFEQ '0'                                                           CGL020
     C                     MOVE D2IPYN    PINTG                                               CGL020
     C                     MOVE D2IPYL    PINTGA                                              CGL020
     C                     MOVE D2AWIN    PINST                                               CGL020
     C                     MOVE D2AWIL    PINSTA                                              CGL020
     C                     MOVE D2BOFN    PBENM                                               CGL020
     C                     MOVE D2BOF1    PBENMA                                              CGL020
     C                     MOVELD2DIDN    PDEBT                                               CSW210
     C                     MOVELD2DLIN    PDEBTA                                              CSW210
     C                     ELSE                                                               CGL020
     C                     MOVE *BLANKS   PINTG                                               CGL020
     C                     MOVE *BLANKS   PINTGA                                              CGL020
     C                     MOVE *BLANKS   PINST                                               CGL020
     C                     MOVE *BLANKS   PINSTA                                              CGL020
     C                     MOVE *BLANKS   PBENM                                               CGL020
     C                     MOVE *BLANKS   PBENMA                                              CGL020
     C                     MOVE *BLANKS   PDEBT                                               CSW210
     C                     MOVE *BLANKS   PDEBTA                                              CSW210
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      ** Call SE extract program                                                              CGL020
      *                                                                                       CGL020
     C                     CALL ZAAMLP                                                        CGL020
     C                     PARM           PINTG  10                                           CGL020
     C                     PARM           PINTGA 35                                           CGL020
     C                     PARM           PINST  10                                           CGL020
     C                     PARM           PINSTA 35                                           CGL020
     C                     PARM           PBENM  10                                           CGL020
     C                     PARM           PBENMA 35                                           CGL020
     C                     PARM           PDEBT  10                                           CSW210
     C                     PARM           PDEBTA 35                                           CSW210
     C                     PARM           DPBN                                                CGL020
     C                     PARM *BLANKS   PBLANK  8                                           CGL020
     C                     PARM           STLA                                                CGL020
     C                     PARM           SEBR                                                CGL020
     C                     PARM           EVCY                                                CGL020
     C                     PARM           F1RACT                                              CGL020
     C                     PARM           F1RCTY                                              CGL020
     C                     PARM           F1RBNK                                              CGL020
     C                     PARM           F1RCDE                                              CGL020
     C                     PARM           F1PACT                                              CGL020
     C                     PARM           F1PCTY                                              CGL020
     C                     PARM           F1PBNK                                              CGL020
     C                     PARM           F1PCDE                                              CGL020
     C                     PARM           F1DACT                                              CGL020
     C                     PARM           F1DCTY                                              CGL020
     C                     PARM           F1DBNK                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDEVDT      F1SDAT                                              CGL020
     C                     MOVE *BLANKS   F1TICK                                              CGL020
     C                     MOVE *BLANKS   F1EXCH                                              CGL020
     C                     MOVE *ZEROS    F1NOML                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *                                                                                       CGL020
      ********************************************************************                    CGL020
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C*****************************************************************
      /EJECT                                                              E21480
     C***********/COPY ZSRSRC,XDATE3Z1                             E21480 S01117
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZACCH                                                  S01117
      /EJECT                                                              S01117
     C/COPY ZSRSRC,ZBKDT                                                  S01117
      /EJECT                                                              S01117
     C/COPY ZSRSRC,ZACCRZ1                                                E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZACCZZ1                                                E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZDATE1Z2                                               E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZDATE2Z4                                               E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZDAYSZ2                                                E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZDYYRZ3                                                E21480
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
     C/COPY ZSRSRC,ZHASHZ3
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZLCDZ1                                                 E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZNCDZ3                                                 E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZPRCIZ1                                                E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZRATEZ1                                                E21480
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZYCEZ1                                                 E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZYLDIZ1                                                E21480
      /EJECT                                                              E21480
     C/COPY ZSRSRC,ZYLDZ2                                                 E21480
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCALCD                                                 E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCNSDZ1                                                E39495
     C/EJECT                                                              S01408
     C/COPY WNCPYSRC,SE2200CCP5                                           S01408
      ***
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
