     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Generate account keys (accruals)')            *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE2210 - GENERATE ACCOUNT KEYS - ACCRUALS                    *
     F*                                                               *
     F*  Function: This program reads the Book Position Actions files *
     F*   (COB)    for changes to positions today as well as changes  *
     F*            to previous positions on the Historic Book Position*
     F*                                                               *
     F*  Called by: SEC0605  - Generate A/c Keys - Book Positions     *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD033891           Date 07Jul15               *
      *  Prev Amend No. MD030796           Date 30Oct14               *
      *                 MD050604           Date 21Feb20               *
      *                 249688             Date 01Jul19               *
      *                 262293             Date 31May19               *
      *                 MD046248           Date 27Oct17               *
      *                 215959             Date 21Mar16               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 09Jul15               *
      *                 AR847937           Date 25Nov14               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CSE105             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 248351             Date 07Jun07               *
      *                 246619             Date 29Mar07               *
      *                 BUG13026           Date 12Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      *                 BUG8858            Date 28Jun06               *
      *                 CGL035             Date 01Mar05               *
      *                 CSE075             Date 17Nov05               *
      *                 233707             Date 27May05               *
      *                 230973             Date 13Dec04               *
      *                 CSE065             Date 08Nov04               *
      *                 CSE071             Date 19Jul05               *
      *                 229857             Date 07Oct04               *
      *                 228948             Date 27Sep04               *
      *                 226570             Date 27Jun04               *
      *                 228110             Date 07Jun04               *
      *                 226138             Date 12Apr04               *
      *                 225469             Date 26Mar04               *
      *                 CAS006             Date 21Jan03               *
      *                 211407             Date 07Jan03               *
      *                 194370             Date 12Jul01               *
      *                 199421             Date 25Jan02               *
      *                 207543             Date 17JUL02               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 CSE036             Date 22Apr02               *
      *                 CGL020             Date 12Dec02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 204134             Date 24Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 11Dec01               *
      *                 180707             Date 25Jul00               *
      *                 CSE032             Date 13Dec01               *
      *                 188515             Date 24Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 177707             Date 15Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 186983             Date 03Jan01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 174050             Date 10Apr00               *
     F*                 148124             Date 03May00               *
     F*                 140272             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 176392             Date 14Mar00               *
     F*                 CSE006             Date 24AUG99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 10Nov98               *
      *                 102506             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
     F*                 129696             Date 26Feb98               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 111157             DATE 05Feb97               *
     F*                 CAC002             Date 15Sep96               *
     F*                 S01408             DATE 14OCT96               *
     F*                 S01408             DATE 30SEP96               *
     F*                 091803             DATE 20AUG96               *
     F*                 084704             DATE 01AUG96               *
     F*                 083039             DATE 01AUG96               *
     F*                 059110             DATE 25JUL96               *
     F*                 088047             DATE 26JUN96               *
     F*                 100228             DATE 31MAY96               *
     F*                 099886             DATE 17APR96               *
     F*                 100017             DATE 17APR96               *
     F*                 099882             DATE 16APR96               *
     F*                 099885             DATE 16APR96               *
     F*                 CPM004             DATE 08FEB96               *
     F*                 S01408             DATE 10JAN96               *
     F*                 088778             DATE 25OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 086491             DATE 15JUN95               *
     F*                 S01502             DATE 02DEC94               *
     F*                 064575             DATE 15AUG94               *
     F*                 065301             DATE 05MAY94               *
     F*                 055893             DATE 02FEB93               *
     F*                 055427             DATE 19NOV93               *
     F*                 052254             DATE 19NOV93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 048414             DATE 01FEB93               *
     F*                 047922             DATE 01FEB93               *
     F*                 S01397             DATE 16SEP92               *
     F*                 E40425             DATE 18MAY92               *
     F*                 E37527             DATE 31MAR92               *
     F*                 E27163             DATE 17MAR92               *
     F*                 E23199             DATE 03DEC91               *
     F*                 E29170             DATE 06NOV91               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E29237             DATE 08OCT91               *
     F*                 E29236             DATE 08OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 29MAY91               *
     F*                 S01195             DATE 29MAY91               *
     F*                 SE1220             DATE 29MAY91               *
     F*                 E24428             DATE 24JAN91               *
     F*                 E23987             DATE 01NOV90               *
     F*                 S01269             DATE 01AUG90               *
     F*                 S01271             DATE 19JUN90               *
     F*                 E23738             DATE 28SEP90               *
     F*                 E22957             DATE 11AUG90               *
     F*                 E21528             DATE 11APR90               *
     F*                 E21608             DATE 02APR90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21304             DATE 06MAR90               *
     F*                 E21242             DATE 26FEB90               *
     F*                 E21232             DATE 26FEB90               *
     F*                 E21130             DATE 14FEB90               *
     F*                 E21097             DATE 08FEB90               *
     F*                 E20953             DATE 30JAN90               *
     F*                 S01232             DATE 13DEC89               *
     F*                 S01233             DATE 12DEC89               *
     F*                 E20552             DATE 10DEC89               *
     F*                 E20568             DATE 09DEC89               *
     F*                 E20380             DATE 23NOV89               *
     F*                 E19975             DATE 23NOV89               *
     F*                 E20085             DATE 08NOV89               *
     F*                 E20086             DATE 08NOV89               *
     F*                 E20087             DATE 08NOV89               *
     F*                 E19445             DATE 08NOV89               *
     F*                 E19444             DATE 08NOV89               *
     F*                 E20125             DATE 08NOV89               *
     F*                 E19915             DATE 25OCT89               *
     F*                 E18803             DATE 17AUG89               *
     F*                 E16772             DATE 19/06/89              *
     F*                 S01176             DATE 10/11/88              *
     F*                 E15965             DATE 31/10/88              *
     F*                 E14616             DATE 06/10/88              *
     F*                 E15442             DATE 30/09/88              *
     F*                 E15430             DATE 28/09/88              *
     F*                 E14235             DATE 23/09/88              *
     F*                 E14959             DATE 10/09/88              *
     F*                 E14680             DATE 08/09/88              *
     F*                 E13817             DATE 23/06/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD033891 - LAVP issue on Branch 900. Recompiled due to       *
      *             changes in /COPY ZYLDZ2.                          *
      *  MD030796 - Portuguese Upgrade - Discount/Premium Amortisation*
      *             on Trade Date not done when CSE032 on             *
      *             Formalised fix from PS.                           *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in /copy sources ZAVPRZ1*
      *             and ZCNSDZ1.                                      *
      *  249688 - Unrealized P/L postings incorrectly booked. When    *
      *           CAS006 is switched on, do not switch on *IN30.      *
      *           Reverse 248351 except for applied fixes.            *
      *           Applied for AR928731 (Child: AR928732)              *
      *         - Applied for MD053606.                               *
      *  262293 - Wrong LCPN in ZLCD when BCNV is NE ' ' or 'N' and   *
      *           Coupon date falls on a bank holiday, but not a      *
      *           holiday on the Nominal Currency. Do not recalculate *
      *           LCPN if from PF/SNDEVD. Applied fix for MD052461.   *
      *  MD046248 - Finastra Rebranding                               *
      *  215959 - Truncation error on event amount in SE2450P3.       *
      *           Recompiled due to changes in PF/SEKEYD.             *
      *         - Applied for MD-37439.                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR847937 - Incorrect UP/UL keys generated due to wrong STBS  *
      *             passed to the UP/UL calculation routine.          *
      *             (Child: AR847938)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CSE105 - Portuguese Upgrade - Discount/Premium Amortisation  *
      *           on Trade Date                                       *
     F*  248351 - Apply release 4 FOR-NYK fix 099883 to amend BUG8858 *
     F*           Upgrade - unrealized ac/keys produced with wrong    *
     F*           amounts due to ICD change and CAS006 wrong coding.  *
     F*           Apply also fix 103946                               *
     F*  099883 - For discount based securities, price should also    *
     F*           be calculated based on ECD.  (covers also 099391)   *
     F*  103946 - Mark to Market on the mortage repayment date, system*
     F*           unable to reverse out all the unrealised P/L.       *
      *  246619 - Need to keep track the previous nominal position    *
      *           for each record in PF/BKPOSD. Field PNOM will be    *
      *           used during reversal of negative a/c key of UL/UP.  *
      *  BUG8858 - Applied fix 217990.                                *
      *  BUG13026 - Add 'equal' condition between 'days-to-maturity'  *
      *             and 'days-to-amortise' to determine matured       *
      *             securities.                                       *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL035 - EUSD Upgrade to MidasPlus                           *
      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
      *  233707 - Use the average life date regardless of the mark to *
      *           market flag.                                        *
      *  230973 - If CSE032 is ON and constant yield amortisation is  *
      *           used, the resulting price should be the latest      *
      *           average price.                                      *
      *  CSE065 - Const. Yield Amort. on Mortgage backed assets       *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  228948 - Add 'Exclude Accrued Interest in Unrealized Profit  *
      *           or Loss'.                                           *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  228110 - No profit/loss posted for securities whose average  *
      *           price equals market price.  Applied fix to continue *
      *           processing of profit/loss if accrued interest to    *
      *           date is not zero.                                   *
      *  226138 - Allow amortisation of Schuldshein on a yield curve  *
      *           basis.                                              *
      *  225469 - Wrong computation of average price. For a previous  *
      *           average price of 100, if CSE032 is ON, last accrued *
      *           to date is zero, and ST Discount Amortise is 'C',   *
      *           the valuation date or the amortisation start date   *
      *           should be set to ACDT - 1.                          *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  199421 - Wrong LCPN in ZLCD when BCNV in NE ' ' and Coupon   *
      *           date falls on a holiday.  Partially applied 180904. *
      *           EXTRA CODE NOT INCLUDED IN 148124.                  *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompiled over changed ZYLDZ2.                     *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  CSE036 - Unrealised Profit and Loss Report by Trade          *
      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
      *           Information (Recompile)                             *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  204134 - Accrued interest incorrect. Reverse 177707.         *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  CSE032 - Allow entry of yield basis if trade basis and       *
      *           price basis are 'P'.                                *
      *  188515 - Profit Centre not output when Trade and Book        *
      *           positions are not reconcilable.                     *
      *  177707 - First accrual movement wrong for proc. type *NE '6' *
      *           when last position date *GT last coupon date.       *
      *  186983 - Schuldschein security did not post accrued interest *
      *           if position is short, but accruals report (SE0905)  *
      *           shows that interest was accrued. Remove part of fix *
      *           088788 which allow generation of accrued interest   *
      *           for short position.                                 *
      *  174050 - System generate UP posting even if ICD was setup to *
      *           post UL only and vice versa.  Prevent system to     *
      *           generate acct keys to SEKEYD if it didnt satisfy    *
      *           conditions on ICD setup.                            *
     F*  148124 - Wrong accrual entry generated due to wrong last     *
     F*           coupon date used. This was after amending the       *
     F*           security. Retrieve last coupon date from PF/SNDEVD  *
     F*           or use ZLCD subr. Applied fix 150689.               *
     F*  140272 - Recompile over changed ZYLDZ2
     F*  176392 - DBASE 24 caused by settled trades (RECI = 'S')      *
     F*  CSE006 - Repurchase Agreements (REPOs) enhancement           *
      *  CAC005 - PCA-SE Enhancement.                                 *
     F*  102506 - Accrue 30 days interest over February for day basis *
     F*           '1' & '5'. Removed fix 086491 in ZDAYSZ2 and        *
     F*           replaced with 067811.                               *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  129696 - If the position date is less than the last coupon   *
     F*           date and the position is flat, set accrued interest *
     F*           to zero.                                            *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  111157 - Remove 055893                                       *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*           If Analytical Accounting is available, define the   *
     F*           profit centre for posting.                          *
     F*  S01408 - Addition of core hook SE2210CCP5                    *
     F*  S01408 - Addition of core hook SE2210CCP4                    *
     F*  091803 - DO UNREALISED PROFIT/LOSS PROCESSING WHEN MARKET    *
     F*           PRICE EXISTS AS ZERO.                               *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation,*
     F*           and recompile over amended subroutine ZDAYS.        *
     F*  099882 - Rounding problem in Unrealised P/L for mortagage    *
     F*           backed securities.                                  *
     F*  099885 - Program changed to get current factor from SEDEVD.  *
     F*           This is because if factor changes on next day which *
     F*           is a holiday, the field on file will already have   *
     F*           been updated and the unrealised P/L will be         *
     F*           calculated using the incorrect current factor.      *
     F*  CPM004 - Bank Portfolios                                     *
     F*  S01408 - Addition of core hooks SE2210FFP1                   *
     F*                                  SE2210IIP1                   *
     F*                                  SE2210CCP1                   *
     F*                                  SE2210CCP2                   *
     F*                                  SE2210CCP3                   *
     F*  088778 - For schuldschein sold, system generates an account  *
     F*           key to remove the accrued interest - this is wrong  *
     F*           as the interest is still due. For schuldschein, if  *
     F*           accrual less than 0 or net position 0, do not       *
     F*           generate accrual key.                               *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  S01502 - BLI Telekurs Processing.  Recompiled due to change  *
     F*           in length of SESTAT, 133 long.                      *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  055893 - Don't stop amortizing after coupon date for AU yield*
     F*  055427 - USE CURRENT FACTOR FROM SECTYD WHEN CALCULATING FOR *
     F*           UNREALISED PROFIT AND LOSS FOR MORT. BACKED SEC.    *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           SR. ZYLD)                                           *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  048414 - AMORTIZATION BY SECURITY REPORT ERRORS              *
     F*  047922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*         - Added processing for Discount/Premium since First   *
     F*           Position Date for Amortisation by Security Report   *
     F*         - Recompiled for New Zealand Bond Formula             *
     F*  E40425 - Only access Book Positions Profit Centres PF/SEPCBD *
     F*           if Profit Centres used and Trade and Book Positions *
     F*           are to be reconciled.                               *
     F*  E37527 - Recompiled for corrections to Audit Print File.     *
     F*  E27163 - For mortgage backed securities check whether there  *
     F*           is a mortgage repayment                             *
     F*  E23199 - Interest accruals are posted in the incorrect       *
     F*           currency. Caused by overwriting of nominal currency *
     F*           on security by nominal currency on Security Diary   *
     F*           events (PF/SEDEVD). Rename NMCY on SEDEVDF          *
     F*  E29170 - Report Control Facility changes                     *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E29237 - Ex-Coupon position not reset for accruals           *
     F*           following a coupon date                             *
     F*  E29236 - Partly paid securities                              *
     F*           - Problems with back-valuation                      *
     F*           - Problems with discount amortization               *
     F*           - 2 keys produced on part payment, should only be 1 *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  S01195 - New holiday file processing                         *
     F*  S01220 - STRATEGIC RISK MANAGEMENT                           *
     F*           Recompiled over changed PF/SECTYD, PF/SEDEVD        *
     F*  E24428 - error in amortising if a position starts amortising *
     F*           again having previously gone flat                   *
     F*  E23987 - Incorrect Interest Accrued on Coupon date for       *
     F*           ex-dividend trades.                                 *
     F*  S01269 - Trade authorisation: recompile over changed file    *
     F*           TABSE.                                              *
     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
     F*           to TRADSD and/or DPTMVD                             *
     F*  E23738 - Program calculates 1 days interest short if First   *
     F*           Day Accruals - ICLD should be updated with Accrual  *
     F*           Control Date ACDT, not Event Control Date ECD.      *
     F*  E22957 - BOOK POSITION PROCESSING REVIEW                     *
     F*           Discount calculations have been simplified so that  *
     F*           numerator = Unamortised Discount ie                 *
     F*            Long - Premium is -ve,  Discount is +ve            *
     F*            Short - Premium is +ve,  Discount is -ve           *
     F*           Reflecting income/expense                           *
     F*         - Aust.price not calculated properly on price changes *
     F*         - ZYCE does not work on 'BUSINESS DAYS' Formula       *
     F*         - Remove EX-COUPON calc.in cum-coupon period (AUS.YLD)*
     F*         - Wrong Discount amortisation on AUSTR.YIELDS         *
     F*         - LPCD NOT Updated by this program ICLD is instead    *
     F*           LPCD is NOW Last Action Date.                       *
     F*  E21528 - System outputs incorrect Event Date for postings    *
     F*           generated in Non-Working Day Processing.            *
     F*           Fix will work for normal run as well.               *
     F*  E21608 - Average Price error after Amortization.             *
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21304 - Use Last Coupon Date as Start Date for Schuldschein *
     F*           Accrued Interest if it is greater than Last         *
     F*           Position Date.                                      *
     F*  E21242 - Average Price Reset to Zero on Amortization         *
     F*  E21232 - Reversal of Interest Accruals Incorrect             *
     F*  E21130 - Post negative 'PA' keys when necessary              *
     F*  E21097 - Rounding Error in calc of ave Price                 *
     F*  E20953 - Use consistent method to calculate interest for use *
     F*           in Aussie price/yield conversion                    *
     F*  S01232 - Australian Yields Modification                      *
     F*  S01233 - Australian modifications for Amortization of        *
     F*           prem/disc. (Yield curve basis)                      *
     F*  E20552 - Remove E20087 coding for amortization of discount   *
     F*           on a trade date basis.                              *
     F*  E20568 - ZACCZ changed to read non-diary events file -       *
     F*           renamed record format of SECEO.                     *
     F*  E20380 - New version of ZYLD for DIV BASIS 5.                *
     F*  E19975 - ISSR shouldn't be zeroized before writing           *
     F*           SEKEYD as  issuer should appear on account key.     *
     F*  E20085 - Interest and Coupon Calculations Rewrite:           *
     F*           - LF/SECEO member SEDEVD changed to omit RECI = 'C' *
     F*           - ZACCZ rewritten - file definitions changed.       *
     F*           - 'Accrue-to' dte was incorrect for weekend Accruals*
     F*             (Note : SEC0609 has been added to phase ANWD1.)   *
     F*  E20086 - Mortgage-Backs and Current Factor Processing Rewrite*
     F*           - Maintain UNAMORT. DISC/PREM., PREM/DISC AMORTIZED *
     F*             SINCE LPD, AVG PRICE NUMERATOR, and UNREAL P&L.   *
     F*             net of the Current Factor.                        *
     F*  E20087 - Discount Amortization Processing:                   *
     F*           - SR/AMORT used wrong dates in determining days to  *
     F*             maturity and number of days' interest to amortize.*
     F*             However although amortization is required on trade*
     F*             dte positions, this processing must exclude trades*
     F*             which have not reached value.                     *
     F*           - Accumulate amortized discount/premium for Monthly *
     F*             Profitability Report in new fld DPTM on PF/BKMTHD *
     F*           - Perform amortization BEFORE unrealized P/L calcs  *
     F*             so that SR/UNRLPL can use updated average price.  *
     F*  E19445 - Incorrect event code on account key when unrealized *
     F*           profit on a holding goes from positive to zero.     *
     F*  E19444 - Incorrect sign on unrealized loss event amount when *
     F*           loss changes from prior day but remains a loss.     *
     F*  E20125 - Allow separate accounting for unrealized P/L on     *
     F*           short positions (i.e. 'N' in position 15 of SEKEYD).*
     F*  E19915 - INCLUDE INTEREST ADJUSTMENTS IN ACCRUAL CALC.       *
     F*  E18803 - SET ACCOUNT KEY SEQUENCE NUMBER TO ZERO TO ALLOW    *
     F*           MULTI-BRANCH SYSTEMS.                               *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  S01176 - RELEASE 3.1 MODIFICATIONS.                          *
     F*  E15965 - Mark to market revaluation                          *
     F*  E14616 - INTEREST ACCRUAL INCORRECT IF EVENTS OF TYPE        *
     F*           IR, PP, MP EXIST FOR SECURITY DURING THE ACCRUAL    *
     F*           PERIOD.                                             *
     F*  E15442 - AVERAGE PRICE IS NOT BEING UPDATED BY AMORTIZATION  *
     F*           OF DISCOUNT,AMORTIZED AMOUNTS ARE INCORRECT.        *
     F*  E15430 - CONVERTIBLE INDICATOR SHOULD BE 'Y' OR ' ' ON       *
     F*           ACCOUNT KEYS                                        *
     F*  E14235 - ERROR IN SR/ZNCD TO FETCH NEXT COUPON DATE. PROGRAM *
     F*           RE-COMPILED TO ALLOW FOR NEW SUB-ROUTINE.           *
     F*  E14959 - PROGRAM SHOULDN'T TRY TO GENERATE ACCRUALS FOR      *
     F*           MATURED SECURITIES                                  *
     F*  E14680 - COUPON EVENTS ARE OUTPUT AS 'CP' RATHER THAN 'CO'   *
     F*           ON NON DIARY EVENTS FILE.                           *
     F*  E13817 - PROGRAM FIXES PROM JULIUS BAER.                     *
     F*                                                               *
     F*****************************************************************
      *
     FBKPHD   UF  E           K        DISK         KINFDS BKHDS
     F                                              KINFSR BKHSR
     F*BKPOS***IF  E           K        DISK                                                  246619
     FBKPOS   UF  E           K        DISK                                                   246619
     FBKMTH   UF  E           K        DISK                               E20087
     F***TRDMTHT*IF**E           K        DISK                     E20087 E20552
     FSECTY   IF  E           K        DISK
     F***SEDEV***1F**E           K        DISK                            E13817
     F***SECED***IF**E           K        DISK                     E13817 E20085
     F***SECET***IF**E           K        DISK                     E14616 E20085
     F*********** SEDEVDF                         KRENAMESEDEVDF2  E14616 E20085
     FSEDEV   IF  E           K        DISK                               E20085
     FSECEO   IF  E           K        DISK                               E20085
     F            SEDEVDF                           KRENAMESEDEVDO        E20085
     F*********** SNDEVDF                           KIGNORE         E20085E20568
     F            SNDEVDF                           KRENAMESNDEVDO        E20568
     FBOOKD   IF  E           K        DISK
     FINVTP   IF  E           K        DISK
     FPRICED  IF  E           K        DISK                               091803
     FBKPHDA  IF  E                    DISK
     FSEPCBD  IF  E           K        DISK                               S01117
     FBSPOSDL1UF  E           K        DISK                               CSE006
     FTRADS   IF  E           K        DISK                               CSE006
     FSEKEYD  O   E           K        DISK         KINFDS SKDDS
     F                                              KINFSR SKDSR
     FSEKEYA  O   E           K        DISK         KINFDS SKADS
     F                                              KINFSR SKASR
     FSE2210AUO   E                    PRINTER
     FTABSE   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICD SE    TABTB36F                          KIGNORE
     F* ICD 5     TABTB40F                          KIGNORE               E40425
     F* CURRENCY  TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETAF                          KIGNORE               E40425
     F            TABLETHF                          KIGNORE
     F**** HOLS * TABLETJF                          KIGNORE               S01232
     F            TABLETLF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE               E40425
     F            TABLETNF                          KIGNORE
     F            TABLETKF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE2210FFP1                                           S01408
      *                                                                                       CSE065
     FSEDEVAL1IF  E           K        DISK                                                   CSE065
     F            SEDEVDF                           KRENAMESEDEVDAL                           CSE065
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   21 - NO RECORDS IN PRICED FILE                              *   091803
     F*   22 - NO PRICE RECORD EXISTS FOR A SECURITY                  *   091803
     F****16**-**SECURITY*DIARY*EVENT*RECORD*FOUND**************** E13817 E20085
     F*   30 - NEW AND PREVIOUS UNREALSIED P/L BOTH +VE OR BOTH -VE   *
     F*   35 - Nominal Currency decimal places equal to 0             *
     F*   36 - Nominal Currency decimal places equal to 1             *
     F*   37 - Nominal Currency decimal places equal to 2             *
     F*   38 - Nominal Currency decimal places equal to 3             *
     F****40*******NO*INTEREST*CHANGES*OCCURRED*BETWEEN*ICLD*AND*NCD***   E20085
     F****41*******BYPASS*FIRST*READ*OF*SEDEV*AS*RECORD*ALREADY*READ***   E20085
     F*   50 - CONDITION **DIFFERENCE** IN AUDIT PRINT                *
     F*   52 - AUSTRALIAN YIELD TRADED SECURITY                       *   S01232
     F*   53 - READE on BSPOSDL1                                      *   CSE006
     F****76*-****INTEREST*CHANGES*THIS*COUPON*PERIOD************* E13817 E20085
     F****77*-****SECURITY*DIARY*EVENT*RECORD*ALREADY*READ******** E13817 E20085
     F*   80 - ERROR ON CHAIN
     F*   81 - END OF FORWARD TRADES FOR THIS POSITION                *   E20087
     F*   82 - CURRENT FIFO TRADE FOUND FOR THIS POSITION             *   E20087
     F*   87 - ERROR ON UPDATE OR WRITE OF RECORD                     *
     F****88*******END*OF*FILE*ON*SEDEV********************************   E20085
     F*   89 - END OF FILE ON BKPHD                                   *
     F*                                                               *
     F*90-99 - USED IN Z-SUBROUTINES                                  *
     F*                                                               *
     F*   U7 - DATABASE ERROR                                         *
     F*   U8 - DATABASE ERROR                                         *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  FIRST  - Accesses ICD 1, 2 and SE.                           *
     F*  UNRLPL - Produces Unrealised Profit and Loss Keys.           *
     F***ADJUPL*-*Unrealized*P/L*for*Discounted*'T'*Positions.**** E20087 E20552
     F***ACCUM**-*Accumulate*Adjusted*Consideration*for*SR/ADJUPL.*****   E20552
     F*  AMORT  - Amortises Discount/Premium.                         *
     F*  AAMORT - Amortises Discount/Premium on Yield Curve Basis.    *   S01233
     F*  AMUPL - Calculates Amortisation on the unrealised P/L on B/S *   CSE006
     F***ADJBUD*-*Adjusts*Unamortized*Discount*for*'T'*Position*with***   E20552
     F************Outstanding*Forward*Trades.********************* E20087 E20552
     F*  ACCRUE - Calculates Accrued Interest up to Date.             *
     F***ACCRX**-*Calculates*Ex-Coupon*Accrual.************************   E13817
     F***INTCPN*-*Calculates*Ex-Coupon*Accrual.************************   E13817
     F*  UPDATE - Updates Book Position Header.                       *
     F*  WRITED - Sets up Common Fields and Outputs Keys to SEKEYD.   *
     F*  AUDIT  - Outputs Control Report and Updates Book Position    *
     F*           Header Audit Record.                                *
     F*                                                               *
     F*  BKHSR,SKDSR,SKASR,   ERROR ROUTINES                          *
     F*                                                               *
     F*  BKPCHN - File Access, LF/BKPOS                               *
     F*  BOKCHN - File Access, LF/BOOKD                               *
     F*  INVCHN - File Access, LF/INVTP                               *
     F*  PPCCHN - File Access, PF/SEPCBD                              *
     F*  SECCHN - File Access, LF/SECTY                               *
     F*  TABCHN - File Access, LF/TABSE                               *
     F*                                                               *
     F****XDATE**-*CALCULATE*NUMBER*OF*WORKING*DAYS*BACKWARDS***** S01232 S01117
     F*   ZBKDT  - CALCULATE NUMBER OF WORKING DAYS BACKWARDS         *   S01117
     F*   ZACCH  - Access holidays file                               *
     F*   ZACCR  - CALCULATES INTEREST ACCRUED                        *
     F*   ZACCZ  - CALCULATE INTEREST ACCRUED BETWEEN TWO DATES       *
     F*   ZCALCD - Calculate long term CD Price from Yield            *   E39495
     F*   ZCNSD  - CALCULATE 'CONSIDERATION'                          *   S01233
     F*   ZDATE1 - CONVERTS DATES TO DAYS                             *
     F*   ZDATE2 - CONVERTS DAYS TO DATES                             *
     F*   ZDAYS  - CALCULATES NO DAYS BETWEEN TWO DATES               *
     F*   ZDYYR  - CALCULATES NO DAYS IN INTEREST YEAR                *
     F*   ZD5DYS - SR TO CALCULATE NO OF DAYS IN INT. YEAR FOR DVBS 5.*
     F*   ZEVCD  - CALCULATES EVENT CONTROL DATE                      *
     F*   ZHASH  - CALCULATES EVENT AMOUNTS AS HASH VALUE             *
     F*   ZICD2  - ACCESSES ICD 2                                     *
     F*   ZICDSE - ACCESSES ICD FOR SE                                *
     F*   ZLCD   - CALCULATES LAST COUPON DATE                        *
     F*   ZNCD   - CALCULATES NEXT COUPON DATE                        *
     F*   ZPRCI  - CONVERTS PRICE TO %PRICE                           *
     F*   ZPRCO  - Converts % price to Price/Discount/Yield           *
     F*   ZRATE  - CALCULATES EFFECTIVE RATE                          *
     F*   ZSYSTM - ACCESSES ICD 1                                     *
     F*   ZYCE   - GET AUSTRALIAN YIELD CUM/EX PARAMETER              *   S01232
     F*   ZYLD   - Sets up parameters for routine ZYIELD              *
     F*   ZYLDI  - OUTPUTS YIELD AS PERCENTAGE                        *
     F*   ZYLDO  - Converts % price to Price/Discount/Yield           *
     F*   *PSSR  - EXCEPTION ERROR ROUTINE                            *   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E************        ZF29   14  14  5 0             29TH FEB ARRAY
     E/COPY ZSRSRC,ZDAYSZ1                               29TH FEB ARRAY
     E/COPY ZSRSRC,ZDATE2Z1                              ZYDY/ZMDY & ZMNM
     E*COPY*ZSRSRC*ZDATE6Z1                                        S01232 S01195
     E/COPY ZSRSRC,ZPOWER8Z1                             POWER8 ARRAY
     E                    RPI        12  1               RATE/PAYMT INDS
     E/COPY ZSRSRC,ZNCDZ1                                CD AND CR
     E/COPY ZSRSRC,ZHASHZ1                               INT AND DEC
     E/COPY ZSRSRC,ZHOLE                                                  S01117
      /EJECT
     I***********                                                  E13817 E20085
     I**TO*RENAME*SNDEVD*FIELDS*********************************** E13817 E20085
     I***********                                                  E13817 E20085
     I***SNDEVDF***                                                E13817 E20085
     I***********   SNDT                            SDED           E13817 E20085
     I***********   SNET                            SDET           E13817 E20085
     I*
     ISEDEVDF                                                             E23199
     I*                                                                   E23199
     I** Rename NMCY to avoid confusion with NMCY on PF/SECTYD            E23199
     I*                                                                   E23199
     I              NMCY                            NMCYSD                E23199
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
     ISEDEVDO                                                             E23199
     I*                                                                   E23199
     I** Rename NMCY to avoid confusion with NMCY on PF/SECTYD            E23199
     I*                                                                   E23199
     I              NMCY                            NMCYSD                E23199
      *                                                                                       CSE065
     ISEDEVDAL                                                                                CSE065
     I*                                                                                       CSE065
     I              RECI                            C#RECI                                    CSE065
     I              SDSN                            C#SDSN                                    CSE065
     I              SDED                            C#SDED                                    CSE065
     I              SDET                            C#SDET                                    CSE065
     I              SDNV                            C#SDNV                                    CSE065
     I              SDVA                            C#SDVA                                    CSE065
     I              ZZ005                           C#ZZ05                                    CSE065
     I              SRPT                            C#SRPT                                    CSE065
     I              SDTR                            C#SDTR                                    CSE065
     I              SRMI                            C#SRMI                                    CSE065
     I              SDPD                            C#SDPD                                    CSE065
     I              SDNC                            C#SDNC                                    CSE065
     I              SDPP                            C#SDPP                                    CSE065
     I              SDPC                            C#SDPC                                    CSE065
     I              SDTA                            C#SDTA                                    CSE065
     I              SDTP                            C#SDTP                                    CSE065
     I              SDRP                            C#SDRP                                    CSE065
     I              SDCV                            C#SDCV                                    CSE065
     I              SDCX                            C#SDCX                                    CSE065
     I              SDCE                            C#SDCE                                    CSE065
     I              SDMD                            C#SDMD                                    CSE065
     I              NMCY                            C#NMCY                                    CSE065
     I              SDAD                            C#SDAD                                    CSE065
     I              SDDT                            C#SDDT                                    CSE065
     I              RCIC                            C#RCIC                                    CSE065
     I              LCD                             C#LCD                                     CSE065
     I              CHTP                            C#CHTP                                    CSE065
     I              TNLU                            C#TNLU                                    CSE065
     I              SDCP                            C#SDCP                                    CSE065
     I              SDXD                            C#SDXD                                    CSE065
     I              FRNT                            C#FRNT                                    CSE065
     I              REPA                            C#REPA                                    CSE065
     I              TMST                            C#TMST                                    CSE065
     I              SCRS                            C#SCRS                                    CSE065
     I              SLQP                            C#SLQP                                    CSE065
     I              SDNN                            C#SDNN                                    CSE065
     I              SDAL                            C#SDAL                                    CSE065
     ITRADSDF                                                                                 CGL035
     I              EUTX                            TEUTX                                     CGL035
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR SEKEYD ACCOUNT KEY
     I*
     I                                        1  20 ACKY
     I                                        1   3 INVT
     I                                        4   4 EVTP
     I                                        5   5 TRTP
     I                                        6   6 PORT
     I                                        7   8 BOOK
     I                                        9   9 PSBS
     I                                       10  10 FILL
     I                                       11  12 CGTP
     I                                       13  13 MRKT
     I                                       14  14 CNVI
     I                                       15  15 NEGI
     I                                       16  18 FIL2
     I                                       19  20 AMCD
     I*                                                                   S01094
     I*    Hash totalling fields                                          S01094
     I/COPY ZSRSRC,ZHASHZ2
     I*   Data structure for array used in ZDATE5                         E22957
     I/COPY ZSRSRC,ZHOLI                                                  S01117
     I*   Data structure used for standard holiday processing             S01117
     I/COPY ZSRSRC,ZHOLDS                                                 S01117
     I*   Data structure used for standard holiday processing             S01117
     I            DS                                                      E22957
     I                                        1  75 HCCY                  E22957
     I                                        1  75 XCCY                  E22957
     I*
     I*
     I            DS
     I*
     I* DATA STRUCTURE TO FORCE ISSUER FIELD TO BE ZONED
     I*
     I**********                              1   60WISSR                                     CSD027
     I**********                              7  120CSTN                                      CSD027
     I                                        1   6 WISSR                                     CSD027
     I                                        7  12 CSTN                                      CSD027
     I*
     IKSEPCR      DS                                                      S01117
     I*                                                                   S01117
     I* Book Position Profit Centre (PF/SEPCBD)                           S01117
     I*                                                                   S01117
     I                                        1   2 KBHBK                 S01117
     I                                        3   5 KBHBA                 S01117
     I                                        6  15 KBHSC                 S01117
     I                                       16  16 KBHMK                 S01117
     I*                                                                   S01117
     I            DS
     I*
     I* DATA STRUCTURE FOR BOOK POSITION KEY
     I*
     I                                        1  20 BKKEY
     I                                        1  10 BHSC
     I***********                            11  130BHBR                  S01117
     I                                       11  13 BHBA                  S01117
     I                                       14  15 BHBK
     I                                       16  16 BHMK
     I                                       17  17 BHTV
     I                                    P  18  200LPSD
     I*
     I/COPY ZSRSRC,ZNCDZ2
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR TABLE FILE KEY
     I*
     I                                        1  12 TKEY
     I                                        1   20RECT
     I                                        3  10 ZZ008
     I                                       11  120RCDE
     I                                        3   8 ZZ006
     I                                        9  11 RCCY
     I                                       12  12 ZZ001
     I*
     IBKHDS       DS                            366
     I*
     I* DATA STRUCTURES FOR RPG 01021 ERROR HANDLING
     I*
     I                                     *STATUS  STSBKH
     I*
     ISKDDS       DS
     I                                     *STATUS  STSSKD
     I*
     ISKADS       DS
     I                                     *STATUS  STSSKA
     I*
     I/COPY ZSRSRC,ZYLDZ1
     I*
     ILDA         DS                            256                       S01117
     I*                                                                   S01117
     I**  Local Data Area for Database Error Reporting                    S01117
     I*                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I***********LDA        UDS                            256            S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I*                                                                   E20087
     I*    SESTAT DATA STRUCTURE                                          E20087
     I*                                                                   E20087
     IDTAARA    E DSSESTAT                                                E20087
     I*
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                   S01408
     I/COPY WNCPYSRC,SE2210IIP1                                           S01408
     I*                                                                   S01408
     ISDMMOD    E DSSDMMODPD                                              CAC002
     I**  Modules File Details                                            CAC002
     I*                                                                   CAC002
     ISDSTRD    E DSSDSTRDPD                                              CAC002
     I**  Securities Trading Details                                      CAC002
     I*                                                                   CSE006
     ISCSARD    E DSSCSARDPD                                              CSE006
     I** Switchable features file                                         CSE006
      *                                                                                       228948
     ISDHEDG    E DSSDHEDGPD                                                                  228948
      ** Hedge ICD                                                                            228948
     I*                                                                   CAC002
     IDSFDY     E DSDSFDY                                                 CAC002
     I*  First DS for Access Programs, Short Data Structure               CAC002
     I*                                                                   CAC002
     I              'DiscPremAmortPostn  'C         SVALKK                                    CSE105
      *                                                                                       CSE105
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C* KEY LISTS FOR CHAINING TO :-
     C*
     C*     TABTB36
     C*
     C           TABKEY    KLIST
     C                     KFLD           TKEY
     C*
     C*     BOOK POSITION
     C*
     C           BKPKEY    KLIST
     C                     KFLD           BHSC
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHMK
     C                     KFLD           BHTV
     C                     KFLD           LPSD
     C*
     C*     SECURITIES
     C*
     C           SECKEY    KLIST
     C                     KFLD           BHSC
     C*
     C*     INVESTMENTS TYPE
     C*
     C           INVKEY    KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*
     C*     BOOK DETAILS
     C*
     C           BOKKEY    KLIST
     C                     KFLD           BHBK
     C*                                                                   099885
     C***  Define the Keylist for SEDEVDO in SECEO.                       099885
     C*                                                                   099885
     C           KZSDDO    KLIST                                          099885
     C                     KFLD           SDSN                            099885
     C                     KFLD           SDET                            099885
     C                     KFLD           SDED                            099885
     C*                                                                   148124
     C** Keylist for SNDEVDO in SECEO                                     148124
     C*                                                                   148124
     C           KESNCP    KLIST                                          148124
     C                     KFLD           SESN                            148124
     C                     KFLD           SNET                            148124
     C                     KFLD           SNDT                            148124
     C*
     C***********                                                         E20085
     C******SECURITY*DIARY*EVENTS**************************************   E20085
     C***********                                                         E20085
     C***********SEDKEY    KLIST                                          E20085
     C***********          KFLD           BHSC                            E20085
     C***********          KFLD           EDTE    50                      E20085
     C***********          KFLD           ETYP    2                E13817 E20085
     C***********                                                         E20085
     C***********SEDKY2    KLIST                                          E20085
     C***********          KFLD           BHSC                            E20085
     C*                                                                   E20087
     C** Monthly book position statistics file (BKMTH)                    E20087
     C*                                                                   E20087
     C           BKMKEY    KLIST                                          E20087
     C                     KFLD           BHSC                            E20087
     C***********          KFLD           BHBR                     E20087 S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK                            E20087
     C                     KFLD           BHMK                            E20087
     C                     KFLD           BHTV                            E20087
     C                     KFLD           BKED                            E20087
     C*                                                                   E20087
     C***Trades*by*branch/book/security/market*(LF/TRDMTHT)********E20087 E20552
     C***********TRDKEY    KLIST                                   E20087 E20552
     C***********          KFLD           BHBR                     E20087 E20552
     C***********          KFLD           BHBK                     E20087 E20552
     C***********          KFLD           BHSC                     E20087 E20552
     C***********          KFLD           BHMK                     E20087 E20552
     C*                                                                   S01117
     C* Book Position Profit Centre (PF/SEPCBD)                           S01117
     C*                                                                   S01117
     C           KSEPCB    KLIST                                          S01117
     C                     KFLD           KBHBK                           S01117
     C                     KFLD           KBHBA                           S01117
     C                     KFLD           KBHSC                           S01117
     C                     KFLD           KBHMK                           S01117
     C*                                                                   091803
     C** PRICED FILE KEY                                                  091803
     C*                                                                   091803
     C           PKEY      KLIST                                          091803
     C                     KFLD           PSSN                            091803
     C                     KFLD           PPRT                            091803
     C                     KFLD           PVDT                            091803
      *                                                                   CSE006
      *** Buy/Sell Back Position by Security (full key)                   CSE006
      *                                                                   CSE006
     C           BSKEY1    KLIST                                          CSE006
     C                     KFLD           BHBA                            CSE006
     C                     KFLD           BHBK                            CSE006
     C                     KFLD           BHSC                            CSE006
     C                     KFLD           WTDRF   6                       CSE006
      *                                                                   CSE006
      *** Buy/Sell Back Position by Security (partial key)                CSE006
      *                                                                   CSE006
     C           BSKEY2    KLIST                                          CSE006
     C                     KFLD           BHBA                            CSE006
     C                     KFLD           BHBK                            CSE006
     C                     KFLD           BHSC                            CSE006
      *                                                                                       CSE065
     C           SEDVKY    KLIST                                                              CSE065
     C                     KFLD           K@SVSN                                              CSE065
     C                     KFLD           K@SDET                                              CSE065
     C                     KFLD           K@SDED                                              CSE065
     C*
     C* PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE2210'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C* CLEAR COUNT WORKFIELDS AND Z = 1
     C*
     C                     Z-ADD0         IREC
     C                     Z-ADD0         OREC
     C                     Z-ADD0         WSTDT   50                      E13817
     C                     MOVE 'N'       DADJN                           100017
SP   C                     Z-ADD1         Z
     C*
     C*  FIRST CYCLE PROCESS
     C*
     C                     EXSR FIRST
     C*
     C*  DO UNTIL EOF OR ERROR
     C*
     C           *IN89     DOWEQ'0'
     C           *INU7     ANDEQ'0'
     C*
     C*  READ FILE
     C*
     C                     READ BKPHD                    89
     C/COPY WNCPYSRC,SE2210C033
     C*
     C*  IF NOT EOF
     C*
     C           *IN89     IFEQ '0'
     C                     ADD  1         IREC    50
     C                     MOVE '0'       *IN30
     C***********          MOVEA'00'      *IN,40                          E20085
     C*                                                                   E14959
     C** ONLY PROCESS NON-MATURED SECURITIES                              E14959
     C*                                                                   E14959
     C           RECI      IFEQ 'D'                                       E14959
     C/COPY WNCPYSRC,SE2210C034
     C*
     C*  OBTAIN LATEST BOOK POSITION
     C*
     C                     EXSR BKPCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDLP
     C                     END
     C*
     C*  OBTAIN SECURITIES
     C*
     C                     EXSR SECCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDLP
     C                     END
     C*
     C*  OBTAIN BOOK DETAILS
     C*
     C                     EXSR BOKCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDLP
     C                     END
     C*
     C*  OBTAIN INVESTMENT DETAILS
     C*
     C                     EXSR INVCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDLP
     C                     END
     C*                                                                   S01117
     C*  Obtain Book Position Profit Centre Details                       S01117
      ***  ... if Profit Centres are used and Trade and Book Positions    E40425
      ***  are to be reconciled.                                          E40425
      *                                                                   E40425
     C           PFUS      IFEQ 'Y'                                       E40425
     C********** TBRC      ANDEQ'Y'                                       E40425 188515
     C*                                                                   S01117
     C           CAC005    IFEQ 'N'                                       CAC005
     C                     EXSR PPCCHN                                    S01117
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           *INU7     IFEQ '1'                                       S01117
     C                     GOTO ENDLP                                     S01117
     C                     END                                            S01117
      *                                                                   E40425
     C                     END                                            E40425
     C*
     C*  OBTAIN CURRENCY DECIMAL PLACES
     C*
     C                     EXSR TABCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDLP
     C                     END
     C                     Z-ADDCDP       NCDP                            S01232
     C*
     C* Setup input parameter currency decimal places for use in          S01117
     C* subroutines SR.ZACCZ, SR.ZACCR, SR.ZCNSD                          S01117
     C*                                                                   S01117
     C                     Z-ADDCDP       ZCDP                            S01117
     C*
     C* CALCULATE EVENT CONTROL DATE AND NEXT COUPON DATE
     C*
     C** ZEVCD now called in SR/FIRST.                                    E20085
     C*
     C***********          EXSR ZEVCD                                     E20085
     C                     EXSR ZNCD
     C*
     C***PRODUCE*UNREALIZED*P/L*KEYS***********************************   E20087
     C** Unrealised P/L Keys produced after average price has been        E20087
     C** adjusted by SR/AMORT.                                            E20087
     C***********                                                         E40425
     C********** UPPS      IFNE *BLANK                                    E20087
     C********** UPBS      IFEQ 'B'                                       E20087
     C********** UPBS      OREQ BHTV                                      E20087
     C**********           EXSR UNRLPL                                    E20087
     C**********           END                                            E20087
     C**********           END                                            E20087
     C*
     C*  PRODUCE AMORTISATION KEYS
     C*
     C***********BHTV      IFEQ 'V'                                       E15442
     C***********MATY      ANDNE99999                                     E15442
     C***********STBS      ANDEQ'D'                             E13817    E15442
     C***********STAD      IFEQ 'Y'                                       E15442
     C***********GDPK      OREQ 'Y'                                       E15442
     C***********          EXSR AMORT                                     E15442
     C***********          END                                            E15442
     C***********          END                                            E15442
     C*                                                                   E20087
     C***Since*SR/AMORT*now*updates*average*prices,*amortization****E20087E20552
     C***is*now*required*for*'T'*as*well*as*'V'*records,*although*noE20087E20552
     C***account*keys*will*be*generated*for*'T'*records.************E20087E20552
     C********** BHTV      IFEQ 'V'                                 E15442E20087
     C********** MATY      ANDNE99999                               E15442E20087
      *                                                                   CSE006
      *** Only do SR/AMORT if BYSL not eq 'Y' and switchable feature      CSE006
      *** is on.                                                          CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C           BYSL      ANDNE'Y'                                       CSE006
     C           CSE006    ORNE 'Y'                                       CSE006
      *                                                                   CSE006
     C           BHTV      IFEQ 'V'                                       E20552
     C           MATY      ANDNE99999                                     E20552
     C/COPY WNCPYSRC,SE2210C051
      *                                                                                       CSE105
     C           CSE105    ANDEQ'N'                                                           CSE105
      *                                                                                       CSE105
      ** If CSE105 is installed, perform the routine when the new                             CSE105
      ** Trade/Value Amortization flag is "Both" or EQUAL to original                         CSE105
      ** flag.                                                                                CSE105
      *                                                                                       CSE105
     C           CSE105    OREQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQ'B'                                                           CSE105
     C           MATY      ANDNE99999                                                         CSE105
     C           CSE105    OREQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQBHTV                                                          CSE105
     C           MATY      ANDNE99999                                                         CSE105
      *                                                                                       CSE105
     C***********MATY      IFNE 99999                              E20087 E20552
     C           STAD      IFEQ 'Y'                                       E15442
     C           STAD      OREQ 'C'                                       S01233
     C/COPY WNCPYSRC,SE2210C075
     C           STBS      OREQ 'D'                                       E15442
     C           GDPK      ANDEQ'Y'                                       E15442
     C/COPY WNCPYSRC,SE2210C076
     C                     EXSR AMORT                                     E15442
      *                                                                                       CSE065
      ** Post Equity Amount for Available for Sales Book                                      CSE065
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C********** STRM      ANDEQ'Y'                                                    CSE065 233707
     C           BHTV      ANDEQ'V'                                                           CSE065
     C           PROT      ANDNE'2'                                                           CSE065
     C           PROT      ANDNE'4'                                                           CSE065
     C           PROT      ANDNE'7'                                                           CSE065
     C                     EXSR SREQTY                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     END                                            E15442
     C                     END                                            E15442
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** If Buy-Sell Book indicator = 'Y'and CSE006 is on EXSR AMUPL     CSE006
      *** to calulate Amortisation on the unrealised profit/loss of       CSE006
      *** Buy/Sell trades.                                                CSE006
      *                                                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C           BYSL      ANDEQ'Y'                                       CSE006
     C                     EXSR AMUPL                                     CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *                                                                   CSE006
     C*                                                                   E20087
     C** Perform unrealized P/L calculations at this point                E20087
     C** to reflect the effect of amortization on average price.          E20087
      *                                                                   CSE006
      *** Only do this if BYSL not eq 'Y' and switchable feature          CSE006
      *** is on.                                                          CSE006
      *                                                                   CSE006
     C*********  CSE006    IFEQ 'Y'                                                    CSE006 CAS006
     C*********  BYSL      ANDNE'Y'                                                    CSE006 CAS006
     C*********  CSE006    ORNE 'Y'                                                    CSE006 CAS006
      *                                                                   CSE006
     C*                                                                   E20087
     C/COPY WNCPYSRC,SE2210C006
     C*********  UPPS      IFNE *BLANK                                                 E20087 CAS006
     C/COPY WNCPYSRC,SE2210C007
     C*********  UPBS      IFEQ 'B'                                                    E20087 CAS006
     C*********  UPBS      OREQ BHTV                                                   E20087 CAS006
     C*********            EXSR UNRLPL                                                 E20087 CAS006
     C*********            END                                                         E20087 CAS006
     C*********            END                                                         E20087 CAS006
      *                                                                                CSE006 CAS006
     C*********            ENDIF                                                       CSE006 CAS006
      *                                                                                CSE006 CAS006
     C*
     C*  PRODUCE INTEREST ACCRUAL KEYS
     C*
     C           BHTV      IFEQ 'V'
     C           DYBS      ANDNE'4'
     C           PROT      IFEQ '1'
     C           PROT      OREQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C                     MOVE 'Y'       DADJN                           100017
     C*                                                                   102506
     C***  Set Accrual Type for ZDAYS subroutine                          102506
     C*                                                                   102506
     C                     MOVE 'I'       ZACLT                           102506
     C                     EXSR ACCRUE
     C*                                                                   102506
     C***  Reset Accrual Type                                             102506
     C*                                                                   102506
     C                     MOVE *BLANK    ZACLT                           102506
     C                     MOVE 'N'       DADJN                           100017
     C                     END
     C                     END
      *                                                                                       CAS006
      ** Perform unrealized P/L calculations at this point                                    CAS006
      ** to reflect the effect of amortization on average price.                              CAS006
      *                                                                                       CAS006
      ** Only do this if BYSL not eq 'Y' and switchable feature                               CAS006
      ** is on.                                                                               CAS006
      *                                                                                       CAS006
     C           CSE006    IFEQ 'Y'                                                           CAS006
     C           BYSL      ANDNE'Y'                                                           CAS006
     C           CSE006    ORNE 'Y'                                                           CAS006
      *                                                                                       CSE036
      ** If CSE036 then don't do Unrelised P/L key Calc                                       CSE036
      *                                                                                       CSE036
     C           CSE036    IFEQ 'Y'                                                           CSE036
     C                     MOVE 'N'       #EXSR   1                                           CSE036
     C                     ENDIF                                                              CSE036
      *                                                                                       CSE036
      *                                                                                       CAS006
     C           UPPS      IFNE *BLANK                                                        CAS006
     C           UPBS      IFEQ 'B'                                                           CAS006
     C           UPBS      OREQ BHTV                                                          CAS006
     C                     EXSR UNRLPL                                                        CAS006
      *                                                                                       246619
     C                     Z-ADDNPSN      PNOM                                                246619
     C                     EXCPTUPDBKD                                                        246619
      *                                                                                       246619
     C                     END                                                                CAS006
     C                     END                                                                CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C*
     C* UPDATE BOOK POSITION HEADER
     C*
     C                     EXSR UPDATE
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2210CCP2                                           S01408
     C*                                                                   S01408
     C*                                                                   E14959
     C                     END                                            E14959
     C                     END
     C*
     C           ENDLP     TAG                             ** ENDLP **
     C*
     C                     END
     C*
     C* OUTPUT CONTROL REPORT AND WRITE AUDIT RECORD
     C*
     C           EAUDIT    TAG                             ** EAUDIT **
     C*
     C                     EXSR AUDIT
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C/COPY WNCPYSRC,SE2210C068
     C                     SETON                     LR
      *                                                               *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      * SUBROUTINE TO ACCESS ICD 1,2 AND ICD FOR SE                   *
      *                                                               *
      *****************************************************************
      *
     C           FIRST     BEGSR                           ** FIRST **
     C*
     C                     EXSR ZSYSTM
     C*
     C* ERROR IN ZSYSTM
     C*
     C           *IN,99    IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C                     Z-ADD1         DBASE            **DB ERROR 01**
     C                     MOVEL'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C*
     C                     ELSE
     C*
     C                     EXSR ZICD2
     C*
     C* ERROR IN ZICD2
     C*
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD2         DBASE            ***************
     C                     MOVEL'TABLE'   DBFILE           **DB ERROR 02**
     C                     MOVELTKEY      DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C*
     C                     ELSE
     C*
     C                     EXSR ZICDSE
     C*
     C* ERROR IN ZICDSE
     C*
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD3         DBASE            ***************
     C                     MOVEL'TABLE'   DBFILE           **DB ERROR 03**
     C                     MOVELTKEY      DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
      *                                                                   E40425
     C                     ELSE                                           E40425
      *                                                                   E40425
     C                     MOVE *BLANKS   TKEY                            E40425
     C                     MOVEL'01'      TKEY                            E40425
     C                     MOVE '40'      TKEY                            E40425
     C           TKEY      CHAINTABTB40F             80                   E40425
      *                                                                   E40425
     C           *IN80     IFEQ '1'                                       E40425
     C           RECI      ORNE 'D'                                       E40425
     C           *LOCK     IN   LDA                                       E40425
     C                     Z-ADD10        DBASE            ***************E40425
     C                     MOVEL'TABTB40' DBFILE           * DB ERROR 10 *E40425
     C                     MOVELTKEY      DBKEY            ***************E40425
     C                     SETON                     U7U8                 E40425
     C                     OUT  LDA                                       E40425
     C                     DUMP                                           E40425
     C                     END                                            E40425
      *                                                                   E40425
     C                     END
     C*
     C                     END
     C                     END
     C*                                                                   CAC002
     C**  Check if Analytical Accounting module is installed.             CAC002
     C*                                                                   CAC002
     C                     CALL 'AOMMODR0'                                CAC002
     C                     PARM '*MSG   ' @RTCD   7                       CAC002
     C                     PARM '*FIRST ' @OPTN   7                       CAC002
     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD20        DBASE            ************   CAC002
     C                     MOVEL'SDMMODPD'DBFILE           * DBERR 20 *   CAC002
     C                     MOVEL@OPTN     DBKEY            ************   CAC002
     C                     OUT  LDA                                       CAC002
     C                     SETON                     U7U8                 CAC002
     C                     DUMP                                           CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C**  Access Securities Trading details                               CAC002
     C*                                                                   CAC002
     C                     CALL 'AOSTRDR0'                                CAC002
     C                     PARM '*MSG   ' @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDSTRD    PARM SDSTRD    DSSDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD21        DBASE            ************   CAC002
     C                     MOVEL'SDSTRDPD'DBFILE           * DBERR 21 *   CAC002
     C                     MOVEL@OPTN     DBKEY            ************   CAC002
     C                     OUT  LDA                                       CAC002
     C                     SETON                     U7U8                 CAC002
     C                     DUMP                                           CAC002
     C                     ENDIF                                          CAC002
     C/COPY WNCPYSRC,SE2210C069
      *                                                                   CAC005
      ***  Check if CAC005 - PCA-SE Enhancement is on.                    CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*VERIFY' @OPTN   7                       CAC005
     C                     PARM 'CAC005'  @SARD   6                       CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM *BLANKS   @RTCD                           CSE006
     C                     PARM '*VERIFY' @OPTN                           CSE006
     C                     PARM 'CSE006'  @SARD   6                       CSE006
     C           SCSARD    PARM SCSARD    DSFDY                           CSE006
      *                                                                   CSE006
      * Database Error                                                    CSE006
      *                                                                   CSE006
     C           @RTCD     IFNE *BLANKS                                   CSE006
     C           @RTCD     ANDNE'*NRF'                                    CSE006
     C           *LOCK     IN   LDA                                       CSE006
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE006
     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 23 *CSE006
     C                     Z-ADD23        DBASE            ***************CSE006
     C                     OUT  LDA                                       CSE006
     C                     SETON                     U7U8                 CSE006
     C                     DUMP                                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C           @RTCD     IFEQ *BLANK                                    CSE006
     C                     MOVEL'Y'       CSE006  1                       CSE006
     C                     ELSE                                           CSE006
     C                     MOVEL'N'       CSE006                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                                       262293
      **  Determine if feature CSE031 is installed.                                           262293
      *                                                                                       262293
     C                     MOVE 'N'       CSE031  1                                           262293
     C                     CALL 'AOSARDR0'                                                    262293
     C                     PARM '       ' @RTCD                                               262293
     C                     PARM '*VERIFY' @OPTN                                               262293
     C                     PARM 'CSE031'  @SARD                                               262293
      *                                                                                       262293
     C           @RTCD     IFEQ *BLANK                                                        262293
     C                     MOVE 'Y'       CSE031                                              262293
     C                     ENDIF                                                              262293
      *                                                                   CSE032
      **  Determine if feature CSE032 is installed.                       CSE032
      *                                                                   CSE032
     C                     MOVE 'N'       CSE032  1                       CSE032
     C                     CALL 'AOSARDR0'                                CSE032
     C                     PARM '       ' @RTCD                           CSE032
     C                     PARM '*VERIFY' @OPTN                           CSE032
     C                     PARM 'CSE032'  @SARD                           CSE032
      *                                                                   CSE032
     C           @RTCD     IFEQ *BLANK                                    CSE032
     C                     MOVE 'Y'       CSE032                          CSE032
     C                     END                                            CSE032
      *                                                                                       CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   PRTCD   7                                           CAS006
     C                     PARM '*VERIFY' POPTN   7                                           CAS006
     C                     PARM 'CAS006'  PSARD   6                                           CAS006
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS006
      *                                                                                       CAS006
     C           PRTCD     IFNE *BLANKS                                                       CAS006
     C           PRTCD     ANDNE'*NRF    '                                                    CAS006
     C           *LOCK     IN   LDA                                                           CAS006
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS006
     C                     Z-ADD46        DBASE                                               CAS006
     C                     MOVEL'CAS006'  DBKEY                                               CAS006
     C                     MOVE '1'       *INU7                                               CAS006
     C                     MOVE '1'       *INU8                                               CAS006
     C                     OUT  LDA                                                           CAS006
     C                     EXSR *PSSR                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           PRTCD     IFEQ *BLANKS                                                       CAS006
     C                     MOVE 'Y'       CAS006  1                                           CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'N'       CAS006                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CSE065
      ***  Check if CSE065 is installed.                                                      CSE065
      *                                                                                       CSE065
     C                     CALL 'AOSARDR0'                                                    CSE065
     C                     PARM *BLANKS   @RTCD   7                                           CSE065
     C                     PARM '*VERIFY' @OPTN   7                                           CSE065
     C                     PARM 'CSE065'  @SARD   6                                           CSE065
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE065
      *                                                                                       CSE065
      * Database Error                                                                        CSE065
      *                                                                                       CSE065
     C           @RTCD     IFNE *BLANKS                                                       CSE065
     C           @RTCD     ANDNE'*NRF'                                                        CSE065
     C           *LOCK     IN   LDA                                                           CSE065
     C                     MOVEL'SCSARDPD'DBFILE           ***************                    CSE065
     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 65 *                    CSE065
     C                     Z-ADD65        DBASE            ***************                    CSE065
     C                     OUT  LDA                                                           CSE065
     C                     SETON                     U7U8                                     CSE065
     C                     DUMP                                                               CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C           @RTCD     IFEQ *BLANK                                                        CSE065
     C                     MOVEL'Y'       CSE065  1                                           CSE065
     C                     ELSE                                                               CSE065
     C                     MOVEL'N'       CSE065                                              CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       228948
      ** If SE Hedge Accounting is ON (CAS006), access Hedge ICD                              228948
      *                                                                                       228948
     C           CAS006    IFEQ 'Y'                                                           228948
     C                     CALL 'AOHEDGR0'                                                    228948
     C                     PARM *BLANKS   PRTCD                                               228948
     C                     PARM '*FIRST ' POPTN                                               228948
     C           SDHEDG    PARM SDHEDG    DSSDY                                               228948
      *                                                                                       228948
     C           PRTCD     IFNE *BLANK                                                        228948
     C           *LOCK     IN   LDA                                                           228948
     C                     MOVEL'SDHEDGPD'DBFILE                                              228948
     C                     Z-ADD30        DBASE                                               228948
     C                     MOVEL'*FIRST'  DBKEY                                               228948
     C                     OUT  LDA                                                           228948
     C                     EXSR *PSSR                                                         228948
     C                     ENDIF                                                              228948
     C                     ENDIF                                                              228948
     C*
     C* Setup input parameters of accrual/profit date and                 S01117
     C* date next working day                                             S01117
     C*                                                                   S01117
     C                     Z-ADDDNWD      ZZDNWD                          S01117
     C                     Z-ADDAPDA      ZZAPDT                          S01117
     C*
     C* CALCULATE ACCRUAL CONTROL DATE
     C*
     C** Use ZEVCD to prevent incorrect calculation of accrual date       E20085
     C*
     C                     EXSR ZEVCD                                     E20085
     C*                                                                   E20085
     C           ACLD      IFEQ 'Y'
     C***********          Z-ADDAPDA      ACDT    50                      E20085
     C                     Z-ADDECD       ACDT    50                      E20085
     C                     ELSE
     C***********APDA      ADD  1         ACDT    50                      E20085
     C           ECD       ADD  1         ACDT    50                      E20085
     C                     END
      *                                                                   E20087
      ***  Get Data Area SESTAT                                           E20087
      *                                                                   E20087
     C           *NAMVAR   DEFN SESTAT    DTAARA                          E20087
     C                     IN   DTAARA                                    E20087
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2210CCP1                                           S01408
      *                                                                                       CSE105
      ** Access SAR details file to see if feature CSE105 is installed.                       CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSARDR0'                                                    CSE105
     C                     PARM '       ' @RTCD                                               CSE105
     C                     PARM '*VERIFY' @OPTN                                               CSE105
     C                     PARM 'CSE105'  @SARD                                               CSE105
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE105
      *                                                                                       CSE105
     C           @RTCD     IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'Y'       CSE105  1                                           CSE105
     C                     ELSE                                                               CSE105
     C                     MOVE 'N'       CSE105                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** Check system values if CSE105 is switched on                                         CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSVALR0'                                                    CSE105
     C                     PARM *BLANKS   @RTCD                                               CSE105
     C                     PARM SVALKK    SVALK1 20                                           CSE105
     C                     PARM           SVAL1 200                                           CSE105
     C                     PARM *BLANK    SVALK2 20                                           CSE105
     C                     PARM           SVAL2 200                                           CSE105
     C                     PARM *BLANK    SVALK3 20                                           CSE105
     C                     PARM           SVAL3 200                                           CSE105
     C                     PARM *BLANK    SVALK4 20                                           CSE105
     C                     PARM           SVAL4 200                                           CSE105
     C                     PARM *BLANK    SVALK5 20                                           CSE105
     C                     PARM           SVAL5 200                                           CSE105
     C                     PARM *BLANK    SVALK6 20                                           CSE105
     C                     PARM           SVAL6 200                                           CSE105
     C                     PARM *BLANK    SVALK7 20                                           CSE105
     C                     PARM           SVAL7 200                                           CSE105
     C                     PARM *BLANK    SVALK8 20                                           CSE105
     C                     PARM           SVAL8 200                                           CSE105
     C                     PARM *BLANK    SVALK9 20                                           CSE105
     C                     PARM           SVAL9 200                                           CSE105
     C                     PARM *BLANK    SVALK0 20                                           CSE105
     C                     PARM           SVAL10200                                           CSE105
      *                                                                                       CSE105
     C           @RTCD     IFNE *BLANKS                                                       CSE105
     C           *LOCK     IN   LDA                                                           CSE105
     C                     MOVE 'SDSVALPD'DBFILE                                              CSE105
     C                     MOVELSVALK1    DBKEY                                               CSE105
     C                     Z-ADD15        DBASE                                               CSE105
     C                     OUT  LDA                                                           CSE105
     C                     EXSR *PSSR                                                         CSE105
     C                     SETON                       U7U8                                   CSE105
     C                     ELSE                                                               CSE105
     C                     MOVELSVAL1     SESVAL  1                                           CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C           SESVAL    IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'V'       SESVAL                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
     C*                                                                   S01408
      *                                                                                       CSE075
      ** Access SAR details file to see if CSE075 is installed                                CSE075
      *                                                                                       CSE075
     C                     CALL 'AOSARDR0'                                                    CSE075
     C                     PARM *BLANKS   PRTCD   7                                           CSE075
     C                     PARM '*VERIFY' POPTN   7                                           CSE075
     C                     PARM 'CSE075'  PSARD   6                                           CSE075
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE075
      *                                                                                       CSE075
     C           PRTCD     IFNE *BLANKS                                                       CSE075
     C           PRTCD     ANDNE'*NRF    '                                                    CSE075
     C           *LOCK     IN   LDA                                                           CSE075
     C                     MOVE 'SCSARDPD'DBFILE                                              CSE075
     C                     Z-ADD47        DBASE                                               CSE075
     C                     MOVEL'CSE075 ' DBKEY                                               CSE075
     C                     MOVE *ON       *INU7                                               CSE075
     C                     MOVE *ON       *INU8                                               CSE075
     C                     OUT  LDA                                                           CSE075
     C                     EXSR *PSSR                                                         CSE075
     C                     ENDIF                                                              CSE075
      *                                                                                       CSE075
     C           PRTCD     IFEQ *BLANKS                                                       CSE075
     C                     MOVE 'Y'       CSE075  1                                           CSE075
     C                     ELSE                                                               CSE075
     C                     MOVE 'N'       CSE075                                              CSE075
     C                     ENDIF                                                              CSE075
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  @SARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE036 is installed                                CSE036
      *                                                                                       CSE036
     C                     CALL 'AOSARDR0'                                                    CSE036
     C                     PARM *BLANKS   @RTCD                                               CSE036
     C                     PARM '*VERIFY' @OPTN                                               CSE036
     C                     PARM 'CSE036'  @SARD                                               CSE036
      *                                                                                       CSE036
     C           @RTCD     IFEQ *BLANK                                                        CSE036
     C                     MOVE 'Y'       CSE036  1                                           CSE036
     C                     ELSE                                                               CSE036
     C                     MOVE 'N'       CSE036                                              CSE036
     C                     ENDIF                                                              CSE036
      *                                                                   CSE006
      *** Define work fields                                              CSE006
      *                                                                   CSE006
     C           *LIKE     DEFN APNC      AMNT                            CSE006
      *                                                                                       CSE065
     C           *LIKE     DEFN SESN      K@SVSN                                              CSE065
     C           *LIKE     DEFN SDET      K@SDET                                              CSE065
     C           *LIKE     DEFN SDAL      K@SDED                                              CSE065
     C           *LIKE     DEFN MATY      W@MATY                                              CSE065
     C           *LIKE     DEFN LATD      W@LATD                                              CSE065
     C           *LIKE     DEFN LPSD      W@LPSD                                              CSE065
     C           *LIKE     DEFN LPCD      W@LPCD                                              CSE065
     C           *LIKE     DEFN WADP      WWADP                                               CSE065
     C           *LIKE     DEFN WEDN      WWEDN                                               CSE065
     C           *LIKE     DEFN WADP      W@QAMT                                              CSE065
     C           *LIKE     DEFN WADP      W@QDIF                                              CSE065
     C           *LIKE     DEFN ACDT      W@ACDT                                              CSE065
      *                                                                                       CSE065
     C                     Z-ADD*ZEROS    W@NDY1  50                                          CSE065
     C                     Z-ADD*ZEROS    W@NDY2  50                                          CSE065
     C                     MOVE *BLANK    WAMORT  1                                           CSE065
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * UNRLPL  -  SUBROUTINE TO CALCULATE UNREALIZED PROFIT/LOSS AND *
      *              TO OUTPUT UNREALIZED P/L ACCOUNT KEYS            *
      *                                                               *
      *****************************************************************
      *
     C           UNRLPL    BEGSR                           **  UNRLPL **
     C*
     C**UNREALISED*P/L*IS*SET*TO*ZERO*OF*MARKET*PRICE*IS*ZERO********     091803
     C*
     C           MKPR      IFEQ 0
     C*                                                                   091803
     C** IF MARKET PRICE EQUALS TO ZERO CHAIN TO PRICED FILE IF A         091803
     C** PRICE EXISTS.                                                    091803
     C*                                                                   091803
     C                     MOVE BHSC      PSSN                            091803
     C                     MOVE 'V '      PPRT                            091803
     C                     Z-ADDECD       PVDT                            091803
     C*                                                                   091803
     C           PKEY      SETGTPRICED                                    091803
     C                     READPPRICED                   21               091803
     C*                                                                   091803
     C           *IN21     IFEQ *OFF                                      091803
     C           PSSN      ANDEQBHSC                                      091803
     C           PPRT      ANDEQ'V '                                      091803
     C           PPRC      ANDEQ0                                         091803
     C                     SETOF                         22               091803
     C                     ELSE                                           091803
     C                     SETON                         22               091803
     C                     END                                            091803
     C*                                                                   091803
     C                     END                                            091803
     C*                                                                   091803
     C** IF MARKET PRICE EXISTS BUT ZERO DO UNREALISED P/L                091803
     C** PROCESSING.                                                      091803
     C*                                                                   091803
     C           *IN22     IFEQ *ON                                       091803
     C                     SETOF                         22               091803
     C                     Z-ADD0         UPPT
     C                     ELSE
     C*
     C* STORE UNREALISED P/L AS PREVIOUS
     C*
     C                     Z-ADDUPPT      PUPPT  130
     C*                                                                   E20087
     C***If*this*is*a*discount-based*trade*date*position,*calculateE20087 E20552
     C***unrealized*P/L*trade-by-trade*in*SR/ADJUPL*(FIFO only).***E20087 E20552
     C***********BHTV      IFEQ 'T'                                E20087 E20552
     C***********STBS      ANDEQ'D'                                E20087 E20552
     C***********FIFO      ANDEQ'Y'                                E20087 E20552
     C***********          EXSR ADJUPL                             E20087 E20552
     C***********          Z-ADDWKUPPT    UPPT                     E20087 E20552
     C***********          ELSE                                    E20087 E20552
     C*
     C* CONVERT MARKET PRICE FROM PRICE/DISC/YIELD FORMAT TO PRICE
     C*  FORMAT
     C*
     C***********          Z-ADDRUND      ZFDATE                          E15965
     C*                                                                   E20087
     C** Since book price already reflects amortization through the       E20087
     C** accrue-to date, ACDT is the correct date for price conversion.   E20087
     C*                                                                   E20087
     C***********          Z-ADDECD       ZFDATE                   E15965 E20087
      *                                                                                      BUG8858
      ** Save the From-date before calculation of price since this value                     BUG8858
      ** can be changed if this is a yield based instrument                                  BUG8858
      ** or discount based instrument                                                        099883
      *                                                                                      BUG8858
     C                     Z-ADDACDT      @BACDT  50                                         BUG8858
     C           STBS      IFEQ 'Y'                                                          BUG8858
     C           ACLD      ANDNE'Y'                                                          BUG8858
     C           STBS      OREQ 'D'                                                          099883
     C           ACLD      ANDNE'Y'                                                          099883
     C           ACDT      SUB  1         ZFDATE                                             BUG8858
     C                     ELSE                                                              BUG8858
     C                     Z-ADDACDT      ZFDATE                          E20087
     C                     ENDIF                                                             BUG8858
     C*                                                                   E20087
     C                     Z-ADDMKPR      ZPRCIN
     C*                                                                   S01232
     C*     SET UP AUSTRALIAN YIELD PARAMETERS                            S01232
     C*                                                                   S01232
     C/COPY WNCPYSRC,SE2210C004
     C           *IN52     IFEQ '1'                                       S01232
     C           NPSN      ANDNE0                                         S01232
     C*                                                                   E20953
     C* Set Nominal to positive for working on                            E20953
     C*                                                                   E20953
     C           NPSN      IFLT 0                                         E20953
     C                     Z-SUBNPSN      WNOML  130                      E20953
     C                     ELSE                                           E20953
     C                     Z-ADDNPSN      WNOML                           E20953
     C                     END                                            E20953
     C/COPY WNCPYSRC,SE2210C005
     C*                                                                   E20953
     C* Save Event Control Date.                                          E22957
     C*                                                                   E20953
     C                     Z-ADDECD       ECDPRV  50                      E22957
     C*                                                                   E22957
     C* Obtain next coupon date                                           E22957
     C* (Add 1 to ECD so that if ZFDATE=NCD,calculate NCD after that)     E22957
     C*                                                                   E22957
     C           ZFDATE    ADD  1         ECD                             E22957
     C                     EXSR ZNCD                                      E22957
     C*                                                                   E22957
     C* Obtain last coupon date                                           E22957
     C*                                                                   E22957
     C           NCD       SUB  1         ZECD                            E22957
     C                     EXSR ZLCD                                      E22957
     C                     Z-ADDZZLCD     LCOUP   50                      E22957
     C*                                                                   E20953
     C* Determine if period Cum or Ex                                     E20953
     C*                                                                   E20953
     C***********          Z-ADDECD       WRKD    50               E20953 E22957
     C                     Z-ADDZFDATE    WRKD    50                      E22957
     C                     EXSR ZYCE                                      E20953
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C                     Z-ADDWNOML     ZAMT                                                CSE035
     C                     Z-ADDLCOUP     ZDCSDT                                              CSE035
     C                     Z-ADDZFDATE    ZDCEDT                                              CSE035
     C                     EXSR ZACCZ                                                         CSE035
     C                     Z-ADDZDCINT    TOTACC                                              CSE035
     C                     Z-ADDZDCINT    WRKPIX                                              CSE035
      *                                                                                       CSE035
     C                     ELSE                                                               CSE035
     C*                                                                   E20953
     C* Calculate interest for Cum period (SCUMEX = C)                    E20953
     C*                                                                   E20953
     C/COPY WNCPYSRC,SE2210C039
     C           SCUMEX    IFEQ 'C'                                       E20953
     C/COPY WNCPYSRC,SE2210C040
     C***********          Z-ADDNPSN      ZAMT                     S01232 E20953
     C                     Z-ADDWNOML     ZAMT                            E20953
     C***********          Z-ADDLCPN      ZDCSDT                   S01232 E22957
     C***********          Z-ADDECD       ZDCEDT                   S01232 E22957
     C                     Z-ADDLCOUP     ZDCSDT                          E22957
     C                     Z-ADDZFDATE    ZDCEDT                          E22957
     C/COPY WNCPYSRC,SE2210C009
     C                     EXSR ZACCZ                                     S01232
     C/COPY WNCPYSRC,SE2210C010
     C                     Z-ADDZDCINT    TOTACC                          E20953
     C                     Z-ADDZDCINT    WRKPIX                          E22957
     C***********ZDCINT    DIV  NPSN      WRKPI                    S01232 E20953
     C***********          Z-ADDECD       WRKD    50               S01232 E20953
     C***********          EXSR ZYCE                               S01232 E20953
     C*                                                                   E20953
     C**Calculate*the*Accrued*Interest*on*the*Ex-Coupon*Nominal*   E20953 E22957
     C***********                                                  E20953 E22957
     C***********ECNP      IFEQ 0                                  E20953 E22957
     C***********          Z-ADD0         WTCPN                    E20953 E22957
     C***********          ELSE                                    E20953 E22957
     C***********          Z-ADDLCPN      ZDCSDT                   E20953 E22957
     C***********          Z-ADDNCD       ZDCEDT                   E20953 E22957
     C***********ECNP      IFLT 0                                  E20953 E22957
     C***********          Z-SUBECNP      ZAMT                     E20953 E22957
     C***********          ELSE                                    E20953 E22957
     C***********          Z-ADDECNP      ZAMT                     E20953 E22957
     C***********          END                                     E20953 E22957
     C***********          EXSR ZACCZ                              E20953 E22957
     C***********          Z-ADDZDCINT    WTCPN                    E20953 E22957
     C***********          END                                     E20953 E22957
     C***********                                                  E20953 E22957
     C***********TOTACC    SUB  WTCPN     WRKPIX                   E20953 E22957
     C***********WRKPIX    IFLE 0                                  E20953 E22957
     C***********          MOVE 'X'       SCUMEX                   E20953 E22957
     C***********          END                                     E20953 E22957
     C*                                                                   E20953
     C/COPY WNCPYSRC,SE2210C041
     C                     END                                            E20953
     C/COPY WNCPYSRC,SE2210C042
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C*                                                                   S01232
     C*   IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST           S01232
     C*   TILL NCD AND IS NEGATIVE                                        S01232
     C*                                                                   S01232
     C           SCUMEX    IFEQ 'X'                                       S01232
     C***********          Z-ADDLCPN      ZDCSDT                   S01232 E22957
     C                     Z-ADDLCOUP     ZDCSDT                          E22957
     C                     Z-ADDNCD       ZDCEDT                          S01232
     C                     Z-ADDWNOML     ZAMT                            E20953
     C/COPY WNCPYSRC,SE2210C011
     C                     EXSR ZACCZ                                     S01232
     C/COPY WNCPYSRC,SE2210C012
     C***********ZDCINT    DIV  NPSN      WKWPI  159               S01232 E20953
     C***********WRKPI     SUB  WKWPI     WRKPI                    S01232 E20953
     C                     Z-ADDZDCINT    NCDWRK                          E20953
     C*                                                                   E20953
     C* Calculate interest to Next Coupon Date                            E20953
     C*                                                                   E20953
     C***********          Z-ADDLCPN      ZDCSDT                   E20953 E22957
     C***********          Z-ADDECD       ZDCEDT                   E20953 E22957
     C                     Z-ADDLCOUP     ZDCSDT                          E22957
     C                     Z-ADDZFDATE    ZDCEDT                          E22957
     C/COPY WNCPYSRC,SE2210C013
     C                     EXSR ZACCZ                                     E20953
     C/COPY WNCPYSRC,SE2210C014
     C                     Z-ADDZDCINT    LCDWRK                          E20953
     C*                                                                   E20953
     C           LCDWRK    SUB  NCDWRK    WRKPIX                          E20953
     C*                                                                   E20953
     C                     END                                            E20953
     C*                                                                   E20953
     C* Make interest figure a percentage                                 E20953
     C*                                                                   E20953
     C           WRKPIX    DIV  WNOML     WRKPI                           E20953
     C*                                                                   E20953
     C* Return old Event Control Date                                     E22957
     C*                                                                   E20953
     C                     Z-ADDECDPRV    ECD                             E22957
     C*                                                                   E20953
     C***********          END                                     S01232 E20953
     C*                                                                   E20953
     C                     ELSE                                           S01232
     C                     Z-ADD0         WRKPI                           S01232
     C                     MOVE 'C'       SCUMEX                          S01232
     C                     END                                            S01232
     C*                                                                   E39495
     C                     Z-ADDNPSN      ZNOML                           E39495
     C*                                                                   S01232
     C                     EXSR ZPRCI
     C                     Z-ADD@BACDT    ZFDATE                                             BUG8858
     C*
     C*  CALCULATE PRICE DIFFERENCE
     C*
     C/COPY WNCPYSRC,SE2210C072
     C           ZPRCOT    SUB  LAVP      WPRICE 158
     C*
     C* OBTAIN NEW UNREALISED P/L
     C*
     C***********NPSN      MULT WPRICE    UPPT                            E21097
     C***********          Z-ADD*ZEROS    WVAL   150                      E21097
     C***********          Z-ADD*ZEROS    WVAL0  150                      E21097
     C***********          Z-ADD*ZEROS    WVAL1  151                      E21097
     C***********          Z-ADD*ZEROS    WVAL2  152                      E21097
     C***********          Z-ADD*ZEROS    WVAL3  153                      E21097
     C***********          MOVEA'0000'    *IN,35                          E21097
     C***********35        ADD  CDP       J       20                      E21097
     C***********          MOVEA'1'       *IN,J                           E21097
     C***35******NPSN      MULT WPRICE    WVAL0                           E21097
     C***36******NPSN      MULT WPRICE    WVAL1                           E21097
     C***37******NPSN      MULT WPRICE    WVAL2                           E21097
     C***38******NPSN      MULT WPRICE    WVAL3                           E21097
     C***********                                                         E21097
     C***35******          MOVE WVAL0     WVAL                            E21097
     C***36******          MOVE WVAL1     WVAL                            E21097
     C***37******          MOVE WVAL2     WVAL                            E21097
     C***38******          MOVE WVAL3     WVAL                            E21097
     C***********                                                         E21097
     C**allow*for*nominal**decimal*places******************************   E21097
     C***********                                                         E21097
     C***********5         SUB  NMDP      DC      10                      E21097
     C***********WVAL      MULT POWER8,DC UPPT                            E21097
     C***********                                                         E21097
     C***********SPBS      IFEQ 'P'                                       E21097
     C***********UPPT      DIV  100       UPPT      H                     E21097
     C***********          END                                            E21097
     C*                                                                   E21097
     C                     Z-ADDNPSN      ZNOML                           E21097
     C                     Z-ADDWPRICE    ZPRC                            E21097
     C                     EXSR ZCNSD                                     E21097
     C                     Z-ADDZCONS     UPPT                            E21097
     C*                                                                   103946
     C* Adjust posting amount by the mortgage factor                      103946
     C*                                                                   103946
     C           PROT      IFEQ '8'                                       103946
     C                     EXSR FACTOR                                    103946
     C                     END                                            103946
     C*                                                                   E21097
     C***********PROT      IFEQ '8'                                       E20086
     C***********UPPT      MULT CFCT      UPPT      H                     E20086
     C***********          END                                            E20086
     C*                                                                   E20087
     C***********          END                                     E20087 E20552
     C*
     C* SET COMMON FIELDS FOR ACCOUNT KEYS
     C*
     C                     MOVE 'A'       EVTP
     C                     MOVE BHTV      PSBS
     C                     MOVE ' '       FILL
     C*****************************************************************                E20125 246619
     C***ALLOW*NEGATIVE*POSITION*ACCOUNTING*FOR*UNREALIZED*P/L.********                E20125 246619
     C*****************************************************************                E20125 246619
     C********** NPSN      IFGE 0                                                      E20125 246619
     C********** NPAC      OREQ 'N'                                                    E20125 246619
     C**********           MOVE ' '       NEGI                                                246619
     C**********           ELSE                                                        E20125 246619
     C**********           MOVE 'N'       NEGI                                         E20125 246619
     C**********           END                                                         E20125 246619
     C/COPY WNCPYSRC,SE2210C067
     C*
     C* SET INDICATOR FOR NEW AND PREVIOUS UNREALISED P/L
     C*
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C**********           MOVE '0'       *IN30                                       CAS006  248351
     C**********           MOVE '1'       *IN30                                        248351 249688
     C                     MOVE '0'       *IN30                                               249688
     C                     ELSE                                                               CAS006
      *                                                                                       246619
      ** Check move of nominal from short to long and vice versa                              246619
      *                                                                                       246619
     C           PNOM      IFGE 0                                                             246619
     C           NPSN      ANDGE0                                                             246619
     C           PNOM      ORLE 0                                                             246619
     C           NPSN      ANDLE0                                                             246619
      *                                                                                       246619
     C           UPPT      IFLE 0
     C           PUPPT     ANDLE0
     C                     MOVE '1'       *IN30
     C                     ELSE
     C           UPPT      IFGE 0
     C           PUPPT     ANDGE0
     C                     MOVE '1'       *IN30
     C                     END
     C                     END
      *                                                                                       246619
     C                     ENDIF                                                              246619
     C                     ENDIF                                                              CAS006
     C*
     C*  PRODUCE ACCOUNT KEYS IF NEW UNREALISED P/L GREATER THAN 0
     C*  AND POSTING BASIS IS NOT 'L' OR NEW UNREALISED P/L IS LESS
     C*  THAN ZERO AND PROFIT POSTING IS NOT 'P'
     C*
     C           UPPT      IFGT 0
     C           UPPS      ANDNE'L'
     C                     GOTO UNRLKY
     C                     ELSE
     C           UPPT      IFLT 0
     C           UPPS      ANDNE'P'
     C                     GOTO UNRLKY
     C                     ELSE
     C           PUPPT     IFGT 0                                         E15965
     C           UPPS      ANDNE'L'                                       E15965
     C                     GOTO UNRLKY                                    E15965
     C                     END                                            E15965
     C           PUPPT     IFLT 0                                         E15965
     C           UPPS      ANDNE'P'                                       E15965
     C                     GOTO UNRLKY                                    E15965
     C                     END                                            E15965
      *                                                                                       228110
      **  Accrued interest to date should be considered as the current                        228110
      **  profit/loss if market price entered results to zero profit                          228110
      **  or loss.                                                                            228110
      *                                                                                       228110
     C           CAS006    IFEQ 'Y'                                                           228110
     C           WPRICE    ANDEQ0                                                             228110
     C           ARPC      ANDNE0                                                             228110
     C                     GOTO UNRLKY                                                        228110
     C                     ENDIF                                                              228110
      *                                                                                       228110
     C                     GOTO EURLPL
     C                     END
     C                     END
     C*
     C           UNRLKY    TAG
     C*
     C*  -  PRODUCE ONE KEY IF PREVIOUS AND NEW UNREAL. P/L BOTH LESS
     C*      THAN OR BOTH GREATER THAN 0
     C*
     C           *IN30     IFEQ '1'
     C*
     C           UPPT      IFGT 0
     C*                                                                   E19445
     C** Since UPPT may be zero, need to check PUPPT as well in deter-    E19445
     C** mining whether this posting is a change to profit or loss.       E19445
     C*                                                                   E19445
     C           PUPPT     ORGT 0                                         E19445
     C                     MOVE 'UP'      AMCD
     C                     ELSE
     C                     MOVE 'UL'      AMCD
     C                     END
      *                                                                                       246619
      ** Allow Negative Position Accounting for Unrealized P/L:  NEGI                         246619
      ** should be 'N' for Unrealized P/L on short posn if NPAC = 'Y'.                        246619
      *                                                                                       246619
     C           NPSN      IFGE 0                                                             246619
     C           PNOM      ANDGE0                                                             246619
     C           NPAC      OREQ 'N'                                                           246619
     C                     MOVE ' '       NEGI                                                246619
     C                     ELSE                                                               246619
     C                     MOVE 'N'       NEGI                                                246619
     C                     ENDIF                                                              246619
     C*
     C           UPPT      SUB  PUPPT     EVAM
     C           UPPT      IFLT 0
     C*                                                                   E19445
     C           PUPPT     ORLT 0                                         E19445
     C*                                                                   E19445
     C** If calculating change to UL, have just subtracted a negative     E19444
     C*  PUPPT; must reverse sign regardless of whether EVAM is +/-ve.    E19444
     C*                                                                   E19444
     C***********EVAM      ANDLT0                                         E19444
     C           EVAM      MULT -1        EVAM
     C                     END
      *                                                                   E20086
     C**Adjust*posting*amount*by*the*mortgage*factor***************E20086 103946
     C*************************************************************E20086 103946
     C***********PROT      IFEQ '8'                                E20086 103946
     C***********          MULT AAPR      EVAM                     E20086 055427
     C***********          MULT CFCT      EVAM                     055427 103946
     C***********          EXSR FACTOR                             099885 103946
     C***********          END                                     E20086 103946
     C/COPY WNCPYSRC,SE2210C053
     C*
     C           EVAM      IFNE 0
     C                     EXSR WRITED
     C                     END
     C*
     C*  ELSE PRODUCE TWO KEYS IF TRADE MOVES FROM PROFIT TO LOSS OR
     C*  FROM LOSS TO PROFIT
     C*
     C                     ELSE
     C/COPY WNCPYSRC,SE2210C066
     C*
     C*  -  PRODUCE REVERSAL KEY FOR UNRL P/L
     C*
     C           PUPPT     IFGT 0
     C                     MOVE 'UP'      AMCD
     C                     ELSE
     C                     MOVE 'UL'      AMCD
     C                     END
      *                                                                                       246619
      ** Allow Negative Position Accounting for Unrealized P/L:  NEGI                         246619
      ** should be 'N' for Unrealized P/L on short posn if NPAC = 'Y'.                        246619
      *                                                                                       246619
     C           PNOM      IFGE 0                                                             246619
     C           NPAC      OREQ 'N'                                                           246619
     C                     MOVE ' '       NEGI                                                246619
     C                     ELSE                                                               246619
     C                     MOVE 'N'       NEGI                                                246619
     C                     ENDIF                                                              246619
     C*
     C           PUPPT     IFGT 0
     C           PUPPT     MULT -1        EVAM
     C                     ELSE
     C                     Z-ADDPUPPT     EVAM
     C                     END
     C*************************************************************E20086 103946
     C**Adjust*posting*amount*by*the*mortgage*factor***************E20086 103946
     C*************************************************************E20086 103946
     C***********PROT      IFEQ '8'                                E20086 103946
     C***********          MULT AAPR      EVAM                      E20086099885
     C***********          EXSR FACTOR                             099885 103946
     C***********          END                                     E20086 103946
     C*COPY WNCPYSRC,SE2210C054      **SOURCE NOT FOUND**
     C*
     C           EVAM      IFNE 0
     C           AMCD      ANDEQ'UL'                                      174050
     C           UPPS      ANDNE'P'                                       174050
     C           EVAM      ORNE 0                                         174050
     C           AMCD      ANDEQ'UP'                                      174050
     C           UPPS      ANDNE'L'                                       174050
     C                     EXSR WRITED
     C                     END
     C*
     C*  -  PRODUCE  KEY FOR NEW UNRL. P/L
     C*
     C           UPPT      IFGT 0
     C                     MOVE 'UP'      AMCD
     C                     ELSE
     C                     MOVE 'UL'      AMCD
     C                     END
      *                                                                                       246619
      ** Allow Negative Position Accounting for Unrealized P/L:- NEGI                         246619
      ** should be 'N' for Unrealized P/L on short posn if NPAC = 'Y'.                        246619
      *                                                                                       246619
     C           NPSN      IFGE 0                                                             246619
     C           NPAC      OREQ 'N'                                                           246619
     C                     MOVE ' '       NEGI                                                246619
     C                     ELSE                                                               246619
     C                     MOVE 'N'       NEGI                                                246619
     C                     ENDIF                                                              246619
     C*
     C           UPPT      IFLT 0
     C           UPPT      MULT -1        EVAM
     C                     ELSE
     C                     Z-ADDUPPT      EVAM
     C                     END
     C*************************************************************E20086 103946
     C**Adjust*posting*amount*by*the*mortgage*factor***************E20086 103946
     C*************************************************************E20086 103946
     C********** PROT      IFEQ '8'                                E20086 103946
     C***********          MULT AAPR      EVAM                     E20086 099885
     C***********          EXSR FACTOR                             099885 103946
     C***********          END                                     E20086 103946
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           UPPT      IFGT 0                                                             CAS006
     C                     Z-ADDEVAM      WEVAM  150                                          CAS006
     C                     ELSE                                                               CAS006
     C                     Z-SUBEVAM      WEVAM                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       228948
      ** Do not add accrued interest in UP/UL if 'Supress Accrued                             228948
      ** Interest..' indicator in Hedge ICD is set to 'Y'.                                    228948
      *                                                                                       228948
     C           FSEXRL    IFEQ 'Y'                                                           228948
     C                     ADD  ARPC      WEVAM                                               CAS006
     C                     ENDIF                                                              228948
      *                                                                                       228948
     C                     Z-ADDWEVAM     UPPT                                                CAS006
      *                                                                                       CAS006
     C           UPPT      IFGT 0                                                             CAS006
     C                     MOVE 'UP'      AMCD                                                CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'UL'      AMCD                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           UPPT      IFLT 0                                                             CAS006
     C           UPPT      MULT -1        EVAM                                                CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADDUPPT      EVAM                                                CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C/COPY WNCPYSRC,SE2210C055
     C*
     C           EVAM      IFNE 0
     C           AMCD      ANDEQ'UL'                                      174050
     C           UPPS      ANDNE'P'                                       174050
     C           EVAM      ORNE 0                                         174050
     C           AMCD      ANDEQ'UP'                                      174050
     C           UPPS      ANDNE'L'                                       174050
     C                     EXSR WRITED
     C                     END
     C*
     C                     END
     C                     END
     C*
     C           EURLPL    ENDSR                           ** EURLPL **
      *
      *****************************************************************
      /EJECT                                                              E20087
      ************************************************************ E20087 E20552
      ***********                                                  E20087 E20552
      ***ADJUPL*-*Adjust*the*Unrealized*Profit/Loss*for*Discounted E20087 E20552
      ************Trade*Date*Positions.*************************** E20087 E20552
      ***********                                                  E20087 E20552
      ************************************************************ E20087 E20552
     C***********                                                  E20087 E20552
     C***********ADJUPL    BEGSR                                   E20087 E20552
     C***********                                                  E20087 E20552
     C**CLEAR*'CURRENT*FIFO*TRADE*FOUND'*INDICATOR*AND*ACCUMULATOR*FIELDS.E20552
     C***********          MOVE '0'       *IN82                    E20087 E20552
     C***********          Z-ADD0         TOTBC                    E20087 E20552
     C***********          Z-ADD0         TOTMV                    E20087 E20552
     C***********                                                  E20087 E20552
     C***********          MOVE BHTR      BHTRA   6                E20087 E20552
      ***********                                                  E20087 E20552
     C***********TRDKEY    CHAINTRADSDF              81            E20087 E20552
     C***********                                                  E20087 E20552
     C***LOOP*FOR*ALL*TRADES*FOR*THIS*POSITION*********************E20087 E20552
     C************IN81     DOWEQ'0'                                E20087 E20552
     C***********                                                  E20087 E20552
     C***********RECI      IFNE '*'                                E20087 E20552
     C***********TINC      ANDEQ'C'                                E20087 E20552
     C***********                                                  E20087 E20552
     C***IF*CURRENT*FIFO*TRADE,*USE*REMAINING*UNLIQUIDATED*NOMINAL*E20087 E20552
     C************IN82     IFEQ '0'                                E20087 E20552
     C***********TDRF      ANDEQBHTRA                              E20087 E20552
     C***********                                                  E20087 E20552
     C***********          MOVE '1'       *IN82                    E20087 E20552
     C***********          Z-ADDBHRN      NOML                     E20087 E20552
     C***********          MOVE TDTP      STDTP   2                E20087 E20552
     C***********                                                  E20087 E20552
     C***CONVERT*MARKET*DISCOUNT*RATE*TO*CURRENT*PERCENTAGE*PRICE**E20087 E20552
     C***********          Z-ADDMKPR      ZPRCIN                   E20087 E20552
     C***********          Z-ADDACDT      ZFDATE                   E20087 E20552
     C***********          EXSR ZPRCI                              E20087 E20552
     C***********          Z-ADDZPRCOT    MPCURR 158               E20087 E20552
     C***********                                                  E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***ONLY*PROCESS*CURRENT*FIFO*TRADE*AND*LATER*TRADES*OF*SAME*TYPE.87 E20552
     C************IN82     IFEQ '1'                                E20087 E20552
     C***********TDTP      ANDEQSTDTP                              E20087 E20552
     C***********          EXSR ACCUM                              E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********TRDKEY    READETRADSDF                8181        E20087 E20552
     C***********                                                  E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***Calculate*unrealized*P/L*using*accumulated*values.******* E20087 E20552
     C************IN82     IFEQ '1'                                E20087 E20552
     C***********TOTMV     SUB  TOTBC     WKUPPT 150               E20087 E20552
     C***Adjust*for*percentage*pricing.*************************** E20087 E20552
     C***********WKUPPT    DIV  100       WKUPPT                   E20087 E20552
     C***********                                                  E20087 E20552
     C***Update*average*price************************************* E20087 E20552
     C***********5         ADD  CDP       DC      10               E20087 E20552
     C***********NPSN      MULT POWER8,DC POS150 150               E20087 E20552
     C***********TOTBC     DIV  POS150    LAVP      H              E20087 E20552
     C***********                                                  E20087 E20552
     C***********          ELSE                                    E20087 E20552
     C***********          Z-ADD0         WKUPPT                   E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********          ENDSR                                   E20087 E20552
      ***********                                                  E20087 E20552
      ************************************************************ E20087 E20552
      /EJECT                                                              E20087
      ************************************************************ E20087 E20552
      ***********                                                  E20087 E20552
      ***ACCUM*-*Subroutine*to*accumulate*the*Adjusted*Consideration 0087 E20552
      ***********from*Trades.************************************* E20087 E20552
      ***********                                                  E20087 E20552
      ************************************************************ E20087 E20552
      ***********                                                  E20087 E20552
     C***********ACCUM     BEGSR                                   E20087 E20552
     C***********                                                  E20087 E20552
     C***IF*TRADE*HAS*REACHED*VALUE,*CONVERT*DISCOUNT*TO*PRICE*AS*OF*ACDT.E20552
     C***OTHERWISE,*USE*PERCENTAGE*PRICE*(PRIC)*FROM*TRADE*RECORD. E20087 E20552
     C***********TDVD      IFLE ACDT                               E20087 E20552
     C***********          Z-ADDTPDY      ZPRCIN                   E20087 E20552
     C***********          Z-ADDACDT      ZFDATE                   E20087 E20552
     C***********          EXSR ZPRCI                              E20087 E20552
     C***********          Z-ADDZPRCOT    PRIC                     E20087 E20552
     C***********          END                                     E20087 E20552
      ***********                                                  E20087 E20552
     C***CALCULATE*ADJUSTED*BOOK*COST******************************E20087 E20552
     C***********5         ADD  CDP       DC      10               E20087 E20552
     C***********NOML      MULT POWER8,DC WRK150 150               E20087 E20552
     C***********WRK150    MULT PRIC      BKCT   150H              E20087 E20552
      ***********                                                  E20087 E20552
     C***ACCUMULATE*BOOK*COST************************************* E20087 E20552
     C***********          ADD  BKCT      TOTBC  150               E20087 E20552
     C***********                                                  E20087 E20552
     C***MARKET*PRICE/VALUE*CALCULATIONS************************** E20087 E20552
     C***********                                                  E20087 E20552
     C***IF*TRADE*HASN'T*REACHED*VALUE,*CONVERT*MARKET*DISCOUNT*TO*PRICE  E20552
     C***AS*OF*TDVD;*ELSE*USE*PRICE*AS*OF*ACDT*CALCULATED*IN*SR/ADJUPL. 7 E20552
     C***********TDVD      IFGT ACDT                               E20087 E20552
     C***********          Z-ADDMKPR      ZPRCIN                   E20087 E20552
     C***********          Z-ADDTDVD      ZFDATE                   E20087 E20552
     C***********          EXSR ZPRCI                              E20087 E20552
     C***********WRK150    MULT ZPRCOT    MKVL   150H              E20087 E20552
     C***********          ELSE                                    E20087 E20552
     C***********WRK150    MULT MPCURR    MKVL      H              E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***ACCUMULATE*MARKET*VALUE********************************** E20087 E20552
     C***********          ADD  MKVL      TOTMV  150               E20087 E20552
     C***********                                                  E20087 E20552
     C***********          ENDSR                                   E20087 E20552
      ***********                                                  E20087 E20552
      ************************************************************ E20087 E20552
      /EJECT
      *****************************************************************
      *                                                               *
      *   AMORT  - SUBROUTINE TO AMORTIZE DISCOUNT/PREMIUM            *
      *                                                               *
      *****************************************************************
      *
     C           AMORT     BEGSR                           **  AMORT **
     C*                                                                   E15442
     C* ONLY AMORTIZE INTEREST-BEARING SECURITIES                         E15442
     C*                                                                   E15442
     C           PROT      IFEQ '2'                                       E15442
     C           PROT      OREQ '4'                                       E15442
     C           PROT      OREQ '7'                                       E15442
     C                     GOTO EAMORT                                    E15442
     C/COPY WNCPYSRC,SE2210C008
     C                     END                                            E15442
     C/COPY WNCPYSRC,SE2210C003
     C*
     C**For*Trade*date*positions,*do*not*amortize*discount*on*trades 0087 E20552
     C**which*have*not*reached*value.******************************E20087 E20552
     C***********          Z-ADDBUDU      WKBUDU 150               E20087 E20552
     C***********BHTV      IFEQ 'T'                                E20087 E20552
     C***********SPBS      ANDEQ'P'                                E20087 E20552
     C***********FIFO      ANDEQ'Y'                                E20087 E20552
     C***********          EXSR ADJBUD                             E20087 E20552
     C***********          END                                     E20087 E20552
     C*
     C* DISCOUNT/PREMIUM AMORTISED ONLY IF NOT EQUAL ZERO
     C*
     C***********BUDU      IFNE 0                                         E20087
     C***********WKBUDU    IFNE 0                                  E20087 E20552
     C           CSE032    IFNE 'Y'                                       CSE032
     C           BUDU      IFNE 0                                         E20552
     C********** STAD      OREQ 'C'                                055893 111157
     C********** SYBS      ANDEQ'AU'                               055893 111157
     C********** NPSN      ANDNE0                                  055893 111157
     C/COPY WNCPYSRC,SE2210C035
     C*
     C* AMORTIZE PREM/DISC ON YIELD CURVE BASIS FOR AUSTRALIA.            S01233
     C*  -IF YIELD CURVE BASIS                                            S01233
     C*  -AND NOT FIFO                                                    S01233
     C*  -AND NOT SCHULDSHEIN                                             S01233
     C*  -AND YIELD-BASED SECURITY                                        S01233
     C*                                                                   S01233
     C           STAD      IFEQ 'C'                                       S01233
     C           FIFO      ANDNE'Y'                                       S01233
     C********** PROT      ANDNE'6'                                                    S01233 226138
     C/COPY WNCPYSRC,SE2210C036
     C           STBS      ANDEQ'Y'                                       S01233
     C                     EXSR AAMORT                                    S01233
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     EXSR AAMORN                                                        CAS006
     C                     ENDIF                                                              CAS006
     C/COPY WNCPYSRC,SE2210C037
     C*                                                                   S01233
     C                     ELSE                                           S01233
     C*
     C*   - CALCULATE DAYS TO MATURITY
     C*
     C***********          Z-ADDLPSD      ZSDATE                          E15965
     C*                                                                   E20087
     C** Since BUDU represents discount/premium remaining as of the       E20087
     C** prior amortization date, days to maturity should be calculated   E20087
     C** from the prior amortization date, not from LPCD,                 E20087
     C** unless no prior amortization has been performed.                 E20087
     C*                                                                   E20087
     C           LATD      IFNE 0                                         E20087
     C           LPSD      IFGT LATD                                      E24428
     C                     Z-ADDLPSD      ZSDATE                          E24428
     C                     ELSE                                           E24428
     C                     Z-ADDLATD      ZSDATE                          E20087
     C                     END                                            E24428
     C                     ELSE                                           E20087
     C***********          Z-ADDLPCD      ZSDATE                   E15965 E20087
     C***********          Z-ADDLPSD      ZSDATE                   E20087 E22957
     C                     Z-ADDLPCD      ZSDATE                          E22957
     C                     END                                            E20087
     C*                                                                   E20087
     C                     Z-ADDMATY      ZEDATE
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2210CCP4                                           S01408
     C*                                                                   S01408
      *                                                                                       CSE075
      ** If Enhanced Treasury is switched on:                                                 CSE075
      *                                                                                       CSE075
     C           CSE075    IFEQ 'Y'                                                           CSE075
      *                                                                                       CSE075
      ** For MBS, amortize to average life date, if available.                                CSE075
      *                                                                                       CSE075
     C           PROT      IFEQ '8'                                                           CSE075
     C           PPDI      ANDNE'Y'                                                           CSE075
     C           ALDT      ANDNE0                                                             CSE075
     C                     Z-ADDALDT      ZEDATE                                              CSE075
     C                     ENDIF                                                              CSE075
     C                     ENDIF                                                              CSE075
     C*                                                                   102506
     C** Set day number accrued to for ZDAYS Subroutine                   102506
     C*                                                                   102506
     C                     Z-ADDDNAT      ZIDNAT                          102506
     C*                                                                   102506
     C** Set accrual type for ZDAYS Subroutine                            102506
     C*                                                                   102506
     C                     MOVE *BLANK    ZACLT                           102506
     C                     EXSR ZDAYS
     C                     Z-ADDZDDAYS    WDAYSM  50
     C/COPY WNCPYSRC,SE2210C077
     C*
     C*   - CALCULATE DAYS TO AMORTISE
     C*
     C***********          Z-ADDLPSD      ZSDATE                          E15965
     C************         Z-ADDLPCD      ZSDATE                   E15965 E20087
     C           LATD      IFNE 0                                         E20087
     C           LPSD      IFGT LATD                                      E24428
     C                     Z-ADDLPSD      ZSDATE                          E24428
     C                     ELSE                                           E24428
     C                     Z-ADDLATD      ZSDATE                          E20087
     C                     END                                            E24428
     C                     ELSE                                           E20087
     C***********          Z-ADDLPSD      ZSDATE                   E20087 E22957
     C                     Z-ADDLPCD      ZSDATE                          E22957
     C                     END                                            E20087
     C*                                                                   E20087
     C                     Z-ADDACDT      ZEDATE
     C*                                                                   102506
     C** Set day number accrued to for ZDAYS Subroutine                   102506
     C*                                                                   102506
     C                     Z-ADDDNAT      ZIDNAT                          102506
     C*                                                                   102506
     C** Set accrual type for ZDAYS Subroutine                            102506
     C*                                                                   102506
     C                     MOVE 'D'       ZACLT                           102506
     C                     EXSR ZDAYS
     C                     Z-ADDZDDAYS    WDAYSA  50
     C*                                                                   102506
     C** Reset day number accrued to and accrual type                     102506
     C*                                                                   102506
     C                     Z-ADD*ZERO     ZIDNAT                          102506
     C                     MOVE *BLANK    ZACLT                           102506
     C*                                                                   102506
     C** Update day number accrued to                                     102506
     C*                                                                   102506
     C                     Z-ADDZODNAT    DNAT                            102506
     C*
     C*   - CALCULATE EARNED DISC/PREM SINCE LATEST POSN DATE
     C*
     C           WDAYSM    IFEQ 0
     C********** WDAYSM    ORLT WDAYSA                                               E20087 BUG13026
     C           WDAYSM    ORLE WDAYSA                                                      BUG13026
     C*                                                                   E20087
     C** If issue is maturing, amortize remaining discount/premium.       E20087
     C*                                                                   E20087
     C***********          Z-ADD0         WEDP                            E20087
     C***********          Z-ADDWKBUDU    WEDP                     E20087 E20552
     C                     Z-ADDBUDU      WEDP                            E20552
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDBUDN      WEDN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ELSE
     C***********WDAYSA    DIV  WDAYSM    WDAYS   94H                     E15442
     C***********BUDU      MULT WDAYS     WEDP   130H                     E15542
     C***********BUDU      DIV  WDAYSM    WEDPXX 152H              E15542 E20087
     C***********WKBUDU    DIV  WDAYSM    WEDPXX 152H              E20087 E20552
     C           BUDU      DIV  WDAYSM    WEDPXX 152H                     E20552
     C           WEDPXX    MULT WDAYSA    WEDP   130H                     E15442
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           BUDN      DIV  WDAYSM    WEDPXN 152H                                         CAS006
     C           WEDPXN    MULT WDAYSA    WEDN   130H                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     END
     C*
     C*   - CALCULATE AMORTISED DISC/PREM TO POST
     C*
     C***********WEDP      SUB  DPAP      WADP   130                      E15965
     C                     Z-ADDWEDP      WADP   130                      E15965
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDWEDN      WADN   130                                          CAS006
     C                     ENDIF                                                              CAS006
     C*
     C                     END                                            S01233
     C*
     C*   - OUTPUT AMORTISED DISC/PREM KEY
     C*                                                                   E20087
     C***This*subroutine*is*now*called*for*both*'T'*and*'V'*records,*but87E20552
     C***account*keys*are*needed*only*for*value*date*positions.****E20087 E20552
     C***********BHTV      IFEQ 'V'                                E20087 E20552
     C*                                                                   E20087
     C                     MOVE 'A'       EVTP
     C                     MOVE ' '       PSBS
     C                     MOVE ' '       FILL
     C           NPAC      IFEQ 'N'
     C********** NPSN      ORGT 0                                         E13817
     C           NPSN      ORGE 0                                         E13817
     C                     MOVE ' '       NEGI
     C                     ELSE
     C                     MOVE 'N'       NEGI
     C                     END
     C*
     C***********BUDU      IFGT 0                                         E20087
     C***********WKBUDU    IFGT 0                                  E20087 E20552
     C***********BUDU      IFGT 0                                  E20552 E22957
     C           NPSN      IFGT 0                                         E22957
     C           BUDU      ANDGT0                                         E22957
     C           NPSN      ORLT 0                                         E22957
     C           BUDU      ANDLT0                                         E22957
     C                     MOVE 'DA'      AMCD
     C                     ELSE
     C                     MOVE 'PA'      AMCD
     C                     END
     C*
     C***********WADP      IFLT 0                                         E22957
     C***********WADP      ORGT 0                                  E21130 E22957
     C***********BUDU      ANDLT0                                  E21130 E22957
     C***********WADP      MULT -1        EVAM                            E22957
     C***********          ELSE                                           E22957
     C                     Z-ADDWADP      EVAM
     C***********          END                                            E22957
     C*
     C**IF*-*VE*POSITION*AND*NO*'N'*IN*POSITION*15*OF*A/C*KEY******E15442 E22957
     C**THE*DISCOUNT/PREMIUM*AMORTISED*MUST*HAVE*ITS*SIGN*REVERSED*E15442 E22957
     C**(AS*REVERSE*ENTRIES*ARE*REQUIRED*ON*PURCHASES*AND*SALES)***E15442 E22957
     C*                                                                   E15442
     C/COPY WNCPYSRC,SE2210C070
     C*                                                                   E22957
     C** - Reverse sign on Premiums, because different key                E22957
     C*                                                                   E22957
     C           AMCD      IFEQ 'PA'                                      E22957
     C                     Z-SUBEVAM      EVAM                            E22957
     C                     END                                            E22957
     C*                                                                   E22957
     C** - Reverse sign, if Negative Position on Key                      E22957
     C*                                                                   E22957
     C           NPSN      IFLT 0
     C***********NPAC      ANDEQ'N'                                       E22957
     C           NPAC      ANDEQ'Y'                                       E22957
     C           EVAM      MULT -1        EVAM
     C                     END
     C*                                                                   027163
     C** Check is there any mortgage repayment if it is a mortgage back   027163
     C** security.                                                        027163
     C*                                                                   027163
     C           PROT      IFEQ '8'                                       027163
     C                     MOVE BHSC      SESN                            027163
     C                     Z-ADDLPCD      ZDCSDT                          027163
     C                     MOVE 'MP'      SDET                            027163
     C           KZSEDO    SETLLSEDEVDO                                   027163
     C                     READ SEDEVDO                  96               027163
     C           *IN96     IFEQ '0'                                       027163
     C           SDSN      ANDEQSESN                                      027163
     C           SDET      ANDEQ'MP'                                      027163
     C                     Z-ADDSDCP      AAPR                            027163
     C                     END                                            027163
     C                     END                                            027163
      *                                                                   E20086
      * Adjust posting amount by the mortgage factor                      E20086
      *                                                                   E20086
     C           PROT      IFEQ '8'                                       E20086
     C/COPY WNCPYSRC,SE2210C065
     C                     MULT AAPR      EVAM                            E20086
     C                     END                                            E20086
     C/COPY WNCPYSRC,SE2210C056
     C*
     C           EVAM      IFNE 0
     C/COPY WNCPYSRC,SE2210C052
      *                                                                                       CSE105
      ** If CSE105 is installed and this is a Trade Date Position,                            CSE105
      ** to 'DT' when "discount" or 'PT' when "premium".                                      CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
     C           BHTV      ANDEQ'T'                                                           CSE105
      *                                                                                       CSE105
     C                     SELEC                                                              CSE105
     C           AMCD      WHEQ 'DA'                                                          CSE105
     C                     MOVE 'DT'      AMCD                                                CSE105
     C           AMCD      WHEQ 'PA'                                                          CSE105
     C                     MOVE 'PT'      AMCD                                                CSE105
     C                     ENDSL                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     EXSR WRITED
     C                     END
     C*                                                                   E20087
     C/COPY WNCPYSRC,SE2210C071
     C** Accumulate amortized discount/premium for Profitability Report.  E20087
     C** Note: Field DPTM has been added to PF/BKMTHD.  It is used only   E20087
     C** on 'V' records; Trade Date report will use Value Date figures.   E20087
     C*                                                                   E20087
     C                     MOVELEOPT      BKED                            E20087
     C           BKMKEY    CHAINBKMTHDF              80                   E20087
     C           *IN80     IFEQ '0'                                       E20087
     C*                                                                   E20087
     C** Adjust for current factor if necessary.                          E20087
     C*                                                                   E20087
     C           PROT      IFEQ '8'                                       E20087
     C/COPY WNCPYSRC,SE2210C057
     C           WADP      MULT AAPR      WADPCF 150                      E20087
     C                     ELSE                                           E20087
     C                     Z-ADDWADP      WADPCF                          E20087
     C                     END                                            E20087
     C*                                                                   E20087
     C** On long position, discount is income, premium is expense.        E20087
     C** On short position, premium is income, discount is expense.       E20087
     C*                                                                   E20087
     C***********NPSN      IFGT 0                                  E20087 E22957
     C                     ADD  WADPCF    DPTM                            E20087
     C***********          ELSE                                    E20087 E22957
     C***********          SUB  WADPCF    DPTM                     E20087 E22957
     C***********          END                                     E20087 E22957
     C*                                                                   E20087
     C                     EXCPTUPDBKM                                    E20087
     C                     END                                            E20087
     C*                                                                   E20087
     C***End*of*calculations*performed*only*for*'V'*records.****** E20087 E20552
     C***********          END                                     E20087 E20552
     C*                                                                   E20087
     C*
     C*  - CALCULATE NEW UNAMORTISED DISC/PREM ON POSITION
     C*
     C***********BUDU      SUB  WEDP      BUDU                            E15965
     C           BUDU      SUB  WADP      BUDU                            E15965
     C*
     C*  - SET DISC/PREM AMORTISED SINCE LATEST POSN DATE
     C*
     C***********          Z-ADDWEDP      DPAP                            E15965
     C                     ADD  WADP      DPAP                            E15965
     C                     ADD  WADP      DPFP                            S01397
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           BUDN      SUB  WADN      BUDN                                                CAS006
     C                     ADD  WADN      DPAN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*                                                                   E15965
     C*  - UPDATE AVERAGE PRICE ON BOOK POSITION HEADER                   E15965
     C*  First determine average price numerator                          E15965
     C*   for current position/price                                      E15965
     C*                                                                   E21097
     C***********          Z-ADDNPSN      ZNOML                           E21097
     C***********          Z-ADDNPSN      ZNOML                    E21608 E22957
     C***********          Z-ADDLAVP      ZPRC                     E21097 E22957
     C***********          EXSR ZCNSD                              E21097 E22957
     C***********          Z-ADDZCONS     APNC                     E21097 E22957
     C***********          Z-ADD*ZEROS    APNC0  150               E15965 E21097
     C***********          Z-ADD*ZEROS    APNC1  151               E15965 E21097
     C***********          Z-ADD*ZEROS    APNC2  152               E15965 E21097
     C***********          Z-ADD*ZEROS    APNC3  153               E15965 E21097
     C***********          MOVEA'0000'    *IN,70                   E15965 E21097
     C***********70        ADD  CDP       J       20               E15965 E21097
     C***********          MOVEA'1'       *IN,J                    E15965 E21097
     C***70******NPSN      MULT LAVP      APNC0     H              E15965 E21097
     C***71******NPSN      MULT LAVP      APNC1     H              E15965 E21097
     C***72******NPSN      MULT LAVP      APNC2     H              E15965 E21097
     C***73******NPSN      MULT LAVP      APNC3     H              E15965 E21097
     C***********                                                  E15965 E21097
     C***70******          MOVE APNC0     APNC                     E15965 E21097
     C***71******          MOVE APNC1     APNC                     E15965 E21097
     C***72******          MOVE APNC2     APNC                     E15965 E21097
     C***73******          MOVE APNC3     APNC                     E15965 E21097
     C***********                                                  E15965 E21097
     C**Reformat*amount,*allowing*for*nominal*decimal*places****** E15965 E21097
     C***********                                                  E15965 E21097
     C***********5         SUB  NMDP      DC      10               E15965 E21097
     C***********APNC      MULT POWER8,DC APNC      H              E15965 E21097
     C***********                                                  E15965 E21097
     C**Price*basis*'P'******************************************* E15965 E21097
     C***********                                                  E15965 E21097
     C***********SPBS      IFEQ 'P'                                E15965 E21097
     C***********          DIV  100       APNC                     E15965 E21097
     C***********          END                                     E15965 E21097
     C*                                                                   E15965
     C* Add in amortized discount/premium and rework average price        E15965
     C* and Part Payyments Posted                                         E29236
     C*                                                                   E15965
     C***********NPSN      IFGT 0                                  E15965 E22957
     C***********          ADD  WADP      APNC                     E15965 E22957
     C***********          ELSE                                    E15965 E22957
     C***********          SUB  WADP      APNC                     E15965 E22957
     C***********          END                                     E15965 E22957
     C*                                                                   CPM004
     C* Portfolio Currency Rate                                           CPM004
     C*                                                                   CPM004
     C           APNC      IFNE *ZERO                                     CPM004
     C           FXAP      DIV  APNC      WFACT  238                      CPM004
     C                     ELSE                                           CPM004
     C                     Z-ADD*ZERO     WFACT                           CPM004
     C                     END                                            CPM004
     C*                                                                   E15965
     C           NPSN      IFEQ 0                                         E15965
     C***********          Z-ADDAPNC      APPB                     E15965 E22957
     C                     Z-ADD0         APPB                            E22957
     C                     Z-ADD0         APPN                                                CAS006
     C                     Z-ADD0         LFXP                            CPM004
     C                     ELSE                                           E15965
     C                     Z-ADDNPSN      ZNOML                           E22957
     C           APNC      ADD  DPAP      ZAPNC                           E22957
     C                     ADD  BHPP      ZAPNC                           E29236
     C           ZAPNC     MULT WFACT     LFXP                            CPM004
     C                     EXSR ZAVPR                                     E22957
     C                     Z-ADDZPRC      APPB                            E22957
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDNPSN      ZNOML                                               CAS006
     C           APNN      ADD  DPAN      ZAPNC                                               CAS006
     C                     ADD  BHPP      ZAPNC                                               CAS006
     C                     EXSR ZAVPR                                                         CAS006
     C                     Z-ADDZPRC      APPN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     END                                            E22957
     C***********                                                         E22957
     C***********APNC      DIV  NPSN      APPB                     E15965 E21097
     C***********          END                                     E15965 E21097
     C***********                                                  E15965 E21097
     C***********SPBS      IFEQ 'P'                                E15965 E21097
     C***********          MULT 100       APPB                     E15965 E21097
     C***********          END                                     E15965 E21097
     C***********                                                  E15965 E21097
     C***********5         ADD  CDP       DC                       E15965 E21097
     C***********          SUB  NMDP      DC                       E15965 E21097
     C***********APPB      DIV  POWER8,DC APPB      H              E15965 E21097
     C***********                                                  E21097 E22957
     C***********5         ADD  CDP       DC                       E21097 E22957
     C***********          SUB  NMDP      DC                       E21097 E22957
     C***********                                                  E21097 E22957
     C***********DC        IFLT 5                                  E21097 E22957
     C***********APNC      DIV  POWER8,DC APNC0  150H              E21097 E22957
     C***********          ELSE                                    E21242 E22957
     C***********          Z-ADDAPNC      APNC0                    E21242 E22957
     C***********          END                                     E21097 E22957
     C***********                                                  E21097 E22957
     C***********SPBS      IFEQ 'P'                                E21097 E22957
     C***********          MULT 100       APNC0                    E21097 E22957
     C***********          END                                     E21097 E22957
     C***********                                                  E21097 E22957
     C***********APNC0     DIV  NPSN      APPB      H              E21097 E22957
     C***********                                                  E21097 E22957
     C***********DC        IFGE 5                                  E21097 E22957
     C***********APPB      DIV  POWER8,DC APPB      H              E21097 E22957
     C***********          END                                     E21097 E22957
     C***********                                                  E21097 E22957
     C***********          END                                     E21097 E22957
     C/COPY WNCPYSRC,SE2210C061
     C                     Z-ADDAPPB      LAVP                            E15965
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDAPPN      LAVN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C/COPY WNCPYSRC,SE2210C074
     C***********                                                  E15965 E22957
     C**Update*latest*position*change*date**********************   E15965 E22957
     C***********                                                  E15965 E22957
     C***********          Z-ADDECD       LPCD                     E15965 E22957
     C*                                                                   E20087
     C** AND update last accrue-to date                                   E20087
     C**    (field is not used for accruals).                             E20087
     C*                                                                   E20087
     C                     Z-ADDACDT      LATD                            E20087
     C*
     C/COPY WNCPYSRC,SE2210C073
     C                     END
     C                     ELSE                                           CSE032
     C           BUDU      IFNE 0                                         CSE032
     C           STAD      OREQ 'C'                                       CSE032
     C           SYBS      ANDNE*BLANKS                                   CSE032
     C           NPSN      ANDNE*ZERO                                     CSE032
     C*                                                                   CSE032
     C* AMORTIZE PREM/DISC ON YIELD CURVE BASIS FOR AUSTRALIA.            CSE032
     C*  -IF YIELD CURVE BASIS                                            CSE032
     C*  -AND NOT FIFO                                                    CSE032
     C*  -AND NOT SCHULDSHEIN                                             CSE032
     C*  -AND YIELD-BASED SECURITY                                        CSE032
     C*                                                                   CSE032
     C           STAD      IFEQ 'C'                                       CSE032
     C           FIFO      ANDNE'Y'                                       CSE032
     C********** PROT      ANDNE'6'                                                    CSE032 226138
     C           SYBS      ANDNE*BLANKS                                   CSE032
     C*                                                                   CSE032
     C** Override trade basis to 'Y' as ZPRCI and ZPRCO standard          CSE032
     C** subroutines calculate yield for 'Y' trade basis only.            CSE032
     C*                                                                   CSE032
     C                     MOVE STBS      STBSBK  1                                         AR847937
      *                                                                                     AR847937
     C                     MOVEL'Y'       STBS                            CSE032
     C                     MOVE ' '       WAMORT                                              CSE065
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C           LATD      IFNE 0                                                             CSE065
     C           LPSD      IFGT LATD                                                          CSE065
     C                     Z-ADDLPSD      ZSDATE                                              CSE065
     C                     ELSE                                                               CSE065
     C                     Z-ADDLATD      ZSDATE                                              CSE065
     C                     ENDIF                                                              CSE065
     C                     ELSE                                                               CSE065
     C                     Z-ADDLPCD      ZSDATE                                              CSE065
     C                     ENDIF                                                              CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C********** STRM      ANDEQ'Y'                                                    CSE065 233707
     C                     MOVE 'T'       WAMORT                                              CSE065
     C                     EXSR AAMORC                                                        CSE065
     C                     Z-ADDZPRCOT    ZPRCOO                                              233707
     C                     ELSE                                                               CSE065
     C                     EXSR AAMORT                                    CSE032
     C                     Z-ADDZPRCOT    ZPRCOO 158                                          230973
     C                     ENDIF                                                              CSE065
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CSE065
     C                     MOVE ' '       WAMORT                                              CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C********** STRM      ANDEQ'Y'                                                    CSE065 233707
     C                     MOVE 'N'       WAMORT                                              CSE065
     C                     EXSR AAMORC                                                        CSE065
     C                     ELSE                                                               CSE065
     C                     EXSR AAMORN                                                        CAS006
     C                     Z-ADDZPRCOT    ZPRCON 158                                          230973
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CAS006
      *                                                                                     AR847937
     C                     MOVE STBSBK    STBS                                              AR847937
     C*                                                                   CSE032
     C                     ELSE                                           CSE032
     C*                                                                   CSE032
     C*   - CALCULATE DAYS TO MATURITY                                    CSE032
     C*                                                                   CSE032
     C** Since BUDU represents discount/premium remaining as of the       CSE032
     C** prior amortization date, days to maturity should be calculated   CSE032
     C** from the prior amortization date, not from LPCD,                 CSE032
     C** unless no prior amortization has been performed.                 CSE032
     C*                                                                   CSE032
     C           LATD      IFNE 0                                         CSE032
     C           LPSD      IFGT LATD                                      CSE032
     C                     Z-ADDLPSD      ZSDATE                          CSE032
     C                     ELSE                                           CSE032
     C                     Z-ADDLATD      ZSDATE                          CSE032
     C                     END                                            CSE032
     C                     ELSE                                           CSE032
     C                     Z-ADDLPCD      ZSDATE                          CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C                     Z-ADDMATY      ZEDATE                          CSE032
      *                                                                                       CSE065
      ** If CSE065 is ON and Available for Sales Book, amortisation                           CSE065
      ** is calculated base per Average Life Date change                                      CSE065
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C********** STRM      ANDEQ'Y'                                                    CSE065 233707
     C           STAD      ANDEQ'Y'                                                           CSE065
     C                     EXSR AMORSL                                                        CSE065
     C                     ELSE                                                               CSE065
     C*                                                                   CSE032
     C** Set day number accrued to for ZDAYS Subroutine                   CSE032
     C*                                                                   CSE032
     C                     Z-ADDDNAT      ZIDNAT                          CSE032
     C*                                                                   CSE032
     C** Set accrual type for ZDAYS Subroutine                            CSE032
     C*                                                                   CSE032
     C                     MOVE *BLANK    ZACLT                           CSE032
     C                     EXSR ZDAYS                                     CSE032
     C                     Z-ADDZDDAYS    WDAYSM  50                      CSE032
     C*                                                                   CSE032
     C*   - CALCULATE DAYS TO AMORTISE                                    CSE032
     C*                                                                   CSE032
     C           LATD      IFNE 0                                         CSE032
     C           LPSD      IFGT LATD                                      CSE032
     C                     Z-ADDLPSD      ZSDATE                          CSE032
     C                     ELSE                                           CSE032
     C                     Z-ADDLATD      ZSDATE                          CSE032
     C                     END                                            CSE032
     C                     ELSE                                           CSE032
     C                     Z-ADDLPCD      ZSDATE                          CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C                     Z-ADDACDT      ZEDATE                          CSE032
     C*                                                                   CSE032
     C** Set day number accrued to for ZDAYS Subroutine                   CSE032
     C*                                                                   CSE032
     C                     Z-ADDDNAT      ZIDNAT                          CSE032
     C*                                                                   CSE032
     C** Set accrual type for ZDAYS Subroutine                            CSE032
     C*                                                                   CSE032
     C                     MOVE 'D'       ZACLT                           CSE032
     C                     EXSR ZDAYS                                     CSE032
     C                     Z-ADDZDDAYS    WDAYSA  50                      CSE032
     C*                                                                   CSE032
     C** Reset day number accrued to and accrual type                     CSE032
     C*                                                                   CSE032
     C                     Z-ADD*ZERO     ZIDNAT                          CSE032
     C                     MOVE *BLANK    ZACLT                           CSE032
     C*                                                                   CSE032
     C** Update day number accrued to                                     CSE032
     C*                                                                   CSE032
     C                     Z-ADDZODNAT    DNAT                            CSE032
     C*                                                                   CSE032
     C*   - CALCULATE EARNED DISC/PREM SINCE LATEST POSN DATE             CSE032
     C*                                                                   CSE032
     C           WDAYSM    IFEQ 0                                         CSE032
     C********** WDAYSM    ORLT WDAYSA                                               CSE032 BUG13026
     C           WDAYSM    ORLE WDAYSA                                                      BUG13026
     C*                                                                   CSE032
     C** If issue is maturing, amortize remaining discount/premium.       CSE032
     C*                                                                   CSE032
     C                     Z-ADDBUDU      WEDP                            CSE032
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDBUDN      WEDN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ELSE                                           CSE032
     C           BUDU      DIV  WDAYSM    WEDPXX 152H                     CSE032
     C           WEDPXX    MULT WDAYSA    WEDP   130H                     CSE032
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           BUDN      DIV  WDAYSM    WEDPXN 152H                                         CAS006
     C           WEDPXN    MULT WDAYSA    WEDN   130H                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     END                                            CSE032
     C*                                                                   CSE032
     C*   - CALCULATE AMORTISED DISC/PREM TO POST                         CSE032
     C*                                                                   CSE032
     C                     Z-ADDWEDP      WADP   130                      CSE032
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDWEDN      WADN   130                                          CAS006
     C                     ENDIF                                                              CAS006
     C*                                                                   CSE032
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     END                                            CSE032
     C*                                                                   CSE032
     C*   - OUTPUT AMORTISED DISC/PREM KEY                                CSE032
     C*                                                                   CSE032
     C                     MOVE 'A'       EVTP                            CSE032
     C                     MOVE ' '       PSBS                            CSE032
     C                     MOVE ' '       FILL                            CSE032
     C           NPAC      IFEQ 'N'                                       CSE032
     C           NPSN      ORGE 0                                         CSE032
     C                     MOVE ' '       NEGI                            CSE032
     C                     ELSE                                           CSE032
     C                     MOVE 'N'       NEGI                            CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C           NPSN      IFGT 0                                         CSE032
     C           BUDU      ANDGT0                                         CSE032
     C           NPSN      ORLT 0                                         CSE032
     C           BUDU      ANDLT0                                         CSE032
     C                     MOVE 'DA'      AMCD                            CSE032
     C                     ELSE                                           CSE032
     C                     MOVE 'PA'      AMCD                            CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C                     Z-ADDWADP      EVAM                            CSE032
     C*                                                                   CSE032
     C** - Reverse sign on Premiums, because different key                CSE032
     C*                                                                   CSE032
     C           AMCD      IFEQ 'PA'                                      CSE032
     C                     Z-SUBEVAM      EVAM                            CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C** - Reverse sign, if Negative Position on Key                      CSE032
     C*                                                                   CSE032
     C           NPSN      IFLT 0                                         CSE032
     C           NPAC      ANDEQ'Y'                                       CSE032
     C           EVAM      MULT -1        EVAM                            CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C** Check is there any mortgage repayment if it is a mortgage back   CSE032
     C** security.                                                        CSE032
     C*                                                                   CSE032
     C           PROT      IFEQ '8'                                       CSE032
     C                     MOVE BHSC      SESN                            CSE032
     C                     Z-ADDLPCD      ZDCSDT                          CSE032
     C                     MOVE 'MP'      SDET                            CSE032
     C           KZSEDO    SETLLSEDEVDO                                   CSE032
     C                     READ SEDEVDO                  96               CSE032
     C           *IN96     IFEQ '0'                                       CSE032
     C           SDSN      ANDEQSESN                                      CSE032
     C           SDET      ANDEQ'MP'                                      CSE032
     C                     Z-ADDSDCP      AAPR                            CSE032
     C                     END                                            CSE032
     C                     END                                            CSE032
      *                                                                   CSE032
      * Adjust posting amount by the mortgage factor                      CSE032
      *                                                                   CSE032
     C           PROT      IFEQ '8'                                       CSE032
     C                     MULT AAPR      EVAM                            CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C           EVAM      IFNE 0                                         CSE032
      *                                                                                     MD030796
      ** If CSE105 is installed and this is a Trade Date Position,                          MD030796
      ** to 'DT' when "discount" or 'PT' when "premium".                                    MD030796
      *                                                                                     MD030796
     C           CSE105    IFEQ 'Y'                                                         MD030796
     C           BHTV      ANDEQ'T'                                                         MD030796
      *                                                                                     MD030796
     C                     SELEC                                                            MD030796
     C           AMCD      WHEQ 'DA'                                                        MD030796
     C                     MOVE 'DT'      AMCD                                              MD030796
     C           AMCD      WHEQ 'PA'                                                        MD030796
     C                     MOVE 'PT'      AMCD                                              MD030796
     C                     ENDSL                                                            MD030796
      *                                                                                     MD030796
     C                     ENDIF                                                            MD030796
      *                                                                                     MD030796
     C                     EXSR WRITED                                    CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C** Accumulate amortized discount/premium for Profitability Report.  CSE032
     C** Note: Field DPTM has been added to PF/BKMTHD.  It is used only   CSE032
     C** on 'V' records; Trade Date report will use Value Date figures.   CSE032
     C*                                                                   CSE032
     C                     MOVELEOPT      BKED                            CSE032
     C           BKMKEY    CHAINBKMTHDF              80                   CSE032
     C           *IN80     IFEQ '0'                                       CSE032
     C*                                                                   CSE032
     C** Adjust for current factor if necessary.                          CSE032
     C*                                                                   CSE032
     C           PROT      IFEQ '8'                                       CSE032
     C           WADP      MULT AAPR      WADPCF 150                      CSE032
     C                     ELSE                                           CSE032
     C                     Z-ADDWADP      WADPCF                          CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C** On long position, discount is income, premium is expense.        CSE032
     C** On short position, premium is income, discount is expense.       CSE032
     C*                                                                   CSE032
     C                     ADD  WADPCF    DPTM                            CSE032
     C*                                                                   CSE032
     C                     EXCPTUPDBKM                                    CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C*  - CALCULATE NEW UNAMORTISED DISC/PREM ON POSITION                CSE032
     C*                                                                   CSE032
     C           BUDU      SUB  WADP      BUDU                            CSE032
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           BUDN      SUB  WADN      BUDN                                                CAS006
     C                     ADD  WADN      DPAN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*                                                                   CSE032
     C*  - SET DISC/PREM AMORTISED SINCE LATEST POSN DATE                 CSE032
     C*                                                                   CSE032
     C                     ADD  WADP      DPAP                            CSE032
     C                     ADD  WADP      DPFP                            CSE032
     C*                                                                   CSE032
     C* Portfolio Currency Rate                                           CSE032
     C*                                                                   CSE032
     C           APNC      IFNE *ZERO                                     CSE032
     C           FXAP      DIV  APNC      WFACT  238                      CSE032
     C                     ELSE                                           CSE032
     C                     Z-ADD*ZERO     WFACT                           CSE032
     C                     END                                            CSE032
     C*                                                                   CSE032
     C           NPSN      IFEQ 0                                         CSE032
     C                     Z-ADD0         APPB                            CSE032
     C                     Z-ADD0         APPN                                                CAS006
     C                     Z-ADD0         LFXP                            CSE032
     C                     ELSE                                           CSE032
     C                     Z-ADDNPSN      ZNOML                           CSE032
     C           APNC      ADD  DPAP      ZAPNC                           CSE032
     C                     ADD  BHPP      ZAPNC                           CSE032
     C           ZAPNC     MULT WFACT     LFXP                            CSE032
     C                     EXSR ZAVPR                                     CSE032
     C                     Z-ADDZPRC      APPB                            CSE032
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDNPSN      ZNOML                                               CAS006
     C           APNN      ADD  DPAN      ZAPNC                                               CAS006
     C                     ADD  BHPP      ZAPNC                                               CAS006
     C                     EXSR ZAVPR                                                         CAS006
     C                     Z-ADDZPRC      APPN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     END                                            CSE032
     C           STAD      IFEQ 'C'                                                           230973
     C           FIFO      ANDNE'Y'                                                           230973
     C           SYBS      ANDNE*BLANKS                                                       230973
     C**********           Z-ADDZPRCOT    LAVP                                                230973
     C                     Z-ADDZPRCOO    LAVP                                                230973
     C                     ELSE                                                               230973
     C                     Z-ADDAPPB      LAVP                            CSE032
     C                     ENDIF                                                              230973
      *                                                                                       CSE065
      ** Calculate the New Mark to Market Average Price                                       CSE065
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C********** STRM      ANDEQ'Y'                                                    CSE065 233707
     C           STAD      IFEQ 'Y'                                                           CSE065
     C           STAD      OREQ 'C'                                                           CSE065
      *                                                                                       CSE065
     C           NPSN      IFEQ 0                                                             CSE065
     C                     Z-ADD0         NAVP                                                CSE065
     C                     ELSE                                                               CSE065
     C                     Z-ADDNPSN      ZNOML                                               CSE065
     C           BKCOST    ADD  BHPP      ZAPNC                                               CSE065
     C                     EXSR ZAVPR                                                         CSE065
     C                     Z-ADDZPRC      NAVP                                                CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           STAD      IFEQ 'C'                                                           230973
     C           FIFO      ANDNE'Y'                                                           230973
     C           SYBS      ANDNE*BLANKS                                                       230973
     C**********           Z-ADDZPRCOT    LAVN                                                230973
     C                     Z-ADDZPRCON    LAVN                                                230973
     C                     ELSE                                                               230973
     C                     Z-ADDAPPN      LAVN                                                CAS006
     C                     ENDIF                                                              230973
     C                     ENDIF                                                              CAS006
     C*                                                                   CSE032
     C** AND update last accrue-to date                                   CSE032
     C**    (field is not used for accruals).                             CSE032
     C*                                                                   CSE032
     C                     Z-ADDACDT      LATD                            CSE032
     C                     END                                            CSE032
     C                     END                                            CSE032
     C*
     C***********          ENDSR                                          E15442
     C           EAMORT    ENDSR                                          E15442
      *
     C/COPY WNCPYSRC,SE2210C038
      ******************************************************************
      /EJECT                                                              E20085
      ************************************************************ E20087 E20552
      ***********                                                  E20087 E20552
      ***ADJBUD*-*Subroutine*to*adjust*Unrealized*Discount/Premium*and 87 E20552
      ************Unrealized*P/L*on*'T'*positions*with*forward*Trades. 87 E20552
      ***********                                                  E20087 E20552
      ************************************************************ E20087 E20552
      ***********                                                  E20087 E20552
     C***********ADJBUD    BEGSR                           ** ADJBUD 0087 E20552
     C***********                                                  E20087 E20552
     C***Clear*'Current*FIFO*trade*found'*indicator;*set*FIFO*trade*ref.  E20552
     C***********          MOVE '0'       *IN82                    E20087 E20552
     C***********          MOVE BHTR      BHTRA   6                E20087 E20552
     C***********                                                  E20087 E20552
     C***Set*up*index*for*currency*decimal*places***************** E20087 E20552
     C***********CDP       ADD  5         DC                       E20087 E20552
     C***********          SUB  NMDP      DC                       E20087 E20552
     C***********                                                  E20087 E20552
     C***Read*all*trades*for*this*position.*Only*accumulate*forwards. 087 E20552
     C***********TRDKEY    CHAINTRADSDF              81            E20087 E20552
     C***********                                                  E20087 E20552
     C***Loop*for*processing*trades.****************************** E20087 E20552
     C************IN81     DOWEQ'0'                                E20087 E20552
     C***********                                                  E20087 E20552
     C***Only*process*live,*complete*trades.********************** E20087 E20552
     C***********RECI      IFNE '*'                                E20087 E20552
     C***********TINC      ANDEQ'C'                                E20087 E20552
     C***********                                                  E20087 E20552
     C***Check*for*current*FIFO*trade.**************************** E20087 E20552
     C************IN82     IFEQ '0'                                E20087 E20552
     C***********TDRF      ANDEQBHTRA                              E20087 E20552
     C***********          MOVE '1'       *IN82                    E20087 E20552
     C***********          MOVE TDTP      SVTDTP  2                E20087 E20552
     C***********                                                  E20087 E20552
     C***If*current*FIFO*trade*is*a*forward,*adjust*nominal*and*consider- E20552
     C***ation*to*reflect*partial*liquidations;*else*don't*bother. E20087 E20552
     C***********TDVD      IFGT ECD                                E20087 E20552
     C***********          Z-ADDBHRN      NOML                     E20087 E20552
     C***********NOML      MULT POWER8,DC NOML15 150               E20087 E20552
     C***********PRIC      MULT NOML15    TCSR      H              E20087 E20552
     C***********          DIV  100       TCSR      H              E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***Process*unliquidated*forward*trades.********************* E20087 E20552
     C***If*trade*is*same*type*as*current*FIFO*trade*(i.e.,*if*purchase 7 E20552
     C***and*currently*long,*or*sale*and*currently*short),*adjust*WKBUDU  E20552
     C***so*that*the*system*will*not*begin*to*amortize*the*discount*or 87 E20552
     C***premium*on*the*trade*until*it*reaches*value.************* E20087 E20552
     C***********TDVD      IFGT ECD                                E20087 E20552
     C************IN82     ANDEQ'1'                                E20087 E20552
     C***********TDTP      ANDEQSVTDTP                             E20087 E20552
     C***********                                                  E20087 E20552
     C***Calculate*discount/premium*on*trade.********************* E20087 E20552
     C***********NOML      MULT POWER8,DC NOML15                   E20087 E20552
     C***********NOML15    SUB  TCSR      DSCPRM 150               E20087 E20552
     C***********                                                  E20087 E20552
     C***********          SUB  DSCPRM    WKBUDU                   E20087 E20552
     C***********                                                  E20087 E20552
     C***********          END                                     E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********TRDKEY    READETRADSDF                8181        E20087 E20552
     C***********          END                                     E20087 E20552
     C***********                                                  E20087 E20552
     C***********          ENDSR                                   E20087 E20552
      ***********                                                  E20087 E20552
      ************************************************************ E20087 E20552
      /EJECT                                                              CSE006
      *****************************************************************   CSE006
      *                                                               *   CSE006
      * AMUPL  -  SUBROUTINE TO CALCULATE AMORTISATON ON THE UNREALIS *   CSE006
      *           PROFIT/LOSS ON THE BUY-SELL                         *   CSE006
      *                                                               *   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           AMUPL     BEGSR                           **  AMUPL ***  CSE006
      *                                                                   CSE006
      *** Set up Buy/sell key - setting low value for Trade Reference     CSE006
      *                                                                   CSE006
     C                     MOVE *ZEROS    WTDRF                           CSE006
      *                                                                   CSE006
      *** Set Low level on BSPOSDL1                                       CSE006
      *                                                                   CSE006
     C           BSKEY1    SETLLBSPOSDL1                                  CSE006
      *                                                                   CSE006
      *** Get Buy-sell book file details                                  CSE006
      *                                                                   CSE006
     C           BSKEY2    READEBSPOSDL1                 53               CSE006
      *                                                                   CSE006
     C           *IN53     DOWEQ*OFF                                      CSE006
      *                                                                   CSE006
      *** Make sure Accrual control date is greater than last accrued     CSE006
      *** to date(BSLATD) and Unamort P/L (BSOPL) is not zero.            CSE006
      *                                                                   CSE006
     C           BSRECI    IFEQ 'D'                                       CSE006
     C           ACDT      ANDGTBSLATD                                    CSE006
     C           BSOPL     ANDNE0                                         CSE006
      *                                                                   CSE006
      *** Calculate numbers of days between the two trades                CSE006
      *                                                                   CSE006
     C           DYBS      IFNE *BLANK                                    CSE006
     C                     Z-ADDBSVD1     ZSDATE                          CSE006
     C                     Z-ADDBSVD2     ZEDATE                          CSE006
     C                     MOVE 'N'       DADJN                           CSE006
     C                     EXSR ZDAYS                                     CSE006
     C                     MOVE ' '       DADJN                           CSE006
     C                     Z-ADDZDDAYS    DAYS    50                      CSE006
     C                     ELSE                                           CSE006
     C                     Z-ADD0         TDAYS   50                      CSE006
     C           BSVD2     SUB  BSVD1     TDAYS   50                      CSE006
     C                     Z-ADDTDAYS     DAYS                            CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      ***  Calculate daily amortisation amount                            CSE006
      *                                                                   CSE006
     C           DAYS      IFNE 0                                         CSE006
     C           BSPL      DIV  DAYS      AMNT      H                     CSE006
     C                     ELSE                                           CSE006
     C                     Z-ADD0         AMNT                            CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Calculate Number of days to amortise                            CSE006
      *                                                                   CSE006
     C                     Z-ADDBSLATD    ZSDATE                          CSE006
     C                     Z-ADDACDT      ZEDATE                          CSE006
      *                                                                   CSE006
      ** Set day number accrued to for ZDAYS Subroutine                   CSE006
      *                                                                   CSE006
     C                     Z-ADDDNAT      ZIDNAT                          CSE006
      *                                                                   CSE006
      ** Set accrual type for ZDAYS Subroutine                            CSE006
      *                                                                   CSE006
     C                     MOVE 'D'       ZACLT                           CSE006
     C                     EXSR ZDAYS                                     CSE006
     C                     Z-ADDZDDAYS    WDAYSA  50                      CSE006
      *                                                                   CSE006
      ** Reset day number accrued to and accrual type                     CSE006
      *                                                                   CSE006
     C                     Z-ADD*ZERO     ZIDNAT                          CSE006
     C                     MOVE *BLANK    ZACLT                           CSE006
      *                                                                   CSE006
      *** Update day number accrued to                                    CSE006
      *                                                                   CSE006
     C                     Z-ADDZODNAT    DNAT                            CSE006
      *                                                                   CSE006
      *** Calculate total amortisation amount                             CSE006
      *                                                                   CSE006
     C           ACDT      IFGE BSVD2                                     CSE006
     C                     Z-ADDBSOPL     TOTAMR 150                      CSE006
     C                     ELSE                                           CSE006
     C           AMNT      MULT WDAYSA    TOTAMR                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Subtract total amortisation amount from BSOPL                   CSE006
      *                                                                   CSE006
     C           BSOPL     SUB  TOTAMR    BSOPL                           CSE006
      *                                                                   CSE006
      *** Add total amortisation amount to BSAPL                          CSE006
      *                                                                   CSE006
     C           BSAPL     ADD  TOTAMR    BSAPL                           CSE006
      *                                                                   CSE006
     C                     Z-ADDACDT      BSLATD                          CSE006
      *                                                                   CSE006
      *** Update Buy/Sell postion file                                    CSE006
      *                                                                   CSE006
     C                     UPDATBSPOSD0                                   CSE006
      *                                                                   CSE006
      *** Change Event Amount to total amortisation                       CSE006
      *                                                                   CSE006
     C                     Z-ADDTOTAMR    EVAM                            CSE006
      *                                                                   CSE006
      *** Set up Account key fields                                       CSE006
      *                                                                   CSE006
     C           EVAM      IFLT 0                                         CSE006
     C                     MOVE 'RL'      AMCD                            CSE006
     C           EVAM      MULT -1        EVAM                            CSE006
     C                     ELSE                                           CSE006
     C                     MOVE 'RP'      AMCD                            CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     MOVE 'A'       EVTP                            CSE006
      *                                                                   CSE006
     C                     MOVE ' '       NEGI                            CSE006
      *                                                                   CSE006
      *** Call from (work field)                                          CSE006
     C                     MOVE 'A'       @CFRM   1                       CSE006
     C                     MOVE ' '       NEGI                            CSE006
      *                                                                   CSE006
      *** Get trade details from TRADS detail                             CSE006
      *                                                                   CSE006
     C           BSPRF     CHAINTRADS                80                   CSE006
      *                                                                   CSE006
     C           *IN80     IFEQ '1'                                       CSE006
     C***********RECI      ORNE 'D'                                 CSE006176392
     C           RECI      OREQ '*'                                       176392
     C           *LOCK     IN   LDA                                       CSE006
     C                     Z-ADD24        DBASE            ***************CSE006
     C                     MOVEL'TRADS  ' DBFILE           * DB ERROR 24 *CSE006
     C                     MOVELBSPRF     DBKEY            ***************CSE006
     C                     SETON                     U7U8                 CSE006
     C                     OUT  LDA                                       CSE006
     C                     DUMP                                           CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Write record to SEYKED file                                     CSE006
      *                                                                   CSE006
     C                     EXSR WRITED                                    CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
      *** Get Buy-sell book file details                                  CSE006
      *                                                                   CSE006
     C           BSKEY2    READEBSPOSDL1                 53               CSE006
      *                                                                   CSE006
     C                     ENDDO                                          CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *                                                                   CSE006
      *****************************************************************   CSE006
      /EJECT
      *****************************************************************
      *                                                                   E20085
      *     SUBROUTINE -  ACCRUE                                          E20085
      *  THIS SUBROUTINE HAS BEEN REWRITTEN BELOW                         E20085
      *                                                                   E20085
      *****************************************************************   E20085
      ***********                                                         E20085
      **ACCRUE***-*SUBROUTINE*TO*CALCULATE*ACCRUED*INTEREST*UP*TO*DATE*   E20085
      **********                                                          E20085
     C********** ACCRUE    BEGSR                           **ACCRUE **    E20085
     C***********EACCRU    ENDSR                           **  EACCRU **  E20085
      ***********                                                         E20085
      *****************************************************************   E20085
      /EJECT                                                              E20085
      *****************************************************************   E20085
      *                                                               *   E20085
      *  ACCRUE - Subroutine to calculate Accrued Interest up to Date.*   E20085
      *                                                               *   E20085
      *  CALLS - ZNCD   (Obtain Next Coupon Date)                     *   E20085
      *          ZACCZ  (Calculate Accrued Interest between two Dates)*   E20085
      *                                                               *   E20085
      *****************************************************************   E20085
      *                                                                   E20085
     C           ACCRUE    BEGSR                           *** ACCRUE *** E20085
      *                                                                   E20085
      ***  Define and zeroize the Total Accrued Interest Field.           E20085
      *                                                                   E20085
     C                     Z-ADD0         TOTACC 150                      E20085
      *                                                                                       262293
     C                     MOVE '0'       *IN10                                               262293
      *                                                                                       262293
      ** If CSE031 is installed, use the LCPN in PF/SECTYD instead,                           262293
      ** unless BCNV is ' ' or 'N'                                                            262293
      *                                                                                       262293
     C           CSE031    IFEQ 'N'                                                           262293
     C           CSE031    OREQ 'Y'                                                           262293
     C           BCNV      ANDEQ' '                                                           262293
     C           CSE031    OREQ 'Y'                                                           262293
     C           BCNV      ANDEQ'N'                                                           262293
     C*                                                                   148124
     C                     MOVE 'CP'      SNET                            148124
     C                     MOVE *HIVAL    SNDT                            148124
     C           KESNCP    SETLLSNDEVDO                                   148124
     C                     READ SNDEVDO                  60               148124
     C           *IN60     IFEQ '0'                                       148124
     C           SNSN      ANDEQSESN                                      148124
     C           SNET      ANDEQ'CP'                                      148124
     C                     Z-ADDSNDT      LCPN                            148124
     C                     MOVE '1'       *IN10                                               262293
     C                     ENDIF                                                              262293
     C                     ENDIF                                                              262293
     C**********           ELSE                                                        148124 262293
     C           *IN10     IFEQ '0'                                                           262293
     C                     Z-ADDECD       ZECD                            148124
     C                     EXSR ZLCD                                      148124
     C                     Z-ADDZZLCD     LCPN                            148124
     C                     ENDIF                                          148124
      *                                                                                       262293
      ** If LCPN is from PF/SNDEVD do not re-calculate LCPN                                   262293
      *                                                                                       199421
     C           BCNV      IFNE ' '                                                           199421
     C           BCNV      ANDNE'N'                                                           262293
     C           LCPN      ANDGTRUND                                                          199421
     C           *IN10     ANDEQ'0'                                                           262293
     C                     MOVE RUND      ZECD                                                199421
     C                     EXSR ZLCD                                                          199421
     C                     Z-ADDZZLCD     LCPN                                                199421
     C                     ENDIF                                                              199421
      *                                                                   E20085
      ***  If the Initial Date is Greater Than the Action Date, then      E20085
      ***  the Accrued Interest is zero.                                  E20085
      *                                                                   E20085
     C           ITLD      IFGT ACDT                                      E20085
     C                     Z-ADD0         WAIRP  130                      E20085
     C                     GOTO EACCRU                                    E20085
     C                     END                                            E20085
      *                                                                   E20085
      ***  If the Latest Position Date is Less Than the Last Coupon       E20085
      ***  Date then Purchased Interest is zero.                          E20085
      *                                                                   E20085
     C           LPSD      IFLT LCPN                                      E20085
     C                     Z-ADD*ZERO     ECNP                            E29237
     C                     Z-ADD*ZERO     INDO                            E29237
     C                     Z-ADD*ZERO     INDN                                                CAS006
     C                     Z-ADD*ZERO     IACP                            E29237
     C                     Z-ADD0         WPINT  130                      E20085
     C                     Z-ADD0         ECNP                            E23987
     C           NPSN      IFEQ 0                                         129696
     C                     Z-ADD0         ARPC                            129696
     C                     END                                            129696
     C                     ELSE                                           E20085
     C                     Z-ADDPILP      WPINT                           E20085
     C                     END                                            E20085
      *                                                                   E20085
      ***  Determine the Next Coupon Date.                                E20085
      *                                                                   E20085
     C                     EXSR ZNCD                                      E20085
      *                                                                   E20085
      ***  Calculate the Accrued Interest on the Total Nominal            E20085
      ***  Position up to the Action Date.                                E20085
      *                                                                   E20085
     C           PROT      IFNE '6'                                       E20085
      *                                                                   E20085
     C********** LPSD      IFGT LCPN                               177707 204134
     C**********           Z-ADDLPSD      ZDCSDT                   177707 204134
     C**********           ELSE                                    177707 204134
     C                     Z-ADDLCPN      ZDCSDT                          E20085
     C**********           END                                     177707 204134
     C                     Z-ADDACDT      ZDCEDT                          E20085
     C                     Z-ADDNPSN      ZAMT                            E20085
     C/COPY WNCPYSRC,SE2210C015
     C                     EXSR ZACCZ                                     E20085
     C/COPY WNCPYSRC,SE2210C016
     C                     Z-ADDZDCINT    TOTACC                          E20085
      *                                                                   E20085
     C                     ELSE                                           E20085
     C           LPSD      IFGT LCPN                                      E21304
     C                     Z-ADDLPSD      ZSDATE                          E20085
     C                     ELSE                                           E21304
     C                     Z-ADDLCPN      ZSDATE                          E21304
     C                     END                                            E21304
     C                     Z-ADDACDT      ZEDATE                          E20085
     C                     Z-ADDNPSN      ZAMT                            E20085
     C                     Z-ADDCPNR      IRATE                           E20085
     C/COPY WNCPYSRC,SE2210C017
     C                     EXSR ZACCR                                     E20085
     C/COPY WNCPYSRC,SE2210C018
     C                     Z-ADDZACCRD    TOTACC                          E20085
      *                                                                   E20085
     C                     END                                            E20085
      *                                                                   E20085
      ***  Calculate the Accrued Interest on the Ex-Coupon Nominal        E20085
      ***  Position from the Action Date.                                 E20085
      *                                                                   E20085
     C           ECNP      IFEQ 0                                         E20085
     C                     Z-ADD0         WTCPN                           E20085
     C                     ELSE                                           E20085
     C                     Z-ADDLCPN      ZDCSDT                          E20085
     C                     Z-ADDNCD       ZDCEDT                          E20085
     C                     Z-ADDECNP      ZAMT                            E20085
     C/COPY WNCPYSRC,SE2210C019
     C                     EXSR ZACCZ                                     E20085
     C/COPY WNCPYSRC,SE2210C020
     C                     Z-ADDZDCINT    WTCPN  150                      E20085
     C                     END                                            E20085
      *                                                                   E20085
      ***  Calculate the Accrued Interest to Post.                        E20085
      *                                                                   E20085
     C           TOTACC    SUB  WTCPN     WSTOT  150                      E20085
     C           WSTOT     SUB  WPINT     WSTOT                           E20085
     C           WSTOT     SUB  ARPC      WAIRP                           E20085
     C                     ADD  INDO      WAIRP                           E20085
     C/COPY WNCPYSRC,SE2210C060
      *                                                                   E20085
      ***  Output Accrued Interest Receivable Account Keys.               E20085
      *                                                                   E20085
     C                     MOVE 'A'       EVTP                            E20085
     C                     MOVE ' '       PSBS                            E20085
     C                     MOVE ' '       FILL                            E20085
      *                                                                   E20085
     C           NPSN      IFGE 0                                         E20085
     C           SNAC      OREQ 'N'                                       E20085
     C                     MOVE ' '       NEGI                            E20085
     C                     ELSE                                           E20085
     C                     MOVE 'N'       NEGI                            E20085
     C                     END                                            E20085
      *                                                                   E20085
     C                     MOVE 'AI'      AMCD                            E20085
      *                                                                   E20085
     C           NPSN      IFLT 0                                         E20085
     C           SNAC      ANDEQ'Y'                                       E20085
     C           WAIRP     MULT -1        EVAM                            E20085
     C                     ELSE                                           E20085
     C                     Z-ADDWAIRP     EVAM                            E20085
     C                     END                                            E20085
      *                                                                   088778
     C           PROT      IFEQ '6'                                       088778
     C           NPSN      ANDEQ0                                         088778
     C***********PROT      OREQ '6'                                088778 186983
     C***********EVAM      ANDLT0                                  088778 186983
     C                     Z-ADD0         EVAM                            088778
     C                     END                                            088778
      *                                                                   088778
      *                                                                   E20085
     C           EVAM      IFNE 0                                         E20085
     C                     EXSR WRITED                                    E20085
     C/COPY WNCPYSRC,SE2210C001
     C                     END                                            E20085
      *                                                                   E20085
      ***  Reset AIR Posted since Last Control Date.                      E20085
      *                                                                   E20085
     C           WAIRP     ADD  ARPC      ARPC                            E20085
     C*                                                                   E21232
     C***********          Z-ADDECD       LPCD                     E21232 E22957
     C***********          Z-ADDECD       ICLD                     E22957 E23738
     C                     Z-ADDACDT      ICLD                            E23738
     C/COPY WNCPYSRC,SE2210C058
      *                                                                   E20085
     C           EACCRU    ENDSR                           *** EACCRU *** E20085
      *                                                                   E20085
      *****************************************************************   E20085
      /EJECT                                                              E20085
     C*****************************************************************   E20085
     C*                                                               *   E20085
     C*  REDUNDANT CODE REMOVED BY E20085                             *   E20085
     C*                                                               *   E20085
     C*************************************************************E13817 E14616
     C****INT*****-**SUBROUTINE*TO*CALCULATE*INTEREST*FOR*PROCESSINE13817 E14616
     C****************TYPES*1,3,5*OR*8*****************************E13817 E14616
     C*************************                                    E13817 E14616
     C***********INTCPN****BEGSR                           ** INTCPE13817 E14616
     C***********EINT      ENDSR                           ** EINT E13817 E14616
     C***********                                                         E13817
     C*****************************************************************   E13817
     C*****************************************************************   E13817
     C* ACCRX*****-**SUBROUTINE*TO*CALCULATE*EX-COUPON*ACCRUAL*********   E13817
     C***********                                                         E13817
     C***********ACCRX     BEGSR                           ** ACCRX  **   E13817
     C***********          ENDSR                                          E13817
     C***********                                                         E13817
     C*****************************************************************   E13817
      /EJECT                                                              S01233
      *****************************************************************   S01233
      *                                                               *   S01233
      *  AAMORT - Subroutine to Amortise Premium/Discount on a Yield  *   S01233
      *           Curve Basis for the Australian Market.              *   S01233
      *                                                               *   S01233
      *****************************************************************   S01233
      *                                                                   S01233
     C           AAMORT    BEGSR                           *** AAMORT *** S01233
     C*                                                                   S01233
     C**  If initial date has not been reached yet, then bypass           S01233
     C*                                                                   S01233
     C           ITLD      IFGT ACDT                                      S01233
     C           CSE065    OREQ 'Y'                                                           CSE065
     C           ALDT      ANDLTRUND                                                          CSE065
     C           WAMORT    ANDNE' '                                                           CSE065
     C                     GOTO AAEND                                     S01233
     C                     END                                            S01233
     C*                                                                   S01233
     C** Initialise work fields                                           S01233
     c*                                                                   S01233
     C                     Z-ADD0         YLDPRC 158                      S01233
     C                     Z-ADD0         LCDWRK 130                      S01233
     C                     Z-ADD0         NCDWRK 130                      S01233
     C                     Z-ADD0         ACTWRK 130                      S01233
     C                     Z-ADD0         WRKPIX 130                      S01233
     C                     Z-ADD0         WRKPI                           S01233
     C*                                                                   S01233
     C           LATD      IFNE 0                                         S01233
     C           LPSD      IFGT LATD                                      E24428
     C                     Z-ADDLPSD      ZSDATE                          E24428
     C                     ELSE                                           E24428
     C                     Z-ADDLATD      LASTD   50                      S01233
     C                     END                                            E24428
     C                     ELSE                                           S01233
     C***********          Z-ADDLPSD      LASTD                    S01233 E22957
     C                     Z-ADDLPCD      LASTD                           E22957
     C                     END                                            S01233
     C*                                                                   S01233
     C** Save Event Control Date.                                         S01233
     C*                                                                   S01233
     C                     Z-ADDECD       ECDPRV  50                      S01233
     C*                                                                   E20953
     C** Set nominal to positive for working on                           E20953
     C*                                                                   E20953
     C           NPSN      IFLT 0                                         E20953
     C                     Z-SUBNPSN      WNOML  130                      E20953
     C                     ELSE                                           E20953
     C                     Z-ADDNPSN      WNOML                           E20953
     C                     END                                            E20953
     C*                                                                   S01233
     C** If Coupon rate = zeroes (eg. Commercial Paper)                   S01233
     C** then zeroise WRKPI and bypass interest calcs.                    S01233
     C*                                                                   S01233
     C           CPNR      IFEQ 0                                         S01233
     C           SYBS      ORNE 'AU'                                      S01233
     C/COPY WNCPYSRC,SE2210C062
     C                     Z-ADD*ZEROS    WRKPI                           S01233
     C*                                                                   S01233
     C                     ELSE                                           S01233
     C*                                                                   S01233
     C* Obtain next coupon date for previous period                       S01233
     C*                                                                   S01233
     C***********          Z-ADDLASTD     ECD                      S01233 E22957
     C           LASTD     ADD  1         ECD                             E22957
     C                     EXSR ZNCD                                      S01233
     C*                                                                   S01233
     C* Obtain last coupon date for previous period                       S01233
     C*                                                                   S01233
     C***********          Z-ADDLASTD     ZECD                     S01233 E22957
     C           NCD       SUB  1         ZECD                            E22957
     C                     EXSR ZLCD                                      S01233
     C                     Z-ADDZZLCD     LCOUP   50                      S01233
     C*                                                                   S01233
     C**set*nominal*to*positive*for*working*on*********************S01233 E20953
     C***********NPSN      IFLT 0                                  S01233 E20953
     C***********          Z-SUBNPSN      WNOML  130               S01233 E20953
     C***********          ELSE                                    S01233 E20953
     C***********          Z-ADDNPSN      WNOML                    S01233 E20953
     C***********          END                                     S01233 E20953
     C*                                                                   S01233
     C* Determine if period Cum or Ex                                     S01233
     C*                                                                   S01233
     C                     Z-ADDLASTD     WRKD                            S01233
     C                     EXSR ZYCE                                      S01233
     C*                                                                   S01233
     C* Calculate interest for Cum period (SCUMEX = C)                    S01233
     C*                                                                   S01233
     C/COPY WNCPYSRC,SE2210C043
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C                     Z-ADDLCOUP     ZDCSDT                                              CSE035
     C                     Z-ADDLASTD     ZDCEDT                                              CSE035
     C                     Z-ADDWNOML     ZAMT                                                CSE035
     C                     EXSR ZACCZ                                                         CSE035
     C                     Z-ADDZDCINT    TOTACC                                              CSE035
     C                     Z-ADDZDCINT    WRKPIX                                              CSE035
      *                                                                                       CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SCUMEX    IFEQ 'C'                                       S01233
     C/COPY WNCPYSRC,SE2210C044
     C                     Z-ADDLCOUP     ZDCSDT                          S01233
     C***********          Z-ADDLPSD      ZDCEDT                   S01233 E22957
     C                     Z-ADDLASTD     ZDCEDT                          E22957
     C                     Z-ADDWNOML     ZAMT                            S01233
     C/COPY WNCPYSRC,SE2210C021
     C                     EXSR ZACCZ                                     S01233
     C/COPY WNCPYSRC,SE2210C022
     C                     Z-ADDZDCINT    TOTACC                          S01233
     C                     Z-ADDZDCINT    WRKPIX                          E22957
     C***********                                                  S01233 E22957
     C**Calculate*the*Accrued*Interest*on*the*Ex-Coupon*Nominal*   S01233 E22957
     C***********                                                  S01233 E22957
     C***********ECNP      IFEQ 0                                  S01233 E22957
     C***********          Z-ADD0         WTCPN                    S01233 E22957
     C***********          ELSE                                    S01233 E22957
     C***********          Z-ADDLCOUP     ZDCSDT                   S01233 E22957
     C***********          Z-ADDNCD       ZDCEDT                   S01233 E22957
     C***********ECNP      IFLT 0                                  S01233 E22957
     C***********          Z-SUBECNP      ZAMT                     S01233 E22957
     C***********          ELSE                                    S01233 E22957
     C***********          Z-ADDECNP      ZAMT                     S01233 E22957
     C***********          END                                     S01233 E22957
     C***********          EXSR ZACCZ                              S01233 E22957
     C***********          Z-ADDZDCINT    WTCPN                    S01233 E22957
     C***********          END                                     S01233 E22957
     C***********                                                  S01233 E22957
     C***********TOTACC    SUB  WTCPN     WRKPIX                   S01233 E22957
     C***********WRKPIX    IFLT 0                                  S01233 E20953
     C***********WRKPIX    IFLE 0                                  E20953 E22957
     C***********          MOVE 'X'       SCUMEX                   S01233 E22957
     C***********          END                                     S01233 E22957
     C*                                                                   S01233
     C/COPY WNCPYSRC,SE2210C045
     C                     END                                            S01233
     C/COPY WNCPYSRC,SE2210C046
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C*                                                                   S01233
     C* Calculate interest for Ex period (SCUMEX = X)                     S01233
     C*                                                                   S01233
     C           SCUMEX    IFEQ 'X'                                       S01233
     C*                                                                   S01233
     C* Calculate interest from last coupon to latest pos. date           S01233
     C*                                                                   S01233
     C                     Z-ADDLCOUP     ZDCSDT                          S01233
     C***********          Z-ADDLPSN      ZDCEDT                   S01233 E20953
     C                     Z-ADDLASTD     ZDCEDT                          E20953
     C                     Z-ADDWNOML     ZAMT                            S01233
     C/COPY WNCPYSRC,SE2210C023
     C                     EXSR ZACCZ                                     S01233
     C/COPY WNCPYSRC,SE2210C024
     C                     Z-ADDZDCINT    LCDWRK                          S01233
     C*                                                                   S01233
     C* Calculate interest from last coupon to next coupon                S01233
     C*                                                                   S01233
     C                     Z-ADDLCOUP     ZDCSDT                          S01233
     C                     Z-ADDNCD       ZDCEDT                          S01233
     C                     Z-ADDWNOML     ZAMT                            S01233
     C/COPY WNCPYSRC,SE2210C025
     C                     EXSR ZACCZ                                     S01233
     C/COPY WNCPYSRC,SE2210C026
     C                     Z-ADDZDCINT    NCDWRK                          S01233
     C*                                                                   S01233
     C           LCDWRK    SUB  NCDWRK    WRKPIX                          S01233
     C*                                                                   S01233
     C                     END                                            S01233
     C*                                                                   S01233
     C* Make interest figure a percentage                                 S01233
     C*                                                                   S01233
     C           WRKPIX    DIV  WNOML     WRKPI                           S01233
     C*                                                                   S01233
     C                     END                                            S01233
     C*                                                                   S01233
     C* Calculate Yield from last (change/amort) date                     S01233
     C*                                                                   S01233
     C                     Z-ADDLAVP      ZPRICE                          S01233
     C                     Z-ADDLASTD     ZFDATE                          S01233
     C           CSE032    IFEQ 'Y'                                                           225469
     C           LATD      ANDEQ0                                                             225469
     C           LAVP      ANDEQ100                                                           225469
     C           ACDT      SUB  1         ZFDATE                                              225469
     C                     ENDIF                                                              225469
     C*                                                                   102506
     C** Set day number accrued to for ZDAYS Subroutine                   102506
     C*                                                                   102506
     C                     Z-ADDDNAT      ZIDNAT                          102506
     C*                                                                   102506
     C** Set accrual type for ZDAYS Subroutine                            102506
     C*                                                                   102506
     C                     MOVE *BLANK    ZACLT                           102506
     C*                                                                   102506
     C                     Z-ADDWNOML     ZNOML                           E39495
     C                     EXSR ZPRCO                                     S01233
     C                     Z-ADDZPRCOT    YLDPRC                          S01233
     C*                                                                   S01233
     C* CALCULATE PRICE FROM YIELD TO ACTION DATE.                        S01233
     C*                                                                   S01233
     C* If Coupon rate = zeroes (eg. Commercial Paper)                    S01233
     C* then zeroise WRKPI and bypass interest calcs.                     S01233
     C*                                                                   S01233
     C           CPNR      IFEQ 0                                         S01233
     C           SYBS      ORNE 'AU'                                      S01233
     C/COPY WNCPYSRC,SE2210C063
     C                     Z-ADD*ZEROS    WRKPI                           S01233
     C*                                                                   S01233
     C                     ELSE                                           S01233
     C*                                                                   S01233
     C* Obtain coupon date for current period                             S01233
     C*                                                                   S01233
     C***********          Z-ADDECDPRV    ECD                      S01233 E22957
     C           ACDT      ADD  1         ECD                             E22957
     C                     EXSR ZNCD                                      S01233
     C*                                                                   E22957
     C* Obtain last coupon date for current period                        E22957
     C*                                                                   E22957
     C           NCD       SUB  1         ZECD                            E22957
     C                     EXSR ZLCD                                      E22957
     C                     Z-ADDZZLCD     LCOUP   50                      E22957
     C*                                                                   S01233
     C* Determine if period Cum. or Ex.                                   S01233
     C*                                                                   S01233
     C                     Z-ADDACDT      WRKD                            S01233
     C                     EXSR ZYCE                                      S01233
     C*                                                                   S01233
     C* Calculate interest for Cum period (SCUMEX = C)                    S01233
     C*                                                                   S01233
     C/COPY WNCPYSRC,SE2210C047
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C                     Z-ADDLCOUP     ZDCSDT                                              CSE035
     C                     Z-ADDACDT      ZDCEDT                                              CSE035
     C                     Z-ADDWNOML     ZAMT                                                CSE035
     C                     EXSR ZACCZ                                                         CSE035
     C                     Z-ADDZDCINT    TOTACC                                              CSE035
     C                     Z-ADDZDCINT    WRKPIX                                              CSE035
      *                                                                                       CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           SCUMEX    IFEQ 'C'                                       S01233
     C/COPY WNCPYSRC,SE2210C048
     C***********          Z-ADDLCPN      ZDCSDT                   S01233 E22957
     C                     Z-ADDLCOUP     ZDCSDT                          E22957
     C                     Z-ADDACDT      ZDCEDT                          S01233
     C                     Z-ADDWNOML     ZAMT                            S01233
     C/COPY WNCPYSRC,SE2210C027
     C                     EXSR ZACCZ                                     S01233
     C/COPY WNCPYSRC,SE2210C028
     C                     Z-ADDZDCINT    TOTACC                          S01233
     C                     Z-ADDZDCINT    WRKPIX                          E22957
     C***********                                                  S01233 E22957
     C**Calculate*the*Accrued*Interest*on*the*Ex-Coupon*Nominal*   S01233 E22957
     C***********                                                  S01233 E22957
     C***********ECNP      IFEQ 0                                  S01233 E22957
     C***********          Z-ADD0         WTCPN                    S01233 E22957
     C***********          ELSE                                    S01233 E22957
     C***********          Z-ADDLCPN      ZDCSDT                   S01233 E22957
     C***********          Z-ADDNCD       ZDCEDT                   S01233 E22957
     C***********ECNP      IFLT 0                                  S01233 E22957
     C***********          Z-SUBECNP      ZAMT                     S01233 E22957
     C***********          ELSE                                    S01233 E22957
     C***********          Z-ADDECNP      ZAMT                     S01233 E22957
     C***********          END                                     S01233 E22957
     C***********          EXSR ZACCZ                              S01233 E22957
     C***********          Z-ADDZDCINT    WTCPN                    S01233 E22957
     C***********          END                                     S01233 E22957
     C***********                                                  S01233 E22957
     C***********TOTACC    SUB  WTCPN     WRKPIX                   S01233 E22957
     C***********WRKPIX    IFLT 0                                  S01233 E20953
     C***********WRKPIX    IFLE 0                                  E20953 E22957
     C***********          MOVE 'X'       SCUMEX                   S01233 E22957
     C***********          END                                     S01233 E22957
     C*                                                                   S01233
     C/COPY WNCPYSRC,SE2210C049
     C                     END                                            S01233
     C/COPY WNCPYSRC,SE2210C050
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C*                                                                   S01233
     C* Calculate interest for Ex period (SCUMEX = X)                     S01233
     C*                                                                   S01233
     C           SCUMEX    IFEQ 'X'                                       S01233
     C*                                                                   S01233
     C* Calculate interest from last coupon to action date                S01233
     C*                                                                   S01233
     C***********          Z-ADDLCPN      ZDCSDT                   S01233 E22957
     C                     Z-ADDLCOUP     ZDCSDT                          E22957
     C                     Z-ADDACDT      ZDCEDT                          S01233
     C                     Z-ADDWNOML     ZAMT                            S01233
     C/COPY WNCPYSRC,SE2210C029
     C                     EXSR ZACCZ                                     S01233
     C/COPY WNCPYSRC,SE2210C030
     C                     Z-ADDZDCINT    ACTWRK                          S01233
     C*                                                                   S01233
     C* Calculate interest from last coupon to next coupon                S01233
     C*                                                                   S01233
     C***********          Z-ADDLCPN      ZDCSDT                   S01233 E22957
     C                     Z-ADDLCOUP     ZDCSDT                          E22957
     C                     Z-ADDNCD       ZDCEDT                          S01233
     C                     Z-ADDWNOML     ZAMT                            S01233
     C/COPY WNCPYSRC,SE2210C031
     C                     EXSR ZACCZ                                     S01233
     C/COPY WNCPYSRC,SE2210C032
     C                     Z-ADDZDCINT    NCDWRK                          S01233
     C*                                                                   S01233
     C           ACTWRK    SUB  NCDWRK    WRKPIX                          S01233
     C*                                                                   S01233
     C                     END                                            S01233
     C*                                                                   S01233
     C* Make interest figure a percentage                                 S01233
     C*                                                                   S01233
     C           WRKPIX    DIV  WNOML     WRKPI                           S01233
     C*                                                                   S01233
     C                     END                                            S01233
     C*                                                                   S01233
     C* Calculate New Price from Action date                              S01233
     C*                                                                   S01233
     C                     Z-ADDYLDPRC    ZPRCIN                          S01233
     C                     Z-ADDACDT      ZFDATE                          S01233
     C*                                                                   102506
     C** Set accrual type for ZDAYS Subroutine                            102506
     C*                                                                   102506
     C                     MOVE 'Y'       ZACLT                           102506
     C*                                                                   E39495
     C                     Z-ADDWNOML     ZNOML                           E39495
     C*                                                                   E39495
     C                     EXSR ZPRCI                                     S01233
     C*                                                                   102506
     C** Reset accrual type                                               102506
     C*                                                                   102506
     C                     Z-ADD*ZERO     ZIDNAT                          102506
     C                     MOVE *BLANK    ZACLT                           102506
     C*                                                                   102506
     C** Update day number accrued to                                     102506
     C*                                                                   102506
     C                     Z-ADDZODNAT    DNAT                            102506
     C*                                                                   S01233
     C* Calculate amount to amortise                                      S01233
     C*                                                                   S01233
     C           ZPRCOT    SUB  LAVP      ZPRC                            S01233
     C***********          Z-ADDWNOML     ZNOML                    S01233 E22957
     C                     Z-ADDNPSN      ZNOML                           E22957
     C                     EXSR ZCNSD                                     S01233
     C                     Z-ADDZCONS     WADP                            S01233
     C/COPY WNCPYSRC,SE2210C064
     C*                                                                   S01233
     C* Return old Event Control Date                                     S01233
     C*                                                                   S01233
     C                     Z-ADDECDPRV    ECD                             S01233
     C*                                                                   S01233
     C           AAEND     ENDSR                           *** AAEND  *** S01233
      *                                                                   S01233
      *****************************************************************   S01233
      /EJECT
      *****************************************************************                       CAS006
      *                                                               *                       CAS006
      *  AAMORN - Subroutine to Amortise Premium/Discount on a Yield  *                       CAS006
      *           Curve Basis for the Australian Market using Net     *                       CAS006
      *           Treasury Price.                                     *                       CAS006
      *****************************************************************                       CAS006
      *                                                                                       CAS006
     C           AAMORN    BEGSR                           *** AAMORN ***                     CAS006
      *                                                                                       CAS006
      **  If initial date has not been reached yet, then bypass                               CAS006
      *                                                                                       CAS006
     C           ITLD      IFGT ACDT                                                          CAS006
     C           CSE065    OREQ 'Y'                                                           CSE065
     C           ALDT      ANDLTRUND                                                          CSE065
     C           WAMORT    ANDNE' '                                                           CSE065
     C                     GOTO AAENN                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Initialise work fields                                                               CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         YLDPRN 158                                          CAS006
     C                     Z-ADD0         LCDWRK                                              CAS006
     C                     Z-ADD0         NCDWRK                                              CAS006
     C                     Z-ADD0         ACTWRK                                              CAS006
     C                     Z-ADD0         WRKPIX                                              CAS006
     C                     Z-ADD0         WRKPI                                               CAS006
      *                                                                                       CAS006
     C           LATD      IFNE 0                                                             CAS006
     C           LPSD      IFGT LATD                                                          CAS006
     C                     Z-ADDLPSD      ZSDATE                                              CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADDLATD      LASTD                                               CAS006
     C                     ENDIF                                                              CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADDLPCD      LASTD                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Save Event Control Date.                                                             CAS006
      *                                                                                       CAS006
     C                     Z-ADDECD       ECDPRV                                              CAS006
      *                                                                                       CAS006
      ** Set nominal to positive for working on                                               CAS006
      *                                                                                       CAS006
     C           NPSN      IFLT 0                                                             CAS006
     C                     Z-SUBNPSN      WNOML                                               CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADDNPSN      WNOML                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** If Coupon rate = zeroes (eg. Commercial Paper)                                       CAS006
      ** then zeroise WRKPI and bypass interest calcs.                                        CAS006
      *                                                                                       CAS006
     C           CPNN      IFEQ 0                                                             CAS006
     C           SYBS      ORNE 'AU'                                                          CAS006
     C                     Z-ADD*ZEROS    WRKPI                                               CAS006
     C*                                                                                       CAS006
     C                     ELSE                                                               CAS006
      *                                                                                       CAS006
      ** Obtain next coupon date for previous period                                          CAS006
      *                                                                                       CAS006
     C           LASTD     ADD  1         ECD                                                 CAS006
     C                     EXSR ZNCD                                                          CAS006
      *                                                                                       CAS006
      ** Obtain last coupon date for previous period                                          CAS006
      *                                                                                       CAS006
     C           NCD       SUB  1         ZECD                                                CAS006
     C                     EXSR ZLCD                                                          CAS006
     C                     Z-ADDZZLCD     LCOUP                                               CAS006
      *                                                                                       CAS006
      ** Determine if period Cum or Ex                                                        CAS006
      *                                                                                       CAS006
     C                     Z-ADDLASTD     WRKD                                                CAS006
     C                     EXSR ZYCE                                                          CAS006
      *                                                                                       CAS006
      ** Calculate interest for Cum period (SCUMEX = C)                                       CAS006
      *                                                                                       CAS006
     C           SCUMEX    IFEQ 'C'                                                           CAS006
     C                     Z-ADDLCOUP     ZDCSDT                                              CAS006
     C                     Z-ADDLASTD     ZDCEDT                                              CAS006
     C                     Z-ADDWNOML     ZAMT                                                CAS006
     C                     EXSR ZACCZ                                                         CAS006
     C                     Z-ADDZDCINT    TOTACC                                              CAS006
     C                     Z-ADDZDCINT    WRKPIX                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Calculate interest for Ex period (SCUMEX = X)                                        CAS006
      *                                                                                       CAS006
     C           SCUMEX    IFEQ 'X'                                                           CAS006
      *                                                                                       CAS006
      ** Calculate interest from last coupon to latest pos. date                              CAS006
      *                                                                                       CAS006
     C                     Z-ADDLCOUP     ZDCSDT                                              CAS006
     C                     Z-ADDLASTD     ZDCEDT                                              CAS006
     C                     Z-ADDWNOML     ZAMT                                                CAS006
     C                     EXSR ZACCZ                                                         CAS006
     C                     Z-ADDZDCINT    LCDWRK                                              CAS006
      *                                                                                       CAS006
      ** Calculate interest from last coupon to next coupon                                   CAS006
      *                                                                                       CAS006
     C                     Z-ADDLCOUP     ZDCSDT                                              CAS006
     C                     Z-ADDNCD       ZDCEDT                                              CAS006
     C                     Z-ADDWNOML     ZAMT                                                CAS006
     C                     EXSR ZACCZ                                                         CAS006
     C                     Z-ADDZDCINT    NCDWRK                                              CAS006
      *                                                                                       CAS006
     C           LCDWRK    SUB  NCDWRK    WRKPIX                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Make interest figure a percentage                                                    CAS006
      *                                                                                       CAS006
     C           WRKPIX    DIV  WNOML     WRKPI                                               CAS006
     C*                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Calculate Yield from last (change/amort) date                                        CAS006
      *                                                                                       CAS006
     C                     Z-ADDLAVN      ZPRICE                                              CAS006
     C                     Z-ADDLASTD     ZFDATE                                              CAS006
      *                                                                                       CAS006
      ** Set day number accrued to for ZDAYS Subroutine                                       CAS006
      *                                                                                       CAS006
     C                     Z-ADDDNAT      ZIDNAT                                              CAS006
      *                                                                                       CAS006
      ** Set accrual type for ZDAYS Subroutine                                                CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANK    ZACLT                                               CAS006
      *                                                                                       CAS006
     C                     Z-ADDWNOML     ZNOML                                               CAS006
     C                     EXSR ZPRCO                                                         CAS006
     C                     Z-ADDZPRCOT    YLDPRN                                              CAS006
      *                                                                                       CAS006
      ** Calculate price from yield to action date.                                           CAS006
      *                                                                                       CAS006
      ** If Coupon rate = zeroes (eg. Commercial Paper)                                       CAS006
      ** then zeroise WRKPI and bypass interest calcs.                                        CAS006
      *                                                                                       CAS006
     C           CPNN      IFEQ 0                                                             CAS006
     C           SYBS      ORNE 'AU'                                                          CAS006
     C                     Z-ADD*ZEROS    WRKPI                                               CAS006
      *                                                                                       CAS006
     C                     ELSE                                                               CAS006
      *                                                                                       CAS006
      ** Obtain coupon date for current period                                                CAS006
      *                                                                                       CAS006
     C           ACDT      ADD  1         ECD                                                 CAS006
     C                     EXSR ZNCD                                                          CAS006
      *                                                                                       CAS006
      ** Obtain last coupon date for current period                                           CAS006
      *                                                                                       CAS006
     C           NCD       SUB  1         ZECD                                                CAS006
     C                     EXSR ZLCD                                                          CAS006
     C                     Z-ADDZZLCD     LCOUP                                               CAS006
      *                                                                                       CAS006
      ** Determine if period Cum. or Ex.                                                      CAS006
      *                                                                                       CAS006
     C                     Z-ADDACDT      WRKD                                                CAS006
     C                     EXSR ZYCE                                                          CAS006
      *                                                                                       CAS006
      ** Calculate interest for Cum period (SCUMEX = C)                                       CAS006
      *                                                                                       CAS006
     C           SCUMEX    IFEQ 'C'                                                           CAS006
     C                     Z-ADDLCOUP     ZDCSDT                                              CAS006
     C                     Z-ADDACDT      ZDCEDT                                              CAS006
     C                     Z-ADDWNOML     ZAMT                                                CAS006
     C                     EXSR ZACCZ                                                         CAS006
     C                     Z-ADDZDCINT    TOTACC                                              CAS006
     C                     Z-ADDZDCINT    WRKPIX                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Calculate interest for Ex period (SCUMEX = X)                                        CAS006
      *                                                                                       CAS006
     C           SCUMEX    IFEQ 'X'                                                           CAS006
      *                                                                                       CAS006
      ** Calculate interest from last coupon to action date                                   CAS006
      *                                                                                       CAS006
     C                     Z-ADDLCOUP     ZDCSDT                                              CAS006
     C                     Z-ADDACDT      ZDCEDT                                              CAS006
     C                     Z-ADDWNOML     ZAMT                                                CAS006
     C                     EXSR ZACCZ                                                         CAS006
     C                     Z-ADDZDCINT    ACTWRK                                              CAS006
      *                                                                                       CAS006
      ** Calculate interest from last coupon to next coupon                                   CAS006
      *                                                                                       CAS006
     C                     Z-ADDLCOUP     ZDCSDT                                              CAS006
     C                     Z-ADDNCD       ZDCEDT                                              CAS006
     C                     Z-ADDWNOML     ZAMT                                                CAS006
     C                     EXSR ZACCZ                                                         CAS006
     C                     Z-ADDZDCINT    NCDWRK                                              CAS006
      *                                                                                       CAS006
     C           ACTWRK    SUB  NCDWRK    WRKPIX                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Make interest figure a percentage                                                    CAS006
      *                                                                                       CAS006
     C           WRKPIX    DIV  WNOML     WRKPI                                               CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** Calculate New Price from Action date                                                 CAS006
      *                                                                                       CAS006
     C                     Z-ADDYLDPRN    ZPRCIN                                              CAS006
     C                     Z-ADDACDT      ZFDATE                                              CAS006
      *                                                                                       CAS006
      ** Set accrual type for ZDAYS Subroutine                                                CAS006
      *                                                                                       CAS006
     C                     MOVE 'Y'       ZACLT                                               CAS006
      *                                                                                       CAS006
     C                     Z-ADDWNOML     ZNOML                                               CAS006
      *                                                                                       CAS006
     C                     EXSR ZPRCI                                                         CAS006
      *                                                                                       CAS006
      ** Reset accrual type                                                                   CAS006
      *                                                                                       CAS006
     C                     Z-ADD*ZERO     ZIDNAT                                              CAS006
     C                     MOVE *BLANK    ZACLT                                               CAS006
      *                                                                                       CAS006
      ** Update day number accrued to                                                         CAS006
      *                                                                                       CAS006
     C                     Z-ADDZODNAT    DNAT                                                CAS006
      *                                                                                       CAS006
      ** Calculate amount to amortise                                                         CAS006
      *                                                                                       CAS006
     C           ZPRCOT    SUB  LAVN      ZPRC                                                CAS006
     C                     Z-ADDNPSN      ZNOML                                               CAS006
     C                     EXSR ZCNSD                                                         CAS006
     C                     Z-ADDZCONS     WADN                                                CAS006
      *                                                                                       CAS006
      ** Return old Event Control Date                                                        CAS006
      *                                                                                       CAS006
     C                     Z-ADDECDPRV    ECD                                                 CAS006
      *                                                                                       CAS006
     C           AAENN     ENDSR                           *** AAENN  ***                     CAS006
      *                                                                                       CAS006
      *****************************************************************                       CSE065
      /EJECT                                                                                  CSE065
      *****************************************************************                       CSE065
      *                                                               *                       CSE065
      *  AAMORC - Subroutine to calculate amortisation for            *                       CSE065
      *           Available for Sales Book                            *                       CSE065
      *                                                               *                       CSE065
      *****************************************************************                       CSE065
      *                                                                                       CSE065
     C           AAMORC    BEGSR                                                              CSE065
      *                                                                                       CSE065
      ** Store MATY, LATD, LPSD & LPCD to work variable                                       CSE065
      *                                                                                       CSE065
     C                     MOVE MATY      W@MATY                                              CSE065
     C                     MOVE LATD      W@LATD                                              CSE065
     C                     MOVE LPSD      W@LPSD                                              CSE065
     C                     MOVE LPCD      W@LPCD                                              CSE065
     C                     Z-ADDACDT      WACDT   50                                          CSE065
      *                                                                                       CSE065
     C                     MOVE *ZEROS    WWADP                                               CSE065
     C                     MOVE *ZEROS    WWEDN                                               CSE065
      *                                                                                       CSE065
     C                     MOVE SESN      K@SVSN                                              CSE065
     C                     MOVE 'AL'      K@SDET                                              CSE065
     C                     MOVE ZSDATE    K@SDED                                              CSE065
      *                                                                                       CSE065
     C           SEDVKY    SETGTSEDEVAL1                                                      CSE065
     C                     READPSEDEVAL1                 65                                   CSE065
      *                                                                                       CSE065
     C           *IN65     IFEQ *ON                                                           CSE065
     C           C#SDSN    ORNE SESN                                                          CSE065
     C           C#SDET    ORNE 'AL'                                                          CSE065
     C           *LOCK     IN   LDA                                                           CSE065
     C                     MOVE 'SEDEVD'  DBFILE                                              CSE065
     C                     Z-ADD51        DBASE                                               CSE065
     C                     MOVEL'INIT AL' DBKEY                                               CSE065
     C                     MOVE '1'       *INU7                                               CSE065
     C                     MOVE '1'       *INU8                                               CSE065
     C                     OUT  LDA                                                           CSE065
     C                     EXSR *PSSR                                                         CSE065
     C                     MOVE '1'       *INLR                                               CSE065
     C                     ELSE                                                               CSE065
     C                     Z-ADDC#SDAL    WALDT1                                              CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C           *IN65     DOUEQ*ON                                                           CSE065
     C           C#SDSN    OREQ SESN                                                          CSE065
     C           C#SDET    ORNE 'AL'                                                          CSE065
     C           C#SDED    ORGE WACDT                                                         CSE065
      *                                                                                       CSE065
      ** Read next 'AL' record                                                                CSE065
      *                                                                                       CSE065
     C                     READ SEDEVAL1                 65                                   CSE065
      *                                                                                       CSE065
      ** If found, set the dates                                                              CSE065
      *                                                                                       CSE065
     C           *IN65     IFEQ *OFF                                                          CSE065
     C           C#SDSN    ANDEQSESN                                                          CSE065
     C           C#SDET    ANDEQ'AL'                                                          CSE065
     C           C#SDED    ANDLEACDT                                                          CSE065
     C                     Z-ADDC#SDED    ACDT                                                CSE065
     C                     Z-ADDC#SDAL    WALDT2                                              CSE065
     C                     ELSE                                                               CSE065
     C                     Z-ADDWACDT     ACDT                                                CSE065
     C                     Z-ADDWALDT1    WALDT2                                              CSE065
     C                     ENDIF                                                              CSE065
     C**********           MOVE WALDT1    MATY                                         CSE065 233707
     C                     MOVE WALDT2    MATY                                                233707
      *                                                                                       CSE065
     C           WAMORT    IFEQ 'N'                                                           CSE065
     C                     EXSR AAMORN                                                        CSE065
     C                     ELSE                                                               CSE065
     C                     EXSR AAMORT                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C           WAMORT    IFEQ 'N'                                                           CSE065
     C                     ADD  WADN      WWEDN                                               CSE065
     C                     ELSE                                                               CSE065
     C                     ADD  WADP      WWADP                                               CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     Z-ADDWALDT2    WALDT1                                              CSE065
     C                     MOVE ACDT      LATD                                                CSE065
     C                     MOVE ACDT      LPSD                                                CSE065
     C                     MOVE ACDT      LPCD                                                CSE065
      *                                                                                       CSE065
     C                     ENDDO                                                              CSE065
      *                                                                                       CSE065
     C           WAMORT    IFEQ 'N'                                                           CSE065
     C                     MOVE WWEDN     WADN                                                CSE065
     C                     ELSE                                                               CSE065
     C                     MOVE WWADP     WADP                                                CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     MOVE W@MATY    MATY                                                CSE065
     C                     MOVE W@LATD    LATD                                                CSE065
     C                     MOVE W@LPSD    LPSD                                                CSE065
     C                     MOVE W@LPCD    LPCD                                                CSE065
     C                     Z-ADDWACDT     ACDT                                                CSE065
      *                                                                                       CSE065
     C                     ENDSR                                                              CSE065
      *                                                                                       CSE065
      *****************************************************************                       CSE065
      /EJECT                                                                                  CSE065
      *****************************************************************                       CSE065
      *                                                               *                       CSE065
      *  AMORSL - Subroutine to calculate amortisation for Straight   *                       CSE065
      *           Line Method base on changes in Average Life Date.   *                       CSE065
      *                                                               *                       CSE065
      *****************************************************************                       CSE065
      *                                                                                       CSE065
     C           AMORSL    BEGSR                                                              CSE065
      *                                                                                       CSE065
      ** Store ACDT to Work Variable                                                          CSE065
      *                                                                                       CSE065
     C                     MOVE ACDT      W@ACDT                                              CSE065
      *                                                                                       CSE065
     C                     Z-ADD*ZEROS    WWADP                                               CSE065
     C                     Z-ADD*ZEROS    WWEDN                                               CSE065
      *                                                                                       CSE065
     C                     MOVE SESN      K@SVSN                                              CSE065
     C                     MOVE 'AL'      K@SDET                                              CSE065
     C                     MOVE ZSDATE    K@SDED                                              CSE065
      *                                                                                       CSE065
     C           SEDVKY    SETGTSEDEVAL1                                                      CSE065
     C                     READPSEDEVAL1                 66                                   CSE065
      *                                                                                       CSE065
     C           *IN66     IFEQ *ON                                                           CSE065
     C           C#SDSN    ORNE SESN                                                          CSE065
     C           C#SDET    ORNE 'AL'                                                          CSE065
     C           *LOCK     IN   LDA                                                           CSE065
     C                     MOVE 'SEDEVD'  DBFILE                                              CSE065
     C                     Z-ADD50        DBASE                                               CSE065
     C                     MOVEL'INIT AL' DBKEY                                               CSE065
     C                     MOVE '1'       *INU7                                               CSE065
     C                     MOVE '1'       *INU8                                               CSE065
     C                     OUT  LDA                                                           CSE065
     C                     EXSR *PSSR                                                         CSE065
     C                     MOVE '1'       *INLR                                               CSE065
     C                     ELSE                                                               CSE065
     C                     Z-ADDC#SDAL    WALDT1  50                                          CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C           *IN66     DOUEQ*ON                                                           CSE065
     C           C#SDSN    ORNE SESN                                                          CSE065
     C           C#SDET    ORNE 'AL'                                                          CSE065
     C           C#SDED    ORGE W@ACDT                                                        CSE065
      *                                                                                       CSE065
      ** Read next 'AL' record                                                                CSE065
      *                                                                                       CSE065
     C                     READ SEDEVAL1                 66                                   CSE065
      *                                                                                       CSE065
      ** If found, set the dates                                                              CSE065
      *                                                                                       CSE065
     C           *IN66     IFEQ *OFF                                                          CSE065
     C           C#SDSN    ANDEQSESN                                                          CSE065
     C           C#SDET    ANDEQ'AL'                                                          CSE065
     C           C#SDED    ANDLEW@ACDT                                                        CSE065
     C                     Z-ADDC#SDED    ACDT                                                CSE065
     C                     Z-ADDC#SDAL    WALDT2  50                                          CSE065
     C                     ELSE                                                               CSE065
     C                     Z-ADDW@ACDT    ACDT                                                CSE065
     C                     Z-ADDWALDT1    WALDT2                                              CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** Calculate number of days to Average Life Date                                        CSE065
      *                                                                                       CSE065
     C                     MOVE WALDT1    ZEDATE                                              CSE065
     C                     MOVE DNAT      ZIDNAT                                              CSE065
     C                     MOVE *BLANKS   ZACLT                                               CSE065
     C                     EXSR ZDAYS                                                         CSE065
      *                                                                                       CSE065
      ** Move ZDDAYS to No_of_Days1                                                           CSE065
      *                                                                                       CSE065
     C                     MOVE ZDDAYS    W@NDY1                                              CSE065
      *                                                                                       CSE065
      ** Calculate number of days to amortised                                                CSE065
      *                                                                                       CSE065
     C           WALDT1    IFLT ACDT                                                          CSE065
     C                     MOVE WALDT1    ZEDATE                                              CSE065
     C                     ELSE                                                               CSE065
     C                     MOVE ACDT      ZEDATE                                              CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     MOVE DNAT      ZIDNAT                                              CSE065
     C                     MOVE 'D'       ZACLT                                               CSE065
      *                                                                                       CSE065
     C                     EXSR ZDAYS                                                         CSE065
      *                                                                                       CSE065
      ** Move ZDDAYS to No_of_Days2                                                           CSE065
      *                                                                                       CSE065
     C                     MOVE ZDDAYS    W@NDY2                                              CSE065
      *                                                                                       CSE065
     C                     Z-ADD*ZEROS    ZIDNAT                                              CSE065
     C                     MOVE *BLANKS   ZACLT                                               CSE065
     C                     MOVE ZODNAT    DNAT                                                CSE065
      *                                                                                       CSE065
      ** Calculate Earned Discount/Premium since Latest Position Date                         CSE065
      *                                                                                       CSE065
     C           W@NDY1    IFEQ 0                                                             CSE065
     C           W@NDY1    ORLT W@NDY2                                                        CSE065
     C                     MOVE BUDU      WEDP                                                CSE065
      *                                                                                       CSE065
     C           CAS006    IFEQ 'Y'                                                           CSE065
     C                     MOVE BUDN      WEDN                                                CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ELSE                                                               CSE065
      *                                                                                       CSE065
     C           BUDU      DIV  W@NDY1    WEDP                                                CSE065
     C                     MULT W@NDY2    WEDP                                                CSE065
      *                                                                                       CSE065
     C           CAS006    IFEQ 'Y'                                                           CSE065
     C           BUDN      DIV  W@NDY1    WEDN                                                CSE065
     C                     MULT W@NDY2    WEDN                                                CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** Accumulate Amortised Discount/Premium to post                                        CSE065
      *                                                                                       CSE065
     C                     ADD  WEDP      WWADP                                               CSE065
      *                                                                                       CSE065
     C           CAS006    IFEQ 'Y'                                                           CSE065
     C                     ADD  WEDN      WWEDN                                               CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     MOVE ACDT      ZSDATE                                              CSE065
     C                     Z-ADDWALDT2    WALDT1                                              CSE065
     C                     ENDDO                                                              CSE065
      *                                                                                       CSE065
     C                     MOVE WWADP     WADP                                                CSE065
      *                                                                                       CSE065
     C           CAS006    IFEQ 'Y'                                                           CSE065
     C                     MOVE WWEDN     WADN                                                CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     MOVE W@ACDT    ACDT                                                CSE065
      *                                                                                       CSE065
     C                     ENDSR                                                              CSE065
      *                                                                                       CSE065
      *****************************************************************                       CSE065
      /EJECT                                                                                  CSE065
      *****************************************************************                       CSE065
      *                                                               *                       CSE065
      *  SREQTY - Subroutine to post Equity Amount account keys       *                       CSE065
      *           equivalent to amortisation amount                   *                       CSE065
      *                                                               *                       CSE065
      *****************************************************************                       CSE065
      *                                                                                       CSE065
     C           SREQTY    BEGSR                                                              CSE065
      *                                                                                       CSE065
     C                     Z-SUBWADP      W@QAMT                                              CSE065
      *                                                                                       CSE065
     C           WADP      ADD  EQTAMT    W@QDIF                                              CSE065
      *                                                                                       CSE065
     C                     MOVE 'V'       EVTP                                                CSE065
     C                     MOVE *BLANK    PSBS                                                CSE065
     C                     MOVE *BLANK    FILL                                                CSE065
      *                                                                                       CSE065
     C           NPAC      IFEQ 'N'                                                           CSE065
     C           NPSN      ORGE 0                                                             CSE065
     C                     MOVE *BLANK    NEGI                                                CSE065
     C                     ELSE                                                               CSE065
     C                     MOVE 'N'       NEGI                                                CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** If Equity Amount is positive and EQTAMT is negative                                  CSE065
      *                                                                                       CSE065
     C           W@QAMT    IFGE 0                                                             CSE065
     C           EQTAMT    ANDLT0                                                             CSE065
      *                                                                                       CSE065
     C           W@QDIF    IFGT 0                                                             CSE065
     C                     MOVE 'ED'      AMCD                                                CSE065
     C                     MOVE EQTAMT    EVAM                                                CSE065
      *                                                                                       CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR WRITED                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     MOVE 'EI'      AMCD                                                CSE065
     C                     MOVE W@QDIF    EVAM                                                CSE065
      *                                                                                       CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR WRITED                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ELSE                                                               CSE065
      *                                                                                       CSE065
     C                     MOVE 'ED'      AMCD                                                CSE065
     C                     Z-SUBW@QAMT    EVAM                                                CSE065
      *                                                                                       CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR WRITED                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** If Equity Amount is negative and EQTAMT is positive                                  CSE065
      *                                                                                       CSE065
     C           W@QAMT    IFLT 0                                                             CSE065
     C           EQTAMT    ANDGE0                                                             CSE065
      *                                                                                       CSE065
     C           W@QDIF    IFLT 0                                                             CSE065
     C                     MOVE 'EI'      AMCD                                                CSE065
     C                     Z-SUBEQTAMT    EVAM                                                CSE065
      *                                                                                       CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR WRITED                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     MOVE 'ED'      AMCD                                                CSE065
     C                     Z-SUBW@QDIF    EVAM                                                CSE065
      *                                                                                       CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR WRITED                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ELSE                                                               CSE065
     C                     MOVE 'EI'      AMCD                                                CSE065
     C                     Z-ADDW@QAMT    EVAM                                                CSE065
      *                                                                                       CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR WRITED                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** If Equity Amount is negative and EQTAMT is negative                                  CSE065
      *                                                                                       CSE065
     C           W@QAMT    IFLT 0                                                             CSE065
     C           EQTAMT    ANDLT0                                                             CSE065
     C                     MOVE 'ED'      AMCD                                                CSE065
     C                     Z-SUBW@QAMT    EVAM                                                CSE065
      *                                                                                       CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR WRITED                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** If Equity Amount is positive and EQTAMT is positive                                  CSE065
      *                                                                                       CSE065
     C           W@QAMT    IFGE 0                                                             CSE065
     C           EQTAMT    ANDGE0                                                             CSE065
     C                     MOVE 'EI'      AMCD                                                CSE065
     C                     MOVE W@QAMT    EVAM                                                CSE065
      *                                                                                       CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR WRITED                                                        CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     MOVE W@QDIF    EQTAMT                                              CSE065
      *                                                                                       CSE065
     C                     ENDSR                                                              CSE065
      *                                                                                       CSE065
      *****************************************************************                       CAS006
      /EJECT                                                                                  CAS006
     C*****************************************************************   099885
     C*                                                                   099885
     C           FACTOR    BEGSR                                          099885
     C*                                                                   099885
     C***  Define the Keylist for SEDEVDO in SECEO.                       099885
     C*                                                                   099885
     C                     MOVE SESN      SDSN                            099885
     C                     MOVE 'MP'      SDET                            099885
     C                     Z-ADDRUND      SDED                            099885
      *                                                                   099885
     C***  SECEO is in REVERSE DATE order: To get the latest Current      099885
     C***  Factor, we must SETLL and read forwards.                       099885
     C*                                                                   099885
     C           KZSDDO    SETLLSEDEVDO                                   099885
     C                     READ SEDEVDO                  39               099885
     C*                                                                   099885
     C           *IN39     IFEQ '0'                                       099885
     C           SDSN      ANDEQSESN                                      099885
     C           SDET      ANDEQ'MP'                                      099885
     C*                                                                   099885
     C***  If a Factor Change found, multiply with the Nominal            099885
     C*                                                                   099885
     C*********************MULT SDCP      EVAM                     099885 099882
     C*********************MULT SDCP      EVAM      H              099882 103946
     C                     MULT SDCP      UPPT      H                     103946
     C*                                                                   099885
     C***  Else use the Current Factor from the Security File             099885
     C*                                                                   099885
     C                     ELSE                                           099885
     C*                                                                   099885
     C*********************MULT CFCT      EVAM                     099885 099882
     C*********************MULT CFCT      EVAM      H                     103946
     C                     MULT CFCT      UPPT      H                     103946
     C*                                                                   099885
     C                     END                                            099885
     C                     ENDSR                                          099885
     C*                                                                   099885
     C*****************************************************************   099885
      /EJECT                                                              099885
      *****************************************************************
      *                                                               *
      *  UPDATE - Subroutine to Update Book Position Header File.     *
      *                                                               *
      *****************************************************************
      *
     C           UPDATE    BEGSR                           *** UPDATE ***
     C*
     C* UPDATE FILE
     C***********          UPDATBKPHDDF                                   E15965
     C                     EXCPTUPDBKH                                    E15965
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  WRITED - Subroutine to Write record to SEKEYD File.          *
      *                                                               *
      *****************************************************************
      *
     C           WRITED    BEGSR                           *** WRITED ***
     C*
     C* SET UP KEY FOR SEKEYD RECORD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE SITP      INVT
     C                     MOVE *BLANK    TRTP
     C                     MOVE *BLANK    PORT
     C                     MOVE *BLANK    CGTP
      *                                                                   CSE006
      *** Check if BYSL Book                                              CSE006
      *                                                                   CSE006
     C           @CFRM     IFEQ 'A'                                       CSE006
     C                     MOVE TDBK      BOOK                            CSE006
     C                     ELSE                                           CSE006
     C                     MOVE BHBK      BOOK
     C                     ENDIF                                          CSE006
     C           CIAK      IFEQ 'Y'
     C           SCVI      ANDEQ'Y'                                       E15430
     C                     MOVE SCVI      CNVI
     C                     ELSE
     C                     MOVE *BLANK    CNVI
     C                     END
     C                     MOVE BHMK      MRKT
     C*
     C* SET UP REST OF SEKEYD RECORD
     C*
     C                     Z-ADD0         TRFR
     C**********           Z-ADDWISSR     CSTN                                                CSD027
     C                     MOVE WISSR     CSTN                                                CSD027
     C***********          MOVE BHBR      BRCH                            S01117
     C                     MOVE BHBA      BRHA                            S01117
     C***********          MOVE 01        ASQN                            E18803
     C                     MOVE 00        ASQN                            E18803
     C***********          Z-ADDAPDA      EVDT                            E21528
     C                     Z-ADDECD       EVDT                            E21528
     C                     MOVE NMCY      EVCY
     C                     Z-ADD0         STLT
     C                     MOVE *BLANK    STLA
     C                     MOVE '0'       RVRS
     C***********          Z-ADD0         ISSR                            E19975
     C**********           Z-ADD0         KCUST                                        E19975 CSD027
     C                     MOVE *BLANKS   KCUST                                               CSD027
     C                     Z-ADD0         KNCA
     C***********          MOVE *BLANK    KCCY                            S01176
     C                     MOVE NMCY      KCCY                            S01176
     C                     Z-ADD0         KBCA
     C                     MOVE BHSC      SESH
     C*                                                                   S01117
      *                                                                   CSE006
      *** Check if BYSL Book                                              CSE006
      *                                                                   CSE006
     C           @CFRM     IFEQ 'A'                                       CSE006
     C                     MOVE BPRC      PRFC                            CSE006
     C                     ELSE                                           CSE006
      *                                                                   CSE006
     C** Output profit centre from Book Position Profit Centre            S01117
     C*                                                                   S01117
     C**    If Analytical Accounting is installed and book position       CAC002
     C**    profit centre is blank, set the profit centre to              CAC002
     C**    SE ICD default profit centre.                                 CAC002
     C*                                                                   CAC002
      *                                                                   CAC005
      ** If CAC005 is on, use the profit centre from AOBKPCR0             CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELPMPRFC    PRFC                            CAC005
      *                                                                   CAC005
     C                     ELSE                                           CAC005
      *                                                                   CAC005
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           PCBK      ANDEQ*BLANKS                                   CAC002
     C                     MOVE BVSEPC    PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE PCBK      PRFC                            S01117
     C                     ENDIF                                          CAC002
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C*                                                                   S01117
     C** Set settlement branch to blank                                   S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SEBR                            S01117
     C*
     C                     ADD  1         OREC    50
     C*
     C                     WRITESEKEYDF
     C*
     C* CALL HASH TOTALLING SUBROUTINE
     C*
     C                     Z-ADD1         S
     C                     Z-ADDEVAM      ZZAMT
     C                     EXSR ZHASH
      *                                                                   CSE006
      *** Initialisw Work field 'Called From'                             CSE006
      *                                                                   CSE006
     C                     MOVE ' '       @CFRM                           CSE006
      *                                                                   CSE006
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Update Book Position Header Audit and *
      *           Output the Control Report.                          *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR                           *** AUDIT  ***
     C*
     C* READ BOOK POSITION HEADER
     C*
     C                     WRITEHEADR
     C           *INU8     IFEQ '0'
     C                     READ BKPHDAF                  99
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C                     Z-ADD9         DBASE            * DB ERROR 09 *
     C                     MOVEL'BKPHD'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C                     END
     C*
     C* OUTPUT CONTROL REPORT
     C*
     C           *INU8     IFEQ '0'
     C*
     C***********IREC      IFEQ 0                                         E29170
     C***********          WRITENONE                                      E29170
     C***********          ELSE                                           E29170
     C                     Z-ADDINT,Z     OHASH1
     C                     Z-ADDDEC,Z     OHASH2
AW   C*
AW   C**  IF FILE IS OUT OF BALANCE SETON U8 AND INDICATOR TO PRINT
AW   C**  DIFFERENCE MESSAGE
AW   C*
AW   C           IREC      IFNE NORE
AW   C                     SETON                     50U8
AW   C                     END
     C                     WRITECONTROL
     C***********          END                                            E29170
     C*
     C                     ELSE
     C                     WRITEERROR
     C                     END
     C***********                                                         E29170
     C***********          WRITETRAIL                                     E29170
     C*
     C* WRITE SEKEYDA RECORD
     C*
     C           *INU8     IFEQ '0'
     C                     MOVE OREC      NORE
     C                     Z-ADDOHASH1    HRWN
     C                     Z-ADDOHASH2    HRDC
     C                     WRITESEKEYAF
     C                     END
     C/COPY WNCPYSRC,SE2210C078
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  BKPCHN - Subroutine to Chain to Book Position File.          *
      *                                                               *
      *****************************************************************
      *
     C           BKPCHN    BEGSR                           *** BKPCHN ***
     C*
     C           BKPKEY    CHAINBKPOSDF              80
     C**N80***** RECI      COMP 'D'                  8080                 E15965
     C           *IN80     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'BKPOS'   DBFILE           ***************
     C                     MOVELBKKEY     DBKEY            * DB ERROR 04 *
     C                     Z-ADD04        DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  BOKCHN - Subroutine to Chain to Book File.                   *
      *                                                               *
      *****************************************************************
      *
     C           BOKCHN    BEGSR                           *** BOKCHN ***
      *                                                                   CAC005
      ** If CAC005 is on, retrieve user book from AOBKPCR0.               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
      *                                                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD   7                       CAC005
     C                     PARM '*USER  ' POPTN   7                       CAC005
     C           PMBKCD    PARM *BLANKS   PMBKCD  2                       CAC005
     C           PMPRFC    PARM *BLANKS   PMPRFC  4                       CAC005
     C                     PARM BHBK      PMPSBK  2                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C           PRTCD     ANDNE'   *NRF'                                 CSE006
     C           *LOCK     IN   LDA                                       CAC005
     C                     Z-ADD22        DBASE            ************   CAC005
     C                     MOVEL'AOBKPCR0'DBFILE           * DBERR 22 *   CAC005
     C                     MOVELBHBK      DBKEY            ************   CAC005
     C                     OUT  LDA                                       CAC005
     C                     MOVE *ON       *INU7                           CAC005
     C                     MOVE *ON       *INU8                           CAC005
     C                     DUMP                                           CAC005
     C                     ELSE                                           CSE006
      *                                                                   CSE006
      ** If Record is not found use standard book code                    CSE006
     C           PRTCD     IFEQ '   *NRF'                                 CSE006
     C                     MOVE BHBK      W#BOOK  2                       CSE006
     C                     ELSE                                           CSE006
     C                     MOVE PMBKCD    W#BOOK                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     ENDIF                                          CAC005
      ***********                                                   CAC005CSE006
     C***********PMBKCD    CHAINBOOKDDF              80             CAC005CSE006
      ***********                                                   CAC005CSE006
     C                     ELSE                                           CAC005
     C***********                                                         CSE006
     C***********BOKKEY    CHAINBOOKDDF              80                   CSE006
      ***********                                                   CAC005CSE006
     C                     MOVE BHBK      W#BOOK  2                       CSE006
     C                     ENDIF                                          CAC005
      *                                                                   CSE006
      ** Access file with standardised key                                CSE006
     C           W#BOOK    CHAINBOOKDDF              80                   CSE006
      *                                                                   CAC005
     C  N80      RECI      COMP 'D'                  8080
     C           *IN80     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'BOOKD'   DBFILE           ***************
      *                                                                   CAC005
     C***********CAC005    IFEQ 'Y'                                 CAC005CSE006
     C***********          MOVELPMBKCD    DBKEY                     CAC005CSE006
     C***********          ELSE                                     CAC005CSE006
     C***********          MOVELBHBK      DBKEY            * DB ERROR 05 *CSE006
     C***********          ENDIF                                    CAC005CSE006
     C                     MOVELW#BOOK    DBKEY                           CSE006
      *                                                                   CAC005
     C                     Z-ADD05        DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SECCHN - Subroutine to Chain to Securities File.             *
      *                                                               *
      *****************************************************************
      *
     C           SECCHN    BEGSR                           *** SECCHN ***
     C*
     C           SECKEY    CHAINSECTYDF              80
     C****0***** RECI      COMP 'D'                  8080
     C  N80      RECI      COMP '*'                      80
     C           *IN80     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SECTY'   DBFILE           ***************
     C                     MOVELBHSC      DBKEY            * DB ERROR 06 *
     C                     Z-ADD06        DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     ELSE
     C/COPY WNCPYSRC,SE2210C059
     C**********           Z-ADDISSR      WISSR                                               CSD027
     C                     MOVE ISSR      WISSR                                               CSD027
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2210CCP5                                           S01408
     C*                                                                   S01408
     C*                                                                   S01232
     C*   Australian yield indicator                                      S01232
     C*                                                                   S01232
     C           STBS      IFEQ 'Y'                                       S01232
     C           SYBS      ANDEQ'AU'                                      S01232
     C                     SETON                     52                   S01232
     C                     ELSE                                           S01232
     C                     SETOF                     52                   S01232
     C                     END                                            S01232
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  INVCHN - Subroutine to Chain to Investment Types File.       *
      *                                                               *
      *****************************************************************
      *
     C           INVCHN    BEGSR                           *** INVCHN ***
     C*
     C           INVKEY    CHAININVTPDF              80
     C  N80      RECI      COMP 'D'                  8080
     C           *IN80     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'INVTP'   DBFILE           ***************
     C                     MOVELNMCY      KEY6    6        * DB ERROR 07 *
     C                     MOVE SITP      KEY6             ***************
     C                     MOVELKEY6      DBKEY
     C                     Z-ADD07        DBASE
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************   S01117
      *                                                               *   S01117
      *  PPCCHN - Subroutine to Chain to Book Position Profit Centre  *   S01117
      *  Called from: Main processing                                 *   S01117
      *  Calls:                                                       *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           PPCCHN    BEGSR                           *** PPCCHN *** S01117
     C*                                                                   S01117
     C** SET UP KEY FIELDS FOR CHAIN TO PF/SEPCBD                         S01117
     C*                                                                   S01117
     C                     MOVE BHBK      KBHBK                           S01117
     C                     MOVE BHBA      KBHBA                           S01117
     C                     MOVE BHSC      KBHSC                           S01117
     C                     MOVE BHMK      KBHMK                           S01117
     C*                                                                   S01117
     C           KSEPCB    CHAINSEPCBDF              80                   S01117
     C           *IN80     IFEQ '1'                                       S01117
     C           RECI      OREQ '*'                                       S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SEPCBD'  DBFILE           ***************S01117
     C                     MOVELKSEPCR    DBKEY            * DB ERROR 13 *S01117
     C                     Z-ADD13        DBASE            ***************S01117
     C                     SETON                     U7U8                 S01117
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      *****************************************************************   S01117
      /SPACE 3                                                            S01117
      *****************************************************************
      *                                                               *
      *  TABCHN - Subroutine to Chain to TABTG10.                     *
      *                                                               *
      *****************************************************************
      *
     C           TABCHN    BEGSR                           *** TABCHN ***
     C*
     C                     MOVE *BLANK    TKEY
     C                     MOVEL'20'      TKEY
     C                     MOVELNMCY      KEY4    4
     C                     MOVE '1'       KEY4
     C                     MOVE KEY4      TKEY
     C           TABKEY    CHAINTABTG10F             80
     C  N80      RECI      COMP 'D'                  8080
     C           *IN80     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELTKEY      DBKEY            * DB ERROR 08 *
     C                     Z-ADD8         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2210CCP3                                           S01408
     C*                                                                   S01408
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  BKHSR  - Subroutine for Error Handling of Book Position      *
      *           Header File.                                        *
      *                                                               *
      *****************************************************************
      *
     C           BKHSR     BEGSR                           *** BKHSR  ***
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BKPHDD'  DBFILE           ***************
     C                     MOVELBKKEY     DBKEY            * DB ERROR 90 *
     C                     Z-ADD90        DBASE            ***************
     C                     MOVE STSBKH    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SKDSR  - Subroutine for Error Handling of SEKEYD.            *
      *                                                               *
      *****************************************************************
      *
     C           SKDSR     BEGSR                           *** SKDSR  ***
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SEKEY'   DBFILE           ***************
     C                     MOVELACKY      DBKEY            * DB ERROR 91 *
     C                     Z-ADD91        DBASE            ***************
     C                     MOVE STSSKD    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SKASR  - Subroutine for Error Handling of SEKEYA.            *
      *                                                               *
      *****************************************************************
      *
     C           SKASR     BEGSR                           *** SKASR  ***
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SEKEY'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 92 *
     C                     Z-ADD92        DBASE            ***************
     C                     MOVE STSSKA    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C/COPY WNCPYSRC,SE2210C002
     C*****************************************************************
      /EJECT                                                              S01232
SP   C***********/COPY ZSRSRC,XDATE3Z1                             S01232 S01117
      /EJECT
     C/COPY ZSRSRC,ZACCH                                                  S01117
      /EJECT                                                              S01117
     C/COPY ZSRSRC,ZBKDT                                                  S01117
      /EJECT                                                              S01117
SP   C/COPY ZSRSRC,ZACCRZ1
      /EJECT                                                              E14616
     C/COPY ZSRSRC,ZACCZZ1                                                E14616
      /EJECT                                                              S01233
      /COPY ZSRSRC,ZAVPRZ1                                                E22957
      /EJECT                                                              S01233
     C/COPY ZSRSRC,ZCNSDZ1                                                S01233
      /EJECT
SP   C/COPY ZSRSRC,ZDATE1Z2
      ***/EJECT******************                                         E13817
SP   C***/COPY*ZSRSRC,ZDATE2Z2***                                         E13817
      /EJECT                                                              E13817
SP   C/COPY ZSRSRC,ZDATE2Z4                                               E13817
      /EJECT
SP   C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
SP   C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
SP   C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
SP   C/COPY ZSRSRC,ZHASHZ3
      /EJECT
SP   C/COPY ZSRSRC,ZICD2Z1
      /EJECT
SP   C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E20380
SP   C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT
SP   C/COPY ZSRSRC,ZNCDZ3
      /EJECT
SP   C/COPY ZSRSRC,ZPRCIZ1
      /EJECT                                                              S01233
SP   C/COPY ZSRSRC,ZPRCOZ1                                                S01233
      /EJECT
SP   C/COPY ZSRSRC,ZRATEZ1
      /EJECT
SP   C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT                                                              S01232
SP   C/COPY ZSRSRC,ZYCEZ1                                                 S01232
      /EJECT
SP   C/COPY ZSRSRC,ZYLDIZ1
      /EJECT                                                              S01233
SP   C/COPY ZSRSRC,ZYLDOZ1                                                S01233
      /EJECT
SP   C/COPY ZSRSRC,ZYLDZ2
     C/EJECT
     C/COPY ZSRSRC,ZCALCD                                                 E39495
     O/EJECT
     OBKPHDDF E                UPDBKH                                     E15965
     O**********               LPCD                                E15965 E22957
     O                         LAVP                                       E15965
     O                         LATD                                       E20087
     O                         ICLD                                       E22957
     O                         UPPT                                       E15965
     O                         DPAP                                       E15965
     O                         BUDU                                       E15965
     O                         ARPC                                       E15965
     O                         DPFP                                       048414
     O                         LFXP                                       CPM004
     O                         DNAT                                       102506
     O                         LAVN                                                           CAS006
     O                         DPAN                                                           CAS006
     O                         BUDN                                                           CAS006
     O                         NAVP                                                           CSE065
     O                         BKVAMT                                                         CSE065
     O                         EQTAMT                                                         CSE065
     O/COPY WNCPYSRC,SE2210O001
     O*                                                                   E20087
     OBKMTHDF E                UPDBKM                                     E20087
     O                         DPTM                                       E20087
     O                         BKAMTM                                                         CSE065
     O                         EQAMTM                                                         CSE065
     OBKPOSDF E                UPDBKD                                                         246619
     O                         PNOM                                                           246619
      /EJECT
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
