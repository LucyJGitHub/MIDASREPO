000100200529     H        1
000200200529      *****************************************************************
000300200529/*STD *  RPGBASE                                                      *
000400200529/*EXI *  TEXT('Midas SE Gen. Coupon Actions for Backvals')
000500200529     F*****************************************************************
000600200529     F*                                                               *
000700200529     F*  Midas - Securities Trading Module
000800200529     F*                                                               *
000900200529     F*  SE2235 - GENERATE COUPON ACTIONS FOR BACKVALUATIONS.         *
001000200529     F*                                                               *
001100200529     F*  Function: For backvalued Trades, where a Coupon Date has     *
001200200529     F*    (COB)   occurred between the Value Date of the Trade and   *
001300200529     F*            the Last Coupon Date from the Security, if there   *
001400200529     F*            is no Coupon Action on the Historic Actions File   *
001500200529     F*            or Event on the Security Non-Diary Events File,    *
001600200529     F*            for that Security/Date, then this program will     *
001700200529     F*            generate them. These are vital for later processes.*
001800200529     F*                                                               *
001900200529     F*  Called By: SEC0605  - Generate Account Keys for Book Posns - *
002000200529     F*              Forward Run. (Called just before SE2220).        *
002100200529     F*                                                               *
002200200529      *  (c) Finastra International Limited 2001                      *
002300200529     F*                                                               *
002400200604     F*  Last Amend No. 247420             Date 22May20               *
002500200529      *  Prev Amend No. MD046248           Date 27Oct17               *
002600200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
002700200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
002800200529      * Midas Plus 1.4 Base ------------------------------------------*
002900200529      * Midas Plus 1.3 ----------- Base ------------------------------*
003000200529      *                 CSD027             Date 09Dec05               *
003100200529      *                 CSE071             Date 19Jul05               *
003200200529      *                 CAS008             Date 11May04               *
003300200529      *                 CAS006             Date 21Jan03               *
003400200529      *                 CSE037             Date 29Apr02               *
003500200529      *                 214425             Date 30Jan03               *
003600200529      *                 CSE035             Date 22Apr02               *
003700200529      *                 206316             Date 19Jul02               *
003800200529      * Midas Release 4.01 -------------------------------------------*
003900200529      *                 CSE031             Date 09Nov01               *
004000200529      *                 168141             Date 29Sep99               *
004100200529      * Midas Release 4 --------------- Base -------------------------*
004200200529      * Midas DBA 3.00 ---------------- Base -------------------------*
004300200529     F*                 130862             Date 16Oct98               *
004400200529     F*                 CEU017             Date 07Apr98               *
004500200529     F*                 CSE007             Date 18Mar98               *
004600200529     F*                 CSE005             DATE 04FEB97               *
004700200529     F*                 100228             DATE 31MAY96               *
004800200529     F*                 097181             DATE 03MAY96               *
004900200529     F*                 091254             DATE 20OCT95               *
005000200529     F*                 051107             DATE 25NOV93               *
005100200529     F*                 054257             DATE 25NOV93               *
005200200529     F*                 052254             DATE 25NOV93               *
005300200529     F*                 S01401             DATE 16JUN93               *
005400200529     F*                 S01397             DATE 10SEP92               *
005500200529     F*                 E36490             DATE 27FEB92               *
005600200529     F*                 E29170             DATE 06NOV91               *
005700200529     F*                 E29304             DATE 09OCT91               *
005800200529     F*                 E27092             DATE 04SEP91               *
005900200529     F*                 S01117             DATE 06JUN91               *
006000200529     F*                 E21516             DATE 06APR90               *
006100200529     F*                 E21616             DATE 03APR90               *
006200200529     F*                 E20085             DATE 06NOV89               *
006300200529     F*                                                               *
006400200529     F*---------------------------------------------------------------*
006500200529     F*                                                               *
006600200529      *  247420 - Rename and increase length of field NORE in file    *
006700200529      *           SNDEVA from NORE(5,0) to SNNORE(7,0).  Also increase*
006800200529      *           length of working fields related to SNNORE.         *
006900200529      *           Applied fix 230439.                                 *
007000200529      *  MD046248 - Finastra Rebranding                               *
007100200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
007200200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
007300200529      *  CAS008 - Delayed Hedge Assessment (Recompile)                *
007400200529     F*  CAS006 - Hedge Accounting Phase B                            *
007500200529      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
007600200529      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
007700200529      *  214425 - There are cases when the value of the field ZZLCD   *
007800200529      *           (last coupon date) doesn't change during the        *
007900200529      *           generation of CP actions which causes the looping   *
008000200529      *           problem. The solution is to exit generation when    *
008100200529      *           current ZZLCD is equal to the previous ZZLCD.       *
008200200529     F*  206316 - Recompiled over changed ZLCDZ1.                     *
008300200529     F*  CSE031 - Coupon Fixing for Floating Rate Notes.              *
008400200529     F*           (recompilation due to change to ZNCD/ZLCD)          *
008500200529     F*  168141 - Switchable feature CSE005 introduced the ability    *
008600200529     F*           to use next working day as last coupon date if that *
008700200529     F*           date was a non working day. Therefore need to est-  *
008800200529     F*           ablish real coupon date to stop looping. ZLCDZ1     *
008900200529     F*           sub routine therefore saves REAL LAST COUPON DATE   *
009000200529     F*           as well as allowed LAST COUPON date ZZLCD to stop   *
009100200529     F*           looping.                                            *
009200200529     F*  130862 - Recompiled over changed ZLCDZ1.                     *
009300200529     F*  CEU017 - Securities Redenomination Euro Changes              *
009400200529     F*           Same coding than CSE007                             *
009500200529     F*  CSE007 - Corporate Actions                                   *
009600200529     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
009700200529     F*           (recompilation due to change to ZNCD/ZLCD)          *
009800200529     F*  100228 - RECOMPILED FOR CHANGES TO SR ZLCDZ1                 *
009900200529     F*  097181 - 051107 was generating book position actions for     *
010000200529     F*           mortgage payments beyond next working day, and the  *
010100200529     F*           posting amount included future dated trades. Fix is *
010200200529     F*           to write a record only if event if before DNWD, and *
010300200529     F*           make it a type 'V' record to ensure the posting     *
010400200529     F*           amount is correct.                                  *
010500200529     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1                       *
010600200529     F*  051107 - BACK-VALUATION PRIOR TO MORTGAGE PAYMENT SHOULD     *
010700200529     F*           GENERATE BOOK POSITION ACTIONS, IF THEY DON'T EXIST *
010800200529     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
010900200529     F*           to 10,9                                             *
011000200529     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
011100200529     F*           to 10,9                                             *
011200200529     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
011300200529     F*          - Recompiled due to changes to files.                *
011400200529     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
011500200529     F*          - Recompiled due to changes to files.                *
011600200529     F*  E36490  - New coupon action written even though one already  *
011700200529     F*            existed.                                           *
011800200529     F*  E29170  - Report Control Facility changes.                   *
011900200529     F*  E29304  - Back-valuation prior to coupon date used to        *
012000200529     F*            add coupon actions to BPACHD with a RECI=D.        *
012100200529     F*            This causes problems if there are no records on    *
012200200529     F*            PRFAJD to reset the RECI to 'H'. Program has been  *
012300200529     F*            changed to write instead to BPACCD so that the RECI*
012400200529     F*            is set to 'H' in the forward run of SE2220.        *
012500200529     F*            **** Note that this replaces any other fixes to    *
012600200529     F*            correct this problem. ****                         *
012700200529     F*  E27092 - Recompiled over changed SR/ZLCD                     *
012800200529     F*  S01117 - Multibranching                                      *
012900200529     F*  E21516 -'Actioned Date' (BCED) should be set to RUND on      *   E21516
013000200529     F*           Output of a Coupon Action to BPACHD.                *   E21516
013100200529     F*  E21616 - Recompiled over changed SR/ZLCD.                    *   E21616
013200200529     F*  E20085 - Interest and Coupon Calculations Rewrite:           *   E20085
013300200529     F*          - Program written to go between Reversal and Forward *   E20085
013400200529     F*            modes of SE2220 to generate Coupon Actions for     *   E20085
013500200529     F*            backvalued Trades between the Value Date and LCPN  *   E20085
013600200529     F*            on the Security, where no Actions already exist on *   E20085
013700200529     F*            PF/BPACHD, plus corresponding Events on PF/SNDEVD. *   E20085
013800200529     F*                                                               *
013900200529     F*****************************************************************
014000200529     F*                                                               *
014100200529     F*  C R E A T I O N     P A R A M E T E R S                      *
014200200529     F*                                                               *
014300200529     F*                                                               *
014400200529     F*****************************************************************
014500200529      *
014600200529     FBPACTRD IF  E           K        DISK
014700200529     FSECTY   IF  E           K        DISK
014800200529     FINVTP   IF  E           K        DISK
014900200529     FSECEO   UF  E           K        DISK         KINFDS SNDDS A
015000200529     F                                              KINFSR SNDSR
015100200529     FSNDEVA  UF  E           K        DISK         KINFDS SNADS
015200200529     F                                              KINFSR SNASR
015300200529     F*PACHCP*UF**E           K        DISK         KINFDS BPHDS A        E29304
015400200529     FBPACC   UF  E           K        DISK         KINFDS BPHDS A        E29304
015500200529     F            BPACCDF                           KRENAMEBPACCXF        E29304
015600200529     F            BPACBDF                           KRENAMEBPACBXF        E29304
015700200529     F            BPACHDF                           KRENAMEBPACHXF        E29304
015800200529     F                                              KINFSR BPHSR
015900200529     F*PACHA**UF**E           K        DISK         KINFDS BHADS          E29304
016000200529     FBPACCA  UF  E           K        DISK         KINFDS BHADS          E29304
016100200529     F                                              KINFSR BHASR
016200200529     FTABSE   IF  E           K        DISK
016300200529     F            TABLETAF                          KIGNORE
016400200529     F            TABLETHF                          KIGNORE
016500200529     F*********** TABLETJF                          KIGNORE               S01117
016600200529     F            TABLETLF                          KIGNORE
016700200529     F            TABLETKF                          KIGNORE
016800200529     F            TABLETNF                          KIGNORE
016900200529     F            TABLETPF                          KIGNORE
017000200529     F            TABLETRF                          KIGNORE
017100200529     F            TABLETXF                          KIGNORE
017200200529     F**ICD*1*****TABTB10F                          KIGNORE
017300200529     F            TABTB11F                          KIGNORE
017400200529     F            TABTB36F                          KIGNORE
017500200529     F            TABTB40F                          KIGNORE
017600200529     F            TABTE10F                          KIGNORE
017700200529     F            TABTE20F                          KIGNORE
017800200529     F            TABTG10F                          KIGNORE
017900200529     F            TABTG20F                          KIGNORE
018000200529     F            TABLET2F                          KIGNORE
018100200529     F            TABLET3F                          KIGNORE
018200200529     F            TABLET5F                          KIGNORE
018300200529     F/COPY WNCPYSRC,SE2235F001
018400200529     FSE2235AUO   E                    PRINTER
018500200529      /EJECT
018600200529     F*****************************************************************
018700200529     F*                                                               *
018800200529     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
018900200529     F*                                                               *
019000200529     F*   87  - ERROR on WRITE Operation.                             *
019100200529     F*   88  - Generic CHAIN Fail.                                   *
019200200529     F*   89  - EOF Fail on BPACTRD.                                  *
019300200529     F*                                                               *
019400200529     F* 90-99 - Used by Standard Subroutines.                         *
019500200529     F* U7-U8 - Database Error.                                       *
019600200529     F*                                                               *
019700200529     F*****************************************************************
019800200529      /EJECT
019900200529     F*****************************************************************
020000200529     F*                                                               *
020100200529     F*  S U B R O U T I N E   I N D E X                              *
020200200529     F*                                                               *
020300200529     F*  FIRST  - Definitions and setup.                              *
020400200529     F*  GENCP  - Generates Coupon Actions if necessary.              *
020500200529     F***WBPACH**-**Set*up*and*write*out*a*record*to*BPACH.************   E29304
020600200529     F*  WBPACH  -  Set up and write out a record to BPACC.           *   E29304
020700200529     F*  WSNDEV - Set up and write out a record to SNDEV.             *
020800200529     F*  AUDIT  - Updates Audit Files, Outputs a Control Report and   *
020900200529     F*           Terminates the Program.                             *
021000200529     F*  BPHSR  - Error Handling on Update of LF/BPACHCP.             *
021100200529     F*  BHASR  - Error Handling on Update of PF/BPACHA.              *
021200200529     F*  SNDSR  - Error Handling on Update of LF/SECEO.               *
021300200529     F*  SNASR  - Error Handling on Update of PF/SNDEVA.              *
021400200529     F*  *PSSR  - Error handling                                      *   S01117
021500200529     F*                                                               *
021600200529     F*  ZDATE1 - Validates Dates and converts to Number of Days.     *
021700200529     F*  ZDATE2 - Converts a Day Number to Date Format.               *
021800200529     F*  ZLCD   - Obtains Prior Coupon Date.                          *
021900200529     F*  ZSYSTM - Obtains ICD Information from TABTB10.               *
022000200529     F*                                                               *
022100200529     F*****************************************************************
022200200529      /EJECT
022300200529     E                    CPY@    1   1 80
022400200529     E/COPY ZSRSRC,ZDATE2Z1
022500200529     E/COPY ZSRSRC,ZNCDZ1
022600200529      /EJECT
022700200529     IBPACBDF
022800200529      ***  Rename the fields on BPACBD to look like BPACCD and BPACHD.
022900200529     I              BBSS                            BCSS
023000200529     I***********   BBBR                            BCBR                  S01117
023100200529     I              BBBA                            BCBA                  S01117
023200200529     I              BBMK                            BCMK
023300200529     I              BBBK                            BCBO
023400200529     I              BBAD                            BCAD
023500200529     I              BBED                            BCED
023600200529     I              BBAS                            BCAS
023700200529     I              BBTP                            BCTP
023800200529     I              BBIT                            BCIT
023900200529     I              BBUN                            BCUN
024000200529     I              BBCA                            BCCP
024100200529     I              BBTA                            BCTA
024200200529     I              BBCF                            BCCF
024300200529     I              BBPC                            BCPC
024400200529     I              BBNC                            BCNC
024500200529     I              BBNR                            BCNR
024600200529     I              BBOD                            BCOT
024700200529     I              BBTV                            BCTV
024800200529     I              BBTR                            BCTR
024900200529     I              BBTS                            BCTS
025000200529     I              BBPS                            BCPS
025100200529     I              BBNM                            BCNL
025200200529     I              BBCN                            BCCN
025300200529     I              BBRA                            BCRA
025400200529     I              BBCC                            BCCC
025500200529     I              BBCT                            BCCT
025600200529     I              BBPT                            BCTD
025700200529     I              BBRI                            BCRV
025800200529     I              BBPR                            BCPR
025900200529     I              BBP1                            BCP1
026000200529     I              BBP2                            BCP2
026100200529     I              BBPL                            BCPL
026200200529     I              BBAP                            BCAT
026300200529     I              BBDV                            BCDV
026400200529     I              BBPN                            BCPN                                      CAS006
026500200529     ISECTYDF
026600200529     I              RECI                            SRECI
026700200529     IINVTPDF
026800200529     I              RECI                            IRECI
026900200529     I              SFLG                            ISFLG                                     CSE037
027000200529     ISEDEVDF
027100200529     I              RECI                            SDRECI
027200200529      *
027300200529     ICPYR@#      DS
027400200529      ***  Data Structure for Copyright Insertion.
027500200529     I                                        1  80 CPY@
027600200529     I                                        1  20 CPY@##
027700200529      *
027800200529     I/COPY ZSRSRC,ZNCDZ2
027900200529      *
028000200529      ***  Define BPAC Key Data Structures.
028100200529      *
028200200529     I            DS
028300200529     I                                        1  16 OLDKEY
028400200529     I                                        1  10 OLDSEC
028500200529     I***********                            11  130OLDBR                 S01117
028600200529     I                                       11  13 OLDBR                 S01117
028700200529     I                                       14  15 OLDBK
028800200529     I                                       16  16 OLDMK
028900200529     I            DS
029000200529     I                                        1  16 NEWKEY
029100200529     I                                        1  19 BPHERR
029200200529     I                                        1  10 BCSS
029300200529     I***********                            11  130BCBR                  S01117
029400200529     I                                       11  13 BCBA                  S01117
029500200529     I                                       14  15 BCBO
029600200529     I                                       16  16 BCMK
029700200529     I                                    P  17  190BCAD
029800200529     I            DS
029900200529     I                                        1   6 INVERR
030000200529     I                                        1   3 NMCY
030100200529     I                                        4   6 SITP
030200200529     I            DS
030300200529     I                                        1  15 SNDERR
030400200529     I                                        1  10 SNSN
030500200529     I                                    P  11  130SNDT
030600200529     I                                       14  15 SNET
030700200529      *
030800200529      ***  Data Structures for Error Handling.
030900200529      *
031000200529     IBPHDS       DS
031100200529     I                                     *STATUS  STSBPH
031200200529      *
031300200529     IBHADS       DS
031400200529     I                                     *STATUS  STSBHA
031500200529      *
031600200529     ISNDDS       DS
031700200529     I                                     *STATUS  STSSND
031800200529      *
031900200529     ISNADS       DS
032000200529     I                                     *STATUS  STSSNA
032100200529      *
032200200529     ILDA         DS                            256                       S01117
032300200529     I                                      134 183 DBLOT                 S01117
032400200529     I                                      134 141 DBFILE                S01117
032500200529     I                                      142 170 DBKEY                 S01117
032600200529     I                                      171 180 DBPGM                 S01117
032700200529     I                                      181 1830DBASE                 S01117
032800200529     I*LDA******* UDS                            256                      S01117
032900200529     I***********                           134 177 DBLOT                 S01117
033000200529     I***********                           134 138 DBFILE                S01117
033100200529     I***********                           139 167 DBKEY                 S01117
033200200529     I***********                           168 175 DBPGM                 S01117
033300200529     I***********                           176 1770DBASE                 S01117
033400200529     C/EJECT
033500200529      *================================================================
033600200529      *  P R O G R A M     S T A R T                                  *
033700200529      *================================================================
033800200529      *
033900200529      ***  Do Program Setup
034000200529      *
034100200529     C                     EXSR FIRST
034200200529      *
034300200529      ***  Read the Backvalued Book Position Trade Actions File.
034400200529      ***  Continue processing until End of File.
034500200529      *
034600200529     C                     READ BPACTRD                  89
034700200529      *
034800200529     C           *IN89     DOWEQ'0'
034900200529      *
035000200529     C                     ADD  1         IREC    50
035100200529      *
035200200529      ***  If no change in Key, then ignore the Action record.
035300200529      ***  (Since the File is sorted in Date order, only need to
035400200529      ***  process the first of each Security/Branch/Book/Market.)
035500200529      *
035600200529     C           NEWKEY    IFNE OLDKEY
035700200529      *
035800200529      ***  On Change of Security, obtain the Security Details (and
035900200529      ***  chain to Investment Types File for PROT).
036000200529      *
036100200529     C           BCSS      IFNE OLDSEC
036200200529     C           BCSS      CHAINSECTY                88
036300200529      *
036400200529     C           *IN88     IFEQ '1'
036500200529     C           *LOCK     IN   LDA                                       S01117
036600200529     C                     MOVE 'SECTY'   DBFILE           ***************
036700200529     C                     MOVELBCSS      DBKEY            * DB ERROR 02 *
036800200529     C                     Z-ADD02        DBASE            ***************
036900200529     C                     OUT  LDA                                       S01117
037000200529     C                     EXSR *PSSR                                     S01117
037100200529     C                     SETON                     U7U8
037200200529     C                     EXSR AUDIT
037300200529     C                     END
037400200529     C*
037500200529     C           INVKEY    CHAININVTP                88
037600200529     C           *IN88     IFEQ '1'
037700200529     C           *LOCK     IN   LDA                                       S01117
037800200529     C                     MOVE 'INVTP'   DBFILE           ***************
037900200529     C                     MOVELINVERR    DBKEY            * DB ERROR 03 *
038000200529     C                     Z-ADD03        DBASE            ***************
038100200529     C                     OUT  LDA                                       S01117
038200200529     C                     EXSR *PSSR                                     S01117
038300200529     C                     SETON                     U7U8
038400200529     C                     EXSR AUDIT
038500200529     C                     END
038600200529      *
038700200529     C                     END
038800200529     C*                                                                   051107
038900200529     C                     Z-ADDBCAD      TRDATE  50                      051107
039000200529      *
039100200529      ***  If an Interest-bearing Security, execute SR/GENCP until a
039200200529      ***  Last Coupon is found which is less than the Action Date.
039300200529      *
039400200529     C           PROT      IFEQ '1'
039500200529     C           PROT      OREQ '3'
039600200529     C           PROT      OREQ '5'
039700200529     C           PROT      OREQ '6'
039800200529     C           PROT      OREQ '8'
039900200529      *
040000200529     C           DYBS      IFNE '4'
040100200529     C           SPBS      ANDNE'D'
040200200529      *
040300200529     C*********************Z-ADDBCAD      TRDATE  50                      051107
040400200529      *
040500200529      ***  Find Last Coupon Date before today (LCPN may not be correct
040600200529      ***  at this point for our requirements).
040700200529      *
040800200529     C           RUND      SUB  1         ZECD
040900200529     C                     EXSR ZLCD
041000200529      *
041100200529     C                     MOVE 'N'       WEXTCP  1                                           214425
041200200529     C           TRDATE    DOWLTRUND
041300200529     C           TRDATE    ANDLEZZLCD
041400200529     C           ZZLCD     ANDGTITLD
041500200529     C           WEXTCP    ANDEQ'N'                                                           214425
041600200529      *                                                                                       214425
041700200529      ** Save previous ZZLCD.                                                                 214425
041800200529      *                                                                                       214425
041900200529     C                     Z-ADDZZLCD     WSZLCD  50                                          214425
042000200529     C                     EXSR GENCP
042100200529      *                                                                                       214425
042200200529      ** Exit loop when current ZZLCD is same as previous ZZLCD.                              214425
042300200529      *                                                                                       214425
042400200529     C           ZZLCD     IFEQ WSZLCD                                                        214425
042500200529     C                     MOVE 'Y'       WEXTCP                                              214425
042600200529     C                     ENDIF                                                              214425
042700200529      *                                                                                       214425
042800200529     C                     END
042900200529     C                     END
043000200529     C                     END
043100200529     C*                                                                   051107
043200200529     C* If a mortgage-backed security, execute subroutine SR/GENMP        051107
043300200529     C* write any missing mortgage payment book position actions.         051107
043400200529     C*                                                                   051107
043500200529     C           PROT      IFEQ '8'                                       051107
043600200529     C                     EXSR GENMP                                     051107
043700200529     C                     END                                            051107
043800200529     C                     END
043900200529      *
044000200529     C                     MOVE NEWKEY    OLDKEY
044100200529     C                     READ BPACTRD                  89
044200200529      *
044300200529     C                     END
044400200529      *
044500200529      *================================================================
044600200529      *  P R O G R A M     E N D                                      *
044700200529      *                                                               *
044800200529      ***  Update Audit Records, Output Control Report and End Program*
044900200529      *                                                               *
045000200529     C                     EXSR AUDIT
045100200529      *                                                               *
045200200529      *================================================================
045300200529      /EJECT
045400200529      *****************************************************************
045500200529      *                                                               *
045600200529      *  FIRST  - Subroutine to do Program Setup.                     *
045700200529      *                                                               *
045800200529      *  Called By: Main Processing.                                  *
045900200529      *  Calls    : ZSYSTM - Obtains ICD Information from TABTB10.    *
046000200529      *                                                               *
046100200529      *****************************************************************
046200200529      *
046300200529     C           FIRST     BEGSR                           *** FIRST  ***
046400200529      *
046500200529      ***  Keylists for File CHAINs:
046600200529      *
046700200529      ***  Investment Types File.
046800200529      *
046900200529     C           INVKEY    KLIST
047000200529     C                     KFLD           NMCY
047100200529     C                     KFLD           SITP
047200200529      *
047300200529      ***  Security Non-Diary Events.
047400200529      *
047500200529     C           SNDKEY    KLIST
047600200529     C                     KFLD           BCSS
047700200529     C                     KFLD           SNET
047800200529     C                     KFLD           LCPDT
047900200529     C                     MOVE 'CP'      SNET
048000200529      *
048100200529      ***  Security Diary Events.
048200200529      *
048300200529     C           SDEKEY    KLIST
048400200529     C                     KFLD           SDSN
048500200529     C                     KFLD           SDET
048600200529     C                     KFLD           SDED
048700200529     C           SDEPKY    KLIST                                          051107
048800200529     C                     KFLD           SDSN                            051107
048900200529     C                     KFLD           SDET                            051107
049000200529      *
049100200529      ***  Book Position Historic Action File.
049200200529      *
049300200529     C           BPHKEY    KLIST
049400200529     C                     KFLD           BCSS
049500200529     C***********          KFLD           BCBR                            S01117
049600200529     C                     KFLD           BCBA                            S01117
049700200529     C*********************KFLD           BCBO                            E29304
049800200529     C*********************KFLD           BCMK                            E29304
049900200529     C*********************KFLD           LCPDT                           E29304
050000200529     C                     KFLD           BCMK                            E29304
050100200529     C                     KFLD           BCBO                            E29304
050200200529     C                     KFLD           TRDVAL  1                       E29304
050300200529     C***********          KFLD           LCPDT                    E29304 051107
050400200529     C                     KFLD           EVTDAT  50                      051107
050500200529     C                     KFLD           ACTSEQ  2                       E29304
050600200529     C***********          KFLD           TASRTS  1                E29304 E36490
050700200529     C***********          KFLD           TRDREF  6                E29304 E36490
050800200529     C***********          KFLD           REVIND  1                E29304 E36490
050900200529     C***********          MOVEL'V'       TRDVAL                   E29304 051107
051000200529     C***********          MOVEL'30'      ACTSEQ                   E29304 051107
051100200529      *
051200200529      ***  Set Up LDA Information.
051300200529      *
051400200529     C           *NAMVAR   DEFN           LDA                             S01117
051500200529     C           *LOCK     IN   LDA                                       S01117
051600200529     C                     MOVE *BLANK    DBLOT
051700200529     C                     MOVE 'SE2235  'DBPGM
051800200529     C                     OUT  LDA                                       S01117
051900200529      *                                                                                       CAS006
052000200529      ** Access SAR Details to see if CAS006 is installed                                     CAS006
052100200529      *                                                                                       CAS006
052200200529     C                     CALL 'AOSARDR0'                                                    CAS006
052300200529     C                     PARM *BLANKS   PRTCD   7                                           CAS006
052400200529     C                     PARM '*VERIFY 'POPTN   7                                           CAS006
052500200529     C                     PARM 'CAS006'  PSARD   6                                           CAS006
052600200529      *                                                                                       CAS006
052700200529     C           PRTCD     IFNE *BLANKS                                                       CAS006
052800200529     C           PRTCD     ANDNE'*NRF   '                                                     CAS006
052900200529     C           *LOCK     IN   LDA                                                           CAS006
053000200529     C                     MOVEL'CAS006'  DBKEY                                               CAS006
053100200529     C                     MOVEL'SCSARDPD'DBFILE                                              CAS006
053200200529     C                     Z-ADD10        DBASE                                               CAS006
053300200529     C                     OUT  LDA                                                           CAS006
053400200529     C                     MOVE '1'       *INU7                                               CAS006
053500200529     C                     MOVE '1'       *INU8                                               CAS006
053600200529     C                     MOVE '1'       *INLR                                               CAS006
053700200529     C                     EXSR *PSSR                                                         CAS006
053800200529     C                     ENDIF                                                              CAS006
053900200529      *                                                                                       CAS006
054000200529     C           PRTCD     IFEQ *BLANKS                                                       CAS006
054100200529     C                     MOVE 'Y'       CAS006  1                                           CAS006
054200200529     C                     ELSE                                                               CAS006
054300200529     C                     MOVE 'N'       CAS006                                              CAS006
054400200529     C                     ENDIF                                                              CAS006
054500200529      *
054600200529      ***  Access ICD Information.
054700200529      *
054800200529     C                     EXSR ZSYSTM
054900200529     C           *IN99     IFEQ '1'
055000200529     C           *LOCK     IN   LDA                                       S01117
055100200529     C                     MOVE 'TABLE'   DBFILE           ***************
055200200529     C                     MOVELZTABKY    DBKEY            * DB ERROR 01 *
055300200529     C                     Z-ADD01        DBASE            ***************
055400200529     C                     OUT  LDA                                       S01117
055500200529     C                     EXSR *PSSR                                     S01117
055600200529     C                     SETON                     U7U8
055700200529     C                     EXSR AUDIT
055800200529     C                     END
055900200529      *                                                                                       CSE035
056000200529      ** Access SAR details file to see if CSE035 is installed                                CSE035
056100200529      *                                                                                       CSE035
056200200529     C                     CALL 'AOSARDR0'                                                    CSE035
056300200529     C                     PARM *BLANKS   @RTCD   7                                           CSE035
056400200529     C                     PARM '*VERIFY' @OPTN   7                                           CSE035
056500200529     C                     PARM 'CSE035'  @SARD   6                                           CSE035
056600200529      *                                                                                       CSE035
056700200529     C           @RTCD     IFEQ *BLANK                                                        CSE035
056800200529     C                     MOVE 'Y'       CSE035  1                                           CSE035
056900200529     C                     ELSE                                                               CSE035
057000200529     C                     MOVE 'N'       CSE035                                              CSE035
057100200529     C                     ENDIF                                                              CSE035
057200200529      *                                                                                       CSE035
057300200529     C/COPY WNCPYSRC,SE2235C001
057400200529      *
057500200529     C                     ENDSR
057600200529      *
057700200529      *****************************************************************
057800200529      /EJECT
057900200529      *****************************************************************
058000200529      *                                                               *
058100200529      *  GENCP  - Subroutine to Check that Coupons between the Action *
058200200529      ************Date*and*the*Run*Date*exist*on*BPACH*and*SNDEV.******   E29304
058300200529      *           Date and the Run Date exist on BPACC and SNDEV.     *   E29304
058400200529      *                                                               *
058500200529      *  Called By: Main Processing.                                  *
058600200529      ***Calls****:*WBPACH*-*Set*up*and*write*out*a*record*to*BPACH.***   E29304
058700200529      *  Calls    : WBPACH - Set up and write out a record to BPACC.  *   E29304
058800200529      *             WSNDEV - Set up and write out a record to SNDEV.  *
058900200529      *                                                               *
059000200529      *****************************************************************
059100200529      *
059200200529     C           GENCP     BEGSR                           *** GENCP  ***
059300200529      *
059400200529      ***  Save Last Coupon Date and find the next Prior Coupon Date.
059500200529      *
059600200529     C                     Z-ADDZZLCD     LCPDT   50
059700200529     C*                                                                   168141
059800200529     C* Use REAL last coupon date instead of calculated last coupon       168141
059900200529     C* date as calculated last coupon date may cause looping.            168141
060000200529     C* problem introduced by CSE005. See GEMS for fuller explaination    168141
060100200529     C*                                                                   168141
060200200529     C***********ZZLCD     SUB  1         ZECD                            168141
060300200529     C           ZZREAL    SUB  1         ZECD                            168141
060400200529     C                     EXSR ZLCD
060500200529      *
060600200529      *****Check*to*see*if*the*Coupon*Action*exists*on*BPACHD.*********   E29304
060700200529      ***  Check to see if the Coupon Action exists on BPACC.             E29304
060800200529      *
060900200529     C***********BPHKEY    CHAINBPACHCP              88                   E29304
061000200529     C                     MOVEL'V'       TRDVAL                          051107
061100200529     C                     Z-ADDLCPDT     EVTDAT                          051107
061200200529     C                     MOVEL'30'      ACTSEQ                          051107
061300200529     C           BPHKEY    CHAINBPACC                88                   E29304
061400200529      *
061500200529      ***  If Action not found, generate it.
061600200529      *
061700200529     C           *IN88     IFEQ '1'
061800200529     C                     EXSR WBPACH
061900200529     C                     END
062000200529      *
062100200529      ***  Check to see if the Coupon Event exists on SNDEVD.
062200200529      *
062300200529     C           SNDKEY    CHAINSECEO                88
062400200529      *
062500200529      ***  If Event not found, generate it.
062600200529      *
062700200529     C           *IN88     IFEQ '1'
062800200529     C                     EXSR WSNDEV
062900200529     C                     END
063000200529      *
063100200529     C                     ENDSR
063200200529      *
063300200529      *****************************************************************
063400200529      /EJECT                                                              051107
063500200529      *****************************************************************   051107
063600200529      *                                                               *   051107
063700200529      *  GENMP  - Subroutine to output missing mortgage payment       *   051107
063800200529      *           events to BPACC                                     *   051107
063900200529      *                                                               *   051107
064000200529      *  Called By: Main Processing.                                  *   051107
064100200529      *  Calls    : WBPCMP - Set up and write out a record to BPACC.  *   051107
064200200529      *                                                               *   051107
064300200529      *****************************************************************   051107
064400200529      *                                                                   051107
064500200529     C           GENMP     BEGSR                           *** GENMP  *** 051107
064600200529      *                                                                   051107
064700200529      ***  Look for mortgage payments since the trade action date         051107
064800200529      *                                                                   051107
064900200529     C                     MOVE BCSS      SDSN                            051107
065000200529     C                     MOVE 'MP'      SDET                            051107
065100200529     C                     Z-ADD*HIVAL    SDED                            051107
065200200529     C           SDEKEY    SETLLSEDEVDF                                   051107
065300200529     C           SDEPKY    READESEDEVDF                  88               051107
065400200529     C  N88      SDED      COMP 0                        88               051107
065500200529     C           *IN88     DOWEQ'0'                                       051107
065600200529     C           SDED      ANDGTTRDATE                                    051107
065700200529     C           SDAD      ANDNE0                                         097181
065800200529      *                                                                   051107
065900200529      ***  Check to see if the Mortgage Payment Action exists on BPACC.   051107
066000200529      *                                                                   051107
066100200529     C***********          MOVEL'T'       TRDVAL                    051107097181
066200200529     C                     MOVEL'V'       TRDVAL                          097181
066300200529     C                     Z-ADDSDED      EVTDAT                          051107
066400200529     C                     MOVEL'20'      ACTSEQ                          051107
066500200529     C           BPHKEY    CHAINBPACC                88                   051107
066600200529      *                                                                   051107
066700200529      ***  If Action not found, generate it.                              051107
066800200529      *                                                                   051107
066900200529     C           *IN88     IFEQ '1'                                       051107
067000200529     C                     EXSR WBPCMP                                    051107
067100200529     C                     END                                            051107
067200200529     C*                                                                   051107
067300200529     C           SDEPKY    READESEDEVDF                  88               051107
067400200529     C  N88      SDED      COMP 0                        88               051107
067500200529     C                     END                                            051107
067600200529     C*                                                                   051107
067700200529     C                     ENDSR                                          051107
067800200529      *                                                                   051107
067900200529      *****************************************************************   051107
068000200529      /EJECT
068100200529      *****************************************************************
068200200529      *                                                               *
068300200529      ***WBPACH*-*Set*up*and*Output*a*Coupon*Action*to*BPACHD.*********   E29304
068400200529      *  WBPACH - Set up and Output a Coupon Action to BPACCD.        *   E29304
068500200529      *                                                               *
068600200529      *  Called By: GENCP.                                            *
068700200529      *  Calls    : None.                                             *
068800200529      *                                                               *
068900200529      *****************************************************************
069000200529      *
069100200529     C           WBPACH    BEGSR                           *** WBPACH ***
069200200529      *
069300200529      ***  Set up Coupon fields on Action record.
069400200529      ***  (BCSS, BCBR, BCMK, BCBO already set up from key).
069500200529      *
069600200529     C                     MOVE 'D'       RECI
069700200529     C                     Z-ADDLCPDT     BCAD
069800200529     C***********          Z-ADD*ZERO     BCED                            E21516
069900200529     C                     Z-ADDRUND      BCED                            E21516
070000200529     C                     MOVE '30'      BCAS
070100200529     C                     MOVE 'CP'      BCTP
070200200529     C                     MOVE SITP      BCIT
070300200529      *
070400200529     C                     Z-ADD*ZERO     BCUN
070500200529     C                     Z-ADD*ZERO     BCCP
070600200529     C                     Z-ADD*ZERO     BCTA
070700200529      *
070800200529      ***  Get Current Factors as at and prior to Action Date.
070900200529      *
071000200529     C           PROT      IFEQ '8'
071100200529     C                     Z-ADDCFCT      BCCF
071200200529     C                     Z-ADDCFCT      BCPC
071300200529      *
071400200529     C                     MOVE BCSS      SDSN
071500200529     C                     MOVE 'MP'      SDET
071600200529     C                     Z-ADDLCPDT     SDED
071700200529     C           SDEKEY    SETLLSEDEVDF
071800200529     C                     READ SEDEVDF                  88
071900200529      *
072000200529     C           *IN88     IFEQ '0'
072100200529     C           SDSN      ANDEQBCSS
072200200529     C           SDET      ANDEQ'MP'
072300200529     C                     Z-ADDSDCP      BCCF
072400200529      *
072500200529     C                     READ SEDEVDF                  88
072600200529     C           *IN88     IFEQ '0'
072700200529     C           SDSN      ANDEQBCSS
072800200529     C           SDET      ANDEQ'MP'
072900200529     C                     Z-ADDSDCP      BCPC
073000200529     C                     END
073100200529      *
073200200529     C                     END
073300200529     C                     END
073400200529     C/COPY WNCPYSRC,SE2235C002
073500200529      *
073600200529      ***  Get Coupon Rate as at Action Date.
073700200529      *
073800200529     C                     MOVE BCSS      SDSN
073900200529     C                     MOVE 'IR'      SDET
074000200529     C                     Z-ADDLCPDT     SDED
074100200529     C           SDEKEY    SETLLSEDEVDF
074200200529     C                     READ SEDEVDF                  88
074300200529     C           *IN88     IFEQ '0'
074400200529     C           SDSN      ANDEQBCSS
074500200529     C           SDET      ANDEQ'IR'
074600200529     C                     Z-ADDSDNC      BCNC
074700200529      *                                                                                       CAS006
074800200529     C           CAS006    IFEQ 'Y'                                                           CAS006
074900200529     C                     Z-ADDSDNN      SNCX   117                                          CAS006
075000200529     C                     ENDIF                                                              CAS006
075100200529      *                                                                                       CAS006
075200200529     C                     ELSE
075300200529     C                     Z-ADDCPNR      BCNC
075400200529      *                                                                                       CAS006
075500200529     C           CAS006    IFEQ 'Y'                                                           CAS006
075600200529     C                     Z-ADDCPNN      SNCX                                                CAS006
075700200529     C                     ENDIF                                                              CAS006
075800200529      *                                                                                       CAS006
075900200529     C                     END
076000200529      *
076100200529     C                     MOVEL'COUPON D'NAR    11
076200200529     C                     MOVE 'ATE'     NAR
076300200529     C                     MOVE *BLANKS   BCNR
076400200529     C                     MOVELNAR       BCNR
076500200529      *
076600200529     C                     Z-ADD*ZERO     BCOT
076700200529     C                     MOVE 'V'       BCTV
076800200529     C                     MOVE *BLANKS   BCTR
076900200529     C                     MOVE *BLANKS   BCTS
077000200529     C                     MOVE *BLANKS   BCPS
077100200529     C                     Z-ADD*ZERO     BCNL
077200200529     C                     Z-ADD*ZERO     BCCN
077300200529     C                     Z-ADD*ZERO     BCRA
077400200529     C                     Z-ADD*ZERO     BCCC
077500200529     C                     Z-ADD*ZERO     BCCT
077600200529     C                     Z-ADD*ZERO     BCTD
077700200529     C                     MOVE *BLANKS   BCRV
077800200529     C                     Z-ADD*ZERO     INAJ
077900200529     C                     Z-ADD*ZERO     PCHI
078000200529     C/COPY WNCPYSRC,SE2235C003
078100200529     C                     MOVE *BLANKS   RMIP
078200200529     C                     Z-ADD*ZERO     CNTP
078300200529     C                     MOVE *BLANKS   ACRI
078400200529     C**********           Z-ADD*ZERO     TRCP                                                CSD027
078500200529     C                     MOVE *BLANKS   TRCP                                                CSD027
078600200529     C                     Z-ADD*ZERO     BCPR
078700200529     C                     Z-ADD*ZERO     BCP1
078800200529     C                     Z-ADD*ZERO     BCP2
078900200529     C                     Z-ADD*ZERO     BCPL
079000200529     C                     Z-ADD*ZERO     BCAT
079100200529     C                     Z-ADD*ZERO     BCDV
079200200529     C                     Z-ADDZZLCD     LCCP
079300200529     C                     MOVE *BLANKS   BCCOAF                          CSE007
079400200529     C           CAS006    IFEQ 'Y'                                                           CAS006
079500200529     C                     Z-ADD*ZERO     BCPN                                                CAS006
079600200529     C                     Z-ADD*ZERO     CNTN                                                CAS006
079700200529     C                     Z-ADD*ZERO     INAN                                                CAS006
079800200529     C                     Z-ADD*ZERO     PCHN                                                CAS006
079900200529     C                     ENDIF                                                              CAS006
080000200529      *
080100200529      *** Output Coupon Action record.
080200200529      *
080300200529     C************         WRITEBPACHDF                                   E29304
080400200529     C                     WRITEBPACCXF                                   E29304
080500200529     C                     ADD  1         OBPACH
080600200529      *
080700200529     C                     ENDSR
080800200529      *
080900200529      *****************************************************************
081000200529      /EJECT
081100200529      *****************************************************************   051107
081200200529      *                                                               *   051107
081300200529      *  WBPCMP - Set up and Output a Mort.Payment Action to BPACCD.  *   051107
081400200529      *                                                               *   051107
081500200529      *  Called By: GENMP.                                            *   051107
081600200529      *  Calls    : None.                                             *   051107
081700200529      *                                                               *   051107
081800200529      *****************************************************************   051107
081900200529      *                                                                   051107
082000200529     C           WBPCMP    BEGSR                           *** WBPCMP *** 051107
082100200529      *                                                                   051107
082200200529      ***  Find the previous coupon date.                                 051107
082300200529      *                                                                   051107
082400200529     C           SDED      SUB  1         ZECD                            051107
082500200529     C                     EXSR ZLCD                                      051107
082600200529      *                                                                   051107
082700200529      ***  Set up Coupon fields on Action record.                         051107
082800200529      ***  (BCSS, BCBR, BCMK, BCBO already set up from key).              051107
082900200529      *                                                                   051107
083000200529     C                     MOVE 'D'       RECI                            051107
083100200529     C                     Z-ADDSDED      BCAD                            051107
083200200529     C                     Z-ADDRUND      BCED                            051107
083300200529     C                     MOVE '20'      BCAS                            051107
083400200529     C                     MOVE 'MP'      BCTP                            051107
083500200529     C                     MOVE SITP      BCIT                            051107
083600200529      *                                                                   051107
083700200529     C                     Z-ADD*ZERO     BCUN                            051107
083800200529     C                     Z-ADD*ZERO     BCCP                            051107
083900200529     C                     Z-ADD*ZERO     BCTA                            051107
084000200529      *                                                                   051107
084100200529      ***  Current Factors                                                051107
084200200529      *                                                                   051107
084300200529     C                     Z-ADDSDCP      BCPC                            051107
084400200529     C                     Z-ADDSDCP      BCCF                            051107
084500200529      *                                                                   051107
084600200529      ***  Coupon Rate                                                    051107
084700200529      *                                                                   051107
084800200529     C                     Z-ADDSDNC      BCNC                            051107
084900200529      *                                                                                       CAS006
085000200529     C           CAS006    IFEQ 'Y'                                                           CAS006
085100200529     C                     Z-ADDSDNN      SNCX                                                CAS006
085200200529     C                     ENDIF                                                              CAS006
085300200529      *                                                                   051107
085400200529     C                     MOVEL'REPAYMEN'NAR    11                       051107
085500200529     C                     MOVE 'T  '     NAR                             051107
085600200529     C                     MOVE *BLANKS   BCNR                            051107
085700200529     C                     MOVELNAR       BCNR                            051107
085800200529      *                                                                   051107
085900200529     C                     Z-ADD*ZERO     BCOT                            051107
086000200529     C                     MOVE TRDVAL    BCTV                            051107
086100200529     C                     MOVE *BLANKS   BCTR                            051107
086200200529     C                     MOVE *BLANKS   BCTS                            051107
086300200529     C                     MOVE *BLANKS   BCPS                            051107
086400200529     C                     Z-ADD*ZERO     BCNL                            051107
086500200529     C                     Z-ADD*ZERO     BCCN                            051107
086600200529     C                     Z-ADD*ZERO     BCRA                            051107
086700200529     C                     Z-ADD*ZERO     BCCC                            051107
086800200529     C                     Z-ADD*ZERO     BCCT                            051107
086900200529     C                     Z-ADD*ZERO     BCTD                            051107
087000200529     C                     MOVE *BLANKS   BCRV                            051107
087100200529     C                     Z-ADD*ZERO     INAJ                            051107
087200200529     C                     Z-ADD*ZERO     PCHI                            051107
087300200529     C/COPY WNCPYSRC,SE2235C004
087400200529     C                     MOVE *BLANKS   RMIP                            051107
087500200529     C                     Z-ADD*ZERO     CNTP                            051107
087600200529     C                     MOVE *BLANKS   ACRI                            051107
087700200529     C**********           Z-ADD*ZERO     TRCP                                         051107 CSD027
087800200529     C                     MOVE *BLANKS   TRCP                                                CSD027
087900200529     C                     Z-ADD*ZERO     BCPR                            051107
088000200529     C                     Z-ADD*ZERO     BCP1                            051107
088100200529     C                     Z-ADD*ZERO     BCP2                            051107
088200200529     C                     Z-ADD*ZERO     BCPL                            051107
088300200529     C                     Z-ADD*ZERO     BCAT                            051107
088400200529     C                     Z-ADD*ZERO     BCDV                            051107
088500200529     C                     Z-ADDZZLCD     LCCP                            051107
088600200529     C                     MOVE *BLANKS   BCCOAF                          CSE007
088700200529     C           CAS006    IFEQ 'Y'                                                           CAS006
088800200529     C                     Z-ADD*ZERO     BCPN                                                CAS006
088900200529     C                     Z-ADD*ZERO     CNTN                                                CAS006
089000200529     C                     Z-ADD*ZERO     INAN                                                CAS006
089100200529     C                     Z-ADD*ZERO     PCHN                                                CAS006
089200200529     C                     ENDIF                                                              CAS006
089300200529      *                                                                   051107
089400200529      *** Output Mortgage Payment Action record.                          051107
089500200529      *                                                                   051107
089600200529     C                     WRITEBPACCXF                                   051107
089700200529     C                     ADD  1         OBPACH                          051107
089800200529      *                                                                   051107
089900200529     C                     ENDSR                                          051107
090000200529      *                                                                   051107
090100200529      *****************************************************************   051107
090200200529      /EJECT
090300200529      *****************************************************************
090400200529      *                                                               *
090500200529      *  WSNDEV - Set up and Output a Coupon Event to SNDEVD.         *
090600200529      *                                                               *
090700200529      *  Called By: GENCP.                                            *
090800200529      *  Calls    : None.                                             *
090900200529      *                                                               *
091000200529      *****************************************************************
091100200529      *
091200200529     C           WSNDEV    BEGSR                           *** WSNDEV ***
091300200529      *
091400200529      *****Set*up*SNDEV*fields*from*BPACH*fields.**********************   E29304
091500200529      ***  Set up SNDEV fields from BPACC fields.                         E29304
091600200529      *
091700200529     C                     MOVE RECI      RECI
091800200529     C                     MOVE BCSS      SNSN
091900200529     C                     Z-ADDBCAD      SNDT
092000200529     C                     MOVE BCTP      SNET
092100200529     C                     Z-ADDBCNC      SNCR
092200200529     C                     Z-ADDBCCF      SNCF
092300200529     C                     Z-ADD*ZERO     SNCP
092400200529     C                     Z-ADD*ZERO     SNCA
092500200529     C                     Z-ADD*ZERO     SNPR
092600200529     C                     MOVELBCNR      SNNA
092700200529     C                     Z-ADDLCCP      LCCP
092800200529      *                                                                                       CAS006
092900200529     C           CAS006    IFEQ 'Y'                                                           CAS006
093000200529     C                     Z-ADDSNCX      SNCN                                                CAS006
093100200529     C                     ENDIF                                                              CAS006
093200200529      *
093300200529      ***  Output Coupon Event record.
093400200529      *
093500200529     C                     WRITESNDEVDF
093600200529     C                     ADD  1         OSNDEV
093700200529      *
093800200529     C                     ENDSR
093900200529      *
094000200529      *****************************************************************
094100200529      /EJECT
094200200529      *****************************************************************
094300200529      *                                                               *
094400200529      *  AUDIT  - Subroutine to Update the Audit records, Output the  *
094500200529      *           Control Report and terminate the program.           *
094600200529      *                                                               *
094700200529      *  Called By: Main Processing and each DB Error.                *
094800200529      *  Calls    : None.                                             *
094900200529      *                                                               *
095000200529      *****************************************************************
095100200529      *
095200200529     C           AUDIT     BEGSR                           *** AUDIT  ***
095300200529      *
095400200529      ***  Only update Audit Files if there are no DB Errors.
095500200529      *
095600200529     C           *INU7     IFEQ '0'
095700200529      *
095800200529     C***********          READ BPACHAF                  88               E29304
095900200529     C                     READ BPACCAF                  88               E29304
096000200529     C           *IN88     IFEQ '1'
096100200529     C           *LOCK     IN   LDA                                       S01117
096200200529     C***********          MOVEL'BPACH'   DBFILE           ***************E29304
096300200529     C                     MOVEL'BPACC'   DBFILE           ***************E29304
096400200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 04 *
096500200529     C                     Z-ADD04        DBASE            ***************
096600200529     C                     OUT  LDA                                       S01117
096700200529     C                     EXSR *PSSR                                     S01117
096800200529     C                     SETON                     U7U8
096900200529     C                     GOTO ERRTAG
097000200529      *
097100200529     C                     ELSE
097200200529     C                     ADD  OBPACH    NORE
097300200529     C                     UPDATBPACCAF                                   E29304
097400200529     C*********************ADD  OBPACH    RFGA                            E29304
097500200529     C*********************UPDATBPACHAF                                   E29304
097600200529     C                     END
097700200529      *
097800200529     C                     READ SNDEVAF                  88
097900200529     C           *IN88     IFEQ '1'
098000200529     C           *LOCK     IN   LDA                                       S01117
098100200529     C                     MOVEL'SNDEV'   DBFILE           ***************
098200200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 05 *
098300200529     C                     Z-ADD05        DBASE            ***************
098400200529     C                     OUT  LDA                                       S01117
098500200529     C                     EXSR *PSSR                                     S01117
098600200529     C                     SETON                     U7U8
098700200529     C                     GOTO ERRTAG
098800200529      *
098900200529     C                     ELSE
099000200529     C                     Z-ADD2235      TNLU
099100200529     C**********           ADD  OSNDEV    NORE                                                247420
099200200529     C                     ADD  OSNDEV    SNNORE                                              247420
099300200529     C                     UPDATSNDEVAF
099400200529     C                     END
099500200529      *
099600200529     C                     END
099700200529      *
099800200529      ***  Output Control Report.
099900200529      *
100000200529     C                     WRITEHEADAU
100100200529      *
100200200529      ***  Database errors within SR/AUDIT must 'GOTO' here.
100300200529      *
100400200529     C           ERRTAG    TAG                             *** ERRTAG ***
100500200529      *
100600200529     C           *INU7     IFEQ '1'
100700200529     C                     WRITEERROR
100800200529     C                     ELSE
100900200529      *
101000200529     C***********IREC      IFEQ 0                                         E29170
101100200529     C***********          WRITENONE                                      E29170
101200200529     C***********          ELSE                                           E29170
101300200529     C                     WRITECONTROL
101400200529     C***********          END                                            E29170
101500200529      *
101600200529     C                     END
101700200529      ***********                                                         E29170
101800200529     C***********          WRITETRAILAU                                   E29170
101900200529      *
102000200529      ***  Terminate the Program.
102100200529      *
102200200529     C                     SETON                     LR
102300200529      *
102400200529     C                     ENDSR
102500200529      *
102600200529      *****************************************************************
102700200529      /EJECT
102800200529      *****************************************************************
102900200529      *                                                               *
103000200529      *  BPHSR  - Subroutine for Error handling of Action records.    *
103100200529      *                                                               *
103200200529      ***Called*By:*Write*error*on*BPACHD.*****************************   E29304
103300200529      *  Called By: Write error on BPACC.                             *   E29304
103400200529      *  Calls    : AUDIT                                             *
103500200529      *                                                               *
103600200529      *****************************************************************
103700200529      *
103800200529     C           BPHSR     BEGSR                           *** BPHSR ***
103900200529      *
104000200529     C           *LOCK     IN   LDA                                       S01117
104100200529     C***********          MOVE 'BPACH'   DBFILE                          E29304
104200200529     C                     MOVE 'BPACC'   DBFILE                          E29304
104300200529     C                     MOVELBPHERR    DBKEY            ***************
104400200529     C                     Z-ADD06        DBASE            * DB ERROR 06 *
104500200529     C                     MOVE STSBPH    DBSTAT           ***************
104600200529     C                     OUT  LDA                                       S01117
104700200529     C                     EXSR *PSSR                                     S01117
104800200529     C                     SETON                     87U7U8
104900200529     C                     EXSR AUDIT
105000200529      *
105100200529     C                     ENDSR
105200200529      *
105300200529      *****************************************************************
105400200529      /SPACE 3
105500200529      *****************************************************************
105600200529      *                                                               *
105700200529      *  BHASR  - Subroutine for Error handling of Action Audit.      *
105800200529      *                                                               *
105900200529      ***Called*By:*Write*error*on*BPACHA.*****************************   E29304
106000200529      *  Called By: Write error on BPACCA.                            *   E29304
106100200529      *  Calls    : AUDIT                                             *
106200200529      *                                                               *
106300200529      *****************************************************************
106400200529      *
106500200529     C           BHASR     BEGSR                           *** BHASR ***
106600200529      *
106700200529     C           *LOCK     IN   LDA                                       S01117
106800200529     C*********************MOVE 'BPACH'   DBFILE                          E29304
106900200529     C                     MOVE 'BPACC'   DBFILE                          E29304
107000200529     C                     MOVEL'AUDIT'   DBKEY            ***************
107100200529     C                     Z-ADD07        DBASE            * DB ERROR 07 *
107200200529     C                     MOVE STSBHA    DBSTAT           ***************
107300200529     C                     OUT  LDA                                       S01117
107400200529     C                     EXSR *PSSR                                     S01117
107500200529     C                     SETON                     87U7U8
107600200529     C                     EXSR AUDIT
107700200529      *
107800200529     C                     ENDSR
107900200529      *
108000200529      *****************************************************************
108100200529      /SPACE 3
108200200529      *****************************************************************
108300200529      *                                                               *
108400200529      *  SNDSR  - Subroutine for Error handling of Diary records.     *
108500200529      *                                                               *
108600200529      *  Called By: Write error on SNDEVD.                            *
108700200529      *  Calls    : AUDIT                                             *
108800200529      *                                                               *
108900200529      *****************************************************************
109000200529      *
109100200529     C           SNDSR     BEGSR                           *** SNDSR ***
109200200529      *
109300200529     C           *LOCK     IN   LDA                                       S01117
109400200529     C                     MOVE 'SNDEV'   DBFILE
109500200529     C                     MOVELSNDERR    DBKEY            ***************
109600200529     C                     Z-ADD08        DBASE            * DB ERROR 08 *
109700200529     C                     MOVE STSSND    DBSTAT           ***************
109800200529     C                     OUT  LDA                                       S01117
109900200529     C                     EXSR *PSSR                                     S01117
110000200529     C                     SETON                     87U7U8
110100200529     C                     EXSR AUDIT
110200200529      *
110300200529     C                     ENDSR
110400200529      *
110500200529      *****************************************************************
110600200529      /SPACE 3
110700200529      *****************************************************************
110800200529      *                                                               *
110900200529      *  SNASR  - Subroutine for Error handling of Diary Audit.       *
111000200529      *                                                               *
111100200529      *  Called By: Write error on SNDEVA.                            *
111200200529      *  Calls    : AUDIT                                             *
111300200529      *                                                               *
111400200529      *****************************************************************
111500200529      *
111600200529     C           SNASR     BEGSR                           *** SNASR ***
111700200529      *
111800200529     C           *LOCK     IN   LDA                                       S01117
111900200529     C                     MOVE 'SNDEV'   DBFILE
112000200529     C                     MOVEL'AUDIT'   DBKEY            ***************
112100200529     C                     Z-ADD09        DBASE            * DB ERROR 09 *
112200200529     C                     MOVE STSSNA    DBSTAT           ***************
112300200529     C                     OUT  LDA                                       S01117
112400200529     C                     EXSR *PSSR                                     S01117
112500200529     C                     SETON                     87U7U8
112600200529     C                     EXSR AUDIT
112700200529      *
112800200529     C                     ENDSR
112900200529      *
113000200529      *****************************************************************   E18651
113100200529      /EJECT                                                              S01117
113200200529      *****************************************************************   S01117
113300200529      *                                                               *   S01117
113400200529      *  *PSSR  - Error control subroutine                            *   S01117
113500200529      *                                                               *   S01117
113600200529      *****************************************************************   S01117
113700200529      *                                                                   S01117
113800200529     C           *PSSR     BEGSR                           ** *PSSR **    S01117
113900200529     C**                                                                  S01117
114000200529     C           @RUN      IFEQ *BLANKS                                   S01117
114100200529     C                     MOVE 'Y'       @RUN    1                       S01117
114200200529     C                     DUMP                                           S01117
114300200529     C                     END                                            S01117
114400200529     C**                                                                  S01117
114500200529     C                     ENDSR                                          S01117
114600200529      *                                                                   S01117
114700200529      *****************************************************************
114800200529      /EJECT
114900200529     C/COPY ZSRSRC,ZDATE1Z2
115000200529      /EJECT
115100200529     C/COPY ZSRSRC,ZDATE2Z4
115200200529      /EJECT
115300200529     C/COPY ZSRSRC,ZLCDZ1
115400200529      /EJECT
115500200529     C/COPY ZSRSRC,ZSYSTMZ1
115600200529      /EJECT
115700200529      ***
115800200529**  CPY@
115900200529(c) Finastra International Limited 2001
116000200529**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
1161002005290366073110961461
116200200529**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
116300200529000031059090120151181212243273304334365
116400200529**   ZMNM - MONTHS SHORT NAMES
116500200529JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
