     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Gen. a/c keys - matured book position')       *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE2270 - GENERATE ACCOUNT KEYS - BOOK POSITION MATURITIES    *
     F*                                                               *
     F*  Function: For each Book Position in a maturing Security,     *
     F*   (COB)    a/c keys are generated, and the position is        *
     F*            closed off.                                        *
     F*            An extract is created for production of the        *
     F*            Matured Securities report.                         *
     F*                                                               *
     F*  Called by: SEC0607A - Generate A/c Keys - Book Position      *
     F*                        Maturities                             *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. 248698             Date 01Jun20               *
      *  Prev Amend No. MD057247           Date 01Feb21               *
      *                 MD050604           Date 21Feb20               *
      *                 MD054156           Date 29Jan20               *
      *                 MD046248           Date 27Oct17               *
      *                 215959             Date 21Mar16               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 09Jul15               *
      *                 CSE105             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSE091             DATE 16Jan06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE065             Date 08Nov04               *
      *                 CSE071             Date 19Jul05               *
      *                 194370             Date 12Jul01               *
      *                 CAS006             Date 21Jan03               *
      *                 211407             Date 07Jan03               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 CGL020             Date 12Dec02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 192467             Date 26Jul01               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      *                 183884             Date 12Feb02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 178371             Date 15Jan01               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 140272             Date 20Apr00               *
     F*                 169496             Date 08Feb00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CAC005             Date 23Nov98               *
      *                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
      *                 CSE005             Date 04Feb97               *
      *                 CAC002             Date 15Sep96               *
     F*                 084704             Date 01Aug96               *
     F*                 083039             Date 01Aug96               *
     F*                 059110             Date 01Aug96               *
     F*                 088047             Date 26Jun96               *
     F*                 100228             Date 31May96               *
     F*                 103011             DATE 09MAY96               *
     F*                 S01408             DATE 26APR96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 CPM004             DATE 08FEB96               *
     F*                 S01408             DATE 05FEB96               *
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 086491             DATE 15JUN95               *
     F*                 065301             DATE 06MAY94               *
     F*                 055842             DATE 08FEB94               *
     F*                 056004             DATE 26NOV93               *
     F*                 054257             DATE 26NOV93               *
     F*                 052254             DATE 26NOV93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 S01397             DATE 16SEP92               *
     F*                 E31177             DATE 03APR92               *
     F*                 E37572             DATE 30MAR92               *
     F*                 E29170             DATE 06NOV91               *
     F*                 E24106             DATE 25OCT91               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E29236             DATE 09OCT91               *
     F*                 E29270             DATE 09OCT91               *
     F*                 E24654             DATE 30SEP91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 S01117             DATE 31MAY91               *
     F*                 S01269             DATE 01AUG90               *
     F*                 E23517             DATE 01OCT90               *
     F*                 E22957             DATE 12AUG90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21511             DATE 03APR90               *
     F*                 E21139             DATE 15FEB90               *
     F*                 E20117             DATE 07FEB90               *
     F*                 E20953             DATE 31JAN90               *
     F*                 S01232             DATE 14DEC89               *
     F*                 S01233             DATE 12DEC89               *
     F*                 E20568             DATE 09DEC89               *
     F*                 E20380             DATE 30NOV89               *
     F*                 E20085             DATE 14NOV89               *
     F*                 E19138             DATE 12NOV89               *
     F*                 E18803             DATE 17AUG89               *
     F*                 E16474             DATE 26/06/89              *
     F*                 E17876             DATE 11/04/89              *
     F*                 E17704             DATE 31/03/89              *
     F*                 E17303             DATE 31/03/89              *
     F*                 S01176             DATE 09/11/88              *
     F*                 E15965             DATE 31/10/88              *
     F*                 E15442             DATE 30/09/88              *
     F*                 E14236             DATE 12/09/88              *
     F*                 E14680             DATE 08/09/88              *
     F*                 E14889             DATE 01/09/88              *
     F*                 E14721             DATE 19/08/88              *
     F*                 E14522             DATE 08/08/88              *
     F*                 E14502             DATE 27/07/88              *
     F*                 E13817             DATE 23/06/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in copy source ZCNSDZ1. *
      *  MD054156 - Incorrect amount generated on Midas Account Key   *
      *             Changed AAPR from BKPOSD to SACF from MATAC       *
      *  MD046248 - Finastra Rebranding                               *
      *  215959 - Truncation error on event amount in SE2450P3.       *
      *           Recompiled due to changes in PF/SEKEYD.             *
      *         - Applied for MD-37439.                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  CSE105 - Portuguese Upgrade - Discount/Premium Amortisation  *
      *           on Trade Date                                       *
      *  CSE091 - Upgrade LBV023 to Midas Plus.                       *
      *           Apply part of 066616 which sets event type on RP    *
      *           and RL keys at maturity to 'M'. originally in R10.4 *
      *           as 108032 - INCORPORATE S11422 FROM BV R2.3 SYSTEM. *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE065 - Cost Yield Amort. on Mortgage Backed Assets         *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
     F*  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
     F*           Information (Recompile)                             *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  192467 - No maturity position settlement was generated.  Set *
      *           price for records with processing type '1' and      *
      *           price basis 'U'.                                    *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  183884 - Only access Book Positions Profit Centres PF/SEPCBD *
      *           if Profit Centres used and Trade and Book Positions *
      *           are to be reconciled.                               *
     F*  178371 - WREDPR keeps the value of the previous security.    *
     F*           If Price Basis is 'U', set-up WREDPR with 0.        *
     F*  140272 - Recompile over changed ZYLDZ2                       *
     F*  169496 - DBERR in file BKMTH during COB.                     *
      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*           If Analytical Accounting is available, define the   *
     F*           profit centre for posting.                          *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  103011 - The system creates a position settlement MT* for    *
     F*           warrant which can lead to confusion for cashflow    *
     F*  S01408 - Addition of core hook SE2270CCP3
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  S01408 - Addition of core hook SE2270FFP1
     F*           Addition of core hook SE2270CCP1
     F*           Addition of core hook SE2270CCP2
     F*  CPM004 - Bank Portfolios                                     *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  055842 - Check if profit centres used before chaining to     *
     F*           profit centres file                                 *
     F*  056004 - Should not amortize the trade date position, so that*
     F*           the realized Profit/Loss key for trade date is      *
     F*           equal to the discount/premium. Where as the value   *
     F*           date key can be equal to 0, if the book is amortized*
     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
     F*           to 10,9                                             *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Recompiled due to changes to files.               *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*         - Added processing for Discount/Premium since First   *
     F*           Position Date for Amortisation by Security Report   *
     F*         - Recompiled for New Zealand Bond Formula             *
     F*  E31177 - Realised profit wrong at maturity for books that    *
     F*           have had mark to market done to them                *
     F*  E37572 - ZACRFB needs to be called to calculate the coupon   *
     F*           amount for Schuldsheins                             *
     F*  E29170 - Report Control Facility changes                     *
     F*  E24106 - Ensure nominal currency decimal places are used in  *
     F*           the calculation of FV key                           *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E29236 - Partly paid securities                              *
     F*           - Problems with back-valuation                      *
     F*           - Problems with discount amortization               *
     F*           - 2 keys produced on part payment, should only be 1 *
     F*  E29270 - Realized profit wrongly generated at maturity for   *
     F*           amortizing books on first day accruals.             *
     F*  E24654 - Consideration keys should be produced using the     *
     F*           value date book position's average price.           *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  S01117 - Multibranching                                      *
     F*  S01269 - Trade authorisation: recompiled for change to       *
     F*           file TABSE                                          *
     F*  E23517 - IF SETTLEMENT CCY IS NOT EQUAL TO THE NOMINAL CCY,  *
     F*           THEN THE SEKEYD FIELD EVCY SHOULD BE SET TO THE     *
     F*           SETTLEMENT CCY FOR THE 'CV' KEY.                    *
     F*  E22957 - BOOK POSITION PROCESSING REVIEW                     *
     F*         - Suppress RP and RL key generation if trade date     *
     F*         - Discount was Calc'ed from Average Price not APNC    *
     F*         - Coding for convrsn of DISC/YIELD to price is redundt*
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21511 - Extension to E19138. Zeroise the Accrued interest   *
     F*           for securities that are not interest bearing.       *
     F*  E21139 - CV Key is generated at 100% and not at Redemption   *
     F*           Price.                                              *
     F*  E20117 - Use ZCNSD to calculate realized Profit and Loss,    *
     F*           Consideration, etc. as in SE2220 - Was out by a     *
     F*           factor of CDP (cf E19138).                          *
     F*  E20953 - Use consistent method to calculate Interest for use *
     F*           in Australian Price/Yield conversion.               *
     F*  S01232 - Australian Yields Modification.                     *
     F*  S01233 - Australian modifications for the Amortization of    *
     F*           Premium/Discount (Yield curve basis).               *
     F*  E20568 - ZACCZ changed to read Non-Diary Events File -       *
     F*           renamed record format of SECEO.                     *
     F*  E20380 - New version of ZYLD for DIV BASIS 5, RECOMPILED.    *
     F*  E20085 - Interest and Coupon Calculations Rewrite:           *
     F*           - LF/SECEO member SEDEVD changed to omit RECI = 'C'.*
     F*           - Coupon Amount at Maturity must be written to file *
     F*             MATEXD. SR/ZACCZ and SR/ZLCD have been added.     *
     F*             Redundant Subroutines, ACCRUE, ACCRUX, INTCPN,    *
     F*             ZNCD and COUPON, have been removed.               *
     F*           - Enhance E19138.                                   *
     F*  E19138 - CONSIDERATION/COUNTERVALUE/REALIZED & UNREALIZED P/L*
     F*           AMTS FOR CERTAIN SECURITIES ARE WRONG BY FACTORS OF *
     F*           10 AND UNREALIZED P/L AT MATURITY IS WRONG          *
     F*  E18803 - SET ACCOUNT KEY SEQUENCE NO. TO ZERO TO ALLOW FOR   *
     F*           MULTI-BRANCH SYSTEMS.                               *
     F*  E16474 - ISSUER OF A SECURITY SHOULD GO ON THE MATURITY      *
     F*           ACCOUNT KEY.                                        *
     F*  E17876 - REMOVE E17704, CAUSES SE2100 LOOP IN ALL TEST SYS'S.*
     F*  E17704 - RECOMPILE PROGRAM OVER CHANGED ZNCDZ3 SR            *
     F*  E17303 - RECOMPILE PROGRAM OVER CHANGED ZDYYRZ3 ZYLDZ1 ZYLDZ2*
     F*  S01176 - RELEASE 3.1 MODIFICATIONS.                          *
     F*  E15965 - Mark to market revaluation                          *
     F*  E15442 - AVERAGE PRICE IS NOT UPDATED BY AMORTISATION        *
     F*           OF DISCOUNT, AMORTISED AMOUNTS ARE INCORRECT.       *
     F*  E14236 - PROCESS MATURITY BOOK POSITION ACTIONS.             *
     F*  E14680 - COUPON EVENTS ARE OUTPUT AS 'CP' RATHER THAN 'CO'   *
     F*           ON NON DIARY EVENTS FILE.                           *
     F*  E14889 - COUNTERVALUE KEY WRONGLY GENERATED AT MATURITY.     *
     F*  E14721 - OUTPUT REVERSAL INDICATOR ON SEKEYD AS ZERO, IN     *
     F*           ACCORDANCE WITH THE SDS.                            *
     F*  E14522 - TEST CONVERTIBLE INDICATOR (POSN 14 IN ACCOUNT KEY) *
     F*           CORRECTLY.                                          *
     F*  E14502 - ONLY PROCESS MATAC RECORDS WHICH HAVE AKRI (ACCOUNT *
     F*           KEY REQUIRED INDICATOR) = 'Y'.                      *
     F*  E13817 - POST INCORPORATION FIXES FROM JULIUS BAER.          *
     F*                                                               *
     F*****************************************************************
      *
     FMATAC   IF  E           K        DISK
     FBKPHD   UF  E           K        DISK         KINFDS BKHDS
     F                                              KINFSR BKHSR
     FBKMTH   UF  E           K        DISK         KINFDS BKMDS
     F                                              KINFSR BKMSR
     FBKPHDA  IF  E           K        DISK         KINFDS BHADS
     F                                              KINFSR BHASR
     F***BKPOS***IF**E           K        DISK                            E14236
     FBKPOS   UF  E           K        DISK                               E14236
     FBOOKD   IF  E           K        DISK
     FSECTY   IF  E           K        DISK
     FINVTP   IF  E           K        DISK
     F***SEDEV   IF  E           K        DISK                            E13817
     FSECED   IF  E           K        DISK                               E13817
     FSEPCBD  IF  E           K        DISK                               S01117
     FSECEO   IF  E           K        DISK                               E20085
     F            SEDEVDF                           KRENAMESEDEVDO        E20085
     F**********  SNDEVDF                           KIGNORE         E20085E20568
     F            SNDEVDF                           KRENAMESNDEVDO        E20568
     FSEKEYD  O   E           K        DISK         KINFDS SKDDS
     F                                              KINFSR SKDSR
     FSEKEYA  O   E           K        DISK         KINFDS SKADS
     F                                              KINFSR SKASR
     FMATEXD  O   E           K        DISK         KINFDS MTDDS
     F                                              KINFSR MTDSR
     FMATEXA  O   E           K        DISK         KINFDS MTADS
     F                                              KINFSR MTASR
     FSE2270AUO   E                    PRINTER
     F*****TABICD  IF  E           K        DISK                          S01232
     F**ICD*1**** TABTB10F                          KIGNORE               S01232
     F**ICD*2***  TABTB11F                          KIGNORE               S01232
     F**********  TABTB20F                          KIGNORE               S01232
     F**********  TABTB30F                          KIGNORE               S01232
     F**********  TABTB35F                          KIGNORE               S01232
     F**ICD*SE**  TABTB36F                          KIGNORE               S01232
     F**********  TABTB40F                          KIGNORE               S01232
     F**********  TABTB50F                          KIGNORE               S01232
     F**********  TABTB55F                          KIGNORE               S01232
     F**********  TABTE10F                          KIGNORE               S01232
     F**********  TABTE20F                          KIGNORE               S01232
     F* CURRENCY  TABTG10F                          KIGNORE               S01232
     F**********  TABTG20F                          KIGNORE               S01232
     F**********  TABLETHF                          KIGNORE               S01232
     F**********  TABLETRF                          KIGNORE               S01232
     F**********  TABLETXF                          KIGNORE               S01232
     F**********  TABLET5F                          KIGNORE               S01232
     FTABSE   IF  E           K        DISK                               S01232
     F            TABLETAF                          KIGNORE               S01232
     F*********** TABTB10F                          KIGNORE               S01232
     F*********** TABTB11F                          KIGNORE               S01232
     F*********** TABTB36F                          KIGNORE               S01232
     F************TABTB40F                          KIGNORE        S01232 055842
     F            TABTE10F                          KIGNORE               S01232
     F            TABTE20F                          KIGNORE               S01232
     F** CCY **** TABTG10F                          KIGNORE               S01232
     F            TABTG20F                          KIGNORE               S01232
     F            TABLETHF                          KIGNORE               S01232
     F***HOLS *** TABLETJF                          KIGNORE               S01232
     F            TABLETKF                          KIGNORE               S01232
     F            TABLETLF                          KIGNORE               S01232
     F            TABLETNF                          KIGNORE               S01232
     F            TABLETPF                          KIGNORE               S01232
     F*********** TABLETRF                          KIGNORE               S01232
     F            TABLETXF                          KIGNORE               S01232
     F            TABLET2F                          KIGNORE               S01232
     F            TABLET3F                          KIGNORE               S01232
     F            TABLET5F                          KIGNORE               S01232
     F*                                                                   S01408
     F/COPY WNCPYSRC,SE2270FFP1                                           S01408
     F*                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   10 - SECURITY DIARY EVENT RECORD FOUND                      *
     F*   11 - NO BOOK POSITION HEADERS FOR THIS SECURITY             *
     F*   12 - TRADE TYPE BOOK POSITION ONLY                          *
     F*   15 - UNREALISED P/L CHANGED LONG TO SHORT OR VICE VERSA     *
     F*                                                               *
     F****20*-*COUPON*KEYS*PROCESSED                                  *   E20085
     F****40*-*SECURITY*DIARY*EVENT*RECORD*FOUND*FOR*INTEREST*CHANGES *   E20085
     F****41*-*BYPASS*FIRST*READ*OF*SEDEV                             *   E20085
     F****70-73*NO*OF*DPS*FOR*CALCULATION                             *   E20085
     F****76*-*INTEREST*CHANGES*FOR*PERIOD                         E13817 E20085
     F****77*-*SECED*RECORD*READ                                   E13817 E20085
     F****78*-*EOF*ON*SECED                                        E13817 E20085
     F*                                                               *
     F*   52 - AUSTRALIAN YIELD SECURITY                              *   S01232
     F*   88 - EOF ON BKPHD FOR READE                                 *
     F*   89 - EOF ON MATAC                                           *
     F*                                                               *
     F*90-99 - USED IN Z-SUBROUTINES                                  *
     F*                                                               *
     F*U7-U8 - DATABASE ERROR                                         *
     F*   U8 - CONTROL TOTALS OUT OF BALANCE                          *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  FIRST  - ACCESSES INFO FROM ICD,ICD2 AND ICDSE               *
     F*  FVAL   - PRODUCES FACE VALUE KEYS                            *
     F*  CONS   - PRODUCES CONSIDERATION KEYS                         *
     F*  CVALUE - PRODUCES COUNTERVALUE KEYS                          *
     F*  UNRLPL - PRODUCES UNREALISED P/L KEYS                        *
     F*  REALPL - PRODUCES REALISED P/L KEYS                          *
     F*  AMORT  - AMORTISES PREMIUM/DISCOUNT                          *
     F***ACCRUE*-*ACCRUES*INTEREST*UP*TO*MATURITY*DATE*****************   E20085
     F***ACCRUX*-*CALCULATES*EX-COUPON*ACCRUAL******************** E13817 E20085
     F***INTCPN*-*CALCULATES*EX-COUPON*ACCRUAL******************** E13817 E20085
     F***COUPON*-*PRODUCES*COUPON*KEYS*AT*MATURITY*********************   E20085
     F*  W01    - WRITES ACCOUNT KEY                                  *
     F*  W02    - WRITES RECORD TO MATURED SECURITY POSITIONS EXTRACT *
     F*  W03    - WRITES NEW BOOK POSITION HEADER                     *
     F*  U03    - UPDATES BOOK POSITION HEADER                        *
     F*  AUDIT  - PRODUCES CONTROL REPORT AND UPDATES AUDIT RECORDS   *
     F*                                                               *
     F*  BKPCHN - CHAINS TO BOOK POSITION                             *
     F*  PPCCHN - Chains to Book Position Profit Centre File          *
     F*  BOKCHN - CHAINS TO BOOK DESCRIPTION FILE                     *
     F*  SECCHN - CHAINS TO SECURITIES FILE                           *
     F*  INVCHN - CHAINS TO INVESTMENTS FILE                          *
     F*  TABCHN -  CHAINS TO TABTG10 FILE                             *
     F*                                                               *
     F*  ZACCR  - CALCULATES ACCRUED INTEREST                         *
     F*  ZACCZ  - CALCULATES ACCRUED INTEREST between certain dates   *   E20085
     F*  ZCNSD  - CALCULATES AMOUNT FROM NOMINAL AND PRICE            *   E20117
     F*  ZCONV  - TO CONVERT AMOUNT TO OTHER CURRENCY                 *
     F*  ZDATE1 - CONVERTS DATES TO DAYS                              *
     F*  ZDATE2 - CONVERTS DAYS TO DATES                              *
     F*  ZDAYS  - CALCULATES NO OF DAYS BETWEEN TWO DATES             *
     F*  ZDYYR  - CALCULATES NO OF DAYS IN INTEREST YEAR              *
     F*  ZEVCD  - CALCULATES EVENT CONTROL DATE                       *
     F*  ZICD2  - OBTAINS ICD2 INFO                                   *
     F*  ZICDSE - OBTAINS ICDSE INFO                                  *
     F*  ZNCD   - CALCULATES NEXT COUPON DATE                         *
     F*  ZPRCI  - CONVERTS PRICE TO %PRICE                            *
     F*  ZRATE  - CALCULATES EFFECTIVE RATE                           *
     F*  ZSYSTM - OBTAINS ICD INFO                                    *
     F*  ZYLDI  - OUTPUTS YIELD AS PERCENTAGE                         *
     F*  *PSSR  - EXCEPTION ERROR ROUTINE                             *
     F*                                                               *
     F*****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDATE6Z1                                               S01232
     E/COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZHASHZ1
     E/COPY ZSRSRC,ZPOWERZ1
     E/COPY ZSRSRC,ZPOWER8Z1
     E                    WWARRZ  1   5  5                                CPM004
      /EJECT
     I*
     ISNDEVDF                                                             E13817
     I*                                                                   E13817
     I* TO RENAME SNDEVD FIELDS                                           E13817
     I*                                                                   E13817
     I              SNDT                            SDED                  E13817
     I              SNET                            SDET                  E13817
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
     I*                                                                   E13817
     I* DATA STRUCTURES FOR Z-SUBROUTINES
     I*
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZHASHZ2
     I*
     I            DS
     I                                        1   6 IKEY
     I                                        1   3 NMCY
     I                                        4   6 SITP
     I*
     I            DS
     I                                        1  15 EKEY
     I                                        1  10 ESEC
     I                                    P  11  130EDTE
     I                                       14  15 ETYP
     I*
     I            DS
     I                                        1  12 TKEY
     I                                        1   20RECT
     I                                        3  10 ZZ008
     I                                       11  120RCDE
     I*
     I            DS
     I                                        1  17 BHKEY
     I                                        1  20 BPKEY
     I                                        1  16 BHKN16
     I                                        1  10 BHSC
     I***********                            11  130BHBR                  S01117
     I                                       11  13 BHBA                  S01117
     I                                       14  15 BHBK
     I                                       16  16 BHMK
     I                                       17  17 BHTV
     I                                    P  18  200LPSD
     I            DS
     I                                        1  17 BHKEYP
     I                                        1  16 BHKP16
     I                                        1  10 WBHSC
     I***********                            11  130WBHBR                 S01117
     I                                       11  13 WBHBA                 S01117
     I                                       14  15 WBHBK
     I                                       16  16 WBHMK
     I                                       17  17 WBHTV
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR ACCOUNT KEY
     I*
     I                                        1  20 ACKY
     I                                        1   3 IVTP
     I                                        4   4 EVTP
     I                                        5   5 TRTP
     I                                        6   6 PORT
     I                                        7   8 BOOK
     I                                        9   9 PSBS
     I                                       10  10 FILL
     I                                        9  10 TRST
     I                                       11  12 CHGT
     I                                       13  13 MRKT
     I                                       14  14 CNVI
     I                                       15  15 NEGI
     I                                       16  18 FIL2
     I                                       19  20 AMCD
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR STORING BOOK POSITION HEADER RECORD
     I*
     I                                        1  15 BKHST
     I                                        1  10 BKHSC
     I***********                            11  130BKHBR                 S01117
     I                                       11  13 BKHBR                 S01117
     I                                       14  15 BKHBK
     IKSEPCR      DS                                                      S01117
     I*                                                                   S01117
     I* Data structure used to store Key List for Book Position           S01117
     I* Profit Centre File (PF/SEPCBD) in case of Database Error          S01117
     I*                                                                   S01117
     I                                        1   2 KBHBK                 S01117
     I                                        3   5 KBHBA                 S01117
     I                                        6  15 KBHSC                 S01117
     I                                       16  16 KBHMK                 S01117
     I*
     I* DATA STRUCTURES FOR ERROR HANDLING
     I*
     IBKHDS       DS
     I                                     *STATUS  STSBKH
     I*
     IBKMDS       DS
     I                                     *STATUS  STSBKM
     I*
     IBHADS       DS
     I                                     *STATUS  STSBHA
     I*
     IMTDDS       DS
     I                                     *STATUS  STSMTD
     I*
     IMTADS       DS
     I                                     *STATUS  STSMTA
     I*
     ISKDDS       DS
     I                                     *STATUS  STSSKD
     I*
     ISKADS       DS
     I                                     *STATUS  STSSKA
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR BOOK HEADER MONTHLY KEY
     I*
     I                                        1  20 BKMKEY
     I                                        1  10 BKSS
     I***********                            11  130BKBR                  S01117
     I                                       11  13 BKBA                  S01117
     I                                       14  15 BKBO
     I                                       16  16 BKMK
     I                                       17  17 BKTV
     I                                    P  18  200BKED
     I*
     ILDA         DS                            256                       S01117
     I*                                                                   S01117
     I** Local Data Area, used in Database Error reporting                S01117
     I*                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I***********LDA        UDS                 256                       S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I/COPY ZSRSRC,ZYLDZ1
      *                                                                   CPM004
     I            DS                                                      CPM004
     I                                        1   5 WWKY                  CPM004
     I                                        1   1 WWKY1                 CPM004
     I                                        2   2 WWKY2                 CPM004
     I                                        3   3 WWKY3                 CPM004
     I                                        4   5 WWKY4                 CPM004
      *                                                                   CPM004
      ** Input parameters on call to AOPLCSR1                             CPM004
     II@PARM      DS                            256                       CPM004
     I                                        1   1 I#PORS                CPM004
     I                                        2   5 I#R997                CPM004
     I                                        6  15 I#CUST                CPM004
     I                                       16  18 I#BRCA                CPM004
     I                                       19  20 I#BOOK                CPM004
     I                                       21  24 I#PTFR                CPM004
     I                                       25  34 I#CPGM                CPM004
     I*                                                                   CPM004
      ** Output parameters on call to AOPLCSR1                            CPM004
     IO@PARM      DS                            256                       CPM004
     I                                        1   2 O#BOOK                CPM004
     I                                        3   6 O#PTFR                CPM004
     I                                        7  12 O#BICN                CPM004
     I                                       13  22 O#CRNM                CPM004
     I                                       23  24 O#ACOF                CPM004
     ISDMMOD    E DSSDMMODPD                                              CPM004
     I**  Data structure for module details                               CPM004
     I*                                                                   CPM004
     ISDPORT    E DSSDPORTPD                                              CPM004
     I**  Data structure for Porfolio Management ICD                      CPM004
     I*                                                                   CPM004
     ISDPLCS    E DSSDPLCSPD                                              CPM004
     I**  Data structure for Porfolio Customer details                    CPM004
     I*                                                                   CPM004
     ISDSTRD    E DSSDSTRDPD                                              CAC002
     I**  Securities Trading Details                                      CAC002
     I*                                                                   CAC002
     IDSFDY     E DSDSFDY                                                 CPM004
     I** First data structure for access programs, short data structure   CPM004
     I*                                                                   CPM004
     IDSSDY     E DSDSSDY                                                 CAC002
     I*  Second DS for Access Programs, Long Data Structure               CAC002
     I*                                                                   CAC002
     ISCSARD    E DSSCSARDPD                                                                  CAS006
      ** SAR file details accessed via access program AOSARDR0                                CAS006
     I/COPY WNCPYSRC,SE2270I002
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I              'DiscPremAmortPostn  'C         SVALKK                                    CSE105
      *                                                                                       CSE105
     I/COPY WNCPYSRC,SE2270I001
      /EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C                     MOVEACPY@      CPY2@  80
     C*
     C* KEYLISTS FOR FILE CHAINS
     C*
     C*   - BOOK POSITION HEADER
     C*
     C           BKHKEY    KLIST
     C                     KFLD           SASN
     C*
     C*  - BOOK POSITION
     C*
     C           BKPKEY    KLIST
     C                     KFLD           BHSC
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHMK
     C                     KFLD           BHTV
     C                     KFLD           LPSD
     C*
     C* KEY LIST FOR SETLL OF BOOK POSITION HEADER  MONTH END FILE
     C*
     C           BMKEY     KLIST
     C                     KFLD           BKSS
     C***********          KFLD           BKBR                            S01117
     C                     KFLD           BKBA                            S01117
     C                     KFLD           BKBO
     C                     KFLD           BKMK
     C                     KFLD           BKTV
     C                     KFLD           BKED
     C*
     C* KEY LIST FOR READ EQUAL OF BOOK POSITION HEADER  MONTH END FILE
     C*
     C           BKMK1     KLIST
     C                     KFLD           BKSS
     C***********          KFLD           BKBR                            S01117
     C                     KFLD           BKBA                            S01117
     C                     KFLD           BKBO
     C                     KFLD           BKMK
     C                     KFLD           BKTV
     C*                                                                   S01117
     C*  - Book Position Profit Centre (PF/SEPCBD)                        S01117
     C*                                                                   S01117
     C           KSEPCB    KLIST                                          S01117
     C                     KFLD           KBHBK                           S01117
     C                     KFLD           KBHBA                           S01117
     C                     KFLD           KBHSC                           S01117
     C                     KFLD           KBHMK                           S01117
     C*
     C*  - BOOK
     C*
     C           BOKKEY    KLIST
     C                     KFLD           BHBK
     C*
     C*  - SECURITY
     C*
     C           SECKEY    KLIST
     C                     KFLD           SASN
     C*
     C*  - SECURITY DIARY EVENTS
     C*
     C           SEDKEY    KLIST
     C                     KFLD           SASN
     C                     KFLD           EDTE
     C                     KFLD           ETYP
     C*
     C*  - SECURITY DIARY EVENTS
     C*
     C           SEDKY2    KLIST
     C                     KFLD           SASN
     C*
     C*  - INVESTMENT TYPE
     C*
     C           INVKEY    KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*
     C*  - TABLE
     C*
     C           TABKEY    KLIST
     C                     KFLD           TKEY
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2270CCP1                                           S01408
     C*
     C* ACCESS ICD INFORMATION
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANK    DBLOT
     C                     MOVE 'SE2270  'DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C                     EXSR FIRST
     C           *INU7     IFEQ '1'
     C                     GOTO EAUDIT
     C                     END
     C*
     C* DEFINE AND CLEAR WORK FIELDS AND INDICATORS
     C*
     C                     Z-ADD0         IREC    50
     C                     Z-ADD0         SEKREC  50
     C                     Z-ADD0         MATREC  50
     C                     Z-ADD0         BHREC   50
     C                     Z-ADD0         BHRECT  50
     C                     Z-ADD0         BHRECV  50
     C                     MOVE ' '       TVST    1
     C*
     C* DEFINE WORK FIELDS
     C*
     C           *LIKE     DEFN SDRP      WREDPR
     C           *LIKE     DEFN SDRP      SREDPR
     C           *LIKE     DEFN CSNT      WCSNT
     C*
     C* READ AND PROCESS ALL MATURITY ACTIONS UNTIL EOF
     C*
     C           *IN89     DOUEQ'1'
     C           *INU7     OREQ '1'
     C                     READ MATAC                    89
     C           *IN89     IFEQ '1'
     C                     GOTO ENDLP
     C                     ELSE
     C                     ADD  1         IREC
     C                     END
     C*                                                                   E14502
     C* ONLY PROCESS IF ACCOUNT KEY REQUIRED IND. IS SET TO 'Y'           E14502
     C* TO AVOID PRODUCING ENTRIES PRIOR TO MATURITY DATE                 E14502
     C*                                                                   E14502
     C           AKRI      IFNE 'Y'                                       E14502
     C                     GOTO ENDLP                                     E14502
     C                     END                                            E14502
     C*
     C* CLEAR INDICATORS AND WORK FIELDS
     C*
     C                     Z-ADD0         NOREC   50
     C                     Z-ADD0         WFVAL  130
     C                     Z-ADD0         WINTD  130
     C                     MOVEA'00'      *IN,10
     C                     MOVE '0'       *IN15
     C***********          MOVE '0'       *IN20                           E20085
     C***********          MOVEA'00'      *IN,40                          E20085
     C                     MOVE '0'       *IN88
     C*
     C* ACCESS SECURITIES FILE AND INVESTMENT TYPE
     C*
     C                     EXSR SECCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDLP
     C                     END
     C*
     C                     EXSR INVCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDLP
     C                     END
     C/COPY WNCPYSRC,SE2270C017
     C*
     C* OBTAIN NOMINAL CURRENCY DECIMAL PLACES FROM TABTG10
     C*
     C                     MOVE WNMCY     WKCCY   3                       S01117
     C                     EXSR TABCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDLP
     C                     END
     C*********************Z-ADDCDP       NCDP                     S01232 E22957
     C*                                                                   S01117
     C**  Set up nominal currency decimal places parameter for            S01117
     C**  SR.ZACCR - Calculate interest accrued between two dates         S01117
     C**  SR.ZCNSD - Calculate consideration                              S01117
     C**  and input currency decimal places parameter for                 S01117
     C**  SR.ZCONV - Convert an amount from one currency to a second      S01117
     C*                                                                   S01117
     C                     Z-ADDCDP       ZCDP                            S01117
     C                     Z-ADDCDP       ZCDPI                           S01117
     C*
     C* OBTAIN REDEMPTION PRICE
     C*
     C*   - ACCESS SECURITY EVENT 'RC' OR 'RP' FOR MATURITY DATE
     C*
     C                     Z-ADDMATY      EDTE
     C                     MOVE 'RC'      ETYP
     C                     EXSR SEDCHN
     C*
     C           *IN10     IFEQ '0'
     C                     MOVE 'RP'      ETYP
     C                     EXSR SEDCHN
     C                     END
     C*
     C*   -  IF SECURITY RECORD NOT FOUND - SET REDEMPTION PRICE TO 1
     C*        OR 100 DEPENDING ON PRICE BASIS ON SECURITY
     C*
     C           *IN10     IFEQ '0'
     C*
     C           SPBS      IFEQ 'P'
     C                     Z-ADD100       WREDPR
     C***********          ELSE                                           103011
     C***********          Z-ADD1         WREDPR                          103011
     C                     ELSE                                           178371
     C                     Z-ADD0         WREDPR                          178371
     C           PROT      IFEQ '1'                                                           192467
     C           SPBS      ANDEQ'U'                                                           192467
     C                     Z-ADD1         WREDPR                                              192467
     C                     ENDIF                                                              192467
     C                     END
     C*
     C                     ELSE
     C                     Z-ADDSDRP      WREDPR
     C                     END
     C*
     C**CALCULATE*EVENT*CONTROL*DATE*AND*NEXT*COUPON*DATE*****
     C*
     C***********          EXSR ZEVCD                                     E19138
     C***********          EXSR ZNCD                                      E20085
     C*
     C* FOR EACH BOOK POSITION HEADER FOR THIS SECURITY -
     C*    - PRODUCE REQUIRED KEYS
     C*
     C/COPY WNCPYSRC,SE2270C022
     C           BKHKEY    SETLLBKPHD
     C*
     C           *IN88     DOUEQ'1'
     C           *INU7     OREQ '1'
     C           BKHKEY    READEBKPHD                    88
     C*
     C           *IN88     IFEQ '1'
     C*
     C           NOREC     IFEQ 0
     C                     MOVE '1'       *IN11
     C                     EXSR W02
     C                     END
     C*
     C                     GOTO ENDRD
     C                     END
     C*
     C                     ADD  1         BHREC
     C                     ADD  1         NOREC
     C*
     C* CHECK FOR TYPES 'T' AND 'V' IN PAIRS
     C*
     C*   -  IF TYPE 'T' FOUND ONLY, WRITE MATEXD RECORD FOR
     C*        PREVIOUS POSITION
     C*
     C           BHTV      IFEQ 'T'
     C           TVST      ANDEQ'T'
     C*
     C           TVST      OREQ 'T'
     C           BHKN16    ANDNEBHKP16
     C                     MOVE '1'       *IN12
     C                     MOVELBHKEY     BKHST
     C                     EXSR W02
     C                     MOVELBKHST     BHKEY
     C                     MOVE '0'       *IN12
     C                     ADD  1         BHRECT
     C                     END
     C*
     C*    -  IF TYPE 'V' FOUND ONLY, INCREMENT COUNT
     C*
     C           BHTV      IFEQ 'V'
     C           TVST      ANDEQ'V'
     C*
     C           BHTV      OREQ 'V'
     C           BHKN16    ANDNEBHKP16
     C                     Z-ADD0         WCSNT
     C                     ADD  1         BHRECV
     C                     END
     C*
     C                     MOVE BHTV      TVST
     C                     MOVE BHKEY     BHKEYP
     C*
     C* ACCESS BOOK POSITION FOR LATEST POSITION DATE FOR THIS HEADER
     C*
     C                     EXSR BKPCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDRD
     C                     END
     C*                                                                   S01117
     C* Access Book Position Profit Centre                                S01117
     C*                                                                   S01117
     C           PFUS      IFEQ 'Y'                                       055842
     C           TBRC      ANDEQ'Y'                                       183884
     C                     MOVE BPBK      KBHBK                           S01117
     C                     MOVE BPBA      KBHBA                           S01117
     C                     MOVE BPSC      KBHSC                           S01117
     C                     MOVE BPMK      KBHMK                           S01117
     C           CAC005    IFEQ 'N'                                       CAC005
     C                     EXSR PPCCHN                                    S01117
     C                     ENDIF                                          CAC005
     C           *INU7     IFEQ '1'                                       S01117
     C                     GOTO ENDRD                                     S01117
     C                     END                                            S01117
     C                     END                                            055842
     C*
     C* ACCESS BOOK DETAILS FILE
     C*
     C                     EXSR BOKCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDRD
     C                     END
     C*
     C* ACCESS BOOK HEADER MONTH END RECORD
     C*
     C                     EXSR BMTCHN
     C           *INU7     IFEQ '1'
     C                     GOTO ENDRD
     C                     END
     C*
     C* PRODUCE FACE VALUE AND CONSIDERATION KEYS IF REQUIRED
     C*
     C           BHTV      IFEQ 'T'
     C*
     C           PROT      IFNE '2'
     C           PROT      ANDNE'4'
     C           PROT      ANDNE'7'
     C                     EXSR FVAL
     C                     END
     C                     END                                            E24654
     C*
     C           BHTV      IFEQ 'V'                                       E24654
     C                     EXSR CONS
     C*
     C                     END
     C*
     C* PRODUCE UNREALISED P/L KEYS IF REQUIRED
     C*
     C/COPY WNCPYSRC,SE2270C006
     C           UPPS      IFNE ' '
     C           UPBS      IFEQ 'B'
     C           UPBS      OREQ BHTV
     C                     EXSR UNRLPL
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE2270C007
     C*
     C**PRODUCE*REALISED*P/L*KEYS*IF*REQUIRED**************************   E19138
     C** Perform amortization first                                       E19138
     C*
     C***********RPBS      IFEQ 'B'                                       E19138
     C***********RPBS      OREQ BHTV                                      E19138
     C***********          EXSR REALPL                                    E19138
     C***********          END                                            E19138
     C*
     C* PRODUCE AMORTISED DISC/PREM, ACCRUED INTEREST RECEIVABLE,
     C*    COUPON AND COUNTERVALUE ACCOUNT KEYS IF REQUIRED
     C*
     C*****Amortization*is*required*for*both*'T'*and*'V'*records***E19138 056004
      ***  Amortization is only required for 'V' records                  056004
      ***  to permit correct calculation of Realized Profit/Loss.         E19138
      *                                                                   E19138
     C***********BHTV      IFEQ 'V'                                       E19138
     C***********                                                         E20085
     C***********MATY      IFNE 99999                                     E15442
     C***********STBS      ANDEQ'D'                                       E15442
     C***********STAD      IFEQ 'Y'                                       E15442
     C***********GDPK      OREQ 'Y'                                       E15442
     C***********          EXSR AMORT                                     E15442
     C***********          END                                            E15442
     C***********          END                                            E15442
     C           MATY      IFNE 99999                                     E15442
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2270CCP2                                           S01408
      *                                                                                       CSE105
      ** If CSE105 is installed, perform the routine when the new                             CSE105
      ** Trade/Value Amortization flag is "Both" or EQUAL to original                         CSE105
      ** flag.                                                                                CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
      *                                                                                       CSE105
     C           STAD      IFEQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQ'B'                                                           CSE105
     C           STAD      OREQ 'Y'                                                           CSE105
     C           SESVAL    ANDEQBHTV                                                          CSE105
      *                                                                                       CSE105
     C           STAD      OREQ 'C'                                                           CSE105
     C           SESVAL    ANDEQ'B'                                                           CSE105
     C           STAD      OREQ 'C'                                                           CSE105
     C           SESVAL    ANDEQBHTV                                                          CSE105
      *                                                                                       CSE105
     C           STBS      OREQ 'D'                                                           CSE105
     C           GDPK      ANDEQ'Y'                                                           CSE105
     C           SESVAL    ANDEQ'B'                                                           CSE105
     C           STBS      OREQ 'D'                                                           CSE105
     C           GDPK      ANDEQ'Y'                                                           CSE105
     C           SESVAL    ANDEQBHTV                                                          CSE105
      *                                                                                       CSE105
     C                     EXSR AMORT                                                         CSE105
      *                                                                                       CSE105
      ** If no amortisation, recalculate APNC for realised P/L                                CSE105
      ** calculation.                                                                         CSE105
      *                                                                                       CSE105
     C                     ELSE                                                               CSE105
     C                     Z-ADDNPSN      ZNOML                                               CSE105
     C                     Z-ADDLAVP      ZPRC                                                CSE105
     C                     EXSR ZCNSD                                                         CSE105
     C                     Z-ADDZCONS     APNC                                                CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** ... CSE105 is not installed.                                                         CSE105
      *                                                                                       CSE105
     C                     ELSE                                                               CSE105
      *                                                                                       CSE105
     C*                                                                   S01408
     C           STAD      IFEQ 'Y'                                       E15442
     C           BHTV      ANDEQ'V'                                       056004
     C           STAD      OREQ 'C'                                       S01233
     C           BHTV      ANDEQ'V'                                       056004
     C/COPY WNCPYSRC,SE2270C024
     C           STBS      OREQ 'D'                                       E15442
     C           GDPK      ANDEQ'Y'                                       E15442
     C           BHTV      ANDEQ'V'                                       056004
     C/COPY WNCPYSRC,SE2270C015
     C           CSE065    IFNE 'Y'                                                           CSE065
     C           CSE065    OREQ 'Y'                                                           CSE065
     C           STRM      ANDNE'Y'                                                           CSE065
     C           STAD      ANDNE'C'                                                           CSE065
     C           STAD      ANDNE'Y'                                                           CSE065
     C                     EXSR AMORT                                     E15442
     C                     ENDIF                                                              CSE065
     C*                                                                   E31177
     C* If no amortisation, recalculate APNC for realised P/L calculation E31177
     C*                                                                   E31177
     C                     ELSE                                           E31177
     C                     Z-ADDNPSN      ZNOML                           E31177
     C                     Z-ADDLAVP      ZPRC                            E31177
     C                     EXSR ZCNSD                                     E31177
     C                     Z-ADDZCONS     APNC                            E31177
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDNPSN      ZNOML                                               CAS006
     C                     Z-ADDLAVN      ZPRC                                                CAS006
     C                     EXSR ZCNSD                                                         CAS006
     C                     Z-ADDZCONS     APNN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     END                                            E15442
     C/COPY WNCPYSRC,SE2270C025
      *                                                                                       CSE065
      ** Maintain Mark to Market Book Price even after                                        CSE065
      ** Average Life date had passed.                                                        CSE065
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C           STRM      ANDEQ'Y'                                                           CSE065
     C           STAD      IFEQ 'Y'                                                           CSE065
     C           STAD      OREQ 'C'                                                           CSE065
     C                     Z-ADDNPSN      ZNOML                                               CSE065
     C                     Z-ADDNAVP      ZPRC                                                CSE065
     C                     EXSR ZCNSD                                                         CSE065
     C                     Z-ADDZCONS     BKCOST                                              CSE065
     C                     ENDIF                                                              CSE065
     C                     ENDIF                                                              CSE065
     C                     END                                            E15442
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE2270CCP3                                           S01408
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C*                                                                   S01408
     C*
      ***  Produce Realized Profit/Loss Keys if required. (Note: this     E19138
      ***  processing was moved so that the Profit/Loss would reflect     E19138
      ***  the effect of Amortization on the Latest Average Price.)       E19138
      *                                                                   E19138
     C           RPBS      IFEQ 'B'                                       E19138
     C           RPBS      OREQ BHTV                                      E19138
     C                     EXSR REALPL                                    E19138
      *                                                                                       CSE065
      ** Post Book Value Change account keys                                                  CSE065
      *                                                                                       CSE065
     C           CSE065    IFEQ 'Y'                                                           CSE065
     C           STRM      ANDEQ'Y'                                                           CSE065
     C           BHTV      ANDEQ'V'                                                           CSE065
     C           STAD      IFEQ 'Y'                                                           CSE065
     C           STAD      OREQ 'C'                                                           CSE065
     C                     EXSR SRBOKV                                                        CSE065
     C                     ENDIF                                                              CSE065
     C                     END                                                                CSE065
      *                                                                                       CSE065
     C                     END                                            E19138
     C*                                                                   E19138
     C           BHTV      IFEQ 'V'                                       E19138
      *                                                                   E21511
      ***  Zero the Accrued Interest first, for Securities that are       E21511
      ***  not Interest-bearing.                                          E21511
      *                                                                   E21511
     C                     Z-ADD0         CPNA                            E21511
      *                                                                   E21511
     C           PROT      IFEQ '1'
     C           PROT      OREQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C           DYBS      IFNE '4'
     C***********          EXSR ACCRUE                                    E20085
     C***********          EXSR COUPON                                    E20085
     C*                                                                   E20085
     C           MATY      SUB  1         ZECD                            E20085
     C                     EXSR ZLCD                                      E20085
     C                     Z-ADDZZLCD     ZDCSDT                          E20085
     C                     Z-ADDMATY      ZDCEDT                          E20085
     C                     Z-ADDNPSN      ZAMT                            E20085
     C                     Z-ADDMATY      NCD     50                      E20085
     C           PROT      IFNE '6'                                       E37572
     C                     EXSR ZACCZ                                     E20085
     C                     Z-ADDZDCINT    CPNA                            E20085
     C                     ELSE                                           E37572
     C                     Z-ADD0         FCAD   130                      E37572
     C                     CALL 'ZACRFB'                                  E37572
     C                     PARM           ZDCSDT                          E37572
     C                     PARM           ZDCEDT                          E37572
     C                     PARM           BPBA                            E37572
     C                     PARM           SASN                            E37572
     C                     PARM           BPBK                            E37572
     C                     PARM           BPMK                            E37572
     C                     PARM           ZCDP                            E37572
     C                     PARM           #INT   150                      E37572
     C                     PARM           FCAD                            E37572
     C                     Z-ADD#INT      CPNA                            E37572
     C                     END                                            E37572
     C                     END
     C                     END
     C*
     C*  Produce Countervalue keys
     C*
     C                     EXSR CVALUE
     C           *INU7     IFEQ '1'
     C                     GOTO ENDRD
     C                     END
     C*
     C                     END
     C*
     C* UPDATE BOOK POSITION HEADER
     C*
     C                     EXSR U01
     C*
     C* OUTPUT TO MATURED SECURITY POSITIONS EXTRACT
     C*
     C           BHTV      IFEQ 'T'
     C                     Z-ADDNPSN      WCSNT
     C                     Z-ADDWREDPR    SREDPR
     C                     ELSE
     C                     EXSR W02
     C                     END
     C*
     C           ENDRD     TAG                             *** ENDRD  ***
     C                     END
     C*
     C           ENDLP     TAG                             *** ENDLP  ***
     C                     END
     C*
     C* UPDATE BOOK POSITION AUDIT RECORD AND OUTPUT CONTROL REPORT
     C*
     C           EAUDIT    TAG                             *** EAUDIT ***
     C*
     C                     EXSR AUDIT
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C                     SETON                     LR
      *                                                               *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  FIRST  - Subroutine to access ICD Information and to get the *
      *           Event Control Date.                                 *
      *                                                               *
      *****************************************************************
      *
     C           FIRST     BEGSR                           ** FIRST **
     C*
     C* INIT. FIELD  **** MOVED FROM SR W01 ***
     C*
     C                     Z-ADD1         S
     C                     Z-ADD1         Z
     C*
     C* ACCESS ICD
     C*
     C                     EXSR ZSYSTM
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 01 *
     C                     Z-ADD1         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     ELSE
     C*
     C* ACCESS ICD2
     C*
     C                     EXSR ZICD2
     C           *INU7     IFEQ '1'
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *IN99
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELTKEY      DBKEY            * DB ERROR 02 *
     C                     Z-ADD2         DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     ELSE
     C*
     C* ACCESS ZICDSE
     C*
     C                     EXSR ZICDSE
     C           *INU8     IFEQ '1'
     C                     SETON                     99U7
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'TABLE'   DBFILE           ***************
     C                     MOVELTKEY      DBKEY            * DB ERROR 03 *
     C                     Z-ADD03        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     ELSE                                           E19138
     C*                                                                   S01117
     C**  Set up required input parameters for SR.ZEVCD                   S01117
     C**  ZZAPDT - Accrual Profit Date                                    S01117
     C**  ZZDNWD - Date Next Working Day                                  S01117
     C*                                                                   S01117
     C                     Z-ADDAPDA      ZZAPDT                          S01117
     C                     Z-ADDDNWD      ZZDNWD                          S01117
     C*                                                                   S01117
     C                     EXSR ZEVCD                                     E19138
     C                     END
     C                     END
     C                     END
     C*                                                                   055842
     C                     READ TABTB40F                 99               055842
     C           *IN99     IFEQ '1'                                       055842
     C                     MOVE '1'       *INU7                           055842
     C                     MOVE '1'       *INU8                           055842
     C           *LOCK     IN   LDA                        ***************055842
     C                     MOVE 'TABLE'   DBFILE           * DBERR 097   *055842
     C                     Z-ADD97        DBASE            ***************055842
     C                     OUT  LDA                                       055842
     C                     DUMP                                           055842
     C                     END                                            055842
     C*                                                                   CPM004
     C**  Get module details using access object                          CPM004
     C*                                                                   CPM004
     C                     CALL 'AOMMODR0'                                CPM004
     C                     PARM *BLANKS   WLRTCD  7                       CPM004
     C                     PARM '*FIRST'  WLOPTN  7                       CPM004
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPM004
     C*                                                                   CPM004
     C           WLRTCD    IFNE *BLANKS                                   CPM004
     C                     SETON                     99U7U8               CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVEL'SDMMODPD'DBFILE           ***************CPM004
     C                     MOVELWLRTCD    DBKEY            * DB ERROR 98 *CPM004
     C                     Z-ADD98        DBASE            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     DUMP                                           CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C** If Portfolio Management is present, get ICD                      CPM004
     C*                                                                   CPM004
     C           BGPFMG    IFEQ 'Y'                                       CPM004
     C                     CALL 'AOPORTR0'                                CPM004
     C                     PARM *BLANKS   WLRTCD                          CPM004
     C                     PARM '*FIRST'  WLOPTN                          CPM004
     C           SDPORT    PARM SDPORT    DSFDY                           CPM004
     C           WLRTCD    IFNE *BLANKS                                   CPM004
     C                     SETON                     99U7U8               CPM004
     C           *LOCK     IN   LDA                                       CPM004
     C                     MOVEL'SDPORTPD'DBFILE           ***************CPM004
     C                     MOVELWLRTCD    DBKEY            * DB ERROR 99 *CPM004
     C                     Z-ADD99        DBASE            ***************CPM004
     C                     OUT  LDA                                       CPM004
     C                     DUMP                                           CPM004
     C                     END                                            CPM004
     C                     END                                            CPM004
     C/COPY WNCPYSRC,SE2270C003
      *                                                                                       CSE105
      ** Access SAR details file to see if feature CSE105 is installed.                       CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSARDR0'                                                    CSE105
     C                     PARM '       ' @RTCD                                               CSE105
     C                     PARM '*VERIFY' @OPTN                                               CSE105
     C                     PARM 'CSE105'  @SARD                                               CSE105
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE105
      *                                                                                       CSE105
     C           @RTCD     IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'Y'       CSE105  1                                           CSE105
     C                     ELSE                                                               CSE105
     C                     MOVE 'N'       CSE105                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
      ** Check system values if CSE105 is switched on                                         CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
      *                                                                                       CSE105
     C                     CALL 'AOSVALR0'                                                    CSE105
     C                     PARM *BLANKS   @RTCD                                               CSE105
     C                     PARM SVALKK    SVALK1 20                                           CSE105
     C                     PARM           SVAL1 200                                           CSE105
     C                     PARM *BLANK    SVALK2 20                                           CSE105
     C                     PARM           SVAL2 200                                           CSE105
     C                     PARM *BLANK    SVALK3 20                                           CSE105
     C                     PARM           SVAL3 200                                           CSE105
     C                     PARM *BLANK    SVALK4 20                                           CSE105
     C                     PARM           SVAL4 200                                           CSE105
     C                     PARM *BLANK    SVALK5 20                                           CSE105
     C                     PARM           SVAL5 200                                           CSE105
     C                     PARM *BLANK    SVALK6 20                                           CSE105
     C                     PARM           SVAL6 200                                           CSE105
     C                     PARM *BLANK    SVALK7 20                                           CSE105
     C                     PARM           SVAL7 200                                           CSE105
     C                     PARM *BLANK    SVALK8 20                                           CSE105
     C                     PARM           SVAL8 200                                           CSE105
     C                     PARM *BLANK    SVALK9 20                                           CSE105
     C                     PARM           SVAL9 200                                           CSE105
     C                     PARM *BLANK    SVALK0 20                                           CSE105
     C                     PARM           SVAL10200                                           CSE105
      *                                                                                       CSE105
     C           @RTCD     IFNE *BLANKS                                                       CSE105
     C           *LOCK     IN   LDA                                                           CSE105
     C                     MOVE 'SDSVALPD'DBFILE                                              CSE105
     C                     MOVELSVALK1    DBKEY                                               CSE105
     C                     Z-ADD15        DBASE                                               CSE105
     C                     OUT  LDA                                                           CSE105
     C                     EXSR *PSSR                                                         CSE105
     C                     SETON                       U7U8                                   CSE105
     C                     ELSE                                                               CSE105
     C                     MOVELSVAL1     SESVAL  1                                           CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C           SESVAL    IFEQ *BLANKS                                                       CSE105
     C                     MOVE 'V'       SESVAL                                              CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD   7                                           CSE035
     C                     PARM '*VERIFY' @OPTN   7                                           CSE035
     C                     PARM 'CSE035'  @SARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
     C*                                                                   CAC002
     C**  Access Securities Trading details                               CAC002
     C*                                                                   CAC002
     C                     CALL 'AOSTRDR0'                                CAC002
     C                     PARM *BLANKS   WLRTCD                          CAC002
     C                     PARM '*FIRST ' WLOPTN                          CAC002
     C           SDSTRD    PARM SDSTRD    DSSDY                           CAC002
      *                                                                   CAC002
     C           WLRTCD    IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD70        DBASE            ************   CAC002
     C                     MOVEL'SDSTRDPD'DBFILE           * DBERR 70 *   CAC002
     C                     MOVELWLOPTN    DBKEY            ************   CAC002
     C                     OUT  LDA                                       CAC002
     C                     SETON                     U7U8                 CAC002
     C                     DUMP                                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC005
      ** Check if CAC005 is installed                                     CAC005
      *                                                                   CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*VERIFY' POPTN   7                       CAC005
     C                     PARM 'CAC005'  PSARD   6                       CAC005
      *                                                                   CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVE 'Y'       CAC005  1                       CAC005
     C                     ELSE                                           CAC005
     C                     MOVE 'N'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                                       CAS006
      ** Determine if CAS006 (Hedge Accounting Phase B) is installed                          CAS006
      *                                                                                       CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   PRTCD                                               CAS006
     C                     PARM '*VERIFY' POPTN                                               CAS006
     C                     PARM 'CAS006'  PSARD                                               CAS006
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS006
      *                                                                                       CAS006
     C           PRTCD     IFNE *BLANKS                                                       CAS006
     C           PRTCD     ANDNE'*NRF    '                                                    CAS006
     C           *LOCK     IN   LDA                                                           CAS006
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS006
     C                     Z-ADD71        DBASE                                               CAS006
     C                     MOVEL'CAS006'  DBKEY                                               CAS006
     C                     OUT  LDA                                                           CAS006
     C                     MOVE '1'       *INU7                                               CAS006
     C                     MOVE '1'       *INU8                                               CAS006
     C                     MOVE '1'       *INLR                                               CAS006
     C                     EXSR *PSSR                                                         CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           PRTCD     IFEQ *BLANKS                                                       CAS006
     C                     MOVE 'Y'       CAS006  1                                           CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'N'       CAS006                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CSE065
      ** Determine if CSE065 is installed                                                     CSE065
      *                                                                                       CSE065
     C                     CALL 'AOSARDR0'                                                    CSE065
     C                     PARM *BLANKS   PRTCD                                               CSE065
     C                     PARM '*VERIFY' POPTN                                               CSE065
     C                     PARM 'CSE065'  PSARD                                               CSE065
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE065
      *                                                                                       CSE065
     C           PRTCD     IFNE *BLANKS                                                       CSE065
     C           PRTCD     ANDNE'*NRF    '                                                    CSE065
     C           *LOCK     IN   LDA                                                           CSE065
     C                     MOVE 'SCSARDPD'DBFILE                                              CSE065
     C                     Z-ADD72        DBASE                                               CSE065
     C                     MOVEL'CSE065'  DBKEY                                               CSE065
     C                     OUT  LDA                                                           CSE065
     C                     MOVE *ON       *INU7                                               CSE065
     C                     MOVE *ON       *INU8                                               CSE065
     C                     MOVE *ON       *INLR                                               CSE065
     C                     EXSR *PSSR                                                         CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C           PRTCD     IFEQ *BLANKS                                                       CSE065
     C                     MOVE 'Y'       CSE065  1                                           CSE065
     C                     ELSE                                                               CSE065
     C                     MOVE 'N'       CSE065                                              CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CAS006
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
     C/COPY WNCPYSRC,SE2270C016
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  AMORT  - Subroutine to Amortize Discount/Premium.            *
      *                                                               *
      *****************************************************************
      *
     C           AMORT     BEGSR                           **  AMORT **
     C*
     C* DISCOUNT/PREMIUM AMORTISED ONLY IF NOT EQUAL ZERO
     C*
     C           BUDU      IFNE 0
     C*
     C*   - CALCULATE AMORTISED DISC/PREM TO POST
     C*
     C***********BUDU      SUB  DPAP      WADP   130                      E15965
     C                     Z-ADDBUDU      WADP   130                      E15965
      *                                                                   E19138
      ***  SR/AMORT is now called for both 'V' and 'T' records, but       E19138
      ***  Account Keys are required only for Value Date Positions.       E19138
      *                                                                   E19138
     C           BHTV      IFEQ 'V'                                       E19138
     C/COPY WNCPYSRC,SE2270C004
      *                                                                                       CSE105
     C           CSE105    ANDEQ'N'                                                           CSE105
      *                                                                                       CSE105
      ** ...no need to condition to BHTV when CSE105 is installed.                            CSE105
      *                                                                                       CSE105
     C           CSE105    OREQ 'Y'                                                           CSE105
      *                                                                                       CSE105
     C*
     C*   - OUTPUT AMORTISED DISC/PREM KEY
     C*
     C                     MOVE 'A'       EVTP
     C                     MOVE '  '      TRST
     C           NPAC      IFEQ 'N'
     C           NPSN      ORGE 0
     C                     MOVE ' '       NEGI
     C                     ELSE
     C                     MOVE 'N'       NEGI
     C                     END
     C*
     C***********BUDU      IFGT 0                                         E22957
     C           NPSN      IFGT 0                                         E22957
     C           BUDU      ANDGT0                                         E22957
     C           NPSN      ORLT 0                                         E22957
     C           BUDU      ANDLT0                                         E22957
     C                     MOVE 'DA'      AMCD
     C                     ELSE
     C                     MOVE 'PA'      AMCD
     C                     END
     C*
     C**********           Z-ADDWISSR     CSTN                                                CSD027
     C                     MOVE WISSR     CSTN                                                CSD027
     C***********WADP      IFLT 0                                         E22957
     C***********WADP      MULT -1        EVAM                            E22957
     C***********          ELSE                                           E22957
     C                     Z-ADDWADP      EVAM
     C***********          END                                            E22957
     C*
     C************************************************************ E15442 E22957
     C**IF*-*VE*POSITION*AND*NO*'N'*IN*POSITION*15*OF*A/C*KEY***** E15442 E22957
     C**THE*DISCOUNT/PREMIUM*AMORTISED*MUST*HAVE*ITS*SIGN*REVERSED E15442 E22957
     C**(AS*REVERSE*ENTRIES*ARE*REQUIRED*ON*PURCHASES*AND*SALES)** E15442 E22957
     C************************************************************        E22957
     C*                                                                   E22957
     C** - Reverse sign on Premiums, because different key                E22957
     C*                                                                   E22957
     C           AMCD      IFEQ 'PA'                                      E22957
     C                     Z-SUBEVAM      EVAM                            E22957
     C                     END                                            E22957
     C*                                                                   E22957
     C** - Reverse sign, if Negative Position on Key                      E22957
     C*                                                                   E22957
     C*                                                                   E15442
     C           NPSN      IFLT 0
     C***********NPAC      ANDEQ'N'                                       E22957
     C           NPAC      ANDEQ'Y'                                       E22957
     C           EVAM      MULT -1        EVAM
     C                     END
     C*
     C***********EVAM      IFNE 0                                         E22957
     C***********          EXSR W01                                       E22957
     C***********          END                                            E22957
      *                                                                   E19138
      ***  Adjust posting amount by the Mortgage Current Factor.          E22957
      *                                                                   E22957
     C           PROT      IFEQ '8'                                       E22957
     C/COPY WNCPYSRC,SE2270C018
     C**********           MULT AAPR      EVAM                                       E22957 MD054156
     C********** WADP      MULT AAPR      WADPCF 150                                 E22957 MD054156
     C                     MULT SACF      EVAM                                              MD054156
     C           WADP      MULT SACF      WADPCF 150                                        MD054156
     C                     ELSE                                           E22957
     C                     Z-ADDWADP      WADPCF                          E22957
     C                     END                                            E22957
      *                                                                   E22957
      ***  Update Discount/Premium Amortized this month on BKMTHD.        E19138
      ***  (Note: this field is maintained on 'V' records only.)          E19138
      ***  On a long position, Discount is Income, Premium is Expense;    E19138
      ***  On a short position, Premium is Income, Discount is Expense.   E19138
      *                                                                   E19138
     C***********NPSN      IFGT 0                                  E19138 E22957
     C***********          ADD  BUDU      DPTM                     E19138 E22957
     C***********          ELSE                                    E19138 E22957
     C***********          SUB  BUDU      DPTM                     E19138 E22957
     C***********          END                                     E19138 E22957
     C*                                                                   E22957
     C                     Z-ADDWADPCF    DPTM                            E22957
     C/COPY WNCPYSRC,SE2270C005
      *                                                                                       CSE105
      ** If CSE105 is installed and this is a Trade Date Position,                            CSE105
      ** to 'DT' when "discount" or 'PT' when "premium".                                      CSE105
      *                                                                                       CSE105
     C           CSE105    IFEQ 'Y'                                                           CSE105
     C           BHTV      ANDEQ'T'                                                           CSE105
      *                                                                                       CSE105
     C                     SELEC                                                              CSE105
     C           AMCD      WHEQ 'DA'                                                          CSE105
     C                     MOVE 'DT'      AMCD                                                CSE105
     C           AMCD      WHEQ 'PA'                                                          CSE105
     C                     MOVE 'PT'      AMCD                                                CSE105
     C                     ENDSL                                                              CSE105
      *                                                                                       CSE105
     C                     ENDIF                                                              CSE105
      *                                                                                       CSE105
     C*                                                                   E22957
     C           EVAM      IFNE 0                                         E22957
     C                     EXSR W01                                       E22957
     C                     END                                            E22957
      *                                                                   E19138
      ***  - End of processing performed only for 'V' records.            E19138
      *                                                                   E19138
     C                     END                                            E19138
     C*                                                                   CPM004
     C* Portfolio Currency Rate                                           CPM004
     C*                                                                   CPM004
     C           APNC      IFNE *ZERO                                     CPM004
     C           FXAP      DIV  APNC      WFACT  238                      CPM004
     C                     ELSE                                           CPM004
     C                     Z-ADD*ZERO     WFACT                           CPM004
     C                     END                                            CPM004
     C*
     C*  - SET DISC/PREM AMORTISED SINCE LATEST POSN DATE
     C*
     C***********          Z-ADDBUDU      DPAP                            E15965
     C                     ADD  BUDU      DPAP                            E15965
     C                     ADD  BUDU      DPFP                            S01397
      *                                                                   E19138
     C*** Update APNC, with amortised discount/Prem since LPSD            E22957
     C* and Part Payments Posted                                          E29236
     C*                                                                   E22957
     C                     ADD  DPAP      APNC                            E22957
     C                     ADD  BHPP      APNC                            E29236
     C/COPY WNCPYSRC,SE2270C001
     C*                                                            E19138 E22957
      *                                                            E19138 E22957
      *****Update*the*Average*Price*on*the*Book*Position*Header.***E19138 E22957
      *****This*processing*allows*subsequent*Profit/Loss***********E19138 E22957
      *****calculations*to*reflect*Amortization*effects.***********E19138 E22957
      ***********************                                      E19138 E22957
      *****Determine*the*Average*Price*Numerator*for*the*Current***E19138 E22957
      *****Position/Price.*****************************************E19138 E22957
      ***********************                                      E19138 E22957
     C***********                                                  E19138 E20117
     C***********          Z-ADD*ZEROS    APNC0  150               E19138 E20117
     C***********          Z-ADD*ZEROS    APNC1  151               E19138 E20117
     C***********          Z-ADD*ZEROS    APNC2  152               E19138 E20117
     C***********          Z-ADD*ZEROS    APNC3  153               E19138 E20117
     C***********          MOVEA'0000'    *IN,70                   E19138 E20117
     C***********70        ADD  CDP       J       20               E19138 E20117
     C***********          MOVEA'1'       *IN,J                    E19138 E20117
     C***70******NPSN      MULT LAVP      APNC0     H              E19138 E20117
     C***71******NPSN      MULT LAVP      APNC1     H              E19138 E20117
     C***72******NPSN      MULT LAVP      APNC2     H              E19138 E20117
     C***73******NPSN      MULT LAVP      APNC3     H              E19138 E20117
     C***********                                                  E19138 E20117
     C***70******          MOVE APNC0     APNC                     E19138 E20117
     C***71******          MOVE APNC1     APNC                     E19138 E20117
     C***72******          MOVE APNC2     APNC                     E19138 E20117
     C***73******          MOVE APNC3     APNC                     E19138 E20117
     C***********                                                  E19138 E20117
     C**Reformat*amount,*allowing*for*nominal*decimal*places****** E19138 E20117
     C***********                                                  E19138 E20117
     C***********5         SUB  NMDP      DC      10               E19138 E20117
     C***********APNC      MULT POWER8,DC APNC      H              E19138 E20117
     C***********                                                  E19138 E20117
     C**Price*basis*'P'******************************************* E19138 E20117
     C***********                                                  E19138 E20117
     C***********SPBS      IFEQ 'P'                                E19138 E20117
     C***********          DIV  100       APNC                     E19138 E20117
     C***********          END                                     E19138 E20117
     C***********                                                  E19138 E20117
     C*                                                                   E20117
     C**Use*ZNCSD*to*be*consistent*with*SE2220*******              E20117 E22957
     C***********                                                         E22957
     C***********                                                  E20117 E22957
     C***********          Z-ADDNPSN      ZNOML                    E20117 E22957
     C***********          Z-ADDLAVP      ZPRC                     E20117 E22957
     C***********          EXSR ZCNSD                              E20117 E22957
     C***********          Z-ADDZCONS     APNC                     E20117 E22957
      ***********                                                  E19138 E22957
      *****Add*in*the Amortized Discount/Premium and rework the    E19138 E22957
      *****Average*Price.                                          E19138 E22957
      ***********                                                  E19138 E22957
     C***********NPSN      IFGT 0                                  E19138 E22957
     C***********          ADD  WADP      APNC                     E19138 E22957
     C***********          ELSE                                    E19138 E22957
     C***********          SUB  WADP      APNC                     E19138 E22957
     C***********          END                                     E19138 E22957
      ***********                                                  E19138 E22957
     C           NPSN      IFEQ 0                                         E19138
     C                     Z-ADDAPNC      APPB                            E19138
     C                     Z-ADD0         LFXP                            CPM004
     C                     ELSE                                           E19138
     C           APNC      DIV  NPSN      APPB                            E19138
     C           APNC      MULT WFACT     LFXP                            CPM004
     C                     END                                            E19138
      *                                                                   E19138
     C           SPBS      IFEQ 'P'                                       E19138
     C                     MULT 100       APPB                            E19138
     C                     END                                            E19138
      *                                                                   E19138
     C           5         ADD  CDP       DC                              E19138
     C                     SUB  NMDP      DC                              E19138
     C           APPB      DIV  POWER8,DC APPB      H                     E19138
     C                     Z-ADDAPPB      LAVP                            E19138
     C*
     C*  - CALCULATE NEW UNAMORTISED DISC/PREM ON POSITION
     C*
     C                     Z-ADD0         BUDU
     C                     ELSE                                           E29270
     C*                                                                   E29270
     C*** Update APNC, with amortised discount/Prem since LPSD            E29270
     C* and Part Payyments Posted                                         E29270
     C*                                                                   E29270
     C                     ADD  DPAP      APNC                            E29270
     C                     ADD  BHPP      APNC                            E29270
     C*
     C                     END
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
     C           BUDN      IFNE *ZERO                                                         CAS006
     C                     ADD  BUDN      DPAN                                                CAS006
     C                     ADD  DPAN      APNN                                                CAS006
     C                     ADD  BHPP      APNN                                                CAS006
     C           NPSN      IFEQ *ZERO                                                         CAS006
     C                     Z-ADDAPNN      APPN                                                CAS006
     C                     ELSE                                                               CAS006
     C           APNN      DIV  NPSN      APPN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           SPBS      IFEQ 'P'                                                           CAS006
     C                     MULT 100       APPN                                                CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           CDP       ADD  5         DC                                                  CAS006
     C                     SUB  NMDP      DC                                                  CAS006
     C           APPN      DIV  POWER8,DC APPN      H                                         CAS006
     C                     Z-ADDAPPN      LAVN                                                CAS006
     C                     Z-ADD*ZERO     BUDN                                                CAS006
      *                                                                                       CAS006
     C                     ELSE                                                               CAS006
     C                     ADD  DPAN      APNN                                                CAS006
     C                     ADD  BHPP      APNN                                                CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C*
     C/COPY WNCPYSRC,SE2270C002
     C                     ENDSR
      *
      *****************************************************************
     C/COPY WNCPYSRC,SE2270C026
      /EJECT
      *****************************************************************
      *                                                               *
      *  FVAL   - Subroutine to Produce Face Value Keys.              *
      *                                                               *
      *****************************************************************
      *
     C           FVAL      BEGSR                           **  FVAL **
     C*
     C* CALCULATE FACE VALUE
     C*
     C                     Z-ADDNPSN      WFVAL  130
     C           PPDI      IFEQ 'Y'
     C           SFPP      ANDNECPDP
     C                     MOVE CPDP      CPDP3   53
     C           WFVAL     MULT CPDP3     WFVAL     H
     C                     END
     C*
     C*  Apply Current Factor for Mortgage Backed Securities
     C*
     C           PROT      IFEQ '8'
     C           WFVAL     MULT CFCT      WFVAL     H
     C                     END
     C/COPY WNCPYSRC,SE2270C008
     C*
     C                     MOVE 'M'       EVTP
     C                     MOVE '  '      TRST
     C*
     C           NPSN      IFGE 0
     C           NPAC      OREQ 'N'
     C                     MOVE ' '       NEGI
     C                     ELSE
     C                     MOVE 'N'       NEGI
     C                     END
     C*
     C           NPAC      IFEQ 'Y'                                       E13817
     C           NPSN      ANDLT0
     C           WFVAL     MULT -1        EVAM
     C                     ELSE
     C                     Z-ADDWFVAL     EVAM
     C                     END
     C*
     C                     MOVE 'FV'      AMCD
     C**********           Z-ADDWISSR     CSTN                                                CSD027
     C                     MOVE WISSR     CSTN                                                CSD027
     C                     MOVE '0'       RVRS
     C*                                                                   E13817
     C           5         SUB  NMDP      DC      10                      E13817
     C***********          ADD  CDP       DC                       E13817 E24106
     C                     ADD  ZCDP      DC                              E24106
     C                     MULT POWER8,DC EVAM                            E13817
     C*
     C           EVAM      IFNE 0
     C                     EXSR W01
     C                     END
     C/COPY WNCPYSRC,SE2270C013
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
     C/COPY WNCPYSRC,SE2270C011
      *****************************************************************
      *                                                               *
      *  CONS   - Subroutine to Produce Consideration Keys.           *
      *                                                               *
      *****************************************************************
      *
     C           CONS      BEGSR                           **  CONS **
     C*
     C* CALCULATE CONSIDERATION AMOUNT
     C*
     C                     Z-ADD*ZEROS    WCONS  150                      E19138
     C***********          Z-ADD*ZEROS    WCONS0 150               E19138 E20117
     C***********          Z-ADD*ZEROS    WCONS1 151               E19138 E20117
     C***********          Z-ADD*ZEROS    WCONS2 152               E19138 E20117
     C***********          Z-ADD*ZEROS    WCONS3 153               E19138 E20117
     C***********          MOVEA'0000'    *IN,70                   E19138 E20117
     C***********70        ADD  CDP       J       20               E19138 E20117
     C***********          MOVEA'1'       *IN,J                    E19138 E20117
     C***********                                                  E19138 E20117
     C***70******NPSN      MULT LAVP      WCONS0    H              E19138 E20117
     C***71******NPSN      MULT LAVP      WCONS1    H              E19138 E20117
     C***72******NPSN      MULT LAVP      WCONS2    H              E19138 E20117
     C***73******NPSN      MULT LAVP      WCONS3    H              E19138 E20117
     C***********                                                  E19138 E20117
     C***70******          MOVE WCONS0    WCONS                    E19138 E20117
     C***71******          MOVE WCONS1    WCONS                    E19138 E20117
     C***72******          MOVE WCONS2    WCONS                    E19138 E20117
     C***73******          MOVE WCONS3    WCONS                    E19138 E20117
     C***********                                                  E19138 E20117
     C**Convert*event amount for Nominal Dec Places                E19138 E20117
     C***********5         SUB  NMDP      DC                       E19138 E20117
     C***********          ADD  CDP       DC                       E20085 E20117
     C***********WCONS     MULT POWER8,DC WCONS     H              E19138 E20117
     C***********                                                  E19138 E20117
     C**If*Price*Basis 'P', divide by 100                          E19138 E20117
     C***********                                                  E19138 E20117
     C***********SPBS      IFEQ 'P'                                E19138 E20117
     C***********WCONS     DIV  100       WCONS     H              E19138 E20117
     C***********          END                                     E19138 E20117
     C***********                                                  E19138 E20117
     C*                                                                   E20117
     C* Use ZNCSD to be consistent with SE2220                            E20117
     C*                                                                   E20117
     C                     Z-ADDNPSN      ZNOML                           E20117
     C                     Z-ADDLAVP      ZPRC                            E20117
     C                     EXSR ZCNSD                                     E20117
     C                     Z-ADDZCONS     WCONS                           E20117
     C*                                                                   E20117
     C           PROT      IFEQ '8'                                       E19138
     C/COPY WNCPYSRC,SE2270C019
     C           WCONS     MULT CFCT      WCONS     H                     E19138
     C                     END                                            E19138
     C/COPY WNCPYSRC,SE2270C009
     C*                                                                   E19138
     C***********WFVAL     MULT LAVP      WCONS  130H                     E19138
     C*
     C                     MOVE 'M'       EVTP
     C                     MOVE '  '      TRST
     C*
     C           NPSN      IFGE 0
     C           NPAC      OREQ 'N'
     C                     MOVE ' '       NEGI
     C                     ELSE
     C                     MOVE 'N'       NEGI
     C                     END
     C*
     C           NPAC      IFEQ 'Y'                                       E13817
     C           NPSN      ANDLT0
     C           WCONS     MULT -1        EVAM
     C                     ELSE
     C                     Z-ADDWCONS     EVAM
     C                     END
     C*
     C                     MOVE 'CO'      AMCD
     C**********           Z-ADDWISSR     CSTN                                                CSD027
     C                     MOVE WISSR     CSTN                                                CSD027
     C                     MOVE '0'       RVRS
     C*
     C           EVAM      IFNE 0
     C                     EXSR W01
     C                     END
     C/COPY WNCPYSRC,SE2270C014
     C*
     C                     ENDSR
      *
     C/COPY WNCPYSRC,SE2270C012
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  REALPL - Subroutine to Produce Realized Profit and Loss Keys.*
      *                                                               *
      *****************************************************************
      *
     C           REALPL    BEGSR                           **  REALPL **
     C*
     C**CONVERT*MARKET*PRICE*FROM*PRICE/DISC/YIELD*FORMAT*TO*PRICE******  E22957
     C***FORMAT*********************************************************  E22957
     C***********                                                         E22957
     C***********          Z-ADDRUND      ZFDATE                   E15965 E22957
     C***********          Z-ADDECD       ZFDATE                   E15965 E22957
     C***********          Z-ADDWREDPR    ZPRCIN                          E22957
     C***********                                                  S01232 E22957
     C*****SET*UP PARAMETERS FOR AUSTRALIAN YIELD SECURITIES       S01232 E22957
     C***********                                                  S01232 E22957
     C************IN52     IFEQ '1'                                S01232 E22957
     C***********NPSN      ANDNE0                                  S01232 E22957
     C***********                                                  E20953 E22957
     C**set*nominal to positive for calculation purposes           E20953 E22957
     C***********                                                  E20953 E22957
     C***********NPSN      IFLT 0                                  E20953 E22957
     C***********          Z-SUBNPSN      WNOML  130               E20953 E22957
     C***********          ELSE                                    E20953 E22957
     C***********          Z-ADDNPSN      WNOML                    E20953 E22957
     C***********          END                                     E20953 E22957
     C***********                                                  E20953 E22957
     C**Determine if period Cum. or Ex                             E20953 E22957
     C***********                                                  E20953 E22957
     C***********          Z-ADDECD       WRKD    50               E20953 E22957
     C***********          EXSR ZYCE                               E20953 E22957
     C***********                                                  E20953 E22957
     C**Calculate interest for Cum period (SCUMEX = C)             E20953 E22957
     C***********                                                  E20953 E22957
     C***********SCUMEX    IFEQ 'C'                                E20953 E22957
     C***********          Z-ADDLCPN      ZDCSDT                   S01232 E22957
     C***********          Z-ADDECD       ZDCEDT                   S01232 E22957
     C***********          Z-ADDNPSN      ZAMT                     S01232 E20953
     C***********          Z-ADDWNOML     ZAMT                     E20953 E22957
     C***********          EXSR ZACCZ                              S01232 E22957
     C***********          Z-ADDZDCINT    TOTACC 150               E20953 E22957
     C***********ZDCINT    DIV  NPSN      WRKPI                    S01232 E20953
     C***********          Z-ADDECD       WRKD    50               S01232 E20953
     C***********          EXSR ZYCE                               S01232 E20953
     C***********                                                  E20953 E22957
     C**Calculate the Accrued Interest on the Ex-Coupon Nominal    E20953 E22957
     C***********                                                  E20953 E22957
     C***********ECNP      IFEQ 0                                  E20953 E22957
     C***********          Z-ADD0         WTCPN  150               E20953 E22957
     C***********          ELSE                                    E20953 E22957
     C***********          Z-ADDLCPN      ZDCSDT                   E20953 E22957
     C***********          Z-ADDNCD       ZDCEDT                   E20953 E22957
     C***********ECNP      IFLT 0                                  E20953 E22957
     C***********          Z-SUBECNP      ZAMT                     E20953 E22957
     C***********          ELSE                                    E20953 E22957
     C***********          Z-ADDECNP      ZAMT                     E20953 E22957
     C***********          END                                     E20953 E22957
     C***********          EXSR ZACCZ                              E20953 E22957
     C***********          Z-ADDZDCINT    WTCPN                    E20953 E22957
     C***********          END                                     E20953 E22957
     C***********                                                  E20953 E22957
     C***********TOTACC    SUB  WTCPN     WRKPIX 130               E20953 E22957
     C***********WRKPIX    IFLE 0                                  E20953 E22957
     C***********          MOVE 'X'       SCUMEX                   E20953 E22957
     C***********          END                                     E20953 E22957
     C***********                                                  E20953 E22957
     C***********          END                                     E20953 E22957
     C***********                                                  S01232 E22957
     C***********IF EX-COUPON THEN PI PASSED IS THE REMAINING INTEREST232 E22957
     C***********TILL NCD AND IS NEGATIVE                          S01232 E22957
     C***********                                                  S01232 E22957
     C***********SCUMEX    IFEQ 'X'                                S01232 E22957
     C***********          Z-ADDLCPN      ZDCSDT                   S01232 E22957
     C***********          Z-ADDNCD       ZDCEDT                   S01232 E22957
     C***********          Z-ADDWNOML     ZAMT                     E20953 E22957
     C***********          EXSR ZACCZ                              S01232 E22957
     C***********          Z-ADDZDCINT    NCDWRK 130               E20953 E22957
     C***********ZDCINT    DIV  NPSN      WKWPI  159               S01232 E20953
     C***********WRKPI     SUB  WKWPI     WRKPI                    S01232 E20953
     C***********                                                  E20953 E22957
     C**Calculate interest to Next Coupon Date                     E20953 E22957
     C***********                                                  E20953 E22957
     C***********          Z-ADDLCPN      ZDCSDT                   E20953 E22957
     C***********          Z-ADDECD       ZDCEDT                   E20953 E22957
     C***********          EXSR ZACCZ                              E20953 E22957
     C***********          Z-ADDZDCINT    LCDWRK 130               E20953 E22957
     C***********                                                  E20953 E22957
     C***********LCDWRK    SUB  NCDWRK    WRKPIX                   E20953 E22957
     C***********                                                  E20953 E22957
     C***********          END                                     E20953 E22957
     C***********                                                  E20953 E22957
     C**Show*interest figure as percentage                         E20953 E22957
     C***********                                                  E20953 E22957
     C***********WRKPIX    DIV  WNOML     WRKPI                    E20953 E22957
     C***********                                                  E20953 E22957
     C***********          END                                     S01232 E20953
     C***********          ELSE                                    S01232 E22957
     C***********          Z-ADD0         WRKPI                    S01232 E22957
     C***********          MOVE 'C'       SCUMEX                   S01232 E22957
     C***********          END                                     S01232 E22957
     C***********                                                  S01232 E22957
     C***********          EXSR ZPRCI                                     E22957
     C***********                                                         E22957
     C**CALCULATE REALISED P/L                                            E22957
     C***********                                                         E22957
     C***********ZPRCOT    SUB  LAVP      WPRICE 158                      E20085
     C***********WREDPR    SUB  LAVP      WPRICE 158               E20085 E22957
     C***********          Z-ADD*ZEROS    WPRLS0 150               E19138 E20117
     C***********          Z-ADD*ZEROS    WPRLS1 151               E19138 E20117
     C***********          Z-ADD*ZEROS    WPRLS2 152               E19138 E20117
     C***********          Z-ADD*ZEROS    WPRLS3 153               E19138 E20117
     C***********          MOVEA'0000'    *IN,70                   E19138 E20117
     C***********70        ADD  CDP       J       20               E19138 E20117
     C***********          MOVEA'1'       *IN,J                    E19138 E20117
     C***70******NPSN      MULT WPRICE    WPRLS0    H              E19138 E20117
     C***71******NPSN      MULT WPRICE    WPRLS1    H              E19138 E20117
     C***72******NPSN      MULT WPRICE    WPRLS2    H              E19138 E20117
     C***73******NPSN      MULT WPRICE    WPRLS3    H              E19138 E20117
     C***********                                                  E19138 E20117
     C***70******          MOVE WPRLS0    WPRLS  150               E19138 E20117
     C***71******          MOVE WPRLS1    WPRLS                    E19138 E20117
     C***72******          MOVE WPRLS2    WPRLS                    E19138 E20117
     C***73******          MOVE WPRLS3    WPRLS                    E19138 E20117
     C**Convert*Realised P/L Amount                                E19138 E20117
     C***********                                                  E19138 E20117
     C***********5         SUB  NMDP      DC      10               E19138 E20117
     C***********          ADD  CDP       DC                       E20085 E20117
     C***********WPRLS     MULT POWER8,DC WPRLS     H              E19138 E20117
     C***********                                                  E19138 E20117
     C**If*Price*Basis 'P', divide by 100                          E19138 E20117
     C***********                                                  E19138 E20117
     C***********SPBS      IFEQ 'P'                                E19138 E20117
     C***********WPRLS     DIV  100       WPRLS     H              E19138 E20117
     C***********          END                                     E19138 E20117
     C***********                                                  E19138 E20117
     C*                                                                   E20117
     C* Use ZCNSD to be consistent with SE2220                            E20117
     C*                                                                   E20117
     C                     Z-ADDNPSN      ZNOML                           E20117
     C***********          Z-ADDWPRICE    ZPRC                     E20117 E22957
     C                     Z-ADDWREDPR    ZPRC                     E20117 E22957
     C                     EXSR ZCNSD                                     E20117
     C***********          Z-ADDZCONS     WPRLS  150               E20117 E22957
     C                     Z-ADDZCONS     BKVAL  150               E20117 E22957
     C*                                                                   E22957
     C           BKVAL     SUB  APNC      WPRLS  150                      E22957
     C*                                                                   E20117
     C           PROT      IFEQ '8'                                       E19138
     C           WPRLS     MULT CFCT      WPRLS     H                     E19138
     C                     END                                            E19138
     C                     Z-ADDWPRLS     EVAM                            E22957
     C*                                                                   E19138
     C**IF*POSITION*<0*,THEN*MARKET*PRICE>AV.PRICE*GIVES*A*REALIZED*LOSS* E22957
     C***********                                                  E19138 E22957
     C***********NPSN      IFLT 0                                  E19138 E22957
     C***********NPSN      MULT WPRICE    WTOT   154H                     E19138
     C***********WPRLS     MULT -1        EVAM                     E19138 E22957
     C***********          ELSE                                    E19138 E22957
     C***********          Z-ADDWPRLS     EVAM                     E19138 E22957
     C***********          END                                     E19138 E22957
     C***********                                                  E19138 E22957
     C***********          Z-ADDWTOT      EVAM      H                     E19138
     C*
     C* UPDATE REALISED P/L THIS MONTH
     C*
     C           EVAM      ADD  RPTM      RPTM
     C*
     C**WRITE*REALISED*P/L*KEY************                                E22957
     C* WRITE REALISED P/L KEY UNLESS ENTRY IS TO BE SUPPRESSED           E22957
     C*                                                                   E22957
     C           BHTV      IFNE SKTD                                      E22957
     C*
     C                     MOVE BHTV      EVTP
     C/COPY WNCPYSRC,SE2270C021
      ** Apply part of 066616 which sets event type on RP                                     CSE091
      ** and RL keys at maturity to 'M'.                                                      CSE091
      *                                                                                       CSE091
      ** Access CAR details file to determine if feature is installed                         CSE091
      *                                                                                       CSE091
     C                     CALL 'AOSARDR0'                                                    CSE091
     C                     PARM *BLANKS   @RTCD   7                                           CSE091
     C                     PARM '*VERIFY' @OPTN   7                                           CSE091
     C                     PARM 'CSE091'  @SARD   6                                           CSE091
     C           SCSARD    PARM *BLANKS   DSFDY                                               CSE091
      *                                                                                       CSE091
     C           @RTCD     IFEQ *BLANKS                                                       CSE091
     C                     MOVEL'Y'       CSE091  1                                           CSE091
     C                     ELSE                                                               CSE091
     C                     MOVEL'N'       CSE091                                              CSE091
     C                     ENDIF                                                              CSE091
      *                                                                                       CSE091
      **  If CSE091 is ON                                                                     CSE091
      *                                                                                       CSE091
     C           CSE091    IFEQ 'Y'                                                           CSE091
      ** Clear Event Type field and reset to 'M'.                                             CSE091
      *                                                                                       CSE091
     C                     MOVE *BLANKS   EVTP                                                CSE091
     C                     MOVE 'M'       EVTP                                                CSE091
      *                                                                                       CSE091
     C                     ENDIF                                                              CSE091
      *                                                                                       CSE091
     C                     MOVE '  '      TRST
     C           NPAC      IFEQ 'Y'                                       E13817
     C           NPSN      ANDLT0                                         E13817
     C                     MOVE 'N'       NEGI                            E13817
     C                     ELSE                                           E13817
     C                     MOVE ' '       NEGI                            E13817
     C                     END                                            E13817
     C*                                                                   E13817
     C           EVAM      IFGT 0
     C                     MOVE 'RP'      AMCD
     C                     ELSE
     C                     MOVE 'RL'      AMCD
     C           EVAM      MULT -1        EVAM
     C                     END
     C*
     C           EVAM      IFNE 0
     C                     EXSR W01
     C                     END
     C                     END                                            E22957
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  UNRLPL - Subroutine to Produce Unrealized P/L Keys.          *
      *                                                               *
      *****************************************************************
      *
     C           UNRLPL    BEGSR                           **  UNRLPL **
     C*
     C**UNREALISED*P/L*IS*SET*TO*ZERO*OF*MARKET*PRICE*IS*ZERO**********   E19138
     C***********                                                         E19138
     C***********MKPR      IFEQ 0                                         E19138
     C***********          Z-ADD0         UPPT                            E19138
     C***********          ELSE                                           E19138
     C*
     C* STORE UNREALISED P/L AS PREVIOUS
     C*
     C                     Z-ADDUPPT      PUPPT  130
     C*
     C**CONVERT*MARKET*PRICE*FROM*PRICE/DISC/YIELD*FORMAT*TO*PRICE*****   E19138
     C***FORMAT********************************************************   E19138
     C***********                                                         E19138
     C***********          Z-ADDRUND      ZFDATE                          E15965
     C***********          Z-ADDECD       ZFDATE                   E15965 E19138
     C***********          Z-ADDWREDPR    ZPRCIN                          E19138
     C***********          EXSR ZPRCI                                     E19138
     C***********                                                         E19138
     C***CALCULATE*PRICE*DIFFERENCE************************************   E19138
     C***********                                                         E19138
     C***********ZPRCOT    SUB  LAVP      WPRICE                          E19138
     C*
     C* OBTAIN NEW UNREALISED P/L
     C* (IT IS ZERO AS THE POSITION EFFECTIVELY BECOMES ZERO AT MATURITY) E19138
     C*
     C                     Z-ADD*ZERO     UPPT                            E19138
     C*                                                                   E19138
     C***********NPSN      MULT WPRICE    WTOT      H                     E19138
     C***********          Z-ADDWTOT      UPPT      H                     E19138
     C***********                                                         E19138
     C***********SPBS      IFEQ 'P'                                       E19138
     C***********UPPT      DIV  100       UPPT      H                     E19138
     C***********          END                                            E19138
     C***********PROT      IFEQ '8'                                       E19138
     C***********UPPT      MULT CFCT      WTOT      H                     E19138
     C***********          Z-ADDWTOT      UPPT      H                     E19138
     C***********          END                                            E19138
     C*
     C* SET COMMON FIELDS FOR ACCOUNT KEYS
     C*
     C                     MOVE 'A'       EVTP
     C                     MOVE BHTV      PSBS
     C                     MOVE ' '       FILL
     C*
     C**SET*INDICATOR*FOR*NEW*AND*PREVIOUS*UNREALISED*P/L**************   E19138
     C***********                                                         E19138
     C***********UPPT      IFLE 0                                         E19138
     C***********PUPPT     ANDLE0                                         E19138
     C***********          MOVE '1'       *IN15                           E19138
     C***********          ELSE                                           E19138
     C***********UPPT      IFGE 0                                         E19138
     C***********PUPPT     ANDGE0                                         E19138
     C***********          MOVE '1'       *IN15                           E19138
     C***********          END                                            E19138
     C***********          END                                            E19138
     C*
     C* PRODUCE ACCOUNT KEYS IF NEW UNREALISED P/L GREATER THAN 0
     C*  AND POSTING BASIS IS NOT 'L' OR NEW UNREALISED P/L IS LESS THAN
     C*  ZER0 AND PROFIT POSTING IS NOT 'P'
     C*
     C***********UPPT      IFGT 0                                         E19138
     C***********UPPS      ANDNE'L'                                       E19138
     C***********          GOTO UNRLKY                                    E19138
     C***********          ELSE                                           E19138
     C***********UPPT      IFLT 0                                         E19138
     C***********UPPS      ANDNE'P'                                       E19138
     C***********          GOTO UNRLKY                                    E19138
     C***********          ELSE                                           E19138
     C           PUPPT     IFGT 0                                         E15965
     C           UPPS      ANDNE'L'                                       E15965
     C                     GOTO UNRLKY                                    E15965
     C                     END                                            E15965
     C           PUPPT     IFLT 0                                         E15965
     C           UPPS      ANDNE'P'                                       E15965
     C                     GOTO UNRLKY                                    E15965
     C                     END                                            E15965
     C                     GOTO EURLPL
     C***********          END                                            E19138
     C***********          END                                            E19138
     C*
     C           UNRLKY    TAG
     C*
     C***-**PRODUCE*ONE*KEY*IF*PREVIOUS*AND*NEW*UNREAL.*P/L*BOTH*LESS**   E19138
     C*******THAN*OR*BOTH GREATER THAN 0                                  E19138
     C***********                                                         E19138
     C************IN15     IFEQ '1'                                       E19138
     C***********                                                         E19138
     C***********UPPT      IFGT 0                                         E19138
     C***********          MOVE 'UP'      AMCD                            E19138
     C***********          ELSE                                           E19138
     C***********          MOVE 'UL'      AMCD                            E19138
     C***********          END                                            E19138
     C***********                                                         E19138
     C***********UPPT      SUB  PUPPT     EVAM                            E19138
     C***********EVAM      IFLT 0                                         E19138
     C***********EVAM      MULT -1        EVAM                            E19138
     C***********          END                                            E19138
     C***********                                                         E19138
     C***********EVAM      IFNE 0                                         E19138
     C***********          EXSR W01                                       E19138
     C***********          END                                            E19138
     C***********                                                         E19138
     C***ELSE*PRODUCE*TWO*KEYS*IF*TRADE*MOVES*FROM*PROFIT*TO*LOSS*OR***   E19138
     C***FROM*LOSS*TO*PROFIT*******************************************   E19138
     C***********                                                         E19138
     C***********          ELSE                                           E19138
     C*
     C*  -  PRODUCE REVERSAL KEY FOR UNRL P/L
     C*
     C           PUPPT     IFGT 0
     C                     MOVE 'UP'      AMCD
     C                     ELSE
     C                     MOVE 'UL'      AMCD
     C                     END
     C*
     C           PUPPT     IFGT 0
     C           PUPPT     MULT -1        EVAM
     C                     ELSE
     C                     Z-ADDPUPPT     EVAM
     C                     END
     C*
     C           EVAM      IFNE 0
     C                     EXSR W01
     C                     END
     C*
     C                     Z-ADD0         UPPT                            E20085
     C*
     C***-**PRODUCE**KEY*FOR*NEW*UNRL.*P/L*****************************   E19138
     C***********                                                         E19138
     C***********UPPT      IFGT 0                                         E19138
     C***********          MOVE 'UP'      AMCD                            E19138
     C***********          ELSE                                           E19138
     C***********          MOVE 'UL'      AMCD                            E19138
     C***********          END                                            E19138
     C***********                                                         E19138
     C***********          Z-ADDUPPT      EVAM                            E19138
     C***********UPPT      IFLT 0                                         E19138
     C***********EVAM      MULT -1        EVAM                            E19138
     C***********          END                                            E19138
     C***********                                                         E19138
     C***********EVAM      IFNE 0                                         E19138
     C***********          EXSR W01                                       E19138
     C***********          END                                            E19138
     C***********                                                         E19138
     C***********          END                                            E19138
     C***********          END                                            E19138
     C*
     C           EURLPL    ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CVALUE - Subroutine to Produce Countervalue Keys.            *
      *                                                               *
      *****************************************************************
      *
     C           CVALUE    BEGSR
     C*
     C* CALCULATE COUNTERVALUE
     C*
     C***********          Z-ADD*ZEROS    WCONS0 150                      E20117
     C***********          Z-ADD*ZEROS    WCONS1 151                      E20117
     C***********          Z-ADD*ZEROS    WCONS2 152                      E20117
     C***********          Z-ADD*ZEROS    WCONS3 153                      E20117
     C***********          MOVEA'0000'    *IN,70                          E20117
     C***********70        ADD  CDP       J       20                      E20117
     C***********          MOVEA'1'       *IN,J                           E20117
     C***********                                                         E20117
     C***70******NPSN      MULT WREDPR    WCONS0    H              E19138 E20117
     C***71******NPSN      MULT WREDPR    WCONS1    H              E19138 E20117
     C***72******NPSN      MULT WREDPR    WCONS2    H              E19138 E20117
     C***73******NPSN      MULT WREDPR    WCONS3    H              E19138 E20117
     C***********                                                  E19138 E20117
     C***70******          MOVE WCONS0    WCVAL                    E19138 E20117
     C***71******          MOVE WCONS1    WCVAL                    E19138 E20117
     C***72******          MOVE WCONS2    WCVAL                    E19138 E20117
     C***73******          MOVE WCONS3    WCVAL                    E19138 E20117
     C***********                                                  E19138 E20117
     C**Convert*event amount for Nominal Dec Places                E19138 E20117
     C***********5         SUB  NMDP      DC                       E19138 E20117
     C***********WCVAL     MULT POWER8,DC WCVAL  150H              E19138 E20117
     C***********                                                  E19138 E20117
     C**If*Price*Basis 'P', divide by 100                          E19138 E20117
     C***********                                                  E19138 E20117
     C***********SPBS      IFEQ 'P'                                E19138 E20117
     C***********WCVAL     DIV  100       WCVAL     H              E19138 E20117
     C***********          END                                     E19138 E20117
     C*                                                                   E20117
     C* Use ZNCSD to be consistent with SE2220                            E20117
     C*                                                                   E20117
     C                     Z-ADDNPSN      ZNOML                           E20117
     C                     Z-ADDWREDPR    ZPRC                            E20117
     C                     EXSR ZCNSD                                     E20117
     C                     Z-ADDZCONS     WCVAL  150                      E20117
     C*                                                                   E20117
     C           PROT      IFEQ '8'                                       E19138
     C/COPY WNCPYSRC,SE2270C020
     C           WCVAL     MULT CFCT      WCVAL     H                     E19138
     C                     END                                            E19138
     C/COPY WNCPYSRC,SE2270C010
     C*                                                                   E19138
     C***70******          MOVE WFVAL     WCONS0                          E19138
     C***71******          MOVE WFVAL     WCONS1                          E19138
     C***72******          MOVE WFVAL     WCONS2                          E19138
     C***73******          MOVE WFVAL     WCONS3                          E19138
     C***********                                                         E19138
     C************IN10     IFEQ '1'                                       E14889
     C***70******WCONS0    MULT WREDPR    WCVAL  130H                     E19138
     C***71******WCONS1    MULT WREDPR    WCVAL  130H                     E19138
     C***72******WCONS2    MULT WREDPR    WCVAL  130H                     E19138
     C***73******WCONS3    MULT WREDPR    WCVAL  130H                     E19138
     C***********          ELSE                                           E14889
     C***70******          Z-ADDWCONS0    WCVAL                           E14889
     C***71******          Z-ADDWCONS1    WCVAL                           E14889
     C***72******          Z-ADDWCONS2    WCVAL                           E14889
     C***73******          Z-ADDWCONS3    WCVAL                           E14889
     C***********          END                                            E14889
     C***********                                                         E20085
     C**IF*COUPON*KEYS*WERE*PRODUCED*ON*THIS*POSITION*-****************   E20085
     C******ADD*INTEREST*DUE*TO*COUNTERVALUE***************************   E20085
     C***********                                                         E20085
     C************IN20     IFEQ '1'                                       E20085
     C***********WINTD     ADD  WCVAL     WCVAL                           E20085
     C***********          END                                            E20085
     C*
     C* IF COUNTERVALUE IS 0 - NO KEYS PRODUCED
     C*
     C           WCVAL     IFEQ 0
     C                     GOTO ECVAL
     C                     END
     C*
     C* IF EITHER VALUE OR PAYMENT CURRENCY NOT EQ NOMINAL CURRENCY
     C*    THEN CONVERT COUNTERVALUE TO VALUE/PAYMENT CURRENCY
     C*
     C           VLCY      IFNE *BLANKS
     C                     MOVE VLCY      CCCY    3
     C                     ELSE
     C                     MOVE SPYC      CCCY
     C                     END
     C           CCCY      IFNE WNMCY
     C                     MOVE SMDI      ZMD
     C                     Z-ADDSEXR      ZEXCH
     C                     MOVE WNMCY     ZCCYI
     C                     MOVE CCCY      ZCCYO
     C                     Z-ADDWCVAL     ZAMTCI
     C*                                                                   S01117
     C** Obtain Output Currency Decimal Places parameter for SR.ZCONV     S01117
     C*                                                                   S01117
     C                     MOVE CCCY      WKCCY   3                       S01117
     C                     EXSR TABCHN                                    S01117
     C           *INU7     IFEQ '1'                                       S01117
     C                     GOTO ECVAL                                     S01117
     C                     END                                            S01117
     C                     Z-ADDCDP       ZCDPO                           S01117
     C*                                                                   S01117
     C                     EXSR ZCONV
     C************INU7     IFEQ '1'                                       S01117
     C***********          MOVE '1'       *INU8                           S01117
     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
     C***********          MOVELTKEY      DBKEY            * DB ERROR 04 *S01117
     C***********          Z-ADD04        DBASE            ***************S01117
     C***********          GOTO ECVAL                                     S01117
     C***********          END                                            S01117
     C                     Z-ADDZAMTCO    WCVAL
     C                     END
     C*
     C* OUTPUT COUNTERVALUE KEY
     C*
     C                     MOVE 'M'       EVTP
     C                     MOVE '  '      TRST
     C*
     C                     MOVE 'CV'      AMCD
     C           NPSN      IFGE 0
     C           NPAC      OREQ 'N'
     C                     MOVE ' '       NEGI
     C                     ELSE
     C                     MOVE 'N'       NEGI
     C                     END
     C*
     C           NPAC      IFEQ 'Y'                                       E13817
     C           NPSN      ANDLT0
     C           WCVAL     MULT -1        EVAM
     C                     ELSE
     C                     Z-ADDWCVAL     EVAM
     C                     END
     C*
     C           EVAM      IFNE 0
     C                     EXSR W01
     C                     END
     C*
     C           ECVAL     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  W01    - Subroutine to Output Account Keys.                  *
      *                                                               *
      *****************************************************************
      *
     C           W01       BEGSR                           **  W01 **
     C*
     C* SET UP ALL FIELDS NOT PASSED FROM PROCESSES
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE ' '       TRTP
     C                     MOVE ' '       PORT
     C                     MOVE ' '       CHGT
     C           CIAK      IFEQ 'Y'
     C           SCVI      ANDEQ'Y'                                       E14522
     C                     MOVE SCVI      CNVI
     C                     ELSE                                           E14522
     C                     MOVE *BLANK    CNVI                            E14522
     C                     END
     C*
     C                     MOVE BHBK      BOOK
     C                     MOVE BHMK      MRKT
     C                     MOVE *ZEROS    TRFR
     C**********           Z-ADDWISSR     CSTN                                                CSD027
     C                     MOVE WISSR     CSTN                                                CSD027
     C***********          MOVE BHBR      BRCH                            S01117
     C                     MOVE BHBA      BRHA                            S01117
     C                     MOVE SITP      IVTP
     C***********          MOVE '01'      ASQN                            E18803
     C                     MOVE '00'      ASQN                            E18803
     C                     Z-ADDMATY      EVDT
     C                     MOVE WNMCY     EVCY
     C*                                                                   E23517
     C           AMCD      IFEQ 'CV'                                      E23517
     C           WNMCY     ANDNECCCY                                      E23517
     C                     MOVE CCCY      EVCY                            E23517
     C                     END                                            E23517
     C*                                                                   E23517
     C                     MOVE BHSC      SESH
     C***********          MOVE ' '       RVRS                            E14721
     C                     MOVE '0'       RVRS                            E14721
     C*
     C                     MOVE *BLANKS   STLA
     C***********          MOVE *BLANKS   KCCY                            E15442
     C                     MOVE WNMCY     KCCY                            E15442
     C                     MOVE *ZEROS    STLT
     C***********          MOVE *ZEROS    ISSR                            E16474
     C**********           Z-ADDWISSR     ISSR                                         E16474 CSD027
     C**********           MOVE *ZEROS    KCUST                                               CSD027
     C                     MOVE WISSR     ISSR                                                CSD027
     C                     MOVE *BLANKS   KCUST                                               CSD027
     C                     Z-ADD0         KNCA
     C                     Z-ADD0         KBCA
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELPPRFC     PRFC                            CAC005
     C                     ELSE                                           CAC005
     C*
     C*  OUTPUT PROFIT CENTRE FROM BOOK POSITION                          S01117
     C**    If Analytical Accounting is installed and book position       CAC002
     C**    profit centre is blank, set the profit centre to              CAC002
     C**    SE ICD default profit centre.                                 CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           PCBK      ANDEQ*BLANKS                                   CAC002
     C                     MOVE BVSEPC    PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE PCBK      PRFC                            S01117
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC005
     C*                                                                   CPM004
     C** If Bank Portfolios Supported, set portfolio reference            CPM004
     C*                                                                   CPM004
     C           FCPORS    IFEQ 'B'                                       CPM004
     C                     EXSR SETPTF                                    CPM004
     C                     END                                            CPM004
     C                     WRITESEKEYDF
     C*
     C* ACCUMULATE TOTAL OF ACCOUNT KEYS OUTPUT
     C*
SP   C************         Z-ADD1         S
SP   C************         Z-ADD1         Z
     C                     Z-ADDEVAM      ZZAMT
     C                     EXSR ZHASH
     C                     ADD  1         SEKREC
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  W02  - Subroutine to Write a record to the Matured Security  *
      *         Positions Extract, (PF/MATEXD).                       *
      *                                                               *
      *****************************************************************
      *
     C           W02       BEGSR                           **  W02 **
     C*
     C                     MOVE 'B'       RECI
     C*
     C* IF NO BOOK POSITION HEADER FOUND, OUTPUT RECORD WITH 0 AMOUNTS
     C*
     C           *IN11     IFEQ '1'
     C***********          MOVE *ZEROS    BHBR                            S01117
     C                     MOVE *BLANKS   BHBA                            S01117
     C                     MOVE SASN      BHSC
     C                     MOVE *BLANKS   BHBK
     C**********           MOVE *ZEROS    CSCN                                                CSD027
     C                     MOVE *BLANKS   CSCN                                                CSD027
     C                     Z-ADD0         CSNT
     C                     Z-ADD0         CSNV
     C                     Z-ADD0         TCTR
     C                     Z-ADD0         SDRP
     C                     Z-ADD0         CPDD
     C                     ELSE
     C*
     C* SET UP FIELDS AS CALCULATED OR FROM BOOK POSITION HEADER
     C*
     C**********           MOVE *ZEROS    CSCN                                                CSD027
     C                     MOVE *BLANKS   CSCN                                                CSD027
     C                     Z-ADDWCSNT     CSNT
     C*
     C************IN20     IFEQ '0'                                       E20085
     C***********          Z-ADD0         CPDD                            E20085
     C***********          END                                            E20085
     C*
     C           *IN12     IFEQ '1'
     C                     Z-ADD0         CSNV
     C                     Z-ADD0         TCTR
     C                     MOVE WBHSC     BHSC
     C***********          MOVE WBHBR     BHBR                            S01117
     C                     MOVE WBHBA     BHBA                            S01117
     C                     MOVE WBHBK     BHBK
     C                     Z-ADDSREDPR    SDRP
     C                     ELSE
     C                     Z-ADDNPSN      CSNV
     C                     Z-ADDWCVAL     TCTR
     C                     Z-ADDWREDPR    SDRP
     C                     END
     C*
     C                     END
     C*
     C                     WRITEMATEXDF
     C*
     C                     ADD  1         MATREC
     C*
     C           EW02      ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  U01 - Subroutine to Update Book Position Header, (PF/BKPHDD) *
      *        and Book Position Header Month-End File, (PF/BKMTHD).  *
      *                                                               *
      *****************************************************************
      *
     C           U01       BEGSR                           **  U01 **
     C*
     C* SET UP FIELDS NOT CREATED IN CALCULATIONS
     C*
     C                     MOVE 'M'       RECI
     C                     Z-ADD0         INDO
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD*ZERO     INDN                                                CAS006
     C                     ENDIF                                                              CAS006
     C*
     C                     UPDATBKPHDDF
     C*
     C*
     C* UPDATE BOOK HEADER MONTH END FILE
     C*
     C           *IN50     IFEQ '0'                                       169496
     C                     UPDATBKMTHDF
     C                     END                                            169496
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************   CPM004
      *                                                               *   CPM004
      *  SETPTF - Subroutine to set portfolio reference on A/C key    *   CPM004
      *                                                               *   CPM004
      *****************************************************************   CPM004
     C           SETPTF    BEGSR                                          CPM004
     C*                                                                   CPM004
     C                     MOVEL*BLANK    PTFR                            CPM004
     C*                                                                   CPM004
     C                     MOVE EVTP      WWKY1                           CPM004
     C                     MOVE TRTP      WWKY2                           CPM004
     C                     MOVE PORT      WWKY3                           CPM004
     C                     MOVE AMCD      WWKY4                           CPM004
     C           WWKY      LOKUPWWARRZ                   99               CPM004
     C           *IN99     IFEQ '1'                                       CPM004
     C                     EXSR SRPORT                                    CPM004
     C                     END                                            CPM004
     C                     ENDSR                                          CPM004
      *****************************************************************   CPM004
      /EJECT                                                              CPM004
      ******************************************************************* CPM004
      *                                                                 * CPM004
      * SRPORT   - Access portfolio reference of book                   * CPM004
      *                                                                 * CPM004
      ******************************************************************* CPM004
     C           SRPORT    BEGSR                                          CPM004
     C*                                                                   CPM004
     C                     MOVEL'B'       I#PORS                          CPM004
     C                     MOVELFCR997    I#R997                          CPM004
     C                     MOVEL*BLANKS   I#CUST                          CPM004
     C                     MOVELBHBA      I#BRCA                          CPM004
     C                     MOVELBHBK      I#BOOK                          CPM004
     C                     MOVEL*BLANKS   I#PTFR                          CPM004
     C                     MOVEL*BLANKS   I#CPGM                          CPM004
     C*                                                                   CPM004
     C                     CALL 'AOPLCSR1'                                CPM004
     C                     PARM *BLANKS   P@RTCD  7        B:Return code  CPM004
     C                     PARM '*KEY   ' P@OPTN  7        I:Option       CPM004
     C                     PARM           I@PARM           I:Parameters   CPM004
     C                     PARM *BLANKS   O@PARM           O:Parameters   CPM004
     C           SDPLCS    PARM SDPLCS    DSFDY            O:Format       CPM004
     C*                                                                   CPM004
     C           P@RTCD    IFEQ *BLANKS                                   CPM004
     C                     MOVELO#PTFR    PTFR                            CPM004
     C                     END                                            CPM004
     C*                                                                   CPM004
     C                     ENDSR                                          CPM004
      ******************************************************************* CPM004
      /EJECT                                                              CPM004
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Update Audit records and Output Audit *
      *           Control Report.                                     *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR                           ** AUDIT **
     C*
     C* CHECK NO DBASE ERROR HAS BEEN ENCOUNTERED SO FAR
     C*    -  UPDATE BOOK POSITION HEADER AUDIT RECORD
     C*
     C           *INU7     IFEQ '0'
     C*
     C                     READ BKPHDAF                  99
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'BKPHD'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 05 *
     C                     Z-ADD05        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     ELSE
     C                     Z-ADDNORE      BHAREC  50
     C                     END
     C                     END
     C*
     C*    -  OUTPUT CONTROL REPORT
     C*
     C                     WRITEHEADAU
     C*
     C           *INU7     IFEQ '0'
     C*
     C***********IREC      IFEQ 0                                         E29170
     C***********          WRITENONE                                      E29170
     C***********          ELSE                                           E29170
     C                     Z-ADDINT,S     OHASH1
     C                     Z-ADDDEC,S     OHASH2
     C                     WRITECONTROL
     C***********          END                                            E29170
     C*
     C                     ELSE
     C*
     C                     WRITEERROR
     C*
     C                     END
     C***********                                                         E29170
     C***********          WRITETRAILAU                                   E29170
     C*
     C* IF NO DATABASE ERRORS OUTPUT AUDIT RECORDS TO SEKEYA AND MATEXA
     C*
     C           *INU7     IFEQ '0'
     C                     MOVE SEKREC    NORE
     C                     Z-ADDOHASH1    HRWN
     C                     Z-ADDOHASH2    HRDC
     C                     WRITESEKEYAF
     C                     MOVE 'B'       RECI
     C                     MOVE MATREC    NORE
     C                     WRITEMATEXAF
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  BKPCHN - Subroutine to Chain to Book Position Record.        *
      *                                                               *
      *****************************************************************
      *
     C           BKPCHN    BEGSR                           **  BKPCHN **
     C*
     C                     MOVE '0'       *IN11
     C           BKPKEY    CHAINBKPOSDF              80
     C**N80******RECI      COMP 'D'                  8080                 E20085
     C           *IN80     IFEQ '1'
     C           RECI      OREQ '*'                                       E20085
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'BKPOS'   DBFILE           ***************
     C                     MOVELBPKEY     DBKEY            * DB ERROR 06 *
     C                     Z-ADD06        DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C*                                                                   E14236
     C*  FLAG THE BOOK POSITION AS MATURED (RECI EQUAL TO 'M')            E14236
     C*                                                                   E14236
     C                     ELSE                                           E14236
     C                     MOVEL'M'       RECI                            E14236
     C                     EXCPTUBKPOS                                    E14236
     C                     END                                            E14236
     C*                                                                   E14236
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  PPCCHN - SR to chain to Book Position Profit Centre record   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           PPCCHN    BEGSR                           **  PPCCHN **  S01117
     C*                                                                   S01117
     C           KSEPCB    CHAINSEPCBDF              80                   S01117
     C           *IN80     IFEQ '1'                                       S01117
     C           RECI      OREQ '*'                                       S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SEPCBD'  DBFILE           ***************S01117
     C                     MOVELKSEPCR    DBKEY            * DB ERROR 12 *S01117
     C                     Z-ADD12        DBASE            ***************S01117
     C                     SETON                     U7U8                 S01117
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      *****************************************************************   S01117
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  BMTCHN - Subroutine to Chain to Book Header Month-End record.*
      *                                                               *
      *****************************************************************
      *
     C           BMTCHN    BEGSR                           **  BMTCHN **
     C*
     C                     MOVE BHSC      BKSS
     C***********          Z-ADDBHBR      BKBR                            S01117
     C                     MOVE BHBA      BKBA                            S01117
     C                     MOVE BHBK      BKBO
     C                     MOVE BHMK      BKMK
     C                     MOVE BHTV      BKTV
     C                     MOVE *HIVAL    BKED
     C           BMKEY     SETLLBKMTH                    79
     C           BKMK1     READEBKMTH                    80
     C           *IN80     IFEQ '1'                                       169496
     C           APPB      IFEQ 0                                         169496
     C           NPSN      ANDEQ0                                         169496
     C                     MOVE '0'       *IN80                           169496
     C                     MOVE '1'       *IN50                           169496
     C                     ENDIF                                          169496
     C                     ELSE                                           169496
     C                     MOVE '0'       *IN50                           169496
     C**N80******BKID      COMP '*'                      80               169496
     C           BKID      COMP '*'                      80               169496
     C                     ENDIF                                          169496
     C           *IN80     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD07        DBASE            ***************
     C                     MOVEL'BKMTH'   DBFILE           * DB ERROR 07 *
     C                     MOVELBKMKEY    DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  BOKCHN - Subroutine to Chain to Book File.                   *
      *                                                               *
      *****************************************************************
      *
     C           BOKCHN    BEGSR                           **  BOKCHN **
      *                                                                   CAC005
      ** If CAC005 is installed, retrieve user book. BHBK is Book         CAC005
      ** Position file is held as a pseudo book                           CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM *BLANKS   PRTCD   7                       CAC005
     C                     PARM '*USER  ' POPTN   7                       CAC005
     C                     PARM           PBKCD   2                       CAC005
     C                     PARM           PPRFC   4                       CAC005
     C                     PARM BHBK      PPSBK   2                       CAC005
      *                                                                   CAC005
      ** If record not found                                              CAC005
      *                                                                   CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C           *LOCK     IN   LDA                                       CAC005
     C                     MOVEL'SDBKPCPD'DBFILE           ************   CAC005
     C                     MOVELBHBK      DBKEY            * DBERR  19*   CAC005
     C                     Z-ADD19        DBASE            ************   CAC005
     C                     MOVE *ON       *INU7                           CAC005
     C                     MOVE *ON       *INU8                           CAC005
     C                     OUT  LDA                                       CAC005
     C                     DUMP                                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      ** Access Book Details using the user book from AOBKPCR0            CAC005
      *                                                                   CAC005
     C           PBKCD     CHAINBOOKDDF              80                   CAC005
     C                     ELSE                                           CAC005
     C*
     C           BOKKEY    CHAINBOOKDDF              80
     C                     ENDIF                                          CAC005
     C  N80      RECI      COMP 'D'                  8080
     C           *IN80     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'BOOKD'   DBFILE           ***************
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVELPBKCD     DBKEY                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVELBHBK      DBKEY            * DB ERROR 08 *
     C                     ENDIF                                          CAC005
     C                     Z-ADD08        DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SECCHN - Subroutine to Chain to Securities File.             *
      *                                                               *
      *****************************************************************
      *
     C           SECCHN    BEGSR                           **  SECCHN **
     C*
     C           SECKEY    CHAINSECTYDF              80
     C  N80      RECI      COMP '*'                      80
     C           *IN80     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SECTY'   DBFILE           ***************
     C                     MOVELSASN      DBKEY            * DB ERROR 09 *
     C                     Z-ADD09        DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     ELSE
     C                     MOVE NMCY      WNMCY   3
     C**********           Z-ADDISSR      WISSR   60                                          CSD027
     C                     MOVE ISSR      WISSR   6                                           CSD027
     C*                                                                   S01232
     C*     Indicate if an Australian yield traded security               S01232
     C*                                                                   S01232
     C           STBS      IFEQ 'Y'                                       S01232
     C           SYBS      ANDEQ'AU'                                      S01232
     C                     SETON                     52                   S01232
     C                     ELSE                                           S01232
     C                     SETOF                     52                   S01232
     C                     END                                            S01232
     C*                                                                   S01232
     C                     END
     C*
     C/COPY WNCPYSRC,SE2270C023
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  INVCHN - Subroutine to Chain to Investments File.            *
      *                                                               *
      *****************************************************************
      *
     C           INVCHN    BEGSR                           **  INVCHN **
     C*
     C           INVKEY    CHAININVTPDF              80
     C  N80      RECI      COMP 'D'                  8080
     C           *IN80     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'INVTP'   DBFILE           ***************
     C                     MOVELIKEY      DBKEY            * DB ERROR 10 *
     C                     Z-ADD10        DBASE            ***************
     C                     SETON                     U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SEDCHN - Subroutine to Chain to Security Diary Events File.  *
      *                                                               *
      *****************************************************************
      *
     C           SEDCHN    BEGSR                           **  SEDCHN **
     C*
     C                     MOVE '0'       *IN10                           E13817
     C           SEDKEY    CHAINSECED                80                   E13817
     C**N80******RECI      COMP 'D'                  8080                 E21139
     C  N80      RECI      COMP '*'                      80               E21139
     C           *IN80     IFEQ '0'
     C                     MOVE '1'       *IN10
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  TABCHN - Subroutine to Chain to TABTG10.                     *
      *                                                               *
      *****************************************************************
      *
     C           TABCHN    BEGSR                           **  TABCHN **
     C*
     C                     MOVE '0'       *IN15
     C                     MOVE *BLANK    TKEY
     C                     MOVEL'20'      TKEY
     C***********          MOVELWNMCY     KEY4    4                       S01117
     C                     MOVELWKCCY     KEY4    4                       S01117
     C                     MOVE '1'       KEY4
     C                     MOVE KEY4      TKEY
     C           TABKEY    CHAINTABTG10F             80
     C  N80      RECI      COMP 'D'                  8080
     C           *IN80     IFEQ '1'
     C           RECI      ANDEQ'D'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELTKEY      DBKEY            * DB ERROR 11 *
     C                     Z-ADD11        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  BKHSR  - S/R for Error Handling of Book Position Header.     *
      *                                                               *
      *****************************************************************
      *
     C           BKHSR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BKPHDD'  DBFILE           ***************
     C                     MOVELBHKEY     DBKEY            * DB ERROR 90 *
     C                     Z-ADD90        DBASE            ***************
     C                     MOVE STSBKH    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  MTDSR  - Subroutine for Error Handling of Account Keys.      *
      *                                                               *
      *****************************************************************
      *
     C           MTDSR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'MATEX'   DBFILE           ***************
     C                     MOVELSASN      DBKEY            * DB ERROR 91 *
     C                     Z-ADD91        DBASE            ***************
     C                     MOVE STSMTD    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  BKMSR  - Subroutine for Error Handling of Book Header Month. *
      *                                                               *
      *****************************************************************
      *
     C           BKMSR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BKMTH '  DBFILE           ***************
     C                     MOVELBKMKEY    DBKEY            * DB ERROR 92 *
     C                     Z-ADD92        DBASE            ***************
     C                     MOVE STSBKM    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  MTASR  - Subroutine for Error Handling of Maturity Extract.  *
      *                                                               *
      *****************************************************************
      *
     C           MTASR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'MATEX'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 93 *
     C                     Z-ADD93        DBASE            ***************
     C                     MOVE STSMTA    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SKDSR  - Subroutine for Error Handling of Account Keys.      *
      *                                                               *
      *****************************************************************
      *
     C           SKDSR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SEKEY'   DBFILE           ***************
     C                     MOVELACKY      DBKEY            * DB ERROR 94 *
     C                     Z-ADD94        DBASE            ***************
     C                     MOVE STSSKD    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SKASR  - Subroutine for Error Handling of Account Keys Audit.*
      *                                                               *
      *****************************************************************
      *
     C           SKASR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SEKEY'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 95 *
     C                     Z-ADD95        DBASE            ***************
     C                     MOVE STSSKA    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  BHASR  - S/R for Error Handling of Book Position Header      *
      *           Audit.                                              *
      *                                                               *
      *****************************************************************
      *
     C           BHASR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'BKPHD'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 96 *
     C                     Z-ADD96        DBASE            ***************
     C                     MOVE STSBHA    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      ******************************************************************
      /EJECT                                                              S01117
      *****************************************************************                       CSE065
      *                                                               *                       CSE065
      *  SRBOKV - S/R for Post Book Value change account keys on      *                       CSE065
      *           maturity.                                           *                       CSE065
      *                                                               *                       CSE065
      *****************************************************************                       CSE065
      *                                                                                       CSE065
     C           SRBOKV    BEGSR                                                              CSE065
      *                                                                                       CSE065
      ** Book Value Change                                                                    CSE065
      *                                                                                       CSE065
     C           LAVP      SUB  NAVP      WDIFF  308                                          CSE065
     C           WDIFF     MULT NPSN      WBVC   308                                          CSE065
      *                                                                                       CSE065
      ** Book Difference                                                                      CSE065
      *                                                                                       CSE065
     C           WBVC      ADD  BKVAMT    WBKD   308                                          CSE065
      *                                                                                       CSE065
     C                     MOVE 'V'       EVTP                                                CSE065
     C                     MOVE *BLANKS   TRST                                                CSE065
     C                     Z-ADD2270      TNLU                                                CSE065
      *                                                                                       CSE065
     C           NPAC      IFEQ 'N'                                                           CSE065
     C           NPSN      ORGE 0                                                             CSE065
     C                     MOVE *BLANKS   NEGI                                                CSE065
     C                     ELSE                                                               CSE065
     C                     MOVE 'N'       NEGI                                                CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** Book Value Change is positive and BKVAMT is negative.                                CSE065
      *                                                                                       CSE065
     C           WBVC      IFGE 0                                                             CSE065
     C           BKVAMT    ANDLT0                                                             CSE065
      *                                                                                       CSE065
     C           WBKD      IFGT 0                                                             CSE065
     C                     MOVE 'BD'      AMCD                                                CSE065
     C                     Z-ADDBKVAMT    EVAM                                                CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR W01                                                           CSE065
     C                     ENDIF                                                              CSE065
     C                     MOVE 'BI'      AMCD                                                CSE065
     C                     Z-ADDWBKD      EVAM                                                CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR W01                                                           CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ELSE                                                               CSE065
      *                                                                                       CSE065
     C                     MOVE 'BD'      AMCD                                                CSE065
     C           WBVC      MULT -1        WBKD2  308                                          CSE065
     C                     Z-ADDWBKD2     EVAM                                                CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR W01                                                           CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** Book Value Change is negative and BKVAMT is positive.                                CSE065
      *                                                                                       CSE065
     C           WBVC      IFLT 0                                                             CSE065
     C           BKVAMT    ANDGE0                                                             CSE065
      *                                                                                       CSE065
     C           WBKD      IFLT 0                                                             CSE065
     C                     MOVE 'BI'      AMCD                                                CSE065
     C           BKVAMT    MULT -1        WBKD3  308                                          CSE065
     C                     Z-ADDWBKD3     EVAM                                                CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR W01                                                           CSE065
     C                     ENDIF                                                              CSE065
     C                     MOVE 'BD'      AMCD                                                CSE065
     C           WBKD      MULT -1        WBKD4  308                                          CSE065
     C                     Z-ADDWBKD4     EVAM                                                CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR W01                                                           CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ELSE                                                               CSE065
      *                                                                                       CSE065
     C                     MOVE 'BI'      AMCD                                                CSE065
     C                     Z-ADDWBVC      EVAM                                                CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR W01                                                           CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** Book Value Change is negative and BKVAMT is negative.                                CSE065
      *                                                                                       CSE065
     C           WBVC      IFLT 0                                                             CSE065
     C           BKVAMT    ANDLT0                                                             CSE065
      *                                                                                       CSE065
     C                     MOVE 'BD'      AMCD                                                CSE065
     C           WBVC      MULT -1        WBKD5  308                                          CSE065
     C                     Z-ADDWBKD5     EVAM                                                CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR W01                                                           CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
      ** Book Value Change is positive and BKVAMT is positive.                                CSE065
      *                                                                                       CSE065
     C           WBVC      IFGE 0                                                             CSE065
     C           BKVAMT    ANDGE0                                                             CSE065
      *                                                                                       CSE065
     C                     MOVE 'BI'      AMCD                                                CSE065
     C                     Z-ADDWBVC      EVAM                                                CSE065
     C           EVAM      IFNE 0                                                             CSE065
     C                     EXSR W01                                                           CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     ENDIF                                                              CSE065
      *                                                                                       CSE065
     C                     Z-ADDWBKD      BKVAMT                                              CSE065
      *                                                                                       CSE065
     C                     ENDSR                                                              CSE065
      *                                                                                       CSE065
      *****************************************************************                       CSE065
      /EJECT                                                                                  CSE065
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C*****************************************************************
      /EJECT
     C***/COPY ZSRSRC,XDATE3Z1                                     S01232 E22957
      ***/EJECT                                                    S01232 E22957
     C/COPY ZSRSRC,ZACCRZ1
      /EJECT                                                              E20085
     C/COPY ZSRSRC,ZACCZZ1                                                E20085
      /EJECT                                                              E20117
     C/COPY ZSRSRC,ZCNSDZ1                                                E20117
      /EJECT
     C/COPY ZSRSRC,ZCONVZ1
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
     C/COPY ZSRSRC,ZHASHZ3
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT                                                              E20085
     C/COPY ZSRSRC,ZLCDZ1                                                            E20085 MD057247
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT
     C***/COPY ZSRSRC,ZPRCIZ1                                             E22957
      ***/EJECT                                                           E22957
     C/COPY ZSRSRC,ZRATEZ1
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT                                                              S01232
     C***/COPY ZSRSRC,ZYCEZ1                                       S01232 E22957
      ***/EJECT                                                    S01232 E22957
     C***/COPY ZSRSRC,ZYLDIZ1                                             E22957
      ***/EJECT                                                           E22957
     C***/COPY ZSRSRC,ZYLDZ2                                              E22957
      ***O/EJECT                                                          E22957
     OBKPOSDF E                UBKPOS                                     E14236
     O                         RECI                                       E14236
      /EJECT
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  WWARRZ                                                                CPM004
P  PP                                                                     CPM004
R  CO                                                                     CPM004
C  DI                                                                     CPM004
H  DI                                                                     CPM004
M  CV                                                                     CPM004
