000100200529     H        1
000200200529      *****************************************************************
000300200529/*STD *  RPGBASE                                                      *
000400200529/*EXI *  TEXT('Midas SE Generate a/c keys - trades')                  *
000500200529     F*****************************************************************
000600200529     F*                                                               *
000700200529     F*  Midas - Securities Trading Module                            *
000800200529     F*                                                               *
000900200529     F*  SE2290 - GENERATE TRADE ACCOUNT KEYS                         *
001000200529     F*                                                               *
001100200529     F*  Function: This program generates Trade-based Account Keys    *
001200200529     F*    (COB)   for all Trades (including Book Transfers and Trade *
001300200529     F*            Amendments), on Trade and Value date. The Trade    *
001400200529     F*            Actions due today for both Dates are then written  *
001500200529     F*            to the Trade Actions File (PF/TRDACD), which is    *
001600200529     F*            used in COB to identify Book, Customer and Depot   *
001700200529     F*            Positions which are affected by the Trade Actions. *
001800200529     F*            Records are written to PF/SETLXD if Telexes are    *
001900200529     F*            due (processed in SEC0603).                        *
002000200529     F*            Trades past Backvalue period are transferred to    *
002100200529     F*            the Historical Trades File and Cancelled Trades    *
002200200529     F*            are shown on the Cancelled Trades file.            *
002300200529     F*            Automatic Settlement Actions for Book Transfers    *
002400200529     F*            are written (PF/ASTACD).                           *
002500200529     F*            Any changes made to Trades after Trade or Value    *
002600200529     F*            Date are monitored and changes affecting Positions *
002700200529     F*            are written to User/Customer Depot Movements Files.*
002800200529     F*            Indicators to signify that Trade and Value Date    *
002900200529     F*            Accounting have been done are updated on the       *
003000200529     F*            Trades file.                                       *
003100200529     F*                                                               *
003200200529     F*  Called by: SEC0602C - Generate A/c Keys - Trades             *
003300200529     F*                                                               *
003400200529      *  (c) Finastra International Limited 2001                      *
003500200529     F*                                                               *
003600200604     F*  Last Amend No. 258975             Date 22May20               *
003700200604     F*  PREV Amend No. 243841             Date 22May20               *
003800200604      *                 MD046248           Date 27Oct17               *
003900200529      *                 215959             Date 21Mar16               *
004000200529      *                 226449             Date 24Jun15               *
004100200529      *                 250925             Date 15Jun15               *
004200200529      *                 CSW210             Date 04May10               *
004300200529      *                 CER059             Date 19Jul10               *
004400200529      *                 CER054             Date 07Apr09               *
004500200529      *                 BUG23123           Date 09Mar09               *
004600200529      *                 CER048             Date 19May08               *
004700200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
004800200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
004900200529      * Midas Plus 1.4 Base ------------------------------------------*
005000200529      * Midas Plus 1.3 ----------- Base ------------------------------*
005100200529      *                 BUG12826           Date 05Dec06
005200200529      *                 CSD031             Date 10Apr06               *
005300200529      *                 CSD027             Date 09Dec05               *
005400200529      *                 BUG9864            Date 13Jan06               *
005500200529      *                 236063             Date 25Aug05               *
005600200529      *                 235615             Date 25Aug05               *
005700200529      *                 235751             Date 29Aug05               *
005800200529      *                 235174             Date 27Jul05               *
005900200529      *                 234844             Date 08Jul05               *
006000200529      *                 234440             Date 26Jun05               *
006100200529      *                 234300             Date 23Jun05               *
006200200529      *                 233999             Date 08Jun05               *
006300200529      *                 233566             Date 26May05               *
006400200529      *                 CGL031             Date 05Jul04               *
006500200529      *                 CSE071             Date 19Jul05               *
006600200529      *                 223183             Date 21Nov03               *
006700200529      *                 BUG3122            Date 17Jul04               *
006800200529      *                 CGL029             Date 01Sep03               *
006900200529      *                 CGP001             Date 14Oct03               *
007000200529      *                 194370             Date 12Jul01               *
007100200529      *                 CAS006             Date 21Jan03               *
007200200529      *                 211407             Date 07Jan03               *
007300200529      *                 180056             Date 18Oct00               *
007400200529      *                 CSE035             Date 22Apr02               *
007500200529      *                 CSE039             Date 16MAY03               *
007600200529      *                 CAP182             Date 19FEB03               *
007700200529      *                 CGL020             Date 12Dec02               *
007800200529      *                 206316             Date 19Jul02               *
007900200529      * Midas Release 4.01 -------------------------------------------*
008000200529      *                 CPK015             Date 01Jul02               *
008100200529      *                 CSE031             Date 09Nov01               *
008200200529      *                 180707             Date 25Jul00               *
008300200529      * Midas Release 4 --------------- Base -------------------------*
008400200529      *                 169622             Date 13Jun01               *
008500200529      * Midas DBA 3.04 -----------------------------------------------*
008600200529      *                 CSE023             Date 14AUG00               *
008700200529      * Midas DBA 3.03 -----------------------------------------------*
008800200529      *                 165636             Date 03May00               *
008900200529      *                 161657             Date 20Apr00                  *
009000200529      * Midas DBA 3.02 -----------------------------------------------*
009100200529      *                 CSE017             Date 22Oct99               *
009200200529      *                 CAP051             DATE 16Nov99               *
009300200529      *                 CPB001             DATE 18Jun99               *
009400200529      * Midas DBA 3.00 ---------------- Base -------------------------*
009500200529      *                 130862             Date 18Oct98               *
009600200529      *                 151945             DATE 06Jan99               *
009700200529      *                 CAP003             Date 30Jul98               *
009800200529      *                 139104             Date 17Jul98               *
009900200529      *                 CEU017             Date 07Apr98               *
010000200529     F*                 CSE007             Date 18Mar98               *
010100200529     F*                 112898             DATE 23FEB98               *
010200200529     F*                 125968             DATE 05DEC97               *
010300200529     F*                 S01408             DATE 22JAN98               *
010400200529     F*                 CSE005             DATE 04FEB97               *
010500200529     F*                 109058             DATE 07APR97               *
010600200529     F*                 CAC002             Date 15Sep96               *
010700200529     F*                 090247             Date 13Aug96               *
010800200529     F*                 084704             Date 01Aug96               *
010900200529     F*                 083039             Date 01Aug96               *
011000200529     F*                 059110             Date 01Aug96               *
011100200529     F*                 088047             Date 26Jun96               *
011200200529     F*                 100228             Date 31May96               *
011300200529     F*                 037597             DATE 01MAY96               *
011400200529     F*                 100017             DATE 18APR96               *
011500200529     F*                 S01408             DATE 12FEB96               *
011600200529     F*                 092961             DATE 04OCT95               *
011700200529     F*                 091254             DATE 20OCT95               *
011800200529     F*                 086491             DATE 15JUN95               *
011900200529     F*                 080259             DATE 14DEC94               *
012000200529     F*                 S01486             DATE 31OCT94               *
012100200529     F*                 S01502             DATE 02DEC94               *
012200200529     F*                 070683             DATE 12OCT94               *
012300200529     F*                 066883             DATE 01FEB93               *
012400200529     F*                 052254             DATE 10JAN94               *
012500200529     F*                 S01446             DATE 18OCT93               *
012600200529     F*                 S01401             DATE 16JUN93               *
012700200529     F*                 S01397             DATE 10SEP92               *
012800200529     F*                 E39925             DATE 20MAY92               *
012900200529     F*                 E37633             DATE 30MAR92               *
013000200529     F*                 E37180             DATE 18MAR92               *
013100200529     F*                 E35978             DATE 21FEB92               *
013200200529     F*                 E35649             DATE 18FEB92               *
013300200529     F*                 E23874             DATE 05SEP91               *
013400200529     F*                 S01220             DATE 07AUG90               *
013500200529     F*                 S01117             DATE 02NOV90               *
013600200529     F*                 E23955             DATE 24OCT90               *
013700200529     F*                 S01269             DATE 16JUL90               *
013800200529     F*                 S01271             DATE 07JUN90               *
013900200529     F*                 E23716             DATE 02OCT90               *
014000200529     F*                 E22485             DATE 07AUG90               *
014100200529     F*                 E21538             DATE 09APR90               *
014200200529     F*                 E21606             DATE 02APR90               *
014300200529     F*                 E21433             DATE 12MAR90               *
014400200529     F*                 E21303             DATE 06MAR90               *
014500200529     F*                 E21244             DATE 26FEB90               *
014600200529     F*                 E21273             DATE 26FEB90               *
014700200529     F*                 E20602             DATE 15DEC89               *
014800200529     F*                 E20191             DATE 01DEC89               *
014900200529     F*                 E18209             DATE 27NOV89               *
015000200529     F*                 E19975             DATE 23NOV89               *
015100200529     F*                 E20235             DATE 20NOV89               *
015200200529     F*                 E19488             DATE 14NOV89               *
015300200529     F*                 E19832             DATE 16OCT89               *
015400200529     F*                 E19824             DATE 13OCT89               *
015500200529     F*                 E19332             DATE 29AUG89               *
015600200529     F*                 E18803             DATE 17AUG89               *
015700200529     F*                 E19284             DATE 15AUG89               *
015800200529     F*                 E16772             DATE 19/06/89              *
015900200529     F*                 E18335             DATE 13/06/89              *
016000200529     F*                 E17876             DATE 11/04/89              *
016100200529     F*                 E17704             DATE 31/03/89              *
016200200529     F*                 E17303             DATE 31/03/89              *
016300200529     F*                 E17179             DATE 09/03/89              *
016400200529     F*                 E16333             DATE 09/03/89              *
016500200529     F*                 E16800             DATE 09/03/89              *
016600200529     F*                 E16848             DATE 09/02/89              *
016700200529     F*                 E16830             DATE 09/02/89              *
016800200529     F*                 E16819             DATE 09/02/89              *
016900200529     F*                 S01176             DATE 09/11/88              *
017000200529     F*                 S01169             DATE 09/11/88              *
017100200529     F*                 E15996             DATE 03/11/88              *
017200200529     F*                 E15439             DATE 06/10/88              *
017300200529     F*                 E15549             DATE 05/10/88              *
017400200529     F*                 E15430             DATE 28/09/88              *
017500200529     F*                 E14550             DATE 28/09/88              *
017600200529     F*                 E14235             DATE 23/09/88              *
017700200529     F*                 E15222             DATE 20/09/88              *
017800200529     F*                 E14720             DATE 20/09/88              *
017900200529     F*                 E14513             DATE 31/08/88              *
018000200529     F*                 E14544             DATE 22/08/88              *
018100200529     F*                 S01175             DATE 01/07/88              *
018200200529     F*                 S01158             DATE 06/05/88              *
018300200529     F*                                                               *
018400200529     F*---------------------------------------------------------------*
018500200529     F*                                                               *
018600200529      *  258975 - The system generate wrong posting date events on    *
018700200529      *           the settlement for securities events. Use trade     *
018800200529      *           date as posting date when generating trade date     *
018900200529      *           account keys.                                       *
019000200529      *  253841 - Suppress trade action generation for a matured      *
019100200529      *           security to avoid duplicate record error in BKPHDD. *
019200200529      *           Partially applied fix 137339.                       *
019300200529      *  MD046248 - Finastra Rebranding                               *
019400200529      *  215959 - Truncation error on event amount in SE2450P3.       *
019500200529      *           Recompiled due to changes in PF/SEKEYD.             *
019600200529      *         - Applied for MD-37439.                               *
019700200529      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
019800200529      *         - Applied for MD034387.                               *
019900200529      *  250925 - Increase length of fields used to save settlement   *
020000200529      *           details to avoid overriding the data. Applied fix   *
020100200529      *           243302.                                             *
020200200529      *         - Applied for MD-34196.                               *
020300200529      *  CSW210 - SWIFT 2010 Changes                                  *
020400200529      *  CER059 - German Feature Upgrade to Delhi                     *
020500200529      *  CER054 - German Features - Church Tax (Recompile)            *
020600200529      *  BUG23123 - Report: Does not show Retail Account Number       *
020700200529      *                     Date is not Midas Standard Date           *
020800200529      *                     Period should be actual int. calc. period *
020900200529      *                     Secondary Tax amount is not printed       *
021000200529      *                     Added field TSSLID                        *
021100200529      *                     (Recompile)                               *
021200200529      *  CER048 - German Features - Taxes (Recompile)                 *
021300200529      *  BUG12826 - SEC0602C  00001 (Day 2 PT COB)                    *
021400200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
021500200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
021600200529      *  BUG9864 - Component SEC0606K failed due to duplicate records.*
021700200529      *            Applied fix 211879.                                *
021800200529      *  236063 - CONDITION GENERATION OF REVERSAL ACKEYS             *
021900200529      *  235615 - Correct postings generated for a Trade Reversal.    *
022000200529      *  235751 - If settlement ccy is different than nominal ccy     *
022100200529      *           Nominal amount must be different than settlement    *
022200200529      *           amount.
022300200529      *  235174 - Trade a/c keys do not consider Joint A/c country.   *
022400200529      *  234844 - Customer incomes not retrieved by the program       *
022500200529      *  234440 - Purchase Interest management in real time           *
022600200529      *  234300 - Recompiled over changed in PF/HSTTRD.               *
022700200529      *  233999 - Country code on ET account key must be the country  *
022800200529      *           of residence instead of the country of tax          *
022900200529      *  233566 - Add fields to CDEPPD                                *
023000200529      *  CGL031 - Taxation of Savings Income                          *
023100200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
023200200529      *  223183 - Don't generate an automatic settlement (ASTACD) for *
023300200529      *           trades with the internal customer which are not     *
023400200529      *           book transfers.                                     *
023500200529      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
023600200529      *  CGL029 - Increase Account Code to 10 digits                  *
023700200529      *  CGP001 - Global Processing.                                  *
023800200529      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
023900200529      *           For securities with divisor basis = '5' and first   *
024000200529      *           coupon date > valuation date (rundate + 1), set     *
024100200529      *           event control date to first coupon date before      *
024200200529      *           processing SR/ZDYYR. This is to ensure that the     *
024300200529      *           correct hypothetical last and next coupon dates are *
024400200529      *           used in deriving the price/yield rate.              *
024500200529      *  CAS006 - Hedge Accounting Phase B.                           *
024600200529      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
024700200529      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
024800200529      *           The change was to call subroutine ZLCD1 instead     *
024900200529      *           of ZLCD in retrieving the PERIOD for NNX processing *
025000200529      *           and ZNCD1 is called instead of ZNCD in retrieving   *
025100200529      *           the WBENCD for NNX processing. Also rewrite tests   *
025200200529      *           for identifying if position is NX,NNX or CUM.       *
025300200529      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
025400200529      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
025500200529      *  CSE039 - Automatic Settlement of Trades                      *
025600200529      *  CAP182 - Auto Settlement of Trades                           *
025700200529      *           Recompile over changed SETLED                       *
025800200529      *  CGL020 - Compliance Watch - Additional A/C Postings          *
025900200529      *           Information                                         *
026000200529      *  206316 - Recompiled over changed ZLCDZ1.                     *
026100200529      *  CPK015 - Release 4.01 Packaging:                             *
026200200529      *           - A default timestamp string is required for WRITE. *
026300200529      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
026400200529      *           (recompilation due to change to ZNCD/ZLCD)          *
026500200529      *  180707 - No Position Settlements generated. Recompile over   *
026600200529      *           changes in /COPY ZNCDZ3.                            *
026700200529     F*  169622 - 090247 only applicable if security has a maturity   *
026800200529     F*           date (not for shares for example).                  *
026900200529      *  CSE023 - Treaty Withholding Tax                              *
027000200529     F*  165636 - Accounting problems regarding amended trades.       *
027100200529     F*           Fix is to correct reversals for amended trades.     *
027200200529     F*  161657 - Recompiled over changed SR/ZCONPRZ1.                *
027300200529      *  CSE017 - Cum/Ex Indicator on Depot Movements                 *
027400200529     F*  CAP051 - Automatic Authorisation (SE Trades Part)            *
027500200529     F*  CPB001 - 'Private Banking' Module                            *
027600200529     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
027700200529     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
027800200529      *  CAP003 - Conversion of Midas inputs to modular API structure *
027900200529      *           Phase 2.  Program recompiled over changed files.    *
028000200529     F*  139104 - Problem with S01486 which donot set up currency     *
028100200529     F*           decimal places before it is being used for          *
028200200529     F*           reallowance calculation and hence caused array index*
028300200529     F*           error if the trade is the first one being process.  *
028400200529     F*  CEU017 - Securities Redenomination Euro Changes              *
028500200529     F*           Same coding than CSE007                             *
028600200529     F*  CSE007 - Corporate Actions                                   *
028700200529     F*  112898 - THE SPOT RATE ON THE TRADE IS THE ONE IN SETTLEMENT *
028800200529     F*           CURRENCY.                                           *
028900200529     F*  125968 - REVERSAL PROCESSING NOT DONE FOR TRADE DATE.        *
029000200529     F*           DUE TO FIX 109058.                                  *
029100200529     F*  S01408 - Hook SE2290C033 moved to match the R10.6 source.    *
029200200529     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
029300200529     F*           (recompilation due to change to ZNCD/ZLCD)          *
029400200529     F*  109058 - TRADE DATE ACCOUNTING MISSED FOR AMENDED TRADE.     *
029500200529     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
029600200529     F*           If Analytical Accounting is available, generate a   *
029700200529     F*           new margin account key and define the profit centre *
029800200529     F*           for each posting.                                   *
029900200529     F*  090247 - A DATABASE ERROR OCCURS IN SE0945 IF A TRADE IS NOT *
030000200529     F*           FULLY SETTLED BUT THE SECURITY HAS BEEN DROPPED     *
030100200529     F*           SO MOVE TRADES TO HSTTRD IF SECURITY HAS MATURED.   *
030200200529     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
030300200529     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
030400200529     F*  059110 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
030500200529     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
030600200529     F*  100228 - ADD STANDARD SR ZLCDZ1.                             *
030700200529     F*           RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
030800200529     F*  037597 - USE THE SPOT RATE EQUIVALENT OF THE TRADE INSTEAD   *
030900200529     F*           OF THE SPOT RATE EQUIVALENT OF TABTG10.             *
031000200529     F*  100017 - Position settlement unable to pick up day adjustment*
031100200529     F*           on SECTYD. Therefore subroutine ZDAYSZ2 changed to  *
031200200529     F*           use indicator DADJN to not apply interest rate      *
031300200529     F*           adjustment for amortisation if set to 'N'.          *
031400200529     F*  S01408 - Addition of core hook SE2290FFP1
031500200529     F*           Addition of core hook SE2290IIP1
031600200529     F*           Addition of core hook SE2290CCP1
031700200529     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
031800200529     F*           (Wrong number of days calculated for day basis 1    *
031900200529     F*           when start or end day is last day of February)      *
032000200529     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
032100200529     F*  086491 - Wrong nbr of days calculated for day basis 1        *
032200200529     F*           when start or end day is last day of February       *
032300200529     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
032400200529     F*  080259 - Portfolio Ref missing on Trade Actions file         *
032500200529     F*           (lines missed by S01486)                            *
032600200529     F*  S01486 - Incorporation of PM Enhancements (S01235) and       *
032700200529     F*           apply fixes 42217, B05819, B05705, R05367, R05580,  *
032800200529     F*           R0166, R0124, S01313, R0710, S05776, and R0661.     *
032900200529     F*  S01502 - BLI TELEKURS PROCESSING, RECOMPILED DUE TO CHANGE   *
033000200529     F*           IN LENGTH OF SESTAT, 133 LONG.                      *
033100200529     F*  070683 - BASED CURRENCY EQUIVALENT IS BEING CLACULATED       *
033200200529     F*           INCORRECTLY. IT IS BEING MULTIPLIED INSTEAD OF      *
033300200529     F*           DIVIDED.                                            *
033400200529     F*  066883 - Generate Countervalue keys correctly as per ICD flag*
033500200529     F*           On Trade Date, generate CV keys if Cross Currency   *
033600200529     F*           Entries flag is 'T' or 'B'                          *
033700200529     F*           On Value Date, generate CV keys if Cross Currency   *
033800200529     F*           Entries flag is 'V' or 'B'                          *
033900200529     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
034000200529     F*  S01446 - CUSTOMER COMMISSIONS (COURTAGE) ENHANCEMENT         *
034100200529     F*           Amended to use the charge code group when           *
034200200529     F*           generating the Charges Account Keys.                *
034300200529     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
034400200529     F*         - Recompiled due to changes to files.                 *
034500200529     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
034600200529     F*         - Recompiled due to changes to files.                 *
034700200529     F*  E39925 - Attempt to update TRAUTD after fail on READE -      *
034800200529     F*           caused by DOUNTIL.                                  *
034900200529     F*  E37633 - Recompiled for changes to Audit Report. (Changed to *
035000200529     F*           stop page without header being printed).            *
035100200529     F*  E37180 - Trade entered previous month and reversed this      *
035200200529     F*           month indicator should only be 'Y' if action date   *
035300200529     F*           is in previous month too                            *
035400200529     F*  E35978 - W05 should use Start of Business trade and          *
035500200529     F*           not trade as it is now                              *
035600200529     F*  E35649 - Lengths of SREC and TREC need to be increased as    *
035700200529     F*           do not match current length of TRADSD               *
035800200529     F*  E23874 - Contingent liability keys should not  be produced   *
035900200529     F*           if the security details have specified 'N'          *
036000200529     F*  S01220 - STRATEGIC RISK MANAGEMENT                           *
036100200529     F*           Recompiled over changed PF/SECTYD, PF/SEDEVD        *
036200200529     F*  S01117 - Multibranching.                                     *
036300200529     F*  E23955 - E22485 incomplete on change of SREC to SREC1/2      *
036400200529     F*  S01269 - Trade authorization processing.                     *   S01269
036500200529     F*  S01271 - PAY/RECEIVE IN INPUT CYCLE - REMOVE TELEX EXTRACT   *   S01271
036600200529     F*           PROCESSING TO NEW PROGRAM SE3320. (NB SOME LINES IN *   S01271
036700200529     F*           SR/TRADED, SR/TRADEA, SR/TRADEC,                    *   S01271
036800200529     F*           WERE COMMENTED OUT ALREADY BUT HAD NO               *   S01271
036900200529     F*           ERROR REFERENCE NUMBER ATTACHED.)  ALSO INCREASE    *   S01271
037000200529     F*           LENGTH OF SREC AND TREC TO ACCOUNT FOR INCREASE TO  *   S01271
037100200529     F*           LENGTH OF TRADSD.                                   *   S01271
037200200529     F*  E23716 - Redundant code removed.                             *
037300200529     F*  E22485 - SOB Trades were not saved when read for Amends      *
037400200529     F*           resulting in ghost depot movements                  *
037500200529     F*         - Amendment to nominal did not action Cust/User Depot *
037600200529     F*           Movements, Nominal for reversal Equaled new Nominal *
037700200529     F*         - SECED replaced by SECEO and SOBSO for Reversals     *
037800200529     F*           all the diary event info it needs                   *
037900200529     F*  E21538 - Dropping trades entered in the current month messed *   E21538
038000200529     F*           up the Monthly Trading Reconciliation Report.       *   E21538
038100200529     F*  E21606 - Book Transfers with Value Date of Next Working Day  *   E21606
038200200529     F*           must Update I/C Settlement Nominals on Position     *   E21606
038300200529     F*           Files for Next Day's Enquiries.                     *   E21606
038400200529     F*  E21433 - Do not reverse the sign on the 'PI' Key if the      *   E21433
038500200529     F*           Trade is Ex-Coupon.                                 *   E21433
038600200529     F*  E21303 - Accrued Indicator should always be on Trade Action. *   E21303
038700200529     F*  E21244 - Incorrect Amounts on Base Currency Euiv. Postings.  *   E21244
038800200529     F*  E21273 - No Charge/Commission Keys for Purchases.            *   E21273
038900200529     F*  E20602 - Account Keys for Changes and Commissions are        *   E20602
039000200529     F*           generated with negative sign.                       *   E20602
039100200529     F*  E20191 - Charges are being added to Commissions Total and    *   E20191
039200200529     F*           vice-versa.                                         *   E20191
039300200529     F*  E18209 - Create an empty Trailer in SETLXA if no Trades exist*   E18209
039400200529     F*  E19975 - KCUST and ISSR shouldn't be zeroized before writing *   E19975
039500200529     F*           SEKEYD as  issuer and depot cust nos are needed for *   E19975
039600200529     F*           account keys with posting ref 4 and 5.              *   E19975
039700200529     F*  E20235 - Error E15222 is wrong. Should use TPDY into TRPR,   *   E20235
039800200529     F*           not PRIC into TRPR.                                 *   E20235
039900200529     F*  E19488 - Error in S01176:                                    *   E19488
040000200529     F*           Mishandling of TREC and SREC data structures        *   E19488
040100200529     F*           causes corruption of trade records.                 *   E19488
040200200529     F*  E19832 - Contingent Liability Keys should only be produced   *   E19832
040300200529     F*           if Counterparty is a Market Client.                 *   E19832
040400200529     F*  E19824 - Convertible Indicator must be 'Y' or ' ' on         *   E19824
040500200529     F*           Contingent Account Keys.                            *   E19824
040600200529     F*  E19332 - 1) On Trades amended after Trade Date, but prior to *   E19332
040700200529     F*              Value date, reverse out Value Date Keys.         *   E19332
040800200529     F*           2) Correct Date Next Working Day movements on       *   E19332
040900200529     F*              Trades amended today.                            *   E19332
041000200529     F*           3) Price on Depot Movements is zero.                *   E19332
041100200529     F*           4) Flag all Customer Depot Movements as Reversals   *   E19332
041200200529     F*              so that no Average Price reworking occurs in     *   E19332
041300200529     F*              SE2405/SE2410.                                   *   E19332
041400200529     F*  E18803 - Set Account Key Sequence Number to zero to allow    *   E18803
041500200529     F*           for Multi-Branch system.                            *   E18803
041600200529     F*  E19284 - Indicator 50 set off to prevent subsequent Trades   *   E19284
041700200529     F*           being flagged as fully Settled.                     *   E19284
041800200529     F*  E16772 - Recompiled for the Dividend Payment Amount field    *   E16772
041900200529     F*           changes.                                            *   E16772
042000200529     F*  E18335 - CONTINGENT LIABILITY KEY SHOULD NOT BE PRODUCED     *   E18335
042100200529     F*           FOR PROCESSING TYPES 2,4,7.                         *   E18335
042200200529     F*  E17876 - REMOVE E17704, CAUSES SE2100 LOOP IN ALL TEST SYS'S.*   E17876
042300200529     F*  E17704 - RECOMPILE PROGRAM OVER CHANGED ZNCDZ3 SR            *   E17704
042400200529     F*  E17303 - RECOMPILE PROGRAM OVER CHANGED ZDYYRZ3 ZYLDZ1 ZYLDZ2*   E17303
042500200529     F*  E17179 - CHANGE REC ID TO '*' ON DELETED INCOMPLETE TRADES   *   E17179
042600200529     F*  E16333 - ONLY WRITE RECORD TO HISTORIC TRADES FILE IF TRADE  *   E16333
042700200529     F*           HAS BEEN FULLY SETTLED.                             *   E16333
042800200529     F*  E16800 - DO NOT REVERSE SIGN ON ACCOUNT KEYS AS AMOUNT IS    *   E16800
042900200529     F*           HELD ON FILE WITH CORRECT SIGN. AND OUTPUT REVERSAL *   E16800
043000200529     F*           INDICATOR ON ALL ACCOUNT KEYS.                      *   E16800
043100200529     F*  E16848 - OUTPUT ALL CANCELLED TRADE RECORDS WITH RECI 'C'.   *   E16848
043200200529     F*  E16830 - INCORRECT SIGN ON PI KEY FOR EX-COUPON TRADE.       *   E16830
043300200529     F*  E16819 - WHEN CANCELLING A TRADE, USE START OF BUSINESS VALUE*   E16819
043400200529     F*           AS TRADE MAY HAVE SUBSEQUENTLY BEEN AMENDED.        *   E16819
043500200529     F*  S01176 - SECURITIES TRADING 3.1                              *   S01176
043600200529     F*  S01169 - SECURITIES TRADING 3.1 (BAER INCORPORATION).        *   S01169
043700200529     F*  E15996 - DESIGN OMISSIONS - various Julius Baer fixes        *   E14838
043800200529     F*  E15439 - IF NO RECORD FOUND FOR TRADE STOP READING SEDEVD,   *   E15439
043900200529     F*           PREVIOUSLY READ TO START OF FILE - LONG RUN TIME.   *   E15439
044000200529     F*  E15549 - FIX CONNECTED WITH REDELIVERY OF POSITION           *   E15549
044100200529     F*           SETTLEMENT PROGRAMS AND OTHER FIXES FROM CD.        *   E15549
044200200529     F*           - ACCRUED INDICATOR NOT SET FOR SHARES              *   E15549
044300200529     F*  E15430 - CONVERTIBLE INDICATOR MUST BE 'Y' OR ' ' ON         *   E15430
044400200529     F*           ACCOUNT KEYS                                        *   E15430
044500200529     F*  E14550 - PERFORM ACCOUNTING REVERSAL BASED ON TACI FROM      *   E14550
044600200529     F*           START OF BUSINESS RECORD FOR TRADE AMENDMENTS.      *   E14550
044700200529     F*  E14235 - ERROR IN SR/ZNCD TO FETCH NEXT COUPON DATE. PROGRAM *   E14235
044800200529     F*           RE-COMPILED TO ALLOW FOR NEW SUB-ROUTINE.           *   E14235
044900200529     F*  E15222 - UPDATE TRADE ACTION FILE WITH TRADE PRICE, NOT      *   E15222
045000200529     F*           THE PRICE/DISCOUNT/YIELD CONTENTS.                  *   E15222
045100200529     F*  E14720 - REVERSAL INDICATOR SET OFF ONLY OUTSIDE SR/W01      *   E14720
045200200529     F*           TO PREVENT INCORRECT ENTRY GENERATION.              *   E14720
045300200529     F*  E14513 - CROSS-CURRENCY ENTRIES SHOULD BE GENERATED          *   E14513
045400200529     F*           FOR 'VALUE' AS WELL AS FOR 'BOTH'.                  *   E14513
045500200529     F*  E14544 - ENSURE POSITIONS 11-12 ARE BLANK FOR                *   E14544
045600200529     F*           CONSIDERATION A/C KEYS.                             *   E14544
045700200529     F*  S01175 - EUCLID ENHANCEMENT                                  *   S01175
045800200529     F*  S01158 - POST INCORPORATION DEVELOPMENT FIXES                *   S01158
045900200529     F*                                                               *
046000200529     F*****************************************************************
046100200529      *
046200200529     FTRDBR   UP  E           K        DISK         KINFDS TRDDS
046300200529     F                                              KINFSR TRDSR
046400200529     F*TRADSA**UF**E                    DISK         KINFDS TRADS         S01269
046500200529     FTRADSA  UF  E                    DISK         KINFDS TRDSA          S01269
046600200529     F                                              KINFSR TRASR
046700200529     FSECTY   IF  E           K        DISK
046800200529     FTRADS   IF  E           K        DISK                               S01269
046900200529     F            TRADSDF                           KRENAMETRADSDX        S01269
047000200529     FTRADSDY2IF  E           K        DISK                                                   CGL020
047100200529     FCLINT   IF  E           K        DISK
047200200529     F            CLINTCAF                          KIGNORE
047300200529     F            CLINTCBF                          KIGNORE
047400200529     F            CLINTCCF                          KIGNORE
047500200529     F            CLINTC1F                          KIGNORE
047600200529     F*TABSE***IF**E***        K        DISK                              S01117
047700200529     F* ICD 1     TABTB10F                          KIGNORE
047800200529     F* ICD 2     TABTB11F                          KIGNORE
047900200529     F* ICD SE    TABTB36F                          KIGNORE
048000200529     F*********** TABTB40F                          KIGNORE               S01117
048100200529     F* CCY       TABTG10F                          KIGNORE
048200200529     F*********** TABTG20F                          KIGNORE               S01117
048300200529     F*********** TABLETAF                          KIGNORE               S01117
048400200529     F*********** TABLETHF                          KIGNORE               S01117
048500200529     F*********** TABLETJF                          KIGNORE               S01117
048600200529     F*********** TABLETLF                          KIGNORE               S01117
048700200529     F*********** TABLETRF                          KIGNORE               S01117
048800200529     F*********** TABLETXF                          KIGNORE               S01117
048900200529     F*********** TABLET2F                          KIGNORE               S01117
049000200529     F*********** TABLET3F                          KIGNORE               S01117
049100200529     F*********** TABLET5F                          KIGNORE               S01117
049200200529     F*********** TABTE10F                          KIGNORE               S01117
049300200529     F*********** TABTE20F                          KIGNORE               S01117
049400200529     F*********** TABLETNF                          KIGNORE               S01117
049500200529     F*********** TABLETKF                          KIGNORE               S01117
049600200529     F*********** TABLETPF                          KIGNORE               S01117
049700200529     FSOBTR   IF  E           K        DISK
049800200529     F            TRADSDF                           KRENAMESOBTRDF
049900200529     FINVTP   IF  E           K        DISK
050000200529     F***SECED   IF  E           K        DISK                            E22485
050100200529     F************SNDEVDF                           KIGNORE               E22485
050200200529     FSECEO   IF  E           K        DISK                               E22485
050300200529     FSOBSO   IF  E           K        DISK                               E22485
050400200529     F            SNDEVDF                           KRENAMESOBSNDF        E22485
050500200529     F            SEDEVDF                           KRENAMESOBSEDF        E22485
050600200529     FTRAUT   UF  E           K        DISK                               S01269
050700200529     FCLBTR   UF  E           K        DISK         KINFDS CLBDS A
050800200529     F                                              KINFSR CLBSR
050900200529     FCLIABA  UF  E                    DISK         KINFDS CLADS
051000200529     F                                              KINFSR CLASR
051100200529     FTRDACD  O   E                    DISK         KINFDS TACDS
051200200529     F                                              KINFSR TACSR
051300200529     FTRDACA  O   E                    DISK         KINFDS TAADS
051400200529     F                                              KINFSR TAASR
051500200529     FSEKEYD  O   E                    DISK         KINFDS SKYDS
051600200529     F                                              KINFSR SKYSR
051700200529     FSEKEYA  O   E                    DISK         KINFDS SKADS
051800200529     F                                              KINFSR SKASR
051900200529     F***SETLXD**O   E                    DISK         KINFDS SLXDS       S01271
052000200529     F***                                             KINFSR SLXSR        S01271
052100200529     F***SETLXA**O   E                    DISK         KINFDS SLADS       S01271
052200200529     F***                                             KINFSR SLASR        S01271
052300200529     FCNCTRD  O   E                    DISK         KINFDS CNCDS
052400200529     F                                              KINFSR CNCSR
052500200529     F            TRADSDF                           KRENAMECNCTRDF
052600200529     F***TRA  UF  E                    DISK         KINFDS CNADS
052700200529     FCNCTRA  O   E                    DISK         KINFDS CNADS
052800200529     F                                              KINFSR CNASR
052900200529     FHSTTRD  O   E                    DISK         KINFDS HSTDS
053000200529     F                                              KINFSR HSTSR
053100200529     F*********** TRADSDF                           KRENAMEHSTTRDF        S01176
053200200529     FHSTTRA  UF  E                    DISK         KINFDS HSADS
053300200529     F                                              KINFSR HSASR
053400200529     FASTACD  O   E                    DISK         KINFDS ASTDS
053500200529     F                                              KINFSR ASTSR
053600200529     FASTACA  O   E                    DISK         KINFDS ASADS
053700200529     F                                              KINFSR ASASR
053800200529     FUDPMVD  O   E                    DISK         KINFDS UDPDS
053900200529     F                                              KINFSR UDPSR
054000200529     FUDPMVA  O   E                    DISK         KINFDS UDADS
054100200529     F                                              KINFSR UDASR
054200200529     FCDPMVD  O   E                    DISK         KINFDS CDPDS
054300200529     F                                              KINFSR CDPSR
054400200529     FCDPMVA  O   E                    DISK         KINFDS CDADS
054500200529     F                                              KINFSR CDASR
054600200529     FSETLED  O   E                    DISK                               S01176
054700200529     FSETLEA  UF  E                    DISK                               S01176
054800200529     FTRATXD  O   E                    DISK                               S01269
054900200529     F            TRADSDF                           KRENAMETRATXDF        S01269
055000200529     FHSTAUD  O   E                    DISK                               S01269
055100200529     F            TRAUTDF                           KRENAMEHSTAUDF        S01269
055200200529      *                                                                                       CGL031
055300200529      ***Customer*Income*by Generation*Date/Module*ID/Transaction*no.                  CGL031 234844
055400200529     F***SDCSINL6IF  E           K        DISK                                         CGL031 234844
055500200529      ** Customer Income by Transaction no./Module ID                                         234844
055600200529     FSDCSINLDIF  E           K        DISK                                                   234844
055700200529      *                                                                                       CGL031
055800200529      ** Start of Business Customer Income by Transaction no./Module ID                       235615
055900200529     FSOBCINLDIF  E           K        DISK                                                   235615
056000200529     F            SDCSIND0                          KRENAMESOBCIND0                           235615
056100200529      *                                                                                       235615
056200200529     F/COPY WNCPYSRC,SE2290F001
056300200529     FSE2290AUO   E                    PRINTER
056400200529     FSEMVTSL1IF  E           K        DISK                               CSE039
056500200529     FSEMVTSL0O   E                    DISK                               CSE039
056600200529     F            SEMVTSD0                          KRENAMESEMVTSUP       CSE039
056700200529     F*
056800200529     F/COPY WNCPYSRC,SE2290FFP1
056900200529     F*
057000200529      /EJECT
057100200529     F*****************************************************************
057200200529     F*                                                               *
057300200529     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
057400200529     F*                                                               *
057500200529     F*10-19 - CHAINING/READ INDICATORS                               *
057600200529     F*   20 - FIRST CYCLE INDICATOR                                  *
057700200529     F*   21 - TRADE DATE ACCOUNTING INDICATOR                        *
057800200529     F*   22 - VALUE DATE ACCOUNTING INDICATOR                        *
057900200529     F*   23 - TRADE DATE A/C IND FOR SOBTR                           *
058000200529     F*   24 - VALUE DATE A/C IND FOR SOBTR                           *
058100200529     F*   25 - ONLY CREATE COUNTERVALUE KEY FOR SOBTR                 *
058200200529     F****26*-*REVERSAL INDICATORFOR TELEX PROCESSING                 *   S01271
058300200529     F*   27 - COMMISSION TOTAL NEGATIVE                              *
058400200529     F*   28 - COMMISSION TOTAL POSITIVE                              *
058500200529     F*   29 - PERFORM TRADE DATE PROCESSING                          *
058600200529     F*   30 - PERFORM VALUE DATE PROCESSING                          *
058700200529     F*   31 - CHARGES TOTAL NEGATIVE                                 *
058800200529     F*   32 - CHARGES TOTAL POSITIVE                                 *
058900200529     F*   33 - SUPRESS TRADE DATE KEYS                                *
059000200529     F*   34 - SUPRESS VALUE DATE KEYS                                *
059100200529     F*   35 - REALLOWANCE AMOUNT NEGATIVE                            *
059200200529     F*   36 - MAKE ACTION SEQ NO. 11                                 *
059300200529     F*   37 - USE DATA FROM SECURITY EVENTS FILE                     *
059400200529     F*   38 - ARRAY INDEX LESS THAN 3 FOR C & C KEYS                 *
059500200529     F****39*-*NO*NOMINAL*CCY*OUTPUT*ON*REC*TO*SEKEYD***              *   S01176
059600200529     F*   40 - DIFFERENCE MESSAGE ON PRINTOUT                         *
059700200529     F*   41 - TRADE DATE A/C IND FOR TRADE CHANGES                   *
059800200529     F*   42 - NOMINAL CCY DEC PLACES 0                               *
059900200529     F*   43 - NOMINAL CCY DEC PLACES 1                               *
060000200529     F*   44 - NOMINAL CCY DEC PLACES 2                               *
060100200529     F*   45 - NOMINAL CCY DEC PLACES 3                               *
060200200529     F*   50 - AUTO-SETTLEMENT INDICATOR IS Y FOR THE CURRENT         *   S01176
060300200529     F*        TRADE                                                  *   S01176
060400200529     F*   60 - PROCESSING TYPE 2,4 OR 7.                              *   E18335
060500200529     F*                                                               *
060600200529     F****98*-*ZSYSTM*DATE*FORMAT*IND*                                *   S01117
060700200529     F****99*-*ZSYSTM*ICD*RECORD*ERROR*                               *   S01117
060800200529     F*   98 - DATE FORMAT IND                                        *   S01117
060900200529     F*   99 - RECORD ERROR                                           *   S01117
061000200529     F*                                                               *
061100200529     F*   U7 - DATABASE ERROR                                         *
061200200529     F*   U8 - DATABASE ERROR                                         *
061300200529     F*                                                               *
061400200529     F*****************************************************************
061500200529      /EJECT
061600200529     F*****************************************************************
061700200529     F*                                                               *
061800200529     F*  S U B R O U T I N E   I N D E X                              *
061900200529     F*                                                               *
062000200529     F*   ACC    - PERFORM ACCOUNTING FOR COMPLETE TRADE              *
062100200529     F*   ACCREV - REVERSE TRADE ACCOUNTING FOR A COMPLETE TRADE      *
062200200529     F*   ACKEY  - GENERATE ACCOUNT KEYS                              *
062300200529     F*   ACTION - OUTPUT TRADE ACTION                                *
062400200529     F*   AUDIT  - PERFORM RUN CONTROL PROCESS                        *
062500200529     F*   CDEPOT - OUTPUT CUST. DEPOT MOVEMENTS FOR AMENDED DEPOT     *
062600200529     F*   DATARA - EXTRACT DATA AREA FROM RUNDAT                      *   S01117
062700200529     F*   NOMDEC - CALCULATE NOMINAL AMOUNT IN NOMINAL CCY DEC PLACES *
062800200529     F*   SRETXR - Retrieve Tax Amount for Reversal from SOB file     *                       235615
062900200529     F****TELEX**-*OUTPUT*TELEX*EXTRACT                               *   S01271
063000200529     F*   TITLE  - EXTRACT TITLE FROM AOBANKRO                        *   S01117
063100200529     F*   TRADEA - PROCESS FULLY AMENDED TRADE                        *
063200200529     F*   TRADEC - PROCESS CANCELLED TRADE                            *
063300200529     F*   TRADED - PROCESS TRADE-LIVE,NOT FULLY SETTLD, NOT FULLY     *
063400200529     F*            AMENDED                                            *
063500200529     F*   TRADEP - Process Trade: Changed but awaiting authorisation  *   S01269
063600200529     F*   UDEPOT - OUTPUT USER DEPOT MOVEMENTS FOR AMENDED DEPOT      *
063700200529     F*   W01    - WRITE GENERATED ACCOUNT KEYS TO SEKEYD             *
063800200529     F*   W04    - WRITE CONTINGENT LIABILITY ACCOUNT KEYS TO SEKEYD  *   S01176
063900200529     F*   W05    - Write to Trades Awaiting Telex file                *   S01269
064000200529     F**                                                              *
064100200529     F*   ZCONPR - TO CALCULATE CONTRACT PRICE                        *
064200200529     F*   ZCONV  - TO CONVERT AMT FROM ONE CURRENCY TO ANOTHER        *
064300200529     F*   ZDATE1 - TO CONVERT DATE TO DAYS                            *
064400200529     F*   ZDATE2 - TO CONVERT DAYS TO DATE                            *
064500200529     F*   ZDAYS  - TO CALC. NO. OF DAYS BETWEEN TWO DATES             *
064600200529     F*   ZDYYR  - TO CALC. NO. OF DAYS IN INTEREST YEAR              *
064700200529     F*   ZEVCD  - DETERMINE EVENT CONTROL DATE                       *
064800200529     F****ZICDSE*-*RETRIEVE*SECURITIES*TRADING*ICD*RECORD**************   S01117
064900200529     F****ZICD2**-*RETRIEVE*ICD*RECORD*2*******************************   S01117
065000200529     F*   ZNCD   - TO CALCULATE NEXT COUPON DATE                      *
065100200529     F****ZSYSTM*-*RETRIEVE*ICD*RECORD*1*                             *   S01117
065200200529     F*   *PSSR  - EXCEPTION ERROR ROUTINE                            *   S01117
065300200529     F*                                                               *
065400200529     F*****************************************************************
065500200529      /EJECT
065600200529     E                    NAR     1   1 15                                S01176
065700200529     E                    CPY@    1   1 80
065800200529     E/COPY ZSRSRC,ZPOWERZ1
065900200529     E                    POWER8  1   8  8 4             POWER8 ARRAY
066000200529     E/COPY ZSRSRC,ZHASHZ1
066100200529     E**********          CCDE        7  2                                S01169
066200200529     E**********          CAMT        7 13 0                              S01169
066300200529     E                    XCD        10  2                                S01169
066400200529     E                    XAM        10 13 0                              S01169
066500200529     E                    RAM         3 13 0                              S01176
066600200529     E                    RCD         3  2                                S01176
066700200529     E/COPY ZSRSRC,ZNCDZ1
066800200529     E/COPY ZSRSRC,ZDAYSZ1
066900200529     E/COPY ZSRSRC,ZDATE2Z1
067000200529     E                    STAMP   1   1 26                                                    CPK015
067100200529     E                    NARR    1   1 30               NARRATIVE        CSE039
067200200529     E                    TMMP    1   1 26               TIMESTAMP        CSE039
067300200529      ** Array containing dummy timestamp                                                     CPK015
067400200529      /EJECT
067500200529     I*
067600200529     I/COPY WNCPYSRC,SE2290IIP1
067700200529     i*
067800200529     I*
067900200529     I* RENAME PORTFOLIO REFERENCE FIELD                                  S01486
068000200529     ITRADSDF                                                             S01486
068100200529     I              PTFR                            XPTFR                 S01486
068200200529     I              COAF                            XCOAF                 CSE007
068300200529     I/COPY ZSRSRC,ZNCDZ2
068400200529     IRECIN     E DSTRDBR
068500200529     I              ZZ005                           ZZ005X                052254
068600200529     I                                        1 256 RECIN1                S01486
068700200529     I                                      257 512 RECIN2                S01486
068800200529     I***********                           513 528 RECIN3         S01486 CAC002
068900200529     I***********                           513 554 RECIN3         CAC002 CSE007
069000200529     I***********                           513 555 RECIN3         CSE007 CAP051
069100200529     I**********                            513 633 RECIN3                             CAP051 250925
069200200529     I                                      513 715 RECIN3                                    250925
069300200529     ITREC        DS                                                      S01176
069400200529     I***********                             1 250 TREC1           S01176E35649
069500200529     I************                          251 500 TREC2          S01176 S01271
069600200529     I***********                           251 503 TREC2           S01271E35649
069700200529     I*************************************   1 255 TREC1          E35649 S01486
069800200529     I************************************* 256 510 TREC2          E35649 S01486
069900200529     I                                        1 256 TREC1                 S01486
070000200529     I                                      257 512 TREC2                 S01486
070100200529     I***********                           513 528 TREC3          S01486 CAC002
070200200529     I***********                           513 554 TREC3          CAC002 CSE007
070300200529     I***********                           513 555 TREC3          CSE007 CAP051
070400200529     I**********                            513 633 TREC3                              CAP051 250925
070500200529     I                                      513 715 TREC3                                     250925
070600200529     ISREC        DS                                                      S01176
070700200529     I***********                             1 250 SREC1           S01176E35649
070800200529     I************                          251 500 SREC2          S01176 S01271
070900200529     I***********                           251 503 SREC2           S01271E35649
071000200529     I*************************************   1 255 SREC1          E35649 S01486
071100200529     I************************************* 256 510 SREC2          E35649 S01486
071200200529     I                                        1 256 SREC1                 S01486
071300200529     I                                      257 512 SREC2                 S01486
071400200529     I***********                           513 528 SREC3          S01486 CAC002
071500200529     I***********                           513 554 SREC3          CAC002 CSE007
071600200529     I/COPY WNCPYSRC,SE2290I006
071700200529     I***********                           513 555 SREC3          CSE007 CAP051
071800200529     I**********                            513 633 SREC3                              CAP051 250925
071900200529     I                                      513 715 SREC3                                     250925
072000200529     I            DS
072100200529     I                                        1  20 ACKY
072200200529     I                                        1   3 INTP
072300200529     I                                        4   4 EVCD
072400200529     I                                        5   5 TRDT
072500200529     I                                        6   6 PFIN
072600200529     I                                        7   8 BKCD
072700200529     I                                        9  10 TRSB
072800200529     I                                       11  12 CCCD
072900200529     I                                       13  13 MKT
073000200529     I                                       14  14 CNVI
073100200529     I/COPY WNCPYSRC,SE2290I001
073200200529     I**********                             15  18 FILL1                                     CGL031
073300200529     I                                       15  16 FILL1                                     CGL031
073400200529     I                                       17  18 CTTX                                      CGL031
073500200529     I/COPY WNCPYSRC,SE2290I002
073600200529     I                                       19  20 AMTC
073700200529     I/COPY WNCPYSRC,SE2290I007
073800200529     I            DS
073900200529     I************                            1  34 TRSIDS                E22485
074000200529     I**********                              1  40 TRSIDS                             E22485 CGL029
074100200529     I                                        1  76 TRSIDS                                    CGL029
074200200529     I                                        1   20TRSMTH
074300200529     I**********                              3  14 TRPYFM                                    CGL029
074400200529     I                                        3  14 TRQQFM                                    CGL029
074500200529     I************                           15  170TRPYFB                S01117
074600200529     I                                       15  17 TRPYFA                S01117
074700200529     I**********                             18  29 TRPAYT                                    CGL029
074800200529     I                                       18  29 TRQQYT                                    CGL029
074900200529     I************                           30  320TRPYTB                S01117
075000200529     I                                       30  32 TRPYTA                S01117
075100200529     I                                       33  340TRASNM
075200200529     I                                       35  400TRNOML                E22485
075300200529     I                                       41  58 TRPYFM                                    CGL029
075400200529     I                                       59  76 TRPAYT                                    CGL029
075500200529     I            DS
075600200529     I************                            1  34 SOSIDS                E22485
075700200529     I**********                              1  40 SOSIDS                             E22485 CGL029
075800200529     I                                        1  76 SOSIDS                                    CGL029
075900200529     I                                        1   20SOSMTH
076000200529     I**********                              3  14 SOPYFM                                    CGL029
076100200529     I                                        3  14 SOQQFM                                    CGL029
076200200529     I************                           15  170SOPYFB                S01117
076300200529     I                                       15  17 SOPYFA                S01117
076400200529     I**********                             18  29 SOPAYT                                    CGL029
076500200529     I                                       18  29 SOQQYT                                    CGL029
076600200529     I************                           30  320SOPYTB                S01117
076700200529     I                                       30  32 SOPYTA                S01117
076800200529     I                                       33  340SOASNM
076900200529     I                                       35  400SONOML                E22485
077000200529     I                                       41  58 SOPYFM                                    CGL029
077100200529     I                                       59  76 SOPAYT                                    CGL029
077200200529     I*                                                                   S01094
077300200529     I            DS                                                      S01094
077400200529     I*    Hash totalling fields                                          S01094
077500200529     I                                        1  153ZZAMT                 S01094
077600200529     I                                       16  300ZZAMTI                S01094
077700200529     I                                       31  330ZZAMTD                S01094
077800200529     I                                       34  360ZZTOTD                S01094
077900200529     I                                       37  510ZZTOTI                S01094
078000200529     I                                       52  520Z                     S01094
078100200529     I                                       53  530S                     S01094
078200200529     I*
078300200529     I* DATA STRUCTURES FOR ERROR HANDLING
078400200529     I*
078500200529     ITRDDS       DS
078600200529     I                                     *STATUS  STSTRD
078700200529     I*
078800200529     I*TRADS******DS                                                      S01269
078900200529     ITRDSA       DS                                                      S01269
079000200529     I                                     *STATUS  STSTRA
079100200529     I*
079200200529     ICLBDS       DS
079300200529     I                                     *STATUS  STSCLB
079400200529     I*
079500200529     ICLADS       DS
079600200529     I                                     *STATUS  STSCLA
079700200529     I*
079800200529     ITACDS       DS
079900200529     I                                     *STATUS  STSTAC
080000200529     I*
080100200529     ITAADS       DS
080200200529     I                                     *STATUS  STSTAA
080300200529     I*
080400200529     ISKYDS       DS
080500200529     I                                     *STATUS  STSSKY
080600200529     I*
080700200529     ISKADS       DS
080800200529     I                                     *STATUS  STSSKA
080900200529     I*
081000200529     I***SLXDS****DS                                                      S01271
081100200529     I************                         *STATUS  STSSLX                S01271
081200200529     I*
081300200529     I***SLADS****DS                                                      S01271
081400200529     I************                         *STATUS  STSSLA                S01271
081500200529     I*
081600200529     ICNCDS       DS
081700200529     I                                     *STATUS  STSCNC
081800200529     I*
081900200529     ICNADS       DS
082000200529     I                                     *STATUS  STSCNA
082100200529     I*
082200200529     IHSTDS       DS
082300200529     I                                     *STATUS  STSHST
082400200529     I*
082500200529     IHSADS       DS
082600200529     I                                     *STATUS  STSHSA
082700200529     I*
082800200529     IASTDS       DS
082900200529     I                                     *STATUS  STSAST
083000200529     I*
083100200529     IASADS       DS
083200200529     I                                     *STATUS  STSASA
083300200529     I*
083400200529     IUDPDS       DS
083500200529     I                                     *STATUS  STSUDP
083600200529     I*
083700200529     IUDADS       DS
083800200529     I                                     *STATUS  STSUDA
083900200529     I*
084000200529     ICDPDS       DS
084100200529     I                                     *STATUS  STSCDP
084200200529     I*
084300200529     ICDADS       DS
084400200529     I                                     *STATUS  STSCDA
084500200529     I*
084600200529     ISESTAT    E DS
084700200529     I              EUTX                            XEUTX                                     CGL031
084800200529     I/COPY WNCPYSRC,SE2290I004
084900200529     I*
085000200529     I***LDA*****   UDS                            256                    S01117
085100200529     I***********                           134 177 DBLOT                 S01117
085200200529     I***********                           134 138 DBFILE                S01117
085300200529     I***********                           139 167 DBKEY                 S01117
085400200529     I***********                           168 175 DBPGM                 S01117
085500200529     I***********                           176 177 DBASE                 S01117
085600200529     ILDA         DS                            256                       S01117
085700200529     I                                      134 183 DBLOT                 S01117
085800200529     I                                      134 141 DBFILE                S01117
085900200529     I                                      142 170 DBKEY                 S01117
086000200529     I                                      171 180 DBPGM                 S01117
086100200529     I                                      181 1830DBASE                 S01117
086200200529     IRUNDT       DS                                                      S01117
086300200529      *                                                                   S01117
086400200529      ** RUNDAT data area                                                 S01117
086500200529      *                                                                   S01117
086600200529     I                                        1   7 RUNA                  S01117
086700200529     I                                    P   8  100RUND                  S01117
086800200529     I                                       11  11 SSF                   S01117
086900200529     I                                       12  12 DATF                  S01117
087000200529     I                                       13  13 MBIN                  S01117
087100200529      *                                                                   S01446
087200200529      ** External DS for Charges types details                            S01446
087300200529      *                                                                   S01446
087400200529     I@SECGT    E DSSECGT                                                 S01446
087500200529     I              RECI                            XRECI                 S01446
087600200529     I              LCD                             XLCD                  S01446
087700200529     I              CHTP                            XCHTP                 S01446
087800200529     I              TNLU                            XTNLU                 S01446
087900200529     I              PRFC                            XPRFC                 CAC002
088000200529     I/COPY WNCPYSRC,SE2290I003
088100200529      *                                                                   S01117
088200200529      ** External DS for bank details                                     S01117
088300200529     I*                                                                   S01117
088400200529     ISDBANK    E DSSDBANKPD                                              S01117
088500200529     I              BJURPT                          TITL                  S01117
088600200529     I*                                                                   S01117
088700200529     I**  EXTERNAL DS FOR SECURITIES TRADING DETAILS                      S01117
088800200529     ISDSTRD    E DSSDSTRDPD                                              S01117
088900200529     I*                                                                   S01117
089000200529     I**  EXTERNAL DS FOR GENERAL LEDGER ICD DETAILS                      S01117
089100200529     ISDGELR    E DSSDGELRPD                                              S01117
089200200529     I*                                                                   S01117
089300200529     I** Currency details                                                 S01117
089400200529     ISDCURR    E DSSDCURRPD                                              S01117
089500200529     I*                                                                   S01486
089600200529     I** Module details                                                   S01486
089700200529     ISDMMOD    E DSSDMMODPD                                              S01486
089800200529     I** Security Client Details                                          CSE039
089900200529     ISDSECS    E DSSDSECSPD                                              CSE039
090000200529     I              QQACCD                          QQACC1                                    CGL029
090100200529     I/COPY WNCPYSRC,SE2290I005
090200200529     I*                                                                   S01117
090300200529     ISCSARD    E DSSCSARDPD                                                                  CGL020
090400200529     I              LCD                             WLCD                                      CGL020
090500200529     I              ZONE                            WZONE                                     CGP001
090600200529     I** Switchable features file                                                             CGL020
090700200529     I*                                                                                       CGL020
090800200529     I** Data structure for access objects, short data structure          S01117
090900200529     I*                                                                   S01117
091000200529     IDSFDY     E DSDSFDY                                                 S01117
091100200529     I*                                                                   S01117
091200200529     I** LONG STRUCTURE FOR ACCESS OBJECTS, LONG DATA STRUCTURE           S01117
091300200529     IDSSDY     E DSDSSDY                                                 S01117
091400200529     I*                                                                   S01117
091500200529     ICPYR@#      DS
091600200529     I*
091700200529     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
091800200529     I*
091900200529     I                                        1  80 CPY@
092000200529     I                                        1  20 CPY@##
092100200529      *                                                                                       CGL020
092200200529      ** Set constant field for ZAAMLSETSE routine's name                                     CGL020
092300200529      *                                                                                       CGL020
092400200529     I              'ZAAMLSETSE'          C         SETAML                                    CGL020
092500200529      *                                                                                       CGL020
092600200529     I**********                              1   60PTCNR                              CGL020 CSD027
092700200529     I                                        1   6 PTCNR                                     CSD027
092800200529     C/EJECT
092900200529      *================================================================
093000200529      *  P R O G R A M   S T A R T                                    *
093100200529      *================================================================
093200200529     C/COPY WNCPYSRC,SE2290C001
093300200529      *                                                                   S01486
093400200529      *** Copyright Statement                                             S01486
093500200529     C                     MOVEACPY@      ACT@   80                       S01486
093600200529     C*
093700200529     C* KEYLISTS FOR FILE CHAINS
093800200529     C*
093900200529     C*   - CLIENT FILE
094000200529     C*
094100200529     C           CLNUM     KLIST
094200200529     C                     KFLD           TCNR
094300200529     C                     KFLD           CRCT    1
094400200529     C*
094500200529     C*  - INVESTMENT TYPE
094600200529     C*
094700200529     C           ITKEY     KLIST
094800200529     C                     KFLD           NMCY
094900200529     C                     KFLD           SITP
095000200529     C*
095100200529     C*  - SECURITY DIARY EVENTS
095200200529     C*
095300200529     C           SEKEY     KLIST
095400200529     C                     KFLD           TDSS
095500200529     C***********          KFLD           EVDT    50                      E22485
095600200529     C                     KFLD           EVTP    2
095700200529     C                     KFLD           EVDT    50                      E22485
095800200529     C*                                                                   CSE039
095900200529     C*  - MOVEMENTS STATUS FILE                                          CSE039
096000200529     C*                                                                   CSE039
096100200529     C           KSEMV     KLIST                                          CSE039
096200200529     C                     KFLD           KTDRF   6                       CSE039
096300200529     C                     KFLD           KTRTY   1                       CSE039
096400200529     C                     KFLD           KNTDT   50                      CSE039
096500200529     C*                                                                   CSE039
096600200529      *                                                                                       CGL031
096700200529      ** Customer Income Key List                                                             CGL031
096800200529      *                                                                                       CGL031
096900200529     C           KCSIN     KLIST                                                              CGL031
097000200529     C***********          KFLD           WGDAT   50                                   CGL031 234844
097100200529     C***********          KFLD           WMODI   1                                    CGL031 234844
097200200529     C                     KFLD           WTRNO   60                                          CGL031
097300200529     C                     KFLD           WMODI   1                                           234844
097400200529      *                                                                                       CGL031
097500200529     C/COPY WNCPYSRC,SE2290C002
097600200529     C*
097700200529     C           MAIN      TAG
097800200529     C*
097900200529     C** Initialise trade subroutine indicator                            165636
098000200529     C*                                                                   165636
098100200529     C                     MOVE ' '       @SUBR   1                       165636
098200200529     C*                                                                   165636
098300200529     C* If trade is incomplete, add to audit count and skip all further
098400200529     C* processing
098500200529     C*
098600200529     C           TINC      IFEQ 'I'
098700200529     C           RECI      IFEQ 'D'
098800200529     C                     ADD  1         DICNT
098900200529     C                     ELSE
099000200529     C           RECI      IFEQ 'A'
099100200529     C                     ADD  1         AICNT
099200200529     C                     ELSE                                           E17179
099300200529     C           RECI      IFEQ 'C'                                       E17179
099400200529     C                     MOVE '*'       RECI                            E17179
099500200529     C                     ADD  1         DAUCNT                          E17179
099600200529     C                     UPDATTRADSDF                                   E17179
099700200529     C/COPY WNCPYSRC,SE2290C046
099800200529     C                     END                                            E17179
099900200529     C                     END
100000200529     C                     END
100100200529     C                     ADD  1         LAUCNT
100200200529     C                     GOTO MEND
100300200529     C                     ELSE
100400200529     C*
100500200529     C* If trade is complete and deleted, ignore
100600200529     C*
100700200529     C           RECI      CABEQ'*'       MEND
100800200529     C                     END
100900200529     C*
101000200529     C* STORE INPUT RECORD FROM TRADSD
101100200529     C*
101200200529     C**********           MOVE RECIN     TREC                            S01169
101300200529     C**********           MOVELRECIN     TREC                     S01169 S01176
101400200529     C*
101500200529     C******************** MOVELRECIN     TREC1                    S01176 S01486
101600200529     C******************** MOVE RECIN     TREC2                    S01176 S01486
101700200529     C                     MOVE RECIN1    TREC1                           S01486
101800200529     C                     MOVE RECIN2    TREC2                           S01486
101900200529     C                     MOVE RECIN3    TREC3                           S01486
102000200529     C*                                                                   S01176
102100200529     C** STORE FIELD DETAILS FROM TRADSD                                  S01176
102200200529     C** DELIVER FROM                                                     S01176
102300200529     C** DELIVER TO                                                       S01176
102400200529     C** LAST CHANGE DATE                                                 S01176
102500200529     C** RECORD ID                                                        S01176
102600200529     C** ACCOUNTING INDICATOR                                             S01176
102700200529     C** CURRENT FACTOR                                                   S01176
102800200529     C** AUTO SETTLE INDICATOR                                            S01176
102900200529     C*                                                                   S01176
103000200529     C           *LIKE     DEFN DELF      TDELF                           S01176
103100200529     C                     MOVE DELF      TDELF                           S01176
103200200529     C           *LIKE     DEFN DELT      TDELT                           S01176
103300200529     C                     MOVE DELT      TDELT                           S01176
103400200529     C           *LIKE     DEFN LCD       TLCD                            S01176
103500200529     C                     Z-ADDLCD       TLCD                            S01176
103600200529     C           *LIKE     DEFN RECI      TRECI                           S01176
103700200529     C                     MOVE RECI      TRECI                           S01176
103800200529     C                     MOVE *BLANK    WKGNRV  1                                           236063
103900200529     C           *LIKE     DEFN RECI      WKRECI                                              236063
104000200529      *   NOTE TRADSD RECI.                                                                   236063
104100200529     C                     MOVE RECI      WKRECI                                              236063
104200200529     C           *LIKE     DEFN TACI      TTACI                           S01176
104300200529     C                     MOVE TACI      TTACI                           S01176
104400200529     C           *LIKE     DEFN TCFC      TTCFC                           S01176
104500200529     C                     Z-ADDTCFC      TTCFC                           S01176
104600200529     C           *LIKE     DEFN AUTS      TAUTS                           S01176
104700200529     C                     MOVE AUTS      TAUTS                           S01176
104800200529     C           *LIKE     DEFN TDBK      TTDBK                           S01176
104900200529     C                     MOVE TDBK      TTDBK                           S01176
105000200529     C************LIKE     DEFN TDBR      TTDBR                    S01176 S01117
105100200529     C***********          MOVE TDBR      TTDBR                    S01176 S01117
105200200529     C           *LIKE     DEFN TDBA      TTDBR                           S01117
105300200529     C                     MOVE TDBA      TTDBR                           S01117
105400200529     C           *LIKE     DEFN TDDT      TTDDT                           S01176
105500200529     C                     MOVE TDDT      TTDDT                           S01176
105600200529     C           *LIKE     DEFN TDMI      TTDMI                           S01176
105700200529     C                     MOVE TDMI      TTDMI                           S01176
105800200529     C           *LIKE     DEFN TDVD      TTDVD                           S01176
105900200529     C                     MOVE TDVD      TTDVD                           S01176
106000200529     C           *LIKE     DEFN PRIC      TPRIC                           E19332
106100200529     C                     MOVE PRIC      TPRIC                           E19332
106200200529     C           *LIKE     DEFN NOML      TNOML                           E22485
106300200529     C                     MOVE NOML      TNOML                           E22485
106400200529      *                                                                   S01269
106500200529     C           *LIKE     DEFN CHTP      TCHTP                           S01269
106600200529     C                     MOVE CHTP      TCHTP                           S01269
106700200529     C/COPY WNCPYSRC,SE2290C079
106800200529      *                                                                   S01269
106900200529     C*
107000200529     C* SET UP STANDARD ERROR FIELDS AND RETRIEVE TABLE RECORDS
107100200529     C*
107200200529     C           *IN20     IFEQ '0'
107300200529     C***********          MOVE *BLANKS   DBLOT                           S01117
107400200529     C***********          MOVEL'SE2290'  DBPGM                           S01117
107500200529     C***********          MOVE *BLANKS   SECSN  10                       S01117
107600200529     C                     EXSR TITLE                                     S01117
107700200529     C                     EXSR DATARA                                    S01117
107800200529     C***********          EXSR ZSYSTM                                    S01117
107900200529     C************IN99     IFEQ '1'                                       S01117
108000200529     C***********          SETON                     U7U8LR               S01117
108100200529     C***********          MOVE 'TABLE'   DBFILE                          S01117
108200200529     C***********          MOVELZTABKY    DBKEY            ***************S01117
108300200529     C***********          MOVE '01'      DBASE            **DB ERROR 01**S01117
108400200529     C***********          GOTO MEND                       ***************S01117
108500200529     C***********          END                                            S01117
108600200529     C********************************************************************S01117
108700200529     C*
108800200529     C**RETRIEVE*SECOND*TABLE*RECORD**************************************S01117
108900200529     C** RETRIEVE GENERAL LEDGER DETAIL
109000200529     C*
109100200529     C***********          EXSR ZICD2
109200200529     C**********           CALL 'AOGELRR0'                                                    CGL029
109300200529     C                     CALL 'AOGELRR1'                                                    CGL029
109400200529     C                     PARM '*MSG   ' @RTCD   7                       S01117
109500200529     C                     PARM '*FIRST ' @OPTN   7                       S01117
109600200529     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
109700200529     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
109800200529     C*                                                                   S01117
109900200529     C************INU7     IFEQ '1'                                       S01117
110000200529     C           @RTCD     IFNE *BLANK                                    S01117
110100200529     C                     SETON                     U7U8LR
110200200529     C           *LOCK     IN   LDA                                       S01117
110300200529     C***********          MOVE 'TABLE'   DBFILE
110400200529     C***********          MOVELZTABKY    DBKEY
110500200529     C***********          MOVE '02'      DBASE            ***************S01117
110600200529     C                     MOVEL'SDGELRPD'DBFILE                          S01117
110700200529     C                     MOVEL@OPTN     DBKEY            ***************S01117
110800200529     C                     MOVEL@OPTN     DBOPTN  7                       S01117
110900200529     C                     Z-ADD2         DBASE            * DB ERROR 02 *S01117
111000200529     C                     OUT  LDA                        ***************S01117
111100200529     C                     DUMP                                           S01117
111200200529     C                     GOTO MEND
111300200529     C                     END
111400200529     C*
111500200529     C**RETRIEVE*SE*TABLE*RECORD******************************************S01117
111600200529     C*
111700200529     C***********          EXSR ZICDSE
111800200529     C*                                                                   S01117
111900200529     C**   ACCESS SECURITIES TRADING DETAIL                               S01117
112000200529     C                     CALL 'AOSTRDR0'                                S01117
112100200529     C                     PARM '*MSG   ' @RTCD   7                       S01117
112200200529     C                     PARM '*FIRST ' @OPTN   7                       S01117
112300200529     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
112400200529     C*                                                                   S01117
112500200529      *
112600200529     C************INU7     IFEQ '1'                                       S01117
112700200529     C           @RTCD     IFNE *BLANK                                    S01117
112800200529     C                     SETON                     U7U8LR
112900200529     C           *LOCK     IN   LDA                                       S01117
113000200529     C                     MOVEL'SDSTRDPD'DBFILE                          S01117
113100200529     C                     MOVEL@OPTN     DBKEY                           S01117
113200200529     C                     MOVEL@OPTN     DBOPTN  7                       S01117
113300200529     C***********          MOVE 'TABLE'   DBFILE                          S01117
113400200529     C***********          MOVELZTABKY    DBKEY            ***************S01117
113500200529     C***********          MOVE '03'      DBASE            * DB ERROR 03 *S01117
113600200529     C                     Z-ADD3         DBASE            ***************S01117
113700200529     C                     OUT  LDA                                       S01117
113800200529     C                     DUMP                                           S01117
113900200529     C                     GOTO MEND
114000200529     C                     END
114100200529      *                                                                   S01446
114200200529      ** Access switchable features file                                  S01446
114300200529      *                                                                   S01446
114400200529     C                     CALL 'AOSARDR0'                                S01446
114500200529     C                     PARM '       ' @RTCD                           S01446
114600200529     C                     PARM '*VERIFY' @OPTN                           S01446
114700200529     C                     PARM 'S01446'  @SARD   6                       S01446
114800200529     C*                                                                   S01446
114900200529      *                                                                   S01446
115000200529     C           @RTCD     IFEQ *BLANK                                    S01446
115100200529     C                     MOVE 'Y'       S01446  1                       S01446
115200200529     C                     END                                            S01446
115300200529      *                                                                   CSE017
115400200529      **  Determine if feature CSE017 is installed.                       CSE017
115500200529      *                                                                   CSE017
115600200529     C                     MOVE 'N'       CSE017  1                       CSE017
115700200529     C                     CALL 'AOSARDR0'                                CSE017
115800200529     C                     PARM '       ' @RTCD                           CSE017
115900200529     C                     PARM '*VERIFY' @OPTN                           CSE017
116000200529     C                     PARM 'CSE017'  @SARD                           CSE017
116100200529      *                                                                   CSE017
116200200529     C           @RTCD     IFEQ *BLANK                                    CSE017
116300200529     C                     MOVE 'Y'       CSE017                          CSE017
116400200529     C                     ELSE                                           CSE017
116500200529     C                     MOVE 'N'       CSE017                          CSE017
116600200529      *                                                                   CSE017
116700200529      ** Database Error (return code other than *NRF)                     CSE017
116800200529      *                                                                   CSE017
116900200529     C           @RTCD     IFNE '*NRF   '                                 CSE017
117000200529     C           *LOCK     IN   LDA                                       CSE017
117100200529     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE017
117200200529     C                     MOVEL'CSE017'  DBKEY            * DB ERROR 39 *CSE017
117300200529     C                     Z-ADD39        DBASE            ***************CSE017
117400200529     C                     OUT  LDA                                       CSE017
117500200529     C                     MOVE *ON       *INU7                           CSE017
117600200529     C                     MOVE *ON       *INU8                           CSE017
117700200529     C                     MOVE *ON       *INLR                           CSE017
117800200529     C                     EXSR *PSSR                                     CSE017
117900200529     C                     ENDIF                                          CSE017
118000200529      *                                                                   CSE017
118100200529     C                     ENDIF                                          CSE017
118200200529      *                                                                                       CGL020
118300200529      ** Determine if Midas Compliance Watch is installed                                     CGL020
118400200529      *                                                                                       CGL020
118500200529     C                     MOVE 'N'       CGL020  1                                           CGL020
118600200529     C                     CALL 'AOSARDR0'                                                    CGL020
118700200529     C                     PARM '       ' PRTCD   7                                           CGL020
118800200529     C                     PARM '*VERIFY' POPTN   7                                           CGL020
118900200529     C                     PARM 'CGL020'  PSARD   6                                           CGL020
119000200529     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
119100200529      *                                                                                       CGL020
119200200529     C           PRTCD     IFNE *BLANK                                                        CGL020
119300200529     C           PRTCD     ANDNE'*NRF   '                                                     CGL020
119400200529     C           *LOCK     IN   LDA                                                           CGL020
119500200529     C                     MOVEL'SE2290'  DBPGM                                               CGL020
119600200529     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
119700200529     C                     MOVEL'100'     DBASE                                               CGL020
119800200529     C                     MOVELPSARD     DBKEY                                               CGL020
119900200529     C                     MOVE '1'       *INU7                                               CGL020
120000200529     C                     MOVE '1'       *INU8                                               CGL020
120100200529     C                     MOVE '1'       *INLR                                               CGL020
120200200529     C                     OUT  LDA                                                           CGL020
120300200529     C                     DUMP                                                               CGL020
120400200529     C                     RETRN                                                              CGL020
120500200529     C                     ENDIF                                                              CGL020
120600200529      *                                                                                       CGL020
120700200529     C           PRTCD     IFEQ *BLANK                                                        CGL020
120800200529     C                     MOVE 'Y'       CGL020                                              CGL020
120900200529     C                     ENDIF                                                              CGL020
121000200529      ** Check if CSE039 is installed                                     CSE039
121100200529      *                                                                   CSE039
121200200529     C                     CALL 'AOSARDR0'                                CSE039
121300200529     C                     PARM *BLANKS   @RTCD                           CSE039
121400200529     C                     PARM '*VERIFY' @OPTN                           CSE039
121500200529     C                     PARM 'CSE039'  @SARD                           CSE039
121600200529      *                                                                   CSE039
121700200529     C           @RTCD     IFEQ *BLANKS                                   CSE039
121800200529     C                     MOVE 'Y'       CSE039  1                       CSE039
121900200529     C                     ELSE                                           CSE039
122000200529     C                     MOVE 'N'       CSE039                          CSE039
122100200529     C                     ENDIF                                          CSE039
122200200529      *                                                                                       CGL020
122300200529      *                                                                                       CGL031
122400200529      ** Check if Taxation of Savings Income (CGL031) is installed                            CGL031
122500200529      *                                                                                       CGL031
122600200529     C                     MOVE 'N'       CGL031  1                                           CGL031
122700200529     C                     CALL 'AOSARDR0'                                                    CGL031
122800200529     C                     PARM *BLANKS   PRTCD   7                                           CGL031
122900200529     C                     PARM '*VERIFY' POPTN   7                                           CGL031
123000200529     C                     PARM 'CGL031'  PSARD   6                                           CGL031
123100200529     C           SCSARD    PARM SCSARD    DSFDY                                               CGL031
123200200529      *                                                                                       CGL031
123300200529     C           PRTCD     IFEQ *BLANK                                                        CGL031
123400200529     C                     MOVE 'Y'       CGL031                                              CGL031
123500200529     C                     ELSE                                                               CGL031
123600200529     C                     MOVE 'N'       CGL031                                              CGL031
123700200529      *                                                                                       CGL031
123800200529      ** Database Error (return code other than *NRF)                                         CGL031
123900200529      *                                                                                       CGL031
124000200529     C           PRTCD     IFNE '*NRF   '                                                     CGL031
124100200529     C           *LOCK     IN   LDA                                                           CGL031
124200200529     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
124300200529     C                     MOVEL'CGL031'  DBKEY                                               CGL031
124400200529     C                     Z-ADD40        DBASE                                               CGL031
124500200529     C                     OUT  LDA                                                           CGL031
124600200529     C                     MOVE *ON       *INU7                                               CGL031
124700200529     C                     MOVE *ON       *INU8                                               CGL031
124800200529     C                     MOVE *ON       *INLR                                               CGL031
124900200529     C                     EXSR *PSSR                                                         CGL031
125000200529     C                     ENDIF                                                              CGL031
125100200529      *                                                                                       CGL031
125200200529     C                     ENDIF                                                              CGL031
125300200529      *                                                                                       CGL031
125400200529     C/COPY WNCPYSRC,SE2290C076
125500200529     C*                                                                   S01486
125600200529     C**  Get module details using access object                          S01486
125700200529     C*                                                                   S01486
125800200529     C                     CALL 'AOMMODR0'                                S01486
125900200529     C                     PARM *BLANKS   @RTCD                           S01486
126000200529     C                     PARM '*FIRST'  @OPTN                           S01486
126100200529     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
126200200529     C*                                                                   S01486
126300200529     C           @RTCD     IFNE *BLANKS                                   S01486
126400200529     C           *LOCK     IN   LDA                                       S01486
126500200529     C                     Z-ADD25        DBASE            ***************S01486
126600200529     C                     MOVE 'SDMMODPD'DBFILE           * DB ERROR 25 *S01486
126700200529     C                     MOVEL@OPTN     DBKEY            ***************S01486
126800200529     C                     SETON                     U7U8                 S01486
126900200529     C                     OUT  LDA                                       S01486
127000200529     C                     DUMP                                           S01486
127100200529     C                     GOTO MEND                                      S01486
127200200529     C                     END                                            S01486
127300200529      *
127400200529      ** Access SAR details file to see if CSE035 is installed                                CSE035
127500200529      *                                                                                       CSE035
127600200529     C                     CALL 'AOSARDR0'                                                    CSE035
127700200529     C                     PARM '       ' @RTCD   7                                           CSE035
127800200529     C                     PARM '*VERIFY' @OPTN   7                                           CSE035
127900200529     C                     PARM 'CSE035'  WSARD   6                                           CSE035
128000200529      *                                                                                       CSE035
128100200529     C           @RTCD     IFEQ *BLANK                                                        CSE035
128200200529     C                     MOVE 'Y'       CSE035  1                                           CSE035
128300200529     C                     ELSE                                                               CSE035
128400200529     C                     MOVE 'N'       CSE035                                              CSE035
128500200529     C                     ENDIF                                                              CSE035
128600200529      *                                                                                       CAS006
128700200529     C                     CALL 'AOSARDR0'                                                    CAS006
128800200529     C                     PARM *BLANKS   PRTCD   7                                           CAS006
128900200529     C                     PARM '*VERIFY' POPTN   7                                           CAS006
129000200529     C                     PARM 'CAS006'  PSARD   6                                           CAS006
129100200529      *                                                                                       CAS006
129200200529     C           PRTCD     IFNE *BLANKS                                                       CAS006
129300200529     C           PRTCD     ANDNE'*NRF    '                                                    CAS006
129400200529     C           *LOCK     IN   LDA                                                           CAS006
129500200529     C                     MOVE 'SCSARDPD'DBFILE                                              CAS006
129600200529     C                     Z-ADD26        DBASE                                               CAS006
129700200529     C                     MOVEL'CAS006'  DBKEY                                               CAS006
129800200529     C                     MOVE '1'       *INU7                                               CAS006
129900200529     C                     MOVE '1'       *INU8                                               CAS006
130000200529     C                     MOVE '1'       *INLR                                               CAS006
130100200529     C                     OUT  LDA                                                           CAS006
130200200529     C                     EXSR *PSSR                                                         CAS006
130300200529     C                     ENDIF                                                              CAS006
130400200529      *                                                                                       CAS006
130500200529     C           PRTCD     IFEQ *BLANKS                                                       CAS006
130600200529     C                     MOVE 'Y'       CAS006  1                                           CAS006
130700200529     C                     ELSE                                                               CAS006
130800200529     C                     MOVE 'N'       CAS006                                              CAS006
130900200529     C                     ENDIF                                                              CAS006
131000200529      *                                                                                       CAS006
131100200529      *
131200200529     C/COPY WNCPYSRC,SE2290C038
131300200529     C*
131400200529     C* DETERMINE EVENT CONTROL DATE AND CALCULATE BACK VALUE DATE
131500200529     C*
131600200529     C                     Z-ADDBJDNWD    ZZDNWD                          S01117
131700200529     C                     Z-ADDBKAPDT    ZZAPDT                          S01117
131800200529     C*
131900200529     C                     EXSR ZEVCD
132000200529     C***********ECD       SUB  BKVP      BKVD    50                      S01117
132100200529     C           ECD       SUB  BVBVP     BKVD    50                      S01117
132200200529     C           RUND      SUB  31        MTHAGO  50                      E21538
132300200529     C                     SETON                     20
132400200529     C                     END
132500200529     C*
132600200529     C* MOVE SETTLEMENT DETAILS INTO DATA STRUCTURE
132700200529     C*
132800200529     C                     MOVE SMTH      TRSMTH
132900200529     C                     MOVE PYFM      TRPYFM
133000200529     C***********          MOVE PYFB      TRPYFB                          S01117
133100200529     C                     MOVE PYFA      TRPYFA                          S01117
133200200529     C                     MOVE PAYT      TRPAYT
133300200529     C***********          MOVE PYTB      TRPYTB                          S01117
133400200529     C                     MOVE PYTA      TRPYTA                          S01117
133500200529     C                     MOVE ASNM      TRASNM
133600200529     C                     MOVE NOML      TRNOML                          E22485
133700200529     C/COPY WNCPYSRC,SE2290C071
133800200529     C*
133900200529     C* IF TRADE FOR NEW SECURITY RETRIEVE SECURITY RECORD
134000200529     C*
134100200529     C           TDSS      IFNE SECSN
134200200529     C           TDSS      CHAINSECTY                15
134300200529     C                     MOVE RECI      SRECI   1                                          BUG9864
134400200529     C*
134500200529     C* DATABASE ERROR IF RECORD NOT FOUND
134600200529     C*
134700200529     C  N15      RECI      COMP '*'                      15
134800200529     C           *IN15     IFEQ '1'
134900200529     C                     SETON                     U7U8LR
135000200529     C           *LOCK     IN   LDA                                       S01117
135100200529     C                     MOVE 'SECTY'   DBFILE           ***************
135200200529     C                     MOVELTDSS      DBKEY            * DB ERROR 04 *
135300200529     C***********          MOVE '04'      DBASE            ***************S01117
135400200529     C                     Z-ADD4         DBASE                           S01117
135500200529     C                     OUT  LDA                                       S01117
135600200529     C                     DUMP                                           S01117
135700200529     C                     GOTO MEND
135800200529     C                     END
135900200529     C*
136000200529     C* MOVE INFORMATION INTO WORK FIELDS
136100200529     C*
136200200529     C                     MOVE TDSS      SECSN  10
136300200529     C                     MOVE NMCY      SNMCY   3
136400200529     C*                                                                   139104
136500200529     C* Access Currency file to get the number of decimal point for the   139104
136600200529     C* nominal currency.                                                 139104
136700200529     C*                                                                   139104
136800200529     C                     CALL 'AOCURRR0'                                139104
136900200529     C                     PARM '*MSG   ' @RTCD   7                       139104
137000200529     C                     PARM '*KEY   ' @OPTN   7                       139104
137100200529     C                     PARM SNMCY     @AJCD   3                       139104
137200200529     C           SDCURR    PARM SDCURR    DSSDY                           139104
137300200529     C*                                                                   139104
137400200529     C           @RTCD     IFNE *BLANK                                    139104
137500200529     C                     SETON                     U7U8LR               139104
137600200529     C           *LOCK     IN   LDA                                       139104
137700200529     C                     MOVEL'SDCURRPD'DBFILE                          139104
137800200529     C                     MOVE @AJCD     DBKEY                           139104
137900200529     C                     MOVE @OPTN     DBOPTN                          139104
138000200529     C                     Z-ADD38        DBASE                           139104
138100200529     C                     OUT  LDA                                       139104
138200200529     C                     DUMP                                           139104
138300200529     C                     GOTO MEND                                      139104
138400200529     C                     END                                            139104
138500200529     C*
138600200529     C* RETRIEVE INVESTMENT TYPE RECORD - IF NOT THERE DATABASE ERROR
138700200529     C*
138800200529     C           ITKEY     CHAININVTPDF              18
138900200529     C  N18      RECI      COMP 'D'                  1818
139000200529     C           *IN18     IFEQ '1'
139100200529     C                     SETON                     U7U8LR
139200200529     C           *LOCK     IN   LDA                                       S01117
139300200529     C                     MOVE 'INVTP'   DBFILE           ***************
139400200529     C                     MOVELNMCY      KEY6    6        * DB ERROR 09 *
139500200529     C                     MOVE SITP      KEY6             ***************
139600200529     C                     MOVELKEY6      DBKEY
139700200529     C***********          MOVE '09'      DBASE                           S01117
139800200529     C                     Z-ADD9         DBASE                           S01117
139900200529     C                     OUT  LDA                                       S01117
140000200529     C                     DUMP                                           S01117
140100200529     C                     GOTO MEND
140200200529     C                     END
140300200529     C*
140400200529     C/COPY WNCPYSRC,SE2290C072
140500200529     C                     END
140600200529     C*
140700200529     C* SETOF WORK INDICATORS
140800200529     C*
140900200529     C                     SETOF                     212223
141000200529     C********             SETOF                     242526               S01271
141100200529     C                     SETOF                     2425                 S01271
141200200529     C/COPY WNCPYSRC,SE2290C003
141300200529     C*
141400200529     C* RETRIEVE CLIENT RECORD
141500200529     C*
141600200529     C                     MOVE '1'       CRCT
141700200529     C           CLNUM     CHAINCLINTSEF             16
141800200529     C*
141900200529     C* IF NOT FOUND DATABASE ERROR
142000200529     C*
142100200529     C  N16      RECI      COMP 'D'                  1616
142200200529     C           *IN16     IFEQ '1'
142300200529     C           RECI      ANDNE'C'                                                         BUG12826
142400200529     C           TOED      ANDNERUND                                                        BUG12826
142500200529     C                     SETON                     U7U8LR
142600200529     C           *LOCK     IN   LDA                                       S01117
142700200529     C                     MOVE 'CLINT'   DBFILE           ***************
142800200529     C                     MOVELTCNR      KEY7    7        * DB ERROR 05 *
142900200529     C                     MOVE '1'       KEY7             ***************
143000200529     C                     MOVELKEY7      DBKEY
143100200529     C***********          MOVE '05'      DBASE                           S01117
143200200529     C                     Z-ADD5         DBASE                           S01117
143300200529     C                     OUT  LDA                                       S01117
143400200529     C                     DUMP                                           S01117
143500200529     C                     GOTO MEND
143600200529     C                     END
143700200529     C*                                                                   E19284
143800200529     C* SET OFF INDICATOR 50 - AUTO SETTLEMENT FOR TRADE                  E19284
143900200529     C*                                                                   E19284
144000200529     C                     SETOF                         50               E19284
144100200529     C*
144200200529     C* TEST THE ACCOUNT INDICATOR BITS BIT 0 - TRADE DATE ACCOUNTING
144300200529     C*                                 BIT 1 - VALUE DATE ACCOUNTING
144400200529     C/COPY WNCPYSRC,SE2290C004
144500200529     C*
144600200529     C                     TESTB'0'       TACI           21
144700200529     C                     TESTB'1'       TACI           22
144800200529     C/COPY WNCPYSRC,SE2290C005
144900200529     C                     MOVE TACI      WTACI   1
145000200529     C*
145100200529     C* CHECK RECORD ID OF TRADE RECORD AND PROCESS ACCORDINGLY
145200200529     C*
145300200529     C           TRECI     IFEQ 'D'
145400200529     C           TRECI     OREQ 'A'
145500200529     C           TOED      ANDEQRUND
145600200529     C                     EXSR TRADED
145700200529     C                     GOTO NXSR
145800200529     C                     END
145900200529     C*
146000200529     C           TRECI     IFEQ 'A'
146100200529     C           TOED      ANDNERUND
146200200529     C***********          EXSR TRADEA                                    S01269
146300200529     C***********          GOTO NXSR                                      S01269
146400200529     C***********          END                                            S01269
146500200529     C*                                                                   S01269
146600200529     C* RETRIEVE START OF BUSINESS TRADE RECORD - IF NOT THERE            S01269
146700200529     C*          DATABASE ERROR                                           S01269
146800200529     C*                                                                   S01269
146900200529     C           TDRF      CHAINSOBTRDF              17                   S01269
147000200529     C  N17      RECI      COMP '*'                      17               S01269
147100200529     C           *IN17     IFEQ '1'                                       S01269
147200200529     C                     SETON                     U7U8LR               S01269
147300200529     C                     MOVE 'SOBTR'   DBFILE           ***************S01269
147400200529     C                     MOVELTDRF      DBKEY            ** DB ERROR 24 S01269
147500200529     C***********          MOVE '24'      DBASE            ********S01269 S01117
147600200529     C                     Z-ADD24        DBASE                    S01269 S01117
147700200529     C                     GOTO MEND                                      S01269
147800200529     C                     END                                            S01269
147900200529     C                     TESTB'0'       TACI           23               S01269
148000200529     C                     TESTB'1'       TACI           24               S01269
148100200529     C           TDRF      CHAINTRADSDX              17                   S01269
148200200529      *                                                                   S01269
148300200529      *  IF ANY ACCOUNTING DONE BEFORE CHANGE                             S01269
148400200529      *                                                                   S01269
148500200529     C           *IN23     IFEQ '1'                                       S01269
148600200529     C           *IN24     OREQ '1'                                       S01269
148700200529     C                     EXSR TRADEA                                    S01269
148800200529     C                     ELSE                                           S01269
148900200529     C                     EXSR TRADED                                    S01269
149000200529     C                     END                                            S01269
149100200529      *                                                                   S01269
149200200529     C                     END                                            S01269
149300200529     C*
149400200529     C           TRECI     IFEQ 'C'
149500200529     C                     EXSR TRADEC
149600200529     C                     GOTO NXSR
149700200529     C                     END
149800200529     C*
149900200529     C           TRECI     IFEQ 'S'
150000200529     C                     ADD  1         SICNT   50
150100200529     C                     END
150200200529      *                                                                   S01269
150300200529     C           TRECI     IFEQ 'P'                                       S01269
150400200529     C                     EXSR TRADEP                                    S01269
150500200529      *                                                                   S01269
150600200529     C                     END                                            S01269
150700200529      *                                                                   S01269
150800200529     C           TRECI     IFEQ 'L'                                       S01269
150900200529     C                     ADD  1         LICNT   50                      S01269
151000200529     C                     SETON                     2936                 S01269
151100200529     C                     SETOF                     30                   S01269
151200200529     C                     EXSR ACTION                                    S01269
151300200529     C***********TDVD      IFLE DNWD                               S01269 S01117
151400200529     C           TDVD      IFLE BJDNWD                                    S01117
151500200529     C                     SETOF                     29                   S01269
151600200529     C                     SETON                     3036                 S01269
151700200529     C                     EXSR ACTION                                    S01269
151800200529     C                     END                                            S01269
151900200529     C                     END                                            S01269
152000200529      *                                                                   S01269
152100200529     C           TRECI     IFEQ 'R'                                       S01269
152200200529     C                     ADD  1         RICNT   50                      S01269
152300200529     C           TDRF      SETGTTRAUTDF                                   S01269
152400200529     C                     READPTRAUTDF                  17               S01269
152500200529      *                                                                   S01269
152600200529     C           TLCD      IFEQ RUND                                      S01269
152700200529     C*                                                                   S01269
152800200529     C* RETRIEVE START OF BUSINESS TRADE RECORD                           S01269
152900200529     C*                                                                   S01269
153000200529     C           TDRF      CHAINSOBTRDF              17                   S01269
153100200529     C           *IN17     IFEQ '1'                                       S01269
153200200529     C           TDRI      IFEQ 'D'                                       S01269
153300200529     C           TDRI      OREQ 'A'                                       S01269
153400200529     C                     EXSR TRADED                                    S01269
153500200529     C                     END                                            S01269
153600200529     C*                                                                   S01269
153700200529     C                     ELSE                                           S01269
153800200529     C                     TESTB'0'       TACI           23               S01269
153900200529     C                     TESTB'1'       TACI           24               S01269
154000200529     C*                                                                   S01269
154100200529     C           TDRI      IFEQ 'D'                                       S01269
154200200529     C           *IN23     IFEQ '0'                                       S01269
154300200529     C           *IN24     OREQ '0'                                       S01269
154400200529     C           TDRF      CHAINTRADSDX              17                   S01269
154500200529     C                     EXSR TRADED                                    S01269
154600200529     C                     END                                            S01269
154700200529     C                     END                                            S01269
154800200529     C*                                                                   S01269
154900200529     C           TDRI      IFEQ 'P'                                       S01269
155000200529     C           TDRF      CHAINTRADSDX              17                   S01269
155100200529     C                     EXSR TRADEP                                    S01269
155200200529     C                     END                                            S01269
155300200529     C*                                                                   S01269
155400200529     C           TDRI      IFEQ 'A'                                       S01269
155500200529     C           TDRF      CHAINTRADSDX              17                   S01269
155600200529     C           *IN23     IFEQ '1'                                       S01269
155700200529     C           *IN24     OREQ '1'                                       S01269
155800200529     C                     EXSR TRADEA                                    S01269
155900200529     C                     ELSE                                           S01269
156000200529     C                     EXSR TRADED                                    S01269
156100200529     C                     END                                            S01269
156200200529     C                     END                                            S01269
156300200529     C*                                                                   S01269
156400200529     C                     END                                            S01269
156500200529     C*                                                                   S01269
156600200529     C           TDRI      IFEQ 'D'                                       S01269
156700200529     C           TDRI      OREQ 'A'                                       S01269
156800200529     C           TDRI      OREQ 'S'                                       S01269
156900200529     C                     EXSR W05                                       S01269
157000200529     C                     END                                            S01269
157100200529     C*                                                                   S01269
157200200529     C                     ELSE                                           S01269
157300200529      *                                                                   S01269
157400200529     C           TDRI      IFEQ 'L'                                       S01269
157500200529     C                     MOVE ' '       RVLI                            S01269
157600200529     C                     SETOF                     30                   S01269
157700200529     C                     SETON                     2936                 S01269
157800200529     C                     EXSR ACTION                                    S01269
157900200529     C***********TDVD      IFLE DNWD                               S01269 S01117
158000200529     C           TDVD      IFLE BJDNWD                                    S01117
158100200529     C                     SETOF                     29                   S01269
158200200529     C                     SETON                     3036                 S01269
158300200529     C                     EXSR ACTION                                    S01269
158400200529     C                     END                                            S01269
158500200529     C                     END                                            S01269
158600200529      *                                                                   S01269
158700200529     C                     END                                            S01269
158800200529     C                     END                                            S01269
158900200529     C*                                                                   S01269
159000200529     C*
159100200529     C**  CHECK IF PAST BACK VALUE DATE
159200200529     C**  Do not delete if entered in the last 31 days.                   E21538
159300200529     C*
159400200529     C           NXSR      TAG
159500200529     C*
159600200529     C           TDVD      IFGE BKVD
159700200529     C/COPY WNCPYSRC,SE2290C067
159800200529     C           TOED      ORGT MTHAGO                                    E21538
159900200529     C/COPY WNCPYSRC,SE2290C068
160000200529     C*
160100200529     C                     MOVE 'N'       DROP    1                                          BUG9864
160200200529      *                                                                                      BUG9864
160300200529     C           SRECI     IFEQ 'D'                                                          BUG9864
160400200529      *                                                                                      BUG9864
160500200529     C           TRECI     IFNE '*'
160600200529     C                     ADD  1         LAUCNT  50
160700200529     C                     END
160800200529     C                     ELSE                                                              BUG9864
160900200529     C           TRECI     IFEQ 'D'                                                          BUG9864
161000200529     C           TRECI     OREQ 'L'                                                          BUG9864
161100200529     C           TRECI     OREQ 'R'                                                          BUG9864
161200200529     C           TRECI     OREQ 'P'                                                           253841
161300200529     C                     MOVE 'Y'       DROP                                               BUG9864
161400200529     C                     ENDIF                                                             BUG9864
161500200529     C                     ENDIF                                                             BUG9864
161600200529     C*
161700200529     C* IF PAST BACK VALUE DATE WRITE TO HISTORIC TRADE AND ADD TO
161800200529     C*    COUNT OF HISTORIC RECORDS
161900200529     C*    - ONLY IF TRADE FULLY SETTLED                                  E16333
162000200529     C/COPY WNCPYSRC,SE2290C069
162100200529     C*
162200200529     C                     ELSE
162300200529     C                     MOVE 'Y'       DROP                                               BUG9864
162400200529     C                     ENDIF                                                             BUG9864
162500200529     C/COPY WNCPYSRC,SE2290C077
162600200529     C********** TRECI     IFEQ 'S'                                                   E16333 BUG9864
162700200529     C/COPY WNCPYSRC,SE2290C070
162800200529     C********** RUND      ORGT MATY                                                  090247 BUG9864
162900200529     C********** MATY      ANDNE0                                                     169622 BUG9864
163000200529     C**********           MOVE TREC      RECIN                           S01169
163100200529      *                                                                   E19488
163200200529      ***  At this point, the last 67 characters of TREC1 and the         E19488
163300200529      ***  first 67 of TREC2 are redundant.                               E19488
163400200529      ***  Must move them into RECIN separately to overlay correctly.     E19488
163500200529      *                                                                   E19488
163600200529     C***********          MOVELTREC      RECIN                    S01176 E19488
163700200529     C******************** MOVE TREC2     RECIN                    E19488 S01486
163800200529     C******************** MOVELTREC1     RECIN                    E19488 S01486
163900200529     C           DROP      IFEQ 'Y'                                                          BUG9864
164000200529      *                                                                                      BUG9864
164100200529     C                     MOVE TREC3     RECIN3                          S01486
164200200529     C                     MOVE TREC2     RECIN2                          S01486
164300200529     C                     MOVE TREC1     RECIN1                          S01486
164400200529      *                                                                   E19488
164500200529     C                     MOVELTRECI     RECI                            S01169
164600200529     C                     MOVELTTACI     TACI                            S01169
164700200529     C           BGPFMG    IFEQ 'Y'                                       S01486
164800200529     C           BGN4ST    OREQ 'Y'                                       CPB001
164900200529     C                     MOVE PTFR      S1PTFR  4                       S01486
165000200529     C                     MOVE XPTFR     PTFR                            S01486
165100200529     C                     END                                            S01486
165200200529     C                     WRITEHSTTRDF
165300200529     C           BGPFMG    IFEQ 'Y'                                       S01486
165400200529     C           BGN4ST    OREQ 'Y'                                       CPB001
165500200529     C                     MOVE S1PTFR    PTFR                            S01486
165600200529     C                     END                                            S01486
165700200529     C                     ADD  1         HSTCNT  50
165800200529     C           TRECI     IFNE '*'
165900200529     C                     MOVE '*'       TRECI
166000200529     C                     SUB  1         LAUCNT
166100200529     C                     MOVE *BLANKS   PTFR                            080259
166200200529     C                     END
166300200529      *                                                                   S01269
166400200529     C           TDRF      SETLLTRAUTDF                                   S01269
166500200529     C                     SETOF                     09                   S01269
166600200529     C************IN09     DOUEQ'1'                               S01269  E39925
166700200529     C           TDRF      READETRAUTDF                  09               S01269
166800200529     C           *IN09     DOWEQ'0'                                       E39925
166900200529     C                     WRITEHSTAUDF                                   S01269
167000200529     C                     MOVE '*'       RECI                            S01269
167100200529     C                     UPDATTRAUTDF                                   S01269
167200200529     C                     ADD  1         THACNT  50                      S01269
167300200529     C           TDRF      READETRAUTDF                  09               E39925
167400200529     C                     END                                            S01269
167500200529      *                                                                   S01269
167600200529     C                     ELSE                                           E16333
167700200529     C                     ADD  1         LAUCNT                          E16333
167800200529     C                     END                                            E16333
167900200529     C/COPY WNCPYSRC,SE2290C078
168000200529     C**********           END                                                               BUG9864
168100200529     C*
168200200529     C* UPDATE TRADES RECORD
168300200529     C*
168400200529     C***********          MOVE TREC      RECIN                           S01169
168500200529      *                                                                   E19488
168600200529      ***  Move last 67 characters of TREC1 and the first 67 of TREC2     E19488
168700200529      ***  into RECIN separately to overlay correctly.                    E19488
168800200529      *                                                                   E19488
168900200529     C***********          MOVELTREC      RECIN                    S01176 E19488
169000200529     C******************** MOVE TREC2     RECIN                    E19488 S01486
169100200529     C******************** MOVELTREC1     RECIN                    E19488 S01486
169200200529     C                     MOVE TREC3     RECIN3                          S01486
169300200529     C                     MOVE TREC2     RECIN2                          S01486
169400200529     C                     MOVE TREC1     RECIN1                          S01486
169500200529      *                                                                   E19488
169600200529     C                     MOVELTRECI     RECI                            S01169
169700200529     C                     MOVELTTACI     TACI                            S01169
169800200529     C           TRECI     IFEQ '*'
169900200529     C                     ADD  1         DAUCNT  50
170000200529     C                     END
170100200529     C*                                                                   S01176
170200200529     C** IF AUTO-SETTLEMENT WAS DONE FOR THE CURRENT TRADE UPDATE THE     S01176
170300200529     C** FOLLOWING FIELDS ON TRADSD                                       S01176
170400200529     C*                                                                   S01176
170500200529     C           *IN50     IFEQ '1'                                       S01176
170600200529     C*                                                                   S01176
170700200529     C** SEQ. NO. TO SEQ NO. + 1                                          S01176
170800200529     C** DATE FULLY SETTLED TO TRADE VALUE DATE                           S01176
170900200529     C** NOMINAL SETTLED NP TO OUTSTANDING NOMINAL                        S01176
171000200529     C** VALUE SETTLED NP TO OUTSTANDING NOMINAL                          S01176
171100200529     C** OUTSTANDING NOMINAL TO ZERO                                      S01176
171200200529     C** OUTSTANDING VALUE TO ZERO                                        S01176
171300200529     C** AUTO-SETTLEMENT IND. SET TO 'N'                                  S01176
171400200529     C*                                                                   S01176
171500200529     C                     ADD  1         TSSQ                            S01176
171600200529     C                     Z-ADDTDVD      TDFS                            S01176
171700200529     C                     Z-ADDTOSN      TNSN                            S01176
171800200529     C                     Z-ADDTOSV      TVSN                            S01176
171900200529     C                     Z-ADD0         TOSN                            S01176
172000200529     C                     Z-ADD0         TOSV                            S01176
172100200529     C                     MOVE 'N'       AUTS                            S01176
172200200529     C*                                                                   S01176
172300200529     C                     END                                            S01176
172400200529     C*                                                                   S01176
172500200529     C                     UPDATTRADSDF
172600200529     C/COPY WNCPYSRC,SE2290C047
172700200529     C*
172800200529     C           MEND      TAG
172900200529      *
173000200529      *================================================================
173100200529      *  P R O G R A M   E N D                                        *
173200200529      *                                                               *
173300200529     CLR                   EXSR AUDIT
173400200529      *                                                               *
173500200529      *================================================================
173600200529      /EJECT
173700200529     C*****************************************************************
173800200529     C*                                                               *
173900200529     C**TRADED*-*PROCESS*TRADE*WITH*RED*ID*=*D*******                     S01269
174000200529     C* TRADED - Process trade with:                                      S01269
174100200529     C*                                                                   S01269
174200200529     C* REC ID = D - live and authorised                                  S01269
174300200529     C* REC ID = A - amended and authorised and entered today             S01269
174400200529     C*                                                                   S01269
174500200529     C*****************************************************************
174600200529     C*
174700200529     C           TRADED    BEGSR                           ** TRADED **
174800200529     C*
174900200529     C* ADD TO COUNT OF RECORD TYPE AND CHECK VALUE DATE ACCOUNTING
175000200529     C*
175100200529     C           TRECI     IFNE 'R'                                       S01269
175200200529     C                     ADD  1         DICNT   50
175300200529     C                     END                                            S01269
175400200529     C           *IN22     IFEQ '0'
175500200529     C*
175600200529     C***CHECK*INCOMPLETE*INDICATOR*******                                S01271
175700200529     C** (NOTE - INCOMPLETE TRADES ARE EXCLUDED IN CALLING PROCESS)       S01271
175800200529     C*
175900200529     C********** TINC      IFEQ 'I'
176000200529     C********** SMTH      IFEQ *ZEROS
176100200529     C******                                                              S01271
176200200529     C******     TINC      IFEQ 'I'                                       S01271
176300200529     C******                                                              S01271
176400200529     C**IF*LAST*CHANGE*DATE*=*RUN*DATE*OUTPUT*TELEX*EXTRACT****           S01271
176500200529     C******                                                              S01271
176600200529     C********** TLCD      ANDEQRUND
176700200529     C******     TLCD      IFEQ RUND                                      S01271
176800200529     C******               EXSR TELEX                                     S01271
176900200529     C******               END                                            S01271
177000200529     C******               ELSE                                           S01271
177100200529     C*
177200200529     C* PERFORM ACCOUNTING PROCESS FOR THIS TRADE
177300200529     C*
177400200529     C                     EXSR ACC
177500200529     C*
177600200529     C* UPDATE REC ID if processing fully amended trade entered today
177700200529     C*
177800200529     C           TRECI     IFEQ 'A'
177900200529     C                     MOVE 'D'       TRECI
178000200529     C                     END
178100200529     C*
178200200529     C***********          END                                            S01271
178300200529     C*
178400200529     C                     END
178500200529     C*
178600200529     C* CHECK DISCRECTIONARY IND = I AND VALUE DATE ACCOUNTING DONE
178700200529     C*       RESET REC ID AND ADD TO COUNT
178800200529     C*
178900200529     C           C1DI      IFEQ 'I'
179000200529     C           *IN22     ANDEQ'1'
179100200529     C                     MOVE 'S'       TRECI
179200200529     C                     ADD  1         FSCNT   50
179300200529     C                     END
179400200529     C*
179500200529     C                     ENDSR
179600200529      *
179700200529      *****************************************************************
179800200529      /EJECT
179900200529      *****************************************************************
180000200529      *                                                               *
180100200529      * TRADEA - PROCESS TRADE WITH RED ID = A                        *
180200200529      *                                                               *
180300200529      *****************************************************************
180400200529      *
180500200529     C           TRADEA    BEGSR                           ** TRADEA **
180600200529     C*
180700200529     C**ADD*TO*COUNT*FOR*THIS*RECORD*TYPE*AND*CHECK*INCOMPLETE*IND****    S01271
180800200529     C*********OUTPUT*TELEX*EXTRACT*IF*INCOMPLETE**********               S01271
180900200529     C*********                                                           S01271
181000200529     C*********            ADD  1         AICNT   50                      S01271
181100200529     C********** TINC      IFEQ 'I'
181200200529     C********** SMTH      IFEQ *ZEROS
181300200529     C*********  TINC      IFEQ 'I'                                       S01271
181400200529     C*********            EXSR TELEX                                     S01271
181500200529     C*********                                                           S01271
181600200529     C**ELSE*DO*ACCOUNTING*PROCESSING*FOR*THIS*TRADE*****                 S01271
181700200529     C*********                                                           S01271
181800200529     C*********            ELSE                                           S01271
181900200529     C*********            EXSR ACC                                       S01271
182000200529     C*********            END                                            S01271
182100200529     C*                                                                   S01271
182200200529     C* ADD TO COUNT FOR THIS RECORD TYPE                                 S01271
182300200529     C*                                                                   S01271
182400200529     C                     ADD  1         AICNT   50                      S01271
182500200529     C*                                                                   165636
182600200529     C** Flag TRADEA as the calling subr. for use in ACCREV               165636
182700200529     C*                                                                   165636
182800200529     C                     MOVE 'A'       @SUBR                           165636
182900200529     C*                                                                   S01271
183000200529     C* DO ACCOUNTING PROCESSING FOR THIS TRADE                           S01271
183100200529     C*                                                                   S01271
183200200529     C                     EXSR ACC                                       S01271
183300200529     C*
183400200529     C* UPDATE REC ID
183500200529     C*
183600200529     C           TRECI     IFEQ 'A'                                       S01269
183700200529     C                     MOVE 'D'       TRECI
183800200529     C                     END                                            S01269
183900200529      *                                                                   S01269
184000200529     C***********AUTT      IFNE '00'                               S01269 S01117
184100200529     C           BVAUTH    IFNE '00'                                      S01117
184200200529      *                                                                   S01269
184300200529     C           TDRF      SETGTTRAUT                                     S01269
184400200529      *                                                                   S01269
184500200529     C           TATYP     DOUEQ'AM'                                      S01269
184600200529     C           TATYP     OREQ 'CH'                                      S01269
184700200529     C                     READPTRAUTDF                  09               S01269
184800200529      *                                                                   S01269
184900200529     C           *IN09     IFEQ '1'                                       S01269
185000200529     C           TDRF      ORNE TRDRF                                     S01269
185100200529     C                     SETON                     U7U8LR               S01269
185200200529     C                     MOVE 'TRAUT'   DBFILE           ***************S01269
185300200529     C                     MOVELTDRF      DBKEY            * DB ERROR 21 *S01269
185400200529     C***********          MOVE '21'      DBASE            ********S01269 S01117
185500200529     C                     Z-ADD21        DBASE                    S01269 S01117
185600200529     C                     GOTO MEND                                      S01269
185700200529     C                     END                                            S01269
185800200529      *                                                                   S01269
185900200529     C                     END                                            S01269
186000200529      *                                                                   S01269
186100200529     C           TADT      IFLT RUND                                      S01269
186200200529     C                     GOTO ENDTA                                     S01269
186300200529     C                     END                                            S01269
186400200529      *                                                                   S01269
186500200529     C                     END                                            S01269
186600200529     C*
186700200529     C* RETRIEVE START OF BUSINESS TRADE RECORD - IF NOT THERE
186800200529     C*          DATABASE ERROR
186900200529     C*
187000200529     C           TDRF      CHAINSOBTRDF              17
187100200529     C  N17      RECI      COMP '*'                      17
187200200529     C           *IN17     IFEQ '1'
187300200529     C                     SETON                     U7U8LR
187400200529     C           *LOCK     IN   LDA                                       S01117
187500200529     C                     MOVE 'SOBTR'   DBFILE           ***************
187600200529     C                     MOVELTDRF      DBKEY            * DB ERROR 06 *
187700200529     C***********          MOVE '06'      DBASE            ***************S01117
187800200529     C                     Z-ADD6         DBASE                           S01117
187900200529     C                     OUT  LDA                                       S01117
188000200529     C                     DUMP                                           S01117
188100200529     C                     GOTO MEND
188200200529     C                     END
188300200529     C*
188400200529     C* MOVE RECORD INTO DATASTRUCTURE TO PRESERVE FIELDS
188500200529     C*      AND DO REVERSAL ACCOUNTING IF NECESSARY
188600200529     C*
188700200529     C***********          TESTB'0'       WTACI          41               E14550
188800200529     C************IN41     IFEQ '1'                                       E14550
188900200529     C*
189000200529     C**********           MOVE RECIN     SREC                            S01169
189100200529     C**********           MOVELRECIN     SREC                     S01169 S01176
189200200529     C******************** MOVELRECIN     SREC1                    S01176 S01486
189300200529     C******************** MOVE RECIN     SREC2                    S01176 S01486
189400200529     C                     MOVE RECIN1    SREC1                           S01486
189500200529     C                     MOVE RECIN2    SREC2                           S01486
189600200529     C                     MOVE RECIN3    SREC3                           S01486
189700200529     C*                                                                   S01176
189800200529     C** STORE FIELD DETAILS FROM SOBTRD                                  S01176
189900200529     C** DELIVER FROM                                                     S01176
190000200529     C** DELIVER TO                                                       S01176
190100200529     C*                                                                   S01176
190200200529     C           *LIKE     DEFN DELF      SDELF                           S01176
190300200529     C                     MOVE DELF      SDELF                           S01176
190400200529     C           *LIKE     DEFN DELT      SDELT                           S01176
190500200529     C                     MOVE DELT      SDELT                           S01176
190600200529     C           *LIKE     DEFN TDBK      STDBK                           S01176
190700200529     C                     MOVE TDBK      STDBK                           S01176
190800200529     C************LIKE     DEFN TDBR      STDBR                    S01176 S01117
190900200529     C***********          MOVE TDBR      STDBR                    S01176 S01117
191000200529     C           *LIKE     DEFN TDBA      STDBR                           S01117
191100200529     C                     MOVE TDBA      STDBR                           S01117
191200200529     C           *LIKE     DEFN TDDT      STDDT                           S01176
191300200529     C                     MOVE TDDT      STDDT                           S01176
191400200529     C           *LIKE     DEFN TDMI      STDMI                           S01176
191500200529     C                     MOVE TDMI      STDMI                           S01176
191600200529     C           *LIKE     DEFN TDVD      STDVD                           S01176
191700200529     C                     MOVE TDVD      STDVD                           S01176
191800200529     C           *LIKE     DEFN PRIC      SPRIC                           E19332
191900200529     C                     MOVE PRIC      SPRIC                           E19332
192000200529     C           *LIKE     DEFN NOML      SNOML                           E22485
192100200529     C                     MOVE NOML      SNOML                           E22485
192200200529     C*                                                                   S01176
192300200529     C                     TESTB'0'       TACI           23
192400200529     C                     TESTB'1'       TACI           24
192500200529     C/COPY WNCPYSRC,SE2290C006
192600200529     C           *IN23     IFEQ '1'
192700200529     C************IN29     ANDNE'1'                                109058 125968
192800200529     C***********          SETON                     26                   S01271
192900200529     C***********          EXSR TELEX                                     S01271
193000200529     C                     EXSR ACCREV
193100200529     C                     END
193200200529     C/COPY WNCPYSRC,SE2290C007
193300200529     C*
193400200529     C* OUTPUT RECORD TO CANCELLED TRADES FILE, ADD TO COUNT
193500200529     C*        RESTORE TRADE RECORD TO PROCESSING AREA
193600200529     C*
193700200529     C**********           MOVE SREC      RECIN                           S01169
193800200529      *                                                                   E19488
193900200529      ***  At this point, the last 67 characters of SREC1 and the         E19488
194000200529      ***  first 67 of SREC2 are redundant.                               E19488
194100200529      ***  Must move them into RECIN separately to overlay correctly.     E19488
194200200529      *                                                                   E19488
194300200529     C***********          MOVELSREC      RECIN                    S01176 E19488
194400200529     C******************** MOVE SREC2     RECIN                    E19488 S01486
194500200529     C******************** MOVELSREC1     RECIN                    E19488 S01486
194600200529     C                     MOVE SREC3     RECIN3                          S01486
194700200529     C                     MOVE SREC2     RECIN2                          S01486
194800200529     C                     MOVE SREC1     RECIN1                          S01486
194900200529      *                                                                   E19488
195000200529     C                     MOVE 'C'       RECI                            E16848
195100200529     C                     MOVEASTAMP,1   TMST             Default Timestamp                  CPK015
195200200529     C                     WRITECNCTRDF
195300200529     C/COPY WNCPYSRC,SE2290C008
195400200529     C                     ADD  1         CNCCNT  50
195500200529     C**********           MOVE TREC      RECIN                           S01169
195600200529      *                                                                   E19488
195700200529      ***  Move last 67 characters of TREC1 and the first 67 of TREC2     E19488
195800200529      ***  into RECIN separately to overlay correctly.                    E19488
195900200529      *                                                                   E19488
196000200529     C***********          MOVELTREC      RECIN                    S01176 E19488
196100200529     C******************** MOVE TREC2     RECIN                    E19488 S01486
196200200529     C******************** MOVELTREC1     RECIN                    E19488 S01486
196300200529     C                     MOVE TREC3     RECIN3                          S01486
196400200529     C                     MOVE TREC2     RECIN2                          S01486
196500200529     C                     MOVE TREC1     RECIN1                          S01486
196600200529      *                                                                   E19488
196700200529     C                     MOVELTRECI     RECI                            S01176
196800200529     C                     MOVELTTACI     TACI                            S01176
196900200529     C*
197000200529     C**********           END                                            E14550
197100200529     C*
197200200529     C*********            ENDSR                                          S01269
197300200529     C*                                                                   S01269
197400200529     C           ENDTA     ENDSR                                          S01269
197500200529      *
197600200529      *****************************************************************
197700200529      /EJECT
197800200529      *****************************************************************
197900200529      *                                                               *
198000200529      * TRADEC - PROCESS TRADE WITH RED ID = C                        *
198100200529      *                                                               *
198200200529      *****************************************************************
198300200529      *
198400200529     C           TRADEC    BEGSR                           ** TRADEC **
198500200529     C*
198600200529     C* ADD TO COUNT OF CANCELLED RECORDS
198700200529     C*
198800200529     C                     ADD  1         CICNT   50
198900200529     C*                                                                   E16819
199000200529     C* FETCH START OF BUSINESS DETAILS, BUT NO D/B ERROR IF NOT FOUND    E16819
199100200529     C* AS TRADE MAY HAVE BEEN ENTERED AND CANCELLED TODAY.               E16819
199200200529     C*
199300200529     C           TDRF      CHAINSOBTRDF              17                   E16819
199400200529     C*                                                                   E16819
199500200529     C* IF TRADE DATE PROCESSING DONE PERFORM REVERSAL ACCOUNTING
199600200529     C*
199700200529     C********** *IN21     IFEQ '1'                                       E16819
199800200529     C                     TESTB'0'       TACI           23               E16819
199900200529     C                     TESTB'1'       TACI           24               E16819
200000200529     C/COPY WNCPYSRC,SE2290C009
200100200529     C           *IN23     IFEQ '1'                                       E16819
200200200529     C*********            SETON                     26                   S01271
200300200529     C*********            EXSR TELEX                                     S01271
200400200529     C                     EXSR ACCREV
200500200529     C                     END
200600200529     C/COPY WNCPYSRC,SE2290C010
200700200529     C*
200800200529     C* OUTPUT TO CANCELLED TRADES AND ADD TO COUNT
200900200529     C*
201000200529     C**********           MOVE TREC      RECIN                           S01169
201100200529      *                                                                   E19488
201200200529      ***  Move last 67 characters of TREC1 and the first 67 of TREC2     E19488
201300200529      ***  into RECIN separately to overlay correctly.                    E19488
201400200529      *                                                                   E19488
201500200529     C***********          MOVELTREC      RECIN                    S01176 E19488
201600200529     C*                                                                   E22485
201700200529     C*** Cancelled record should be as at SOB if it exists               E22485
201800200529     C*                                                                   E22485
201900200529     C***********          MOVE TREC2     RECIN                    E19488 E22485
202000200529     C***********          MOVELTREC1     RECIN                    E19488 E22485
202100200529      *                                                                   E19488
202200200529     C                     MOVE 'C'       RECI                            E16848
202300200529     C                     MOVEASTAMP,1   TMST             Default Timestamp                  CPK015
202400200529     C                     WRITECNCTRDF
202500200529     C/COPY WNCPYSRC,SE2290C011
202600200529     C                     ADD  1         CNCCNT
202700200529     C******************** MOVE TREC2     RECIN                    E22485 S01486
202800200529     C******************** MOVELTREC1     RECIN                    E22485 S01486
202900200529     C                     MOVE TREC3     RECIN3                          S01486
203000200529     C                     MOVE TREC2     RECIN2                          S01486
203100200529     C                     MOVE TREC1     RECIN1                          S01486
203200200529      *
203300200529     C                     MOVE '*'       TRECI
203400200529     C*
203500200529     C*
203600200529     C/COPY WNCPYSRC,SE2290CCP1
203700200529     C*
203800200529     C                     ENDSR
203900200529      *                                                                   S01269
204000200529      *****************************************************************   S01269
204100200529      /EJECT                                                              S01269
204200200529      *****************************************************************   S01269
204300200529      *                                                                   S01269
204400200529      * TRADEP - PROCESS:  Trade, changed but awaiting authorisation      S01269
204500200529      *          FOR EACH: Trade with Record ID = P                       S01269
204600200529      *          WHEN:     Called from P/TRADE                            S01269
204700200529      *                                                                   S01269
204800200529      *****************************************************************   S01269
204900200529      *                                                                   S01269
205000200529     C           TRADEP    BEGSR                           ** TRADEP **   S01269
205100200529      *                                                                   S01269
205200200529      * Add 1 to count for this record ID                                 S01269
205300200529      *                                                                   S01269
205400200529     C                     ADD  1         PICNT   50                      S01269
205500200529      *                                                                   S01269
205600200529      *  produce trade actions sequence '11' for next days enquiries      S01269
205700200529      *                                                                   S01269
205800200529     C                     SETON                     2936                 S01269
205900200529     C                     SETOF                     30                   S01269
206000200529     C                     EXSR ACTION                                    S01269
206100200529     C***********TDVD      IFLE DNWD                               S01269 S01117
206200200529     C           TDVD      IFLE BJDNWD                                    S01117
206300200529     C                     SETOF                     29                   S01269
206400200529     C                     SETON                     3036                 S01269
206500200529     C                     EXSR ACTION                                    S01269
206600200529     C                     END                                            S01269
206700200529      *                                                                   S01269
206800200529     C           TLCD      IFEQ RUND                                      S01269
206900200529     C           TOED      ANDNERUND                                      S01269
207000200529      *                                                                   S01269
207100200529      * Access Start of Business version of this Trade (same trade ref)   S01269
207200200529      *    If not found - database error                                  S01269
207300200529      *                                                                   S01269
207400200529     C           TDRF      CHAINSOBTRDF              17                   S01269
207500200529      *                                                                   S01269
207600200529     C           *IN17     IFEQ '1'                                       S01269
207700200529     C                     SETON                     U7U8LR               S01269
207800200529     C                     MOVE 'SOBTR'   DBFILE           ***************S01269
207900200529     C                     MOVELTDRF      DBKEY            * DB ERROR 22 *S01269
208000200529     C***********          MOVE '22'      DBASE            ********S01269 S01117
208100200529     C                     Z-ADD22        DBASE                    S01269 S01117
208200200529     C                     GOTO MEND                                      S01269
208300200529     C                     END                                            S01269
208400200529      *                                                                   S01269
208500200529     C                     TESTB'0'       TACI           23               S01269
208600200529     C                     TESTB'1'       TACI           24               S01269
208700200529     C/COPY WNCPYSRC,SE2290C012
208800200529     C           *IN23     IFEQ '1'                                       S01269
208900200529      *                                                                   S01269
209000200529      * Move record into data structure to preserve fields                S01269
209100200529      *                                                                   S01269
209200200529     C******************** MOVELRECIN     SREC1                    S01269 S01486
209300200529     C******************** MOVE RECIN     SREC2                    S01269 S01486
209400200529     C                     MOVE RECIN1    SREC1                           S01486
209500200529     C                     MOVE RECIN2    SREC2                           S01486
209600200529     C                     MOVE RECIN3    SREC3                           S01486
209700200529      *                                                                   S01269
209800200529      * Store field details from SOBTRD                                   S01269
209900200529      * Deliver from                                                      S01269
210000200529      * Deliver to                                                        S01269
210100200529      *                                                                   S01269
210200200529     C                     MOVE DELF      SDELF                           S01269
210300200529     C                     MOVE DELT      SDELT                           S01269
210400200529     C                     MOVE TDBK      STDBK                           S01269
210500200529     C***********          MOVE TDBR      STDBR                    S01269 S01117
210600200529     C                     MOVE TDBA      STDBR                    S01269 S01117
210700200529     C                     MOVE TDDT      STDDT                           S01269
210800200529     C                     MOVE TDMI      STDMI                           S01269
210900200529     C                     MOVE TDVD      STDVD                           S01269
211000200529     C                     MOVE PRIC      SPRIC                           S01269
211100200529      *                                                                   S01269
211200200529      *   do reversal accounting                                          S01269
211300200529      *                                                                   S01269
211400200529     C                     EXSR ACCREV                                    S01269
211500200529     C/COPY WNCPYSRC,SE2290C013
211600200529      *                                                                   S01269
211700200529      * Copy SOB trade to CANCELLED TRADES FILE (all data unchanged)      S01269
211800200529      * ADD 1 to count of records transferred to cancelled trades         S01269
211900200529      * Restore trade record to processing area                           S01269
212000200529      *                                                                   S01269
212100200529     C******************** MOVE SREC2     RECIN                    S01269 S01486
212200200529     C******************** MOVELSREC1     RECIN                    S01269 S01486
212300200529     C                     MOVE SREC1     RECIN1                          S01486
212400200529     C                     MOVE SREC2     RECIN2                          S01486
212500200529     C                     MOVE SREC3     RECIN3                          S01486
212600200529     C                     MOVE 'C'       RECI                            S01269
212700200529     C                     MOVEASTAMP,1   TMST             Default Timestamp                  CPK015
212800200529     C                     WRITECNCTRDF                                   S01269
212900200529     C/COPY WNCPYSRC,SE2290C014
213000200529      *                                                                   S01269
213100200529     C                     ADD  1         CNCCNT                          S01269
213200200529      *                                                                   S01269
213300200529     C***********          MOVE TREC2     RECIN                     S01269E35978
213400200529     C***********          MOVELTREC1     RECIN                     S01269E35978
213500200529     C***********          MOVELTRECI     RECI                      S01269E35978
213600200529     C***********          MOVELTTACI     TACI                      S01269E35978
213700200529     C******************** MOVE SREC2     RECIN                    E35978 S01486
213800200529     C******************** MOVELSREC1     RECIN                    E35978 S01486
213900200529     C                     MOVE SREC1     RECIN1                          S01486
214000200529     C                     MOVE SREC2     RECIN2                          S01486
214100200529     C                     MOVE SREC3     RECIN3                          S01486
214200200529      *                                                                   S01269
214300200529      * Write record to PF/TRATXD as per W05                              S01269
214400200529      *                                                                   S01269
214500200529     C                     EXSR W05                                       S01269
214600200529      *                                                                   S01269
214700200529     C******************** MOVE TREC2     RECIN                    E35978 S01486
214800200529     C******************** MOVELTREC1     RECIN                    E35978 S01486
214900200529     C                     MOVE TREC1     RECIN1                          S01486
215000200529     C                     MOVE TREC2     RECIN2                          S01486
215100200529     C                     MOVE TREC3     RECIN3                          S01486
215200200529     C                     MOVELTRECI     RECI                            E35978
215300200529     C                     MOVELTTACI     TACI                            E35978
215400200529     C                     END                                            S01269
215500200529     C                     END                                            S01269
215600200529      *                                                                   S01269
215700200529     C                     ENDSR                                          S01269
215800200529      *                                                                   S01269
215900200529      *
216000200529      *****************************************************************
216100200529      /EJECT
216200200529      *****************************************************************
216300200529      *                                                               *
216400200529      * ACC - PERFORM ACCOUNTING FOR COMPLETE TRADES                  *
216500200529      *                                                               *
216600200529      *****************************************************************
216700200529      *
216800200529     C           ACC       BEGSR                           **  ACC **
216900200529     C*
217000200529     C/COPY WNCPYSRC,SE2290C015
217100200529     C**IF*TRADE*DATE*PROCESSING*NOT*DONE*PERFORM*TELEX*EXTRACT*AND***    S01271
217200200529     C*****TRADE*ACTIONS*AND*ACCOUNT*KEYS********                         S01271
217300200529     C*                                                                   S01271
217400200529     C* IF TRADE DATE PROCESSING NOT DONE DO TRADE ACTIONS AND ACCNT KEYS S01271
217500200529     C*
217600200529     C           *IN21     IFEQ '0'
217700200529     C                     SETON                     29
217800200529     C                     SETOF                     30
217900200529     C***********          EXSR TELEX                                     S01271
218000200529     C                     EXSR ACTION
218100200529     C                     MOVE '0'       RVRS                            E16800
218200200529     C                     EXSR ACKEY
218300200529     C                     BITON'0'       TTACI
218400200529     C/COPY WNCPYSRC,SE2290C016
218500200529     C                     END
218600200529     C/COPY WNCPYSRC,SE2290C017
218700200529     C*
218800200529     C* IF VALUE DATE ACCOUNTING NOT DONE OUTPUT TRADE ACTIONS AND
218900200529     C*    ACCOUNT KEY GENERATION
219000200529     C*
219100200529     C           *IN22     IFEQ '0'
219200200529     C           TDVD      ANDLEECD
219300200529     C                     SETON                     30
219400200529     C                     SETOF                     29
219500200529     C                     EXSR ACTION
219600200529     C                     MOVE '0'       RVRS                            E16800
219700200529     C                     EXSR ACKEY
219800200529     C                     BITON'1'       TTACI
219900200529     C           C1DI      IFEQ 'I'
220000200529     C           LKRF      ANDNE*BLANKS                                                       223183
220100200529     C                     MOVE 'D'       RECI
220200200529     C                     MOVE TOED      ORED
220300200529     C                     MOVE ' '       SRIN
220400200529     C                     WRITEASTACDF
220500200529     C                     ADD  1         ASTCNT  50
220600200529     C                     END
220700200529     C***********                                                         S01176
220800200529     C**IF*DISCRETIONARY*IND*=*M*AND*TS*TRADE*OUTPUT*CONTINGENT********   S01176
220900200529     C*****LIABILITIES*RECORD******************************************   S01176
221000200529     C***********                                                         S01176
221100200529     C***********C1DI      IFEQ 'M'                                       S01176
221200200529     C***********TDTP      ANDEQ'TS'                                      S01176
221300200529     C***********          MOVE 'D'       RECI                            S01176
221400200529     C***********          WRITECLIABDF                                   S01176
221500200529     C***********          ADD  1         CLBADD  50                      S01176
221600200529     C***********          END                                            S01176
221700200529     C*                                                                   S01176
221800200529     C* IF DISCRETIONARY IND = M AND THE CONTINGENT LIABILITY IND.        S01176
221900200529     C* (SECTYD) FOR SECURITY ='Y' OUTPUT CONTINGENT LIABILITY RECORD     S01176
222000200529     C*                                                                   S01176
222100200529     C           C1DI      IFEQ 'M'                                       S01176
222200200529     C           TDTP      ANDEQ'TS'                                      S01176
222300200529     C           CNLI      ANDEQ'Y'                                       S01176
222400200529     C           TCNR      ANDNEISSR                                      E19832
222500200529     C                     MOVE 'D'       RECI                            S01176
222600200529     C                     WRITECLIABDF                                   S01176
222700200529     C                     ADD  1         CLBADD  50                      S01176
222800200529     C                     END                                            S01176
222900200529     C*                                                                   S01176
223000200529     C** RESET PROGRAM INDICATOR ,WHICH IS ONLY SETON IF THE     .        S01176
223100200529     C** AUTO SETTLEMENT INDICATOR IS 'Y' FOR THE CURRENT TRADE           S01176
223200200529     C*                                                                   S01176
223300200529     C                     SETOF                     50                   S01176
223400200529     C*                                                                   S01176
223500200529     C* IF THE AUTO- SETTLE INDICATOR ON THE TRADE IS 'Y'        .        S01176
223600200529     C* OUTPUT A TRADE SETTLEMENT DETAIL RECORD                           S01176
223700200529     C*                                                                   S01176
223800200529     C           TAUTS     IFEQ 'Y'                                       S01176
223900200529     C*                                                                   S01176
224000200529     C** SET PROGRAM INDICATOR, WHICH IS ONLY SETON IF THE     .          S01176
224100200529     C** AUTO SETTLEMENT INDICATOR IS 'Y' FOR THE CURRENT TRADE           S01176
224200200529     C*                                                                   S01176
224300200529     C                     SETON                     50                   S01176
224400200529     C*                                                                   S01176
224500200529     C** RESTORES ORIGINAL TRADE DETAILS FROM STORED COPY         .       S01176
224600200529      *                                                                   E19488
224700200529      ***  Move last 67 characters of TREC1 and the first 67 of TREC2     E19488
224800200529      ***  into RECIN separately to overlay correctly.                    E19488
224900200529      *                                                                   E19488
225000200529     C***********          MOVE TREC      RECIN                    S01176 E19488
225100200529     C*                                                                   E19488
225200200529     C******************** MOVE TREC2     RECIN                    E19488 S01486
225300200529     C******************** MOVELTREC1     RECIN                    E19488 S01486
225400200529     C                     MOVE TREC3     RECIN3                          S01486
225500200529     C                     MOVE TREC2     RECIN2                          S01486
225600200529     C                     MOVE TREC1     RECIN1                          S01486
225700200529     C*                                                                   S01176
225800200529     C** OUTPUT TRADE SETTLEMENT DETAIL RECORD                            S01176
225900200529     C*                                                                   S01176
226000200529     C                     MOVE 'D'       RECI                            S01176
226100200529     C                     MOVE TDRF      STDR                            S01176
226200200529     C                     Z-ADDTSSQ      SSQN                            S01176
226300200529     C                     ADD  1         SSQN                            S01176
226400200529     C***********          Z-ADDTDBR      SBCD                     S01176 S01117
226500200529     C                     MOVE TDBA      SBCA                            S01117
226600200529     C                     Z-ADDTDVD      SEDE                            S01176
226700200529     C                     MOVE 'Y'       SFSI                            S01176
226800200529     C                     MOVE *BLANK    SRIN                            S01176
226900200529     C                     Z-ADDTOSN      SNMS                            S01176
227000200529     C                     Z-ADDTOSV      SVLS                            S01176
227100200529     C                     MOVE *BLANK    SSRF                            S01176
227200200529     C                     MOVELNAR,1     SNTV                            S01176
227300200529     C                     MOVE *BLANK    SRSL                            S01176
227400200529     C                     MOVE 'F'       SFSL                            S01176
227500200529     C                     MOVE 'F'       SNFS                            S01176
227600200529     C                     MOVE *BLANK    SOSI                            S01176
227700200529     C                     MOVE *BLANK    SDSI                            S01176
227800200529     C                     Z-ADD0         SDAM                            S01176
227900200529     C                     MOVE TDSS      SSSN                            S01176
228000200529     C                     MOVE TCNR      SCPN                            S01176
228100200529     C                     MOVE TDMI      SMKI                            S01176
228200200529     C                     MOVE TDTP      STET                            S01176
228300200529     C                     MOVE SETC      SSCY                            S01176
228400200529     C                     MOVE TDBK      SBOC                            S01176
228500200529     C                     Z-ADDRUND      LCD                             S01176
228600200529     C                     MOVE 'I'       CHTP                            S01176
228700200529     C                     Z-ADD0         TNLU                            S01176
228800200529     C                     MOVE 'Y'       AUTS                            S01176
228900200529     C*                                                                   S01176
229000200529     C                     WRITESETLEDF                                   S01176
229100200529     C                     ADD  1         SETADD  50                      S01176
229200200529      **                                                                  CSE039
229300200529      ** Write a record to PF/SEMVTSPD                                    CSE039
229400200529     C           CSE039    IFEQ 'Y'                                       CSE039
229500200529     C                     EXSR SRSEMV                                    CSE039
229600200529     C                     ENDIF                                          CSE039
229700200529     C                     END                                            S01176
229800200529     C*
229900200529     C                     END
230000200529     C*
230100200529     C* IF TRADE CHANGED AFTER TRADE DATE PROCESSING DONE
230200200529     C*    PERFORM SOME ACCOUNTING AGAIN
230300200529     C*
230400200529     C           *IN21     IFEQ '1'
230500200529     C           TLCD      ANDEQRUND
230600200529     C           TOED      ANDNERUND
230700200529     C*
230800200529     C********   TDVD      IFGE ECD                                       S01271
230900200529     C********             EXSR TELEX                                     S01271
231000200529     C********             END                                            S01271
231100200529     C*
231200200529     C* RETRIEVE START OF BUSINESS TRADE RECORD
231300200529     C*
231400200529     C           TDRF      CHAINSOBTRDF              17
231500200529     C  N17      RECI      COMP '*'                      17
231600200529     C           *IN17     IFEQ '1'
231700200529     C                     SETON                     U7U8LR
231800200529     C           *LOCK     IN   LDA                                       S01117
231900200529     C                     MOVE 'SOBTR'   DBFILE           ***************
232000200529     C                     MOVELTDRF      DBKEY            * DB ERROR 07 *
232100200529     C***********          MOVE '07'      DBASE            ***************S01117
232200200529     C                     Z-ADD7         DBASE                           S01117
232300200529     C                     OUT  LDA                                       S01117
232400200529     C                     DUMP                                           S01117
232500200529     C                     GOTO MEND
232600200529     C                     END
232700200529     C*
232800200529     C* MOVE SETTLEMENT DETAILS INTO DATA AREA
232900200529     C*
233000200529     C**********           MOVE RECIN     SREC                            S01169
233100200529     C**********           MOVELRECIN     SREC                     S01169 E23955
233200200529     C******************** MOVE RECIN     SREC2                    E22485 S01486
233300200529     C******************** MOVELRECIN     SREC1                    E22485 S01486
233400200529     C                     MOVE RECIN3    SREC3                           S01486
233500200529     C                     MOVE RECIN2    SREC2                           S01486
233600200529     C                     MOVE RECIN1    SREC1                           S01486
233700200529     C*                                                                   E22485
233800200529     C                     MOVE SMTH      SOSMTH
233900200529     C                     MOVE PYFM      SOPYFM
234000200529     C***********          MOVE PYFB      SOPYFB                          S01117
234100200529     C                     MOVE PYFA      SOPYFA                          S01117
234200200529     C                     MOVE PAYT      SOPAYT
234300200529     C***********          MOVE PYTB      SOPYTB                          S01117
234400200529     C                     MOVE PYTA      SOPYTA                          S01117
234500200529     C                     MOVE ASNM      SOASNM
234600200529     C                     MOVE NOML      SONOML                          E22485
234700200529     C*                                                                   E22485
234800200529     C                     MOVE DELF      SDELF                           E22485
234900200529     C                     MOVE DELT      SDELT                           E22485
235000200529     C                     MOVE TDBK      STDBK                           E22485
235100200529     C*********************MOVE TDBR      STDBR                    E22485 S01117
235200200529     C                     MOVE TDBA      STDBR                           S01117
235300200529     C                     MOVE TDDT      STDDT                           E22485
235400200529     C                     MOVE TDMI      STDMI                           E22485
235500200529     C                     MOVE TDVD      STDVD                           E22485
235600200529     C                     MOVE PRIC      SPRIC                           E22485
235700200529     C                     MOVE NOML      SNOML                           E22485
235800200529     C*
235900200529     C* IF SETTLEMENT DETAILS DIFFER REVERSE OLD INFO AND OUTPUT NEW
236000200529     C*    COUNTERVALUE KEY ONLY
236100200529     C*
236200200529     C***********TRSIDS    IFNE SOSIDS                                    109058
236300200529     C***********CHTP      OREQ 'C'                                 E22485E23716
236400200529     C***********CHTP      IFNE 'C'                                 E22485E23716
236500200529     C                     SETON                     25
236600200529     C*********************END                                      E22485E23716
236700200529     C                     SETON                     29                   E19332
236800200529     C                     SETOF                     30                   E19332
236900200529     C/COPY WNCPYSRC,SE2290C018
237000200529     C                     MOVE '1'       RVRS
237100200529     C                     EXSR ACKEY
237200200529     C/COPY WNCPYSRC,SE2290C019
237300200529     C*
237400200529     C**  MOVE BACK TRADSDF DATA
237500200529     C*
237600200529     C**********           MOVE TREC      RECIN                           S01169
237700200529      *                                                                   E19488
237800200529      ***  Move last 67 characters of TREC1 and the first 67 of TREC2     E19488
237900200529      ***  into RECIN separately to overlay correctly.                    E19488
238000200529      *                                                                   E19488
238100200529     C***********          MOVELTREC      RECIN                    S01176 E19488
238200200529     C******************** MOVE TREC2     RECIN                    E19488 S01486
238300200529     C******************** MOVELTREC1     RECIN                    E19488 S01486
238400200529     C                     MOVE TREC3     RECIN3                          S01486
238500200529     C                     MOVE TREC2     RECIN2                          S01486
238600200529     C                     MOVE TREC1     RECIN1                          S01486
238700200529      *                                                                   E19488
238800200529     C                     MOVELTRECI     RECI                            S01169
238900200529     C/COPY WNCPYSRC,SE2290C020
239000200529     C                     MOVELTTACI     TACI                            S01169
239100200529     C                     MOVE '0'       RVRS
239200200529     C                     EXSR ACKEY
239300200529     C/COPY WNCPYSRC,SE2290C021
239400200529     C***********          END                                            109058
239500200529     C*
239600200529     C* IF TRADE TYPE = TP AND THE DEPOTS HAVE CHANGED OUTPUT TO
239700200529     C*    DEPOT MOVEMENTS FILE
239800200529     C*
239900200529     C           TDTP      IFEQ 'TP'
240000200529     C*
240100200529     C* USER DEPOT MOVEMENT
240200200529     C*
240300200529     C           TDELT     IFNE SDELT
240400200529     C           TTDBR     ORNE STDBR                                     E15996
240500200529     C           TTDBK     ORNE STDBK                                     E15996
240600200529     C           TTDMI     ORNE STDMI                                     E15996
240700200529     C           TTDDT     ORNE STDDT                                     E15996
240800200529     C           TTDVD     ORNE STDVD                                     E15996
240900200529     C           TNOML     ORNE SNOML                                     E22485
241000200529     C                     EXSR UDEPOT
241100200529     C                     END
241200200529     C*
241300200529     C* CUSTOMER DEPOT MOVEMENT
241400200529     C*
241500200529     C           C1DI      IFEQ 'S'
241600200529     C********** TDELF     ANDNESDELF                                     E15996
241700200529     C           C1DI      OREQ 'D'
241800200529     C********** TDELF     ANDNESDELF                                     E15996
241900200529     C           TDELF     IFNE SDELF                                     E15996
242000200529     C           TTDBR     ORNE STDBR                                     E15996
242100200529     C           TTDMI     ORNE STDMI                                     E15996
242200200529     C           TTDDT     ORNE STDDT                                     E15996
242300200529     C           TTDVD     ORNE STDVD                                     E15996
242400200529     C           TNOML     ORNE SNOML                                     E22485
242500200529     C                     EXSR CDEPOT
242600200529     C                     END                                            E15996
242700200529     C                     END
242800200529     C*
242900200529     C                     END
243000200529     C*
243100200529     C*
243200200529     C* IF TRADE TYPE = TS AND THE DEPOTS HAVE CHANGED OUTPUT TO
243300200529     C*    DEPOT MOVEMENTS FILE
243400200529     C*
243500200529     C           TDTP      IFEQ 'TS'
243600200529     C*
243700200529     C* USER DEPOT MOVEMENT
243800200529     C*
243900200529     C           TDELF     IFNE SDELF
244000200529     C           TTDBR     ORNE STDBR                                     E15996
244100200529     C           TTDBK     ORNE STDBK                                     E15996
244200200529     C           TTDMI     ORNE STDMI                                     E15996
244300200529     C           TTDDT     ORNE STDDT                                     E15996
244400200529     C           TTDVD     ORNE STDVD                                     E15996
244500200529     C           TNOML     ORNE SNOML                                     E22485
244600200529     C                     EXSR UDEPOT
244700200529     C                     END
244800200529     C*
244900200529     C* CUSTOMER DEPOT MOVEMENT
245000200529     C*
245100200529     C           C1DI      IFEQ 'S'
245200200529     C********** TDELT     ANDNESDELT                                     E15996
245300200529     C           C1DI      OREQ 'D'
245400200529     C********** TDELT     ANDNESDELT                                     E15996
245500200529     C           TDELT     IFNE SDELT                                     E15996
245600200529     C           TTDBR     ORNE STDBR                                     E15996
245700200529     C           TTDMI     ORNE STDMI                                     E15996
245800200529     C           TTDDT     ORNE STDDT                                     E15996
245900200529     C           TTDVD     ORNE STDVD                                     E15996
246000200529     C           TNOML     ORNE SNOML                                     E22485
246100200529     C                     EXSR CDEPOT
246200200529     C                     END                                            E15996
246300200529     C                     END
246400200529     C*
246500200529     C                     END
246600200529     C                     END
246700200529     C*
246800200529     C* IF VALUE DATE = DATE OF NEXT WORKING DAY OUTPUT TRADE ACTION
246900200529     C*    WITH SEQ NO = 11 TO PROJECT NEXT DAYS POSITION
247000200529     C*
247100200529     C***********TDVD      IFEQ DNWD                                      S01117
247200200529     C           TDVD      IFEQ BJDNWD                                    S01117
247300200529      *                                                                   E19488
247400200529      ***  Move last 67 characters of TREC1 and the first 67 of TREC2     E19488
247500200529      ***  into RECIN separately to overlay correctly.                    E19488
247600200529      *                                                                   E19488
247700200529     C***********          MOVE TREC      RECIN                    S01176 E19488
247800200529      *                                                                   E19488
247900200529     C******************** MOVE TREC2     RECIN                    E19488 S01486
248000200529     C******************** MOVELTREC1     RECIN                    E19488 S01486
248100200529     C                     MOVE TREC3     RECIN3                          S01486
248200200529     C                     MOVE TREC2     RECIN2                          S01486
248300200529     C                     MOVE TREC1     RECIN1                          S01486
248400200529     C                     SETON                     3036
248500200529     C                     SETOF                     29
248600200529     C*                                                                   E21606
248700200529     C* IF BOOK TRANSFER THEN TREAT AS AUTO-SETTLE FOR UPDATING OF        E21606
248800200529     C* I/C SETTLED NOMINAL ON POSITION FILES FOR NEXT DAYS ENQUIRIES     E21606
248900200529     C*                                                                   E21606
249000200529     C           C1DI      IFEQ 'I'                                       E21606
249100200529     C                     MOVE 'Y'       AUTS                            E21606
249200200529     C                     END                                            E21606
249300200529     C*                                                                   E21606
249400200529     C                     EXSR ACTION
249500200529     C                     SETOF                     36
249600200529     C                     END
249700200529     C*
249800200529     C                     ENDSR
249900200529      *
250000200529      *****************************************************************
250100200529      /EJECT
250200200529      *****************************************************************
250300200529      *                                                               *
250400200529      * ACCREV - PERFORM REVERSAL ACCOUNTING FOR COMPLETE TRADES      *
250500200529      *                                                               *
250600200529      *****************************************************************
250700200529      *
250800200529     C           ACCREV    BEGSR                           ** ACCREV **
250900200529     C*
251000200529     C* IF TRADE DATE ACCOUNTING DONE REVERSE TRADE ACTIONS AND
251100200529     C*    ACCOUNT KEYS
251200200529     C*
251300200529     C*                                                                   165636
251400200529     C** But not if this subr. called from TRADEA and processing          165636
251500200529     C** already done, to prevent unnecessary reversal.                   165636
251600200529     C*                                                                   165636
251700200529     C           @SUBR     IFEQ 'A'                                       165636
251800200529     C           *IN21     ANDEQ'0'                                       165636
251900200529     C           @SUBR     ORNE 'A'                                       165636
252000200529     C           *IN21     IFEQ '1'
252100200529     C           *IN23     OREQ '1'
252200200529     C                     MOVE 'Y'       RVLI
252300200529     C                     SETON                     29
252400200529     C                     SETOF                     30
252500200529     C                     EXSR ACTION
252600200529     C                     MOVE '1'       RVRS
252700200529     C                     EXSR ACKEY
252800200529     C                     END
252900200529     C*                                                                   165636
253000200529     C                     END                                            165636
253100200529     C*                                                                   165636
253200200529     C/COPY WNCPYSRC,SE2290C022
253300200529     C*
253400200529     C* IF VALUE DATE ACCOUNTING DONE REVERSE TRADE ACTIONS AND
253500200529     C*    ACCOUNT KEYS
253600200529     C*
253700200529     C*                                                                   165636
253800200529     C** But not if this subr. called from TRADEA and processing          165636
253900200529     C** already done, to prevent unnecessary reversal.                   165636
254000200529     C*                                                                   165636
254100200529     C           @SUBR     IFEQ 'A'                                       165636
254200200529     C           *IN22     ANDEQ'0'                                       165636
254300200529     C           @SUBR     ORNE 'A'                                       165636
254400200529     C           *IN22     IFEQ '1'
254500200529     C           *IN24     OREQ '1'
254600200529     C                     MOVE 'Y'       RVLI
254700200529     C                     SETON                     30
254800200529     C                     SETOF                     29
254900200529     C                     EXSR ACTION
255000200529     C                     MOVE '1'       RVRS
255100200529     C                     EXSR ACKEY
255200200529     C           C1DI      IFEQ 'I'
255300200529     C           LKRF      ANDNE*BLANKS                                                       223183
255400200529     C                     MOVE 'D'       RECI
255500200529     C                     MOVE TOED      ORED
255600200529     C                     MOVE 'Y'       SRIN
255700200529     C                     WRITEASTACDF
255800200529     C                     ADD  1         ASTCNT  50
255900200529     C                     END
256000200529     C*
256100200529     C* UPDATE CONTINGENT LIABILITIES RECORD
256200200529     C*
256300200529     C           C1DI      IFEQ 'M'
256400200529     C           TDTP      ANDEQ'TS'
256500200529     C           CNLI      ANDEQ'Y'                                       S01176
256600200529     C           TCNR      ANDNEISSR                                      E19832
256700200529     C           TDRF      CHAINCLIABDF              11
256800200529     C  N11      RECI      COMP 'D'                  1111
256900200529     C           *IN11     IFEQ '1'
257000200529     C                     SETON                     U7U8LR
257100200529     C           *LOCK     IN   LDA                                       S01117
257200200529     C                     MOVE 'CLIAB'   DBFILE           ***************
257300200529     C                     MOVELTDRF      DBKEY            * DB ERROR 08 *
257400200529     C***********          MOVE '08'      DBASE            ***************S01117
257500200529     C                     Z-ADD8         DBASE                           S01117
257600200529     C                     OUT  LDA                                       S01117
257700200529     C                     DUMP                                           S01117
257800200529     C                     GOTO MEND
257900200529     C                     ELSE
258000200529     C                     MOVE '*'       RECI
258100200529     C                     UPDATCLIABDF
258200200529     C                     ADD  1         CLBDEL  50
258300200529     C                     END
258400200529     C                     END
258500200529     C                     END
258600200529     C*
258700200529     C                     END                                            165636
258800200529     C*                                                                   165636
258900200529     C                     MOVE ' '       RVLI
259000200529     C                     MOVE '0'       RVRS
259100200529     C*
259200200529     C                     ENDSR
259300200529      *
259400200529      *****************************************************************
259500200529      /EJECT
259600200529      *****************************************************************
259700200529      *                                                               *
259800200529      **TELEX*-*OUTPUT*TELEX*EXTRACT**                                *   S01271
259900200529      *                                                               *
260000200529      *****************************************************************   S01271
260100200529     C***********TELEX     BEGSR                           ** TELEX **    S01271
260200200529     C********                                                            S01271
260300200529     C**IF*COUNTERPARTY*IS*A*DISCRETIONARY*CLIENT*IE*TRADE*IS*THE*RESULT* S01271
260400200529     C**OF*A*TRANSFER*NO*DETAILS*ARE*TO*BE*OUTPUT*TO*THE*TELEX*EXTRACT*** S01271
260500200529     C********                                                            S01271
260600200529     C********   C1DI      IFEQ 'I'                                       S01271
260700200529     C********             GOTO TELEXE                                    S01271
260800200529     C********             END                                            S01271
260900200529     C********                                                            S01271
261000200529     C**MOVE*INFORMATION*FROM*TRADE*RECORD*INTO*TELEX*EXTRACT***          S01271
261100200529     C********                                                            S01271
261200200529     C********             MOVE 'D'       RECI                            S01271
261300200529     C********             MOVE TDRF      TRDE                            S01271
261400200529     C********             MOVE TDBR      BCHT                            S01271
261500200529     C********   TDTP      IFEQ 'TP'                                      S01271
261600200529     C********             MOVE PYFB      BCHS                            S01271
261700200529     C********             END                                            S01271
261800200529     C********                                                            S01271
261900200529     C********   TDTP      IFEQ 'TS'                                      S01271
262000200529     C********             MOVE PYTB      BCHS                            S01271
262100200529     C********             END                                            S01271
262200200529     C********                                                            S01271
262300200529     C********   BCHS      IFEQ *ZERO                                     S01271
262400200529     C********             Z-ADDBCHT      BCHS                            S01271
262500200529     C********             END                                            S01271
262600200529     C*******                                                             S01271
262700200529     C*******              MOVE TDSS      SCSN                            S01271
262800200529     C*******              MOVE TDTP      TRAD                            S01271
262900200529     C*******              MOVE TCNR      CLNM                            S01271
263000200529     C*******              MOVE *BLANKS   TXIN                            S01271
263100200529     C*******                                                             S01271
263200200529     C*******    *IN26     IFEQ '1'                                       S01271
263300200529     C*******              MOVE 'C'       ACTO                            S01271
263400200529     C*******              ELSE                                           S01271
263500200529     C*******              MOVE '1'       ACTO                            S01158
263600200529     C*******              MOVE 'I'       ACTO                     S01158 S01271
263700200529     C*******              END                                            S01271
263800200529     C*******                                                             S01271
263900200529     C*******              ADD  1         TXCNT   50                      S01271
264000200529     C*******              WRITESETLXDF                                   S01271
264100200529     C*******                                                             S01271
264200200529     C*******    TELEXE    ENDSR                                          S01271
264300200529      *********                                                           S01271
264400200529      *****************************************************************   S01271
264500200529      *****************************************************************
264600200529      /EJECT
264700200529      *****************************************************************
264800200529      *                                                               *
264900200529      * ACTION - OUTPUT TRADE ACTIONS FOR TRADE                       *
265000200529      *                                                               *
265100200529      *****************************************************************
265200200529      *
265300200529     C           ACTION    BEGSR                           ** ACTION **
265400200529     C*
265500200529     C* CALCULATE COMMISSION AND CHARGES TOTALS
265600200529     C*
265700200529     C                     Z-ADD0         CCCT                            S01169
265800200529     C                     Z-ADD0         CCTL                            S01169
265900200529     C***********TBCA      ADD  TCCA      CCTL                            E20191
266000200529     C***********TCA1      ADD  TCA2      CCCT                            E20191
266100200529     C***********          ADD  TCA3      CCCT                            E20191
266200200529     C***********          ADD  TLTA      CCCT                            S01176
266300200529     C***********          ADD  TOCA      CCCT                            S01176
266400200529     C***********          ADD  LTCA      CCCT             * LOCAL TFR    S01176
266500200529     C***********          ADD  TPCA      CCCT             * PMT CHARGE   S01176
266600200529     C***********          ADD  TVCA      CCCT             * VAT CHARGE   S01176
266700200529     C***********          ADD  TCA4      CCCT                     S01176 E20191
266800200529     C***********          ADD  TCA5      CCCT                     S01176 E20191
266900200529     C***********          ADD  TCA6      CCCT                     S01176 E20191
267000200529     C***********          ADD  TCA7      CCCT                     S01176 E20191
267100200529     C***********          ADD  TAXA      CCCT                     S01176 E20191
267200200529     C           TBCA      ADD  TCCA      CCCT                            E20191
267300200529     C           TCA1      ADD  TCA2      CCTL                            E20191
267400200529     C                     ADD  TCA3      CCTL                            E20191
267500200529     C                     ADD  TCA4      CCTL                            E20191
267600200529     C                     ADD  TCA5      CCTL                            E20191
267700200529     C                     ADD  TCA6      CCTL                            E20191
267800200529     C                     ADD  TCA7      CCTL                            E20191
267900200529     C                     ADD  TAXA      CCTL                            E20191
268000200529     C*
268100200529     C**OBTAIN*DETAILS*FROM*LATEST*SECURITY*EVENT*DIARY*RECORD*******     E22485
268200200529     C*************OTHERWISE*USE*SECURITIES*DETAILS******************     E22485
268300200529     C*
268400200529     C                     MOVE TDVD      EVDT
268500200529     C                     MOVE '  '      EVTP
268600200529     C                     Z-ADD*ZEROS    STCA                            E22485
268700200529     C                     MOVE CPDP      STCA                            E22485
268800200529     C                     Z-ADD0         SAVDT                           E22485
268900200529     C*                                                                   E22485
269000200529     C***  Defaults: The values on the Security File may have been        E22485
269100200529     C***  changed since the Start Date, so check the Security Non-Diary  E22485
269200200529     C***  Events File for each one.                                      E22485
269300200529     C*                                                                   E22485
269400200529     C                     MOVE 'CP'      EVTP                            E22485
269500200529     C           RVLI      IFNE 'Y'                                       E22485
269600200529     C           SEKEY     SETLLSNDEVDF                                   E22485
269700200529     C                     READ SNDEVDF                  19               E22485
269800200529     C                     ELSE                                           E22485
269900200529     C           SEKEY     SETLLSOBSNDF                                   E22485
270000200529     C                     READ SOBSNDF                  19               E22485
270100200529     C                     END                                            E22485
270200200529     C           *IN19     IFEQ '0'                                       E22485
270300200529     C           SNSN      ANDEQSESN                                      E22485
270400200529     C           SNET      ANDEQ'CP'                                      E22485
270500200529     C                     Z-ADDSNDT      SAVDT   50                      E22485
270600200529     C                     MOVE SNCP      STCA                            E22485
270700200529     C                     END                                            E22485
270800200529     C*                                                                   E22485
270900200529     C           PPDI      IFEQ 'Y'                                       E22485
271000200529     C                     MOVE 'PP'      EVTP                            E22485
271100200529     C           RVLI      IFNE 'Y'                                       E22485
271200200529     C           SEKEY     SETLLSEDEVDF                                   E22485
271300200529     C                     READ SEDEVDF                  19               E22485
271400200529     C                     ELSE                                           E22485
271500200529     C           SEKEY     SETLLSOBSEDF                                   E22485
271600200529     C                     READ SOBSEDF                  19               E22485
271700200529     C                     END                                            E22485
271800200529     C           *IN19     IFEQ '0'                                       E22485
271900200529     C           SDSN      ANDEQSESN                                      E22485
272000200529     C           SDET      ANDEQ'PP'                                      E22485
272100200529     C           SDDT      ANDGESAVDT                                     E22485
272200200529     C                     MOVE '1'       *IN37                           E22485
272300200529     C                     END                                            E22485
272400200529     C                     END                                            E22485
272500200529     C***********SEKEY     SETGTSEDEVDF                                   E22485
272600200529     C***********                                                         E22485
272700200529     C************IN19     DOUEQ'1'                                       E22485
272800200529     C***********          READPSEDEVDF                  19               E22485
272900200529     C***********                                                         E22485
273000200529     C************IN19     IFEQ '1'                                       E22485
273100200529     C***********SDSN      ORNE TDSS                                      E22485
273200200529     C***********          MOVE '0'       *IN37                           E22485
273300200529     C***********          MOVE '1'       *IN19                    E15439 E22485
273400200529     C***********          ELSE                                           E22485
273500200529     C***********                                                         E22485
273600200529     C***********SDET      IFEQ 'PP'                                      E22485
273700200529     C***********SDED      ANDEQTDVD                               S01176 E22485
273800200529     C***********          SETON                     3719                 E22485
273900200529     C***********          ELSE                                           E22485
274000200529     C***********                                                         E22485
274100200529     C***********SDED      IFLT TDVD                                      E22485
274200200529     C***********SDET      IFEQ 'IR'                                      E22485
274300200529     C***********SDET      OREQ 'MP'                                      E22485
274400200529     C***********SDET      OREQ 'CP'                                      E22485
274500200529     C***********          SETON                     3719                 E22485
274600200529     C***********          END                                            E22485
274700200529     C***********          END                                            E22485
274800200529     C***********                                                         E22485
274900200529     C***********          END                                            E22485
275000200529     C***********          END                                            E22485
275100200529     C***********          END                                            E22485
275200200529     C*
275300200529     C* MOVE INFO INTO TRADE ACTIONS FILE
275400200529     C*
275500200529     C                     MOVE 'D'       RECI
275600200529     C           TDTP      IFEQ 'TP'
275700200529     C                     MOVE 'P'       PRSL
275800200529     C                     MOVE DELT      OUDP
275900200529     C                     ELSE
276000200529     C                     MOVE 'S'       PRSL
276100200529     C                     MOVE DELF      OUDP
276200200529     C                     END
276300200529     C*
276400200529     C   36                MOVE 11        ACTS
276500200529     C  N36                MOVE 10        ACTS
276600200529     C************         MOVE TPDY      TRPR                            E15222
276700200529     C************         MOVE PRIC      TRPR                     E15222 E20235
276800200529     C******************** MOVE TPDY      TRPR                     E20235 S01486
276900200529     C                     MOVE PRIC      TRPR                            S01486
277000200529     C                     MOVE TSUB      TDTS
277100200529     C*
277200200529      *                                                                                       253841
277300200529     C           *IN36     IFEQ '1'                                                           253841
277400200529     C           SRECI     ANDNE'D'                                                           253841
277500200529      *                                                                                       253841
277600200529      ** Do not generate trade action for a matured security.                                 253841
277700200529      *                                                                                       253841
277800200529     C                     ELSE                                                               253841
277900200529     C* Trade Date Processing
278000200529     C*
278100200529     C           *IN29     IFEQ '1'
278200200529     C                     MOVE 'T'       TVDA
278300200529     C                     MOVE TDDT      EVTD
278400200529     C                     MOVE TDVD      OTRD
278500200529     C                     ADD  1         TACNT   50
278600200529     C                     END
278700200529     C*
278800200529     C* Value Date Processing
278900200529     C*
279000200529     C           *IN30     IFEQ '1'
279100200529     C                     MOVE 'V'       TVDA
279200200529     C                     MOVE TDVD      EVTD
279300200529     C                     MOVE TDDT      OTRD
279400200529     C                     ADD  1         VACNT   50
279500200529     C                     END
279600200529     C*
279700200529     C                     MOVE EOPM      PEMD    50
279800200529     C           RVLI      IFEQ 'Y'
279900200529     C           TOED      ANDLEPEMD
280000200529     C           EVTD      ANDLEPEMD                                      E37180
280100200529     C                     MOVE 'Y'       RMIP
280200200529     C                     ELSE
280300200529     C                     MOVE ' '       RMIP
280400200529     C                     END
280500200529     C*                                                                   S01486
280600200529     C**  If Portfolio Management is present                              S01486
280700200529     C*                                                                   S01486
280800200529     C           BGPFMG    IFEQ 'Y'                                       S01486
280900200529     C           BGN4ST    OREQ 'Y'                                       CPB001
281000200529     C*                                                                   S01486
281100200529     C**  Calculate the trade value in settlement currency                S01486
281200200529     C*                                                                   S01486
281300200529     C           TVSN      ADD  TVSP      CTVLSC 150                      S01486
281400200529     C                     ADD  TOSV      CTVLSC                          S01486
281500200529     C*                                                                   S01486
281600200529     C**  Calculate the exchange rate from nominal to settlement ccy      S01486
281700200529     C*                                                                   S01486
281800200529     C           TCTR      IFNE *ZERO                                     S01486
281900200529     C           CTVLSC    DIV  TCTR      ERNSC  158H                     S01486
282000200529     C                     ELSE                                           S01486
282100200529     C                     Z-ADD*ZERO     ERNSC                           S01486
282200200529     C                     END                                            S01486
282300200529     C*                                                                   S01486
282400200529     C** Convert purchased int, charges & commissions to settlement ccy   S01486
282500200529     C*                                                                   S01486
282600200529     C           ITRA      MULT ERNSC     ITRASC 150H                     S01486
282700200529     C           CCTL      MULT ERNSC     CCTLSC 150H                     S01486
282800200529     C           CCCT      MULT ERNSC     CCCTSC 150H                     S01486
282900200529     C*                                                                   S01486
283000200529     C**  Subtract purchased int, charges & commissions (if reqd) from    S01486
283100200529     C**  total value to get customer trade value in settlement ccy       S01486
283200200529     C*                                                                   S01486
283300200529     C           CTVLSC    SUB  ITRASC    SETAM                           S01486
283400200529     C           BVCCAP    IFNE 'Y'                                       S01486
283500200529     C                     SUB  CCTLSC    SETAM                           S01486
283600200529     C                     END                                            S01486
283700200529     C           BVCMCP    IFNE 'Y'                                       S01486
283800200529     C                     SUB  CCCTSC    SETAM                           S01486
283900200529     C                     END                                            S01486
284000200529     C*                                                                   S01486
284100200529     C**  If reallowance is not to be included in average price           S01486
284200200529     C**  calculate amount and add to average price                       S01486
284300200529     C*                                                                   S01486
284400200529     C           BVRCAP    IFNE 'Y'                        B1             S01486
284500200529     C           RALL      ANDNE0                                         S01486
284600200529     C*                                                                   S01486
284700200529     C**  Format reallowance amount                                       S01486
284800200529     C                     Z-ADDRALL      WDRAL1                          S01486
284900200529     C**    If discount...                                                S01486
285000200529     C*                                                                   S01486
285100200529     C           STBS      IFEQ 'D'                        B2             S01486
285200200529     C                     Z-ADDTDVD      ZSDATE                          S01486
285300200529     C                     Z-ADDMATY      ZEDATE                          S01486
285400200529     C                     MOVE 'N'       DADJN                           100017
285500200529     C                     EXSR ZDAYS                                     S01486
285600200529     C                     MOVE ' '       DADJN                           100017
285700200529     C                     Z-ADDZDDAYS    #DDAYS  50                      S01486
285800200529     C                     EXSR ZDYYR                                     S01486
285900200529     C           ZINTDD    IFNE 0                          B3             S01486
286000200529     C           RALL      MULT #DDAYS    WPRICE 158                      S01486
286100200529     C           WPRICE    DIV  ZINTDD    WDRALL  95H                     S01486
286200200529     C*                                                                   S01486
286300200529     C           WDRALL    IFGE 0                          B4             S01486
286400200529     C           1         SUB  WDRALL    WDRAL1 158                      S01486
286500200529     C                     ELSE                            X4             S01486
286600200529     C                     Z-SUBWDRALL    WDRALL                          S01486
286700200529     C           1         SUB  WDRALL    WDRAL1                          S01486
286800200529     C                     Z-SUBWDRAL1    WDRAL1                          S01486
286900200529     C                     END                             E4             S01486
287000200529     C*                                                                   S01486
287100200529     C                     ELSE                            X3             S01486
287200200529     C                     Z-ADD*ZEROS    WDRAL1                          S01486
287300200529     C                     END                             E3             S01486
287400200529     C                     END                             E2             S01486
287500200529     C*                                                                   S01486
287600200529     C                     Z-ADD*ZEROS    ZRALL  150                      S01486
287700200529     C*                                                                   S01486
287800200529     C**  Percentage priced: Reallowance = reallowance % X nominal        S01486
287900200529     C           SPBS      IFEQ 'P'                        B2             S01486
288000200529     C                     Z-ADD*ZEROS    ZRALL0 150                      S01486
288100200529     C                     Z-ADD*ZEROS    ZRALL1 151                      S01486
288200200529     C                     Z-ADD*ZEROS    ZRALL2 152                      S01486
288300200529     C                     Z-ADD*ZEROS    ZRALL3 153                      S01486
288400200529     C                     MOVEA'0000'    *IN,42                          S01486
288500200529     C           42        ADD  A6NBDP    J       20                      S01486
288600200529     C                     MOVEA'1'       *IN,J                           S01486
288700200529     C*                                                                   S01486
288800200529     C**  Calculate consideration/reallowance/charges/commission          S01486
288900200529     C*                                                                   S01486
289000200529     C   42      NOML      MULT WDRAL1    ZRALL0    H                     S01486
289100200529     C   43      NOML      MULT WDRAL1    ZRALL1    H                     S01486
289200200529     C   44      NOML      MULT WDRAL1    ZRALL2    H                     S01486
289300200529     C   45      NOML      MULT WDRAL1    ZRALL3    H                     S01486
289400200529     C*                                                                   S01486
289500200529     C   42                DIV  100       ZRALL0                          S01486
289600200529     C   43                DIV  100       ZRALL1                          S01486
289700200529     C   44                DIV  100       ZRALL2                          S01486
289800200529     C   45                DIV  100       ZRALL3                          S01486
289900200529     C*                                                                   S01486
290000200529     C   42                MOVE ZRALL0    ZRALL                           S01486
290100200529     C   43                MOVE ZRALL1    ZRALL                           S01486
290200200529     C   44                MOVE ZRALL2    ZRALL                           S01486
290300200529     C   45                MOVE ZRALL3    ZRALL                           S01486
290400200529     C*                                                                   S01486
290500200529     C**  Allow for nominal decimal places                                S01486
290600200529     C*                                                                   S01486
290700200529     C           5         SUB  NMDP      DC      10                      S01486
290800200529     C           ZRALL     MULT POWER8,DC ZRALL                           S01486
290900200529      *                                                                   S01486
291000200529     C           ZRALL     MULT POWER8,DC ZRALL                           S01486
291100200529     C*                                                                   S01486
291200200529     C**  Unit priced: Reallowance = reallowance % X consideration        S01486
291300200529     C                     ELSE                            X2             S01486
291400200529     C           TCSR      MULT WDRAL1    ZRALL     H                     S01486
291500200529     C           ZRALL     DIV  100       ZRALL     H                     S01486
291600200529     C                     END                             E2             S01486
291700200529     C*                                                                   S01486
291800200529     C                     SUB  ZRALL     SETAM                           S01486
291900200529     C                     END                             E1             S01486
292000200529     C           BGPFMG    IFEQ 'Y'                                       S01486
292100200529     C           BGN4ST    OREQ 'Y'                                       CPB001
292200200529     C                     MOVE SETC      SETCY                           S01486
292300200529     C                     END                                            S01486
292400200529     C*                                                                   S01486
292500200529     C**  End of Portfolio Management present                             S01486
292600200529     C                     END                                            S01486
292700200529     C*
292800200529     C* CALCULATE CONTRACT PRICE USING ZCONPR
292900200529     C*
293000200529      * Access the Nom. Dec. Places for use in  SR - ZCONPR
293100200529      *
293200200529     C                     Z-ADDSET       #SET   130
293300200529     C                     EXSR NOMDEC
293400200529     C***********          Z-ADDCDP       ZCDP                            S01117
293500200529     C                     Z-ADDA6NBDP    ZCDP                            S01117
293600200529     C                     Z-ADD#SET      SET
293700200529      *
293800200529     C                     EXSR ZCONPR
293900200529     C                     MOVE ZCONP     CNTP
294000200529      *                                                                                       CAS006
294100200529     C           CAS006    IFEQ 'Y'                                                           CAS006
294200200529     C                     Z-ADD0         PRICX                                               CAS006
294300200529     C                     Z-ADD0         TCSRX                                               CAS006
294400200529     C                     Z-ADD0         ZCONSX 150                                          CAS006
294500200529      *                                                                                       CAS006
294600200529     C                     Z-ADDPRIC      ZPRC   169                                          CAS006
294700200529     C                     Z-ADDNOML      ZNOMLX 150                                          CAS006
294800200529     C                     CALL 'ZCNSD'                                                       CAS006
294900200529     C                     PARM           ZNOMLX                                              CAS006
295000200529     C                     PARM           ZPRC                                                CAS006
295100200529     C                     PARM           SPBS                                                CAS006
295200200529     C                     PARM           NMDP                                                CAS006
295300200529     C                     PARM           ZCDP                                                CAS006
295400200529     C                     PARM           ZCONSX                                              CAS006
295500200529      *                                                                                       CAS006
295600200529     C                     Z-ADDTCSR      TCSRX  150                                          CAS006
295700200529     C                     Z-ADDZCONSX    TCSR                                                CAS006
295800200529      *                                                                                       CAS006
295900200529     C                     Z-ADDPRIC      PRICX  158                                          CAS006
296000200529     C                     Z-ADDPRICN     PRIC                                                CAS006
296100200529     C                     EXSR ZCONPR                                                        CAS006
296200200529     C                     Z-ADDPRICX     PRIC                                                CAS006
296300200529     C                     Z-ADDTCSRX     TCSR                                                CAS006
296400200529     C                     MOVE ZCONP     CNTN                                                CAS006
296500200529      *                                                                                       CAS006
296600200529     C                     ENDIF                                                              CAS006
296700200529      *                                                                                       CAS006
296800200529     C********** CGL031    IFEQ 'Y'                                                    CGL031 234440
296900200529     C********** TDTP      ANDEQ'TS'                                                   CGL031 233566
297000200529     C**********           Z-ADDFSPP      TFPR                                         CGL031 234440
297100200529     C                     Z-ADD0         TFPR                                                234440
297200200529     C**********           ENDIF                                                       CGL031 234440
297300200529      *                                                                                       CGL031
297400200529     C                     MOVE TCSR      CNSD
297500200529     C                     MOVE TINA      INAJ
297600200529     C                     MOVE ITRA      PCHI
297700200529     C***********          MOVE ACIN      ACRI                            E15549
297800200529     C           PROT      IFEQ '4'                                       E21303
297900200529     C                     MOVE EXDV      ACRI                            E21303
298000200529     C                     ELSE                                           E21303
298100200529     C                     MOVE ACIN      ACRI                            E21303
298200200529     C                     END                                            E21303
298300200529     C                     MOVE TCNR      TRCP
298400200529     C                     MOVE TCFC      SDCP                            E22485
298500200529     C                     MOVE TDCR      CPNR                            E22485
298600200529     C***********          MOVE CPDP      STCA                     E22485 E22485
298700200529     C*
298800200529     C           C1DI      IFEQ 'D'
298900200529     C           C1DI      OREQ 'S'
299000200529     C                     MOVE 'Y'       PTFI
299100200529     C*
299200200529     C           TDTP      IFEQ 'TP'
299300200529     C                     MOVE DELF      PTCD
299400200529     C                     ELSE
299500200529     C*
299600200529     C           TDTP      IFEQ 'TS'
299700200529     C                     MOVE DELT      PTCD
299800200529     C                     ELSE
299900200529     C                     MOVE *BLANKS   PTCD
300000200529     C                     END
300100200529     C*
300200200529     C                     END
300300200529     C*
300400200529     C                     ELSE
300500200529     C                     MOVE ' '       PTFI
300600200529     C                     MOVE *BLANKS   PTCD
300700200529     C                     END
300800200529     C*
300900200529     C           *IN37     IFEQ '1'
301000200529     C           PROT      IFEQ '4'                                       E22485
301100200529     C                     MOVE SDTA      STCA                            E22485
301200200529     C                     ELSE                                           E22485
301300200529     C                     Z-ADD*ZEROS    STCA                            E22485
301400200529     C                     MOVE SDTP      STCA                            E22485
301500200529     C                     END                                            E22485
301600200529     C                     MOVE '0'       *IN37                           E22485
301700200529     C                     END                                            E22485
301800200529     C*                                                                   E22485
301900200529     C************IN37     IFEQ '1'                                       E22485
302000200529     C***********          MOVE SDNC      CPNR                            E22485
302100200529     C***********          MOVE TTCFC     SDCP                            E22485
302200200529     C***********                                                         E22485
302300200529     C***********PROT      IFEQ '4'                                       E22485
302400200529     C***********          MOVE EXDV      ACRI                     E15549 E22485
302500200529     C***********          MOVE SDTA      STCA                            E22485
302600200529     C***********          ELSE                                           E22485
302700200529     C***********          MOVE ACIN      ACRI                     E15549 E22485
302800200529     C***********          MOVE SDTP      STCA                            E22485
302900200529     C***********          END                                            E22485
303000200529     C***********          ELSE                                           E22485
303100200529     C***********          MOVE CPNR      CPNR                            E22485
303200200529     C***********          MOVE TTCFC     SDCP                            E22485
303300200529     C***********          MOVE CPDP      STCA                            E22485
303400200529     C***********          END                                            E22485
303500200529     C*
303600200529     C           ACTS      IFEQ '11'                                      S01269
303700200529     C***********          Z-ADDDNWD      EVTD                     S01269 S01117
303800200529     C                     Z-ADDBJDNWD    EVTD                            S01117
303900200529     C                     END                                            S01269
304000200529     C*                                                                   080259
304100200529     C* Move Portfolio Reference before output                            080259
304200200529     C           BGPFMG    IFEQ 'Y'                                       080259
304300200529     C           BGN4ST    OREQ 'Y'                                       CPB001
304400200529     C                     MOVE XPTFR     PTFR                            080259
304500200529     C                     END                                            080259
304600200529     C*                                                                   080259
304700200529     C                     MOVE XCOAF     COAF                            CSE007
304800200529      *                                                                                       CAS006
304900200529     C           CAS006    IFEQ 'Y'                                                           CAS006
305000200529     C                     Z-ADDLQPR      LQPP                                                CAS006
305100200529     C                     Z-ADDCRSK      CRKP                                                CAS006
305200200529     C                     Z-ADDTINN      INAN                                                CAS006
305300200529     C                     Z-ADDITRN      PCHN                                                CAS006
305400200529     C                     ENDIF                                                              CAS006
305500200529     C*                                                                   CSE007
305600200529     C/COPY WNCPYSRC,SE2290C050
305700200529     C                     WRITETRDACDF
305800200529     C*                                                                   E21606
305900200529     C*
306000200529     C* IF BOOK TRANSFER WITH VALUE DATE OF DNWD THEN RESET AUTO-SETTLE   E21606
306100200529     C* INDICATOR                                                         E21606
306200200529     C                     ENDIF                                                              253841
306300200529      *                                                                                       253841
306400200529     C*                                                                   E21606
306500200529     C           C1DI      IFEQ 'I'                                       E21606
306600200529     C***********TDVD      ANDEQDNWD                               E21606 S01117
306700200529     C           TDVD      ANDEQBJDNWD                                    S01117
306800200529     C                     MOVE 'N'       AUTS                            E21606
306900200529     C                     END                                            E21606
307000200529     C*                                                                   E21606
307100200529     C*                                                                   S01269
307200200529     C                     SETOF                     36                   S01269
307300200529     C*                                                                   S01269
307400200529     C                     ENDSR
307500200529      *
307600200529      *****************************************************************
307700200529      /EJECT
307800200529      *****************************************************************
307900200529      *                                                               *
308000200529      * ACKEY - OUTPUT GENERATED ACCOUNT KEYS FOR TRADE               *
308100200529      *                                                               *
308200200529      *****************************************************************
308300200529      *
308400200529     C           ACKEY     BEGSR                           ** ACKEY **
308500200529     C*
308600200529     C* IF IND 25 IS ON CALCULATE COUNTERVALUE KEY ONLY
308700200529     C*
308800200529     C/COPY WNCPYSRC,SE2290C023
308900200529     C   25                GOTO CVALUE
309000200529     C*
309100200529     C* RETRIEVE INVESTMENT TYPE RECORD - IF NOT THERE DATABASE ERROR     S01169
309200200529     C*                                                                   S01169
309300200529     C                     MOVE TNMC      NMCY                            S01169
309400200529     C*                                                                   S01169
309500200529     C           ITKEY     CHAININVTPDF              18                   S01169
309600200529     C  N18      RECI      COMP 'D'                  1818                 S01169
309700200529     C           *IN18     IFEQ '1'                                       S01169
309800200529     C                     SETON                     U7U8LR               S01169
309900200529     C           *LOCK     IN   LDA                                       S01117
310000200529     C                     MOVE 'INVTP'   DBFILE           ***************S01169
310100200529     C                     MOVELTNMC      KEY6    6        * DB ERROR 12 *S01169
310200200529     C                     MOVE SITP      KEY6             ***************S01169
310300200529     C                     MOVELKEY6      DBKEY                           S01169
310400200529     C***********          MOVE '12'      DBASE                    S01169 S01117
310500200529     C                     Z-ADD12        DBASE                    S01169 S01117
310600200529     C                     OUT  LDA                                       S01117
310700200529     C                     DUMP                                           S01117
310800200529     C                     GOTO MEND                                      S01169
310900200529     C                     END                                            S01169
311000200529     C*
311100200529     C* CHECK IF KEYS ARE TO BE SUPPRESSED
311200200529     C*
311300200529     C***********SKTD      COMP 'T'                      33               S01117
311400200529     C***********SKTD      COMP 'V'                      34               S01117
311500200529     C           BVSKTV    COMP 'T'                      33               S01117
311600200529     C           BVSKTV    COMP 'V'                      34               S01117
311700200529     C                     Z-ADDNOML      SET    130
311800200529     C                     EXSR NOMDEC
311900200529     C*
312000200529     C           *INU7     IFEQ '1'
312100200529     C                     GOTO MEND
312200200529     C                     END
312300200529     C*
312400200529     C**CALCULATE*FACE*VALUE**                                            E22485
312500200529     C***********                                                         E22485
312600200529     C***********          Z-ADDSET       FVAL                            E22485
312700200529     C***********PPDI      IFEQ 'Y'                                       E22485
312800200529     C***********          MOVE TDVD      EVDT                            E22485
312900200529     C***********          MOVE 'PP'      EVTP                            E22485
313000200529     C***********SEKEY     SETGTSEDEVDF                                   E22485
313100200529     C***********          READPSEDEVDF                  19               E22485
313200200529     C**N19******RECI      COMP 'D'                  1919                 E22485
313300200529     C***********                                                         E22485
313400200529     C**IF*SECURITY*DIARY*RECORD*NOT*FOUND*-*USE*CALL*%*FROM*SECURITY*FILEE22485
313500200529     C***********                                                         E22485
313600200529     C************IN19     IFEQ '0'                                       E22485
313700200529     C***********SDSN      ANDEQTDSS                                      E22485
313800200529     C***********SDET      ANDEQ'PP'                                      E22485
313900200529     C***********SET       MULT SDTP      FVAL   130H                     E22485
314000200529     C***********          ELSE                                           E22485
314100200529     C***********          MOVE CPDP      CPDP3   63                      E22485
314200200529     C***********SET       MULT CPDP3     FVAL      H                     E22485
314300200529     C***********          END                                            E22485
314400200529     C***********                                                         E22485
314500200529     C***********          END                                            E22485
314600200529     C***********                                                         E22485
314700200529     C***********PROT      IFEQ '8'                                       E22485
314800200529     C***********          MOVE SDCP      EVDT                            E22485
314900200529     C***********          MOVE 'MP'      EVTP                            E22485
315000200529     C***********SEKEY     SETGTSEDEVDF                                   E22485
315100200529     C***********          READPSEDEVDF                  19               E22485
315200200529     C**N19******RECI      COMP 'D'                  1919                 E22485
315300200529     C***********                                                         E22485
315400200529     C**IF*SECURITY DIARY RECORD NOT FOUND - USE FACTOR ROM SECURITY FILE E22485
315500200529     C***********                                                         E22485
315600200529     C************IN19     IFEQ '0'                                       E22485
315700200529     C***********SDSN      ANDEQTDSS                                      E22485
315800200529     C***********SDET      ANDEQ'MP'                                      E22485
315900200529     C***********SET       MULT SDCP      FVAL      H                     E22485
316000200529     C***********          ELSE                                           E22485
316100200529     C***********SET       MULT CFCT      FVAL      H                     E22485
316200200529     C***********          END                                            E22485
316300200529     C***********                                                         E22485
316400200529     C*
316500200529     C* REALLOWANCE KEYS
316600200529     C*
316700200529     C           *IN29     IFEQ '1'
316800200529     C           *IN33     ANDNE'1'
316900200529     C           *IN30     OREQ '1'
317000200529     C           *IN34     ANDNE'1'
317100200529     C*
317200200529     C* SET AMOUNT CODE DEPENDING ON REALLOWANCE VALUE AND
317300200529     C*     TRADE TYPE
317400200529     C*
317500200529     C           RALL      IFNE 0
317600200529     C*
317700200529     C           TDTP      IFEQ 'TP'
317800200529     C*
317900200529     C           RALL      IFLT 0
318000200529     C                     MOVE 'RR'      AMTC
318100200529     C                     ELSE
318200200529     C                     MOVE 'RE'      AMTC
318300200529     C                     END
318400200529     C*
318500200529     C                     ELSE
318600200529     C*
318700200529     C           RALL      IFLT 0
318800200529     C                     MOVE 'RE'      AMTC
318900200529     C                     ELSE
319000200529     C                     MOVE 'RR'      AMTC
319100200529     C                     END
319200200529     C*
319300200529     C                     END
319400200529     C*
319500200529     C                     END
319600200529     C*
319700200529      * FORMAT REALLOWANCE AMOUNT
319800200529     C*
319900200529     C                     Z-ADDRALL      WDRAL1
320000200529     C*
320100200529     C*     IF DISCOUNT ..
320200200529     C*
320300200529     C           STBS      IFEQ 'D'
320400200529     C           RALL      ANDNE0
320500200529     C                     Z-ADDTDVD      ZSDATE
320600200529     C                     Z-ADDMATY      ZEDATE
320700200529     C                     MOVE 'N'       DADJN                           100017
320800200529     C                     EXSR ZDAYS
320900200529     C                     MOVE ' '       DADJN                           100017
321000200529     C                     Z-ADDZDDAYS    #DDAYS  50
321100200529     C                     EXSR ZDYYR
321200200529     C           ZINTDD    IFNE 0
321300200529     C           RALL      MULT #DDAYS    WPRICE 158
321400200529     C           WPRICE    DIV  ZINTDD    WDRALL  95H
321500200529     C*
321600200529     C           WDRALL    IFGE 0
321700200529     C           1         SUB  WDRALL    WDRAL1 158
321800200529     C                     ELSE
321900200529     C                     Z-SUBWDRALL    WDRALL
322000200529     C           1         SUB  WDRALL    WDRAL1
322100200529     C                     Z-SUBWDRAL1    WDRAL1
322200200529     C                     END
322300200529     C*
322400200529     C                     ELSE
322500200529     C                     Z-ADD*ZEROS    WDRAL1
322600200529     C                     END
322700200529     C                     END
322800200529     C*
322900200529     C                     Z-ADD*ZEROS    ZRALL  150
323000200529     C                     Z-ADD*ZEROS    ZRALL0 150
323100200529     C                     Z-ADD*ZEROS    ZRALL1 151
323200200529     C                     Z-ADD*ZEROS    ZRALL2 152
323300200529     C                     Z-ADD*ZEROS    ZRALL3 153
323400200529     C                     MOVEA'0000'    *IN,42
323500200529     C***********42        ADD  CDP       J       20                      S01117
323600200529     C           42        ADD  A6NBDP    J       20                      S01117
323700200529     C                     MOVEA'1'       *IN,J
323800200529     C*
323900200529     C*  Calculate consideration/reallowance/charges/commission
324000200529     C*
324100200529     C   42      NOML      MULT WDRAL1    ZRALL0    H
324200200529     C   43      NOML      MULT WDRAL1    ZRALL1    H
324300200529     C   44      NOML      MULT WDRAL1    ZRALL2    H
324400200529     C   45      NOML      MULT WDRAL1    ZRALL3    H
324500200529     C*
324600200529     C* Price basis - divide by 100
324700200529     C*
324800200529     C           SPBS      IFEQ 'P'
324900200529     C   42                DIV  100       ZRALL0
325000200529     C   43                DIV  100       ZRALL1
325100200529     C   44                DIV  100       ZRALL2
325200200529     C   45                DIV  100       ZRALL3
325300200529     C                     END
325400200529     C*
325500200529     C   42                MOVE ZRALL0    ZRALL
325600200529     C   43                MOVE ZRALL1    ZRALL
325700200529     C   44                MOVE ZRALL2    ZRALL
325800200529     C   45                MOVE ZRALL3    ZRALL
325900200529     C*
326000200529     C*   Allow for nominal decimal places
326100200529     C*
326200200529     C           5         SUB  NMDP      DC      10
326300200529     C           ZRALL     MULT POWER8,DC ZRALL
326400200529     C*
326500200529     C                     MOVE TNMC      EVCY
326600200529     C           ZRALL     IFLT 0
326700200529     C                     Z-SUBZRALL     EVAM
326800200529     C                     ELSE
326900200529     C                     Z-ADDZRALL     EVAM
327000200529     C                     END
327100200529     C*
327200200529     C* WRITE RECORD OUT ONLY IF NE 0
327300200529     C*
327400200529     C           EVAM      IFNE 0
327500200529     C                     EXSR W01
327600200529     C/COPY WNCPYSRC,SE2290C045
327700200529     C                     END
327800200529     C*
327900200529     C                     END
328000200529     C*
328100200529     C* CHARGES AND COMMISSION KEYS
328200200529     C*
328300200529     C* MOVE CODES AND AMOUNTS INTO THE CODE AND AMT ARRAYS
328400200529     C*
328500200529     C           *IN29     IFEQ '1'
328600200529     C           *IN33     ANDNE'1'
328700200529     C           *IN30     OREQ '1'
328800200529     C           *IN34     ANDNE'1'
328900200529     C***********          MOVE TBCC      CCDE,1                          S01169
329000200529     C***********          MOVE TBCA      CAMT,1                          S01169
329100200529     C***********          MOVE TCCC      CCDE,2                          S01169
329200200529     C***********          MOVE TCCA      CAMT,2                          S01169
329300200529     C***********          MOVE TCC1      CCDE,3                          S01169
329400200529     C***********          MOVE TCA1      CAMT,3                          S01169
329500200529     C***********          MOVE TCC2      CCDE,4                          S01169
329600200529     C***********          MOVE TCA2      CAMT,4                          S01169
329700200529     C***********          MOVE TCC3      CCDE,5                          S01169
329800200529     C***********          MOVE TCA3      CAMT,5                          S01169
329900200529     C***********          MOVE TLTC      CCDE,6                          S01169
330000200529     C***********          MOVE TLTA      CAMT,6                          S01169
330100200529     C***********          MOVE TOCC      CCDE,7                          S01169
330200200529     C***********          MOVE TOCA      CAMT,7                          S01169
330300200529     C                     MOVE TBCC      XCD,1                           S01169
330400200529     C                     MOVE TBCA      XAM,1                           S01169
330500200529     C                     MOVE TCCC      XCD,2                           S01169
330600200529     C                     MOVE TCCA      XAM,2                           S01169
330700200529     C                     MOVE TCC1      XCD,3                           S01169
330800200529     C                     MOVE TCA1      XAM,3                           S01169
330900200529     C                     MOVE TCC2      XCD,4                           S01169
331000200529     C                     MOVE TCA2      XAM,4                           S01169
331100200529     C                     MOVE TCC3      XCD,5                           S01169
331200200529     C                     MOVE TCA3      XAM,5                           S01169
331300200529     C***********          MOVE TLTC      XCD,6                    S01169 S01176
331400200529     C***********          MOVE TLTA      XAM,6                    S01169 S01176
331500200529     C***********          MOVE TOCC      XCD,7                    S01169 S01176
331600200529     C***********          MOVE TOCA      XAM,7                    S01169 S01176
331700200529     C***********          MOVE TTCC      XCD,8                    S01169 S01176
331800200529     C***********          MOVE LTCA      XAM,8                    S01169 S01176
331900200529     C***********          MOVE TPCC      XCD,9                    S01169 S01176
332000200529     C***********          MOVE TPCA      XAM,9                    S01169 S01176
332100200529     C***********          MOVE TVCC      XCD,10                   S01169 S01176
332200200529     C***********          MOVE TVCA      XAM,10                   S01169 S01176
332300200529     C                     MOVE TCC4      XCD,6                           S01176
332400200529     C                     MOVE TCA4      XAM,6                           S01176
332500200529     C                     MOVE TCC5      XCD,7                           S01176
332600200529     C                     MOVE TCA5      XAM,7                           S01176
332700200529     C                     MOVE TCC6      XCD,8                           S01176
332800200529     C                     MOVE TCA6      XAM,8                           S01176
332900200529     C                     MOVE TCC7      XCD,9                           S01176
333000200529     C                     MOVE TCA7      XAM,9                           S01176
333100200529     C                     MOVE TAXC      XCD,10                          S01176
333200200529     C                     MOVE TAXA      XAM,10                          S01176
333300200529     C/COPY WNCPYSRC,SE2290C080
333400200529     C*                                                            S01169 E20602
333500200529     C**REVERSE*THE*SIGN*OF*CHARGE/COMMISSION*VALUES*FOR*A*TRADE** S01176 E20602
333600200529     C**PURCHASE*FOR*MARKET*OR*PORTFOLIO*CUSTOMERS**************** S01176 E20602
333700200529     C***********                                                  S01176 E20602
333800200529     C***********C1DI      IFEQ 'M'                                S01176 E20602
333900200529     C***********TDTP      ANDEQ'TP'                               S01176 E20602
334000200529     C***********C1DI      OREQ 'S'                                S01176 E20602
334100200529     C***********TDTP      ANDEQ'TP'                               S01176 E20602
334200200529     C***********C1DI      OREQ 'D'                                S01176 E20602
334300200529     C***********TDTP      ANDEQ'TP'                               S01176 E20602
334400200529     C***********                                                  S01176 E20602
334500200529     C***********          Z-SUBTBCA      XAM,1                    S01176 E20602
334600200529     C***********          Z-SUBTCCA      XAM,2                    S01176 E20602
334700200529     C***********          Z-SUBTCA1      XAM,3                    S01176 E20602
334800200529     C***********          Z-SUBTCA2      XAM,4                    S01176 E20602
334900200529     C***********          Z-SUBTCA3      XAM,5                    S01176 E20602
335000200529     C***********          Z-SUBTCA4      XAM,6                    S01176 E20602
335100200529     C***********          Z-SUBTCA5      XAM,7                    S01176 E20602
335200200529     C***********          Z-SUBTCA6      XAM,8                    S01176 E20602
335300200529     C***********          Z-SUBTCA7      XAM,9                    S01176 E20602
335400200529     C***********          Z-SUBTAXA      XAM,10                   S01176 E20602
335500200529     C***********                                                  S01176 E20602
335600200529     C***********          END                                     S01176 E20602
335700200529     C*                                                                   S01169
335800200529     C* DETERMINE AMOUNT CODE FOR EACH AMOUNT DEPENDING ON                S01169
335900200529     C* DISCRETIONARY IND AND SIGN OF CHARGES/COMMISSION AMOUNT
336000200529     C*
336100200529     C***********          DO   7         I       10                      S01169
336200200529     C                     DO   10        I       20                      S01169
336300200529     C*
336400200529     C***********CCDE,I    IFNE '  '                                      S01169
336500200529     C           XCD,I     IFNE '  '                                      S01169
336600200529     C           I         COMP 3                      38
336700200529     C*
336800200529     C           I         IFGE 8                                         S01169
336900200529     C                     SETOF                     38                   S01169
337000200529     C                     END                                            S01169
337100200529     C***********                                                         S01169
337200200529     C**Reverse*sign*for*Sale*to*market*client*or*purchase*from*portfolio S01176
337300200529     C**customer*for*charges/commissions*values************************   S01176
337400200529     C***********                                                         S01176
337500200529     C***********C1DI      IFEQ 'M'                                S01158 S01176
337600200529     C***********TDTP      ANDEQ'TS'                               S01158 S01176
337700200529     C***********C1DI      OREQ 'I'                                S01158 S01176
337800200529     C***********TDTP      ANDEQ'TS'                               S01158 S01176
337900200529     C***********C1DI      OREQ 'D'                                S01158 S01176
338000200529     C***********TDTP      ANDEQ'TP'                               S01158 S01176
338100200529     C***********C1DI      OREQ 'S'                                S01158 S01176
338200200529     C***********TDTP      ANDEQ'TP'                               S01158 S01176
338300200529     C***********          Z-SUBTBCA      CAMT,1                   S01158 S01176
338400200529     C***********          Z-SUBTCCA      CAMT,2                   S01158 S01176
338500200529     C***********          Z-SUBTCA1      CAMT,3                   S01158 S01176
338600200529     C***********          Z-SUBTCA2      CAMT,4                   S01158 S01176
338700200529     C***********          Z-SUBTCA3      CAMT,5                   S01158 S01176
338800200529     C***********          Z-SUBTLTA      CAMT,6                   S01158 S01176
338900200529     C***********          Z-SUBTOCA      CAMT,7                   S01158 S01176
339000200529     C***********          Z-SUBTBCA      XAM,1                    S01158 S01176
339100200529     C***********          Z-SUBTCCA      XAM,2                    S01158 S01176
339200200529     C***********          Z-SUBTCA1      XAM,3                    S01158 S01176
339300200529     C***********          Z-SUBTCA2      XAM,4                    S01158 S01176
339400200529     C***********          Z-SUBTCA3      XAM,5                    S01158 S01176
339500200529     C***********          Z-SUBTLTA      XAM,6                    S01158 S01176
339600200529     C***********          Z-SUBTOCA      XAM,7                    S01158 S01176
339700200529     C***********          Z-SUBLTCA      XAM,8                    S01169 S01176
339800200529     C***********          Z-SUBTPCA      XAM,9                    S01169 S01176
339900200529     C***********          Z-SUBTVCA      XAM,10                   S01169 S01176
340000200529     C***********          END                                     S01158 S01176
340100200529     C***********                                                  S01158 S01176
340200200529     C***********C1DI      IFEQ 'M'                                       S01176
340300200529     C***********C1DI      OREQ 'I'                                       S01176
340400200529     C***********                                                         S01176
340500200529     C***********CAMT,I    IFGT 0                                  S01169 S01176
340600200529     C***********XAM,I     IFGT 0                                  S01169 S01176
340700200529     C***38******          MOVE 'CP'      AMTC                            S01176
340800200529     C**N38******          MOVE 'FP'      AMTC                            S01176
340900200529     C***********          ELSE                                           S01176
341000200529     C***38******          MOVE 'CR'      AMTC                            S01176
341100200529     C**N38******          MOVE 'FR'      AMTC                            S01176
341200200529     C***********          END                                            S01176
341300200529     C***********                                                         S01176
341400200529     C***********          ELSE                                           S01176
341500200529     C***********CAMT,I    IFGT 0                                  S01169 S01176
341600200529     C***********XAM,I     IFGT 0                   *S5436         S01169 S01176
341700200529     C***38******          MOVE 'CR'      AMTC                            S01176
341800200529     C**N38******          MOVE 'FR'      AMTC                            S01176
341900200529     C***********          ELSE                                           S01176
342000200529     C***38******          MOVE 'CP'      AMTC                            S01176
342100200529     C**N38******          MOVE 'FP'      AMTC                            S01176
342200200529     C***********          END                                            S01176
342300200529     C***********                                                         S01176
342400200529     C***********          END                                            S01176
342500200529     C*                                                                   S01176
342600200529     C***********XAM,I     IFGT 0                                  S01176 E20602
342700200529     C*                                                                   E20602
342800200529     C* DETERMINE AMOUNT CODE ACCORDING TO TYPE OF TRADE AND SIGN OF      E20602
342900200529     C* CHARGE/COMMISSION AS READ FROM TRADSD FILE.                       E20602
343000200529     C*                                                                   E20602
343100200529     C           TDTP      IFEQ 'TP'                                      E20602
343200200529     C           XAM,I     ANDLT0                                         E20602
343300200529     C           TDTP      OREQ 'TS'                                      E20602
343400200529     C           XAM,I     ANDGT0                                         E20602
343500200529     C   38                MOVE 'CR'      AMTC                            S01176
343600200529     C  N38                MOVE 'FR'      AMTC                            S01176
343700200529     C                     ELSE                                           S01176
343800200529     C   38                MOVE 'CP'      AMTC                            S01176
343900200529     C  N38                MOVE 'FP'      AMTC                            S01176
344000200529     C                     END                                            S01176
344100200529     C*                                                                   S01176
344200200529     C*
344300200529     C/COPY WNCPYSRC,SE2290C024
344400200529     C                     MOVE TNMC      EVCY
344500200529     C/COPY WNCPYSRC,SE2290C025
344600200529     C***********CAMT,I    IFLT 0                                         S01169
344700200529     C***********          Z-SUBCAMT,I    EVAM                            S01169
344800200529     C***********XAM,I     IFLT 0                                   S01169E16800
344900200529     C***********          Z-SUBXAM,I     EVAM                      S01169E16800
345000200529     C***********          ELSE                                           E16800
345100200529     C***********          Z-ADDCAMT,I    EVAM                            S01169
345200200529     C***********          Z-ADDXAM,I     EVAM                     S01169 E20602
345300200529     C***********          END                                            E16800
345400200529     C*
345500200529     C***********          MOVE CCDE,I    CCCD                            S01169
345600200529     C                     MOVE XCD,I     CCCD                            S01169
345700200529     C/COPY WNCPYSRC,SE2290C026
345800200529      *                                                                   S01446
345900200529      ** If Autocharges is switched on and S01446 is on then              S01446
346000200529      *  Or Analytical Accounting is installed,                           CAC002
346100200529      *                                                                   S01446
346200200529     C           BVACOP    IFEQ 'Y'                        B1             S01446
346300200529     C           S01446    ANDEQ'Y'                                       S01446
346400200529     C           BGN0ST    OREQ 'Y'                                       CAC002
346500200529      *                                                                   S01446
346600200529      ** Access Charges Codes file                                        S01446
346700200529      *                                                                   S01446
346800200529     C                     CALL 'AOCHGTR0'                                S01446
346900200529     C                     PARM '*MSG   ' @RTCD   7                       S01446
347000200529     C                     PARM '*KEY   ' @OPTN   7                       S01446
347100200529     C                     PARM SNMCY     @CCY    3                       S01446
347200200529     C                     PARM CCCD      @CHGC   2                       S01446
347300200529     C           @SECGT    PARM @SECGT    DSSDY                           S01446
347400200529     C*                                                                   S01446
347500200529     C           @RTCD     IFNE *BLANKS                    B*2            S01446
347600200529     C                     MOVE '1'       *INU7                           S01446
347700200529     C                     MOVE '1'       *INU8                           S01446
347800200529     C           *LOCK     IN   LDA                                       S01446
347900200529     C                     MOVEL'SECGT   'DBFILE            **************S01446
348000200529     C                     MOVELSNMCY     DBKEY             * DB ERROR 31*S01446
348100200529     C                     MOVE CCCD      DBKEY             **************S01446
348200200529     C                     MOVE @OPTN     DBOPTN                          S01446
348300200529     C                     Z-ADD31        DBASE                           S01446
348400200529     C                     OUT  LDA                                       S01446
348500200529     C                     DUMP                                           S01446
348600200529     C                     GOTO MEND                                      S01446
348700200529     C                     ELSE                            X*2            S01446
348800200529      *                                                                   CAC002
348900200529     C           BVACOP    IFEQ 'Y'                                       CAC002
349000200529     C           S01446    ANDEQ'Y'                                       CAC002
349100200529     C                     MOVE GCCO      CCCD                            S01446
349200200529     C                     ENDIF                                          CAC002
349300200529      *                                                                   CAC002
349400200529      ** If Analytical Accounting is installed, define a Profit Centre.   CAC002
349500200529      *                                                                   CAC002
349600200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
349700200529      *                                                                   CAC002
349800200529     C           BVACOP    IFEQ 'Y'                                       CAC002
349900200529     C           S01446    ANDEQ'Y'                                       CAC002
350000200529      *                                                                   CAC002
350100200529      ** Access charges codes file for Group charge code.                 CAC002
350200200529      *                                                                   CAC002
350300200529     C                     CALL 'AOCHGTR0'                                CAC002
350400200529     C                     PARM '*MSG   ' @RTCD                           CAC002
350500200529     C                     PARM '*KEY   ' @OPTN                           CAC002
350600200529     C                     PARM SNMCY     @CCY                            CAC002
350700200529     C                     PARM CCCD      @CHGC                           CAC002
350800200529     C           @SECGT    PARM @SECGT    DSSDY                           CAC002
350900200529     C*                                                                   CAC002
351000200529     C           @RTCD     IFNE *BLANKS                                   CAC002
351100200529     C                     MOVE '1'       *INU7                           CAC002
351200200529     C                     MOVE '1'       *INU8                           CAC002
351300200529     C           *LOCK     IN   LDA                                       CAC002
351400200529     C                     MOVEL'SECGT   'DBFILE           ************   CAC002
351500200529     C                     MOVELSNMCY     DBKEY            * DBERR 33 *   CAC002
351600200529     C                     MOVE CCCD      DBKEY            ************   CAC002
351700200529     C                     MOVE @OPTN     DBOPTN                          CAC002
351800200529     C                     Z-ADD33        DBASE                           CAC002
351900200529     C                     OUT  LDA                                       CAC002
352000200529     C                     DUMP                                           CAC002
352100200529     C                     GOTO MEND                                      CAC002
352200200529     C                     ENDIF                                          CAC002
352300200529      *                                                                   CAC002
352400200529     C                     ENDIF                                          CAC002
352500200529      *                                                                   CAC002
352600200529     C           BOTR      IFEQ ' '                                       CAC002
352700200529     C                     MOVE XPRFC     WWPRFC  4                       CAC002
352800200529     C                     ENDIF                                          CAC002
352900200529     C*                                                                   CAC002
353000200529     C           BOTR      IFEQ 'T'                                       CAC002
353100200529     C                     MOVE TPRC      WWPRFC                          CAC002
353200200529     C                     ENDIF                                          CAC002
353300200529     C*                                                                   CAC002
353400200529     C           BOTR      IFEQ 'B'                                       CAC002
353500200529     C                     MOVE BPRC      WWPRFC                          CAC002
353600200529     C                     ENDIF                                          CAC002
353700200529     C*                                                                   CAC002
353800200529     C                     ENDIF                                          CAC002
353900200529      *                                                                   CAC002
354000200529     C                     END                             E*2            S01446
354100200529     C                     END                             E1             S01446
354200200529     C*                                                                   S01446
354300200529     C                     Z-ADDXAM,I     EVAM                            E21273
354400200529     C*
354500200529     C* IF CHARGES/COMMISSIONS AS READ FROM TRADSD FILE ARE NEGATIVE      E20602
354600200529     C* THEN REVERSE THE SIGN, SO AS TO PRODUCE A POSITIVE EVENT AMOUNT   E20602
354700200529     C* FOR THE CHARGES/COMMISSIONS ACCOUNT KEY.                          E20602
354800200529     C*                                                                   E20602
354900200529     C           XAM,I     IFLT 0                                         E20602
355000200529     C                     Z-SUBXAM,I     EVAM                            E20602
355100200529     C                     END                                            E20602
355200200529     C/COPY WNCPYSRC,SE2290C039
355300200529     C*
355400200529     C* WRITE RECORD OUT ONLY IF NE 0
355500200529     C*
355600200529     C           EVAM      IFNE 0
355700200529     C                     EXSR W01
355800200529     C/COPY WNCPYSRC,SE2290C040
355900200529     C                     END
356000200529     C*
356100200529     C                     END
356200200529     C                     END
356300200529     C                     END
356400200529     C/COPY WNCPYSRC,SE2290C041
356500200529     C*                                                                   S01176
356600200529     C* REBATE KEYS                                                       S01176
356700200529     C*                                                                   S01176
356800200529     C* DETERMINE IF KEYS ARE BEING SUPPRESSED                            S01176
356900200529     C*                                                                   S01176
357000200529     C           *IN29     IFEQ '1'                                       S01176
357100200529     C           *IN33     ANDNE'1'                                       S01176
357200200529     C           *IN30     OREQ '1'                                       S01176
357300200529     C           *IN34     ANDNE'1'                                       S01176
357400200529     C*                                                                   S01176
357500200529     C* Reverse sign of the rebate amounts for a trade purchase           S01176
357600200529     C* with a market or portfolio customer                               S01176
357700200529     C*                                                                   S01176
357800200529     C           C1DI      IFEQ 'M'                                       S01176
357900200529     C           TDTP      ANDEQ'TP'                                      S01176
358000200529     C           C1DI      OREQ 'D'                                       S01176
358100200529     C           TDTP      ANDEQ'TP'                                      S01176
358200200529     C           C1DI      OREQ 'S'                                       S01176
358300200529     C           TDTP      ANDEQ'TP'                                      S01176
358400200529     C*                                                                   S01176
358500200529     C           BCMR      MULT -1        BCMR                            S01176
358600200529     C           CCMR      MULT -1        CCMR                            S01176
358700200529     C           TXRB      MULT -1        TXRB                            S01176
358800200529     C*                                                                   S01176
358900200529     C                     END                                            S01176
359000200529     C*                                                                   S01176
359100200529     C                     MOVE TBCC      RCD,1                           S01176
359200200529     C                     MOVE BCMR      RAM,1                           S01176
359300200529     C                     MOVE TCCC      RCD,2                           S01176
359400200529     C                     MOVE CCMR      RAM,2                           S01176
359500200529     C                     MOVE TAXC      RCD,3                           S01176
359600200529     C                     MOVE TXRB      RAM,3                           S01176
359700200529     C*                                                                   S01176
359800200529     C* DETERMINE AMOUNT CODE FOR EACH AMOUNT DEPENDING ON                S01176
359900200529     C* DISCRETIONARY IND AND SIGN OF THE REBATE AMOUNT                   S01176
360000200529     C*                                                                   S01176
360100200529     C                     DO   3         I                               S01176
360200200529     C*                                                                   S01176
360300200529     C           RCD,I     IFNE '  '                                      S01176
360400200529     C*                                                                   S01176
360500200529     C           RAM,I     IFGT 0                                         S01176
360600200529     C                     MOVE 'ZR'      AMTC                            S01176
360700200529     C                     ELSE                                           S01176
360800200529     C                     MOVE 'ZP'      AMTC                            S01176
360900200529     C                     END                                            S01176
361000200529     C*                                                                   S01176
361100200529     C                     MOVE TNMC      EVCY                            S01176
361200200529     C           RAM,I     IFLT 0                                         S01176
361300200529     C                     Z-SUBRAM,I     EVAM                            S01176
361400200529     C                     ELSE                                           S01176
361500200529     C                     Z-ADDRAM,I     EVAM                            S01176
361600200529     C                     END                                            S01176
361700200529     C*                                                                   S01176
361800200529     C                     MOVE RCD,I     CCCD                            S01176
361900200529      *                                                                   S01446
362000200529      ** If Autocharges is switched on and S01446 is on then              S01446
362100200529      *  Or Analytical Accounting is installed,                           CAC002
362200200529      *                                                                   S01446
362300200529     C           BVACOP    IFEQ 'Y'                        B1             S01446
362400200529     C           S01446    ANDEQ'Y'                                       S01446
362500200529     C           EVAM      ANDNE0                                         S01176
362600200529     C           BGN0ST    OREQ 'Y'                                       CAC002
362700200529     C           EVAM      ANDNE0                                         CAC002
362800200529      *                                                                   S01446
362900200529      ** Access Charges Codes file for group charge code                  S01446
363000200529      *                                                                   S01446
363100200529     C                     CALL 'AOCHGTR0'                                S01446
363200200529     C                     PARM '*MSG   ' @RTCD   7                       S01446
363300200529     C                     PARM '*KEY   ' @OPTN   7                       S01446
363400200529     C                     PARM SNMCY     @CCY    3                       S01446
363500200529     C                     PARM CCCD      @CHGC   2                       S01446
363600200529     C           @SECGT    PARM @SECGT    DSSDY                           S01446
363700200529     C*                                                                   S01446
363800200529     C           @RTCD     IFNE *BLANKS                    B*2            S01446
363900200529     C                     MOVE '1'       *INU7                           S01446
364000200529     C                     MOVE '1'       *INU8                           S01446
364100200529     C           *LOCK     IN   LDA                                       S01446
364200200529     C                     MOVEL'SECGT   'DBFILE            **************S01446
364300200529     C                     MOVELSNMCY     DBKEY             * DB ERROR 32*S01446
364400200529     C                     MOVE CCCD      DBKEY             **************S01446
364500200529     C                     MOVE @OPTN     DBOPTN                          S01446
364600200529     C                     Z-ADD32        DBASE                           S01446
364700200529     C                     OUT  LDA                                       S01446
364800200529     C                     DUMP                                           S01446
364900200529     C                     GOTO MEND                                      S01446
365000200529     C                     ELSE                            X*2            S01446
365100200529      *                                                                   CAC002
365200200529     C           BVACOP    IFEQ 'Y'                                       CAC002
365300200529     C           S01446    ANDEQ'Y'                                       CAC002
365400200529     C                     MOVE GCCO      CCCD                            S01446
365500200529     C                     ENDIF                                          CAC002
365600200529      *                                                                   CAC002
365700200529      ** If Analytical Accounting is installed, define a Profit Centre.   CAC002
365800200529      *                                                                   CAC002
365900200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
366000200529      *                                                                   CAC002
366100200529     C           BVACOP    IFEQ 'Y'                                       CAC002
366200200529     C           S01446    ANDEQ'Y'                                       CAC002
366300200529      *                                                                   CAC002
366400200529      ** Access charges codes file for Group charge code.                 CAC002
366500200529      *                                                                   CAC002
366600200529     C                     CALL 'AOCHGTR0'                                CAC002
366700200529     C                     PARM '*MSG   ' @RTCD                           CAC002
366800200529     C                     PARM '*KEY   ' @OPTN                           CAC002
366900200529     C                     PARM SNMCY     @CCY                            CAC002
367000200529     C                     PARM CCCD      @CHGC                           CAC002
367100200529     C           @SECGT    PARM @SECGT    DSSDY                           CAC002
367200200529     C*                                                                   CAC002
367300200529     C           @RTCD     IFNE *BLANKS                                   CAC002
367400200529     C                     MOVE '1'       *INU7                           CAC002
367500200529     C                     MOVE '1'       *INU8                           CAC002
367600200529     C           *LOCK     IN   LDA                                       CAC002
367700200529     C                     MOVEL'SECGT   'DBFILE           ************   CAC002
367800200529     C                     MOVELSNMCY     DBKEY            * DBERR 34 *   CAC002
367900200529     C                     MOVE CCCD      DBKEY            ************   CAC002
368000200529     C                     MOVE @OPTN     DBOPTN                          CAC002
368100200529     C                     Z-ADD34        DBASE                           CAC002
368200200529     C                     OUT  LDA                                       CAC002
368300200529     C                     DUMP                                           CAC002
368400200529     C                     GOTO MEND                                      CAC002
368500200529     C                     ENDIF                                          CAC002
368600200529      *                                                                   CAC002
368700200529     C                     ENDIF                                          CAC002
368800200529      *                                                                   CAC002
368900200529     C           BOTR      IFEQ ' '                                       CAC002
369000200529     C                     MOVE XPRFC     WWPRFC                          CAC002
369100200529     C                     ENDIF                                          CAC002
369200200529     C*                                                                   CAC002
369300200529     C           BOTR      IFEQ 'T'                                       CAC002
369400200529     C                     MOVE TPRC      WWPRFC                          CAC002
369500200529     C                     ENDIF                                          CAC002
369600200529     C*                                                                   CAC002
369700200529     C           BOTR      IFEQ 'B'                                       CAC002
369800200529     C                     MOVE BPRC      WWPRFC                          CAC002
369900200529     C                     ENDIF                                          CAC002
370000200529     C*                                                                   CAC002
370100200529     C                     ENDIF                                          CAC002
370200200529      *                                                                   CAC002
370300200529     C                     END                             E*2            S01446
370400200529     C                     END                             E1             S01446
370500200529     C*                                                                   S01176
370600200529     C* WRITE RECORD OUT ONLY IF NE 0                                     S01176
370700200529     C*                                                                   S01176
370800200529     C           EVAM      IFNE 0                                         S01176
370900200529     C                     EXSR W01                                       S01176
371000200529     C                     END                                            S01176
371100200529     C*                                                                   S01176
371200200529     C                     END                                            S01176
371300200529     C                     END                                            S01176
371400200529     C                     END                                            S01176
371500200529     C*                                                                   S01176
371600200529     C* COUNTERVALUE KEY
371700200529     C*                                                                   S01176
371800200529     C           CVALUE    TAG
371900200529     C                     MOVE 'CN'      AMTC
372000200529     C                     MOVE TNMC      EVCY
372100200529     C                     Z-ADDTCTR      EVAM
372200200529     C                     MOVE '  '      CCCD                            E14544
372300200529     C                     MOVE *ZEROS    KNCA
372400200529     C***********          MOVE '   '     KCCY                            S01176
372500200529     C                     MOVE SNMCY     KCCY                            S01176
372600200529     C                     MOVE *ZEROS    KBCA
372700200529     C***********          SETON                     39                   S01176
372800200529     C*
372900200529     C           EVAM      IFNE 0
373000200529     C                     EXSR W01
373100200529     C                     END
373200200529     C*                                                                   CSE023
373300200529     C** If Backup Witholding Tax is applied then output A/C key          CSE023
373400200529     C*                                                                   CSE023
373500200529     C           WHTX      IFNE 0                                         CSE023
373600200529     C                     MOVE 'BW'      AMTC                            CSE023
373700200529     C                     MOVE TNMC      EVCY                            CSE023
373800200529     C                     MOVE '  '      CCCD                            CSE023
373900200529     C                     Z-ADDWHTX      EVAM                            CSE023
374000200529     C                     MOVE SNMCY     KCCY                            CSE023
374100200529     C                     MOVE *ZEROS    KBCA                            CSE023
374200200529     C                     EXSR W01                                       CSE023
374300200529     C                     END                                            CSE023
374400200529     C*                                                                   CSE023
374500200529     C           CGL031    IFEQ 'Y'                                                           CGL031
374600200529     C           *IN30     ANDEQ*ON                                                           CGL031
374700200529      *  DETERMINE WHETHER TO GENERATE REVERSALS FOR TAX AND NETT INTEREST.                   236063
374800200529     C                     EXSR SRGNRV                                                        236063
374900200529      *                                                                                       236063
375000200529      *                                                                                       CGL031
375100200529      ** Retrieve Tax Amounts as at Start of Business and generate reversals                  235615
375200200529      *                                                                                       235615
375300200529     C           WKGNRV    IFEQ 'Y'                                                           236063
375400200529     C                     EXSR SRETXR                                                        235615
375500200529      *                                                                                       235615
375600200529      ** Generate Net Interest Account Key to Reverse Start of Business Amount                235615
375700200529      *                                                                                       235615
375800200529     C           WIEVAM    IFGT 0                                                             235615
375900200529     C                     MOVE *BLANK    CCCD                                                235615
376000200529     C                     MOVE *BLANK    CTTX                                                235615
376100200529     C                     MOVE 'NI'      AMTC                                                235615
376200200529     C                     Z-ADDWIEVAM    EVAM                                                235615
376300200529     C                     MOVE WKCCY     EVCY                                                235615
376400200529     C                     Z-ADD*ZERO     KNCA                                                235615
376500200529     C                     MOVE WKCCY     KCCY                                                235615
376600200529     C                     Z-ADD*ZERO     KBCA                                                235615
376700200529     C                     MOVELRVRS      SVRVRS  1                                           235615
376800200529     C                     MOVEL'1'       RVRS                                                235615
376900200529     C                     EXSR W01                                                           235615
377000200529     C                     MOVELSVRVRS    RVRS                                                235615
377100200529     C                     ENDIF                                                              235615
377200200529      *                                                                                       236063
377300200529     C                     ENDIF                                                              236063
377400200529      *                                                                                       235615
377500200529      ** Retrieve Tax Amount                                                                  CGL031
377600200529      *                                                                                       CGL031
377700200529     C                     EXSR SRETAX                                                        CGL031
377800200529      *                                                                                       CGL031
377900200529      ***Generate*Tax*Amount*Account*Key*******************************                CGL031 235174
378000200529      *                                                                                       CGL031
378100200529     C********** WXEVAM    IFGT 0                                                      CGL031 235174
378200200529     C**********           MOVE *BLANK    CCCD                                         CGL031 235174
378300200529     C**********           MOVE TSCTRT    CTTX                                         CGL031 233999
378400200529     C**********           MOVE TSRCTR    CTTX                                         233999 235174
378500200529     C**********           MOVE 'ET'      AMTC                                         CGL031 235174
378600200529     C**********           Z-ADDWXEVAM    EVAM                                         CGL031 235174
378700200529     C**********           MOVE WEVCY     EVCY                                         CGL031 235174
378800200529     C**********           Z-ADDWXKNCA    KNCA                                         CGL031 235174
378900200529     C**********           MOVE WKCCY     KCCY                                         CGL031 235174
379000200529     C**********           Z-ADDWXKBCA    KBCA                                         CGL031 235174
379100200529     C**********           EXSR W01                                                    CGL031 235174
379200200529     C**********           ENDIF                                                       CGL031 235174
379300200529      *                                                                                       CGL031
379400200529      ** Generate Net Interest Account Key                                                    CGL031
379500200529      *                                                                                       CGL031
379600200529     C           WIEVAM    IFGT 0                                                             CGL031
379700200529     C                     MOVE *BLANK    CCCD                                                CGL031
379800200529     C                     MOVE *BLANK    CTTX                                                CGL031
379900200529     C                     MOVE 'NI'      AMTC                                                CGL031
380000200529     C                     Z-ADDWIEVAM    EVAM                                                CGL031
380100200529     C                     MOVE WKCCY     EVCY                                                CGL031
380200200529     C                     Z-ADD*ZERO     KNCA                                                CGL031
380300200529     C                     MOVE WKCCY     KCCY                                                CGL031
380400200529     C                     Z-ADD*ZERO     KBCA                                                CGL031
380500200529     C                     EXSR W01                                                           CGL031
380600200529     C                     ENDIF                                                              CGL031
380700200529      *                                                                                       CGL031
380800200529     C                     ENDIF                                                              CGL031
380900200529      *                                                                                       CGL031
381000200529     C/COPY WNCPYSRC,SE2290C027
381100200529     C*
381200200529     C***********          SETOF                     39                   S01176
381300200529     C*
381400200529     C* IF CROSS CURRENCY KEYS REQUIRED CHECK SETTLEMENT CURRENCY
381500200529     C*    AND BASE CURRENCY FOR ACCOUNTING
381600200529     C*
381700200529     C** On Trade Date, generate CV keys if Cross Currency Entries        066883
381800200529     C**  flag is 'T' or 'B'                                              066883
381900200529     C** On Value Date, generate CV keys if Cross Currency Entries        066883
382000200529     C**  flag is 'V' or 'B'                                              066883
382100200529     C*                                                                   066883
382200200529     C           *IN29     IFEQ '1'                                       066883
382300200529     C           BVCCYE    ANDEQ'T'                                       066883
382400200529     C           *IN29     OREQ '1'                                       066883
382500200529     C           BVCCYE    ANDEQ'B'                                       066883
382600200529     C           *IN30     OREQ '1'                                       066883
382700200529     C           BVCCYE    ANDEQ'V'                                       066883
382800200529     C           *IN30     OREQ '1'                                       066883
382900200529     C           BVCCYE    ANDEQ'B'                                       066883
383000200529     C************IN30     IFEQ '1'                                       066883
383100200529     C********** CCYE      ANDEQ'B'                                       E14513
383200200529     C************IN29     OREQ '1'                                       066883
383300200529     C***********CCYE      ANDEQ'B'                                       S01117
383400200529     C***********BVCCYE    ANDEQ'B'                                 S01117066883
383500200529     C/COPY WNCPYSRC,SE2290C028
383600200529     C*****************************************************************   S01117
383700200529     C**FIRST*ACCESS*TABTG10*FOR*NOMINAL*CCY'S*DEC*PLACES*AND*MULT/DIV*   S01117
383800200529     C*****************************************************************   S01117
383900200529     C***********          MOVEL'20      'TKEY
384000200529     C***********          MOVELSNMCY     ZWK4
384100200529     C***********          MOVE 1         ZWK4
384200200529     C***********          MOVE ZWK4      TKEY
384300200529     C***********TKEY      CHAINTABTG10F             10
384400200529     C*                                                                   S01117
384500200529     C*                                                                   S01117
384600200529     C* OBTAIN NOMINAL CURRENCY DECIMAL PALCES AND MULT/DIV INDICATOR     S01117
384700200529     C*                                                                   S01117
384800200529     C                     CALL 'AOCURRR0'                                S01117
384900200529     C                     PARM '*MSG   ' @RTCD   7                       S01117
385000200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
385100200529     C                     PARM SNMCY     @AJCD   3                       S01117
385200200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
385300200529     C*                                                                   S01117
385400200529     C************IN10     IFEQ '1'                                       S01117
385500200529     C           @RTCD     IFNE *BLANK                                    S01117
385600200529     C                     SETON                     U7U8LR
385700200529     C           *LOCK     IN   LDA                                       S01117
385800200529     C***********          MOVE 'TABLE'   DBFILE           ***************
385900200529     C***********          MOVELTKEY      DBKEY            * DB ERROR 10 *
386000200529     C**********           MOVE '10'      DBASE            ***************S01117
386100200529     C                     MOVEL'SDCURRPD'DBFILE                          S01194
386200200529     C                     MOVE @AJCD     DBKEY                           S01194
386300200529     C                     MOVE @OPTN     DBOPTN                          S01194
386400200529     C                     Z-ADD10        DBASE                           S01117
386500200529     C                     OUT  LDA                                       S01117
386600200529     C                     DUMP                                           S01117
386700200529     C                     GOTO MEND
386800200529     C                     ELSE
386900200529     C*
387000200529     C* SAVE NOM CCY CDP AND MULT/DIV IND TO AVOID A REPEAT ACCESS LATER
387100200529     C*
387200200529     C***********          Z-ADDCDP       NOMCDP  10                      S01117
387300200529     C***********          MOVE MDIN      NOMMDI  10                      S01117
387400200529     C***********          MOVE SPOT      NOMEXR 138                      S01117
387500200529     C                     Z-ADDA6NBDP    NOMCDP  10                      S01117
387600200529     C***********          MOVE A6MDIN    NOMMDI  10                      S01117
387700200529     C                     MOVE A6MDIN    NOMMDI  1                 S01117070683
387800200529     C                     MOVE A6SPRT    NOMEXR 138                      070683
387900200529     C                     END
388000200529     C*
388100200529     C* IF NOM CCY IS NOT EQUAL TP SETTLEMENT CCY CONVERT NOM TO SETT
388200200529     C*
388300200529     C           SNMCY     IFNE SETC
388400200529     C*
388500200529     C                     MOVE TCTR      ZAMTCI
388600200529     C*
388700200529     C* CONV. NOM TO SETT CCY USING EX.RATE AND M/D IND FROM TRADES FILE
388800200529     C*
388900200529     C                     MOVE TDER      ZEXCH
389000200529     C                     MOVE TMDI      ZMD
389100200529     C*
389200200529     C                     MOVE SNMCY     ZCCYI
389300200529     C                     MOVE SETC      ZCCYO
389400200529     C*
389500200529     C* CONVERT FROM ONE CURRENCY TO ANOTHER USING ZCONV
389600200529     C*                                                                   S01117
389700200529     C** FIND DECIMAL PLACES FOR (FROM) CURRENCY                          S01117
389800200529     C*                                                                   S01117
389900200529     C                     CALL 'AOCURRR0'                                S01117
390000200529     C                     PARM '*MSG   ' @RTCD   7                       S01117
390100200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
390200200529     C                     PARM ZCCYI     @AJCD   3                       S01117
390300200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
390400200529     C           @RTCD     IFNE *BLANKS                                   S01117
390500200529     C                     MOVE '1'       *INU7                           S01117
390600200529     C                     MOVE '1'       *INU8                           S01117
390700200529     C                     ELSE                                           S01117
390800200529     C                     Z-ADDA6NBDP    ZCDPI                           S01117
390900200529     C*                                                                   S01117
391000200529     C** FIND DECIMAL PLACES FOR (TO) CURRENCY                            S01117
391100200529     C*                                                                   S01117
391200200529     C                     CALL 'AOCURRR0'                                S01117
391300200529     C                     PARM '*MSG   ' @RTCD   7                       S01117
391400200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
391500200529     C                     PARM ZCCYO     @AJCD   3                       S01117
391600200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
391700200529     C           @RTCD     IFNE *BLANKS                                   S01117
391800200529     C                     MOVE '1'       *INU7                           S01117
391900200529     C                     MOVE '1'       *INU8                           S01117
392000200529     C                     ELSE                                           S01117
392100200529     C                     Z-ADDA6NBDP    ZCDPO                           S01117
392200200529     C                     END                                            S01117
392300200529     C                     END                                            S01117
392400200529     C*                                                                   S01117
392500200529     C           *INU8     IFEQ '1'                                       S01117
392600200529     C                     MOVE '1'       *INLR                           S01117
392700200529     C           *LOCK     IN   LDA                                       S01117
392800200529     C                     MOVEL'SDCURRPD'DBFILE           ***************S01117
392900200529     C                     MOVEL@AJCD     DBKEY            * DB ERROR 11 *S01117
393000200529     C                     Z-ADD11        DBASE            ***************S01117
393100200529     C                     OUT  LDA                                       S01117
393200200529     C                     DUMP                                           S01117
393300200529     C                     GOTO MEND                                      S01117
393400200529     C                     END                                            S01117
393500200529     C*
393600200529     C                     EXSR ZCONV
393700200529     C************IN90     IFEQ '1'                                       S01117
393800200529     C***********          SETON                     U7U8LR               S01117
393900200529     C***********          MOVE 'TABLE'   DBFILE                          S01117
394000200529     C***********          MOVELTKEY      DBKEY            ***************S01117
394100200529     C***********          MOVE '11'      DBASE            * DB ERROR 11 *S01117
394200200529     C***********          GOTO MEND                                      S01117
394300200529     C***********          END                                            S01117
394400200529     C*
394500200529     C                     Z-ADDZAMTCO    EVAM
394600200529     C                     ELSE
394700200529     C                     Z-ADDTCTR      EVAM
394800200529     C                     END
394900200529     C*
395000200529     C* IF NOMINAL CURRENCY NE BASE CCY FOR ACCOUNTING CALC
395100200529     C*    COUNTERVALUE IN BASE CURRENCY USING ZCONV
395200200529     C*
395300200529     C***********SNMCY     IFNE BCCY                                      S01117
395400200529     C           SNMCY     IFNE BJCYCD                                    S01117
395500200529     C*                                                                   E21244
395600200529     C* IF SETTLEMENT CCY NOT EQUAL TO BASE CCY, CONVERT NOMINAL          E21244
395700200529     C* CCY TO BASE CCY EQUIVALENT                                        E21244
395800200529     C*                                                                   E21244
395900200529     C***********SETC      IFNE BCCY                               E21244 S01117
396000200529     C           SETC      IFNE BJCYCD                                    S01117
396100200529     C*
396200200529     C*  CONVERT COUNTERVALUE TO BASE CCY
396300200529     C*
396400200529     C                     MOVE TCTR      ZAMTCI
396500200529     C*********************MOVE NOMEXR    ZEXCH                           037597
396600200529     C************         MOVE TBCR      ZEXCH                    037597 112898
396700200529     C                     MOVE NOMEXR    ZEXCH                           112898
396800200529     C***********NOMMDI    IFEQ 0                                         070683
396900200529     C***********          MOVE 'D'       ZMD                             070683
397000200529     C***********          ELSE                                           070683
397100200529     C***********          MOVE 'M'       ZMD                             070683
397200200529     C***********          END                                            070683
397300200529     C                     MOVE NOMMDI    ZMD                             070683
397400200529     C***********          MOVE BCCY      ZCCYO                           S01117
397500200529     C                     MOVE BJCYCD    ZCCYO                           S01117
397600200529     C**********           MOVE NMCY      ZCCYI
397700200529     C                     MOVE SNMCY     ZCCYI
397800200529     C*                                                                   S01117
397900200529     C** FIND DECIMAL PLACES FOR (FROM) CURRENCY                          S01117
398000200529     C*                                                                   S01117
398100200529     C                     CALL 'AOCURRR0'                                S01117
398200200529     C                     PARM '*MSG   ' @RTCD   7                       S01117
398300200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
398400200529     C                     PARM ZCCYI     @AJCD   3                       S01117
398500200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
398600200529     C           @RTCD     IFNE *BLANKS                                   S01117
398700200529     C                     MOVE '1'       *INU7                           S01117
398800200529     C                     MOVE '1'       *INU8                           S01117
398900200529     C                     MOVE '1'       *INLR                           S01117
399000200529     C           *LOCK     IN   LDA                                       S01117
399100200529     C                     MOVEL'SDCURRPD'DBFILE           ***************S01117
399200200529     C                     MOVEL@AJCD     DBKEY            * DB ERROR 13 *S01117
399300200529     C                     Z-ADD13        DBASE            ***************S01117
399400200529     C                     MOVE @OPTN     DBOPTN                          S01117
399500200529     C                     OUT  LDA                                       S01117
399600200529     C                     DUMP                                           S01117
399700200529     C                     GOTO MEND                                      S01117
399800200529     C                     ELSE                                           S01117
399900200529     C                     Z-ADDA6NBDP    ZCDPI                           S01117
400000200529     C                     END                                            S01117
400100200529     C*                                                                   S01117
400200200529     C** FIND DECIMAL PLACES FOR (TO) CURRENCY                            S01117
400300200529     C*                                                                   S01117
400400200529     C                     CALL 'AOCURRR0'                                S01117
400500200529     C                     PARM '*MSG   ' @RTCD   7                       S01117
400600200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
400700200529     C                     PARM ZCCYO     @AJCD   3                       S01117
400800200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
400900200529     C           @RTCD     IFNE *BLANKS                                   S01117
401000200529     C                     MOVE '1'       *INU7                           S01117
401100200529     C                     MOVE '1'       *INU8                           S01117
401200200529     C                     MOVE '1'       *INLR                           S01117
401300200529     C           *LOCK     IN   LDA                                       S01117
401400200529     C                     MOVEL'SDCURRPD'DBFILE           ***************S01117
401500200529     C                     MOVEL@AJCD     DBKEY            * DB ERROR 13 *S01117
401600200529     C                     Z-ADD13        DBASE            ***************S01117
401700200529     C                     MOVE @OPTN     DBOPTN                          S01117
401800200529     C                     OUT  LDA                                       S01117
401900200529     C                     DUMP                                           S01117
402000200529     C                     GOTO MEND                                      S01117
402100200529     C                     ELSE                                           S01117
402200200529     C                     Z-ADDA6NBDP    ZCDPO                           S01117
402300200529     C                     END                                            S01117
402400200529     C*
402500200529     C                     EXSR ZCONV
402600200529     C************IN90     IFEQ '1'                                       S01117
402700200529     C***********          SETON                     U7U8LR               S01117
402800200529     C***********          MOVE 'TABLE'   DBFILE                          S01117
402900200529     C***********          MOVELTKEY      DBKEY            ***************S01117
403000200529     C************         MOVE '13'      DBASE            * DB ERROR 13 *S01117
403100200529     C***********          GOTO MEND                       ***************S01117
403200200529     C***********          END                                            S01117
403300200529     C*
403400200529     C                     Z-ADDZAMTCO    KBCA
403500200529     C*                                                                   E21244
403600200529     C* ELSE BASE CURRENCY EQUIVALENT IS COUNTERVALUE IN SETTLEMENT CCY   E21244
403700200529     C*                                                                   E21244
403800200529     C                     ELSE                                           E21244
403900200529     C                     Z-ADDEVAM      KBCA                            E21244
404000200529     C*                                                                   CAC002
404100200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
404200200529     C           TDTP      IFEQ 'TS'                                      CAC002
404300200529     C                     SUB  MAMT      KBCA                            CAC002
404400200529     C                     ELSE                                           CAC002
404500200529     C                     ADD  MAMT      KBCA                            CAC002
404600200529     C                     ENDIF                                          CAC002
404700200529     C                     ENDIF                                          CAC002
404800200529     C*                                                                   CAC002
404900200529     C                     END                                            E21244
405000200529     C                     ELSE
405100200529     C                     Z-ADDTCTR      KBCA
405200200529     C                     END
405300200529     C/COPY WNCPYSRC,SE2290C029
405400200529     C*
405500200529     C                     MOVE 'CV'      AMTC
405600200529     C/COPY WNCPYSRC,SE2290C030
405700200529     C                     MOVE SETC      EVCY
405800200529     C                     Z-ADDTCTR      KNCA
405900200529     C                     MOVE SNMCY     KCCY
406000200529     C*
406100200529     C* WRITE RECORD OUT ONLY IF EVENT AMOUNT NE ZERO
406200200529     C*
406300200529     C           EVAM      IFNE 0
406400200529     C                     EXSR W01
406500200529     C                     END
406600200529     C/COPY WNCPYSRC,SE2290C031
406700200529     C*
406800200529     C                     END
406900200529     C/COPY WNCPYSRC,SE2290C075
407000200529      *                                                                   CAC002
407100200529      ** If Analytical Accounting is installed and the Margin amount is   CAC002
407200200529      ** not zero, generate Margin Amount key.                            CAC002
407300200529      *                                                                   CAC002
407400200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
407500200529     C*                                                                   CAC002
407600200529     C           *IN29     IFEQ '1'                                       CAC002
407700200529     C           BVCCYE    ANDEQ'T'                                       CAC002
407800200529     C           *IN29     OREQ '1'                                       CAC002
407900200529     C           BVCCYE    ANDEQ'B'                                       CAC002
408000200529     C           *IN30     OREQ '1'                                       CAC002
408100200529     C           BVCCYE    ANDEQ'V'                                       CAC002
408200200529     C           *IN30     OREQ '1'                                       CAC002
408300200529     C           BVCCYE    ANDEQ'B'                                       CAC002
408400200529     C*                                                                   CAC002
408500200529     C           MAMT      IFNE 0                                         CAC002
408600200529     C                     MOVE 'MV'      AMTC                            CAC002
408700200529     C                     Z-ADDMAMT      EVAM                            CAC002
408800200529     C                     MOVE SETC      EVCY                            CAC002
408900200529     C                     EXSR W01                                       CAC002
409000200529     C                     ENDIF                                          CAC002
409100200529     C*                                                                   CAC002
409200200529     C                     ENDIF                                          CAC002
409300200529     C*                                                                   CAC002
409400200529     C                     ENDIF                                          CAC002
409500200529     C/COPY WNCPYSRC,SE2290C032
409600200529     C*
409700200529     C   25                GOTO ENDKEY
409800200529     C/COPY WNCPYSRC,SE2290C073
409900200529     C*
410000200529     C* PURCHASED INTEREST KEYS
410100200529     C*
410200200529     C           *IN29     IFEQ '1'
410300200529     C           *IN33     ANDNE'1'
410400200529     C           ITRA      ANDNE*ZERO
410500200529     C           PROT      ANDNE'6'
410600200529     C                     MOVE 'PI'      AMTC
410700200529     C                     MOVE TNMC      EVCY
410800200529     C/COPY WNCPYSRC,SE2290C048
410900200529     C**********           Z-ADDITRA      EVAM
411000200529     C********** TDTP      IFEQ 'TS'                                      S01158
411100200529     C**********           Z-SUBITRA      EVAM                            S01158
411200200529     C**********           ELSE                                           S01158
411300200529     C                     Z-ADDITRA      EVAM
411400200529     C**********           END                                            S01158
411500200529     C*
411600200529     C**REVERSE*SIGN*IF*TRADE*IS*EX-COUPON************************ E16830 E21433
411700200529     C***********                                                  E16830 E21433
411800200529     C***********ACIN      IFEQ 'X'                                E16830 E21433
411900200529     C***********          Z-SUBEVAM      EVAM                     E16830 E21433
412000200529     C***********          END                                     E16830 E21433
412100200529     C*                                                                   E16830
412200200529     C           EVAM      IFNE 0
412300200529     C                     EXSR W01
412400200529     C                     END
412500200529     C*
412600200529     C                     END
412700200529     C*
412800200529     C* INTEREST DISCREPANCY KEYS
412900200529     C*
413000200529     C           TINA      IFNE *ZERO
413100200529     C           *IN29     ANDEQ'1'
413200200529     C           *IN33     ANDNE'1'
413300200529     C           TINA      ORNE *ZERO
413400200529     C           *IN30     ANDEQ'1'
413500200529     C           *IN34     ANDNE'1'
413600200529     C*
413700200529     C           TDTP      IFEQ 'TP'
413800200529     C           TINA      ANDGT*ZERO
413900200529     C           TDTP      OREQ 'TS'
414000200529     C           TINA      ANDLT*ZERO
414100200529     C                     MOVE 'DN'      AMTC
414200200529     C                     ELSE
414300200529     C                     MOVE 'DF'      AMTC
414400200529     C                     END
414500200529     C*
414600200529     C                     MOVE TNMC      EVCY
414700200529     C           TINA      IFLT *ZERO
414800200529     C                     Z-SUBTINA      EVAM
414900200529     C                     ELSE
415000200529     C                     Z-ADDTINA      EVAM
415100200529     C                     END
415200200529     C*
415300200529     C           EVAM      IFNE 0
415400200529     C                     EXSR W01
415500200529     C                     END
415600200529     C*
415700200529     C                     END
415800200529     C*                                                                   S01176
415900200529     C* CONTINGENT LIABILITY KEY                                          S01176
416000200529     C*                                                                   S01176
416100200529     C* DETERMINE IF KEYS ARE BEING SUPPRESSED                            S01176
416200200529     C*                                                                   S01176
416300200529     C           *IN29     IFEQ '1'                                       S01176
416400200529     C           *IN33     ANDNE'1'                                       S01176
416500200529     C           *IN30     OREQ '1'                                       S01176
416600200529     C           *IN34     ANDNE'1'                                       S01176
416700200529     C*                                                                   S01176
416800200529     C*  Produce Contingent Liability Key                                 S01176
416900200529     C*  if required                                                      E19832
417000200529     C*                                                                   E19832
417100200529     C           CNLI      IFEQ 'Y'                                       E19832
417200200529     C*                                                                   E19832
417300200529     C                     EXSR W04                                       S01176
417400200529     C*                                                                   S01176
417500200529     C                     END                                            E19832
417600200529     C                     END                                            S01176
417700200529     C*
417800200529     C           ENDKEY    ENDSR
417900200529      *
418000200529      *****************************************************************
418100200529      /EJECT
418200200529      *****************************************************************
418300200529      *                                                               *
418400200529      * UDEPOT - OUTPUT USER DEPOT MOVEMENTS FOR AMENDED DEPOT        *
418500200529      *                                                               *
418600200529      *****************************************************************
418700200529      *
418800200529     C           UDEPOT    BEGSR                           ** UDEPOT **
418900200529     C*
419000200529     C* MOVE INFORMATION INTO RECORD FOR USER DEPOT MOVEMENT
419100200529     C*
419200200529     C                     MOVE 'D'       RECI
419300200529     C**********           MOVE TDBR      DPBC                            E15996
419400200529     C                     MOVE TDSS      DPSS
419500200529     C**********           MOVE TDBK      DPBK                            E15996
419600200529     C**********           MOVE TDMI      DMRT                            E15996
419700200529     C**********           MOVE RUND      DADA                            E15996
419800200529     C                     MOVE *BLANKS   DMRF
419900200529     C**********           MOVE 'T'       DDBA                            E15996
420000200529     C***********          MOVE NOML      DMNA                            E22485
420100200529     C**********           MOVE 'Y'       DRIN                            E15996
420200200529     C                     MOVE ' '       DRIN                            E15996
420300200529     C                     MOVELTDRF      DPNR
420400200529     C*
420500200529     C* OUTPUT MOVEMENT CODE DEPENDING ON TRADE TYPE
420600200529     C*
420700200529     C* If Trade Purchase -
420800200529     C*
420900200529     C           TDTP      IFEQ 'TP'
421000200529     C********** SDELT     ANDNE*ZEROS                                                        CSD027
421100200529     C           SDELT     ANDNE*BLANKS                                                       CSD027
421200200529     C***********          MOVE STDBR     DPBC                     E15996 S01117
421300200529     C                     MOVE STDBR     DPBA                            S01117
421400200529     C                     MOVE STDBK     DPBK                            E15996
421500200529     C                     MOVE STDMI     DMRT                            E15996
421600200529     C                     MOVE STDDT     DADA                            E15996
421700200529     C                     MOVE 'T'       DDBA                            E15996
421800200529     C                     MOVE 'UO'      DPMV
421900200529     C                     MOVE SDELT     DDEP
422000200529     C                     MOVE SNOML     DMNA                            E22485
422100200529     C                     WRITEUDPMVDF
422200200529     C/COPY WNCPYSRC,SE2290C051
422300200529     C***********          MOVE TTDBR     DPBC                     E15996 S01117
422400200529     C                     MOVE TTDBR     DPBA                            S01117
422500200529     C                     MOVE TTDBK     DPBK                            E15996
422600200529     C                     MOVE TTDMI     DMRT                            E15996
422700200529     C                     MOVE TTDDT     DADA                            E15996
422800200529     C                     MOVE 'UI'      DPMV
422900200529     C                     MOVE TDELT     DDEP
423000200529     C                     MOVE TNOML     DMNA                            E22485
423100200529     C**********           MOVE ' '       DRIN                            E15996
423200200529     C                     WRITEUDPMVDF
423300200529     C/COPY WNCPYSRC,SE2290C052
423400200529     C                     ADD  2         UDCNT   50
423500200529     C*                                                                   E15996
423600200529     C* Value date actions                                                E15996
423700200529     C*                                                                   E15996
423800200529     C           STDVD     IFLT ECD                                       E15996
423900200529     C***********          MOVE STDBR     DPBC                     E15996 S01117
424000200529     C                     MOVE STDBR     DPBA                            S01117
424100200529     C                     MOVE STDBK     DPBK                            E15996
424200200529     C                     MOVE STDMI     DMRT                            E15996
424300200529     C                     MOVE STDVD     DADA                            E15996
424400200529     C                     MOVE 'V'       DDBA                            E15996
424500200529     C                     MOVE 'UO'      DPMV                            E15996
424600200529     C                     MOVE SDELT     DDEP                            E15996
424700200529     C                     MOVE SNOML     DMNA                            E22485
424800200529     C                     WRITEUDPMVDF                                   E15996
424900200529     C/COPY WNCPYSRC,SE2290C053
425000200529     C                     ADD  1         UDCNT   50                      E15996
425100200529     C                     END                                            E15996
425200200529     C*                                                                   E15996
425300200529     C           TTDVD     IFLT ECD                                       E15996
425400200529     C***********          MOVE TTDBR     DPBC                     E15996 S01117
425500200529     C                     MOVE TTDBR     DPBA                            S01117
425600200529     C                     MOVE TTDBK     DPBK                            E15996
425700200529     C                     MOVE TTDMI     DMRT                            E15996
425800200529     C                     MOVE TTDVD     DADA                            E15996
425900200529     C                     MOVE 'V'       DDBA                            E15996
426000200529     C                     MOVE 'UO'      DPMV                            E15996
426100200529     C                     MOVE TDELT     DDEP                            E15996
426200200529     C                     MOVE TNOML     DMNA                            E22485
426300200529     C                     WRITEUDPMVDF                                   E15996
426400200529     C/COPY WNCPYSRC,SE2290C054
426500200529     C                     ADD  1         UDCNT   50                      E15996
426600200529     C                     END                                            E15996
426700200529     C*                                                                   E15996
426800200529     C                     END
426900200529     C*
427000200529     C* If Trade Sale -
427100200529     C*
427200200529     C           TDTP      IFEQ 'TS'
427300200529     C********** SDELF     ANDNE*ZEROS                                                        CSD027
427400200529     C           SDELF     ANDNE*BLANKS                                                       CSD027
427500200529     C***********          MOVE STDBR     DPBC                     E15996 S01117
427600200529     C                     MOVE STDBR     DPBA                            S01117
427700200529     C                     MOVE STDBK     DPBK                            E15996
427800200529     C                     MOVE STDMI     DMRT                            E15996
427900200529     C                     MOVE STDDT     DADA                            E15996
428000200529     C                     MOVE 'T'       DDBA                            E15996
428100200529     C                     MOVE 'UI'      DPMV
428200200529     C                     MOVE SDELF     DDEP
428300200529     C                     MOVE SNOML     DMNA                            E22485
428400200529     C                     WRITEUDPMVDF
428500200529     C/COPY WNCPYSRC,SE2290C055
428600200529     C************         MOVE TTDBR     DPBC                     E15996 S01117
428700200529     C                     MOVE TTDBR     DPBA                            S01117
428800200529     C                     MOVE TTDBK     DPBK                            E15996
428900200529     C                     MOVE TTDMI     DMRT                            E15996
429000200529     C                     MOVE TTDDT     DADA                            E15996
429100200529     C                     MOVE 'UO'      DPMV
429200200529     C                     MOVE TDELF     DDEP
429300200529     C                     MOVE TNOML     DMNA                            E22485
429400200529     C**********           MOVE ' '       DRIN                            E15996
429500200529     C                     WRITEUDPMVDF
429600200529     C/COPY WNCPYSRC,SE2290C056
429700200529     C                     ADD  2         UDCNT
429800200529     C*                                                                   E15996
429900200529     C* Value date actions                                                E15996
430000200529     C*                                                                   E15996
430100200529     C           STDVD     IFLT ECD                                       E15996
430200200529     C***********          MOVE STDBR     DPBC                     E15996 S01117
430300200529     C                     MOVE STDBR     DPBA                            S01117
430400200529     C                     MOVE STDBK     DPBK                            E15996
430500200529     C                     MOVE STDMI     DMRT                            E15996
430600200529     C                     MOVE STDVD     DADA                            E15996
430700200529     C                     MOVE 'V'       DDBA                            E15996
430800200529     C                     MOVE 'UO'      DPMV                            E15996
430900200529     C                     MOVE SDELF     DDEP                            E15996
431000200529     C                     MOVE SNOML     DMNA                            E22485
431100200529     C                     WRITEUDPMVDF                                   E15996
431200200529     C/COPY WNCPYSRC,SE2290C057
431300200529     C                     ADD  1         UDCNT   50                      E15996
431400200529     C                     END                                            E15996
431500200529     C*                                                                   E15996
431600200529     C           TTDVD     IFLT ECD                                       E15996
431700200529     C***********          MOVE TTDBR     DPBC                     E15996 S01117
431800200529     C                     MOVE TTDBR     DPBA                            S01117
431900200529     C                     MOVE TTDBK     DPBK                            E15996
432000200529     C                     MOVE TTDMI     DMRT                            E15996
432100200529     C                     MOVE TTDVD     DADA                            E15996
432200200529     C                     MOVE 'V'       DDBA                            E15996
432300200529     C                     MOVE 'UO'      DPMV                            E15996
432400200529     C                     MOVE TDELF     DDEP                            E15996
432500200529     C                     MOVE TNOML     DMNA                            E22485
432600200529     C                     WRITEUDPMVDF                                   E15996
432700200529     C/COPY WNCPYSRC,SE2290C058
432800200529     C                     ADD  1         UDCNT   50                      E15996
432900200529     C                     END                                            E15996
433000200529     C*                                                                   E15996
433100200529     C                     END
433200200529     C*
433300200529     C                     ENDSR
433400200529      *
433500200529      *****************************************************************
433600200529      /EJECT
433700200529      *****************************************************************
433800200529      *                                                               *
433900200529      * CDEPOT - OUTPUT CUSTOMER DEPOT MOVEMENTS FOR AMENDED DEPOT    *
434000200529      *                                                               *
434100200529      *****************************************************************
434200200529      *
434300200529     C           CDEPOT    BEGSR                           ** CDEPOT **
434400200529     C*
434500200529     C* MOVE INFORMATION INTO RECORD FOR CUSTOMER MOVEMENT
434600200529     C*
434700200529     C                     MOVE 'D'       RECI
434800200529     C**********           MOVE TDBR      CPBC                            E15996
434900200529     C                     MOVE TDSS      CPSS
435000200529     C                     MOVE TCNR      CCRT
435100200529     C**********           MOVE TDMI      CMRT                            E15996
435200200529     C**********           MOVE RUND      CADA                            E15996
435300200529     C                     MOVE *BLANKS   CDMR
435400200529     C                     MOVE *ZEROS    CPRC
435500200529     C**********           MOVE 'T'       CDBA                            E15996
435600200529     C***********          MOVE NOML      CMNA                            E22485
435700200529     C**********           MOVE 'Y'       CRIN                            E15996
435800200529     C                     MOVE ' '       CRIN                            E15996
435900200529     C                     MOVELTDRF      DPNR
436000200529     C*
436100200529     C* MOVEMENT TYPE OUTPUT DEPENDS ON TRADE TYPE
436200200529     C*
436300200529     C* If Trade Purchase -
436400200529     C*
436500200529     C           TDTP      IFEQ 'TP'
436600200529     C********** SDELF     ANDNE*ZEROS                                                        CSD027
436700200529     C           SDELF     ANDNE*BLANKS                                                       CSD027
436800200529     C***********          MOVE STDBR     CPBC                     E15996 S01117
436900200529     C                     MOVE STDBR     CPBA                            S01117
437000200529     C                     MOVE STDMI     CMRT                            E15996
437100200529     C                     MOVE STDDT     CADA                            E15996
437200200529     C                     MOVE 'T'       CDBA                            E15996
437300200529     C***********          MOVE 'CI'      CPMV                            E19332
437400200529     C                     MOVE 'CO'      CPMV                            E19332
437500200529     C                     MOVE 'Y'       CRIN                            E19332
437600200529     C                     MOVE SDELF     CDEP
437700200529     C                     MOVE SPRIC     CPRC                            E19332
437800200529     C                     MOVE SNOML     CMNA                            E22485
437900200529      *                                                                   CSE017
438000200529     C           CSE017    IFEQ 'Y'                                       CSE017
438100200529     C                     MOVE *BLANK    CPIN                            CSE017
438200200529     C                     ENDIF                                          CSE017
438300200529      *                                                                   CSE017
438400200529     C                     WRITECDPMVDF
438500200529     C/COPY WNCPYSRC,SE2290C059
438600200529     C***********          MOVE TTDBR     CPBC                     E15996 S01117
438700200529     C                     MOVE TTDBR     CPBA                            S01117
438800200529     C                     MOVE TTDMI     CMRT                            E15996
438900200529     C                     MOVE TTDDT     CADA                            E15996
439000200529     C***********          MOVE 'CO'      CPMV
439100200529     C                     MOVE 'CI'      CPMV                            E19332
439200200529     C                     MOVE 'Y'       CRIN                            E19332
439300200529     C                     MOVE TDELF     CDEP
439400200529     C                     MOVE TPRIC     CPRC                            E19332
439500200529     C                     MOVE TNOML     CMNA                            E22485
439600200529     C**********           MOVE ' '       CRIN                            E15996
439700200529      *                                                                   CSE017
439800200529     C           CSE017    IFEQ 'Y'                                       CSE017
439900200529     C                     MOVE *BLANK    CPIN                            CSE017
440000200529     C                     ENDIF                                          CSE017
440100200529      *                                                                   CSE017
440200200529     C                     WRITECDPMVDF
440300200529     C/COPY WNCPYSRC,SE2290C060
440400200529     C                     ADD  2         CDCNT   50
440500200529     C*                                                                   E15996
440600200529     C* Value date action                                                 E15996
440700200529     C*                                                                   E15996
440800200529     C           STDVD     IFLT ECD                                       E15996
440900200529     C***********          MOVE STDBR     CPBC                     E15996 S01117
441000200529     C                     MOVE STDBR     CPBA                            S01117
441100200529     C                     MOVE STDMI     CMRT                            E15996
441200200529     C                     MOVE STDVD     CADA                            E15996
441300200529     C                     MOVE 'V'       CDBA                            E15996
441400200529     C***********          MOVE 'CI'      CPMV                     E15996 E19332
441500200529     C                     MOVE 'CO'      CPMV                            E19332
441600200529     C                     MOVE 'Y'       CRIN                            E19332
441700200529     C                     MOVE SDELF     CDEP                            E15996
441800200529     C                     MOVE SPRIC     CPRC                            E19332
441900200529     C                     MOVE SNOML     CMNA                            E22485
442000200529      *                                                                   CSE017
442100200529     C           CSE017    IFEQ 'Y'                                       CSE017
442200200529     C                     MOVE *BLANK    CPIN                            CSE017
442300200529     C                     ENDIF                                          CSE017
442400200529      *                                                                   CSE017
442500200529     C                     WRITECDPMVDF                                   E15996
442600200529     C/COPY WNCPYSRC,SE2290C061
442700200529     C                     ADD  1         CDCNT   50                      E15996
442800200529     C                     END                                            E15996
442900200529     C*                                                                   E15996
443000200529     C           TTDVD     IFLT ECD                                       E15996
443100200529     C***********          MOVE TTDBR     CPBC                     E15996 S01117
443200200529     C                     MOVE TTDBR     CPBA                            S01117
443300200529     C                     MOVE TTDMI     CMRT                            E15996
443400200529     C                     MOVE TTDVD     CADA                            E15996
443500200529     C                     MOVE 'V'       CDBA                            E15996
443600200529     C***********          MOVE 'CO'      CPMV                     E15996 E19332
443700200529     C                     MOVE 'CI'      CPMV                            E19332
443800200529     C                     MOVE 'Y'       CRIN                            E19332
443900200529     C                     MOVE TDELF     CDEP                            E15996
444000200529     C                     MOVE TPRIC     CPRC                            E19332
444100200529     C                     MOVE TNOML     CMNA                            E22485
444200200529      *                                                                   CSE017
444300200529     C           CSE017    IFEQ 'Y'                                       CSE017
444400200529     C                     MOVE *BLANK    CPIN                            CSE017
444500200529     C                     ENDIF                                          CSE017
444600200529      *                                                                   CSE017
444700200529     C                     WRITECDPMVDF                                   E15996
444800200529     C/COPY WNCPYSRC,SE2290C062
444900200529     C                     ADD  1         CDCNT   50                      E15996
445000200529     C                     END                                            E15996
445100200529     C*                                                                   E15996
445200200529     C                     END
445300200529     C*
445400200529     C* If Trade Sale -
445500200529     C*
445600200529     C           TDTP      IFEQ 'TS'
445700200529     C********** SDELT     ANDNE*ZEROS                                                        CSD027
445800200529     C           SDELT     ANDNE*BLANKS                                                       CSD027
445900200529     C***********          MOVE STDBR     CPBC                     E15996 S01117
446000200529     C                     MOVE STDBR     CPBA                            S01117
446100200529     C                     MOVE STDMI     CMRT                            E15996
446200200529     C                     MOVE STDDT     CADA                            E15996
446300200529     C                     MOVE 'T'       CDBA                            E15996
446400200529     C***********          MOVE 'CO'      CPMV                            E19332
446500200529     C                     MOVE 'CI'      CPMV                            E19332
446600200529     C                     MOVE 'Y'       CRIN                            E19332
446700200529     C                     MOVE SDELT     CDEP
446800200529     C                     MOVE SPRIC     CPRC                            E19332
446900200529     C                     MOVE SNOML     CMNA                            E22485
447000200529      *                                                                   CSE017
447100200529     C           CSE017    IFEQ 'Y'                                       CSE017
447200200529     C                     MOVE *BLANK    CPIN                            CSE017
447300200529     C                     ENDIF                                          CSE017
447400200529      *                                                                   CSE017
447500200529     C                     WRITECDPMVDF
447600200529     C/COPY WNCPYSRC,SE2290C063
447700200529     C***********          MOVE TTDBR     CPBC                     E15996 S01117
447800200529     C                     MOVE TTDBR     CPBA                            S01117
447900200529     C                     MOVE TTDMI     CMRT                            E15996
448000200529     C                     MOVE TTDDT     CADA                            E15996
448100200529     C***********          MOVE 'CI'      CPMV                            E19332
448200200529     C                     MOVE 'CO'      CPMV                            E19332
448300200529     C                     MOVE 'Y'       CRIN                            E19332
448400200529     C                     MOVE TDELT     CDEP
448500200529     C                     MOVE TPRIC     CPRC                            E19332
448600200529     C                     MOVE TNOML     CMNA                            E22485
448700200529     C**********           MOVE ' '       CRIN                            E15996
448800200529      *                                                                   CSE017
448900200529     C           CSE017    IFEQ 'Y'                                       CSE017
449000200529     C                     MOVE *BLANK    CPIN                            CSE017
449100200529     C                     ENDIF                                          CSE017
449200200529      *                                                                   CSE017
449300200529     C                     WRITECDPMVDF
449400200529     C/COPY WNCPYSRC,SE2290C064
449500200529     C                     ADD  2         CDCNT
449600200529     C*                                                                   E15996
449700200529     C* Value date action                                                 E15996
449800200529     C*                                                                   E15996
449900200529     C           STDVD     IFLT ECD                                       E15996
450000200529     C***********          MOVE STDBR     CPBC                     E15996 S01117
450100200529     C                     MOVE STDBR     CPBA                            S01117
450200200529     C                     MOVE STDMI     CMRT                            E15996
450300200529     C                     MOVE STDVD     CADA                            E15996
450400200529     C                     MOVE 'V'       CDBA                            E15996
450500200529     C***********          MOVE 'CI'      CPMV                            E15996
450600200529     C                     MOVE 'CO'      CPMV                            E19332
450700200529     C                     MOVE 'Y'       CRIN                            E19332
450800200529     C                     MOVE SDELT     CDEP                            E15996
450900200529     C                     MOVE SPRIC     CPRC                            E19332
451000200529     C                     MOVE SNOML     CMNA                            E22485
451100200529      *                                                                   CSE017
451200200529     C           CSE017    IFEQ 'Y'                                       CSE017
451300200529     C                     MOVE *BLANK    CPIN                            CSE017
451400200529     C                     ENDIF                                          CSE017
451500200529      *                                                                   CSE017
451600200529     C                     WRITECDPMVDF                                   E15996
451700200529     C/COPY WNCPYSRC,SE2290C065
451800200529     C                     ADD  1         CDCNT   50                      E15996
451900200529     C                     END                                            E15996
452000200529     C*                                                                   E15996
452100200529     C           TTDVD     IFLT ECD                                       E15996
452200200529     C***********          MOVE TTDBR     CPBC                     E15996 S01117
452300200529     C                     MOVE TTDBR     CPBA                            S01117
452400200529     C                     MOVE TTDMI     CMRT                            E15996
452500200529     C                     MOVE TTDVD     CADA                            E15996
452600200529     C                     MOVE 'V'       CDBA                            E15996
452700200529     C***********          MOVE 'CO'      CPMV                     E15996 E19332
452800200529     C                     MOVE 'CI'      CPMV                            E19332
452900200529     C                     MOVE 'Y'       CRIN                            E19332
453000200529     C                     MOVE TDELT     CDEP                            E15996
453100200529     C                     MOVE TPRIC     CPRC                            E19332
453200200529     C                     MOVE TNOML     CMNA                            E22485
453300200529      *                                                                   CSE017
453400200529     C           CSE017    IFEQ 'Y'                                       CSE017
453500200529     C                     MOVE *BLANK    CPIN                            CSE017
453600200529     C                     ENDIF                                          CSE017
453700200529      *                                                                   CSE017
453800200529     C                     WRITECDPMVDF                                   E15996
453900200529     C/COPY WNCPYSRC,SE2290C066
454000200529     C                     ADD  1         CDCNT   50                      E15996
454100200529     C                     END                                            E15996
454200200529     C*                                                                   E15996
454300200529     C                     END
454400200529     C*
454500200529     C                     ENDSR
454600200529      *
454700200529      *****************************************************************
454800200529      /EJECT
454900200529      *****************************************************************
455000200529      *                                                               *
455100200529      *  W01 - WRITE OUT THE GENERATED ACCOUNT KEYS                   *
455200200529      *                                                               *
455300200529      *****************************************************************
455400200529      *
455500200529     C           W01       BEGSR                           ** W01 **
455600200529     C*
455700200529     C* ADD EVENT AMOUNT INTO HASH TOTALS
455800200529     C*
455900200529     C                     Z-ADD1         Z
456000200529     C                     Z-ADD1         S
456100200529     C                     Z-ADDEVAM      ZZAMT
456200200529     C                     EXSR ZHASH
456300200529     C*
456400200529     C* MOVE INFORMATION IN TO RECORD DEPENDING ON TRADE OR VALUE
456500200529     C*      DATE PROCESSING AND TRADE TYPES ETC.
456600200529     C*
456700200529     C                     MOVE 'D'       RECI
456800200529     C*                                                                   S01486
456900200529     C           *IN29     IFEQ '1'
457000200529     C                     MOVE 'T'       EVCD
457100200529     C*                                                                   S01486
457200200529     C****If*Portfolio*Management*is*present***************************                S01486 258975
457300200529     C*                                                                   S01486
457400200529     C********** BGPFMG    IFEQ 'Y'                                                    S01486 258975
457500200529     C********** BGN4ST    OREQ 'Y'                                                    CPB001 258975
457600200529     C*****************************************************************                S01486 258975
457700200529     C****For*safe*custody*or*discretionary*customers,*output*the*trade                S01486 258975
457800200529     C****value*date*to*LF/SEKEY*as*the*event*date,*if*amount*code*on**                S01486 258975
457900200529     C****account*key*is*either*'CN'*or*'CV'.**************************                S01486 258975
458000200529     C*****************************************************************                S01486 258975
458100200529     C********** C1DI      IFEQ 'D'                                                    S01486 258975
458200200529     C********** C1DI      OREQ 'S'                                                    S01486 258975
458300200529     C********** AMTC      IFEQ 'CV'                                                   S01486 258975
458400200529     C********** AMTC      OREQ 'CN'                                                   S01486 258975
458500200529     C********** AMTC      OREQ 'MV'                                                   CAC002 258975
458600200529     C**********           Z-ADDTDVD      EVDT                                         S01486 258975
458700200529     C**********           ELSE                                                        S01486 258975
458800200529     C**********           Z-ADDTDDT      EVDT                                         S01486 258975
458900200529     C**********           END                                                         S01486 258975
459000200529     C**********           ELSE                                                        S01486 258975
459100200529     C**********           MOVE TDDT      EVDT                                         S01486 258975
459200200529     C**********           END                                                         S01486 258975
459300200529     C*COPY*WNCPYSRC,SE2290C033****************************************   S01408
459400200529     C*                                                                   S01486
459500200529     C****Portfolio*Management*is*not*present**************************                S01486 258975
459600200529     C**********           ELSE                                                        S01486 258975
459700200529     C                     MOVE TDDT      EVDT
459800200529     C**********           END                                                         S01486 258975
459900200529     C/COPY WNCPYSRC,SE2290C033                                           S01408
460000200529     C*                                                                   S01486
460100200529     C                     END
460200200529     C*                                                                   S01486
460300200529     C           *IN30     IFEQ '1'
460400200529     C                     MOVE 'V'       EVCD
460500200529     C                     MOVE TDVD      EVDT
460600200529     C                     END
460700200529     C*                                                                   S01486
460800200529     C*
460900200529     C                     MOVE *BLANK    SEBR                            S01117
461000200529     C           TDTP      IFEQ 'TP'
461100200529     C                     MOVE 'P'       TRDT
461200200529     C                     MOVE PYFM      STLA
461300200529     C                     MOVE DELT      KCUST
461400200529     C                     MOVE PYFA      SEBR                            S01117
461500200529     C                     END
461600200529     C           TDTP      IFEQ 'TS'
461700200529     C                     MOVE 'S'       TRDT
461800200529     C                     MOVE PAYT      STLA
461900200529     C                     MOVE DELF      KCUST
462000200529     C                     MOVE PYTA      SEBR                            S01117
462100200529     C                     END
462200200529     C*
462300200529     C                     MOVE SITP      INTP
462400200529     C           AMTC      IFEQ 'CV'
462500200529     C           AMTC      OREQ 'CN'
462600200529     C           AMTC      OREQ 'DF'
462700200529     C           AMTC      OREQ 'DN'
462800200529     C           AMTC      OREQ 'MV'                                      CAC002
462900200529     C/COPY WNCPYSRC,SE2290C034
463000200529     C*
463100200529     C           C1DI      IFEQ 'M'
463200200529     C                     MOVE ' '       PFIN
463300200529     C                     ELSE
463400200529     C                     MOVE C1DI      PFIN
463500200529     C                     END
463600200529     C*
463700200529     C                     ELSE
463800200529     C                     MOVE ' '       PFIN
463900200529     C                     END
464000200529     C*
464100200529     C                     MOVE TDBK      BKCD
464200200529     C***********TSAK      IFEQ 'Y'                                       S01117
464300200529     C           BVTSAK    IFEQ 'Y'                                       S01117
464400200529     C                     MOVE TSUB      TRSB
464500200529     C                     ELSE
464600200529     C                     MOVE ' '       TRSB
464700200529     C                     END
464800200529     C*                                                                   CGL031
464900200529     C           AMTC      IFEQ 'ET'                                      CGL031
465000200529     C           AMTC      OREQ 'NI'                                      CGL031
465100200529     C                     MOVE 'E'       EVCD                            CGL031
465200200529     C                     MOVE *BLANK    TRDT                            CGL031
465300200529     C                     MOVE C1DI      PFIN                            CGL031
465400200529     C                     MOVE *BLANK    BKCD                            CGL031
465500200529     C                     END                                            CGL031
465600200529     C*
465700200529     C                     MOVE TDMI      MKT
465800200529     C*
465900200529     C***********CIAK      IFEQ 'Y'                                       S01117
466000200529     C           BVCIAK    IFEQ 'Y'                                       S01117
466100200529     C           SCVI      ANDEQ'Y'                                       E15430
466200200529     C                     MOVE SCVI      CNVI
466300200529     C                     ELSE
466400200529     C                     MOVE ' '       CNVI
466500200529     C                     END
466600200529     C*
466700200529     C                     MOVE TDRF      TRFR
466800200529     C                     MOVE TCNR      CSTN
466900200529     C***********          MOVE TDBR      BRCH                            S01117
467000200529     C                     MOVE TDBA      BRHA                            S01117
467100200529     C                     MOVE ASNM      ASQN
467200200529     C                     MOVE SMTH      STLT
467300200529     C**N39******          MOVE SNMCY     KCCY                            S01176
467400200529     C                     MOVE SNMCY     KCCY                            S01176
467500200529     C                     MOVE TDSS      SESH
467600200529     C                     ADD  1         KEYCNT  50
467700200529     C*                                                                   S01486
467800200529     C**  Check the amount code for countervalue                          S01486
467900200529     C*                                                                   S01486
468000200529     C**  Save portfolio reference                                        S01486
468100200529     C           BGPFMG    IFEQ 'Y'                                       S01486
468200200529     C           AMTC      ANDEQ'CV'                                      S01486
468300200529     C           BGN4ST    OREQ 'Y'                                       CPB001
468400200529     C           AMTC      ANDEQ'CV'                                      CPB001
468500200529     C*                                                                   S01486
468600200529     C**  Move the portfolio reference from the trade into file           S01486
468700200529     C*                                                                   S01486
468800200529     C                     MOVE XPTFR     PTFR                            S01486
468900200529     C                     ELSE                                           S01486
469000200529     C*                                                                   S01486
469100200529     C**  Set the portfolio reference equal to blank                      S01486
469200200529     C*                                                                   S01486
469300200529     C                     MOVE *BLANKS   PTFR                            S01486
469400200529     C                     END                                            S01486
469500200529     C*                                                                   S01486
469600200529      *                                                                   S01117
469700200529      ** Set settlement branch to booking branch if settlement branch     S01117
469800200529      ** is blank                                                         S01117
469900200529      *                                                                   S01117
470000200529     C           SEBR      IFEQ *BLANKS                                   S01117
470100200529     C                     MOVE BRHA      SEBR                            S01117
470200200529     C                     END                                            S01117
470300200529      *                                                                   CAC002
470400200529      ** If Analytical Accounting is installed, define the profit         CAC002
470500200529      ** centre for each posting.                                         CAC002
470600200529      *                                                                   CAC002
470700200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
470800200529     C                     MOVE PRFC      WPRFC   4                       CAC002
470900200529     C           AMTC      IFEQ 'CR'                                      CAC002
471000200529     C           AMTC      OREQ 'FR'                                      CAC002
471100200529     C           AMTC      OREQ 'ZR'                                      CAC002
471200200529     C           AMTC      OREQ 'CP'                                      CAC002
471300200529     C           AMTC      OREQ 'FP'                                      CAC002
471400200529     C           AMTC      OREQ 'ZP'                                      CAC002
471500200529     C                     MOVE WWPRFC    PRFC                            CAC002
471600200529     C                     ELSE                                           CAC002
471700200529     C           AMTC      IFEQ 'CN'                                      CAC002
471800200529     C           AMTC      OREQ 'CV'                                      CAC002
471900200529     C           AMTC      OREQ 'MV'                                      CAC002
472000200529     C                     MOVE TPRC      PRFC                            CAC002
472100200529     C                     ELSE                                           CAC002
472200200529     C                     MOVE BPRC      PRFC                            CAC002
472300200529     C                     ENDIF                                          CAC002
472400200529     C                     ENDIF                                          CAC002
472500200529     C                     ENDIF                                          CAC002
472600200529     C*                                                                   S01117
472700200529      ** If Midas Compliance Watch (CGL020) is installed and Repayment,                       CGL020
472800200529      ** set Fee Flag = 'F', Fee Value = Charge Amount and Fee Percent = 100                  CGL020
472900200529      *                                                                                       CGL020
473000200529     C           CGL020    IFEQ 'Y'                                                           CGL020
473100200529     C           AMTC      IFEQ 'FR'                                                          CGL020
473200200529     C           AMTC      OREQ 'FP'                                                          CGL020
473300200529     C           AMTC      OREQ 'CR'                                                          CGL020
473400200529     C           AMTC      OREQ 'CP'                                                          CGL020
473500200529     C           AMTC      OREQ 'ZR'                                                          CGL020
473600200529     C           AMTC      OREQ 'ZP'                                                          CGL020
473700200529     C                     MOVE 'F'       F1FFLG                                              CGL020
473800200529     C                     Z-ADDEVAM      F1FVAL                                              CGL020
473900200529     C                     Z-ADD100       F1FPCT                                              CGL020
474000200529     C                     ELSE                                                               CGL020
474100200529     C                     MOVE *BLANK    F1FFLG                                              CGL020
474200200529     C                     Z-ADD0         F1FVAL                                              CGL020
474300200529     C                     Z-ADD0         F1FPCT                                              CGL020
474400200529     C                     ENDIF                                                              CGL020
474500200529      *                                                                                       CGL020
474600200529     C           TDRF      CHAINTRADSDY2             17                                       CGL020
474700200529     C           *IN17     IFEQ '0'                                                           CGL020
474800200529     C                     MOVELT2IPYN    PIPYN  10                                           CGL020
474900200529     C                     MOVELT2IPYL    PIPYL  35                                           CGL020
475000200529     C                     MOVELT2AWIN    PAWIN  10                                           CGL020
475100200529     C                     MOVELT2AWIL    PAWIL  35                                           CGL020
475200200529     C                     MOVELT2BOFN    PBOFN  10                                           CGL020
475300200529     C                     MOVELT2BOF1    PBOF1  35                                           CGL020
475400200529     C                     MOVELT2DIDN    PDEBT  10                                           CSW210
475500200529     C                     MOVELT2DLIN    PDEBTA 35                                           CSW210
475600200529     C                     ELSE                                                               CGL020
475700200529     C                     MOVEL*BLANKS   PIPYN                                               CGL020
475800200529     C                     MOVEL*BLANKS   PIPYL                                               CGL020
475900200529     C                     MOVEL*BLANKS   PAWIN                                               CGL020
476000200529     C                     MOVEL*BLANKS   PAWIL                                               CGL020
476100200529     C                     MOVEL*BLANKS   PBOFN                                               CGL020
476200200529     C                     MOVEL*BLANKS   PBOF1                                               CGL020
476300200529     C                     MOVE *BLANKS   PDEBT                                               CSW210
476400200529     C                     MOVE *BLANKS   PDEBTA                                              CSW210
476500200529     C                     ENDIF                                                              CGL020
476600200529      *                                                                                       CGL020
476700200529     C**********           Z-ADDTCNR      PTCNR                                        CGL020 CSD027
476800200529     C                     MOVE TCNR      PTCNR                                               CSD027
476900200529      *                                                                                       CGL020
477000200529      ** Setup AML Fields                                                                     CGL020
477100200529      *                                                                                       CGL020
477200200529     C                     CALL SETAML                                                        CGL020
477300200529     C                     PARM           PIPYN                                               CGL020
477400200529     C                     PARM           PIPYL                                               CGL020
477500200529     C                     PARM           PAWIN                                               CGL020
477600200529     C                     PARM           PAWIL                                               CGL020
477700200529     C                     PARM           PBOFN                                               CGL020
477800200529     C                     PARM           PBOF1                                               CGL020
477900200529     C                     PARM           PDEBT                                               CSW210
478000200529     C                     PARM           PDEBTA                                              CSW210
478100200529     C                     PARM           PTCNR                                               CGL020
478200200529     C                     PARM           TDFA                                                CGL020
478300200529     C                     PARM           STLA                                                CGL020
478400200529     C                     PARM           SEBR                                                CGL020
478500200529     C                     PARM           EVCY                                                CGL020
478600200529     C                     PARM           F1RACT                                              CGL020
478700200529     C                     PARM           F1RCTY                                              CGL020
478800200529     C                     PARM           F1RBNK                                              CGL020
478900200529     C                     PARM           F1RCDE                                              CGL020
479000200529     C                     PARM           F1PACT                                              CGL020
479100200529     C                     PARM           F1PCTY                                              CGL020
479200200529     C                     PARM           F1PBNK                                              CGL020
479300200529     C                     PARM           F1PCDE                                              CGL020
479400200529     C                     PARM           F1DACT                                              CGL020
479500200529     C                     PARM           F1DCTY                                              CGL020
479600200529     C                     PARM           F1DBNK                                              CGL020
479700200529      *                                                                                       CGL020
479800200529     C                     Z-ADDTDVD      F1SDAT                                              CGL020
479900200529     C                     MOVELTDSS      F1TICK                                              CGL020
480000200529     C                     MOVELTMKC      F1EXCH                                              CGL020
480100200529     C                     Z-ADDNOML      F1NOML                                              CGL020
480200200529      *                                                                                       CGL020
480300200529     C                     ENDIF                                                              CGL020
480400200529      *                                                                                       CGL020
480500200529     C/COPY WNCPYSRC,SE2290C049
480600200529     C                     WRITESEKEYDF
480700200529     C/COPY WNCPYSRC,SE2290C074
480800200529      *                                                                                       CGL020
480900200529      ** If Midas Compliance Watch (CGL020) is installed,                                     CGL020
481000200529      ** reset Fee Flag, Fee Value and Fee Percent.                                           CGL020
481100200529      *                                                                                       CGL020
481200200529     C           CGL020    IFEQ 'Y'                                                           CGL020
481300200529     C                     MOVE *BLANK    F1FFLG                                              CGL020
481400200529     C                     Z-ADD0         F1FVAL                                              CGL020
481500200529     C                     Z-ADD0         F1FPCT                                              CGL020
481600200529     C                     ENDIF                                                              CGL020
481700200529      *                                                                   CAC002
481800200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
481900200529     C                     MOVE WPRFC     PRFC                            CAC002
482000200529     C                     ENDIF                                          CAC002
482100200529      *                                                                   CAC002
482200200529     C*  REPLACE PORTFOLIO REFERENCE                                      S01486
482300200529     C******************** MOVE XXPTFR    PTFR                            S01486
482400200529     C/COPY WNCPYSRC,SE2290C042
482500200529     C*
482600200529     C* RESET FIELDS THAT GET CHANGED IN ACC AND ACCREV
482700200529     C*
482800200529     C                     MOVE '  '      CCCD
482900200529     C                     MOVE '  '      AMTC
483000200529     C                     Z-ADD0         EVAM
483100200529     C                     MOVE '   '     EVCY
483200200529     C**********           MOVE '0'       RVRS                            E14720
483300200529     C                     Z-ADD0         KNCA
483400200529     C                     Z-ADD0         KBCA
483500200529     C*
483600200529     C                     ENDSR
483700200529      *
483800200529      *****************************************************************
483900200529      /EJECT                                                              S01176
484000200529      *****************************************************************   S01176
484100200529      *                                                               *   S01176
484200200529      * W04 - WRITE OUT CONTINGENT LIABILITY KEYS                     *   S01176
484300200529      *                                                               *   S01176
484400200529      *****************************************************************   S01176
484500200529      *                                                                   S01176
484600200529     C           W04       BEGSR                           ** W04 **      S01176
484700200529     C*                                                                   S01176
484800200529     C**    ONLY WRITE CONT LIAB KEYS IF TRADE IS A SALE                  S01176
484900200529     C**     AND COUNTERPARTY IS NOT EQUAL TO THE ISSUER                  S01176
485000200529     C**     AND PROCESSING TYPE NOT EQUAL TO 2,4 OR 7                    E18335
485100200529     C*                                                                   S01176
485200200529     C                     SETOF                     60                   E18335
485300200529     C           PROT      IFEQ '2'                                       E18335
485400200529     C           PROT      OREQ '4'                                       E18335
485500200529     C           PROT      OREQ '7'                                       E18335
485600200529     C           CNLI      ORNE 'Y'                                       E23874
485700200529     C                     SETON                     60                   E18335
485800200529     C                     END                                            E18335
485900200529     C*                                                                   E18335
486000200529     C           TDTP      IFEQ 'TS'                                      S01176
486100200529     C           TCNR      ANDNEISSR                                      S01176
486200200529     C           *IN60     ANDNE'1'                                       E18335
486300200529     C           C1DI      ANDEQ'M'                                       E19832
486400200529     C*                                                                   S01176
486500200529     C* MOVE INFORMATION IN TO RECORD DEPENDING ON TRADE OR VALUE         S01176
486600200529     C*      DATE PROCESSING AND TRADE TYPES ETC.                         S01176
486700200529     C*                                                                   S01176
486800200529     C                     MOVE 'D'       RECI                            S01176
486900200529     C           *IN29     IFEQ '1'                                       S01176
487000200529     C                     MOVE 'T'       EVCD                            S01176
487100200529     C                     MOVE TDDT      EVDT                            S01176
487200200529     C                     END                                            S01176
487300200529     C           *IN30     IFEQ '1'                                       S01176
487400200529     C                     MOVE 'V'       EVCD                            S01176
487500200529     C                     MOVE TDVD      EVDT                            S01176
487600200529     C                     END                                            S01176
487700200529     C*                                                                   S01176
487800200529     C                     MOVE SITP      INTP                            S01176
487900200529     C                     MOVE ' '       TRDT                            S01176
488000200529     C                     MOVE ' '       PFIN                            S01176
488100200529     C                     MOVE '  '      BKCD                            S01176
488200200529     C                     MOVE '  '      TRSB                            S01176
488300200529     C                     MOVE '  '      CCCD                            S01176
488400200529     C                     MOVE ' '       MKT                             S01176
488500200529     C                     MOVE 'FV'      AMTC                            S01176
488600200529     C*                                                                   S01176
488700200529     C***********CIAK      IFEQ 'Y'                                S01176 S01117
488800200529     C           BVCIAK    IFEQ 'Y'                                       S01117
488900200529     C           SCVI      ANDEQ'Y'                                       E19824
489000200529     C                     MOVE SCVI      CNVI                            S01176
489100200529     C                     ELSE                                           S01176
489200200529     C                     MOVE ' '       CNVI                            S01176
489300200529     C                     END                                            S01176
489400200529     C*                                                                   S01176
489500200529     C                     MOVE TDRF      TRFR                            S01176
489600200529     C                     MOVE TCNR      CSTN                            S01176
489700200529     C***********          MOVE TDBR      BRCH                     S01176 S01117
489800200529     C                     MOVE TDBA      BRHA                            S01117
489900200529     C*                                                                   E19975
490000200529     C** Set up depot                                                     E19975
490100200529     C*                                                                   E19975
490200200529     C           TDTP      IFEQ 'TP'                                      E19975
490300200529     C                     MOVE DELT      KCUST                           E19975
490400200529     C                     END                                            E19975
490500200529     C           TDTP      IFEQ 'TS'                                      E19975
490600200529     C                     MOVE DELF      KCUST                           E19975
490700200529     C                     END                                            E19975
490800200529     C*                                                                   E19975
490900200529     C***********          Z-ADD1         ASQN                     S01176 E18803
491000200529     C                     Z-ADD0         ASQN                            E18803
491100200529     C                     Z-ADDNOML      SET                             S01176
491200200529     C                     EXSR NOMDEC                                    S01176
491300200529     C                     Z-ADDSET       EVAM                            S01176
491400200529     C                     MOVE NMCY      EVCY                            S01176
491500200529     C                     MOVE TDSS      SESH                            S01176
491600200529     C*                                                                   S01176
491700200529     C* REMAINING FIELDS SET TO BLANK/ZERO                                S01176
491800200529     C*                                                                   S01176
491900200529     C                     Z-ADD0         STLT                            S01176
492000200529     C                     MOVE *BLANK    STLA                            S01176
492100200529     C***********          Z-ADD0         ISSR                     S01176 E19975
492200200529     C***********          Z-ADD0         KCUST                    S01176 E19975
492300200529     C                     Z-ADD0         KNCA                            S01176
492400200529     C                     MOVE SNMCY     KCCY                            S01176
492500200529     C                     Z-ADD0         KBCA                            S01176
492600200529     C*  SAVE PORTFOLIO REFERENCE                                         S01486
492700200529     C                     MOVE *BLANK    PTFR                            S01486
492800200529     C                     MOVE *BLANK    SEBR                            S01117
492900200529     C*                                                                   S01176
493000200529     C                     ADD  1         KEYCNT  50                      S01176
493100200529      *                                                                   CAC002
493200200529      ** If Analytical Accounting is installed, define profit centre.     CAC002
493300200529      *                                                                   CAC002
493400200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
493500200529     C                     MOVE PRFC      WPRFC                           CAC002
493600200529     C                     MOVE BVSEPC    PRFC                            CAC002
493700200529     C                     ENDIF                                          CAC002
493800200529      *                                                                   CAC002
493900200529      *                                                                                       CGL020
494000200529      ** Setup AML Fields                                                                     CGL020
494100200529      *                                                                                       CGL020
494200200529     C           CGL020    IFEQ 'Y'                                                           CGL020
494300200529      *                                                                                       CGL020
494400200529     C                     MOVE *BLANKS   F1RACT                                              CGL020
494500200529     C                     MOVE *BLANKS   F1RCTY                                              CGL020
494600200529     C                     MOVE *BLANKS   F1RBNK                                              CGL020
494700200529     C                     MOVE *BLANKS   F1RCDE                                              CGL020
494800200529     C                     MOVE *BLANKS   F1PACT                                              CGL020
494900200529     C                     MOVE *BLANKS   F1PCTY                                              CGL020
495000200529     C                     MOVE *BLANKS   F1PBNK                                              CGL020
495100200529     C                     MOVE *BLANKS   F1PCDE                                              CGL020
495200200529     C                     MOVE *BLANKS   F1DACT                                              CGL020
495300200529     C                     MOVE *BLANKS   F1DCTY                                              CGL020
495400200529     C                     MOVE *BLANKS   F1DBNK                                              CGL020
495500200529     C                     Z-ADD0         F1SDAT                                              CGL020
495600200529     C                     MOVE *BLANKS   F1TICK                                              CGL020
495700200529     C                     MOVE *BLANKS   F1EXCH                                              CGL020
495800200529     C                     Z-ADD0         F1NOML                                              CGL020
495900200529      *                                                                                       CGL020
496000200529     C                     ENDIF                                                              CGL020
496100200529      *                                                                                       CGL020
496200200529     C                     WRITESEKEYDF                                   S01176
496300200529      *                                                                   CAC002
496400200529     C           BGN0ST    IFEQ 'Y'                                       CAC002
496500200529     C                     MOVE WPRFC     PRFC                            CAC002
496600200529     C                     ENDIF                                          CAC002
496700200529      *                                                                   CAC002
496800200529     C*  REPLACE PORTFOLIO REFERENCE                                      S01486
496900200529     C*                                                                   S01176
497000200529     C* ADD EVENT AMOUNT INTO HASH TOTALS                                 S01176
497100200529     C*                                                                   S01176
497200200529     C                     Z-ADD1         Z                               S01176
497300200529     C                     Z-ADD1         S                               S01176
497400200529     C                     Z-ADDEVAM      ZZAMT                           S01176
497500200529     C                     EXSR ZHASH                                     S01176
497600200529     C*                                                                   S01176
497700200529     C* RESET FIELDS THAT GET CHANGED IN ACC AND ACCREV                   S01176
497800200529     C*                                                                   S01176
497900200529     C                     MOVE '  '      AMTC                            S01176
498000200529     C                     Z-ADD0         EVAM                            S01176
498100200529     C                     MOVE '   '     EVCY                            S01176
498200200529     C                     MOVE '0'       RVRS                            S01176
498300200529     C*                                                                   S01176
498400200529     C                     END                                            S01176
498500200529     C*                                                                   S01176
498600200529     C                     ENDSR                                          S01176
498700200529      *                                                                   S01176
498800200529      *****************************************************************   S01176
498900200529      /EJECT
499000200529     C/COPY WNCPYSRC,SE2290C043
499100200529      *****************************************************************   S01269
499200200529      *                                                                   S01269
499300200529      * W05 - PROCESS:  write to trades awaiting telex file PF/TRATXD     S01269
499400200529      *       FOR EACH: action for which the telex is deferred            S01269
499500200529      *       WHEN:     called from P/TRADEP & P/TRADE                    S01269
499600200529      *                                                                   S01269
499700200529      *****************************************************************   S01269
499800200529      *                                                                   S01269
499900200529     C           W05       BEGSR                           ** W05 **      S01269
500000200529      *                                                                   S01269
500100200529     C           TRECI     IFEQ 'R'                                       S01269
500200200529     C           TOED      ANDLTRUND                                      S01269
500300200529     C           TDRF      CHAINSOBTRDF              17                   S01269
500400200529      *                                                                   S01269
500500200529     C           *IN17     IFEQ '1'                                       S01269
500600200529     C                     SETON                     U7U8LR               S01269
500700200529     C                     MOVE 'SOBTR'   DBFILE           ***************S01269
500800200529     C                     MOVELTDRF      DBKEY            * DB ERROR 23 *S01269
500900200529     C***********          MOVE '23'      DBASE            ********S01269 S01117
501000200529     C                     Z-ADD23        DBASE                    S01269 S01117
501100200529     C                     GOTO MEND                                      S01269
501200200529     C                     END                                            S01269
501300200529      *                                                                   S01269
501400200529     C                     END                                            S01269
501500200529      *                                                                   S01269
501600200529     C                     MOVEASTAMP,1   TMST             Default Timestamp                  CPK015
501700200529     C                     WRITETRATXDF                                   S01269
501800200529      *                                                                   S01269
501900200529     C                     ENDSR                                          S01269
502000200529      *                                                                   S01269
502100200529      *****************************************************************   S01269
502200200529      /EJECT                                                              S01269
502300200529      *****************************************************************
502400200529      *                                                               *
502500200529      * AUDIT - PERFORM THE RUN CONTROL PROCESSES                     *
502600200529      *                                                               *
502700200529      *****************************************************************
502800200529      *
502900200529     C           AUDIT     BEGSR                           ** AUDIT **
503000200529     C*
503100200529     C* CHECK FOR DATABASE ERRORS
503200200529     C*
503300200529     C           *INU7     IFEQ '0'
503400200529     C*
503500200529     C* CHECK FOR NO RECORDS ON FILE
503600200529     C*
503700200529     C           *IN20     IFEQ '0'
503800200529     C                     EXSR TITLE                                     S01117
503900200529     C                     EXSR DATARA                                    S01117
504000200529     C************         MOVE *BLANKS   DBLOT                           S01117
504100200529     C************         MOVEL'SE2290'  DBPGM                           S01117
504200200529     C************         EXSR ZSYSTM                                    S01117
504300200529     C************IN99     IFEQ '1'                                       S01117
504400200529     C************         SETON                     U7U8                 S01117
504500200529     C************         MOVE 'TABLE'   DBFILE                          S01117
504600200529     C************         MOVELZTABKY    DBKEY            ***************S01117
504700200529     C***********          MOVE '14'      DBASE            **DB ERROR 14**S01117
504800200529     C***********          END                             ***************S01117
504900200529     C*
505000200529     C* Write out blank audit records
505100200529     C*
505200200529     C                     Z-ADD*ZEROS    NORE
505300200529     C                     Z-ADD*ZEROS    NORT
505400200529     C                     Z-ADD*ZEROS    NRDT
505500200529     C***********          WRITESETLXAF                            E18209 S01271
505600200529     C                     WRITETRDACAF
505700200529     C                     WRITEASTACAF
505800200529     C                     WRITECDPMVAF
505900200529     C                     WRITEUDPMVAF
506000200529     C***********          WRITESETLXAF                            S01176 S01271
506100200529     C                     GOTO WRTAU
506200200529     C                     END
506300200529     C*
506400200529     C* READ TRADES FILE AUDIT RECORD AND CHECK LIVE RECORDS
506500200529     C*
506600200529     C                     READ TRADSAF                  12
506700200529     C           *IN12     IFEQ '1'
506800200529     C                     SETON                     U7U8LR
506900200529     C           *LOCK     IN   LDA                                       S01117
507000200529     C                     MOVE 'TRADS'   DBFILE           ***************
507100200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 15 *
507200200529     C***********          MOVE '15'      DBASE            ***************S01117
507300200529     C                     Z-ADD15        DBASE                           S01117
507400200529     C                     OUT  LDA                                       S01117
507500200529     C                     DUMP                                           S01117
507600200529     C                     END
507700200529     C*
507800200529     C* IF COUNTS AGREE OUTPUT AND UPDATE OTHER AUDIT RECORDS
507900200529     C*
508000200529     C           *INU8     IFEQ '0'
508100200529     C           NORE      SUB  DAUCNT    NORE
508200200529     C           SLRB      SUB  DAUCNT    SLRB
508300200529     C                     UPDATTRADSAF
508400200529     C                     Z-ADDKEYCNT    NORE
508500200529     C                     Z-ADDINT,1     HRWN
508600200529     C                     Z-ADDDEC,1     HRDC
508700200529     C                     WRITESEKEYAF
508800200529     C********             Z-ADDTXCNT     NORE                            S01271
508900200529     C********             WRITESETLXAF                                   S01271
509000200529     C                     Z-ADDTACNT     NORT
509100200529     C                     Z-ADDVACNT     NRDT
509200200529     C                     WRITETRDACAF
509300200529     C*
509400200529     C                     Z-ADDASTCNT    NORE
509500200529     C                     WRITEASTACAF
509600200529     C                     Z-ADDUDCNT     NORE
509700200529     C                     WRITEUDPMVAF
509800200529     C                     Z-ADDCDCNT     NORE
509900200529     C                     WRITECDPMVAF
510000200529     C*
510100200529     C                     Z-ADDCNCCNT    SLRB
510200200529     C                     Z-ADD*ZEROS    SINS
510300200529     C                     Z-ADD*ZEROS    SAMD
510400200529     C                     Z-ADD*ZEROS    SDEL
510500200529     C                     Z-ADD*ZEROS    TRDA
510600200529     C                     Z-ADDCNCCNT    NORE
510700200529     C                     WRITECNCTRAF
510800200529     C*
510900200529     C                     READ HSTTRAF                  14
511000200529     C           *IN14     IFEQ '1'
511100200529     C                     SETON                     U7U8LR
511200200529     C           *LOCK     IN   LDA                                       S01117
511300200529     C                     MOVE 'HSTTR'   DBFILE           ***************
511400200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 17 *
511500200529     C***********          MOVE '17'      DBASE            ***************S01117
511600200529     C                     Z-ADD17        DBASE                           S01117
511700200529     C                     OUT  LDA                                       S01117
511800200529     C                     DUMP                                           S01117
511900200529     C                     ELSE
512000200529     C                     ADD  HSTCNT    SINS
512100200529     C                     ADD  HSTCNT    NORE
512200200529     C                     UPDATHSTTRAF
512300200529     C*
512400200529     C                     READ CLIABAF                  11
512500200529     C           *IN11     IFEQ '1'
512600200529     C                     SETON                     U7U8LR
512700200529     C           *LOCK     IN   LDA                                       S01117
512800200529     C                     MOVE 'CLIAB'   DBFILE           ***************
512900200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 18 *
513000200529     C***********          MOVE '18'      DBASE            ***************S01117
513100200529     C                     Z-ADD18        DBASE                           S01117
513200200529     C                     OUT  LDA                                       S01117
513300200529     C                     DUMP                                           S01117
513400200529     C                     ELSE
513500200529     C                     Z-ADDNORE      ONORE   50
513600200529     C           NORE      SUB  CLBDEL    NORE
513700200529     C           NORE      ADD  CLBADD    NORE
513800200529     C                     Z-ADDNORE      NNORE   50
513900200529     C                     UPDATCLIABAF
514000200529     C*
514100200529     C                     END
514200200529     C                     END
514300200529     C                     END
514400200529     C*                                                                   S01176
514500200529     C** UPDATE AUTO SETTLEMENT TRAILER IF NO DB ERROR HAS OCCURRED       S01176
514600200529     C*                                                                   S01176
514700200529     C           *INU8     IFEQ '0'                                       S01176
514800200529     C*                                                                   S01176
514900200529     C                     READ SETLEAF                  14               S01176
515000200529     C           *IN14     IFEQ '1'                                       S01176
515100200529     C                     SETON                     U7U8LR               S01176
515200200529     C           *LOCK     IN   LDA                                       S01117
515300200529     C                     MOVE 'SETLE'   DBFILE           ***************S01176
515400200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 20 *S01176
515500200529      *                                                    ***************S01117
515600200529     C***********          MOVE '20'      DBASE                    S01176 S01117
515700200529     C                     Z-ADD20        DBASE                    S01176 S01117
515800200529     C                     OUT  LDA                                       S01117
515900200529     C                     DUMP                                           S01117
516000200529     C                     ELSE                                           S01176
516100200529     C                     ADD  SETADD    NORE                            S01176
516200200529     C                     Z-ADDSETADD    SLRB                            S01176
516300200529     C                     UPDATSETLEAF                                   S01176
516400200529     C                     END                                            S01176
516500200529     C                     END                                            S01176
516600200529     C*                                                                   S01176
516700200529     C                     END
516800200529     C*
516900200529     C* WRITE OUT CONTROL REPORT
517000200529     C*
517100200529     C           WRTAU     TAG
517200200529     C*
517300200529     C                     WRITEHEADAU
517400200529     C**N20NU7***          WRITENONE                                      S01117
517500200529     C**NU7*20***          WRITECONTROL                                   S01117
517600200529     C**NU7*20***          WRITEHEADAU                                    S01117
517700200529     C**NU7*20***          WRITECONTRL2                                   S01117
517800200529     C  NU7                WRITECONTROL                                   S01117
517900200529     C  NU7                WRITEHEADAU                                    S01117
518000200529     C  NU7                WRITECONTRL2                                   S01117
518100200529     C   U7 U8             WRITEERRORAU
518200200529     C***********          WRITETRAILAU                                   S01117
518300200529     C   U7 U8             DUMP                                           S01117
518400200529     C/COPY WNCPYSRC,SE2290C035
518500200529     C*
518600200529     C                     ENDSR
518700200529      *
518800200529      *****************************************************************
518900200529      /EJECT
519000200529      *****************************************************************
519100200529      *                                                               *
519200200529      *  NOMDEC- SUBROUTINE TO CONVERT AN AMOUNT FROM NOMINAL DEC PLS *
519300200529      *              TO NOMINAL CCY DEC PLS.                          *
519400200529      *                                                               *
519500200529      *****************************************************************
519600200529      *
519700200529     C           NOMDEC    BEGSR                           ** NOMDEC**
519800200529     C*
519900200529     C* OBTAIN DECIMAL PLACES FOR NOMINAL CURRENCY
520000200529     C*
520100200529     C***********          MOVEL'20      'TKEY   12                       S01117
520200200529     C***********          MOVELTNMC      ZWK4    4                       S01117
520300200529     C***********          MOVE 1         ZWK4                            S01117
520400200529     C***********          MOVE ZWK4      TKEY                            S01117
520500200529     C***********TKEY      CHAINTABTG10F             90                   S01117
520600200529     C                     CALL 'AOCURRR0'                                S01117
520700200529     C                     PARM '*MSG   ' @RTCD   7                       S01117
520800200529     C                     PARM '*KEY   ' @OPTN   7                       S01117
520900200529     C                     PARM TNMC      @AJCD   3                       S01117
521000200529     C           SDCURR    PARM SDCURR    DSSDY                           S01117
521100200529     C*                                                                   S01117
521200200529     C**N90******RECI      COMP 'D'                  9090                 S01117
521300200529     C************IN90     IFEQ '1'                                       S01117
521400200529     C           @RTCD     IFNE *BLANK                                    S01117
521500200529     C                     SETON                     U7U8LR
521600200529     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
521700200529     C***********          MOVELTKEY      DBKEY            * DB ERROR 19 *S01117
521800200529     C************         MOVE '19'      DBASE            ***************S01117
521900200529     C           *LOCK     IN   LDA                                       S01117
522000200529     C                     MOVEL'SDCURRPD'DBFILE           ***************S01117
522100200529     C                     MOVE @AJCD     DBKEY            * DB ERROR 19 *S01117
522200200529     C                     MOVE @OPTN     DBOPTN           ***************S01117
522300200529     C                     Z-ADD19        DBASE                           S01117
522400200529     C                     OUT  LDA                                       S01117
522500200529     C                     DUMP                                           S01117
522600200529     C                     GOTO ENOMDC
522700200529     C                     END
522800200529     C*
522900200529     C***********CDP       SUB  TNMD      ZI      10                      S01117
523000200529     C           A6NBDP    SUB  TNMD      ZI      10                      S01117
523100200529     C           ZI        ADD  5         ZI
523200200529     C           SET       MULT POWER8,ZI SET       H
523300200529     C*
523400200529     C           ENOMDC    ENDSR
523500200529      *
523600200529      *****************************************************************
523700200529      /SPACE 3
523800200529     C*****************************************************************
523900200529     C*                                                               *
524000200529     C*   TRDSR  - SUBROUTINE FOR ERROR HANDLING OF TRADES FILE       *
524100200529     C*                                                               *
524200200529     C*****************************************************************
524300200529     C*
524400200529     C           TRDSR     BEGSR
524500200529     C*
524600200529     C           *LOCK     IN   LDA                                       S01117
524700200529     C                     MOVE 'TRDBR'   DBFILE           ***************
524800200529     C                     MOVELTDRF      DBKEY            * DB ERROR 80 *
524900200529     C***********          MOVE '80'      DBASE            ***************S01117
525000200529     C                     Z-ADD80        DBASE                           S01117
525100200529     C                     MOVE STSTRD    DBSTAT
525200200529     C                     OUT  LDA                                       S01117
525300200529     C                     MOVE '1'       *IN87
525400200529     C                     SETON                     LRU7U8
525500200529     C                     DUMP                                           S01117
525600200529     C                     GOTO MEND
525700200529     C*
525800200529     C                     ENDSR
525900200529     C*
526000200529     C*****************************************************************
526100200529      /SPACE 3
526200200529     C*****************************************************************
526300200529     C*                                                               *
526400200529     C*   CLBSR  - SUBROUTINE FOR ERROR HANDLING OF CONTINGENT        *
526500200529     C*            LIABILITIES FILE                                   *
526600200529     C*                                                               *
526700200529     C*****************************************************************
526800200529     C*
526900200529     C           CLBSR     BEGSR
527000200529     C*
527100200529     C           *LOCK     IN   LDA                                       S01117
527200200529     C                     MOVE 'CLBTR'   DBFILE           ***************
527300200529     C                     MOVELTDRF      DBKEY            * DB ERROR 81 *
527400200529     C***********          MOVE '81'      DBASE            ***************S01117
527500200529     C                     Z-ADD81        DBASE                           S01117
527600200529     C                     MOVE STSCLB    DBSTAT
527700200529     C                     OUT  LDA                                       S01117
527800200529     C                     MOVE '1'       *IN87
527900200529     C                     SETON                     LRU7U8
528000200529     C                     DUMP                                           S01117
528100200529     C                     GOTO MEND
528200200529     C*
528300200529     C                     ENDSR
528400200529     C*
528500200529     C*****************************************************************
528600200529      /SPACE 3
528700200529     C*****************************************************************
528800200529     C*                                                               *
528900200529     C*   CLASR  - SUBROUTINE FOR ERROR HANDLING OF CONTINGENT        *
529000200529     C*            LIABILITIES AUDIT RECORD                           *
529100200529     C*                                                               *
529200200529     C*****************************************************************
529300200529     C*
529400200529     C           CLASR     BEGSR
529500200529     C*
529600200529     C           *LOCK     IN   LDA                                       S01117
529700200529     C                     MOVE 'CLIAB'   DBFILE           ***************
529800200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 82 *
529900200529     C***********          MOVE '82'      DBASE            ***************S01117
530000200529     C                     Z-ADD82        DBASE                           S01117
530100200529     C                     MOVE STSCLA    DBSTAT
530200200529     C                     OUT  LDA                                       S01117
530300200529     C                     MOVE '1'       *IN87
530400200529     C                     SETON                     LRU7U8
530500200529     C                     DUMP                                           S01117
530600200529     C                     GOTO MEND
530700200529     C*
530800200529     C                     ENDSR
530900200529     C*
531000200529     C*****************************************************************
531100200529      /SPACE 3
531200200529     C*****************************************************************
531300200529     C*                                                               *
531400200529     C*   TACSR  - SUBROUTINE FOR ERROR HANDLING OF TRADE ACTIONS FILE*
531500200529     C*                                                               *
531600200529     C*****************************************************************
531700200529     C*
531800200529     C           TACSR     BEGSR
531900200529     C*
532000200529     C           *LOCK     IN   LDA                                       S01117
532100200529     C                     MOVE 'TRDAC'   DBFILE           ***************
532200200529     C                     MOVELTDRF      DBKEY            * DB ERROR 83 *
532300200529     C***********          MOVE '83'      DBASE            ***************S01117
532400200529     C                     Z-ADD83        DBASE                           S01117
532500200529     C                     MOVE STSTAC    DBSTAT
532600200529     C                     OUT  LDA                                       S01117
532700200529     C                     MOVE '1'       *IN87
532800200529     C                     SETON                     LRU7U8
532900200529     C                     DUMP                                           S01117
533000200529     C                     GOTO MEND
533100200529     C*
533200200529     C                     ENDSR
533300200529     C*
533400200529     C*****************************************************************
533500200529      /SPACE 3
533600200529     C*****************************************************************
533700200529     C*                                                               *
533800200529     C*   TAASR  - SUBROUTINE FOR ERROR HANDLING OF TRADE ACTIONS     *
533900200529     C*               AUDIT RECORD                                    *
534000200529     C*                                                               *
534100200529     C*****************************************************************
534200200529     C*
534300200529     C           TAASR     BEGSR
534400200529     C*
534500200529     C           *LOCK     IN   LDA                                       S01117
534600200529     C                     MOVE 'TRDAC'   DBFILE           ***************
534700200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 84 *
534800200529     C***********          MOVE '84'      DBASE            ***************S01117
534900200529     C                     Z-ADD84        DBASE                           S01117
535000200529     C                     MOVE STSTAA    DBSTAT
535100200529     C                     OUT  LDA                                       S01117
535200200529     C                     MOVE '1'       *IN87
535300200529     C                     SETON                     LRU7U8
535400200529     C                     DUMP                                           S01117
535500200529     C                     GOTO MEND
535600200529     C*
535700200529     C                     ENDSR
535800200529     C*
535900200529     C*****************************************************************
536000200529      /SPACE 3
536100200529     C*****************************************************************
536200200529     C*                                                               *
536300200529     C*   SKYSR  - SUBROUTINE FOR ERROR HANDLING OF ACCOUNT KEYS FILE *
536400200529     C*                                                               *
536500200529     C*****************************************************************
536600200529     C*
536700200529     C           SKYSR     BEGSR
536800200529     C*
536900200529     C           *LOCK     IN   LDA                                       S01117
537000200529     C                     MOVE 'SEKEY'   DBFILE           ***************
537100200529     C                     MOVELACKY      DBKEY            * DB ERROR 85 *
537200200529     C***********          MOVE '85'      DBASE            ***************S01117
537300200529     C                     Z-ADD85        DBASE                           S01117
537400200529     C                     MOVE STSSKY    DBSTAT
537500200529     C                     OUT  LDA                                       S01117
537600200529     C                     MOVE '1'       *IN87
537700200529     C                     SETON                     LRU7U8
537800200529     C                     DUMP                                           S01117
537900200529     C                     GOTO MEND
538000200529     C*
538100200529     C                     ENDSR
538200200529     C*
538300200529     C*****************************************************************
538400200529      /SPACE 3
538500200529     C*****************************************************************
538600200529     C*                                                               *
538700200529     C*   SKASR  - SUBROUTINE FOR ERROR HANDLING OF ACCOUNT KEYS      *
538800200529     C*                AUDIT RECORD                                   *
538900200529     C*                                                               *
539000200529     C*****************************************************************
539100200529     C*
539200200529     C           SKASR     BEGSR
539300200529     C*
539400200529     C           *LOCK     IN   LDA                                       S01117
539500200529     C                     MOVE 'SEKEY'   DBFILE           ***************
539600200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 86 *
539700200529     C***********          MOVE '86'      DBASE            ***************S01117
539800200529     C                     Z-ADD86        DBASE                           S01117
539900200529     C                     MOVE STSSKA    DBSTAT
540000200529     C                     OUT  LDA                                       S01117
540100200529     C                     MOVE '1'       *IN87
540200200529     C                     SETON                     LRU7U8
540300200529     C                     DUMP                                           S01117
540400200529     C                     GOTO MEND
540500200529     C*
540600200529     C                     ENDSR
540700200529     C*
540800200529     C*****************************************************************
540900200529      /SPACE 3
541000200529     C*****************************************************************
541100200529     C*                                                                   S01271
541200200529     C****SLXSR**-*SUBROUTINE*FOR*ERROR*HANDLING*OF*TELEX*EXTRACT*FILE**  S01271
541300200529     C**********                                                          S01271
541400200529     C********** SLXSR     BEGSR                                          S01271
541500200529     C**********                                                          S01271
541600200529     C**********           MOVE 'SETLX'   DBFILE                          S01271
541700200529     C**********           MOVELTDRF      DBKEY                           S01271
541800200529     C**********           MOVE '87'      DBASE                           S01271
541900200529     C**********           MOVE STSSLX    DBSTAT                          S01271
542000200529     C**********           MOVE '1'       *IN87                           S01271
542100200529     C**********           SETON                     LRU7U8               S01271
542200200529     C**********           GOTO MEND                                      S01271
542300200529     C**********                                                          S01271
542400200529     C**********           ENDSR                                          S01271
542500200529     C**********                                                          S01271
542600200529     C*****************************************************************   S01271
542700200529     C*****************************************************************
542800200529      /SPACE 3
542900200529     C*****************************************************************
543000200529     C*********                                                           S01271
543100200529     C****SLASR**-*SUBROUTINE*FOR*ERROR*HANDLING*OF*TELEX*EXTRACT****  R  S01271
543200200529     C****************AUDIT*RECORD****                                    S01271
543300200529     C*********                                                           S01271
543400200529     C*********  SLASR     BEGSR                                          S01271
543500200529     C*********                                                           S01271
543600200529     C*********            MOVE 'SETLX'   DBFILE                          S01271
543700200529     C*********            MOVEL'AUDIT'   DBKEY                           S01271
543800200529     C*********            MOVE '88'      DBASE                           S01271
543900200529     C*********            MOVE STSSLA    DBSTAT                          S01271
544000200529     C*********            MOVE '1'       *IN87                           S01271
544100200529     C*********            SETON                     LRU7U8               S01271
544200200529     C*********            GOTO MEND                                      S01271
544300200529     C*********                                                           S01271
544400200529     C*********            ENDSR                                          S01271
544500200529     C*********                                                           S01271
544600200529     C*****************************************************************
544700200529      /SPACE 3
544800200529     C*****************************************************************
544900200529     C*                                                               *
545000200529     C*   CNCSR  - SUBROUTINE FOR ERROR HANDLING OF CANCELLED TRADES  *
545100200529     C*                FILE                                           *
545200200529     C*                                                               *
545300200529     C*****************************************************************
545400200529     C*
545500200529     C           CNCSR     BEGSR
545600200529     C*
545700200529     C           *LOCK     IN   LDA                                       S01117
545800200529     C                     MOVE 'CNCTR'   DBFILE           ***************
545900200529     C                     MOVELTDRF      DBKEY            * DB ERROR 89 *
546000200529     C***********          MOVE '89'      DBASE            ***************S01117
546100200529     C                     Z-ADD89        DBASE                           S01117
546200200529     C                     MOVE STSCNC    DBSTAT
546300200529     C                     OUT  LDA                                       S01117
546400200529     C                     MOVE '1'       *IN87
546500200529     C                     SETON                     LRU7U8
546600200529     C                     DUMP                                           S01117
546700200529     C                     GOTO MEND
546800200529     C*
546900200529     C                     ENDSR
547000200529     C*
547100200529     C*****************************************************************
547200200529      /SPACE 3
547300200529     C*****************************************************************
547400200529     C*                                                               *
547500200529     C*   CNASR  - SUBROUTINE FOR ERROR HANDLING OF CANCELLED TRADES  *
547600200529     C*               AUDIT RECORD                                    *
547700200529     C*                                                               *
547800200529     C*****************************************************************
547900200529     C*
548000200529     C           CNASR     BEGSR
548100200529     C*
548200200529     C           *LOCK     IN   LDA                                       S01117
548300200529     C                     MOVE 'CNCTR'   DBFILE           ***************
548400200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 90 *
548500200529     C***********          MOVE '90'      DBASE            ***************S01117
548600200529     C                     Z-ADD90        DBASE                           S01117
548700200529     C                     MOVE STSCNA    DBSTAT
548800200529     C                     OUT  LDA                                       S01117
548900200529     C                     MOVE '1'       *IN87
549000200529     C                     SETON                     LRU7U8
549100200529     C                     DUMP                                           S01117
549200200529     C                     GOTO MEND
549300200529     C*
549400200529     C                     ENDSR
549500200529     C*
549600200529     C*****************************************************************
549700200529      /SPACE 3
549800200529     C*****************************************************************
549900200529     C*                                                               *
550000200529     C*   HSTSR  - SUBROUTINE FOR ERROR HANDLING OF HISTORIC TRADES   *
550100200529     C*               FILE                                            *
550200200529     C*                                                               *
550300200529     C*****************************************************************
550400200529     C*
550500200529     C           HSTSR     BEGSR
550600200529     C*
550700200529     C           *LOCK     IN   LDA                                       S01117
550800200529     C                     MOVE 'HSTTR'   DBFILE           ***************
550900200529     C                     MOVELTDRF      DBKEY            * DB ERROR 91 *
551000200529     C***********          MOVE '91'      DBASE            ***************S01117
551100200529     C                     Z-ADD91        DBASE                           S01117
551200200529     C                     MOVE STSHST    DBSTAT
551300200529     C                     OUT  LDA                                       S01117
551400200529     C                     MOVE '1'       *IN87
551500200529     C                     SETON                     LRU7U8
551600200529     C                     DUMP                                           S01117
551700200529     C                     GOTO MEND
551800200529     C*
551900200529     C                     ENDSR
552000200529     C*
552100200529     C*****************************************************************
552200200529      /SPACE 3
552300200529     C*****************************************************************
552400200529     C*                                                               *
552500200529     C*   HSASR  - SUBROUTINE FOR ERROR HANDLING OF HISTORIC TRADES   *
552600200529     C*               AUDIT RECORD                                    *
552700200529     C*                                                               *
552800200529     C*****************************************************************
552900200529     C*
553000200529     C           HSASR     BEGSR
553100200529     C*
553200200529     C           *LOCK     IN   LDA                                       S01117
553300200529     C                     MOVE 'HSTTR'   DBFILE           ***************
553400200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 92 *
553500200529     C***********          MOVE '92'      DBASE            ***************S01117
553600200529     C                     Z-ADD92        DBASE                           S01117
553700200529     C                     MOVE STSHSA    DBSTAT
553800200529     C                     OUT  LDA                                       S01117
553900200529     C                     MOVE '1'       *IN87
554000200529     C                     SETON                     LRU7U8
554100200529     C                     DUMP                                           S01117
554200200529     C                     GOTO MEND
554300200529     C*
554400200529     C                     ENDSR
554500200529     C*
554600200529     C*****************************************************************
554700200529      /SPACE 3
554800200529     C*****************************************************************
554900200529     C*                                                               *
555000200529     C*   ASTSR  - SUBROUTINE FOR ERROR HANDLING OF AUTOMATIC SETTLE -*
555100200529     C*               MENT ACTIONS FILE                               *
555200200529     C*                                                               *
555300200529     C*****************************************************************
555400200529     C*
555500200529     C           ASTSR     BEGSR
555600200529     C*
555700200529     C           *LOCK     IN   LDA                                       S01117
555800200529     C                     MOVE 'ASTAC'   DBFILE           ***************
555900200529     C                     MOVELTDRF      DBKEY            * DB ERROR 93 *
556000200529     C***********          MOVE '93'      DBASE            ***************S01117
556100200529     C                     Z-ADD93        DBASE                           S01117
556200200529     C                     MOVE STSAST    DBSTAT
556300200529     C                     OUT  LDA                                       S01117
556400200529     C                     MOVE '1'       *IN87
556500200529     C                     SETON                     LRU7U8
556600200529     C                     DUMP                                           S01117
556700200529     C                     GOTO MEND
556800200529     C*
556900200529     C                     ENDSR
557000200529     C*
557100200529     C*****************************************************************
557200200529      /SPACE 3
557300200529     C*****************************************************************
557400200529     C*                                                               *
557500200529     C*   ASASR  - SUBROUTINE FOR ERROR HANDLING OF AUTOMATIC SETTLE -*
557600200529     C*               MENT ACTIONS AUDIT RECORD                       *
557700200529     C*                                                               *
557800200529     C*****************************************************************
557900200529     C*
558000200529     C           ASASR     BEGSR
558100200529     C*
558200200529     C           *LOCK     IN   LDA                                       S01117
558300200529     C                     MOVE 'ASTAC'   DBFILE           ***************
558400200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 94 *
558500200529     C***********          MOVE '94'      DBASE            ***************S01117
558600200529     C                     Z-ADD94        DBASE                           S01117
558700200529     C                     MOVE STSASA    DBSTAT
558800200529     C                     OUT  LDA                                       S01117
558900200529     C                     MOVE '1'       *IN87
559000200529     C                     SETON                     LRU7U8
559100200529     C                     DUMP                                           S01117
559200200529     C                     GOTO MEND
559300200529     C*
559400200529     C                     ENDSR
559500200529     C*
559600200529     C*****************************************************************
559700200529      /SPACE 3
559800200529     C*****************************************************************
559900200529     C*                                                               *
560000200529     C*   UDPSR  - SUBROUTINE FOR ERROR HANDLING OF USER DEPOT        *
560100200529     C*            MOVEMENT FILE                                      *
560200200529     C*                                                               *
560300200529     C*****************************************************************
560400200529     C*
560500200529     C           UDPSR     BEGSR
560600200529     C*
560700200529     C           *LOCK     IN   LDA                                       S01117
560800200529     C                     MOVE 'UDPMV'   DBFILE           ***************
560900200529     C                     MOVELTDSS      DBKEY            * DB ERROR 95 *
561000200529     C***********          MOVE '95'      DBASE            ***************S01117
561100200529     C                     Z-ADD95        DBASE                           S01117
561200200529     C                     MOVE STSUDP    DBSTAT
561300200529     C                     OUT  LDA                                       S01117
561400200529     C                     MOVE '1'       *IN87
561500200529     C                     SETON                     LRU7U8
561600200529     C                     DUMP                                           S01117
561700200529     C                     GOTO MEND
561800200529     C*
561900200529     C                     ENDSR
562000200529     C*
562100200529     C*****************************************************************
562200200529      /SPACE 3
562300200529     C*****************************************************************
562400200529     C*                                                               *
562500200529     C*   UDASR  - SUBROUTINE FOR ERROR HANDLING OF USER DEPOT        *
562600200529     C*            MOVEMENT AUDIT RECORD                              *
562700200529     C*                                                               *
562800200529     C*****************************************************************
562900200529     C*
563000200529     C           UDASR     BEGSR
563100200529     C*
563200200529     C           *LOCK     IN   LDA                                       S01117
563300200529     C                     MOVE 'UDPMV'   DBFILE           ***************
563400200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 96 *
563500200529     C***********          MOVE '96'      DBASE            ***************S01117
563600200529     C                     Z-ADD96        DBASE                           S01117
563700200529     C                     MOVE STSUDA    DBSTAT
563800200529     C                     OUT  LDA                                       S01117
563900200529     C                     MOVE '1'       *IN87
564000200529     C                     SETON                     LRU7U8
564100200529     C                     DUMP                                           S01117
564200200529     C                     GOTO MEND
564300200529     C*
564400200529     C                     ENDSR
564500200529     C*
564600200529     C*****************************************************************
564700200529      /SPACE 3
564800200529     C*****************************************************************
564900200529     C*                                                               *
565000200529     C*   CDPSR  - SUBROUTINE FOR ERROR HANDLING OF CUSTOMER DEPOT    *
565100200529     C*               MOVEMENTS FILE                                  *
565200200529     C*                                                               *
565300200529     C*****************************************************************
565400200529     C*
565500200529     C           CDPSR     BEGSR
565600200529     C*
565700200529     C           *LOCK     IN   LDA                                       S01117
565800200529     C                     MOVE 'CDPMV'   DBFILE           ***************
565900200529     C                     MOVELTDSS      DBKEY            * DB ERROR 97 *
566000200529     C**********           MOVE '97'      DBASE            ***************S01117
566100200529     C                     Z-ADD97        DBASE                           S01117
566200200529     C                     MOVE STSCDP    DBSTAT
566300200529     C                     OUT  LDA                                       S01117
566400200529     C                     MOVE '1'       *IN87
566500200529     C                     SETON                     LRU7U8
566600200529     C                     DUMP                                           S01117
566700200529     C                     GOTO MEND
566800200529     C*
566900200529     C                     ENDSR
567000200529     C*
567100200529     C*****************************************************************
567200200529      /SPACE 3
567300200529     C*****************************************************************
567400200529     C*                                                               *
567500200529     C*   CDASR  - SUBROUTINE FOR ERROR HANDLING OF CUSTOMER DEPOT    *
567600200529     C*               MOVEMENTS AUDIT RECORD                          *
567700200529     C*                                                               *
567800200529     C*****************************************************************
567900200529     C*
568000200529     C           CDASR     BEGSR
568100200529     C*
568200200529     C           *LOCK     IN   LDA                                       S01117
568300200529     C                     MOVE 'CDPMV'   DBFILE           ***************
568400200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 98 *
568500200529     C***********          MOVE '98'      DBASE            ***************S01117
568600200529     C                     Z-ADD98        DBASE                           S01117
568700200529     C                     MOVE STSCDA    DBSTAT
568800200529     C                     OUT  LDA                                       S01117
568900200529     C                     MOVE '1'       *IN87
569000200529     C                     SETON                     LRU7U8
569100200529     C                     DUMP                                           S01117
569200200529     C                     GOTO MEND
569300200529     C*
569400200529     C                     ENDSR
569500200529     C*
569600200529     C*****************************************************************
569700200529      /SPACE 3
569800200529     C*****************************************************************
569900200529     C*                                                               *
570000200529     C*   TRASR  - SUBROUTINE FOR ERROR HANDLING OF TRADES FILE AUDIT *
570100200529     C*                                                               *
570200200529     C*****************************************************************
570300200529     C*
570400200529     C           TRASR     BEGSR
570500200529     C*
570600200529     C           *LOCK     IN   LDA                                       S01117
570700200529     C                     MOVE 'TRADS'   DBFILE           ***************
570800200529     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 99 *
570900200529     C***********          MOVE '99'      DBASE            ***************S01117
571000200529     C                     Z-ADD99        DBASE                           S01117
571100200529     C                     MOVE STSTRA    DBSTAT
571200200529     C                     OUT  LDA                                       S01117
571300200529     C                     MOVE '1'       *IN87
571400200529     C                     SETON                     LRU7U8
571500200529     C                     DUMP                                           S01117
571600200529     C                     GOTO MEND
571700200529     C*
571800200529     C                     ENDSR
571900200529     C*
572000200529      *****************************************************************                       CGL031
572100200529      /SPACE 3                                                                                CGL031
572200200529      *****************************************************************                       CGL031
572300200529      *                                                               *                       CGL031
572400200529      * SRETAX - Retrieve Tax Amount                                  *                       CGL031
572500200529      *                                                               *                       CGL031
572600200529      *****************************************************************                       CGL031
572700200529     C           SRETAX    BEGSR                                                              CGL031
572800200529      *                                                                                       CGL031
572900200529     C**********           Z-ADDRUND      WGDAT                                        CGL031 234844
573000200529     C                     MOVE 'S'       WMODI                                               CGL031
573100200529     C                     MOVE TDRF      WTRNO                                               CGL031
573200200529      *                                                                                       CGL031
573300200529     C                     Z-ADD*ZEROS    WXEVAM 150                                          CGL031
573400200529     C                     Z-ADD*ZEROS    WIEVAM 150                                          CGL031
573500200529     C                     Z-ADD*ZEROS    WKEVAM 150                                          235174
573600200529     C                     Z-ADD*ZEROS    WXKNCA 150                                          CGL031
573700200529     C                     Z-ADD*ZEROS    WIKNCA 150                                          CGL031
573800200529     C                     Z-ADD*ZEROS    WXKBCA 150                                          CGL031
573900200529     C                     Z-ADD*ZEROS    WIKBCA 150                                          CGL031
574000200529      *                                                                                       CGL031
574100200529     C********** KCSIN     SETLLSDCSINL6                                               CGL031 234844
574200200529     C********** KCSIN     READESDCSINL6                 27                            CGL031 234844
574300200529     C           KCSIN     SETLLSDCSINLD                                                      234844
574400200529     C           KCSIN     READESDCSINLD                 27                                   234844
574500200529      *                                                                                       CGL031
574600200529     C           *IN27     DOWEQ*OFF                                                          CGL031
574700200529      *                                                                                       CGL031
574800200529     C           TSSTAT    IFEQ 'T'                                                           CGL031
574900200529      *                                                                                       CGL031
575000200529     C           TSSCCY    IFEQ TSTXCY                                                        CGL031
575100200529     C                     ADD  TSTXSS    WXEVAM                                              CGL031
575200200529     C                     ADD  TSNINS    WIEVAM                                              CGL031
575300200529     C                     Z-ADDTSTXSS    WKEVAM                                              235174
575400200529     C                     ELSE                                                               CGL031
575500200529     C                     ADD  TSTXSC    WXEVAM                                              CGL031
575600200529     C                     ADD  TSNINC    WIEVAM                                              CGL031
575700200529     C                     Z-ADDTSTXSC    WKEVAM                                              235174
575800200529     C                     ENDIF                                                              CGL031
575900200529      *                                                                                       CGL031
576000200529     C                     MOVE TSTXCY    WEVCY   3                                           CGL031
576100200529     C                     ADD  TSTXSS    WXKNCA                                              CGL031
576200200529     C                     ADD  TSNINS    WIKNCA                                              CGL031
576300200529      *                                                                                       CGL031
576400200529     C                     MOVE TSSCCY    WKCCY   3                                           CGL031
576500200529     C                     ADD  TSTXSB    WXKBCA                                              CGL031
576600200529     C                     ADD  TSNINB    WIKBCA                                              CGL031
576700200529      *                                                                                       235174
576800200529      ** Generate EU a/c keys for tax amount.                                                 235174
576900200529      *                                                                                       235174
577000200529     C                     EXSR SREAET                                                        235174
577100200529      *                                                                                       CGL031
577200200529     C                     ENDIF                                                              CGL031
577300200529      *                                                                                       CGL031
577400200529     C********** KCSIN     READESDCSINL6                 27                            CGL031 234844
577500200529     C           KCSIN     READESDCSINLD                 27                                   234844
577600200529     C                     ENDDO                                                              CGL031
577700200529      *                                                                                       CGL031
577800200529     C                     ENDSR                                                              CGL031
577900200529      *****************************************************************                       236063
578000200529      /EJECT                                                                                  236063
578100200529      *****************************************************************                       236063
578200200529      *                                                               *                       236063
578300200529      * SRGNRV - DETERMINE WHETHER TO GENERATE REVERSALS.             *                       236063
578400200529      *                                                               *                       236063
578500200529      *****************************************************************                       236063
578600200529     C           SRGNRV    BEGSR                                                              236063
578700200529      *                                                                                       236063
578800200529      *  SETUP KEY FOR SDCSINLD.                                                              236063
578900200529     C                     MOVE 'S'       WMODI                                               236063
579000200529     C                     MOVE TDRF      WTRNO                                               236063
579100200529      *                                                                                       236063
579200200529     C           KCSIN     SETLLSDCSINLD                 27                                   236063
579300200529      *  IF RECORD FOUND ON SDCSINLD OR TRADSD.WKRECI<>'C' THEN DO NOT GENERATE REVERSALS.    236063
579400200529      *                                                                                       236063
579500200529     C                     SELEC                                                              236063
579600200529     C           *IN27     WHEQ *ON                                                           236063
579700200529     C                     MOVE 'N'       WKGNRV                                              236063
579800200529      *                                                                                       236063
579900200529     C           *IN27     WHEQ *OFF                                                          236063
580000200529     C           WKRECI    ANDNE'C'                                                           236063
580100200529     C                     MOVE 'N'       WKGNRV                                              236063
580200200529      *                                                                                       236063
580300200529     C                     OTHER                                                              236063
580400200529     C                     MOVE 'Y'       WKGNRV                                              236063
580500200529     C                     ENDSL                                                              236063
580600200529      *                                                                                       236063
580700200529     C                     ENDSR                                                              236063
580800200529      *                                                                                       236063
580900200529      *                                                                                       236063
581000200529      *****************************************************************                       235615
581100200529      /EJECT                                                                                  235615
581200200529      *****************************************************************                       235615
581300200529      *                                                               *                       235615
581400200529      * SRETXR - Retrieve Tax Amount for Reversal from SOB file       *                       235615
581500200529      *                                                               *                       235615
581600200529      *****************************************************************                       235615
581700200529     C           SRETXR    BEGSR                                                              235615
581800200529      *                                                                                       235615
581900200529     C                     MOVE 'S'       WMODI                                               235615
582000200529     C                     MOVE TDRF      WTRNO                                               235615
582100200529      *                                                                                       235615
582200200529     C                     Z-ADD*ZEROS    WXEVAM                                              235615
582300200529     C                     Z-ADD*ZEROS    WIEVAM                                              235615
582400200529     C                     Z-ADD*ZEROS    WKEVAM                                              235615
582500200529     C                     Z-ADD*ZEROS    WXKNCA                                              235615
582600200529     C                     Z-ADD*ZEROS    WIKNCA                                              235615
582700200529     C                     Z-ADD*ZEROS    WXKBCA                                              235615
582800200529     C                     Z-ADD*ZEROS    WIKBCA                                              235615
582900200529      *                                                                                       235615
583000200529     C           KCSIN     SETLLSOBCINLD                                                      235615
583100200529     C           KCSIN     READESOBCINLD                 27                                   235615
583200200529      *                                                                                       235615
583300200529     C           *IN27     DOWEQ*OFF                                                          235615
583400200529      *                                                                                       235615
583500200529     C           TSSTAT    IFEQ 'T'                                                           235615
583600200529      *                                                                                       235615
583700200529     C           TSSCCY    IFEQ TSTXCY                                                        235615
583800200529     C                     ADD  TSTXSS    WXEVAM                                              235615
583900200529     C                     ADD  TSNINS    WIEVAM                                              235615
584000200529     C                     Z-ADDTSTXSS    WKEVAM                                              235615
584100200529     C                     ELSE                                                               235615
584200200529     C                     ADD  TSTXSC    WXEVAM                                              235615
584300200529     C                     ADD  TSNINC    WIEVAM                                              235615
584400200529     C                     Z-ADDTSTXSC    WKEVAM                                              235615
584500200529     C                     ENDIF                                                              235615
584600200529      *                                                                                       235615
584700200529     C                     MOVE TSTXCY    WEVCY                                               235615
584800200529     C                     ADD  TSTXSS    WXKNCA                                              235615
584900200529     C                     ADD  TSNINS    WIKNCA                                              235615
585000200529      *                                                                                       235615
585100200529     C                     MOVE TSSCCY    WKCCY                                               235615
585200200529     C                     ADD  TSTXSB    WXKBCA                                              235615
585300200529     C                     ADD  TSNINB    WIKBCA                                              235615
585400200529      *                                                                                       235615
585500200529      ** Generate EU a/c keys for tax amount reversal.                                        235615
585600200529      *                                                                                       235615
585700200529     C                     MOVELRVRS      SVRVRS                                              235615
585800200529     C                     MOVEL'1'       RVRS                                                235615
585900200529     C                     EXSR SREAET                                                        235615
586000200529     C                     MOVELSVRVRS    RVRS                                                235615
586100200529      *                                                                                       235615
586200200529     C                     ENDIF                                                              235615
586300200529      *                                                                                       235615
586400200529     C           KCSIN     READESOBCINLD                 27                                   235615
586500200529     C                     ENDDO                                                              235615
586600200529      *                                                                                       235615
586700200529     C                     ENDSR                                                              235615
586800200529      *****************************************************************                       235174
586900200529      /EJECT                                                                                  235174
587000200529      *****************************************************************                       235174
587100200529      *                                                               *                       235174
587200200529      *  SREAET - EU a/c key generation for tax amount.               *                       235174
587300200529      *                                                               *                       235174
587400200529      *****************************************************************                       235174
587500200529     C           SREAET    BEGSR                                                              235174
587600200529      *                                                                                       235174
587700200529     C           WKEVAM    IFGT *ZERO                                                         235174
587800200529     C                     MOVE *BLANK    CCCD                                                235174
587900200529     C                     MOVE TSRCTR    CTTX                                                235174
588000200529     C                     MOVE 'ET'      AMTC                                                235174
588100200529     C                     Z-ADDWKEVAM    EVAM                                                235174
588200200529     C                     MOVE TSTXCY    EVCY                                                235174
588300200529     C********** TSSCCY    IFEQ TSTXCY                                                 235751 235615
588400200529     C**********           Z-ADDTSTXSS    KNCA                                         235174 235615
588500200529     C                     Z-ADDTSTXSR    KNCA                                                235615
588600200529     C**********           ELSE                                                        235751 235615
588700200529     C**********           Z-ADDTSTXSC    KNCA                                         235751 235615
588800200529     C**********           ENDIF                                                       235751 235615
588900200529     C                     MOVE TSSCCY    KCCY                                                235174
589000200529     C                     Z-ADDTSTXSB    KBCA                                                235174
589100200529     C                     EXSR W01                                                           235174
589200200529     C                     ENDIF                                                              235174
589300200529      *                                                                                       235174
589400200529     C                     ENDSR                                                              235174
589500200529     C*****************************************************************
589600200529      /EJECT
589700200529      *****************************************************************   S01117
589800200529      *                                                               *   S01117
589900200529      *  TITLE - Subroutine to extract title from AOBANKR0            *   S01117
590000200529      *                                                               *   S01117
590100200529      *  Called by: Main program                                      *   S01117
590200200529      *             AUDIT                                             *   S01117
590300200529      *                                                               *   S01117
590400200529      *  Calls: None                                                  *   S01117
590500200529      *                                                               *   S01117
590600200529      *****************************************************************   S01117
590700200529      *                                                                   S01117
590800200529     C           TITLE     BEGSR                                          S01117
590900200529     C                     CALL 'AOBANKR0'                                S01117
591000200529     C                     PARM '*MSG   ' @RTCD   7                       S01117
591100200529     C                     PARM '*FIRST ' @OPTN   7                       S01117
591200200529     C           SDBANK    PARM SDBANK    DSFDY                           S01117
591300200529      *                                                                   S01117
591400200529     C           @RTCD     IFNE *BLANK                                    S01117
591500200529     C           *LOCK     IN   LDA                                       S01117
591600200529     C                     MOVEL'SDBANKPD'DBFILE                          S01117
591700200529     C                     MOVEL@OPTN     DBKEY            ***************S01117
591800200529     C                     MOVEL@OPTN     DBOPTN  7        * DB ERROR 11 *S01117
591900200529     C                     Z-ADD77        DBASE            ***************S01117
592000200529     C                     OUT  LDA                                       S01117
592100200529     C                     SETON                     U7U8LR               S01117
592200200529     C                     WRITEHEADAU                                    S01117
592300200529     C                     WRITEERRORAU                                   S01117
592400200529     C                     DUMP                                           S01117
592500200529     C                     RETRN                                          S01117
592600200529     C                     END                                            S01117
592700200529     C/COPY WNCPYSRC,SE2290C036
592800200529     C                     ENDSR                                          S01117
592900200529      *                                                                   S01117
593000200529      *****************************************************************   S01117
593100200529      /EJECT                                                              S01117
593200200529      *****************************************************************   S01117
593300200529      *                                                               *   S01117
593400200529      *  DATARA - Subroutine to input data area                       *   S01117
593500200529      *                                                               *   S01117
593600200529      *  Called by: Main program                                      *   S01117
593700200529      *             AUDIT                                             *   S01117
593800200529      *                                                               *   S01117
593900200529      *  Calls: None                                                  *   S01117
594000200529      *                                                               *   S01117
594100200529      *****************************************************************   S01117
594200200529     C           DATARA    BEGSR                                          S01117
594300200529      *                                                                   S01117
594400200529     C           *NAMVAR   DEFN           LDA                             S01117
594500200529     C           *LOCK     IN   LDA                                       S01117
594600200529     C                     MOVEL*BLANK    DBLOT                           S01117
594700200529     C                     MOVEL'SE2290'  DBPGM                           S01117
594800200529     C                     OUT  LDA                                       S01117
594900200529      *                                                                   S01117
595000200529      ** Read in the data area RUNDAT                                     S01117
595100200529      *                                                                   S01117
595200200529     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
595300200529     C                     IN   RUNDT                                     S01117
595400200529      *                                                                   S01117
595500200529      ** Check data format                                                S01117
595600200529      *                                                                   S01117
595700200529     C           DATF      IFEQ 'M'                                       S01117
595800200529     C                     MOVE '1'       *IN98                           S01117
595900200529     C                     ELSE                                           S01117
596000200529     C                     MOVE '0'       *IN98                           S01117
596100200529     C                     END                                            S01117
596200200529     C/COPY WNCPYSRC,SE2290C081
596300200529      *                                                                   S01117
596400200529     C                     ENDSR                                          S01117
596500200529      *****************************************************************   CSE039
596600200529      /EJECT                                                              CSE039
596700200529      *****************************************************************   CSE039
596800200529      *                                                               *   CSE039
596900200529      *  SRSEMV - SUBROUTINE TO WRITE RECORD TO PF/SEMVTSPD           *   CSE039
597000200529      *                                                               *   CSE039
597100200529      *****************************************************************   CSE039
597200200529      *                                                                   CSE039
597300200529     C           SRSEMV    BEGSR                                          CSE039
597400200529      *                                                                   CSE039
597500200529      ** Check if record exists (Reference, Type, Notification)           CSE039
597600200529     C                     MOVELTDRF      KTDRF                           CSE039
597700200529     C                     MOVEL'T'       KTRTY                           CSE039
597800200529     C                     Z-ADDRUND      KNTDT                           CSE039
597900200529     C                     Z-ADD0         USQNR   30                      CSE039
598000200529      *                                                                   CSE039
598100200529      ** Get Sequence Number                                              CSE039
598200200529     C           KSEMV     SETLLSEMVTSL1                                  CSE039
598300200529     C                     READ SEMVTSL1                 65               CSE039
598400200529     C           *IN65     IFEQ *OFF                                      CSE039
598500200529     C           KTDRF     ANDEQTMTRRF                                    CSE039
598600200529     C           KTRTY     ANDEQTMTRTY                                    CSE039
598700200529     C           KNTDT     ANDEQTMNTDT                                    CSE039
598800200529     C                     Z-ADDTMSQNR    USQNR                           CSE039
598900200529     C                     ENDIF                                          CSE039
599000200529      *                                                                   CSE039
599100200529      ** Write details to PF/SEMVTSPD                                     CSE039
599200200529     C                     MOVELTDRF      TMTRRF                          CSE039
599300200529     C                     MOVEL'T'       TMTRTY                          CSE039
599400200529     C                     Z-ADDRUND      TMNTDT                          CSE039
599500200529     C           USQNR     ADD  1         TMSQNR                          CSE039
599600200529     C                     MOVEL'SET'     TMSWSC                          CSE039
599700200529     C                     MOVEL*BLANKS   TMSWRC                          CSE039
599800200529     C                     MOVEL*BLANKS   TMNTMT                          CSE039
599900200529     C                     MOVEL*BLANKS   TMLCUS                          CSE039
600000200529     C                     MOVEL'MIDAS'   TMINOR                          CSE039
600100200529     C                     MOVEL*BLANKS   TMMSGK                          CSE039
600200200529      *                                                                   CSE039
600300200529      ** Set "Settlement Message Generated" as follow:                    CSE039
600400200529      ** Check "Settlement Advice Required" in SDSECSPD using TCNR        CSE039
600500200529      ** and if = 'Y', set TMSTMG to 'Y', if not set TMSTMG to 'N'        CSE039
600600200529     C                     MOVE TCNR      @AENB                           CSE039
600700200529     C                     CALL 'AOSECSR0'                                CSE039
600800200529     C                     PARM *BLANKS   @RTCD                           CSE039
600900200529     C                     PARM '*KEY   ' @OPTN                           CSE039
601000200529     C                     PARM           @AENB   6                       CSE039
601100200529     C           SDSECS    PARM SDSECS    DSSDY                           CSE039
601200200529     C           @RTCD     IFNE *BLANKS                                   CSE039
601300200529      *                                                                   CSE039
601400200529     C           BFSARQ    IFEQ 'Y'                                       CSE039
601500200529     C                     MOVEL'Y'       TMSTMG                          CSE039
601600200529     C                     ELSE                                           CSE039
601700200529     C                     MOVEL'N'       TMSTMG                          CSE039
601800200529     C                     ENDIF                                          CSE039
601900200529      *                                                                   CSE039
602000200529     C                     ELSE                                           CSE039
602100200529     C                     MOVEL'N'       TMSTMG                          CSE039
602200200529     C                     ENDIF                                          CSE039
602300200529      *                                                                   CSE039
602400200529     C                     MOVELNARR,1    TMNARR                          CSE039
602500200529     C                     MOVEL'I'       TMLCTP                          CSE039
602600200529     C                     Z-ADDRUND      TMLCDT                          CSE039
602700200529     C                     MOVELTMMP,1    TMTMST                          CSE039
602800200529     C                     MOVELTDBA      TMTRBB                          CSE039
602900200529      *                                                                   CSE039
603000200529     C                     WRITESEMVTSUP                                  CSE039
603100200529      *                                                                   CSE039
603200200529     C                     ENDSR                                          CSE039
603300200529      *                                                                   CSE039
603400200529      *****************************************************************   S01117
603500200529      /EJECT                                                              S01117
603600200529      *****************************************************************   S01117
603700200529      *                                                               *   S01117
603800200529      *  *PSSR  - Error control subroutine                            *   S01117
603900200529      *                                                               *   S01117
604000200529      *****************************************************************   S01117
604100200529      *                                                                   S01117
604200200529     C           *PSSR     BEGSR                           ** *PSSR **    S01117
604300200529     C**                                                                  S01117
604400200529     C           @RUN      IFEQ *BLANKS                                   S01117
604500200529     C                     MOVE 'Y'       @RUN    1                       S01117
604600200529     C                     DUMP                                           S01117
604700200529     C                     END                                            S01117
604800200529     C**                                                                  S01117
604900200529     C                     ENDSR                                          S01117
605000200529      *                                                                   S01117
605100200529     C*****************************************************************
605200200529     C/COPY WNCPYSRC,SE2290C037
605300200529      /EJECT
605400200529     C/COPY ZSRSRC,ZCONPRZ1
605500200529      /EJECT
605600200529     C/COPY ZSRSRC,ZCONVZ1
605700200529      /EJECT
605800200529     C/COPY ZSRSRC,ZDATE1Z2
605900200529      /EJECT
606000200529     C/COPY ZSRSRC,ZDATE2Z4
606100200529      /EJECT
606200200529     C/COPY ZSRSRC,ZDAYSZ2
606300200529      /EJECT
606400200529     C/COPY ZSRSRC,ZDYYRZ3
606500200529      /EJECT
606600200529     C/COPY ZSRSRC,ZEVCDZ1
606700200529      /EJECT
606800200529     C/COPY ZSRSRC,ZHASHZ3
606900200529     C*EJECT******************                                            S01117
607000200529     C*COPY*ZSRSRC,ZICD2Z1****                                            S01117
607100200529     C*EJECT******************                                            S01117
607200200529     C*COPY*ZSRSRC,ZICDSEZ1***                                            S01117
607300200529      /EJECT
607400200529     C/COPY ZSRSRC,ZNCDZ3
607500200529      /EJECT
607600200529     C/COPY ZSRSRC,ZLCDZ1                                                 100228
607700200529      /EJECT                                                              100228
607800200529     C***/COPY*ZSRSRC*ZSYSTMZ1                                            S01117
607900200529     C/COPY WNCPYSRC,SE2290C044
608000200529      /EJECT
608100200529      ***
608200200529**  NAR                                                                   S01176
608300200529AUTO-SETTLEMENT                                                           S01176
608400200529**  CPY@
608500200529(c) Finastra International Limited 2001
608600200529**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
6087002005290000001
6088002005290000010
6089002005290000100
6090002005290001000
6091002005290010000
6092002005290100000
6093002005291000000
609400200529**  POWER8 - ARRAY OF POWERS FOR NOMINAL CURRENCY CONVERSION
60950020052900000001
60960020052900000010
60970020052900000100
60980020052900001000
60990020052900010000
61000020052900100000
61010020052901000000
61020020052910000000
610300200529**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
6104002005290006001521029820444305904073650882610287117481320914670161311759219053
6105002005292051421975234362489726358278192928030741322023366335124365853804639507
61060020052940968424294389045351
610700200529**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
6108002005290366073110961461
610900200529**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
611000200529000031059090120151181212243273304334365
611100200529**   ZMNM - MONTHS SHORT NAMES
611200200529JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
611300200529** STAMP - Dummy timestamp                                                                    CPK015
6114002005290001-01-01-00.00.00.000000                                                                    CPK015
611500200529**  NARR  - Array of Narratives
611600200529Automatic Settlement by Midas
611700200529**  TMMP  - Array of TIMESTAMP
6118002005290001-01-01-00.00.00.000000
