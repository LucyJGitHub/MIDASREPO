     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Generate a/c keys - posn settlemts')          *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE2300  - GENERATE A/C KEYS - POSITION SETTLEMENTS           *
     F*                                                               *
     F*  Function: Generate Account Keys from authorised Position     *
     F*   (COB)    Settlements, in respect of amounts due on client   *
     F*            and depot holdings                                 *
     F*                                                               *
     F*  Called by: SEC0604A - Generate A/C Keys- Position Settlement *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. 215959             Date 21Mar16               *
      *  Prev Amend No. CER071             Date 01Aug16               *
      *                 CER070             Date 19Aug14               *
      *                 CLE134             Date 01Aug12               *
      *                 AR942839A          Date 16Apr12               *
      *                 AR864714           Date 17Nov11               *
      *                 CSW210             Date 04May10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26839           Date 05Jan10               *
      *                 CER045             Date 20Jul09               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23123           Date 09Mar09               *
      *                 BUG22911           Date 17Feb09               *
      *                 CER048             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247782A            Date 07Jun07               *
      *                 247966             Date 23May07               *
      *                 247782             Date 15May07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 17May06               *
      *                 CSD027             Date 09Dec05               *
      *                 235226A            Date 07Sep05               *
      *                 235226             Date 07Sep05               *
      *                 234715             Date 31Aug05               *
      *                 234664             Date 15Sep05               *
      *                 235709             Date 26Aug05               *
      *                 235174             Date 27Jul05               *
      *                 235141             Date 22Jul05               *
      *                 234635             Date 04Jul05               *
      *                 233710             Date 06Jun05               *
      *                 CSE071             Date 19Jul05               *
      *                 228045             Date 08Jul04               *
      *                 225599             Date 10Mar04               *
      *                 223108             Date 04Dec03               *
      *                 220547             Date 20Aug03               *
      *                 219490             Date 24Jul03               *
      *                 CGP001             Date 14Oct03               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 194195             Date 15Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 195362             Date 10Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 183665             Date 06Mar01               *
      *                 188794             Date 19Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 14Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 173004             Date 09Jun00               *
      *                 161794             Date 27Dec99               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CPB001             Date 18Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 151544             Date 31DEC98               *
      *                 CEU017             Date 03Avr98               *
      *                 CSE007             Date 03Feb98               *
     F*                 115469             DATE 23SEP97               *
     F*                 CAC002             Date 12Sep96               *
     F*                 088939             Date 19Aug96               *
     F*                 091407             Date 13Aug96               *
     F*                 101925             DATE 12APR96               *
     F*                 094232             DATE 06OCT95               *
     F*                 087178             DATE 15JUN95               *
     F*                 046386             DATE 29NOV94               *
     F*                 S01486             DATE 21NOV94               *
     F*                 S01496             DATE 15JUL94               *
     F*                 S01509             DATE 27OCT94               *
     F*                 S01512             DATE 10AUG94               *
     F*                 065461             DATE 08AUG94               *
     F*                 067406             DATE 25FEB94               *
     F*                 S01447             DATE 26NOV93               *
     F*                 S01446             DATE 26NOV93               *
     F*                 055942             DATE 27MAY93               *
     F*                 052254             DATE 10JAN94               *
     F*                 S01401             DATE 16JUN93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E37532             DATE 24MAR92               *
     F*                 E37241             DATE 24MAR92               *
     F*                 S01220             DATE 12NOV90               *
     F*                 S01117             DATE 02NOV90               *
     F*                 S01269             DATE 24OCT90               *
     F*                 E21244             DATE 26FEB90               *
     F*                 E21245             DATE 26FEB90               *
     F*                 E20651             DATE 30JAN90               *
     F*                 E19975             DATE 23NOV89               *
     F*                 E19770             DATE 25OCT89               *
     F*                 E18803             DATE 17AUG 89              *
     F*                 E16359             DATE 27/06/89              *
     F*                 E16776             DATE 08/03/89              *
     F*                 E15685             DATE 20/10/88              *
     F*                 E15687             DATE 20/10/88              *
     F*                 E15825             DATE 19/10/88              *
     F*                 E15430             DATE 28/09/88              *
     F*                 E15329             DATE 22/09/88              *
     F*                 E14884             DATE 08/09/88              *
     F*                 E14723             DATE 07/09/88              *
     F*                 E14840             DATE 06/09/88              *
     F*                 E14888             DATE 01/09/88              *
     F*                 E14713             DATE 16/08/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  215959 - Truncation error on event amount in SE2450P3.       *
      *           Recompiled due to changes in PF/SEKEYD.             *
      *         - Applied for MD-37439.                               *
      *  CER071 - BAIS - Legal Form field (Recompile)                 *
      *  CER070 - BuBa Reporting / BAIS V.1.16.0 (Recompile)          *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  AR942839A - No movement is posted in Stamp Tax Movement      *
      *              enquiry for Position Settlements                 *
      *  AR864714 - No Movements is posted for position settlement    *
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26839 - JA1_Threshold limit of the main joint customer was*
      *             utilized by the member                            *
      *  CER045 - German Features - Reporting Bundesbank (Recompile)  *
      *  CER054 - German Features - Church Tax                        *
      *  BUG23123 - Report: Does not show Retail Account Number       *
      *                     Date is not Midas Standard Date           *
      *                     Period should be actual int. calc. period *
      *                     Secondary Tax amount is not printed       *
      *                     Added field TSSLID                        *
      *                     (Recompile)                               *
      *  BUG22911 - Changes for Correct Tax Calculation               *
      *  CER048 - German Features - Taxes                             *
     F*  247782A- Position settlement will be also posted if EVCD     *
     F*           greater or equal to PSVL if S01512 not 'on'         *
      *  247966 - Increment field IREC by 1 if RECI <> '*' when       *
      *           features S01496, CSE007 and CEU017 are OFF.         *
     F*  247782 - Position settlement will be also posted if value    *
     F*           date reached and also S01512 not 'active'.          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  235226A- For ET Keys, if tax Ccy equal Base Ccy, keep Event  *
      *           amount for the Base Ccy Equivalent, otherwise lost  *
      *           of precision                                        *
      *  235226 - Consider tax rates of the Joint A/c members.        *
      *  234715 - Correction to fix 225599.                           *
      *  234664 - Failed component SEC0604A. DB erorr 30 occurred     *
      *           due to blank 'tax currency'.  Instead of A4TXCY,    *
      *           move the value of output field @@TXCY to TXCY.      *
      *  235709 - Wrong tax amount on Joint Account.                  *
      *  235174 - Trade a/c keys do not consider Joint A/c country.   *
      *  235141 - Incorrect currency code for US Treaty Withholding   *
      *           tax                                                 *
      *  234635 - Incorrect amount in 'ET' and 'NI' key               *
      *  233710 - Generation of position settlement cust income and   *
      *           account key                                         *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  228045 - Review coding of 225599 as Foob in SE2580           *
      *           and RECI not update in POSETD                       *
      *  225599 - Deletion of a position settlement (not authorised   *
      *           and not posted) will generate account keys and then *
      *           will post reversal of Transitory accounts amounts   *
      *  223108 - Settlement amount is negative after COB. Reversal   *
      *           of sign should only be for account key postings.    *
      *  220547 - Reversal processing. Review the fix 219490.         *
      *  219490 - Settlement amount sign of reversed position sett is *
      *           is also reversed. Fix is to reverse the actual amt. *
      *  CGP001 - Global Processing.                                  *
      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
      *           Information                                         *
      *  194195 - Incorrect number of decimal places used when nominal*
      *           currency is not equal to settlement currency.       *
      *  195362 - Account keys generated with missing country code.   *
      *           Ensure correct value of CSE023 for execution of     *
      *           correct subroutine.                                 *
      *  183665 - Posting for Position Settlement for DEM shows amount*
      *           in EUR. Amount should be converted if nominal ccy   *
      *           differs from due currency. Applied fix 162379. Also *
      *           added code to check if NMCY NE BCCY for base ccy amt*
      *  188794 - Country of Treaty Tax Code not in A/C Key.          *
      *  CSE023 - Treaty Withholding Tax                              *
     F*  173004 - Condition coupon payment sign on the client's       *
     F*           classification.                                     *
      *  161794 - Only Nostro Settlements should be forward dated if  *
      *           value day falls on a holiday for settlement ccy.    *
     F*  CPB001 - 'Private Banking' Module                            *
      *  151544 - USE SETTLEMENT AMOUNT IN SETTLEMENT CURRENCY TO     *
      *           BASE CURRENCY EQUIVALENT AMOUNT                     *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*  CSE007 - Corporate Actions                                   *
     F*  115469 - Settlement amount for short position should be      *
     F*           negative.                                           *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*           If Analytical Accounting is available, generate a   *
     F*           new margin account key and define the profit centre *
     F*           for each posting.                                   *
     F*  088939 - If due date read is a holiday, process it only if   *
     F*           next working day is less than or equal to run date. *
     F*  091407 - Position settlement account keys posted to suspense *
     F*           rather than settlement account.                     *
     F*  101925 - Settlement amount is posted gross - reinstate the   *
     F*           code that subtracts the charge and commission       *
     F*           amounts from nominal ccy equivalent.                *
     F*  094232 - Nominal currency equivalent is in settlement ccy    *
     F*  087178 - Remove computation of settlement amount, and use    *
     F*           PSAT from file which already has charges, commis-   *
     F*           sions and taxes added to or deducted from it.       *
     F*  046386 - Allow cross portfolio position settlements          *
     F*  S01486 - Incorporation of PM Enhancements (S01313)           *
     F*           048449 included                                     *
     F*  S01496 - Incorporation of Jyske Enhancements (S10982),       *
     F*           (S10978) and (S10985).                              *
     F*  S01509 - Value currency to be currency of issuer of payments *
     F*  S01512 - Add value date to Position Settlements              *
     F*  065461 - Only output the A/C keys if the position settlement *
     F*           generated date is not the run date to prevent the   *
     F*           keys to be generated on the wrong date.             *
     F*  067406 - Use rates off POSETD record rather than Spot Rate.  *
     F*           Also reduce accesses to TABTG10.                    *
     F*  S01447 - Withholding Tax amendment                           *
     F*           Generate Position Settlement key net of tax paid.   *
     F*           Generate tax keys for various types of tax,         *
     F*           ('WD', 'WN', 'WR' and 'WX').                        *
     F*  S01446 - Customer Commissions (Courtage) amendment           *
     F*           Use Charge Code Group on account key,               *
     F*           if Autocharging is on.                              *
     F*  055942 - OUTPUT DEPOT CUSTOMER NUMBER ON KEYS                *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*          - Recompiled due to changes to files.                *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*          - Recompiled due to changes to files.                *
     F*  E37532 - Negative account keys should not have negative      *
     F*           amounts too                                         *
     F*  E37241 - Last Change Date and Type on POSETD overwritten     *
     F*  S01220 - STRATEGIC RISK MANAGEMENT                           *
     F*           Recompiled over changed PF/SECTYD                   *
     F*  S01117 - MULTI-BRANCHING                                     *
     F*  S01269 - TRADE AUTHORISATION: RECOMPILED FOR CHANGE TO FILE  *
     F*           TABSE                                               *
     F*  E21244 - INCORRECT AMOUNTS ON BASE CURRENCY EQUIV.POSTINGS   *   E21244
     F*  E21245 - DO NOT OUTPUT BOOK TO ACCOUNT KEYS                  *   E21245
     F*  E20651 - DB ERROR NUMBERS USED IN MORE THAN ONE PLACE.       *   E20651
     F*           NEW ERROR NUMBERS AS FOLLOWS:                       *   E20651
     F*           DB ERROR 10 -> 12                                   *   E20651
     F*           DB ERROR 10 -> 13                                   *   E20651
     F*  E19975 - KCUST and ISSR shouldn't be zeroized before writing *   E19975
     F*           SEKEYD as  issuer and depot cust nos are needed for *   E19975
     F*           account keys with posting ref 4 and 5.              *   E19975
     F*  E19770 - REQUIRES ISSUER CUSTOMER TO BE AVAILABLE FOR        *   E19770
     F*           POSTING REFERENCE 4 FOR THE FOLLOWING:-             *   E19770
     F*           1) IIIS_D______MVN___DI  2) IIIS_D______MVN___PP    *   E19770
     F*           3) IIIS_D______MVN___MR  4) IIIS_D______MVN___CV    *   E19770
     F*  E18803 - SET ACCOUNT KEY SEQUENCE NO TO ZERO TO ALLOW FOR    *   E18803
     F*           MULTI-BRANCH SYSTEMS.                               *   E18803
     F*  E16359 - POSITION SETTLEMENT A/C KEYS ARE CREATED WITH A     *   E16359
     F*           BLANK DISCRETIONARY INDICATOR.                      *   E16359
     F*  E16776 - CHANGE INPUT FILE TO USE VERSION BUILT OVER ONE     *   E16776
     F*           MEMBER ONLY.                                        *   E16776
     F*  E15685 - TO TAKE MARKET INDICATOR FROM SECURITY.             *   E15685
     F*  E15687 - MAKE AMOUNT POSITIVE FOR 'AMCD' - 'CP,CR,FP,FR'     *   E15687
     F*  E15825 - MATURED RECORDS SHOULD BE OMITTED FROM RECORD       *   E15825
     F*           COUNT.                                              *   E15825
     F*  E15430 - CONVERTIBLE INDICATOR MUST BE 'Y' OR ' ' ON         *   E15430
     F*           ACCOUNT KEYS                                        *   E15430
     F*  E15329 - CALCULATION OF SIGNS FOR EVENT AMOUNTS AMENDED      *   E15329
     F*           ALLOWING FOR PORTFOLIO CLIENTS OR DEPOTS            *   E15329
     F*  E14884 - POSETD RECORD ID UPDATED TO 'M' (MATURED) IF        *   E14884
     F*           POSITION SETTLEMENT HAS BEEN ACTIONED               *   E14884
     F*  E14723 - INCORRECT SET UP OF ACCOUNT KEY ACCORDING TO        *.  E14723
     F*           DISCRETIONARY INDICATOR.                            *   E14723
     F*  E14840 - AUDIT LIST SHOULD BE PRINTED WHETHER OR NOT FILE    *   E14840
     F*           CONTROLS BALANCE.                                   *   E14840
     F*  E14888 - INCORRECT KEYS GEN. FOR POSITION ON POS SETTLEMENTS *   E14888
     F*  E14713 - KEY FOR DEPOT MOVEMENTS SHOULD HAVE AN 'X' IN       *   E14713
     F*           POSITION 6 REGARDLESS OF DISCRETIONARY INDICATOR.   *   E14713
     F*                                                               *
     F*****************************************************************
     F*
     F*POSET   IF  E           K        DISK
     F***POSET   UF  E           K        DISK         KINFDS POSDS E14884E16776
     FPOSET1  UF  E           K        DISK         KINFDS POSDS          E16776
     F                                              KINFSR POSSR          E14884
     FPOSETDY2IF  E           K        DISK                                                   CGL020
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F/COPY WNCPYSRC,SE2300F002
     F            CLINTCBF                          KIGNORE
     F/COPY WNCPYSRC,SE2300F003
     F            CLINTCCF                          KIGNORE
     F*           CLINTSEF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     FSECTY   IF  E           K        DISK
     FSECOATL0IF  E           K        DISK                               CSE007
     FSESWHTL0IF  E           K        DISK                               S01446
     F*POSETA  IF  E                    DISK
     FPOSETA  UF  E           K        DISK         KINFDS PAUDS          E14884
     F                                              KINFSR PAUSR          E14884
     FSEKEYD  O   E           K        DISK         KINFDS SKDDS
     F                                              KINFSR SKDSR
     FSEKEYA  O   E           K        DISK         KINFDS SKADS
     F                                              KINFSR SKASR
     FSE2300AUO   E                    PRINTER
     FTABSE   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F            TABTB10F                          KIGNORE               S01117
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICD SE    TABTB36F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F* CCY       TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETAF                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********** TABLETJF                          KIGNORE               S01117
     F            TABLETLF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETKF                          KIGNORE
     F            TABLETPF                          KIGNORE
     FCPOSN   IF  E           K        DISK                                                   233710
     FSDACUSL1IF  E           K        DISK                                                   233710
     FSDNAHOL1IF  E           K        DISK                                                   233710
     FSDJACCLBIF  E           K        DISK                                                   233710
     FSDCSINPDO   E           K        DISK                                                   233710
     F/COPY WNCPYSRC,SE2300F001
     F*
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F  I N D I C A T O R S                   *
     F*                                                               *
     F*   60 - PROCESS AMEND S01496                                   *   S01496
     F*   70 - Search (CHAIN) Indicator of POSETDY2                   *                       CGL020
     F*   80 - ERROR ON CHAIN                                         *
     F****89***END*OF*FILE*ON*POSET                                   *   E16776
     F*   89 - END OF FILE ON POSET1                                  *   E16776
     F*90-99 - USED IN Z-SUBROUTINES                                  *
     F*                                                               *
     F*   U7 - DATABASE ERROR                                         *
     F*   U8 - DATABASE ERROR                                         *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  I N D E X   T O   S U B R O U T I N E S                      *
     F*                                                               *
     F*   FIRST  - ACCESSES ICD 1,2 AND SE                            *
     F*   WRITED - SETS UP COMMON FIELDS AND OUTPUTS KEY TO SEKEYD    *
     F*   AUDIT  - OUTPUTS CONTROL REPORT                             *
     F*   P01    - SUBROUTINE TO GENERATE AMOUNT DUE KEY              *
     F*   P02    - SUBROUTINE TO GENERATE CHARGE & COMMISSION KEYS    *
     F*   P03    - SUBROUTINE TO GENERATE SETTLEMENT AMOUNT KEY       *
     F*   WTKEYS - SUBROUTINE TO GENERATE WITHHOLDING TAX KEYS        *   S01447
     F*   CLEAR  - SUB TO CLEAR FIELDS BEFORE GENERATING RECORD       *
     F*                                                               *
     F****ZSYSTM******-*ACCESSES*ICD*1************************************S01117
     F*   ZICD2  - ACCESSES ICD 2                                     *
     F*   ZICDSE - ACCESSES ICD FOR SE                                *
     F*   ZCONV  - SUBROUTINE TO CONVERT AND AMOUNT FROM ONE          *
     F*            CURRENCY TO ANOTHER                                *
     F*   ZHASH  - TO CALCULATE HASH VALUE OF ACCOUNT KEYS            *
     F*   SKDSR  - ERROR ROUTINE                                      *
     F*   SKASR  - ERROR ROUTINE                                      *
     F*   *PSSR  - DATABASE ERROR HANDLING SUBROUTINE                 *   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     F/COPY WNCPYSRC,SE2300F004
     E/COPY ZSRSRC,ZHASHZ1
     E/COPY ZSRSRC,ZPOWERZ1
     E/COPY ZSRSRC,ZHOLE                                                  088939
     E                    CPY@    1   1 80
      /EJECT
     IPOSETDF                                                             E37241
     I              RECI                            PRECI                                     225599
     I              LCD                             PLCD                  E37241
     I              CHTP                            PCHTP                 E37241
     I              TNLU                            PTNLU                 E37241
     I              PTFR                            RNPTFR                S01486
     I/COPY ZSRSRC,ZHASHZ2
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR SEKEYD ACCOUNT KEY
     I*
     I                                        1  20 ACKY
     I                                        1   3 INVT
     I                                        4   4 EVTP
     I                                        5   5 TRTP
     I                                        6   6 PORT
     I                                        7   8 BOOK
     I                                        9   9 PSBS
     I                                       10  10 FIL1
     I                                       11  12 CGTP
     I                                       13  13 MRKT
     I                                       14  14 CNVI
     I                                       15  15 NEGI
     I************                           16  18 FIL3                  S01447
     I                                       16  16 FIL1B                 S01447
     I                                       17  18 COTA                  S01447
     I                                       19  20 AMCD
     I*
     I            DS
     I*
     I* DATA STRUCTURE FOR TABLE FILE KEY
     I*
     I                                        1  12 TKEY
     I                                        1   20RECT
     I                                        3  10 ZZ008
     I                                       11  120RCDE
     I                                        3   8 ZZ006
     I                                        9  11 RCCY
     I                                       12  12 ZZ001
     I*
     I* DATA STRUCTURES FOR RPG 01021 ERROR HANDLING
     I*
     ISKDDS       DS                            366
     I                                     *STATUS  STSSKD
     I*
     ISKADS       DS
     I                                     *STATUS  STSSKA
     I*                                                                   E14884
     IPOSDS       DS                                                      E14884
     I                                     *STATUS  STSPOS                E14884
     I*                                                                   E14884
     IPAUDS       DS                                                      E14884
     I                                     *STATUS  STSPAU                E14884
     I*
     I*DA********UDS                            256                       S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770 BASE                 S01117
     I*
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     IRUNDT       DS                                                      S01117
      ** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     ISDCURR    E DSSDCURRPD                                              183665
      *                                                                   183665
      ** Currency details                                                 183665
      *                                                                   183665
     ISDCTRY    E DSSDCTRYPD                                                                  233710
      *                                                                                       233710
      ** Country details                                                                      233710
      *                                                                                       233710
     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
     ISDBANK    E DSSDBANKPD                                              S01117
     I              BJURPT                          TITL                  S01117
     I**  External DS for Switchable Features file                        S01446
     ISCSARD    E DSSCSARDPD                                              S01446
     I*                                                                   S01486
     I@MMOD     E DSSDMMODPD                                              S01486
     I** Dummy record format for access to Modules File                   S01486
     I*                                                                   CAC002
     ISDSTRD    E DSSDSTRDPD                                              CAC002
     I**  Securities Trading Details                                      CAC002
     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
      ** Data structure for Tax Parameter File                                              BUG22911
      *                                                                                     BUG22911
     I*                                                                   S01486
     I**  External DS for Charge Types file                               S01446
     ISECGT     E DSSECGT                                                 S01446
     I              RECI                            RECI1                 S01446
     I              LCD                             LCD1                  S01446
     I              CHTP                            CHTP1                 S01446
     I              TNLU                            TNLU1                 S01446
     I              PRFC                            PRFC1                 CAC002
     I              ZONE                            ZONE1                                     CGP001
     I** DATA STRUCTURE FOR ACCESS OBJECTS, SHORT DATA STRUCTURE          S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I*
     I** DATA STRUCTURE FOR ACCESS OBJECTS, LONG DATA STRUCTURE           S01446
     IDSSDY     E DSDSSDY                                                 S01446
     I*                                                                   S01446
     I/COPY WNCPYSRC,SE2300I001
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                                       CGL020
     I** Counterparty Key for POSETDY2                                                        CGL020
     I            DS                                                                          CGL020
     I**********                              1   60KPCPY                              CGL020 CSD027
     I                                        1   6 KPCPY                                     CSD027
     I*                                                                                       CGL020
     I** Counterparty Parameter for ZAAMLSETSE                                                CGL020
     I            DS                                                                          CGL020
     I**********                              1   60PCTRP                              CGL020 CSD027
     I                                        1   6 PCTRP                                     CSD027
     I*                                                                   088939
     I** Securities Settlement Fields Extractor Program Name                                  CGL020
     I              'ZAAMLSETSE'          C         SETSE                                     CGL020
     I*                                                                                       CGL020
      ** Constant for Instrument Reference                                                    233710
     I              ' - Coupon'           C         WINST1                                    233710
     I              ' - Dividend'         C         WINST2                                    233710
     I              ' - Maturity'         C         WINST3                                    233710
     I              ' - Mortgage Payment' C         WINST4                                    233710
      *                                                                                       233710
     I/COPY ZSRSRC,ZHOLI                                                  088939
      /EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
     C* KEY LISTS FOR CHAINING TO :-
     C*     TABTB36
     C*
     C           TABKEY    KLIST
     C                     KFLD           TKEY
     C*
     C*     SECURITIES
     C*
     C           SECKEY    KLIST
     C                     KFLD           PSSH
     C*
     C*     CLINTSE
     C*
     C           CLIKEY    KLIST
     C                     KFLD           PCPY
     C*                                                                                       CGL020
     C*     POSETDY2                                                                          CGL020
     C*                                                                                       CGL020
     C           KPSTES    KLIST                                                              CGL020
     C                     KFLD           KPBCA   3                                           CGL020
     C                     KFLD           KPSSH  10                                           CGL020
     C                     KFLD           KPCPY                                               CGL020
     C                     KFLD           KPDUD   50                                          CGL020
     C                     KFLD           KPEVT   2                                           CGL020
     C*                                                                                       CGL020
      *                                                                                       233710
      ** CPOSN                                                                                233710
      *                                                                                       233710
     C           KCPOS     KLIST                                                              233710
     C                     KFLD           PBCA                                                233710
     C                     KFLD           PSSH                                                233710
     C                     KFLD           PCPY                                                233710
     C/COPY WNCPYSRC,SE2300C001
     C*
     C* PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE2300'  DBPGM
     C                     OUT  LDA                                       S01117
      *                                                                   S01496
      **  Access SAR details file to see if JYSKE Enhcmts is installed.   S01496
      *                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM '       ' @RTCD                           S01496
     C                     PARM '*VERIFY' @OPTN                           S01496
     C                     PARM 'S01496'  WSARD   6                       S01496
      *                                                                   S01496
     C           @RTCD     IFEQ *BLANK                                    S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C                     MOVE *ON       *IN60                           S01496
     C                     ENDIF                                          S01496
      *                                                                   CSE007
      **  Access SAR details file to see if Corporate Action installed.   CSE007
      *                                                                   CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM '       ' @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  WSARD   6                       CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANK                                    CSE007
     C                     MOVE 'Y'       CSE007  1                       CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE023
      **  Access SAR details file to see if CSE023 installed.             CSE023
      *                                                                   CSE023
     C                     CALL 'AOSARDR0'                                CSE023
     C                     PARM '       ' @RTCD                           CSE023
     C                     PARM '*VERIFY' @OPTN                           CSE023
     C                     PARM 'CSE023'  WSARD   6                       CSE023
      *                                                                   CSE023
     C           @RTCD     IFEQ *BLANK                                    CSE023
     C                     MOVE 'Y'       CSE023  1                       CSE023
     C                     ELSE                                           195362
     C                     MOVE 'N'       CSE023                          195362
     C                     ENDIF                                          CSE023
      *                                                                   CEU017
      **  Access SAR details file to see if Securities Redenomination     CEU017
      **  is installed                                                    CEU017
      *                                                                   CEU017
     C                     MOVE 'N'       CEU017  1                       CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM '       ' @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  WSARD   6                       CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANK                                    CEU017
     C                     MOVE 'Y'       CEU017                          CEU017
     C                     ENDIF                                          CEU017
      *                                                                                       CGL020
      ** Access SAR details to see if CGL020 is enabled.                                      CGL020
      *                                                                                       CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM *BLANKS   @RTCD                                               CGL020
     C                     PARM '*VERIFY' @OPTN                                               CGL020
     C                     PARM 'CGL020'  WSARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C           @RTCD     IFEQ *BLANKS                                                       CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     MOVE *BLANK    F1FFLG                                              CGL020
     C                     Z-ADD0         F1FVAL                                              CGL020
     C                     Z-ADD0         F1FPCT                                              CGL020
     C                     ELSE                                                               CGL020
      *                                                                                       CGL020
     C           @RTCD     IFNE '*NRF'                                                        CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     MOVELWSARD     DBKEY                                               CGL020
     C                     Z-ADD901       DBASE                                               CGL020
     C                     OUT  LDA                                                           CGL020
     C                     MOVE *ON       *INU7                                               CGL020
     C                     MOVE *ON       *INU8                                               CGL020
     C                     EXSR *PSSR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                     AR864714
      ** Check if CER049 - Stamp Tax is switch on                                           AR864714
      *                                                                                     AR864714
     C                     CALL 'AOSARDR0'                                                  AR864714
     C                     PARM *BLANKS   @RTCD                                             AR864714
     C                     PARM '*VERIFY' @OPTN                                             AR864714
     C                     PARM 'CER049'  WSARD                                             AR864714
      *                                                                                     AR864714
     C           @RTCD     IFEQ *BLANK                                                      AR864714
     C                     MOVE 'Y'       CER049  1                                         AR864714
     C                     ELSE                                                             AR864714
     C                     MOVE 'N'       CER049                                            AR864714
     C                     ENDIF                                                            AR864714
     C*
     C* CLEAR COUNTS AND WORKFIELDS
     C*
     C                     Z-ADD0         IREC
     C                     Z-ADD0         DREC    50                                          228045
     C                     Z-ADD0         OREC
     C                     Z-ADD0         MREC                            E14884
AW   C                     Z-ADD1         S
AW   C                     Z-ADD1         Z
     C*
     C*  FIRST CYCLE PROCESS
     C*
     C                     EXSR FIRST
     C*                                                                   S01117
     C           *INU7     IFEQ '1'                                       S01117
     C                     GOTO EAUDIT                                    S01117
     C                     END                                            S01117
     C*
     C*  READ FILE
     C*
     C**********           READ POSET                    89               E16776
     C                     READ POSET1                   89               E16776
     C/COPY WNCPYSRC,SE2300C017
     C*
     C*  DO UNTIL EOF OR ERROR
     C*
     C           *IN89     DOWEQ'0'
     C           *INU7     ANDEQ'0'
     C*
     C*  INCREMENT COUNT
     C*
     C** TRY TO GENERATE ACCOUNT KEY IF POSITION SETTLEMENT IS DELETED AND NOT                225599
     C** REVERSED - AKEY TO REVERSE POSTING ON TRANSITORY ACCOUNT                             225599
     C**    SO PROCESS RECORD IF RECI IS '*' AND DELETED TODAY.                               225599
     C**                                                                                      225599
     C**********           MOVE RECI      PRECI   1                                    219490 225599
     C********** RECI      IFNE '*'                                                           225559
     C********** RECI      ANDNE'M'                                                    E15825 225559
     C           PRECI     IFNE 'M'                                                           225599
     C/COPY WNCPYSRC,SE2300C037
     C*                                                                   S01496
     C**  If Jyske Enhancements feature is installed, reversed are        S01496
     C**  previously 'MATURED' so do not count them                       S01496
     C**  Same processing if Corporate Action is installed                CSE007
     C**  Same processing if Securities Redenomination is installed       CEU017
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*
     C           PRECI     IFEQ '*'                                                           228045
     C           PLCD      ANDEQRUND                                                          228045
     C                     ADD  1         DREC                                                225599
     C                     END                                                                228045
     C*
     C********** RECI      IFNE 'R'                                                    S01496 225599
     C           PRECI     IFNE 'R'                                                           225599
     C           PRECI     ANDNE'*'                                                           225599
     C                     ADD  1         IREC                            S01486
     C                     END                                            S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           PRECI     IFNE '*'                                                           247966
     C                     ADD  1         IREC    50
     C                     ENDIF                                                              247966
     C***********                                                         065461
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Process all records if Jyske Enhancements feature (S01496)      S01496
     C**  is installed.  If the feature is not installed, process only    S01496
     C**  those records with event type not equal to 'RC'.                S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           PEVT      ORNE 'RC'                                      S01496
     C**ONLY*PROCESS*RECORDS*WHERE*AUTHORITY*IND*=*'Y'********************065461
     C* ONLY PROCESS RECORDS WHERE AUTH.IND = 'Y' OR TO BE REVERSED065461 S01496
     C*                                                                   065461
     C** Only process records where authority Ind = 'Y' and the           065461
     C** position settlement generated date is not the run date.          065461
     C*                                                                   065461
     C** If S01512 is active, additional check of value date *LE event    S01512
     C** control date will be in effect                                   S01512
     C** or to be reversed                                                S01496
     C*
     C           PAUI      IFEQ 'Y'
     C********** RECI      ANDEQ'D'                                                    E14884 225599
     C           PRECI     ANDEQ'D'                                                           225599
     C           PDTG      ANDNERUND                                      065461
     C           PSVL      ANDLEWWECD                                     247782
     C           S01512    ANDEQ'N'                                       S01512
     C*                                                                   S01512
     C           PAUI      OREQ 'Y'                                       S01512
     C********** RECI      ANDEQ'D'                                                    S01512 225599
     C           PRECI     ANDEQ'D'                                                           225599
     C           PDTG      ANDNERUND                                      S01512
     C           PSVL      ANDLEWWECD                                     S01512
     C           S01512    ANDEQ'Y'                                       S01512
     C*
     C           PRECI     OREQ '*'                                                           225599
     C           PCHTP     ANDEQ'D'                                                           225599
     C           PLCD      ANDEQBJRDNB                                                        225599
     C           PDTG      ANDNE0                                                             225599
     C*
     C           SRPG      ORNE 'Y'                                       S01496
     C********** RECI      ANDEQ'R'                                                    S01496 225599
     C           PRECI     ANDEQ'R'                                                           225599
     C           S01496    ANDEQ'Y'                                       S01496
     C           SRPG      ORNE 'Y'                                       CSE007
     C********** RECI      ANDEQ'R'                                                    CSE007 225599
     C           PRECI     ANDEQ'R'                                                           225599
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           SRPG      ORNE 'Y'                                       CEU017
     C********** RECI      ANDEQ'R'                                                    CEU017 225599
     C           PRECI     ANDEQ'R'                                                           225599
     C           CEU017    ANDEQ'Y'                                       CEU017
     C**********           MOVE RECI      WWRECI  1                                    S01496 225599
     C**********           MOVE CHTP      WWCHTP  1                                    S01496 225599
     C**********           Z-ADDLCD       WWLCD   50                                   S01496 225599
     C                     MOVE PRECI     WWRECI  1                                           225599
     C                     MOVE PCHTP     WWCHTP  1                                           225599
     C                     Z-ADDPLCD      WWLCD   50                                          225599
     C*                                                                   088939
     C** Check if due date (or next working day after due date, if due    088939
     C** date is a holiday) is less than or equal to run date             088939
     C** before processing the record for a nostro settlement             088939
     C*                                                                   088939
     C                     Z-ADDPDUD      ZDAYNO                          088939
     C                     Z-ADD0         ZNRDYS                          088939
     C                     MOVE PSCU      ZCCY                            088939
     C                     EXSR ZFWDT                                     088939
     C*                                                                   088939
     C           ZDYNBR    IFLE BJRDNB                                    088939
     C           PSMT      ORNE 01                                        161794
     C           PSMT      ANDNE07                                        161794
     C           PSMT      ANDNE08                                        161794
     C/COPY WNCPYSRC,SE2300C028
     C*                                                                   088939
     C                     ADD  1         AREC    50
     C*
     C*  OBTAIN SECURITIES  RECORD
     C*
     C           SECKEY    CHAINSECTYDF              80
     C           *IN80     IFEQ '0'
     C           RECI      IFEQ '*'
     C                     SETON                     80
     C                     END
     C                     END
     C           *IN80     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SECTY'   DBFILE           *****************
     C                     MOVELPSSH      DBKEY            ** DB ERROR 04 **
     C                     Z-ADD4         DBASE            *****************
     C                     OUT  LDA                                       S01117
     C                     SETON                     U7U8
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*                                                                   067406
     C** Get Nominal Currency decimal places and M/D Indicator            067406
     C*                                                                   067406
     C                     MOVE *BLANK    ZZ006                           067406
     C                     MOVE '20'      RECT                            067406
     C                     MOVE 1         ZZ001                           067406
     C                     MOVE PNCY      RCCY                            067406
     C*                                                                   067406
     C           TABKEY    CHAINTABTG10F             80                   067406
     C           *IN80     IFEQ '1'                                       067406
     C           RECI      OREQ '*'                                       067406
     C           *LOCK     IN   LDA                                       067406
     C                     MOVE 'TABLE'   DBFILE           ***************067406
     C                     MOVELTKEY      DBKEY            ** DB ERROR 15 067406
     C                     Z-ADD15        DBASE            ***************067406
     C                     OUT  LDA                                       067406
     C                     SETON                     99U7U8               067406
     C                     EXSR *PSSR                                     067406
     C                     GOTO EAUDIT                                    067406
     C                     END                                            067406
     C*                                                                   067406
      **  Save Nominal Currency details                                   067406
     C*                                                                   067406
     C           *LIKE     DEFN CDP       UNOMDP                          067406
     C           *LIKE     DEFN MDIN      UNMDIN                          067406
     C                     Z-ADDCDP       UNOMDP                          067406
     C                     Z-ADDMDIN      UNMDIN                          067406
     C*
     C           *INU7     IFEQ '1'
     C                     GOTO EAUDIT
     C                     END
     C*
     C*  OBTAIN CLINTSE  RECORD
     C*
     C           CLIKEY    CHAINCLINTSEF             80
     C           *IN80     IFEQ '0'
     C           RECI      IFEQ '*'
     C                     SETON                     80
     C                     END
     C                     END
     C           *IN80     IFEQ '1'
     C                     MOVE *BLANKS   C1DI
     C                     END
     C*
     C*  PRODUCE NORMAL KEYS AND KEY FOR DELETION OF POST AFTER                               225599
     C*                                                                                       225599
     C           PRECI     IFNE '*'                                                           225599
     C*                                                                                       225599
     C*  PRODUCE AMOUNT DUE KEY
     C*
     C                     EXSR CLEAR
     C*                                                                   CSE007
     C                     MOVE *BLANKS   WWCOAT  1                       CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           PEVT      CHAINSECOATL0             80                   CSE007
     C           *IN80     IFEQ '0'                                       CSE007
     C*                                                                   CSE007
     C           MMPTYP    IFEQ 'DV'                                      CSE007
     C*                                                                   CSE007
     C*  Set Corporate Action Flag to 'I' (Income Events)                 CSE007
     C                     MOVE 'I'       WWCOAT                          CSE007
     C                     ELSE                                           CSE007
     C*                                                                   CSE007
     C*  Set Corporate Action Flag to 'O' (Others)                        CSE007
     C                     MOVE 'O'       WWCOAT                          CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C                     EXSR P01
     C*
     C*  IF CHARGE AMOUNT AND COMMISSION AMOUNT NOT BOTH ZERO
     C*  PRODUCE CHARGE & COMMISSION KEYS
     C*
     C/COPY WNCPYSRC,SE2300C002
     C           PCHA      IFNE 0
     C           PCAM      ORNE 0
     C                     EXSR CLEAR
     C                     EXSR P02
     C                     END
     C/COPY WNCPYSRC,SE2300C027
     C*                                                                   S01447
     C** If the Treaty Withholding Tax feature is On                      CSE023
     C** Check if Country of Treaty of Tax on Security Detail is equal    CSE023
     C** to *BLANK.                                                       CSE023
     C** If it is BLANK, check if need to do S01447 Withholding Tax.      CSE023
     C*                                                                   CSE023
     C           CSE023    IFEQ 'N'                                       CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           CRTT      ANDEQ*BLANK                                    CSE023
     C*                                                                   CSE023
     C*  If the Withholding Tax feature is on...                          S01447
     C*  If either the Tax Deducted at Source or the Tax Deducted at      S01447
     C*  Source - Refundable or the Tax Deducted by User are not zero     S01447
     C*  then generate keys for Withholding Tax                           S01447
     C*                                                                   S01447
     C           S01447    IFEQ 'Y'                                       S01447
     C           TASO      IFNE *ZERO                                     S01447
     C           TASR      ORNE *ZERO                                     S01447
     C           TAUS      ORNE *ZERO                                     S01447
     C                     EXSR CLEAR                                     S01447
     C                     EXSR WTKEYS                                    S01447
     C                     END                                            S01447
     C                     END                                            S01447
     C*                                                                   CSE023
     C                     ELSE                                           CSE023
     C*                                                                   CSE023
     C** If Country of Treaty Tax is non-blank, then generate             CSE023
     C** Treaty Withholding Tax Keys.                                     CSE023
     C*                                                                   CSE023
     C                     EXSR CLEAR                                     CSE023
     C                     EXSR WTTKYS                                    CSE023
     C*                                                                   CSE023
     C                     END                                            CSE023
      *                                                                                       233710
      ** Produce Keys for EU Tax                                                              233710
      *                                                                                       233710
     C           CGL031    IFEQ 'Y'                                                           233710
     C           SETX      ANDEQ'Y'                                                           233710
     C           TXNM      ANDNE0                                                             234664
     C                     EXSR SRTAXA                                                        233710
     C                     EXSR SRETAX                                                        233710
     C                     ENDIF                                                              233710
     C*
     C*  PRODUCE SETTLEMENT AMOUNT KEY
     C*
     C                     EXSR CLEAR
     C                     EXSR P03
     C*                                                                   E14884
     C*  UPDATE RECORD ID ON POSETD RECORD                                E14884
     C*                                                                   E14884
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01496
     C           WWRECI    IFEQ 'R'                                       S01496
     C                     MOVE 'Y'       SRPG                            S01496
     C**********           MOVE 'R'       RECI                                         S01496 228045
     C                     MOVE 'R'       PRECI                                               228045
     C                     ELSE                                           S01496
     C**********           MOVE 'M'       RECI                                         S01496 228045
     C                     MOVE 'M'       PRECI                                               228045
     C                     ENDIF                                          S01496
     C                     MOVE WWCHTP    CHTP                            S01496
     C                     Z-ADDWWLCD     LCD                             S01496
     C*                                                                   S01496
     C                     ELSE                                           S01496
     C**********           MOVE 'M'       RECI                                         E14884 228045
     C                     MOVE 'M'       PRECI                                               228045
     C                     ENDIF                                          S01496
     C                     UPDATPOSETDF                                   E14884
     C/COPY WNCPYSRC,SE2300C046
     C*                                                                   S01496
     C** For Reversal, RECI is changed from 'M' to 'R', and for trailer   S01496
     C** calculation, they are included in 'LIVE' Records                 S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01496
     C           WWRECI    IFNE 'R'                                       S01496
     C           WWRECI    ANDNE'*'                                                           228045
     C                     ADD  1         MREC                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ELSE                                           S01496
     C           WWRECI    IFNE '*'                                                           247966
     C                     ADD  1         MREC    50                      E14884
     C                     ENDIF                                                              247966
     C                     END                                            S01496
     C*
     C                     END                                            088939
     C*                                                                                       225599
     C* IF DELETION OF A POST GENERATE ACCOUNT KEY TO REVERSE AMOUNT                          225599
     C* GENERATED ON TRANSITORY ACCOUNT CODE                                                  225599
     C           PRECI     IFEQ '*'                                                           225599
     C           PCHTP     ANDEQ'D'                                                           225599
     C           PLCD      ANDEQBJRDNB                                                        225599
     C*                                                                                       225599
     C                     EXSR CLEAR                                                         225599
     C*                                                                                       225599
     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN SR. WRITED                                  225599
     C*                                                                                       225599
     C                     MOVE '1'       RVRS                                                225599
     C           PEVT      IFEQ 'CP'                                                          225599
     C                     MOVE 'C'       EVTP                                                225599
     C                     END                                                                225599
     C********** PEVT      IFEQ 'DI'                                                   225599 234715
     C           PEVT      IFEQ 'DV'                                                          234715
     C                     MOVE 'H'       EVTP                                                225599
     C                     END                                                                225599
     C           PEVT      IFEQ 'MT'                                                          225599
     C                     MOVE 'M'       EVTP                                                225599
     C                     END                                                                225599
     C           SNAC      IFEQ 'N'                                                           225599
     C           PAMD      ORGT 0                                                             225599
     C                     MOVE ' '       NEGI                                                225599
     C                     ELSE                                                               225599
     C                     MOVE 'N'       NEGI                                                225599
     C                     END                                                                225599
     C                     MOVE 'DI'      AMCD                                                225599
     C           PEVT      IFEQ 'MT'                                                          225599
     C                     MOVE 'CV'      AMCD                                                225599
     C                     END                                                                225599
     C                     Z-ADDPAMD      EVAM                                                225599
     C                     EXSR WRITED                                                        225599
     C                     END                                                                225599
     C                     END                                                                225599
     C*
     C                     END
     C                     END                                            S01496
     C                     END
     C*
     C*  READ NEXT RECORD
     C*
     C**********           READ POSET                    89               E16776
     C                     READ POSET1                   89               E16776
     C/COPY WNCPYSRC,SE2300C018
     C*
     C                     END
     C*
     C* OUTPUT CONTROL REPORT AND WRITE AUDIT RECORD
     C*
     C           EAUDIT    TAG                             ** EAUDIT **
     C*
     C                     EXSR AUDIT
     C*
     C                     SETON                     LR
     C*
     C*================================================================
     C*  P R O G R A M     E N D
     C*================================================================
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**SUBROUTINE*TO*ACCESS*ICD*1,2*AND*ICD*FOR*SE***********************S01117
     C**CALLS:*ZSYSTM,*ZICD2,*ZICDSE**************************************S01117
     C* SUBROUTINE TO ACCESS ICD 2, ICD FOR SE                            S01117
     C* CALLS: ZICD2, ZICDSE                                              S01117
     C*                                                               *
     C*****************************************************************
     C*
     C           FIRST     BEGSR                           ** FIRST **
     C***********                                                         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C***********                                                         S01117
     C**ERROR*IN*ZSYSTM***************************************************S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          MOVE '1'       *INU7                           S01117
     C***********          MOVE '1'       *INU8            ***************S01117
     C***********          Z-ADD1         DBASE            **DB ERROR 01**S01117
     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C*
     C                     EXSR ZICD2
     C*
     C* ERROR IN ZICD2
     C*
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD2         DBASE            ***************
     C                     MOVEL'TABLE'   DBFILE           **DB ERROR 02**
     C                     MOVELTKEY      DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C*
     C                     ELSE
     C*
     C                     EXSR ZICDSE
     C*
     C* ERROR IN ZICDSE
     C*
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD3         DBASE            ***************
     C                     MOVEL'TABLE'   DBFILE           **DB ERROR 03**
     C                     MOVELTKEY      DBKEY            ***************
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*
      *In the data area RUNDAT                                            S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
      *                                                                   S01117
     C**   ACCESS BANK DETAILS, FOR TITLE                                 S01117
      *                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBANKPD'DBFILE                          S01117
     C                     MOVEL@OPTN     DBKEY            ***************S01117
     C                     MOVEL@OPTN     DBOPTN  7        * DBERROR 011 *S01117
     C                     Z-ADD11        DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     SETON                     U7U8                 S01117
     C                     EXSR *PSSR                                     S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C/COPY WNCPYSRC,SE2300C003
     C*                                                                   S01117
     C** Get Base Currency decimal places                                 S01117
     C*                                                                   S01117
     C                     MOVE *BLANK    ZZ006                           S01117
     C                     MOVE '20'      RECT                            S01117
     C                     MOVE 1         ZZ001                           S01117
     C                     MOVE BCCY      RCCY                            S01117
     C*                                                                   S01117
     C           TABKEY    CHAINTABTG10F             80                   S01117
     C           *IN80     IFEQ '1'                                       S01117
     C           RECI      OREQ '*'                                       S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************S01117
     C                     MOVELTKEY      DBKEY            ** DB ERROR 14 S01117
     C                     Z-ADD14        DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     SETON                     99U7U8               S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C** Save Base Currency Decimal Places for SR.ZCONV                   S01117
     C*                                                                   S01117
     C           *LIKE     DEFN CDP       BSCDP                           S01117
     C                     Z-ADDCDP       BSCDP                           S01117
     C                     END                                            S01117
     C                     END
     C*
     C                     END
     C                     END
      *                                                                                       233710
     C                     CALL 'AOCTRYR0'                                                    233710
     C                     PARM *BLANKS   PRTCD                                               233710
     C                     PARM '*KEY   ' POPTN                                               233710
     C                     PARM BJCNCD    PKEY    3                                           233710
     C           SDCTRY    PARM SDCTRY    DSSDY                                               233710
      *                                                                                       233710
     C           PRTCD     IFNE *BLANKS                                                       233710
     C           *LOCK     IN   LDA                                                           233710
     C                     MOVE 'SDCTRYPD'DBFILE                                              233710
     C                     MOVELPKEY      DBKEY                                               233710
     C                     Z-ADD31        DBASE                                               233710
     C                     OUT  LDA                                                           233710
     C                     MOVE *ON       *INU7                                               233710
     C                     MOVE *ON       *INU8                                               233710
     C                     EXSR *PSSR                                                         233710
     C                     ENDIF                                                              233710
     C*                                                                   S01486
     C**  Access SDMMODPD for Portfolio Management Indicator.             S01486
     C*                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM '        '@RTCD   7                       S01486
     C                     PARM '*FIRST  '@OPTN   7                       S01486
     C           @MMOD     PARM @MMOD     DSFDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C           BGTYLC    OREQ 'D'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD21        DBASE            ***************S01486
     C                     MOVE 'SDMMODPD'DBFILE           * DB ERROR 21 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     SETON                     U7U899               S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*                                                                   CAC002
     C**  Access Securities Trading details                               CAC002
     C*                                                                   CAC002
     C                     CALL 'AOSTRDR0'                                CAC002
     C                     PARM '*MSG   ' @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDSTRD    PARM SDSTRD    DSSDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD25        DBASE            ************   CAC002
     C                     MOVEL'SDSTRDPD'DBFILE           * DBERR 25 *   CAC002
     C                     MOVEL@OPTN     DBKEY            ************   CAC002
     C                     OUT  LDA                                       CAC002
     C                     SETON                     U7U8                 CAC002
     C                     EXSR *PSSR                                     CAC002
     C                     ENDIF                                          CAC002
      *                                                                   S01446
      **  Access Switchable features file for Customer Commission         S01446
      **  and Withholding Tax features                                    S01446
      *                                                                   S01446
     C                     MOVE 'N'       S01446                          S01446
     C                     CALL 'AOSARDR0'                                S01446
     C                     PARM '       ' @RTCD                           S01446
     C                     PARM '*VERIFY' @OPTN                           S01446
     C                     PARM 'S01446'  @SARD   6                       S01446
      *                                                                   S01446
     C           @RTCD     IFEQ *BLANK                                    S01446
     C                     MOVE 'Y'       S01446  1                       S01446
     C                     END                                            S01447
      *                                                                   S01447
     C                     MOVE 'N'       S01447                          S01447
     C                     CALL 'AOSARDR0'                                S01447
     C                     PARM '       ' @RTCD                           S01447
     C                     PARM '*VERIFY' @OPTN                           S01447
     C                     PARM 'S01447'  @SARD                           S01447
      *                                                                   S01447
     C           @RTCD     IFEQ *BLANK                                    S01447
     C                     MOVE 'Y'       S01447  1                       S01447
     C                     END                                            S01447
     C/COPY WNCPYSRC,SE2300C004
     C*
     C** Access SAR files to check if Position Settlements is active      S01512
     C*                                                                   S01512
     C                     MOVE 'N'       S01512                          S01512
     C                     CALL 'AOSARDR0'                                S01512
     C                     PARM '       ' @RTCD                           S01512
     C                     PARM '*VERIFY' @OPTN                           S01512
     C                     PARM 'S01512'  @SARD   6                       S01512
     C*                                                                   S01512
     C           @RTCD     IFEQ *BLANK                                    S01512
     C                     MOVE 'Y'       S01512  1                       S01512
     C                     END                                            S01512
     C*                                                                   S01512
     C** Set event control date to lesser of accrual profit date and      S01512
     C** date of next working day - 1 if S01512 is active                 S01512
     C*                                                                   S01512
     C           S01512    IFEQ 'Y'                                       S01512
     C           DNWD      SUB  1         WWCHK   50                      S01512
     C           APDA      IFLT WWCHK                                     S01512
     C                     Z-ADDAPDA      WWECD                           S01512
     C                     ELSE                                           S01512
     C                     Z-ADDWWCHK     WWECD   50                      S01512
     C                     END                                            S01512
     C                     ELSE                                           247782A
     C                     Z-ADDAPDA      WWECD                           247782A
     C                     END                                            S01512
     C*                                                                   S01512
      ** Check if CGL031 is installed                                                         233710
      *                                                                                       233710
     C                     CALL 'AOSARDR0'                                                    233710
     C                     PARM *BLANKS   PRTCD   7                                           233710
     C                     PARM '*VERIFY' POPTN   7                                           233710
     C                     PARM 'CGL031'  PSARD   6                                           233710
     C           SCSARD    PARM SCSARD    DSFDY                                               233710
      *                                                                                       233710
     C           PRTCD     IFEQ *BLANKS                                                       233710
     C                     MOVE 'Y'       CGL031  1                                           233710
     C                     ELSE                                                               233710
     C                     MOVE 'N'       CGL031                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     CALL 'AOSARDR0'                                                    CER048
     C                     PARM *BLANKS   PRTCD                                               CER048
     C                     PARM '*VERIFY' POPTN                                               CER048
     C                     PARM 'CER048'  PSARD                                               CER048
     C           SCSARD    PARM SCSARD    DSFDY                                               CER048
      *                                                                                       CER048
     C           PRTCD     IFEQ *BLANKS                                                       CER048
     C                     MOVE 'Y'       CER048  1                                           CER048
     C                     ELSE                                                               CER048
     C                     MOVE 'N'       CER048                                              CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CER048
     C                     CALL 'AOSARDR0'                                                    CER054
     C                     PARM *BLANKS   PRTCD                                               CER054
     C                     PARM '*VERIFY' POPTN                                               CER054
     C                     PARM 'CER054'  PSARD                                               CER054
     C           SCSARD    PARM SCSARD    DSFDY                                               CER054
      *                                                                                       CER054
     C                     MOVE 'N'       CER054                                              CER054
      *                                                                                       CER054
     C           PRTCD     IFEQ *BLANKS                                                       CER054
     C                     MOVE 'Y'       CER054  1                                           CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C           PRTCD     IFNE *BLANKS                                                       CER054
     C           PRTCD     ANDNE'*NRF'                                                        CER054
      *                                                                                       CER054
     C           *LOCK     IN   LDA                                                           CER054
     C                     MOVEL'SCSARDPD'DBFILE                                              CER054
     C                     MOVELPSARD     DBKEY                                               CER054
     C                     Z-ADD63        DBASE                                               CER054
     C                     OUT  LDA                                                           CER054
     C                     SETON                     U7U8                                     CER054
     C                     EXSR *PSSR                                                         CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
     C/COPY WNCPYSRC,SE2300C019
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* SUBROUTINE TO OUTPUT CONTROL REPORT                           *
     C*                                                               *
     C*****************************************************************
     C*
     C           AUDIT     BEGSR                           ** AUDIT **
     C*
     C* READ POSET AUDIT RECORD
     C*
     C           *INU8     IFEQ '0'
     C                     READ POSETAF                  99
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8            ***************
     C           *LOCK     IN   LDA                                       S01117
     C***********          Z-ADD10        DBASE            **DB*ERROR*10**E20651
     C                     Z-ADD12        DBASE            **DB ERROR 12**E20651
     C                     MOVEL'POSETA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C**********           END                                            E14884
     C**********           END                                            E14884
     C                     ELSE                                           E14884
     C*
     C* IF RECORD COUNT NOT EQUAL TO AUDIT COUNT
     C*
     C           NORE      IFNE IREC
     C                     SETON                     57U8
     C                     END
     C*                                                                   E14884
     C* IF NO ERROR IN FILE CONTROLS - UPDATE AUDIT RECORD                E14884
     C*                                                                   E14884
     C                     Z-ADDNORE      ONORE   50                      E14884
     C           NORE      SUB  MREC      NORE                            E14884
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C                     Z-ADDNORE      NLRB                            S01496
     C                     Z-ADD0         NOAM                                                225599
     C                     Z-ADD0         NODE                                                225599
     C                     END                                            S01496
     C           *INU8     IFEQ '0'                                       E14884
     C                     UPDATPOSETAF                                   E14884
     C                     END                                            E14884
     C*                                                                   E14884
     C                     END                                            E14884
     C                     END                                            E14884
     C*
     C* OUTPUT CONTROL REPORT
     C*
     C                     WRITEHEADR
     C********** *INU8     IFEQ '0'                                       E14840
     C           *INU7     IFEQ '0'                                       E14840
     C*
     C***********IREC      IFEQ 0                                         S01117
     C***********          WRITENONE                                      S01117
     C***********          ELSE                                           S01117
AW   C                     Z-ADDINT,Z     OHASH1
AW   C                     Z-ADDDEC,Z     OHASH2
     C                     WRITECONTROL
     C***********          END                                            S01117
     C*
     C                     ELSE
     C                     WRITEERROR
     C                     END
     C*
     C***********          WRITETRAIL                                     S01117
     C*
     C* WRITE SEKEYDA RECORD
     C*
     C           *INU8     IFEQ '0'
     C                     MOVE OREC      NORE
AW   C                     Z-ADDINT,Z     HRWN
AW   C                     Z-ADDDEC,Z     HRDC
     C                     WRITESEKEYAF
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* P01 - SUBROUTINE TO GENERATE AMOUNT DUE KEY                   *
     C*                                                               *
     C*****************************************************************
     C*
     C           P01       BEGSR                           ** P01    **
     C*
     C*  SET NEGATIVE IND
     C*
     C           NPAC      IFEQ 'N'
     C           PNMP      ORGE 0
     C                     MOVE ' '       NEGI
     C                     ELSE
     C                     MOVE 'N'       NEGI
     C                     END
     C*
     C*  SET AMOUNT CODE
     C*
     C           PEVT      IFEQ 'CP'
     C           PEVT      OREQ 'DV'
     C           WWCOAT    OREQ 'I'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           WWCOAT    OREQ 'I'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C                     MOVE 'DI'      AMCD
     C                     ELSE
     C           PEVT      IFEQ 'PP'
     C                     MOVE 'PP'      AMCD
     C                     ELSE
     C           PEVT      IFEQ 'MP'
     C                     MOVE 'MR'      AMCD
     C                     ELSE
     C           PEVT      IFEQ 'MT'
     C           PEVT      OREQ 'RC'                                      S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C                     MOVE 'CV'      AMCD
     C                     ELSE                                           CSE007
     C           WWCOAT    IFEQ 'O'                                       CSE007
     C           CSE007    ANDEQ'Y'                                       CSE007
     C           WWCOAT    OREQ 'O'                                       CEU017
     C           CEU017    ANDEQ'Y'                                       CEU017
     C                     MOVE 'CD'      AMCD                            CSE007
     C                     END                                            CSE007
     C                     END
     C                     END
     C                     END
     C                     END
     C*                                                                   CSE007
     C* IF POSITION SETTLEMENT GENERATED FROM A CORPORATE ACTION          CSE007
     C*                                                                   CSE007
     C           WWCOAT    IFEQ 'I'                                       CSE007
     C           WWCOAT    OREQ 'O'                                       CSE007
     C*                                                                   CSE007
     C* INCLUDE TRADE SUB-TYPE IN CORPORATE ACTION KEY                    CSE007
     C*                                                                   CSE007
     C           BVCOTA    IFEQ 'Y'                                       CSE007
     C                     MOVELMMTSUB    PSBS                            CSE007
     C                     MOVE MMTSUB    FIL1                            CSE007
     C                     ELSE                                           CSE007
     C                     MOVE *BLANKS   PSBS                            CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C*                                                                   E15329
     C* SET OTHER A/C KEY FIELDS RELEVENT TO THIS PROCESS
     C*                                                                   E15329
     C                     MOVE 'S'       EVTP
     C***********          Z-ADDPAMD      EVAM
     C*                                                                   E15329
     C           AMCD      IFEQ 'PP'                                      E15329
     C*                                                                   E15329
     C           PPRE      IFEQ 'P'                                       E15329
     C*                                                                   E15329
     C           C1DI      IFEQ 'S'                                       E15329
     C           C1DI      OREQ 'D'                                       E15329
     C                     Z-SUBPAMD      EVAM                            E15329
     C                     ELSE                                           E15329
     C                     Z-ADDPAMD      EVAM                            E15329
     C                     END                                            E15329
     C*                                                                   E15329
     C                     ELSE                                           E15329
     C*                                                                   E15329
     C           C1DI      IFEQ 'S'                                       E15329
     C           C1DI      OREQ 'D'                                       E15329
     C                     Z-ADDPAMD      EVAM                            E15329
     C                     ELSE                                           E15329
     C                     Z-SUBPAMD      EVAM                            E15329
     C                     END                                            E15329
     C*                                                                   E15329
     C                     END                                            E15329
     C*                                                                   E15329
     C                     ELSE                                           E15329
     C*                                                                   E15329
     C           PPRE      IFEQ 'P'                                       E15329
     C*                                                                   E15329
     C           C1DI      IFEQ 'S'                                       E15329
     C           C1DI      OREQ 'D'                                       E15329
     C                     Z-ADDPAMD      EVAM                            E15329
     C                     ELSE                                           E15329
     C                     Z-SUBPAMD      EVAM                            E15329
     C                     END                                            E15329
     C*                                                                   E15329
     C                     ELSE                                           E15329
     C*                                                                   E15329
     C           C1DI      IFEQ 'S'                                       E15329
     C           C1DI      OREQ 'D'                                       E15329
     C                     Z-SUBPAMD      EVAM                            E15329
     C                     ELSE                                           E15329
     C                     Z-ADDPAMD      EVAM                            E15329
     C                     END                                            E15329
     C*                                                                   E15329
     C                     END                                            E15329
     C*                                                                   E15329
     C                     END                                            E15329
     C*                                                                   E15329
     C                     MOVE PSMT      STLT                            091407
     C                     MOVE PSEA      STLA                            091407
      *                                                                   091407
     C                     EXSR WRITED
     C/COPY WNCPYSRC,SE2300C005
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* P02   - SUBROUTINE TO GENERATE CHARGE & COMMISSION KEYS       *
     C*                                                               *
     C*****************************************************************
     C*
     C           P02       BEGSR                           ** P02    **
     C/COPY WNCPYSRC,SE2300C020
     C*
     C*  SET AMOUNT CODE
     C*
     C           PEVT      IFEQ 'CP'
     C                     MOVEL'C'       EVTP
     C                     ELSE
     C           PEVT      IFEQ 'DV'
     C                     MOVEL'H'       EVTP
     C                     ELSE
     C           PEVT      IFEQ 'PP'
     C                     MOVEL'P'       EVTP
     C                     ELSE
     C           PEVT      IFEQ 'MP'
     C                     MOVEL'R'       EVTP
     C                     ELSE
     C           PEVT      IFEQ 'MT'
     C           PEVT      OREQ 'RC'                                      S01496
     C           S01496    ANDEQ'Y'                                       S01496
     C                     MOVEL'M'       EVTP
     C                     ELSE                                           CSE007
     C           WWCOAT    IFEQ 'I'                                       CSE007
     C           WWCOAT    OREQ 'O'                                       CSE007
     C                     MOVEL'X'       EVTP                            CSE007
     C                     END                                            CSE007
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*                                                                   CSE007
     C* IF POSITION SETTLEMENT GENERATED FROM A CORPORATE ACTION          CSE007
     C*                                                                   CSE007
     C           WWCOAT    IFEQ 'I'                                       CSE007
     C           WWCOAT    OREQ 'O'                                       CSE007
     C*                                                                   CSE007
     C* INCLUDE TRADE SUB-TYPE IN CORPORATE ACTION KEY                    CSE007
     C*                                                                   CSE007
     C           BVCOTA    IFEQ 'Y'                                       CSE007
     C                     MOVELMMTSUB    PSBS                            CSE007
     C                     MOVE MMTSUB    FIL1                            CSE007
     C                     ELSE                                           CSE007
     C                     MOVE *BLANKS   PSBS                            CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C*
     C* IF CHARGE AMOUNT NON ZERO GENERATE CHARGE A/C KEY
     C*
     C           PCHA      IFNE 0
     C*
     C* DETERMINE AMOUNT CODE DEPENDING ON SIGN OF CHARGE AND
     C* DISCRET IND.
     C*
     C           C1DI      IFEQ 'S'
     C           C1DI      OREQ 'D'
     C           PCHA      IFGT 0
     C                     MOVEL'FR'      AMCD
     C                     ELSE
     C                     MOVEL'FP'      AMCD
     C                     END
     C                     ELSE
     C           PCHA      IFGT 0
     C                     MOVEL'FP'      AMCD
     C                     ELSE
     C                     MOVEL'FR'      AMCD
     C                     END
     C                     END
     C*                                                                   S01446
     C* If Customer Commission feature is on and Autocharges is on,       S01446
     C* Or Analytical Accounting is installed,                            CAC002
     C* access the Charge Types file for the Group Charge Code            S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           AUMO      ANDEQ'Y'                                       S01446
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C                     CALL 'AOCHGTR0'                                S01446
     C                     PARM *BLANKS   @RTCD                           S01446
     C                     PARM '*KEY'    @OPTN                           S01446
     C                     PARM PNCY      @CCY    3                       S01446
     C                     PARM PCHC      @CCOM   2                       S01446
     C           SECGT     PARM SECGT     DSSDY                           S01446
      *                                                                   S01446
     C           @RTCD     IFNE *BLANK                                    S01446
     C           *LOCK     IN   LDA                                       S01446
     C                     MOVEL'SECGT'   DBFILE                          S01446
     C                     MOVE PCHC      WDBKY   6                       S01446
     C                     MOVELPNCY      WDBKY                           S01446
     C                     MOVELWDBKY     DBKEY            ***************S01446
     C                     Z-ADD17        DBASE            * DB ERROR 17 *S01446
     C                     OUT  LDA                        ***************S01446
     C                     SETON                     99U7U8               S01446
     C                     EXSR *PSSR                                     S01446
     C                     GOTO EAUDIT                                    S01446
     C                     ELSE                                           S01446
      *                                                                   CAC002
     C           S01446    IFEQ 'Y'                                       CAC002
     C           AUMO      ANDEQ'Y'                                       CAC002
     C                     MOVELGCCO      CGTP                            S01446
     C                     ELSE                                           CAC002
     C                     MOVELPCHC      CGTP                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      ** If Analytical Accounting is installed, define a Profit Centre.   CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
     C           S01446    IFEQ 'Y'                                       CAC002
     C           AUMO      ANDEQ'Y'                                       CAC002
      *                                                                   CAC002
      ** Access charges codes file for Group charge code.                 CAC002
      *                                                                   CAC002
     C                     CALL 'AOCHGTR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM PNCY      @CCY                            CAC002
     C                     PARM GCCO      @CCOM                           CAC002
     C           SECGT     PARM SECGT     DSSDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     MOVEL'SECGT'   DBFILE                          CAC002
     C                     MOVE GCCO      WDBKY                           CAC002
     C                     MOVELPNCY      WDBKY                           CAC002
     C                     MOVELWDBKY     DBKEY            ************   CAC002
     C                     Z-ADD26        DBASE            * DBERR 26 *   CAC002
     C                     OUT  LDA                        ************   CAC002
     C                     SETON                     99U7U8               CAC002
     C                     EXSR *PSSR                                     CAC002
     C                     GOTO EAUDIT                                    CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C           BOTR      IFEQ 'T'                                       CAC002
     C           BOTR      OREQ 'B'                                       CAC002
      *                                                                   CAC002
     C           C1DI      IFEQ 'S'                                       CAC002
     C           C1DI      OREQ 'D'                                       CAC002
     C                     MOVE PPFC      PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE BVSEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ELSE                                           CAC002
     C                     MOVE PRFC1     PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     END                                            S01446
     C                     ELSE                                           S01446
     C*
     C* SET OTHER FIELDS ON A/C KEY RELEVENT TO THIS PROCESS
     C*
     C*********************MOVELPBCD      BOOK                            E21245
     C                     MOVELPCHC      CGTP
     C                     END                                            S01446
     C/COPY WNCPYSRC,SE2300C006
     C                     Z-ADDPCHA      EVAM
     C/COPY WNCPYSRC,SE2300C021
     C*
     C* WRITE A/C KEY
     C*
     C           AMCD      IFEQ 'FP'                                      E15687
     C           AMCD      OREQ 'FR'                                      E15687
     C           EVAM      IFLT 0                                         E15687
     C                     Z-SUBEVAM      EVAM                            E15687
     C                     END                                            E15687
      *                                                                                       CGL020
      ** Set the Fee Fields if CGL020 is enabled.                                             CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDPCHA      F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     END                                            E15687
     C*
     C                     MOVE PSMT      STLT                            091407
     C                     MOVE PSEA      STLA                            091407
      *                                                                   091407
     C/COPY WNCPYSRC,SE2300C022
     C                     EXSR WRITED
     C/COPY WNCPYSRC,SE2300C007
     C                     END
     C*
     C* IF COMMISSION AMOUNT NON ZERO GENERATE CHARGE A/C KEY
     C*
     C           PCAM      IFNE 0
     C*
     C* DETERMINE AMOUNT CODE DEPENDING ON SIGN OF CHARGE AND
     C* DISCRET IND.
     C*
     C           C1DI      IFEQ 'S'
     C           C1DI      OREQ 'D'
     C           PCAM      IFGT 0
     C***********          MOVE 'FR'      AMCD                            E14888
     C                     MOVE 'CR'      AMCD                            E14888
     C                     ELSE
     C***********          MOVE 'FP'      AMCD                            E14888
     C                     MOVE 'CP'      AMCD                            E14888
     C                     END
     C                     ELSE
     C           PCAM      IFGT 0
     C***********          MOVE 'FP'      AMCD                            E14888
     C                     MOVE 'CP'      AMCD                            E14888
     C                     ELSE
     C***********          MOVE 'FR'      AMCD                            E14888
     C                     MOVE 'CR'      AMCD                            E14888
     C                     END
     C                     END
     C*                                                                   S01446
     C* If Customer Commission feature is on and Autocharges is on,       S01446
     C* Or Analytical Accounting is installed,                            CAC002
     C* access the Charge Types file for the Group Charge Code            S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           AUMO      ANDEQ'Y'                                       S01446
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C                     CALL 'AOCHGTR0'                                S01446
     C                     PARM *BLANKS   @RTCD                           S01446
     C                     PARM '*KEY'    @OPTN                           S01446
     C                     PARM PNCY      @CCY    3                       S01446
     C                     PARM PCCD      @CCOM   2                       S01446
     C           SECGT     PARM SECGT     DSSDY                           S01446
      *                                                                   S01446
     C           @RTCD     IFNE *BLANK                                    S01446
     C           *LOCK     IN   LDA                                       S01446
     C                     MOVEL'SECGT'   DBFILE                          S01446
     C                     MOVE PCCD      WDBKY   6                       S01446
     C                     MOVELPNCY      WDBKY                           S01446
     C                     MOVELWDBKY     DBKEY            ***************S01446
     C                     Z-ADD20        DBASE            * DB ERROR 20 *S01446
     C                     OUT  LDA                        ***************S01446
     C                     SETON                     99U7U8               S01446
     C                     EXSR *PSSR                                     S01446
     C                     GOTO EAUDIT                                    S01446
     C                     ELSE                                           S01446
      *                                                                   CAC002
     C           S01446    IFEQ 'Y'                                       CAC002
     C           AUMO      ANDEQ'Y'                                       CAC002
     C                     MOVELGCCO      CGTP                            S01446
     C                     ELSE                                           CAC002
     C                     MOVELPCCD      CGTP                            CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      ** If Analytical Accounting is installed, define a Profit Centre.   CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
     C           S01446    IFEQ 'Y'                                       CAC002
     C           AUMO      ANDEQ'Y'                                       CAC002
      *                                                                   CAC002
      ** Access charges codes file for Group charge code.                 CAC002
      *                                                                   CAC002
     C                     CALL 'AOCHGTR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM PNCY      @CCY                            CAC002
     C                     PARM GCCO      @CCOM                           CAC002
     C           SECGT     PARM SECGT     DSSDY                           CAC002
      *                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     MOVEL'SECGT'   DBFILE                          CAC002
     C                     MOVE GCCO      WDBKY                           CAC002
     C                     MOVELPNCY      WDBKY                           CAC002
     C                     MOVELWDBKY     DBKEY            ************   CAC002
     C                     Z-ADD27        DBASE            * DBERR 27 *   CAC002
     C                     OUT  LDA                        ************   CAC002
     C                     SETON                     99U7U8               CAC002
     C                     EXSR *PSSR                                     CAC002
     C                     GOTO EAUDIT                                    CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C           BOTR      IFEQ 'T'                                       CAC002
     C           BOTR      OREQ 'B'                                       CAC002
      *                                                                   CAC002
     C           C1DI      IFEQ 'S'                                       CAC002
     C           C1DI      OREQ 'D'                                       CAC002
     C                     MOVE PPFC      PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE BVSEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ELSE                                           CAC002
     C                     MOVE PRFC1     PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     END                                            S01446
     C                     ELSE                                           S01446
     C*
     C* SET OTHER FIELDS ON A/C KEY RELEVENT TO THIS PROCESS
     C*
     C*********************MOVE PBCD      BOOK                            E21245
     C                     MOVE PCCD      CGTP
     C                     END                                            S01446
     C/COPY WNCPYSRC,SE2300C008
     C                     Z-ADDPCAM      EVAM
     C/COPY WNCPYSRC,SE2300C023
     C*
     C* WRITE A/C KEY
     C*
     C           AMCD      IFEQ 'CP'                                      E15687
     C           AMCD      OREQ 'CR'                                      E15687
     C           EVAM      IFLT 0                                         E15687
     C                     Z-SUBEVAM      EVAM                            E15687
     C                     END                                            E15687
      *                                                                                       CGL020
      ** Set the Fee Fields if CGL020 is enabled.                                             CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE 'F'       F1FFLG                                              CGL020
     C                     Z-ADDPCAM      F1FVAL                                              CGL020
     C                     Z-ADD100       F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     END                                            E15687
     C*
     C                     MOVE PSMT      STLT                            091407
     C                     MOVE PSEA      STLA                            091407
      *                                                                   091407
     C/COPY WNCPYSRC,SE2300C024
     C                     EXSR WRITED
     C/COPY WNCPYSRC,SE2300C009
     C                     END
     C/COPY WNCPYSRC,SE2300C038
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* P03      -   SUBROUTINE TO GENERATE SETTLEMENT AMOUNT KEY     *
     C*                                                               *
     C*****************************************************************
     C*
     C           P03       BEGSR                           ** P03    **
     C/COPY WNCPYSRC,SE2300C034
     C*                                                                   CSE007
     C* IF POSITION SETTLEMENT GENERATED FROM A CORPORATE ACTION          CSE007
     C*                                                                   CSE007
     C           WWCOAT    IFEQ 'I'                                       CSE007
     C           WWCOAT    OREQ 'O'                                       CSE007
     C*                                                                   CSE007
     C* INCLUDE TRADE SUB-TYPE IN CORPORATE ACTION KEY                    CSE007
     C*                                                                   CSE007
     C           BVCOTA    IFEQ 'Y'                                       CSE007
     C                     MOVELMMTSUB    PSBS                            CSE007
     C                     MOVE MMTSUB    FIL1                            CSE007
     C                     ELSE                                           CSE007
     C                     MOVE *BLANKS   PSBS                            CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CAC002
      ** If Analytical Accounting is installed and the Margin amount is   CAC002
      ** not zero, generate Margin Amount key.                            CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           MAMT      ANDNE0                                         CAC002
     C                     MOVE 'MA'      AMCD                            CAC002
     C                     MOVE 'S'       EVTP                            CAC002
     C                     MOVELPSCU      EVCY                            CAC002
     C                     Z-ADDMAMT      EVAM                            CAC002
     C                     EXSR WRITED                                    CAC002
     C                     ENDIF                                          CAC002
     C*
     C*  SET AMOUNT DUE
     C*
     C***********          Z-ADDPAMD      KNCA                            E15329
     C*
     C           C1DI      IFEQ 'S'                                       E15329
     C           C1DI      OREQ 'D'                                       E15329
     C           PPRE      IFEQ 'P'                                       E15329
     C***********          Z-ADDPAMD      KNCA                     E15329 087178
     C***********          Z-ADDPSAT      KNCA                     087178 094232
     C                     Z-ADDPAMD      KNCA                            094232
     C                     ELSE                                           E15329
     C***********          Z-SUBPAMD      KNCA                     E15329 087178
     C***********          Z-SUBPSAT      KNCA                     087178 094232
     C                     Z-SUBPAMD      KNCA                            094232
     C                     END                                            E15329
     C                     ELSE                                           E15329
     C           PPRE      IFEQ 'R'                                       E15329
     C***********          Z-ADDPAMD      KNCA                     E15329 087178
     C***********          Z-ADDPSAT      KNCA                     087178 094232
     C                     Z-ADDPAMD      KNCA                            094232
     C                     ELSE                                           E15329
     C***********          Z-SUBPAMD      KNCA                     E15329 087178
     C***********          Z-SUBPSAT      KNCA                     087178 094232
     C                     Z-SUBPAMD      KNCA                            094232
     C                     END                                            E15329
     C                     END                                            E15329
     C***********                                                         E15329
     C**IF*CHARGE*AMOUNT*NON*ZERO*SUBTRACT*OF*ADD*TO*SETTLE*AMT**         E15329
     C***********PCHA      IFNE 0                                         E15329
     C***********                                                         E15329
     C**DETERMINE*AMOUNT*CODE*DEPENDING*ON*SIGN*OF*CHARGE*AND*            E15329
     C**DISCRET*IND.                                                      E15329
     C***********C1DI      IFEQ 'S'                                       E15329
     C***********C1DI      OREQ 'D'                                       E15329
     C***********PPRE      IFEQ 'P'                                       E15329
     C***********          SUB  PCHA      KNCA                            E15329
     C***********          ELSE                                           E15329
     C***********          ADD  PCHA      KNCA                            E15329
     C***********          END                                            E15329
     C***********          ELSE                                           E15329
     C***********PPRE      IFEQ 'P'                                       E15329
     C***********          SUB  PCHA      KNCA                            E15329
     C***********          ELSE                                           E15329
     C***********          ADD  PCHA      KNCA                            E15329
     C***********          END                                            E15329
     C***********          END                                            E15329
     C***********          END                                            E15329
     C***********                                                         E15329
     C**IF COMMISSION AMOUNT NON ZERO GENERATE COMMISSION A/C KEY         E15329
     C***********PCAM      IFNE 0                                         E15329
     C***********                                                         E15329
     C**DETERMINE AMOUNT CODE DEPENDING ON SIGN OF CHARGE AND             E15329
     C**DISCRET*IND.                                                      E15329
     C***********C1DI      IFEQ 'S'                                       E15329
     C***********C1DI      OREQ 'D'                                       E15329
     C***********PPRE      IFEQ 'P'                                       E15329
     C***********          SUB  PCAM      KNCA                            E15329
     C***********          ELSE                                           E15329
     C***********          ADD  PCAM      KNCA                            E15329
     C***********          END                                            E15329
     C***********          ELSE                                           E15329
     C***********PPRE      IFEQ 'P'                                       E15329
     C***********          SUB  PCAM      KNCA                            E15329
     C***********          ELSE                                           E15329
     C***********          ADD  PCAM      KNCA                            E15329
     C***********          END                                            E15329
     C***********          END                                            E15329
     C***********          END                                            E15329
     C***********          SUB  PCHA      KNCA                     E15329 087178
     C***********          SUB  PCAM      KNCA                     E15329 087178
     C***********                                                  S01447 087178
     C***If*Withholding*Tax*is*on*subtract*Tax*Amount*Deducted*at**S01447 087178
     C***Source*and*Tax*Amount*Deducted*by*User********************S01447 087178
     C***********                                                  S01447 087178
     C***********S01447    IFEQ 'Y'                                S01447 087178
     C***********          SUB  TASO      KNCA                     S01447 087178
     C***********          SUB  TAUS      KNCA                     S01447 087178
     C***********          END                                     S01447 087178
     C/COPY WNCPYSRC,SE2300C010
     C                     SUB  PCHA      KNCA                            101925
     C/COPY WNCPYSRC,SE2300C011
     C                     SUB  PCAM      KNCA                            101925
     C/COPY WNCPYSRC,SE2300C012
     C*                                                                   101925
     C** If Withholding Tax is on subtract Tax Amount Deducted at         101925
     C** Source and Tax Amount Deducted by User                           101925
     C**                                                                  101925
     C           S01447    IFEQ 'Y'                                       101925
     C                     SUB  TASO      KNCA                            101925
     C                     SUB  TAUS      KNCA                            101925
     C                     END                                            101925
     C*                                                                   S01447
     C           CGL031    IFEQ 'Y'                                                           234635
     C           SETX      ANDEQ'Y'                                                           234635
     C           PNCY      IFNE PSCU                                                          234635
     C           PAMD      SUB  TXNM      KNCA                                                234635
     C                     END                                                                234635
     C                     END                                                                234635
      *                                                                   183665
      ** If nominal currency is not equal to due currency, convert KNCA   183665
      *                                                                   183665
     C           NMCY      IFNE PNCY                                      183665
     C                     Z-ADDKNCA      ZAMTF                           183665
     C                     MOVE PNCY      ZCCYF                           183665
     C                     MOVE NMCY      ZCCYT                           183665
      *                                                                   183665
     C                     CALL 'AOCURRR0'                                183665
     C                     PARM '*DBERR'  @RTCD                           183665
     C                     PARM '*KEY   ' @OPTN                           183665
     C                     PARM PNCY      @AJCD   3                       183665
     C           SDCURR    PARM SDCURR    DSSDY                           183665
      *                                                                   183665
     C                     Z-ADDA6SPRT    ZRATEF                          183665
     C                     MOVE A6MDIN    ZMDINF                          183665
     C                     MOVE A6NBDP    ZCDPF                           183665
      *                                                                   183665
     C                     CALL 'AOCURRR0'                                183665
     C                     PARM '*DBERR'  @RTCD                           183665
     C                     PARM '*KEY   ' @OPTN                           183665
     C                     PARM NMCY      @AJCD                           183665
     C           SDCURR    PARM SDCURR    DSSDY                           183665
      *                                                                   183665
     C                     Z-ADDA6SPRT    ZRATET                          183665
     C                     MOVE A6MDIN    ZMDINT                          183665
     C                     MOVE A6NBDP    ZCDPT                           183665
      *                                                                   183665
     C                     EXSR ZCCYCN                                    183665
     C                     Z-ADDZAMTT     KNCA                            183665
     C                     END                                            183665
      *                                                                   183665
     C***********          Z-ADDKNCA      EVAM                            101925
     C*                                                                   087178
     C** Settlement amount, PSAT, is already in settlement currency       087178
     C** so this portion is ignored                                       087178
     C***********                                                         087178
     C**IF*NOM*CCY*NE*SETTL*CCY*CONVERT*SETTL*AMNT*IN*NOM*CCY**********   087178
     C**TO*SETTL*CCY*USING*P/ZCONV*AND*Z-ADD*TO*EVENT*AMOUNT***********   087178
     C**IN*PLACE*OF*SETTL*AMONT*IN*NOMINAL*CCY*************************   087178
     C***********                                                         087178
     C***********PNCY      IFNE PSCU                                      087178
     C***********          Z-ADDKNCA      ZAMTCI                          087178
     C***********          Z-ADDPSXR      ZEXCH                           087178
     C***********          MOVE PNCY      ZCCYI                           087178
     C***********          MOVE PSCU      ZCCYO                           087178
     C***********          MOVE PMDI      ZMD                             087178
     C***********                                                  S01117 087178
     C***Get*Nominal*Currency*rate*and*decimal*places*******       S01117 067406
     C***********                                                  S01117 067406
     C***********          MOVE *BLANK    ZZ006                    S01117 067406
     C***********          MOVE '20'      RECT                     S01117 067406
     C***********          MOVE 1         ZZ001                    S01117 067406
     C***********          MOVE PNCY      RCCY                     S01117 067406
     C* *********                                                  S01117 067406
     C***********TABKEY    CHAINTABTG10F             80            S01117 067406
     C********** *IN80     IFEQ '1'                                S01117 067406
     C***********RECI      OREQ '*'                                S01117 067406
     C********** *LOCK     IN   LDA                                S01117 067406
     C***********          MOVE 'TABLE'   DBFILE***************    S01117 067406
     C***********          MOVELTKEY      DBKEY ** DB ERROR 15     S01117 067406
     C***********          Z-ADD15        DBASE ***************    S01117 067406
     C***********          OUT  LDA                                S01117 067406
     C***********          SETON                     99U7U8        S01117 067406
     C***********          EXSR *PSSR                              S01117 067406
     C***********          GOTO EAUDIT                             S01117 067406
     C***********          END                                     S01117 067406
     C***********                                                  S01117 087178
     C***Set*Input*Currency*Decimal*Places*for*SR.ZCONV************S01117 087178
     C***********                                                  S01117 087178
     C***********          Z-ADDCDP       ZCDPI                    S01117 067406
     C***********          Z-ADDUNOMDP    ZCDPI                    067406 087178
     C***********                                                  S01117 087178
     C***Get*Settlement*Currency*spot*rate*and*decimal*places***** S01117 067406
     C***Get*Settlement*Currency*decimal*places********************067406 087178
     C***********                                                  S01117 087178
     C***********          MOVE *BLANK    ZZ006                    S01117 087178
     C***********          MOVE '20'      RECT                     S01117 087178
     C***********          MOVE 1         ZZ001                    S01117 087178
     C***********          MOVE PSCU      RCCY                     S01117 087178
     C***********                                                  S01117 087178
     C***********TABKEY    CHAINTABTG10F             80            S01117 087178
     C************IN80     IFEQ '1'                                S01117 087178
     C***********RECI      OREQ '*'                                S01117 087178
     C************LOCK     IN   LDA                                S01117 087178
     C***********          MOVE 'TABLE'   DBFILE           ********S01117 087178
     C***********          MOVELTKEY      DBKEY            ** DB ERS01117 087178
     C***********          Z-ADD16        DBASE            ********S01117 087178
     C***********          OUT  LDA                                S01117 087178
     C***********          SETON                     99U7U8        S01117 087178
     C***********          EXSR *PSSR                              S01117 087178
     C***********          GOTO EAUDIT                             S01117 087178
     C***********          END                                     S01117 087178
     C***********                                                  S01117 087178
     C***Set*Output*Currency*Decimal*Places*for*SR.ZCONV***********S01117 087178
     C***********                                                  S01117 087178
     C***********          Z-ADDCDP       ZCDPO                    S01117 087178
     C***********                                                         087178
     C***********          EXSR ZCONV                                     087178
     C************INU7     IFEQ '1'                                       S01117
     C************LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
     C***********          MOVELTKEY      DBKEY            ** DB ERROR 07 S01117
     C***********          Z-ADD5         DBASE            ***************S01117
     C***********          OUT  LDA                                       S01117
     C***********          SETON                     99U7U8               S01117
     C***********          EXSR *PSSR                                     S01117
     C***********          GOTO EAUDIT                                    S01117
     C***********          END                                            S01117
     C***********          Z-ADDZAMTCO    EVAM                            087178
     C***********          END                                            087178
     C*                                                                   094232
     C**If*nominal*ccy*ne*settlement*currency*use*settlement*amount094232 101925
     C***********PNCY      IFNE PSCU                               094232 101925
     C* always use settlement amount as this is in correct currency       101925
     C/COPY WNCPYSRC,SE2300C013
     C* (always need to check if the amount is pay/receive)               115469
     C           C1DI      IFEQ 'S'                                       173004
     C***********PRECI     ANDNE'R'                                                    219490 220547
     C           C1DI      OREQ 'D'                                       173004
     C***********PRECI     ANDNE'R'                                                    219490 220547
     C           PPRE      IFEQ 'R'                                       115469
     C           PRECI     ANDNE'R'                                                           220547
     C**********           Z-SUBPSAT      PSAT                                         173004 223108
     C                     Z-SUBPSAT      EVAM                                                223108
     C                     ELSE                                                               223108
     C                     Z-ADDPSAT      EVAM                                                223108
     C                     END                                            173004
     C                     ELSE                                           173004
     C           PPRE      IFEQ 'P'                                       173004
     C           PRECI     ANDNE'R'                                                           220547
     C**********           Z-SUBPSAT      PSAT                                         173004 223108
     C                     Z-SUBPSAT      EVAM                                                223108
     C                     ELSE                                                               223108
     C                     Z-ADDPSAT      EVAM                                                223108
     C                     END                                            173004
     C                     END                                            173004
     C***********          Z-ADDPSAT      EVAM                                         094232 223108
     C/COPY WNCPYSRC,SE2300C043
     C***********          ELSE                                    115469 173004
     C***********          Z-SUBPSAT      EVAM                     115469 173004
     C***********          END                                     115469 173004
     C***********          END                                     094232 101925
     C*
     C* IF NOM CCY NE BASE CCY CONVERT SETTL AMNT IN NOM CCY
     C* TO BASE CCY USING P/ZCONV
     C*
     C           PNCY      IFNE BCCY
     C           NMCY      ORNE BCCY                                      183665
     C*                                                                   E21244
     C* IF SETTLEMENT CURRENCY NOT EQUAL TO BASE CURRENCY,CONVERT NOMINAL E21244
     C* CURRENCY TO BASE CURRENCY EQUIVALENT                              E21244
     C*                                                                   E21244
     C           PSCU      IFNE BCCY                                      E21244
     C*                                                                   E21244
     C**CHAIN*TO*TABTG10*TO*GET*SPOT*RATE*OF*NOMINAL*CCY****              067406
     C* *********                                                         067406
     C***********          MOVE *BLANK    ZZ006                           067406
     C***********          MOVE '20'      RECT                            067406
     C***********          MOVE 1         ZZ001                           067406
     C***********          MOVE PNCY      RCCY                            067406
     C* *********                                                         067406
     C***********TABKEY    CHAINTABTG10F             80                   067406
     C********** *IN80     IFEQ '0'                                       067406
     C***********RECI      IFEQ '*'                                       067406
     C***********          SETON                     80                   067406
     C***********          END                                            067406
     C***********          END                                            067406
     C********** *IN80     IFEQ '1'                                       067406
     C********** *LOCK     IN   LDA                                S01117 067406
     C***********          MOVE 'TABLE'   DBFILE *****************        067406
     C***********          MOVELTKEY      DBKEY  ** DB ERROR 06 **        067406
     C***********          Z-ADD6         DBASE  *****************        067406
     C***********          OUT  LDA                                S01117 067406
     C***********          SETON                     99U7U8               067406
     C***********          EXSR *PSSR                              S01117 067406
     C***********          GOTO EAUDIT                                    067406
     C***********          END                                            067406
     C*
     C***********          Z-ADDKNCA      ZAMTCI                          151544
     C**********           Z-ADDPSAT      ZAMTCI                                       151544 223108
     C                     Z-ADDEVAM      ZAMTCI                                              223108
     C/COPY WNCPYSRC,SE2300C044
     C*                                                                   067406
     C**  Use Nominal/Base exchange rate from POSETD record               067406
     C*                                                                   067406
     C***********          Z-ADDSPOT      ZEXCH                           067406
     C                     Z-ADDPBRX      ZEXCH                           067406
     C************         MOVE PNCY      ZCCYI                           151544
     C                     MOVE PSCU      ZCCYI                           151544
     C                     MOVE BCCY      ZCCYO
     C*                                                                   S01117
     C** Set Input Currency Decimal Places for SR.ZCONV                   S01117
     C*                                                                   S01117
     C***********          Z-ADDCDP       ZCDPI                    S01117 067406
     C                     Z-ADDUNOMDP    ZCDPI                           067406
     C*                                                                   S01117
     C** Set Output Currency Decimal Places for SR.ZCONV to Base          S01117
     C** Currency Decimal places already obtained in SR.FIRST             S01117
     C*                                                                   S01117
     C                     Z-ADDBSCDP     ZCDPO                           S01117
     C*
     C* IF MDIN = 0 DIVIDE ELSE MULT
     C*
     C***********MDIN      IFEQ 0                                         067406
     C                     MOVE *BLANK    ZZ006                           151544
     C                     MOVE '20'      RECT                            151544
     C                     MOVE 1         ZZ001                           151544
     C                     MOVE PSCU      RCCY                            151544
     C*                                                                   151544
     C           TABKEY    CHAINTABTG10F             80                   151544
     C           *LIKE     DEFN MDIN      U2MDIN                          151544
     C                     Z-ADDMDIN      U2MDIN                          151544
     C********** UNMDIN    IFEQ 0                                         151544
     C           U2MDIN    IFEQ 0                                         151544
     C                     MOVE 'D'       ZMD
     C                     ELSE
     C                     MOVE 'M'       ZMD
     C                     END
      *                                                                   194195
     C           PSCU      IFNE PNCY                                      194195
     C                     Z-ADDCDP       ZCDPI                           194195
     C                     ENDIF                                          194195
      *                                                                   194195
     C                     EXSR ZCONV
     C************INU7     IFEQ '1'                                       S01117
     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
     C***********          MOVELTKEY      DBKEY            ** DB ERROR 07 S01117
     C***********          Z-ADD7         DBASE            ***************S01117
     C***********          SETON                     99U7U8               S01117
     C***********          GOTO EAUDIT                                    S01117
     C***********          END                                            S01117
     C                     Z-ADDZAMTCO    KBCA
     C*                                                                   E21244
     C* ELSE BASE CURRENCY EQUIVALENT IS PAY AMOUNT IN SETTLEMENT CCY     E21244
     C*                                                                   E21244
     C                     ELSE                                           E21244
     C                     Z-ADDEVAM      KBCA                            E21244
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           PPRE      IFEQ 'R'                                       CAC002
     C                     SUB  MAMT      KBCA                            CAC002
     C                     ELSE                                           CAC002
     C                     ADD  MAMT      KBCA                            CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     END                                            E21244
     C*                                                                   E21244
     C* ELSE BASE CURRENCY EQUIVALENT IS PAY AMOUNT IN NOMINAL CCY        E21244
     C*                                                                   E21244
     C                     ELSE                                           E21244
     C                     Z-ADDKNCA      KBCA                            E21244
     C                     END
     C/COPY WNCPYSRC,SE2300C014
     C*
     C* SET OTHER FIELDS ON A/C KEY RELEVENT TO THIS PROCESS
     C*
     C                     MOVE 'S'       EVTP
     C                     MOVE 'SA'      AMCD
     C/COPY WNCPYSRC,SE2300C045
     C                     MOVELPSCU      EVCY
     C                     MOVE PSMT      STLT
     C                     MOVE PSEA      STLA
     C*                                                                   S01496
     C**  If reversal, use saved BCCY value from SABC                     S01496
     C**  If not reversal, save amount in base into SABC                  S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01496
     C           WWRECI    IFEQ 'R'                                       S01496
     C                     Z-ADDSABC      KBCA                            S01496
     C                     ELSE                                           S01496
     C                     Z-ADDKBCA      SABC                            S01496
     C                     ENDIF                                          S01496
     C*                                                                   S01496
     C                     ENDIF                                          S01496
      *                                                                                       CGL020
      ** Set the Fee Fields if CGL020 is enabled.                                             CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRSFSA                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C* WRITE A/C KEY
     C                     EXSR WRITED
     C/COPY WNCPYSRC,SE2300C015
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT                                                              S01447
     C*****************************************************************   S01447
     C*                                                               *   S01447
     C* WTKEYS   -   SUBROUTINE TO GENERATE WITHHOLDING TAX KEYS      *   S01447
     C*                                                               *   S01447
     C*****************************************************************   S01447
     C*                                                                   S01447
     C           WTKEYS    BEGSR                                          S01447
     C*                                                                   S01447
     C*  Set event code to coupon or dividend                             S01447
     C*                                                                   S01447
     C           PEVT      IFEQ 'CP'                                      S01447
     C                     MOVE 'C'       EVTP                            S01447
     C                     ELSE                                           S01447
     C*  Set event code to 'X' if Corporate Action flag 'I' (Income Evts) CSE007
     C*                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           WWCOAT    ANDEQ'I'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           WWCOAT    ANDEQ'I'                                       CEU017
     C                     MOVE 'X'       EVTP                            CSE007
     C*                                                                   CSE007
     C*  Include Trade Sub-Type in Corporate Action Key                   CSE007
     C*                                                                   CSE007
     C           BVCOTA    IFEQ 'Y'                                       CSE007
     C                     MOVELMMTSUB    PSBS                            CSE007
     C                     MOVE MMTSUB    FIL1                            CSE007
     C                     ELSE                                           CSE007
     C                     MOVE *BLANKS   PSBS                            CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   CSE007
     C                     ELSE                                           CSE007
     C                     MOVE 'H'       EVTP                            S01447
     C                     END                                            CSE007
     C                     END                                            S01447
     C*                                                                   S01447
     C*  Access securities file for country of tax                        S01447
     C*  Database error if no record or the country of tax is blank       S01447
     C*                                                                   S01447
     C           SECKEY    CHAINSESWHTL0             99                   S01447
     C           *IN99     IFEQ '1'                                       S01447
     C           S1CTTA    OREQ *BLANK                                    S01447
     C           *LOCK     IN   LDA                                       S01447
     C                     MOVEL'SESWHTL0'DBFILE           *****************1447
     C                     MOVELPSSH      DBKEY            ** DB ERROR 18 **1447
     C                     Z-ADD18        DBASE            *****************1447
     C                     OUT  LDA                                       S01447
     C                     SETON                     U7U8                 S01447
     C                     EXSR *PSSR                                     S01447
     C                     GOTO EAUDIT                                    S01447
     C                     END                                            S01447
     C                     MOVE S1CTTA    COTA                            S01447
     C*                                                                   S01447
     C*  Generate key for Tax Deducted at Source Refundable               S01447
     C*                                                                   S01447
     C           TASR      IFNE *ZERO                                     S01447
     C*                                                                   S01447
     C*  Set up amount code                                               S01447
     C*                                                                   S01447
     C                     MOVE 'WR'      AMCD                            S01447
     C*                                                                   S01447
     C*  Set up amount as lesser of Tax Refundable and Tax Deducted       S01447
     C*                                                                   S01447
     C           TASR      IFLE TASO                                      S01447
     C                     Z-ADDTASR      EVAM                            S01447
     C                     ELSE                                           S01447
     C                     Z-ADDTASO      EVAM                            S01447
     C                     END                                            S01447
     C*                                                                   S01447
     C*  Event amount must be positive                                    S01447
     C*                                                                   S01447
     C           EVAM      IFLT 0                                         S01447
     C                     Z-SUBEVAM      EVAM                            S01447
     C                     END                                            S01447
     C*                                                                   S01447
     C*  Write account key                                                S01447
     C*                                                                   S01447
     C                     EXSR WRITED                                    S01447
     C/COPY WNCPYSRC,SE2300C039
     C*                                                                   S01447
     C                     END                                            S01447
     C*                                                                   S01447
     C*  Generate key for Tax Refundable not deducted at source           S01447
     C*  Key generated if the Tax Refundable is greater than the          S01447
     C*  Tax Deducted                                                     S01447
     C*                                                                   S01447
     C           TASR      IFGT TASO                                      S01447
     C*                                                                   S01447
     C*  Set up amount code                                               S01447
     C*                                                                   S01447
     C                     MOVE 'WX'      AMCD                            S01447
     C*                                                                   S01447
     C*  Event amount is Tax Refundable less Tax Deducted                 S01447
     C*                                                                   S01447
     C           TASR      SUB  TASO      EVAM                            S01447
     C*                                                                   S01447
     C*  Write account key                                                S01447
     C*                                                                   S01447
     C                     EXSR WRITED                                    S01447
     C/COPY WNCPYSRC,SE2300C040
     C*                                                                   S01447
     C                     END                                            S01447
     C*                                                                   S01447
     C*  Generate key for Tax not Refundable                              S01447
     C*  Key generated if the Tax Deducted at Source is greater than      S01447
     C*  the Tax Refundable                                               S01447
     C*                                                                   S01447
     C           TASO      IFGT TASR                                      S01447
     C*                                                                   S01447
     C*  Set up amount code                                               S01447
     C*                                                                   S01447
     C                     MOVE 'WN'      AMCD                            S01447
     C*                                                                   S01447
     C*  Event amount is Tax Deducted at Source less Tax Deducted         S01447
     C*  at Source Refundable                                             S01447
     C*                                                                   S01447
     C           TASO      SUB  TASR      EVAM                            S01447
     C*                                                                   S01447
     C*  Write account key                                                S01447
     C*                                                                   S01447
     C                     EXSR WRITED                                    S01447
     C/COPY WNCPYSRC,SE2300C041
     C*                                                                   S01447
     C                     END                                            S01447
     C*                                                                   S01447
     C*  Generate key for Tax Deducted by User                            S01447
     C*  Key generated if the Tax Deducted by User is greater than        S01447
     C*  zero                                                             S01447
     C*                                                                   S01447
     C           TAUS      IFNE *ZERO                                     S01447
     C/COPY WNCPYSRC,SE2300C035
     C*                                                                   S01447
     C*  Set up amount code                                               S01447
     C*                                                                   S01447
     C                     MOVE 'WD'      AMCD                            S01447
     C*                                                                   S01447
     C*  Event amount is Tax Deducted by User and should be positive      S01447
     C*                                                                   S01447
     C           TAUS      IFLT 0                                         S01447
     C                     Z-SUBTAUS      KNCA                            S01447
     C                     ELSE                                           S01447
     C                     Z-ADDTAUS      KNCA                            S01447
     C                     END                                            S01447
     C*                                                                   S01447
     C**  Set up Event Amount, Event Currency and Base Currency Amt:      S01447
     C**  Event amount is in Base currency and Event currency is Base CCY.S01447
     C**  Use exchange rate from Position Settlement record but because   S01447
     C**  there is no M/D indicator there, use the one from TABTG10,      S01447
     C**  (which cannot change once the system is set up).                S01447
     C*                                                                   S01447
     C                     MOVE BCCY      EVCY                            S01447
     C*                                                                   S01447
     C           PNCY      IFNE BCCY                                      S01447
     C           NMCY      ORNE BCCY                                      183665
     C*                                                                   S01447
     C           UNMDIN    IFEQ 0                                         S01447
     C                     MOVE 'D'       ZMD                             S01447
     C                     ELSE                                           S01447
     C                     MOVE 'M'       ZMD                             S01447
     C                     END                                            S01447
     C*                                                                   S01447
     C                     Z-ADDTAUS      ZAMTCI                          S01447
     C                     Z-ADDPBRX      ZEXCH                           S01447
     C                     MOVE PNCY      ZCCYI                           S01447
     C                     MOVE BCCY      ZCCYO                           S01447
     C                     Z-ADDUNOMDP    ZCDPI                           S01447
     C                     Z-ADDBSCDP     ZCDPO                           S01447
     C                     EXSR ZCONV                                     S01447
     C*                                                                   S01447
     C                     Z-ADDZAMTCO    EVAM                            S01447
     C                     Z-ADDZAMTCO    KBCA                            S01447
     C*                                                                   S01447
     C** Else Base Currency Amount & Event Amount = Position Settlement   S01447
     C** amount.                                                          S01447
     C*                                                                   S01447
     C                     ELSE                                           S01447
     C*                                                                   S01447
     C                     Z-ADDKNCA      EVAM                            S01447
     C                     Z-ADDKNCA      KBCA                            S01447
     C                     END                                            S01447
     C*                                                                   S01496
     C**  If reversal use saved base currency value from BAUS             S01496
     C**  If not reversal, save tax equivalent into BAUS                  S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C*                                                                   S01496
     C           WWRECI    IFEQ 'R'                                       S01496
     C                     Z-ADDBAUS      EVAM                            S01496
     C                     Z-ADDBAUS      KBCA                            S01496
     C                     ELSE                                           S01496
     C                     Z-ADDKBCA      BAUS                            S01496
     C                     ENDIF                                          S01496
     C*                                                                   S01496
     C                     ENDIF                                          S01496
     C*                                                                   S01447
     C*  Write account key                                                S01447
     C*                                                                   S01447
     C                     EXSR WRITED                                    S01447
     C/COPY WNCPYSRC,SE2300C036
     C*                                                                   S01447
     C                     END                                            S01447
     C*                                                                   S01447
     C                     ENDSR                                          S01447
     C*****************************************************************   S01447
     C/EJECT                                                              CSE023
     C*****************************************************************   CSE023
     C*                                                               *   CSE023
     C* WTTKYS   -   SUBROUTINE TO GENERATE TREATY WITHHOLDING TAX KEY*   CSE023
     C*                                                               *   CSE023
     C*****************************************************************   CSE023
     C*                                                                   CSE023
     C           WTTKYS    BEGSR                                          CSE023
      *                                                                   188794
      ** Set Country of Treaty Code                                       188794
      *                                                                   188794
     C                     MOVE CRTT      COTA                            188794
     C*                                                                   CSE023
     C*  Set event code to coupon or dividend                             CSE023
     C*                                                                   CSE023
     C           PEVT      IFEQ 'CP'                                      CSE023
     C                     MOVE 'C'       EVTP                            CSE023
     C                     ELSE                                           CSE023
     C*  Set event code to 'X' if Corporate Action flag 'I' (Income Evts) CSE023
     C*                                                                   CSE023
     C           CSE007    IFEQ 'Y'                                       CSE023
     C           WWCOAT    ANDEQ'I'                                       CSE023
     C           CEU017    OREQ 'Y'                                       CSE023
     C           WWCOAT    ANDEQ'I'                                       CSE023
     C                     MOVE 'X'       EVTP                            CSE023
     C*                                                                   CSE023
     C*  Include Trade Sub-Type in Corporate Action Key                   CSE023
     C*                                                                   CSE023
     C           BVCOTA    IFEQ 'Y'                                       CSE023
     C                     MOVELMMTSUB    PSBS                            CSE023
     C                     MOVE MMTSUB    FIL1                            CSE023
     C                     ELSE                                           CSE023
     C                     MOVE *BLANKS   PSBS                            CSE023
     C                     ENDIF                                          CSE023
     C*                                                                   CSE023
     C                     ELSE                                           CSE023
     C           PEVT      IFEQ 'MA'                                      CSE023
     C                     MOVE 'M'       EVTP                            CSE023
     C                     ELSE                                           CSE023
     C                     MOVE 'H'       EVTP                            CSE023
     C                     END                                            CSE023
     C                     END                                            CSE023
     C                     END                                            CSE023
     C*                                                                   CSE023
     C*  Generate key for Tax Deducted at Source                          CSE023
     C*                                                                   CSE023
     C           TASO      IFNE *ZERO                                     CSE023
     C*                                                                   CSE023
     C*  Set up amount code                                               CSE023
     C*                                                                   CSE023
     C                     MOVE 'WN'      AMCD                            CSE023
     C                     Z-ADDTASO      EVAM                            CSE023
     C*                                                                   CSE023
     C*  Event amount must be positive                                    CSE023
     C*                                                                   CSE023
     C           EVAM      IFLT 0                                         CSE023
     C                     Z-SUBEVAM      EVAM                            CSE023
     C                     END                                            CSE023
     C*                                                                   CSE023
     C*  Write account key                                                CSE023
     C*                                                                   CSE023
     C                     EXSR WRITED                                    CSE023
     C/COPY WNCPYSRC,SE2300C042
     C*                                                                   CSE023
     C                     END                                            CSE023
     C*                                                                   CSE023
     C*  Generate key for Tax Deducted by User                            CSE023
     C*  Key generated if the Tax Deducted by User is not zero            CSE023
     C*                                                                   CSE023
     C           TAUS      IFNE *ZERO                                     CSE023
     C*                                                                   CSE023
     C*  Set up amount code                                               CSE023
     C*                                                                   CSE023
     C                     MOVE 'WD'      AMCD                            CSE023
     C*                                                                   CSE023
     C*  Event amount is Tax Deducted by User and should be positive      CSE023
     C*                                                                   CSE023
     C           TAUS      IFLT 0                                         CSE023
     C                     Z-SUBTAUS      KNCA                            CSE023
     C                     ELSE                                           CSE023
     C                     Z-ADDTAUS      KNCA                            CSE023
     C                     END                                            CSE023
     C*                                                                   CSE023
     C**  Set up Event Amount, Event Currency and Base Currency Amt:      CSE023
     C**  Event amount is in Base currency and Event currency is Base CCY.CSE023
     C**  Use exchange rate from Position Settlement record but because   CSE023
     C**  there is no M/D indicator there, use the one from TABTG10,      CSE023
     C**  (which cannot change once the system is set up).                CSE023
     C*                                                                   CSE023
     C                     MOVE BCCY      EVCY                            CSE023
     C*                                                                   CSE023
     C           PNCY      IFNE BCCY                                      CSE023
     C*                                                                   CSE023
     C           UNMDIN    IFEQ 0                                         CSE023
     C                     MOVE 'D'       ZMD                             CSE023
     C                     ELSE                                           CSE023
     C                     MOVE 'M'       ZMD                             CSE023
     C                     END                                            CSE023
     C*                                                                   CSE023
     C                     Z-ADDTAUS      ZAMTCI                          CSE023
     C                     Z-ADDPBRX      ZEXCH                           CSE023
     C                     MOVE PNCY      ZCCYI                           CSE023
     C                     MOVE BCCY      ZCCYO                           CSE023
     C                     Z-ADDUNOMDP    ZCDPI                           CSE023
     C                     Z-ADDBSCDP     ZCDPO                           CSE023
     C                     EXSR ZCONV                                     CSE023
     C*                                                                   CSE023
     C                     Z-ADDZAMTCO    EVAM                            CSE023
     C                     Z-ADDZAMTCO    KBCA                            CSE023
     C*                                                                   CSE023
     C** Else Base Currency Amount & Event Amount = Position Settlement   CSE023
     C** amount.                                                          CSE023
     C*                                                                   CSE023
     C                     ELSE                                           CSE023
     C*                                                                   CSE023
     C                     Z-ADDKNCA      EVAM                            CSE023
     C                     Z-ADDKNCA      KBCA                            CSE023
     C                     END                                            CSE023
     C*                                                                   CSE023
     C**  If reversal use saved base currency value from BAUS             CSE023
     C**  If not reversal, save tax equivalent into BAUS                  CSE023
     C*                                                                   CSE023
     C           S01496    IFEQ 'Y'                                       CSE023
     C           CSE007    OREQ 'Y'                                       CSE023
     C           CEU017    OREQ 'Y'                                       CSE023
     C*                                                                   CSE023
     C           WWRECI    IFEQ 'R'                                       CSE023
     C                     Z-ADDBAUS      EVAM                            CSE023
     C                     Z-ADDBAUS      KBCA                            CSE023
     C                     ELSE                                           CSE023
     C                     Z-ADDKBCA      BAUS                            CSE023
     C                     ENDIF                                          CSE023
     C*                                                                   CSE023
     C                     ENDIF                                          CSE023
     C*                                                                   CSE023
     C                     MOVE '  '      COTA                            CSE023
     C*                                                                   CSE023
     C*  Write account key                                                CSE023
     C*                                                                   CSE023
     C                     EXSR WRITED                                    CSE023
     C*                                                                   CSE023
     C                     END                                            CSE023
      *                                                                   188794
     C                     MOVE '  '      COTA                            188794
     C*                                                                   CSE023
     C                     ENDSR                                          CSE023
     C*****************************************************************   CSE023
      /EJECT                                                                                  233710
      *****************************************************************                       233710
      *                                                               *                       233710
      * SRETAX - Subroutine to post the EU Tax Amount                 *                       233710
      *                                                               *                       233710
      *****************************************************************                       233710
     C           SRETAX    BEGSR                                                              233710
      *                                                                                       233710
      ** Take a security copy of the currency codes                                           235141
      *                                                                                       235141
     C                     MOVELEVCY      WEVCY   3                                           235141
     C                     MOVELKCCY      WKCCY   3                                           235141
      *                                                                                       233710
      ***Tax*Account*Key*Generation************************************                233710 235174
      ***Initialisetfieldseneration************************************                233710 235174
      *                                                                                       233710
     C**********           MOVEL'E'       EVTP                                         233710 235174
     C**********           MOVEL@@COLC    COTA                                         233710 235174
     C**********           MOVEL'ET'      AMCD                                         233710 235174
      *                                                                                       234635
      ***Tax*amount*in*tax*ccy*from*POSETD*****************************                234635 235174
      *                                                                                       234635
     C**********           Z-ADDTSTXSC    EVAM                                         233710 234635
     C**********           Z-ADDTAXA      EVAM                                         234635 235174
      *                                                                                       233710
     C**********           MOVELTSTXCY    EVCY                                         233710 235174
     C**********           MOVELTSOCCY    KCCY                                         233710 235174
      *                                                                                       233710
     C********** TSTXCY    IFNE TSOCCY                                                 233710 235174
     C**********           Z-ADDTXST      KNCA                                         233710 235174
     C**********           Z-ADDWWTXSB    KBCA                                         233710 235174
     C**********           ELSE                                                        233710 235174
     C**********           Z-ADD0         KNCA                                         233710 235174
     C**********           Z-ADD0         KBCA                                         233710 235174
     C**********           ENDIF                                                       233710 235174
      *                                                                                       233710
      ***Build*output*record*******************************************                233710 235174
      *                                                                                       233710
     C**********           MOVE SITP      INVT                                         233710 235174
     C**********           MOVE ' '       TRTP                                         233710 235174
      *                                                                                       233710
     C**********           MOVE '  '      BOOK                                         233710 235174
     C**********           MOVE ' '       PSBS                                         233710 235174
     C**********           MOVE ' '       FIL1                                         233710 235174
     C**********           MOVE '  '      CGTP                                         233710 235174
     C**********           MOVE 'D'       RECI                                         233710 235174
      *                                                                                       233710
     C********** PPRE      IFEQ 'R'                                                    233710 235174
     C********** PSMT      ANDEQ04                                                     233710 235174
     C********** PPRE      OREQ 'P'                                                    233710 235174
     C********** PSMT      ANDEQ04                                                     233710 235174
     C**********           ELSE                                                        233710 235174
     C**********           MOVE *BLANK    STLA                                         233710 235174
     C**********           ENDIF                                                       233710 235174
     C**********           Z-ADDSAED      EVDT                                                233710
      *                                                                                       233710
     C********** PPRE      IFEQ 'R'                                                    233710 235174
     C********** PSMT      ANDEQ04                                                     233710 235174
     C********** PPRE      OREQ 'P'                                                    233710 235174
     C********** PSMT      ANDEQ04                                                     233710 235174
     C**********           ELSE                                                        233710 235174
     C**********           Z-ADD0         STLT                                         233710 235174
     C**********           ENDIF                                                       233710 235174
      *                                                                                       233710
      ***Write*Generated*Account*Key*Record****************************                233710 235174
      *                                                                                       233710
     C**********           EXSR WRITED                                                 233710 235174
      *                                                                                       233710
      ** Net Interest Amount Account Key Generation                                           233710
      ** Initialise fields                                                                    233710
      *                                                                                       233710
     C                     EXSR CLEAR                                                         233710
      *                                                                                       233710
     C                     MOVEL'E'       EVTP                                                233710
     C                     MOVEL*BLANK    COTA                                                233710
     C                     MOVEL'NI'      AMCD                                                233710
      *                                                                                       233710
      ** Net Interest Amount in Nominal Ccy = Amount due - EU Tax                             234635
      *                                                                                       234635
     C**********           Z-ADDTSNINT    EVAM                                                234635
     C           PAMD      SUB  TXNM      EVAM                                                234635
      *                                                                                       233710
     C                     MOVELTSOCCY    EVCY                                                233710
     C                     MOVELTSOCCY    KCCY                                                233710
     C                     Z-ADDTSNINT    KNCA                                                233710
     C                     MOVELTSNINB    KBCA                                                233710
      *                                                                                       233710
      ** Build output record                                                                  233710
      *                                                                                       233710
     C                     MOVE SITP      INVT                                                233710
     C                     MOVE ' '       TRTP                                                233710
      *                                                                                       233710
     C                     MOVE '  '      BOOK                                                233710
     C                     MOVE ' '       PSBS                                                233710
     C                     MOVE ' '       FIL1                                                233710
     C                     MOVE '  '      CGTP                                                233710
     C                     MOVE 'D'       RECI                                                233710
      *                                                                                       233710
     C           PPRE      IFEQ 'R'                                                           233710
     C           PSMT      ANDEQ04                                                            233710
     C           PPRE      OREQ 'P'                                                           233710
     C           PSMT      ANDEQ04                                                            233710
     C                     ELSE                                                               233710
     C                     MOVE *BLANK    STLA                                                233710
     C                     ENDIF                                                              233710
     C****                 Z-ADDSAED      EVDT                                                233710
      *                                                                                       233710
     C           PPRE      IFEQ 'R'                                                           233710
     C           PSMT      ANDEQ04                                                            233710
     C           PPRE      OREQ 'P'                                                           233710
     C           PSMT      ANDEQ04                                                            233710
     C                     ELSE                                                               233710
     C                     Z-ADD0         STLT                                                233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
      ** Write Generated Account Key Record                                                   233710
      *                                                                                       233710
     C                     EXSR WRITED                                                        233710
      *                                                                                       233710
      ** Restore the security copy of the currency codes                                      235141
      *                                                                                       235141
     C                     MOVELWEVCY     EVCY                                                235141
     C                     MOVELWKCCY     KCCY                                                235141
      *                                                                                       235141
     C                     ENDSR                                                              233710
      *****************************************************************                       233710
      /EJECT                                                                                  233710
      *****************************************************************                       233710
      *                                                               *                       233710
      * SRTAXA - Subroutine to calculate taxable amount               *                       233710
      *                                                               *                       233710
      *****************************************************************                       233710
     C           SRTAXA    BEGSR                                                              233710
      *                                                                                       233710
     C                     Z-ADD*ZERO     WWTXSB 150                                          233710
     C                     MOVE *BLANKS   WTXJA   1                                           233710
     C                     MOVE PCPY      @@CUST                                              233710
      *                                                                                       233710
     C                     CALL 'ZATXCLPI'                                                    233710
      ** Input                                                                                233710
     C                     PARM 'S'       @@MODI  1                                           233710
     C                     PARM           @@TRRF 18                                           233710
     C                     PARM PBCA      @@BRCA  3                                           233710
     C                     PARM           @@CUST  6                                           233710
     C                     PARM *ZERO     @@STRD  50                                          233710
     C                     PARM *ZERO     @@ENDD  50                                          233710
     C                     PARM PAMD      @@TOTI 150                                          233710
     C                     PARM           @@TAXR  64                                          233710
     C                     PARM PNCY      @@OCCY  3                                           233710
     C                     PARM *BLANKS   PINTH   1                                           CER048
      ** Output                                                                               233710
     C                     PARM           @@IAED 150                                          233710
     C                     PARM           @@TAXA 150                                          233710
     C                     PARM           @@TOTO 150                                          233710
     C                     PARM           @@TXCY  3                                           233710
     C                     PARM           @@CTAX  2                                           233710
     C                     PARM           @@TXBS  2                                           233710
     C                     PARM           @@WTAC  40                                          233710
     C                     PARM           @@COLC  2                                           233710
     C                     PARM           @@STAT  5                                           233710
     C                     PARM           @@TRTE  1                                           233710
     C                     PARM           @@TXR1  64                                          233710
     C**********           PARM *ZEROS    PSTXB   20                                 CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC  100                                 CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR   64                                 CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP   1                                  CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA  150                                 CER048 BUG22911
     C                     PARM           @@KEY  10                                           233710
     C                     PARM           @@FILE 10                                           233710
     C                     PARM           @@RTRN  7                                           233710
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       233710
     C                     SELEC                                                              233710
      *                                                                                       233710
      ** If return code = Error.                                                              233710
      *                                                                                       233710
     C           @@RTRN    WHEQ 'ERROR'                                                       233710
     C                     MOVE @@FILE    DBFILE                                              233710
     C                     MOVE @@KEY     DBKEY                                               233710
     C                     Z-ADD60        DBASE                                               233710
     C                     MOVE *ON       *INU7                                               233710
     C                     MOVE *ON       *INU8                                               233710
     C                     EXSR *PSSR                                                         233710
     C                     GOTO EAUDIT                                                        233710
      *                                                                                       233710
      ** If return code = Private Individual                                                  233710
      *                                                                                       233710
     C           @@RTRN    WHNE 'JOINT'                                                       233710
      *                                                                                       233710
     C           @@STAT    IFEQ 'TAXAB'                                                       233710
     C           @@STAT    OREQ 'DISCL'                                                       233710
     C           @@STAT    OREQ 'SELF'                                                        233710
      *                                                                                       233710
     C                     EXSR SRTAXB                                                        233710
      *                                                                                       233710
     C                     Z-ADDTXNM      @@TAXA                                              233710
     C           TXNM      MULT 100       WTAMT  150                                          233710
     C           @@TAXR    IFNE 0                                                             233710
     C           WTAMT     DIV  @@TAXR    @@TOTO                                              233710
     C                     ELSE                                                               233710
     C                     Z-ADD0         @@TOTO                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
      ** Write record to SDCSINPD                                                             233710
      *                                                                                       233710
     C                     EXSR SRCSIN                                                        233710
      *                                                                                       235174
      ** Generate EU a/c keys for tax amount.                                                 235174
      *                                                                                       235174
     C                     EXSR SREAET                                                        235174
      *                                                                                       233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
      ** If return code = Joint Account                                                       233710
      *                                                                                       233710
     C           @@RTRN    WHEQ 'JOINT'                                                       233710
     C                     MOVE PCPY      KJANO   6                                           233710
      *                                                                                       235709
      ***Determine*the*total*EU*tax*if*all*Joint*A/c*members*were*taxable.             235709 235226
      ** Determine the total customer income.                                                 235226
      *                                                                                       235709
     C                     EXSR SRETJA                                                        235709
      *                                                                                       233710
     C           KJANO     SETLLSDJACCLB                                                      233710
     C           KJANO     READESDJACCLB                 60                                   233710
      *                                                                                       233710
     C           *IN60     DOWEQ*OFF                                                          233710
      *                                                                                       233710
     C                     CALL 'ZATXCLJA'                                                    233710
      ** Input                                                                                233710
     C                     PARM 'S'       @@MODI                                              233710
     C                     PARM           @@TRRF                                              233710
     C                     PARM PBCA      @@BRCA                                              233710
     C                     PARM JCJANO    @@JANO  6                                           233710
     C                     PARM JCCUST    @@CUST                                              233710
     C                     PARM JCNAHO    @@NARF 10                                           233710
     C                     PARM JCINVP    @@INVP 10                                           233710
     C                     PARM JCPAHT    @@PAHT  1                                         BUG26839
     C                     PARM *ZERO     @@STRD                                              233710
     C                     PARM *ZERO     @@ENDD                                              233710
     C                     PARM PAMD      @@TOTI                                              233710
     C                     PARM           @@TAXR                                              233710
     C                     PARM PNCY      @@OCCY                                              233710
     C                     PARM *BLANKS   PINTH                                               CER048
      ** Output                                                                               233710
     C                     PARM           @@IAED                                              233710
     C                     PARM           @@TAXA                                              233710
     C                     PARM           @@TOTO                                              233710
     C                     PARM           @@TXCY                                              233710
     C                     PARM           @@CTAX                                              233710
     C                     PARM           @@TXBS                                              233710
     C                     PARM           @@WTAC                                              233710
     C                     PARM           @@COLC                                              233710
     C                     PARM           @@STAT                                              233710
     C                     PARM           @@TRTE                                              233710
     C                     PARM           @@TXR1                                              233710
     C                     PARM           @@JAMG  1                                           233710
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY                                               233710
     C                     PARM           @@FILE                                              233710
     C                     PARM           @@RTRN                                              233710
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       233710
      ** If return code = Error.                                                              233710
      *                                                                                       233710
     C           @@RTRN    IFEQ 'ERROR'                                                       233710
     C                     MOVE @@FILE    DBFILE                                              233710
     C                     MOVE @@KEY     DBKEY                                               233710
     C                     Z-ADD61        DBASE                                               233710
     C                     MOVE *ON       *INU7                                               233710
     C                     MOVE *ON       *INU8                                               233710
     C                     EXSR *PSSR                                                         233710
     C                     GOTO EAUDIT                                                        233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C           @@STAT    IFEQ 'TAXAB'                                                       233710
     C           @@STAT    OREQ 'DISCL'                                                       233710
     C           @@STAT    OREQ 'SELF '                                                       233710
      *                                                                                       233710
     C                     EXSR SRTAXB                                                        233710
      *                                                                                       233710
     C                     MOVE 'Y'       WTXJA                                               233710
      *                                                                                       233710
      ** CALCULATE THE AMOUNT FOR EACH MEMBER                                                 233710
      *                                                                                       233710
     C                     CALL 'ZAMRATIO'                                                    233710
     C                     PARM           @@INVP                                              233710
     C                     PARM           TXNM                                                233710
     C                     PARM           @@TAXA                                              233710
      *                                                                                       233710
     C           @@TAXA    MULT 100       WTAMT                                               233710
     C           @@TAXR    IFNE 0                                                             233710
     C           WTAMT     DIV  @@TAXR    @@TOTO                                              233710
     C                     ELSE                                                               233710
     C                     Z-ADD0         @@TOTO                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
      ** Write record to SDCSINPD                                                             233710
      *                                                                                       233710
     C                     EXSR SRCSIN                                                        233710
      *                                                                                       235174
      ** Generate EU a/c keys for tax amount.                                                 235174
      *                                                                                       235174
     C                     EXSR SREAET                                                        235174
      *                                                                                       233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C           @@RTRN    IFEQ 'NOTAX'                                                       233710
     C           @@RTRN    OREQ 'TAXAB'                                                       233710
     C           KJANO     READESDJACCLB                 60                                   233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
      ** If @@RTRN = Last, end loop                                                           233710
      *                                                                                       233710
     C           @@RTRN    IFEQ 'LAST'                                                        233710
     C                     MOVE *ON       *IN60                                               233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     ENDDO                                                              233710
      *                                                                                       233710
     C                     ENDSL                                                              233710
      *                                                                                       233710
     C                     ENDSR                                                              233710
      *****************************************************************                       233710
      /EJECT                                                                                  233710
      *****************************************************************                       233710
      *                                                               *                       233710
      * SRCURR - Subroutine to Access Currrency Details               *                       233710
      *                                                               *                       233710
      *****************************************************************                       233710
     C           SRCURR    BEGSR                                                              233710
      *                                                                                       233710
     C                     CALL 'AOCURRR0'                                                    233710
     C                     PARM *BLANKS   PRTCD                                               233710
     C                     PARM '*KEY   ' POPTN                                               233710
     C                     PARM WCURR     PKEY    3                                           233710
     C           SDCURR    PARM SDCURR    DSSDY                                               233710
      *                                                                                       233710
     C           PRTCD     IFNE *BLANKS                                                       233710
     C                     MOVE 'SDCURRPD'DBFILE                                              233710
     C                     MOVELPKEY      DBKEY                                               233710
     C                     Z-ADD30        DBASE                                               233710
     C                     MOVE *ON       *INU7                                               233710
     C                     MOVE *ON       *INU8                                               233710
     C                     MOVE *ON       *INLR                                               233710
     C                     EXSR *PSSR                                                         233710
     C                     GOTO EAUDIT                                                        233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     ENDSR                                                              233710
      *****************************************************************                       233710
      /EJECT                                                                                  233710
      *****************************************************************                       233710
      *                                                               *                       233710
      * SRTAXB - Subroutine to Retrieve Tax Basket                    *                       233710
      *                                                               *                       233710
      *****************************************************************                       233710
     C           SRTAXB    BEGSR                                                              233710
      *                                                                                       233710
     C                     CALL 'AOTXBSR0'                                                    233710
     C                     PARM *BLANKS   PRTCD                                               233710
     C                     PARM '*KEY   ' POPTN                                               233710
     C                     PARM @@CTAX    PCTTT   2                                           233710
     C                     PARM @@TXBS    PTXBS   2                                           233710
     C                     PARM BJRDNB    PDATE   50                                          233710
     C                     PARM           PNARR  15                                           233710
     C                     PARM           PRATE   64                                          233710
      *                                                                                       233710
     C           PRTCD     IFEQ *BLANKS                                                       233710
     C                     Z-ADDPRATE     @@TAXR  64                                          233710
     C                     ELSE                                                               233710
     C                     Z-ADD*ZEROS    @@TAXR                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     ENDSR                                                              233710
      *****************************************************************                       233710
      /EJECT                                                                                  233710
      *****************************************************************                       233710
      *                                                               *                       233710
      * SRCPOS - Subroutine to access LF/CPOSN to retreive average    *                       233710
      *          fiscal price                                         *                       233710
      *                                                               *                       233710
      *****************************************************************                       233710
     C           SRCPOS    BEGSR                                                              233710
      *                                                                                       233710
     C           KCPOS     CHAINCPOSN                62                                       233710
      *                                                                                       233710
     C           *IN62     IFEQ *OFF                                                          233710
     C                     Z-ADDCSPV      TSPAMT                                              233710
     C                     ELSE                                                               233710
     C                     Z-ADD*ZEROS    TSPAMT                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     ENDSR                                                              233710
      *****************************************************************                       233710
      /EJECT                                                                                  233710
      *****************************************************************                       233710
      *                                                               *                       233710
      * SRCSIN - Subroutine to Output to SDCSINPD                     *                       233710
      *                                                               *                       233710
      *****************************************************************                       233710
     C           SRCSIN    BEGSR                                                              233710
      *                                                                                       233710
     C                     EXSR SRCPOS                                                        233710
      *                                                                                       233710
     C                     Z-ADDBJRDNB    TSRDNB                                              233710
     C                     Z-ADDPDUD      TSEDAT                                              233710
      *                                                                                       233710
      ** Get Tax Year from Tax Calculation Date                                               233710
      *                                                                                       233710
     C                     Z-ADDTSEDAT    ZDAYNO                                              233710
      *                                                                                       233710
     C                     CALL 'ZDATE2'                                                      233710
     C                     PARM           ZDAYNO  50                                          233710
     C                     PARM           BJDFIN                                              233710
     C                     PARM           ZDATE   60                                          233710
     C                     PARM           ZADATE  7                                           233710
      *                                                                                       233710
     C                     MOVE ZDATE     TSTAXY                                              233710
     C                     MOVEL'20'      TSTAXY                                              233710
      *                                                                                       233710
     C           BJDFIN    IFEQ 'D'                                                           233710
     C                     MOVELZDATE     WDATE1  4                                           233710
     C                     MOVE WDATE1    TSTAXM                                              233710
     C                     ELSE                                                               233710
     C                     MOVELZDATE     TSTAXM                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     MOVEL@@CTAX    TSCTRT                                              233710
     C                     MOVEL@@BRCA    TSBRCA                                              233710
     C                     MOVEL@@CUST    TSCUST                                              233710
      *                                                                                       233710
     C           WTXJA     IFEQ 'Y'                                                           233710
     C                     MOVEL@@JANO    TSJOIN                                              233710
     C                     MOVEL@@NARF    TSNAHO                                              233710
     C                     MOVEL@@INVP    TSINVP                                              233710
     C                     ELSE                                                               233710
     C**********           Z-ADD*ZERO     TSJOIN                                      233710 CSD027A
     C                     MOVE *BLANKS   TSJOIN                                             CSD027A
     C                     MOVE *BLANKS   TSNAHO                                              233710
     C                     MOVE *BLANKS   TSINVP                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
      ** Get Customer Status                                                                  233710
      *                                                                                       233710
     C                     SELEC                                                              233710
     C           @@STAT    WHEQ 'DISCL'                                                       233710
     C                     MOVEL'D'       TSSTAT                                              233710
     C           @@STAT    WHEQ 'SELF'                                                        233710
     C                     MOVEL'S'       TSSTAT                                              233710
     C           @@STAT    WHEQ 'TAXAB'                                                       233710
     C                     MOVEL'T'       TSSTAT                                              233710
     C                     ENDSL                                                              233710
      *                                                                                       233710
      ** Get Details either from SDACUSPD or SDNAHOPD                                         233710
      *                                                                                       233710
     C                     SELEC                                                              233710
     C           @@CUST    WHNE *BLANK                                                        233710
     C           @@CUST    CHAINSDACUSL1             61                                       233710
     C           *IN61     IFEQ *OFF                                                          233710
     C                     MOVELE5CNA1    TSFAMN                                              233710
     C                     MOVELE5CNA2    TSFIRN                                              233710
     C           E5CNA3    CAT  E5CNA4:1  TSSTRT                                              233710
     C                     MOVELE5ZIPC    TSZIPC                                              233710
     C                     MOVELE5CITY    TSCITY                                              233710
     C                     MOVELE5TINO    TSRTIN                                              233710
     C                     MOVELE5DBTH    TSDBTH                                              233710
     C                     MOVELE5BTHT    TSTBTH                                              233710
     C                     MOVELE5BTHC    TSCBTH                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C           @@NARF    WHNE *BLANK                                                        233710
     C           @@NARF    CHAINSDNAHOL1             61                                       233710
     C           *IN61     IFEQ *OFF                                                          233710
     C                     MOVELNHIDE1    TSFAMN                                              233710
     C                     MOVELNHIDE2    TSFIRN                                              233710
     C           NHIDE3    CAT  NHIDE4:1  TSSTRT                                              233710
     C                     MOVELNHZIPC    TSZIPC                                              233710
     C                     MOVELNHCITY    TSCITY                                              233710
     C                     MOVELNHTINO    TSRTIN                                              233710
     C                     MOVELNHDBTH    TSDBTH                                              233710
     C                     MOVELNHBTHT    TSTBTH                                              233710
     C                     MOVELNHBTHC    TSCBTH                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     ENDSL                                                              233710
      *                                                                                       233710
      ** Get Interest Payment Date                                                            233710
      *                                                                                       233710
     C***                  Z-ADDSAED      @@DAYN  50                                          233710
     C***                  EXSR ZDATE9                                                        233710
     C***                  MOVE @@VDT     TSIPDT                                              233710
      *                                                                                       233710
     C                     MOVEL@@COLC    TSRCTR                                              233710
     C                     MOVEL@@TXBS    TSTXBS                                              233710
     C                     MOVEL@@WTAC    TSWTAC                                              233710
     C                     MOVEL@@OCCY    TSOCCY                                              233710
      *                                                                                       233710
      ** Get Original Spot Rate                                                               233710
      *                                                                                       233710
     C                     MOVELTSOCCY    WCURR   3                                           233710
     C                     EXSR SRCURR                                                        233710
     C           A6MDIN    IFEQ 'D'                                                           233710
     C                     MOVELA6SPRT    TSOCSR                                              233710
     C                     ELSE                                                               233710
     C           1         DIV  A6SPRT    TSOCSR    H                                         233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     MOVEL'D'       TSOCMD                                              233710
     C                     MOVELA6NBDP    TSOCDP                                              233710
     C                     MOVELTSOCCY    TSSCCY                                              233710
     C                     MOVELTSOCSR    TSSCSR                                              233710
     C                     MOVELTSOCMD    TSSCMD                                              233710
     C                     MOVELTSOCDP    TSSCDP                                              233710
     C           TXCY      IFEQ *BLANKS                                                       233710
     C**********           MOVE A4TXCY    TXCY                                         233710 234664
     C                     MOVEL@@TXCY    TXCY                                                234664
     C                     ENDIF                                                              233710
     C                     MOVELTXCY      TSTXCY                                              233710
      *                                                                                       233710
      ** Get Currency Spot Rate                                                               233710
      *                                                                                       233710
     C                     MOVELTSTXCY    WCURR                                               233710
     C                     EXSR SRCURR                                                        233710
     C           A6MDIN    IFEQ 'D'                                                           233710
     C                     MOVELA6SPRT    TSTCSR                                              233710
     C                     ELSE                                                               233710
     C           1         DIV  A6SPRT    TSTCSR    H                                         233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     MOVEL'D'       TSTCMD                                              233710
     C                     MOVELA6NBDP    TSTCDP                                              233710
      *                                                                                       233710
      ** Get Orig/Settlement Currency Exchange Rate                                           233710
      ** Get Orig/Settlement Cross Rate                                                       233710
      *                                                                                       233710
     C                     Z-ADDTSOCSR    ZRATE1 138                                          233710
     C                     MOVE TSOCMD    ZMDI1   1                                           233710
     C                     Z-ADDTSSCSR    ZRATE2 138                                          233710
     C                     MOVE TSSCMD    ZMDI2   1                                           233710
     C                     EXSR ZXRATE                                                        233710
     C                     Z-ADDZRATEX    TSXROS                                              233710
     C                     MOVE ZMDIX     TSOSMD                                              233710
      *                                                                                       233710
      ** Get Settlement/Tax Currency Exchange Rate                                            233710
      *                                                                                       233710
     C                     Z-ADDTSSCSR    ZRATE1                                              233710
     C                     MOVE TSSCMD    ZMDI1                                               233710
     C                     Z-ADDTSTCSR    ZRATE2                                              233710
     C                     MOVE TSTCMD    ZMDI2                                               233710
     C                     EXSR ZXRATE                                                        233710
     C                     Z-ADDZRATEX    TSXRST                                              233710
     C                     MOVE ZMDIX     TSSTMD                                              233710
      *                                                                                       233710
     C                     MOVEL'S'       TSMODI                                              233710
      *                                                                                       233710
     C                     MOVEL*BLANKS   TSINST                                              233710
     C                     SELEC                                                              233710
     C           PEVT      WHEQ 'CP'                                                          233710
     C                     MOVEL'CP'      TSETYP                                              233710
     C           SESN      CAT  WINST1    TSINST                                              233710
     C           PEVT      WHEQ 'DV'                                                          233710
     C                     MOVEL'DV'      TSETYP                                              233710
     C           SESN      CAT  WINST2    TSINST                                              233710
     C           PEVT      WHEQ 'MT'                                                          233710
     C                     MOVEL'MT'      TSETYP                                              233710
     C           SESN      CAT  WINST3    TSINST                                              233710
     C           PEVT      WHEQ 'MP'                                                          233710
     C                     MOVEL'MP'      TSETYP                                              233710
     C           SESN      CAT  WINST4    TSINST                                              233710
     C                     ENDSL                                                              233710
      *                                                                                       233710
     C                     Z-ADD*ZERO     TSDLLN                                              233710
     C                     Z-ADD*ZERO     TSACOD                                              233710
     C                     Z-ADD*ZERO     TSACSQ                                              233710
      *                                                                                       233710
     C                     MOVELSESN      TSSESN                                              233710
     C                     MOVELSRPN      TSSRPN                                              233710
     C                     MOVELISNO      TSISIN                                              233710
      *                                                                                       233710
      ** Amounts in Original Currency                                                         233710
      *                                                                                       233710
     C                     Z-ADD@@TOTO    TSGINT                                              233710
      *                                                                                       233710
      ** The following fields are calculated when the customer status = T only.               233710
      *                                                                                       233710
     C                     Z-ADD*ZERO     TSTXRT                                              233710
     C                     Z-ADD*ZERO     TSTXSR                                              233710
     C           TSSTAT    IFEQ 'T'                                                           233710
     C                     Z-ADD@@TAXR    TSTXRT                                              233710
     C                     Z-ADD@@TAXA    TSTXSR                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C           TSGINT    SUB  TSTXSR    TSNINT                                              233710
      *                                                                                       233710
      ** Amounts in Settlement Currency                                                       233710
      *                                                                                       233710
     C           TSOCCY    IFEQ TSSCCY                                                        233710
     C                     Z-ADDTSPAMT    TSPAMS                                              233710
     C                     Z-ADD@@TOTO    TSGINS                                              233710
     C                     Z-ADD@@TAXA    TSTXSS                                              233710
      *                                                                                       233710
     C                     ELSE                                                               233710
     C                     Z-ADDTSPAMT    ZAMTF                                               233710
     C                     Z-ADDTSXROS    ZCRSRT                                              233710
     C                     MOVE TSOSMD    ZCRSMD                                              233710
     C                     Z-ADDTSOCDP    ZCDPF                                               233710
     C                     Z-ADDTSSCDP    ZCDPT                                               233710
     C                     EXSR ZCCYXR                                                        233710
     C                     Z-ADDZAMTT     TSPAMS                                              233710
      *                                                                                       233710
     C           TXST      MULT 100       WTAMT                                               233710
     C           @@TAXR    IFNE 0                                                             233710
     C           WTAMT     DIV  @@TAXR    TSGINS                                              233710
     C                     ELSE                                                               233710
     C                     Z-ADD0         TSGINS                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C                     Z-ADDTXST      TSTXSS                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C           TSGINS    SUB  TSTXSS    TSNINS                                              233710
      *                                                                                       233710
      ** Amounts in Tax Currency                                                              233710
      *                                                                                       233710
     C           TSSCCY    IFEQ TSTXCY                                                        233710
     C                     Z-ADDTSPAMS    TSPAMC                                              233710
     C                     Z-ADDTSGINS    TSGINC                                              233710
     C                     Z-ADDTSTXSS    TSTXSC                                              233710
      *                                                                                       233710
     C                     ELSE                                                               233710
     C                     Z-ADDTSPAMS    ZAMTF                                               233710
     C                     Z-ADDTSXRST    ZCRSRT                                              233710
     C                     MOVE TSSTMD    ZCRSMD                                              233710
     C                     Z-ADDTSSCDP    ZCDPF                                               233710
     C                     Z-ADDTSTCDP    ZCDPT                                               233710
     C                     EXSR ZCCYXR                                                        233710
     C                     Z-ADDZAMTT     TSPAMC                                              233710
      *                                                                                       233710
     C           TAXA      MULT 100       WTAMT                                               233710
     C           @@TAXR    IFNE 0                                                             233710
     C           WTAMT     DIV  @@TAXR    TSGINC                                              233710
     C                     ELSE                                                               233710
     C                     Z-ADD0         TSGINS                                              233710
     C                     ENDIF                                                              233710
     C                     Z-ADDTAXA      TSTXSC                                              233710
      *                                                                                       233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C           TSGINC    SUB  TSTXSC    TSNINC                                              233710
      *                                                                                       233710
      ** Amounts in Base Currency                                                             233710
      *                                                                                       233710
     C           TSSCCY    IFEQ BJCYCD                                                        233710
     C                     Z-ADDTSPAMS    TSPAMB                                              233710
     C                     Z-ADDTSGINS    TSGINB                                              233710
     C                     Z-ADDTSTXSS    TSTXSB                                              233710
      *                                                                                       233710
     C                     ELSE                                                               233710
     C                     Z-ADDTSPAMS    ZAMTF                                               233710
     C                     Z-ADDTSSCSR    ZCRSRT                                              233710
     C                     MOVE TSSCMD    ZCRSMD                                              233710
     C                     Z-ADDTSSCDP    ZCDPF                                               233710
      *                                                                                       233710
      ** Get Base Currency Decimal Places                                                     233710
      *                                                                                       233710
     C                     MOVELBJCYCD    WCURR                                               233710
     C                     EXSR SRCURR                                                        233710
     C                     Z-ADDA6NBDP    ZCDPI                                               233710
     C                     Z-ADDZCDPI     ZCDPT                                               233710
     C                     EXSR ZCCYXR                                                        233710
     C                     Z-ADDZAMTT     TSPAMB                                              233710
      *                                                                                       233710
     C                     Z-ADDTSGINS    ZAMTF                                               233710
     C                     Z-ADDTSSCSR    ZCRSRT                                              233710
     C                     MOVE TSSCMD    ZCRSMD                                              233710
     C                     Z-ADDTSSCDP    ZCDPF                                               233710
     C                     Z-ADDZCDPI     ZCDPT                                               233710
     C                     EXSR ZCCYXR                                                        233710
     C                     Z-ADDZAMTT     TSGINB                                              233710
      *                                                                                       233710
     C                     Z-ADDTSTXSS    ZAMTF                                               233710
     C                     Z-ADDTSSCSR    ZCRSRT                                              233710
     C                     MOVE TSSCMD    ZCRSMD                                              233710
     C                     Z-ADDTSSCDP    ZCDPF                                               233710
     C                     Z-ADDZCDPI     ZCDPT                                               233710
     C                     EXSR ZCCYXR                                                        233710
     C                     Z-ADDZAMTT     TSTXSB                                              233710
     C                     ENDIF                                                              233710
      *                                                                                       233710
     C           TSGINB    SUB  TSTXSB    TSNINB                                              233710
     C                     MOVE 'N'       TSINPR                                              233710
     C                     Z-ADD*ZERO     TSTNLU                                              233710
     C                     ADD  TSTXSB    WWTXSB                                              233710
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
     C                     MOVE *ZEROS    TSSTXB                                              CER048
     C                     MOVE *ZEROS    TSSTAC                                              CER048
     C                     MOVE *ZEROS    TSSTRT                                              CER048
     C                     MOVE *ZEROS    TSSTDO                                              CER048
     C                     MOVE *ZEROS    TSSTDS                                              CER048
     C                     MOVE *ZEROS    TSSTDT                                              CER048
     C                     MOVE *ZEROS    TSSTDB                                              CER048
     C                     MOVE *ZEROS    TSPTHU                                              CER048
     C                     MOVE *ZEROS    TSPTUT                                              CER048
      *                                                                                       CER048
     C           CER054    IFEQ 'Y'                                                           CER054
      *                                                                                       CER054
     C                     MOVE *BLANKS   TSSTCD                                              CER054
     C                     MOVE *BLANKS   TSRLAF                                              CER054
     C                     MOVE *ZEROS    TSTTXB                                              CER054
     C                     MOVE *ZEROS    TSTTAC                                              CER054
     C                     MOVE *ZEROS    TSTTRA                                              CER054
     C                     MOVE *ZEROS    TSTTDO                                              CER054
     C                     MOVE *ZEROS    TSTTDS                                              CER054
     C                     MOVE *ZEROS    TSTTDT                                              CER054
     C                     MOVE *ZEROS    TSTTDB                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER054
      *                                                                                       CER054
     C                     ENDIF                                                              CER048
      *                                                                                       233710
      ** Write record to SDCSINPD                                                             233710
      *                                                                                       233710
     C                     WRITESDCSIND0                                                      233710
      *                                                                                       233710
     C                     ENDSR                                                              233710
      *****************************************************************                       233710
      /EJECT                                                                                  235174
      *****************************************************************                       235174
      *                                                               *                       235174
      *  SREAET - EU a/c key generation for tax amount.               *                       235174
      *                                                               *                       235174
      *****************************************************************                       235174
     C           SREAET    BEGSR                                                              235174
      *                                                                                       235174
     C                     MOVEL'E'       EVTP                                                235174
     C                     MOVEL@@COLC    COTA                                                235174
     C                     MOVEL'ET'      AMCD                                                235174
     C                     Z-ADD*ZERO     EVAM                                                235709
     C                     Z-ADD*ZERO     KNCA                                                235709
     C                     Z-ADD*ZERO     KBCA                                                235709
      *                                                                                       235174
      ** Tax amount in tax ccy from POSETD                                                    235174
      *                                                                                       235174
     C           WTXJA     IFEQ 'Y'                                                           235174
     C           TSSTAT    IFEQ 'T'                                                           235709
     C           @@TCIT    MULT @@TXR1    @@TTXT    H                                         235226
     C                     CALL 'ZAMRATIO'                                                    235174
     C                     PARM           @@INVP                                              235174
     C**********           PARM           TAXA                                         235174 235709
     C                     PARM           @@TTXT                                              235709
     C                     PARM           @@TXAM 150                                          235174
     C                     Z-ADD@@TXAM    EVAM                                                235174
     C                     ENDIF                                                              235709
     C                     ELSE                                                               235174
     C                     Z-ADDTAXA      EVAM                                                235174
     C                     ENDIF                                                              235174
      *                                                                                       235174
     C                     MOVELTSTXCY    EVCY                                                235174
     C                     MOVELTSOCCY    KCCY                                                235174
      *                                                                                       235174
     C           TSTXCY    IFNE TSOCCY                                                        235174
     C           WTXJA     IFEQ 'Y'                                                           235174
     C           TSSTAT    IFEQ 'T'                                                           235709
     C           @@TCIS    MULT @@TXR1    @@TTXS    H                                         235226
     C                     CALL 'ZAMRATIO'                                                    235174
     C                     PARM           @@INVP                                              235174
     C**********           PARM           TXST                                         235174 235709
     C                     PARM           @@TTXS                                              235709
     C                     PARM           @@TXAM                                              235174
     C                     Z-ADD@@TXAM    KNCA                                                235174
     C**********           Z-ADDTSTXSB    KBCA                                         235174 235226
      *                                                                                       235226
     C           PSCU      IFEQ BJCYCD                                                        235226
     C                     Z-ADD@@TXAM    KBCA                                                235226
     C                     ELSE                                                               235226
      *                                                                                       235226
     C* Do not convert from the Other Amount if Tax and Base Ccy are equals                  235226A
     C           EVCY      IFEQ BJCYCD                                                       235226A
     C                     Z-ADDEVAM      KBCA                                               235226A
     C                     ELSE                                                              235226A
     C*                                                                                      235226A
     C                     MOVE PSCU      WCURR                                               235226
     C                     EXSR SRCURR                                                        235226
     C                     Z-ADDA6SPRT    ZRATE1                                              235226
     C                     MOVE A6MDIN    ZMDI1                                               235226
     C                     MOVE A6NBDP    ZCDPI                                               235226
      *                                                                                       235226
     C                     MOVE BJCYCD    WCURR                                               235226
     C                     EXSR SRCURR                                                        235226
     C                     Z-ADDA6SPRT    ZRATE2                                              235226
     C                     MOVE A6MDIN    ZMDI2                                               235226
     C                     MOVE A6NBDP    ZCDPO                                               235226
      *                                                                                       235226
     C                     EXSR ZXRATE                                                        235226
      *                                                                                       235226
     C                     Z-ADD@@TXAM    ZAMTCI                                              235226
     C                     Z-ADDZRATEX    ZEXCH                                               235226
     C                     MOVE ZMDIX     ZMD                                                 235226
     C                     MOVE PSCU      ZCCYI                                               235226
     C                     MOVE BJCYCD    ZCCYO                                               235226
      *                                                                                       235226
     C                     EXSR ZCONV                                                         235226
     C                     Z-ADDZAMTCO    KBCA                                                235226
     C*                                                                                      235226A
     C                     ENDIF                                                             235226A
     C*                                                                                      235226A
     C                     ENDIF                                                              235226
      *                                                                                       235226
     C                     ENDIF                                                              235709
     C                     ELSE                                                               235174
     C**********           Z-ADDTXST      KNCA                                         235174 234635
     C                     Z-ADDTXNM      KNCA                                                234635
     C                     Z-ADDWWTXSB    KBCA                                                235174
     C                     ENDIF                                                              235174
     C                     ELSE                                                               235174
     C                     Z-ADD0         KNCA                                                235174
     C                     Z-ADD0         KBCA                                                235174
     C                     ENDIF                                                              235174
      *                                                                                       235174
      ** Build output record                                                                  235174
      *                                                                                       235174
     C                     MOVE SITP      INVT                                                235174
     C                     MOVE ' '       TRTP                                                235174
      *                                                                                       235174
     C                     MOVE '  '      BOOK                                                235174
     C                     MOVE ' '       PSBS                                                235174
     C                     MOVE ' '       FIL1                                                235174
     C                     MOVE '  '      CGTP                                                235174
     C                     MOVE 'D'       RECI                                                235174
      *                                                                                       235174
     C           PPRE      IFEQ 'R'                                                           235174
     C           PSMT      ANDEQ04                                                            235174
     C           PPRE      OREQ 'P'                                                           235174
     C           PSMT      ANDEQ04                                                            235174
     C                     ELSE                                                               235174
     C                     MOVE *BLANK    STLA                                                235174
     C                     ENDIF                                                              235174
      *                                                                                       235174
     C           PPRE      IFEQ 'R'                                                           235174
     C           PSMT      ANDEQ04                                                            235174
     C           PPRE      OREQ 'P'                                                           235174
     C           PSMT      ANDEQ04                                                            235174
     C                     ELSE                                                               235174
     C                     Z-ADD0         STLT                                                235174
     C                     ENDIF                                                              235174
      *                                                                                       235174
      ** Write Generated Account Key Record                                                   235174
      *                                                                                       235174
     C                     EXSR WRITED                                                        235174
      *                                                                                       235174
     C                     ENDSR                                                              235174
      *****************************************************************                       235174
      /EJECT                                                                                  235709
      *****************************************************************                       235709
      *                                                               *                       235709
      ***SRETJA*-*Determines*the*total*EU*tax*if*all*Joint*A/c*********                235709 235226
      ************members*were*taxable.********************************                235709 235226
      *  SRETJA - Determines the total customer income of the         *                       235226
      *           Position Settlement.                                *                       235226
      *                                                               *                       235709
      *****************************************************************                       235709
     C           SRETJA    BEGSR                                                              235709
      *                                                                                       235709
     C                     Z-ADD*ZERO     WNUMER  50                                          235709
     C                     Z-ADD*ZERO     WDENOM  50                                          235709
     C                     Z-ADD*ZERO     WIPTRN 138                                          235226
     C                     Z-ADD*ZERO     WIPTRT 138                                          235226
     C                     Z-ADD*ZERO     @@TTXT 130                                          235709
     C                     Z-ADD*ZERO     @@TTXS 130                                          235709
     C                     Z-ADD*ZERO     @@TCIT 218                                          235226
     C                     Z-ADD*ZERO     @@TCIS 218                                          235226
      *                                                                                       235709
     C           KJANO     SETLLSDJACCLB                                                      235709
     C           KJANO     READESDJACCLB                 60                                   235709
      *                                                                                       235709
     C           *IN60     DOWEQ*OFF                                                          235709
      *                                                                                       235709
     C                     CALL 'ZATXCLJA'                                                    235709
      *                                                                                       235709
     C                     PARM 'S'       @@MODI                                              235709
     C                     PARM           @@TRRF                                              235709
     C                     PARM PBCA      @@BRCA                                              235709
     C                     PARM JCJANO    @@JANO                                              235709
     C                     PARM JCCUST    @@CUST                                              235709
     C                     PARM JCNAHO    @@NARF                                              235709
     C                     PARM JCINVP    @@INVP                                              235709
     C                     PARM *ZERO     @@STRD                                              235709
     C                     PARM *ZERO     @@ENDD                                              235709
     C                     PARM PAMD      @@TOTI                                              235709
     C                     PARM           @@TAXR                                              235709
     C                     PARM PNCY      @@OCCY                                              235709
     C                     PARM *BLANKS   PINTH                                               CER048
      *                                                                                       235709
     C                     PARM           @@IAED                                              235709
     C                     PARM           @@TAXA                                              235709
     C                     PARM           @@TOTO                                              235709
     C                     PARM           @@TXCY                                              235709
     C                     PARM           @@CTAX                                              235709
     C                     PARM           @@TXBS                                              235709
     C                     PARM           @@WTAC                                              235709
     C                     PARM           @@COLC                                              235709
     C                     PARM           @@STAT                                              235709
     C                     PARM           @@TRTE                                              235709
     C                     PARM           @@TXR1                                              235709
     C                     PARM           @@JAMG                                              235709
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY                                               235709
     C                     PARM           @@FILE                                              235709
     C                     PARM           @@RTRN                                              235709
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       235709
     C           @@RTRN    IFEQ 'ERROR'                                                       235709
     C                     MOVE @@FILE    DBFILE                                              235709
     C                     MOVE @@KEY     DBKEY                                               235709
     C                     Z-ADD62        DBASE                                               235709
     C                     MOVE *ON       *INU7                                               235709
     C                     MOVE *ON       *INU8                                               235709
     C                     EXSR *PSSR                                                         235709
     C                     GOTO EAUDIT                                                        235709
     C                     ENDIF                                                              235709
      *                                                                                       235709
     C           @@STAT    IFEQ 'TAXAB'                                                       235709
      *                                                                                       235709
      ** Parse the Investment Proportion.                                                     235709
      *                                                                                       235709
     C                     CALL 'ZAINVPUT'                                                    235709
     C                     PARM '*PARSE ' POPTN   7                                           235709
     C                     PARM @@INVP    PPARM1 10                                           235709
     C                     PARM           PPARM2 10                                           235709
     C                     PARM           PPARM3 10                                           235709
     C                     PARM           PRATIO 138                                          235709
      *                                                                                       235709
      ***Get*the*total*Investment*Proportion*of*all*taxable*members.***                235709 235226
      ** Get the total Inv. Prop. * Tax Rate of all taxable members.                          235226
      *                                                                                       235709
     C                     MOVE PPARM2    WTEMP   40                                          235709
     C                     Z-ADD*ZERO     WNUMER                                              235226
     C                     ADD  WTEMP     WNUMER                                              235709
     C                     MOVE PPARM3    WDENOM                                              235709
      *                                                                                       235226
     C           @@TXR1    MULT WNUMER    WIPTRN                                              235226
     C                     DIV  WDENOM    WIPTRN                                              235226
     C                     ADD  WIPTRN    WIPTRT                                              235226
      *                                                                                       235709
     C                     ENDIF                                                              235709
      *                                                                                       235709
     C           @@RTRN    IFEQ 'NOTAX'                                                       235709
     C           @@RTRN    OREQ 'TAXAB'                                                       235709
     C           KJANO     READESDJACCLB                 60                                   235709
     C                     ENDIF                                                              235709
      *                                                                                       235709
     C           @@RTRN    IFEQ 'LAST'                                                        235709
     C                     MOVE *ON       *IN60                                               235709
     C                     ENDIF                                                              235709
      *                                                                                       235709
     C                     ENDDO                                                              235709
      *                                                                                       235709
     C           WIPTRT    IFNE *ZERO                                                         235226
     C           1         DIV  WIPTRT    WTEMP2 138                                          235226
      *                                                                                       235226
      ** Total customer income in tax currency.                                               235226
      *                                                                                       235226
     C           TAXA      MULT WTEMP2    @@TCIT                                              235226
      *                                                                                       235226
      ** Total customer income in settlement currency.                                        235226
      *                                                                                       235226
     C           TXST      MULT WTEMP2    @@TCIS                                              235226
     C                     ENDIF                                                              235226
      *                                                                                       235226
     C********** WNUMER    IFNE *ZERO                                                  235709 235226
      *****************************************************************                235709 235226
      ***EU*Tax*=*WNUMER/WDEMOM***C*where******************************                235709 235226
      *****WNUMER/WDEMOM*-*Total*Investment*Proportion*(of*all*taxable*members)        235709 235226
      *****C*-*Total*EU*Tax*(if*all*members*were*taxable)**************                235709 235226
      ***Thus,*C*=*EU*Tax***WDENOM/WNUMER.*****************************                235709 235226
      *****************************************************************                235709 235226
     C**********           MOVE *BLANKS   PPARM1                                       235709 235226
     C**********           MOVE *BLANKS   PPARM2                                       235709 235226
     C**********           MOVE WDENOM    PPARM1                                       235709 235226
     C**********           MOVE WNUMER    PPARM2                                       235709 235226
      *****************************************************************                235709 235226
      ***Build*the*inverse*Investment*Proportion.**********************                235709 235226
      *****************************************************************                235709 235226
     C**********           CALL 'ZAINVPUT'                                             235709 235226
     C**********           PARM '*BUILD ' POPTN                                        235709 235226
     C**********           PARM           PPARM1                                       235709 235226
     C**********           PARM           PPARM2                                       235709 235226
     C**********           PARM           PPARM3                                       235709 235226
     C**********           PARM           PRATIO                                       235709 235226
      *****************************************************************                235709 235226
      ***Total*EU*Tax*if*all*members*were*taxable*in*******************                235709 235226
      ***...Tax*Currency.**********************************************                235709 235226
      *****************************************************************                235709 235226
     C**********           CALL 'ZAMRATIO'                                             235709 235226
     C**********           PARM           PPARM3                                       235709 235226
     C**********           PARM           TAXA                                         235709 235226
     C**********           PARM           @@TXAM                                       235709 235226
     C**********           Z-ADD@@TXAM    @@TTXT                                       235709 235226
      *****************************************************************                235709 235226
      ***...Settlement*Currency.***************************************                235709 235226
      *****************************************************************                235709 235226
     C**********           CALL 'ZAMRATIO'                                             235709 235226
     C**********           PARM           PPARM3                                       235709 235226
     C**********           PARM           TXST                                         235709 235226
     C**********           PARM           @@TXAM                                       235709 235226
     C**********           Z-ADD@@TXAM    @@TTXS                                       235709 235226
      *****************************************************************                235709 235226
     C**********           ENDIF                                                       235709 235226
      *                                                                                       235709
     C                     ENDSR                                                              235709
      *****************************************************************                       235709
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* SUBROUTINE TO WRITE RECORD TO SEKEYD FILE                     *
     C*                                                               *
     C*****************************************************************
     C*
     C           WRITED    BEGSR                           ** WRITED **
     C*
     C** ONLY OUTPUT A/C KEY RECORD IF EVENT AMOUNT NON-ZERO
     C/COPY WNCPYSRC,SE2300C032
     C*
     C           EVAM      IFNE 0
     C*                                                                   E37536
     C           NEGI      IFEQ 'N'                                       E37536
     C           EVAM      ANDLT0                                         E37536
     C                     Z-SUBEVAM      EVAM                            E37536
     C                     END                                            E37536
     C*
     C* SET UP KEY FOR SEKEYD RECORD
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE SITP      INVT
     C                     MOVE *BLANK    TRTP
     C                     MOVE PSEB      SEBR                            S01117
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'N'                                       CAC002
     C                     MOVE PPFC      PRFC                            S01117
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C***********C1DI      IFEQ 'M'                                       E14713
     C***********          MOVE *BLANKS   PORT                            E14713
     C           C1DI      IFNE 'S'                                       E14713
     C           C1DI      ANDNE'D'                                       E14713
     C***********C1DI      ANDNE'I'                                       E16359
     C                     MOVE 'X'       PORT                            E14713
     C                     ELSE
     C                     MOVELC1DI      PORT
     C                     END
     C***********C1DI      IFEQ 'M'                                       E16359
     C***********          MOVE *BLANKS   PORT                            E16359
     C***********          END                                            E16359
     C           WWCOAT    IFEQ ' '                                       CSE007
     C                     MOVE FIL1      TRTP
     C                     ENDIF                                          CSE007
     C           CIAK      IFEQ 'Y'
     C           SCVI      ANDEQ'Y'                                       E15430
     C                     MOVE SCVI      CNVI
     C                     ELSE
     C                     MOVE *BLANK    CNVI
     C                     END
     C*************        MOVE 'S'       MRKT                            E15685
     C                     MOVE MKTI      MRKT                            E15685
     C*
     C* SET UP REST OF SEKEYD RECORD
     C*
     C                     Z-ADD0         TRFR
     C**********           Z-ADDPCPY      CSTN                                                CSD027
     C                     MOVE PCPY      CSTN                                                CSD027
     C***********          MOVELPBCH      BRCH                            S01117
     C                     MOVELPBCA      BRHA                            S01117
     C***********          MOVE 01        ASQN                            E18803
     C/COPY WNCPYSRC,SE2300C025
     C                     MOVE 00        ASQN                            E18803
     C/COPY WNCPYSRC,SE2300C026
     C           S01512    IFEQ 'Y'                                       S01512
     C                     Z-ADDPSVL      EVDT                            S01512
     C                     ELSE                                           S01512
     C                     Z-ADDPDUD      EVDT
     C                     END                                            S01512
     C           EVCY      IFEQ *BLANKS
     C                     MOVE PNCY      EVCY
     C                     END
     C                     MOVE '0'       RVRS
     C           S01496    IFEQ 'Y'                                       S01496
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           WWRECI    IFEQ 'R'                                       S01496
     C                     MOVE '1'       RVRS                            S01496
     C                     ENDIF                                          S01496
     C                     ENDIF                                          S01496
     C*                                                                                       225599
     C           PRECI     IFEQ '*'                                                           225599
     C                     MOVE '1'       RVRS                                                225599
     C                     END                                                                225599
     C*                                                                   E19770
     C* NEED ISSUER FOR POSTING REF 4.                                    E19770
     C*                                                                   E19770
     C*****                Z-ADD0         ISSR                            E19770
     C*                                                                   E19770
     C*********************Z-ADD0         KCUST                           E19975
     C**********           Z-ADDPCPY      KCUST                                        055942 CSD027
     C                     MOVE PCPY      KCUST                                               CSD027
     C                     MOVE PSSH      SESH
     C***********          MOVELPNCY      KCCY                            S01509
     C                     MOVELNMCY      KCCY                            S01509
     C/COPY WNCPYSRC,SE2300C033
     C*
     C** COUNT RECORDS AND ADD EVENT AMOUNT INTO HASH TOTAL
     C*
     C                     Z-ADDEVAM      ZZAMT
     C                     EXSR ZHASH
     C                     ADD  1         OREC    50
     C*                                                                   S01486
     C**  Output Portfolio Ref. for acct. keys for Portfolio customers.   S01486
     C*                                                                   S01486
     C                     MOVE *BLANKS   PTFR                            S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   S01486
     C           PORT      IFEQ 'S'                                       S01486
     C           PORT      OREQ 'D'                                       S01486
     C           AMCD      IFEQ 'DI'                                      S01486
     C           AMCD      OREQ 'PP'                                      S01486
     C           AMCD      OREQ 'CV'                                      S01486
     C           AMCD      OREQ 'SA'                                      046386
     C                     MOVE RNPTFR    PTFR                            S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C                     Z-ADDPTNLU     TNLU                            S01486
     C                     MOVE PEVT      PEV1                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                                     AR864714
     C           CER049    IFEQ 'Y'                                                         AR864714
     C                     MOVE PEVT      PEV1                                              AR864714
     C           S01512    IFEQ 'Y'                                                        AR942839A
     C                     MOVELPDUD      STLAQQ                                           AR942839A
     C                     ENDIF                                                           AR942839A
     C                     ENDIF                                                            AR864714
      *                                                                   CAC002
      ** If Analytical Accounting is installed, define the profit         CAC002
      ** centre for each posting.                                         CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
     C           AMCD      IFNE 'CP'                                      CAC002
     C           AMCD      ANDNE'CR'                                      CAC002
     C           AMCD      ANDNE'FP'                                      CAC002
     C           AMCD      ANDNE'FR'                                      CAC002
      *                                                                   CAC002
     C           C1DI      IFEQ 'S'                                       CAC002
     C           C1DI      OREQ 'D'                                       CAC002
     C                     MOVE PPFC      PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE BVSEPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C/COPY WNCPYSRC,SE2300C030
     C*
      ** Process the Pay/Receive Settlement Instructions.                                     CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRPRSI                                                        CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     WRITESEKEYDF
      *                                                                                       CGL020
      ** Clear the Fee Fields to avoid unnecessary side effects.                              CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVE *BLANK    F1FFLG                                              CGL020
     C                     Z-ADD0         F1FVAL                                              CGL020
     C                     Z-ADD0         F1FPCT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C/COPY WNCPYSRC,SE2300C031
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* CLEAR - SUBROUTINE TO CLEAR FIELDS BEFORE GENERATING RECORD   *
     C*                                                               *
     C*****************************************************************
     C*
     C           CLEAR     BEGSR                           ** WRITED **
     C*
     C                     MOVE 'D'       RECI
     C                     MOVEL*BLANKS   ACKY
     C                     Z-ADD0         TRFR
     C**********           Z-ADD0         CSTN                                                CSD027
     C                     MOVE *BLANKS   CSTN                                                CSD027
     C***********          MOVEL*BLANKS   BRCH                            S01117
     C                     MOVEL*BLANKS   BRHA                            S01117
     C                     Z-ADD0         ASQN
     C                     Z-ADD0         EVDT
     C                     Z-ADD0         EVAM
     C                     MOVEL*BLANKS   EVCY
     C                     Z-ADD0         STLT
     C                     MOVEL*BLANKS   STLA
     C                     MOVEL*BLANKS   SEBR                            S01117
     C                     MOVE '0'       RVRS
     C*
     C* NEED ISSUER FOR POSTING REF 4.                                    E19770
     C*
     C**********           Z-ADD0         ISSR                            E19770
     C*                                                                   E19770
     C*********************Z-ADD0         KCUST                           E19975
     C                     Z-ADD0         KNCA
     C                     MOVEL*BLANKS   KCCY
     C                     Z-ADD0         KBCA
     C                     MOVEL*BLANKS   SESH
     C                     MOVEL*BLANKS   PRFC                            S01117
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*   SKDSR  - SUBROUTINE FOR ERROR HANDLING OF SEKEYD            *
     C*                                                               *
     C*****************************************************************
     C*
     C           SKDSR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SEKEY'   DBFILE
     C                     MOVELACKY      DBKEY            *****************
     C                     Z-ADD8         DBASE            ** DB ERROR 08 **
     C                     MOVE STSSKD    DBSTAT           *****************
     C                     OUT  LDA                                       S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/SPACE 3
     C*****************************************************************
     C*                                                               *
     C*   SKASR  - SUBROUTINE FOR ERROR HANDLING OF SEKEYA            *
     C*                                                               *
     C*****************************************************************
     C*
     C           SKASR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SEKEY'   DBFILE
     C                     MOVEL'AUDIT'   DBKEY            *****************
     C                     Z-ADD9         DBASE            ** DB ERROR 09 **
     C                     MOVE STSSKA    DBSTAT           *****************
     C                     OUT  LDA                                       S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************   E14884
     C*                                                               *   E14884
     C*   POSSR  - SUBROUTINE FOR ERROR HANDLING OF POSET             *   E14884
     C*                                                               *   E14884
     C*****************************************************************   E14884
     C*                                                                   E14884
     C           POSSR     BEGSR                                          E14884
     C*                                                                   E14884
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'POSET'   DBFILE                          E14884
     C                     MOVELPSSH      DBKEY            ***************E14884
     C***********          Z-ADD10        DBASE   **DB*ERROR*10*   E14884 E20651
     C                     Z-ADD13        DBASE            * DB ERROR 13 *E20651
     C                     MOVE STSPOS    DBSTAT           ***************E14884
     C                     OUT  LDA                                       S01117
     C                     MOVE '1'       *IN87                           E14884
     C                     SETON                     99U7U8               E14884
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EAUDIT                                    E14884
     C*                                                                   E14884
     C                     ENDSR                                          E14884
     C*                                                                   E14884
     C*                                                                   E14884
     C*****************************************************************   E14884
      /SPACE 3
     C*****************************************************************   E14884
     C*                                                               *   E14884
     C*   PAUSR  - SUBROUTINE FOR ERROR HANDLING OF POSETA AUDIT      *   E14884
     C*                                                               *   E14884
     C*****************************************************************   E14884
     C*                                                                   E14884
     C           PAUSR     BEGSR                                          E14884
     C*                                                                   E14884
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'POSET'   DBFILE                          E14884
     C                     MOVEL'AUDIT'   DBKEY            ***************E14884
     C                     Z-ADD11        DBASE            **DB ERROR 11**E14884
     C                     MOVE STSPAU    DBSTAT           ***************E14884
     C                     OUT  LDA                                       S01117
     C                     MOVE '1'       *IN87                           E14884
     C                     SETON                     99U7U8               E14884
     C                     EXSR *PSSR                                     S01117
     C                     GOTO EAUDIT                                    E14884
     C*                                                                   E14884
     C                     ENDSR                                          E14884
     C*                                                                   E14884
     C*****************************************************************   E14884
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      * SRSFSA - Sets the Fee Fields for SA (Settlement Amount)       *                       CGL020
      *          Account Keys.                                        *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
     C           SRSFSA    BEGSR                                                              CGL020
      *                                                                                       CGL020
      ** Set the Fee Flag.                                                                    CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       F1FFLG                                              CGL020
      *                                                                                       CGL020
      ** Calculate the Fee Value.                                                             CGL020
      *                                                                                       CGL020
     C                     Z-ADD0         WFVAL  150                                          CGL020
     C                     ADD  PCHA      WFVAL                                               CGL020
     C                     ADD  PCAM      WFVAL                                               CGL020
     C                     Z-ADDWFVAL     F1FVAL                                              CGL020
      *                                                                                       CGL020
      ** Calculate the Fee Percent.                                                           CGL020
      *                                                                                       CGL020
     C                     Z-ADD0         WFPCT  308                                          CGL020
     C           PAMD      IFNE 0                                                             CGL020
     C           F1FVAL    DIV  PAMD      WFPCT                                               CGL020
     C                     MULT 100       WFPCT                                               CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDWFPCT     F1FPCT                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *****************************************************************                       CGL020
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      * SRPRSI - Handles the Pay/Receieve Settlement Instructions.    *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
     C           SRPRSI    BEGSR                                                              CGL020
      *                                                                                       CGL020
      ** If the Settlement Account is equal to blanks, clear the                              CGL020
      ** Settlement Instruction fields. Otherwise, call the                                   CGL020
      ** Securities Settlement Fields Extractor.                                              CGL020
      *                                                                                       CGL020
     C           STLA      IFEQ *BLANKS                                                       CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   F1RACT                                              CGL020
     C                     MOVE *BLANKS   F1RCTY                                              CGL020
     C                     MOVE *BLANKS   F1RBNK                                              CGL020
     C                     MOVE *BLANKS   F1RCDE                                              CGL020
     C                     MOVE *BLANKS   F1PACT                                              CGL020
     C                     MOVE *BLANKS   F1PCTY                                              CGL020
     C                     MOVE *BLANKS   F1PBNK                                              CGL020
     C                     MOVE *BLANKS   F1PCDE                                              CGL020
     C                     MOVE *BLANKS   F1DACT                                              CGL020
     C                     MOVE *BLANKS   F1DCTY                                              CGL020
     C                     MOVE *BLANKS   F1DBNK                                              CGL020
     C                     Z-ADD0         F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
      *                                                                                       CGL020
      ** Set the ZAAMLSETSE parameters.                                                       CGL020
      *                                                                                       CGL020
     C                     EXSR SRSZIP                                                        CGL020
      *                                                                                       CGL020
      ** Execute the actual call.                                                             CGL020
      *                                                                                       CGL020
     C                     CALL SETSE                                                         CGL020
     C                     PARM           PINPT                                               CGL020
     C                     PARM           PINPA                                               CGL020
     C                     PARM           PACIN                                               CGL020
     C                     PARM           PACIA                                               CGL020
     C                     PARM           PBENM                                               CGL020
     C                     PARM           PBENA                                               CGL020
     C                     PARM           PDEBT  10                                           CSW210
     C                     PARM           PDEBTA 35                                           CSW210
     C                     PARM           PCTRP                                               CGL020
     C                     PARM           PFAC                                                CGL020
     C                     PARM           PSEA                                                CGL020
     C                     PARM           PSEB                                                CGL020
     C                     PARM           EVCY                                                CGL020
     C                     PARM           F1RACT                                              CGL020
     C                     PARM           F1RCTY                                              CGL020
     C                     PARM           F1RBNK                                              CGL020
     C                     PARM           F1RCDE                                              CGL020
     C                     PARM           F1PACT                                              CGL020
     C                     PARM           F1PCTY                                              CGL020
     C                     PARM           F1PBNK                                              CGL020
     C                     PARM           F1PCDE                                              CGL020
     C                     PARM           F1DACT                                              CGL020
     C                     PARM           F1DCTY                                              CGL020
     C                     PARM           F1DBNK                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDPDUD      F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   F1TICK                                              CGL020
     C                     MOVE *BLANKS   F1EXCH                                              CGL020
     C                     Z-ADD0         F1NOML                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *****************************************************************                       CGL020
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      * SRSZIP - Sets the ZAAMLSETSE input parameters.                *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
     C           SRSZIP    BEGSR                                                              CGL020
      *                                                                                       CGL020
      ** Clear the initial input parameters.                                                  CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   PINPT  10                                           CGL020
     C                     MOVE *BLANKS   PINPA  35                                           CGL020
     C                     MOVE *BLANKS   PACIN  10                                           CGL020
     C                     MOVE *BLANKS   PACIA  35                                           CGL020
      *                                                                                       CGL020
      ** Set the POSETDY2 Key Fields.                                                         CGL020
      *                                                                                       CGL020
     C                     MOVE PBCA      KPBCA                                               CGL020
     C                     MOVE PSSH      KPSSH                                               CGL020
     C**********           Z-ADDPCPY      KPCPY                                        CGL020 CSD027
     C                     MOVE PCPY      KPCPY                                               CSD027
     C                     Z-ADDPDUD      KPDUD                                               CGL020
     C                     MOVE PEVT      KPEVT                                               CGL020
      *                                                                                       CGL020
      ** Search for Extended Settlements.                                                     CGL020
      *                                                                                       CGL020
     C           KPSTES    CHAINPOSETDY2             70                                       CGL020
      *                                                                                       CGL020
      ** Get the Account for Payment details if a record was found.                           CGL020
      *                                                                                       CGL020
     C           *IN70     IFEQ '0'                                                           CGL020
     C                     MOVE P2AFPN    PBENM  10                                           CGL020
     C                     MOVE P2AFPL    PBENA  35                                           CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE *BLANKS   PBENM                                               CGL020
     C                     MOVE *BLANKS   PBENA                                               CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      ** Set the Counterparty parameter.                                                      CGL020
      *                                                                                       CGL020
     C**********           Z-ADDPCPY      PCTRP                                        CGL020 CSD027
     C                     MOVE PCPY      PCTRP                                               CSD027
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *****************************************************************                       CGL020
      /EJECT
     C********************************************************************S01117
     C*                                                                   S01117
     C*   *PSSR SR.- DATABASE ERROR SUBROUTINE                            S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C           *PSSR     BEGSR                           ** *PSSR SR ** S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANK                                    S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C/COPY WNCPYSRC,SE2300C016
     C/EJECT                                                              S01117
     C/COPY ZSRSRC,ZACCH                                                  088939
      /EJECT                                                              088939
     C/COPY ZSRSRC,ZCONVZ1
      /EJECT                                                              088939
     C/COPY ZSRSRC,ZFWDT                                                  088939
      /EJECT
AW   C/COPY ZSRSRC,ZHASHZ3
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT
     C*COPY*ZSRSRC,ZSYSTMZ1***                                            S01117
      /EJECT
      ***
     C/COPY WNCPYSRC,SE2300C029
     C/COPY ZSRSRC,ZCCYCN                                                 183665
     C/COPY ZSRSRC,ZXRATEZ1                                                                   233710
     C/COPY ZSRSRC,ZCCYXR                                                                     233710
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
