000100200616     H        1
000200200616      *****************************************************************
000300200616/*STD *  RPGBASE                                                      *
000400200616/*EXI *  TEXT('Midas SE Generate a/c keys - posn settlemts')          *
000500200616     F*****************************************************************
000600200616     F*                                                               *
000700200616     F*  Midas - Securities Trading Module                            *
000800200616     F*                                                               *
000900200616     F*  SE2300  - GENERATE A/C KEYS - POSITION SETTLEMENTS           *
001000200616     F*                                                               *
001100200616     F*  Function: Generate Account Keys from authorised Position     *
001200200616     F*   (COB)    Settlements, in respect of amounts due on client   *
001300200616     F*            and depot holdings                                 *
001400200616     F*                                                               *
001500200616     F*  Called by: SEC0604A - Generate A/C Keys- Position Settlement *
001600200616     F*                                                               *
001700200616      *  (c) Finastra International Limited 2001                      *
001800200616     F*                                                               *
001900200616     F*                                                               *
001901200616      *  Last Amend No. AR324886           Date 01JUN20               *
002000200616      *  PREV Amend No. CER050             Date 16Jun19               *
002100200616      *                 MD054041           Date 20Aug19               *
002200200616      *                 MD046248           Date 27Oct17               *
002300200616      *                 MD037742A          Date 09Jun16               *
002400200616      *                 215959             Date 21Mar16               *
002500200616      *                 CER071             Date 01Aug16               *
002600200616      *                 CER070             Date 19Aug14               *
002700200616      *                 CLE134             Date 01Aug12               *
002800200616      *                 AR942839A          Date 16Apr12               *
002900200616      *                 AR864714           Date 17Nov11               *
003000200616      *                 CSW210             Date 04May10               *
003100200616      *                 CER059             Date 19Jul10               *
003200200616      *                 BUG26839           Date 05Jan10               *
003300200616      *                 CER045             Date 20Jul09               *
003400200616      *                 CER054             Date 07Apr09               *
003500200616      *                 BUG23123           Date 09Mar09               *
003600200616      *                 BUG22911           Date 17Feb09               *
003700200616      *                 CER048             Date 19May08               *
003800200616      * Bank Fusion Midas 1.4 Base -----------------------------------*
003900200616      * Midas Plus 1.4 Base 04 ---------------------------------------*
004000200616      *                 247782A            Date 07Jun07               *
004100200616      *                 247966             Date 23May07               *
004200200616      *                 247782             Date 15May07               *
004300200616      * Midas Plus 1.4 Base ------------------------------------------*
004400200616      * Midas Plus 1.3 ----------- Base ------------------------------*
004500200616      *                 CSD031             Date 10Apr06               *
004600200616      *                 CSD027A            Date 17May06               *
004700200616      *                 CSD027             Date 09Dec05               *
004800200616      *                 235226A            Date 07Sep05               *
004900200616      *                 235226             Date 07Sep05               *
005000200616      *                 234715             Date 31Aug05               *
005100200616      *                 234664             Date 15Sep05               *
005200200616      *                 235709             Date 26Aug05               *
005300200616      *                 235174             Date 27Jul05               *
005400200616      *                 235141             Date 22Jul05               *
005500200616      *                 234635             Date 04Jul05               *
005600200616      *                 233710             Date 06Jun05               *
005700200616      *                 CSE071             Date 19Jul05               *
005800200616      *                 228045             Date 08Jul04               *
005900200616      *                 225599             Date 10Mar04               *
006000200616      *                 223108             Date 04Dec03               *
006100200616      *                 220547             Date 20Aug03               *
006200200616      *                 219490             Date 24Jul03               *
006300200616      *                 CGP001             Date 14Oct03               *
006400200616      *                 CGL020             Date 12Dec02               *
006500200616      * Midas Release 4.01.02 ----------------------------------------*
006600200616      *                 194195             Date 15Apr02               *
006700200616      * Midas Release 4.01 -------------------------------------------*
006800200616      *                 195362             Date 10Sep01               *
006900200616      * Midas Release 4 --------------- Base -------------------------*
007000200616      * Midas DBA 3.05 -----------------------------------------------*
007100200616      *                 183665             Date 06Mar01               *
007200200616      *                 188794             Date 19Jan01               *
007300200616      * Midas DBA 3.04 -----------------------------------------------*
007400200616      *                 CSE023             Date 14Aug00               *
007500200616      * Midas DBA 3.03 -----------------------------------------------*
007600200616      *                 173004             Date 09Jun00               *
007700200616      *                 161794             Date 27Dec99               *
007800200616      * Midas DBA 3.02 -----------------------------------------------*
007900200616     F*                 CPB001             Date 18Jun99               *
008000200616      * Midas DBA 3.00 ---------------- Base -------------------------*
008100200616      *                 151544             Date 31DEC98               *
008200200616      *                 CEU017             Date 03Avr98               *
008300200616      *                 CSE007             Date 03Feb98               *
008400200616     F*                 115469             DATE 23SEP97               *
008500200616     F*                 CAC002             Date 12Sep96               *
008600200616     F*                 088939             Date 19Aug96               *
008700200616     F*                 091407             Date 13Aug96               *
008800200616     F*                 101925             DATE 12APR96               *
008900200616     F*                 094232             DATE 06OCT95               *
009000200616     F*                 087178             DATE 15JUN95               *
009100200616     F*                 046386             DATE 29NOV94               *
009200200616     F*                 S01486             DATE 21NOV94               *
009300200616     F*                 S01496             DATE 15JUL94               *
009400200616     F*                 S01509             DATE 27OCT94               *
009500200616     F*                 S01512             DATE 10AUG94               *
009600200616     F*                 065461             DATE 08AUG94               *
009700200616     F*                 067406             DATE 25FEB94               *
009800200616     F*                 S01447             DATE 26NOV93               *
009900200616     F*                 S01446             DATE 26NOV93               *
010000200616     F*                 055942             DATE 27MAY93               *
010100200616     F*                 052254             DATE 10JAN94               *
010200200616     F*                 S01401             DATE 16JUN93               *
010300200616     F*                 S01397             DATE 10SEP92               *
010400200616     F*                 E37532             DATE 24MAR92               *
010500200616     F*                 E37241             DATE 24MAR92               *
010600200616     F*                 S01220             DATE 12NOV90               *
010700200616     F*                 S01117             DATE 02NOV90               *
010800200616     F*                 S01269             DATE 24OCT90               *
010900200616     F*                 E21244             DATE 26FEB90               *
011000200616     F*                 E21245             DATE 26FEB90               *
011100200616     F*                 E20651             DATE 30JAN90               *
011200200616     F*                 E19975             DATE 23NOV89               *
011300200616     F*                 E19770             DATE 25OCT89               *
011400200616     F*                 E18803             DATE 17AUG 89              *
011500200616     F*                 E16359             DATE 27/06/89              *
011600200616     F*                 E16776             DATE 08/03/89              *
011700200616     F*                 E15685             DATE 20/10/88              *
011800200616     F*                 E15687             DATE 20/10/88              *
011900200616     F*                 E15825             DATE 19/10/88              *
012000200616     F*                 E15430             DATE 28/09/88              *
012100200616     F*                 E15329             DATE 22/09/88              *
012200200616     F*                 E14884             DATE 08/09/88              *
012300200616     F*                 E14723             DATE 07/09/88              *
012400200616     F*                 E14840             DATE 06/09/88              *
012500200616     F*                 E14888             DATE 01/09/88              *
012600200616     F*                 E14713             DATE 16/08/88              *
012700200616     F*                                                               *
012800200616     F*---------------------------------------------------------------*
012900200616     F*                                                               *
012901200616      *  AR324886 - Implement 4-eyes processing in Position           *
012902200616      *             Settlement Maintenance.                           *
013000200616      *  CER050 - Annualised Percentage Rate (Recompile)              *
013100200616      *  MD054041 - Component SEC0601 seq. 00007 failed due to trailer*
013200200616      *             imbalance in file POSETA.                         *
013300200616      *           - Ensure number of live records (field NLRB) should *
013400200616      *             be updated by passing field NORE where matured    *
013500200616      *             records are deducted.                             *
013600200616      *  MD046248 - Finastra Rebranding                               *
013700200616      *  MD037742A - Security diary events - pool factor reversal.    *
013800200616      *              Postings are not generated after COB. Allow      *
013900200616      *              position settlements generated on rundate to be  *
014000200616      *              posted immediately after COB.                    *
014100200616      *  215959 - Truncation error on event amount in SE2450P3.       *
014200200616      *           Recompiled due to changes in PF/SEKEYD.             *
014300200616      *         - Applied for MD-37439.                               *
014400200616      *  CER071 - BAIS - Legal Form field (Recompile)                 *
014500200616      *  CER070 - BuBa Reporting / BAIS V.1.16.0 (Recompile)          *
014600200616      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
014700200616      *  AR942839A - No movement is posted in Stamp Tax Movement      *
014800200616      *              enquiry for Position Settlements                 *
014900200616      *  AR864714 - No Movements is posted for position settlement    *
015000200616      *  CSW210 - SWIFT 2010 Changes                                  *
015100200616      *  CER059 - German Feature Upgrade to Delhi                     *
015200200616      *  BUG26839 - JA1_Threshold limit of the main joint customer was*
015300200616      *             utilized by the member                            *
015400200616      *  CER045 - German Features - Reporting Bundesbank (Recompile)  *
015500200616      *  CER054 - German Features - Church Tax                        *
015600200616      *  BUG23123 - Report: Does not show Retail Account Number       *
015700200616      *                     Date is not Midas Standard Date           *
015800200616      *                     Period should be actual int. calc. period *
015900200616      *                     Secondary Tax amount is not printed       *
016000200616      *                     Added field TSSLID                        *
016100200616      *                     (Recompile)                               *
016200200616      *  BUG22911 - Changes for Correct Tax Calculation               *
016300200616      *  CER048 - German Features - Taxes                             *
016400200616     F*  247782A- Position settlement will be also posted if EVCD     *
016500200616     F*           greater or equal to PSVL if S01512 not 'on'         *
016600200616      *  247966 - Increment field IREC by 1 if RECI <> '*' when       *
016700200616      *           features S01496, CSE007 and CEU017 are OFF.         *
016800200616     F*  247782 - Position settlement will be also posted if value    *
016900200616     F*           date reached and also S01512 not 'active'.          *
017000200616      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
017100200616      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
017200200616      *  CSD027 - Conversion Of Customer Number to Alpha              *
017300200616      *  235226A- For ET Keys, if tax Ccy equal Base Ccy, keep Event  *
017400200616      *           amount for the Base Ccy Equivalent, otherwise lost  *
017500200616      *           of precision                                        *
017600200616      *  235226 - Consider tax rates of the Joint A/c members.        *
017700200616      *  234715 - Correction to fix 225599.                           *
017800200616      *  234664 - Failed component SEC0604A. DB erorr 30 occurred     *
017900200616      *           due to blank 'tax currency'.  Instead of A4TXCY,    *
018000200616      *           move the value of output field @@TXCY to TXCY.      *
018100200616      *  235709 - Wrong tax amount on Joint Account.                  *
018200200616      *  235174 - Trade a/c keys do not consider Joint A/c country.   *
018300200616      *  235141 - Incorrect currency code for US Treaty Withholding   *
018400200616      *           tax                                                 *
018500200616      *  234635 - Incorrect amount in 'ET' and 'NI' key               *
018600200616      *  233710 - Generation of position settlement cust income and   *
018700200616      *           account key                                         *
018800200616      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
018900200616      *  228045 - Review coding of 225599 as Foob in SE2580           *
019000200616      *           and RECI not update in POSETD                       *
019100200616      *  225599 - Deletion of a position settlement (not authorised   *
019200200616      *           and not posted) will generate account keys and then *
019300200616      *           will post reversal of Transitory accounts amounts   *
019400200616      *  223108 - Settlement amount is negative after COB. Reversal   *
019500200616      *           of sign should only be for account key postings.    *
019600200616      *  220547 - Reversal processing. Review the fix 219490.         *
019700200616      *  219490 - Settlement amount sign of reversed position sett is *
019800200616      *           is also reversed. Fix is to reverse the actual amt. *
019900200616      *  CGP001 - Global Processing.                                  *
020000200616      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
020100200616      *           Information                                         *
020200200616      *  194195 - Incorrect number of decimal places used when nominal*
020300200616      *           currency is not equal to settlement currency.       *
020400200616      *  195362 - Account keys generated with missing country code.   *
020500200616      *           Ensure correct value of CSE023 for execution of     *
020600200616      *           correct subroutine.                                 *
020700200616      *  183665 - Posting for Position Settlement for DEM shows amount*
020800200616      *           in EUR. Amount should be converted if nominal ccy   *
020900200616      *           differs from due currency. Applied fix 162379. Also *
021000200616      *           added code to check if NMCY NE BCCY for base ccy amt*
021100200616      *  188794 - Country of Treaty Tax Code not in A/C Key.          *
021200200616      *  CSE023 - Treaty Withholding Tax                              *
021300200616     F*  173004 - Condition coupon payment sign on the client's       *
021400200616     F*           classification.                                     *
021500200616      *  161794 - Only Nostro Settlements should be forward dated if  *
021600200616      *           value day falls on a holiday for settlement ccy.    *
021700200616     F*  CPB001 - 'Private Banking' Module                            *
021800200616      *  151544 - USE SETTLEMENT AMOUNT IN SETTLEMENT CURRENCY TO     *
021900200616      *           BASE CURRENCY EQUIVALENT AMOUNT                     *
022000200616     F*  CEU017 - Securities Redenomination Euro Changes              *
022100200616     F*  CSE007 - Corporate Actions                                   *
022200200616     F*  115469 - Settlement amount for short position should be      *
022300200616     F*           negative.                                           *
022400200616     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
022500200616     F*           If Analytical Accounting is available, generate a   *
022600200616     F*           new margin account key and define the profit centre *
022700200616     F*           for each posting.                                   *
022800200616     F*  088939 - If due date read is a holiday, process it only if   *
022900200616     F*           next working day is less than or equal to run date. *
023000200616     F*  091407 - Position settlement account keys posted to suspense *
023100200616     F*           rather than settlement account.                     *
023200200616     F*  101925 - Settlement amount is posted gross - reinstate the   *
023300200616     F*           code that subtracts the charge and commission       *
023400200616     F*           amounts from nominal ccy equivalent.                *
023500200616     F*  094232 - Nominal currency equivalent is in settlement ccy    *
023600200616     F*  087178 - Remove computation of settlement amount, and use    *
023700200616     F*           PSAT from file which already has charges, commis-   *
023800200616     F*           sions and taxes added to or deducted from it.       *
023900200616     F*  046386 - Allow cross portfolio position settlements          *
024000200616     F*  S01486 - Incorporation of PM Enhancements (S01313)           *
024100200616     F*           048449 included                                     *
024200200616     F*  S01496 - Incorporation of Jyske Enhancements (S10982),       *
024300200616     F*           (S10978) and (S10985).                              *
024400200616     F*  S01509 - Value currency to be currency of issuer of payments *
024500200616     F*  S01512 - Add value date to Position Settlements              *
024600200616     F*  065461 - Only output the A/C keys if the position settlement *
024700200616     F*           generated date is not the run date to prevent the   *
024800200616     F*           keys to be generated on the wrong date.             *
024900200616     F*  067406 - Use rates off POSETD record rather than Spot Rate.  *
025000200616     F*           Also reduce accesses to TABTG10.                    *
025100200616     F*  S01447 - Withholding Tax amendment                           *
025200200616     F*           Generate Position Settlement key net of tax paid.   *
025300200616     F*           Generate tax keys for various types of tax,         *
025400200616     F*           ('WD', 'WN', 'WR' and 'WX').                        *
025500200616     F*  S01446 - Customer Commissions (Courtage) amendment           *
025600200616     F*           Use Charge Code Group on account key,               *
025700200616     F*           if Autocharging is on.                              *
025800200616     F*  055942 - OUTPUT DEPOT CUSTOMER NUMBER ON KEYS                *
025900200616     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
026000200616     F*           to 10,9                                             *
026100200616     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
026200200616     F*          - Recompiled due to changes to files.                *
026300200616     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
026400200616     F*          - Recompiled due to changes to files.                *
026500200616     F*  E37532 - Negative account keys should not have negative      *
026600200616     F*           amounts too                                         *
026700200616     F*  E37241 - Last Change Date and Type on POSETD overwritten     *
026800200616     F*  S01220 - STRATEGIC RISK MANAGEMENT                           *
026900200616     F*           Recompiled over changed PF/SECTYD                   *
027000200616     F*  S01117 - MULTI-BRANCHING                                     *
027100200616     F*  S01269 - TRADE AUTHORISATION: RECOMPILED FOR CHANGE TO FILE  *
027200200616     F*           TABSE                                               *
027300200616     F*  E21244 - INCORRECT AMOUNTS ON BASE CURRENCY EQUIV.POSTINGS   *   E21244
027400200616     F*  E21245 - DO NOT OUTPUT BOOK TO ACCOUNT KEYS                  *   E21245
027500200616     F*  E20651 - DB ERROR NUMBERS USED IN MORE THAN ONE PLACE.       *   E20651
027600200616     F*           NEW ERROR NUMBERS AS FOLLOWS:                       *   E20651
027700200616     F*           DB ERROR 10 -> 12                                   *   E20651
027800200616     F*           DB ERROR 10 -> 13                                   *   E20651
027900200616     F*  E19975 - KCUST and ISSR shouldn't be zeroized before writing *   E19975
028000200616     F*           SEKEYD as  issuer and depot cust nos are needed for *   E19975
028100200616     F*           account keys with posting ref 4 and 5.              *   E19975
028200200616     F*  E19770 - REQUIRES ISSUER CUSTOMER TO BE AVAILABLE FOR        *   E19770
028300200616     F*           POSTING REFERENCE 4 FOR THE FOLLOWING:-             *   E19770
028400200616     F*           1) IIIS_D______MVN___DI  2) IIIS_D______MVN___PP    *   E19770
028500200616     F*           3) IIIS_D______MVN___MR  4) IIIS_D______MVN___CV    *   E19770
028600200616     F*  E18803 - SET ACCOUNT KEY SEQUENCE NO TO ZERO TO ALLOW FOR    *   E18803
028700200616     F*           MULTI-BRANCH SYSTEMS.                               *   E18803
028800200616     F*  E16359 - POSITION SETTLEMENT A/C KEYS ARE CREATED WITH A     *   E16359
028900200616     F*           BLANK DISCRETIONARY INDICATOR.                      *   E16359
029000200616     F*  E16776 - CHANGE INPUT FILE TO USE VERSION BUILT OVER ONE     *   E16776
029100200616     F*           MEMBER ONLY.                                        *   E16776
029200200616     F*  E15685 - TO TAKE MARKET INDICATOR FROM SECURITY.             *   E15685
029300200616     F*  E15687 - MAKE AMOUNT POSITIVE FOR 'AMCD' - 'CP,CR,FP,FR'     *   E15687
029400200616     F*  E15825 - MATURED RECORDS SHOULD BE OMITTED FROM RECORD       *   E15825
029500200616     F*           COUNT.                                              *   E15825
029600200616     F*  E15430 - CONVERTIBLE INDICATOR MUST BE 'Y' OR ' ' ON         *   E15430
029700200616     F*           ACCOUNT KEYS                                        *   E15430
029800200616     F*  E15329 - CALCULATION OF SIGNS FOR EVENT AMOUNTS AMENDED      *   E15329
029900200616     F*           ALLOWING FOR PORTFOLIO CLIENTS OR DEPOTS            *   E15329
030000200616     F*  E14884 - POSETD RECORD ID UPDATED TO 'M' (MATURED) IF        *   E14884
030100200616     F*           POSITION SETTLEMENT HAS BEEN ACTIONED               *   E14884
030200200616     F*  E14723 - INCORRECT SET UP OF ACCOUNT KEY ACCORDING TO        *.  E14723
030300200616     F*           DISCRETIONARY INDICATOR.                            *   E14723
030400200616     F*  E14840 - AUDIT LIST SHOULD BE PRINTED WHETHER OR NOT FILE    *   E14840
030500200616     F*           CONTROLS BALANCE.                                   *   E14840
030600200616     F*  E14888 - INCORRECT KEYS GEN. FOR POSITION ON POS SETTLEMENTS *   E14888
030700200616     F*  E14713 - KEY FOR DEPOT MOVEMENTS SHOULD HAVE AN 'X' IN       *   E14713
030800200616     F*           POSITION 6 REGARDLESS OF DISCRETIONARY INDICATOR.   *   E14713
030900200616     F*                                                               *
031000200616     F*****************************************************************
031100200616     F*
031200200616     F*POSET   IF  E           K        DISK
031300200616     F***POSET   UF  E           K        DISK         KINFDS POSDS E14884E16776
031400200616     FPOSET1  UF  E           K        DISK         KINFDS POSDS          E16776
031500200616     F                                              KINFSR POSSR          E14884
031501200616     FPSAUT   UF  E           K        DISK                                                 AR324886
031502200616      ** SE Position Settlement Authorisation detail                                        AR324886
031503200616      *                                                                                     AR324886
031600200616     FPOSETDY2IF  E           K        DISK                                                   CGL020
031700200616     FCLINT   IF  E           K        DISK
031800200616     F            CLINTCAF                          KIGNORE
031900200616     F/COPY WNCPYSRC,SE2300F002
032000200616     F            CLINTCBF                          KIGNORE
032100200616     F/COPY WNCPYSRC,SE2300F003
032200200616     F            CLINTCCF                          KIGNORE
032300200616     F*           CLINTSEF                          KIGNORE
032400200616     F            CLINTC1F                          KIGNORE
032500200616     FSECTY   IF  E           K        DISK
032600200616     FSECOATL0IF  E           K        DISK                               CSE007
032700200616     FSESWHTL0IF  E           K        DISK                               S01446
032800200616     F*POSETA  IF  E                    DISK
032900200616     FPOSETA  UF  E           K        DISK         KINFDS PAUDS          E14884
033000200616     F                                              KINFSR PAUSR          E14884
033100200616     FSEKEYD  O   E           K        DISK         KINFDS SKDDS
033200200616     F                                              KINFSR SKDSR
033300200616     FSEKEYA  O   E           K        DISK         KINFDS SKADS
033400200616     F                                              KINFSR SKASR
033500200616     FSE2300AUO   E                    PRINTER
033600200616     FTABSE   IF  E           K        DISK
033700200616     F* ICD 1     TABTB10F                          KIGNORE
033800200616     F            TABTB10F                          KIGNORE               S01117
033900200616     F* ICD 2     TABTB11F                          KIGNORE
034000200616     F* ICD SE    TABTB36F                          KIGNORE
034100200616     F            TABTB40F                          KIGNORE
034200200616     F* CCY       TABTG10F                          KIGNORE
034300200616     F            TABTG20F                          KIGNORE
034400200616     F            TABLETAF                          KIGNORE
034500200616     F            TABLETHF                          KIGNORE
034600200616     F*********** TABLETJF                          KIGNORE               S01117
034700200616     F            TABLETLF                          KIGNORE
034800200616     F            TABLETRF                          KIGNORE
034900200616     F            TABLETXF                          KIGNORE
035000200616     F            TABLET2F                          KIGNORE
035100200616     F            TABLET3F                          KIGNORE
035200200616     F            TABLET5F                          KIGNORE
035300200616     F            TABTE10F                          KIGNORE
035400200616     F            TABTE20F                          KIGNORE
035500200616     F            TABLETNF                          KIGNORE
035600200616     F            TABLETKF                          KIGNORE
035700200616     F            TABLETPF                          KIGNORE
035800200616     FCPOSN   IF  E           K        DISK                                                   233710
035900200616     FSDACUSL1IF  E           K        DISK                                                   233710
036000200616     FSDNAHOL1IF  E           K        DISK                                                   233710
036100200616     FSDJACCLBIF  E           K        DISK                                                   233710
036200200616     FSDCSINPDO   E           K        DISK                                                   233710
036300200616     F/COPY WNCPYSRC,SE2300F001
036400200616     F*
036500200616      /EJECT
036600200616     F*****************************************************************
036700200616     F*                                                               *
036800200616     F*  F U N C T I O N   O F  I N D I C A T O R S                   *
036900200616     F*                                                               *
037000200616     F*   60 - PROCESS AMEND S01496                                   *   S01496
037100200616     F*   70 - Search (CHAIN) Indicator of POSETDY2                   *                       CGL020
037200200616     F*   80 - ERROR ON CHAIN                                         *
037300200616     F****89***END*OF*FILE*ON*POSET                                   *   E16776
037400200616     F*   89 - END OF FILE ON POSET1                                  *   E16776
037500200616     F*90-99 - USED IN Z-SUBROUTINES                                  *
037600200616     F*                                                               *
037700200616     F*   U7 - DATABASE ERROR                                         *
037800200616     F*   U8 - DATABASE ERROR                                         *
037900200616     F*                                                               *
038000200616     F*****************************************************************
038100200616      /EJECT
038200200616     F*****************************************************************
038300200616     F*                                                               *
038400200616     F*  I N D E X   T O   S U B R O U T I N E S                      *
038500200616     F*                                                               *
038600200616     F*   FIRST  - ACCESSES ICD 1,2 AND SE                            *
038700200616     F*   WRITED - SETS UP COMMON FIELDS AND OUTPUTS KEY TO SEKEYD    *
038800200616     F*   AUDIT  - OUTPUTS CONTROL REPORT                             *
038900200616     F*   P01    - SUBROUTINE TO GENERATE AMOUNT DUE KEY              *
039000200616     F*   P02    - SUBROUTINE TO GENERATE CHARGE & COMMISSION KEYS    *
039100200616     F*   P03    - SUBROUTINE TO GENERATE SETTLEMENT AMOUNT KEY       *
039200200616     F*   WTKEYS - SUBROUTINE TO GENERATE WITHHOLDING TAX KEYS        *   S01447
039300200616     F*   CLEAR  - SUB TO CLEAR FIELDS BEFORE GENERATING RECORD       *
039400200616     F*                                                               *
039500200616     F****ZSYSTM******-*ACCESSES*ICD*1************************************S01117
039600200616     F*   ZICD2  - ACCESSES ICD 2                                     *
039700200616     F*   ZICDSE - ACCESSES ICD FOR SE                                *
039800200616     F*   ZCONV  - SUBROUTINE TO CONVERT AND AMOUNT FROM ONE          *
039900200616     F*            CURRENCY TO ANOTHER                                *
040000200616     F*   ZHASH  - TO CALCULATE HASH VALUE OF ACCOUNT KEYS            *
040100200616     F*   SKDSR  - ERROR ROUTINE                                      *
040200200616     F*   SKASR  - ERROR ROUTINE                                      *
040300200616     F*   *PSSR  - DATABASE ERROR HANDLING SUBROUTINE                 *   S01117
040400200616     F*                                                               *
040500200616     F*****************************************************************
040600200616      /EJECT
040700200616     F/COPY WNCPYSRC,SE2300F004
040800200616     E/COPY ZSRSRC,ZHASHZ1
040900200616     E/COPY ZSRSRC,ZPOWERZ1
041000200616     E/COPY ZSRSRC,ZHOLE                                                  088939
041100200616     E                    CPY@    1   1 80
041200200616      /EJECT
041300200616     IPOSETDF                                                             E37241
041400200616     I              RECI                            PRECI                                     225599
041500200616     I              LCD                             PLCD                  E37241
041600200616     I              CHTP                            PCHTP                 E37241
041700200616     I              TNLU                            PTNLU                 E37241
041800200616     I              PTFR                            RNPTFR                S01486
041900200616     I/COPY ZSRSRC,ZHASHZ2
042000200616     I*
042100200616     I            DS
042200200616     I*
042300200616     I* DATA STRUCTURE FOR SEKEYD ACCOUNT KEY
042400200616     I*
042500200616     I                                        1  20 ACKY
042600200616     I                                        1   3 INVT
042700200616     I                                        4   4 EVTP
042800200616     I                                        5   5 TRTP
042900200616     I                                        6   6 PORT
043000200616     I                                        7   8 BOOK
043100200616     I                                        9   9 PSBS
043200200616     I                                       10  10 FIL1
043300200616     I                                       11  12 CGTP
043400200616     I                                       13  13 MRKT
043500200616     I                                       14  14 CNVI
043600200616     I                                       15  15 NEGI
043700200616     I************                           16  18 FIL3                  S01447
043800200616     I                                       16  16 FIL1B                 S01447
043900200616     I                                       17  18 COTA                  S01447
044000200616     I                                       19  20 AMCD
044100200616     I*
044200200616     I            DS
044300200616     I*
044400200616     I* DATA STRUCTURE FOR TABLE FILE KEY
044500200616     I*
044600200616     I                                        1  12 TKEY
044700200616     I                                        1   20RECT
044800200616     I                                        3  10 ZZ008
044900200616     I                                       11  120RCDE
045000200616     I                                        3   8 ZZ006
045100200616     I                                        9  11 RCCY
045200200616     I                                       12  12 ZZ001
045300200616     I*
045400200616     I* DATA STRUCTURES FOR RPG 01021 ERROR HANDLING
045500200616     I*
045600200616     ISKDDS       DS                            366
045700200616     I                                     *STATUS  STSSKD
045800200616     I*
045900200616     ISKADS       DS
046000200616     I                                     *STATUS  STSSKA
046100200616     I*                                                                   E14884
046200200616     IPOSDS       DS                                                      E14884
046300200616     I                                     *STATUS  STSPOS                E14884
046400200616     I*                                                                   E14884
046500200616     IPAUDS       DS                                                      E14884
046600200616     I                                     *STATUS  STSPAU                E14884
046700200616     I*
046800200616     I*DA********UDS                            256                       S01117
046900200616     I***********                           134 177 DBLOT                 S01117
047000200616     I***********                           134 138 DBFILE                S01117
047100200616     I***********                           139 167 DBKEY                 S01117
047200200616     I***********                           168 175 DBPGM                 S01117
047300200616     I***********                           176 1770 BASE                 S01117
047400200616     I*
047500200616     ILDA         DS                            256                       S01117
047600200616     I                                      134 183 DBLOT                 S01117
047700200616     I                                      134 141 DBFILE                S01117
047800200616     I                                      142 170 DBKEY                 S01117
047900200616     I                                      171 180 DBPGM                 S01117
048000200616     I                                      181 1830DBASE                 S01117
048100200616     IRUNDT       DS                                                      S01117
048200200616      ** DATA AREA RUNDAT                                                 S01117
048300200616     I                                        1   7 RUNA                  S01117
048400200616     I                                    P   8  100RUND                  S01117
048500200616     I                                       11  11 SSF                   S01117
048600200616     I                                       12  12 DATF                  S01117
048700200616     I                                       13  13 MBIN                  S01117
048800200616     ISDCURR    E DSSDCURRPD                                              183665
048900200616      *                                                                   183665
049000200616      ** Currency details                                                 183665
049100200616      *                                                                   183665
049200200616     ISDCTRY    E DSSDCTRYPD                                                                  233710
049300200616      *                                                                                       233710
049400200616      ** Country details                                                                      233710
049500200616      *                                                                                       233710
049600200616     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
049700200616     ISDBANK    E DSSDBANKPD                                              S01117
049800200616     I              BJURPT                          TITL                  S01117
049900200616     I**  External DS for Switchable Features file                        S01446
050000200616     ISCSARD    E DSSCSARDPD                                              S01446
050100200616     I*                                                                   S01486
050200200616     I@MMOD     E DSSDMMODPD                                              S01486
050300200616     I** Dummy record format for access to Modules File                   S01486
050400200616     I*                                                                   CAC002
050500200616     ISDSTRD    E DSSDSTRDPD                                              CAC002
050600200616     I**  Securities Trading Details                                      CAC002
050700200616     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
050800200616      ** Data structure for Tax Parameter File                                              BUG22911
050900200616      *                                                                                     BUG22911
051000200616     I*                                                                   S01486
051100200616     I**  External DS for Charge Types file                               S01446
051200200616     ISECGT     E DSSECGT                                                 S01446
051300200616     I              RECI                            RECI1                 S01446
051400200616     I              LCD                             LCD1                  S01446
051500200616     I              CHTP                            CHTP1                 S01446
051600200616     I              TNLU                            TNLU1                 S01446
051700200616     I              PRFC                            PRFC1                 CAC002
051800200616     I              ZONE                            ZONE1                                     CGP001
051900200616     I** DATA STRUCTURE FOR ACCESS OBJECTS, SHORT DATA STRUCTURE          S01117
052000200616     IDSFDY     E DSDSFDY                                                 S01117
052100200616     I*
052200200616     I** DATA STRUCTURE FOR ACCESS OBJECTS, LONG DATA STRUCTURE           S01446
052300200616     IDSSDY     E DSDSSDY                                                 S01446
052400200616     I*                                                                   S01446
052500200616     I/COPY WNCPYSRC,SE2300I001
052600200616     ICPYR@#      DS
052700200616     I*
052800200616     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
052900200616     I*
053000200616     I                                        1  80 CPY@
053100200616     I                                        1  20 CPY@##
053200200616     I*                                                                                       CGL020
053300200616     I** Counterparty Key for POSETDY2                                                        CGL020
053400200616     I            DS                                                                          CGL020
053500200616     I**********                              1   60KPCPY                              CGL020 CSD027
053600200616     I                                        1   6 KPCPY                                     CSD027
053700200616     I*                                                                                       CGL020
053800200616     I** Counterparty Parameter for ZAAMLSETSE                                                CGL020
053900200616     I            DS                                                                          CGL020
054000200616     I**********                              1   60PCTRP                              CGL020 CSD027
054100200616     I                                        1   6 PCTRP                                     CSD027
054200200616     I*                                                                   088939
054300200616     I** Securities Settlement Fields Extractor Program Name                                  CGL020
054400200616     I              'ZAAMLSETSE'          C         SETSE                                     CGL020
054500200616     I*                                                                                       CGL020
054600200616      ** Constant for Instrument Reference                                                    233710
054700200616     I              ' - Coupon'           C         WINST1                                    233710
054800200616     I              ' - Dividend'         C         WINST2                                    233710
054900200616     I              ' - Maturity'         C         WINST3                                    233710
055000200616     I              ' - Mortgage Payment' C         WINST4                                    233710
055100200616      *                                                                                       233710
055200200616     I/COPY ZSRSRC,ZHOLI                                                  088939
055300200616      /EJECT
055400200616     C*================================================================
055500200616     C*  P R O G R A M     S T A R T
055600200616     C*================================================================
055700200616     C*
055800200616     C* KEY LISTS FOR CHAINING TO :-
055900200616     C*     TABTB36
056000200616     C*
056100200616     C           TABKEY    KLIST
056200200616     C                     KFLD           TKEY
056300200616     C*
056400200616     C*     SECURITIES
056500200616     C*
056600200616     C           SECKEY    KLIST
056700200616     C                     KFLD           PSSH
056800200616     C*
056900200616     C*     CLINTSE
057000200616     C*
057100200616     C           CLIKEY    KLIST
057200200616     C                     KFLD           PCPY
057201200616      *                                                                                     AR324886
057202200616     C           PSAUTH    KLIST                                                            AR324886
057203200616     C                     KFLD           PBCA                                              AR324886
057204200616     C                     KFLD           PSSH                                              AR324886
057205200616     C                     KFLD           PCPY                                              AR324886
057206200616     C                     KFLD           PDUD                                              AR324886
057207200616     C                     KFLD           PEVT                                              AR324886
057208200616     C                     KFLD           RNPTFR                                            AR324886
057209200616     C                     KFLD           PTNLU                                             AR324886
057210200616     C                     KFLD           TXBS                                              AR324886
057211200616     C                     KFLD           BNFO                                              AR324886
057212200616     C                     KFLD           EXCD                                              AR324886
057300200616     C*                                                                                       CGL020
057400200616     C*     POSETDY2                                                                          CGL020
057500200616     C*                                                                                       CGL020
057600200616     C           KPSTES    KLIST                                                              CGL020
057700200616     C                     KFLD           KPBCA   3                                           CGL020
057800200616     C                     KFLD           KPSSH  10                                           CGL020
057900200616     C                     KFLD           KPCPY                                               CGL020
058000200616     C                     KFLD           KPDUD   50                                          CGL020
058100200616     C                     KFLD           KPEVT   2                                           CGL020
058200200616     C*                                                                                       CGL020
058300200616      *                                                                                       233710
058400200616      ** CPOSN                                                                                233710
058500200616      *                                                                                       233710
058600200616     C           KCPOS     KLIST                                                              233710
058700200616     C                     KFLD           PBCA                                                233710
058800200616     C                     KFLD           PSSH                                                233710
058900200616     C                     KFLD           PCPY                                                233710
059000200616     C/COPY WNCPYSRC,SE2300C001
059100200616     C*
059200200616     C* PREPARE LDA
059300200616     C*
059400200616     C           *NAMVAR   DEFN           LDA                             S01117
059500200616     C           *LOCK     IN   LDA                                       S01117
059600200616     C                     MOVEL*BLANK    DBLOT
059700200616     C                     MOVEL'SE2300'  DBPGM
059800200616     C                     OUT  LDA                                       S01117
059900200616      *                                                                   S01496
060000200616      **  Access SAR details file to see if JYSKE Enhcmts is installed.   S01496
060100200616      *                                                                   S01496
060200200616     C                     CALL 'AOSARDR0'                                S01496
060300200616     C                     PARM '       ' @RTCD                           S01496
060400200616     C                     PARM '*VERIFY' @OPTN                           S01496
060500200616     C                     PARM 'S01496'  WSARD   6                       S01496
060600200616      *                                                                   S01496
060700200616     C           @RTCD     IFEQ *BLANK                                    S01496
060800200616     C                     MOVE 'Y'       S01496  1                       S01496
060900200616     C                     MOVE *ON       *IN60                           S01496
061000200616     C                     ENDIF                                          S01496
061100200616      *                                                                   CSE007
061200200616      **  Access SAR details file to see if Corporate Action installed.   CSE007
061300200616      *                                                                   CSE007
061400200616     C                     CALL 'AOSARDR0'                                CSE007
061500200616     C                     PARM '       ' @RTCD                           CSE007
061600200616     C                     PARM '*VERIFY' @OPTN                           CSE007
061700200616     C                     PARM 'CSE007'  WSARD   6                       CSE007
061800200616      *                                                                   CSE007
061900200616     C           @RTCD     IFEQ *BLANK                                    CSE007
062000200616     C                     MOVE 'Y'       CSE007  1                       CSE007
062100200616     C                     ENDIF                                          CSE007
062200200616      *                                                                   CSE023
062300200616      **  Access SAR details file to see if CSE023 installed.             CSE023
062400200616      *                                                                   CSE023
062500200616     C                     CALL 'AOSARDR0'                                CSE023
062600200616     C                     PARM '       ' @RTCD                           CSE023
062700200616     C                     PARM '*VERIFY' @OPTN                           CSE023
062800200616     C                     PARM 'CSE023'  WSARD   6                       CSE023
062900200616      *                                                                   CSE023
063000200616     C           @RTCD     IFEQ *BLANK                                    CSE023
063100200616     C                     MOVE 'Y'       CSE023  1                       CSE023
063200200616     C                     ELSE                                           195362
063300200616     C                     MOVE 'N'       CSE023                          195362
063400200616     C                     ENDIF                                          CSE023
063500200616      *                                                                   CEU017
063600200616      **  Access SAR details file to see if Securities Redenomination     CEU017
063700200616      **  is installed                                                    CEU017
063800200616      *                                                                   CEU017
063900200616     C                     MOVE 'N'       CEU017  1                       CEU017
064000200616     C                     CALL 'AOSARDR0'                                CEU017
064100200616     C                     PARM '       ' @RTCD                           CEU017
064200200616     C                     PARM '*VERIFY' @OPTN                           CEU017
064300200616     C                     PARM 'CEU017'  WSARD   6                       CEU017
064400200616      *                                                                   CEU017
064500200616     C           @RTCD     IFEQ *BLANK                                    CEU017
064600200616     C                     MOVE 'Y'       CEU017                          CEU017
064700200616     C                     ENDIF                                          CEU017
064800200616      *                                                                                       CGL020
064900200616      ** Access SAR details to see if CGL020 is enabled.                                      CGL020
065000200616      *                                                                                       CGL020
065100200616     C                     CALL 'AOSARDR0'                                                    CGL020
065200200616     C                     PARM *BLANKS   @RTCD                                               CGL020
065300200616     C                     PARM '*VERIFY' @OPTN                                               CGL020
065400200616     C                     PARM 'CGL020'  WSARD                                               CGL020
065500200616     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
065600200616      *                                                                                       CGL020
065700200616     C                     MOVE 'N'       CGL020  1                                           CGL020
065800200616     C           @RTCD     IFEQ *BLANKS                                                       CGL020
065900200616     C                     MOVE 'Y'       CGL020                                              CGL020
066000200616     C                     MOVE *BLANK    F1FFLG                                              CGL020
066100200616     C                     Z-ADD0         F1FVAL                                              CGL020
066200200616     C                     Z-ADD0         F1FPCT                                              CGL020
066300200616     C                     ELSE                                                               CGL020
066400200616      *                                                                                       CGL020
066500200616     C           @RTCD     IFNE '*NRF'                                                        CGL020
066600200616     C           *LOCK     IN   LDA                                                           CGL020
066700200616     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
066800200616     C                     MOVELWSARD     DBKEY                                               CGL020
066900200616     C                     Z-ADD901       DBASE                                               CGL020
067000200616     C                     OUT  LDA                                                           CGL020
067100200616     C                     MOVE *ON       *INU7                                               CGL020
067200200616     C                     MOVE *ON       *INU8                                               CGL020
067300200616     C                     EXSR *PSSR                                                         CGL020
067400200616     C                     ENDIF                                                              CGL020
067500200616      *                                                                                       CGL020
067600200616     C                     ENDIF                                                              CGL020
067700200616      *                                                                                     AR864714
067800200616      ** Check if CER049 - Stamp Tax is switch on                                           AR864714
067900200616      *                                                                                     AR864714
068000200616     C                     CALL 'AOSARDR0'                                                  AR864714
068100200616     C                     PARM *BLANKS   @RTCD                                             AR864714
068200200616     C                     PARM '*VERIFY' @OPTN                                             AR864714
068300200616     C                     PARM 'CER049'  WSARD                                             AR864714
068400200616      *                                                                                     AR864714
068500200616     C           @RTCD     IFEQ *BLANK                                                      AR864714
068600200616     C                     MOVE 'Y'       CER049  1                                         AR864714
068700200616     C                     ELSE                                                             AR864714
068800200616     C                     MOVE 'N'       CER049                                            AR864714
068900200616     C                     ENDIF                                                            AR864714
069000200616     C*
069100200616     C* CLEAR COUNTS AND WORKFIELDS
069200200616     C*
069300200616     C                     Z-ADD0         IREC
069400200616     C                     Z-ADD0         DREC    50                                          228045
069500200616     C                     Z-ADD0         OREC
069600200616     C                     Z-ADD0         MREC                            E14884
069700200616AW   C                     Z-ADD1         S
069800200616AW   C                     Z-ADD1         Z
069900200616     C*
070000200616     C*  FIRST CYCLE PROCESS
070100200616     C*
070200200616     C                     EXSR FIRST
070300200616     C*                                                                   S01117
070400200616     C           *INU7     IFEQ '1'                                       S01117
070500200616     C                     GOTO EAUDIT                                    S01117
070600200616     C                     END                                            S01117
070700200616     C*
070800200616     C*  READ FILE
070900200616     C*
071000200616     C**********           READ POSET                    89               E16776
071100200616     C                     READ POSET1                   89               E16776
071200200616     C/COPY WNCPYSRC,SE2300C017
071300200616     C*
071400200616     C*  DO UNTIL EOF OR ERROR
071500200616     C*
071600200616     C           *IN89     DOWEQ'0'
071700200616     C           *INU7     ANDEQ'0'
071800200616     C*
071900200616     C*  INCREMENT COUNT
072000200616     C*
072100200616     C** TRY TO GENERATE ACCOUNT KEY IF POSITION SETTLEMENT IS DELETED AND NOT                225599
072200200616     C** REVERSED - AKEY TO REVERSE POSTING ON TRANSITORY ACCOUNT                             225599
072300200616     C**    SO PROCESS RECORD IF RECI IS '*' AND DELETED TODAY.                               225599
072400200616     C**                                                                                      225599
072500200616     C**********           MOVE RECI      PRECI   1                                    219490 225599
072600200616     C********** RECI      IFNE '*'                                                           225559
072700200616     C********** RECI      ANDNE'M'                                                    E15825 225559
072800200616     C           PRECI     IFNE 'M'                                                           225599
072900200616     C/COPY WNCPYSRC,SE2300C037
073000200616     C*                                                                   S01496
073100200616     C**  If Jyske Enhancements feature is installed, reversed are        S01496
073200200616     C**  previously 'MATURED' so do not count them                       S01496
073300200616     C**  Same processing if Corporate Action is installed                CSE007
073400200616     C**  Same processing if Securities Redenomination is installed       CEU017
073500200616     C*                                                                   S01496
073600200616     C           S01496    IFEQ 'Y'                                       S01496
073700200616     C           CSE007    OREQ 'Y'                                       CSE007
073800200616     C           CEU017    OREQ 'Y'                                       CEU017
073900200616     C*
074000200616     C           PRECI     IFEQ '*'                                                           228045
074100200616     C           PLCD      ANDEQRUND                                                          228045
074200200616     C                     ADD  1         DREC                                                225599
074300200616     C                     END                                                                228045
074400200616     C*
074500200616     C********** RECI      IFNE 'R'                                                    S01496 225599
074600200616     C           PRECI     IFNE 'R'                                                           225599
074700200616     C           PRECI     ANDNE'*'                                                           225599
074800200616     C                     ADD  1         IREC                            S01486
074900200616     C                     END                                            S01496
075000200616     C                     ELSE                                           S01496
075100200616     C*                                                                   S01496
075200200616     C           PRECI     IFNE '*'                                                           247966
075300200616     C                     ADD  1         IREC    50
075400200616     C                     ENDIF                                                              247966
075500200616     C***********                                                         065461
075600200616     C                     END                                            S01496
075700200616     C*                                                                   S01496
075800200616     C**  Process all records if Jyske Enhancements feature (S01496)      S01496
075900200616     C**  is installed.  If the feature is not installed, process only    S01496
076000200616     C**  those records with event type not equal to 'RC'.                S01496
076100200616     C*                                                                   S01496
076200200616     C           S01496    IFEQ 'Y'                                       S01496
076300200616     C           CSE007    OREQ 'Y'                                       CSE007
076400200616     C           CEU017    OREQ 'Y'                                       CEU017
076500200616     C           PEVT      ORNE 'RC'                                      S01496
076600200616     C**ONLY*PROCESS*RECORDS*WHERE*AUTHORITY*IND*=*'Y'********************065461
076700200616     C* ONLY PROCESS RECORDS WHERE AUTH.IND = 'Y' OR TO BE REVERSED065461 S01496
076800200616     C*                                                                   065461
076900200616     C** Only process records where authority Ind = 'Y' and the           065461
077000200616     C** position settlement generated date is not the run date.          065461
077100200616     C*                                                                   065461
077200200616     C** If S01512 is active, additional check of value date *LE event    S01512
077300200616     C** control date will be in effect                                   S01512
077400200616     C** or to be reversed                                                S01496
077500200616     C*
077600200616     C           PAUI      IFEQ 'Y'
077700200616     C********** RECI      ANDEQ'D'                                                    E14884 225599
077800200616     C           PRECI     ANDEQ'D'                                                           225599
077900200616     C********** PDTG      ANDNERUND                                                065461 MD037742A
078000200616     C           PSVL      ANDLEWWECD                                     247782
078100200616     C           S01512    ANDEQ'N'                                       S01512
078200200616     C*                                                                   S01512
078300200616     C           PAUI      OREQ 'Y'                                       S01512
078400200616     C********** RECI      ANDEQ'D'                                                    S01512 225599
078500200616     C           PRECI     ANDEQ'D'                                                           225599
078600200616     C********** PDTG      ANDNERUND                                                S01512 MD037742A
078700200616     C           PSVL      ANDLEWWECD                                     S01512
078800200616     C           S01512    ANDEQ'Y'                                       S01512
078900200616     C*
079000200616     C           PRECI     OREQ '*'                                                           225599
079100200616     C           PCHTP     ANDEQ'D'                                                           225599
079200200616     C           PLCD      ANDEQBJRDNB                                                        225599
079300200616     C           PDTG      ANDNE0                                                             225599
079400200616     C*
079500200616     C           SRPG      ORNE 'Y'                                       S01496
079600200616     C********** RECI      ANDEQ'R'                                                    S01496 225599
079700200616     C           PRECI     ANDEQ'R'                                                           225599
079800200616     C           S01496    ANDEQ'Y'                                       S01496
079900200616     C           SRPG      ORNE 'Y'                                       CSE007
080000200616     C********** RECI      ANDEQ'R'                                                    CSE007 225599
080100200616     C           PRECI     ANDEQ'R'                                                           225599
080200200616     C           CSE007    ANDEQ'Y'                                       CSE007
080300200616     C           SRPG      ORNE 'Y'                                       CEU017
080400200616     C********** RECI      ANDEQ'R'                                                    CEU017 225599
080500200616     C           PRECI     ANDEQ'R'                                                           225599
080600200616     C           CEU017    ANDEQ'Y'                                       CEU017
080700200616     C**********           MOVE RECI      WWRECI  1                                    S01496 225599
080800200616     C**********           MOVE CHTP      WWCHTP  1                                    S01496 225599
080900200616     C**********           Z-ADDLCD       WWLCD   50                                   S01496 225599
081000200616     C                     MOVE PRECI     WWRECI  1                                           225599
081100200616     C                     MOVE PCHTP     WWCHTP  1                                           225599
081200200616     C                     Z-ADDPLCD      WWLCD   50                                          225599
081300200616     C*                                                                   088939
081400200616     C** Check if due date (or next working day after due date, if due    088939
081500200616     C** date is a holiday) is less than or equal to run date             088939
081600200616     C** before processing the record for a nostro settlement             088939
081700200616     C*                                                                   088939
081800200616     C                     Z-ADDPDUD      ZDAYNO                          088939
081900200616     C                     Z-ADD0         ZNRDYS                          088939
082000200616     C                     MOVE PSCU      ZCCY                            088939
082100200616     C                     EXSR ZFWDT                                     088939
082200200616     C*                                                                   088939
082300200616     C           ZDYNBR    IFLE BJRDNB                                    088939
082400200616     C           PSMT      ORNE 01                                        161794
082500200616     C           PSMT      ANDNE07                                        161794
082600200616     C           PSMT      ANDNE08                                        161794
082700200616     C/COPY WNCPYSRC,SE2300C028
082800200616     C*                                                                   088939
082900200616     C                     ADD  1         AREC    50
083000200616     C*
083100200616     C*  OBTAIN SECURITIES  RECORD
083200200616     C*
083300200616     C           SECKEY    CHAINSECTYDF              80
083400200616     C           *IN80     IFEQ '0'
083500200616     C           RECI      IFEQ '*'
083600200616     C                     SETON                     80
083700200616     C                     END
083800200616     C                     END
083900200616     C           *IN80     IFEQ '1'
084000200616     C           *LOCK     IN   LDA                                       S01117
084100200616     C                     MOVEL'SECTY'   DBFILE           *****************
084200200616     C                     MOVELPSSH      DBKEY            ** DB ERROR 04 **
084300200616     C                     Z-ADD4         DBASE            *****************
084400200616     C                     OUT  LDA                                       S01117
084500200616     C                     SETON                     U7U8
084600200616     C                     EXSR *PSSR                                     S01117
084700200616     C                     END
084800200616     C*                                                                   067406
084900200616     C** Get Nominal Currency decimal places and M/D Indicator            067406
085000200616     C*                                                                   067406
085100200616     C                     MOVE *BLANK    ZZ006                           067406
085200200616     C                     MOVE '20'      RECT                            067406
085300200616     C                     MOVE 1         ZZ001                           067406
085400200616     C                     MOVE PNCY      RCCY                            067406
085500200616     C*                                                                   067406
085600200616     C           TABKEY    CHAINTABTG10F             80                   067406
085700200616     C           *IN80     IFEQ '1'                                       067406
085800200616     C           RECI      OREQ '*'                                       067406
085900200616     C           *LOCK     IN   LDA                                       067406
086000200616     C                     MOVE 'TABLE'   DBFILE           ***************067406
086100200616     C                     MOVELTKEY      DBKEY            ** DB ERROR 15 067406
086200200616     C                     Z-ADD15        DBASE            ***************067406
086300200616     C                     OUT  LDA                                       067406
086400200616     C                     SETON                     99U7U8               067406
086500200616     C                     EXSR *PSSR                                     067406
086600200616     C                     GOTO EAUDIT                                    067406
086700200616     C                     END                                            067406
086800200616     C*                                                                   067406
086900200616      **  Save Nominal Currency details                                   067406
087000200616     C*                                                                   067406
087100200616     C           *LIKE     DEFN CDP       UNOMDP                          067406
087200200616     C           *LIKE     DEFN MDIN      UNMDIN                          067406
087300200616     C                     Z-ADDCDP       UNOMDP                          067406
087400200616     C                     Z-ADDMDIN      UNMDIN                          067406
087500200616     C*
087600200616     C           *INU7     IFEQ '1'
087700200616     C                     GOTO EAUDIT
087800200616     C                     END
087900200616     C*
088000200616     C*  OBTAIN CLINTSE  RECORD
088100200616     C*
088200200616     C           CLIKEY    CHAINCLINTSEF             80
088300200616     C           *IN80     IFEQ '0'
088400200616     C           RECI      IFEQ '*'
088500200616     C                     SETON                     80
088600200616     C                     END
088700200616     C                     END
088800200616     C           *IN80     IFEQ '1'
088900200616     C                     MOVE *BLANKS   C1DI
089000200616     C                     END
089100200616     C*
089200200616     C*  PRODUCE NORMAL KEYS AND KEY FOR DELETION OF POST AFTER                               225599
089300200616     C*                                                                                       225599
089400200616     C           PRECI     IFNE '*'                                                           225599
089500200616     C*                                                                                       225599
089600200616     C*  PRODUCE AMOUNT DUE KEY
089700200616     C*
089800200616     C                     EXSR CLEAR
089900200616     C*                                                                   CSE007
090000200616     C                     MOVE *BLANKS   WWCOAT  1                       CSE007
090100200616     C           CSE007    IFEQ 'Y'                                       CSE007
090200200616     C           CEU017    OREQ 'Y'                                       CEU017
090300200616     C           PEVT      CHAINSECOATL0             80                   CSE007
090400200616     C           *IN80     IFEQ '0'                                       CSE007
090500200616     C*                                                                   CSE007
090600200616     C           MMPTYP    IFEQ 'DV'                                      CSE007
090700200616     C*                                                                   CSE007
090800200616     C*  Set Corporate Action Flag to 'I' (Income Events)                 CSE007
090900200616     C                     MOVE 'I'       WWCOAT                          CSE007
091000200616     C                     ELSE                                           CSE007
091100200616     C*                                                                   CSE007
091200200616     C*  Set Corporate Action Flag to 'O' (Others)                        CSE007
091300200616     C                     MOVE 'O'       WWCOAT                          CSE007
091400200616     C                     ENDIF                                          CSE007
091500200616     C*                                                                   CSE007
091600200616     C                     ENDIF                                          CSE007
091700200616     C                     ENDIF                                          CSE007
091800200616     C*                                                                   CSE007
091900200616     C                     EXSR P01
092000200616     C*
092100200616     C*  IF CHARGE AMOUNT AND COMMISSION AMOUNT NOT BOTH ZERO
092200200616     C*  PRODUCE CHARGE & COMMISSION KEYS
092300200616     C*
092400200616     C/COPY WNCPYSRC,SE2300C002
092500200616     C           PCHA      IFNE 0
092600200616     C           PCAM      ORNE 0
092700200616     C                     EXSR CLEAR
092800200616     C                     EXSR P02
092900200616     C                     END
093000200616     C/COPY WNCPYSRC,SE2300C027
093100200616     C*                                                                   S01447
093200200616     C** If the Treaty Withholding Tax feature is On                      CSE023
093300200616     C** Check if Country of Treaty of Tax on Security Detail is equal    CSE023
093400200616     C** to *BLANK.                                                       CSE023
093500200616     C** If it is BLANK, check if need to do S01447 Withholding Tax.      CSE023
093600200616     C*                                                                   CSE023
093700200616     C           CSE023    IFEQ 'N'                                       CSE023
093800200616     C           CSE023    OREQ 'Y'                                       CSE023
093900200616     C           CRTT      ANDEQ*BLANK                                    CSE023
094000200616     C*                                                                   CSE023
094100200616     C*  If the Withholding Tax feature is on...                          S01447
094200200616     C*  If either the Tax Deducted at Source or the Tax Deducted at      S01447
094300200616     C*  Source - Refundable or the Tax Deducted by User are not zero     S01447
094400200616     C*  then generate keys for Withholding Tax                           S01447
094500200616     C*                                                                   S01447
094600200616     C           S01447    IFEQ 'Y'                                       S01447
094700200616     C           TASO      IFNE *ZERO                                     S01447
094800200616     C           TASR      ORNE *ZERO                                     S01447
094900200616     C           TAUS      ORNE *ZERO                                     S01447
095000200616     C                     EXSR CLEAR                                     S01447
095100200616     C                     EXSR WTKEYS                                    S01447
095200200616     C                     END                                            S01447
095300200616     C                     END                                            S01447
095400200616     C*                                                                   CSE023
095500200616     C                     ELSE                                           CSE023
095600200616     C*                                                                   CSE023
095700200616     C** If Country of Treaty Tax is non-blank, then generate             CSE023
095800200616     C** Treaty Withholding Tax Keys.                                     CSE023
095900200616     C*                                                                   CSE023
096000200616     C                     EXSR CLEAR                                     CSE023
096100200616     C                     EXSR WTTKYS                                    CSE023
096200200616     C*                                                                   CSE023
096300200616     C                     END                                            CSE023
096400200616      *                                                                                       233710
096500200616      ** Produce Keys for EU Tax                                                              233710
096600200616      *                                                                                       233710
096700200616     C           CGL031    IFEQ 'Y'                                                           233710
096800200616     C           SETX      ANDEQ'Y'                                                           233710
096900200616     C           TXNM      ANDNE0                                                             234664
097000200616     C                     EXSR SRTAXA                                                        233710
097100200616     C                     EXSR SRETAX                                                        233710
097200200616     C                     ENDIF                                                              233710
097300200616     C*
097400200616     C*  PRODUCE SETTLEMENT AMOUNT KEY
097500200616     C*
097600200616     C                     EXSR CLEAR
097700200616     C                     EXSR P03
097800200616     C*                                                                   E14884
097900200616     C*  UPDATE RECORD ID ON POSETD RECORD                                E14884
098000200616     C*                                                                   E14884
098100200616     C           S01496    IFEQ 'Y'                                       S01496
098200200616     C           CSE007    OREQ 'Y'                                       CSE007
098300200616     C           CEU017    OREQ 'Y'                                       CEU017
098400200616     C*                                                                   S01496
098500200616     C           WWRECI    IFEQ 'R'                                       S01496
098600200616     C                     MOVE 'Y'       SRPG                            S01496
098700200616     C**********           MOVE 'R'       RECI                                         S01496 228045
098800200616     C                     MOVE 'R'       PRECI                                               228045
098900200616     C                     ELSE                                           S01496
099000200616     C**********           MOVE 'M'       RECI                                         S01496 228045
099100200616     C                     MOVE 'M'       PRECI                                               228045
099200200616     C                     ENDIF                                          S01496
099300200616     C                     MOVE WWCHTP    CHTP                            S01496
099400200616     C                     Z-ADDWWLCD     LCD                             S01496
099500200616     C*                                                                   S01496
099600200616     C                     ELSE                                           S01496
099700200616     C**********           MOVE 'M'       RECI                                         E14884 228045
099800200616     C                     MOVE 'M'       PRECI                                               228045
099900200616     C                     ENDIF                                          S01496
100000200616     C                     UPDATPOSETDF                                   E14884
100001200616     C           PSAUTH    CHAINPSAUT                88                                     AR324886
100002200616     C           *IN88     IFEQ *OFF                                                        AR324886
100003200616     C                     MOVE PRECI     PARECI                                            AR324886
100004200616     C                     UPDATPSAUTDF                                                     AR324886
100005200616     C                     ENDIF                                                            AR324886
100100200616     C/COPY WNCPYSRC,SE2300C046
100200200616     C*                                                                   S01496
100300200616     C** For Reversal, RECI is changed from 'M' to 'R', and for trailer   S01496
100400200616     C** calculation, they are included in 'LIVE' Records                 S01496
100500200616     C*                                                                   S01496
100600200616     C           S01496    IFEQ 'Y'                                       S01496
100700200616     C           CSE007    OREQ 'Y'                                       CSE007
100800200616     C           CEU017    OREQ 'Y'                                       CEU017
100900200616     C*                                                                   S01496
101000200616     C           WWRECI    IFNE 'R'                                       S01496
101100200616     C           WWRECI    ANDNE'*'                                                           228045
101200200616     C                     ADD  1         MREC                            S01496
101300200616     C                     END                                            S01496
101400200616     C*                                                                   S01496
101500200616     C                     ELSE                                           S01496
101600200616     C           WWRECI    IFNE '*'                                                           247966
101700200616     C                     ADD  1         MREC    50                      E14884
101800200616     C                     ENDIF                                                              247966
101900200616     C                     END                                            S01496
102000200616     C*
102100200616     C                     END                                            088939
102200200616     C*                                                                                       225599
102300200616     C* IF DELETION OF A POST GENERATE ACCOUNT KEY TO REVERSE AMOUNT                          225599
102400200616     C* GENERATED ON TRANSITORY ACCOUNT CODE                                                  225599
102500200616     C           PRECI     IFEQ '*'                                                           225599
102600200616     C           PCHTP     ANDEQ'D'                                                           225599
102700200616     C           PLCD      ANDEQBJRDNB                                                        225599
102800200616     C*                                                                                       225599
102900200616     C                     EXSR CLEAR                                                         225599
103000200616     C*                                                                                       225599
103100200616     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN SR. WRITED                                  225599
103200200616     C*                                                                                       225599
103300200616     C                     MOVE '1'       RVRS                                                225599
103400200616     C           PEVT      IFEQ 'CP'                                                          225599
103500200616     C                     MOVE 'C'       EVTP                                                225599
103600200616     C                     END                                                                225599
103700200616     C********** PEVT      IFEQ 'DI'                                                   225599 234715
103800200616     C           PEVT      IFEQ 'DV'                                                          234715
103900200616     C                     MOVE 'H'       EVTP                                                225599
104000200616     C                     END                                                                225599
104100200616     C           PEVT      IFEQ 'MT'                                                          225599
104200200616     C                     MOVE 'M'       EVTP                                                225599
104300200616     C                     END                                                                225599
104400200616     C           SNAC      IFEQ 'N'                                                           225599
104500200616     C           PAMD      ORGT 0                                                             225599
104600200616     C                     MOVE ' '       NEGI                                                225599
104700200616     C                     ELSE                                                               225599
104800200616     C                     MOVE 'N'       NEGI                                                225599
104900200616     C                     END                                                                225599
105000200616     C                     MOVE 'DI'      AMCD                                                225599
105100200616     C           PEVT      IFEQ 'MT'                                                          225599
105200200616     C                     MOVE 'CV'      AMCD                                                225599
105300200616     C                     END                                                                225599
105400200616     C                     Z-ADDPAMD      EVAM                                                225599
105500200616     C                     EXSR WRITED                                                        225599
105600200616     C                     END                                                                225599
105700200616     C                     END                                                                225599
105800200616     C*
105900200616     C                     END
106000200616     C                     END                                            S01496
106100200616     C                     END
106200200616     C*
106300200616     C*  READ NEXT RECORD
106400200616     C*
106500200616     C**********           READ POSET                    89               E16776
106600200616     C                     READ POSET1                   89               E16776
106700200616     C/COPY WNCPYSRC,SE2300C018
106800200616     C*
106900200616     C                     END
107000200616     C*
107100200616     C* OUTPUT CONTROL REPORT AND WRITE AUDIT RECORD
107200200616     C*
107300200616     C           EAUDIT    TAG                             ** EAUDIT **
107400200616     C*
107500200616     C                     EXSR AUDIT
107600200616     C*
107700200616     C                     SETON                     LR
107800200616     C*
107900200616     C*================================================================
108000200616     C*  P R O G R A M     E N D
108100200616     C*================================================================
108200200616     C/EJECT
108300200616     C*****************************************************************
108400200616     C*                                                               *
108500200616     C**SUBROUTINE*TO*ACCESS*ICD*1,2*AND*ICD*FOR*SE***********************S01117
108600200616     C**CALLS:*ZSYSTM,*ZICD2,*ZICDSE**************************************S01117
108700200616     C* SUBROUTINE TO ACCESS ICD 2, ICD FOR SE                            S01117
108800200616     C* CALLS: ZICD2, ZICDSE                                              S01117
108900200616     C*                                                               *
109000200616     C*****************************************************************
109100200616     C*
109200200616     C           FIRST     BEGSR                           ** FIRST **
109300200616     C***********                                                         S01117
109400200616     C***********          EXSR ZSYSTM                                    S01117
109500200616     C***********                                                         S01117
109600200616     C**ERROR*IN*ZSYSTM***************************************************S01117
109700200616     C***********                                                         S01117
109800200616     C************IN99     IFEQ '1'                                       S01117
109900200616     C***********          MOVE '1'       *INU7                           S01117
110000200616     C***********          MOVE '1'       *INU8            ***************S01117
110100200616     C***********          Z-ADD1         DBASE            **DB ERROR 01**S01117
110200200616     C***********          MOVEL'TABLE'   DBFILE           ***************S01117
110300200616     C***********          MOVELZTABKY    DBKEY                           S01117
110400200616     C***********                                                         S01117
110500200616     C***********          ELSE                                           S01117
110600200616     C*
110700200616     C                     EXSR ZICD2
110800200616     C*
110900200616     C* ERROR IN ZICD2
111000200616     C*
111100200616     C           *INU7     IFEQ '1'
111200200616     C           *LOCK     IN   LDA                                       S01117
111300200616     C                     Z-ADD2         DBASE            ***************
111400200616     C                     MOVEL'TABLE'   DBFILE           **DB ERROR 02**
111500200616     C                     MOVELTKEY      DBKEY            ***************
111600200616     C                     OUT  LDA                                       S01117
111700200616     C                     EXSR *PSSR                                     S01117
111800200616     C*
111900200616     C                     ELSE
112000200616     C*
112100200616     C                     EXSR ZICDSE
112200200616     C*
112300200616     C* ERROR IN ZICDSE
112400200616     C*
112500200616     C           *INU7     IFEQ '1'
112600200616     C           *LOCK     IN   LDA                                       S01117
112700200616     C                     Z-ADD3         DBASE            ***************
112800200616     C                     MOVEL'TABLE'   DBFILE           **DB ERROR 03**
112900200616     C                     MOVELTKEY      DBKEY            ***************
113000200616     C                     OUT  LDA                                       S01117
113100200616     C                     EXSR *PSSR                                     S01117
113200200616     C*                                                                   S01117
113300200616     C                     ELSE                                           S01117
113400200616     C*
113500200616      *In the data area RUNDAT                                            S01117
113600200616     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
113700200616     C                     IN   RUNDT                                     S01117
113800200616      *                                                                   S01117
113900200616     C**   ACCESS BANK DETAILS, FOR TITLE                                 S01117
114000200616      *                                                                   S01117
114100200616     C                     CALL 'AOBANKR0'                                S01117
114200200616     C                     PARM '*MSG   ' @RTCD   7                       S01117
114300200616     C                     PARM '*FIRST ' @OPTN   7                       S01117
114400200616     C           SDBANK    PARM SDBANK    DSFDY                           S01117
114500200616     C*                                                                   S01117
114600200616     C           @RTCD     IFNE *BLANK                                    S01117
114700200616     C           *LOCK     IN   LDA                                       S01117
114800200616     C                     MOVEL'SDBANKPD'DBFILE                          S01117
114900200616     C                     MOVEL@OPTN     DBKEY            ***************S01117
115000200616     C                     MOVEL@OPTN     DBOPTN  7        * DBERROR 011 *S01117
115100200616     C                     Z-ADD11        DBASE            ***************S01117
115200200616     C                     OUT  LDA                                       S01117
115300200616     C                     SETON                     U7U8                 S01117
115400200616     C                     EXSR *PSSR                                     S01117
115500200616     C*                                                                   S01117
115600200616     C                     ELSE                                           S01117
115700200616     C/COPY WNCPYSRC,SE2300C003
115800200616     C*                                                                   S01117
115900200616     C** Get Base Currency decimal places                                 S01117
116000200616     C*                                                                   S01117
116100200616     C                     MOVE *BLANK    ZZ006                           S01117
116200200616     C                     MOVE '20'      RECT                            S01117
116300200616     C                     MOVE 1         ZZ001                           S01117
116400200616     C                     MOVE BCCY      RCCY                            S01117
116500200616     C*                                                                   S01117
116600200616     C           TABKEY    CHAINTABTG10F             80                   S01117
116700200616     C           *IN80     IFEQ '1'                                       S01117
116800200616     C           RECI      OREQ '*'                                       S01117
116900200616     C           *LOCK     IN   LDA                                       S01117
117000200616     C                     MOVE 'TABLE'   DBFILE           ***************S01117
117100200616     C                     MOVELTKEY      DBKEY            ** DB ERROR 14 S01117
117200200616     C                     Z-ADD14        DBASE            ***************S01117
117300200616     C                     OUT  LDA                                       S01117
117400200616     C                     SETON                     99U7U8               S01117
117500200616     C                     EXSR *PSSR                                     S01117
117600200616     C                     ELSE                                           S01117
117700200616     C*                                                                   S01117
117800200616     C** Save Base Currency Decimal Places for SR.ZCONV                   S01117
117900200616     C*                                                                   S01117
118000200616     C           *LIKE     DEFN CDP       BSCDP                           S01117
118100200616     C                     Z-ADDCDP       BSCDP                           S01117
118200200616     C                     END                                            S01117
118300200616     C                     END
118400200616     C*
118500200616     C                     END
118600200616     C                     END
118700200616      *                                                                                       233710
118800200616     C                     CALL 'AOCTRYR0'                                                    233710
118900200616     C                     PARM *BLANKS   PRTCD                                               233710
119000200616     C                     PARM '*KEY   ' POPTN                                               233710
119100200616     C                     PARM BJCNCD    PKEY    3                                           233710
119200200616     C           SDCTRY    PARM SDCTRY    DSSDY                                               233710
119300200616      *                                                                                       233710
119400200616     C           PRTCD     IFNE *BLANKS                                                       233710
119500200616     C           *LOCK     IN   LDA                                                           233710
119600200616     C                     MOVE 'SDCTRYPD'DBFILE                                              233710
119700200616     C                     MOVELPKEY      DBKEY                                               233710
119800200616     C                     Z-ADD31        DBASE                                               233710
119900200616     C                     OUT  LDA                                                           233710
120000200616     C                     MOVE *ON       *INU7                                               233710
120100200616     C                     MOVE *ON       *INU8                                               233710
120200200616     C                     EXSR *PSSR                                                         233710
120300200616     C                     ENDIF                                                              233710
120400200616     C*                                                                   S01486
120500200616     C**  Access SDMMODPD for Portfolio Management Indicator.             S01486
120600200616     C*                                                                   S01486
120700200616     C                     CALL 'AOMMODR0'                                S01486
120800200616     C                     PARM '        '@RTCD   7                       S01486
120900200616     C                     PARM '*FIRST  '@OPTN   7                       S01486
121000200616     C           @MMOD     PARM @MMOD     DSFDY                           S01486
121100200616     C*                                                                   S01486
121200200616     C           @RTCD     IFNE *BLANK                                    S01486
121300200616     C           BGTYLC    OREQ 'D'                                       S01486
121400200616     C           *LOCK     IN   LDA                                       S01486
121500200616     C                     Z-ADD21        DBASE            ***************S01486
121600200616     C                     MOVE 'SDMMODPD'DBFILE           * DB ERROR 21 *S01486
121700200616     C                     MOVEL*BLANKS   DBKEY            ***************S01486
121800200616     C                     OUT  LDA                                       S01486
121900200616     C                     SETON                     U7U899               S01486
122000200616     C                     EXSR *PSSR                                     S01486
122100200616     C                     END                                            S01486
122200200616     C*                                                                   CAC002
122300200616     C**  Access Securities Trading details                               CAC002
122400200616     C*                                                                   CAC002
122500200616     C                     CALL 'AOSTRDR0'                                CAC002
122600200616     C                     PARM '*MSG   ' @RTCD                           CAC002
122700200616     C                     PARM '*FIRST ' @OPTN                           CAC002
122800200616     C           SDSTRD    PARM SDSTRD    DSSDY                           CAC002
122900200616     C*                                                                   CAC002
123000200616     C           @RTCD     IFNE *BLANKS                                   CAC002
123100200616     C           *LOCK     IN   LDA                                       CAC002
123200200616     C                     Z-ADD25        DBASE            ************   CAC002
123300200616     C                     MOVEL'SDSTRDPD'DBFILE           * DBERR 25 *   CAC002
123400200616     C                     MOVEL@OPTN     DBKEY            ************   CAC002
123500200616     C                     OUT  LDA                                       CAC002
123600200616     C                     SETON                     U7U8                 CAC002
123700200616     C                     EXSR *PSSR                                     CAC002
123800200616     C                     ENDIF                                          CAC002
123900200616      *                                                                   S01446
124000200616      **  Access Switchable features file for Customer Commission         S01446
124100200616      **  and Withholding Tax features                                    S01446
124200200616      *                                                                   S01446
124300200616     C                     MOVE 'N'       S01446                          S01446
124400200616     C                     CALL 'AOSARDR0'                                S01446
124500200616     C                     PARM '       ' @RTCD                           S01446
124600200616     C                     PARM '*VERIFY' @OPTN                           S01446
124700200616     C                     PARM 'S01446'  @SARD   6                       S01446
124800200616      *                                                                   S01446
124900200616     C           @RTCD     IFEQ *BLANK                                    S01446
125000200616     C                     MOVE 'Y'       S01446  1                       S01446
125100200616     C                     END                                            S01447
125200200616      *                                                                   S01447
125300200616     C                     MOVE 'N'       S01447                          S01447
125400200616     C                     CALL 'AOSARDR0'                                S01447
125500200616     C                     PARM '       ' @RTCD                           S01447
125600200616     C                     PARM '*VERIFY' @OPTN                           S01447
125700200616     C                     PARM 'S01447'  @SARD                           S01447
125800200616      *                                                                   S01447
125900200616     C           @RTCD     IFEQ *BLANK                                    S01447
126000200616     C                     MOVE 'Y'       S01447  1                       S01447
126100200616     C                     END                                            S01447
126200200616     C/COPY WNCPYSRC,SE2300C004
126300200616     C*
126400200616     C** Access SAR files to check if Position Settlements is active      S01512
126500200616     C*                                                                   S01512
126600200616     C                     MOVE 'N'       S01512                          S01512
126700200616     C                     CALL 'AOSARDR0'                                S01512
126800200616     C                     PARM '       ' @RTCD                           S01512
126900200616     C                     PARM '*VERIFY' @OPTN                           S01512
127000200616     C                     PARM 'S01512'  @SARD   6                       S01512
127100200616     C*                                                                   S01512
127200200616     C           @RTCD     IFEQ *BLANK                                    S01512
127300200616     C                     MOVE 'Y'       S01512  1                       S01512
127400200616     C                     END                                            S01512
127500200616     C*                                                                   S01512
127600200616     C** Set event control date to lesser of accrual profit date and      S01512
127700200616     C** date of next working day - 1 if S01512 is active                 S01512
127800200616     C*                                                                   S01512
127900200616     C           S01512    IFEQ 'Y'                                       S01512
128000200616     C           DNWD      SUB  1         WWCHK   50                      S01512
128100200616     C           APDA      IFLT WWCHK                                     S01512
128200200616     C                     Z-ADDAPDA      WWECD                           S01512
128300200616     C                     ELSE                                           S01512
128400200616     C                     Z-ADDWWCHK     WWECD   50                      S01512
128500200616     C                     END                                            S01512
128600200616     C                     ELSE                                           247782A
128700200616     C                     Z-ADDAPDA      WWECD                           247782A
128800200616     C                     END                                            S01512
128900200616     C*                                                                   S01512
129000200616      ** Check if CGL031 is installed                                                         233710
129100200616      *                                                                                       233710
129200200616     C                     CALL 'AOSARDR0'                                                    233710
129300200616     C                     PARM *BLANKS   PRTCD   7                                           233710
129400200616     C                     PARM '*VERIFY' POPTN   7                                           233710
129500200616     C                     PARM 'CGL031'  PSARD   6                                           233710
129600200616     C           SCSARD    PARM SCSARD    DSFDY                                               233710
129700200616      *                                                                                       233710
129800200616     C           PRTCD     IFEQ *BLANKS                                                       233710
129900200616     C                     MOVE 'Y'       CGL031  1                                           233710
130000200616     C                     ELSE                                                               233710
130100200616     C                     MOVE 'N'       CGL031                                              233710
130200200616     C                     ENDIF                                                              233710
130300200616      *                                                                                       233710
130400200616     C                     CALL 'AOSARDR0'                                                    CER048
130500200616     C                     PARM *BLANKS   PRTCD                                               CER048
130600200616     C                     PARM '*VERIFY' POPTN                                               CER048
130700200616     C                     PARM 'CER048'  PSARD                                               CER048
130800200616     C           SCSARD    PARM SCSARD    DSFDY                                               CER048
130900200616      *                                                                                       CER048
131000200616     C           PRTCD     IFEQ *BLANKS                                                       CER048
131100200616     C                     MOVE 'Y'       CER048  1                                           CER048
131200200616     C                     ELSE                                                               CER048
131300200616     C                     MOVE 'N'       CER048                                              CER048
131400200616     C                     ENDIF                                                              CER048
131500200616      *                                                                                       CER048
131600200616     C                     CALL 'AOSARDR0'                                                    CER054
131700200616     C                     PARM *BLANKS   PRTCD                                               CER054
131800200616     C                     PARM '*VERIFY' POPTN                                               CER054
131900200616     C                     PARM 'CER054'  PSARD                                               CER054
132000200616     C           SCSARD    PARM SCSARD    DSFDY                                               CER054
132100200616      *                                                                                       CER054
132200200616     C                     MOVE 'N'       CER054                                              CER054
132300200616      *                                                                                       CER054
132400200616     C           PRTCD     IFEQ *BLANKS                                                       CER054
132500200616     C                     MOVE 'Y'       CER054  1                                           CER054
132600200616     C                     ENDIF                                                              CER054
132700200616      *                                                                                       CER054
132800200616     C           PRTCD     IFNE *BLANKS                                                       CER054
132900200616     C           PRTCD     ANDNE'*NRF'                                                        CER054
133000200616      *                                                                                       CER054
133100200616     C           *LOCK     IN   LDA                                                           CER054
133200200616     C                     MOVEL'SCSARDPD'DBFILE                                              CER054
133300200616     C                     MOVELPSARD     DBKEY                                               CER054
133400200616     C                     Z-ADD63        DBASE                                               CER054
133500200616     C                     OUT  LDA                                                           CER054
133600200616     C                     SETON                     U7U8                                     CER054
133700200616     C                     EXSR *PSSR                                                         CER054
133800200616      *                                                                                       CER054
133900200616     C                     ENDIF                                                              CER054
134000200616     C/COPY WNCPYSRC,SE2300C019
134100200616     C                     ENDSR
134200200616     C*****************************************************************
134300200616     C/EJECT
134400200616     C*****************************************************************
134500200616     C*                                                               *
134600200616     C* SUBROUTINE TO OUTPUT CONTROL REPORT                           *
134700200616     C*                                                               *
134800200616     C*****************************************************************
134900200616     C*
135000200616     C           AUDIT     BEGSR                           ** AUDIT **
135100200616     C*
135200200616     C* READ POSET AUDIT RECORD
135300200616     C*
135400200616     C           *INU8     IFEQ '0'
135500200616     C                     READ POSETAF                  99
135600200616     C           *IN99     IFEQ '1'
135700200616     C                     MOVE '1'       *INU7
135800200616     C                     MOVE '1'       *INU8            ***************
135900200616     C           *LOCK     IN   LDA                                       S01117
136000200616     C***********          Z-ADD10        DBASE            **DB*ERROR*10**E20651
136100200616     C                     Z-ADD12        DBASE            **DB ERROR 12**E20651
136200200616     C                     MOVEL'POSETA'  DBFILE           ***************
136300200616     C                     MOVEL'AUDIT'   DBKEY
136400200616     C                     OUT  LDA                                       S01117
136500200616     C                     EXSR *PSSR                                     S01117
136600200616     C**********           END                                            E14884
136700200616     C**********           END                                            E14884
136800200616     C                     ELSE                                           E14884
136900200616     C*
137000200616     C* IF RECORD COUNT NOT EQUAL TO AUDIT COUNT
137100200616     C*
137200200616     C           NORE      IFNE IREC
137300200616     C                     SETON                     57U8
137400200616     C                     END
137500200616     C*                                                                   E14884
137600200616     C* IF NO ERROR IN FILE CONTROLS - UPDATE AUDIT RECORD                E14884
137700200616     C*                                                                   E14884
137800200616     C                     Z-ADDNORE      ONORE   50                      E14884
137900200616     C           NORE      SUB  MREC      NORE                            E14884
138000200616     C           S01496    IFEQ 'Y'                                       S01496
138100200616     C           CSE007    OREQ 'Y'                                       CSE007
138200200616     C           CEU017    OREQ 'Y'                                       CEU017
138300200616     C**********           Z-ADDNORE      NLRB                                       S01496 MD054041
138400200616     C                     Z-ADD0         NOAM                                                225599
138500200616     C                     Z-ADD0         NODE                                                225599
138600200616     C                     END                                            S01496
138700200616     C                     Z-ADDNORE      NLRB                                              MD054041
138800200616     C           *INU8     IFEQ '0'                                       E14884
138900200616     C                     UPDATPOSETAF                                   E14884
139000200616     C                     END                                            E14884
139100200616     C*                                                                   E14884
139200200616     C                     END                                            E14884
139300200616     C                     END                                            E14884
139400200616     C*
139500200616     C* OUTPUT CONTROL REPORT
139600200616     C*
139700200616     C                     WRITEHEADR
139800200616     C********** *INU8     IFEQ '0'                                       E14840
139900200616     C           *INU7     IFEQ '0'                                       E14840
140000200616     C*
140100200616     C***********IREC      IFEQ 0                                         S01117
140200200616     C***********          WRITENONE                                      S01117
140300200616     C***********          ELSE                                           S01117
140400200616AW   C                     Z-ADDINT,Z     OHASH1
140500200616AW   C                     Z-ADDDEC,Z     OHASH2
140600200616     C                     WRITECONTROL
140700200616     C***********          END                                            S01117
140800200616     C*
140900200616     C                     ELSE
141000200616     C                     WRITEERROR
141100200616     C                     END
141200200616     C*
141300200616     C***********          WRITETRAIL                                     S01117
141400200616     C*
141500200616     C* WRITE SEKEYDA RECORD
141600200616     C*
141700200616     C           *INU8     IFEQ '0'
141800200616     C                     MOVE OREC      NORE
141900200616AW   C                     Z-ADDINT,Z     HRWN
142000200616AW   C                     Z-ADDDEC,Z     HRDC
142100200616     C                     WRITESEKEYAF
142200200616     C                     END
142300200616     C*
142400200616     C                     ENDSR
142500200616     C*****************************************************************
142600200616     C/EJECT
142700200616     C*****************************************************************
142800200616     C*                                                               *
142900200616     C* P01 - SUBROUTINE TO GENERATE AMOUNT DUE KEY                   *
143000200616     C*                                                               *
143100200616     C*****************************************************************
143200200616     C*
143300200616     C           P01       BEGSR                           ** P01    **
143400200616     C*
143500200616     C*  SET NEGATIVE IND
143600200616     C*
143700200616     C           NPAC      IFEQ 'N'
143800200616     C           PNMP      ORGE 0
143900200616     C                     MOVE ' '       NEGI
144000200616     C                     ELSE
144100200616     C                     MOVE 'N'       NEGI
144200200616     C                     END
144300200616     C*
144400200616     C*  SET AMOUNT CODE
144500200616     C*
144600200616     C           PEVT      IFEQ 'CP'
144700200616     C           PEVT      OREQ 'DV'
144800200616     C           WWCOAT    OREQ 'I'                                       CSE007
144900200616     C           CSE007    ANDEQ'Y'                                       CSE007
145000200616     C           WWCOAT    OREQ 'I'                                       CEU017
145100200616     C           CEU017    ANDEQ'Y'                                       CEU017
145200200616     C                     MOVE 'DI'      AMCD
145300200616     C                     ELSE
145400200616     C           PEVT      IFEQ 'PP'
145500200616     C                     MOVE 'PP'      AMCD
145600200616     C                     ELSE
145700200616     C           PEVT      IFEQ 'MP'
145800200616     C                     MOVE 'MR'      AMCD
145900200616     C                     ELSE
146000200616     C           PEVT      IFEQ 'MT'
146100200616     C           PEVT      OREQ 'RC'                                      S01496
146200200616     C           S01496    ANDEQ'Y'                                       S01496
146300200616     C                     MOVE 'CV'      AMCD
146400200616     C                     ELSE                                           CSE007
146500200616     C           WWCOAT    IFEQ 'O'                                       CSE007
146600200616     C           CSE007    ANDEQ'Y'                                       CSE007
146700200616     C           WWCOAT    OREQ 'O'                                       CEU017
146800200616     C           CEU017    ANDEQ'Y'                                       CEU017
146900200616     C                     MOVE 'CD'      AMCD                            CSE007
147000200616     C                     END                                            CSE007
147100200616     C                     END
147200200616     C                     END
147300200616     C                     END
147400200616     C                     END
147500200616     C*                                                                   CSE007
147600200616     C* IF POSITION SETTLEMENT GENERATED FROM A CORPORATE ACTION          CSE007
147700200616     C*                                                                   CSE007
147800200616     C           WWCOAT    IFEQ 'I'                                       CSE007
147900200616     C           WWCOAT    OREQ 'O'                                       CSE007
148000200616     C*                                                                   CSE007
148100200616     C* INCLUDE TRADE SUB-TYPE IN CORPORATE ACTION KEY                    CSE007
148200200616     C*                                                                   CSE007
148300200616     C           BVCOTA    IFEQ 'Y'                                       CSE007
148400200616     C                     MOVELMMTSUB    PSBS                            CSE007
148500200616     C                     MOVE MMTSUB    FIL1                            CSE007
148600200616     C                     ELSE                                           CSE007
148700200616     C                     MOVE *BLANKS   PSBS                            CSE007
148800200616     C                     ENDIF                                          CSE007
148900200616     C                     ENDIF                                          CSE007
149000200616     C*                                                                   CSE007
149100200616     C*                                                                   E15329
149200200616     C* SET OTHER A/C KEY FIELDS RELEVENT TO THIS PROCESS
149300200616     C*                                                                   E15329
149400200616     C                     MOVE 'S'       EVTP
149500200616     C***********          Z-ADDPAMD      EVAM
149600200616     C*                                                                   E15329
149700200616     C           AMCD      IFEQ 'PP'                                      E15329
149800200616     C*                                                                   E15329
149900200616     C           PPRE      IFEQ 'P'                                       E15329
150000200616     C*                                                                   E15329
150100200616     C           C1DI      IFEQ 'S'                                       E15329
150200200616     C           C1DI      OREQ 'D'                                       E15329
150300200616     C                     Z-SUBPAMD      EVAM                            E15329
150400200616     C                     ELSE                                           E15329
150500200616     C                     Z-ADDPAMD      EVAM                            E15329
150600200616     C                     END                                            E15329
150700200616     C*                                                                   E15329
150800200616     C                     ELSE                                           E15329
150900200616     C*                                                                   E15329
151000200616     C           C1DI      IFEQ 'S'                                       E15329
151100200616     C           C1DI      OREQ 'D'                                       E15329
151200200616     C                     Z-ADDPAMD      EVAM                            E15329
151300200616     C                     ELSE                                           E15329
151400200616     C                     Z-SUBPAMD      EVAM                            E15329
151500200616     C                     END                                            E15329
151600200616     C*                                                                   E15329
151700200616     C                     END                                            E15329
151800200616     C*                                                                   E15329
151900200616     C                     ELSE                                           E15329
152000200616     C*                                                                   E15329
152100200616     C           PPRE      IFEQ 'P'                                       E15329
152200200616     C*                                                                   E15329
152300200616     C           C1DI      IFEQ 'S'                                       E15329
152400200616     C           C1DI      OREQ 'D'                                       E15329
152500200616     C                     Z-ADDPAMD      EVAM                            E15329
152600200616     C                     ELSE                                           E15329
152700200616     C                     Z-SUBPAMD      EVAM                            E15329
152800200616     C                     END                                            E15329
152900200616     C*                                                                   E15329
153000200616     C                     ELSE                                           E15329
153100200616     C*                                                                   E15329
153200200616     C           C1DI      IFEQ 'S'                                       E15329
153300200616     C           C1DI      OREQ 'D'                                       E15329
153400200616     C                     Z-SUBPAMD      EVAM                            E15329
153500200616     C                     ELSE                                           E15329
153600200616     C                     Z-ADDPAMD      EVAM                            E15329
153700200616     C                     END                                            E15329
153800200616     C*                                                                   E15329
153900200616     C                     END                                            E15329
154000200616     C*                                                                   E15329
154100200616     C                     END                                            E15329
154200200616     C*                                                                   E15329
154300200616     C                     MOVE PSMT      STLT                            091407
154400200616     C                     MOVE PSEA      STLA                            091407
154500200616      *                                                                   091407
154600200616     C                     EXSR WRITED
154700200616     C/COPY WNCPYSRC,SE2300C005
154800200616     C*
154900200616     C                     ENDSR
155000200616     C*****************************************************************
155100200616     C/EJECT
155200200616     C*****************************************************************
155300200616     C*                                                               *
155400200616     C* P02   - SUBROUTINE TO GENERATE CHARGE & COMMISSION KEYS       *
155500200616     C*                                                               *
155600200616     C*****************************************************************
155700200616     C*
155800200616     C           P02       BEGSR                           ** P02    **
155900200616     C/COPY WNCPYSRC,SE2300C020
156000200616     C*
156100200616     C*  SET AMOUNT CODE
156200200616     C*
156300200616     C           PEVT      IFEQ 'CP'
156400200616     C                     MOVEL'C'       EVTP
156500200616     C                     ELSE
156600200616     C           PEVT      IFEQ 'DV'
156700200616     C                     MOVEL'H'       EVTP
156800200616     C                     ELSE
156900200616     C           PEVT      IFEQ 'PP'
157000200616     C                     MOVEL'P'       EVTP
157100200616     C                     ELSE
157200200616     C           PEVT      IFEQ 'MP'
157300200616     C                     MOVEL'R'       EVTP
157400200616     C                     ELSE
157500200616     C           PEVT      IFEQ 'MT'
157600200616     C           PEVT      OREQ 'RC'                                      S01496
157700200616     C           S01496    ANDEQ'Y'                                       S01496
157800200616     C                     MOVEL'M'       EVTP
157900200616     C                     ELSE                                           CSE007
158000200616     C           WWCOAT    IFEQ 'I'                                       CSE007
158100200616     C           WWCOAT    OREQ 'O'                                       CSE007
158200200616     C                     MOVEL'X'       EVTP                            CSE007
158300200616     C                     END                                            CSE007
158400200616     C                     END
158500200616     C                     END
158600200616     C                     END
158700200616     C                     END
158800200616     C                     END
158900200616     C*                                                                   CSE007
159000200616     C* IF POSITION SETTLEMENT GENERATED FROM A CORPORATE ACTION          CSE007
159100200616     C*                                                                   CSE007
159200200616     C           WWCOAT    IFEQ 'I'                                       CSE007
159300200616     C           WWCOAT    OREQ 'O'                                       CSE007
159400200616     C*                                                                   CSE007
159500200616     C* INCLUDE TRADE SUB-TYPE IN CORPORATE ACTION KEY                    CSE007
159600200616     C*                                                                   CSE007
159700200616     C           BVCOTA    IFEQ 'Y'                                       CSE007
159800200616     C                     MOVELMMTSUB    PSBS                            CSE007
159900200616     C                     MOVE MMTSUB    FIL1                            CSE007
160000200616     C                     ELSE                                           CSE007
160100200616     C                     MOVE *BLANKS   PSBS                            CSE007
160200200616     C                     ENDIF                                          CSE007
160300200616     C                     ENDIF                                          CSE007
160400200616     C*
160500200616     C* IF CHARGE AMOUNT NON ZERO GENERATE CHARGE A/C KEY
160600200616     C*
160700200616     C           PCHA      IFNE 0
160800200616     C*
160900200616     C* DETERMINE AMOUNT CODE DEPENDING ON SIGN OF CHARGE AND
161000200616     C* DISCRET IND.
161100200616     C*
161200200616     C           C1DI      IFEQ 'S'
161300200616     C           C1DI      OREQ 'D'
161400200616     C           PCHA      IFGT 0
161500200616     C                     MOVEL'FR'      AMCD
161600200616     C                     ELSE
161700200616     C                     MOVEL'FP'      AMCD
161800200616     C                     END
161900200616     C                     ELSE
162000200616     C           PCHA      IFGT 0
162100200616     C                     MOVEL'FP'      AMCD
162200200616     C                     ELSE
162300200616     C                     MOVEL'FR'      AMCD
162400200616     C                     END
162500200616     C                     END
162600200616     C*                                                                   S01446
162700200616     C* If Customer Commission feature is on and Autocharges is on,       S01446
162800200616     C* Or Analytical Accounting is installed,                            CAC002
162900200616     C* access the Charge Types file for the Group Charge Code            S01446
163000200616     C*                                                                   S01446
163100200616     C           S01446    IFEQ 'Y'                                       S01446
163200200616     C           AUMO      ANDEQ'Y'                                       S01446
163300200616     C           BGN0ST    OREQ 'Y'                                       CAC002
163400200616     C                     CALL 'AOCHGTR0'                                S01446
163500200616     C                     PARM *BLANKS   @RTCD                           S01446
163600200616     C                     PARM '*KEY'    @OPTN                           S01446
163700200616     C                     PARM PNCY      @CCY    3                       S01446
163800200616     C                     PARM PCHC      @CCOM   2                       S01446
163900200616     C           SECGT     PARM SECGT     DSSDY                           S01446
164000200616      *                                                                   S01446
164100200616     C           @RTCD     IFNE *BLANK                                    S01446
164200200616     C           *LOCK     IN   LDA                                       S01446
164300200616     C                     MOVEL'SECGT'   DBFILE                          S01446
164400200616     C                     MOVE PCHC      WDBKY   6                       S01446
164500200616     C                     MOVELPNCY      WDBKY                           S01446
164600200616     C                     MOVELWDBKY     DBKEY            ***************S01446
164700200616     C                     Z-ADD17        DBASE            * DB ERROR 17 *S01446
164800200616     C                     OUT  LDA                        ***************S01446
164900200616     C                     SETON                     99U7U8               S01446
165000200616     C                     EXSR *PSSR                                     S01446
165100200616     C                     GOTO EAUDIT                                    S01446
165200200616     C                     ELSE                                           S01446
165300200616      *                                                                   CAC002
165400200616     C           S01446    IFEQ 'Y'                                       CAC002
165500200616     C           AUMO      ANDEQ'Y'                                       CAC002
165600200616     C                     MOVELGCCO      CGTP                            S01446
165700200616     C                     ELSE                                           CAC002
165800200616     C                     MOVELPCHC      CGTP                            CAC002
165900200616     C                     ENDIF                                          CAC002
166000200616      *                                                                   CAC002
166100200616      ** If Analytical Accounting is installed, define a Profit Centre.   CAC002
166200200616      *                                                                   CAC002
166300200616     C           BGN0ST    IFEQ 'Y'                                       CAC002
166400200616      *                                                                   CAC002
166500200616     C           S01446    IFEQ 'Y'                                       CAC002
166600200616     C           AUMO      ANDEQ'Y'                                       CAC002
166700200616      *                                                                   CAC002
166800200616      ** Access charges codes file for Group charge code.                 CAC002
166900200616      *                                                                   CAC002
167000200616     C                     CALL 'AOCHGTR0'                                CAC002
167100200616     C                     PARM *BLANKS   @RTCD                           CAC002
167200200616     C                     PARM '*KEY   ' @OPTN                           CAC002
167300200616     C                     PARM PNCY      @CCY                            CAC002
167400200616     C                     PARM GCCO      @CCOM                           CAC002
167500200616     C           SECGT     PARM SECGT     DSSDY                           CAC002
167600200616      *                                                                   CAC002
167700200616     C           @RTCD     IFNE *BLANKS                                   CAC002
167800200616     C           *LOCK     IN   LDA                                       CAC002
167900200616     C                     MOVEL'SECGT'   DBFILE                          CAC002
168000200616     C                     MOVE GCCO      WDBKY                           CAC002
168100200616     C                     MOVELPNCY      WDBKY                           CAC002
168200200616     C                     MOVELWDBKY     DBKEY            ************   CAC002
168300200616     C                     Z-ADD26        DBASE            * DBERR 26 *   CAC002
168400200616     C                     OUT  LDA                        ************   CAC002
168500200616     C                     SETON                     99U7U8               CAC002
168600200616     C                     EXSR *PSSR                                     CAC002
168700200616     C                     GOTO EAUDIT                                    CAC002
168800200616     C                     ENDIF                                          CAC002
168900200616      *                                                                   CAC002
169000200616     C                     ENDIF                                          CAC002
169100200616      *                                                                   CAC002
169200200616     C           BOTR      IFEQ 'T'                                       CAC002
169300200616     C           BOTR      OREQ 'B'                                       CAC002
169400200616      *                                                                   CAC002
169500200616     C           C1DI      IFEQ 'S'                                       CAC002
169600200616     C           C1DI      OREQ 'D'                                       CAC002
169700200616     C                     MOVE PPFC      PRFC                            CAC002
169800200616     C                     ELSE                                           CAC002
169900200616     C                     MOVE BVSEPC    PRFC                            CAC002
170000200616     C                     ENDIF                                          CAC002
170100200616     C*                                                                   CAC002
170200200616     C                     ELSE                                           CAC002
170300200616     C                     MOVE PRFC1     PRFC                            CAC002
170400200616     C                     ENDIF                                          CAC002
170500200616     C*                                                                   CAC002
170600200616     C                     ENDIF                                          CAC002
170700200616      *                                                                   CAC002
170800200616     C                     END                                            S01446
170900200616     C                     ELSE                                           S01446
171000200616     C*
171100200616     C* SET OTHER FIELDS ON A/C KEY RELEVENT TO THIS PROCESS
171200200616     C*
171300200616     C*********************MOVELPBCD      BOOK                            E21245
171400200616     C                     MOVELPCHC      CGTP
171500200616     C                     END                                            S01446
171600200616     C/COPY WNCPYSRC,SE2300C006
171700200616     C                     Z-ADDPCHA      EVAM
171800200616     C/COPY WNCPYSRC,SE2300C021
171900200616     C*
172000200616     C* WRITE A/C KEY
172100200616     C*
172200200616     C           AMCD      IFEQ 'FP'                                      E15687
172300200616     C           AMCD      OREQ 'FR'                                      E15687
172400200616     C           EVAM      IFLT 0                                         E15687
172500200616     C                     Z-SUBEVAM      EVAM                            E15687
172600200616     C                     END                                            E15687
172700200616      *                                                                                       CGL020
172800200616      ** Set the Fee Fields if CGL020 is enabled.                                             CGL020
172900200616      *                                                                                       CGL020
173000200616     C           CGL020    IFEQ 'Y'                                                           CGL020
173100200616     C                     MOVE 'F'       F1FFLG                                              CGL020
173200200616     C                     Z-ADDPCHA      F1FVAL                                              CGL020
173300200616     C                     Z-ADD100       F1FPCT                                              CGL020
173400200616     C                     ENDIF                                                              CGL020
173500200616      *                                                                                       CGL020
173600200616     C                     END                                            E15687
173700200616     C*
173800200616     C                     MOVE PSMT      STLT                            091407
173900200616     C                     MOVE PSEA      STLA                            091407
174000200616      *                                                                   091407
174100200616     C/COPY WNCPYSRC,SE2300C022
174200200616     C                     EXSR WRITED
174300200616     C/COPY WNCPYSRC,SE2300C007
174400200616     C                     END
174500200616     C*
174600200616     C* IF COMMISSION AMOUNT NON ZERO GENERATE CHARGE A/C KEY
174700200616     C*
174800200616     C           PCAM      IFNE 0
174900200616     C*
175000200616     C* DETERMINE AMOUNT CODE DEPENDING ON SIGN OF CHARGE AND
175100200616     C* DISCRET IND.
175200200616     C*
175300200616     C           C1DI      IFEQ 'S'
175400200616     C           C1DI      OREQ 'D'
175500200616     C           PCAM      IFGT 0
175600200616     C***********          MOVE 'FR'      AMCD                            E14888
175700200616     C                     MOVE 'CR'      AMCD                            E14888
175800200616     C                     ELSE
175900200616     C***********          MOVE 'FP'      AMCD                            E14888
176000200616     C                     MOVE 'CP'      AMCD                            E14888
176100200616     C                     END
176200200616     C                     ELSE
176300200616     C           PCAM      IFGT 0
176400200616     C***********          MOVE 'FP'      AMCD                            E14888
176500200616     C                     MOVE 'CP'      AMCD                            E14888
176600200616     C                     ELSE
176700200616     C***********          MOVE 'FR'      AMCD                            E14888
176800200616     C                     MOVE 'CR'      AMCD                            E14888
176900200616     C                     END
177000200616     C                     END
177100200616     C*                                                                   S01446
177200200616     C* If Customer Commission feature is on and Autocharges is on,       S01446
177300200616     C* Or Analytical Accounting is installed,                            CAC002
177400200616     C* access the Charge Types file for the Group Charge Code            S01446
177500200616     C*                                                                   S01446
177600200616     C           S01446    IFEQ 'Y'                                       S01446
177700200616     C           AUMO      ANDEQ'Y'                                       S01446
177800200616     C           BGN0ST    OREQ 'Y'                                       CAC002
177900200616     C                     CALL 'AOCHGTR0'                                S01446
178000200616     C                     PARM *BLANKS   @RTCD                           S01446
178100200616     C                     PARM '*KEY'    @OPTN                           S01446
178200200616     C                     PARM PNCY      @CCY    3                       S01446
178300200616     C                     PARM PCCD      @CCOM   2                       S01446
178400200616     C           SECGT     PARM SECGT     DSSDY                           S01446
178500200616      *                                                                   S01446
178600200616     C           @RTCD     IFNE *BLANK                                    S01446
178700200616     C           *LOCK     IN   LDA                                       S01446
178800200616     C                     MOVEL'SECGT'   DBFILE                          S01446
178900200616     C                     MOVE PCCD      WDBKY   6                       S01446
179000200616     C                     MOVELPNCY      WDBKY                           S01446
179100200616     C                     MOVELWDBKY     DBKEY            ***************S01446
179200200616     C                     Z-ADD20        DBASE            * DB ERROR 20 *S01446
179300200616     C                     OUT  LDA                        ***************S01446
179400200616     C                     SETON                     99U7U8               S01446
179500200616     C                     EXSR *PSSR                                     S01446
179600200616     C                     GOTO EAUDIT                                    S01446
179700200616     C                     ELSE                                           S01446
179800200616      *                                                                   CAC002
179900200616     C           S01446    IFEQ 'Y'                                       CAC002
180000200616     C           AUMO      ANDEQ'Y'                                       CAC002
180100200616     C                     MOVELGCCO      CGTP                            S01446
180200200616     C                     ELSE                                           CAC002
180300200616     C                     MOVELPCCD      CGTP                            CAC002
180400200616     C                     ENDIF                                          CAC002
180500200616      *                                                                   CAC002
180600200616      ** If Analytical Accounting is installed, define a Profit Centre.   CAC002
180700200616      *                                                                   CAC002
180800200616     C           BGN0ST    IFEQ 'Y'                                       CAC002
180900200616      *                                                                   CAC002
181000200616     C           S01446    IFEQ 'Y'                                       CAC002
181100200616     C           AUMO      ANDEQ'Y'                                       CAC002
181200200616      *                                                                   CAC002
181300200616      ** Access charges codes file for Group charge code.                 CAC002
181400200616      *                                                                   CAC002
181500200616     C                     CALL 'AOCHGTR0'                                CAC002
181600200616     C                     PARM *BLANKS   @RTCD                           CAC002
181700200616     C                     PARM '*KEY   ' @OPTN                           CAC002
181800200616     C                     PARM PNCY      @CCY                            CAC002
181900200616     C                     PARM GCCO      @CCOM                           CAC002
182000200616     C           SECGT     PARM SECGT     DSSDY                           CAC002
182100200616      *                                                                   CAC002
182200200616     C           @RTCD     IFNE *BLANKS                                   CAC002
182300200616     C           *LOCK     IN   LDA                                       CAC002
182400200616     C                     MOVEL'SECGT'   DBFILE                          CAC002
182500200616     C                     MOVE GCCO      WDBKY                           CAC002
182600200616     C                     MOVELPNCY      WDBKY                           CAC002
182700200616     C                     MOVELWDBKY     DBKEY            ************   CAC002
182800200616     C                     Z-ADD27        DBASE            * DBERR 27 *   CAC002
182900200616     C                     OUT  LDA                        ************   CAC002
183000200616     C                     SETON                     99U7U8               CAC002
183100200616     C                     EXSR *PSSR                                     CAC002
183200200616     C                     GOTO EAUDIT                                    CAC002
183300200616     C                     ENDIF                                          CAC002
183400200616      *                                                                   CAC002
183500200616     C                     ENDIF                                          CAC002
183600200616      *                                                                   CAC002
183700200616     C           BOTR      IFEQ 'T'                                       CAC002
183800200616     C           BOTR      OREQ 'B'                                       CAC002
183900200616      *                                                                   CAC002
184000200616     C           C1DI      IFEQ 'S'                                       CAC002
184100200616     C           C1DI      OREQ 'D'                                       CAC002
184200200616     C                     MOVE PPFC      PRFC                            CAC002
184300200616     C                     ELSE                                           CAC002
184400200616     C                     MOVE BVSEPC    PRFC                            CAC002
184500200616     C                     ENDIF                                          CAC002
184600200616     C*                                                                   CAC002
184700200616     C                     ELSE                                           CAC002
184800200616     C                     MOVE PRFC1     PRFC                            CAC002
184900200616     C                     ENDIF                                          CAC002
185000200616     C*                                                                   CAC002
185100200616     C                     ENDIF                                          CAC002
185200200616      *                                                                   CAC002
185300200616     C                     END                                            S01446
185400200616     C                     ELSE                                           S01446
185500200616     C*
185600200616     C* SET OTHER FIELDS ON A/C KEY RELEVENT TO THIS PROCESS
185700200616     C*
185800200616     C*********************MOVE PBCD      BOOK                            E21245
185900200616     C                     MOVE PCCD      CGTP
186000200616     C                     END                                            S01446
186100200616     C/COPY WNCPYSRC,SE2300C008
186200200616     C                     Z-ADDPCAM      EVAM
186300200616     C/COPY WNCPYSRC,SE2300C023
186400200616     C*
186500200616     C* WRITE A/C KEY
186600200616     C*
186700200616     C           AMCD      IFEQ 'CP'                                      E15687
186800200616     C           AMCD      OREQ 'CR'                                      E15687
186900200616     C           EVAM      IFLT 0                                         E15687
187000200616     C                     Z-SUBEVAM      EVAM                            E15687
187100200616     C                     END                                            E15687
187200200616      *                                                                                       CGL020
187300200616      ** Set the Fee Fields if CGL020 is enabled.                                             CGL020
187400200616      *                                                                                       CGL020
187500200616     C           CGL020    IFEQ 'Y'                                                           CGL020
187600200616     C                     MOVE 'F'       F1FFLG                                              CGL020
187700200616     C                     Z-ADDPCAM      F1FVAL                                              CGL020
187800200616     C                     Z-ADD100       F1FPCT                                              CGL020
187900200616     C                     ENDIF                                                              CGL020
188000200616      *                                                                                       CGL020
188100200616     C                     END                                            E15687
188200200616     C*
188300200616     C                     MOVE PSMT      STLT                            091407
188400200616     C                     MOVE PSEA      STLA                            091407
188500200616      *                                                                   091407
188600200616     C/COPY WNCPYSRC,SE2300C024
188700200616     C                     EXSR WRITED
188800200616     C/COPY WNCPYSRC,SE2300C009
188900200616     C                     END
189000200616     C/COPY WNCPYSRC,SE2300C038
189100200616     C*
189200200616     C                     ENDSR
189300200616     C*****************************************************************
189400200616     C/EJECT
189500200616     C*****************************************************************
189600200616     C*                                                               *
189700200616     C* P03      -   SUBROUTINE TO GENERATE SETTLEMENT AMOUNT KEY     *
189800200616     C*                                                               *
189900200616     C*****************************************************************
190000200616     C*
190100200616     C           P03       BEGSR                           ** P03    **
190200200616     C/COPY WNCPYSRC,SE2300C034
190300200616     C*                                                                   CSE007
190400200616     C* IF POSITION SETTLEMENT GENERATED FROM A CORPORATE ACTION          CSE007
190500200616     C*                                                                   CSE007
190600200616     C           WWCOAT    IFEQ 'I'                                       CSE007
190700200616     C           WWCOAT    OREQ 'O'                                       CSE007
190800200616     C*                                                                   CSE007
190900200616     C* INCLUDE TRADE SUB-TYPE IN CORPORATE ACTION KEY                    CSE007
191000200616     C*                                                                   CSE007
191100200616     C           BVCOTA    IFEQ 'Y'                                       CSE007
191200200616     C                     MOVELMMTSUB    PSBS                            CSE007
191300200616     C                     MOVE MMTSUB    FIL1                            CSE007
191400200616     C                     ELSE                                           CSE007
191500200616     C                     MOVE *BLANKS   PSBS                            CSE007
191600200616     C                     ENDIF                                          CSE007
191700200616     C                     ENDIF                                          CSE007
191800200616      *                                                                   CAC002
191900200616      ** If Analytical Accounting is installed and the Margin amount is   CAC002
192000200616      ** not zero, generate Margin Amount key.                            CAC002
192100200616      *                                                                   CAC002
192200200616     C           BGN0ST    IFEQ 'Y'                                       CAC002
192300200616     C           MAMT      ANDNE0                                         CAC002
192400200616     C                     MOVE 'MA'      AMCD                            CAC002
192500200616     C                     MOVE 'S'       EVTP                            CAC002
192600200616     C                     MOVELPSCU      EVCY                            CAC002
192700200616     C                     Z-ADDMAMT      EVAM                            CAC002
192800200616     C                     EXSR WRITED                                    CAC002
192900200616     C                     ENDIF                                          CAC002
193000200616     C*
193100200616     C*  SET AMOUNT DUE
193200200616     C*
193300200616     C***********          Z-ADDPAMD      KNCA                            E15329
193400200616     C*
193500200616     C           C1DI      IFEQ 'S'                                       E15329
193600200616     C           C1DI      OREQ 'D'                                       E15329
193700200616     C           PPRE      IFEQ 'P'                                       E15329
193800200616     C***********          Z-ADDPAMD      KNCA                     E15329 087178
193900200616     C***********          Z-ADDPSAT      KNCA                     087178 094232
194000200616     C                     Z-ADDPAMD      KNCA                            094232
194100200616     C                     ELSE                                           E15329
194200200616     C***********          Z-SUBPAMD      KNCA                     E15329 087178
194300200616     C***********          Z-SUBPSAT      KNCA                     087178 094232
194400200616     C                     Z-SUBPAMD      KNCA                            094232
194500200616     C                     END                                            E15329
194600200616     C                     ELSE                                           E15329
194700200616     C           PPRE      IFEQ 'R'                                       E15329
194800200616     C***********          Z-ADDPAMD      KNCA                     E15329 087178
194900200616     C***********          Z-ADDPSAT      KNCA                     087178 094232
195000200616     C                     Z-ADDPAMD      KNCA                            094232
195100200616     C                     ELSE                                           E15329
195200200616     C***********          Z-SUBPAMD      KNCA                     E15329 087178
195300200616     C***********          Z-SUBPSAT      KNCA                     087178 094232
195400200616     C                     Z-SUBPAMD      KNCA                            094232
195500200616     C                     END                                            E15329
195600200616     C                     END                                            E15329
195700200616     C***********                                                         E15329
195800200616     C**IF*CHARGE*AMOUNT*NON*ZERO*SUBTRACT*OF*ADD*TO*SETTLE*AMT**         E15329
195900200616     C***********PCHA      IFNE 0                                         E15329
196000200616     C***********                                                         E15329
196100200616     C**DETERMINE*AMOUNT*CODE*DEPENDING*ON*SIGN*OF*CHARGE*AND*            E15329
196200200616     C**DISCRET*IND.                                                      E15329
196300200616     C***********C1DI      IFEQ 'S'                                       E15329
196400200616     C***********C1DI      OREQ 'D'                                       E15329
196500200616     C***********PPRE      IFEQ 'P'                                       E15329
196600200616     C***********          SUB  PCHA      KNCA                            E15329
196700200616     C***********          ELSE                                           E15329
196800200616     C***********          ADD  PCHA      KNCA                            E15329
196900200616     C***********          END                                            E15329
197000200616     C***********          ELSE                                           E15329
197100200616     C***********PPRE      IFEQ 'P'                                       E15329
197200200616     C***********          SUB  PCHA      KNCA                            E15329
197300200616     C***********          ELSE                                           E15329
197400200616     C***********          ADD  PCHA      KNCA                            E15329
197500200616     C***********          END                                            E15329
197600200616     C***********          END                                            E15329
197700200616     C***********          END                                            E15329
197800200616     C***********                                                         E15329
197900200616     C**IF COMMISSION AMOUNT NON ZERO GENERATE COMMISSION A/C KEY         E15329
198000200616     C***********PCAM      IFNE 0                                         E15329
198100200616     C***********                                                         E15329
198200200616     C**DETERMINE AMOUNT CODE DEPENDING ON SIGN OF CHARGE AND             E15329
198300200616     C**DISCRET*IND.                                                      E15329
198400200616     C***********C1DI      IFEQ 'S'                                       E15329
198500200616     C***********C1DI      OREQ 'D'                                       E15329
198600200616     C***********PPRE      IFEQ 'P'                                       E15329
198700200616     C***********          SUB  PCAM      KNCA                            E15329
198800200616     C***********          ELSE                                           E15329
198900200616     C***********          ADD  PCAM      KNCA                            E15329
199000200616     C***********          END                                            E15329
199100200616     C***********          ELSE                                           E15329
199200200616     C***********PPRE      IFEQ 'P'                                       E15329
199300200616     C***********          SUB  PCAM      KNCA                            E15329
199400200616     C***********          ELSE                                           E15329
199500200616     C***********          ADD  PCAM      KNCA                            E15329
199600200616     C***********          END                                            E15329
199700200616     C***********          END                                            E15329
199800200616     C***********          END                                            E15329
199900200616     C***********          SUB  PCHA      KNCA                     E15329 087178
200000200616     C***********          SUB  PCAM      KNCA                     E15329 087178
200100200616     C***********                                                  S01447 087178
200200200616     C***If*Withholding*Tax*is*on*subtract*Tax*Amount*Deducted*at**S01447 087178
200300200616     C***Source*and*Tax*Amount*Deducted*by*User********************S01447 087178
200400200616     C***********                                                  S01447 087178
200500200616     C***********S01447    IFEQ 'Y'                                S01447 087178
200600200616     C***********          SUB  TASO      KNCA                     S01447 087178
200700200616     C***********          SUB  TAUS      KNCA                     S01447 087178
200800200616     C***********          END                                     S01447 087178
200900200616     C/COPY WNCPYSRC,SE2300C010
201000200616     C                     SUB  PCHA      KNCA                            101925
201100200616     C/COPY WNCPYSRC,SE2300C011
201200200616     C                     SUB  PCAM      KNCA                            101925
201300200616     C/COPY WNCPYSRC,SE2300C012
201400200616     C*                                                                   101925
201500200616     C** If Withholding Tax is on subtract Tax Amount Deducted at         101925
201600200616     C** Source and Tax Amount Deducted by User                           101925
201700200616     C**                                                                  101925
201800200616     C           S01447    IFEQ 'Y'                                       101925
201900200616     C                     SUB  TASO      KNCA                            101925
202000200616     C                     SUB  TAUS      KNCA                            101925
202100200616     C                     END                                            101925
202200200616     C*                                                                   S01447
202300200616     C           CGL031    IFEQ 'Y'                                                           234635
202400200616     C           SETX      ANDEQ'Y'                                                           234635
202500200616     C           PNCY      IFNE PSCU                                                          234635
202600200616     C           PAMD      SUB  TXNM      KNCA                                                234635
202700200616     C                     END                                                                234635
202800200616     C                     END                                                                234635
202900200616      *                                                                   183665
203000200616      ** If nominal currency is not equal to due currency, convert KNCA   183665
203100200616      *                                                                   183665
203200200616     C           NMCY      IFNE PNCY                                      183665
203300200616     C                     Z-ADDKNCA      ZAMTF                           183665
203400200616     C                     MOVE PNCY      ZCCYF                           183665
203500200616     C                     MOVE NMCY      ZCCYT                           183665
203600200616      *                                                                   183665
203700200616     C                     CALL 'AOCURRR0'                                183665
203800200616     C                     PARM '*DBERR'  @RTCD                           183665
203900200616     C                     PARM '*KEY   ' @OPTN                           183665
204000200616     C                     PARM PNCY      @AJCD   3                       183665
204100200616     C           SDCURR    PARM SDCURR    DSSDY                           183665
204200200616      *                                                                   183665
204300200616     C                     Z-ADDA6SPRT    ZRATEF                          183665
204400200616     C                     MOVE A6MDIN    ZMDINF                          183665
204500200616     C                     MOVE A6NBDP    ZCDPF                           183665
204600200616      *                                                                   183665
204700200616     C                     CALL 'AOCURRR0'                                183665
204800200616     C                     PARM '*DBERR'  @RTCD                           183665
204900200616     C                     PARM '*KEY   ' @OPTN                           183665
205000200616     C                     PARM NMCY      @AJCD                           183665
205100200616     C           SDCURR    PARM SDCURR    DSSDY                           183665
205200200616      *                                                                   183665
205300200616     C                     Z-ADDA6SPRT    ZRATET                          183665
205400200616     C                     MOVE A6MDIN    ZMDINT                          183665
205500200616     C                     MOVE A6NBDP    ZCDPT                           183665
205600200616      *                                                                   183665
205700200616     C                     EXSR ZCCYCN                                    183665
205800200616     C                     Z-ADDZAMTT     KNCA                            183665
205900200616     C                     END                                            183665
206000200616      *                                                                   183665
206100200616     C***********          Z-ADDKNCA      EVAM                            101925
206200200616     C*                                                                   087178
206300200616     C** Settlement amount, PSAT, is already in settlement currency       087178
206400200616     C** so this portion is ignored                                       087178
206500200616     C***********                                                         087178
206600200616     C**IF*NOM*CCY*NE*SETTL*CCY*CONVERT*SETTL*AMNT*IN*NOM*CCY**********   087178
206700200616     C**TO*SETTL*CCY*USING*P/ZCONV*AND*Z-ADD*TO*EVENT*AMOUNT***********   087178
206800200616     C**IN*PLACE*OF*SETTL*AMONT*IN*NOMINAL*CCY*************************   087178
206900200616     C***********                                                         087178
207000200616     C***********PNCY      IFNE PSCU                                      087178
207100200616     C***********          Z-ADDKNCA      ZAMTCI                          087178
207200200616     C***********          Z-ADDPSXR      ZEXCH                           087178
207300200616     C***********          MOVE PNCY      ZCCYI                           087178
207400200616     C***********          MOVE PSCU      ZCCYO                           087178
207500200616     C***********          MOVE PMDI      ZMD                             087178
207600200616     C***********                                                  S01117 087178
207700200616     C***Get*Nominal*Currency*rate*and*decimal*places*******       S01117 067406
207800200616     C***********                                                  S01117 067406
207900200616     C***********          MOVE *BLANK    ZZ006                    S01117 067406
208000200616     C***********          MOVE '20'      RECT                     S01117 067406
208100200616     C***********          MOVE 1         ZZ001                    S01117 067406
208200200616     C***********          MOVE PNCY      RCCY                     S01117 067406
208300200616     C* *********                                                  S01117 067406
208400200616     C***********TABKEY    CHAINTABTG10F             80            S01117 067406
208500200616     C********** *IN80     IFEQ '1'                                S01117 067406
208600200616     C***********RECI      OREQ '*'                                S01117 067406
208700200616     C********** *LOCK     IN   LDA                                S01117 067406
208800200616     C***********          MOVE 'TABLE'   DBFILE***************    S01117 067406
208900200616     C***********          MOVELTKEY      DBKEY ** DB ERROR 15     S01117 067406
209000200616     C***********          Z-ADD15        DBASE ***************    S01117 067406
209100200616     C***********          OUT  LDA                                S01117 067406
209200200616     C***********          SETON                     99U7U8        S01117 067406
209300200616     C***********          EXSR *PSSR                              S01117 067406
209400200616     C***********          GOTO EAUDIT                             S01117 067406
209500200616     C***********          END                                     S01117 067406
209600200616     C***********                                                  S01117 087178
209700200616     C***Set*Input*Currency*Decimal*Places*for*SR.ZCONV************S01117 087178
209800200616     C***********                                                  S01117 087178
209900200616     C***********          Z-ADDCDP       ZCDPI                    S01117 067406
210000200616     C***********          Z-ADDUNOMDP    ZCDPI                    067406 087178
210100200616     C***********                                                  S01117 087178
210200200616     C***Get*Settlement*Currency*spot*rate*and*decimal*places***** S01117 067406
210300200616     C***Get*Settlement*Currency*decimal*places********************067406 087178
210400200616     C***********                                                  S01117 087178
210500200616     C***********          MOVE *BLANK    ZZ006                    S01117 087178
210600200616     C***********          MOVE '20'      RECT                     S01117 087178
210700200616     C***********          MOVE 1         ZZ001                    S01117 087178
210800200616     C***********          MOVE PSCU      RCCY                     S01117 087178
210900200616     C***********                                                  S01117 087178
211000200616     C***********TABKEY    CHAINTABTG10F             80            S01117 087178
211100200616     C************IN80     IFEQ '1'                                S01117 087178
211200200616     C***********RECI      OREQ '*'                                S01117 087178
211300200616     C************LOCK     IN   LDA                                S01117 087178
211400200616     C***********          MOVE 'TABLE'   DBFILE           ********S01117 087178
211500200616     C***********          MOVELTKEY      DBKEY            ** DB ERS01117 087178
211600200616     C***********          Z-ADD16        DBASE            ********S01117 087178
211700200616     C***********          OUT  LDA                                S01117 087178
211800200616     C***********          SETON                     99U7U8        S01117 087178
211900200616     C***********          EXSR *PSSR                              S01117 087178
212000200616     C***********          GOTO EAUDIT                             S01117 087178
212100200616     C***********          END                                     S01117 087178
212200200616     C***********                                                  S01117 087178
212300200616     C***Set*Output*Currency*Decimal*Places*for*SR.ZCONV***********S01117 087178
212400200616     C***********                                                  S01117 087178
212500200616     C***********          Z-ADDCDP       ZCDPO                    S01117 087178
212600200616     C***********                                                         087178
212700200616     C***********          EXSR ZCONV                                     087178
212800200616     C************INU7     IFEQ '1'                                       S01117
212900200616     C************LOCK     IN   LDA                                       S01117
213000200616     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
213100200616     C***********          MOVELTKEY      DBKEY            ** DB ERROR 07 S01117
213200200616     C***********          Z-ADD5         DBASE            ***************S01117
213300200616     C***********          OUT  LDA                                       S01117
213400200616     C***********          SETON                     99U7U8               S01117
213500200616     C***********          EXSR *PSSR                                     S01117
213600200616     C***********          GOTO EAUDIT                                    S01117
213700200616     C***********          END                                            S01117
213800200616     C***********          Z-ADDZAMTCO    EVAM                            087178
213900200616     C***********          END                                            087178
214000200616     C*                                                                   094232
214100200616     C**If*nominal*ccy*ne*settlement*currency*use*settlement*amount094232 101925
214200200616     C***********PNCY      IFNE PSCU                               094232 101925
214300200616     C* always use settlement amount as this is in correct currency       101925
214400200616     C/COPY WNCPYSRC,SE2300C013
214500200616     C* (always need to check if the amount is pay/receive)               115469
214600200616     C           C1DI      IFEQ 'S'                                       173004
214700200616     C***********PRECI     ANDNE'R'                                                    219490 220547
214800200616     C           C1DI      OREQ 'D'                                       173004
214900200616     C***********PRECI     ANDNE'R'                                                    219490 220547
215000200616     C           PPRE      IFEQ 'R'                                       115469
215100200616     C           PRECI     ANDNE'R'                                                           220547
215200200616     C**********           Z-SUBPSAT      PSAT                                         173004 223108
215300200616     C                     Z-SUBPSAT      EVAM                                                223108
215400200616     C                     ELSE                                                               223108
215500200616     C                     Z-ADDPSAT      EVAM                                                223108
215600200616     C                     END                                            173004
215700200616     C                     ELSE                                           173004
215800200616     C           PPRE      IFEQ 'P'                                       173004
215900200616     C           PRECI     ANDNE'R'                                                           220547
216000200616     C**********           Z-SUBPSAT      PSAT                                         173004 223108
216100200616     C                     Z-SUBPSAT      EVAM                                                223108
216200200616     C                     ELSE                                                               223108
216300200616     C                     Z-ADDPSAT      EVAM                                                223108
216400200616     C                     END                                            173004
216500200616     C                     END                                            173004
216600200616     C***********          Z-ADDPSAT      EVAM                                         094232 223108
216700200616     C/COPY WNCPYSRC,SE2300C043
216800200616     C***********          ELSE                                    115469 173004
216900200616     C***********          Z-SUBPSAT      EVAM                     115469 173004
217000200616     C***********          END                                     115469 173004
217100200616     C***********          END                                     094232 101925
217200200616     C*
217300200616     C* IF NOM CCY NE BASE CCY CONVERT SETTL AMNT IN NOM CCY
217400200616     C* TO BASE CCY USING P/ZCONV
217500200616     C*
217600200616     C           PNCY      IFNE BCCY
217700200616     C           NMCY      ORNE BCCY                                      183665
217800200616     C*                                                                   E21244
217900200616     C* IF SETTLEMENT CURRENCY NOT EQUAL TO BASE CURRENCY,CONVERT NOMINAL E21244
218000200616     C* CURRENCY TO BASE CURRENCY EQUIVALENT                              E21244
218100200616     C*                                                                   E21244
218200200616     C           PSCU      IFNE BCCY                                      E21244
218300200616     C*                                                                   E21244
218400200616     C**CHAIN*TO*TABTG10*TO*GET*SPOT*RATE*OF*NOMINAL*CCY****              067406
218500200616     C* *********                                                         067406
218600200616     C***********          MOVE *BLANK    ZZ006                           067406
218700200616     C***********          MOVE '20'      RECT                            067406
218800200616     C***********          MOVE 1         ZZ001                           067406
218900200616     C***********          MOVE PNCY      RCCY                            067406
219000200616     C* *********                                                         067406
219100200616     C***********TABKEY    CHAINTABTG10F             80                   067406
219200200616     C********** *IN80     IFEQ '0'                                       067406
219300200616     C***********RECI      IFEQ '*'                                       067406
219400200616     C***********          SETON                     80                   067406
219500200616     C***********          END                                            067406
219600200616     C***********          END                                            067406
219700200616     C********** *IN80     IFEQ '1'                                       067406
219800200616     C********** *LOCK     IN   LDA                                S01117 067406
219900200616     C***********          MOVE 'TABLE'   DBFILE *****************        067406
220000200616     C***********          MOVELTKEY      DBKEY  ** DB ERROR 06 **        067406
220100200616     C***********          Z-ADD6         DBASE  *****************        067406
220200200616     C***********          OUT  LDA                                S01117 067406
220300200616     C***********          SETON                     99U7U8               067406
220400200616     C***********          EXSR *PSSR                              S01117 067406
220500200616     C***********          GOTO EAUDIT                                    067406
220600200616     C***********          END                                            067406
220700200616     C*
220800200616     C***********          Z-ADDKNCA      ZAMTCI                          151544
220900200616     C**********           Z-ADDPSAT      ZAMTCI                                       151544 223108
221000200616     C                     Z-ADDEVAM      ZAMTCI                                              223108
221100200616     C/COPY WNCPYSRC,SE2300C044
221200200616     C*                                                                   067406
221300200616     C**  Use Nominal/Base exchange rate from POSETD record               067406
221400200616     C*                                                                   067406
221500200616     C***********          Z-ADDSPOT      ZEXCH                           067406
221600200616     C                     Z-ADDPBRX      ZEXCH                           067406
221700200616     C************         MOVE PNCY      ZCCYI                           151544
221800200616     C                     MOVE PSCU      ZCCYI                           151544
221900200616     C                     MOVE BCCY      ZCCYO
222000200616     C*                                                                   S01117
222100200616     C** Set Input Currency Decimal Places for SR.ZCONV                   S01117
222200200616     C*                                                                   S01117
222300200616     C***********          Z-ADDCDP       ZCDPI                    S01117 067406
222400200616     C                     Z-ADDUNOMDP    ZCDPI                           067406
222500200616     C*                                                                   S01117
222600200616     C** Set Output Currency Decimal Places for SR.ZCONV to Base          S01117
222700200616     C** Currency Decimal places already obtained in SR.FIRST             S01117
222800200616     C*                                                                   S01117
222900200616     C                     Z-ADDBSCDP     ZCDPO                           S01117
223000200616     C*
223100200616     C* IF MDIN = 0 DIVIDE ELSE MULT
223200200616     C*
223300200616     C***********MDIN      IFEQ 0                                         067406
223400200616     C                     MOVE *BLANK    ZZ006                           151544
223500200616     C                     MOVE '20'      RECT                            151544
223600200616     C                     MOVE 1         ZZ001                           151544
223700200616     C                     MOVE PSCU      RCCY                            151544
223800200616     C*                                                                   151544
223900200616     C           TABKEY    CHAINTABTG10F             80                   151544
224000200616     C           *LIKE     DEFN MDIN      U2MDIN                          151544
224100200616     C                     Z-ADDMDIN      U2MDIN                          151544
224200200616     C********** UNMDIN    IFEQ 0                                         151544
224300200616     C           U2MDIN    IFEQ 0                                         151544
224400200616     C                     MOVE 'D'       ZMD
224500200616     C                     ELSE
224600200616     C                     MOVE 'M'       ZMD
224700200616     C                     END
224800200616      *                                                                   194195
224900200616     C           PSCU      IFNE PNCY                                      194195
225000200616     C                     Z-ADDCDP       ZCDPI                           194195
225100200616     C                     ENDIF                                          194195
225200200616      *                                                                   194195
225300200616     C                     EXSR ZCONV
225400200616     C************INU7     IFEQ '1'                                       S01117
225500200616     C***********          MOVE 'TABLE'   DBFILE           ***************S01117
225600200616     C***********          MOVELTKEY      DBKEY            ** DB ERROR 07 S01117
225700200616     C***********          Z-ADD7         DBASE            ***************S01117
225800200616     C***********          SETON                     99U7U8               S01117
225900200616     C***********          GOTO EAUDIT                                    S01117
226000200616     C***********          END                                            S01117
226100200616     C                     Z-ADDZAMTCO    KBCA
226200200616     C*                                                                   E21244
226300200616     C* ELSE BASE CURRENCY EQUIVALENT IS PAY AMOUNT IN SETTLEMENT CCY     E21244
226400200616     C*                                                                   E21244
226500200616     C                     ELSE                                           E21244
226600200616     C                     Z-ADDEVAM      KBCA                            E21244
226700200616     C*                                                                   CAC002
226800200616     C           BGN0ST    IFEQ 'Y'                                       CAC002
226900200616     C           PPRE      IFEQ 'R'                                       CAC002
227000200616     C                     SUB  MAMT      KBCA                            CAC002
227100200616     C                     ELSE                                           CAC002
227200200616     C                     ADD  MAMT      KBCA                            CAC002
227300200616     C                     ENDIF                                          CAC002
227400200616     C                     ENDIF                                          CAC002
227500200616     C*                                                                   CAC002
227600200616     C                     END                                            E21244
227700200616     C*                                                                   E21244
227800200616     C* ELSE BASE CURRENCY EQUIVALENT IS PAY AMOUNT IN NOMINAL CCY        E21244
227900200616     C*                                                                   E21244
228000200616     C                     ELSE                                           E21244
228100200616     C                     Z-ADDKNCA      KBCA                            E21244
228200200616     C                     END
228300200616     C/COPY WNCPYSRC,SE2300C014
228400200616     C*
228500200616     C* SET OTHER FIELDS ON A/C KEY RELEVENT TO THIS PROCESS
228600200616     C*
228700200616     C                     MOVE 'S'       EVTP
228800200616     C                     MOVE 'SA'      AMCD
228900200616     C/COPY WNCPYSRC,SE2300C045
229000200616     C                     MOVELPSCU      EVCY
229100200616     C                     MOVE PSMT      STLT
229200200616     C                     MOVE PSEA      STLA
229300200616     C*                                                                   S01496
229400200616     C**  If reversal, use saved BCCY value from SABC                     S01496
229500200616     C**  If not reversal, save amount in base into SABC                  S01496
229600200616     C*                                                                   S01496
229700200616     C           S01496    IFEQ 'Y'                                       S01496
229800200616     C           CSE007    OREQ 'Y'                                       CSE007
229900200616     C           CEU017    OREQ 'Y'                                       CEU017
230000200616     C*                                                                   S01496
230100200616     C           WWRECI    IFEQ 'R'                                       S01496
230200200616     C                     Z-ADDSABC      KBCA                            S01496
230300200616     C                     ELSE                                           S01496
230400200616     C                     Z-ADDKBCA      SABC                            S01496
230500200616     C                     ENDIF                                          S01496
230600200616     C*                                                                   S01496
230700200616     C                     ENDIF                                          S01496
230800200616      *                                                                                       CGL020
230900200616      ** Set the Fee Fields if CGL020 is enabled.                                             CGL020
231000200616      *                                                                                       CGL020
231100200616     C           CGL020    IFEQ 'Y'                                                           CGL020
231200200616     C                     EXSR SRSFSA                                                        CGL020
231300200616     C                     ENDIF                                                              CGL020
231400200616      *                                                                                       CGL020
231500200616     C* WRITE A/C KEY
231600200616     C                     EXSR WRITED
231700200616     C/COPY WNCPYSRC,SE2300C015
231800200616     C*
231900200616     C                     ENDSR
232000200616     C*****************************************************************
232100200616     C/EJECT                                                              S01447
232200200616     C*****************************************************************   S01447
232300200616     C*                                                               *   S01447
232400200616     C* WTKEYS   -   SUBROUTINE TO GENERATE WITHHOLDING TAX KEYS      *   S01447
232500200616     C*                                                               *   S01447
232600200616     C*****************************************************************   S01447
232700200616     C*                                                                   S01447
232800200616     C           WTKEYS    BEGSR                                          S01447
232900200616     C*                                                                   S01447
233000200616     C*  Set event code to coupon or dividend                             S01447
233100200616     C*                                                                   S01447
233200200616     C           PEVT      IFEQ 'CP'                                      S01447
233300200616     C                     MOVE 'C'       EVTP                            S01447
233400200616     C                     ELSE                                           S01447
233500200616     C*  Set event code to 'X' if Corporate Action flag 'I' (Income Evts) CSE007
233600200616     C*                                                                   CSE007
233700200616     C           CSE007    IFEQ 'Y'                                       CSE007
233800200616     C           WWCOAT    ANDEQ'I'                                       CSE007
233900200616     C           CEU017    OREQ 'Y'                                       CEU017
234000200616     C           WWCOAT    ANDEQ'I'                                       CEU017
234100200616     C                     MOVE 'X'       EVTP                            CSE007
234200200616     C*                                                                   CSE007
234300200616     C*  Include Trade Sub-Type in Corporate Action Key                   CSE007
234400200616     C*                                                                   CSE007
234500200616     C           BVCOTA    IFEQ 'Y'                                       CSE007
234600200616     C                     MOVELMMTSUB    PSBS                            CSE007
234700200616     C                     MOVE MMTSUB    FIL1                            CSE007
234800200616     C                     ELSE                                           CSE007
234900200616     C                     MOVE *BLANKS   PSBS                            CSE007
235000200616     C                     ENDIF                                          CSE007
235100200616     C*                                                                   CSE007
235200200616     C                     ELSE                                           CSE007
235300200616     C                     MOVE 'H'       EVTP                            S01447
235400200616     C                     END                                            CSE007
235500200616     C                     END                                            S01447
235600200616     C*                                                                   S01447
235700200616     C*  Access securities file for country of tax                        S01447
235800200616     C*  Database error if no record or the country of tax is blank       S01447
235900200616     C*                                                                   S01447
236000200616     C           SECKEY    CHAINSESWHTL0             99                   S01447
236100200616     C           *IN99     IFEQ '1'                                       S01447
236200200616     C           S1CTTA    OREQ *BLANK                                    S01447
236300200616     C           *LOCK     IN   LDA                                       S01447
236400200616     C                     MOVEL'SESWHTL0'DBFILE           *****************1447
236500200616     C                     MOVELPSSH      DBKEY            ** DB ERROR 18 **1447
236600200616     C                     Z-ADD18        DBASE            *****************1447
236700200616     C                     OUT  LDA                                       S01447
236800200616     C                     SETON                     U7U8                 S01447
236900200616     C                     EXSR *PSSR                                     S01447
237000200616     C                     GOTO EAUDIT                                    S01447
237100200616     C                     END                                            S01447
237200200616     C                     MOVE S1CTTA    COTA                            S01447
237300200616     C*                                                                   S01447
237400200616     C*  Generate key for Tax Deducted at Source Refundable               S01447
237500200616     C*                                                                   S01447
237600200616     C           TASR      IFNE *ZERO                                     S01447
237700200616     C*                                                                   S01447
237800200616     C*  Set up amount code                                               S01447
237900200616     C*                                                                   S01447
238000200616     C                     MOVE 'WR'      AMCD                            S01447
238100200616     C*                                                                   S01447
238200200616     C*  Set up amount as lesser of Tax Refundable and Tax Deducted       S01447
238300200616     C*                                                                   S01447
238400200616     C           TASR      IFLE TASO                                      S01447
238500200616     C                     Z-ADDTASR      EVAM                            S01447
238600200616     C                     ELSE                                           S01447
238700200616     C                     Z-ADDTASO      EVAM                            S01447
238800200616     C                     END                                            S01447
238900200616     C*                                                                   S01447
239000200616     C*  Event amount must be positive                                    S01447
239100200616     C*                                                                   S01447
239200200616     C           EVAM      IFLT 0                                         S01447
239300200616     C                     Z-SUBEVAM      EVAM                            S01447
239400200616     C                     END                                            S01447
239500200616     C*                                                                   S01447
239600200616     C*  Write account key                                                S01447
239700200616     C*                                                                   S01447
239800200616     C                     EXSR WRITED                                    S01447
239900200616     C/COPY WNCPYSRC,SE2300C039
240000200616     C*                                                                   S01447
240100200616     C                     END                                            S01447
240200200616     C*                                                                   S01447
240300200616     C*  Generate key for Tax Refundable not deducted at source           S01447
240400200616     C*  Key generated if the Tax Refundable is greater than the          S01447
240500200616     C*  Tax Deducted                                                     S01447
240600200616     C*                                                                   S01447
240700200616     C           TASR      IFGT TASO                                      S01447
240800200616     C*                                                                   S01447
240900200616     C*  Set up amount code                                               S01447
241000200616     C*                                                                   S01447
241100200616     C                     MOVE 'WX'      AMCD                            S01447
241200200616     C*                                                                   S01447
241300200616     C*  Event amount is Tax Refundable less Tax Deducted                 S01447
241400200616     C*                                                                   S01447
241500200616     C           TASR      SUB  TASO      EVAM                            S01447
241600200616     C*                                                                   S01447
241700200616     C*  Write account key                                                S01447
241800200616     C*                                                                   S01447
241900200616     C                     EXSR WRITED                                    S01447
242000200616     C/COPY WNCPYSRC,SE2300C040
242100200616     C*                                                                   S01447
242200200616     C                     END                                            S01447
242300200616     C*                                                                   S01447
242400200616     C*  Generate key for Tax not Refundable                              S01447
242500200616     C*  Key generated if the Tax Deducted at Source is greater than      S01447
242600200616     C*  the Tax Refundable                                               S01447
242700200616     C*                                                                   S01447
242800200616     C           TASO      IFGT TASR                                      S01447
242900200616     C*                                                                   S01447
243000200616     C*  Set up amount code                                               S01447
243100200616     C*                                                                   S01447
243200200616     C                     MOVE 'WN'      AMCD                            S01447
243300200616     C*                                                                   S01447
243400200616     C*  Event amount is Tax Deducted at Source less Tax Deducted         S01447
243500200616     C*  at Source Refundable                                             S01447
243600200616     C*                                                                   S01447
243700200616     C           TASO      SUB  TASR      EVAM                            S01447
243800200616     C*                                                                   S01447
243900200616     C*  Write account key                                                S01447
244000200616     C*                                                                   S01447
244100200616     C                     EXSR WRITED                                    S01447
244200200616     C/COPY WNCPYSRC,SE2300C041
244300200616     C*                                                                   S01447
244400200616     C                     END                                            S01447
244500200616     C*                                                                   S01447
244600200616     C*  Generate key for Tax Deducted by User                            S01447
244700200616     C*  Key generated if the Tax Deducted by User is greater than        S01447
244800200616     C*  zero                                                             S01447
244900200616     C*                                                                   S01447
245000200616     C           TAUS      IFNE *ZERO                                     S01447
245100200616     C/COPY WNCPYSRC,SE2300C035
245200200616     C*                                                                   S01447
245300200616     C*  Set up amount code                                               S01447
245400200616     C*                                                                   S01447
245500200616     C                     MOVE 'WD'      AMCD                            S01447
245600200616     C*                                                                   S01447
245700200616     C*  Event amount is Tax Deducted by User and should be positive      S01447
245800200616     C*                                                                   S01447
245900200616     C           TAUS      IFLT 0                                         S01447
246000200616     C                     Z-SUBTAUS      KNCA                            S01447
246100200616     C                     ELSE                                           S01447
246200200616     C                     Z-ADDTAUS      KNCA                            S01447
246300200616     C                     END                                            S01447
246400200616     C*                                                                   S01447
246500200616     C**  Set up Event Amount, Event Currency and Base Currency Amt:      S01447
246600200616     C**  Event amount is in Base currency and Event currency is Base CCY.S01447
246700200616     C**  Use exchange rate from Position Settlement record but because   S01447
246800200616     C**  there is no M/D indicator there, use the one from TABTG10,      S01447
246900200616     C**  (which cannot change once the system is set up).                S01447
247000200616     C*                                                                   S01447
247100200616     C                     MOVE BCCY      EVCY                            S01447
247200200616     C*                                                                   S01447
247300200616     C           PNCY      IFNE BCCY                                      S01447
247400200616     C           NMCY      ORNE BCCY                                      183665
247500200616     C*                                                                   S01447
247600200616     C           UNMDIN    IFEQ 0                                         S01447
247700200616     C                     MOVE 'D'       ZMD                             S01447
247800200616     C                     ELSE                                           S01447
247900200616     C                     MOVE 'M'       ZMD                             S01447
248000200616     C                     END                                            S01447
248100200616     C*                                                                   S01447
248200200616     C                     Z-ADDTAUS      ZAMTCI                          S01447
248300200616     C                     Z-ADDPBRX      ZEXCH                           S01447
248400200616     C                     MOVE PNCY      ZCCYI                           S01447
248500200616     C                     MOVE BCCY      ZCCYO                           S01447
248600200616     C                     Z-ADDUNOMDP    ZCDPI                           S01447
248700200616     C                     Z-ADDBSCDP     ZCDPO                           S01447
248800200616     C                     EXSR ZCONV                                     S01447
248900200616     C*                                                                   S01447
249000200616     C                     Z-ADDZAMTCO    EVAM                            S01447
249100200616     C                     Z-ADDZAMTCO    KBCA                            S01447
249200200616     C*                                                                   S01447
249300200616     C** Else Base Currency Amount & Event Amount = Position Settlement   S01447
249400200616     C** amount.                                                          S01447
249500200616     C*                                                                   S01447
249600200616     C                     ELSE                                           S01447
249700200616     C*                                                                   S01447
249800200616     C                     Z-ADDKNCA      EVAM                            S01447
249900200616     C                     Z-ADDKNCA      KBCA                            S01447
250000200616     C                     END                                            S01447
250100200616     C*                                                                   S01496
250200200616     C**  If reversal use saved base currency value from BAUS             S01496
250300200616     C**  If not reversal, save tax equivalent into BAUS                  S01496
250400200616     C*                                                                   S01496
250500200616     C           S01496    IFEQ 'Y'                                       S01496
250600200616     C           CSE007    OREQ 'Y'                                       CSE007
250700200616     C           CEU017    OREQ 'Y'                                       CEU017
250800200616     C*                                                                   S01496
250900200616     C           WWRECI    IFEQ 'R'                                       S01496
251000200616     C                     Z-ADDBAUS      EVAM                            S01496
251100200616     C                     Z-ADDBAUS      KBCA                            S01496
251200200616     C                     ELSE                                           S01496
251300200616     C                     Z-ADDKBCA      BAUS                            S01496
251400200616     C                     ENDIF                                          S01496
251500200616     C*                                                                   S01496
251600200616     C                     ENDIF                                          S01496
251700200616     C*                                                                   S01447
251800200616     C*  Write account key                                                S01447
251900200616     C*                                                                   S01447
252000200616     C                     EXSR WRITED                                    S01447
252100200616     C/COPY WNCPYSRC,SE2300C036
252200200616     C*                                                                   S01447
252300200616     C                     END                                            S01447
252400200616     C*                                                                   S01447
252500200616     C                     ENDSR                                          S01447
252600200616     C*****************************************************************   S01447
252700200616     C/EJECT                                                              CSE023
252800200616     C*****************************************************************   CSE023
252900200616     C*                                                               *   CSE023
253000200616     C* WTTKYS   -   SUBROUTINE TO GENERATE TREATY WITHHOLDING TAX KEY*   CSE023
253100200616     C*                                                               *   CSE023
253200200616     C*****************************************************************   CSE023
253300200616     C*                                                                   CSE023
253400200616     C           WTTKYS    BEGSR                                          CSE023
253500200616      *                                                                   188794
253600200616      ** Set Country of Treaty Code                                       188794
253700200616      *                                                                   188794
253800200616     C                     MOVE CRTT      COTA                            188794
253900200616     C*                                                                   CSE023
254000200616     C*  Set event code to coupon or dividend                             CSE023
254100200616     C*                                                                   CSE023
254200200616     C           PEVT      IFEQ 'CP'                                      CSE023
254300200616     C                     MOVE 'C'       EVTP                            CSE023
254400200616     C                     ELSE                                           CSE023
254500200616     C*  Set event code to 'X' if Corporate Action flag 'I' (Income Evts) CSE023
254600200616     C*                                                                   CSE023
254700200616     C           CSE007    IFEQ 'Y'                                       CSE023
254800200616     C           WWCOAT    ANDEQ'I'                                       CSE023
254900200616     C           CEU017    OREQ 'Y'                                       CSE023
255000200616     C           WWCOAT    ANDEQ'I'                                       CSE023
255100200616     C                     MOVE 'X'       EVTP                            CSE023
255200200616     C*                                                                   CSE023
255300200616     C*  Include Trade Sub-Type in Corporate Action Key                   CSE023
255400200616     C*                                                                   CSE023
255500200616     C           BVCOTA    IFEQ 'Y'                                       CSE023
255600200616     C                     MOVELMMTSUB    PSBS                            CSE023
255700200616     C                     MOVE MMTSUB    FIL1                            CSE023
255800200616     C                     ELSE                                           CSE023
255900200616     C                     MOVE *BLANKS   PSBS                            CSE023
256000200616     C                     ENDIF                                          CSE023
256100200616     C*                                                                   CSE023
256200200616     C                     ELSE                                           CSE023
256300200616     C           PEVT      IFEQ 'MA'                                      CSE023
256400200616     C                     MOVE 'M'       EVTP                            CSE023
256500200616     C                     ELSE                                           CSE023
256600200616     C                     MOVE 'H'       EVTP                            CSE023
256700200616     C                     END                                            CSE023
256800200616     C                     END                                            CSE023
256900200616     C                     END                                            CSE023
257000200616     C*                                                                   CSE023
257100200616     C*  Generate key for Tax Deducted at Source                          CSE023
257200200616     C*                                                                   CSE023
257300200616     C           TASO      IFNE *ZERO                                     CSE023
257400200616     C*                                                                   CSE023
257500200616     C*  Set up amount code                                               CSE023
257600200616     C*                                                                   CSE023
257700200616     C                     MOVE 'WN'      AMCD                            CSE023
257800200616     C                     Z-ADDTASO      EVAM                            CSE023
257900200616     C*                                                                   CSE023
258000200616     C*  Event amount must be positive                                    CSE023
258100200616     C*                                                                   CSE023
258200200616     C           EVAM      IFLT 0                                         CSE023
258300200616     C                     Z-SUBEVAM      EVAM                            CSE023
258400200616     C                     END                                            CSE023
258500200616     C*                                                                   CSE023
258600200616     C*  Write account key                                                CSE023
258700200616     C*                                                                   CSE023
258800200616     C                     EXSR WRITED                                    CSE023
258900200616     C/COPY WNCPYSRC,SE2300C042
259000200616     C*                                                                   CSE023
259100200616     C                     END                                            CSE023
259200200616     C*                                                                   CSE023
259300200616     C*  Generate key for Tax Deducted by User                            CSE023
259400200616     C*  Key generated if the Tax Deducted by User is not zero            CSE023
259500200616     C*                                                                   CSE023
259600200616     C           TAUS      IFNE *ZERO                                     CSE023
259700200616     C*                                                                   CSE023
259800200616     C*  Set up amount code                                               CSE023
259900200616     C*                                                                   CSE023
260000200616     C                     MOVE 'WD'      AMCD                            CSE023
260100200616     C*                                                                   CSE023
260200200616     C*  Event amount is Tax Deducted by User and should be positive      CSE023
260300200616     C*                                                                   CSE023
260400200616     C           TAUS      IFLT 0                                         CSE023
260500200616     C                     Z-SUBTAUS      KNCA                            CSE023
260600200616     C                     ELSE                                           CSE023
260700200616     C                     Z-ADDTAUS      KNCA                            CSE023
260800200616     C                     END                                            CSE023
260900200616     C*                                                                   CSE023
261000200616     C**  Set up Event Amount, Event Currency and Base Currency Amt:      CSE023
261100200616     C**  Event amount is in Base currency and Event currency is Base CCY.CSE023
261200200616     C**  Use exchange rate from Position Settlement record but because   CSE023
261300200616     C**  there is no M/D indicator there, use the one from TABTG10,      CSE023
261400200616     C**  (which cannot change once the system is set up).                CSE023
261500200616     C*                                                                   CSE023
261600200616     C                     MOVE BCCY      EVCY                            CSE023
261700200616     C*                                                                   CSE023
261800200616     C           PNCY      IFNE BCCY                                      CSE023
261900200616     C*                                                                   CSE023
262000200616     C           UNMDIN    IFEQ 0                                         CSE023
262100200616     C                     MOVE 'D'       ZMD                             CSE023
262200200616     C                     ELSE                                           CSE023
262300200616     C                     MOVE 'M'       ZMD                             CSE023
262400200616     C                     END                                            CSE023
262500200616     C*                                                                   CSE023
262600200616     C                     Z-ADDTAUS      ZAMTCI                          CSE023
262700200616     C                     Z-ADDPBRX      ZEXCH                           CSE023
262800200616     C                     MOVE PNCY      ZCCYI                           CSE023
262900200616     C                     MOVE BCCY      ZCCYO                           CSE023
263000200616     C                     Z-ADDUNOMDP    ZCDPI                           CSE023
263100200616     C                     Z-ADDBSCDP     ZCDPO                           CSE023
263200200616     C                     EXSR ZCONV                                     CSE023
263300200616     C*                                                                   CSE023
263400200616     C                     Z-ADDZAMTCO    EVAM                            CSE023
263500200616     C                     Z-ADDZAMTCO    KBCA                            CSE023
263600200616     C*                                                                   CSE023
263700200616     C** Else Base Currency Amount & Event Amount = Position Settlement   CSE023
263800200616     C** amount.                                                          CSE023
263900200616     C*                                                                   CSE023
264000200616     C                     ELSE                                           CSE023
264100200616     C*                                                                   CSE023
264200200616     C                     Z-ADDKNCA      EVAM                            CSE023
264300200616     C                     Z-ADDKNCA      KBCA                            CSE023
264400200616     C                     END                                            CSE023
264500200616     C*                                                                   CSE023
264600200616     C**  If reversal use saved base currency value from BAUS             CSE023
264700200616     C**  If not reversal, save tax equivalent into BAUS                  CSE023
264800200616     C*                                                                   CSE023
264900200616     C           S01496    IFEQ 'Y'                                       CSE023
265000200616     C           CSE007    OREQ 'Y'                                       CSE023
265100200616     C           CEU017    OREQ 'Y'                                       CSE023
265200200616     C*                                                                   CSE023
265300200616     C           WWRECI    IFEQ 'R'                                       CSE023
265400200616     C                     Z-ADDBAUS      EVAM                            CSE023
265500200616     C                     Z-ADDBAUS      KBCA                            CSE023
265600200616     C                     ELSE                                           CSE023
265700200616     C                     Z-ADDKBCA      BAUS                            CSE023
265800200616     C                     ENDIF                                          CSE023
265900200616     C*                                                                   CSE023
266000200616     C                     ENDIF                                          CSE023
266100200616     C*                                                                   CSE023
266200200616     C                     MOVE '  '      COTA                            CSE023
266300200616     C*                                                                   CSE023
266400200616     C*  Write account key                                                CSE023
266500200616     C*                                                                   CSE023
266600200616     C                     EXSR WRITED                                    CSE023
266700200616     C*                                                                   CSE023
266800200616     C                     END                                            CSE023
266900200616      *                                                                   188794
267000200616     C                     MOVE '  '      COTA                            188794
267100200616     C*                                                                   CSE023
267200200616     C                     ENDSR                                          CSE023
267300200616     C*****************************************************************   CSE023
267400200616      /EJECT                                                                                  233710
267500200616      *****************************************************************                       233710
267600200616      *                                                               *                       233710
267700200616      * SRETAX - Subroutine to post the EU Tax Amount                 *                       233710
267800200616      *                                                               *                       233710
267900200616      *****************************************************************                       233710
268000200616     C           SRETAX    BEGSR                                                              233710
268100200616      *                                                                                       233710
268200200616      ** Take a security copy of the currency codes                                           235141
268300200616      *                                                                                       235141
268400200616     C                     MOVELEVCY      WEVCY   3                                           235141
268500200616     C                     MOVELKCCY      WKCCY   3                                           235141
268600200616      *                                                                                       233710
268700200616      ***Tax*Account*Key*Generation************************************                233710 235174
268800200616      ***Initialisetfieldseneration************************************                233710 235174
268900200616      *                                                                                       233710
269000200616     C**********           MOVEL'E'       EVTP                                         233710 235174
269100200616     C**********           MOVEL@@COLC    COTA                                         233710 235174
269200200616     C**********           MOVEL'ET'      AMCD                                         233710 235174
269300200616      *                                                                                       234635
269400200616      ***Tax*amount*in*tax*ccy*from*POSETD*****************************                234635 235174
269500200616      *                                                                                       234635
269600200616     C**********           Z-ADDTSTXSC    EVAM                                         233710 234635
269700200616     C**********           Z-ADDTAXA      EVAM                                         234635 235174
269800200616      *                                                                                       233710
269900200616     C**********           MOVELTSTXCY    EVCY                                         233710 235174
270000200616     C**********           MOVELTSOCCY    KCCY                                         233710 235174
270100200616      *                                                                                       233710
270200200616     C********** TSTXCY    IFNE TSOCCY                                                 233710 235174
270300200616     C**********           Z-ADDTXST      KNCA                                         233710 235174
270400200616     C**********           Z-ADDWWTXSB    KBCA                                         233710 235174
270500200616     C**********           ELSE                                                        233710 235174
270600200616     C**********           Z-ADD0         KNCA                                         233710 235174
270700200616     C**********           Z-ADD0         KBCA                                         233710 235174
270800200616     C**********           ENDIF                                                       233710 235174
270900200616      *                                                                                       233710
271000200616      ***Build*output*record*******************************************                233710 235174
271100200616      *                                                                                       233710
271200200616     C**********           MOVE SITP      INVT                                         233710 235174
271300200616     C**********           MOVE ' '       TRTP                                         233710 235174
271400200616      *                                                                                       233710
271500200616     C**********           MOVE '  '      BOOK                                         233710 235174
271600200616     C**********           MOVE ' '       PSBS                                         233710 235174
271700200616     C**********           MOVE ' '       FIL1                                         233710 235174
271800200616     C**********           MOVE '  '      CGTP                                         233710 235174
271900200616     C**********           MOVE 'D'       RECI                                         233710 235174
272000200616      *                                                                                       233710
272100200616     C********** PPRE      IFEQ 'R'                                                    233710 235174
272200200616     C********** PSMT      ANDEQ04                                                     233710 235174
272300200616     C********** PPRE      OREQ 'P'                                                    233710 235174
272400200616     C********** PSMT      ANDEQ04                                                     233710 235174
272500200616     C**********           ELSE                                                        233710 235174
272600200616     C**********           MOVE *BLANK    STLA                                         233710 235174
272700200616     C**********           ENDIF                                                       233710 235174
272800200616     C**********           Z-ADDSAED      EVDT                                                233710
272900200616      *                                                                                       233710
273000200616     C********** PPRE      IFEQ 'R'                                                    233710 235174
273100200616     C********** PSMT      ANDEQ04                                                     233710 235174
273200200616     C********** PPRE      OREQ 'P'                                                    233710 235174
273300200616     C********** PSMT      ANDEQ04                                                     233710 235174
273400200616     C**********           ELSE                                                        233710 235174
273500200616     C**********           Z-ADD0         STLT                                         233710 235174
273600200616     C**********           ENDIF                                                       233710 235174
273700200616      *                                                                                       233710
273800200616      ***Write*Generated*Account*Key*Record****************************                233710 235174
273900200616      *                                                                                       233710
274000200616     C**********           EXSR WRITED                                                 233710 235174
274100200616      *                                                                                       233710
274200200616      ** Net Interest Amount Account Key Generation                                           233710
274300200616      ** Initialise fields                                                                    233710
274400200616      *                                                                                       233710
274500200616     C                     EXSR CLEAR                                                         233710
274600200616      *                                                                                       233710
274700200616     C                     MOVEL'E'       EVTP                                                233710
274800200616     C                     MOVEL*BLANK    COTA                                                233710
274900200616     C                     MOVEL'NI'      AMCD                                                233710
275000200616      *                                                                                       233710
275100200616      ** Net Interest Amount in Nominal Ccy = Amount due - EU Tax                             234635
275200200616      *                                                                                       234635
275300200616     C**********           Z-ADDTSNINT    EVAM                                                234635
275400200616     C           PAMD      SUB  TXNM      EVAM                                                234635
275500200616      *                                                                                       233710
275600200616     C                     MOVELTSOCCY    EVCY                                                233710
275700200616     C                     MOVELTSOCCY    KCCY                                                233710
275800200616     C                     Z-ADDTSNINT    KNCA                                                233710
275900200616     C                     MOVELTSNINB    KBCA                                                233710
276000200616      *                                                                                       233710
276100200616      ** Build output record                                                                  233710
276200200616      *                                                                                       233710
276300200616     C                     MOVE SITP      INVT                                                233710
276400200616     C                     MOVE ' '       TRTP                                                233710
276500200616      *                                                                                       233710
276600200616     C                     MOVE '  '      BOOK                                                233710
276700200616     C                     MOVE ' '       PSBS                                                233710
276800200616     C                     MOVE ' '       FIL1                                                233710
276900200616     C                     MOVE '  '      CGTP                                                233710
277000200616     C                     MOVE 'D'       RECI                                                233710
277100200616      *                                                                                       233710
277200200616     C           PPRE      IFEQ 'R'                                                           233710
277300200616     C           PSMT      ANDEQ04                                                            233710
277400200616     C           PPRE      OREQ 'P'                                                           233710
277500200616     C           PSMT      ANDEQ04                                                            233710
277600200616     C                     ELSE                                                               233710
277700200616     C                     MOVE *BLANK    STLA                                                233710
277800200616     C                     ENDIF                                                              233710
277900200616     C****                 Z-ADDSAED      EVDT                                                233710
278000200616      *                                                                                       233710
278100200616     C           PPRE      IFEQ 'R'                                                           233710
278200200616     C           PSMT      ANDEQ04                                                            233710
278300200616     C           PPRE      OREQ 'P'                                                           233710
278400200616     C           PSMT      ANDEQ04                                                            233710
278500200616     C                     ELSE                                                               233710
278600200616     C                     Z-ADD0         STLT                                                233710
278700200616     C                     ENDIF                                                              233710
278800200616      *                                                                                       233710
278900200616      ** Write Generated Account Key Record                                                   233710
279000200616      *                                                                                       233710
279100200616     C                     EXSR WRITED                                                        233710
279200200616      *                                                                                       233710
279300200616      ** Restore the security copy of the currency codes                                      235141
279400200616      *                                                                                       235141
279500200616     C                     MOVELWEVCY     EVCY                                                235141
279600200616     C                     MOVELWKCCY     KCCY                                                235141
279700200616      *                                                                                       235141
279800200616     C                     ENDSR                                                              233710
279900200616      *****************************************************************                       233710
280000200616      /EJECT                                                                                  233710
280100200616      *****************************************************************                       233710
280200200616      *                                                               *                       233710
280300200616      * SRTAXA - Subroutine to calculate taxable amount               *                       233710
280400200616      *                                                               *                       233710
280500200616      *****************************************************************                       233710
280600200616     C           SRTAXA    BEGSR                                                              233710
280700200616      *                                                                                       233710
280800200616     C                     Z-ADD*ZERO     WWTXSB 150                                          233710
280900200616     C                     MOVE *BLANKS   WTXJA   1                                           233710
281000200616     C                     MOVE PCPY      @@CUST                                              233710
281100200616      *                                                                                       233710
281200200616     C                     CALL 'ZATXCLPI'                                                    233710
281300200616      ** Input                                                                                233710
281400200616     C                     PARM 'S'       @@MODI  1                                           233710
281500200616     C                     PARM           @@TRRF 18                                           233710
281600200616     C                     PARM PBCA      @@BRCA  3                                           233710
281700200616     C                     PARM           @@CUST  6                                           233710
281800200616     C                     PARM *ZERO     @@STRD  50                                          233710
281900200616     C                     PARM *ZERO     @@ENDD  50                                          233710
282000200616     C                     PARM PAMD      @@TOTI 150                                          233710
282100200616     C                     PARM           @@TAXR  64                                          233710
282200200616     C                     PARM PNCY      @@OCCY  3                                           233710
282300200616     C                     PARM *BLANKS   PINTH   1                                           CER048
282400200616      ** Output                                                                               233710
282500200616     C                     PARM           @@IAED 150                                          233710
282600200616     C                     PARM           @@TAXA 150                                          233710
282700200616     C                     PARM           @@TOTO 150                                          233710
282800200616     C                     PARM           @@TXCY  3                                           233710
282900200616     C                     PARM           @@CTAX  2                                           233710
283000200616     C                     PARM           @@TXBS  2                                           233710
283100200616     C                     PARM           @@WTAC  40                                          233710
283200200616     C                     PARM           @@COLC  2                                           233710
283300200616     C                     PARM           @@STAT  5                                           233710
283400200616     C                     PARM           @@TRTE  1                                           233710
283500200616     C                     PARM           @@TXR1  64                                          233710
283600200616     C**********           PARM *ZEROS    PSTXB   20                                 CER048 BUG22911
283700200616     C**********           PARM *ZEROS    PSTAC  100                                 CER048 BUG22911
283800200616     C**********           PARM *ZEROS    PSTTR   64                                 CER048 BUG22911
283900200616     C**********           PARM *BLANKS   PSTTP   1                                  CER048 BUG22911
284000200616     C**********           PARM *ZEROS    PSTXA  150                                 CER048 BUG22911
284100200616     C                     PARM           @@KEY  10                                           233710
284200200616     C                     PARM           @@FILE 10                                           233710
284300200616     C                     PARM           @@RTRN  7                                           233710
284400200616     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
284500200616      *                                                                                       233710
284600200616     C                     SELEC                                                              233710
284700200616      *                                                                                       233710
284800200616      ** If return code = Error.                                                              233710
284900200616      *                                                                                       233710
285000200616     C           @@RTRN    WHEQ 'ERROR'                                                       233710
285100200616     C                     MOVE @@FILE    DBFILE                                              233710
285200200616     C                     MOVE @@KEY     DBKEY                                               233710
285300200616     C                     Z-ADD60        DBASE                                               233710
285400200616     C                     MOVE *ON       *INU7                                               233710
285500200616     C                     MOVE *ON       *INU8                                               233710
285600200616     C                     EXSR *PSSR                                                         233710
285700200616     C                     GOTO EAUDIT                                                        233710
285800200616      *                                                                                       233710
285900200616      ** If return code = Private Individual                                                  233710
286000200616      *                                                                                       233710
286100200616     C           @@RTRN    WHNE 'JOINT'                                                       233710
286200200616      *                                                                                       233710
286300200616     C           @@STAT    IFEQ 'TAXAB'                                                       233710
286400200616     C           @@STAT    OREQ 'DISCL'                                                       233710
286500200616     C           @@STAT    OREQ 'SELF'                                                        233710
286600200616      *                                                                                       233710
286700200616     C                     EXSR SRTAXB                                                        233710
286800200616      *                                                                                       233710
286900200616     C                     Z-ADDTXNM      @@TAXA                                              233710
287000200616     C           TXNM      MULT 100       WTAMT  150                                          233710
287100200616     C           @@TAXR    IFNE 0                                                             233710
287200200616     C           WTAMT     DIV  @@TAXR    @@TOTO                                              233710
287300200616     C                     ELSE                                                               233710
287400200616     C                     Z-ADD0         @@TOTO                                              233710
287500200616     C                     ENDIF                                                              233710
287600200616      *                                                                                       233710
287700200616      ** Write record to SDCSINPD                                                             233710
287800200616      *                                                                                       233710
287900200616     C                     EXSR SRCSIN                                                        233710
288000200616      *                                                                                       235174
288100200616      ** Generate EU a/c keys for tax amount.                                                 235174
288200200616      *                                                                                       235174
288300200616     C                     EXSR SREAET                                                        235174
288400200616      *                                                                                       233710
288500200616     C                     ENDIF                                                              233710
288600200616      *                                                                                       233710
288700200616      ** If return code = Joint Account                                                       233710
288800200616      *                                                                                       233710
288900200616     C           @@RTRN    WHEQ 'JOINT'                                                       233710
289000200616     C                     MOVE PCPY      KJANO   6                                           233710
289100200616      *                                                                                       235709
289200200616      ***Determine*the*total*EU*tax*if*all*Joint*A/c*members*were*taxable.             235709 235226
289300200616      ** Determine the total customer income.                                                 235226
289400200616      *                                                                                       235709
289500200616     C                     EXSR SRETJA                                                        235709
289600200616      *                                                                                       233710
289700200616     C           KJANO     SETLLSDJACCLB                                                      233710
289800200616     C           KJANO     READESDJACCLB                 60                                   233710
289900200616      *                                                                                       233710
290000200616     C           *IN60     DOWEQ*OFF                                                          233710
290100200616      *                                                                                       233710
290200200616     C                     CALL 'ZATXCLJA'                                                    233710
290300200616      ** Input                                                                                233710
290400200616     C                     PARM 'S'       @@MODI                                              233710
290500200616     C                     PARM           @@TRRF                                              233710
290600200616     C                     PARM PBCA      @@BRCA                                              233710
290700200616     C                     PARM JCJANO    @@JANO  6                                           233710
290800200616     C                     PARM JCCUST    @@CUST                                              233710
290900200616     C                     PARM JCNAHO    @@NARF 10                                           233710
291000200616     C                     PARM JCINVP    @@INVP 10                                           233710
291100200616     C                     PARM JCPAHT    @@PAHT  1                                         BUG26839
291200200616     C                     PARM *ZERO     @@STRD                                              233710
291300200616     C                     PARM *ZERO     @@ENDD                                              233710
291400200616     C                     PARM PAMD      @@TOTI                                              233710
291500200616     C                     PARM           @@TAXR                                              233710
291600200616     C                     PARM PNCY      @@OCCY                                              233710
291700200616     C                     PARM *BLANKS   PINTH                                               CER048
291800200616      ** Output                                                                               233710
291900200616     C                     PARM           @@IAED                                              233710
292000200616     C                     PARM           @@TAXA                                              233710
292100200616     C                     PARM           @@TOTO                                              233710
292200200616     C                     PARM           @@TXCY                                              233710
292300200616     C                     PARM           @@CTAX                                              233710
292400200616     C                     PARM           @@TXBS                                              233710
292500200616     C                     PARM           @@WTAC                                              233710
292600200616     C                     PARM           @@COLC                                              233710
292700200616     C                     PARM           @@STAT                                              233710
292800200616     C                     PARM           @@TRTE                                              233710
292900200616     C                     PARM           @@TXR1                                              233710
293000200616     C                     PARM           @@JAMG  1                                           233710
293100200616     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
293200200616     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
293300200616     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
293400200616     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
293500200616     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
293600200616     C                     PARM           @@KEY                                               233710
293700200616     C                     PARM           @@FILE                                              233710
293800200616     C                     PARM           @@RTRN                                              233710
293900200616     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
294000200616      *                                                                                       233710
294100200616      ** If return code = Error.                                                              233710
294200200616      *                                                                                       233710
294300200616     C           @@RTRN    IFEQ 'ERROR'                                                       233710
294400200616     C                     MOVE @@FILE    DBFILE                                              233710
294500200616     C                     MOVE @@KEY     DBKEY                                               233710
294600200616     C                     Z-ADD61        DBASE                                               233710
294700200616     C                     MOVE *ON       *INU7                                               233710
294800200616     C                     MOVE *ON       *INU8                                               233710
294900200616     C                     EXSR *PSSR                                                         233710
295000200616     C                     GOTO EAUDIT                                                        233710
295100200616     C                     ENDIF                                                              233710
295200200616      *                                                                                       233710
295300200616     C           @@STAT    IFEQ 'TAXAB'                                                       233710
295400200616     C           @@STAT    OREQ 'DISCL'                                                       233710
295500200616     C           @@STAT    OREQ 'SELF '                                                       233710
295600200616      *                                                                                       233710
295700200616     C                     EXSR SRTAXB                                                        233710
295800200616      *                                                                                       233710
295900200616     C                     MOVE 'Y'       WTXJA                                               233710
296000200616      *                                                                                       233710
296100200616      ** CALCULATE THE AMOUNT FOR EACH MEMBER                                                 233710
296200200616      *                                                                                       233710
296300200616     C                     CALL 'ZAMRATIO'                                                    233710
296400200616     C                     PARM           @@INVP                                              233710
296500200616     C                     PARM           TXNM                                                233710
296600200616     C                     PARM           @@TAXA                                              233710
296700200616      *                                                                                       233710
296800200616     C           @@TAXA    MULT 100       WTAMT                                               233710
296900200616     C           @@TAXR    IFNE 0                                                             233710
297000200616     C           WTAMT     DIV  @@TAXR    @@TOTO                                              233710
297100200616     C                     ELSE                                                               233710
297200200616     C                     Z-ADD0         @@TOTO                                              233710
297300200616     C                     ENDIF                                                              233710
297400200616      *                                                                                       233710
297500200616      ** Write record to SDCSINPD                                                             233710
297600200616      *                                                                                       233710
297700200616     C                     EXSR SRCSIN                                                        233710
297800200616      *                                                                                       235174
297900200616      ** Generate EU a/c keys for tax amount.                                                 235174
298000200616      *                                                                                       235174
298100200616     C                     EXSR SREAET                                                        235174
298200200616      *                                                                                       233710
298300200616     C                     ENDIF                                                              233710
298400200616      *                                                                                       233710
298500200616     C           @@RTRN    IFEQ 'NOTAX'                                                       233710
298600200616     C           @@RTRN    OREQ 'TAXAB'                                                       233710
298700200616     C           KJANO     READESDJACCLB                 60                                   233710
298800200616     C                     ENDIF                                                              233710
298900200616      *                                                                                       233710
299000200616      ** If @@RTRN = Last, end loop                                                           233710
299100200616      *                                                                                       233710
299200200616     C           @@RTRN    IFEQ 'LAST'                                                        233710
299300200616     C                     MOVE *ON       *IN60                                               233710
299400200616     C                     ENDIF                                                              233710
299500200616      *                                                                                       233710
299600200616     C                     ENDDO                                                              233710
299700200616      *                                                                                       233710
299800200616     C                     ENDSL                                                              233710
299900200616      *                                                                                       233710
300000200616     C                     ENDSR                                                              233710
300100200616      *****************************************************************                       233710
300200200616      /EJECT                                                                                  233710
300300200616      *****************************************************************                       233710
300400200616      *                                                               *                       233710
300500200616      * SRCURR - Subroutine to Access Currrency Details               *                       233710
300600200616      *                                                               *                       233710
300700200616      *****************************************************************                       233710
300800200616     C           SRCURR    BEGSR                                                              233710
300900200616      *                                                                                       233710
301000200616     C                     CALL 'AOCURRR0'                                                    233710
301100200616     C                     PARM *BLANKS   PRTCD                                               233710
301200200616     C                     PARM '*KEY   ' POPTN                                               233710
301300200616     C                     PARM WCURR     PKEY    3                                           233710
301400200616     C           SDCURR    PARM SDCURR    DSSDY                                               233710
301500200616      *                                                                                       233710
301600200616     C           PRTCD     IFNE *BLANKS                                                       233710
301700200616     C                     MOVE 'SDCURRPD'DBFILE                                              233710
301800200616     C                     MOVELPKEY      DBKEY                                               233710
301900200616     C                     Z-ADD30        DBASE                                               233710
302000200616     C                     MOVE *ON       *INU7                                               233710
302100200616     C                     MOVE *ON       *INU8                                               233710
302200200616     C                     MOVE *ON       *INLR                                               233710
302300200616     C                     EXSR *PSSR                                                         233710
302400200616     C                     GOTO EAUDIT                                                        233710
302500200616     C                     ENDIF                                                              233710
302600200616      *                                                                                       233710
302700200616     C                     ENDSR                                                              233710
302800200616      *****************************************************************                       233710
302900200616      /EJECT                                                                                  233710
303000200616      *****************************************************************                       233710
303100200616      *                                                               *                       233710
303200200616      * SRTAXB - Subroutine to Retrieve Tax Basket                    *                       233710
303300200616      *                                                               *                       233710
303400200616      *****************************************************************                       233710
303500200616     C           SRTAXB    BEGSR                                                              233710
303600200616      *                                                                                       233710
303700200616     C                     CALL 'AOTXBSR0'                                                    233710
303800200616     C                     PARM *BLANKS   PRTCD                                               233710
303900200616     C                     PARM '*KEY   ' POPTN                                               233710
304000200616     C                     PARM @@CTAX    PCTTT   2                                           233710
304100200616     C                     PARM @@TXBS    PTXBS   2                                           233710
304200200616     C                     PARM BJRDNB    PDATE   50                                          233710
304300200616     C                     PARM           PNARR  15                                           233710
304400200616     C                     PARM           PRATE   64                                          233710
304500200616      *                                                                                       233710
304600200616     C           PRTCD     IFEQ *BLANKS                                                       233710
304700200616     C                     Z-ADDPRATE     @@TAXR  64                                          233710
304800200616     C                     ELSE                                                               233710
304900200616     C                     Z-ADD*ZEROS    @@TAXR                                              233710
305000200616     C                     ENDIF                                                              233710
305100200616      *                                                                                       233710
305200200616     C                     ENDSR                                                              233710
305300200616      *****************************************************************                       233710
305400200616      /EJECT                                                                                  233710
305500200616      *****************************************************************                       233710
305600200616      *                                                               *                       233710
305700200616      * SRCPOS - Subroutine to access LF/CPOSN to retreive average    *                       233710
305800200616      *          fiscal price                                         *                       233710
305900200616      *                                                               *                       233710
306000200616      *****************************************************************                       233710
306100200616     C           SRCPOS    BEGSR                                                              233710
306200200616      *                                                                                       233710
306300200616     C           KCPOS     CHAINCPOSN                62                                       233710
306400200616      *                                                                                       233710
306500200616     C           *IN62     IFEQ *OFF                                                          233710
306600200616     C                     Z-ADDCSPV      TSPAMT                                              233710
306700200616     C                     ELSE                                                               233710
306800200616     C                     Z-ADD*ZEROS    TSPAMT                                              233710
306900200616     C                     ENDIF                                                              233710
307000200616      *                                                                                       233710
307100200616     C                     ENDSR                                                              233710
307200200616      *****************************************************************                       233710
307300200616      /EJECT                                                                                  233710
307400200616      *****************************************************************                       233710
307500200616      *                                                               *                       233710
307600200616      * SRCSIN - Subroutine to Output to SDCSINPD                     *                       233710
307700200616      *                                                               *                       233710
307800200616      *****************************************************************                       233710
307900200616     C           SRCSIN    BEGSR                                                              233710
308000200616      *                                                                                       233710
308100200616     C                     EXSR SRCPOS                                                        233710
308200200616      *                                                                                       233710
308300200616     C                     Z-ADDBJRDNB    TSRDNB                                              233710
308400200616     C                     Z-ADDPDUD      TSEDAT                                              233710
308500200616      *                                                                                       233710
308600200616      ** Get Tax Year from Tax Calculation Date                                               233710
308700200616      *                                                                                       233710
308800200616     C                     Z-ADDTSEDAT    ZDAYNO                                              233710
308900200616      *                                                                                       233710
309000200616     C                     CALL 'ZDATE2'                                                      233710
309100200616     C                     PARM           ZDAYNO  50                                          233710
309200200616     C                     PARM           BJDFIN                                              233710
309300200616     C                     PARM           ZDATE   60                                          233710
309400200616     C                     PARM           ZADATE  7                                           233710
309500200616      *                                                                                       233710
309600200616     C                     MOVE ZDATE     TSTAXY                                              233710
309700200616     C                     MOVEL'20'      TSTAXY                                              233710
309800200616      *                                                                                       233710
309900200616     C           BJDFIN    IFEQ 'D'                                                           233710
310000200616     C                     MOVELZDATE     WDATE1  4                                           233710
310100200616     C                     MOVE WDATE1    TSTAXM                                              233710
310200200616     C                     ELSE                                                               233710
310300200616     C                     MOVELZDATE     TSTAXM                                              233710
310400200616     C                     ENDIF                                                              233710
310500200616      *                                                                                       233710
310600200616     C                     MOVEL@@CTAX    TSCTRT                                              233710
310700200616     C                     MOVEL@@BRCA    TSBRCA                                              233710
310800200616     C                     MOVEL@@CUST    TSCUST                                              233710
310900200616      *                                                                                       233710
311000200616     C           WTXJA     IFEQ 'Y'                                                           233710
311100200616     C                     MOVEL@@JANO    TSJOIN                                              233710
311200200616     C                     MOVEL@@NARF    TSNAHO                                              233710
311300200616     C                     MOVEL@@INVP    TSINVP                                              233710
311400200616     C                     ELSE                                                               233710
311500200616     C**********           Z-ADD*ZERO     TSJOIN                                      233710 CSD027A
311600200616     C                     MOVE *BLANKS   TSJOIN                                             CSD027A
311700200616     C                     MOVE *BLANKS   TSNAHO                                              233710
311800200616     C                     MOVE *BLANKS   TSINVP                                              233710
311900200616     C                     ENDIF                                                              233710
312000200616      *                                                                                       233710
312100200616      ** Get Customer Status                                                                  233710
312200200616      *                                                                                       233710
312300200616     C                     SELEC                                                              233710
312400200616     C           @@STAT    WHEQ 'DISCL'                                                       233710
312500200616     C                     MOVEL'D'       TSSTAT                                              233710
312600200616     C           @@STAT    WHEQ 'SELF'                                                        233710
312700200616     C                     MOVEL'S'       TSSTAT                                              233710
312800200616     C           @@STAT    WHEQ 'TAXAB'                                                       233710
312900200616     C                     MOVEL'T'       TSSTAT                                              233710
313000200616     C                     ENDSL                                                              233710
313100200616      *                                                                                       233710
313200200616      ** Get Details either from SDACUSPD or SDNAHOPD                                         233710
313300200616      *                                                                                       233710
313400200616     C                     SELEC                                                              233710
313500200616     C           @@CUST    WHNE *BLANK                                                        233710
313600200616     C           @@CUST    CHAINSDACUSL1             61                                       233710
313700200616     C           *IN61     IFEQ *OFF                                                          233710
313800200616     C                     MOVELE5CNA1    TSFAMN                                              233710
313900200616     C                     MOVELE5CNA2    TSFIRN                                              233710
314000200616     C           E5CNA3    CAT  E5CNA4:1  TSSTRT                                              233710
314100200616     C                     MOVELE5ZIPC    TSZIPC                                              233710
314200200616     C                     MOVELE5CITY    TSCITY                                              233710
314300200616     C                     MOVELE5TINO    TSRTIN                                              233710
314400200616     C                     MOVELE5DBTH    TSDBTH                                              233710
314500200616     C                     MOVELE5BTHT    TSTBTH                                              233710
314600200616     C                     MOVELE5BTHC    TSCBTH                                              233710
314700200616     C                     ENDIF                                                              233710
314800200616      *                                                                                       233710
314900200616     C           @@NARF    WHNE *BLANK                                                        233710
315000200616     C           @@NARF    CHAINSDNAHOL1             61                                       233710
315100200616     C           *IN61     IFEQ *OFF                                                          233710
315200200616     C                     MOVELNHIDE1    TSFAMN                                              233710
315300200616     C                     MOVELNHIDE2    TSFIRN                                              233710
315400200616     C           NHIDE3    CAT  NHIDE4:1  TSSTRT                                              233710
315500200616     C                     MOVELNHZIPC    TSZIPC                                              233710
315600200616     C                     MOVELNHCITY    TSCITY                                              233710
315700200616     C                     MOVELNHTINO    TSRTIN                                              233710
315800200616     C                     MOVELNHDBTH    TSDBTH                                              233710
315900200616     C                     MOVELNHBTHT    TSTBTH                                              233710
316000200616     C                     MOVELNHBTHC    TSCBTH                                              233710
316100200616     C                     ENDIF                                                              233710
316200200616      *                                                                                       233710
316300200616     C                     ENDSL                                                              233710
316400200616      *                                                                                       233710
316500200616      ** Get Interest Payment Date                                                            233710
316600200616      *                                                                                       233710
316700200616     C***                  Z-ADDSAED      @@DAYN  50                                          233710
316800200616     C***                  EXSR ZDATE9                                                        233710
316900200616     C***                  MOVE @@VDT     TSIPDT                                              233710
317000200616      *                                                                                       233710
317100200616     C                     MOVEL@@COLC    TSRCTR                                              233710
317200200616     C                     MOVEL@@TXBS    TSTXBS                                              233710
317300200616     C                     MOVEL@@WTAC    TSWTAC                                              233710
317400200616     C                     MOVEL@@OCCY    TSOCCY                                              233710
317500200616      *                                                                                       233710
317600200616      ** Get Original Spot Rate                                                               233710
317700200616      *                                                                                       233710
317800200616     C                     MOVELTSOCCY    WCURR   3                                           233710
317900200616     C                     EXSR SRCURR                                                        233710
318000200616     C           A6MDIN    IFEQ 'D'                                                           233710
318100200616     C                     MOVELA6SPRT    TSOCSR                                              233710
318200200616     C                     ELSE                                                               233710
318300200616     C           1         DIV  A6SPRT    TSOCSR    H                                         233710
318400200616     C                     ENDIF                                                              233710
318500200616      *                                                                                       233710
318600200616     C                     MOVEL'D'       TSOCMD                                              233710
318700200616     C                     MOVELA6NBDP    TSOCDP                                              233710
318800200616     C                     MOVELTSOCCY    TSSCCY                                              233710
318900200616     C                     MOVELTSOCSR    TSSCSR                                              233710
319000200616     C                     MOVELTSOCMD    TSSCMD                                              233710
319100200616     C                     MOVELTSOCDP    TSSCDP                                              233710
319200200616     C           TXCY      IFEQ *BLANKS                                                       233710
319300200616     C**********           MOVE A4TXCY    TXCY                                         233710 234664
319400200616     C                     MOVEL@@TXCY    TXCY                                                234664
319500200616     C                     ENDIF                                                              233710
319600200616     C                     MOVELTXCY      TSTXCY                                              233710
319700200616      *                                                                                       233710
319800200616      ** Get Currency Spot Rate                                                               233710
319900200616      *                                                                                       233710
320000200616     C                     MOVELTSTXCY    WCURR                                               233710
320100200616     C                     EXSR SRCURR                                                        233710
320200200616     C           A6MDIN    IFEQ 'D'                                                           233710
320300200616     C                     MOVELA6SPRT    TSTCSR                                              233710
320400200616     C                     ELSE                                                               233710
320500200616     C           1         DIV  A6SPRT    TSTCSR    H                                         233710
320600200616     C                     ENDIF                                                              233710
320700200616      *                                                                                       233710
320800200616     C                     MOVEL'D'       TSTCMD                                              233710
320900200616     C                     MOVELA6NBDP    TSTCDP                                              233710
321000200616      *                                                                                       233710
321100200616      ** Get Orig/Settlement Currency Exchange Rate                                           233710
321200200616      ** Get Orig/Settlement Cross Rate                                                       233710
321300200616      *                                                                                       233710
321400200616     C                     Z-ADDTSOCSR    ZRATE1 138                                          233710
321500200616     C                     MOVE TSOCMD    ZMDI1   1                                           233710
321600200616     C                     Z-ADDTSSCSR    ZRATE2 138                                          233710
321700200616     C                     MOVE TSSCMD    ZMDI2   1                                           233710
321800200616     C                     EXSR ZXRATE                                                        233710
321900200616     C                     Z-ADDZRATEX    TSXROS                                              233710
322000200616     C                     MOVE ZMDIX     TSOSMD                                              233710
322100200616      *                                                                                       233710
322200200616      ** Get Settlement/Tax Currency Exchange Rate                                            233710
322300200616      *                                                                                       233710
322400200616     C                     Z-ADDTSSCSR    ZRATE1                                              233710
322500200616     C                     MOVE TSSCMD    ZMDI1                                               233710
322600200616     C                     Z-ADDTSTCSR    ZRATE2                                              233710
322700200616     C                     MOVE TSTCMD    ZMDI2                                               233710
322800200616     C                     EXSR ZXRATE                                                        233710
322900200616     C                     Z-ADDZRATEX    TSXRST                                              233710
323000200616     C                     MOVE ZMDIX     TSSTMD                                              233710
323100200616      *                                                                                       233710
323200200616     C                     MOVEL'S'       TSMODI                                              233710
323300200616      *                                                                                       233710
323400200616     C                     MOVEL*BLANKS   TSINST                                              233710
323500200616     C                     SELEC                                                              233710
323600200616     C           PEVT      WHEQ 'CP'                                                          233710
323700200616     C                     MOVEL'CP'      TSETYP                                              233710
323800200616     C           SESN      CAT  WINST1    TSINST                                              233710
323900200616     C           PEVT      WHEQ 'DV'                                                          233710
324000200616     C                     MOVEL'DV'      TSETYP                                              233710
324100200616     C           SESN      CAT  WINST2    TSINST                                              233710
324200200616     C           PEVT      WHEQ 'MT'                                                          233710
324300200616     C                     MOVEL'MT'      TSETYP                                              233710
324400200616     C           SESN      CAT  WINST3    TSINST                                              233710
324500200616     C           PEVT      WHEQ 'MP'                                                          233710
324600200616     C                     MOVEL'MP'      TSETYP                                              233710
324700200616     C           SESN      CAT  WINST4    TSINST                                              233710
324800200616     C                     ENDSL                                                              233710
324900200616      *                                                                                       233710
325000200616     C                     Z-ADD*ZERO     TSDLLN                                              233710
325100200616     C                     Z-ADD*ZERO     TSACOD                                              233710
325200200616     C                     Z-ADD*ZERO     TSACSQ                                              233710
325300200616      *                                                                                       233710
325400200616     C                     MOVELSESN      TSSESN                                              233710
325500200616     C                     MOVELSRPN      TSSRPN                                              233710
325600200616     C                     MOVELISNO      TSISIN                                              233710
325700200616      *                                                                                       233710
325800200616      ** Amounts in Original Currency                                                         233710
325900200616      *                                                                                       233710
326000200616     C                     Z-ADD@@TOTO    TSGINT                                              233710
326100200616      *                                                                                       233710
326200200616      ** The following fields are calculated when the customer status = T only.               233710
326300200616      *                                                                                       233710
326400200616     C                     Z-ADD*ZERO     TSTXRT                                              233710
326500200616     C                     Z-ADD*ZERO     TSTXSR                                              233710
326600200616     C           TSSTAT    IFEQ 'T'                                                           233710
326700200616     C                     Z-ADD@@TAXR    TSTXRT                                              233710
326800200616     C                     Z-ADD@@TAXA    TSTXSR                                              233710
326900200616     C                     ENDIF                                                              233710
327000200616      *                                                                                       233710
327100200616     C           TSGINT    SUB  TSTXSR    TSNINT                                              233710
327200200616      *                                                                                       233710
327300200616      ** Amounts in Settlement Currency                                                       233710
327400200616      *                                                                                       233710
327500200616     C           TSOCCY    IFEQ TSSCCY                                                        233710
327600200616     C                     Z-ADDTSPAMT    TSPAMS                                              233710
327700200616     C                     Z-ADD@@TOTO    TSGINS                                              233710
327800200616     C                     Z-ADD@@TAXA    TSTXSS                                              233710
327900200616      *                                                                                       233710
328000200616     C                     ELSE                                                               233710
328100200616     C                     Z-ADDTSPAMT    ZAMTF                                               233710
328200200616     C                     Z-ADDTSXROS    ZCRSRT                                              233710
328300200616     C                     MOVE TSOSMD    ZCRSMD                                              233710
328400200616     C                     Z-ADDTSOCDP    ZCDPF                                               233710
328500200616     C                     Z-ADDTSSCDP    ZCDPT                                               233710
328600200616     C                     EXSR ZCCYXR                                                        233710
328700200616     C                     Z-ADDZAMTT     TSPAMS                                              233710
328800200616      *                                                                                       233710
328900200616     C           TXST      MULT 100       WTAMT                                               233710
329000200616     C           @@TAXR    IFNE 0                                                             233710
329100200616     C           WTAMT     DIV  @@TAXR    TSGINS                                              233710
329200200616     C                     ELSE                                                               233710
329300200616     C                     Z-ADD0         TSGINS                                              233710
329400200616     C                     ENDIF                                                              233710
329500200616      *                                                                                       233710
329600200616     C                     Z-ADDTXST      TSTXSS                                              233710
329700200616     C                     ENDIF                                                              233710
329800200616      *                                                                                       233710
329900200616     C           TSGINS    SUB  TSTXSS    TSNINS                                              233710
330000200616      *                                                                                       233710
330100200616      ** Amounts in Tax Currency                                                              233710
330200200616      *                                                                                       233710
330300200616     C           TSSCCY    IFEQ TSTXCY                                                        233710
330400200616     C                     Z-ADDTSPAMS    TSPAMC                                              233710
330500200616     C                     Z-ADDTSGINS    TSGINC                                              233710
330600200616     C                     Z-ADDTSTXSS    TSTXSC                                              233710
330700200616      *                                                                                       233710
330800200616     C                     ELSE                                                               233710
330900200616     C                     Z-ADDTSPAMS    ZAMTF                                               233710
331000200616     C                     Z-ADDTSXRST    ZCRSRT                                              233710
331100200616     C                     MOVE TSSTMD    ZCRSMD                                              233710
331200200616     C                     Z-ADDTSSCDP    ZCDPF                                               233710
331300200616     C                     Z-ADDTSTCDP    ZCDPT                                               233710
331400200616     C                     EXSR ZCCYXR                                                        233710
331500200616     C                     Z-ADDZAMTT     TSPAMC                                              233710
331600200616      *                                                                                       233710
331700200616     C           TAXA      MULT 100       WTAMT                                               233710
331800200616     C           @@TAXR    IFNE 0                                                             233710
331900200616     C           WTAMT     DIV  @@TAXR    TSGINC                                              233710
332000200616     C                     ELSE                                                               233710
332100200616     C                     Z-ADD0         TSGINS                                              233710
332200200616     C                     ENDIF                                                              233710
332300200616     C                     Z-ADDTAXA      TSTXSC                                              233710
332400200616      *                                                                                       233710
332500200616     C                     ENDIF                                                              233710
332600200616      *                                                                                       233710
332700200616     C           TSGINC    SUB  TSTXSC    TSNINC                                              233710
332800200616      *                                                                                       233710
332900200616      ** Amounts in Base Currency                                                             233710
333000200616      *                                                                                       233710
333100200616     C           TSSCCY    IFEQ BJCYCD                                                        233710
333200200616     C                     Z-ADDTSPAMS    TSPAMB                                              233710
333300200616     C                     Z-ADDTSGINS    TSGINB                                              233710
333400200616     C                     Z-ADDTSTXSS    TSTXSB                                              233710
333500200616      *                                                                                       233710
333600200616     C                     ELSE                                                               233710
333700200616     C                     Z-ADDTSPAMS    ZAMTF                                               233710
333800200616     C                     Z-ADDTSSCSR    ZCRSRT                                              233710
333900200616     C                     MOVE TSSCMD    ZCRSMD                                              233710
334000200616     C                     Z-ADDTSSCDP    ZCDPF                                               233710
334100200616      *                                                                                       233710
334200200616      ** Get Base Currency Decimal Places                                                     233710
334300200616      *                                                                                       233710
334400200616     C                     MOVELBJCYCD    WCURR                                               233710
334500200616     C                     EXSR SRCURR                                                        233710
334600200616     C                     Z-ADDA6NBDP    ZCDPI                                               233710
334700200616     C                     Z-ADDZCDPI     ZCDPT                                               233710
334800200616     C                     EXSR ZCCYXR                                                        233710
334900200616     C                     Z-ADDZAMTT     TSPAMB                                              233710
335000200616      *                                                                                       233710
335100200616     C                     Z-ADDTSGINS    ZAMTF                                               233710
335200200616     C                     Z-ADDTSSCSR    ZCRSRT                                              233710
335300200616     C                     MOVE TSSCMD    ZCRSMD                                              233710
335400200616     C                     Z-ADDTSSCDP    ZCDPF                                               233710
335500200616     C                     Z-ADDZCDPI     ZCDPT                                               233710
335600200616     C                     EXSR ZCCYXR                                                        233710
335700200616     C                     Z-ADDZAMTT     TSGINB                                              233710
335800200616      *                                                                                       233710
335900200616     C                     Z-ADDTSTXSS    ZAMTF                                               233710
336000200616     C                     Z-ADDTSSCSR    ZCRSRT                                              233710
336100200616     C                     MOVE TSSCMD    ZCRSMD                                              233710
336200200616     C                     Z-ADDTSSCDP    ZCDPF                                               233710
336300200616     C                     Z-ADDZCDPI     ZCDPT                                               233710
336400200616     C                     EXSR ZCCYXR                                                        233710
336500200616     C                     Z-ADDZAMTT     TSTXSB                                              233710
336600200616     C                     ENDIF                                                              233710
336700200616      *                                                                                       233710
336800200616     C           TSGINB    SUB  TSTXSB    TSNINB                                              233710
336900200616     C                     MOVE 'N'       TSINPR                                              233710
337000200616     C                     Z-ADD*ZERO     TSTNLU                                              233710
337100200616     C                     ADD  TSTXSB    WWTXSB                                              233710
337200200616      *                                                                                       CER048
337300200616     C           CER048    IFEQ 'Y'                                                           CER048
337400200616      *                                                                                       CER048
337500200616     C                     MOVE *ZEROS    TSSTXB                                              CER048
337600200616     C                     MOVE *ZEROS    TSSTAC                                              CER048
337700200616     C                     MOVE *ZEROS    TSSTRT                                              CER048
337800200616     C                     MOVE *ZEROS    TSSTDO                                              CER048
337900200616     C                     MOVE *ZEROS    TSSTDS                                              CER048
338000200616     C                     MOVE *ZEROS    TSSTDT                                              CER048
338100200616     C                     MOVE *ZEROS    TSSTDB                                              CER048
338200200616     C                     MOVE *ZEROS    TSPTHU                                              CER048
338300200616     C                     MOVE *ZEROS    TSPTUT                                              CER048
338400200616      *                                                                                       CER048
338500200616     C           CER054    IFEQ 'Y'                                                           CER054
338600200616      *                                                                                       CER054
338700200616     C                     MOVE *BLANKS   TSSTCD                                              CER054
338800200616     C                     MOVE *BLANKS   TSRLAF                                              CER054
338900200616     C                     MOVE *ZEROS    TSTTXB                                              CER054
339000200616     C                     MOVE *ZEROS    TSTTAC                                              CER054
339100200616     C                     MOVE *ZEROS    TSTTRA                                              CER054
339200200616     C                     MOVE *ZEROS    TSTTDO                                              CER054
339300200616     C                     MOVE *ZEROS    TSTTDS                                              CER054
339400200616     C                     MOVE *ZEROS    TSTTDT                                              CER054
339500200616     C                     MOVE *ZEROS    TSTTDB                                              CER054
339600200616      *                                                                                       CER054
339700200616     C                     ENDIF                                                              CER054
339800200616      *                                                                                       CER054
339900200616     C                     ENDIF                                                              CER048
340000200616      *                                                                                       233710
340100200616      ** Write record to SDCSINPD                                                             233710
340200200616      *                                                                                       233710
340300200616     C                     WRITESDCSIND0                                                      233710
340400200616      *                                                                                       233710
340500200616     C                     ENDSR                                                              233710
340600200616      *****************************************************************                       233710
340700200616      /EJECT                                                                                  235174
340800200616      *****************************************************************                       235174
340900200616      *                                                               *                       235174
341000200616      *  SREAET - EU a/c key generation for tax amount.               *                       235174
341100200616      *                                                               *                       235174
341200200616      *****************************************************************                       235174
341300200616     C           SREAET    BEGSR                                                              235174
341400200616      *                                                                                       235174
341500200616     C                     MOVEL'E'       EVTP                                                235174
341600200616     C                     MOVEL@@COLC    COTA                                                235174
341700200616     C                     MOVEL'ET'      AMCD                                                235174
341800200616     C                     Z-ADD*ZERO     EVAM                                                235709
341900200616     C                     Z-ADD*ZERO     KNCA                                                235709
342000200616     C                     Z-ADD*ZERO     KBCA                                                235709
342100200616      *                                                                                       235174
342200200616      ** Tax amount in tax ccy from POSETD                                                    235174
342300200616      *                                                                                       235174
342400200616     C           WTXJA     IFEQ 'Y'                                                           235174
342500200616     C           TSSTAT    IFEQ 'T'                                                           235709
342600200616     C           @@TCIT    MULT @@TXR1    @@TTXT    H                                         235226
342700200616     C                     CALL 'ZAMRATIO'                                                    235174
342800200616     C                     PARM           @@INVP                                              235174
342900200616     C**********           PARM           TAXA                                         235174 235709
343000200616     C                     PARM           @@TTXT                                              235709
343100200616     C                     PARM           @@TXAM 150                                          235174
343200200616     C                     Z-ADD@@TXAM    EVAM                                                235174
343300200616     C                     ENDIF                                                              235709
343400200616     C                     ELSE                                                               235174
343500200616     C                     Z-ADDTAXA      EVAM                                                235174
343600200616     C                     ENDIF                                                              235174
343700200616      *                                                                                       235174
343800200616     C                     MOVELTSTXCY    EVCY                                                235174
343900200616     C                     MOVELTSOCCY    KCCY                                                235174
344000200616      *                                                                                       235174
344100200616     C           TSTXCY    IFNE TSOCCY                                                        235174
344200200616     C           WTXJA     IFEQ 'Y'                                                           235174
344300200616     C           TSSTAT    IFEQ 'T'                                                           235709
344400200616     C           @@TCIS    MULT @@TXR1    @@TTXS    H                                         235226
344500200616     C                     CALL 'ZAMRATIO'                                                    235174
344600200616     C                     PARM           @@INVP                                              235174
344700200616     C**********           PARM           TXST                                         235174 235709
344800200616     C                     PARM           @@TTXS                                              235709
344900200616     C                     PARM           @@TXAM                                              235174
345000200616     C                     Z-ADD@@TXAM    KNCA                                                235174
345100200616     C**********           Z-ADDTSTXSB    KBCA                                         235174 235226
345200200616      *                                                                                       235226
345300200616     C           PSCU      IFEQ BJCYCD                                                        235226
345400200616     C                     Z-ADD@@TXAM    KBCA                                                235226
345500200616     C                     ELSE                                                               235226
345600200616      *                                                                                       235226
345700200616     C* Do not convert from the Other Amount if Tax and Base Ccy are equals                  235226A
345800200616     C           EVCY      IFEQ BJCYCD                                                       235226A
345900200616     C                     Z-ADDEVAM      KBCA                                               235226A
346000200616     C                     ELSE                                                              235226A
346100200616     C*                                                                                      235226A
346200200616     C                     MOVE PSCU      WCURR                                               235226
346300200616     C                     EXSR SRCURR                                                        235226
346400200616     C                     Z-ADDA6SPRT    ZRATE1                                              235226
346500200616     C                     MOVE A6MDIN    ZMDI1                                               235226
346600200616     C                     MOVE A6NBDP    ZCDPI                                               235226
346700200616      *                                                                                       235226
346800200616     C                     MOVE BJCYCD    WCURR                                               235226
346900200616     C                     EXSR SRCURR                                                        235226
347000200616     C                     Z-ADDA6SPRT    ZRATE2                                              235226
347100200616     C                     MOVE A6MDIN    ZMDI2                                               235226
347200200616     C                     MOVE A6NBDP    ZCDPO                                               235226
347300200616      *                                                                                       235226
347400200616     C                     EXSR ZXRATE                                                        235226
347500200616      *                                                                                       235226
347600200616     C                     Z-ADD@@TXAM    ZAMTCI                                              235226
347700200616     C                     Z-ADDZRATEX    ZEXCH                                               235226
347800200616     C                     MOVE ZMDIX     ZMD                                                 235226
347900200616     C                     MOVE PSCU      ZCCYI                                               235226
348000200616     C                     MOVE BJCYCD    ZCCYO                                               235226
348100200616      *                                                                                       235226
348200200616     C                     EXSR ZCONV                                                         235226
348300200616     C                     Z-ADDZAMTCO    KBCA                                                235226
348400200616     C*                                                                                      235226A
348500200616     C                     ENDIF                                                             235226A
348600200616     C*                                                                                      235226A
348700200616     C                     ENDIF                                                              235226
348800200616      *                                                                                       235226
348900200616     C                     ENDIF                                                              235709
349000200616     C                     ELSE                                                               235174
349100200616     C**********           Z-ADDTXST      KNCA                                         235174 234635
349200200616     C                     Z-ADDTXNM      KNCA                                                234635
349300200616     C                     Z-ADDWWTXSB    KBCA                                                235174
349400200616     C                     ENDIF                                                              235174
349500200616     C                     ELSE                                                               235174
349600200616     C                     Z-ADD0         KNCA                                                235174
349700200616     C                     Z-ADD0         KBCA                                                235174
349800200616     C                     ENDIF                                                              235174
349900200616      *                                                                                       235174
350000200616      ** Build output record                                                                  235174
350100200616      *                                                                                       235174
350200200616     C                     MOVE SITP      INVT                                                235174
350300200616     C                     MOVE ' '       TRTP                                                235174
350400200616      *                                                                                       235174
350500200616     C                     MOVE '  '      BOOK                                                235174
350600200616     C                     MOVE ' '       PSBS                                                235174
350700200616     C                     MOVE ' '       FIL1                                                235174
350800200616     C                     MOVE '  '      CGTP                                                235174
350900200616     C                     MOVE 'D'       RECI                                                235174
351000200616      *                                                                                       235174
351100200616     C           PPRE      IFEQ 'R'                                                           235174
351200200616     C           PSMT      ANDEQ04                                                            235174
351300200616     C           PPRE      OREQ 'P'                                                           235174
351400200616     C           PSMT      ANDEQ04                                                            235174
351500200616     C                     ELSE                                                               235174
351600200616     C                     MOVE *BLANK    STLA                                                235174
351700200616     C                     ENDIF                                                              235174
351800200616      *                                                                                       235174
351900200616     C           PPRE      IFEQ 'R'                                                           235174
352000200616     C           PSMT      ANDEQ04                                                            235174
352100200616     C           PPRE      OREQ 'P'                                                           235174
352200200616     C           PSMT      ANDEQ04                                                            235174
352300200616     C                     ELSE                                                               235174
352400200616     C                     Z-ADD0         STLT                                                235174
352500200616     C                     ENDIF                                                              235174
352600200616      *                                                                                       235174
352700200616      ** Write Generated Account Key Record                                                   235174
352800200616      *                                                                                       235174
352900200616     C                     EXSR WRITED                                                        235174
353000200616      *                                                                                       235174
353100200616     C                     ENDSR                                                              235174
353200200616      *****************************************************************                       235174
353300200616      /EJECT                                                                                  235709
353400200616      *****************************************************************                       235709
353500200616      *                                                               *                       235709
353600200616      ***SRETJA*-*Determines*the*total*EU*tax*if*all*Joint*A/c*********                235709 235226
353700200616      ************members*were*taxable.********************************                235709 235226
353800200616      *  SRETJA - Determines the total customer income of the         *                       235226
353900200616      *           Position Settlement.                                *                       235226
354000200616      *                                                               *                       235709
354100200616      *****************************************************************                       235709
354200200616     C           SRETJA    BEGSR                                                              235709
354300200616      *                                                                                       235709
354400200616     C                     Z-ADD*ZERO     WNUMER  50                                          235709
354500200616     C                     Z-ADD*ZERO     WDENOM  50                                          235709
354600200616     C                     Z-ADD*ZERO     WIPTRN 138                                          235226
354700200616     C                     Z-ADD*ZERO     WIPTRT 138                                          235226
354800200616     C                     Z-ADD*ZERO     @@TTXT 130                                          235709
354900200616     C                     Z-ADD*ZERO     @@TTXS 130                                          235709
355000200616     C                     Z-ADD*ZERO     @@TCIT 218                                          235226
355100200616     C                     Z-ADD*ZERO     @@TCIS 218                                          235226
355200200616      *                                                                                       235709
355300200616     C           KJANO     SETLLSDJACCLB                                                      235709
355400200616     C           KJANO     READESDJACCLB                 60                                   235709
355500200616      *                                                                                       235709
355600200616     C           *IN60     DOWEQ*OFF                                                          235709
355700200616      *                                                                                       235709
355800200616     C                     CALL 'ZATXCLJA'                                                    235709
355900200616      *                                                                                       235709
356000200616     C                     PARM 'S'       @@MODI                                              235709
356100200616     C                     PARM           @@TRRF                                              235709
356200200616     C                     PARM PBCA      @@BRCA                                              235709
356300200616     C                     PARM JCJANO    @@JANO                                              235709
356400200616     C                     PARM JCCUST    @@CUST                                              235709
356500200616     C                     PARM JCNAHO    @@NARF                                              235709
356600200616     C                     PARM JCINVP    @@INVP                                              235709
356700200616     C                     PARM *ZERO     @@STRD                                              235709
356800200616     C                     PARM *ZERO     @@ENDD                                              235709
356900200616     C                     PARM PAMD      @@TOTI                                              235709
357000200616     C                     PARM           @@TAXR                                              235709
357100200616     C                     PARM PNCY      @@OCCY                                              235709
357200200616     C                     PARM *BLANKS   PINTH                                               CER048
357300200616      *                                                                                       235709
357400200616     C                     PARM           @@IAED                                              235709
357500200616     C                     PARM           @@TAXA                                              235709
357600200616     C                     PARM           @@TOTO                                              235709
357700200616     C                     PARM           @@TXCY                                              235709
357800200616     C                     PARM           @@CTAX                                              235709
357900200616     C                     PARM           @@TXBS                                              235709
358000200616     C                     PARM           @@WTAC                                              235709
358100200616     C                     PARM           @@COLC                                              235709
358200200616     C                     PARM           @@STAT                                              235709
358300200616     C                     PARM           @@TRTE                                              235709
358400200616     C                     PARM           @@TXR1                                              235709
358500200616     C                     PARM           @@JAMG                                              235709
358600200616     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
358700200616     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
358800200616     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
358900200616     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
359000200616     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
359100200616     C                     PARM           @@KEY                                               235709
359200200616     C                     PARM           @@FILE                                              235709
359300200616     C                     PARM           @@RTRN                                              235709
359400200616     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
359500200616      *                                                                                       235709
359600200616     C           @@RTRN    IFEQ 'ERROR'                                                       235709
359700200616     C                     MOVE @@FILE    DBFILE                                              235709
359800200616     C                     MOVE @@KEY     DBKEY                                               235709
359900200616     C                     Z-ADD62        DBASE                                               235709
360000200616     C                     MOVE *ON       *INU7                                               235709
360100200616     C                     MOVE *ON       *INU8                                               235709
360200200616     C                     EXSR *PSSR                                                         235709
360300200616     C                     GOTO EAUDIT                                                        235709
360400200616     C                     ENDIF                                                              235709
360500200616      *                                                                                       235709
360600200616     C           @@STAT    IFEQ 'TAXAB'                                                       235709
360700200616      *                                                                                       235709
360800200616      ** Parse the Investment Proportion.                                                     235709
360900200616      *                                                                                       235709
361000200616     C                     CALL 'ZAINVPUT'                                                    235709
361100200616     C                     PARM '*PARSE ' POPTN   7                                           235709
361200200616     C                     PARM @@INVP    PPARM1 10                                           235709
361300200616     C                     PARM           PPARM2 10                                           235709
361400200616     C                     PARM           PPARM3 10                                           235709
361500200616     C                     PARM           PRATIO 138                                          235709
361600200616      *                                                                                       235709
361700200616      ***Get*the*total*Investment*Proportion*of*all*taxable*members.***                235709 235226
361800200616      ** Get the total Inv. Prop. * Tax Rate of all taxable members.                          235226
361900200616      *                                                                                       235709
362000200616     C                     MOVE PPARM2    WTEMP   40                                          235709
362100200616     C                     Z-ADD*ZERO     WNUMER                                              235226
362200200616     C                     ADD  WTEMP     WNUMER                                              235709
362300200616     C                     MOVE PPARM3    WDENOM                                              235709
362400200616      *                                                                                       235226
362500200616     C           @@TXR1    MULT WNUMER    WIPTRN                                              235226
362600200616     C                     DIV  WDENOM    WIPTRN                                              235226
362700200616     C                     ADD  WIPTRN    WIPTRT                                              235226
362800200616      *                                                                                       235709
362900200616     C                     ENDIF                                                              235709
363000200616      *                                                                                       235709
363100200616     C           @@RTRN    IFEQ 'NOTAX'                                                       235709
363200200616     C           @@RTRN    OREQ 'TAXAB'                                                       235709
363300200616     C           KJANO     READESDJACCLB                 60                                   235709
363400200616     C                     ENDIF                                                              235709
363500200616      *                                                                                       235709
363600200616     C           @@RTRN    IFEQ 'LAST'                                                        235709
363700200616     C                     MOVE *ON       *IN60                                               235709
363800200616     C                     ENDIF                                                              235709
363900200616      *                                                                                       235709
364000200616     C                     ENDDO                                                              235709
364100200616      *                                                                                       235709
364200200616     C           WIPTRT    IFNE *ZERO                                                         235226
364300200616     C           1         DIV  WIPTRT    WTEMP2 138                                          235226
364400200616      *                                                                                       235226
364500200616      ** Total customer income in tax currency.                                               235226
364600200616      *                                                                                       235226
364700200616     C           TAXA      MULT WTEMP2    @@TCIT                                              235226
364800200616      *                                                                                       235226
364900200616      ** Total customer income in settlement currency.                                        235226
365000200616      *                                                                                       235226
365100200616     C           TXST      MULT WTEMP2    @@TCIS                                              235226
365200200616     C                     ENDIF                                                              235226
365300200616      *                                                                                       235226
365400200616     C********** WNUMER    IFNE *ZERO                                                  235709 235226
365500200616      *****************************************************************                235709 235226
365600200616      ***EU*Tax*=*WNUMER/WDEMOM***C*where******************************                235709 235226
365700200616      *****WNUMER/WDEMOM*-*Total*Investment*Proportion*(of*all*taxable*members)        235709 235226
365800200616      *****C*-*Total*EU*Tax*(if*all*members*were*taxable)**************                235709 235226
365900200616      ***Thus,*C*=*EU*Tax***WDENOM/WNUMER.*****************************                235709 235226
366000200616      *****************************************************************                235709 235226
366100200616     C**********           MOVE *BLANKS   PPARM1                                       235709 235226
366200200616     C**********           MOVE *BLANKS   PPARM2                                       235709 235226
366300200616     C**********           MOVE WDENOM    PPARM1                                       235709 235226
366400200616     C**********           MOVE WNUMER    PPARM2                                       235709 235226
366500200616      *****************************************************************                235709 235226
366600200616      ***Build*the*inverse*Investment*Proportion.**********************                235709 235226
366700200616      *****************************************************************                235709 235226
366800200616     C**********           CALL 'ZAINVPUT'                                             235709 235226
366900200616     C**********           PARM '*BUILD ' POPTN                                        235709 235226
367000200616     C**********           PARM           PPARM1                                       235709 235226
367100200616     C**********           PARM           PPARM2                                       235709 235226
367200200616     C**********           PARM           PPARM3                                       235709 235226
367300200616     C**********           PARM           PRATIO                                       235709 235226
367400200616      *****************************************************************                235709 235226
367500200616      ***Total*EU*Tax*if*all*members*were*taxable*in*******************                235709 235226
367600200616      ***...Tax*Currency.**********************************************                235709 235226
367700200616      *****************************************************************                235709 235226
367800200616     C**********           CALL 'ZAMRATIO'                                             235709 235226
367900200616     C**********           PARM           PPARM3                                       235709 235226
368000200616     C**********           PARM           TAXA                                         235709 235226
368100200616     C**********           PARM           @@TXAM                                       235709 235226
368200200616     C**********           Z-ADD@@TXAM    @@TTXT                                       235709 235226
368300200616      *****************************************************************                235709 235226
368400200616      ***...Settlement*Currency.***************************************                235709 235226
368500200616      *****************************************************************                235709 235226
368600200616     C**********           CALL 'ZAMRATIO'                                             235709 235226
368700200616     C**********           PARM           PPARM3                                       235709 235226
368800200616     C**********           PARM           TXST                                         235709 235226
368900200616     C**********           PARM           @@TXAM                                       235709 235226
369000200616     C**********           Z-ADD@@TXAM    @@TTXS                                       235709 235226
369100200616      *****************************************************************                235709 235226
369200200616     C**********           ENDIF                                                       235709 235226
369300200616      *                                                                                       235709
369400200616     C                     ENDSR                                                              235709
369500200616      *****************************************************************                       235709
369600200616     C/EJECT
369700200616     C*****************************************************************
369800200616     C*                                                               *
369900200616     C* SUBROUTINE TO WRITE RECORD TO SEKEYD FILE                     *
370000200616     C*                                                               *
370100200616     C*****************************************************************
370200200616     C*
370300200616     C           WRITED    BEGSR                           ** WRITED **
370400200616     C*
370500200616     C** ONLY OUTPUT A/C KEY RECORD IF EVENT AMOUNT NON-ZERO
370600200616     C/COPY WNCPYSRC,SE2300C032
370700200616     C*
370800200616     C           EVAM      IFNE 0
370900200616     C*                                                                   E37536
371000200616     C           NEGI      IFEQ 'N'                                       E37536
371100200616     C           EVAM      ANDLT0                                         E37536
371200200616     C                     Z-SUBEVAM      EVAM                            E37536
371300200616     C                     END                                            E37536
371400200616     C*
371500200616     C* SET UP KEY FOR SEKEYD RECORD
371600200616     C*
371700200616     C                     MOVE 'D'       RECI
371800200616     C                     MOVE SITP      INVT
371900200616     C                     MOVE *BLANK    TRTP
372000200616     C                     MOVE PSEB      SEBR                            S01117
372100200616     C*                                                                   CAC002
372200200616     C           BGN0ST    IFEQ 'N'                                       CAC002
372300200616     C                     MOVE PPFC      PRFC                            S01117
372400200616     C                     ENDIF                                          CAC002
372500200616     C*                                                                   CAC002
372600200616     C***********C1DI      IFEQ 'M'                                       E14713
372700200616     C***********          MOVE *BLANKS   PORT                            E14713
372800200616     C           C1DI      IFNE 'S'                                       E14713
372900200616     C           C1DI      ANDNE'D'                                       E14713
373000200616     C***********C1DI      ANDNE'I'                                       E16359
373100200616     C                     MOVE 'X'       PORT                            E14713
373200200616     C                     ELSE
373300200616     C                     MOVELC1DI      PORT
373400200616     C                     END
373500200616     C***********C1DI      IFEQ 'M'                                       E16359
373600200616     C***********          MOVE *BLANKS   PORT                            E16359
373700200616     C***********          END                                            E16359
373800200616     C           WWCOAT    IFEQ ' '                                       CSE007
373900200616     C                     MOVE FIL1      TRTP
374000200616     C                     ENDIF                                          CSE007
374100200616     C           CIAK      IFEQ 'Y'
374200200616     C           SCVI      ANDEQ'Y'                                       E15430
374300200616     C                     MOVE SCVI      CNVI
374400200616     C                     ELSE
374500200616     C                     MOVE *BLANK    CNVI
374600200616     C                     END
374700200616     C*************        MOVE 'S'       MRKT                            E15685
374800200616     C                     MOVE MKTI      MRKT                            E15685
374900200616     C*
375000200616     C* SET UP REST OF SEKEYD RECORD
375100200616     C*
375200200616     C                     Z-ADD0         TRFR
375300200616     C**********           Z-ADDPCPY      CSTN                                                CSD027
375400200616     C                     MOVE PCPY      CSTN                                                CSD027
375500200616     C***********          MOVELPBCH      BRCH                            S01117
375600200616     C                     MOVELPBCA      BRHA                            S01117
375700200616     C***********          MOVE 01        ASQN                            E18803
375800200616     C/COPY WNCPYSRC,SE2300C025
375900200616     C                     MOVE 00        ASQN                            E18803
376000200616     C/COPY WNCPYSRC,SE2300C026
376100200616     C           S01512    IFEQ 'Y'                                       S01512
376200200616     C                     Z-ADDPSVL      EVDT                            S01512
376300200616     C                     ELSE                                           S01512
376400200616     C                     Z-ADDPDUD      EVDT
376500200616     C                     END                                            S01512
376600200616     C           EVCY      IFEQ *BLANKS
376700200616     C                     MOVE PNCY      EVCY
376800200616     C                     END
376900200616     C                     MOVE '0'       RVRS
377000200616     C           S01496    IFEQ 'Y'                                       S01496
377100200616     C           CSE007    OREQ 'Y'                                       CSE007
377200200616     C           CEU017    OREQ 'Y'                                       CEU017
377300200616     C           WWRECI    IFEQ 'R'                                       S01496
377400200616     C                     MOVE '1'       RVRS                            S01496
377500200616     C                     ENDIF                                          S01496
377600200616     C                     ENDIF                                          S01496
377700200616     C*                                                                                       225599
377800200616     C           PRECI     IFEQ '*'                                                           225599
377900200616     C                     MOVE '1'       RVRS                                                225599
378000200616     C                     END                                                                225599
378100200616     C*                                                                   E19770
378200200616     C* NEED ISSUER FOR POSTING REF 4.                                    E19770
378300200616     C*                                                                   E19770
378400200616     C*****                Z-ADD0         ISSR                            E19770
378500200616     C*                                                                   E19770
378600200616     C*********************Z-ADD0         KCUST                           E19975
378700200616     C**********           Z-ADDPCPY      KCUST                                        055942 CSD027
378800200616     C                     MOVE PCPY      KCUST                                               CSD027
378900200616     C                     MOVE PSSH      SESH
379000200616     C***********          MOVELPNCY      KCCY                            S01509
379100200616     C                     MOVELNMCY      KCCY                            S01509
379200200616     C/COPY WNCPYSRC,SE2300C033
379300200616     C*
379400200616     C** COUNT RECORDS AND ADD EVENT AMOUNT INTO HASH TOTAL
379500200616     C*
379600200616     C                     Z-ADDEVAM      ZZAMT
379700200616     C                     EXSR ZHASH
379800200616     C                     ADD  1         OREC    50
379900200616     C*                                                                   S01486
380000200616     C**  Output Portfolio Ref. for acct. keys for Portfolio customers.   S01486
380100200616     C*                                                                   S01486
380200200616     C                     MOVE *BLANKS   PTFR                            S01486
380300200616     C           BGPFMG    IFEQ 'Y'                                       S01486
380400200616     C           BGN4ST    OREQ 'Y'                                       CPB001
380500200616     C*                                                                   S01486
380600200616     C           PORT      IFEQ 'S'                                       S01486
380700200616     C           PORT      OREQ 'D'                                       S01486
380800200616     C           AMCD      IFEQ 'DI'                                      S01486
380900200616     C           AMCD      OREQ 'PP'                                      S01486
381000200616     C           AMCD      OREQ 'CV'                                      S01486
381100200616     C           AMCD      OREQ 'SA'                                      046386
381200200616     C                     MOVE RNPTFR    PTFR                            S01486
381300200616     C                     END                                            S01486
381400200616     C                     END                                            S01486
381500200616     C                     Z-ADDPTNLU     TNLU                            S01486
381600200616     C                     MOVE PEVT      PEV1                            S01486
381700200616     C*                                                                   S01486
381800200616     C                     END                                            S01486
381900200616     C*                                                                                     AR864714
382000200616     C           CER049    IFEQ 'Y'                                                         AR864714
382100200616     C                     MOVE PEVT      PEV1                                              AR864714
382200200616     C           S01512    IFEQ 'Y'                                                        AR942839A
382300200616     C                     MOVELPDUD      STLAQQ                                           AR942839A
382400200616     C                     ENDIF                                                           AR942839A
382500200616     C                     ENDIF                                                            AR864714
382600200616      *                                                                   CAC002
382700200616      ** If Analytical Accounting is installed, define the profit         CAC002
382800200616      ** centre for each posting.                                         CAC002
382900200616      *                                                                   CAC002
383000200616     C           BGN0ST    IFEQ 'Y'                                       CAC002
383100200616      *                                                                   CAC002
383200200616     C           AMCD      IFNE 'CP'                                      CAC002
383300200616     C           AMCD      ANDNE'CR'                                      CAC002
383400200616     C           AMCD      ANDNE'FP'                                      CAC002
383500200616     C           AMCD      ANDNE'FR'                                      CAC002
383600200616      *                                                                   CAC002
383700200616     C           C1DI      IFEQ 'S'                                       CAC002
383800200616     C           C1DI      OREQ 'D'                                       CAC002
383900200616     C                     MOVE PPFC      PRFC                            CAC002
384000200616     C                     ELSE                                           CAC002
384100200616     C                     MOVE BVSEPC    PRFC                            CAC002
384200200616     C                     ENDIF                                          CAC002
384300200616     C*                                                                   CAC002
384400200616     C                     ENDIF                                          CAC002
384500200616     C*                                                                   CAC002
384600200616     C                     ENDIF                                          CAC002
384700200616     C/COPY WNCPYSRC,SE2300C030
384800200616     C*
384900200616      ** Process the Pay/Receive Settlement Instructions.                                     CGL020
385000200616      *                                                                                       CGL020
385100200616     C           CGL020    IFEQ 'Y'                                                           CGL020
385200200616     C                     EXSR SRPRSI                                                        CGL020
385300200616     C                     ENDIF                                                              CGL020
385400200616      *                                                                                       CGL020
385500200616     C                     WRITESEKEYDF
385600200616      *                                                                                       CGL020
385700200616      ** Clear the Fee Fields to avoid unnecessary side effects.                              CGL020
385800200616      *                                                                                       CGL020
385900200616     C           CGL020    IFEQ 'Y'                                                           CGL020
386000200616     C                     MOVE *BLANK    F1FFLG                                              CGL020
386100200616     C                     Z-ADD0         F1FVAL                                              CGL020
386200200616     C                     Z-ADD0         F1FPCT                                              CGL020
386300200616     C                     ENDIF                                                              CGL020
386400200616      *                                                                                       CGL020
386500200616     C/COPY WNCPYSRC,SE2300C031
386600200616     C                     END
386700200616     C*
386800200616     C                     ENDSR
386900200616     C*****************************************************************
387000200616     C/EJECT
387100200616     C*****************************************************************
387200200616     C*                                                               *
387300200616     C* CLEAR - SUBROUTINE TO CLEAR FIELDS BEFORE GENERATING RECORD   *
387400200616     C*                                                               *
387500200616     C*****************************************************************
387600200616     C*
387700200616     C           CLEAR     BEGSR                           ** WRITED **
387800200616     C*
387900200616     C                     MOVE 'D'       RECI
388000200616     C                     MOVEL*BLANKS   ACKY
388100200616     C                     Z-ADD0         TRFR
388200200616     C**********           Z-ADD0         CSTN                                                CSD027
388300200616     C                     MOVE *BLANKS   CSTN                                                CSD027
388400200616     C***********          MOVEL*BLANKS   BRCH                            S01117
388500200616     C                     MOVEL*BLANKS   BRHA                            S01117
388600200616     C                     Z-ADD0         ASQN
388700200616     C                     Z-ADD0         EVDT
388800200616     C                     Z-ADD0         EVAM
388900200616     C                     MOVEL*BLANKS   EVCY
389000200616     C                     Z-ADD0         STLT
389100200616     C                     MOVEL*BLANKS   STLA
389200200616     C                     MOVEL*BLANKS   SEBR                            S01117
389300200616     C                     MOVE '0'       RVRS
389400200616     C*
389500200616     C* NEED ISSUER FOR POSTING REF 4.                                    E19770
389600200616     C*
389700200616     C**********           Z-ADD0         ISSR                            E19770
389800200616     C*                                                                   E19770
389900200616     C*********************Z-ADD0         KCUST                           E19975
390000200616     C                     Z-ADD0         KNCA
390100200616     C                     MOVEL*BLANKS   KCCY
390200200616     C                     Z-ADD0         KBCA
390300200616     C                     MOVEL*BLANKS   SESH
390400200616     C                     MOVEL*BLANKS   PRFC                            S01117
390500200616     C*
390600200616     C                     ENDSR
390700200616     C*
390800200616     C*****************************************************************
390900200616      /EJECT
391000200616     C*****************************************************************
391100200616     C*                                                               *
391200200616     C*   SKDSR  - SUBROUTINE FOR ERROR HANDLING OF SEKEYD            *
391300200616     C*                                                               *
391400200616     C*****************************************************************
391500200616     C*
391600200616     C           SKDSR     BEGSR
391700200616     C*
391800200616     C           *LOCK     IN   LDA                                       S01117
391900200616     C                     MOVE 'SEKEY'   DBFILE
392000200616     C                     MOVELACKY      DBKEY            *****************
392100200616     C                     Z-ADD8         DBASE            ** DB ERROR 08 **
392200200616     C                     MOVE STSSKD    DBSTAT           *****************
392300200616     C                     OUT  LDA                                       S01117
392400200616     C                     MOVE '1'       *IN87
392500200616     C                     SETON                     99U7U8
392600200616     C                     EXSR *PSSR                                     S01117
392700200616     C                     GOTO EAUDIT
392800200616     C*
392900200616     C                     ENDSR
393000200616     C*
393100200616     C*****************************************************************
393200200616     C/SPACE 3
393300200616     C*****************************************************************
393400200616     C*                                                               *
393500200616     C*   SKASR  - SUBROUTINE FOR ERROR HANDLING OF SEKEYA            *
393600200616     C*                                                               *
393700200616     C*****************************************************************
393800200616     C*
393900200616     C           SKASR     BEGSR
394000200616     C*
394100200616     C           *LOCK     IN   LDA                                       S01117
394200200616     C                     MOVE 'SEKEY'   DBFILE
394300200616     C                     MOVEL'AUDIT'   DBKEY            *****************
394400200616     C                     Z-ADD9         DBASE            ** DB ERROR 09 **
394500200616     C                     MOVE STSSKA    DBSTAT           *****************
394600200616     C                     OUT  LDA                                       S01117
394700200616     C                     MOVE '1'       *IN87
394800200616     C                     SETON                     99U7U8
394900200616     C                     EXSR *PSSR                                     S01117
395000200616     C                     GOTO EAUDIT
395100200616     C*
395200200616     C                     ENDSR
395300200616     C*
395400200616     C*****************************************************************
395500200616      /SPACE 3
395600200616     C*****************************************************************   E14884
395700200616     C*                                                               *   E14884
395800200616     C*   POSSR  - SUBROUTINE FOR ERROR HANDLING OF POSET             *   E14884
395900200616     C*                                                               *   E14884
396000200616     C*****************************************************************   E14884
396100200616     C*                                                                   E14884
396200200616     C           POSSR     BEGSR                                          E14884
396300200616     C*                                                                   E14884
396400200616     C           *LOCK     IN   LDA                                       S01117
396500200616     C                     MOVE 'POSET'   DBFILE                          E14884
396600200616     C                     MOVELPSSH      DBKEY            ***************E14884
396700200616     C***********          Z-ADD10        DBASE   **DB*ERROR*10*   E14884 E20651
396800200616     C                     Z-ADD13        DBASE            * DB ERROR 13 *E20651
396900200616     C                     MOVE STSPOS    DBSTAT           ***************E14884
397000200616     C                     OUT  LDA                                       S01117
397100200616     C                     MOVE '1'       *IN87                           E14884
397200200616     C                     SETON                     99U7U8               E14884
397300200616     C                     EXSR *PSSR                                     S01117
397400200616     C                     GOTO EAUDIT                                    E14884
397500200616     C*                                                                   E14884
397600200616     C                     ENDSR                                          E14884
397700200616     C*                                                                   E14884
397800200616     C*                                                                   E14884
397900200616     C*****************************************************************   E14884
398000200616      /SPACE 3
398100200616     C*****************************************************************   E14884
398200200616     C*                                                               *   E14884
398300200616     C*   PAUSR  - SUBROUTINE FOR ERROR HANDLING OF POSETA AUDIT      *   E14884
398400200616     C*                                                               *   E14884
398500200616     C*****************************************************************   E14884
398600200616     C*                                                                   E14884
398700200616     C           PAUSR     BEGSR                                          E14884
398800200616     C*                                                                   E14884
398900200616     C           *LOCK     IN   LDA                                       S01117
399000200616     C                     MOVE 'POSET'   DBFILE                          E14884
399100200616     C                     MOVEL'AUDIT'   DBKEY            ***************E14884
399200200616     C                     Z-ADD11        DBASE            **DB ERROR 11**E14884
399300200616     C                     MOVE STSPAU    DBSTAT           ***************E14884
399400200616     C                     OUT  LDA                                       S01117
399500200616     C                     MOVE '1'       *IN87                           E14884
399600200616     C                     SETON                     99U7U8               E14884
399700200616     C                     EXSR *PSSR                                     S01117
399800200616     C                     GOTO EAUDIT                                    E14884
399900200616     C*                                                                   E14884
400000200616     C                     ENDSR                                          E14884
400100200616     C*                                                                   E14884
400200200616     C*****************************************************************   E14884
400300200616      /EJECT                                                                                  CGL020
400400200616      *****************************************************************                       CGL020
400500200616      *                                                               *                       CGL020
400600200616      * SRSFSA - Sets the Fee Fields for SA (Settlement Amount)       *                       CGL020
400700200616      *          Account Keys.                                        *                       CGL020
400800200616      *                                                               *                       CGL020
400900200616      *****************************************************************                       CGL020
401000200616     C           SRSFSA    BEGSR                                                              CGL020
401100200616      *                                                                                       CGL020
401200200616      ** Set the Fee Flag.                                                                    CGL020
401300200616      *                                                                                       CGL020
401400200616     C                     MOVE 'N'       F1FFLG                                              CGL020
401500200616      *                                                                                       CGL020
401600200616      ** Calculate the Fee Value.                                                             CGL020
401700200616      *                                                                                       CGL020
401800200616     C                     Z-ADD0         WFVAL  150                                          CGL020
401900200616     C                     ADD  PCHA      WFVAL                                               CGL020
402000200616     C                     ADD  PCAM      WFVAL                                               CGL020
402100200616     C                     Z-ADDWFVAL     F1FVAL                                              CGL020
402200200616      *                                                                                       CGL020
402300200616      ** Calculate the Fee Percent.                                                           CGL020
402400200616      *                                                                                       CGL020
402500200616     C                     Z-ADD0         WFPCT  308                                          CGL020
402600200616     C           PAMD      IFNE 0                                                             CGL020
402700200616     C           F1FVAL    DIV  PAMD      WFPCT                                               CGL020
402800200616     C                     MULT 100       WFPCT                                               CGL020
402900200616     C                     ENDIF                                                              CGL020
403000200616      *                                                                                       CGL020
403100200616     C                     Z-ADDWFPCT     F1FPCT                                              CGL020
403200200616      *                                                                                       CGL020
403300200616     C                     ENDSR                                                              CGL020
403400200616      *****************************************************************                       CGL020
403500200616      /EJECT                                                                                  CGL020
403600200616      *****************************************************************                       CGL020
403700200616      *                                                               *                       CGL020
403800200616      * SRPRSI - Handles the Pay/Receieve Settlement Instructions.    *                       CGL020
403900200616      *                                                               *                       CGL020
404000200616      *****************************************************************                       CGL020
404100200616     C           SRPRSI    BEGSR                                                              CGL020
404200200616      *                                                                                       CGL020
404300200616      ** If the Settlement Account is equal to blanks, clear the                              CGL020
404400200616      ** Settlement Instruction fields. Otherwise, call the                                   CGL020
404500200616      ** Securities Settlement Fields Extractor.                                              CGL020
404600200616      *                                                                                       CGL020
404700200616     C           STLA      IFEQ *BLANKS                                                       CGL020
404800200616      *                                                                                       CGL020
404900200616     C                     MOVE *BLANKS   F1RACT                                              CGL020
405000200616     C                     MOVE *BLANKS   F1RCTY                                              CGL020
405100200616     C                     MOVE *BLANKS   F1RBNK                                              CGL020
405200200616     C                     MOVE *BLANKS   F1RCDE                                              CGL020
405300200616     C                     MOVE *BLANKS   F1PACT                                              CGL020
405400200616     C                     MOVE *BLANKS   F1PCTY                                              CGL020
405500200616     C                     MOVE *BLANKS   F1PBNK                                              CGL020
405600200616     C                     MOVE *BLANKS   F1PCDE                                              CGL020
405700200616     C                     MOVE *BLANKS   F1DACT                                              CGL020
405800200616     C                     MOVE *BLANKS   F1DCTY                                              CGL020
405900200616     C                     MOVE *BLANKS   F1DBNK                                              CGL020
406000200616     C                     Z-ADD0         F1SDAT                                              CGL020
406100200616      *                                                                                       CGL020
406200200616     C                     ELSE                                                               CGL020
406300200616      *                                                                                       CGL020
406400200616      ** Set the ZAAMLSETSE parameters.                                                       CGL020
406500200616      *                                                                                       CGL020
406600200616     C                     EXSR SRSZIP                                                        CGL020
406700200616      *                                                                                       CGL020
406800200616      ** Execute the actual call.                                                             CGL020
406900200616      *                                                                                       CGL020
407000200616     C                     CALL SETSE                                                         CGL020
407100200616     C                     PARM           PINPT                                               CGL020
407200200616     C                     PARM           PINPA                                               CGL020
407300200616     C                     PARM           PACIN                                               CGL020
407400200616     C                     PARM           PACIA                                               CGL020
407500200616     C                     PARM           PBENM                                               CGL020
407600200616     C                     PARM           PBENA                                               CGL020
407700200616     C                     PARM           PDEBT  10                                           CSW210
407800200616     C                     PARM           PDEBTA 35                                           CSW210
407900200616     C                     PARM           PCTRP                                               CGL020
408000200616     C                     PARM           PFAC                                                CGL020
408100200616     C                     PARM           PSEA                                                CGL020
408200200616     C                     PARM           PSEB                                                CGL020
408300200616     C                     PARM           EVCY                                                CGL020
408400200616     C                     PARM           F1RACT                                              CGL020
408500200616     C                     PARM           F1RCTY                                              CGL020
408600200616     C                     PARM           F1RBNK                                              CGL020
408700200616     C                     PARM           F1RCDE                                              CGL020
408800200616     C                     PARM           F1PACT                                              CGL020
408900200616     C                     PARM           F1PCTY                                              CGL020
409000200616     C                     PARM           F1PBNK                                              CGL020
409100200616     C                     PARM           F1PCDE                                              CGL020
409200200616     C                     PARM           F1DACT                                              CGL020
409300200616     C                     PARM           F1DCTY                                              CGL020
409400200616     C                     PARM           F1DBNK                                              CGL020
409500200616      *                                                                                       CGL020
409600200616     C                     Z-ADDPDUD      F1SDAT                                              CGL020
409700200616      *                                                                                       CGL020
409800200616     C                     ENDIF                                                              CGL020
409900200616      *                                                                                       CGL020
410000200616     C                     MOVE *BLANKS   F1TICK                                              CGL020
410100200616     C                     MOVE *BLANKS   F1EXCH                                              CGL020
410200200616     C                     Z-ADD0         F1NOML                                              CGL020
410300200616      *                                                                                       CGL020
410400200616     C                     ENDSR                                                              CGL020
410500200616      *****************************************************************                       CGL020
410600200616      /EJECT                                                                                  CGL020
410700200616      *****************************************************************                       CGL020
410800200616      *                                                               *                       CGL020
410900200616      * SRSZIP - Sets the ZAAMLSETSE input parameters.                *                       CGL020
411000200616      *                                                               *                       CGL020
411100200616      *****************************************************************                       CGL020
411200200616     C           SRSZIP    BEGSR                                                              CGL020
411300200616      *                                                                                       CGL020
411400200616      ** Clear the initial input parameters.                                                  CGL020
411500200616      *                                                                                       CGL020
411600200616     C                     MOVE *BLANKS   PINPT  10                                           CGL020
411700200616     C                     MOVE *BLANKS   PINPA  35                                           CGL020
411800200616     C                     MOVE *BLANKS   PACIN  10                                           CGL020
411900200616     C                     MOVE *BLANKS   PACIA  35                                           CGL020
412000200616      *                                                                                       CGL020
412100200616      ** Set the POSETDY2 Key Fields.                                                         CGL020
412200200616      *                                                                                       CGL020
412300200616     C                     MOVE PBCA      KPBCA                                               CGL020
412400200616     C                     MOVE PSSH      KPSSH                                               CGL020
412500200616     C**********           Z-ADDPCPY      KPCPY                                        CGL020 CSD027
412600200616     C                     MOVE PCPY      KPCPY                                               CSD027
412700200616     C                     Z-ADDPDUD      KPDUD                                               CGL020
412800200616     C                     MOVE PEVT      KPEVT                                               CGL020
412900200616      *                                                                                       CGL020
413000200616      ** Search for Extended Settlements.                                                     CGL020
413100200616      *                                                                                       CGL020
413200200616     C           KPSTES    CHAINPOSETDY2             70                                       CGL020
413300200616      *                                                                                       CGL020
413400200616      ** Get the Account for Payment details if a record was found.                           CGL020
413500200616      *                                                                                       CGL020
413600200616     C           *IN70     IFEQ '0'                                                           CGL020
413700200616     C                     MOVE P2AFPN    PBENM  10                                           CGL020
413800200616     C                     MOVE P2AFPL    PBENA  35                                           CGL020
413900200616     C                     ELSE                                                               CGL020
414000200616     C                     MOVE *BLANKS   PBENM                                               CGL020
414100200616     C                     MOVE *BLANKS   PBENA                                               CGL020
414200200616     C                     ENDIF                                                              CGL020
414300200616      *                                                                                       CGL020
414400200616      ** Set the Counterparty parameter.                                                      CGL020
414500200616      *                                                                                       CGL020
414600200616     C**********           Z-ADDPCPY      PCTRP                                        CGL020 CSD027
414700200616     C                     MOVE PCPY      PCTRP                                               CSD027
414800200616      *                                                                                       CGL020
414900200616     C                     ENDSR                                                              CGL020
415000200616      *****************************************************************                       CGL020
415100200616      /EJECT
415200200616     C********************************************************************S01117
415300200616     C*                                                                   S01117
415400200616     C*   *PSSR SR.- DATABASE ERROR SUBROUTINE                            S01117
415500200616     C*                                                                   S01117
415600200616     C********************************************************************S01117
415700200616     C**                                                                  S01117
415800200616     C           *PSSR     BEGSR                           ** *PSSR SR ** S01117
415900200616     C**                                                                  S01117
416000200616     C           @RUN      IFEQ *BLANK                                    S01117
416100200616     C                     MOVE 'Y'       @RUN    1                       S01117
416200200616     C                     DUMP                                           S01117
416300200616     C                     END                                            S01117
416400200616     C**                                                                  S01117
416500200616     C                     ENDSR                                          S01117
416600200616     C**                                                                  S01117
416700200616     C********************************************************************S01117
416800200616     C/COPY WNCPYSRC,SE2300C016
416900200616     C/EJECT                                                              S01117
417000200616     C/COPY ZSRSRC,ZACCH                                                  088939
417100200616      /EJECT                                                              088939
417200200616     C/COPY ZSRSRC,ZCONVZ1
417300200616      /EJECT                                                              088939
417400200616     C/COPY ZSRSRC,ZFWDT                                                  088939
417500200616      /EJECT
417600200616AW   C/COPY ZSRSRC,ZHASHZ3
417700200616      /EJECT
417800200616     C/COPY ZSRSRC,ZICD2Z1
417900200616      /EJECT
418000200616     C/COPY ZSRSRC,ZICDSEZ1
418100200616      /EJECT
418200200616     C*COPY*ZSRSRC,ZSYSTMZ1***                                            S01117
418300200616      /EJECT
418400200616      ***
418500200616     C/COPY WNCPYSRC,SE2300C029
418600200616     C/COPY ZSRSRC,ZCCYCN                                                 183665
418700200616     C/COPY ZSRSRC,ZXRATEZ1                                                                   233710
418800200616     C/COPY ZSRSRC,ZCCYXR                                                                     233710
418900200616**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
4190002006160000001
4191002006160000010
4192002006160000100
4193002006160001000
4194002006160010000
4195002006160100000
4196002006161000000
419700200616**  CPY@
419800200616(c) Finastra International Limited 2001
