000100200610     H        1
000200200610      *****************************************************************
000300200610/*STD *  RPGBASE                                                      *
000400200610/*EXI *  TEXT('Midas SE Update depot posns and gen a/c keys')         *
000500200610      *C*PY*WN*PY*RC*SE2370C018                                           S01408
000600200610/*XBIA*: OVRDBF FILE(DPOSHI) TOFILE(DPOSH) SHARE(*NO)               : *
000700200610     F*****************************************************************
000800200610     F*                                                               *
000900200610     F*  Midas - Securities Trading Module                            *
001000200610     F*                                                               *
001100200610     F*  SE2370 - UPDATE DEPOT POSITIONS & GEN A/C KEYS/POSN SETTLMNT *
001200200610     F*                                                               *
001300200610     F*  Function: This program reads LF/DEPAC - Book Positions -     *
001400200610     F*   (COB)    Reverse Date which is based on 6 physical files    *
001500200610      *C*PY*WN*PY*RC*SE2370C019                                           S01408
001600200610     F*            for Actions on Trades, Settlements and Depot       *
001700200610     F*            Movements, by Branch/Depot/Security/Date.          *
001800200610     F*            Program calculates and updates Depot Positions     *
001900200610     F*            for Trade, Value and Settlement Dates based on     *
002000200610     F*            Backvalued and Current Actions.                    *
002100200610     F*            Also, generates Account Keys for Position Settle-  *
002200200610     F*            ments due now on changed positions and Adjustment  *
002300200610     F*            Account Keys and Position Settlements for Events   *
002400200610     F*            affected by Backvaluations.                        *
002500200610     F*            Produces the Daily Depot Movements Report.         *
002600200610     F*                                                               *
002700200610     F*  Called By: SEC0606C - Update Past and Current Depot          *
002800200610     F*                        Positions with the effect of Trades,   *
002900200610     F*                        Depot Movements and Trade Settlements  *
003000200610     F*                                                               *
003100200610     F*  Calls: ZACCRD - Calculate Interest - Depot Positions         *
003200200610     F*                                                               *
003300200610      *  (c) Finastra International Limited 2001                      *
003400200610     F*                                                               *
003401200616      *  Last Amend No. AR324886           Date 01JUN20               *
003500200616      *  PREV Amend No. 248698             Date 01Jun20               *
003600200616      *                 248184             Date 01Jun20               *
003700200610      *                 MD046248           Date 27Oct17               *
003800200610      *                 260331             Date 31Mar16               *
003900200610      *                 215959             Date 21Mar16               *
004000200610      *                 AR1067108          Date 11Dec12               *
004100200610      *                 AR1001183A         Date 20Nov12               *
004200200610      *                 251950A            Date 27Feb12               *
004300200610      *                 AR853119           Date 24Nov11               *
004400200610      *                 CSW210             Date 04May10               *
004500200610      * Bank Fusion Midas 1.4 Base -----------------------------------*
004600200610      * Midas Plus 1.4 Base 04 ---------------------------------------*
004700200610      * Midas Plus 1.4 Base ------------------------------------------*
004800200610      * Midas Plus 1.3 ----------- Base ------------------------------*
004900200610      *                 BUG11620           Date 27Jun06               *
005000200610      *                 CSD031             Date 10Apr06               *
005100200610      *                 236842             Date 07Nov05               *
005200200610      *                 CSD027             Date 09Dec05               *
005300200610      *                 CSE075             Date 06Mar06               *
005400200610      *                 BUG11198           Date 26Apr06               *
005500200610      *                 CSE075             Date 17Nov05               *
005600200610      *                 CSE071             Date 19Jul05               *
005700200610      *                 CSW037A            Date 02May05               *
005800200610      *                 BUG7985            Date 07Jul05               *
005900200610      *                 CSD025             Date 11Jan05               *
006000200610      *                 CSW037             Date 15Dec04               *
006100200610      *                 CSW036             Date 15Dec04               *
006200200610      *                 CLE025             Date 20Oct03               *
006300200610      *                 CGL029             Date 01Sep03               *
006400200610      *                 CAS006             Date 21Jan03               *
006500200610      *                 208241             Date 21Aug02               *
006600200610      *                 CSE037             Date 29Apr02               *
006700200610      *                 CSE035             Date 22Apr02               *
006800200610      *                 CGL020             Date 12Dec02               *
006900200610      *                 206316             Date 19Jul02               *
007000200610      * Midas Release 4.01.02 ----------------------------------------*
007100200610      *                 192467             Date 26Jul01               *
007200200610      *                 194195             Date 15Apr02               *
007300200610      * Midas Release 4.01 -------------------------------------------*
007400200610      *                 CSE034             Date 18Apr02               *
007500200610      *                 CSE031             Date 09Nov01               *
007600200610      *                 157260             Date 28Sep01               *
007700200610      *                 189514             Date 03Aug01               *
007800200610      * Midas Release 4 --------------- Base -------------------------*
007900200610      *                 CSE028             Date 06Jun01               *
008000200610      *                 127566             Date 09May01               *
008100200610      * Midas DBA 3.05 -----------------------------------------------*
008200200610      *                 189460             Date 26Mar01               *
008300200610      * Midas DBA 3.04 -----------------------------------------------*
008400200610      *                 CSE023             Date 31Aug00               *
008500200610      * Midas DBA 3.03 -----------------------------------------------*
008600200610      *                 175400             Date 05Jun00               *
008700200610      *                 162208             Date 04May00               *
008800200610     F*                 131379             Date 27MAR00               *
008900200610     F*                 147449             DATE 15Mar00               *
009000200610     F*                 152391             DATE 15Mar00               *
009100200610      * Midas DBA 3.02 -----------------------------------------------*
009200200610      *                 CSE017             Date 25Oct99               *
009300200610     F*                 CPB001             DATE 05Aug99               *
009400200610      * Midas DBA 3.00 ---------------- Base -------------------------*
009500200610     F*                 130862             Date 16Oct98               *
009600200610     F*                 147514             Date 20Nov98               *
009700200610     F*                 147869             Date 19NOV98               *
009800200610     F*                 143690             Date 05Oct98               *
009900200610     F*                 CEU017             Date 07Apr98               *
010000200610     F*                 CSE007             Date 17Mar98               *
010100200610     F*                 CEU005             Date 04Feb98               *
010200200610     F*                 S01408             Date 03Apr98               *
010300200610     F*                 095066             DATE 19FEB98               *
010400200610     F*                 112878             DATE 16FEB98               *
010500200610     F*                 CSE005             DATE 04FEB97               *
010600200610     F*                 100537             DATE 20MAR96               *
010700200610     F*                 CAC002             Date 15Sep96               *
010800200610     F*                 S01408             Date 27Sep96               *
010900200610     F*                 081366             DATE 26JUL96               *
011000200610     F*                 075530             DATE 29MAY96               *
011100200610     F*                 064754             DATE 29MAY96               *
011200200610     F*                 103017             DATE 09MAY96               *
011300200610     F*                 103011             DATE 09MAY96               *
011400200610     F*                 038963             DATE 01MAY96               *
011500200610     F*                 091254             DATE 20OCT95               *
011600200610     F*                 088423             DATE 16JUN95               *
011700200610     F*                 087712             DATE 15JUN95               *
011800200610     F*                 087178             DATE 15JUN95               *
011900200610     F*                 084669             DATE 06JUN95               *
012000200610     F*                 082248             DATE 27JAN95               *
012100200610     F*                 081765             DATE 17JAN95               *
012200200610     F*                 081439             DATE 10JAN95               *
012300200610     F*                 S01486             DATE 21NOV94               *
012400200610     F*                 S01496             DATE 07OCT94               *
012500200610     F*                 S01512             DATE 10AUG94               *
012600200610     F*                 S01510             DATE 10AUG94               *
012700200610     F*                 S01509             DATE 10AUG94               *
012800200610     F*                 065301             DATE 06MAY94               *
012900200610     F*                 066777             DATE 26FEB94               *
013000200610     F*                 048612             DATE 08FEB94               *
013100200610     F*                 S01447             DATE 08NOV93               *
013200200610     F*                 055420             DATE 26NOV93               *
013300200610     F*                 054257             DATE 26NOV93               *
013400200610     F*                 052254             DATE 26NOV93               *
013500200610     F*                 051107             DATE 26NOV93               *
013600200610     F*                 S01401             DATE 16JUN93               *
013700200610     F*                 S01397             DATE 10SEP92               *
013800200610     F*                 E37493             DATE 02APR92               *
013900200610     F*                 E34512             DATE 15JAN92               *
014000200610     F*                 E33014             DATE 14JAN92               *
014100200610     F*                 E33032             DATE 10DEC91               *
014200200610     F*                 E29170             DATE 25OCT91               *
014300200610     F*                 E29307             DATE 09OCT91               *
014400200610     F*                 S01117             DATE 24MAY91               *
014500200610     F*                 E24421             DATE 23JAN91               *
014600200610     F*                 E24420             DATE 23JAN91               *
014700200610     F*                 S01269             DATE 19JUN90               *
014800200610     F*                 E23169             DATE 01OCT90               *
014900200610     F*                 E21584             DATE 27JUN90               *
015000200610     F*                 E21573             DATE 27JUN90               *
015100200610     F*                 E21571             DATE 21JUN90               *
015200200610     F*                 E21669             DATE 20JUN90               *
015300200610     F*                 E21880             DATE 08JUN90               *
015400200610     F*                 E21603             DATE 07JUN90               *
015500200610     F*                 E21430             DATE 20MAR90               *
015600200610     F*                 E21303             DATE 06MAR90               *
015700200610     F*                 E21315             DATE 06MAR90               *
015800200610     F*                 E21213             DATE 26FEB90               *
015900200610     F*                 E20972             DATE 13FEB90               *
016000200610     F*                 E21111             DATE 12FEB90               *
016100200610     F*                 E19610             DATE 06DEC89               *
016200200610     F*                 E20568             DATE 09DEC89               *
016300200610     F*                 E20394             DATE 24NOV89               *
016400200610     F*                 E20151             DATE 09NOV89               *
016500200610     F*                 E19403             DATE 09NOV89               *
016600200610     F*                 E19430             DATE 09NOV89               *
016700200610     F*                 E19770             DATE 09NOV89               *
016800200610     F*                 E20086             DATE 07NOV89               *
016900200610     F*                 E19967             DATE 01NOV89               *
017000200610     F*                 E16085             DATE 24AUG89               *
017100200610     F*                 E18803             DATE 17AUG89               *
017200200610     F*                 E18221             DATE 15AUG89               *
017300200610     F*                 E16772             DATE 31/05/89              *
017400200610     F*                 E17268             DATE 02/03/89              *
017500200610     F*                 S01176             DATE 09/11/88              *
017600200610     F*                 E15283             DATE 19/10/88              *
017700200610     F*                 E15276             DATE 27/09/88              *
017800200610     F*                 E15549             DATE 05/10/88              *
017900200610     F*                 E15035             DATE 21/09/88              *
018000200610     F*                 E14739             DATE 16/09/88              *
018100200610     F*                 E14716             DATE 07/09/88              *
018200200610     F*                 E14753             DATE 05/09/88              *
018300200610     F*                 E14522             DATE 08/08/88              *
018400200610     F*                 E14209             DATE 27/07/88              *
018500200610     F*                 E14438             DATE 27/07/88              *
018600200610     F*                                                               *
018700200610     F*---------------------------------------------------------------*
018800200610     F*                                                               *
018801200616      *  AR324886 - Implement 4-eyes processing in Position           *
018802200616      *             Settlement Maintenance.                           *
018900200610      *  248698 - Rounding discrepancies on some SE reports. Applied  *
019000200610      *           fix 228682.                                         *
019100200610      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
019200200610      *  248184 - Wrong security withholding tax calculation.  If     *
019300200610      *           S01496, use 4 dec places for tax rate else use 2.   *
019400200610      *  MD046248 - Finastra Rebranding                               *
019500200610      *  260331 - Incorrect posting created due to a deleted diary    *
019600200610      *           event. Applied fix 255857.                          *
019700200610      *         - Applied for MD-37742.                               *
019800200610      *  215959 - Truncation error on event amount in SE2450P3.       *
019900200610      *           Recompiled due to changes in PF/SEKEYD.             *
020000200610      *         - Applied for MD-37439.                               *
020100200610      *  AR1067108 - PMC1140 Component failed during Clean COB        *
020200200610      *              Applied fix AR1001183A                           *
020300200610      *  AR1001183A - Coupon rate was still used in computation of    *
020400200610      *              interest instead of using the details in FRN tab *
020500200610      *              (Reopen) (Recompile)                             *
020600200610      *  251950A - Component SEC1112 0001 terminated abnormally.      *
020700200610      *            Check if PSEB is blank, if it is move value of     *
020800200610      *            PBCA to CCTA, if not move value of PSEB to CCTA.   *
020900200610      *          - Applied for AR964313 (Child:AR964316)              *
021000200610      *  AR853119 - Position settlements generated from corporate     *
021100200610      *             action did not calculate stamp tax.               *
021200200610      *  CSW210 - SWIFT 2010 Changes (Recompile)                      *
021300200610      *  BUG11620 - SEC1107 failed due to '000000' OUDP and PTCD      *
021400200610      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
021500200610     F*  236842 - Make sure that job switch set on if program fails   *
021600200610     F*           so that component will fail.                        *
021700200610      *  CSD027 - Conversion Of Customer Number to Alpha              *
021800200610      *  CSE075 - CSE075 Change Control. Display Coupon Delay period  *
021900200610      *           for all interest-bearing securities.                *
022000200610      *  BUG11198 - Incorrect due amount on position settlement.      *
022100200610      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
022200200610      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
022300200610      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
022400200610      *  BUG7985- Several components failed due to accessing TABLETR  *
022500200610      *  CSD025 - Customer De-Activation                              *
022600200610      *  CSW037 - Additional Field Data on MT300/MT320                *
022700200610      *  CSW036 - Dual SWIFT BIC held on Client Details               *
022800200610      *  CLE025 - Credit Lines (Recompile)                            *
022900200610      *  CGL029 - Increase Account Code to 10 digits                  *
023000200610      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
023100200610      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
023200200610      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
023300200610      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
023400200610     F*  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
023500200610     F*           Information (Recompile)                             *
023600200610      *  206316 - Recompiled over changed ZLCDZ1.                     *
023700200610      *  192467 - No maturity position settlement was generated.  Set *
023800200610      *           price for records with processing type '1' and      *
023900200610      *           price basis 'U'.                                    *
024000200610      *  194195 - Position settlements in base ccy incorrect when the *
024100200610      *           nominal ccy is an 'IN' ccy and settled in EUR via   *
024200200610      *           the standard settlement instructions (in STDSED).   *
024300200610      *  CSE034 - Standing Settlement Instruction improvements        *
024400200610      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
024500200610      *           (recompilation due to change to ZNCD/ZLCD)          *
024600200610      *  157260 - The system still generate position settlement on    *
024700200610      *           coupon date for securities with cancelled-authorise *
024800200610      *           trade eventhough position is zero. Amended program  *
024900200610      *           in such a way that system would not generate posi-  *
025000200610      *           tion settlement if depot position is zero.          *
025100200610      *  189514 - Maturity Depot Movement is not shown in report      *
025200200610      *           SE2370P1.  In processing the entries to be printed  *
025300200610      *           in report SE2370P1, include the Maturity Depot      *
025400200610      *           Movement.                                           *
025500200610      *  CSE028 - Standing Settlement Instructions Enhancement.       *
025600200610      *  127566 - Recompiled over changed ZSDESCZ3                    *
025700200610     F*  189460 - Report is sometimes printed with no page.           *
025800200610      *  CSE023 - Treaty Withholding Tax                              *
025900200610     F*  175400 - Security position settlements not picking up the    *
026000200610     F*           security standard settlements if the securit nominal*
026100200610     F*           currency is an 'in' currency and being settled in   *
026200200610     F*           EURO. Remove fix 147869 and fix it differently since*
026300200610     F*           it caused the above problem. Based on 170568.      *
026400200610     F*  162208 - Amended program to move the Market Indicator of     *
026500200610     F*           the security to PMAR field.                         *
026600200610     F*  131379 - Incorrect account key for primary market at maturity*
026700200610     F*  147449 - Mortgage Payment Position settlement amount not     *
026800200610     F*           having correct P/R Ind. when reversing out Position *
026900200610     F*           and the Mortgage Payment Amount entered (cf with    *
027000200610     F*           Mortgage Payment Current Factor)                    *
027100200610     F*  152391 - Ensure that Mortgage Payment FV key is same sign    *
027200200610     F*           as nominal before Split Negative processing.        *
027300200610      *  CSE017 - Cum/Ex Indicator on Depot Movements                 *
027400200610     F*  CPB001 - 'Private Banking' Module                            *
027500200610     F*  130862 - Recompiled over changed ZLCDZ1.                     *
027600200610     F*  147514 - Position settlement preparations are not taking     *
027700200610     F*           into account the Standard Settlement Instructions.  *
027800200610     F*           Apply fix 143851.  Use *IN88 when chaining to file  *
027900200610     F*           STDSED instead of *IN78 which is already in use.    *
028000200610     F*  147869 - Wrong settlement amount on accounting               *
028100200610     F*  143690 - Incorrect Mult/Div Ind. was being used when EURO    *
028200200610     F*           CCY was involved. Fix is to reverse the M/D ind. if *
028300200610     F*           Nominal CCY is equal to the EURO CCY.               *
028400200610     F*  CEU017 - Securities Redenomination Euro Changes              *
028500200610     F*           Just recompile                                      *
028600200610     F*  CSE007 - Corporate Actions - Just recompile                  *
028700200610     F*  CEU005 - EMU SE Settlement Ccy Conversion                    *
028800200610     F*  S01408 - Balancing of Hooks between DBAR2 and R10.6          *
028900200610     F*           SE2370C018 moved to match location in R10.6         *
029000200610     F*           SE2370C019 moved to match location in R10.6         *
029100200610     F*           SE2370C020 moved to match location in R10.6         *
029200200610     F*           SE2370C021 moved to match location in R10.6         *
029300200610     F*  095066 - Intro. of switchable feature to use the value date  *
029400200610     F*           position to calculate Dividend Payment.             *
029500200610     F*  112878 - When generate revesal position settlement record,   *
029600200610     F*           should not revese the sign of the nominal.          *
029700200610     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
029800200610     F*           (recompilation due to change to ZNCD/ZLCD)          *
029900200610     F*  100537 - Take current factor into account when calculating   *
030000200610     F*           maturity amount                                     *
030100200610     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
030200200610     F*           If Analytical Accounting is available, define the   *
030300200610     F*           profit centre for posting.                          *
030400200610     F*  S01408 - Addition of core hook SE2370FFP1                    *
030500200610     F*           Addition of core hook SE2370CCP3                    *
030600200610     F*           Addition of core hook SE2370CCP2                    *
030700200610     F*           Addition of core hook SE2370CCP1                    *
030800200610     F*  081366 - Check STDSED for deleted indicator and don't allow  *
030900200610     F*           it to corrupt POSETD record .                       *
031000200610     F*  075530 - Position settlement for adjusted maturity event :   *
031100200610     F*           check fields 'AKRI' and 'PSRI' to avoid write of    *
031200200610     F*           duplicate records.                                  *
031300200610     F*  064754 - Back-valuation on coupon or dividend event          *
031400200610     F*           do not produce adjustment position settlement       *
031500200610     F*  103017 - Set RECI to 'D' when writing position settlement rec*
031600200610     F*  103011 - The system creates a position settlement MT* for    *
031700200610     F*           warrant which can lead to confusion for cashflow    *
031800200610     F*  038963 - DEXN MUST BE 0 FOR A SCHULDSCHEIN.                  *
031900200610     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
032000200610     F*  088423 - If S01512 is on, event date should no longer be     *
032100200610     F*           payment date                                        *
032200200610     F*  087712 - Percentage price-based shares have dividend amount  *
032300200610     F*           calculated 100 times too much                       *
032400200610     F*  087178 - Settlement amount has to include charges, commis-   *
032500200610     F*           sions and taxes added to or deducted from amount due*
032600200610     F*  084669 - Setup settlement amount                             *
032700200610     F*           If no standard settlement method defined, settlement*
032800200610     F*           branch must be equal to booking branch              *
032900200610     F*  082248 - Incorrect security used on READ operation causing   *
033000200610     F*           incorrect records to be generated on position       *
033100200610     F*           settlements file                                    *
033200200610     F*  081765 - Generation of invalid Portfolio records on POSETD   *
033300200610     F*  081439 - Wrong update of field tax rate - Recompile          *
033400200610     F*  S01486 - Incorporation of PM Enhancements (B07901)           *
033500200610     F*  S01496 - Incorporation of Jyske Enhancements (S10982).       *
033600200610     F*           Just recompilation.                                 *
033700200610     F*  S01512 - Add Value Date to Position Settlements              *
033800200610     F*  S01510 - Dividend Payments based on Ex-date                  *
033900200610     F*  S01509 - Value Currency to be currency of Issuer of Payments *
034000200610     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
034100200610     F*           with ZAMT increased to 15,0.                        *
034200200610     F*  066777 - Output Last Change Date on new POSETD records.      *
034300200610     F*  048612 - Clear settlement method field before accessing stan-*
034400200610     F*           dard settlements file so that if no record is found,*
034500200610     F*           the value from a previous transaction is not used.  *
034600200610     F*  S01447 - Withholding Tax.                                    *
034700200610     F*           Calculates withholding tax which are written to     *
034800200610     F*           new fields on position settlements file.            *
034900200610     F*  055420 - ROUNDING PROBLEM FOR MORTGAGE BACKED SECURITIES.    *
035000200610     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
035100200610     F*           to 10,9                                             *
035200200610     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
035300200610     F*  051107 - Program ignores Events BEFORE first Action Date. It *
035400200610     F*           should ALSO ignore Events ON the first Action Date  *
035500200610     F*           as they will not be affected, (eg. Coupon).         *
035600200610     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
035700200610     F*           - Position Settlement Message Indicator set to 'Y'  *
035800200610     F*             when Settlement Authorised by System.             *
035900200610     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
036000200610     F*           - Recompiled due to changes to files.               *
036100200610     F*  E37493 - Recompiled over changed printer file                *
036200200610     F*  E34512 - Ex-coupon nominal still not reset crossing a coupon *
036300200610     F*           date, when backvaluation done.                      *
036400200610     F*  E33014 - 'RI' type depot movements are shown on report as    *
036500200610     F*           movements out of the depot (E20511 fails to fix     *
036600200610     F*           this under all circumstances)                       *
036700200610     F*  E33032 - Outputting wrong branch field to POSETD             *
036800200610     F*  E29170 - Report Control Facility changes                     *
036900200610     F*  E29307 - Ex-coupon nominal on positions not always reset when*
037000200610     F*           a position is created that crosses a coupon date    *
037100200610     F*  S01117 - Multi branching                                     *
037200200610     F*  E24421 - Some processing still using value date instead of   *
037300200610     F*           Trade date for Shares                               *
037400200610     F*  E24420 - Corruption of positions if backvaluation to a time  *
037500200610     F*           before earliest position                            *
037600200610     F*  S01269 - Trade Authorisation                                 *
037700200610     F*  E23169 - Settlement exchange rate should be equal to         *
037800200610     F*           exchange rate, (not spot rate), from SECTYD.        *
037900200610     F*           Changed processing to use ZCNCD for accuracy        *
038000200610     F*  E21584 - When accessing Standard Settlements, first look for *
038100200610     F*           a record with appropriate Investment Type; then, if *
038200200610     F*           no such record exists, try again with ITSI blank.   *
038300200610     F*  E21573 - Coupon at Maturity is now produced separately and   *
038400200610     F*           requires a Position Settlement to be generated from *
038500200610     F*           the Coupon Action.                                  *
038600200610     F*  E21571 - Wrong branch name on report SE2370P1.               *
038700200610     F*  E21669 - No Coupon Key was being generated for Backvalued    *
038800200610     F*           Actions when Coupon Due Date had passed, causing    *
038900200610     F*           Accounts OOB. Due to passing wrong Last Coupon Date *
039000200610     F*  E21880 - Need to save RECI of DPOSH Record as Chain to SECTY *
039100200610     F*           corrupts it.                                        *
039200200610     F*  E21603 - Partly paid position settlement errors              *
039300200610     F*  E21430 - MUST KNOW WHETHER SECURITY IS A SHARE OR NOT SO     *
039400200610     F*           MUST ACCESS SECTY AND INVTP ON CHANGE OF SECURITY.  *
039500200610     F*           ALSO FOR PORTFOLIO TRADE ACTIONS ON DIVIDEN POSITION*
039600200610     F*           CALCULATE USING TRADE DATE POSITIONS                *
039700200610     F*  E21303 - FOR SHARES USE TRADE DATE EX-DIVIDEND NOMINAL TO    *
039800200610     F*           UPDATE THE POSITIONS                                *
039900200610     F*  E21315 - ONLY THE FIRST SECURITY PER DEPOT PRINTS THE NAME   *
040000200610     F*           AS TITLE.                                           *
040100200610     F*  E21213 - RECOMPILED OVER CHANGED PRINTER FILE.               *
040200200610     F*  E20511 - DEPOT MOVEMENTS FOR ALL 'REPO' TYPE ACTIONS ARE     *
040300200610     F*           PRINTED WITH A NEGATIVE SIGN IN REPORT SE2370P1.    *
040400200610     F*  E20972 - DIVIDEND DUE AMOUNT BEING TRUNCATED.USE SUBROUTINE  *
040500200610     F*           ZCNSD TO CALCULATE DIVIDEND DUE.                    *
040600200610     F*  E21111 - ERROR FIX S01176 APPLIED TO PRINTER FILE ALSO       *
040700200610     F*           REQUIRES CHANGES IN ORDER OF PR01 SUBROUTINE        *
040800200610     F*           AS DEPOT AND DEPOT REF. DO NOT REFER TO SECURITY    *
040900200610     F*           SHOWN.                                              *
041000200610     F*  E19610 - For Shares/Equities use the Trade Date instead of   *
041100200610     F*           Value Date to calculate the Dividend Due.           *
041200200610     F*  E20568 - ZACCZ changed to read non-diary events file -       *
041300200610     F*           renamed record format of SECEO.                     *
041400200610     F*  E20394 - Loop caused by E19403 if date is equal, keeps       *
041500200610     F*           chaining and reading equal.                         *
041600200610     F*  E20151 - Amount due at maturity inflated by factor of 100    *
041700200610     F*           for a Yen instrument.                               *
041800200610     F*  E19403 - Loop caused by both program and ZACCRD accessing    *
041900200610     F*           DPOSH and resetting the file pointer.               *
042000200610     F*  E19430 - At maturity, generate separate position settlements *
042100200610     F*           for interest and principal; except for Coupon       *
042200200610     F*           events (handled automatically).                     *
042300200610     F*  E19770 - TO PRODUCE THE FOLLOWING A/C KEYS:-                 *
042400200610     F*           1) IIIR_X______MVN___FV  (MORTGAGE REPAYMENT)       *
042500200610     F*           2) IIIM_X______MVN___CV  (MATURITY)                 *
042600200610     F*  E20086 - Mortgage-Backs and Current Factor Processing Rewrite*
042700200610     F*           - Rewrite of SR/MORTPY.                             *
042800200610     F*           - Coupon is produced separately - do not include it *
042900200610     F*             in the MP Amount.                                 *
043000200610     F*           - Current Factor is 9,8 not 11,8 and should default *
043100200610     F*             to 1 not 100.                                     *
043200200610     F*           - No need to chain to the Diary twice, just rename  *
043300200610     F*             the fields on one of the Diary records.           *
043400200610     F*           - Amount calculation simplified.                    *
043500200610     F*           - Rename NMCY on SEDEVDF for program use.           *
043600200610     F*           - Do not need dozens of work variables.             *
043700200610     F*  E19967 - RECOMPILED FOR CHANGE TO PRINTER FILE FOR TRADES    *
043800200610     F*           WITH PORTFOLIO CUSTOMERS MISSING TRADE REF.         *
043900200610     F*  E16085 - TO RESET INVESTMENT TYPE IF DEPOT IS CEDEL AND      *
044000200610     F*           CUSTOMER NOT A MARKET CLIENT.                       *
044100200610     F*           TO SUPPRESS BOOK CODE IN ACCOUNT KEYS FOR CHARGES   *
044200200610     F*           AND COMMISSIONS.                                    *
044300200610     F*  E18803 - SET ACCOUNT KEY SEQUENCE NO. TO ZERO TO ALLOW FOR   *
044400200610     F*           MULTI-BRANCH SYSTEMS.                               *
044500200610     F*  E18221 - BLANK CHTP FIELD CAUSING OVERPRINTING IN POS.       *
044600200610     F*           SETTL. AUDIT LIST.                                  *
044700200610     F*  E16772 - The Dividend Payment Amount field SDDV has been     *
044800200610     F*           replaced by the field SDVA, to increase its size    *
044900200610     F*           from 9,4 to 13,8                                    *
045000200610     F*  E17268 - RECOMPILE AS OBJECT IS MISSING FROM ABS REL 1.      *
045100200610     F*  S01176 - ST3.1                                               *
045200200610     F*  E15283 - PREVENT OVERFLOW ERROR                              *
045300200610     F*  E15276 - RECOMPILE OVER CHANGED SE2370P1 DISPLAY FILE.       *
045400200610     F*  E15549 - FIXES CONNECTED WITH REDELIVERY OF POSITION         *
045500200610     F*           SETTLEMENT PROGRAMS FROM CD.                        *
045600200610     F*           1.INCLUDE SECURITY NON-DIARY EVENTS IN EVENTS       *
045700200610     F*             PROCESSING BETWEEN POSITION CHANGE DATES          *
045800200610     F*           2.FOR SECURITY EVENTS DUE TODAY,DO NOT PROCESS IN   *
045900200610     F*             THIS PROGRAM.(SE2390 WILL DO THOSE)               *
046000200610     F*           3.PROCESS ADJUSTMENTS TO POSITION SETTLEMENTS UP TO *
046100200610     F*             EVENT CONTROL DATE.                               *
046200200610     F*           4.ZEROIZE EX-COUPON NOMINAL IF COUPON DATE CROSSED. *
046300200610     F*  E15035 - AUDIT FILES DO NOT HAVE 'RECI' FIELD. CHECK FOR     *
046400200610     F*           RECI = * IS THEREFORE SUPERFLUOUS AND CAN LEAD      *
046500200610     F*           TO DB ERROR 04                                      *
046600200610     F*  E14739 - PRINT BOND LENDING & BORROWING OPEN/CLOSE BALANCES  *
046700200610     F*  E14716 - EVENT CODE 'MA' CHANGED TO 'MT'                     *
046800200610     F*  E14753 - PORTFOLIO CUSTOMER TRADE ACTIONS INCLUDED           *
046900200610     F*  E14522 - TEST CONVERTIBLE INDICATOR (POSN 14 IN ACCOUNT      *
047000200610     F*           KEY) CORRECTLY.                                     *
047100200610     F*  E14209 - BOND LENDING & BORROWING MOVEMENTS NOT PRINTED.     *
047200200610     F*  E14438 - RECOMPILE PROGRAM FOR EUCLID INCORPORATION AND      *
047300200610     F*           UPGRADING OF FILES.                                 *
047400200610     F*                                                               *
047500200610     F*****************************************************************
047600200610     F*
047700200610     FTRDACA  IF  E                    DISK
047800200610     FSETACA  IF  E                    DISK
047900200610     FUDPMVA  IF  E                    DISK
048000200610     FCDPMVA  IF  E                    DISK
048100200610     FDPOSNA  UF  E                    DISK         KINFDS DPOADS
048200200610     F                                              KINFSR DPOASR
048300200610     FPOSETA  O   E                    DISK         KINFDS POSADS
048400200610     F                                              KINFSR POSASR
048500200610     FSEKEYA  O   E                    DISK         KINFDS SEKADS
048600200610     F                                              KINFSR SEKASR
048700200610     FTABSE   IF  E           K        DISK
048800200610     F* ICD 1     TABTB10F                          KIGNORE
048900200610     F* ICD 2     TABTB11F                          KIGNORE
049000200610     F* TAB36     TABTB36F                          KIGNORE
049100200610     F            TABTB40F                          KIGNORE
049200200610     F* CCY       TABTG10F                          KIGNORE
049300200610     F            TABTG20F                          KIGNORE
049400200610     F            TABLETHF                          KIGNORE
049500200610     F*********** TABLETJF                          KIGNORE               S01117
049600200610     F            TABLETLF                          KIGNORE
049700200610     F* BR NAME   TABLETRF                          KIGNORE
049800200610     F            TABLETXF                          KIGNORE
049900200610     F            TABLET2F                          KIGNORE
050000200610     F            TABLET3F                          KIGNORE
050100200610     F            TABLET5F                          KIGNORE
050200200610     F            TABTE10F                          KIGNORE
050300200610     F            TABLETNF                          KIGNORE
050400200610     F            TABLETKF                          KIGNORE
050500200610     F            TABLETPF                          KIGNORE
050600200610     F            TABLETAF                          KIGNORE
050700200610     F            TABTE20F                          KIGNORE
050800200610     FSE2370AUO   E                    PRINTER
050900200610     F                                              KINFDS SPOOLU         E29170
051000200610     FSE2370P1O   E                    PRINTER                        UC
051100200610     F                                              KINFDS SPOOL          E29170
051200200610     FCLINT   IF  E           K        DISK
051300200610     F            CLINTCAF                          KIGNORE
051400200610     F            CLINTCCF                          KIGNORE
051500200610     F            CLINTC1F                          KIGNORE
051600200610     F*********** CLINTSEF                          KIGNORE               E16085
051700200610     FSECED   IF  E           K        DISK
051800200610     F***SECET***IF  E           K        DISK                            E20086
051900200610     F*********** SEDEVDF                           KRENAMESEDETD         E20086
052000200610     FSECEO   IF  E           K        DISK                               E20086
052100200610     F*********** SNDEVDF                           KIGNORE         E20086E20568
052200200610     F            SNDEVDF                           KRENAMESNDEVDO        E20568
052300200610     F            SEDEVDF                           KRENAMESEDEVDO        E20086
052400200610     FSECACE  IF  E           K        DISK                               E15549
052500200610     FSECTY   IF  E           K        DISK
052600200610     FSESWHTL0IF  E           K        DISK                               S01447
052700200610     F* Securities WHT details file                                       S01447
052800200610     FINVTP   IF  E           K        DISK
052900200610     FSTDSED  IF  E           K        DISK
053000200610     FSEDEVL1 IF  E           K        DISK                               S01510
053100200610     F            SEDEVDF                           KRENAMESEDEVD1        S01510
053200200610     FSEKEYD  O   E           K        DISK         KINFDS SEKDDS
053300200610     F                                              KINFSR SEKDSR
053400200610     FPOSETD  O   E           K        DISK         KINFDS POSDDS
053500200610     F                                              KINFSR POSDSR
053501200616     FPSAUTD  O   E           K        DISK                                                 AR324886
053502200616      ** SE Position Settlement Authorisation detail                                        AR324886
053503200616      *                                                                                     AR324886
053600200610     FSDCUSQL0IF  E           K        DISK                                                 AR853119
053700200610      **  Midas SD Stamp Tax Customer Extension file                                        AR853119
053800200610     FPOSETDX3O   E           K        DISK         KINFSR *PSSR                            AR853119
053900200610      ***  Position Settlements - Extension File                                            AR853119
054000200610      *                                                                                     AR853119
054100200610     FDEPAC   IF  E           K        DISK
054200200610     FDPOSHI  IF  E           K        DISK
054300200610     F            DPOSNDF                           KRENAMEDPOSNI
054400200610     FDPOSH   UF  E           K        DISK         KINFDS DPOHDSA
054500200610     F                                              KINFSR DPOHSR
054600200610     F*                                                                   S01408
054700200610     F/COPY WNCPYSRC,SE2370FFP1                                           S01408
054800200610     F*                                                                   S01408
054900200610      /EJECT
055000200610     F*****************************************************************
055100200610     F*                                                               *
055200200610     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
055300200610     F*                                                               *
055400200610     F*   01 - DEPOT MOVEMENT ACTION RECORD READ IN                   *
055500200610     F*   02 - SETTLEMENT ACTION RECORD READ IN                       *
055600200610     F*   03 - TRADE ACTION RECORD READ IN                            *
055700200610     F*   04 - CUSTOMER DEPOT MOVEMENT ACTION RECORD READ IN          *
055800200610     F*   05 - PORTFOLIO TRADE ACTION RECORD READ IN                  *   E14753
055900200610     F*   06 - PORTFOLIO TRADE SETTLEMENT ACTION RECORD READ IN       *   E14753
056000200610     F*   29 - PRINT DIFFERENCE MESSAGE DEPOT MVMNTS AUDIT & COUNT    *
056100200610     F*   30 - PRINT DIFFERENCE MESSAGE CUST. MVMNTS AUDIT & COUNT    *
056200200610     F*   31 - PRINTER CONTROL - REQUEST SUBR PR01 TO PRINT OPBAL     *
056300200610     F*   32 - PRINTER CONTROL - REQUEST SUBR PR01 TO PRINT ADJ.DUE   *
056400200610     F*   33 - PRINTER CONTROL - REQUEST SUBR PR01 TO PRINT ACTIONS   *
056500200610     F*   34 - PRINTER CONTROL - REQUEST SUBR PR01 TO PRINT CLOBAL    *
056600200610     F*   37 - MULTIBRANCHING ON                                      *   E29170
056700200610     F*   52 - PRINTER CONTROL - REQUEST SUBR PR01 TO PRINT ADJ.DUE   *   E14739
056800200610     F*   53 - PRINTER CONTROL - PRINT ('S FOR REPO ACTIONS           *   E14739
056900200610     F*   65 - FOR PRINT,TEST IF POSN UP OR DOWN,PRINT NEG- IF DOWN   *
057000200610     F*   68 - SE2370P1 PRINT FILE IS OPEN WHEN 68 IS ON .            *
057100200610     F*   77 - END OF FILE ON READE OR RECORD EXISTS ON SETLL         *
057200200610     F*   79 - GENERAL DATA BASE ERROR/RECORD NOT FOUND/DELETED       *
057300200610     F*   80 - SECURITY WHT DETAILS FILE CHAINED TO                   *   S01447
057400200610     F*   87 - EXCEPTION ERROR ON UPDATED FILE - PRINTS STATUS/AUDIT  *
057500200610     F*   88 - Chain indicator for STDSED                             *   147514
057600200610     F*   89 - END OF FILE ON DEPOT ACTIONS FILE                      *
057700200610     F*                                                               *
057800200610     F*90-99 - USED IN Z SUBROUTINES                                  *
057900200610     F*                                                               *
058000200610     F*   U7 - DATABASE ERROR                                         *
058100200610     F*   U8 - DATABASE ERROR                                         *
058200200610     F*                                                               *
058300200610     F*****************************************************************
058400200610      /EJECT
058500200610     F*****************************************************************
058600200610     F*                                                               *
058700200610     F*  S U B R O U T I N E   I N D E X                              *
058800200610     F*                                                               *
058900200610     F*  FIRST -  ACCESSES ICD INFORMATION                            *
059000200610     F*  CH01  -  CHANGE OF POSITION ON INPUT RECORDS - UPDATE FOR    *
059100200610     F*           LAST DATE READ AND ANY SUCCEEDING DATES FOR         *
059200200610     F*           POSITION UPTO END OF DATES FOR THIS POSITION.       *
059300200610     F*  CH02  -  CHANGE OF DATE ON INPUT RECORDS - UPDATE FOR LAST   *
059400200610     F*           DATE READ AND ANY SUCCEEDING DATES FOR POSITION UPTO*
059500200610     F*           NEW DATE READ IN.                                   *
059600200610     F*  NW01   - NEW POSITION READ IN - GET NEWEST DATE FOR THIS     *
059700200610     F*           POSITION AND THEN ESTABLISH LATEST DATE HELD FOR THE*
059800200610     F*           NEW DATE READ IN.(I.E. BALANCE AS AT DATE READ IN)  *
059900200610     F*  NW02  -  NEW DATE FOR POSITION BEING PROCESSED IS READ IN -  *
060000200610     F*           ESTABLISH LATEST DATE HELD FOR THIS                 *
060100200610     F*           NEW DATE READ IN.(I.E. BALANCE AS AT DATE READ IN)  *
060200200610     F*  U01   -  UPDATE POSITIONS WITH ACTIONS ON THIS DATE FOR EACH *
060300200610     F*           EXISTING POSITION DATE WITH ACTIONS-CHG OF DATE     *
060400200610     F*  U02   -  UPDATE POSITIONS WITH ACTIONS ON THIS DATE FOR EACH *
060500200610     F*           EXISTING POSITION DATE WITH ACTIONS-CHG OF POSITION *
060600200610     F*  W01   -  WRITE A NEW POSITION RECORD                         *
060700200610     F*  PR01  -  WRITE PRINT REPORT OF DEPOT MOVEMENTS               *
060800200610     F*  #LEXDV-  PROCESS DIVIDEND PAYMENTS BASED ON EX-DATE          *   S01510
060900200610     F*  ACCUM -  ACCUMULATES VALUES OF ACTIONS FOR A DATE            *
061000200610     F*  CLRUPD - ZEROISE DEPOT POSN RECORD FIELDS                    *
061100200610     F*  NOPOSN - NO EXISTING DEPOT POSITION,INITIALISE FIELDS        *
061200200610     F*  CHGPOS - UPDATE DEPOT POSN RECORDS FROM LAST DATE UPDATED    *
061300200610     F*           TO MOST RECENT.                                     *
061400200610     F*  GETDEP - OBTAIN LATEST CORRECT DEPOT POSITION DATE           *
061500200610     F*  DIVIND - PRODUCE DIVIDEND A/C KEY &/OR POSITION SETTLEMENT   *
061600200610     F*  COUPON - PRODUCE COUPON A/C KEY &/OR POSITION SETTLEMENT     *
061700200610     F*  PARTPY - PRODUCE PART PAYMENT POSITION SETTLEMENT            *
061800200610     F*  MORTPY - PRODUCE MORTGAGE PAYMENT POSITION SETTLEMENT        *
061900200610     F*  MATURE - PRODUCE MATURITY POSITION SETTLEMENT                *
062000200610     F*  NEXT   - GET DATE OF NEXT INTERVENING POSITION USING DPOSHI  *
062100200610     F*  W03    - WRITE ACCOUNT KEY                                   *
062200200610     F*  W02    - WRITE POSITION SETTLEMENT                           *
062300200610     F*  CALCTX - Calculate tax amounts for dividends/Coupons         *   S01447
062400200610     F*  SECTIN - GET SECURITY DETAIL RECORD IN                       *
062500200610     F*  INVTIN - GET INVESTMENT TYPE DETAIL RECORD IN                *
062600200610     F*  SECEDI - GET SECURITY EVENTS DETAIL RECORD IN                *
062700200610     F*  TG10   - GET TABTG10 RECORD FOR EACH CURRENCY AS REQUIRED    *
062800200610     F*  AUDIT  - OUTPUTS AUDIT RECORD DPOSNA AND CONTROL REPORT      *
062900200610     F*  RCFP1  - SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF      *   E29170
063000200610     F*  RCFAU  - SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF      *   E29170
063100200610     F*                                                               *
063200200610     F*  DPOASR - ERROR HANDLING FOR DPOSNA                           *
063300200610     F*  DPOHSR - ERROR HANDLING FOR DPOSH                            *
063400200610     F*  SEKDSR - ERROR HANDLING FOR SEKEYD                           *
063500200610     F*  SEKASR - ERROR HANDLING FOR SEKEYA                           *
063600200610     F*  POSDSR - ERROR HANDLING FOR POSETD                           *
063700200610     F*  POSASR - ERROR HANDLING FOR POSETA                           *
063800200610     F*                                                               *
063900200610     F*  ZACCH  - ACCESS RECORD FOR HOLIDAYS FILE                     *   S01512
064000200610     F*  ZFWDT  - FIND WORKING DAYS FORWARD                           *   S01512
064100200610     F*  ZHASH  - HASH TOTALLING STD SUBROUTINE                       *
064200200610     F*  ZICD2  - OBTAINS ICD2                                        *
064300200610     F*  ZSYSTM - OBTAINS ICD1                                        *
064400200610     F***ZXRATE*-*CROSS*REF*EXCHANGE*RATE*CALCULATED*******************   E23169
064500200610     F*                                                               *
064600200610     F*  ZACCRD - CALCULATE ACCRUED INTEREST ** PROGRAM CALL **       *
064700200610     F*  *PSSR  - EXCEPTION ERROR ROUTINE                             *   S01117
064800200610     F*                                                               *
064900200610     F*****************************************************************
065000200610      /EJECT
065100200610     F/COPY WNCPYSRC,SE2370F001
065200200610     E                    CPY@    1   1 80
065300200610     E/COPY ZSRSRC,ZPOWER8Z1
065400200610     E/COPY ZSRSRC,ZPOWERZ1                                               S01509
065500200610     E/COPY ZSRSRC,ZDATE2Z1
065600200610     E/COPY ZSRSRC,ZHASHZ1
065700200610     E/COPY ZSRSRC,ZSDESCZ1
065800200610     E/COPY ZSRSRC,ZSEDITZ1
065900200610     E/COPY ZSRSRC,ZNCDZ1                                                 E29307
066000200610     E/COPY ZSRSRC,ZHOLE                                                  S01512
066100200610     E/COPY WNCPYSRC,SE2370E001
066200200610      /EJECT
066300200610     I*
066400200610     I* USER DEPOT ACTIONS RECORD FORMATS       -    LF/UDPAC
066500200610     I*
066600200610     IUDPMVDF     01
066700200610     I*
066800200610     I* USER DEPOT MOVEMENTS RECORD - ID 01
066900200610     I*
067000200610     ISETACDF     02
067100200610     I*
067200200610     I* SETTLEMENTS ACTION   RECORD - ID 02
067300200610     I*
067400200610     ITRDACDF     03
067500200610     I              PTFR                            RPTFR                 S01486
067600200610     I*
067700200610     I* TRADE ACTION         RECORD - ID 03
067800200610     I*
067900200610     ICDPMVDF     04
068000200610     I              PTFR                            RPTFR                 S01486
068100200610     I*
068200200610     I* CUSTOMER DEPOT MOVEMENTS RECORD - ID 04
068300200610     I*                                                                   E14753
068400200610     IPTRDADF     05                                                      E14753
068500200610     I*                                                                   E14753
068600200610     I* PORTFOLIO TRADE ACTION RECORD - ID 05                             E14753
068700200610     I*                                                                   E14753
068800200610     IPSETADF     06                                                      E14753
068900200610     I*                                                                   E14753
069000200610     I* PORTFOLIO TRADE SETTLEMENT ACTION RECORD - ID 06                  E14753
069100200610     I*
069200200610     IDPOSNI
069300200610     I*
069400200610     I* DEPOT POSITIONS FILE - NEXT POSITION    LF/DPOSH RENAMED DPOSHI
069500200610     I*
069600200610     I              RECI                            XRECI
069700200610     I***********   DSBR                            XDSBR                 S01117
069800200610     I              DSBA                            XDSBA                 S01117
069900200610     I              DSSC                            XDSSC
070000200610     I              DDPT                            XDDPT
070100200610     I              DSNV                            XDSNV
070200200610     I              DSNT                            XDSNT
070300200610     I              DSNS                            XDSNS
070400200610     I              DEXN                            XDEXN
070500200610     I              DDTE                            XDDTE
070600200610     I              DSRT                            XDSRT
070700200610     I              DSRV                            XDSRV
070800200610     I              DSCT                            XDSCT
070900200610     I              DSCV                            XDSCV
071000200610     ISEDEVDF                                                             E20086
071100200610     I              NMCY                            SNMCY                 E20086
071200200610     ISNDEVDF                                                             E15549
071300200610     I              SNSN                            SDSN                  E15549
071400200610     I              SNDT                            SDED                  E15549
071500200610     I              SNET                            SDET                  E15549
071600200610     ISEDEVDO                                                             E20086
071700200610     I*
071800200610     I***  Rename of fields for Security Diary (by Reverse Date).         E20086
071900200610     I*
072000200610     I              RECI                            SORECI                E20086
072100200610     I              SDSN                            SOSDSN                E20086
072200200610     I              SDED                            SOSDED                E20086
072300200610     I              SDET                            SOSDET                E20086
072400200610     I              SDNV                            SOSDNV                E20086
072500200610     I              SDVA                            SOSDVA                E20086
072600200610     I              SDCP                            SOSDCP                E20086
072700200610     I              SRPT                            SOSRPT                E20086
072800200610     I              SDTR                            SOSDTR                E20086
072900200610     I              SRMI                            SOSRMI                E20086
073000200610     I              SDPD                            SOSDPD                E20086
073100200610     I              SDNC                            SOSDNC                E20086
073200200610     I              SDPP                            SOSDPP                E20086
073300200610     I              SDPC                            SOSDPC                E20086
073400200610     I              SDTA                            SOSDTA                E20086
073500200610     I              SDTP                            SOSDTP                E20086
073600200610     I              SDRP                            SOSDRP                E20086
073700200610     I              SDCV                            SOSDCV                E20086
073800200610     I              SDCX                            SOSDCX                E20086
073900200610     I              SDCE                            SOSDCE                E20086
074000200610     I              SDMD                            SOSDMD                E20086
074100200610     I              NMCY                            SONMCY                E20086
074200200610     I              SDAD                            SOSDAD                E20086
074300200610     I              SDDT                            SOSDDT                E20086
074400200610      *                                                                                       CSE037
074500200610     IINVTPDF                                                                                 CSE037
074600200610     I              SFLG                            ISFLG                                     CSE037
074700200610     I*
074800200610     ITABLKY      DS
074900200610     I*
075000200610     I*  TABTB11 TABLE KEY FIELD DATA STRUCTURE FOR DB ERROR
075100200610     I*
075200200610     I                                        1  12 TKEY
075300200610     I                                        1   20RECT
075400200610     I                                        3  10 ZZ008
075500200610     I                                       11  120RCDE
075600200610     I***********                            10  120WBRCDE                S01117
075700200610     I                                       10  12 WBRCDE                S01117
075800200610     I*
075900200610     ICOMARA      DS
076000200610     I*
076100200610     I* COMMON AREA FOR KEY FIELDS ON ACTION RECORDS READ FROM LF/UDPAC
076200200610     I*
076300200610     I***********                             1   30WBC                   S01117
076400200610     I                                        1   3 WBC                   S01117
076500200610     I                                        4  13 WSS
076600200610     I**********                             14  190WDP                                       CSD027
076700200610     I                                       14  19 WDP                                       CSD027
076800200610     I*
076900200610     ISTGARA      DS
077000200610     I*
077100200610     I* STORAGE  AREA FOR KEY FIELDS ON PREVIOUS ACTION RECORD
077200200610     I*
077300200610     I***********                             1   30WSBC                  S01117
077400200610     I                                        1   3 WSBC                  S01117
077500200610     I                                        4  13 WSSS
077600200610     I**********                             14  190WSDP                                      CSD027
077700200610     I                                       14  19 WSDP                                      CSD027
077800200610     I*
077900200610     IPRTARA      DS
078000200610     I*
078100200610     I* PRINT AREA FOR KEY FIELDS ON PREVIOUS PRINTED POSITION
078200200610     I*
078300200610     I                                        1   30WSPBC
078400200610     I                                        4  13 WSPSS
078500200610     I**********                             14  190WSPDP                                     CSD027
078600200610     I                                       14  19 WSPDP                                     CSD027
078700200610     I*                                                                   081765
078800200610     ISDPLCS    E DSSDPLCSPD                                              081765
078900200610     I** EXTERNAL DS FOR PORTFOLIO MANAGEMENT CUSTOMER DETAILS            081765
079000200610     I*
079100200610     IDPOADS      DS                            366
079200200610     I*
079300200610     I*  USER DEPOT POSITIONS AUDIT FILE ERROR EXCEPTIOND DATA STRUCT.
079400200610     I*
079500200610     I                                     *STATUS  STSUDD
079600200610     I*
079700200610     IDPOHDS      DS                            366
079800200610     I*
079900200610     I*  USER DEPOT POSITIONS FILE ERROR EXCEPTIOND DATA STRUCT.
080000200610     I*
080100200610     I                                     *STATUS  STSUDA
080200200610     I*
080300200610     IPOSDDS      DS                            366
080400200610     I*
080500200610     I*  POSITION SETTLEMENTS  FILE ERROR EXCEPTION  DATA STRUCT.
080600200610     I*
080700200610     I                                     *STATUS  STSPSD
080800200610     I*
080900200610     ISEKDDS      DS                            366
081000200610     I*
081100200610     I*  GENERATED ACCOUNT KEYS FILE ERROR EXCEPTION  DATA STRUCT.
081200200610     I*
081300200610     I                                     *STATUS  STSSKD
081400200610     I*
081500200610     IPOSADS      DS                            366
081600200610     I*
081700200610     I*  POSITION SETTLEMENTS  AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
081800200610     I*
081900200610     I                                     *STATUS  STSPSA
082000200610     I*
082100200610     ISEKADS      DS                            366
082200200610     I*
082300200610     I* GENERATED ACCOUNT KEYS AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
082400200610     I*
082500200610     I                                     *STATUS  STSSKA
082600200610     I/COPY WNCPYSRC,SE2370I002
082700200610     I*                                                                   087178
082800200610     IPPOSET    E DSPOSETD                                                CSE023
082900200610     I*  Position Settlement record for calling SE2310                    CSE023
083000200610     I*P@DATA*****DS**                          100                087178 CAC002
083100200610     I***Data*structure for the parameter passed to and from SEZ010087178 CAC002
083200200610     I/COPY WNCPYSRC,SE2370I005
083300200610     I***P@DATA*     DS                            128                               CAC002 AR853119
083400200610     IP@DATA      DS                            141                                         AR853119
083500200610     I** Data structure for the parameter passed to and from SEZ010       CAC002
083600200610     I** Amended to include margin information for PCA                    CAC002
083700200610     I                                        1   1 P@CLAS                087178
083800200610     I                                        2   2 P@PPRE                087178
083900200610     I                                        3  150P@PAMD                087178
084000200610     I                                       16  280P@PCHA                087178
084100200610     I                                       29  410P@PCAM                087178
084200200610     I                                       42  540P@TASO                087178
084300200610     I                                       55  670P@TAUS                087178
084400200610     I                                       68  808P@PSXR                087178
084500200610     I                                       81  81 P@PMDI                087178
084600200610     I                                       82  84 P@PNCY                087178
084700200610     I                                       85  87 P@PSCU                087178
084800200610     I                                       88 1000P@PSAT                087178
084900200610     I                                      101 1138P@FXMR                CAC002
085000200610     I                                      114 1260P@MAMT                CAC002
085100200610     I                                      127 128 P@TDTP                CAC002
085200200610     I                                      129 1410P@STAM                                  AR853119
085300200610     I/COPY WNCPYSRC,SE2370I003
085400200610     I*
085500200610     I*  INPUT SPECIFICATIONS FOR ZSEDIT SUBROUTINE
085600200610     I*
085700200610     I/COPY ZSRSRC,ZSEDITZ2
085800200610     I/COPY ZSRSRC,ZHASHZ2
085900200610     I*
086000200610     I/COPY ZSRSRC,ZSDESCZ2
086100200610     I/COPY ZSRSRC,ZNCDZ2                                                 E29307
086200200610     I/COPY ZSRSRC,ZHOLI                                                  S01512
086300200610     IWACKEY      DS
086400200610     I*
086500200610     I* ACCOUNT KEY DATA STRUCTURE SEE SUBR W01
086600200610     I*
086700200610     I                                        1   3 WACITY
086800200610     I                                        4   4 WACEVC
086900200610     I                                        5   5 WACTRT
087000200610     I                                        6   6 WACPFI
087100200610     I                                        7   8 WACBKC
087200200610     I                                        9  10 WACTST
087300200610     I                                        9  10 WACPSB
087400200610     I                                       11  12 WACCCC
087500200610     I                                       13  13 WACMKT
087600200610     I                                       14  14 WACCON
087700200610     I                                       15  15 WACNEG
087800200610     I                                       19  20 WACAMC
087900200610     I*
088000200610     IINVKEY      DS
088100200610     I*
088200200610     I* INVESTMENT TYPE FILE KEY FOR DB ERROR PRINTOUT
088300200610     I*
088400200610     I                                        1   3 NMCY
088500200610     I                                        4   6 SITP
088600200610     I*
088700200610     IPOSDDB      DS
088800200610     I*
088900200610     I* FILE POSETD DB ERROR KEY - OUTPUT FILE
089000200610     I*
089100200610     I***********                             1   30PBCH                  S01117
089200200610     I***********                             1   3 PBCH            S01117E33032
089300200610     I***********                             1   3 PBCA           E33032 CSE023
089400200610     I***********                             4  13 PSSH                  CSE023
089500200610     I***********                            14  190PCPY                  CSE023
089600200610     I                                        1   3 PBCAK                 CSE023
089700200610     I                                        4  13 PSSHK                 CSE023
089800200610     I**********                             14  190PCPYK                 CSE023       CSE023 CSD027
089900200610     I                                       14  19 PCPYK                                     CSD027
090000200610     I*                                                                   S01486
090100200610     I*    MIDAS 'Next Available Transaction No.' Data Area  MNATN .      S01486
090200200610     IDNATN       DS                              5                       S01486
090300200610     I                                        1   50FNATN                 S01486
090400200610     I*                                                                   S01486
090500200610     ISDMMOD    E DSSDMMODPD                                              S01486
090600200610     I** DS for access to Modules File                                    S01486
090700200610     I*                                                                   S01486
090800200610     I/COPY WNCPYSRC,SE2370I004
090900200610     ISDSTRD    E DSSDSTRDPD                                              CAC002
091000200610     I**  Securities Trading Details                                      CAC002
091100200610     I*
091200200610     I***********LDA        UDS                            256
091300200610     I***********
091400200610     I**LDA*(256)*IN QTEMP USED FOR DATA BASE ERROR PRINTOUT
091500200610     I***********
091600200610     I***********                           134 177 DBLOT
091700200610     I***********                           134 138 DBFILE
091800200610     I***********                           139 167 DBKEY
091900200610     I***********                           168 175 DBPGM
092000200610     I***********                           176 1770DBASE
092100200610     ILDA         DS                            256
092200200610     I*
092300200610     I* LDA (256) IN QTEMP USED FOR DATA BASE ERROR PRINTOUT
092400200610     I*
092500200610     I                                      134 183 DBLOT
092600200610     I                                      134 141 DBFILE
092700200610     I                                      142 170 DBKEY
092800200610     I                                      171 180 DBPGM
092900200610     I                                      181 1830DBASE
093000200610     I*                                                                   E29170
093100200610     ISPOOL       DS                                                      E29170
093200200610     I*                                                                   E29170
093300200610     I**  DS FOR P1 SPOOL FILE NAME                                       E29170
093400200610     I*                                                                   E29170
093500200610     I                                       83  92 SFILE                 E29170
093600200610     I                                    B 123 1240SFNUM                 E29170
093700200610     I*                                                                   E29170
093800200610     ISPOOLU      DS                                                      E29170
093900200610     I*                                                                   E29170
094000200610     I                                       83  92 SFILEU                E29170
094100200610     I                                    B 123 1240SFNUMU                E29170
094200200610     I*
094300200610     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
094400200610     I*
094500200610     ICPYR@#      DS
094600200610     I                                        1  80 CPY@
094700200610     I                                        1  20 CPY@##
094800200610     ISECNTR    E DSSECNTRPD                                              S01447
094900200610     I** SE Country tax rate details                                      S01447
095000200610     I*                                                                   S01447
095100200610     ISECBTX    E DSSECBTXPD                                              S01447
095200200610     I** SE Country to Branch tax rate details                            S01447
095300200610     I*                                                                   S01447
095400200610     IDSFDY     E DSDSFDY                                                 S01447
095500200610     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01447
095600200610     I*                                                                   S01447
095700200610     ISDCURR    E DSSDCURRPD                                              CEU005
095800200610     I** Currency details                                                 CEU005
095900200610     I*                                                                   CEU005
096000200610     ISDGELR    E DSSDGELRPD                                              CEU005
096100200610     I** General ledger details                                           CEU005
096200200610     I*                                                                   CEU005
096300200610     ISDBANK    E DSSDBANKPD                                                                AR853119
096400200610      ***  Data structure for bank details                                                  AR853119
096500200610     ISDBRCE    E DSSDBRCHEXPD                                                              AR853119
096600200610      ** Branch Details Extension                                                           AR853119
096700200610     ISDSTPD    E DSSDSTPDPD                                                                AR853119
096800200610      *                                                                                     AR853119
096900200610     ISDCUST    E DSSDCUSTPD                                              CPB001
097000200610     I** Customer details                                                 CPB001
097100200610     IDSSDY     E DSDSSDY                                                 S01447
097200200610     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01447
097300200610     I*                                                                   S01447
097400200610     IDSLDY     E DSDSLDY                                                 CPB001
097500200610     I*  THIRD DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE           CPB001
097600200610     I*                                                                   CPB001
097700200610      *                                                                                       CSE028
097800200610      ** DS for customer/book standard settlement instruction                                 CSE028
097900200610      **  to be passed to SESSIR0                                                             CSE028
098000200610      *                                                                                       CSE028
098100200610     IPCBSTD    E DSSTDSED                    2                                               CSE028
098200200610     I              RECI                            STRECI                                    CSE028
098300200610     I              LCD                             STLCD                                     CSE028
098400200610     I              CHTP                            STCHTP                                    CSE028
098500200610     I              TNLU                            STTNLU                                    CSE028
098600200610      *                                                                                       CSE028
098700200610      ** Data structure for standard additional settlement details                            CSE028
098800200610      ** for customer/book to be passed to SESSIR0                                            CSE028
098900200610      *                                                                                       CSE028
099000200610     IPCBSAD    E DSSTDADSED                  8                                               CSE028
099100200610      *                                                                                       CSE028
099200200610     ISDBRCH    E DSSDBRCHPD                                                                 BUG7985
099300200610     I              A8BRNM                          BRNM                                     BUG7985
099400200610      ** Midas SD Branch Codes                                                               BUG7985
099500200610      *                                                                                      BUG7985
099600200610     I              QQDFAC                          AQDFAC                                   BUG7985
099700200610      *                                                                                      BUG7985
099701200616     ISDSTAT    E DSSDSTAT                                                                  AR324886
099702200616      ** SD data area                                                                       AR324886
099703200616      *                                                                                     AR324886
099800200610     I/COPY WNCPYSRC,SE2370I001
099900200610     C/EJECT
100000200610      *================================================================
100100200610      *  P R O G R A M   S T A R T                                    *
100200200610      *================================================================
100300200610     C*
100400200610     C* KEYLISTS FOR CHAINING TO FILES
100500200610     C*
100600200610     C* USER DEPOT POSITIONS - HIST. & CURR (UPDATED) LF/DPOSH
100700200610     C*
100800200610     C           DPHKEY    KLIST
100900200610     C***********          KFLD           DSBR                            S01117
101000200610     C                     KFLD           DSBA                            S01117
101100200610     C                     KFLD           DSSC
101200200610     C                     KFLD           DDPT
101300200610     C                     KFLD           WDT
101400200610     C*
101500200610     C* USER DEPOT POSITIONS - NO DATE ON KEY (UPDATED) LF/DPOSH
101600200610     C*
101700200610     C           DPHKND    KLIST
101800200610     C***********          KFLD           DSBR                            S01117
101900200610     C                     KFLD           DSBA                            S01117
102000200610     C                     KFLD           DSSC
102100200610     C                     KFLD           DDPT
102200200610     C*
102300200610     C* USER DEPOT POSITIONS - HIST. & CURR (UPDATED) LF/DPOSH
102400200610     C*
102500200610     C           STGKEY    KLIST
102600200610     C                     KFLD           WSBC
102700200610     C                     KFLD           WSSS
102800200610     C                     KFLD           WSDP
102900200610     C                     KFLD           STGDAT
103000200610     C*
103100200610     C* USER DEPOT POSITIONS - HIST. & CURR (UPDATED) LF/DPOSH
103200200610     C* NO DATE ON KEY OF STORED BRAN/SEC/DEPOT/BOOK/MARKET-SEE CHGPOS
103300200610     C*
103400200610     C           STGKY2    KLIST
103500200610     C                     KFLD           WSBC
103600200610     C                     KFLD           WSSS
103700200610     C                     KFLD           WSDP
103800200610     C*
103900200610     C* USER DEPOT POSITIONS - HIST. & CURR (INPUT) LF/DPOSHI
104000200610     C*
104100200610     C           DPIKEY    KLIST
104200200610     C***********          KFLD           XDSBR                           S01117
104300200610     C                     KFLD           XDSBA                           S01117
104400200610     C                     KFLD           XDSSC
104500200610     C                     KFLD           XDDPT
104600200610     C                     KFLD           XDDTE
104700200610     C*
104800200610     C* USER DEPOT POSITIONS - NO DATE ON KEY (INPUT) LF/DPOSHI
104900200610     C*
105000200610     C           DPIKND    KLIST
105100200610     C***********          KFLD           XDSBR                           S01117
105200200610     C                     KFLD           XDSBA                           S01117
105300200610     C                     KFLD           XDSSC
105400200610     C                     KFLD           XDDPT
105500200610     C*
105600200610     C*  TABLES TABTB11 AND TABTB10
105700200610     C*
105800200610     C           TABKEY    KLIST
105900200610     C                     KFLD           TKEY
106000200610     C*
106100200610     C*  DEPOT NAME INFORMATION - LF/CLINT (PF/CLINTCB)
106200200610     C*
106300200610     C           CLINTK    KLIST
106400200610     C**********           KFLD           WCLNTK  60                                          CSD027
106500200610     C                     KFLD           WCLNTK  6                                           CSD027
106600200610     C                     KFLD           WLITA   1
106700200610     C*
106800200610     C* DEPOT POSITIONS -  HISTORY AND CURRENT   LF/DPOSH
106900200610     C*
107000200610     C           DPOHKY    KLIST
107100200610     C***********          KFLD           WDSBR                           S01117
107200200610     C                     KFLD           WDSBA                           S01117
107300200610     C                     KFLD           WDSSC
107400200610     C                     KFLD           WDDPT
107500200610     C                     KFLD           WDDTE
107600200610     C*                                                                   E16085
107700200610     C* DEPOT NAME INFORMATION - LF/CLINT (PF/CLINTSE)                    E16085
107800200610     C*                                                                   E16085
107900200610     C           CLIKEY    KLIST                                          E16085
108000200610     C                     KFLD           PCPY                            E16085
108100200610     C                     KFLD           WRECT   1                       E16085
108200200610     C*
108300200610     C* SECURITY EVENTS -  BY SEC/DATE/TYPE      LF/SECED
108400200610     C*
108500200610     C           SECDKY    KLIST
108600200610     C                     KFLD           WDSSC
108700200610     C                     KFLD           SDED
108800200610     C                     KFLD           SDET
108900200610     C*
109000200610     C**SECURITY*EVENTS*-*BY*SEC/TYPE/DATE*******LF/SECED**************   E20086
109100200610      **   (LF/SECEO)                                                     E20086
109200200610      **   Security Diary Events by Security/Event Type/REVERSE Date.     E20086
109300200610     C*
109400200610     C           SECETY    KLIST
109500200610     C                     KFLD           WDSSC
109600200610     C                     KFLD           SDET
109700200610     C                     KFLD           SDED
109800200610     C*
109900200610     C* SECURITY EVENTS - LF/SECED
110000200610     C*
110100200610     C           SECKEY    KLIST
110200200610     C                     KFLD           WSSS
110300200610     C                     KFLD           STGDAT
110400200610     C*
110500200610     C* SECURITY EVENTS -   PARTIAL KEY (NO DATE) LF/SECED
110600200610     C*
110700200610     C           SECK      KLIST
110800200610     C                     KFLD           WSSS
110900200610     C*
111000200610     C* SECURITES  LF/SECTY
111100200610     C*
111200200610     C           SECTKY    KLIST
111300200610     C                     KFLD           WDSSC
111400200610     C*
111500200610     C* INVESTMENT TYPES  LF/INVTP
111600200610     C*
111700200610     C           INVTKY    KLIST
111800200610     C                     KFLD           NMCY
111900200610     C                     KFLD           SITP
112000200610     C*
112100200610     C* STANDARD SETTLEMENT INSTRUCTIONS  PF/STDSED
112200200610     C*
112300200610     C           STDSKY    KLIST
112400200610     C***********          KFLD           SBRH                            S01117
112500200610     C                     KFLD           SBRA                            S01117
112600200610     C                     KFLD           CSTM
112700200610     C                     KFLD           WBOOK   2                                           CSE028
112800200610     C                     KFLD           CYSI
112900200610     C                     KFLD           ITSI
113000200610     C                     KFLD           WPTFR   4                                           CSE028
113100200610      *                                                                                       CSE028
113200200610     C                     MOVE *BLANKS   WBOOK                                               CSE028
113300200610     C                     MOVE *BLANKS   WPTFR                                               CSE028
113400200610      *                                                                                       CSE028
113500200610     C/COPY WNCPYSRC,SE2370C013
113600200610     C           *ENTRY    PLIST                                          E15549
113700200610     C                     PARM           ACRLRN  1                       E15549
113800200610     C*
113900200610     C* ACCESS ICD INFORMATION
114000200610     C*
114100200610     C           *NAMVAR   DEFN           LDA                             S01117
114200200610     C           *LOCK     IN   LDA                                       S01117
114300200610     C                     MOVE *BLANK    DBLOT
114400200610     C                     Z-ADD0         DBASE
114500200610     C                     MOVE 'SE2370  'DBPGM
114600200610     C                     OUT  LDA                                       S01117
114601200616     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
114602200616     C                     IN   SDSTAT                                                      AR324886
114700200610     C*
114800200610     C                     EXSR FIRST
114900200610     C*
115000200610     C* CHECK FOR DATABASE ERRORS
115100200610     C*
115200200610     C           *IN99     IFEQ '1'
115300200610     C                     GOTO EAUDIT
115400200610     C                     END
115500200610     C*                                                                   E15549
115600200610     C** SET EVENT CONTROL DATE ACCORDING TO RUN (SEE SE2100)             E15549
115700200610     C*                                                                   E15549
115800200610     C           ACRLRN    IFNE '3'                                       E15549
115900200610     C                     Z-ADDDNWD      ECD     50                      E15549
116000200610     C                     ELSE                                           E15549
116100200610     C                     Z-ADDAPDA      ECD                             E15549
116200200610     C                     END                                            E15549
116300200610     C/COPY WNCPYSRC,SE2370C034
116400200610     C*
116500200610     C* DEFINE AND CLEAR WORK FIELDS
116600200610     C*
116700200610     C           *LIKE     DEFN DDTE      WACTDT
116800200610     C           *LIKE     DEFN DDTE      WDT
116900200610     C           *LIKE     DEFN DDTE      WLASTD
117000200610     C           *LIKE     DEFN DDTE      WLDDTE
117100200610     C           *LIKE     DEFN DDTE      STGDAT
117200200610     C           *LIKE     DEFN DDTE      WPRTDT
117300200610     C           *LIKE     DEFN DDTE      WCOMPD
117400200610     C           *LIKE     DEFN DDBA      WDBASE
117500200610     C           *LIKE     DEFN DPMV      WTYPE
117600200610     C           *LIKE     DEFN DRIN      WREVER
117700200610     C           *LIKE     DEFN CFCT      CFDIF                           052254
117800200610     C*
117900200610     C           *LIKE     DEFN DSSC      WDSSC
118000200610     C           *LIKE     DEFN DDPT      WDDPT
118100200610     C************LIKE     DEFN DSBR      WDSBR                           S01117
118200200610     C           *LIKE     DEFN DSBA      WDSBA                           S01117
118300200610     C           *LIKE     DEFN DDTE      WDDTE
118400200610     C           *LIKE     DEFN RECI      WSRECI
118500200610     C           *LIKE     DEFN RECI      SRECI                           E21880
118600200610     C*
118700200610     C** DEFINE ACCUMULATOR FIELDS FOR ACTIONS ON ONE DATE
118800200610     C*
118900200610     C           *LIKE     DEFN DSNT      WDSNT
119000200610     C           *LIKE     DEFN DSNV      WDSNV
119100200610     C           *LIKE     DEFN DSNS      WDSNS
119200200610     C           *LIKE     DEFN DSRT      WDSRT
119300200610     C           *LIKE     DEFN DSRV      WDSRV
119400200610     C           *LIKE     DEFN DEXN      WDEXN
119500200610     C*
119600200610     C** DEFINE ACCUMULATOR FIELDS FOR ACTIONS ON ONE POSITION
119700200610     C*
119800200610     C           *LIKE     DEFN DSNT      WDSNTP
119900200610     C           *LIKE     DEFN DSNV      WDSNVP
120000200610     C           *LIKE     DEFN DSNS      WDSNSP
120100200610     C           *LIKE     DEFN DSRT      WDSRTP
120200200610     C           *LIKE     DEFN DSRV      WDSRVP
120300200610     C           *LIKE     DEFN DEXN      WDEXNP
120400200610     C           *LIKE     DEFN DDTE      WNEXTD
120500200610     C***********          Z-ADD0         WBC                             S01117
120600200610     C                     MOVE *BLANKS   WBC                             S01117
120700200610     C***********          Z-ADD0         WSBC                            S01117
120800200610     C                     MOVE *BLANKS   WSBC                            S01117
120900200610     C**********           Z-ADD0         WDP                                                 CSD027
121000200610     C**********           Z-ADD0         WSDP                                                CSD027
121100200610     C                     MOVE *BLANKS   WDP                                                 CSD027
121200200610     C                     MOVE *BLANKS   WSDP                                                CSD027
121300200610     C                     Z-ADD0         RECT
121400200610     C                     Z-ADD0         RCDE
121500200610     C***********          Z-ADD0         WBRCDE                          S01117
121600200610     C                     MOVE *BLANKS   WBRCDE                          S01117
121700200610     C                     MOVE '0'       P31PRT
121800200610     C                     MOVE 'A'       WLITA
121900200610     C*
122000200610     C** Call Access object to check presence of CSE008.                  095066
122100200610     C*                                                                   095066
122200200610     C                     CALL 'AOSARDR0'                                095066
122300200610     C                     PARM '       ' @RTCD   7                       095066
122400200610     C                     PARM '*VERIFY' @OPTN   7                       095066
122500200610     C                     PARM 'CSE008'  @SARD   6                       095066
122600200610     C*                                                                   095066
122700200610     C           @RTCD     IFEQ *BLANK                                    095066
122800200610     C                     MOVE 'Y'       CSE008  1                       095066
122900200610     C                     ELSE                                           095066
123000200610     C                     MOVE 'N'       CSE008                          095066
123100200610     C                     ENDIF                                          095066
123200200610     C*
123300200610     C* LOOP ROUND PROCESSING FOR EACH ACTION RECORD READ LF/DEPAC
123400200610     C           *IN89     DOWEQ'0'
123500200610     C*
123600200610     C** SETOF RECORD IDENTIFYING INDICAT'S FOR ACTION FILE 01,02,03,04
123700200610     C**                                                    05,06.        E14753
123800200610     C*
123900200610     C***********          MOVEA'0000'    *IN,01                          E14753
124000200610     C                     MOVEA'000000'  *IN,01                          E14753
124100200610     C*
124200200610     C* READ ACTION FILE OF DEPOT MOVEMENTS
124300200610     C*
124400200610     C                     READ DEPAC                    89
124500200610     C*
124600200610     C* IF NOT END OF FILE & IF DELETED RECORD IGNORE
124700200610     C*
124800200610     C           *IN89     IFEQ '0'
124900200610     C           RECI      ANDEQ'*'
125000200610     C                     GOTO ENDLP
125100200610     C                     END
125200200610     C*
125300200610     C* OR IF NOT END OF FILE AND EVENT DATE EQUALS DATE NEXT WORKING
125400200610     C* DAY THEN ADD TO COUNT AND IGNORE
125500200610     C*
125600200610     C           *IN89     IFEQ '0'
125700200610     C   01                Z-ADDDADA      WACTDT
125800200610     C   02                Z-ADDSEDE      WACTDT
125900200610     C   03                Z-ADDEVTD      WACTDT
126000200610     C   04                Z-ADDCADA      WACTDT
126100200610     C   05                Z-ADDEVTD      WACTDT                          E14753
126200200610     C   06                Z-ADDSEDE      WACTDT                          E14753
126300200610     C           WACTDT    IFEQ DNWD
126400200610     C           *IN03     OREQ '1'                                       S01269
126500200610     C           ACTS      ANDEQ'11'                                      S01269
126600200610     C   01                ADD  1         WCMOVT
126700200610     C   02                ADD  1         WCSETT
126800200610     C   03                ADD  1         WCTRAD
126900200610     C   04                ADD  1         WCCMVT
127000200610     C   05                ADD  1         WCTRAD                          E14753
127100200610     C   06                ADD  1         WCSETT                          E14753
127200200610     C                     GOTO ENDLP
127300200610     C                     END
127400200610     C                     END
127500200610     C*
127600200610     C* AT END OF FILE - DO UPDATES FOR LAST DATE AND LAST POSITION
127700200610     C*
127800200610     C           *IN89     IFEQ '1'
127900200610     C*
128000200610     C*   END OF FILE - EXECUTE CHANGE OF POSITION SUBROUTINE
128100200610     C*
128200200610     C                     EXSR CH01
128300200610     C                     GOTO ENDLP
128400200610     C                     END
128500200610     C*
128600200610     C** DETERMINE RECORD TYPE AND ADD TO COUNTER FOR EACH TYPE
128700200610     C*   DEPOT MOVEMENTS COUNT
128800200610     C*
128900200610     C           *IN01     IFEQ '1'
129000200610     C                     ADD  1         WCMOVT  50
129100200610     C*
129200200610     C* MOVE KEYS AND DATE TO DATA STRUCTURE FOR COMPARISON
129300200610     C*
129400200610     C***********          MOVE DPBC      WBC                             S01117
129500200610     C                     MOVE DPBA      WBC                             S01117
129600200610     C                     MOVE DPSS      WSS
129700200610     C**********           Z-ADDDDEP      WDP                                                 CSD027
129800200610     C                     MOVE DDEP      WDP                                                 CSD027
129900200610     C                     Z-ADDDADA      WACTDT
130000200610     C                     MOVE DDBA      WDBASE
130100200610     C                     MOVE DPMV      WTYPE
130200200610     C                     MOVE DRIN      WREVER
130300200610     C                     END
130400200610     C*
130500200610     C*  SETTLEMENTS COUNT
130600200610     C*
130700200610     C           *IN02     IFEQ '1'
130800200610     C                     ADD  1         WCSETT  50
130900200610     C*
131000200610     C* MOVE KEYS AND DATE TO DATA STRUCTURE FOR COMPARISON
131100200610     C*
131200200610     C***********          MOVE SBCD      WBC                             S01117
131300200610     C                     MOVE SBCA      WBC                             S01117
131400200610     C                     MOVE SSSN      WSS
131500200610     C**********           Z-ADDSODP      WDP                                                 CSD027
131600200610     C                     MOVE SODP      WDP                                                 CSD027
131700200610     C                     Z-ADDSEDE      WACTDT
131800200610     C                     MOVE 'S'       WDBASE
131900200610     C                     MOVE STET      WTYPE
132000200610     C                     MOVE SRIN      WREVER
132100200610     C                     END
132200200610     C*
132300200610     C*  TRADE ACTIONS COUNT
132400200610     C*
132500200610     C           *IN03     IFEQ '1'
132600200610     C                     ADD  1         WCTRAD  50
132700200610     C*
132800200610     C* Ignore record with blank depot
132900200610     C*
133000200610     C********** OUDP      IFNE *ZEROS                                                        CSD027
133100200610     C           OUDP      IFNE *BLANKS                                                       CSD027
133200200610     C           OUDP      ANDNE'000000'                                                    BUG11620
133300200610     C*
133400200610     C* MOVE KEYS AND DATE TO DATA STRUCTURE FOR COMPARISON
133500200610     C*
133600200610     C***********          MOVE TDBR      WBC                             S01117
133700200610     C                     MOVE TDBA      WBC                             S01117
133800200610     C                     MOVE TDSS      WSS
133900200610     C**********           Z-ADDOUDP      WDP                                                 CSD027
134000200610     C                     MOVE OUDP      WDP                                                 CSD027
134100200610     C                     Z-ADDEVTD      WACTDT
134200200610     C                     MOVE TVDA      WDBASE
134300200610     C                     MOVE '  '      WTYPE
134400200610     C                     MOVE PRSL      WTYPE
134500200610     C                     MOVE RVLI      WREVER
134600200610     C*
134700200610     C                     ELSE
134800200610     C                     GOTO ENDLP
134900200610     C                     END
135000200610     C*
135100200610     C                     END
135200200610     C*
135300200610     C*  CUSTOMER DEPOT MOVEMENTS COUNT
135400200610     C*
135500200610     C           *IN04     IFEQ '1'
135600200610     C                     ADD  1         WCCMVT  50
135700200610     C*
135800200610     C* MOVE KEYS AND DATE TO DATA STRUCTURE FOR COMPARISON
135900200610     C*
136000200610     C***********          MOVE CPBC      WBC                             S01117
136100200610     C                     MOVE CPBA      WBC                             S01117
136200200610     C                     MOVE CPSS      WSS
136300200610     C**********           Z-ADDCDEP      WDP                                                 CSD027
136400200610     C                     MOVE CDEP      WDP                                                 CSD027
136500200610     C                     Z-ADDCADA      WACTDT
136600200610     C                     MOVE CDBA      WDBASE
136700200610     C                     MOVE CPMV      WTYPE
136800200610     C                     MOVE CRIN      WREVER
136900200610     C                     END
137000200610     C*                                                                   E14753
137100200610     C*  PORTFOLIO TRADE ACTIONS COUNT                                    E14753
137200200610     C*                                                                   E14753
137300200610     C           *IN05     IFEQ '1'                                       E14753
137400200610     C                     ADD  1         WCTRAD                          E14753
137500200610     C*                                                                   E14753
137600200610     C* Ignore record with blank depot                                    E14753
137700200610     C*                                                                   E14753
137800200610     C********** PTCD      IFNE *ZEROS                                    E14753       E14753 CSD027
137900200610     C           PTCD      IFNE *BLANKS                                                       CSD027
138000200610     C           PTCD      ANDNE'000000'                                                    BUG11620
138100200610     C*                                                                   E14753
138200200610     C* MOVE KEYS AND DATE TO DATA STRUCTURE FOR COMPARISON               E14753
138300200610     C*                                                                   E14753
138400200610     C***********          MOVE TDBR      WBC                      E14753 S01117
138500200610     C                     MOVE TDBA      WBC                             S01117
138600200610     C                     MOVE TDSS      WSS                             E14753
138700200610     C**********           Z-ADDPTCD      WDP                                          E14753 CSD027
138800200610     C                     MOVE PTCD      WDP                                                 CSD027
138900200610     C                     Z-ADDEVTD      WACTDT                          E14753
139000200610     C                     MOVE TVDA      WDBASE                          E14753
139100200610     C                     MOVE '  '      WTYPE                           E14753
139200200610     C                     MOVE PRSL      WTYPE                           E14753
139300200610     C                     MOVE RVLI      WREVER                          E14753
139400200610     C*                                                                   E14753
139500200610     C                     ELSE                                           E14753
139600200610     C                     GOTO ENDLP                                     E14753
139700200610     C                     END                                            E14753
139800200610     C*                                                                   E14753
139900200610     C                     END                                            E14753
140000200610     C*                                                                   E14753
140100200610     C*  PORTFOLIO TRADE SETTLEMENTS COUNT                                E14753
140200200610     C*                                                                   E14753
140300200610     C           *IN06     IFEQ '1'                                       E14753
140400200610     C                     ADD  1         WCSETT                          E14753
140500200610     C*                                                                   E14753
140600200610     C* MOVE KEYS AND DATE TO DATA STRUCTURE FOR COMPARISON               E14753
140700200610     C*                                                                   E14753
140800200610     C***********          MOVE SBCD      WBC                      E14753 S01117
140900200610     C                     MOVE SBCA      WBC                             S01117
141000200610     C                     MOVE SSSN      WSS                             E14753
141100200610     C**********           Z-ADDSPCD      WDP                                          E14753 CSD027
141200200610     C                     MOVE SPCD      WDP                                                 CSD027
141300200610     C                     Z-ADDSEDE      WACTDT                          E14753
141400200610     C                     MOVE 'S'       WDBASE                          E14753
141500200610     C                     MOVE STET      WTYPE                           E14753
141600200610     C                     MOVE SRIN      WREVER                          E14753
141700200610     C                     END                                            E14753
141800200610     C*
141900200610     C** COMPARE KEY AND DATE TO STORED KEY AND DATE
142000200610     C*
142100200610     C* CHANGE OF POSITION - PROCESS CHG OF DATE,LAST POSN & NEXT POSN
142200200610     C*
142300200610     C           COMARA    IFNE STGARA
142400200610     C*
142500200610     C*   CHANGE POSITION - EXECUTE CHANGE OF POSITION SUBROUTINE
142600200610     C*
142700200610     C                     EXSR CH01
142800200610     C*
142900200610     C** GET LATEST DATE FOR THE POSITION IN SUBR NW01
143000200610     C*
143100200610     C                     EXSR NW01
143200200610     C*
143300200610     C** SAVE RECI OF DPOSH RECORD FOR LATER UPDATE                       E21880
143400200610     C*
143500200610     C                     MOVE RECI      SRECI                           E21880
143600200610     C*                                                                   E21430
143700200610     C** ON CHANGE OF SECURITY ENSURE THAT SECURITIES AND INVESTMENT      E21430
143800200610     C*  TYPES FILES ARE ACCESSED                                         E21430
143900200610     C*                                                                   E21430
144000200610     C           WSS       IFNE WSSS                                      E21430
144100200610     C                     MOVE WSS       WDSSC                           E21430
144200200610     C                     EXSR SECTIN                                    E21430
144300200610     C                     EXSR INVTIN                                    E21430
144400200610     C                     END                                            E21430
144500200610     C*
144600200610     C                     MOVE SRECI     RECI                            E21880
144700200610     C*
144800200610     C                     ELSE
144900200610     C*
145000200610     C** PROCESS CHANGE OF DATE WITHIN SAME POSITION
145100200610     C*
145200200610     C           WACTDT    IFNE STGDAT
145300200610     C*
145400200610     C**  ON CHANGE OF DATE PROCESS PREVIOUS DATES ACTIONS FOR POSN.
145500200610     C*
145600200610     C                     EXSR CH02
145700200610     C*
145800200610     C**  ON CHANGE OF DATE  GET BASE POSITION FOR THIS DATE
145900200610     C*
146000200610     C                     EXSR NW02
146100200610     C*
146200200610     C                     END
146300200610     C                     END
146400200610     C*
146500200610     C** NOW PROCESS ACTION RECORD READ BY ACCUMULATING CHANGES
146600200610     C*
146700200610     C*      ACCUMULATE
146800200610     C*
146900200610     C                     EXSR ACCUM
147000200610     C*
147100200610     C* IF FLAG WACSET (SEE SUBR ACCUM) IS '1' SETOF 33,32,34, SETON 33
147200200610     C* AND EXSR PR01 TO PRINT ACTION JUST READ IN
147300200610     C*
147400200610     C           WACSET    IFEQ '1'
147500200610     C                     MOVEA'0010'    *IN,31
147600200610     C                     MOVEA'0'       *IN,52                          E14739
147700200610     C*
147800200610     C* WPRTDT IS DATE PRINTED ON OPBAL LINE - MAY BE PRINTED NEXT
147900200610     C*
148000200610     C                     Z-ADDWACTDT    WPRTDT
148100200610     C                     EXSR PR01
148200200610     C                     END
148300200610     C*
148400200610     C*  MOVE KEY AND DATE OF RECORD IN TO KE/DATE OF LAST RECORD IN
148500200610     C*
148600200610     C                     MOVE COMARA    STGARA
148700200610     C                     Z-ADDWACTDT    STGDAT
148800200610     C           ENDLP     TAG                             ** ENDLP **
148900200610     C*
149000200610     C                     END
149100200610     C*
149200200610     C* ACCESS UDPMVA AUDIT RECORD FOR DEPOT MOVEMENT ACTIONS
149300200610     C*
149400200610     C                     READ UDPMVA                   79
149500200610     C********** *IN79     IFNE '1'                                       E15035
149600200610     C********** RECI      ANDEQ'*'                                       E15035
149700200610     C**********           MOVE '1'       *IN79                           E15035
149800200610     C**********           END                                            E15035
149900200610     C*
150000200610     C* DATA BASE ERROR
150100200610     C*
150200200610     C           *IN79     IFEQ '1'
150300200610     C           *LOCK     IN   LDA                                       S01117
150400200610     C                     MOVEL'UDPMVA'  DBFILE           ***************
150500200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 04 *
150600200610     C                     Z-ADD4         DBASE            ***************
150700200610     C                     SETON                       U7U8
150800200610     C                     DUMP                                           S01117
150900200610     C                     GOTO EAUDIT
151000200610     C                     END
151100200610     C                     Z-ADDNORE      DMNORE  50
151200200610     C*
151300200610     C* ACCESS CDPMVA AUDIT RECORD FOR CUSTOMERS MOVEMENT ACTIONS
151400200610     C*
151500200610     C                     READ CDPMVA                   79
151600200610     C********** *IN79     IFNE '1'                                       E15035
151700200610     C********** RECI      ANDEQ'*'                                       E15035
151800200610     C**********           MOVE '1'       *IN79                           E15035
151900200610     C**********           END                                            E15035
152000200610     C*
152100200610     C* DATA BASE ERROR
152200200610     C*
152300200610     C           *IN79     IFEQ '1'
152400200610     C           *LOCK     IN   LDA                                       S01117
152500200610     C                     MOVEL'CDPMVA'  DBFILE           ***************
152600200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 05 *
152700200610     C                     Z-ADD5         DBASE            ***************
152800200610     C                     SETON                       U7U8
152900200610     C                     DUMP                                           S01117
153000200610     C                     GOTO EAUDIT
153100200610     C                     END
153200200610     C                     Z-ADDNORE      DCNORE  50
153300200610     C*
153400200610     C* ACCESS SETACA AUDIT RECORD FOR SETTLEMENT ACTIONS
153500200610     C*
153600200610     C                     READ SETACA                   79
153700200610     C********** *IN79     IFNE '1'                                       E15035
153800200610     C********** RECI      ANDEQ'*'                                       E15035
153900200610     C**********           MOVE '1'       *IN79                           E15035
154000200610     C**********           END                                            E15035
154100200610     C*
154200200610     C* DATA BASE ERROR
154300200610     C*
154400200610     C           *IN79     IFEQ '1'
154500200610     C           *LOCK     IN   LDA                                       S01117
154600200610     C                     MOVEL'SETACA'  DBFILE           ***************
154700200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 06 *
154800200610     C                     Z-ADD6         DBASE            ***************
154900200610     C                     SETON                       U7U8
155000200610     C                     DUMP                                           S01117
155100200610     C                     GOTO EAUDIT
155200200610     C                     END
155300200610     C                     Z-ADDNORE      STNORE  50
155400200610     C*
155500200610     C* ACCESS TRDACA AUDIT RECORD FOR TRADE ACTIONS
155600200610     C*
155700200610     C                     READ TRDACA                   79
155800200610     C********** *IN79     IFNE '1'                                       E15035
155900200610     C********** RECI      ANDEQ'*'                                       E15035
156000200610     C**********           MOVE '1'       *IN79                           E15035
156100200610     C**********           END                                            E15035
156200200610     C*
156300200610     C* DATA BASE ERROR
156400200610     C*
156500200610     C           *IN79     IFEQ '1'
156600200610     C           *LOCK     IN   LDA                                       S01117
156700200610     C                     MOVEL'TRDACA'  DBFILE           ***************
156800200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 07 *
156900200610     C                     Z-ADD7         DBASE            ***************
157000200610     C                     SETON                       U7U8
157100200610     C                     DUMP                                           S01117
157200200610     C                     GOTO EAUDIT
157300200610     C                     END
157400200610     C           NORT      ADD  NRDT      TRNORE  50
157500200610     C           EAUDIT    TAG                             ** EAUDIT **
157600200610     C*
157700200610     C** IF IND 68 IS ON THE PRINT FILE IS OPEN - WRITE TRAILER AND CLOSE
157800200610     C*
157900200610     C           *IN68     IFEQ '1'
158000200610     C                     EXSR OF01                                      E15283
158100200610     C                     WRITETRAILP1
158200200610     C                     CLOSESE2370P1               79
158300200610     C                     MOVE '0'       *IN68
158400200610     C           *IN79     IFEQ '1'
158500200610     C           *LOCK     IN   LDA                                       S01117
158600200610     C                     MOVEL'PRINT'   DBFILE           ***************
158700200610     C                     MOVEL'CLOSE'   DBKEY            * DB ERROR 10 *
158800200610     C                     Z-ADD10        DBASE            ***************
158900200610     C                     MOVE '1'       *INU7
159000200610     C                     MOVE '1'       *INU8
159100200610     C                     DUMP                                           S01117
159200200610     C                     END
159300200610     C                     END
159400200610     C*
159500200610     C* OUTPUT RUN CONTROL REPORT
159600200610     C*
159700200610     C                     EXSR AUDIT
159800200610      *
159900200610      *================================================================
160000200610      *  P R O G R A M   E N D                                        *
160100200610      *                                                               *
160200200610     C/COPY WNCPYSRC,SE2370C025
160300200610     C                     SETON                     LR
160400200610      *                                                               *
160500200610      *================================================================
160600200610      /EJECT
160700200610     C*****************************************************************
160800200610     C*                                                               *
160900200610     C* CH01  - SUBROUTINE TO DEAL WITH END OF POSITION               *
161000200610     C*                                                               *
161100200610     C*****************************************************************
161200200610     C*
161300200610     C           CH01      BEGSR                           ** CH01  **
161400200610     C*
161500200610     C* UPDATE FOR LAST ACTION READ AND EXISTING POSITIONS AFTER
161600200610     C*
161700200610     C* FIRST, PROCESS ONLY THE END OF FILE CONDITION - 89 IS ON
161800200610     C*
161900200610     C           *IN89     IFEQ '1'
162000200610     C           WSS       IFNE *BLANK
162100200610     C*
162200200610     C**  ON CHANGE OF POSN ADD LAST DATE ACCUMULATORS TO POSITION CHGS
162300200610     C*
162400200610     C                     EXSR ADDDAT
162500200610     C*
162600200610     C           WEQUAL    IFEQ '1'
162700200610     C           WLASTD    ANDNE0
162800200610     C                     Z-ADDSTGDAT    WCOMPD
162900200610     C                     EXSR U01
163000200610     C                     ELSE
163100200610     C                     EXSR W01
163200200610     C                     END
163300200610     C*
163400200610     C* IF FLAG WPRINT (SEE SUBR ACCUM) IS '1' SETOF 31,32,32 AND SETON
163500200610     C* IND 34,EXSR PR01 TO PRINT CLOSING BALANCE FOR LAST UPDATE/ADD
163600200610     C*
163700200610     C           WPRINT    IFEQ '1'
163800200610     C                     MOVEA'0001'    *IN,31
163900200610     C                     MOVEA'0'       *IN,52                          E14739
164000200610     C                     EXSR PR01
164100200610     C                     END
164200200610     C*
164300200610     C* EXECUTE ADJUST A/C KEYS/POSN.SETT. SUBR - P/SEC
164400200610     C*
164500200610     C                     Z-ADDSTGDAT    WFRMDT  60
164600200610     C*
164700200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
164800200610     C* OR DATE OF LAST POSITION WHICHEVER IS LOWEST
164900200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
165000200610     C* (AS DATE OF LAST POSITION MAY NOT BE THE LATEST POSITION BECAUSE  E15549
165100200610     C* IT IS OBTAINED PRIOR TO MOVEMENT UPDATES,SO CHECK THIS IS NOT SO) E15549
165200200610     C*
165300200610     C           WLASTD    IFGT STGDAT                                    E15549
165400200610     C                     Z-ADDWLASTD    WTODAT  60
165500200610     C                     EXSR NEXT
165600200610     C                     Z-ADDWNEXTD    WTODAT  60
165700200610     C                     EXSR SEC
165800200610     C                     END                                            E15549
165900200610     C*
166000200610     C* EXECUTE CHANGE OF POSITION SUBROUTINE
166100200610     C*
166200200610     C*  UPDATE DEPOT POSITION RECORDS FROM LAST DATE UPDATED TO MOST
166300200610     C*  RECENT.
166400200610     C*
166500200610     C                     EXSR CHGPOS
166600200610     C                     END
166700200610     C                     ELSE
166800200610     C*
166900200610     C* IF ACTION DATE EQUALS POSITION RECORD DATE OR NXT WRKING DAY
167000200610     C* THEN UPDATE IN SUBR U02,ELSE ADD POSITION RECORD IN SUBR W01
167100200610     C* NB. ON FIRST POSITION, DO NOT EXSR U02/W01/CHGPOS
167200200610     C*
167300200610     C           WSSS      IFNE *BLANK
167400200610     C*
167500200610     C**  ON CHANGE OF POSN ADD LAST DATE ACCUMULATORS TO POSITION CHGS
167600200610     C*
167700200610     C                     EXSR ADDDAT
167800200610     C           STGDAT    IFEQ DDTE
167900200610     C           WLASTD    ANDNE0
168000200610     C***********WBCX      ANDEQDSBR                                E24420S01117
168100200610     C           WBCX      ANDEQDSBA                                      S01117
168200200610     C           WSSX      ANDEQDSSC                                      E24420
168300200610     C           WDPX      ANDEQDDPT                                      E24420
168400200610     C                     Z-ADDSTGDAT    WCOMPD
168500200610     C                     EXSR U01
168600200610     C                     ELSE
168700200610     C                     EXSR W01
168800200610     C                     END
168900200610     C*
169000200610     C* IF FLAG WPRINT (SEE SUBR ACCUM) IS '1' SETOF 31,32,32 AND SETON
169100200610     C* IND 34,EXSR PR01 TO PRINT CLOSING BALANCE FOR LAST UPDATE/ADD
169200200610     C*
169300200610     C           WPRINT    IFEQ '1'
169400200610     C                     MOVEA'0001'    *IN,31
169500200610     C                     MOVEA'0'       *IN,52                          E14739
169600200610     C                     EXSR PR01
169700200610     C                     END
169800200610     C*
169900200610     C* EXECUTE ADJUST A/C KEYS/POSN.SETT. SUBR - P/SEC
170000200610     C*
170100200610     C                     Z-ADDSTGDAT    WFRMDT
170200200610     C*
170300200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
170400200610     C* OR DATE OF LAST POSITION WHICHEVER IS LOWEST
170500200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
170600200610     C* (AS DATE OF LAST POSITION MAY NOT BE THE LATEST POSITION BECAUSE  E15549
170700200610     C* IT IS OBTAINED PRIOR TO MOVEMENT UPDATES,SO CHECK THIS IS NOT SO) E15549
170800200610     C*
170900200610     C           WLASTD    IFGT STGDAT                                    E15549
171000200610     C                     Z-ADDWLASTD    WTODAT  60
171100200610     C                     EXSR NEXT
171200200610     C                     Z-ADDWNEXTD    WTODAT  60
171300200610     C                     EXSR SEC
171400200610     C                     END                                            E15549
171500200610     C*
171600200610     C* EXECUTE CHANGE OF POSITION SUBROUTINE
171700200610     C*
171800200610     C                     EXSR CHGPOS
171900200610     C                     END
172000200610     C                     END
172100200610     C*
172200200610     C                     ENDSR
172300200610     C*
172400200610     C*****************************************************************
172500200610      /EJECT
172600200610      *****************************************************************
172700200610      *                                                               *
172800200610      *  NW01   - NEW POSITION READ IN - GET NEWEST DATE FOR THIS     *
172900200610      *           POSITION AND THEN ESTABLISH LATEST DATE HELD FOR THIS
173000200610      *           NEW DATE READ IN.(I.E. BALANCE AS AT DATE READ IN)  *
173100200610      *                                                               *
173200200610      *****************************************************************
173300200610      *
173400200610     C           NW01      BEGSR                            ** NW01 **
173500200610     C*
173600200610     C* GET LATEST DATE FOR THIS NEW POSITION
173700200610     C*
173800200610     C** SET PRINT FLAG WPRINT BACK TO ZERO - SEE SUBR ACCUM
173900200610     C*
174000200610     C                     MOVE '0'       WPRINT  1
174100200610     C*                                                                   E24420
174200200610     C* SAVE KEY FIELDS TO CHECK WHETHER TO WRITE TO OR UPDATE            E24420
174300200610     C* DPOSH LATER                                                       E24420
174400200610     C*                                                                   E24420
174500200610     C                     MOVE WSS       WSSX   10                       E24420
174600200610     C***********          Z-ADDWBC       WBCX    30                E24420S01117
174700200610     C                     MOVE WBC       WBCX    3                       S01117
174800200610     C**********           Z-ADDWDP       WDPX    60                                   E24420 CSD027
174900200610     C                     MOVE WDP       WDPX    6                                           CSD027
175000200610     C*
175100200610     C** CONSTRUCT KEY TO DEPOT POSITIONS HIST/CURR LF/DPOSH
175200200610     C*
175300200610     C** INCREMENT COUNT OF POSITIONS  FOR NEW POSITION
175400200610     C*
175500200610     C                     ADD  1         WCPOSN  50
175600200610     C                     Z-ADD0         DSNS
175700200610     C***********          MOVE WBC       DSBR                            S01117
175800200610     C                     MOVE WBC       DSBA                            S01117
175900200610     C                     MOVE WSS       DSSC
176000200610     C                     MOVE WDP       DDPT
176100200610     C                     MOVE 999999    WDT
176200200610     C           DPHKEY    SETGTDPOSH
176300200610     C*
176400200610     C           RDLOOP    TAG                             ** RDLOOP **
176500200610     C*
176600200610     C                     READPDPOSH                    77
176700200610     C*
176800200610     C*  IF DELETED RECORD GO TO RDLOOP AND READ NEXT PREVIOUS RCD
176900200610     C*
177000200610     C           *IN77     IFEQ '0'
177100200610     C           RECI      CABEQ'*'       RDLOOP
177200200610     C                     END
177300200610     C*
177400200610     C*  IF BEGINNING OF FILE - NO POSITION YET FOR SECURITY
177500200610     C*
177600200610     C           *IN77     IFEQ '1'
177700200610     C                     EXSR NOPOSN
177800200610     C                     GOTO POSVAL
177900200610     C                     END
178000200610     C*
178100200610     C* CHECK IF RECORD RETRIEVED IS SAME AS ACTION RECORD KEY
178200200610     C* ELSE NO POSITION FOR SECURITY - EXSR NOPOSN
178300200610     C*
178400200610     C***********WBC       IFNE DSBR                                      S01117
178500200610     C           WBC       IFNE DSBA                                      S01117
178600200610     C           WSS       ORNE DSSC
178700200610     C           WDP       ORNE DDPT
178800200610     C                     EXSR NOPOSN
178900200610     C                     GOTO POSVAL
179000200610     C                     END
179100200610     C*
179200200610     C** STORE LAST POSITION DATE HELD ON FILE IN WLASTD FIELD
179300200610     C*
179400200610     C                     Z-ADDDDTE      WLASTD
179500200610     C*
179600200610     C** IF NEW DATE IN FOR THIS POSITION IS GREATER THAN LAST DATE
179700200610     C** FOR THIS POSITION AND ACTION DATE IS NOT EQUAL TO DATE NEXT
179800200610     C** WORKING DAY, UPDATE THIS LAST RECORD TO REC.ID = H HISTORY
179900200610     C*
180000200610     C           WACTDT    IFGT DDTE
180100200610     C                     MOVE 'H'       RECI
180200200610     C                     UPDATDPOSNDF
180300200610     C                     END
180400200610     C*
180500200610     C*  - OBTAIN LATEST CORRECT POSITION DATE AND BALANCES
180600200610     C*    FOR EACH POSITION WITH ACTIONS TODAY
180700200610     C*
180800200610     C           POSVAL    TAG                             **POSVAL**
180900200610     C*
181000200610     C** CONSTRUCT KEY TO DEPOT POSITIONS HIST/CURR LF/DPOSH
181100200610     C*
181200200610     C                     Z-ADD*ZERO     WLDDTE                          E29307
181300200610     C***********          MOVE WBC       DSBR                            S01117
181400200610     C                     MOVE WBC       DSBA                            S01117
181500200610     C                     MOVE WSS       DSSC
181600200610     C                     MOVE WDP       DDPT
181700200610     C                     Z-ADDWACTDT    WDT
181800200610     C           DPHKEY    SETLLDPOSH                    77
181900200610     C*
182000200610     C           *IN77     IFEQ '1'
182100200610     C           DPHKEY    READEDPOSH                    77
182200200610     C*
182300200610     C**  DATES ARE EQUAL - SET FLAG TO INDICATE THIS - SEE W01 SUBR
182400200610     C*
182500200610     C           RECI      IFNE '*'
182600200610     C                     Z-ADDDDTE      WLDDTE                          E29307
182700200610     C                     MOVE '1'       WEQUAL  1
182800200610     C                     GOTO ENDNW1
182900200610     C                     END
183000200610     C                     ELSE
183100200610     C                     MOVE '0'       WEQUAL
183200200610     C                     END
183300200610     C*
183400200610     C** SEARCH FOR NEXT EARLIEST DATE EQUAL OR BEFORE ACTION DATE
183500200610     C*
183600200610     C           RPLOOP    TAG                             ** RPLOOP**
183700200610     C*
183800200610     C                     READPDPOSH                    77
183900200610     C  N77      RECI      CABEQ'*'       RPLOOP
184000200610     C*
184100200610     C** IF BEGINNING OF FILE ITS FOR FIRST DATE OF FIRST POSITION
184200200610     C*
184300200610     C           *IN77     IFEQ '1'
184400200610     C                     EXSR CLRUPD
184500200610     C                     GOTO ENDNW1
184600200610     C                     END
184700200610     C*
184800200610     C* CHECK IF RECORD RETRIEVED IS SAME AS ACTION RECORD KEY
184900200610     C* ELSE ZEROISE FIELDS IN FILE LAYOUT DPOSNDF
185000200610     C*
185100200610     C***********WBC       IFNE DSBR                                      S01117
185200200610     C           WBC       IFNE DSBA                                      S01117
185300200610     C           WSS       ORNE DSSC
185400200610     C           WDP       ORNE DDPT
185500200610     C                     EXSR CLRUPD
185600200610     C                     ELSE                                           E29307
185700200610     C                     Z-ADDDDTE      WLDDTE                          E29307
185800200610     C                     END
185900200610     C           ENDNW1    ENDSR                           ** ENDNW1 **
186000200610      *
186100200610      *****************************************************************
186200200610      /EJECT
186300200610      *****************************************************************
186400200610      *                                                               *
186500200610      *  CH02   - CHANGE OF DATE ON INPUT RECORDS - UPDATE FOR LAST   *
186600200610      *           DATE READ AND ANY SUCCEEDING DATES FOR POSITION UP  *
186700200610      *           TO NEW DATE READ IN.                                *
186800200610      *                                                               *
186900200610      *****************************************************************
187000200610      *
187100200610     C           CH02      BEGSR                            ** CH02 **
187200200610     C*
187300200610     C* CHANGE OF DATE - PROCESS PREVIOUS DATE
187400200610     C*
187500200610     C* IF ACTION DATE EQUALS POSITION RECORD DATE OR NXT WRKING DAY
187600200610     C* THEN UPDATE IN SUBR U01, ELSE ADD POSITION RECORD IN SUBR W01
187700200610     C*
187800200610     C                     EXSR ADDDAT
187900200610     C           WEQUAL    IFEQ '1'
188000200610     C                     Z-ADDWACTDT    WCOMPD
188100200610     C                     EXSR U01
188200200610     C                     ELSE
188300200610     C                     EXSR W01
188400200610     C                     END
188500200610     C*
188600200610     C* IF FLAG WPRINT (SEE SUBR ACCUM) IS '1' SETOF 31,32,32 AND SETON
188700200610     C* IND 34, EXSR PR01 TO PRINT CLOSING BALANCE FOR LAST UPDATE/ADD
188800200610     C*
188900200610     C           WPRINT    IFEQ '1'
189000200610     C                     MOVEA'0001'    *IN,31
189100200610     C                     MOVEA'0'       *IN,52                          E14739
189200200610     C                     EXSR PR01
189300200610     C                     END
189400200610     C*
189500200610     C* EXECUTE ADJUST A/C KEYS/POSN.SETT. SUBR - P/SEC
189600200610     C*
189700200610     C                     Z-ADDDDTE      WFRMDT
189800200610     C*
189900200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
190000200610     C* OR DATE OF NEXT ACTION FOR THIS POSITION WHICHEVER IS LOWEST
190100200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
190200200610     C*
190300200610     C                     Z-ADDWACTDT    WTODAT  60
190400200610     C                     EXSR NEXT
190500200610     C                     Z-ADDWNEXTD    WTODAT  60
190600200610     C                     EXSR SEC
190700200610     C*
190800200610     C*  UPDATE INTERVENING POSITION RECORDS
190900200610     C*   FOR EACH NEW ACTION DATE
191000200610     C*
191100200610     C***********DPHKEY    SETGTDPOSH                77                   E19403
191200200610     C*
191300200610     C** WLDDTE IS DATE OF LAST DEPOT POSN. RECORD UPDATED
191400200610     C*
191500200610     C           WLDDTE    DOWLTWACTDT
191600200610     C           DPHKEY    SETGTDPOSH                77                   E19403
191700200610     C           DPHKND    READEDPOSH                    77
191800200610     C                     Z-ADDDDTE      WDT                             E19403
191900200610     C           *IN77     IFEQ '0'
192000200610     C           RECI      ANDNE'*'
192100200610     C           DDTE      ANDLEWACTDT
192200200610     C*
192300200610     C** SUBR U02 HAS TO RESET RECORD TO H IF LATER DATE ADDED AND
192400200610     C** A TEST IS MADE AGAINST WCOMPD SET TO ACTION  DATE WHEN U02
192500200610     C** CALLED HERE WHILST SET TO STORAGE DATE (WACTDT) IF FROM CHGPOS
192600200610     C*
192700200610     C                     Z-ADDWACTDT    WCOMPD
192800200610     C                     EXSR U02
192900200610     C*
193000200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
193100200610     C* OR DATE OF NEXT ACTION FOR THIS POSITION WHICHEVER IS LOWEST
193200200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
193300200610     C*
193400200610     C                     Z-ADDDDTE      WFRMDT
193500200610     C                     Z-ADDWACTDT    WTODAT  60
193600200610     C                     EXSR NEXT
193700200610     C                     Z-ADDWNEXTD    WTODAT  60
193800200610     C                     EXSR SEC
193900200610     C*
194000200610     C* BEFORE CHECKING PRINT, IF THIS DATE EQUAL TO NEXT ACTION DATE
194100200610     C* DO NOT PRINT BACKVALUATIONS AS ACTION MAY FURTHER AFFECT SETTMN
194200200610     C*
194300200610     C           DDTE      IFLT WACTDT
194400200610     C*
194500200610     C* IF FLAG WPRINT (SEE SUBR ACCUM) IS '1' SETOF 33,SETON 31,32,34
194600200610     C* AND EXSR PR01 TO PRINT OPBAL/ADJ.DUE/CLOBAL FOR LAST UPDATE/ADD
194700200610     C*
194800200610     C           WPRINT    IFEQ '1'
194900200610     C                     MOVEA'1101'    *IN,31
195000200610     C                     MOVEA'1'       *IN,52                          E14739
195100200610     C*
195200200610     C* WPRTDT IS DATE PRINTED ON OPBAL LINE
195300200610     C*
195400200610     C                     Z-ADDDDTE      WPRTDT
195500200610     C                     EXSR PR01
195600200610     C                     END
195700200610     C                     END
195800200610     C           DDTE      IFEQ WACTDT
195900200610     C           WCUPDE    SUB  1         WCUPDE
196000200610     C                     END
196100200610     C                     Z-ADDDDTE      WLDDTE
196200200610     C                     ELSE
196300200610     C*
196400200610     C* *IF 77 ON END OF FILE - FORCE END OF DO LOOP
196500200610     C*
196600200610     C   77                Z-ADDWACTDT    WLDDTE
196700200610     C                     END
196800200610     C*
196900200610     C                     END
197000200610     C*
197100200610     C*  AT END OF UPDATES ZEROISE DATE ACCUMULATORS
197200200610     C*
197300200610     C                     Z-ADD0         WDSNT
197400200610     C                     Z-ADD0         WDSNV
197500200610     C                     Z-ADD0         WDSNS
197600200610     C                     Z-ADD0         WDSRT
197700200610     C                     Z-ADD0         WDSRV
197800200610     C                     Z-ADD0         WDEXN
197900200610      *
198000200610     C                     ENDSR
198100200610      *
198200200610      *****************************************************************
198300200610      /EJECT
198400200610      *****************************************************************
198500200610      *                                                               *
198600200610      *  NW02   - NEW DATE FOR POSITION BEING PROCESSED IS READ IN -  *
198700200610      *           ESTABLISH LATEST DATE HELD FOR THIS                 *
198800200610      *           NEW DATE READ IN.(I.E. BALANCE AS AT DATE READ IN)  *
198900200610      *                                                               *
199000200610      *****************************************************************
199100200610      *
199200200610     C           NW02      BEGSR                            ** NW02 **
199300200610     C*
199400200610     C* CHANGE OF DATE - PROCESS NEW DATE IN
199500200610     C*
199600200610     C                     MOVE '0'       P31PRT  1
199700200610     C*
199800200610     C** ACCESS DEPOT POSITION RECORD DPOSNDF FOR LATEST POSITION
199900200610     C** DATE WHICH IS LESS THAN ACTION DATE
200000200610     C*
200100200610     C** CONSTRUCT KEY TO DEPOT POSITIONS HIST/CURR LF/DPOSH
200200200610     C*
200300200610     C***********          MOVE WBC       DSBR                            S01117
200400200610     C                     MOVE WBC       DSBA                            S01117
200500200610     C                     MOVE WSS       DSSC
200600200610     C**********           Z-ADDWDP       DDPT                                                CSD027
200700200610     C                     MOVE WDP       DDPT                                                CSD027
200800200610     C                     Z-ADDWACTDT    WDT
200900200610     C           DPHKEY    SETLLDPOSH                    77
201000200610     C*
201100200610     C*  77 ON MEANS RECORD MATCHES A DATE ON DPOSND FILE
201200200610     C*
201300200610     C           *IN77     IFEQ '1'
201400200610     C                     MOVE '1'       WEQUAL
201500200610     C           DPHKEY    READEDPOSH                    77
201600200610     C           RECI      IFNE '*'
201700200610     C                     GOTO ENDNW2
201800200610     C                     END
201900200610     C                     END
202000200610     C*
202100200610     C* IF NOT A DATE MATCH READ PREVIOUS ONE FOR LATEST EARLIER DATE
202200200610     C*
202300200610     C                     MOVE '0'       WEQUAL
202400200610     C           RP2LOP    TAG
202500200610     C*
202600200610     C                     READPDPOSH                    77
202700200610     C  N77      RECI      CABEQ'*'       RP2LOP
202800200610     C*
202900200610     C           ENDNW2    ENDSR                           ** ENDNW2 **
203000200610      *
203100200610      *****************************************************************
203200200610      /EJECT
203300200610      *****************************************************************
203400200610      *                                                               *
203500200610      *  CLRUPD - Subroutine to Clear fields in Format DPOSNDF.       *
203600200610      *                                                               *
203700200610      *****************************************************************
203800200610      *
203900200610     C           CLRUPD    BEGSR                           ** CLRUPD **
204000200610     C*
204100200610     C** CLEAR EACH FIELD - NO DEPOT POSITION EQUAL OR BEFORE THIS ACTION
204200200610     C*
204300200610     C                     Z-ADD0         DSNT
204400200610     C                     Z-ADD0         DSNV
204500200610     C                     Z-ADD0         DSNS
204600200610     C                     Z-ADD0         DSRT
204700200610     C                     Z-ADD0         DSRV
204800200610     C                     Z-ADD0         DEXN
204900200610     C                     Z-ADD0         DSCT
205000200610     C                     Z-ADD0         DSCV
205100200610      *
205200200610     C                     ENDSR
205300200610      *
205400200610      *****************************************************************
205500200610      /EJECT
205600200610      *****************************************************************
205700200610      *                                                               *
205800200610      *  ADDDAT - Subroutine to add Date accumulated changes to       *
205900200610      *           Position changes.                                   *
206000200610      *                                                               *
206100200610      *****************************************************************
206200200610      *
206300200610     C           ADDDAT    BEGSR                           ** ADDDAT **
206400200610     C*
206500200610     C** ADD EACH DATE ACCUMULATED FIELD TO POSITION FIELDS
206600200610     C*
206700200610     C                     ADD  WDSNT     WDSNTP
206800200610     C                     ADD  WDSNV     WDSNVP
206900200610     C                     ADD  WDSNS     WDSNSP
207000200610     C                     ADD  WDSRT     WDSRTP
207100200610     C                     ADD  WDSRV     WDSRVP
207200200610     C                     ADD  WDEXN     WDEXNP
207300200610      *
207400200610     C                     ENDSR
207500200610      *
207600200610      *****************************************************************
207700200610      /EJECT
207800200610      *****************************************************************
207900200610      *                                                               *
208000200610      *  NOPOSN - Subroutine called when there is no existing         *
208100200610      *           Position on a Security.                             *
208200200610      *                                                               *
208300200610      *****************************************************************
208400200610      *
208500200610     C           NOPOSN    BEGSR                           ** NOPOSN **
208600200610     C*
208700200610     C*  ZEROISE WLASTD (DATE OF LAST POSITION)
208800200610     C*  AND ZEROISE VALUE FIELDS
208900200610     C*
209000200610     C                     Z-ADD0         WLASTD
209100200610     C                     Z-ADD0         DDTE
209200200610     C                     Z-ADD0         DEXN
209300200610     C                     Z-ADD0         DSNT
209400200610     C                     Z-ADD0         DSNV
209500200610     C                     Z-ADD0         DSNS
209600200610     C                     Z-ADD0         DSRT
209700200610     C                     Z-ADD0         DSRV
209800200610     C                     Z-ADD0         TNLU
209900200610      *
210000200610     C                     ENDSR
210100200610      *
210200200610      *****************************************************************
210300200610      /EJECT
210400200610      *****************************************************************
210500200610      *                                                               *
210600200610      *  CHGPOS - Subroutine called on change of Position.            *
210700200610      *                                                               *
210800200610      *****************************************************************
210900200610      *
211000200610     C           CHGPOS    BEGSR                           ** CHGPOS **
211100200610     C*
211200200610     C*  UPDATE DEPOT POSITION RECORDS FROM LAST DATE UPDATED TO MOST
211300200610     C*  RECENT.
211400200610     C*
211500200610     C           STGKEY    SETLLDPOSH                    77
211600200610     C           STGKY2    READEDPOSH                    77               E19403
211700200610     C                     Z-ADDDDTE      STGDAT                          E19403
211800200610     C           WLDDTE    DOWLEWLASTD
211900200610     C***********STGKY2    READEDPOSH                    77               E19403
212000200610     C           *IN77     IFNE '1'
212100200610     C           RECI      ANDNE'*'
212200200610     C           DDTE      IFGT WLDDTE
212300200610     C*
212400200610     C** SUBR U02 HAS TO RESET RECORD TO H IF LATER DATE ADDED AND
212500200610     C** A TEST IS MADE AGAINST WCOMPD SET TO STORAGE DATE WHEN U02
212600200610     C** CALLED FROM WHILST SET TO ACTION DATE (WACTDT) IF FROM CH02
212700200610     C*
212800200610     C                     Z-ADDSTGDAT    WCOMPD
212900200610     C                     EXSR U02
213000200610     C*
213100200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
213200200610     C* OR DATE OF LAST POSITION WHICHEVER IS LOWEST
213300200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
213400200610     C*
213500200610     C                     Z-ADDDDTE      WFRMDT
213600200610     C                     Z-ADDWLASTD    WTODAT  60
213700200610     C                     EXSR NEXT
213800200610     C                     Z-ADDWNEXTD    WTODAT  60
213900200610     C                     EXSR SEC
214000200610     C*
214100200610     C                     Z-ADDDDTE      WLDDTE
214200200610     C*
214300200610     C* IF FLAG WPRINT (SEE SUBR ACCUM) IS '1' SETOF 33,SETON 31,32,34
214400200610     C* AND EXSR PR01 TO PRINT OPBAL/ADJ.DUE/CLOBAL FOR LAST UPDATE/ADD
214500200610     C*
214600200610     C           WPRINT    IFEQ '1'
214700200610     C                     MOVEA'1101'    *IN,31
214800200610     C                     MOVEA'1'       *IN,52                          E14739
214900200610     C*
215000200610     C* WPRTDT IS DATE PRINTED ON OPBAL LINE
215100200610     C*
215200200610     C                     Z-ADDDDTE      WPRTDT
215300200610     C                     EXSR PR01
215400200610     C                     END
215500200610     C***********          END                                            E20394
215600200610     C           STGKEY    CHAINDPOSH                77                   E19403
215700200610     C                     END                                            E20394
215800200610     C           STGKY2    READEDPOSH                    77               E19403
215900200610     C                     Z-ADDDDTE      STGDAT                          E19403
216000200610     C*
216100200610     C* ELSE 77 ON IS END OF FILE - FORCE END OF LOOP
216200200610     C*
216300200610     C                     ELSE
216400200610     C   77                Z-SUB1         WLASTD
216500200610     C                     END
216600200610     C                     END
216700200610     C*                                                                   E15549
216800200610     C** CHECK FOR ADJUSTMENTS TO ACCOUNT KEYS/POSITION SETTLEMENTS       E15549
216900200610     C** FROM THE LATEST POSITION UP TO THE EVENT CONTROL DATE.           E15549
217000200610     C*                                                                   E15549
217100200610     C           WLDDTE    IFLT STGDAT                                    E15549
217200200610     C                     Z-ADDSTGDAT    WFRMDT                          E15549
217300200610     C                     ELSE                                           E15549
217400200610     C                     Z-ADDWLDDTE    WFRMDT                          E15549
217500200610     C                     END                                            E15549
217600200610     C                     Z-ADDECD       WTODAT                          E15549
217700200610     C           WTODAT    IFGT WFRMDT                                    E15549
217800200610     C                     EXSR SEC                                       E15549
217900200610     C                     END                                            E15549
218000200610     C***********          MOVEL'N'       COUPDX  1                E15549 E29307
218100200610     C*
218200200610     C* ZEROISE ALL ACCUMULATORS AFTER UPDATING HAS OCCURRED
218300200610     C*
218400200610     C*   DATE ACCUMULATORS
218500200610     C*
218600200610     C                     Z-ADD0         WDSNT
218700200610     C                     Z-ADD0         WDSNV
218800200610     C                     Z-ADD0         WDSNS
218900200610     C                     Z-ADD0         WDSRT
219000200610     C                     Z-ADD0         WDSRV
219100200610     C                     Z-ADD0         WDEXN
219200200610     C*
219300200610     C*   POSITION ACCUMULATORS
219400200610     C*
219500200610     C                     Z-ADD0         WDSNTP
219600200610     C                     Z-ADD0         WDSNVP
219700200610     C                     Z-ADD0         WDSNSP
219800200610     C                     Z-ADD0         WDSRTP
219900200610     C                     Z-ADD0         WDSRVP
220000200610     C                     Z-ADD0         WDEXNP
220100200610      *
220200200610     C           ENDCHP    ENDSR                           **ENDCHP**
220300200610      *
220400200610      *****************************************************************
220500200610      /EJECT
220600200610      *****************************************************************
220700200610      *                                                               *
220800200610      *  U01    - Subroutine to Update Positions with Actions on this *
220900200610      *           Date for each existing Position Date with Actions.  *
221000200610      *                                                               *
221100200610      *****************************************************************
221200200610      *
221300200610     C           U01       BEGSR                           ** U01 **
221400200610     C*
221500200610     C** DETERMINE IF LAST DATE FOR POSITION
221600200610     C*
221700200610     C           DDTE      IFLT WLASTD
221800200610     C                     MOVE 'H'       RECI
221900200610     C                     ELSE
222000200610     C           DDTE      IFEQ WLASTD
222100200610     C           WCOMPD    ANDGTDDTE
222200200610     C                     MOVE 'H'       RECI
222300200610     C                     END
222400200610     C                     END
222500200610     C*
222600200610     C**   UPDATE IN SUBR U01
222700200610     C*
222800200610     C*    - UPDATE USER DEPOT POSITION RECORD FOR EACH
222900200610     C*      EXISTING POSITION DATE WITH ACTIONS.
223000200610     C*
223100200610     C** ADD ACCUMULATED CHANGES TO CURRENT RECORD VALUES AND UPDATE
223200200610     C*
223300200610     C***IF*COUPON*DATE*CROSSED*RESET*EX-COUPON*NOMINAL************E15549 E29307
223400200610     C*                                                                   E15549
223500200610     C***********COUPDX    IFEQ 'Y'                                E15549 E29307
223600200610     C***********          Z-ADD*ZERO     DEXN                     E15549 E29307
223700200610     C***********          END                                     E15549 E29307
223800200610     C*                                                                   E15549
223900200610     C                     Z-ADDDDTE      ZECD                            E34512
224000200610     C                     EXSR ZLCD                                      E34512
224100200610     C           ZZLCD     IFGE WLDDTE                                    E34512
224200200610     C                     Z-ADD*ZERO     DEXN                            E34512
224300200610     C                     END                                            E34512
224400200610     C                     ADD  WDSNT     DSNT
224500200610     C                     ADD  WDSNV     DSNV
224600200610     C                     ADD  WDSNS     DSNS
224700200610     C                     ADD  WDEXN     DEXN
224800200610     C                     ADD  WDSRT     DSRT
224900200610     C                     ADD  WDSRV     DSRV
225000200610     C*
225100200610     C* IF TRADE DATE BAL OR VALUE DATE BAL UPDATE DATE LAST CHGD DATE
225200200610     C* AS APPROPRIATE WITH RUN DATE
225300200610     C*
225400200610     C           WDSNT     IFNE 0
225500200610     C                     Z-ADDRUND      DSCT
225600200610     C                     END
225700200610     C           WDSNV     IFNE 0
225800200610     C                     Z-ADDRUND      DSCV
225900200610     C                     END
226000200610     C*
226100200610     C                     UPDATDPOSNDF
226200200610     C                     ADD  1         WCUPDE  50
226300200610     C                     Z-ADDDDTE      WLDDTE
226400200610      *
226500200610     C           ENDU01    ENDSR                            **ENDU01**
226600200610      *
226700200610      *****************************************************************
226800200610      /EJECT
226900200610      *****************************************************************
227000200610      *                                                               *
227100200610      *  U02   - Subroutine to Update intervening Positions for each  *
227200200610      *          existing Position Date with no Actions.              *
227300200610      *                                                               *
227400200610      *****************************************************************
227500200610      *
227600200610     C           U02       BEGSR                           ** U02 **
227700200610     C*
227800200610     C** DETERMINE IF LAST DATE FOR POSITION
227900200610     C*
228000200610     C           DDTE      IFLT WLASTD
228100200610     C                     MOVE 'H'       RECI
228200200610     C                     ELSE
228300200610     C           DDTE      IFEQ WLASTD
228400200610     C           WCOMPD    ANDGTDDTE
228500200610     C                     MOVE 'H'       RECI
228600200610     C                     END
228700200610     C                     END
228800200610     C*
228900200610     C** ADD ACCUMULATED CHANGES TO CURRENT RECORD VALUES AND UPDATE
229000200610     C*
229100200610     C***IF*COUPON*DATE*CROSSED*,RESET EX-COUPON NOMINAL           E15549 E29307
229200200610     C*                                                                   E15549
229300200610     C***********COUPDX    IFEQ 'Y'                                E15549 E29307
229400200610     C***********          Z-ADD*ZERO     DEXN                     E15549 E29307
229500200610     C***********          END                                     E15549 E29307
229600200610     C                     Z-ADDDDTE      ZECD                            E34512
229700200610     C                     EXSR ZLCD                                      E34512
229800200610     C           ZZLCD     IFGE WLDDTE                                    E34512
229900200610     C                     Z-ADD*ZERO     DEXN                            E34512
230000200610     C                     END                                            E34512
230100200610     C*                                                                   E15549
230200200610     C                     ADD  WDSNTP    DSNT
230300200610     C                     ADD  WDSNVP    DSNV
230400200610     C                     ADD  WDSNSP    DSNS
230500200610     C                     ADD  WDEXNP    DEXN
230600200610     C                     ADD  WDSRTP    DSRT
230700200610     C                     ADD  WDSRVP    DSRV
230800200610     C*
230900200610     C* IF TRADE DATE BAL OR VALUE DATE BAL, UPDATE DATE LAST CHGD DATE
231000200610     C* AS APPROPRIATE WITH RUN DATE
231100200610     C*
231200200610     C           WDSNTP    IFNE 0
231300200610     C                     Z-ADDRUND      DSCT
231400200610     C                     END
231500200610     C           WDSNVP    IFNE 0
231600200610     C                     Z-ADDRUND      DSCV
231700200610     C                     END
231800200610     C                     UPDATDPOSNDF
231900200610     C                     ADD  1         WCUPDE  50
232000200610     C                     Z-ADDDDTE      WLDDTE
232100200610     C*
232200200610     C           ENDU02    ENDSR                            **ENDU02**
232300200610      *
232400200610      *****************************************************************
232500200610      /EJECT
232600200610      *****************************************************************
232700200610      *                                                               *
232800200610      *  W01    - Subroutine to Write a new Position Record for each  *
232900200610      *           Position for a new Date.                            *
233000200610      *                                                               *
233100200610      *****************************************************************
233200200610      *
233300200610     C           W01       BEGSR                           ** W01 **
233400200610     C*
233500200610     C* RETRIEVE LATEST RECORD UPDATED OR CLEAR FIELDS
233600200610     C*
233700200610     C           STGKEY    SETGTDPOSH
233800200610     C                     READPDPOSH                    77
233900200610     C           *IN77     IFEQ '1'
234000200610     C***********WSBC      ORNE DSBR                                      S01117
234100200610     C           WSBC      ORNE DSBA                                      S01117
234200200610     C           WSSS      ORNE DSSC
234300200610     C           WSDP      ORNE DDPT
234400200610     C                     EXSR CLRUPD
234500200610     C                     END
234600200610     C*
234700200610     C* IF LAST DATE FOR POSITION AND ACTION DATE GT LAST POSN DATE
234800200610     C* RECI IS MADE EQUAL TO D - ELSE RECI IS EQUAL TO H
234900200610     C*
235000200610     C           COMARA    IFNE STGARA
235100200610     C           STGDAT    ANDGTWLASTD
235200200610     C           *IN89     OREQ '1'
235300200610     C           STGDAT    ANDGTWLASTD
235400200610     C                     MOVE 'D'       RECI
235500200610     C                     ELSE
235600200610     C                     MOVE 'H'       RECI
235700200610     C                     END
235800200610     C*
235900200610     C* SET UP KEY FIELDS FROM ACTION RECORD
236000200610     C*
236100200610     C***********          MOVE WSBC      DSBR                            S01117
236200200610     C                     MOVE WSBC      DSBA                            S01117
236300200610     C                     MOVE WSSS      DSSC
236400200610     C**********           Z-ADDWSDP      DDPT                                                CSD027
236500200610     C                     MOVE WSDP      DDPT                                                CSD027
236600200610     C                     Z-ADDSTGDAT    DDTE
236700200610     C*
236800200610     C** ADD ACCUMULATED CHANGES TO CURRENT RECORD VALUES AND UPDATE
236900200610     C*
237000200610     C** IF COUPON DATE CROSSED, RESET EX-COUPON NOMINAL                  E15549
237100200610     C*                                                                   E15549
237200200610     C***********COUPDX    IFEQ 'Y'                                E15549 E29307
237300200610     C***********          Z-ADD*ZERO     DEXN                     E15549 E29307
237400200610     C***********          END                                     E15549 E29307
237500200610     C***********                                                  E15549 E29307
237600200610     C***********DDTE      ADD  1         ZECD                     E29307 E34512
237700200610     C                     Z-ADDDDTE      ZECD                            E34512
237800200610     C                     EXSR ZLCD                                      E29307
237900200610     C***********ZZLCD     IFGT WLDDTE                             E29307 E34512
238000200610     C           ZZLCD     IFGE WLDDTE                                    E34512
238100200610     C                     Z-ADD*ZERO     DEXN                            E29307
238200200610     C                     END                                            E29307
238300200610     C                     ADD  WDSNT     DSNT
238400200610     C                     ADD  WDSNV     DSNV
238500200610     C                     ADD  WDSNS     DSNS
238600200610     C                     ADD  WDEXN     DEXN
238700200610     C                     ADD  WDSRT     DSRT
238800200610     C                     ADD  WDSRV     DSRV
238900200610     C*
239000200610     C                     Z-ADD0         TNLU
239100200610     C*
239200200610     C* IF TRADE DATE BAL OR VALUE DATE BAL UPDATE DATE LAST CHGD DATE
239300200610     C* AS APPROPRIATE WITH RUN DATE
239400200610     C*
239500200610     C           DSNT      IFNE 0
239600200610     C                     Z-ADDRUND      DSCT
239700200610     C                     END
239800200610     C           DSNV      IFNE 0
239900200610     C                     Z-ADDRUND      DSCV
240000200610     C                     END
240100200610     C*                                                                   038963
240200200610     C           PROT      IFEQ '6'                                       038963
240300200610     C                     Z-ADD*ZEROS    DEXN                            038963
240400200610     C                     END                                            038963
240500200610     C*
240600200610     C* INSERT NEW POSITION RECORD
240700200610     C*
240800200610     C                     WRITEDPOSNDF
240900200610     C*
241000200610     C* COUNT NO OF RECORDS ADDED AND STORE LAST DATE HELD FOR POSN.
241100200610     C*
241200200610     C                     ADD  1         WCADDP  50
241300200610     C                     Z-ADDDDTE      WLDDTE
241400200610     C*
241500200610     C           ENDW01    ENDSR                           **ENDW01**
241600200610      *
241700200610      *****************************************************************
241800200610      /EJECT
241900200610      *****************************************************************
242000200610      *                                                               *
242100200610      *  SEC    - Subroutine to produce Adjusted or New Account Keys  *
242200200610      *           and Position Settlements for each revised/new Depot *
242300200610      *           Positions.                                          *
242400200610      *                                                               *
242500200610      * INPUT: FROM DATE  -  DATE OF LAST ACTION/POSITION             *
242600200610      *        TO DATE    -  DATE OF NEXT POSITION ON DEPOT POSN FILE *
242700200610      *                      AS DETERMINED BY SUBR 'NEXT' BEFORE EACH *
242800200610      *                      CALL TO P/SEC.                           *
242900200610      *        BALANCES   -  NEW AND DIFFERENT                        *
243000200610      *                                                               *
243100200610      *****************************************************************
243200200610      *
243300200610     C           SEC       BEGSR                           ** SEC **
243400200610     C*
243500200610     C*
243600200610     C**ACCES*LF/SECED*SECURITY*EVENT*FILE*FORMAT*SEDEVDF*FOR*****        E15549
243700200610     C*       ACCES LF/SECED SECURITY EVENT FILE FOR                      E15549
243800200610     C*       SECURITY ACTIONS BETWEEN LAST POSN DATE (FROM DATE)
243900200610     C*       AND LESS THAN TO DATE (NEXT ACTION DATE INPUT OR TO END
244000200610     C*       OF DATES FOR THIS POSN ON CHANGE OF POSITION)
244100200610     C*
244200200610     C*
244300200610     C***********SECKEY    SETLLSEDEVDF                  77               E15549
244400200610     C***********          MOVEL'N'       COUPDX                   E15549 E29307
244500200610     C           SECKEY    SETLLSECED                    77               E15549
244600200610     C*
244700200610     C*
244800200610     C* GET RECORD ON LF/SECED AS DETAILED ABOVE
244900200610     C*
245000200610     C                     Z-ADD0         WPCNTI  50
245100200610     C                     MOVE '0'       *IN79
245200200610     C           *IN79     DOWEQ'0'
245300200610     C*
245400200610     C                     MOVEL'N'       WRVPOS  1                                           260331
245500200610     C*
245600200610     C***STORE*NOM*CCY*FROM*SECTYD*AS*SEDEVDF*HAS*NMCY*FIELD*TOO*******   E20086
245700200610     C*
245800200610     C***********          MOVE NMCY      WNMCY                           E20086
245900200610     C***********SECK      READESEDEVDF                  79               E15549
246000200610     C           SECK      READESECED                    79               E15549
246100200610     C***********          MOVE WNMCY     NMCY                            E20086
246200200610     C*
246300200610     C***IF*EVENT*DATE*(SDED/SEDEVDF)*GT*TO*DATE**(WTODAT),*END*LOOP****  E15549
246400200610     C** IF EVENT DATE (SDED/SECED) GT TO DATE  (WTODAT), END LOOP        E15549
246500200610     C*
246600200610     C           SDED      IFGT WTODAT
246700200610     C                     MOVE '1'       *IN79
246800200610     C                     END
246900200610     C*
247000200610     C* IND 79 IS SET ON WHEN NO MORE ACTIONS FOR THIS SECURITY/PERIOD
247100200610     C** If S01510 is active, process ex-div before going to end          S01510
247200200610     C*
247300200610     C************IN79     CABEQ'1'       ENDSC1                          S01510
247400200610     C           *IN79     IFEQ '1'                                       S01510
247500200610     C           S01510    IFEQ 'Y'                                       S01510
247600200610     C                     EXSR #LEXDV                                    S01510
247700200610     C                     END                                            S01510
247800200610     C                     GOTO ENDSC1                                    S01510
247900200610     C                     END                                            S01510
248000200610     C                     MOVE RECI      WSRECI
248100200610     C*
248200200610     C***IF*EVENT*DATE*(SDED/SEDEVDF)*LT*FROM*DATE(WFRMDT),*IGNORE*****   E15549
248300200610     C***IF*EVENT*DATE*(SDED/SECED)*LT*FROM*DATE(WFRMDT),*IGNORE** E15549 051107
248400200610      ***  If the Event Date (from SECED) is Less Than or Equal To the    051107
248500200610      ***  From Date, it will not be affected, so ignore.                 051107
248600200610     C*
248700200610     C***********SDED      CABLTWFRMDT    ENDSC1                          051107
248800200610     C           SDED      IFLE WFRMDT                                    051107
248900200610     C           SDET      ANDNE'MA'                                      S01510
249000200610     C           SDED      ORLT WFRMDT                                    S01510
249100200610     C                     GOTO ENDSC1                                    051107
249200200610     C                     END                                            051107
249300200610     C*
249400200610     C** PROCESS SELECTED SECURITY EVENT RECORD
249500200610     C*
249600200610     C** RECORD SELECTED - IGNORE IF EVENT TYPE NOT DV/CP/PP/MA/MP
249700200610     C*
249800200610     C           SDET      IFNE 'DV'
249900200610     C           SDET      ANDNE'CP'
250000200610     C           SDET      ANDNE'PP'
250100200610     C           SDET      ANDNE'MA'
250200200610     C           SDET      ANDNE'MP'
250300200610     C                     GOTO ENDSC1
250400200610     C                     END
250500200610     C*                                                                   S01510
250600200610     C** If S01510 is active, ignore if event type is DV                  S01510
250700200610     C*                                                                   S01510
250800200610     C           S01510    IFEQ 'Y'                                       S01510
250900200610     C           SDET      ANDEQ'DV'                                      S01510
251000200610     C                     GOTO ENDSC1                                    S01510
251100200610     C                     END                                            S01510
251200200610     C*
251300200610      ***  This test now catered for above.                               051107
251400200610     C***RECORD*SELECTED*-*IGNORE*IF*EVENT*TYPE*=*PP*AND*EVENT*DATE****   051107
251500200610     C***IS*EQUAL*TO*FROM*DATE**(WFRMDT)*******************************   051107
251600200610     C***********                                                         051107
251700200610     C***********SDET      IFEQ 'PP'                                      051107
251800200610     C***********SDED      ANDEQWFRMDT                                    051107
251900200610     C***********          GOTO ENDSC1                                    051107
252000200610     C***********          END                                            051107
252100200610     C***********                                                  E15549 051107
252200200610     C***NEXT*POSITION*TO*BE*PROCESSED*WILL*CROSS*A*COUPON/DIVIDENDE15549 E29307
252300200610     C***********                                                  E15549 051107
252400200610     C***********SDET      IFEQ 'CP'                               E15549 E29307
252500200610     C***********SDET      OREQ 'DV'                               E15549 E29307
252600200610     C***********          MOVEL'Y'       COUPDX                   E15549 E29307
252700200610     C***********          END                                     E15549 E29307
252800200610     C*
252900200610     C** RECORD SELECTED - IGNORE IF EVENT TYPE = DV,CP,MP,MA AND
253000200610     C** EVENT DATE IS EQUAL TO NEW DATE = WTODAT
253100200610     C*
253200200610     C***********SDET      IFEQ 'DV'                                      S01510
253300200610     C***********SDET      OREQ 'CP'                                      S01510
253400200610     C***********SDET      OREQ 'MP'                                      S01510
253500200610     C***********SDET      OREQ 'MA'                                      S01510
253600200610     C***********SDED      IFEQ WTODAT                                    S01510
253700200610     C           SDET      IFEQ 'MA'                                      S01510
253800200610     C           SDED      ANDEQWTODAT                                    S01510
253900200610     C           ECD       ANDNEWTODAT                                    S01510
254000200610     C                     GOTO ENDSC1
254100200610     C                     END
254200200610     C***********          END                                            S01510
254300200610     C*                                                                   E15549
254400200610     C** CHECK IF EVENT IS BEING ACTIONED IN THIS RUN                     E15549
254500200610     C*                                                                   E15549
254600200610     C           SECDKY    CHAINSECACE               77                   E15549
254700200610     C*                                                                   E15549
254800200610     C           *IN77     IFEQ '1'                                       E15549
254900200610     C*                                                                   E15549
255000200610     C** IF NON-DIARY EVENT (COUPON OR MATURITY) SET ACTION DATES. ACTION E15549
255100200610     C** PROCESSED PRIOR TO THIS RUN SO PROGRAM MAY CHECK FOR ADJUSTMENTS E15549
255200200610     C*                                                                   E15549
255300200610     C           SDET      IFEQ 'CP'                                      E15549
255400200610     C           SDET      OREQ 'MA'                                      E15549
255500200610     C                     Z-ADDSDED      SDAD                            E15549
255600200610     C                     Z-ADDSDED      SDDT                            E15549
255700200610     C                     END                                            E15549
255800200610     C*                                                                   E15549
255900200610     C                     ELSE                                           E15549
256000200610     C           RECI      IFEQ 'R'                                                           260331
256100200610     C           SAAT      IFEQ 'DV'                                                          260331
256200200610     C           SAAT      OREQ 'MP'                                                          260331
256300200610     C           SAAT      OREQ 'PP'                                                          260331
256400200610     C                     MOVEL'Y'       WRVPOS                                              260331
256500200610     C                     ENDIF                                                              260331
256600200610     C                     ENDIF                                                              260331
256700200610     C*                                                                   E15549
256800200610     C**IF*EVENT*ACTIONED*IN THIS RUN, SE2390 WILL DO THE POSN SETTE15549 051107
256900200610     C*********************                                        E15549 051107
257000200610     C*********************GOTO ENDSC1                             E15549 051107
257100200610     C*                                                                   051107
257200200610     C*  LET THIS PROGRAM DO THE PROCESSING THAT SE2390 WON'T DO.         051107
257300200610     C*                                                                   051107
257400200610     C           SDET      IFEQ 'CP'                                      051107
257500200610     C           SDET      OREQ 'MA'                                      051107
257600200610     C                     Z-ADD*ZERO     SDAD                            051107
257700200610     C                     Z-ADD*ZERO     SDDT                            051107
257800200610     C***********AKRI      IFNE 'Y'                                051107 S01510
257900200610     C***********          Z-ADDSDED      SDAD                     051107 S01510
258000200610     C***********          END                                     051107 S01510
258100200610     C           PSRI      IFNE 'Y'                                       051107
258200200610     C                     Z-ADDSDED      SDDT                            051107
258300200610     C                     END                                            051107
258400200610     C                     ELSE                                           051107
258500200610     C           AKRI      IFEQ 'Y'                                       051107
258600200610     C                     Z-ADD*ZERO     SDAD                            051107
258700200610     C                     END                                            051107
258800200610     C           PSRI      IFEQ 'Y'                                       051107
258900200610     C                     Z-ADD*ZERO     SDDT                            051107
259000200610     C                     END                                            051107
259100200610     C                     END                                            051107
259200200610     C*                                                                   E15549
259300200610     C                     END                                            E15549
259400200610     C*
259500200610     C** RECORD SELECTED - IGNORE IF BOTH ACTIONED DATES ARE ZERO
259600200610     C*
259700200610     C           SDAD      IFEQ 0
259800200610     C           SDDT      ANDEQ0
259900200610     C                     GOTO ENDSC1
260000200610     C                     END
260100200610     C*
260200200610     C** CALCULATE BALANCES THAT FOLLOWING SUBROUTINES WILL OPERATE UPON
260300200610     C*
260400200610     C***IF*ACTIONED*DATE*(EVENT)*IS*EQUAL*TO*RUN*DATE*USE*NEW*BALANCES** E15549
260500200610     C** PROGRAM NOW ONLY WORKS OUT DIFFERENCES TO PROCESS DUE TO         E15549
260600200610     C** BACKVALUATIONS. SECURITY EVENTS ARE PROCESSED IN SE2390          E15549
260700200610     C*
260800200610     C***IF*WDIFF*IS*SET*TO*Y*IN*COUPON/MORTPY/MATURE*SUBRS,THEN*THE***   E20086
260900200610     C***IF*WDIFF*IS*SET*TO*Y*IN*COUPON/MATURE*SUBROUTINES,THEN*THE 20086 E21573
261000200610     C** IF WDIFF IS SET TO Y IN COUPON SUBROUTINE, THEN THE              E21573
261100200610     C** INTEREST CALCULATING PGMS ZACCRC/ZACCRD MUST BE CALLED WITH
261200200610     C** STATUS OF A AND THEN B AND A SUBTRACTION DONE ON RESULTS
261300200610     C*
261400200610     C                     MOVE ' '       WDIFF   1
261500200610     C*
261600200610     C***********SDAD      IFEQ RUND                                      E15549
261700200610     C*
261800200610     C** CALCULATE CUM-COUPON VALUE
261900200610     C*
262000200610     C***********          Z-ADDDSNV      WBDSNV 150                      E15549
262100200610     C***********          Z-ADDDEXN      WBDEXN 150                      E15549
262200200610     C***********DSNV      SUB  DEXN      WCUMCP 150                      E15549
262300200610     C***********          ELSE                                           E15549
262400200610     C*
262500200610     C** ELSE USE DIFFERENCE ONLY  BALANCES
262600200610     C*
262700200610     C                     MOVE 'Y'       WDIFF
262800200610     C                     Z-ADDWDSNTP    WBDSNT 150                      E19610
262900200610     C                     Z-ADDWDSNVP    WBDSNV 150
263000200610     C                     Z-ADDWDEXNP    WBDEXN 150
263100200610     C           WBDSNV    SUB  WBDEXN    WCUMCP 150                      E15549
263200200610     C           DSNV      SUB  DEXN      WDPSN  150                      157260
263300200610     C***********WBDSNV    SUB  WBDEXN    WCUMCP                          E15549
263400200610     C***********          END                                            E15549
263500200610     C*
263600200610     C** EXECUTE SUBROUTINE SECTIN TO RETRIEVE SECURITY RECORD
263700200610     C*
263800200610     C***********WBDSNV    IFEQ 0                                         E24421
263900200610     C***********WBDEXN    ANDEQ0                                         E24421
264000200610     C***********          GOTO ENDSC1                                    E24421
264100200610     C***********          END                                            E24421
264200200610     C*
264300200610     C                     MOVE SDSN      WDSSC
264400200610     C                     EXSR SECTIN
264500200610     C** Execute Subroutine INVTIN to retrieve INVESTMENT Record          E23169
264600200610     C*                                                                   E23169
264700200610     C                     EXSR INVTIN                                    E23169
264800200610     C*                                                                   E23169
264900200610     C*
265000200610     C** EXECUTE SUBROUTINES DEPENDING ON ACTION TYPE
265100200610     C*
265200200610     C           SDET      CASEQ'DV'      DIVIDN
265300200610     C           SDET      CASEQ'CP'      COUPON
265400200610     C                     END
265500200610     C*
265600200610     C           SDDT      IFNE 0
265700200610     C           SDET      CASEQ'PP'      PARTPY
265800200610     C           SDET      CASEQ'MP'      MORTPY
265900200610     C           SDET      CASEQ'MA'      MATURE
266000200610     C                     END
266100200610     C                     END
266200200610     C*
266300200610     C* IF PP,MP,MA ACTIONED (SDDT NOT 0) OR DV,CP ACTIONED
266400200610     C* INCREMENT COUNT AND TEST WHEN NO MORE -  IF NOT ZERO THEN
266500200610     C* ADD 1 TO COUNT OF POSITIONS ACTIONED
266600200610     C*
266700200610     C           SDDT      IFNE 0
266800200610     C           SDET      OREQ 'DV'
266900200610     C           SDET      OREQ 'CP'
267000200610     C                     ADD  1         WPCNTI
267100200610     C                     END
267200200610     C*
267300200610     C           ENDSC1    TAG                             **ENDSC1**
267400200610     C*
267500200610     C                     END
267600200610     C*
267700200610     C* ADD TO COUNT OF POSITIONS PROCESSED
267800200610     C*
267900200610     C           WPCNTI    IFGT 0
268000200610     C                     ADD  1         WCPOSK  50
268100200610     C                     END
268200200610     C*
268300200610     C           ENDSEC    ENDSR                           **ENDSEC**
268400200610     C*
268500200610     C*****************************************************************
268600200610     C/EJECT                                                              S01510
268700200610     C*****************************************************************   S01510
268800200610     C*                                                               *   S01510
268900200610     C*  #LEXDV - Subroutine for dividend payments based on ex-date   *   S01510
269000200610     C*                                                               *   S01510
269100200610     C*****************************************************************   S01510
269200200610     C*                                                                   S01510
269300200610     C           #LEXDV    BEGSR                                          S01510
269400200610     C*                                                                   S01510
269500200610     C           SECKEY    SETLLSEDEVD1                  77               S01510
269600200610     C*                                                                   S01510
269700200610     C** Do until all records for the security are read                   S01510
269800200610     C*                                                                   S01510
269900200610     C           *IN77     DOUEQ'1'                                       S01510
270000200610     C***********SDSN      READESEDEVD1                  77        S01510 082248
270100200610     C           WSSS      READESEDEVD1                  77               082248
270200200610     C*                                                                   S01510
270300200610     C** Process if Ex-date is within the range specified                 S01510
270400200610     C*                                                                   S01510
270500200610     C           *IN77     IFEQ '0'                                       S01510
270600200610     C           SDXD      ANDGTWFRMDT                                    S01510
270700200610     C           SDXD      ANDLEWTODAT                                    S01510
270800200610     C*                                                                   S01510
270900200610     C                     MOVEL'N'       WRVPOS                                              260331
271000200610      *                                                                                       260331
271100200610     C           SECDKY    CHAINSECACE               80                   S01510
271200200610     C           *IN80     IFEQ '0'                                       S01510
271300200610     C           RECI      IFEQ 'R'                                                           260331
271400200610     C           SAAT      ANDEQ'DV'                                                          260331
271500200610     C                     MOVEL'Y'       WRVPOS                                              260331
271600200610     C                     ENDIF                                                              260331
271700200610     C           AKRI      IFEQ 'Y'                                       S01510
271800200610     C                     Z-ADD0         SDAD                            S01510
271900200610     C                     END                                            S01510
272000200610     C           PSRI      IFEQ 'Y'                                       S01510
272100200610     C                     Z-ADD0         SDDT                            S01510
272200200610     C                     END                                            S01510
272300200610     C                     END                                            S01510
272400200610     C*                                                                   S01510
272500200610     C           SDAD      IFNE *ZEROS                                    S01510
272600200610     C           SDDT      ORNE *ZEROS                                    S01510
272700200610     C                     MOVE 'Y'       WDIFF                           S01510
272800200610     C                     Z-ADDWDSNTP    WBDSNT                          S01510
272900200610     C                     EXSR DIVIDN                                    S01510
273000200610     C           SDDT      IFNE *ZEROS                                    S01510
273100200610     C                     ADD  1         WPCNTI                          S01510
273200200610     C                     END                                            S01510
273300200610     C                     END                                            S01510
273400200610     C*                                                                   S01510
273500200610     C                     END                                            S01510
273600200610     C                     END                                            S01510
273700200610     C*                                                                   S01510
273800200610     C                     ENDSR                                          S01510
273900200610      *                                                                   S01510
274000200610      *****************************************************************   S01510
274100200610      /EJECT
274200200610      *****************************************************************
274300200610      *                                                               *
274400200610      *  ACCUM  - Subroutine to accumulate changes for this Date.     *
274500200610      *                                                               *
274600200610      *****************************************************************
274700200610      *
274800200610     C           ACCUM     BEGSR                           ** ACCUM **
274900200610     C*
275000200610     C*  ACCUMULATE ALL MOVEMENTS/TRADES/SETTLEMENTS FOR ONE DATE
275100200610     C*
275200200610     C*  PRINT OCCURS ONLY IF A SETTLEMENT BALANCE IS CHANGED
275300200610     C*  SET FLAG WPRINT TO '1' IF A SETTLEMENT BALANCE CHG OCCURS
275400200610     C*  THIS FLAG REMAINS ON FOR CH01/CH02 TO UPDATE INTERVENING
275500200610     C*  POSITIONS AND IS SET OFF IN NW01 - NEW POSITION IN SUBR.
275600200610     C*
275700200610     C*  THIS ACTION ITSELF MAY AFFECT SETTLEMENTS OR NOT - FLAG WACSET
275800200610     C*  IS SET/UNSET BY EACH ACTION THROUGH ACCUM AND TESTED P/MAIN
275900200610     C*
276000200610     C                     MOVE '0'       WACSET  1
276100200610     C                     MOVE '0'       *IN53                           E14739
276200200610     C*
276300200610     C*  DEPOT MOVEMENT
276400200610     C*
276500200610     C           *IN01     IFEQ '1'
276600200610     C*
276700200610     C* IF A REVERSAL REVERSE THE SIGN OF THE NOMINAL
276800200610     C*
276900200610     C           WREVER    IFEQ 'Y'
277000200610     C                     Z-SUBDMNA      DMNA
277100200610     C                     END
277200200610     C/COPY WNCPYSRC,SE2370C014
277300200610     C*
277400200610     C**  SETT.BAL IS ALTERED WHEN WDSNS IS CHANGED, AND THE MOVEMENT
277500200610     C**  IS LATER PRINTED. TO PRINT NEG NO'S IF MINUS MOVEMENT SET 65
277600200610     C**  ON IF WDSNS IS GREATER AT END OR OFF IF LESS
277700200610     C*
277800200610     C                     Z-ADDWDSNS     W65IND 150
277900200610     C*
278000200610     C**  TYPE IS USER TRANSFER IN, DATE BASIS IS T = TRADE
278100200610     C*
278200200610     C           WTYPE     IFEQ 'UI'
278300200610     C           WDBASE    ANDEQ'T'
278400200610     C*
278500200610     C* ADD TO TRADE NOMINAL
278600200610     C*
278700200610     C                     ADD  DMNA      WDSNT
278800200610     C                     END
278900200610     C*
279000200610     C**  TYPE IS USER TRANSFER IN, DATE BASIS IS C = VALUE AND SETTL.
279100200610     C*
279200200610     C           WTYPE     IFEQ 'UI'
279300200610     C           WDBASE    ANDEQ'C'
279400200610     C*
279500200610     C* ADD TO VALUE NOMINAL AND SETTLEMENT NOMINAL
279600200610     C*
279700200610     C                     ADD  DMNA      WDSNV
279800200610     C                     ADD  DMNA      WDSNS
279900200610     C                     MOVE '1'       WPRINT
280000200610     C                     MOVE '1'       WACSET
280100200610     C                     END
280200200610     C*
280300200610     C**  TYPE IS USER TRANSFER IN, DATE BASIS IS A = ALL DATES
280400200610     C*
280500200610     C           WTYPE     IFEQ 'UI'
280600200610     C           WDBASE    ANDEQ'A'
280700200610     C*
280800200610     C* ADD TO NOMINAL TRADE, SETTLEMENT AND VALUE
280900200610     C*
281000200610     C                     ADD  DMNA      WDSNT
281100200610     C                     ADD  DMNA      WDSNV
281200200610     C                     ADD  DMNA      WDSNS
281300200610     C                     MOVE '1'       WPRINT
281400200610     C                     MOVE '1'       WACSET
281500200610     C                     END
281600200610     C*
281700200610     C**  TYPE IS USER TRANSFER OUT, DATE BASIS IS T = TRADE
281800200610     C*
281900200610     C           WTYPE     IFEQ 'UO'
282000200610     C           WDBASE    ANDEQ'T'
282100200610     C*
282200200610     C* SUB FROM TRADE NOMINAL
282300200610     C*
282400200610     C                     SUB  DMNA      WDSNT
282500200610     C                     END
282600200610     C*
282700200610     C**  TYPE IS USER TRANSFER OUT, DATE BASIS IS C = VALUE AND SETTL.
282800200610     C*
282900200610     C           WTYPE     IFEQ 'UO'
283000200610     C           WDBASE    ANDEQ'C'
283100200610     C*
283200200610     C* SUB FROM VALUE NOMINAL AND SETTLEMENT NOMINAL
283300200610     C*
283400200610     C                     SUB  DMNA      WDSNV
283500200610     C                     SUB  DMNA      WDSNS
283600200610     C                     MOVE '1'       WPRINT
283700200610     C                     MOVE '1'       WACSET
283800200610     C                     END
283900200610     C*
284000200610     C**  TYPE IS USER TRANSFER OUT, DATE BASIS IS A = ALL DATES
284100200610     C*
284200200610     C           WTYPE     IFEQ 'UO'
284300200610     C           WDBASE    ANDEQ'A'
284400200610     C*
284500200610     C* SUB FROM NOMINAL TRADE, SETTLEMENT AND VALUE
284600200610     C*
284700200610     C                     SUB  DMNA      WDSNT
284800200610     C                     SUB  DMNA      WDSNV
284900200610     C                     SUB  DMNA      WDSNS
285000200610     C                     MOVE '1'       WPRINT
285100200610     C                     MOVE '1'       WACSET
285200200610     C                     END
285300200610     C*
285400200610     C** TYPE IS CUSTOMER WALK IN
285500200610     C*
285600200610     C**  TYPE IS CUST WALK IN, DATE BASIS IS T = TRADE
285700200610     C*
285800200610     C           WTYPE     IFEQ 'WI'
285900200610     C           WDBASE    ANDEQ'T'
286000200610     C*
286100200610     C* ADD TO TRADE NOMINAL
286200200610     C*
286300200610     C                     ADD  DMNA      WDSNT
286400200610     C                     END
286500200610     C*
286600200610     C**  TYPE IS CUST WALK IN, DATE BASIS IS C = VALUE AND SETTL.
286700200610     C*
286800200610     C           WTYPE     IFEQ 'WI'
286900200610     C           WDBASE    ANDEQ'C'
287000200610     C*
287100200610     C* ADD TO VALUE NOMINAL AND SETTLEMENT NOMINAL
287200200610     C*
287300200610     C                     ADD  DMNA      WDSNV
287400200610     C                     ADD  DMNA      WDSNS
287500200610     C                     MOVE '1'       WPRINT
287600200610     C                     MOVE '1'       WACSET
287700200610     C                     END
287800200610     C*
287900200610     C**  TYPE IS CUST WALK IN, DATE BASIS IS A = ALL DATES
288000200610     C*
288100200610     C           WTYPE     IFEQ 'WI'
288200200610     C           WDBASE    ANDEQ'A'
288300200610     C*
288400200610     C* ADD TO NOMINAL TRADE, SETTLEMENT AND VALUE
288500200610     C*
288600200610     C                     ADD  DMNA      WDSNT
288700200610     C                     ADD  DMNA      WDSNV
288800200610     C                     ADD  DMNA      WDSNS
288900200610     C                     MOVE '1'       WPRINT
289000200610     C                     MOVE '1'       WACSET
289100200610     C                     END
289200200610     C*
289300200610     C**  TYPE IS CUST WALK OUT, DATE BASIS IS T = TRADE
289400200610     C*
289500200610     C           WTYPE     IFEQ 'WO'
289600200610     C           WDBASE    ANDEQ'T'
289700200610     C*
289800200610     C* SUB FROM TRADE NOMINAL
289900200610     C*
290000200610     C                     SUB  DMNA      WDSNT
290100200610     C                     END
290200200610     C*
290300200610     C**  TYPE IS CUST WALK OUT, DATE BASIS IS C = VALUE AND SETTL.
290400200610     C*
290500200610     C           WTYPE     IFEQ 'WO'
290600200610     C           WDBASE    ANDEQ'C'
290700200610     C*
290800200610     C* SUB FROM VALUE NOMINAL AND SETTLEMENT NOMINAL
290900200610     C*
291000200610     C                     SUB  DMNA      WDSNV
291100200610     C                     SUB  DMNA      WDSNS
291200200610     C                     MOVE '1'       WPRINT
291300200610     C                     MOVE '1'       WACSET
291400200610     C                     END
291500200610     C*
291600200610     C**  TYPE IS CUST WALK OUT, DATE BASIS IS A = ALL DATES
291700200610     C*
291800200610     C           WTYPE     IFEQ 'WO'
291900200610     C           WDBASE    ANDEQ'A'
292000200610     C*
292100200610     C* SUB FROM NOMINAL TRADE, SETTLEMENT AND VALUE
292200200610     C*
292300200610     C                     SUB  DMNA      WDSNT
292400200610     C                     SUB  DMNA      WDSNV
292500200610     C                     SUB  DMNA      WDSNS
292600200610     C                     MOVE '1'       WPRINT
292700200610     C                     MOVE '1'       WACSET
292800200610     C                     END
292900200610     C*
293000200610     C*   REPO OUT TYPE
293100200610     C*
293200200610     C**  TYPE IS REPO OUT,  DATE BASIS IS T = TRADE
293300200610     C*
293400200610     C           WTYPE     IFEQ 'RO'
293500200610     C           WDBASE    ANDEQ'T'
293600200610     C*
293700200610     C* SUB FROM TRADE NOMINAL REPOS
293800200610     C*
293900200610     C                     SUB  DMNA      WDSRT
294000200610     C                     END
294100200610     C*
294200200610     C**  TYPE IS REPO OUT, DATE BASIS IS V = VALUE
294300200610     C*
294400200610     C           WTYPE     IFEQ 'RO'
294500200610     C           WDBASE    ANDEQ'V'
294600200610     C*
294700200610     C* SUB FROM VALUE NOMINAL REPOS
294800200610     C*
294900200610     C                     SUB  DMNA      WDSRV
295000200610     C                     MOVE '1'       WPRINT                          E14209
295100200610     C                     MOVE '1'       WACSET                          E14209
295200200610     C                     MOVE '1'       *IN53                           E14739
295300200610     C                     END
295400200610     C*
295500200610     C**  TYPE IS REPO OUT, DATE BASIS IS B = BOTH
295600200610     C*
295700200610     C           WTYPE     IFEQ 'RO'
295800200610     C           WDBASE    ANDEQ'B'
295900200610     C*
296000200610     C* SUB FROM NOMINAL TRADE AND VALUE REPOS
296100200610     C*
296200200610     C                     MOVE '1'       WPRINT                                              189514
296300200610     C                     MOVE '1'       WACSET                                              189514
296400200610     C                     MOVE '1'       *IN53                                               189514
296500200610     C                     SUB  DMNA      WDSRT
296600200610     C                     SUB  DMNA      WDSRV
296700200610     C                     END
296800200610     C*
296900200610     C*   REPO IN  TYPE
297000200610     C*
297100200610     C**  TYPE IS REPO IN, DATE BASIS IS T = TRADE
297200200610     C*
297300200610     C           WTYPE     IFEQ 'RI'
297400200610     C           WDBASE    ANDEQ'T'
297500200610     C*
297600200610     C* ADD TO TRADE NOMINAL REPOS
297700200610     C*
297800200610     C                     ADD  DMNA      WDSRT
297900200610     C                     END
298000200610     C*
298100200610     C**  TYPE IS REPO IN, DATE BASIS IS V = VALUE
298200200610     C*
298300200610     C           WTYPE     IFEQ 'RI'
298400200610     C           WDBASE    ANDEQ'V'
298500200610     C*
298600200610     C* ADD TO VALUE NOMINAL REPO
298700200610     C*
298800200610     C                     ADD  DMNA      WDSRV
298900200610     C                     MOVE '1'       WPRINT                          E14209
299000200610     C                     MOVE '1'       WACSET                          E14209
299100200610     C                     MOVE '1'       *IN53                           E14739
299200200610     C                     END
299300200610     C*
299400200610     C**  TYPE IS REPO IN, DATE BASIS IS B = BOTH
299500200610     C*
299600200610     C           WTYPE     IFEQ 'RI'
299700200610     C           WDBASE    ANDEQ'B'
299800200610     C*
299900200610     C* ADD TO NOMINAL TRADE AND VALUE REPO
300000200610     C*
300100200610     C                     MOVE '1'       WPRINT                                              189514
300200200610     C                     MOVE '1'       WACSET                                              189514
300300200610     C                     MOVE '1'       *IN53                                               189514
300400200610     C                     ADD  DMNA      WDSRT
300500200610     C                     ADD  DMNA      WDSRV
300600200610     C                     END
300700200610     C*
300800200610     C** NOW CHECK IF SETT HAS GONE UP OR DOWN AND SET 65 FOR SUBR PR01
300900200610     C***SETT*DOES*NOT*CHANGE*FOR*MOVEMENT*'RO'*OR*'RI'*SO*SET*6** E20511 E33014
301000200610     C***ACCORDING*TO**WTYPE.***********************************   E20511 E33014
301100200610     C*
301200200610     C           W65IND    IFGE WDSNS
301300200610     C***********WTYPE     OREQ 'RO'                               E20511 E33014
301400200610     C                     MOVE '0'       *IN65
301500200610     C                     ELSE
301600200610     C                     MOVE '1'       *IN65
301700200610     C                     END
301800200610     C** SETT DOES NOT CHANGE FOR MOVEMENT 'RO' OR 'RI' SO SET 65         E33014
301900200610     C** ACCORDING TO  WTYPE.                                             E33014
302000200610     C           WTYPE     IFEQ 'RO'                                      E33014
302100200610     C                     MOVE '0'       *IN65                           E33014
302200200610     C                     END                                            E33014
302300200610     C           WTYPE     IFEQ 'RI'                                      E33014
302400200610     C                     MOVE '1'       *IN65                           E33014
302500200610     C                     END                                            E33014
302600200610     C*
302700200610     C* NEXT END IS END OF *IN01 IFEQ '1',= DEPOT MOVEMENT ACTION TYPES
302800200610     C*
302900200610     C                     END
303000200610     C*
303100200610     C*  SETTLEMENTS ACTION RECORD
303200200610     C*
303300200610     C           *IN02     IFEQ '1'
303400200610     C*
303500200610     C* IF A REVERSAL, REVERSE THE SIGN OF THE NOMINAL
303600200610     C*
303700200610     C           WREVER    IFEQ 'Y'
303800200610     C                     Z-SUBSNMS      SNMS
303900200610     C                     END
304000200610     C*
304100200610     C**  SETT.BAL IS ALTERED WHEN WDSNS IS CHANGED, AND THE MOVEMENT
304200200610     C**  IS LATER PRINTED. TO PRINT NEG NO'S IF MINUS MOVEMENT SET 65
304300200610     C**  ON IF WDSNS IS GREATER AT END OR OFF IF LESS
304400200610     C*
304500200610     C                     Z-ADDWDSNS     W65IND 150
304600200610     C*
304700200610     C**  TYPE IS SETTLEMENT PURCHASE, DATE BASIS IS S = SETTLEMENT
304800200610     C*
304900200610     C           WTYPE     IFEQ 'TP'
305000200610     C           WDBASE    ANDEQ'S'
305100200610     C*
305200200610     C* ADD TO NOMINAL SETTLEMENT
305300200610     C*
305400200610     C                     ADD  SNMS      WDSNS
305500200610     C                     MOVE '1'       WPRINT
305600200610     C                     MOVE '1'       WACSET
305700200610     C                     END
305800200610     C*
305900200610     C**  TYPE IS SETTLEMENT SALE, DATE BASIS IS S = SETTLEMENT
306000200610     C*
306100200610     C           WTYPE     IFEQ 'TS'
306200200610     C           WDBASE    ANDEQ'S'
306300200610     C*
306400200610     C* SUB FROM NOMINAL SETTLEMENT
306500200610     C*
306600200610     C                     SUB  SNMS      WDSNS
306700200610     C                     MOVE '1'       WPRINT
306800200610     C                     MOVE '1'       WACSET
306900200610     C                     END
307000200610     C*
307100200610     C** NOW CHECK IF SETT HAS GONE UP OR DOWN AND SET 65 FOR SUBR PR01
307200200610     C*
307300200610     C           W65IND    IFGE WDSNS
307400200610     C                     MOVE '0'       *IN65
307500200610     C                     ELSE
307600200610     C                     MOVE '1'       *IN65
307700200610     C                     END
307800200610     C*
307900200610     C* NEXT END IS END OF *IN02 IFEQ '1',= SETTLEMENT ACTION TYPES
308000200610     C*
308100200610     C                     END
308200200610     C*
308300200610     C*  TRADE ACTION RECORD
308400200610     C*
308500200610     C           *IN03     IFEQ '1'
308600200610     C*
308700200610     C* IF A REVERSAL, REVERSE THE SIGN OF THE NOMINAL
308800200610     C*
308900200610     C           WREVER    IFEQ 'Y'
309000200610     C                     Z-SUBNOML      NOML
309100200610     C                     END
309200200610     C*
309300200610     C**  TYPE IS TRADE PURCHASE, DATE BASIS IS T = TRADE
309400200610     C*
309500200610     C           WTYPE     IFEQ ' P'
309600200610     C           WDBASE    ANDEQ'T'
309700200610     C*
309800200610     C* ADD TO NOMINAL TRADE
309900200610     C*
310000200610     C                     ADD  NOML      WDSNT
310100200610     C*                                                                   E21303
310200200610     C** IF A SHARE & ACCRUAL IND. IS X IT IS EX-DIVIDEND.UPDATE THIS TOO E21303
310300200610     C*                                                                   E21303
310400200610     C           PROT      IFEQ '4'                                       E21303
310500200610     C           ACRI      ANDEQ'X'                                       E21303
310600200610     C                     ADD  NOML      WDEXN                           E21303
310700200610     C                     END                                            E21303
310800200610     C                     END
310900200610     C*
311000200610     C**  TYPE IS TRADE PURCHASE, DATE BASIS IS V = VALUE
311100200610     C*
311200200610     C           WTYPE     IFEQ ' P'
311300200610     C           WDBASE    ANDEQ'V'
311400200610     C*
311500200610     C* ADD TO NOMINAL VALUE
311600200610     C*
311700200610     C                     ADD  NOML      WDSNV
311800200610     C*
311900200610     C** IF A ACCRUAL INDICATOR IS X IT IS EX-COUPON - UPDATE THIS TOO
312000200610     C*
312100200610     C           ACRI      IFEQ 'X'
312200200610     C           PROT      ANDNE'4'                                       E21303
312300200610     C                     ADD  NOML      WDEXN
312400200610     C                     END
312500200610     C                     END
312600200610     C*
312700200610     C**  TYPE IS TRADE SALE, DATE BASIS IS T = TRADE
312800200610     C*
312900200610     C           WTYPE     IFEQ ' S'
313000200610     C           WDBASE    ANDEQ'T'
313100200610     C*
313200200610     C* SUB FROM NOMINAL TRADE
313300200610     C*
313400200610     C                     SUB  NOML      WDSNT
313500200610     C*                                                                   E21303
313600200610     C** IF A SHARE & ACCRUAL IND. IS X IT IS EX-DIVIDEND.UPDATE THIS TOO E21303
313700200610     C*                                                                   E21303
313800200610     C           PROT      IFEQ '4'                                       E21303
313900200610     C           ACRI      ANDEQ'X'                                       E21303
314000200610     C                     SUB  NOML      WDEXN                           E21303
314100200610     C                     END                                            E21303
314200200610     C                     END
314300200610     C*
314400200610     C**  TYPE IS TRADE SALE, DATE BASIS IS V = VALUE
314500200610     C*
314600200610     C           WTYPE     IFEQ ' S'
314700200610     C           WDBASE    ANDEQ'V'
314800200610     C*
314900200610     C* SUB FROM NOMINAL VALUE
315000200610     C*
315100200610     C                     SUB  NOML      WDSNV
315200200610     C*
315300200610     C** IF A ACCRUAL INDICATOR IS X IT IS EX-COUPON - UPDATE THIS TOO
315400200610     C*
315500200610     C           ACRI      IFEQ 'X'
315600200610     C           PROT      ANDNE'4'                                       E21303
315700200610     C                     SUB  NOML      WDEXN
315800200610     C                     END
315900200610     C                     END
316000200610     C*
316100200610     C* NEXT END IS END OF *IN03 IFEQ '1',= TRADE ACTION TYPES
316200200610     C*
316300200610     C                     END
316400200610     C*
316500200610     C*  CUSTOMER DEPOT MOVEMENT
316600200610     C*
316700200610     C           *IN04     IFEQ '1'
316800200610     C*
316900200610     C* IF A REVERSAL, REVERSE THE SIGN OF THE NOMINAL
317000200610     C*
317100200610     C           WREVER    IFEQ 'Y'
317200200610     C                     Z-SUBCMNA      CMNA
317300200610     C                     END
317400200610     C/COPY WNCPYSRC,SE2370C033
317500200610      *                                                                   CSE017
317600200610     C           WTYPE     IFEQ 'CI'                                      CSE017
317700200610     C           WDBASE    ANDEQ'T'                                       CSE017
317800200610     C           PROT      ANDEQ'4'                                       CSE017
317900200610     C           CPIN      ANDEQ'X'                                       CSE017
318000200610     C                     ADD  CMNA      WDEXN                           CSE017
318100200610     C                     ENDIF                                          CSE017
318200200610      *                                                                   CSE017
318300200610     C           WTYPE     IFEQ 'CI'                                      CSE017
318400200610     C           WDBASE    ANDEQ'C'                                       CSE017
318500200610     C           PROT      ANDNE'4'                                       CSE017
318600200610     C           CPIN      ANDEQ'X'                                       CSE017
318700200610     C                     ADD  CMNA      WDEXN                           CSE017
318800200610     C                     ENDIF                                          CSE017
318900200610      *                                                                   CSE017
319000200610     C           WTYPE     IFEQ 'CI'                                      CSE017
319100200610     C           WDBASE    ANDEQ'A'                                       CSE017
319200200610     C           CPIN      ANDEQ'X'                                       CSE017
319300200610     C                     ADD  CMNA      WDEXN                           CSE017
319400200610     C                     ENDIF                                          CSE017
319500200610      *                                                                   CSE017
319600200610     C           WTYPE     IFEQ 'CO'                                      CSE017
319700200610     C           WDBASE    ANDEQ'T'                                       CSE017
319800200610     C           PROT      ANDEQ'4'                                       CSE017
319900200610     C           CPIN      ANDEQ'X'                                       CSE017
320000200610     C                     SUB  CMNA      WDEXN                           CSE017
320100200610     C                     ENDIF                                          CSE017
320200200610      *                                                                   CSE017
320300200610     C           WTYPE     IFEQ 'CO'                                      CSE017
320400200610     C           WDBASE    ANDEQ'C'                                       CSE017
320500200610     C           PROT      ANDNE'4'                                       CSE017
320600200610     C           CPIN      ANDEQ'X'                                       CSE017
320700200610     C                     SUB  CMNA      WDEXN                           CSE017
320800200610     C                     ENDIF                                          CSE017
320900200610      *                                                                   CSE017
321000200610     C           WTYPE     IFEQ 'CO'                                      CSE017
321100200610     C           WDBASE    ANDEQ'A'                                       CSE017
321200200610     C           CPIN      ANDEQ'X'                                       CSE017
321300200610     C                     SUB  CMNA      WDEXN                           CSE017
321400200610     C                     ENDIF                                          CSE017
321500200610      *                                                                   CSE017
321600200610     C*
321700200610     C**  SETT.BAL IS ALTERED WHEN WDSNS IS CHANGED, AND THE MOVEMENT
321800200610     C**  IS LATER PRINTED. TO PRINT NEG NO'S IF MINUS MOVEMENT SET 65
321900200610     C**  ON IF WDSNS IS GREATER AT END OR OFF IF LESS
322000200610     C*
322100200610     C                     Z-ADDWDSNS     W65IND 150
322200200610     C*
322300200610     C**  TYPE IS USER TRANSFER IN, DATE BASIS IS T = TRADE
322400200610     C*
322500200610     C           WTYPE     IFEQ 'CI'
322600200610     C           WDBASE    ANDEQ'T'
322700200610     C*
322800200610     C* ADD TO TRADE NOMINAL
322900200610     C*
323000200610     C                     ADD  CMNA      WDSNT
323100200610     C                     END
323200200610     C*
323300200610     C**  TYPE IS USER TRANSFER IN, DATE BASIS IS C = VALUE AND SETTL.
323400200610     C*
323500200610     C           WTYPE     IFEQ 'CI'
323600200610     C           WDBASE    ANDEQ'C'
323700200610     C*
323800200610     C* ADD TO VALUE NOMINAL AND SETTLEMENT NOMINAL
323900200610     C*
324000200610     C                     ADD  CMNA      WDSNV
324100200610     C                     ADD  CMNA      WDSNS
324200200610     C                     MOVE '1'       WPRINT
324300200610     C                     MOVE '1'       WACSET
324400200610     C                     END
324500200610     C*
324600200610     C**  TYPE IS USER TRANSFER IN, DATE BASIS IS A = ALL DATES
324700200610     C*
324800200610     C           WTYPE     IFEQ 'CI'
324900200610     C           WDBASE    ANDEQ'A'
325000200610     C*
325100200610     C* ADD TO NOMINAL TRADE, SETTLEMENT AND VALUE
325200200610     C*
325300200610     C                     ADD  CMNA      WDSNT
325400200610     C                     ADD  CMNA      WDSNV
325500200610     C                     ADD  CMNA      WDSNS
325600200610     C                     MOVE '1'       WPRINT
325700200610     C                     MOVE '1'       WACSET
325800200610     C                     END
325900200610     C*
326000200610     C**  TYPE IS USER TRANSFER OUT, DATE BASIS IS T = TRADE
326100200610     C*
326200200610     C           WTYPE     IFEQ 'CO'
326300200610     C           WDBASE    ANDEQ'T'
326400200610     C*
326500200610     C* SUB FROM TRADE NOMINAL
326600200610     C*
326700200610     C                     SUB  CMNA      WDSNT
326800200610     C                     END
326900200610     C*
327000200610     C**  TYPE IS USER TRANSFER OUT, DATE BASIS IS C = VALUE AND SETTL.
327100200610     C*
327200200610     C           WTYPE     IFEQ 'CO'
327300200610     C           WDBASE    ANDEQ'C'
327400200610     C*
327500200610     C* SUB FROM VALUE NOMINAL AND SETTLEMENT NOMINAL
327600200610     C*
327700200610     C                     SUB  CMNA      WDSNV
327800200610     C                     SUB  CMNA      WDSNS
327900200610     C                     MOVE '1'       WPRINT
328000200610     C                     MOVE '1'       WACSET
328100200610     C                     END
328200200610     C*
328300200610     C**  TYPE IS USER TRANSFER OUT, DATE BASIS IS A = ALL DATES
328400200610     C*
328500200610     C           WTYPE     IFEQ 'CO'
328600200610     C           WDBASE    ANDEQ'A'
328700200610     C*
328800200610     C* SUB FROM NOMINAL TRADE, SETTLEMENT AND VALUE
328900200610     C*
329000200610     C                     SUB  CMNA      WDSNT
329100200610     C                     SUB  CMNA      WDSNV
329200200610     C                     SUB  CMNA      WDSNS
329300200610     C                     MOVE '1'       WPRINT
329400200610     C                     MOVE '1'       WACSET
329500200610     C                     END
329600200610     C*
329700200610     C** TYPE IS CUSTOMER WALK IN
329800200610     C*
329900200610     C**  TYPE IS CUST WALK IN, DATE BASIS IS T = TRADE
330000200610     C*
330100200610     C           WTYPE     IFEQ 'WI'
330200200610     C           WDBASE    ANDEQ'T'
330300200610     C*
330400200610     C* ADD TO TRADE NOMINAL
330500200610     C*
330600200610     C                     ADD  CMNA      WDSNT
330700200610     C                     END
330800200610     C*
330900200610     C**  TYPE IS CUST WALK IN, DATE BASIS IS C = VALUE AND SETTL.
331000200610     C*
331100200610     C           WTYPE     IFEQ 'WI'
331200200610     C           WDBASE    ANDEQ'C'
331300200610     C*
331400200610     C* ADD TO VALUE NOMINAL AND SETTLEMENT NOMINAL
331500200610     C*
331600200610     C                     ADD  CMNA      WDSNV
331700200610     C                     ADD  CMNA      WDSNS
331800200610     C                     MOVE '1'       WPRINT
331900200610     C                     MOVE '1'       WACSET
332000200610     C                     END
332100200610     C*
332200200610     C**  TYPE IS CUST WALK IN, DATE BASIS IS A = ALL DATES
332300200610     C*
332400200610     C           WTYPE     IFEQ 'WI'
332500200610     C           WDBASE    ANDEQ'A'
332600200610     C*
332700200610     C* ADD TO NOMINAL TRADE, SETTLEMENT AND VALUE
332800200610     C*
332900200610     C                     ADD  CMNA      WDSNT
333000200610     C                     ADD  CMNA      WDSNV
333100200610     C                     ADD  CMNA      WDSNS
333200200610     C                     MOVE '1'       WPRINT
333300200610     C                     MOVE '1'       WACSET
333400200610     C                     END
333500200610     C*
333600200610     C**  TYPE IS CUST WALK OUT, DATE BASIS IS T = TRADE
333700200610     C*
333800200610     C           WTYPE     IFEQ 'WO'
333900200610     C           WDBASE    ANDEQ'T'
334000200610     C*
334100200610     C* SUB FROM TRADE NOMINAL
334200200610     C*
334300200610     C                     SUB  CMNA      WDSNT
334400200610     C                     END
334500200610     C*
334600200610     C**  TYPE IS CUST WALK OUT, DATE BASIS IS C = VALUE AND SETTL.
334700200610     C*
334800200610     C           WTYPE     IFEQ 'WO'
334900200610     C           WDBASE    ANDEQ'C'
335000200610     C*
335100200610     C* SUB FROM VALUE NOMINAL AND SETTLEMENT NOMINAL
335200200610     C*
335300200610     C                     SUB  CMNA      WDSNV
335400200610     C                     SUB  CMNA      WDSNS
335500200610     C                     MOVE '1'       WPRINT
335600200610     C                     MOVE '1'       WACSET
335700200610     C                     END
335800200610     C*
335900200610     C**  TYPE IS CUST WALK OUT, DATE BASIS IS A = ALL DATES
336000200610     C*
336100200610     C           WTYPE     IFEQ 'WO'
336200200610     C           WDBASE    ANDEQ'A'
336300200610     C*
336400200610     C* SUB FROM NOMINAL TRADE, SETTLEMENT AND VALUE
336500200610     C*
336600200610     C                     SUB  CMNA      WDSNT
336700200610     C                     SUB  CMNA      WDSNV
336800200610     C                     SUB  CMNA      WDSNS
336900200610     C                     MOVE '1'       WPRINT
337000200610     C                     MOVE '1'       WACSET
337100200610     C                     END
337200200610     C*
337300200610     C*   REPO OUT TYPE
337400200610     C*
337500200610     C**  TYPE IS REPO OUT, DATE BASIS IS T = TRADE
337600200610     C*
337700200610     C           WTYPE     IFEQ 'RO'
337800200610     C           WDBASE    ANDEQ'T'
337900200610     C*
338000200610     C* SUB FROM TRADE NOMINAL REPOS
338100200610     C*
338200200610     C                     SUB  CMNA      WDSRT
338300200610     C                     END
338400200610     C*
338500200610     C**  TYPE IS REPO OUT, DATE BASIS IS V = VALUE
338600200610     C*
338700200610     C           WTYPE     IFEQ 'RO'
338800200610     C           WDBASE    ANDEQ'V'
338900200610     C*
339000200610     C* SUB FROM VALUE NOMINAL REPOS
339100200610     C*
339200200610     C                     SUB  CMNA      WDSRV
339300200610     C                     MOVE '1'       WPRINT                          E14209
339400200610     C                     MOVE '1'       WACSET                          E14209
339500200610     C                     MOVE '1'       *IN53                           E14739
339600200610     C                     END
339700200610     C*
339800200610     C**  TYPE IS REPO OUT, DATE BASIS IS B = BOTH
339900200610     C*
340000200610     C           WTYPE     IFEQ 'RO'
340100200610     C           WDBASE    ANDEQ'B'
340200200610     C*
340300200610     C* SUB FROM NOMINAL TRADE AND VALUE REPOS
340400200610     C*
340500200610     C                     MOVE '1'       WPRINT                                              189514
340600200610     C                     MOVE '1'       WACSET                                              189514
340700200610     C                     MOVE '1'       *IN53                                               189514
340800200610     C                     SUB  CMNA      WDSRT
340900200610     C                     SUB  CMNA      WDSRV
341000200610     C                     END
341100200610     C*
341200200610     C*   REPO IN TYPE
341300200610     C*
341400200610     C**  TYPE IS REPO IN, DATE BASIS IS T = TRADE
341500200610     C*
341600200610     C           WTYPE     IFEQ 'RI'
341700200610     C           WDBASE    ANDEQ'T'
341800200610     C*
341900200610     C* ADD TO TRADE NOMINAL REPOS
342000200610     C*
342100200610     C                     ADD  CMNA      WDSRT
342200200610     C                     END
342300200610     C*
342400200610     C**  TYPE IS REPO IN, DATE BASIS IS V = VALUE
342500200610     C*
342600200610     C           WTYPE     IFEQ 'RI'
342700200610     C           WDBASE    ANDEQ'V'
342800200610     C*
342900200610     C* ADD TO VALUE NOMINAL REPO
343000200610     C*
343100200610     C                     ADD  CMNA      WDSRV
343200200610     C                     MOVE '1'       WPRINT                          E14209
343300200610     C                     MOVE '1'       WACSET                          E14209
343400200610     C                     MOVE '1'       *IN53                           E14739
343500200610     C                     END
343600200610     C*
343700200610     C**  TYPE IS REPO IN, DATE BASIS IS B = BOTH
343800200610     C*
343900200610     C           WTYPE     IFEQ 'RI'
344000200610     C           WDBASE    ANDEQ'B'
344100200610     C*
344200200610     C* ADD TO NOMINAL TRADE AND VALUE REPO
344300200610     C*
344400200610     C                     MOVE '1'       WPRINT                                              189514
344500200610     C                     MOVE '1'       WACSET                                              189514
344600200610     C                     MOVE '1'       *IN53                                               189514
344700200610     C                     ADD  CMNA      WDSRT
344800200610     C                     ADD  CMNA      WDSRV
344900200610     C                     END
345000200610     C*
345100200610     C** NOW CHECK IF SETT HAS GONE UP OR DOWN AND SET 65 FOR SUBR PR01
345200200610     C*
345300200610     C           W65IND    IFGE WDSNS
345400200610     C                     MOVE '0'       *IN65
345500200610     C                     ELSE
345600200610     C                     MOVE '1'       *IN65
345700200610     C                     END
345800200610     C*
345900200610     C* NEXT END IS END OF *IN04 IFEQ '1',= CUST. MOVEMENT ACTION TYPES
346000200610     C*
346100200610     C                     END
346200200610     C*                                                                   E14753
346300200610     C*  PORTFOLIO TRADE ACTION RECORD                                    E14753
346400200610     C*                                                                   E14753
346500200610     C           *IN05     IFEQ '1'                                       E14753
346600200610     C*                                                                   E14753
346700200610     C* IF A REVERSAL, REVERSE THE SIGN OF THE NOMINAL                    E14753
346800200610     C*                                                                   E14753
346900200610     C           WREVER    IFEQ 'Y'                                       E14753
347000200610     C                     Z-SUBNOML      NOML                            E14753
347100200610     C                     END                                            E14753
347200200610     C*                                                                   E14753
347300200610     C**  TYPE IS TRADE PURCHASE, DATE BASIS IS T = TRADE                 E14753
347400200610     C*                                                                   E14753
347500200610     C           WTYPE     IFEQ ' P'                                      E14753
347600200610     C           WDBASE    ANDEQ'T'                                       E14753
347700200610     C*                                                                   E14753
347800200610     C* SUBTRACT FROM NOMINAL TRADE                                       E14753
347900200610     C*                                                                   E14753
348000200610     C                     SUB  NOML      WDSNT                           E14753
348100200610     C           PROT      IFEQ '4'                                       E21430
348200200610     C           ACRI      ANDEQ'X'                                       E21430
348300200610     C                     SUB  NOML      WDEXN                           E21430
348400200610     C                     END                                            E21430
348500200610     C                     END                                            E14753
348600200610     C*                                                                   E14753
348700200610     C**  TYPE IS TRADE PURCHASE, DATE BASIS IS V = VALUE                 E14753
348800200610     C*                                                                   E14753
348900200610     C           WTYPE     IFEQ ' P'                                      E14753
349000200610     C           WDBASE    ANDEQ'V'                                       E14753
349100200610     C*                                                                   E14753
349200200610     C* SUB FROM NOMINAL VALUE                                            E14753
349300200610     C*                                                                   E14753
349400200610     C                     SUB  NOML      WDSNV                           E14753
349500200610     C*                                                                   E14753
349600200610     C** IF A ACCRUAL INDICATOR IS X IT IS EX-COUPON - UPDATE THIS TOO    E14753
349700200610     C*                                                                   E14753
349800200610     C           ACRI      IFEQ 'X'                                       E14753
349900200610     C           PROT      ANDNE'4'                                       E21430
350000200610     C                     SUB  NOML      WDEXN                           E14753
350100200610     C                     END                                            E14753
350200200610     C                     END                                            E14753
350300200610     C*                                                                   E14753
350400200610     C**  TYPE IS TRADE SALE, DATE BASIS IS T = TRADE                     E14753
350500200610     C*                                                                   E14753
350600200610     C           WTYPE     IFEQ ' S'                                      E14753
350700200610     C           WDBASE    ANDEQ'T'                                       E14753
350800200610     C*                                                                   E14753
350900200610     C* ADD TO NOMINAL TRADE                                              E14753
351000200610     C*                                                                   E14753
351100200610     C                     ADD  NOML      WDSNT                           E14753
351200200610     C           PROT      IFEQ '4'                                       E21430
351300200610     C           ACRI      ANDEQ'X'                                       E21430
351400200610     C                     ADD  NOML      WDEXN                           E21430
351500200610     C                     END                                            E21430
351600200610     C                     END                                            E14753
351700200610     C*                                                                   E14753
351800200610     C**  TYPE IS TRADE SALE, DATE BASIS IS V = VALUE                     E14753
351900200610     C*                                                                   E14753
352000200610     C           WTYPE     IFEQ ' S'                                      E14753
352100200610     C           WDBASE    ANDEQ'V'                                       E14753
352200200610     C*                                                                   E14753
352300200610     C* ADD TO NOMINAL VALUE                                              E14753
352400200610     C*                                                                   E14753
352500200610     C                     ADD  NOML      WDSNV                           E14753
352600200610     C*                                                                   E14753
352700200610     C** IF A ACCRUAL INDICATOR IS X IT IS EX-COUPON - UPDATE THIS TOO    E14753
352800200610     C*                                                                   E14753
352900200610     C           ACRI      IFEQ 'X'                                       E14753
353000200610     C           PROT      ANDNE'4'                                       E21430
353100200610     C                     ADD  NOML      WDEXN                           E14753
353200200610     C                     END                                            E14753
353300200610     C                     END                                            E14753
353400200610     C*                                                                   E14753
353500200610     C* NEXT END IS END OF *IN05 IFEQ '1',= PORTFOLIO TRADE ACTION TYPES  E14753
353600200610     C*                                                                   E14753
353700200610     C                     END                                            E14753
353800200610     C*                                                                   E14753
353900200610     C*  PORTFOLIO SETTLEMENTS ACTION RECORD                              E14753
354000200610     C*                                                                   E14753
354100200610     C           *IN06     IFEQ '1'                                       E14753
354200200610     C*                                                                   E14753
354300200610     C* IF A REVERSAL, REVERSE THE SIGN OF THE NOMINAL                    E14753
354400200610     C*                                                                   E14753
354500200610     C           WREVER    IFEQ 'Y'                                       E14753
354600200610     C                     Z-SUBSNMS      SNMS                            E14753
354700200610     C                     END                                            E14753
354800200610     C*                                                                   E14753
354900200610     C**  SETT.BAL IS ALTERED WHEN WDSNS IS CHANGED, AND THE MOVEMENT     E14753
355000200610     C**  IS LATER PRINTED. TO PRINT NEG NO'S IF MINUS MOVEMENT SET 65    E14753
355100200610     C**  ON IF WDSNS IS GREATER AT END OR OFF IF LESS.                   E14753
355200200610     C*                                                                   E14753
355300200610     C                     Z-ADDWDSNS     W65IND 150                      E14753
355400200610     C*                                                                   E14753
355500200610     C**  TYPE IS SETTLEMENT PURCHASE, DATE BASIS IS S = SETTLEMENT       E14753
355600200610     C*                                                                   E14753
355700200610     C           WTYPE     IFEQ 'TP'                                      E14753
355800200610     C           WDBASE    ANDEQ'S'                                       E14753
355900200610     C*                                                                   E14753
356000200610     C* SUBTRACT FROM NOMINAL SETTLEMENT                                  E14753
356100200610     C*                                                                   E14753
356200200610     C                     SUB  SNMS      WDSNS                           E14753
356300200610     C                     MOVE '1'       WPRINT                          E14753
356400200610     C                     MOVE '1'       WACSET                          E14753
356500200610     C                     END                                            E14753
356600200610     C*                                                                   E14753
356700200610     C**  TYPE IS SETTLEMENT SALE, DATE BASIS IS S = SETTLEMENT           E14753
356800200610     C*                                                                   E14753
356900200610     C           WTYPE     IFEQ 'TS'                                      E14753
357000200610     C           WDBASE    ANDEQ'S'                                       E14753
357100200610     C*                                                                   E14753
357200200610     C* ADD TO NOMINAL SETTLEMENT                                         E14753
357300200610     C*                                                                   E14753
357400200610     C                     ADD  SNMS      WDSNS                           E14753
357500200610     C                     MOVE '1'       WPRINT                          E14753
357600200610     C                     MOVE '1'       WACSET                          E14753
357700200610     C                     END                                            E14753
357800200610     C*                                                                   E14753
357900200610     C** NOW CHECK IF SETT HAS GONE UP OR DOWN AND SET 65 FOR SUBR PR01   E14753
358000200610     C*                                                                   E14753
358100200610     C           W65IND    IFGE WDSNS                                     E14753
358200200610     C                     MOVE '0'       *IN65                           E14753
358300200610     C                     ELSE                                           E14753
358400200610     C                     MOVE '1'       *IN65                           E14753
358500200610     C                     END                                            E14753
358600200610     C*                                                                   E14753
358700200610     C* NEXT END IS END OF *IN06 IFEQ '1',= PORTFOLIO SETTLEMENT ACTION   E14753
358800200610     C*                                     TYPES                         E14753
358900200610     C                     END                                            E14753
359000200610     C*
359100200610     C                     ENDSR
359200200610      *
359300200610      *****************************************************************
359400200610      /EJECT
359500200610      *****************************************************************
359600200610      *                                                               *
359700200610      *  PR01   - Subroutine to Print Daily Movements Report.         *
359800200610      *                                                               *
359900200610      *****************************************************************
360000200610      *
360100200610     C           PR01      BEGSR                           ** PR01  **
360200200610     C*
360300200610     C*  THIS ROUTINE IS CALLED WITH 4 INDICATORS SET AS FOLLOWS:
360400200610     C*            *IN31 ON - PRINT OPENING BALANCE FMT DETAL1
360500200610     C*            *IN32 ON - PRINT ADJUSTMENTS DUE FMT DETAL2
360600200610     C*            *IN33 ON - PRINT ACTIONS TODAY   FMT DETAL3
360700200610     C*            *IN34 ON - PRINT CLOSING BALANCE FMT DETAL4
360800200610     C*            *IN52 ON - PRINT ADJUSTMENTS DUE FMT DETAL2R           E14739
360900200610     C* REQUESTS TO PRINT FROM SUBR CH01/CH02 HAVE N31N32N33 34
361000200610     C*                                       OR    31 32 N33 34
361100200610     C* REQUESTS TO PRINT FROM P/MAIN HAVE N31N32 33 N34  AND THIS
361200200610     C*    COMBINATION REQUIRES A CHECK TO SEE IF OPBAL FMT DETAL1
361300200610     C*    SHOULD BE PRINTED FIRST.
361400200610     C*
361500200610     C**IF**IN33*IS*ON*IT*COULD*BE*A*CHANGE*OF*BR/DEPOT/SEC/DATE*******   E21111
361600200610     C***********                                                         E21111
361700200610     C************IN33     IFEQ '1'                                       E21111
361800200610     C***********                                                         E21111
361900200610     C***CHECK*IF*BRANCH*HAS*CHANGED***********************************   E21111
362000200610     C***********                                                         E21111
362100200610     C***********WBC       IFNE WSBC                                      E21111
362200200610     C************IN68     OREQ '0'                                       E21111
362300200610     C***********                                                         E21111
362400200610     C***IF*IND*68*IS*ON*THE*PRINT*FILE*IS*OPEN*-*WRITE*TRAILER*AND*CLOSE E21111
362500200610     C***********                                                         E21111
362600200610     C************IN68     IFEQ '1'                                       E21111
362700200610     C***********          EXSR OF01                                      E15283
362800200610     C***********          WRITETRAILP1                                   E21111
362900200610     C***********          CLOSESE2370P1                                  E21111
363000200610     C***********          MOVE '0'       *IN68                           E21111
363100200610     C***********          END                                            E21111
363200200610     C***********          OPEN SE2370P1                                  E21111
363300200610     C***********          MOVE '1'       *IN68                           E21111
363400200610     C***********                                                         E21111
363500200610     C****GET*BRANCH*DESCRIPTION***************************************   E21111
363600200610     C***********                                                         E21111
363700200610     C***********          MOVE *BLANK    BRNM                            E21111
363800200610     C***********          MOVE *BLANK    TABTRN 30                       E21111
363900200610     C***********          EXSR TR10                                      E21111
364000200610     C***********          MOVELBRNM      TABTRN                          E21111
364100200610     C***********                                                         E21111
364200200610     C****GET*DEPOT*DESCRIPTION****************************************   E21111
364300200610     C***********                                                         E21111
364400200610     C***********          MOVE *BLANK    CSNM                            E21111
364500200610     C***********          MOVE *BLANK    CLINTB                          E21111
364600200610     C***********          Z-ADDWDP       WCLNTK                          E21111
364700200610     C***********          EXSR CLNTIN                                    E21111
364800200610     C************IN79     IFEQ '1'                                       E21111
364900200610     C***********          MOVE *BLANK    CLINTB                          E21111
365000200610     C***********          ELSE                                           E21111
365100200610     C***********CSNM      IFNE *BLANK                                    E21111
365200200610     C***********                                                         E21111
365300200610     C**IF*BLANK*NAME*USE*CODE*INSTEAD*********************************   E21111
365400200610     C***********                                                         E21111
365500200610     C***********          MOVELCSNM      CLINTB                          E21111
365600200610     C***********          ELSE                                           E21111
365700200610     C***********          MOVELWDP       CLINTB                          E21111
365800200610     C***********          END                                            E21111
365900200610     C***********          END                                            E21111
366000200610     C***********                                                         E21111
366100200610     C****GET*SECURITY*REPORT*NAME*************************************   E21111
366200200610     C***********                                                         E21111
366300200610     C***********          MOVE WSS       WDSSC                           E21111
366400200610     C***********          EXSR SECTIN                                    E21111
366500200610     C***********          MOVE SRPN      ZSRPN                           E21111
366600200610     C***********          EXSR ZSDESC                                    E21111
366700200610     C***********          MOVE ZRNME     SECSH                           E21111
366800200610     C***********                                                         E21111
366900200610     C****SET*LINE*COUNT*TO*12*AND*PRINT*HEADING*LINES*FOR*BRANCH******   E21111
367000200610     C***********                                                         E21111
367100200610     C***********          Z-ADD12        LCNT                            E21111
367200200610     C***********          WRITEHEADP1                                    E21111
367300200610     C***********          WRITESECSHR                                    E21111
367400200610     C***********          MOVE COMARA    PRTARA                          E21111
367500200610     C***********          ELSE                                           E21111
367600200610     C***********                                                         E21111
367700200610     C***CHECK*IF*DEPOT*HAS*CHANGED************************************   E21111
367800200610     C***********                                                         E21111
367900200610     C***********WDP       IFNE WSPDP                                     E21111
368000200610     C***********                                                         E21111
368100200610     C****GET*DEPOT*DESCRIPTION****************************************   E21111
368200200610     C***********                                                         E21111
368300200610     C***********          MOVE *BLANK    CSNM                            E21111
368400200610     C***********          MOVE *BLANK    CLINTB                          E21111
368500200610     C***********          Z-ADDWDP       WCLNTK                          E21111
368600200610     C***********          EXSR CLNTIN                                    E21111
368700200610     C************IN79     IFEQ '1'                                       E21111
368800200610     C***********          MOVE *BLANK    CLINTB                          E21111
368900200610     C***********          ELSE                                           E21111
369000200610     C***********CSNM      IFNE *BLANK                                    E21111
369100200610     C***********                                                         E21111
369200200610     C**IF*BLANK*NAME*USE*CODE*INSTEAD*********************************   E21111
369300200610     C***********                                                         E21111
369400200610     C***********          MOVELCSNM      CLINTB                          E21111
369500200610     C***********          ELSE                                           E21111
369600200610     C***********          MOVELWDP       CLINTB                          E21111
369700200610     C***********          END                                            E21111
369800200610     C***********          END                                            E21111
369900200610     C***********                                                         E21111
370000200610     C****GET*SECURITY*REPORT*NAME*************************************   E21111
370100200610     C***********                                                         E21111
370200200610     C***********          MOVE WSS       WDSSC                           E21111
370300200610     C***********          EXSR SECTIN                                    E21111
370400200610     C***********          MOVE SRPN      ZSRPN                           E21111
370500200610     C***********          EXSR ZSDESC                                    E21111
370600200610     C***********          MOVE ZRNME     SECSH                           E21111
370700200610     C***********                                                         E21111
370800200610     C****SET*LINE*COUNT*TO*12*AND*PRINT*HEADING*LINES*FOR*BRANCH******   E21111
370900200610     C***********                                                         E21111
371000200610     C***********          Z-ADD12        LCNT                            E21111
371100200610     C***********          WRITEHEADP1                                    E21111
371200200610     C***********          WRITESECSHR                                    E21111
371300200610     C***********          MOVE COMARA    PRTARA                          E21111
371400200610     C***********                                                         E21111
371500200610     C***********          ELSE                                           E21111
371600200610     C***********                                                         E21111
371700200610     C***CHECK*IF*SECURITY*HAS*CHANGED*********************************   E21111
371800200610     C***********                                                         E21111
371900200610     C***********WSS       IFNE WSPSS                                     E21111
372000200610     C***********                                                         E21111
372100200610     C****GET*SECURITY*REPORT*NAME*************************************   E21111
372200200610     C***********                                                         E21111
372300200610     C***********          MOVE WSS       WDSSC                           E21111
372400200610     C***********          EXSR SECTIN                                    E21111
372500200610     C***********          MOVE SRPN      ZSRPN                           E21111
372600200610     C***********          EXSR ZSDESC                                    E21111
372700200610     C***********          MOVE ZRNME     SECSH                           E21111
372800200610     C***********          MOVE '1'       *IN76                           E21111
372900200610     C***********          EXSR OF01                                      E21111
373000200610     C***********          MOVE '0'       *IN76                           E21111
373100200610     C***********          WRITESECSHR                                    E21111
373200200610     C***********          ADD  2         LCNT                            E21111
373300200610     C***********          MOVE COMARA    PRTARA                          E21111
373400200610     C***********          END                                            E21111
373500200610     C***********          END                                            E21111
373600200610     C***********          END                                            E21111
373700200610     C*                                                                   E21111
373800200610     C* IF *IN33 IS ON IT COULD BE A CHANGE OF BR/DEPOT/SEC/DATE          E21111
373900200610     C*                                                                   E21111
374000200610     C           *IN33     IFEQ '1'                                       E21111
374100200610     C*                                                                   E21111
374200200610     C** CHECK IF BRANCH HAS CHANGED                                      E21111
374300200610     C*                                                                   E21111
374400200610     C** Check against last branch PRINTED.                               E21571
374500200610     C*                                                                   E21111
374600200610     C***********WBC       IFNE WSBC                               E21111 E21571
374700200610     C           WBC       IFNE WSBCPR                                    E21571
374800200610     C           *IN68     OREQ '0'                                       E21111
374900200610     C*                                                                   E21111
375000200610     C** IF IN68 IS ON THE PRINT FILE IS OPEN - WRITE TRAILER AND CLOSE   E21111
375100200610     C*                                                                   E21111
375200200610     C           *IN68     IFEQ '1'                                       E21111
375300200610     C                     EXSR OF01                                      E15283
375400200610     C                     WRITETRAILP1                                   E21111
375500200610     C                     CLOSESE2370P1                                  E21111
375600200610     C                     MOVE '0'       *IN68                           E21111
375700200610     C                     END                                            E21111
375800200610     C                     OPEN SE2370P1                                  E21111
375900200610     C                     MOVE '1'       *IN68                           E21111
376000200610     C                     MOVE '1'       *IN73                           189460
376100200610     C                     Z-ADD0         PAGE                            E29170
376200200610     C*                                                                   E29170
376300200610     C** RCF PROCESSING FOR DETAIL PRINTER FILE                           E29170
376400200610     C*                                                                   E29170
376500200610     C                     EXSR RCFP1                                     E29170
376600200610     C*                                                                   E21111
376700200610     C*   GET BRANCH DESCRIPTION                                          E21111
376800200610     C*                                                                   E21111
376900200610     C                     MOVE *BLANK    BRNM                            E21111
377000200610     C                     MOVE *BLANK    TABTRN 30                       E21111
377100200610     C                     EXSR TR10                                      E21111
377200200610     C                     MOVELBRNM      TABTRN                          E21111
377300200610     C***********          Z-ADDWBC       WSBCPR  30               E21571 S01117
377400200610     C                     MOVE WBC       WSBCPR  3                       S01117
377500200610     C                     END                                            E21111
377600200610     C*                                                                   E21111
377700200610     C** CHECK IF DEPOT HAS CHANGED                                       E21111
377800200610     C*                                                                   E21111
377900200610     C           WDP       IFNE WSPDP                                     E21111
378000200610     C*                                                                   E21111
378100200610     C*   GET DEPOT DESCRIPTION                                           E21111
378200200610     C*                                                                   E21111
378300200610     C                     MOVE *BLANK    CSNM                            E21111
378400200610     C                     MOVE *BLANK    CLINTB                          E21111
378500200610     C**********           Z-ADDWDP       WCLNTK                                       E21111 CSD027
378600200610     C                     MOVE WDP       WCLNTK                                              CSD027
378700200610     C                     EXSR CLNTIN                                    E21111
378800200610     C           *IN79     IFEQ '1'                                       E21111
378900200610     C                     MOVE *BLANK    CLINTB                          E21111
379000200610     C                     ELSE                                           E21111
379100200610     C*                                                                   E21111
379200200610     C* IF BLANK NAME USE CODE INSTEAD                                    E21111
379300200610     C*                                                                   E21111
379400200610     C           CSNM      IFNE *BLANK                                    E21111
379500200610     C                     MOVELCSNM      CLINTB                          E21111
379600200610     C                     ELSE                                           E21111
379700200610     C                     MOVELWDP       CLINTB                          E21111
379800200610     C                     END                                            E21111
379900200610     C                     END                                            E21111
380000200610     C                     END                                            E21111
380100200610     C*                                                                   E21111
380200200610     C** CHECK IF SECURITY HAS CHANGED                                    E21111
380300200610     C*                                                                   E21111
380400200610     C           WSS       IFNE WSPSS                                     E21111
380500200610     C*                                                                   E21111
380600200610     C*   GET SECURITY REPORT NAME                                        E21111
380700200610     C*                                                                   E21111
380800200610     C                     MOVE WSS       WDSSC                           E21111
380900200610     C                     EXSR SECTIN                                    E21111
381000200610     C                     MOVE SRPN      ZSRPN                           E21111
381100200610     C                     EXSR ZSDESC                                    E21111
381200200610     C                     MOVE ZRNME     SECSH                           E21111
381300200610     C*                                                                   E21111
381400200610     C*   GET DEPOT AND REFERENCE DESCRIPTIONS - FIRST CLEAR PREVIOUS     E21111
381500200610     C*                                                                   E21111
381600200610     C                     MOVE *BLANK    DEP1   10                       S01176
381700200610     C                     MOVE *BLANK    REF1   12                       S01176
381800200610     C                     MOVE *BLANK    DEP2   10                       S01176
381900200610     C                     MOVE *BLANK    REF2   12                       S01176
382000200610     C                     MOVE *BLANK    DEP3   10                       S01176
382100200610     C                     MOVE *BLANK    REF3   12                       S01176
382200200610     C                     MOVELDASR      REF1                            S01176
382300200610     C                     MOVELDCSR      REF2                            S01176
382400200610     C                     MOVELDDSR      REF3                            S01176
382500200610     C*                                                                   E21111
382600200610     C**  TO GET DEPOT DESCRIPTION ACCESS INVTPD FOR SETT.DEPOTS 1,2,3    E21111
382700200610     C**  AND THEN USE EACH CODE TO ACCESS CLINTB FOR SHORT DESC.         E21111
382800200610     C*                                                                   E21111
382900200610     C                     EXSR INVTIN                                    E21111
383000200610     C**********           Z-ADDSDC1      WCLNTK                                       E21111 CSD027
383100200610     C                     MOVE SDC1      WCLNTK                                              CSD027
383200200610     C                     EXSR CLNTIN                                    E21111
383300200610     C           *IN79     IFEQ '1'                                       E21111
383400200610     C                     MOVE *BLANK    DEP1                            E21111
383500200610     C                     ELSE                                           E21111
383600200610     C           CSNM      IFEQ *BLANK                                    E21111
383700200610     C                     MOVELCNUM      DEP1                            E21111
383800200610     C                     ELSE                                           E21111
383900200610     C                     MOVELCSNM      DEP1                            E21111
384000200610     C                     END                                            E21111
384100200610     C                     END                                            E21111
384200200610     C**********           Z-ADDSDC2      WCLNTK                                       E21111 CSD027
384300200610     C                     MOVE SDC2      WCLNTK                                              CSD027
384400200610     C                     EXSR CLNTIN                                    E21111
384500200610     C           *IN79     IFEQ '1'                                       E21111
384600200610     C                     MOVE *BLANK    DEP2                            E21111
384700200610     C                     ELSE                                           E21111
384800200610     C           CSNM      IFEQ *BLANK                                    E21111
384900200610     C                     MOVELCNUM      DEP2                            E21111
385000200610     C                     ELSE                                           E21111
385100200610     C                     MOVELCSNM      DEP2                            E21111
385200200610     C                     END                                            E21111
385300200610     C                     END                                            E21111
385400200610     C**********           Z-ADDSDC3      WCLNTK                                       E21111 CSD027
385500200610     C                     MOVE SDC3      WCLNTK                                              CSD027
385600200610     C                     EXSR CLNTIN                                    E21111
385700200610     C           *IN79     IFEQ '1'                                       E21111
385800200610     C                     MOVE *BLANK    DEP3                            E21111
385900200610     C                     ELSE                                           E21111
386000200610     C           CSNM      IFEQ *BLANK                                    E21111
386100200610     C                     MOVELCNUM      DEP3                            E21111
386200200610     C                     ELSE                                           E21111
386300200610     C                     MOVELCSNM      DEP3                            E21111
386400200610     C                     END                                            E21111
386500200610     C                     END                                            E21111
386600200610     C*                                                                   E14739
386700200610     C                     END                                            E21111
386800200610     C*                                                                   E21111
386900200610     C           WBC       IFNE WSBC                                      E21111
387000200610     C           *IN73     OREQ '1'                                       189460
387100200610     C           WDP       ORNE WSPDP                                     E21111
387200200610     C                     Z-ADD12        LCNT                            E21111
387300200610     C                     WRITEHEADP1                                    E21111
387400200610     C                     MOVE '0'       *IN73                           189460
387500200610     C/COPY WNCPYSRC,SE2370C037
387600200610     C                     WRITESECSHR                                    E21111
387700200610     C/COPY WNCPYSRC,SE2370C038
387800200610     C                     MOVE COMARA    PRTARA                          E21111
387900200610     C*                                                                   E21111
388000200610     C                     ELSE                                           E21111
388100200610     C*                                                                   E21111
388200200610     C           WSS       IFNE WSPSS                                     E21111
388300200610     C                     MOVE '1'       *IN76                           E21111
388400200610     C                     EXSR OF01                                      E21111
388500200610     C/COPY WNCPYSRC,SE2370C039
388600200610      *                                                                   E21315
388700200610     C                     WRITESECSHR                                    E21315
388800200610     C/COPY WNCPYSRC,SE2370C040
388900200610      *                                                                   E21315
389000200610     C                     MOVE '0'       *IN76                           E21111
389100200610     C                     ADD  2         LCNT                            E21111
389200200610     C                     MOVE COMARA    PRTARA                          E21111
389300200610     C                     END                                            E21111
389400200610     C                     END                                            E21111
389500200610     C*                                                                   E21111
389600200610     C** CHECK IF FLAG P31PRT IS '0' - IF SO PRINT OPBAL AND ADJ.DUE
389700200610     C*  FOR THIS *IN33 FMT DETAL3 REQUEST,AND SET P31PRT TO '1'
389800200610     C*
389900200610     C           P31PRT    IFEQ '0'
390000200610     C                     MOVE '1'       *IN31
390100200610     C*
390200200610     C** WDSNSP NOT ZERO IF ADJUSTMENTS DUE - 32 ON PRINTS ADJUSTMENTS
390300200610     C*
390400200610     C           WDSNSP    IFNE 0
390500200610     C                     MOVE '1'       *IN32
390600200610     C                     END
390700200610     C           WDSRVP    IFNE 0                                         E14739
390800200610     C                     MOVE '1'       *IN52                           E14739
390900200610     C                     END                                            E14739
391000200610     C                     MOVE '1'       P31PRT  1
391100200610     C                     END
391200200610     C*
391300200610     C*   NEXT END IS END OF *IN33 EQUAL TO 1
391400200610     C*
391500200610     C                     END
391600200610     C*
391700200610     C           *IN34     IFEQ '1'
391800200610     C*
391900200610     C** CHECK IF FLAG P31PRT IS '0' - IF SO PRINT OPBAL AND ADJ.DUE
392000200610     C*  FOR THIS *IN34 FMT CLOSING BAL. REQUEST, AND SET P31PRT TO '1'
392100200610     C*
392200200610     C           P31PRT    IFEQ '0'
392300200610     C                     MOVE '1'       *IN31
392400200610     C                     Z-ADDDDTE      WPRTDT
392500200610     C*
392600200610     C** WDSNSP NOT ZERO IF ADJUSTMENTS DUE - 32 ON PRINTS ADJUSTMENTS
392700200610     C*
392800200610     C           WDSNSP    IFNE 0
392900200610     C                     MOVE '1'       *IN32
393000200610     C                     END
393100200610     C           WDSRVP    IFNE 0                                         E14739
393200200610     C                     MOVE '1'       *IN52                           E14739
393300200610     C                     END                                            E14739
393400200610     C                     MOVE '1'       P31PRT  1
393500200610     C                     END
393600200610     C                     END
393700200610     C*
393800200610     C* IF IND 31 IS ON PRINT OPENING BALANCE
393900200610     C*
394000200610     C           *IN31     IFEQ '1'
394100200610     C                     EXSR OF01
394200200610     C*
394300200610     C** ADD OPENING BALANCE TO ZFLD15 AND EDIT IN ZSEDIT
394400200610     C*
394500200610     C                     Z-ADDDSNS      ZFLD15
394600200610     C*
394700200610     C** IF ADJUSTMENTS TO PRINT (32 ON) THEN SUB ADJUSTMENTS FROM
394800200610     C** OPENING BALANCE. THIS IS BECAUSE THE DPOSN FILE RCD IS
394900200610     C** ALREADY UPDATED TO BROUGHT FORWARD POSITION CHANGES.
395000200610     C*
395100200610     C   32      ZFLD15    SUB  WDSNSP    ZFLD15
395200200610     C                     Z-ADDNMDP      ZDECS
395300200610     C                     MOVE 'J'       ZECODE
395400200610     C                     EXSR ZSEDIT
395500200610     C                     MOVE ZOUT21    NOMPRT
395600200610     C*
395700200610     C** CONVERT DATE OF BALANCE FROM 5/0 PACKED TO DDMMMYY FORMAT
395800200610     C*
395900200610     C                     Z-ADDWPRTDT    ZDAYNO
396000200610     C                     EXSR ZDATE2
396100200610     C                     MOVE ZADATE    STGDT1
396200200610     C*
396300200610     C                     WRITEDETAL1
396400200610     C                     ADD  1         LCNT
396500200610     C*                                                                   E14739
396600200610     C** PRINT REPO OPENING BALANCE                                       E14739
396700200610     C** ADD OPENING BALANCE TO ZFLD15 AND EDIT IN ZSEDIT                 E14739
396800200610     C*                                                                   E14739
396900200610     C                     Z-ADDDSRV      ZFLD15                          E14739
397000200610     C*                                                                   E14739
397100200610     C** IF ADJUSTMENTS TO PRINT (52 ON) THEN SUB ADJUSTMENTS FROM        E14739
397200200610     C** OPENING BALANCE.THIS IS BECAUSE THE DPOSN FILE RCD IS            E14739
397300200610     C** ALREADY UPDATED TO BROUGHT FORWARD POSITION CHANGES.             E14739
397400200610     C*                                                                   E14739
397500200610     C   52      ZFLD15    SUB  WDSRVP    ZFLD15                          E14739
397600200610     C                     Z-ADDNMDP      ZDECS                           E14739
397700200610     C                     MOVE 'J'       ZECODE                          E14739
397800200610     C                     EXSR ZSEDIT                                    E14739
397900200610     C                     MOVE ZOUT21    NOMPRT                          E14739
398000200610     C*                                                                   E14739
398100200610     C** CONVERT DATE OF BALANCE FROM 5/0 PACKED TO DDMMMYY FORMAT        E14739
398200200610     C*                                                                   E14739
398300200610     C                     Z-ADDWPRTDT    ZDAYNO                          E14739
398400200610     C                     EXSR ZDATE2                                    E14739
398500200610     C                     MOVE ZADATE    STGDT1                          E14739
398600200610     C*                                                                   E14739
398700200610     C                     EXSR OF01                                      E14739
398800200610     C*                                                                   E14739
398900200610     C                     WRITEDETAL1R                                   E14739
399000200610     C                     ADD  1         LCNT                            E14739
399100200610     C                     END
399200200610     C*
399300200610     C* IF IND 32 IS ON PRINT ADJUSTMENTS DUE
399400200610     C*
399500200610     C           *IN32     IFEQ '1'
399600200610     C                     EXSR OF01
399700200610     C*
399800200610     C** ADD ADJUSTMENTS TO ZFLD15 AND EDIT IN ZSEDIT
399900200610     C*
400000200610     C                     Z-ADDWDSNSP    ZFLD15
400100200610     C                     Z-ADDNMDP      ZDECS
400200200610     C                     MOVE 'J'       ZECODE
400300200610     C                     EXSR ZSEDIT
400400200610     C                     MOVE ZOUT21    NOMPRT
400500200610     C*
400600200610     C                     WRITEDETAL2
400700200610     C                     ADD  1         LCNT
400800200610     C                     END
400900200610     C*                                                                   E14739
401000200610     C* IF IND 52 IS ON PRINT ADJUSTMENTS DUE  REPO                       E14739
401100200610     C*                                                                   E14739
401200200610     C           *IN52     IFEQ '1'                                       E14739
401300200610     C***********          EXSR OF01                               E14739 E15283
401400200610     C*                                                                   E14739
401500200610     C** ADD ADJUSTMENTS TO ZFLD15 AND EDIT IN ZSEDIT                     E14739
401600200610     C*                                                                   E14739
401700200610     C                     Z-ADDWDSRVP    ZFLD15                          E14739
401800200610     C                     Z-ADDNMDP      ZDECS                           E14739
401900200610     C                     MOVE 'J'       ZECODE                          E14739
402000200610     C                     EXSR ZSEDIT                                    E14739
402100200610     C                     MOVE ZOUT21    NOMPRT                          E14739
402200200610     C*                                                                   E14739
402300200610     C                     EXSR OF01                                      E14739
402400200610     C*                                                                   E14739
402500200610     C                     WRITEDETAL2R                                   E14739
402600200610     C                     ADD  1         LCNT                            E14739
402700200610     C                     END                                            E14739
402800200610     C*
402900200610     C* IF IND 33 IS ON PRINT ACTIONS TODAY
403000200610     C*
403100200610     C           *IN33     IFEQ '1'
403200200610     C                     EXSR OF01
403300200610     C*
403400200610     C** ADD NOMINAL ON ACTION RECORD TO ZFLD15 AND EDIT IN ZSEDIT
403500200610     C** N.B. NOMINAL IS ADDED OR SUB'D TO POSITION RECORD DEPENDING
403600200610     C** ON THE TYPE CODES AND REVERSE FLAG. SUBR ACCUM SETS IND 65 ON
403700200610     C** IF ITS AN ADDITION, OFF IF ITS A SUBTRACTION. THE SIGN OF THE
403800200610     C** NOMINAL VALUE INPUT IS MADE POSITIVE FIRST.
403900200610     C*
404000200610     C           *IN01     IFEQ '1'
404100200610     C           DMNA      IFLT 0
404200200610     C                     Z-SUBDMNA      ZFLD15
404300200610     C                     ELSE
404400200610     C                     Z-ADDDMNA      ZFLD15
404500200610     C                     END
404600200610     C  N65                Z-SUBZFLD15    ZFLD15
404700200610     C                     END
404800200610     C           *IN02     IFEQ '1'
404900200610     C           *IN06     OREQ '1'                                       E14753
405000200610     C           SNMS      IFLT 0
405100200610     C                     Z-SUBSNMS      ZFLD15
405200200610     C                     ELSE
405300200610     C                     Z-ADDSNMS      ZFLD15
405400200610     C                     END
405500200610     C  N65                Z-SUBZFLD15    ZFLD15
405600200610     C                     END
405700200610     C           *IN03     IFEQ '1'
405800200610     C           *IN05     OREQ '1'                                       E14753
405900200610     C           NOML      IFLT 0
406000200610     C                     Z-SUBNOML      ZFLD15
406100200610     C                     ELSE
406200200610     C                     Z-ADDNOML      ZFLD15
406300200610     C                     END
406400200610     C  N65                Z-SUBZFLD15    ZFLD15
406500200610     C                     END
406600200610     C           *IN04     IFEQ '1'
406700200610     C           CMNA      IFLT 0
406800200610     C                     Z-SUBCMNA      ZFLD15
406900200610     C                     ELSE
407000200610     C                     Z-ADDCMNA      ZFLD15
407100200610     C                     END
407200200610     C  N65                Z-SUBZFLD15    ZFLD15
407300200610     C                     END
407400200610     C*
407500200610     C                     Z-ADDNMDP      ZDECS
407600200610     C                     MOVE 'J'       ZECODE
407700200610     C                     EXSR ZSEDIT
407800200610     C                     MOVE ZOUT21    NOMPRT
407900200610     C*
408000200610     C* ACCESS CLINTCB FOR CUST. NO
408100200610     C*      - DEPENDING ON TYPE OF ACTION
408200200610     C*
408300200610     C* IF ACTION IS UDPMVD
408400200610     C*  - GET BRANCH INTERNAL CUST NO.
408500200610     C*
408600200610     C           *IN01     IFEQ '1'
408700200610     C***********          MOVE *BLANK    BRNM                            E29170
408800200610     C***********          MOVE *BLANK    TABTRN 30                       E29170
408900200610     C                     EXSR TR10
409000200610     C                     MOVE BICN      WCLNTK
409100200610     C                     END
409200200610     C*
409300200610     C   02                MOVE SCPT      WCLNTK
409400200610     C   03                MOVE TRCP      WCLNTK
409500200610     C   04                MOVE CCRT      WCLNTK
409600200610     C   05                MOVE TRCP      WCLNTK                          E14753
409700200610     C   06                MOVE SCPT      WCLNTK                          E14753
409800200610     C*
409900200610     C                     EXSR CLNTIN
410000200610     C           *IN79     IFEQ '1'
410100200610     C                     MOVE *BLANKS   CSYCLN
410200200610     C                     MOVE *BLANKS   CSYTWN
410300200610     C                     ELSE
410400200610     C                     MOVELCRNM      CSYCLN
410500200610     C                     MOVELCTWN      CSYTWN
410600200610     C                     END
410700200610     C*
410800200610     C   04                MOVELDPNR      CPNARR
410900200610     C                     WRITEDETAL3
411000200610     C                     ADD  1         LCNT
411100200610     C                     END
411200200610     C*
411300200610     C* IF IND 34 IS ON PRINT CLOSING BALANCE
411400200610     C*
411500200610     C           *IN34     IFEQ '1'
411600200610     C*
411700200610     C                     EXSR OF01
411800200610     C*
411900200610     C** ADD CLOSING BALANCE TO ZFLD15 AND EDIT IN ZSEDIT
412000200610     C*
412100200610     C                     Z-ADDDSNS      ZFLD15
412200200610     C                     Z-ADDNMDP      ZDECS
412300200610     C                     MOVE 'J'       ZECODE
412400200610     C                     EXSR ZSEDIT
412500200610     C                     MOVE ZOUT21    NOMPRT
412600200610     C*
412700200610     C*   GET DEPOT AND REFERENCE DESCRIPTIONS - FIRST CLEAR PREVIOUS
412800200610     C*
412900200610     C***********          MOVE *BLANK    DEP1                            S01176
413000200610     C***********          MOVE *BLANK    REF1                            S01176
413100200610     C***********          MOVE *BLANK    DEP2                            S01176
413200200610     C***********          MOVE *BLANK    REF2                            S01176
413300200610     C***********          MOVE *BLANK    DEP3                            S01176
413400200610     C***********          MOVE *BLANK    REF3                            S01176
413500200610     C***********          MOVELD1SR      REF1                            S01176
413600200610     C***********          MOVELD2SR      REF2                            S01176
413700200610     C***********          MOVELD3SR      REF3                            S01176
413800200610     C***********                                                         E21111
413900200610     C***********          MOVE *BLANK    DEP1   10                S01176 E21111
414000200610     C***********          MOVE *BLANK    REF1   12                S01176 E21111
414100200610     C***********          MOVE *BLANK    DEP2   10                S01176 E21111
414200200610     C***********          MOVE *BLANK    REF2   12                S01176 E21111
414300200610     C***********          MOVE *BLANK    DEP3   10                S01176 E21111
414400200610     C***********          MOVE *BLANK    REF3   12                S01176 E21111
414500200610     C***********          MOVELDASR      REF1                     S01176 E21111
414600200610     C***********          MOVELDCSR      REF2                     S01176 E21111
414700200610     C***********          MOVELDDSR      REF3                     S01176 E21111
414800200610     C***********                                                         E21111
414900200610     C****TO*GET*DEPOT*DESCRIPTION*ACCESS*INVTPD*FOR*SETT.DEPOTS*1,2,3*   E21111
415000200610     C****AND*THEN*USE*EACH*CODE*TO*ACCESS*CLINTB*FOR*SHORT*DESC.******   E21111
415100200610     C***********                                                         E21111
415200200610     C***********          EXSR INVTIN                                    E21111
415300200610     C***********          Z-ADDSDC1      WCLNTK                          E21111
415400200610     C***********          EXSR CLNTIN                                    E21111
415500200610     C************IN79     IFEQ '1'                                       E21111
415600200610     C***********          MOVE *BLANK    DEP1                            E21111
415700200610     C***********          ELSE                                           E21111
415800200610     C***********CSNM      IFEQ *BLANK                                    E21111
415900200610     C***********          MOVELCNUM      DEP1                            E21111
416000200610     C***********          ELSE                                           E21111
416100200610     C***********          MOVELCSNM      DEP1                            E21111
416200200610     C***********          END                                            E21111
416300200610     C***********          END                                            E21111
416400200610     C***********          Z-ADDSDC2      WCLNTK                          E21111
416500200610     C***********          EXSR CLNTIN                                    E21111
416600200610     C************IN79     IFEQ '1'                                       E21111
416700200610     C***********          MOVE *BLANK    DEP2                            E21111
416800200610     C***********          ELSE                                           E21111
416900200610     C***********CSNM      IFEQ *BLANK                                    E21111
417000200610     C***********          MOVELCNUM      DEP2                            E21111
417100200610     C***********          ELSE                                           E21111
417200200610     C***********          MOVELCSNM      DEP2                            E21111
417300200610     C***********          END                                            E21111
417400200610     C***********          END                                            E21111
417500200610     C***********          Z-ADDSDC3      WCLNTK                          E21111
417600200610     C***********          EXSR CLNTIN                                    E21111
417700200610     C************IN79     IFEQ '1'                                       E21111
417800200610     C***********          MOVE *BLANK    DEP3                            E21111
417900200610     C***********          ELSE                                           E21111
418000200610     C***********CSNM      IFEQ *BLANK                                    E21111
418100200610     C***********          MOVELCNUM      DEP3                            E21111
418200200610     C***********          ELSE                                           E21111
418300200610     C***********          MOVELCSNM      DEP3                            E21111
418400200610     C***********          END                                            E21111
418500200610     C***********          END                                            E21111
418600200610     C*                                                                   E14739
418700200610     C***********          EXSR OF01                               E14739 E15283
418800200610     C*
418900200610     C                     WRITEDETAL4
419000200610     C                     ADD  2         LCNT
419100200610     C*                                                                   E14739
419200200610     C** ADD REPO CLOSING BALANCE TO ZFLD15 AND EDIT IN ZSEDIT            E14739
419300200610     C*                                                                   E14739
419400200610     C                     Z-ADDDSRV      ZFLD15                          E14739
419500200610     C                     Z-ADDNMDP      ZDECS                           E14739
419600200610     C                     MOVE 'J'       ZECODE                          E14739
419700200610     C                     EXSR ZSEDIT                                    E14739
419800200610     C                     MOVE ZOUT21    NOMPRT                          E14739
419900200610     C*                                                                   E14739
420000200610     C                     EXSR OF01                                      E14739
420100200610     C*                                                                   E14739
420200200610     C                     WRITEDETAL4R                                   E14739
420300200610     C                     ADD  2         LCNT                            E14739
420400200610     C*                                                                   E14739
420500200610     C** SET PRINT OPBAL/ADJST FLAG P31PRT BACK TO ZERO -
420600200610     C** SINCE AFTER PRINTING, A CLOBAL AN OPBAL WILL BE REQUIRED NEXT
420700200610     C*
420800200610     C                     MOVE '0'       P31PRT
420900200610     C*
421000200610     C                     END
421100200610     C*
421200200610     C                     ENDSR
421300200610      *
421400200610      *****************************************************************
421500200610      /EJECT
421600200610      *****************************************************************
421700200610      *                                                               *
421800200610      *  OF01   - Subroutine to Check an Print Overflow.              *
421900200610      *                                                               *
422000200610      *****************************************************************
422100200610      *
422200200610     C           OF01      BEGSR                           ** OF01  **
422300200610     C*
422400200610     C*  THIS ROUTINE IS CALLED TO CHECK IF LCNT (LINE COUNT)
422500200610     C*  IS ABOVE A CERTAIN VALUE - IF SO PRINT HEADINGS
422600200610     C*
422700200610     C*  IF 76 ON, OVERFLOW BEFORE PRINTING SECSHR SO DO NOT PRINT SECSH
422800200610     C*
422900200610     C           *IN76     IFEQ '1'
423000200610     C           LCNT      IFGT 56
423100200610     C                     WRITEHEADP1
423200200610     C                     Z-ADD10        LCNT    20
423300200610     C                     END
423400200610     C                     ELSE
423500200610     C           LCNT      IFGT 60
423600200610     C                     WRITEHEADP1
423700200610     C/COPY WNCPYSRC,SE2370C041
423800200610     C                     WRITESECSHR
423900200610     C/COPY WNCPYSRC,SE2370C042
424000200610     C                     Z-ADD12        LCNT    20
424100200610     C                     END
424200200610     C                     END
424300200610     C*
424400200610     C                     ENDSR
424500200610      *
424600200610      *****************************************************************
424700200610      /EJECT
424800200610      *****************************************************************
424900200610      *                                                               *
425000200610      *  DIVIDN - Subroutine to produce Dividend Account Keys and/or  *
425100200610      *           Position Settlements.                               *
425200200610      *                                                               *
425300200610      *****************************************************************
425400200610      *
425500200610     C           DIVIDN    BEGSR                           ** DIVIDN **
425600200610     C*
425700200610     C** CALCULATE DIVIDEND DUE
425800200610     C*
425900200610     C*NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
426000200610     C** If S01509 is active, use value currency instead of nominal ccy   S01509
426100200610     C*
426200200610     C********** S01509    IFEQ 'Y'                                                  S01509 BUG11198
426300200610     C**********           MOVE VLCY      WCURR                                      S01509 BUG11198
426400200610     C**********           ELSE                                                      S01509 BUG11198
426500200610     C                     MOVE NMCY      WCURR   3
426600200610     C**********           END                                                       S01509 BUG11198
426700200610     C                     EXSR TG10
426800200610      *                                                                   E19610
426900200610      *  FOR DIVIDENDS, CALCULATE CUM-COUPON VALUE USING THE TRADE DATE   E19610
427000200610      *  POSITION INSTEAD OF THE VALUE DATE.                              E19610
427100200610      ** If S01510 is active, then the cum-coupon value must be the       S01510
427200200610      ** trade date nominal                                               S01510
427300200610     C*** (Use Value date position if required)                           095066
427400200610      *                                                                   E19610
427500200610     C           S01510    IFEQ 'Y'                                       S01510
427600200610     C           CSE008    IFNE 'Y'                                       095066
427700200610     C                     Z-ADDWBDSNT    WCUMCP                          S01510
427800200610     C                     ELSE                                           095066
427900200610     C                     Z-ADDWBDSNV    WCUMCP                          095066
428000200610     C                     END                                            095066
428100200610     C                     ELSE                                           S01510
428200200610     C           CSE008    IFNE 'Y'                                       095066
428300200610     C           WBDSNT    SUB  WBDEXN    WCUMCP                          E19610
428400200610     C                     ELSE                                           095066
428500200610     C           WBDSNV    SUB  WBDEXN    WCUMCP                          095066
428600200610     C                     END                                            095066
428700200610     C                     END                                            S01510
428800200610     C*
428900200610     C**DIVIDEND*DUE*CALCULATION***************************************   E20972
429000200610     C**CUM-COUPON**MULTIPLIED*BY*AMOUNT*PER*UNIT*(SDDV)***************   E20972
429100200610     C**GIVING*WORK*(15/4).*MULTIPLY*BY*POWER*VALUE*AND*RESULT*IN*13/0*   E20972
429200200610     C***********                                                         E20972
429300200610     C***********          Z-ADD0         DC                              E20972
429400200610     C***********                                                         E20972
429500200610     C***********          SUB  NMDP      DC      10                      E20972
429600200610     C***********DC        ADD  5         DC      10                      E20972
429700200610     C***********WCUMCP    MULT POWER8,DC WRK154                          E20086
429800200610     C***********WCUMCP    MULT POWER8,DC WRK154 154               E20086 E20972
429900200610     C***********                                                         E20972
430000200610     C***********WRK154    MULT SDDV      WRK154 154                      E16772
430100200610     C***********WRK154    MULT SDVA      WRK158                   E16772 E20086
430200200610     C***********WRK154    MULT SDVA      WRK158 158               E20086 E20972
430300200610     C***********CDP       ADD  5         DC                              E20972
430400200610     C***********WRK154    MULT POWER8,DC WRK154                          E16772
430500200610     C***********WRK158    MULT POWER8,DC WRK158                   E16772 E20972
430600200610     C***********WRK154    DIV  1         WDIVDU 130H                     E16772
430700200610     C***********WRK158    DIV  1         WDIVDU 130H              E16772 E20972
430800200610     C***********                                                         E20972
430900200610     C***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100******************   E20972
431000200610     C***********                                                         E20972
431100200610     C***********SPBS      IFEQ 'P'                                       E20972
431200200610     C***********WDIVDU    DIV  100       WDIVDU    H                     E20972
431300200610     C***********          END                                            E20972
431400200610     C*                                                                   E20972
431500200610     C** USE SUBROUTINE ZCNSD TO CALCULATE DIVIDEND DUE                   E20972
431600200610     C*                                                                   E20972
431700200610     C                     Z-ADDWCUMCP    ZNOML                           E20972
431800200610     C                     Z-ADDSDVA      ZPRC                            E20972
431900200610     C***********SPBS      IFEQ 'P'                                E23169 087712
432000200610     C***********          MULT 100       ZPRC                     E23169 087712
432100200610     C***********          END                                     E23169 087712
432200200610     C                     EXSR ZCNSD                                     E20972
432300200610     C                     Z-ADDZCONS     WDIVDU 150                      E20972
432400200610     C** If S01509 is active, and value currency is different from                          BUG11198
432500200610     C** nominal currency, convert coupon amount to value currency                          BUG11198
432600200610     C*                                                                                     BUG11198
432700200610     C           S01509    IFEQ 'Y'                                                         BUG11198
432800200610     C           NMCY      ANDNEVLCY                                                        BUG11198
432900200610     C                     MOVE NMCY      WCURR   3                                         BUG11198
433000200610     C                     EXSR TG10                                                        BUG11198
433100200610     C                     Z-ADDZCDP      ZCDPI                                             BUG11198
433200200610     C                     MOVE VLCY      WCURR   3                                         BUG11198
433300200610     C                     EXSR TG10                                                        BUG11198
433400200610     C                     Z-ADDZCDP      ZCDPO                                             BUG11198
433500200610     C                     MOVE NMCY      ZCCYI                                             BUG11198
433600200610     C                     MOVE VLCY      ZCCYO                                             BUG11198
433700200610     C                     Z-ADDWDIVDU    ZAMTCI                                            BUG11198
433800200610     C*                                                                                     BUG11198
433900200610     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event                     BUG11198
434000200610     C** found, else from SECTYD                                                            BUG11198
434100200610     C*                                                                                     BUG11198
434200200610     C                     MOVE SDET      WKDET   2                                         BUG11198
434300200610     C                     MOVE 'XR'      SDET                                              BUG11198
434400200610     C           SECETY    SETLLSEDEVDO                                                     BUG11198
434500200610     C                     READ SEDEVDO                  81                                 BUG11198
434600200610     C           *IN81     IFEQ '0'                                                         BUG11198
434700200610     C           SDSN      ANDEQSASN                                                        BUG11198
434800200610     C           SDET      ANDEQ'XR'                                                        BUG11198
434900200610     C                     Z-ADDSDCE      ZEXCH                                             BUG11198
435000200610     C                     MOVE SDMD      ZMD                                               BUG11198
435100200610     C                     ELSE                                                             BUG11198
435200200610     C                     Z-ADDSEXR      ZEXCH                                             BUG11198
435300200610     C                     MOVE SMDI      ZMD                                               BUG11198
435400200610     C                     ENDIF                                                            BUG11198
435500200610     C                     MOVE WKDET     SDET                                              BUG11198
435600200610     C                     EXSR ZCONV                                                       BUG11198
435700200610     C                     Z-ADDZAMTCO    WDIVDU                                            BUG11198
435800200610     C                     ENDIF                                                            BUG11198
435900200610     C*
436000200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W03
436100200610     C*
436200200610     C           SDAD      IFNE 0
436300200610     C                     MOVE 'H'       WACEVC
436400200610     C*
436500200610     C** SET NEGATIVE IND TO N IF SPLIT NEG ACCRUAL IS NOT N AND
436600200610     C** AND CUM-COUPON VALUE NOT GREATER THAN ZERO
436700200610     C*
436800200610     C           SNAC      IFEQ 'N'
436900200610     C           WCUMCP    ORGT 0
437000200610     C                     MOVE ' '       WACNEG
437100200610     C                     ELSE
437200200610     C                     MOVE 'N'       WACNEG
437300200610     C                     END
437400200610     C                     MOVE 'DI'      WACAMC
437500200610     C                     Z-ADDWDIVDU    EVAM
437600200610     C*
437700200610     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG ACCRUAL IS Y AND
437800200610     C** CUM-COUPON VALUE IS LESS THAN ZERO
437900200610     C*
438000200610     C           WCUMCP    IFLT 0
438100200610     C           SNAC      ANDEQ'Y'
438200200610     C                     Z-SUBEVAM      EVAM
438300200610     C                     END
438400200610     C                     EXSR W03
438500200610     C/COPY WNCPYSRC,SE2370C001
438600200610     C                     END
438700200610     C*
438800200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
438900200610     C*
439000200610     C           SDDT      IFNE 0
439100200610     C                     MOVE 'DV'      PEVT
439200200610     C                     Z-ADDWCUMCP    PNMP                            E23169
439300200610     C***********DSNV      SUB  DEXN      WRK150 150                      E23169
439400200610     C***********          Z-ADDWRK150    PNMP                            E23169
439500200610     C           WDIVDU    IFLT 0
439600200610     C                     Z-SUBWDIVDU    PAMD
439700200610     C                     ELSE
439800200610     C                     Z-ADDWDIVDU    PAMD
439900200610     C                     END
440000200610     C***********WRK150    IFGT 0                                         E23169
440100200610     C           WCUMCP    IFGT 0                                         E23169
440200200610     C                     MOVE 'R'       PPRE
440300200610     C                     ELSE
440400200610     C                     MOVE 'P'       PPRE
440500200610     C                     END
440600200610      *                                                                                       260331
440700200610     C           WRVPOS    IFEQ 'Y'                                                           260331
440800200610     C           PPRE      IFEQ 'R'                                                           260331
440900200610     C                     MOVE 'P'       PPRE                                                260331
441000200610     C                     ELSE                                                               260331
441100200610     C           PPRE      IFEQ 'P'                                                           260331
441200200610     C                     MOVE 'R'       PPRE                                                260331
441300200610     C                     ENDIF                                                              260331
441400200610     C                     ENDIF                                                              260331
441500200610     C                     ENDIF                                                              260331
441600200610      *                                                                                       260331
441700200610     C                     EXSR W02
441800200610     C                     END
441900200610     C*
442000200610     C           ENDDIV    ENDSR                           **ENDDIV**
442100200610      *
442200200610      *****************************************************************
442300200610      /EJECT
442400200610      *****************************************************************
442500200610      *                                                               *
442600200610      *  COUPON - Subroutine to produce Coupon Account Keys and/or    *
442700200610      *           Position Settlements.                               *
442800200610      *                                                               *
442900200610      *****************************************************************
443000200610      *
443100200610     C           COUPON    BEGSR                           ** COUPON **
443200200610     C*
443300200610     C** WORK FIELDS FOR THE A/K COUPON DATE AND POS. SETL. COUPON DATE   064754
443400200610     C*                                                                   064754
443500200610     C                     Z-ADD0         SAVDAD  50                      064754
443600200610     C                     Z-ADD0         SAVDDT  50                      064754
443700200610     C*
443800200610     C** CALCULATE INTEREST DUE VIA P/ZACCRD FOR SECURITY
443900200610     C*  FROM DATE IS LAST COUPON / TO DATE IS EVENT DATE.
444000200610     C*  GET NOMINAL CCY DEC PLACES FROM TABTG10 FIRST (CDP)
444100200610     C*
444200200610     C                     MOVE NMCY      WCURR   3
444300200610     C                     EXSR TG10
444400200610     C*
444500200610      *  TO GENERATE ADJUSTED POSITION SETTLENENT FOR COUPON, SAVE        064754
444600200610      *  THE A/K COUPON DATE AND POS. SETL. COUPON DATE                   064754
444700200610      *                                                                   064754
444800200610     C                     Z-ADDSDAD      SAVDAD                          064754
444900200610     C                     Z-ADDSDDT      SAVDDT                          064754
445000200610     C*
445100200610     C** WHEN PARM ZAB IS 'A', INTEREST IS CALCULATED AFTER CHANGES
445200200610     C** WHEN PARM ZAB IS 'B', INTEREST IS CALCULATED BEFORE CHANGES
445300200610     C*  I.E. 'CHANGES' ARE UPDATES DUE TO BACKVALUATIONS IN PGM
445400200610     C*
445500200610     C                     MOVE 'A'       ZAB
445600200610     C***********          UNLCKLDA                                       S01117
445700200610      *C*PY*WN*PY*RC*SE2370C020                                           S01408
445800200610     C/COPY WNCPYSRC,SE2370C018                                           S01408
445900200610     C                     CALL 'ZACCRD'
446000200610     C***********          PARM           LCPN                            E21669
446100200610     C                     PARM           LCCP                            E21669
446200200610     C                     PARM           SDED
446300200610     C***********          PARM           DSBR                            S01117
446400200610     C                     PARM           DSBA                            S01117
446500200610     C                     PARM           DDPT
446600200610     C                     PARM           DSSC
446700200610     C                     PARM           CDP
446800200610     C                     PARM           ZINTDU 150
446900200610     C                     PARM           ZINDUE 151                      055420
447000200610     C                     PARM           ZAB     1
447100200610      *C*PY*WN*PY*RC*SE2370C021                                           S01408
447200200610     C/COPY WNCPYSRC,SE2370C019                                           S01408
447300200610     C*
447400200610     C*   U7 AND U8 ON IF DATABASE ERROR DURING ZACCR PROCESSING
447500200610     C*
447600200610     C   U7 U8             GOTO EAUDIT
447700200610     C*
447800200610     C** IF WDIFF = Y, CALL ZACCRD AGAIN WITH STATUS B AND SUBTRACT 'A'
447900200610     C*
448000200610     C           WDIFF     IFEQ 'Y'
448100200610     C***********          Z-ADDZINTDU    ZWINTD 150                      055420
448200200610     C                     Z-ADDZINDUE    ZWINTD 151                      055420
448300200610     C                     MOVE 'B'       ZAB
448400200610     C***********          UNLCKLDA                                       S01117
448500200610     C/COPY WNCPYSRC,SE2370C030
448600200610     C/COPY WNCPYSRC,SE2370C020                                           S01408
448700200610     C                     CALL 'ZACCRD'
448800200610     C***********          PARM           LCPN                            E21669
448900200610     C                     PARM           LCCP                            E21669
449000200610     C                     PARM           SDED
449100200610     C***********          PARM           DSBR                            S01117
449200200610     C                     PARM           DSBA                            S01117
449300200610     C                     PARM           DDPT
449400200610     C                     PARM           DSSC
449500200610     C                     PARM           CDP
449600200610     C                     PARM           ZINTDU 150
449700200610     C                     PARM           ZINDUE 151                      055420
449800200610     C                     PARM           ZAB     1
449900200610     C/COPY WNCPYSRC,SE2370C031
450000200610     C/COPY WNCPYSRC,SE2370C021                                           S01408
450100200610     C*
450200200610     C*   U7 AND U8 ON IF DATABASE ERROR DURING ZACCR PROCESSING
450300200610     C*
450400200610     C   U7 U8             GOTO EAUDIT
450500200610     C***********ZWINTD    SUB  ZINTDU    ZINTDU                          055420
450600200610     C           ZWINTD    SUB  ZINDUE    ZINTDU 150H                     055420
450700200610     C                     END
450800200610     C/COPY WNCPYSRC,SE2370C026
450900200610     C*                                                                   S01509
451000200610     C** If S01509 is active, and value currency is different from        S01509
451100200610     C** nominal currency, convert coupon amount to value currency        S01509
451200200610     C*                                                                   S01509
451300200610     C           S01509    IFEQ 'Y'                                       S01509
451400200610     C           NMCY      ANDNEVLCY                                      S01509
451500200610     C                     MOVE NMCY      WCURR   3                       S01509
451600200610     C                     EXSR TG10                                      S01509
451700200610     C                     Z-ADDZCDP      ZCDPI                           S01509
451800200610     C                     MOVE VLCY      WCURR   3                       S01509
451900200610     C                     EXSR TG10                                      S01509
452000200610     C                     Z-ADDZCDP      ZCDPO                           S01509
452100200610     C                     MOVE NMCY      ZCCYI                           S01509
452200200610     C                     MOVE VLCY      ZCCYO                           S01509
452300200610     C                     Z-ADDZINTDU    ZAMTCI                          S01509
452400200610     C*                                                                   S01509
452500200610     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event   S01509
452600200610     C** found, else from SECTYD                                          S01509
452700200610     C*                                                                   S01509
452800200610     C                     MOVE SDET      WKDET   2                       S01509
452900200610     C                     MOVE 'XR'      SDET                            S01509
453000200610     C           SECETY    SETLLSEDEVDO                                   S01509
453100200610     C                     READ SEDEVDO                  75               S01509
453200200610     C           *IN75     IFEQ '0'                                       S01509
453300200610     C           SOSDSN    ANDEQWDSSC                                     S01509
453400200610     C           SOSDET    ANDEQ'XR'                                      S01509
453500200610     C                     Z-ADDSOSDCE    ZEXCH                           S01509
453600200610     C                     MOVE SOSDMD    ZMD                             S01509
453700200610     C                     ELSE                                           S01509
453800200610     C                     Z-ADDSEXR      ZEXCH                           S01509
453900200610     C                     MOVE SMDI      ZMD                             S01509
454000200610     C                     END                                            S01509
454100200610     C                     MOVE WKDET     SDET                            S01509
454200200610     C                     EXSR ZCONV                                     S01509
454300200610     C                     Z-ADDZAMTCO    ZINTDU                          S01509
454400200610     C                     END                                            S01509
454500200610     C/COPY WNCPYSRC,SE2370C002
454600200610     C*                                                                   051107
454700200610     C*** GENERATE A/C KEY AND POSITION SETTLEMENT IF THERE ARE           051107
454800200610     C*** ADJECTMENTS.                                                    051107
454900200610     C*                                                                   051107
455000200610     C           ZINTDU    IFNE 0                                         051107
455100200610     C           WDPSN     ANDNE0                                         157260
455200200610     C*
455300200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W03
455400200610     C*
455500200610     C           SDAD      IFNE 0
455600200610     C           SAVDAD    ORNE 0                                         064754
455700200610     C                     MOVE 'C'       WACEVC
455800200610     C           SNAC      IFEQ 'N'
455900200610     C           WCUMCP    ORGT 0
456000200610     C                     MOVE ' '       WACNEG
456100200610     C                     ELSE
456200200610     C                     MOVE 'N'       WACNEG
456300200610     C                     END
456400200610     C                     MOVE 'DI'      WACAMC
456500200610     C                     Z-ADDZINTDU    EVAM
456600200610     C           ZINTDU    IFLT 0
456700200610     C           SNAC      ANDEQ'Y'
456800200610     C                     Z-SUBEVAM      EVAM
456900200610     C                     END
457000200610     C                     EXSR W03
457100200610     C/COPY WNCPYSRC,SE2370C003
457200200610     C                     END
457300200610     C*
457400200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
457500200610     C*
457600200610     C           SDDT      IFNE 0
457700200610     C           SAVDDT    ORNE 0                                         064754
457800200610     C*                                                                   064754
457900200610     C           SDED      IFEQ 0                                         064754
458000200610     C                     Z-ADDSAVDDT    SDED                            064754
458100200610     C                     END                                            064754
458200200610     C*                                                                   064754
458300200610     C                     MOVE 'CP'      PEVT
458400200610     C                     Z-ADDWCUMCP    PNMP                            E23169
458500200610     C***********DSNV      SUB  DEXN      WRK150 150                      E23169
458600200610     C***********          Z-ADDWRK150    PNMP                            E23169
458700200610     C           ZINTDU    IFLT 0
458800200610     C                     Z-SUBZINTDU    PAMD
458900200610     C                     MOVE 'P'       PPRE
459000200610     C/COPY WNCPYSRC,SE2370C004
459100200610     C                     ELSE
459200200610     C                     Z-ADDZINTDU    PAMD
459300200610     C                     MOVE 'R'       PPRE
459400200610     C/COPY WNCPYSRC,SE2370C005
459500200610     C                     END
459600200610     C                     EXSR W02
459700200610     C                     END
459800200610     C*                                                                   051107
459900200610     C                     END                                            051107
460000200610     C/COPY WNCPYSRC,SE2370C006
460100200610     C*
460200200610     C           ENDCPN    ENDSR                           ** ENDCPN **
460300200610      *
460400200610      *****************************************************************
460500200610      /EJECT
460600200610      *****************************************************************
460700200610      *                                                               *
460800200610      *  PARTPY - Subroutine to produce Part Payment Position         *
460900200610      *           Settlements.                                        *
461000200610      *                                                               *
461100200610      *****************************************************************
461200200610      *
461300200610     C           PARTPY    BEGSR                           ** PARTPY **
461400200610     C*
461500200610     C** CALCULATE PAYMENT DUE AS:
461600200610     C*       NOMINAL TRADE DATE BASIS TIMES CALL AMOUNT
461700200610     C*       HOLDING IS IN NOM.DEC PLACES, RESULT AS 13/0 WITH CCY DEC
461800200610     C*
461900200610     C*   GET SECURITY RECORD IN
462000200610     C*
462100200610     C*NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY  TO GET CCY DP
462200200610     C*
462300200610     C                     MOVE NMCY      WCURR   3
462400200610     C                     EXSR TG10
462500200610     C*
462600200610     C***********                                                         E23169
462700200610     C***********CDP       SUB  NMDP      DC                              E23169
462800200610     C***********DC        ADD  5         DC                              E23169
462900200610     C***********                                                         E23169
463000200610     C***IF*DC*LESS*THAN*5*IT*IS*A*DIVIDE*-*DO*LATER**********************E23169
463100200610     C***********                                                         E23169
463200200610     C***********DC        IFGT 4                                         E23169
463300200610     C***********WBDSNV    MULT POWER8,DC WRK130 130                      E23169
463400200610     C***********          ELSE                                           E23169
463500200610     C***********          Z-ADDWBDSNV    WRK130                          E23169
463600200610     C***********          END                                            E23169
463700200610     C***********                                                         E23169
463800200610     C**USE*PERCENTAGE*FIELD*OR*AMOUNT*FIELD*WHICHEVER*IS*NOT*ZERO********E23169
463900200610     C**IF*BOTH*ZERO*DATA*BASE*ERROR**************************************E23169
464000200610     C***********                                                         E23169
464100200610     C***********SDPC      IFNE 0                                         E23169
464200200610     C***********WRK130    MULT SDPC      WRK154 154               E20972 E23169
464300200610     C***********WRK154    DIV  100       WRK154    H                     E23169
464400200610     C***********          ELSE                                           E23169
464500200610     C***********SDPP      IFNE 0                                         E23169
464600200610     C***********                                                  E21603 E23169
464700200610     C**CONVERT*AMOUNT*FIELD*FROM*15/0*TO*CCY*DECIMAL*PLACES*******E21603*E23169
464800200610     C***********                                                  E21603 E23169
464900200610     C***********5         SUB  CDP       DC                       E21603 E23169
465000200610     C***********SDPP      MULT POWER8,DC WRK154                   E21603 E23169
465100200610     C***********WRK130    MULT SDPP      WRK150                   E21603 E23169
465200200610     C***********WRK130    MULT WRK154    WRK150    H              E21603 E23169
465300200610     C***********          ELSE                                           E23169
465400200610     C***********                                                         E23169
465500200610     C**DB*ERROR*-*BOTH*PRICES*ARE*ZERO***********************************E23169
465600200610     C***********                                                         E23169
465700200610     C***********          MOVEL'SEDEVD'  DBFILE           ***************E23169
465800200610     C***********          MOVEL'CALL%0'  DBKEY            ** DB ERROR 13 E23169
465900200610     C***********          SETON                     U7U8  ***************E23169
466000200610     C***********          Z-ADD13        DBASE                           E23169
466100200610     C***********          GOTO EAUDIT                                    E23169
466200200610     C***********          END                                            E23169
466300200610     C***********          END                                            E23169
466400200610     C***********                                                         E23169
466500200610     C***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR*****E23169
466600200610     C***********                                                         E23169
466700200610     C***********          EXSR INVTIN                                    E23169
466800200610     C***********                                                         E23169
466900200610     C***********PROT      IFEQ '8'                                       E23169
467000200610     C***********SDCP      IFNE 0                                         E23169
467100200610     C***********WRK154    MULT SDCP      WRK154                          E23169
467200200610     C***********          ELSE                                           E23169
467300200610     C***********WRK150    MULT SDCP      WRK154                          E23169
467400200610     C***********          END                                            E23169
467500200610     C***********          ELSE                                           E21603
467600200610     C***********SDCP      IFEQ 0                                         E21603
467700200610     C***********          Z-ADDWRK150    WRK154                          E21603
467800200610     C***********          END                                            E21603
467900200610     C***********          END                                            E23169
468000200610     C***********                                                         E23169
468100200610     C***IF*DC*LESS*THAN*5*DO*FINAL*DIVIDE*HERE***************************E23169
468200200610     C***********                                                         E23169
468300200610     C***********DC        IFLT 5                                         E23169
468400200610     C***********WRK154    MULT POWER8,DC WRK154                          E23169
468500200610     C***********          END                                            E23169
468600200610     C***********                                                         E23169
468700200610     C***********                                                         E23169
468800200610     C***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100*********************E23169
468900200610     C***********                                                         E23169
469000200610     C***********SPBS      IFEQ 'P'                                       E23169
469100200610     C***********WRK154    DIV  100       WPAYDU    H                     E23169
469200200610     C***********          ELSE                                           E23169
469300200610     C***********WRK154    DIV  1         WPAYDU 130H                     E23169
469400200610     C***********          END                                            E23169
469500200610     C           PROT      IFNE '4'                                       E23169
469600200610     C           SDPC      DIV  100000    ZPRC                            E23169
469700200610     C                     ELSE                                           E23169
469800200610     C           5         ADD  CDP       DC                              E23169
469900200610     C           SDPP      DIV  POWER8,DC ZPRC                            E23169
470000200610     C                     END                                            E23169
470100200610     C           SPBS      IFEQ 'P'                                       E23169
470200200610     C                     MULT 100       ZPRC                            E23169
470300200610     C                     END                                            E23169
470400200610     C                     Z-ADDWBDSNV    ZNOML                           E23169
470500200610     C                     EXSR ZCNSD                                     E23169
470600200610     C                     Z-ADDZCONS     WPAYDU 130                      E23169
470700200610     C*
470800200610     C* WRITE POSITION SETTLEMENT
470900200610     C*
471000200610     C                     MOVE 'PP'      PEVT
471100200610     C***********          Z-ADDDSNV      PNMP                            E23169
471200200610     C                     Z-ADDWBDSNV    PNMP                            E23169
471300200610     C                     Z-ADDWPAYDU    PAMD
471400200610     C           PAMD      IFLT 0
471500200610     C                     Z-SUBPAMD      PAMD
471600200610     C                     END
471700200610     C*
471800200610     C           WBDSNV    IFLE 0
471900200610     C                     MOVE 'R'       PPRE
472000200610     C                     ELSE
472100200610     C                     MOVE 'P'       PPRE
472200200610     C                     END
472300200610      *                                                                                       260331
472400200610     C           WRVPOS    IFEQ 'Y'                                                           260331
472500200610     C           PPRE      IFEQ 'R'                                                           260331
472600200610     C                     MOVE 'P'       PPRE                                                260331
472700200610     C                     ELSE                                                               260331
472800200610     C           PPRE      IFEQ 'P'                                                           260331
472900200610     C                     MOVE 'R'       PPRE                                                260331
473000200610     C                     ENDIF                                                              260331
473100200610     C                     ENDIF                                                              260331
473200200610     C                     ENDIF                                                              260331
473300200610      *                                                                                       260331
473400200610     C                     EXSR W02
473500200610      *
473600200610     C           ENDPPY    ENDSR                           ** ENDPPY **
473700200610      *
473800200610      *****************************************************************
473900200610      /EJECT
474000200610      *****************************************************************
474100200610      *                                                               *
474200200610      *  MORTPY - Subroutine to produce Mortgage Payment Account Keys *
474300200610      *           and/or Position Settlements.                        *
474400200610      *                                                               *
474500200610      *****************************************************************
474600200610      *
474700200610     C           MORTPY    BEGSR                           ** MORTPY **
474800200610     C*
474900200610     C****GET*PREVIOUS*CURRENT*FACTOR*FROM*PREV.RECORD*SEDEVD*FOR*THIS*   E20086
475000200610     C****TYPE,FROM*LGL*OF*SEDEVD*BY*SEC/TYPE/DATE*LF/SECET************   E20086
475100200610     C****SAVE*KEY*OF*CURRENT*SEDEVD*RECORD*AND*RECHAIN*AFTERWARDS*****   E20086
475200200610     C***********                                                         E20086
475300200610     C************LIKE     DEFN SDET      WSDET                           E20086
475400200610     C************LIKE     DEFN SDED      WSDED                           E20086
475500200610     C***********          Z-ADDWPCFA     WPCFA  118                      E20086
475600200610     C************LIKE     DEFN SDCP      WSDCP                           E20086
475700200610     C************LIKE     DEFN SDDT      WSDDT                           E20086
475800200610     C***********          MOVE SDET      WSDET                           E20086
475900200610     C***********          Z-ADDSDED      WSDED                           E20086
476000200610     C***********          Z-ADDSDCP      WSDCP                           E20086
476100200610     C***********          Z-ADDSDDT      WSDDT                           E20086
476200200610     C***********SECETY    SETLLSEDETD                                    E20086
476300200610     C***********                                                         E20086
476400200610     C***STORE*NOM*CCY*FROM*SECTYD*AS*SEDEVDF*HAS*NMCY*FIELD*TOO*******   E20086
476500200610     C***********                                                         E20086
476600200610     C***********          MOVE NMCY      WNMCY                           E20086
476700200610     C***********          READPSEDETD                   79               E20086
476800200610     C***********          MOVE WNMCY     NMCY                            E20086
476900200610     C************IN79     IFNE '1'                                       E20086
477000200610     C***********SDSN      IFNE WDSSC                                     E20086
477100200610     C***********SDET      ORNE WSDET                                     E20086
477200200610     C***********          MOVE '1'       *IN79                           E20086
477300200610     C***********          END                                            E20086
477400200610     C***********          END                                            E20086
477500200610     C***********                                                         E20086
477600200610     C**IF*NOT*FOUND*OR*NOT*SAME*SEC/TYPE,DEFAULT*TO*100***************   E20086
477700200610     C***********                                                         E20086
477800200610     C************IN79     IFEQ '1'                                       E20086
477900200610     C***********          Z-ADD100       WPCFA                           E20086
478000200610     C***********          ELSE                                           E20086
478100200610     C***********          Z-ADDSDCP      WPCFA                           E20086
478200200610     C***********          END                                            E20086
478300200610     C***********                                                         E20086
478400200610     C***NOW*RECHAIN*TO*SEDEVD*FOR*CURRENT*FACTOR*AND*OTHER*CURRENT*FLD   E20086
478500200610     C***********                                                         E20086
478600200610     C***********          Z-ADDWSDCP     SDCP                            E20086
478700200610     C***********          Z-ADDWSDED     SDED                            E20086
478800200610     C***********          Z-ADDWSDDT     SDDT                            E20086
478900200610     C***********          MOVE WSDET     SDET                            E20086
479000200610     C***********          EXSR SECEDI                                    E20086
479100200610     C***********                                                         E20086
479200200610     C***CALCULATE*PRINCIPAL*REPAYMENT*AS:*****************************   E20086
479300200610     C**********IF*REPAYMENT*METHOD*IND*IS*Y,*REPAYMENT*AMOUNT*ON*SECAD   E20086
479400200610     C***********                                                         E20086
479500200610     C**************NOMINAL*VALUE*DATE*BASIS*TIMES*********************   E20086
479600200610     C**************(PREVIOUS*CURRENT*FACTOR*MINUS*CURRENT*FACTOR)*****   E20086
479700200610     C**NB*ALTHOUGH*NOM*DEC*=*NOM*DEC*CCY*FOR*MORTGAGE*BACKED*SEC'TS***   E20086
479800200610     C**FIELD*RTAI*IS*IN*CCY*DEC*PLACES*AND*THIS*CALC*OF*WPREPA*IS*TOO*   E20086
479900200610     C***********                                                         E20086
480000200610     C***********WPCFA     SUB  SDCP      WACF    98                      E20086
480100200610     C***********                                                         E20086
480200200610     C***SPLIT*FIELD*WACF*9/8*TO*1/0*AND*8/8*WRK*FLDS*TO*PREVENT*LOSS**   E20086
480300200610     C***OF*HIGH*ORDER*DIGITS******************************************   E20086
480400200610     C***********                                                         E20086
480500200610     C***********          Z-ADDWACF      WRK10   10                      E20086
480600200610     C***********          Z-ADDWACF      WRK88   88                      E20086
480700200610     C***********                                                         E20086
480800200610     C***MULTIPLY*NOMINAL*VALUE*DATE*BASIS*BY*EACH*WORK*FIELD*AND*SUM**   E20086
480900200610     C***********                                                         E20086
481000200610     C***********WBDSNV    MULT WRK88     WRK158 158                      E20086
481100200610     C***********WBDSNV    MULT WRK10     WRK150 150                      E20086
481200200610     C***********WRK158    DIV  1         WRK154 154H                     E20086
481300200610     C***********WRK150    ADD  WRK154    WRK154                          E20086
481400200610     C***********                                                         E20086
481500200610     C*NOMINAL*DECIMAL*PLACES*RETRIEVED*-*NOW*USE*CCY**TO*GET*CCY**DP**   E20086
481600200610     C***********                                                         E20086
481700200610     C***********          MOVE NMCY      WCURR   3                       E20086
481800200610     C***********          EXSR TG10                                      E20086
481900200610     C***********                                                         E20086
482000200610     C***********CDP       SUB  NMDP      DC      10                      E20086
482100200610     C***********DC        ADD  5         DC                              E20086
482200200610     C***********WRK154    MULT POWER8,DC WRK154                          E20086
482300200610     C***********WRK154    DIV  1         WPREPA 130H                     E20086
482400200610     C***********          END                                            E20086
482500200610     C***********                                                         E20086
482600200610     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRD*FOR*SECURITY**************   E20086
482700200610     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E20086
482800200610     C***GET*NOMINAL*CCY*DEC*PLACES*FROM*TABTG10*FIRST*(CDP)***********   E20086
482900200610     C***********                                                         E20086
483000200610     C***********          MOVE NMCY      WCURR   3                       E20086
483100200610     C***********          EXSR TG10                                      E20086
483200200610     C***********                                                         E20086
483300200610     C***WHEN*PARM*ZAB*IS*'A'*,*INTEREST*IS*CALCULATED*AFTER*CHANGES***   E20086
483400200610     C***WHEN*PARM*ZAB*IS*'B'*,*INTEREST*IS*CALCULATED*BEFORE*CHANGES**   E20086
483500200610     C*******I.E.*'CHANGES'*ARE*UPDATES*DUE*TO*BACKVALUATIONS*IN*PGM***   E20086
483600200610     C***********                                                         E20086
483700200610     C***********          MOVE 'A'       ZAB                             E20086
483800200610     C***********          UNLCKLDA                                       E20086
483900200610     C***********          CALL 'ZACCRD'                                  E20086
484000200610     C***********          PARM           LCPN                            E20086
484100200610     C***********          PARM           SDED                            E20086
484200200610     C***********          PARM           DSBR                            E20086
484300200610     C***********          PARM           DDPT                            E20086
484400200610     C***********          PARM           DSSC                            E20086
484500200610     C***********          PARM           CDP                             E20086
484600200610     C***********          PARM           ZINTDU 150                      E20086
484700200610     C***********          PARM           ZAB                             E20086
484800200610     C***********                                                         E20086
484900200610     C****U7*AND*U8*ON*IF*DATABASE*ERROR*DURING*ZACCR**PROCESSING******   E20086
485000200610     C***********                                                         E20086
485100200610     C***U7*U8***          GOTO EAUDIT                                    E20086
485200200610     C***********                                                         E20086
485300200610     C***IF*WDIFF*=*Y,*CALL*ZACCRD*AGAIN*WITH*STAUS*B*AND*SUBTRACT*'A'*   E20086
485400200610     C***********                                                         E20086
485500200610     C***********WDIFF     IFEQ 'Y'                                       E20086
485600200610     C***********          Z-ADDZINTDU    ZWINTD 150                      E20086
485700200610     C***********          MOVE 'B'       ZAB                             E20086
485800200610     C***********          UNLCKLDA                                       E20086
485900200610     C***********          CALL 'ZACCRD'                                  E20086
486000200610     C***********          PARM           LCPN                            E20086
486100200610     C***********          PARM           SDED                            E20086
486200200610     C***********          PARM           DSBR                            E20086
486300200610     C***********          PARM           DDPT                            E20086
486400200610     C***********          PARM           DSSC                            E20086
486500200610     C***********          PARM           CDP                             E20086
486600200610     C***********          PARM           ZINTDU 150                      E20086
486700200610     C***********          PARM           ZAB     1                       E20086
486800200610     C***********                                                         E20086
486900200610     C****U7*AND*U8*ON*IF*DATABASE*ERROR*DURING*ZACCR**PROCESSING******   E20086
487000200610     C***********                                                         E20086
487100200610     C***U7*U8***          GOTO EAUDIT                                    E20086
487200200610     C***********ZWINTD    SUB  ZINTDU    ZINTDU                          E20086
487300200610     C***********          END                                            E20086
487400200610     C***********                                                         E20086
487500200610     C****MULTIPLY*RESULT*OF*ZACCRD*BY*PREVIOUS*CURR*FACTOR************   E20086
487600200610     C***********                                                         E20086
487700200610     C***********ZINTDU    MULT WPCFA     WRK154                          E20086
487800200610     C***********WRK154    DIV  1         WINTPY 130H                     E20086
487900200610     C***********                                                         E20086
488000200610     C**WRITE*POSITION*SETTLEMENT*RECORD*SUBR*W02**********************   E20086
488100200610     C***********                                                         E20086
488200200610     C***********          MOVE 'MP'      PEVT                            E20086
488300200610     C***********          Z-ADDDSNV      PNMP                            E20086
488400200610     C***********                                                         E20086
488500200610     C***AMOUNT*DUE*IS*PRINCIPAL*REPAYMNT*+*INTEREST*******************   E20086
488600200610     C***********                                                         E20086
488700200610     C***********WPREPA    ADD  WINTPY    WRK130 130                      E20086
488800200610     C***********          Z-ADDWRK130    PAMD                            E20086
488900200610     C***********PAMD      IFLT 0                                         E20086
489000200610     C***********          Z-SUBPAMD      PAMD                            E20086
489100200610     C***********          END                                            E20086
489200200610     C***********                                                         E20086
489300200610     C***********WRK130    IFLE 0                                         E20086
489400200610     C***********          MOVE 'P'       PPRE                            E20086
489500200610     C***********          ELSE                                           E20086
489600200610     C***********          MOVE 'R'       PPRE                            E20086
489700200610     C***********          END                                            E20086
489800200610     C***********                                                         E20086
489900200610     C***********          EXSR W02                                       E20086
490000200610     C***********                                                         E20086
490100200610     C***********          MOVE '0'       *IN79                           E20086
490200200610     C*                                                                   E20086
490300200610     C***  Obtain Principal Repayment.                                    E20086
490400200610     C*                                                                   E20086
490500200610     C*** If Repayment Method = 'Y', use the Repayment Amount.            E20086
490600200610     C*                                                                   E20086
490700200610     C           SRMI      IFEQ 'Y'
490800200610     C***********          Z-ADDSRPT      WPREPA 130                      E20086
490900200610     C                     Z-ADDSRPT      PAMD                            E20086
491000200610     C*                                                                   E20086
491100200610     C***  Else, obtain the previous Current Factor from the Security     E20086
491200200610     C***  Diary, then calculate Principal Repayment as:                  E20086
491300200610     C***     (Old CF - New CF) * Current Position                        E20086
491400200610     C*                                                                   E20086
491500200610     C                     ELSE
491600200610     C*
491700200610     C           SECETY    SETGTSEDEVDO                                   E20086
491800200610     C                     READ SEDEVDO                  79               E20086
491900200610     C*                                                                   E20086
492000200610     C           *IN79     IFEQ '1'                                       E20086
492100200610     C           SOSDSN    ORNE WDSSC                                     E20086
492200200610     C           SOSDET    ORNE 'MP'                                      E20086
492300200610     C                     Z-ADD1         SOSDCP                          E20086
492400200610     C                     END                                            E20086
492500200610     C*                                                                   E20086
492600200610     C********** SOSDCP    SUB  SDCP      CFDIF   98               E20086 052254
492700200610     C           SOSDCP    SUB  SDCP      CFDIF                           052254
492800200610     C***********CFDIF     MULT WBDSNV    WMPAMT 152H              E20086 E23169
492900200610     C*                                                                   E20086
493000200610     C***  Convert from Nominal D.p. to the Currency D.p.                 E20086
493100200610     C*                                                                   E20086
493200200610     C                     MOVE NMCY      WCURR   3                       E20086
493300200610     C                     EXSR TG10                                      E20086
493400200610     C*                                                                   E20086
493500200610     C***********CDP       SUB  NMDP      DC      10               E20086 E23169
493600200610     C***********          ADD  5         DC                       E20086 E23169
493700200610     C***********WMPAMT    MULT POWER8,DC PAMD      H              E20086 E23169
493800200610     C*                                                                   E20086
493900200610     C                     Z-ADDWBDSNV    ZNOML                           E23169
494000200610     C                     Z-ADDCFDIF     ZPRC                            E23169
494100200610     C           SPBS      IFEQ 'P'                                       E23169
494200200610     C           ZPRC      MULT 100       ZPRC                            E23169
494300200610     C                     END                                            E23169
494400200610     C                     EXSR ZCNSD                                     E23169
494500200610     C                     Z-ADDZCONS     PAMD                            E23169
494600200610     C                     END                                            E20086
494700200610     C*                                                                   E20086
494800200610     C***  Write Position Settlement Record.                              E20086
494900200610     C*                                                                   E20086
495000200610     C                     MOVE 'MP'      PEVT                            E20086
495100200610     C***********          Z-ADDDSNV      PNMP                     E20086 E23169
495200200610     C                     Z-ADDWBDSNV    PNMP                            E23169
495300200610     C*                                                                   E20086
495400200610      *                                                                   147449
495500200610      * Check sign on Nominal to calculate Pay/Rec indicator              147449
495600200610      *                                                                   147449
495700200610     C           WBDSNV    IFLE 0                                         147449
495800200610     C***********PAMD      IFLE 0                                  E20086 147449
495900200610     C                     MOVE 'P'       PPRE                            E20086
496000200610     C                     ELSE                                           E20086
496100200610     C                     MOVE 'R'       PPRE                            E20086
496200200610     C                     END                                            E20086
496300200610      *                                                                                       260331
496400200610     C           WRVPOS    IFEQ 'Y'                                                           260331
496500200610     C           PPRE      IFEQ 'R'                                                           260331
496600200610     C                     MOVE 'P'       PPRE                                                260331
496700200610     C                     ELSE                                                               260331
496800200610     C           PPRE      IFEQ 'P'                                                           260331
496900200610     C                     MOVE 'R'       PPRE                                                260331
497000200610     C                     ENDIF                                                              260331
497100200610     C                     ENDIF                                                              260331
497200200610     C                     ENDIF                                                              260331
497300200610     C*                                                                   E20086
497400200610     C***  Amount posted should be positive.                              E20086
497500200610     C*                                                                   E20086
497600200610     C           PAMD      IFLT 0                                         E20086
497700200610     C                     Z-SUBPAMD      PAMD                            E20086
497800200610     C                     END                                            E20086
497900200610     C*                                                                   E20086
498000200610     C                     EXSR W02                                       E20086
498100200610     C*                                                                   E20086
498200200610     C                     SETOF                     79                   E20086
498300200610     C*                                                                   E20086
498400200610     C* WRITE ACCOUNT KEYS RECORD SUBR W01 - IIIR_X______MVN___FV         E19770
498500200610     C*                                                                   E19770
498600200610     C                     MOVE 'R'       WACEVC                          E19770
498700200610     C*                                                                   E19770
498800200610     C** SET NEGATIVE IND TO ' 'IF NEG POSN ON A/C IS N OR                E19770
498900200610     C** NOM.MATURING IS GREATER THAN ZERO                                E19770
499000200610     C*                                                                   E19770
499100200610     C*  Use the Repayment Amount from file SEDEVD                        E19770
499200200610     C*                                                                   E19770
499300200610     C***********          Z-ADDSRPT      WRK130                   E19770 E23169
499400200610     C                     Z-ADDPAMD      WRK130 130                      E23169
499500200610      *                                                                   152391
499600200610      * Ensure event amount is same sign as nominal                       152391
499700200610      *                                                                   152391
499800200610     C           WBDSNV    IFLT *ZERO                                     152391
499900200610     C                     Z-SUBWRK130    WRK130                          152391
500000200610     C                     ENDIF                                          152391
500100200610      *                                                                   152391
500200200610     C*                                                                   E19770
500300200610     C           NPAC      IFEQ 'N'                                       E19770
500400200610     C           WRK130    ORGT 0                                         E19770
500500200610     C                     MOVE ' '       WACNEG                          E19770
500600200610     C                     ELSE                                           E19770
500700200610     C                     MOVE 'N'       WACNEG                          E19770
500800200610     C                     END                                            E19770
500900200610     C                     MOVE 'FV'      WACAMC                          E19770
501000200610     C                     Z-ADDWRK130    EVAM                            E19770
501100200610     C*                                                                   E19770
501200200610     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG POSITION ON ACC IS Y    E19770
501300200610     C** AND AMNT DUE IS LESS THAN ZERO                                   E19770
501400200610     C*                                                                   E19770
501500200610     C           WRK130    IFLT 0                                         E19770
501600200610     C           NPAC      ANDEQ'Y'                                       E19770
501700200610     C                     Z-SUBEVAM      EVAM                            E19770
501800200610     C                     END                                            E19770
501900200610     C                     EXSR W03                                       E19770
502000200610     C/COPY WNCPYSRC,SE2370C007
502100200610     C*
502200200610     C***********ENDMPY    ENDSR                           ** ENDMPY **   E20086
502300200610     C*                                                                   E20086
502400200610     C                     ENDSR                                          E20086
502500200610      *
502600200610      *****************************************************************
502700200610      /EJECT
502800200610      *****************************************************************
502900200610      *                                                               *
503000200610      *  MATURE - Subroutine to produce Maturity Position Settlements.*
503100200610      *                                                               *
503200200610      *****************************************************************
503300200610      *
503400200610     C           MATURE    BEGSR                           ** MATURE **
503500200610     C*
503600200610      ***  A separate Coupon Event is now produced at Maturity and this   E21573
503700200610      ***  should be used to generate Position Settlement for Interest.   E21573
503800200610     C*                                                                   E21573
503900200610     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRD*FOR*SECURITY**************   E21573
504000200610     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E21573
504100200610     C***GET*NOMINAL*CCY*DEC*PLACES*FROM*TABTG10*FIRST*(CDP)***********   E21573
504200200610     C***********                                                         E21573
504300200610     C***********          MOVE NMCY      WCURR   3                       E21573
504400200610     C***********          EXSR TG10                                      E21573
504500200610     C***********                                                         E21573
504600200610     C***WHEN*PARM*ZAB*IS*'A'*,*INTEREST*IS*CALCULATED*AFTER*CHANGES***   E21573
504700200610     C***WHEN*PARM*ZAB*IS*'B'*,*INTEREST*IS*CALCULATED*BEFORE*CHANGES**   E21573
504800200610     C*******I.E.*'CHANGES'*ARE*UPDATES*DUE*TO*BACKVALUATIONS*IN*PGM***   E21573
504900200610     C***********                                                         E21573
505000200610     C***********          MOVE 'A'       ZAB                             E21573
505100200610     C***********          UNLCKLDA                                       E21573
505200200610     C***********          CALL 'ZACCRD'                                  E21573
505300200610     C***********          PARM           LCPN                            E21669
505400200610     C***********          PARM           LCCP                     E21669 E21573
505500200610     C***********          PARM           MATY                            E21573
505600200610     C***********          PARM           DSBR                            E21573
505700200610     C***********          PARM           DDPT                            E21573
505800200610     C***********          PARM           DSSC                            E21573
505900200610     C***********          PARM           CDP                             E21573
506000200610     C***********          PARM           ZINTDU 150                      E21573
506100200610     C***********          PARM           ZAB                             E21573
506200200610     C***********                                                         E21573
506300200610     C****U7*AND*U8*ON*IF*DATABASE*ERROR*DURING*ZACCR**PROCESSING******   E21573
506400200610     C***********                                                         E21573
506500200610     C***U7*U8***          GOTO EAUDIT                                    E21573
506600200610     C***********                                                         E21573
506700200610     C***IF*WDIFF*=*Y,*CALL*ZACCRD*AGAIN*WITH*STAUS*B*AND*SUBTRACT*'A'*   E21573
506800200610     C***********                                                         E21573
506900200610     C***********WDIFF     IFEQ 'Y'                                       E21573
507000200610     C***********          Z-ADDZINTDU    ZWINTD 150                      E21573
507100200610     C***********          MOVE 'B'       ZAB                             E21573
507200200610     C***********          UNLCKLDA                                       E21573
507300200610     C***********          CALL 'ZACCRD'                                  E21573
507400200610     C***********          PARM           LCPN                            E21669
507500200610     C***********          PARM           LCCP                     E21669 E21573
507600200610     C***********          PARM           SDED                            E21573
507700200610     C***********          PARM           DSBR                            E21573
507800200610     C***********          PARM           DDPT                            E21573
507900200610     C***********          PARM           DSSC                            E21573
508000200610     C***********          PARM           CDP                             E21573
508100200610     C***********          PARM           ZINTDU 150                      E21573
508200200610     C***********          PARM           ZAB     1                       E21573
508300200610     C***********                                                         E21573
508400200610     C****U7*AND*U8*ON*IF*DATABASE*ERROR*DURING*ZACCR**PROCESSING******   E21573
508500200610     C***********                                                         E21573
508600200610     C***U7*U8***          GOTO EAUDIT                                    E21573
508700200610     C***********ZWINTD    SUB  ZINTDU    ZINTDU                          E21573
508800200610     C***********          END                                            E21573
508900200610     C*
509000200610     C** OBTAIN PRICE AT MATURITY - CHECK LF/SECED FOR REDEMPTION PRICE
509100200610     C*
509200200610     C           *LIKE     DEFN SDCP      WSDCP                           E20086
509300200610     C                     Z-ADDSDCP      WSDCP
509400200610     C           *LIKE     DEFN SDED      WSDED                           E20086
509500200610     C                     Z-ADDSDED      WSDED
509600200610     C           *LIKE     DEFN SDDT      WSDDT                           E20086
509700200610     C                     Z-ADDSDDT      WSDDT
509800200610     C           *LIKE     DEFN SDET      WSDET                           E20086
509900200610     C                     MOVE SDET      WSDET
510000200610     C           *LIKE     DEFN SDAD      WSDAD                           S01510
510100200610     C                     MOVE SDAD      WSDAD                           S01510
510200200610     C*
510300200610     C                     Z-ADD0         SDRP
510400200610     C                     Z-ADDMATY      SDED
510500200610     C                     MOVE 'RC'      SDET
510600200610     C*
510700200610     C** CHECK FILE FOR EITHER 'RC' TYPE OR 'RP' TYPE IN KEY FIELD
510800200610     C*
510900200610     C                     EXSR SECEDI
511000200610     C           *IN78     IFEQ '1'
511100200610     C                     MOVE 'RP'      SDET
511200200610     C                     EXSR SECEDI
511300200610     C                     END
511400200610     C           *IN78     IFEQ '1'
511500200610     C*
511600200610     C** IF NEITHER RC NOR RP USE 100 IF PRICE BASIS IS P, ELSE 1 (U)
511700200610     C** Or if RP/RC record found AND price is zero and S01509 is         S01509
511800200610     C** active, use 100 if price basis is P, else 1                      S01509
511900200610     C*
512000200610     C           *IN78     OREQ '0'                                       S01509
512100200610     C           SDRP      ANDEQ0                                         S01509
512200200610     C           S01509    ANDEQ'Y'                                       S01509
512300200610     C*                                                                   S01509
512400200610     C           SPBS      IFEQ 'P'
512500200610     C                     Z-ADD100       SDRP
512600200610     C                     END
512700200610     C***********SPBS      IFEQ 'U'                                       103011
512800200610     C***********          Z-ADD1         SDRP                            103011
512900200610     C***********          END                                            103011
513000200610     C           PROT      IFEQ '1'                                                           192467
513100200610     C           SPBS      ANDEQ'U'                                                           192467
513200200610     C                     Z-ADD1         SDRP                                                192467
513300200610     C                     ENDIF                                                              192467
513400200610     C                     END
513500200610      *                                                                   100537
513600200610     C           PROT      IFEQ '8'                                       100537
513700200610      *                                                                   100537
513800200610      ** Get current factor prior to action date from the security diary  100537
513900200610      ** If no details, use 1.                                            100537
514000200610      *                                                                   100537
514100200610     C           SECETY    SETGTSEDEVDO                                   100537
514200200610     C                     READ SEDEVDO                  79               100537
514300200610      *                                                                   100537
514400200610     C           *IN79     IFEQ '1'                                       100537
514500200610     C           SOSDSN    ORNE WDSSC                                     100537
514600200610     C           SOSDET    ORNE 'MP'                                      100537
514700200610     C                     Z-ADD1         SOSDCP                          100537
514800200610     C                     END                                            100537
514900200610     C           SOSDCP    MULT 100       SDRP                            100537
515000200610     C                     END                                            100537
515100200610      *                                                                   100537
515200200610     C                     Z-ADDWSDCP     SDCP
515300200610     C                     Z-ADDWSDED     SDED
515400200610     C                     Z-ADDWSDDT     SDDT
515500200610     C                     Z-ADDWSDAD     SDAD                            S01510
515600200610     C                     MOVE WSDET     SDET
515700200610     C*
515800200610     C**  CALCULATE NOMINAL MATURING AT DEPOT AS
515900200610     C**  NOMINAL VALUE DATE BASIS TIMES PRICE AT MATURITY
516000200610     C*
516100200610     C***********          Z-ADDSDRP      WRK08   88                      E23169
516200200610     C***********          Z-ADDSDRP      WRK150 150                      E23169
516300200610     C***********WBDSNV    MULT WRK08     WRK156 156                      E23169
516400200610     C***********WRK156    DIV  1         WNOMAT 130H                     E20151
516500200610     C***********WRK156    DIV  1         WNOMAT 150H              E20151 E23169
516600200610     C***********                                                         E23169
516700200610     C***********WBDSNV    MULT WRK150    WRK150                          E23169
516800200610     C***********WRK150    ADD  WNOMAT    WNOMAT                          E23169
516900200610     C*
517000200610     C*  NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
517100200610     C*
517200200610     C                     MOVE NMCY      WCURR   3
517300200610     C                     EXSR TG10
517400200610     C*
517500200610     C**IF*78*IS*ON,*NO*PRICE*ON*SEC*EVENT*FILE*SO*CCY*FLD*'CDP'*IS*0**   E20151
517600200610     C*
517700200610     C***********CDP       SUB  NMDP      DC      10                      E23169
517800200610     C***78******          Z-SUBNMDP      DC                              E20151
517900200610     C***********DC        ADD  5         DC                              E23169
518000200610     C***********                                                         E23169
518100200610     C*                                                                   E20151
518200200610     C***Adjust*for percentage pricing.                            E20151 E23169
518300200610     C***********                                                  E20151 E23169
518400200610     C***********SPBS      IFEQ 'P'                                E20151 E23169
518500200610     C***********          SUB  2         DC                       E20151 E23169
518600200610     C***********          END                                     E20151 E23169
518700200610     C***********                                                  E20151 E23169
518800200610     C***********DC        IFLT 5                                         E23169
518900200610     C***********WNOMAT    MULT POWER8,DC WRK151 151                      E23169
519000200610     C***********WRK151    DIV  1         WNOMAT    H                     E23169
519100200610     C***********          ELSE                                           E23169
519200200610     C***********WNOMAT    MULT POWER8,DC WNOMAT                          E23169
519300200610     C***********          END                                            E23169
519400200610     C*                                                                   E23169
519500200610     C** Use ZCNSD subroutin to calculate Amount                          E23169
519600200610     C*                                                                   E23169
519700200610     C                     Z-ADDSDRP      ZPRC                            E23169
519800200610     C***********          Z-ADDDSNV      ZNOML                    E23169 S01510
519900200610     C                     Z-ADDWBDSNV    ZNOML                           S01510
520000200610     C                     EXSR ZCNSD                                     E23169
520100200610     C                     Z-ADDZCONS     WNOMAT 150                      E23169
520200200610     C*                                                                   S01509
520300200610     C** If S01509 is active and redemption currency is not blank and     S01509
520400200610     C** is different from the nominal currency, convert maturity         S01509
520500200610     C** amount to redemption currency                                    S01509
520600200610     C*                                                                   S01509
520700200610     C           S01509    IFEQ 'Y'                                       S01509
520800200610     C           *IN78     ANDEQ'0'                                       S01509
520900200610     C           SDCX      ANDNE*BLANKS                                   S01509
521000200610     C           SDCX      ANDNENMCY                                      S01509
521100200610     C                     MOVE NMCY      WCURR   3                       S01509
521200200610     C                     EXSR TG10                                      S01509
521300200610     C                     Z-ADDZCDP      ZCDPI                           S01509
521400200610     C                     MOVE SDCX      WCURR   3                       S01509
521500200610     C                     EXSR TG10                                      S01509
521600200610     C                     Z-ADDZCDP      ZCDPO                           S01509
521700200610     C                     MOVE NMCY      ZCCYI                           S01509
521800200610     C                     MOVE SDCX      ZCCYO                           S01509
521900200610     C                     Z-ADDWNOMAT    ZAMTCI                          S01509
522000200610     C                     Z-ADDSDCE      ZEXCH                           S01509
522100200610     C                     MOVE SDMD      ZMD                             S01509
522200200610     C                     EXSR ZCONV                                     S01509
522300200610     C                     Z-ADDZAMTCO    WNOMAT                          S01509
522400200610     C                     END                                            S01509
522500200610     C/COPY WNCPYSRC,SE2370C032
522600200610     C*                                                                   E23169
522700200610     C**WRITE*POSITION*SETTLEMENT*RECORD*SUBR*W02**********************   S01510
522800200610     C* WRITE POSITION SETTLEMENT RECORD SUBR W02 IF DATE NOT ZERO        S01510
522900200610     C*
523000200610     C**********           MOVE 'MA'      PEVT                            E14716
523100200610     C***********SDDT      IFNE 0                                   S01510075530
523200200610     C*                                                                   075530
523300200610     C           WNOMAT    IFNE 0                                         075530
523400200610     C*                                                                   075530
523500200610     C           SDDT      IFNE 0                                         075530
523600200610     C           SAVDDT    ORNE 0                                         075530
523700200610     C*                                                                   075530
523800200610     C           SDED      IFEQ 0                                         075530
523900200610     C                     Z-ADDSAVDDT    SDED                            075530
524000200610     C                     END                                            075530
524100200610      *                                                                   075530
524200200610     C                     MOVE 'MT'      PEVT                            E14716
524300200610     C                     Z-ADDWBDSNV    PNMP
524400200610     C*                                                                   112878
524500200610     C** If it is generated because of deletion of trade then need        112878
524600200610     C** to revese the sign of the nominal.                               112878
524700200610     C*                                                                   112878
524800200610     C           WREVER    IFEQ 'Y'                                       112878
524900200610     C                     Z-SUBPNMP      PNMP                            112878
525000200610     C                     END                                            112878
525100200610     C*
525200200610     C***AMOUNT*DUE*IS*NOMINAL*MATURING**AT*DEPOT**+*INTEREST**********   E19430
525300200610     C*  Amount due is nominal maturing at depot (interest is separate).  E19430
525400200610     C*
525500200610     C***********WNOMAT    ADD  ZINTDU    WRK130 130                      E19430
525600200610     C***********          Z-ADDWRK130    PAMD                            E19430
525700200610     C                     Z-ADDWNOMAT    PAMD                            E19430
525800200610     C           PAMD      IFLT 0
525900200610     C                     Z-SUBPAMD      PAMD
526000200610     C                     END
526100200610     C*
526200200610     C*
526300200610     C***********WRK130    IFLE 0                                         E19430
526400200610     C           WNOMAT    IFLE 0                                         E19430
526500200610     C                     MOVE 'P'       PPRE
526600200610     C                     ELSE
526700200610     C                     MOVE 'R'       PPRE
526800200610     C                     END
526900200610     C/COPY WNCPYSRC,SE2370C022
527000200610     C                     EXSR W02
527100200610     C/COPY WNCPYSRC,SE2370C029
527200200610     C                     END                                            S01510
527300200610     C*
527400200610     C**WRITE*ACCOUNT*KEYS*RECORD*SUBR*W01*-*IIIM_X______MVN___CV**E19770 S01510
527500200610     C* WRITE ACCOUNT KEYS RECORD SUBR W01 IF DATE NOT ZERO               S01510
527600200610     C*                                                                   E19770
527700200610     C           SDAD      IFNE 0                                         S01510
527800200610     C           SAVDAD    ORNE 0                                         075530
527900200610     C                     MOVE 'M'       WACEVC                          E19770
528000200610     C                     Z-ADDWNOMAT    WRK130                          E23169
528100200610     C*                                                                   E19770
528200200610     C** SET NEGATIVE IND TO ' 'IF NEG POSN ON A/C IS N OR                E19770
528300200610     C** NOM.MATURING + INTEREST IS GREATER THAN ZERO                     E19770
528400200610     C*                                                                   E19770
528500200610     C           NPAC      IFEQ 'N'                                       E19770
528600200610     C           WRK130    ORGT 0                                         E19770
528700200610     C                     MOVE ' '       WACNEG                          E19770
528800200610     C                     ELSE                                           E19770
528900200610     C                     MOVE 'N'       WACNEG                          E19770
529000200610     C                     END                                            E19770
529100200610     C                     MOVE 'CV'      WACAMC                          E19770
529200200610     C                     Z-ADDWRK130    EVAM                            E19770
529300200610     C*                                                                   E19770
529400200610     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG POSITION ON ACC IS Y    E19770
529500200610     C** AND AMNT DUE IS LESS THAN ZERO                                   E19770
529600200610     C*                                                                   E19770
529700200610     C           WRK130    IFLT 0                                         E19770
529800200610     C           NPAC      ANDEQ'Y'                                       E19770
529900200610     C                     Z-SUBEVAM      EVAM                            E19770
530000200610     C                     END                                            E19770
530100200610     C                     EXSR W03                                       E19770
530200200610     C/COPY WNCPYSRC,SE2370C008
530300200610     C                     END                                            S01510
530400200610     C*
530500200610     C                     END                                            075530
530600200610     C*                                                                   075530
530700200610     C           ENDMAT    ENDSR                           ** ENDMAT **
530800200610      *
530900200610      *****************************************************************
531000200610      /EJECT
531100200610      *****************************************************************
531200200610      *                                                               *
531300200610      *  NEXT   - Subroutine to get the Date of the next Position     *
531400200610      *           held for this Security.                             *
531500200610      *                                                               *
531600200610      *****************************************************************
531700200610      *
531800200610     C           NEXT      BEGSR                           **  NEXT  **
531900200610     C*
532000200610     C** BUILD KEY, SET GREATER THAN AND READ NEXT INTERVENING POSITION
532100200610     C*
532200200610     C***********          MOVE DSBR      XDSBR                           S01117
532300200610     C                     MOVE DSBA      XDSBA                           S01117
532400200610     C                     MOVE DSSC      XDSSC
532500200610     C                     MOVE DDPT      XDDPT
532600200610     C                     MOVE DDTE      XDDTE
532700200610     C                     Z-ADDWTODAT    WNEXTD
532800200610     C           DPIKEY    SETGTDPOSHI               79
532900200610     C           *IN79     IFNE '1'
533000200610     C*
533100200610     C           DPIKND    READEDPOSHI                   79
533200200610     C           *IN79     IFEQ '1'
533300200610     C                     Z-ADDWTODAT    WNEXTD
533400200610     C                     ELSE
533500200610     C*
533600200610     C* SUBR NEXT IS CALLED WITH WTODAT SET TO NEXT ACTION DATE (OR
533700200610     C* LAST POSN DATE IF CHANGE OF POSITION) AND IF NEXT POSN.DATE IS
533800200610     C* GREATER THAN THAT DATE, SET WNEXTD TO WTODAT FOR USE IN P/SEC
533900200610     C*
534000200610     C           XDDTE     IFGT WTODAT
534100200610     C                     Z-ADDWTODAT    WNEXTD
534200200610     C                     ELSE
534300200610     C                     Z-ADDXDDTE     WNEXTD
534400200610     C                     END
534500200610     C                     END
534600200610     C                     END
534700200610     C*
534800200610     C           ENDNXT    ENDSR                           ** ENDNXT **
534900200610      *
535000200610      *****************************************************************
535100200610      /EJECT
535200200610      *****************************************************************
535300200610      *                                                               *
535400200610      *  W03    - Subroutine to Write an Account Key.                 *
535500200610      *                                                               *
535600200610      *****************************************************************
535700200610      *
535800200610     C           W03       BEGSR                           **   W03  **
535900200610     C*
536000200610     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
536100200610     C*
536200200610     C           EVAM      CABEQ0         ENDW03
536300200610     C*
536400200610     C* COUNT RECORDS WRITTEN AND USE STD HASH SUBROUTINE
536500200610     C*
536600200610     C                     ADD  1         W01CNT  50
536700200610     C*
536800200610     C**  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
536900200610     C*   ARRAY ELEMENTS (IND,S DEC,S) SO S=1, ACCUMULATING ZZAMT(15/3)
537000200610     C*
537100200610     C                     Z-ADD1         Z
537200200610     C                     Z-ADD1         S
537300200610     C                     Z-ADDEVAM      ZZAMT
537400200610     C                     EXSR ZHASH
537500200610     C*
537600200610     C* BUILD OUTPUT RECORD
537700200610     C*
537800200610     C                     MOVE SITP      WACITY
537900200610     C                     MOVE ' '       WACTRT
538000200610     C                     MOVE 'X'       WACPFI
538100200610     C                     MOVE '  '      WACBKC
538200200610     C                     MOVE '  '      WACTST
538300200610     C                     MOVE '  '      WACPSB
538400200610     C                     MOVE '  '      WACCCC
538500200610     C***********          MOVE 'S'       WACMKT                          131379
538600200610     C                     MOVE MKTI      WACMKT                          131379
538700200610     C           CIAK      IFEQ 'Y'
538800200610     C           SCVI      ANDEQ'Y'                                       E14522
538900200610     C                     MOVE SCVI      WACCON
539000200610     C                     ELSE
539100200610     C                     MOVE ' '       WACCON
539200200610     C                     END
539300200610     C           WACAMC    IFEQ 'FP'                                      E16085
539400200610     C           WACAMC    OREQ 'FR'                                      E16085
539500200610     C           WACAMC    OREQ 'CP'                                      E16085
539600200610     C           WACAMC    OREQ 'CR'                                      E16085
539700200610     C                     MOVE *BLANKS   WACBKC                          E16085
539800200610     C                     END                                            E16085
539900200610     C                     MOVE WACKEY    ACKY
540000200610     C                     MOVE 'D'       RECI
540100200610     C*                                                                   S01509
540200200610     C** If S01509 is active, event currency could be equal to value ccy, S01509
540300200610     C** redemption ccy or nominal ccy depending on the event type        S01509
540400200610     C*                                                                   S01509
540500200610     C           S01509    IFEQ 'Y'                                       S01509
540600200610     C                     SELEC                                          S01509
540700200610     C           SDET      WHEQ 'DV'                                      S01509
540800200610     C           SDET      OREQ 'CP'                                      S01509
540900200610     C                     MOVE VLCY      EVCY                            S01509
541000200610     C           SDET      WHEQ 'MA'                                      S01509
541100200610     C           *IN78     ANDEQ'0'                                       S01509
541200200610     C           SDCX      ANDNE*BLANKS                                   S01509
541300200610     C                     MOVE SDCX      EVCY                            S01509
541400200610     C                     OTHER                                          S01509
541500200610     C                     MOVE NMCY      EVCY                            S01509
541600200610     C                     ENDSL                                          S01509
541700200610     C*                                                                   S01509
541800200610     C                     ELSE                                           S01509
541900200610     C                     MOVE NMCY      EVCY
542000200610     C                     ENDIF                                          S01509
542100200610     C*                                                                   S01509
542200200610     C                     MOVE *BLANK    STLA
542300200610     C           WSRECI    IFEQ 'R'
542400200610     C                     MOVE '1'       RVRS
542500200610     C                     ELSE
542600200610     C                     MOVE '0'       RVRS
542700200610     C                     END
542800200610     C                     MOVE DSSC      SESH
542900200610     C                     Z-ADD0         TRFR
543000200610     C                     MOVELDDPT      CSTN
543100200610     C***********          MOVE DSBR      BRCH                            S01117
543200200610     C                     MOVE DSBA      BRHA                            S01117
543300200610     C***********          Z-ADD01        ASQN                            E18803
543400200610     C                     Z-ADD00        ASQN                            E18803
543500200610     C                     Z-ADDSDED      EVDT
543600200610     C/COPY WNCPYSRC,SE2370C043
543700200610      *                                                                                       CSE075
543800200610      ** If Enhanced Treasury is switched on:                                                 CSE075
543900200610      ** Some securities have a standard coupon delay.                                        CSE075
544000200610      ** If the security is asset-backed and a delay was specified, calculate event date.     CSE075
544100200610      *                                                                                       CSE075
544200200610     C           CSE075    IFEQ 'Y'                                                           CSE075
544300200610     C           SDET      IFEQ 'CP'                                                          CSE075
544400200610     C********** PROT      ANDEQ'8'                                                    CSE075 CSE075
544500200610     C           STBS      ANDEQ'P'                                                           CSE075
544600200610     C           PROT      ANDNE'2'                                                           CSE075
544700200610     C           PROT      ANDNE'4'                                                           CSE075
544800200610     C           PROT      ANDNE'7'                                                           CSE075
544900200610     C           CPDY      ANDNE0                                                             CSE075
545000200610     C           SDET      OREQ 'CP'                                                          CSE075
545100200610     C           STBS      ANDEQ'Y'                                                           CSE075
545200200610     C           PROT      ANDNE'2'                                                           CSE075
545300200610     C           PROT      ANDNE'4'                                                           CSE075
545400200610     C           PROT      ANDNE'7'                                                           CSE075
545500200610     C           PROT      ANDNE'9'                                                           CSE075
545600200610     C           CPDY      ANDNE0                                                             CSE075
545700200610     C           SDED      ADD  CPDY      EVDT                                                CSE075
545800200610     C                     ENDIF                                                              CSE075
545900200610     C                     ENDIF                                                              CSE075
546000200610      *                                                                                       CSE075
546100200610     C                     Z-ADD0         KNCA
546200200610     C                     Z-ADD0         KBCA
546300200610     C                     MOVELDDPT      KCUST
546400200610     C                     Z-ADD0         STLT
546500200610     C***********          MOVE '   '     KCCY                            E15549
546600200610     C                     MOVE NMCY      KCCY                            E15549
546700200610     C*                                                                   CAC002
546800200610     C**  If Analytical Accounting is installed, set the profit centre    CAC002
546900200610     C**  SE ICD default profit centre.                                   CAC002
547000200610     C*                                                                   CAC002
547100200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
547200200610     C                     MOVE BVSEPC    PRFC                            CAC002
547300200610     C                     ENDIF                                          CAC002
547400200610     C*
547500200610     C* WRITE GENERATED ACCOUNT KEY RECORD
547600200610     C*
547700200610     C                     WRITESEKEYDF
547800200610     C*
547900200610     C           ENDW03    ENDSR                           ** ENDW03 **
548000200610      *
548100200610      *****************************************************************
548200200610      /EJECT
548300200610      *****************************************************************
548400200610      *                                                               *
548500200610      *  W02    - Subroutine to Write a Position Settlement.          *
548600200610      *                                                               *
548700200610      *****************************************************************
548800200610      *
548900200610     C           W02       BEGSR                           **   W02  **
549000200610     C*
549100200610     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
549200200610     C*
549300200610     C           PAMD      CABEQ0         ENDW02
549400200610     C*
549500200610     C**COUNT*RECORDS*WRITTEN**************************************       CSE023
549600200610     C*************************************************************       CSE023
549700200610     C***********          ADD  1         W02CNT  50                      CSE023
549800200610     C*
549900200610     C*********            MOVE 'D'       RECI                            081366
550000200610     C***********          MOVE 'S'       PMAR                            162208
550100200610     C                     MOVE MKTI      PMAR                            162208
550200200610     C***********          MOVE DSBR      PBCH                            S01117
550300200610     C***********          MOVE DSBA      PBCH                      S01117E33032
550400200610     C                     MOVE DSBA      PBCA                            E33032
550500200610     C                     MOVE DSSC      PSSH
550600200610     C                     MOVELDDPT      PCPY
550700200610     C*                                                                   CSE023
550800200610     C                     MOVE 'D'       CTYP                            CSE023
550900200610     C                     Z-ADD0         BAUS                            CSE023
551000200610     C                     Z-ADD0         MAMT                            CSE023
551100200610     C                     Z-ADD0         PSEQ                            CSE023
551200200610     C                     Z-ADD0         DAMT                            CSE023
551300200610     C                     Z-ADD0         SABC                            CSE023
551400200610     C*                                                                   CSE023
551500200610     C           SDET      IFEQ 'MP'
551600200610     C           SDET      OREQ 'DV'
551700200610     C           S01512    ANDNE'Y'                                       088423
551800200610     C                     Z-ADDSDPD      PDUD
551900200610     C                     ELSE
552000200610     C                     Z-ADDSDED      PDUD
552100200610     C*                                                                   S01408
552200200610     C/COPY WNCPYSRC,SE2370CCP2                                           S01408
552300200610     C*                                                                   S01408
552400200610     C                     END
552500200610     C*                                                                   S01512
552600200610     C** Authorisation - set to authorised if auto-settle is on           S01512
552700200610     C*                                                                   S01512
552800200610     C           APNS      IFEQ 'Y'
552900200610     C                     MOVE 'Y'       PAUI
553000200610     C                     MOVE 'Y'       PSMI                            S01401
553100200610     C                     ELSE
553200200610     C                     MOVE ' '       PAUI
553300200610     C                     END
553400200610     C*                                                                   S01509
553500200610     C** If S01509 is active, position currency could be equal to value   S01509
553600200610     C** ccy, redemption ccy or nominal ccy depending on the event type   S01509
553700200610     C*                                                                   S01509
553800200610     C           S01509    IFEQ 'Y'                                       S01509
553900200610     C                     SELEC                                          S01509
554000200610     C           SDET      WHEQ 'DV'                                      S01509
554100200610     C           SDET      OREQ 'CP'                                      S01509
554200200610     C                     MOVE VLCY      PNCY                            S01509
554300200610     C           SDET      WHEQ 'MA'                                      S01509
554400200610     C           *IN78     ANDEQ'0'                                       S01509
554500200610     C           SDCX      ANDNE*BLANKS                                   S01509
554600200610     C                     MOVE SDCX      PNCY                            S01509
554700200610     C                     OTHER                                          S01509
554800200610     C                     MOVE NMCY      PNCY                            S01509
554900200610     C                     ENDSL                                          S01509
555000200610     C*                                                                   S01509
555100200610     C                     ELSE                                           S01509
555200200610     C                     MOVE NMCY      PNCY
555300200610     C                     END                                            S01509
555400200610     C*                                                                   S01512
555500200610     C** Value date - set initially to due date                           S01512
555600200610     C** Should be date of the next working day after value date in       S01512
555700200610     C** value currency if S01512 is active                               S01512
555800200610     C*                                                                   S01512
555900200610     C           S01512    IFEQ 'Y'                                       S01512
556000200610     C           SDET      IFEQ 'DV'                                      088423
556100200610     C           SDPD      SUB  1         ZDAYNO                          088423
556200200610     C                     ELSE                                           088423
556300200610     C           PDUD      SUB  1         ZDAYNO                          S01512
556400200610     C                     ENDIF                                          088423
556500200610     C                     Z-ADD1         ZNRDYS                          S01512
556600200610     C                     MOVE PNCY      ZCCY                            S01512
556700200610     C                     EXSR ZFWDT                                     S01512
556800200610     C                     Z-ADDZDYNBR    PSVL                            S01512
556900200610     C                     ELSE                                           S01512
557000200610     C           SDET      IFEQ 'DV'                                      088423
557100200610     C                     Z-ADDSDPD      PSVL                            088423
557200200610     C                     ELSE                                           088423
557300200610     C                     Z-ADDPDUD      PSVL                            S01512
557400200610     C                     ENDIF                                          088423
557500200610     C                     END                                            S01512
557600200610     C*                                                                   S01509
557700200610     C                     MOVE DMKB      PBCD
557800200610     C                     MOVE '0'       PYCUSD  1
557900200610      *                                                                   E23169
558000200610      ** Payment currency and settlement exchange rate are held on        E23169
558100200610      ** SECTYD for straight, dual- and multi-currency securities.        E23169
558200200610      ** Exchange rate=1 for straight securities.                         E23169
558300200610     C** If S01509 is active, settle = pos currency, exchange rate is     S01509
558400200610     C** 1 with mult/div indicator as 'M'                                 S01509
558500200610      *                                                                   E23169
558600200610     C           S01509    IFEQ 'Y'                                       S01509
558700200610     C                     MOVE PNCY      PSCU                            S01509
558800200610     C                     Z-ADD1         PSXR                            S01509
558900200610     C                     MOVE 'M'       PMDI                            S01509
559000200610     C                     ELSE                                           S01509
559100200610     C                     MOVE SPYC      PSCU                            E23169
559200200610     C                     Z-ADDSEXR      PSXR                            E23169
559300200610     C                     MOVE SMDI      PMDI                            E23169
559400200610     C                     END                                            S01509
559500200610      *                                                                   E23169
559600200610     C***********VLCY      IFNE '   '                                     E23169
559700200610     C***********          MOVE VLCY      PSCU                            E23169
559800200610     C***********          ELSE                                           E23169
559900200610     C***********SPYC      IFNE '   '                                     E23169
560000200610     C*                                                                   E23169
560100200610     C***IF*PAYMENT*CURRENCY*USED*SET*FLAG*PYCUSD*TO*1*-*CHECK*BELOW******E23169
560200200610     C*                                                                   E23169
560300200610     C***********          MOVE '1'       PYCUSD                          E23169
560400200610     C***********          MOVE SPYC      PSCU                            E23169
560500200610     C***********          ELSE                                           E23169
560600200610     C***********          MOVE NMCY      PSCU                            E23169
560700200610     C***********          END                                            E23169
560800200610     C***********          END                                            E23169
560900200610     C*                                                                   E23169
561000200610     C***CALCULATE*SETTLEMENT*EXCHANGE*RATE*-*CHECK*FLAG*PYCUSD*****      E23169
561100200610     C*                                                                   E23169
561200200610     C***********PYCUSD    IFEQ '1'                                       E23169
561300200610     C***********          Z-ADDSEXR      PSXR                            E23169
561400200610     C***********          MOVE SMDI      PMDI                            E23169
561500200610     C***********          ELSE                                           E23169
561600200610     C*                                                                   E23169
561700200610     C**GET*SPOT*RATE*FOR*EACH*OF*SETT.*CCY*AND*NOM*CCY*FROM*TABTG10**    E23169
561800200610     C**THEN*CALCULATE*CROSS*RATE*USING*ZXRATE*************************   E23169
561900200610     C*                                                                   E23169
562000200610     C***********          MOVE PSCU      WCURR                           E23169
562100200610     C***********          EXSR TG10                                      E23169
562200200610     C***********          Z-ADDSPOT      ZRATE1 138                      E23169
562300200610     C***********          MOVE MDIN      ZMDI1   1                       E23169
562400200610     C***********          MOVE PNCY      WCURR                           E23169
562500200610     C***********          EXSR TG10                                      E23169
562600200610     C***********          Z-ADDSPOT      ZRATE2 138                      E23169
562700200610     C***********          MOVE MDIN      ZMDI2   1                       E23169
562800200610     C***********          EXSR ZXRATE                                    E23169
562900200610     C***********          Z-ADDZRATEX    PSXR                            E23169
563000200610     C*                                                                   E23169
563100200610     C***MULTIPLY/DIVIDE*IND*ON*TABTG10*IS*0=DIV*1=MULT****************   E23169
563200200610     C*                                                                   E23169
563300200610     C***********ZMDIX     IFEQ '0'                                       E23169
563400200610     C***********          MOVEL'D'       PMDI                            E23169
563500200610     C***********          ELSE                                           E23169
563600200610     C***********          MOVEL'M'       PMDI                            E23169
563700200610     C***********          END                                            E23169
563800200610     C***********          END                                            E23169
563900200610     C*
564000200610     C** BASIC CURR EXCHANGE RATE IS SPOT RATE FOR SETTLEMENT CURRCY
564100200610     C*
564200200610     C                     MOVE PSCU      WCURR
564300200610     C                     EXSR TG10
564400200610     C                     Z-ADDSPOT      PBRX
564500200610     C/COPY WNCPYSRC,SE2370C009
564600200610     C*
564700200610     C** ACCESS STANDARD SETTLEMENT INSTRUCTIONS FILE
564800200610     C*
564900200610     C***********          MOVE PBCH      SBRH                            S01117
565000200610     C***********          MOVE PBCH      SBRA                      S01117E33032
565100200610     C                     MOVE PBCA      SBRA                            E33032
565200200610     C                     MOVELPCPY      CSTM
565300200610     C                     MOVE PSCU      CYSI
565400200610     C                     MOVE SITP      ITSI
565500200610     C                     MOVE *BLANK    PSEA
565600200610     C                     MOVE *BLANK    PSEB
565700200610     C                     MOVE *BLANK    PCPN
565800200610     C                     MOVE *BLANK    PFAC
565900200610     C                     MOVE *BLANK    PSPI
566000200610     C                     MOVE *BLANK    PSPI
566100200610     C                     MOVE *ZEROS    PSMT                            048612
566200200610      *                                                                   E21584
566300200610      ***  First try chaining to STDSE with appropriate Investment Type   E21584
566400200610      *                                                                   E21584
566500200610      *                                                                                       CSE028
566600200610      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
566700200610      *                                                                                       CSE028
566800200610     C           CSE028    IFEQ 'Y'                                                           CSE028
566900200610      *                                                                                       CSE028
567000200610     C                     MOVE *OFF      *IN77                                               CSE028
567100200610     C                     MOVELCSTM      PCUST                                               CSE028
567200200610     C                     CALL 'SESSIR0'                                                     CSE028
567300200610     C                     PARM 'D'       POTYP   1                                           CSE028
567400200610     C                     PARM SBRA      PBRCH   3                                           CSE028
567500200610     C                     PARM           PCUST   6                                           CSE028
567600200610     C                     PARM PBCD      PBOOK   2                                           CSE028
567700200610     C                     PARM CYSI      PCURR   3                                           CSE028
567800200610     C                     PARM SMCC      PMRKT   2                                           CSE034
567900200610     C                     PARM ITSI      PINVT   3                                           CSE028
568000200610     C                     PARM PTFR      PPTFR   4                                           CSE028
568100200610     C                     PARM           PCBSTD                                              CSE028
568200200610     C                     PARM           PCBSAD                                              CSE028
568300200610     C                     PARM *BLANKS   PTRTCD  5                                           CSE028
568400200610      *                                                                                       CSE028
568500200610     C           PTRTCD    IFNE '*NRF '                                                       CSE028
568600200610     C                     SELEC                                                              CSE028
568700200610     C           PTRTCD    WHNE '*NCRF'                                                       CSE028
568800200610     C           2         OCUR PCBSTD                                                        CSE028
568900200610     C           PTRTCD    WHNE '*NBRF'                                                       CSE028
569000200610     C           1         OCUR PCBSTD                                                        CSE028
569100200610     C                     ENDSL                                                              CSE028
569200200610     C                     MOVE STRECI    RECI                                                CSE028
569300200610     C                     ELSE                                                               CSE028
569400200610      *                                                                                       CSE028
569500200610      ** Set on Record Not Found indicator.                                                   CSE028
569600200610     C                     MOVE *ON       *IN77                                               CSE028
569700200610     C                     ENDIF                                                              CSE028
569800200610      *                                                                                       CSE028
569900200610     C                     ELSE                                                               CSE028
570000200610      *                                                                                       CSE028
570100200610     C           STDSKY    CHAINSTDSED               77                   E21584
570200200610     C           RECI      IFEQ '*'                                       081366
570300200610     C                     MOVE *ON       *IN77                           081366
570400200610     C                     ENDIF                                          081366
570500200610      *                                                                   E21584
570600200610     C                     MOVE '1'       WRECT                           E16085
570700200610     C           CLIKEY    CHAINCLINT                99                   E16085
570800200610     C           *IN99     IFEQ '0'                                       E16085
570900200610     C           C1DI      ANDNE'M'                                       E16085
571000200610      *                                                                   E21584
571100200610      ***  If first chain to STDSED failed, retry with blank ITSI.        E21584
571200200610      *                                                                   E21584
571300200610     C           *IN77     ANDEQ'1'                                       E21584
571400200610     C                     MOVE *BLANK    ITSI                            E16085
571500200610     C***********          END                                     E16085 E21584
571600200610     C           STDSKY    CHAINSTDSED               77
571700200610     C           RECI      IFEQ '*'                                       081366
571800200610     C                     MOVE *ON       *IN77                           081366
571900200610     C                     ENDIF                                          081366
572000200610     C                     END                                            E21584
572100200610      *                                                                                       CSE028
572200200610     C                     ENDIF                                                              CSE028
572300200610      *                                                                                       CSE028
572400200610     C/COPY WNCPYSRC,SE2370C027
572500200610      *                                                                   E21584
572600200610     C           *IN77     IFNE '1'
572700200610      *                                                                   147514
572800200610     C                     MOVE *OFF      *IN88                           147514
572900200610      *                                                                   CEU005
573000200610      * CEU005 active and Settlement Ccy used on STDSED.                  CEU005
573100200610     C           CEU005    IFEQ 'Y'                                       CEU005
573200200610     C           SCCY      ANDNE*BLANKS                                   CEU005
573300200610      *                                                                   CEU005
573400200610      * Access currencies file for EURO rate, EURO M/D indicator and      CEU005
573500200610      * Transition Date for 'In' Ccy.                                     CEU005
573600200610      *                                                                   CEU005
573700200610     C           PNCY      IFEQ BKEURO                                    CEU005
573800200610     C                     CALL 'AOCURRR0'                                CEU005
573900200610     C                     PARM           @RTCD   7                       CEU005
574000200610     C                     PARM '*KEY   ' @OPTN   7                       CEU005
574100200610     C                     PARM SCCY      @AJCD   3                       CEU005
574200200610     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
574300200610     C                     ELSE                                           CEU005
574400200610     C           SCCY      IFEQ BKEURO                                    CEU005
574500200610     C                     CALL 'AOCURRR0'                                CEU005
574600200610     C                     PARM           @RTCD   7                       CEU005
574700200610     C                     PARM '*KEY   ' @OPTN   7                       CEU005
574800200610     C                     PARM PNCY      @AJCD   3                       CEU005
574900200610     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
575000200610     C                     ENDIF                                          CEU005
575100200610     C                     ENDIF                                          CEU005
575200200610      *                                                                   CEU005
575300200610      * Value date is later than Transition Start Date.                   CEU005
575400200610     C           PSVL      IFGE A6TPSD                                    CEU005
575500200610     C           A6INCY    ANDEQ'Y'                                       143690
575600200610     C                     Z-ADDA6EUER    PSXR                            CEU005
575700200610      *                                                                   CEU005
575800200610      **Settlement*ccy*is*Euro*currency,*reverse*M/D*indicator.    CEU005 143690
575900200610     C** Nominal ccy is Euro currency, reverse M/D indicator.             143690
576000200610     C***********SCCY      IFEQ BKEURO                             CEU005 143690
576100200610     C           PNCY      IFEQ BKEURO                                    143690
576200200610     C           A6EUMD    IFEQ 'M'                                       CEU005
576300200610     C                     MOVE 'D'       PMDI                            CEU005
576400200610     C                     ELSE                                           CEU005
576500200610     C                     MOVE 'M'       PMDI                            CEU005
576600200610     C                     ENDIF                                          CEU005
576700200610      *                                                                   CEU005
576800200610      **Settlement*ccy*not*Euro*ccy,*use*Euro*M/D*indicator.       CEU005 143690
576900200610     C** Settlement ccy is Euro ccy, use Euro M/D indicator.              143690
577000200610     C                     ELSE                                           CEU005
577100200610     C                     MOVE A6EUMD    PMDI                            CEU005
577200200610     C                     ENDIF                                          CEU005
577300200610      *                                                                   CEU005
577400200610      * Use standard settlement ccy for position settlement ccy           CEU005
577500200610     C                     MOVE SCCY      PSCU                            CEU005
577600200610      *                                                                   194195
577700200610     C                     MOVE PSCU      WCURR                           194195
577800200610     C                     EXSR TG10                                      194195
577900200610     C                     Z-ADDSPOT      PBRX                            194195
578000200610      *                                                                   CEU005
578100200610      * Chain STDSED again.                                               CEU005
578200200610     C                     MOVE SCCY      CYSI                            CEU005
578300200610     C***********STDSKY    CHAINSTDSED               78            CEU005 147514
578400200610      *                                                                                       CSE028
578500200610      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
578600200610      *                                                                                       CSE028
578700200610     C           CSE028    IFEQ 'Y'                                                           CSE028
578800200610      *                                                                                       CSE028
578900200610     C                     MOVE *OFF      *IN88                                               CSE028
579000200610     C                     MOVELCSTM      PCUST                                               CSE028
579100200610     C                     CALL 'SESSIR0'                                                     CSE028
579200200610     C                     PARM 'D'       POTYP                                               CSE028
579300200610     C                     PARM SBRA      PBRCH                                               CSE028
579400200610     C                     PARM           PCUST                                               CSE028
579500200610     C                     PARM PBCD      PBOOK                                               CSE028
579600200610     C                     PARM CYSI      PCURR                                               CSE028
579700200610     C                     PARM SMCC      PMRKT                                               CSE034
579800200610     C                     PARM ITSI      PINVT                                               CSE028
579900200610     C                     PARM PTFR      PPTFR                                               CSE028
580000200610     C                     PARM           PCBSTD                                              CSE028
580100200610     C                     PARM           PCBSAD                                              CSE028
580200200610     C                     PARM *BLANKS   PTRTCD                                              CSE028
580300200610      *                                                                                       CSE028
580400200610     C           PTRTCD    IFNE '*NRF '                                                       CSE028
580500200610     C                     SELEC                                                              CSE028
580600200610     C           PTRTCD    WHNE '*NCRF'                                                       CSE028
580700200610     C           2         OCUR PCBSTD                                                        CSE028
580800200610     C           PTRTCD    WHNE '*NBRF'                                                       CSE028
580900200610     C           1         OCUR PCBSTD                                                        CSE028
581000200610     C                     ENDSL                                                              CSE028
581100200610     C                     MOVE STRECI    RECI                                                CSE028
581200200610     C                     ELSE                                                               CSE028
581300200610      *                                                                                       CSE028
581400200610      ** Set on Record Not Found indicator.                                                   CSE028
581500200610     C                     MOVE *ON       *IN88                                               CSE028
581600200610     C                     ENDIF                                                              CSE028
581700200610      *                                                                                       CSE028
581800200610     C                     ELSE                                                               CSE028
581900200610     C           STDSKY    CHAINSTDSED               88                   147514
582000200610     C                     ENDIF                                                              CSE028
582100200610      *                                                                                       CSE028
582200200610     C/COPY WNCPYSRC,SE2370C044
582300200610     C*****                ENDIF                                  CEU005  147869
582400200610     C*****                ENDIF                                  CEU005  147869
582500200610     C                     ENDIF                                          175400
582600200610     C                     ENDIF                                          175400
582700200610      *                                                                   CEU005
582800200610      * If no record found ensure fields from last chain not loaded       CEU005
582900200610      * to output fields.                                                 CEU005
583000200610     C************IN78     IFEQ '1'                                CEU005 147514
583100200610     C           *IN88     IFEQ *ON                                       147514
583200200610     C           CEU005    ANDEQ'Y'                                       175400
583300200610     C                     MOVE *BLANKS   PSMT                            CEU005
583400200610     C                     MOVE *BLANKS   PSEA                            CEU005
583500200610     C                     MOVE *BLANKS   PSEB                            CEU005
583600200610     C                     MOVE *BLANKS   PCPN                            CEU005
583700200610     C                     MOVE *BLANKS   PFAC                            CEU005
583800200610     C                     MOVE *BLANKS   PSPI                            CEU005
583900200610     C***********          ENDIF                                    147869175400
584000200610     C***********          ENDIF                                    147869175400
584100200610     C                     ELSE                                           CEU005
584200200610      *                                                                   CEU005
584300200610     C*
584400200610     C** USE RECEIVE FIELDS IF PAY/RECEIVE IND IS SET TO P
584500200610     C*
584600200610     C           PPRE      IFEQ 'P'
584700200610     C                     MOVE SPSM      PSMT
584800200610     C                     MOVE SPAT      PSEA
584900200610     C***********          MOVE SPBR      PSEB                            S01117
585000200610     C                     MOVE SPBA      PSEB                            S01117
585100200610     C                     MOVE SPCB      PCPN
585200200610     C                     MOVE SPFA      PFAC
585300200610     C                     MOVE SPSI      PSPI
585400200610     C                     ELSE
585500200610     C*
585600200610     C** USE PAY FIELDS IF PAY/RECEIVE IND IS SET TO R
585700200610     C*
585800200610     C           PPRE      IFEQ 'R'
585900200610     C                     MOVE SRSM      PSMT
586000200610     C                     MOVE SRAC      PSEA
586100200610     C***********          MOVE SRBR      PSEB                            S01117
586200200610     C                     MOVE SRAB      PSEB                            S01117
586300200610     C                     MOVE SRCB      PCPN
586400200610     C                     MOVE *BLANK    PFAC
586500200610     C                     MOVE *BLANK    PSPI
586600200610     C                     END
586700200610     C                     END
586800200610     C/COPY WNCPYSRC,SE2370C028
586900200610     C                     END
587000200610     C                     ENDIF                                          CEU005
587100200610     C/COPY WNCPYSRC,SE2370C045
587200200610     C*
587300200610     C                     Z-ADDRUND      PDTG
587400200610      *                                                                   S01447
587500200610      *** If S01447 installed, and settlement type = Dividend or Coupon   S01447
587600200610      *** and a security WHT details rcd for the security exists, and     S01447
587700200610      *** settlement is a payment, calculate tax amounts.                 S01447
587800200610      *                                                                   S01447
587900200610     C           S01447    IFEQ 'N'                                       S01447
588000200610     C           *IN80     OREQ '1'                                       S01447
588100200610     C           PPRE      OREQ 'P'                                       S01447
588200200610     C           SDET      ORNE 'DV'                                      S01447
588300200610     C           SDET      ANDNE'CP'                                      S01447
588400200610     C                     CLEARTASO                                      S01447
588500200610     C                     CLEARTASR                                      S01447
588600200610     C                     CLEARTAUS                                      S01447
588700200610     C                     ELSE                                           S01447
588800200610     C/COPY WNCPYSRC,SE2370C035
588900200610     C                     EXSR CALCTX                                    S01447
589000200610     C/COPY WNCPYSRC,SE2370C036
589100200610     C                     END                                            S01447
589200200610     C*
589300200610     C* ZEROISE NUMERIC FIELDS WITH NO SPECIFIED VALUE
589400200610     C*
589500200610     C                     Z-ADD0         PCHA
589600200610     C                     Z-ADD0         PCAM
589700200610     C***********          Z-ADD0         PSAT                            084669
589800200610     C***********          Z-ADDPAMD      PSAT                     084669 087178
589900200610     C*                                                                   087178
590000200610     C** Set up parameter for call to SEZ010                              087178
590100200610     C*                                                                   087178
590200200610     C                     MOVE 'M'       P@CLAS                          087178
590300200610     C                     MOVELPPRE      P@PPRE                          087178
590400200610     C                     Z-ADDPAMD      P@PAMD                          087178
590500200610     C                     Z-ADDPCHA      P@PCHA                          087178
590600200610     C                     Z-ADDPCAM      P@PCAM                          087178
590700200610     C                     Z-ADDTASO      P@TASO                          087178
590800200610     C                     Z-ADDTAUS      P@TAUS                          087178
590900200610     C                     Z-ADDPSXR      P@PSXR                          087178
591000200610     C                     MOVELPMDI      P@PMDI                          087178
591100200610     C                     MOVELPNCY      P@PNCY                          087178
591200200610     C                     MOVELPSCU      P@PSCU                          087178
591300200610     C                     Z-ADD0         P@STAM                                            AR853119
591400200610     C/COPY WNCPYSRC,SE2370C015
591500200610     C*                                                                   CAC002
591600200610     C                     MOVE 'TS'      P@TDTP                          CAC002
591700200610     C                     Z-ADD0         P@FXMR                          CAC002
591800200610     C                     Z-ADD0         P@MAMT                          CAC002
591900200610     C                     Z-ADD0         FXMP                            CAC002
592000200610     C                     Z-ADD0         FXMR                            CAC002
592100200610     C                     Z-ADD0         MAMT                            CAC002
592200200610     C*                                                                   087178
592300200610     C** Call SEZ010 to calculate the settlement amount in settle ccy     087178
592400200610     C*                                                                   087178
592500200610     C                     CALL 'SEZ010'                                  087178
592600200610     C                     PARM *BLANKS   P@RCDE  7                       087178
592700200610     C                     PARM           P@DATA                          087178
592800200610     C           P@RCDE    IFEQ *BLANKS                                   087178
592900200610     C                     Z-ADDP@PSAT    PSAT                            087178
593000200610     C                     ELSE                                           087178
593100200610     C                     EXSR *PSSR                                     087178
593200200610     C                     GOTO EAUDIT                                    087178
593300200610     C                     ENDIF                                          087178
593400200610     C*                                                                   087178
593500200610     C***********          Z-ADD0         LCD                             066777
593600200610     C                     Z-ADDRUND      LCD                             066777
593700200610     C                     Z-ADD0         TNLU
593800200610     C*                                                                   S01486
593900200610     C** IF PORTFOLIO MANAGEMENT IS ON, OUTPUT TNLU ON POSETD             S01486
594000200610     C** OR PRIVATE BANKING MODULE IS ON                                  CPB001
594100200610     C           BGPFMG    IFEQ 'Y'                                       S01486
594200200610     C           BGN4ST    OREQ 'Y'                                       CPB001
594300200610     C                     EXSR ZTNLU1                                    S01486
594400200610     C                     MOVELNATN      TNLU                            S01486
594500200610     C                     END                                            S01486
594600200610     C*                                                                   S01486
594700200610     C***********          MOVE ' '       CHTP                           *E18221
594800200610     C                     MOVE 'I'       CHTP                           *E18221
594900200610     C                     MOVE 'D'       RECI                            103017
595000200610     C           PSEB      IFEQ *BLANKS                                   084669
595100200610     C                     MOVE PBCA      PSEB                            084669
595200200610     C                     END                                            084669
595300200610     C           BGPFMG    IFEQ 'Y'                                       081765
595400200610     C           BGN4ST    OREQ 'Y'                                       CPB001
595500200610     C                     MOVE 'N'       WRESET  1                       CPB001
595600200610     C*                                                                   081765
595700200610     C                     MOVELPCPY      PLCUS                           081765
595800200610     C           BGPFMG    IFEQ 'Y'                                       CPB001
595900200610     C                     CALL 'AOPLCSR0'                                081765
596000200610     C                     PARM *BLANKS   PRTCD   7                       081765
596100200610     C                     PARM '*KEY'    POPTN   7                       081765
596200200610     C                     PARM           PLCUS  10                       081765
596300200610     C           SDPLCS    PARM SDPLCS    DSFDY                           081765
596400200610     C           PRTCD     IFNE *BLANKS                                   081765
596500200610     C                     MOVE 'Y'       WRESET                          CPB001
596600200610     C                     ENDIF                                          CPB001
596700200610     C                     ENDIF                                          CPB001
596800200610      *                                                                   CPB001
596900200610     C                     MOVELPCPY      PLCUS                           CPB001
597000200610     C           BGN4ST    IFEQ 'Y'                                       CPB001
597100200610     C                     CALL 'AOCUSTR1'                                CPB001
597200200610     C                     PARM *BLANKS   WWRTCD  7                       CPB001
597300200610     C                     PARM '*KEY   ' WWOPTN  7                       CPB001
597400200610     C                     PARM           PLCUS  10                       CPB001
597500200610     C                     PARM           WWKEY7  7                       CPB001
597600200610     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
597700200610     C           WWRTCD    IFNE *BLANKS                                   CPB001
597800200610     C           WWRTCD    OREQ *BLANKS                                   CPB001
597900200610     C           BBPRBA    ANDNE'Y'                                       CPB001
598000200610     C                     MOVE 'Y'       WRESET                          CPB001
598100200610     C                     ENDIF                                          CPB001
598200200610     C                     ENDIF                                          CPB001
598300200610      *                                                                   CPB001
598400200610     C           WRESET    IFEQ 'Y'                                       CPB001
598500200610     C                     MOVEL*BLANKS   PTFR                            081765
598600200610     C                     END                                            081765
598700200610     C                     END                                            081765
598800200610     C*                                                                   CAC002
598900200610     C**  If Analytical Accounting is installed, set the profit centre    CAC002
599000200610     C**  SE ICD default profit centre.                                   CAC002
599100200610     C*                                                                   CAC002
599200200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
599300200610     C                     MOVE BVSEPC    PPFC                            CAC002
599400200610     C                     ENDIF                                          CAC002
599500200610      *                                                                                      251950A
599600200610     C           PSEB      IFEQ *BLANKS                                                      251950A
599700200610     C                     MOVE PBCA      PSEB                                               251950A
599800200610     C                     END                                                               251950A
599900200610      *                                                                                      251950A
600000200610     C/COPY WNCPYSRC,SE2370C010
600100200610     C*
600200200610     C* WRITE POSITION SETTLEMENT RECORD
600300200610     C*
600400200610     C                     MOVE 'D'       RECI                            CSE023
600500200610     C** If CSE023 is not installed or if CSE023 is installed and         CSE023
600600200610     C** the events is not for Coupon, Dividend or Maturity then          CSE023
600700200610     C** use the normal processing.                                       CSE023
600800200610     C*                                                                   CSE023
600900200610     C           CSE023    IFEQ 'N'                                       CSE023
601000200610     C*                                                                   CSE023
601100200610     C           CSE023    OREQ 'Y'                                       CSE023
601200200610     C           PEVT      ANDNE'CP'                                      CSE023
601300200610     C           PEVT      ANDNE'MT'                                      CSE023
601400200610     C           PEVT      ANDNE'DV'                                      CSE023
601500200610     C*                                                                   CSE023
601600200610     C           CRTT      OREQ *BLANKS                                   CSE023
601700200610     C*                                                                   CSE023
601800200610     C* COUNT RECORDS WRITTEN                                             CSE023
601900200610     C*                                                                   CSE023
602000200610     C                     ADD  1         W02CNT  50                      CSE023
602100200610     C                     WRITEPOSETDF
602101200616     C                     EXSR PSAUDT                                                      AR324886
602200200610     C                     MOVE 'D'       RECI                            081366
602300200610      *                                                                                     AR853119
602400200610      ***  Write extension file                                                             AR853119
602500200610      *                                                                                     AR853119
602600200610     C           CER049    IFEQ 'Y'                                                         AR853119
602700200610     C                     EXSR SRPOST                                                      AR853119
602800200610     C                     ENDIF                                                            AR853119
602900200610     C*                                                                   CSE023
603000200610     C                     ELSE                                           CSE023
603100200610     C*                                                                   CSE023
603200200610     C** If Treaty Withholding Tax is installed, then set up fields       CSE023
603300200610     C** for SE2310.                                                      CSE023
603400200610     C*                                                                   CSE023
603500200610     C** For Coupon Event, @DIVDT is the Last Coupon Date.                CSE023
603600200610     C** For Dividend Event, @DIVDT is equal to the dividend date.        CSE023
603700200610     C*                                                                   CSE023
603800200610     C                     Z-ADD0         @DIVDT                          CSE023
603900200610     C                     MOVE ' '       @TVBAS                          CSE023
604000200610     C*                                                                   CSE023
604100200610     C           PEVT      IFEQ 'CP'                                      CSE023
604200200610     C                     Z-ADDLCCP      @DIVDT                          CSE023
604300200610     C                     END                                            CSE023
604400200610     C*                                                                   CSE023
604500200610     C           PEVT      IFEQ 'DV'                                      CSE023
604600200610     C           S01510    IFEQ 'Y'                                       CSE023
604700200610     C                     Z-ADDSDXD      @DIVDT                          CSE023
604800200610     C                     ELSE                                           CSE023
604900200610     C                     Z-ADDPDUD      @DIVDT                          CSE023
605000200610     C                     END                                            CSE023
605100200610     C*                                                                   CSE023
605200200610     C** If CSE008 is ON then use value date position for dividend.       CSE023
605300200610     C*                                                                   CSE023
605400200610     C           CSE008    IFEQ 'Y'                                       CSE023
605500200610     C                     MOVE 'V'       @TVBAS                          CSE023
605600200610     C                     ELSE                                           CSE023
605700200610     C                     MOVE 'T'       @TVBAS                          CSE023
605800200610     C                     END                                            CSE023
605900200610     C                     END                                            CSE023
606000200610     C*                                                                   CSE023
606100200610     C                     CALL 'SE2310'                                  CSE023
606200200610     C                     PARM           PPOSET                          CSE023
606300200610     C                     PARM           @TVBAS  1                       CSE023
606400200610     C                     PARM           @DIVDT  50                      CSE023
606500200610     C                     PARM           @NREC   30                      CSE023
606600200610     C                     PARM           @ERR    1                       CSE023
606700200610     C*                                                                   CSE023
606800200610     C           @ERR      IFEQ 'N'                                       CSE023
606900200610     C                     ADD  @NREC     W02CNT                          CSE023
607000200610     C                     ELSE                                           CSE023
607100200610     C                     EXSR *PSSR                                     CSE023
607200200610     C                     EXSR AUDIT                                     CSE023
607300200610     C                     MOVE '1'       *INLR                           CSE023
607400200610     C                     END                                            CSE023
607500200610     C                     END                                            CSE023
607600200610     C/COPY WNCPYSRC,SE2370C016
607700200610     C*
607800200610     C                     Z-ADD0         TNLU                            S01486
607900200610     C*                                                                   S01486
608000200610     C           ENDW02    ENDSR                           ** ENDW02 **
608100200610      *
608200200610      *****************************************************************
608300200610      /EJECT                                                              S01447
608400200610      *****************************************************************   S01447
608500200610      *                                                               *   S01447
608600200610      *  CALCTX - Subroutine to calculate tax amounts for dividends   *   S01447
608700200610      *           and Coupons                                         *   S01447
608800200610      *                                                               *   S01447
608900200610      *  CALLED FROM: W02                                             *   S01447
609000200610      *  CALLS:       NONE                                            *   S01447
609100200610      *                                                               *   S01447
609200200610      *****************************************************************   S01447
609300200610      *                                                                   S01447
609400200610     C           CALCTX    BEGSR                                          S01447
609500200610      *                                                                   S01447
609600200610      *** Initialise work tax rate and amount fields                      S01447
609700200610      *                                                                   S01447
609800200610     C                     CLEARUTXRSR                                    S01447
609900200610     C                     CLEARUTXRRF                                    S01447
610000200610     C                     CLEARUTXRUS                                    S01447
610100200610      *                                                                   S01447
610200200610      *** If tax band at source is zero, then take rate from security     S01447
610300200610      *** WHT details file; Otherwise access SEcountry tax rate file to   S01447
610400200610      *** get tax rate at source                                          S01447
610500200610      *                                                                   S01447
610600200610     C           S1TABD    IFEQ *ZERO                      *B1            S01447
610700200610     C                     Z-ADDS1RASO    UTXRSR                          S01447
610800200610     C                     ELSE                            *X1            S01447
610900200610      *                                                                   S01447
611000200610     C                     MOVELS1CTTA    UKEY    3                       S01447
611100200610     C                     MOVE S1TABD    UKEY                            S01447
611200200610      *                                                                   S01447
611300200610     C                     CALL 'AOSCTXR0'                                S01447
611400200610     C                     PARM *BLANKS   @RTCD                           S01447
611500200610     C                     PARM '*KEY   ' @OPTN                           S01447
611600200610     C                     PARM S1CTTA    @CTTA   2                       S01447
611700200610     C                     PARM S1TABD    @TABD   10                      S01447
611800200610     C           SECNTR    PARM SECNTR    DSSDY                           S01447
611900200610     C*                                                                   S01447
612000200610     C           @RTCD     IFNE *BLANKS                    *B2            S01447
612100200610     C           TXRECI    ORNE 'D'                                       S01447
612200200610     C           *LOCK     IN   LDA                                       S01447
612300200610     C                     MOVEL'SECNTRL0'DBFILE           ***************S01447
612400200610     C                     MOVELUKEY      DBKEY            ** DBERROR 011 S01447
612500200610     C                     Z-ADD11        DBASE            ***************S01447
612600200610     C                     SETON                       U7U8               S01447
612700200610     C                     EXSR *PSSR                                     S01447
612800200610     C                     GOTO EAUDIT                                    S01447
612900200610     C                     ELSE                            *X2            S01447
613000200610     C                     Z-ADDTXRASO    UTXRSR                          S01447
613100200610     C                     END                             *E2            S01447
613200200610     C                     END                             *E1            S01447
613300200610      *                                                                   S01447
613400200610      *** If tax band by user is not zero, then access country to         S01447
613500200610      *** branch tax rate file to get tax rate by user                    S01447
613600200610      *** Otherwise set to zero.                                          S01447
613700200610      *                                                                   S01447
613800200610     C           S1TABU    IFNE *ZERO                      *B1            S01447
613900200610     C                     CALL 'AOCBTXR0'                                S01447
614000200610     C                     PARM *BLANKS   @RTCD                           S01447
614100200610     C                     PARM '*KEY   ' @OPTN                           S01447
614200200610     C                     PARM WBC       @BRCA   3                       S01447
614300200610     C                     PARM S1CTTA    @CTTA                           S01447
614400200610     C                     PARM S1TABU    @TABU   10                      S01447
614500200610     C           SECBTX    PARM SECBTX    DSFDY                           S01447
614600200610     C*                                                                   S01447
614700200610     C           @RTCD     IFEQ *BLANKS                    *B2            S01447
614800200610     C           TBRECI    ANDEQ'D'                                       S01447
614900200610     C                     Z-ADDTBRASR    UTXRRF                          S01447
615000200610     C                     Z-ADDTBRAUS    UTXRUS                          S01447
615100200610     C                     END                             *E2            S01447
615200200610     C                     END                             *E1            S01447
615300200610      *                                                                   S01447
615400200610      *** calculate amount deducted at source                             S01447
615500200610      *                                                                   S01447
615600200610     C           S01496    IFEQ 'Y'                                                           248184
615700200610     C           PAMD      MULT UTXRSR    WTASO  204                                          248184
615800200610     C           WTASO     DIV  100       TASO      H                                         248184
615900200610     C                     ELSE                                                               248184
616000200610     C           UTXRSR    DIV  100       URATE   54                      S01447
616100200610     C           PAMD      MULT URATE     TASO      H                     S01447
616200200610     C                     ENDIF                                                              248184
616300200610      *                                                                   S01447
616400200610      *** calculate amount deducted refundable                            S01447
616500200610      *                                                                   S01447
616600200610     C           S01496    IFEQ 'Y'                                                           248184
616700200610     C           PAMD      MULT UTXRRF    WTASR  204                                          248184
616800200610     C           WTASR     DIV  100       TASR      H                                         248184
616900200610     C                     ELSE                                                               248184
617000200610     C           UTXRRF    DIV  100       URATE                           S01447
617100200610     C           PAMD      MULT URATE     TASR      H                     S01447
617200200610     C                     ENDIF                                                              248184
617300200610      *                                                                   S01447
617400200610      *** Amount deducted by user is set to zero, as this is a depot      S01447
617500200610      *** position.                                                       S01447
617600200610      *                                                                   S01447
617700200610     C                     CLEARTAUS                                      S01447
617800200610      *                                                                   S01447
617900200610     C                     ENDSR                                          S01447
618000200610      *                                                                   S01447
618100200610      *****************************************************************   S01447
618200200610      /EJECT
618300200610      *****************************************************************
618400200610      *                                                               *
618500200610      *  SECTIN - Subroutine to get Security record.                  *
618600200610      *                                                               *
618700200610      *****************************************************************
618800200610      *
618900200610     C           SECTIN    BEGSR                           ** SECTIN **
619000200610     C*
619100200610     C** CHAIN FOR SECURITY RECORD AND DATA BASE ERROR
619200200610     C*
619300200610     C           SECTKY    CHAINSECTY                79
619400200610     C           *IN79     IFNE '1'
619500200610     C           RECI      COMP '*'                      79
619600200610     C                     END
619700200610     C           *IN79     IFEQ '1'
619800200610     C           *LOCK     IN   LDA                                       S01117
619900200610     C                     MOVEL'SECTY'   DBFILE           ***************
620000200610     C                     MOVELWDSSC     DBKEY            * DB ERROR 14 *
620100200610     C                     SETON                     U7U8  ***************
620200200610     C                     Z-ADD14        DBASE
620300200610     C                     DUMP                                           S01117
620400200610     C                     GOTO EAUDIT
620500200610     C                     END
620600200610     C*                                                                   S01408
620700200610     C/COPY WNCPYSRC,SE2370CCP3                                           S01408
620800200610     C*                                                                   S01408
620900200610      *
621000200610      *** Access security WHT Details file                                S01447
621100200610      *                                                                   S01447
621200200610     C           SECTKY    CHAINSESWHTL0             80                   S01447
621300200610      *                                                                   S01447
621400200610     C                     ENDSR
621500200610      *
621600200610      *****************************************************************
621700200610      /SPACE 3
621800200610      *****************************************************************
621900200610      *                                                               *
622000200610      *  INVTIN - Subroutine to get Investment Type record.           *
622100200610      *                                                               *
622200200610      *****************************************************************
622300200610      *
622400200610     C           INVTIN    BEGSR                           ** INVTIN **
622500200610     C*
622600200610     C** CHAIN FOR INVESTMENT TYPE RECORD AND DATA BASE ERROR
622700200610     C*
622800200610     C           INVTKY    CHAININVTP                79
622900200610     C           *IN79     IFNE '1'
623000200610     C           RECI      COMP '*'                      79
623100200610     C                     END
623200200610     C           *IN79     IFEQ '1'
623300200610     C           *LOCK     IN   LDA                                       S01117
623400200610     C                     MOVEL'INVTP'   DBFILE           ***************
623500200610     C                     MOVELINVKEY    DBKEY            * DB ERROR 15 *
623600200610     C                     SETON                     U7U8  ***************
623700200610     C                     Z-ADD15        DBASE
623800200610     C                     DUMP                                           S01117
623900200610     C                     GOTO EAUDIT
624000200610     C                     END
624100200610      *
624200200610     C                     ENDSR
624300200610      *
624400200610      *****************************************************************
624500200610      /SPACE 3
624600200610      *****************************************************************
624700200610      *                                                               *
624800200610      *  CLNTIN - Subroutine to get CLINTCB Client record.            *
624900200610      *                                                               *
625000200610      *****************************************************************
625100200610      *
625200200610     C           CLNTIN    BEGSR                           ** CLNTIN **
625300200610     C*
625400200610     C           CLINTK    CHAINCLINT                79
625500200610     C           *IN79     IFNE '1'
625600200610     C           RECI      COMP '*'                      79
625700200610     C                     END
625800200610     C           *IN79     IFEQ '1'
625900200610     C**********           MOVEL'CLINT'   DBFILE           ***************
626000200610     C**********           MOVELWCLNTK    DBKEY            * DB ERROR 16 *
626100200610     C**********           SETON                     U7U8  ***************
626200200610     C**********           Z-ADD16        DBASE            **
626300200610     C**********           GOTO EAUDIT
626400200610     C*
626500200610     C                     END
626600200610     C*
626700200610     C                     ENDSR
626800200610      *
626900200610      *****************************************************************
627000200610      /SPACE 3
627100200610      *****************************************************************
627200200610      *                                                               *
627300200610      *  SECEDI - Subroutine to get Security Diary Event record.      *
627400200610      *                                                               *
627500200610      *****************************************************************
627600200610      *
627700200610     C           SECEDI    BEGSR                           ** SECEDI **
627800200610     C*
627900200610     C** CHAIN FOR SECURITY EVENT RECORD AND DATA BASE ERROR
628000200610     C*
628100200610     C***STORE*NOM*CCY*FROM*SECTYD*AS*SEDEVDF*HAS*NMCY*FIELD*TOO*******   E20086
628200200610     C***********                                                         E20086
628300200610     C***********          MOVE NMCY      WNMCY   3                       E20086
628400200610     C           SECDKY    CHAINSEDEVDF              7877
628500200610     C           *IN78     IFNE '1'
628600200610     C           RECI      COMP '*'                      78
628700200610     C                     END
628800200610     C           *IN77     IFEQ '1'
628900200610     C           *LOCK     IN   LDA                                       S01117
629000200610     C                     MOVEL'SECED'   DBFILE           ***************
629100200610     C                     MOVELWDSSC     DBKEY            * DB ERROR 17 *
629200200610     C                     Z-ADD17        DBASE            ***************
629300200610     C                     SETON                     U7U8
629400200610     C                     DUMP                                           S01117
629500200610     C                     GOTO EAUDIT
629600200610     C                     END
629700200610     C***********          MOVE WNMCY     NMCY                            E20086
629800200610      *
629900200610     C                     ENDSR
630000200610      *
630100200610      *****************************************************************
630200200610      /SPACE 3
630300200610      *****************************************************************
630400200610      *                                                               *
630500200610      *  TG10   - Subroutine to get Security Currency Decimal Places  *
630600200610      *           from TABTG10.                                       *
630700200610      *                                                               *
630800200610      *****************************************************************
630900200610      *
631000200610     C           TG10      BEGSR                           ** TG10   **
631100200610     C*
631200200610     C** CHAIN FOR CURRENCY RECORD IN TABLE TABTG10
631300200610     C** FIELD WCURR CONTAINS THE CURRENCY WHEN THIS SUBROUTINE EXECUTED
631400200610     C*
631500200610     C* IF WCURR IS EQUAL TO WLSTCY (LAST CCY TO ACCESS TABTG10) IGNORE
631600200610     C*
631700200610     C           WCURR     CABEQWLSTCY    ENDT10
631800200610     C                     MOVE WCURR     WLSTCY  3
631900200610     C*
632000200610     C                     MOVEL'20      'ZTABKY 12
632100200610     C                     MOVE '1'       WRK4    4
632200200610     C                     MOVELWCURR     WRK4
632300200610     C                     MOVE WRK4      ZTABKY
632400200610     C**
632500200610     C           ZTABKY    CHAINTABTG10F             99
632600200610     C*
632700200610     C* ERROR IF NO RECORD FOUND OR IF IT IS DELETED
632800200610     C*
632900200610     C           *IN99     IFEQ '1'
633000200610     C                     SETON                     U7U8
633100200610     C                     ELSE
633200200610     C           RECI      IFEQ '*'
633300200610     C                     SETON                     U7U8
633400200610     C                     END
633500200610     C                     END
633600200610     C           *INU7     IFEQ '1'
633700200610     C           *LOCK     IN   LDA                                       S01117
633800200610     C                     MOVE 'TABLE'   DBFILE           ***************
633900200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 18 *
634000200610     C                     Z-ADD18        DBASE            ***************
634100200610     C                     DUMP                                           S01117
634200200610     C                     GOTO EAUDIT
634300200610     C                     END
634400200610     C*                                                                   S01117
634500200610     C**  Set up new output parameter for use in SR.ZCNSD                 S01117
634600200610     C*                                                                   S01117
634700200610     C                     Z-ADDCDP       ZCDP                            S01117
634800200610     C*
634900200610     C           ENDT10    ENDSR                           ** ENDT10 **
635000200610      *
635100200610      *****************************************************************
635200200610      /SPACE 3
635300200610      *****************************************************************
635400200610      *                                                               *
635500200610      *  TR10   - Subroutine to get Branch Name from TABLETR.         *
635600200610      *                                                               *
635700200610      *****************************************************************
635800200610      *
635900200610     C           TR10      BEGSR                           ** TR10   **
636000200610     C*
636100200610     C** CHAIN FOR BRANCH NAME IN TABLE TABTG10
636200200610     C** FIELD WBC CONTAINS THE BRANCH CODE WHEN SUBROUTINE EXECUTES
636300200610     C*
636400200610     C**********           Z-ADD10        RECT                                               BUG7985
636500200610     C***********          Z-ADDWBC       WBRCDE                          S01117
636600200610     C**********           MOVE WBC       WBRCDE                                      S01117 BUG7985
636700200610     C**
636800200610     C********** TKEY      CHAINTABLETRF             99                                      BUG7985
636900200610      *                                                                                      BUG7985
637000200610     C                     CALL 'AOBRCHR1'                                                   BUG7985
637100200610     C                     PARM *BLANKS   PRTCD   7                                          BUG7985
637200200610     C                     PARM '*KEY   ' POPTN   7                                          BUG7985
637300200610     C                     PARM WBC       PBRCH   3                                          BUG7985
637400200610     C           SDBRCH    PARM SDBRCH    DSSDY                                              BUG7985
637500200610     C*                                                                                      BUG7985
637600200610     C*
637700200610     C* ERROR IF NO RECORD FOUND OR IF IT IS DELETED
637800200610     C*
637900200610     C           PRTCD     IFNE *BLANKS                                                      BUG7985
638000200610     C********** *IN99     IFEQ '1'                                                          BUG7985
638100200610     C                     SETON                     U7U8
638200200610     C**********           ELSE                                                              BUG7985
638300200610     C********** RECI      IFEQ '*'                                                          BUG7985
638400200610     C**********           SETON                     U7U8                                    BUG7985
638500200610     C**********           END                                                               BUG7985
638600200610     C                     END
638700200610     C           *INU7     IFEQ '1'
638800200610     C           *LOCK     IN   LDA                                       S01117
638900200610     C**********           MOVE 'TABLE'   DBFILE           ***************                   BUG7985
639000200610     C**********           MOVELTKEY      DBKEY            * DB ERROR 19 *                   BUG7985
639100200610     C                     MOVE 'SDBRCHPD'DBFILE                                             BUG7985
639200200610     C                     MOVELWBC       DBKEY                                              BUG7985
639300200610     C                     Z-ADD19        DBASE            ***************
639400200610     C                     DUMP                                           S01117
639500200610     C                     GOTO EAUDIT
639600200610     C                     END
639700200610     C*
639800200610     C           ENTR10    ENDSR                           ** ENTR10 **
639900200610      *
640000200610      *****************************************************************
640100200610      /EJECT
640200200610      *****************************************************************
640300200610      *                                                               *
640400200610      *  AUDIT  - Subroutine to update the Audit Files and Output the *
640500200610      *           Control Report.                                     *
640600200610      *                                                               *
640700200610      *****************************************************************
640800200610      *
640900200610     C           AUDIT     BEGSR                           ** AUDIT **
641000200610     C*
641100200610     C** COMPARE COUNT OF DEPOT MOVEMENTS TO AUDIT MOVEMENTS
641200200610     C*
641300200610     C           *INU8     IFNE '1'
641400200610     C           WCMOVT    IFNE DMNORE
641500200610     C                     MOVE '1'       *INU8
641600200610     C                     END
641700200610     C                     END
641800200610     C*
641900200610     C** COMPARE COUNT OF CUSTOMER MOVEMENTS TO AUDIT MOVEMENTS
642000200610     C*
642100200610     C           *INU8     IFNE '1'
642200200610     C           WCCMVT    IFNE DCNORE
642300200610     C                     MOVE '1'       *INU8
642400200610     C                     END
642500200610     C                     END
642600200610     C*
642700200610     C** READ DEPOT POSITIONS AUDIT FILE UNLESS ALREADY DB ERROR U7
642800200610     C*
642900200610     C           *INU7     IFNE '1'
643000200610     C                     READ DPOSNA                   79
643100200610     C********** *IN79     IFNE '1'                                       E15035
643200200610     C********** RECI      ANDEQ'*'                                       E15035
643300200610     C**********           MOVE '1'       *IN79                           E15035
643400200610     C**********           END                                            E15035
643500200610     C*
643600200610     C* DATA BASE ERROR
643700200610     C*
643800200610     C           *IN79     IFEQ '1'
643900200610     C           *LOCK     IN   LDA                                       S01117
644000200610     C                     MOVEL'DPOSNA'  DBFILE           ***************
644100200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 20 *
644200200610     C                     Z-ADD20        DBASE            ***************
644300200610     C                     SETON                       U7U8
644400200610     C                     DUMP                                           S01117
644500200610     C                     END
644600200610     C                     END
644700200610     C*
644800200610     C** UPDATE DPOSNA IF U8 NOT ON
644900200610     C*
645000200610     C           *INU8     IFNE '1'
645100200610     C                     Z-ADDNORE      DPNORE  50
645200200610     C                     ADD  WCADDP    NORE
645300200610     C                     UPDATDPOSNAF
645400200610     C                     Z-ADDNORE      WNEWDP  50
645500200610     C                     END
645600200610     C           *INU8     IFEQ '1'
645700200610     C                     Z-ADD0         NORE
645800200610     C                     Z-ADD0         WNEWDP
645900200610     C                     END
646000200610     C*
646100200610     C** IF U8 NOT ON WRITE GEN A/C KEYS AUDIT AND POSN.SETT.AUDIT FILES
646200200610     C*
646300200610     C           *INU8     IFNE '1'
646400200610     C                     Z-ADDW01CNT    NORE
646500200610     C                     Z-ADDINT,1     HRWN
646600200610     C                     Z-ADDDEC,1     HRDC
646700200610     C                     WRITESEKEYAF
646800200610     C*
646900200610     C* WRITE POSETA AUDIT RECORD WITH NO OF RECORDS ON FILE
647000200610     C*
647100200610     C                     Z-ADDW02CNT    NORE
647200200610     C                     WRITEPOSETAF
647300200610     C*
647400200610     C                     END
647500200610     C*
647600200610     C* OUTPUT CONTROL REPORT
647700200610     C*
647800200610     C                     WRITEHEADAU
647900200610     C           *INU7     IFEQ '1'
648000200610     C                     WRITEERROR
648100200610     C                     ELSE
648200200610     C*
648300200610     C* IF RECORD COUNT IS ZERO OUTPUT NONE
648400200610     C*
648500200610     C           WCMOVT    ADD  WORK1     WORK1   50
648600200610     C           WCSETT    ADD  WORK1     WORK1   50
648700200610     C           WCTRAD    ADD  WORK1     WORK1   50
648800200610     C           WCCMVT    ADD  WORK1     WORK1   50
648900200610     C           WORK1     IFEQ 0
649000200610     C                     WRITENONE
649100200610     C                     ELSE
649200200610     C           DMNORE    COMP WCMOVT               2929
649300200610     C           DCNORE    COMP WCCMVT               3030
649400200610     C                     Z-ADDINT,1     WHASHT
649500200610AW   C                     Z-ADDDEC,1     WHASHD
649600200610     C                     WRITECONTROL
649700200610     C*
649800200610     C                     END
649900200610     C                     END
650000200610     C*                                                                   S01117
650100200610     C**  Update the local data area with Database Error Details          S01117
650200200610     C*                                                                   S01117
650300200610     C           *INU7     IFEQ '1'                                       S01117
650400200610     C           *INU8     ANDEQ'1'                                       S01117
650500200610     C                     OUT  LDA                                       S01117
650600200610     C                     END                                            S01117
650700200610     C***********                                                         E29170
650800200610     C***********          WRITETRAILAU                                   E29170
650900200610     C*
651000200610     C                     ENDSR
651100200610      *
651200200610      *****************************************************************
651300200610      /EJECT
651400200610      *****************************************************************
651500200610      *                                                               *
651600200610      *  DPOASR - Subroutine for Error Handling of PF/DPOSNA.         *
651700200610      *                                                               *
651800200610      *****************************************************************
651900200610      *
652000200610     C           DPOASR    BEGSR                            **DPOASR**
652100200610     C*
652200200610     C           *LOCK     IN   LDA                                       S01117
652300200610     C                     MOVEL'DPOSNA'  DBFILE           ***************
652400200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 21 *
652500200610     C                     Z-ADD21        DBASE            ***************
652600200610     C                     MOVE STSUDD    DBSTAT
652700200610     C                     MOVE '1'       *IN87
652800200610     C                     SETON                     99U7U8
652900200610     C                     DUMP                                           S01117
653000200610     C                     GOTO EAUDIT
653100200610     C*
653200200610     C                     ENDSR
653300200610      *
653400200610      *****************************************************************
653500200610      /SPACE 3
653600200610      *****************************************************************
653700200610      *                                                               *
653800200610      *  DPOHSR - Subroutine for Error Handling of LF/DPOSH.          *
653900200610      *                                                               *
654000200610      *****************************************************************
654100200610      *
654200200610     C           DPOHSR    BEGSR                           ** DPOHSR **
654300200610     C*
654400200610     C           *LOCK     IN   LDA                                       S01117
654500200610     C                     MOVE 'DPOSH'   DBFILE           ***************
654600200610     C                     MOVELCOMARA    DBKEY            * DB ERROR 22 *
654700200610     C                     Z-ADD022       DBASE            ***************
654800200610     C                     MOVE STSUDA    DBSTAT
654900200610     C                     MOVE '1'       *IN87
655000200610     C                     SETON                     99U7U8
655100200610     C                     DUMP                                           S01117
655200200610     C                     GOTO EAUDIT
655300200610     C*
655400200610     C                     ENDSR
655500200610      *
655600200610      *****************************************************************
655700200610      /SPACE 3
655800200610      *****************************************************************
655900200610      *                                                               *
656000200610      *  POSDSR - Subroutine for Error Handling of PF/POSETD.         *
656100200610      *                                                               *
656200200610      *****************************************************************
656300200610      *
656400200610     C           POSDSR    BEGSR                            ** POSDSR **
656500200610     C*
656600200610     C                     MOVE PBCA      PBCAK                           CSE023
656700200610     C                     MOVE PSSH      PSSHK                           CSE023
656800200610     C                     MOVE PCPY      PCPYK                           CSE023
656900200610     C           *LOCK     IN   LDA                                       S01117
657000200610     C                     MOVE 'POSETD'  DBFILE           ***************
657100200610     C                     MOVELPOSDDB    DBKEY            * DB ERROR 23 *
657200200610     C                     Z-ADD023       DBASE            ***************
657300200610     C                     MOVE STSPSD    DBSTAT
657400200610     C                     MOVE '1'       *IN87
657500200610     C                     SETON                     99U7U8
657600200610     C                     DUMP                                           S01117
657700200610     C                     GOTO EAUDIT
657800200610     C*
657900200610     C                     ENDSR
658000200610      *
658100200610      *****************************************************************
658200200610      /SPACE 3
658300200610      *****************************************************************
658400200610      *                                                               *
658500200610      *  SEKDSR - Subroutine for Error Handling of PF/SEKEYD.         *
658600200610      *                                                               *
658700200610      *****************************************************************
658800200610      *
658900200610     C           SEKDSR    BEGSR                            **SEKDSR**
659000200610     C*
659100200610     C           *LOCK     IN   LDA                                       S01117
659200200610     C                     MOVE 'SEKEYD'  DBFILE           ***************
659300200610     C                     MOVELACKY      DBKEY            * DB ERROR 24 *
659400200610     C                     Z-ADD024       DBASE            ***************
659500200610     C                     MOVE STSSKD    DBSTAT
659600200610     C                     MOVE '1'       *IN87
659700200610     C                     SETON                     99U7U8
659800200610     C                     DUMP                                           S01117
659900200610     C                     GOTO EAUDIT
660000200610     C*
660100200610     C                     ENDSR
660200200610      *
660300200610      *****************************************************************
660400200610      /SPACE 3
660500200610      *****************************************************************
660600200610      *                                                               *
660700200610      *  POSASR - Subroutine for Error Handling of PF/POSETA.         *
660800200610      *                                                               *
660900200610      *****************************************************************
661000200610      *
661100200610     C           POSASR    BEGSR                              **POSASR**
661200200610     C*
661300200610     C           *LOCK     IN   LDA                                       S01117
661400200610     C                     MOVE 'POSETA'  DBFILE           ***************
661500200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 25 *
661600200610     C                     Z-ADD25        DBASE            ***************
661700200610     C                     MOVE STSPSA    DBSTAT
661800200610     C                     MOVE '1'       *IN87
661900200610     C                     SETON                     99U7U8
662000200610     C                     DUMP                                           S01117
662100200610     C                     GOTO EAUDIT
662200200610     C*
662300200610     C                     ENDSR
662400200610      *
662500200610      *****************************************************************
662600200610      /SPACE 3
662700200610      *****************************************************************
662800200610      *                                                               *
662900200610      *  SEKASR - Subroutine for Error Handling of PF/SEKEYA.         *
663000200610      *                                                               *
663100200610      *****************************************************************
663200200610      *
663300200610     C           SEKASR    BEGSR                             **SEKASR**
663400200610     C*
663500200610     C           *LOCK     IN   LDA                                       S01117
663600200610     C                     MOVE 'SEKEYA'  DBFILE           ***************
663700200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 26 *
663800200610     C                     Z-ADD26        DBASE            ***************
663900200610     C                     MOVE STSSKA    DBSTAT
664000200610     C                     MOVE '1'       *IN87
664100200610     C                     SETON                     99U7U8
664200200610     C                     DUMP                                           S01117
664300200610     C                     GOTO EAUDIT
664400200610     C*
664500200610     C                     ENDSR
664600200610     C/COPY WNCPYSRC,SE2370C017
664700200610      *
664800200610      *****************************************************************
664900200610      /EJECT
665000200610      *****************************************************************
665100200610      *                                                               *
665200200610      *  FIRST  - Subroutine for Access ICD Information.              *
665300200610      *                                                               *
665400200610      *****************************************************************
665500200610      *
665600200610     C           FIRST     BEGSR                           ** FIRST **
665700200610     C*
665800200610     C************NAMVAR   DEFN           LDA                             S01117
665900200610     C*
666000200610     C* ACCESS ICD    TABTB10
666100200610     C*
666200200610     C                     EXSR ZSYSTM
666300200610     C           *IN99     IFEQ '1'
666400200610     C                     MOVE '1'       *INU7
666500200610     C                     MOVE '1'       *INU8
666600200610     C           *LOCK     IN   LDA                                       S01117
666700200610     C                     MOVE 'TABLE'   DBFILE           ***************
666800200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 01 *
666900200610     C                     Z-ADD1         DBASE            ***************
667000200610     C                     DUMP                                           S01117
667100200610     C                     ELSE
667200200610     C*
667300200610     C* ACCESS ICD2   TABTB11
667400200610     C*
667500200610     C                     EXSR ZICD2
667600200610     C           *INU7     IFEQ '1'
667700200610     C                     MOVE '1'       *IN99
667800200610     C           *LOCK     IN   LDA                                       S01117
667900200610     C                     MOVE 'TABLE'   DBFILE           ***************
668000200610     C                     MOVELTKEY      DBKEY            * DB ERROR 02 *
668100200610     C                     Z-ADD2         DBASE            ***************
668200200610     C                     DUMP                                           S01117
668300200610     C                     ELSE
668400200610     C*                                                                   E29170
668500200610     C** TEST WHETHER MULTIBRANCHING IS ON                                E29170
668600200610     C*                                                                   E29170
668700200610     C           MBIN      IFEQ 'Y'                                       E29170
668800200610     C                     SETON                     37                   E29170
668900200610     C                     END                                            E29170
669000200610     C*                                                                   S01117
669100200610     C* SETUP REQUIRE PARAMETER FOR SR.ZSDESC                             S01117
669200200610     C*                                                                   S01117
669300200610     C                     MOVE RSFD      ZRSFD                           S01117
669400200610     C*
669500200610     C* ACCESS ICDSE  TABTB36
669600200610     C*
669700200610     C                     EXSR ZICDSE
669800200610     C           *INU7     IFEQ '1'
669900200610     C                     MOVE '1'       *IN99
670000200610     C           *LOCK     IN   LDA                                       S01117
670100200610     C                     MOVE 'TABLE'   DBFILE           ***************
670200200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 03 *
670300200610     C                     Z-ADD3         DBASE            ***************
670400200610     C                     DUMP                                           S01117
670500200610     C                     END
670600200610     C                     END
670700200610     C                     END
670800200610     C*                                                                   E29170
670900200610     C** RCF PROCESSING FOR AUDIT PRINTER FILE                            E29170
671000200610     C*                                                                   E29170
671100200610     C                     EXSR RCFAU                                     E29170
671200200610     C/COPY WNCPYSRC,SE2370C011
671300200610      *                                                                   CEU005
671400200610      *** Obtain General ledger details                                   CEU005
671500200610      *                                                                   CEU005
671600200610     C**********           CALL 'AOGELRR0'                                CEU005              CGL029
671700200610     C                     CALL 'AOGELRR1'                                                    CGL029
671800200610     C                     PARM '*DBERR ' @RTCD   7                       CEU005
671900200610     C                     PARM '*FIRST ' @OPTN   7                       CEU005
672000200610     C********** SDGELR    PARM SDGELR    DSFDY                           CEU005              CGL029
672100200610     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
672200200610      *                                                                   S01447
672300200610      *** Check Withholding tax is installed                              S01447
672400200610      *                                                                   S01447
672500200610     C                     CALL 'AOSARDR0'                                S01447
672600200610     C                     PARM *BLANKS   @RTCD   7                       S01447
672700200610     C                     PARM '*VERIFY' @OPTN   7                       S01447
672800200610     C                     PARM 'S01447'  @SARD   6                       S01447
672900200610      *                                                                   S01447
673000200610     C           @RTCD     IFEQ *BLANK                                    S01447
673100200610     C                     MOVE 'Y'       S01447  1                       S01447
673200200610     C                     ELSE                                           S01447
673300200610     C                     MOVE 'N'       S01447                          S01447
673400200610     C                     END                                            S01447
673500200610     C*                                                                   S01509
673600200610     C** Check S01509 is installed                                        S01509
673700200610     C*                                                                   S01509
673800200610     C                     CALL 'AOSARDR0'                                S01509
673900200610     C                     PARM *BLANKS   @RTCD   7                       S01509
674000200610     C                     PARM '*VERIFY' @OPTN   7                       S01509
674100200610     C                     PARM 'S01509'  @SARD   6                       S01509
674200200610     C*                                                                   S01509
674300200610     C           @RTCD     IFEQ *BLANK                                    S01509
674400200610     C                     MOVE 'Y'       S01509  1                       S01509
674500200610     C                     ELSE                                           S01509
674600200610     C                     MOVE 'N'       S01509                          S01509
674700200610     C                     END                                            S01509
674800200610     C*                                                                   S01510
674900200610     C** Check if Dividend Payments based on Ex-Date is installed         S01510
675000200610     C*                                                                   S01510
675100200610     C                     CALL 'AOSARDR0'                                S01510
675200200610     C                     PARM *BLANKS   @RTCD   7                       S01510
675300200610     C                     PARM '*VERIFY' @OPTN   7                       S01510
675400200610     C                     PARM 'S01510'  @SARD   6                       S01510
675500200610     C*                                                                   S01510
675600200610     C           @RTCD     IFEQ *BLANK                                    S01510
675700200610     C                     MOVE 'Y'       S01510  1                       S01510
675800200610     C                     ELSE                                           S01510
675900200610     C                     MOVE 'N'       S01510                          S01510
676000200610     C                     END                                            S01510
676100200610     C*                                                                   S01512
676200200610     C** Check if Position Settlements is installed                       S01512
676300200610     C*                                                                   S01512
676400200610     C                     CALL 'AOSARDR0'                                S01512
676500200610     C                     PARM *BLANKS   @RTCD   7                       S01512
676600200610     C                     PARM '*VERIFY' @OPTN   7                       S01512
676700200610     C                     PARM 'S01512'  @SARD   6                       S01512
676800200610     C*                                                                   S01512
676900200610     C           @RTCD     IFEQ *BLANK                                    S01512
677000200610     C                     MOVE 'Y'       S01512  1                       S01512
677100200610     C                     ELSE                                           S01512
677200200610     C                     MOVE 'N'       S01512                          S01512
677300200610     C                     END                                            S01512
677400200610     C*                                                                   CSE023
677500200610     C** Check if CSE023 - Treaty withholding Tax is switched ON          CSE023
677600200610     C*                                                                   CSE023
677700200610     C                     CALL 'AOSARDR0'                                CSE023
677800200610     C                     PARM *BLANKS   @RTCD                           CSE023
677900200610     C                     PARM '*VERIFY' @OPTN                           CSE023
678000200610     C                     PARM 'CSE023'  @SARD   6                       CSE023
678100200610     C*                                                                   CSE023
678200200610     C           @RTCD     IFEQ *BLANK                                    CSE023
678300200610     C                     MOVE 'Y'       CSE023  1                       CSE023
678400200610     C                     ELSE                                           CSE023
678500200610     C                     MOVE 'N'       CSE023                          CSE023
678600200610     C                     END                                            CSE023
678700200610      *                                                                                       CSE035
678800200610      ** Access SAR details file to see if CSE035 is installed                                CSE035
678900200610      *                                                                                       CSE035
679000200610     C                     CALL 'AOSARDR0'                                                    CSE035
679100200610     C                     PARM *BLANKS   @RTCD                                               CSE035
679200200610     C                     PARM '*VERIFY' @OPTN                                               CSE035
679300200610     C                     PARM 'CSE035'  @SARD                                               CSE035
679400200610      *                                                                                       CSE035
679500200610     C           @RTCD     IFEQ *BLANK                                                        CSE035
679600200610     C                     MOVE 'Y'       CSE035  1                                           CSE035
679700200610     C                     ELSE                                                               CSE035
679800200610     C                     MOVE 'N'       CSE035                                              CSE035
679900200610     C                     ENDIF                                                              CSE035
680000200610      *                                                                                       CSE035
680100200610      *                                                                   S01447
680200200610     C/COPY WNCPYSRC,SE2370C023
680300200610      *                                                                   S01447
680400200610      ***  Define like field definitions for withholding tax              S01447
680500200610      *                                                                   S01447
680600200610     C           *LIKE     DEFN S1RASO    UTXRSR           src tax rate   S01447
680700200610     C           *LIKE     DEFN TBRASR    UTXRRF           ref tax rate   S01447
680800200610     C           *LIKE     DEFN TBRAUS    UTXRUS           usr tax rate   S01447
680900200610     C*
681000200610     C*                                                                   S01486
681100200610     C**  Check if S01486 is installed.                                   S01486
681200200610     C*                                                                   S01486
681300200610     C                     CALL 'AOMMODR0'                                S01486
681400200610     C                     PARM '*DBERR'  RTCD    7                       S01486
681500200610     C                     PARM '*FIRST ' @OPTN   7                       S01486
681600200610     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
681700200610     C*                                                                   CAC002
681800200610     C**  Access Securities Trading details                               CAC002
681900200610     C*                                                                   CAC002
682000200610     C                     CALL 'AOSTRDR0'                                CAC002
682100200610     C                     PARM '*MSG   ' @RTCD                           CAC002
682200200610     C                     PARM '*FIRST ' @OPTN                           CAC002
682300200610     C           SDSTRD    PARM SDSTRD    DSSDY                           CAC002
682400200610     C*                                                                   CAC002
682500200610     C           @RTCD     IFNE *BLANKS                                   CAC002
682600200610     C           *LOCK     IN   LDA                                       CAC002
682700200610     C                     Z-ADD27        DBASE            ************   CAC002
682800200610     C                     MOVEL'SDSTRDPD'DBFILE           * DBERR 27 *   CAC002
682900200610     C                     MOVEL@OPTN     DBKEY            ************   CAC002
683000200610     C                     SETON                     U7U899               CAC002
683100200610     C                     DUMP                                           CAC002
683200200610     C                     ENDIF                                          CAC002
683300200610     C*                                                                   S01408
683400200610     C/COPY WNCPYSRC,SE2370CCP1                                           S01408
683500200610     C*                                                                   S01408
683600200610      ** Check if CSE075 feature is installed                                                 CSE075
683700200610      *                                                                                       CSE075
683800200610     C                     CALL 'AOSARDR0'                                                    CSE075
683900200610     C                     PARM *BLANKS   PRTCD   7                                           CSE075
684000200610     C                     PARM '*VERIFY' POPTN   7                                           CSE075
684100200610     C                     PARM 'CSE075'  PSARD   6                                           CSE075
684200200610      *                                                                                       CSE075
684300200610     C           PRTCD     IFNE *BLANKS                                                       CSE075
684400200610     C           PRTCD     ANDNE'*NRF   '                                                     CSE075
684500200610     C           *LOCK     IN   LDA                                                           CSE075
684600200610     C                     MOVEL'SCSARDPD'DBFILE                                              CSE075
684700200610     C                     MOVEL'CSE075 ' DBKEY                                               CSE075
684800200610     C                     Z-ADD29        DBASE                                               CSE075
684900200610     C                     OUT  LDA                                                           CSE075
685000200610     C                     MOVE *ON       *INU7                                               CSE075
685100200610     C                     MOVE *ON       *INU8                                               CSE075
685200200610     C                     MOVE *ON       *INLR                                               CSE075
685300200610     C                     EXSR *PSSR                                                         CSE075
685400200610     C                     ENDIF                                                              CSE075
685500200610      *                                                                                       CSE075
685600200610     C           PRTCD     IFEQ *BLANKS                                                       CSE075
685700200610     C                     MOVE 'Y'       CSE075  1                                           CSE075
685800200610     C                     ELSE                                                               CSE075
685900200610     C                     MOVE 'N'       CSE075                                              CSE075
686000200610     C                     ENDIF                                                              CSE075
686100200610      *                                                                                       CSE075
686200200610     C*                                                                   S01486
686300200610     C** Check if EMU Settlement Ccy switchable feature is installed      CEU005
686400200610     C*                                                                   CEU005
686500200610     C                     CALL 'AOSARDR0'                                CEU005
686600200610     C                     PARM *BLANKS   @RTCD   7                       CEU005
686700200610     C                     PARM '*VERIFY' @OPTN   7                       CEU005
686800200610     C                     PARM 'CEU005'  @SARD   6                       CEU005
686900200610     C*                                                                   CEU005
687000200610     C           @RTCD     IFEQ *BLANK                                    CEU005
687100200610     C                     MOVE 'Y'       CEU005  1                       CEU005
687200200610     C                     ELSE                                           CEU005
687300200610     C                     MOVE 'N'       CEU005                          CEU005
687400200610     C                     END                                            CEU005
687500200610     C*                                                                   CEU005
687600200610      ** Check if CSE028 feature is installed                                                 CSE028
687700200610      *                                                                                       CSE028
687800200610     C                     MOVE 'N'       CSE028  1                                           CSE028
687900200610     C                     CALL 'AOSARDR0'                                                    CSE028
688000200610     C                     PARM *BLANKS   @RTCD                                               CSE028
688100200610     C                     PARM '*VERIFY' @OPTN                                               CSE028
688200200610     C                     PARM 'CSE028'  @SARD                                               CSE028
688300200610      *                                                                                       CSE028
688400200610     C           @RTCD     IFNE *BLANKS                                                       CSE028
688500200610     C           @RTCD     ANDNE'*NRF   '                                                     CSE028
688600200610     C           *LOCK     IN   LDA                                                           CSE028
688700200610     C                     MOVEL@SARD     DBKEY                                               CSE028
688800200610     C                     MOVEL'SCSARDPD'DBFILE                                              CSE028
688900200610     C                     Z-ADD28        DBASE                                               CSE028
689000200610     C                     OUT  LDA                                                           CSE028
689100200610     C                     MOVE *ON       *INU7                                               CSE028
689200200610     C                     MOVE *ON       *INU8                                               CSE028
689300200610     C                     MOVE *ON       *INLR                                               CSE028
689400200610     C                     EXSR *PSSR                                                         CSE028
689500200610     C                     ENDIF                                                              CSE028
689600200610      *                                                                                       CSE028
689700200610     C           @RTCD     IFEQ *BLANKS                                                       CSE028
689800200610     C                     MOVE 'Y'       CSE028                                              CSE028
689900200610     C                     ENDIF                                                              CSE028
690000200610      *                                                                                       CSE028
690100200610      ** Check if CER049 - Stamp Tax is switch on                                           AR853119
690200200610      *                                                                                     AR853119
690300200610     C                     CALL 'AOSARDR0'                                                  AR853119
690400200610     C                     PARM *BLANKS   @RTCD                                             AR853119
690500200610     C                     PARM '*VERIFY' @OPTN                                             AR853119
690600200610     C                     PARM 'CER049'  @SARD                                             AR853119
690700200610      *                                                                                     AR853119
690800200610     C           @RTCD     IFEQ *BLANK                                                      AR853119
690900200610     C                     MOVE 'Y'       CER049  1                                         AR853119
691000200610     C                     ELSE                                                             AR853119
691100200610     C                     MOVE 'N'       CER049                                            AR853119
691200200610     C                     ENDIF                                                            AR853119
691300200610      *                                                                                     AR853119
691400200610      ***  Access bank details                                                              AR853119
691500200610      *                                                                                     AR853119
691600200610     C                     CALL 'AOBANKR0'                                                  AR853119
691700200610     C                     PARM *BLANKS   @RTCD                                             AR853119
691800200610     C                     PARM '*FIRST  '@OPTN                                             AR853119
691900200610     C           SDBANK    PARM SDBANK    DSFDY                                             AR853119
692000200610      *                                                                                     AR853119
692100200610     C           @RTCD     IFNE *BLANK                                                      AR853119
692200200610     C           *LOCK     IN   LDA                                                         AR853119
692300200610     C                     Z-ADD29        DBASE                                             AR853119
692400200610     C                     MOVE *BLANKS   DBFILE                                            AR853119
692500200610     C                     MOVEL'SDBANKPD'DBFILE    P                                       AR853119
692600200610     C                     MOVEL'*FIRST  'DBKEY     P                                       AR853119
692700200610     C                     MOVEL'SE2370'  DBPGM     P                                       AR853119
692800200610     C                     OUT  LDA                                                         AR853119
692900200610     C                     EXSR *PSSR                                                       AR853119
693000200610     C                     ENDIF                                                            AR853119
693100200610      *                                                                                     AR853119
693200200610      ** Check if S01496 - Private Banking Securities Trading Enhancements                    248184
693300200610      *                                                                                       248184
693400200610     C                     CALL 'AOSARDR0'                                                    248184
693500200610     C                     PARM *BLANKS   @RTCD                                               248184
693600200610     C                     PARM '*VERIFY' @OPTN                                               248184
693700200610     C                     PARM 'S01496'  @SARD                                               248184
693800200610      *                                                                                       248184
693900200610     C           @RTCD     IFEQ *BLANK                                                        248184
694000200610     C                     MOVE 'Y'       S01496  1                                           248184
694100200610     C                     ELSE                                                               248184
694200200610     C                     MOVE 'N'       S01496                                              248184
694300200610     C                     END                                                                248184
694400200610      *                                                                                       248184
694500200610     C                     ENDSR
694600200610      *****************************************************************                     AR853119
694700200610      /EJECT                                                                                AR853119
694800200610      *****************************************************************                     AR853119
694900200610      *                                                               *                     AR853119
695000200610      * SRPOST - Create Position Settlement extension                 *                     AR853119
695100200610      *                                                               *                     AR853119
695200200610      *****************************************************************                     AR853119
695300200610     C           SRPOST    BEGSR                                                            AR853119
695400200610      *                                                                                     AR853119
695500200610     C                     MOVE *BLANK    WSTAX   1                                         AR853119
695600200610     C                     MOVE *BLANK    WCTAX   1                                         AR853119
695700200610     C                     Z-ADD0         P3STAF                                            AR853119
695800200610     C                     MOVELBJRDNB    P3CDTE                                            AR853119
695900200610     C                     MOVE 'N'       P3TAX                                             AR853119
696000200610     C                     MOVELPBCA      P3PBCA                                            AR853119
696100200610     C                     MOVELPSSH      P3PSSH                                            AR853119
696200200610     C                     MOVELPCPY      P3PCPY                                            AR853119
696300200610     C                     MOVELPDUD      P3PDUD                                            AR853119
696400200610     C                     MOVELPEVT      P3PEVT                                            AR853119
696500200610      *                                                                                     AR853119
696600200610     C                     CALL 'AOBRCHR2'                                                  AR853119
696700200610     C                     PARM *BLANKS   @RTCD                                             AR853119
696800200610     C                     PARM '*KEY   ' @OPTN                                             AR853119
696900200610     C                     PARM PBCA      @DSNB   3                                         AR853119
697000200610     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR853119
697100200610     C           @RTCD     IFEQ *BLANKS                                                     AR853119
697200200610     C                     MOVE BXTAX     WSTAX                                             AR853119
697300200610     C                     ENDIF                                                            AR853119
697400200610      *                                                                                     AR853119
697500200610     C           PCPY      CHAINSDCUSQL0             99                                     AR853119
697600200610     C           *IN99     IFEQ '0'                                                         AR853119
697700200610     C                     MOVE CQTAX     WCTAX                                             AR853119
697800200610     C                     ENDIF                                                            AR853119
697900200610      *                                                                                     AR853119
698000200610      ** Calculate Stamp tax                                                                AR853119
698100200610      *                                                                                     AR853119
698200200610     C           WSTAX     IFEQ 'Y'                                                         AR853119
698300200610     C           WCTAX     ANDEQ'Y'                                                         AR853119
698400200610     C                     MOVE 'Y'       P3TAX                                             AR853119
698500200610     C                     ENDIF                                                            AR853119
698600200610      *                                                                                     AR853119
698700200610      *                                                                                     AR853119
698800200610     C                     WRITEPOSETDD3                                                    AR853119
698900200610      *                                                                                     AR853119
699000200610     C                     ENDSR                                                            AR853119
699100200610      *
699200200610      *****************************************************************
699201200616      /EJECT                                                                                AR324886
699202200616      *****************************************************************                     AR324886
699203200616     C           PSAUDT    BEGSR                                                            AR324886
699204200616      *                                                                                     AR324886
699205200616     C                     MOVE RECI      PARECI                                            AR324886
699206200616     C                     MOVE PBCA      PAPBCA                                            AR324886
699207200616     C                     MOVE PSSH      PAPSSH                                            AR324886
699208200616     C                     MOVE PCPY      PAPCPY                                            AR324886
699209200616     C                     MOVE PDUD      PAPDUD                                            AR324886
699210200616     C                     MOVE PEVT      PAPEVT                                            AR324886
699211200616     C                     MOVE PTFR      PAPTFR                                            AR324886
699212200616     C                     MOVE TNLU      PATNLU                                            AR324886
699213200616     C                     MOVE TXBS      PATXBS                                            AR324886
699214200616     C                     MOVE BNFO      PABNFO                                            AR324886
699215200616     C                     MOVE EXCD      PAEXCD                                            AR324886
699216200616     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
699217200616     C                     MOVE LCD       PALCD                                             AR324886
699218200616     C                     MOVE CHTP      PALCTP                                            AR324886
699219200616     C                     WRITEPSAUTDF                                                     AR324886
699220200616      *                                                                                     AR324886
699221200616     C                     ENDSR                                                            AR324886
699222200616      *****************************************************************                     AR324886
699300200610      /EJECT                                                              S01117
699400200610      *****************************************************************   S01117
699500200610      *                                                               *   S01117
699600200610      *  *PSSR  - Error control subroutine                            *   S01117
699700200610      *                                                               *   S01117
699800200610      *****************************************************************   S01117
699900200610      *                                                                   S01117
700000200610     C           *PSSR     BEGSR                           ** *PSSR **    S01117
700100200610     C**                                                                  S01117
700200200610     C           @RUN      IFEQ *BLANKS                                   S01117
700300200610     C                     SETON                       U7U8               236842
700400200610     C                     MOVE 'Y'       @RUN    1                       S01117
700500200610     C                     DUMP                                           S01117
700600200610     C                     END                                            S01117
700700200610     C**                                                                  S01117
700800200610     C                     ENDSR                                          S01117
700900200610      *                                                                   S01117
701000200610     C*****************************************************************
701100200610     C******************************************************************* S01486
701200200610     C**  ZTNLU1     :       TO LOCK THE TRANSACTION NUMBER DATA AREA,    S01486
701300200610     C**                     ACCESS THE NEXT AVAILABLE TRANSACTION NUMBER,S01486
701400200610     C**                     THEN UPDATE AND RELEASE THE DATA AREA.       S01486
701500200610     C********************************************************************S01486
701600200610     C           ZTNLU1    BEGSR                            ** ZTNLU1 BSR*S01486
701700200610     C*                                                                   S01486
701800200610     C           *NAMVAR   DEFN MNATN     DNATN                           S01486
701900200610     C           *LOCK     IN   DNATN                                     S01486
702000200610     C                     MOVE FNATN     NATN    50                      S01486
702100200610     C                     MOVE FNATN     ZZWK05  50                      S01486
702200200610     C                     ADD  1         ZZWK05                          S01486
702300200610     C                     MOVE ZZWK05    FNATN                           S01486
702400200610     C                     OUT  DNATN                                     S01486
702500200610     C*                                                                   S01486
702600200610     C                     ENDSR                            ** ZTNLU1 ESR*S01486
702700200610     C********************************************************************S01486
702800200610     C/EJECT                                                              E29170
702900200610     C********************************************************************E29170
703000200610     C*                                                                   E29170
703100200610     C*  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          E29170
703200200610     C*                                                                   E29170
703300200610     C********************************************************************E29170
703400200610     C*                                                                   E29170
703500200610     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
703600200610     C*                                                                   E29170
703700200610     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
703800200610     C*                                                                   E29170
703900200610     C                     Z-ADDSFNUM     ZSNUM   60                      E29170
704000200610     C**                                                                  E29170
704100200610     C                     CALL 'ZSFILE'                                  E29170
704200200610     C                     PARM           SEQ     5                       E29170
704300200610     C                     PARM WBC       SENTY   3                       E29170
704400200610     C                     PARM           SFILE                           E29170
704500200610     C                     PARM           ZSNUM                           E29170
704600200610     C                     PARM           ZSERR   1                       E29170
704700200610     C*                                                                   E29170
704800200610     C           ZSERR     IFEQ 'Y'                                       E29170
704900200610     C*                                                                   E29170
705000200610     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
705100200610     C*                                                                   E29170
705200200610     C                     SETON                     U7U8LR               E29170
705300200610     C                     RETRN                                          E29170
705400200610     C                     END                                            E29170
705500200610     C*                                                                   E29170
705600200610     C                     ENDSR                                          E29170
705700200610     C*                                                                   E29170
705800200610     C********************************************************************E29170
705900200610     C/EJECT                                                              E29170
706000200610     C********************************************************************E29170
706100200610     C*                                                                   E29170
706200200610     C*  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          E29170
706300200610     C*                                                                   E29170
706400200610     C********************************************************************E29170
706500200610     C*                                                                   E29170
706600200610     C           RCFAU     BEGSR                            ** RCFAU **   E29170
706700200610     C*                                                                   E29170
706800200610     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
706900200610     C*                                                                   E29170
707000200610     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
707100200610     C**                                                                  E29170
707200200610     C                     CALL 'ZSFILE'                                  E29170
707300200610     C                     PARM           SEQ                             E29170
707400200610     C                     PARM *BLANKS   SENTY                           E29170
707500200610     C                     PARM           SFILEU                          E29170
707600200610     C                     PARM           ZSNUMU                          E29170
707700200610     C                     PARM           ZSERR                           E29170
707800200610     C*                                                                   E29170
707900200610     C           ZSERR     IFEQ 'Y'                                       E29170
708000200610     C*                                                                   E29170
708100200610     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
708200200610     C*                                                                   E29170
708300200610     C                     SETON                     U7U8LR               E29170
708400200610     C                     RETRN                                          E29170
708500200610     C                     END                                            E29170
708600200610     C*                                                                   E29170
708700200610     C                     ENDSR                                          E29170
708800200610     C*                                                                   E29170
708900200610     C********************************************************************E29170
709000200610     C/COPY WNCPYSRC,SE2370C012
709100200610      /EJECT                                                              S01512
709200200610     C/COPY ZSRSRC,ZACCH                                                  S01512
709300200610      /EJECT                                                              E20972
709400200610     C/COPY ZSRSRC,ZCNSDZ1                                                E20972
709500200610      /EJECT                                                              S01509
709600200610     C/COPY ZSRSRC,ZCONVZ1                                                S01509
709700200610      /EJECT
709800200610     C/COPY ZSRSRC,ZDATE2Z4
709900200610      /EJECT
710000200610     C/COPY ZSRSRC,ZDATE1Z2                                               E29307
710100200610      /EJECT                                                              S01512
710200200610     C/COPY ZSRSRC,ZFWDT                                                  S01512
710300200610      /EJECT
710400200610     C/COPY ZSRSRC,ZLCDZ1                                                 E29307
710500200610      /EJECT
710600200610     C/COPY ZSRSRC,ZHASHZ3
710700200610      /EJECT
710800200610     C/COPY ZSRSRC,ZICD2Z1
710900200610      /EJECT
711000200610     C/COPY ZSRSRC,ZICDSEZ1
711100200610      /EJECT
711200200610     C/COPY ZSRSRC,ZSDESCZ3
711300200610      /EJECT
711400200610     C/COPY ZSRSRC,ZSEDITZ3
711500200610      /EJECT
711600200610     C/COPY ZSRSRC,ZSYSTMZ1
711700200610      **********/EJECT                                                    E23169
711800200610     C**********/COPY ZSRSRC,ZXRATEZ1                                     E23169
711900200610      /EJECT
712000200610      ***
712100200610     C/COPY WNCPYSRC,SE2370C024
712200200610**  CPY@
712300200610(c) Finastra International Limited 2001
712400200610**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
71250020061000000001
71260020061000000010
71270020061000000100
71280020061000001000
71290020061000010000
71300020061000100000
71310020061001000000
71320020061010000000
713300200610**  POWER - Array of powers for currency conversion
7134002006100000001
7135002006100000010
7136002006100000100
7137002006100001000
7138002006100010000
7139002006100100000
7140002006101000000
714100200610**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
7142002006100366073110961461
714300200610**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
714400200610000031059090120151181212243273304334365
714500200610**   ZMNM - MONTHS SHORT NAMES
714600200610JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
