000100200610     H        1
000200200610     F*****************************************************************
000300200610/*STD *  RPGBASE                                                      *
000400200610/*EXI *  TEXT('Midas SE Update customer posns and gen a/c keys')      *
000500200610/*OVRF*: OVRDBF FILE(PMBVALP1) TOFILE(PMBVALPD) SHARE(*NO)          : *   S01486
000600200610/*OVRF*: OVRDBF FILE(SECET) SHARE(*NO)                              : *   S01486
000700200610/*OVRF*: OVRDBF FILE(CPOSHI) TOFILE(CPOSH) SHARE(*NO)               : *
000800200610/*OVRF*: OVRDBF FILE(SECEDI) TOFILE(SECED) SHARE(*NO)               : *   S01486
000900200610     F*****************************************************************
001000200610     F*                                                               *
001100200610     F*  Midas - Securities Trading Module                            *
001200200610     F*                                                               *
001300200610     F*  SE2380  - UPDATE CUST. POSITIONS & GEN ACC.KEYS/POSN SETTLNT *
001400200610     F*                                                               *
001500200610     F*  FUNCTION: This program reads LF/CSPAC which is based on:     *
001600200610     F*   (COB)    PF/TRDACD - Movement of Stock on Trades involving  *
001700200610     F*            Portfolio Customers; PF/SETACD - when that Stock is*
001800200610     F*            Settled and PF/CDPMVD - ad hoc changes to Customer *
001900200610     F*            Positions due to Trade Amendments/Depot Movements. *
002000200610     F*            The files are read in Branch/Security/Customer/Date*
002100200610     F*            sequence and used to update COB Positions (Trade,  *
002200200610     F*            Value and Settled) on PF/CPOSND. The last Position *
002300200610     F*            has RECI = 'D'; all prior Positions have RECI ='H'.*
002400200610     F*             Also checks for Diary and Non-Diary Event Types   *
002500200610     F*            DV, PP, MP and CP where Event Date is between Posn *
002600200610     F*            Dates on LF/CSPAC and not due today, then if the   *
002700200610     F*            movement of Stock affects the Cum-Coupon Nominal,  *
002800200610     F*            the Position Settlement for those Events would have*
002900200610     F*            been on the 'wrong' Position. A Position Settlement*
003000200610     F*            record is thus written to PF/POSETD for the Branch,*
003100200610     F*            Customer and Security for the change in Position   *
003200200610     F*            due to the backvalued movement of Stock.           *
003300200610     F*            Account keys for the Amounts due are also generated*
003400200610     F*            (used to post contingent liability entries for the *
003500200610     F*            Settlement).                                       *
003600200610     F*                                                               *
003700200610     F*  Called By: SEC0606D - Update Customer Positions              *
003800200610     F*                                                               *
003900200610     F*  Calls: ZACCRC - Calculate Interest - Customer Positions      *
004000200610     F*                                                               *
004100200610      *  (c) Finastra International Limited 2001                      *
004200200610      *                                                               *
004201200616      *  Last Amend No. AR324886           Date 01JUN20               *
004300200616      *  PREV Amend No. 248698             Date 01Jun20               *
004400200616      *                 248184             Date 01Jun20               *
004500200610      *                 263929             Date 01Jun20               *
004600200610      *                 MD046248           Date 27Oct17               *
004700200610      *                 260331             Date 31Mar16               *
004800200610      *                 215959             Date 21Mar16               *
004900200610      *                 226449             Date 24Jun15               *
005000200610      *                 AR1067108          Date 11Dec12               *
005100200610      *                 AR1001183A         Date 20Nov12               *
005200200610      *                 CLE148             Date 23Jul12               *
005300200610      *                 AR1001183          Date 14Jul12               *
005400200610      *                 251950A            Date 27Feb12               *
005500200610      *                 AR888911           Date 26Jan12               *
005600200610      *                 AR864714B          Date 28Mar12               *
005700200610      *                 AR875302           Date 09Jan12               *
005800200610      *                 AR879983           Date 21Dec11               *
005900200610      *                 AR853119           Date 24Nov11               *
006000200610      *                 CSW210             Date 04May10               *
006100200610      *                 CER059             Date 19Jul10               *
006200200610      *                 CER043             Date 19May08               *
006300200610      * Bank Fusion Midas 1.4 Base -----------------------------------*
006400200610      * Midas Plus 1.4 Base 04 ---------------------------------------*
006500200610      * Midas Plus 1.4 Base ------------------------------------------*
006600200610      *                 219566             Date 08Feb07               *
006700200610      * Midas Plus 1.3 ----------- Base ------------------------------*
006800200610      *                 233703             Date 19Oct06               *
006900200610      *                 219688             Date 11Oct06               *
007000200610      *                 BUG11104A          Date 14Jun06               *
007100200610      *                 BUG11617           Date 27Jun06               *
007200200610      *                 CSD031             Date 10Apr06               *
007300200610      *                 CSD027             Date 09Dec05               *
007400200610      *                 BUG11272           Date 27Apr06               *
007500200610      *                 BUG11198           Date 26Apr06               *
007600200610      *                 BUG11104           Date 25Apr06               *
007700200610      *                 CGL031             Date 05Jul04               *
007800200610      *                 CSE071             Date 19Jul05               *
007900200610      *                 CLE025             Date 20Oct03               *
008000200610      *                 CGL029             Date 01Sep03               *
008100200610      *                 194370             Date 12Jul01               *
008200200610      *                 211407             Date 09Nov02               *
008300200610      *                 208241             Date 21Aug02               *
008400200610      *                 180056             Date 18Oct00               *
008500200610      *                 CSE037             Date 29Apr02               *
008600200610      *                 CSE035             Date 22Apr02               *
008700200610      *                 CGL020             Date 12Dec02               *
008800200610      *                 206316             Date 19Jul02               *
008900200610      * Midas Release 4.01.02 ----------------------------------------*
009000200610      *                 206040             Date 09Oct02               *
009100200610      *                 192467             Date 26Jul01               *
009200200610      *                 194195             Date 15Apr02               *
009300200610      * Midas Release 4.01 -------------------------------------------*
009400200610      *                 CSE034             Date 18Apr02               *
009500200610      *                 CSE031             Date 09Nov01               *
009600200610      *                 180707             Date 25Jul00               *
009700200610      *                 136297             Date 07Feb02               *
009800200610      *                 157260             Date 28Sep01               *
009900200610      * Midas Release 4 --------------- Base -------------------------*
010000200610      *                 CSE028             Date 06Jun01               *
010100200610      *                 CSE026             Date 17Jan01               *
010200200610      *                 171874             Date 26Jun01               *
010300200610      *                 173976             Date 22Jun01               *
010400200610      *                 174703             Date 12Jun01               *
010500200610      *                 CSE026             Date 17Jan01               *
010600200610      *                 127566             Date 09May01               *
010700200610      * Midas DBA 3.05 -----------------------------------------------*
010800200610      *                 CPB002             Date 13Feb01               *
010900200610      * Midas DBA 3.04 -----------------------------------------------*
011000200610      *                 CSE023             Date 31Aug00               *
011100200610      * Midas DBA 3.03 -----------------------------------------------*
011200200610     F*                 175400             Date 05Jun00               *
011300200610     F*                 162208             Date 04May00               *
011400200610     F*                 131379             Date 27MAR00               *  *
011500200610      * Midas DBA 3.02 -----------------------------------------------*
011600200610      *                 CSE017             Date 25Oct99               *
011700200610      * Midas DBA 3.00 ---------------- Base -------------------------*
011800200610      *                 130862             Date 18Oct98               *
011900200610      *                 151945             Date 06Jan99               *
012000200610     F*                 147514             Date 20Nov98               *
012100200610     F*                 147869             Date 19NOV98               *
012200200610     F*                 143690             Date 05Oct98               *
012300200610     F*                 CEU017             Date 07Apr98               *
012400200610     F*                 CSE007             Date 17Mar98               *
012500200610     F*                 CEU005             DATE 05FEB98               *  *
012600200610     F*                 095066             DATE 19FEB98               *  *
012700200610     F*                 114458             DATE 03FEB98               *  *
012800200610     F*                 CSE005             DATE 04FEB97               *  *
012900200610     F*                 CAC002             Date 15Sep96               *
013000200610     F*                 S01408             Date 02Sep96               *  *
013100200610     F*                 081366             Date 12Aug96               *
013200200610     F*                 100024             Date 24Jul96               *
013300200610     F*                 095033             DATE 15JUL96               *
013400200610     F*                 104632             DATE 17JUN96               *
013500200610     F*                 064754             DATE 29MAY96               *
013600200610     F*                 074380             DATE 28MAY96               *
013700200610     F*                 103361             DATE 28MAY96               *
013800200610     F*                 103017             DATE 09MAY96               *
013900200610     F*                 103011             DATE 09MAY96               *
014000200610     F*                 046500             DATE 02MAY96               *
014100200610     F*                 053999             DATE 02MAY96               *
014200200610     F*                 038963             DATE 01MAY96               *
014300200610     F*                 033988             DATE 01MAY96               *
014400200610     F*                 100017             DATE 18APR96               *
014500200610     F*                 092961             DATE 04OCT95               *
014600200610     F*                 094403             DATE 11OCT95               *
014700200610     F*                 091254             DATE 20OCT95               *
014800200610     F*                 094229             DATE 06OCT95               *
014900200610     F*                 094225             DATE 06OCT95               *
015000200610     F*                 088423             DATE 16JUN95               *
015100200610     F*                 086491             DATE 15JUN95               *
015200200610     F*                 087712             DATE 15JUN95               *
015300200610     F*                 087178             DATE 15JUN95               *
015400200610     F*                 084669             DATE 06JUN95               *
015500200610     F*                 082248             DATE 27JAN95               *
015600200610     F*                 081239             DATE 01FEB95               *
015700200610     F*                 081439             DATE 10JAN95               *
015800200610     F*                 081363             DATE 09JAN95               *
015900200610     F*                 S01486             DATE 22NOV94               *
016000200610     F*                 S01496  JSV        DATE 07OCT94               *
016100200610     F*                 S01446             DATE 28OCT94               *
016200200610     F*                 S01519             DATE 10AUG94               *
016300200610     F*                 S01512             DATE 10AUG94               *
016400200610     F*                 S01510             DATE 10AUG94               *
016500200610     F*                 S01509             DATE 10AUG94               *
016600200610     F*                 065301             DATE 06MAY94               *
016700200610     F*                 066777             DATE 26FEB94               *
016800200610     F*                 048612             DATE 08FEB94               *
016900200610     F*                 S01447             DATE 08NOV93               *
017000200610     F*                 054257             DATE 26NOV93               *
017100200610     F*                 052254             DATE 26NOV93               *
017200200610     F*                 051107             DATE 26NOV93               *
017300200610     F*                 S01401             DATE 16JUN93               *
017400200610     F*                 S01397             DATE 10SEP92               *
017500200610     F*                 E37297             DATE 24MAR92               *
017600200610     F*                 E33032             DATE 10DEC91               *
017700200610     F*                 E29170             DATE 07NOV91               *
017800200610     F*                 E29307             DATE 09OCT91               *
017900200610     F*                 S01117             DATE 28MAY91               *
018000200610     F*                 E24421             DATE 23JAN91               *
018100200610     F*                 S01269             DATE 19JUN90               *
018200200610     F*                 E23169             DATE 02OCT90               *
018300200610     F*                 E22638             DATE 31JUL90               *
018400200610     F*                 E21573             DATE 26JUN90               *
018500200610     F*                 E21669             DATE 20JUN90               *
018600200610     F*                 E21430             DATE 19MAR90               *
018700200610     F*                 E21303             DATE 06MAR90               *
018800200610     F*                 E20651             DATE 30JAN90               *
018900200610     F*                 E19610             DATE 07DEC89               *
019000200610     F*                 E20568             DATE 09DEC89               *
019100200610     F*                 E20394             DATE 24NOV89               *
019200200610     F*                 E19403             DATE 23NOV89               *
019300200610     F*                 E20151             DATE 10NOV89               *
019400200610     F*                 E20086             DATE 07NOV89               *
019500200610     F*                 E16085             DATE 25AUG89               *
019600200610     F*                 E18803             DATE 17AUG89               *
019700200610     F*                 E18221             DATE 15AUG89               *
019800200610     F*                 E18014             DATE 20JUL89               *
019900200610     F*                 E16772             DATE 31/05/89              *
020000200610     F*                 E15426             DATE 03/11/88              *
020100200610     F*                 E15549             DATE 29/09/88              *
020200200610     F*                 E14704             DATE 29/09/88              *
020300200610     F*                 E15035             DATE 20/09/88              *
020400200610     Y*                 E14716             DATE 07/09/88              *
020500200610     F*                 E14718             DATE 17/08/88              *
020600200610     F*                 E14522             DATE 08/08/88              *
020700200610     F*                 E14438             DATE 27/07/88              *
020800200610     F*                 E13561             DATE 20/06/88              *
020900200610     F*                                                               *
021000200610     F*---------------------------------------------------------------*
021100200610     F*                                                               *
021101200616      *  AR324886 - Implement 4-eyes processing in Position           *
021102200616      *             Settlement Maintenance.                           *
021200200610      *  248698 - Rounding discrepancies on some SE reports. Applied  *
021300200610      *           fix 228682.                                         *
021400200610      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
021500200610      *  248184 - Wrong security withholding tax calculation.  If     *
021600200610      *           S01496, use 4 dec places for tax rate else use 2.   *
021700200610      *  263929 - Maturity position settlement with 0 nominal         *
021800200610      *           position and 0 amount due was generated.            *
021900200610      *           Applied fix of 238137. Does not include reopen fix. *
022000200610      *           Check if Amount Due is zero for none-generation of  *
022100200610      *           record.                                             *
022200200610      *           Do not write maturity position settlement for PM    *
022300200610      *           customer having a position of zero.                 *
022400200610      *  MD046248 - Finastra Rebranding                               *
022500200610      *  260331 - Incorrect posting created due to a deleted diary    *
022600200610      *           event. Applied fix 255857.                          *
022700200610      *         - Applied for MD-37742.                               *
022800200610      *  215959 - Truncation error on event amount in SE2450P3.       *
022900200610      *           Recompiled due to changes in PF/SEKEYD.             *
023000200610      *         - Applied for MD-37439.                               *
023100200610      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
023200200610      *         - Applied for MD034387.                               *
023300200610      *  AR1067108 - PMC1140 Component failed during Clean COB        *
023400200610      *              Applied fix AR1001183A                           *
023500200610      *  AR1001183A - Coupon rate was still used in computation of    *
023600200610      *              interest instead of using the details in FRN tab *
023700200610      *              (Reopen)                                        *
023800200610      *  CLE148 - Alpha Loan Reference (Recompile)                    *
023900200610      *  AR1001183 - Coupon rate was still used in computation of     *
024000200610      *              interest instead of using the details in FRN tab *
024100200610      *  251950A - Component SEC1112 0001 terminated abnormally.      *
024200200610      *            Check if PSEB is blank, if it is move value of     *
024300200610      *            PBCA to CCTA, if not move value of PSEB to CCTA.   *
024400200610      *          - Applied for AR964313 (Child:AR964316)              *
024500200610      *  AR888911 - In reversing a deal, REV column in Stamp Tax      *
024600200610      *             Movements Enquiry is not changing from N to Y     *
024700200610      *             (Recompile)                                       *
024800200610      *           - Applied for AR944923                              *
024900200610      *  AR864714B - No movement is posted in Stamp Tax Movement      *
025000200610      *              enquiry for Position Settlements                 *
025100200610      *            - Applied for AR942839                             *
025200200610      *  AR875302 - Position settlement generated calculates Stamp    *
025300200610      *             Tax even when it is not stamp tax liable          *
025400200610      *  AR879983 - Add stamp tax exchange rate (Recompile)           *
025500200610      *  AR853119 - Position settlements generated from corporate     *
025600200610      *             action did not calculate stamp tax.               *
025700200610      *  CSW210 - SWIFT 2010 Changes                                  *
025800200610      *  CER059 - German Feature Upgrade to Delhi                     *
025900200610      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
026000200610      *           (Recompile)                                         *
026100200610      *  219566 - Default the settlement account if no account for    *
026200200610      *           the specified portfolio. This is a LUX local fix    *
026300200610      *           so conditioned in core using new system value       *
026400200610      *           "UseDefaultSettAccnt" in SDSVALPD.                  *
026500200610      *  233703 - CSAV and CSAT not renamed on CPOSHI                 *
026600200610      *  219688 - Settlement account not correctly retrieved          *
026700200610      *           If the customer is a portfolio one, access first    *
026800200610      *           with the account code defined as settlement in      *
026900200610      *           SDSECSPD. If not found use the PMACCNL0 account.    *
027000200610      *  BUG11104A - Customer position do not balance. Applied        *
027100200610      *              169173, 177328.                                  *
027200200610      *  BUG11617 - SEC0606D 00001 failed, I/O error on SECET         *
027300200610      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
027400200610      *  CSD027 - Conversion Of Customer Number to Alpha              *
027500200610      *  BUG11272 - Blank settlement branch on position settlement.   *
027600200610      *  BUG11198 - Incorrect due amount on position settlement.      *
027700200610      *  BUG11104 - Customer position do not balance. If ex-coupon    *
027800200610      *             trade was inserted and dividend event has occured *
027900200610      *             reset ex-coupon nominal. Applied 197652.          *
028000200610      *  CGL031 - Taxation of Savings Income.                         *
028100200610      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
028200200610      *  CLE025 - Credit Lines (Recompile)                            *
028300200610      *  CGL029 - Increase Account Code to 10 digits                  *
028400200610      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
028500200610      *           For securities with divisor basis = '5' and first   *
028600200610      *           coupon date > valuation date (rundate + 1), set     *
028700200610      *           event control date to first coupon date before      *
028800200610      *           processing SR/ZDYYR. This is to ensure that the     *
028900200610      *           correct hypothetical last and next coupon dates are *
029000200610      *           used in deriving the price/yield rate.              *
029100200610      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
029200200610      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
029300200610      *           The change was to call subroutine ZLCD1 instead     *
029400200610      *           of ZLCD in retrieving the PERIOD for NNX processing *
029500200610      *           and ZNCD1 is called instead of ZNCD in retrieving   *
029600200610      *           the WBENCD for NNX processing. Also rewrite tests   *
029700200610      *           for identifying if position is NX,NNX or CUM.       *
029800200610      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
029900200610      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
030000200610      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
030100200610      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
030200200610      *  CGL020 - Compliance Watch - Addtl A/C Postings Information   *
030300200610      *  206316 - Recompiled over changed ZLCDZ1.                     *
030400200610      *  206040 - Apply 192099 from SE2400 to SE2380 to avoid         *
030500200610      *           DB error in SDPLCSPD.                               *
030600200610      *  192467 - No maturity position settlement was generated.  Set *
030700200610      *           price for records with processing type '1' and      *
030800200610      *           price basis 'U'.                                    *
030900200610      *  194195 - Position settlements in base ccy incorrect when the *
031000200610      *           nominal ccy is an 'IN' ccy and settled in EUR via   *
031100200610      *           the standard settlement instructions (in STDSED).   *
031200200610      *  CSE034 - Standing Settlement Instruction improvements        *
031300200610      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
031400200610      *           (recompilation due to change to ZNCD/ZLCD)          *
031500200610      *  180707 - No Position Settlements generated. Recompile over   *
031600200610      *           changes in /COPY ZNCDZ3.                            *
031700200610      *  136297 - When settlement method 04 and no settlement account *
031800200610      *           defined, prime account number is defaulted ... If   *
031900200610      *           it does not exist, use suspense computer account    *
032000200610      *  157260 - The system still generate position settlement on    *
032100200610      *           coupon date for securities with cancelled-authorise *
032200200610      *           trade eventhough position is zero. Amended program  *
032300200610      *           in such a way that system would not generate posi-  *
032400200610      *           tion settlement if customer position is zero.       *
032500200610      *  CSE028 - Standing Settlement Instructions Enhancement.       *
032600200610      *  171874 - ZAINSH changes - only recompile                     *
032700200610      *  173976 - When nominal trade or value is equal to zero,       *
032800200610      *           zeroise appropriate numerator in CPOSND.            *
032900200610      *  174703 - Complete 095033 to condition further call to SEPCIN *
033000200610      *  CSE026 - Position Settlement Default Charges by Customer     *
033100200610      *           Group.                                              *
033200200610      *  127566 - Recompiled over changed ZSDESCZ3                    *
033300200610     F*  CPB002 - Meridian DBA Middleware Replication Customization.  *
033400200610      *  CSE023 - Treaty Withholding Tax                              *
033500200610     F*  175400 - Security position settlements not picking up the    *
033600200610     F*           security standard settlements if the securit nominal*
033700200610     F*           currency is an 'in' currency and being settled in   *
033800200610     F*           EURO. Remove fix 147869 and fix it differently since*
033900200610     F*           it caused the above problem. Based on 170568.      *
034000200610     F*  162208 - Amended program to move the Market Indicator of     *
034100200610     F*           the security to PMAR field.                         *
034200200610     F*  131379 - Incorrect account key for primary market at maturity*
034300200610      *  CSE017 - Cum/Ex Indicator on Depot Movements                 *
034400200610     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
034500200610     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
034600200610     F*  147514 - Position settlement preparations are not taking     *
034700200610     F*           into account the Standard Settlement Instructions.  *
034800200610     F*           Apply fix 143851.  Use *IN88 when chaining to file  *
034900200610     F*           STDSED instead of *IN78 which is already in use.    *
035000200610     F*  147869 - Wrong settlement amount on accounting               *
035100200610     F*  143690 - Incorrect Mult/Div Ind. was being used when EURO    *
035200200610     F*           CCY was involved. Fix is to reverse the M/D ind. if *
035300200610     F*           Nominal CCY is equal to the EURO CCY.               *
035400200610     F*  CEU017 - Securities Redenomination Euro Changes              *
035500200610     F*           Just recompile                                      *
035600200610     F*  CSE007 - Corporate Actions - Just recompile                  *
035700200610     F*  CEU005 - EMU SE Settlement Ccy Conversion.                   *
035800200610     F*  095066 - Intro of Switchable feature to use value date       *
035900200610     F*           position to calculate Dividend Payment.             *
036000200610     F*  114458 - DATABASE ERROR IN SDRETLPD.  DO NOT CALL AORETLR0   *
036100200610     F*           IF RETAIL IS NOT SWITCH ON.                         *
036200200610     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
036300200610     F*           (recompilation due to change to ZNCD/ZLCD)          *
036400200610     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
036500200610     F*           If Analytical Accounting is available, define the   *
036600200610     F*           profit centre for posting.                          *
036700200610     F*  S01408 - Addition of hooks SE2380CCP4                        *
036800200610     F*         - Addition of hooks SE2380CCP3                        *
036900200610     F*         - Addition of hooks SE2380CCP2                        *
037000200610     F*         - Addition of hooks SE2380CCP1                        *
037100200610     F*         - Addition of hooks SE2380FFP1                        *
037200200610     F*         - Addition of hooks SE2380IIP2                        *
037300200610     F*         - Addition of hooks SE2380IIP1                        *
037400200610     F*  081366 - Check STDSED for deleted indicator and don't allow  *
037500200610     F*           it to corrupt POSETD record .(JB2998)               *
037600200610     F*           SUBR TR10 removed - not used .(JB2998)              *
037700200610     F*  100024 - Complete fix 094403                                 *
037800200610     F*  095033 - Should only check Profit Centres Position file if   *
037900200610     F*           profit centres are used                             *
038000200610     F*  104632 - Branch code not written to POSETD if the data is    *
038100200610     F*           originating from Portfolio Management.              *
038200200610     F*  064754 - Back-valuation on coupon or dividend event          *
038300200610     F*           do not produce adjustment position settlement       *
038400200610     F*  074380 - No check if AUMO is 'Y' because Position Settle-    *
038500200610     F*           ment with Settlement method '04' are posted on the  *
038600200610     F*           Suspense account.                                   *
038700200610     F*  103361 - If settlement method is '04' and settlement account *
038800200610     F*           is blank, retrieve prime account number.            *
038900200610     F*           (Originally wrongly annotated as 103661)            *
039000200610     F*  103017 - Set RECI to 'D' when writing position settlement rec*
039100200610     F*  103011 - The system creates a position settlement MT* for    *
039200200610     F*           warrant which can lead to confusion for cashflow    *
039300200610     F*  046500 - CORRECT FILE OUT OF BALANCE PROBLEM IN COB          *
039400200610     F*  053999 - SDED RESET TO 0 AFTER ZAINSH SUBROUTINE             *
039500200610     F*  038963 - CSEX MUST BE 0 FOR A SCHULDSCHEIN.                  *
039600200610     F*  033988 - WHEN SECURITY MATURED, RECI ON CPOSND IS WRONGLY    *
039700200610     F*           UPDATED TO 'M'.                                     *
039800200610     F*  100017 - Position settlement unable to pick up day adj. on   *
039900200610     F*           SECTYD. Change subroutine to use DADJN to stop      *
040000200610     F*           interest day adjustment being used for amortisation.*
040100200610     F*           Recompile over amended subroutine ZDAYS.            *
040200200610     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
040300200610     F*           (Wrong number of days calculated for day basis 1    *
040400200610     F*           when start or end day is last day of February)      *
040500200610     F*  094403 - Ex-coupon nominal on positions not always reset when*
040600200610     F*           a position is created that IS EQUAL TO THE COUPON   *
040700200610     F*           DATE.                                               *
040800200610     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
040900200610     F*  094229 - Calculate settlement amount regardless of S01519    *
041000200610     F*  094225 - Dual currency security is picking up the nominal    *
041100200610     F*           currency but should be the value currency           *
041200200610     F*  088423 - If S01512 is on, event date should no longer be     *
041300200610     F*           payment date                                        *
041400200610     F*  086491 - Wrong nbr of days calculated for day basis 1        *
041500200610     F*           when start or end day is last day of February       *
041600200610     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
041700200610     F*  087712 - Percentage price-based shares have dividend amount  *
041800200610     F*           calculated 100 times too much                       *
041900200610     F*  087178 - Settlement amount has to include taxes added to or  *
042000200610     F*           subtracted from it                                  *
042100200610     F*  084669 - If no standard settlement method defined, settlement*
042200200610     F*           branch must be equal to booking branch              *
042300200610     F*  082248 - Incorrect security used on READ operation causing   *
042400200610     F*           incorrect records to be generated on position       *
042500200610     F*           settlements file                                    *
042600200610     F*  081239 - R10 Private Banking Rework                          *
042700200610     F*  081439 - Wrong update of field tax rate - Recompile          *
042800200610     F*  081363 - Branch code must be alpha                           *
042900200610     F*  S01486 - Incorporation of PM Enhancements (S01313)           *
043000200610     F*           (Fix's S01313 - R05803                              *
043100200610     F*  S01496 - Incorporation of Jyske Enhancements (S10982, S10984)*
043200200610     F*           Just recompilation.                                 *
043300200610     F*  S01446 - Customer Commissions (Courtage) enhancement:        *
043400200610     F*           Get details of single charge currency (from SE ICD) *
043500200610     F*           for conversion of charge amount to nominal currency.*
043600200610     F*  S01519 - Position Settlements Automatic Charges              *
043700200610     F*  S01512 - Add value date to Position Settlements              *
043800200610     F*  S01510 - Dividend Payments based on Ex-date                  *
043900200610     F*  S01509 - Value Currency to be currency of Issuer of Payments *
044000200610     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
044100200610     F*           with ZAMT increased to 15,0.                        *
044200200610     F*  066777 - Output Last Change Date on new POSETD records.      *
044300200610     F*  048612 - Clear settlement method field before accessing stan-*
044400200610     F*           dard settlements file so that if no record is found,*
044500200610     F*           the value from a previous transaction is not used.  *
044600200610     F*  S01447 - Withholding Tax.                                    *
044700200610     F*           Calculates withholding tax which are written to     *
044800200610     F*           new fields on position settlements file.            *
044900200610     F*  S01447 - Withholding Tax                                     *
045000200610     F*           Calculates withholding tax which are written to     *
045100200610     F*           new fields on position settlements file.            *
045200200610     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
045300200610     F*           to 10,9                                             *
045400200610     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
045500200610     F*  051107 - Program ignores Events BEFORE first Action Date. It *
045600200610     F*           should ALSO ignore Events ON the first Action Date  *
045700200610     F*           as they will not be affected, (eg. Coupon).         *
045800200610     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
045900200610     F*           - Position Settlement Message Indicator set to 'Y'  *
046000200610     F*             when Settlement Authorised by System.             *
046100200610     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
046200200610     F*           - Recompiled due to changes to files.               *
046300200610     F*  E37297 - Strange problem with zoned decimal parameter        *
046400200610     F*           passed to ZACCR                                     *
046500200610     F*  E33032 - Outputting wrong branch field to POSETD             *
046600200610     F*  E29170 - Report Control Facility changes                     *
046700200610     F*  E29307 - Ex-coupon nominal on positions not always reset when*
046800200610     F*           a position is created that crosses a coupon date    *
046900200610     F*  S01117 - Multi Branching                                     *
047000200610     F*  E24421 - Dividend position settlements sometimes not being   *
047100200610     F*           produced                                            *
047200200610     F*  S01269 - Trade Authorisation                                 *
047300200610     F*  E23169 - Settlement exchange rate should be equal to         *
047400200610     F*           exchange (not spot rate) from SECTYD.               *
047500200610     F*           Changed processing to use ZCNCD for accuracy        *
047600200610     F*  E22638 - Dividend due amount being truncated. Use standard   *
047700200610     F*           subroutine ZCNSD to calculate dividend due.         *
047800200610     F*  E21573 - Coupon at Maturity is now produced separately and   *
047900200610     F*           requires a Position Settlement to be generated from *
048000200610     F*           the Coupon Action.                                  *
048100200610     F*  E21669 - Apply fix from SE2370 - wrong Last Coupon Date      *
048200200610     F*           being passed as a Parameter.                        *
048300200610     F*  E21430 - Must know whether Security is a Share or not so     *
048400200610     F*           must access SECTY and INVTP on change of Security.  *
048500200610     F*  E21303 - For Shares, use Trade Date Ex-Dividend Nominal to   *
048600200610     F*           Update the Positions.                               *
048700200610     F*  E20651 - Incorrect DB ERROR used.                            *
048800200610     F*           DB ERROR 217 -> 17                                  *
048900200610     F*  E19610 - For Shares/Equities use the Trade Date instead of   *
049000200610     F*           Value Date to calculate the Dividend Due.           *
049100200610     F*  E20568 - ZACCZ changed to read non-diary events file -       *
049200200610     F*           renamed record format of SECEO.                     *
049300200610     F*  E20394 - LOOP CAUSED BY E19403 IF DATE IS EQUAL KEEPS CHAININ*
049400200610     F*           AND READING EQUAL .                                 *
049500200610     F*  E19403 - LOOP CAUSED BY BOTH PROGRAM AND ZACCRC ACCESSING    *
049600200610     F*           DPOSH AND RESETTING THE FILE POINTER                *
049700200610     F*  E20151 - AMOUNT DUE AT MATURITY INFLATED BY FACTOR OF 100    *
049800200610     F*           FOR A YEN INSTRUMENT                                *
049900200610     F*  E20086 - Mortgage-Backs and Current Factor Processing Rewrite*
050000200610     F*  E16085 - TO RESET INVESTMENT TYPE IF DEPOT IS CEDEL AND      *
050100200610     F*           CUSTOMER NOT A MARKET CLIENT.                       *
050200200610     F*           TO SUPPRESS BOOK CODE IN ACCOUNT KEYS FOR           *
050300200610     F*           CHARGES AND COMMISSIONS.                            *
050400200610     F*  E18803 - SET ACCOUNT KEY SEQUENCE NO. TO ZERO TO ALLOW FOR   *
050500200610     F*           MULTI-BRANCH SYSTEMS.                               *
050600200610     F*  E18221 - BLANK CHTP FIELD CAUSING OVERPRINTING IN POS.       *
050700200610     F*           SETTL. AUDIT LIST.                                  *
050800200610     F*  E18014 - PGM RECOMPILED OVER AMENDED AUDIT FILE              *
050900200610     F*  E16772 - The Dividend Payment Amount field SDDV has been     *
051000200610     F*           replaced by the field SDVA, to increase its size    *
051100200610     F*           from 9,4 to 13,8                                    *
051200200610     F*  E15426 - CORRECT REWORK OF POSITIONS FOR BACK-VALUATION      *
051300200610     F*  E15549 - FIXES CONNECTED WITH REDELIVERY OF POSITION         *
051400200610     F*           SETTLEMENT PROGRAMS FROM CD.                        *
051500200610     F*           1.INCLUDE SECURITY NON-DIARY EVENTS IN EVENTS       *
051600200610     F*             PROCESSING BETWEEN POSITION CHANGE DATES          *
051700200610     F*           2.FOR SECURITY EVENTS DUE TODAY,DO NOT PROCESS IN   *
051800200610     F*             THIS PROGRAM.(SE2400 WILL DO THOSE)               *
051900200610     F*           3.PROCESS ADJUSTMENTS TO POSITION SETTLEMENTS UP TO *
052000200610     F*             EVENT CONTROL DATE.                               *
052100200610     F*           4.ZEROIZE EX-COUPON NOMINAL IF COUPON DATE CROSSED. *
052200200610     F*  E14704 - REVERSE SET UP OF PAY/RECEIVE INDICATOR.            *
052300200610     F*  E15035 - AUDIT FILES CDPMVA,CPOSNA,SETACA,TRDACA DO NOT      *
052400200610     F*           HAVE FIELD RECI. CHECK FOR * LEADS TO DB ERROR 04   *
052500200610     F*  E14716 - EVENT CODE 'MA' CHANGED TO 'MT'.                    *
052600200610     F*  E14718 - SET UP BOOK CODE CORRECTLY, USING PORTFOLIO         *
052700200610     F*           BOOK CODE DEFAULT.                                  *
052800200610     F*  E14522 - TEST CONVERTIBLE INDICATOR (POSN 14 IN ACCOUNT      *
052900200610     F*           KEY) CORRECTLY.                                     *
053000200610     F*  E14438 - RECOMPILE PROGRAM FOR EUCLID INCORPORATION          *
053100200610     F*           AND UPGRADING OF FILES.                             *
053200200610     F*  E13561 - UPDATE POSITION CORRECTLY FOR TRADE AND TRADE       *
053300200610     F*           SETTLEMENTS ACTIONS AND SET AP NUMERATOR FIELDS     *
053400200610     F*           TO ZERO FOR NEW RECORD.                             *
053500200610     F*                                                               *
053600200610     F*****************************************************************
053700200610      *
053800200610     FSE2380AUO   E                    PRINTER
053900200610     FTRDACA  IF  E                    DISK
054000200610     FSETACA  IF  E                    DISK
054100200610     FCDPMVA  IF  E                    DISK
054200200610     FCPOSNA  UF  E                    DISK         KINFDS CPOADS
054300200610     F                                              KINFSR CPOASR
054400200610     FMATEXA  O   E                    DISK         KINFDS MXAADS
054500200610     F                                              KINFSR MXAASR
054600200610     FPOSETA  O   E                    DISK         KINFDS POSADS
054700200610     F                                              KINFSR POSASR
054800200610     FSEKEYA  O   E                    DISK         KINFDS SEKADS
054900200610     F                                              KINFSR SEKASR
055000200610     FTABSE   IF  E           K        DISK
055100200610     F* ICD 1     TABTB10F                          KIGNORE
055200200610     F* ICD 2     TABTB11F                          KIGNORE
055300200610     F* TAB36     TABTB36F                          KIGNORE
055400200610     F            TABTB40F                          KIGNORE
055500200610     F* CCY       TABTG10F                          KIGNORE
055600200610     F            TABTG20F                          KIGNORE
055700200610     F            TABLETHF                          KIGNORE
055800200610     F*********** TABLETJF                          KIGNORE               S01117
055900200610     F            TABLETLF                          KIGNORE
056000200610     F* BR NAME   TABLETRF                          KIGNORE
056100200610     F            TABLETXF                          KIGNORE
056200200610     F            TABLET2F                          KIGNORE
056300200610     F            TABLET3F                          KIGNORE
056400200610     F            TABLET5F                          KIGNORE
056500200610     F            TABTE10F                          KIGNORE
056600200610     F            TABLETNF                          KIGNORE
056700200610     F            TABLETKF                          KIGNORE
056800200610     F            TABLETPF                          KIGNORE
056900200610     F            TABLETAF                          KIGNORE
057000200610     F            TABTE20F                          KIGNORE
057100200610     FCLINT   IF  E           K        DISK
057200200610     F            CLINTCAF                          KIGNORE
057300200610     F            CLINTCCF                          KIGNORE
057400200610     F            CLINTC1F                          KIGNORE
057500200610     F*********** CLINTSEF                          KIGNORE               S01447
057600200610     F************CLINTCBF                          KIGNORE               S01447
057700200610     FSECED   IF  E           K        DISK
057800200610     F***SECET***IF  E           K        DISK                            E20086
057900200610     F*********** SEDEVDF                           KRENAMESEDETD         E20086
058000200610     FSECEO   IF  E           K        DISK                               E20086
058100200610     F**********  SNDEVDF                           KIGNORE         E20086E20568
058200200610     F            SNDEVDF                           KRENAMESNDEVDO        E20568
058300200610     F            SEDEVDF                           KRENAMESEDEVDO        E20086
058400200610     FSEPCCD  IF  E           K        DISK                               S01117
058500200610     FSECACE  IF  E           K        DISK                               E15549
058600200610     FSECTY   IF  E           K        DISK
058700200610     FSESWHTL0IF  E           K        DISK                               S01447
058800200610     F* Securities WHT details file                                       S01447
058900200610     FINVTP   IF  E           K        DISK
059000200610     FSTDSED  IF  E           K        DISK
059100200610     FSEDEVL1 IF  E           K        DISK                               S01510
059200200610     F            SEDEVDF                           KRENAMESEDEVD1        S01510
059300200610     F*                                                                   S01486
059400200610     F* RECORD ID PN                                                      S01486
059500200610     FPMPORTPDIF  E           K        DISK                           UC  S01486
059600200610     F*                                                                   S01486
059700200610     F* PM CHANGED POSITIONS                                              S01486
059800200610     FPMBVALPDUF  E           K        DISK                      A    UC  S01486
059900200610     F*                                                                   S01486
060000200610     F* PM CHANGED POSITIONS                                              S01486
060100200610     FPMBVALP1IF  E           K        DISK                           UC  S01486
060200200610     F            PMBVALD0                          KRENAMEPMBVALD1       S01486
060300200610     F*                                                                   S01486
060400200610     F**   ACCOUNT DETAILS                                                S01486
060500200610     FPMACCNL0IF  E           K        DISK                           UC  S01486
060600200610     FPMACCNL1IF  E           K        DISK                           UC  219688
060700200610     F            ACCNTABF                          KRENAMEACCNTL1F       219688
060800200610     F*                                                                   219688
060900200610     FSECET   IF  E           K        DISK                           UC  S01486
061000200610     F            SEDEVDF                           KRENAMESEDEVD2        S01486
061100200610     FSECEDI  IF  E           K        DISK                           UC  S01486
061200200610     F            SNDEVDF                           KRENAMESNDEVDI        S01486
061300200610     F            SEDEVDF                           KRENAMESEDEVDI        S01486
061400200610     FSDCURRL0IF  E           K        DISK                               S01486
061500200610     FSECGT   IF  E           K        DISK                               S01519
061600200610     F** Charge/commissions rates table                                   S01519
061700200610     FSEDFTCL2IF  E           K        DISK                               S01519
061800200610     F** Default charges table                                            S01519
061900200610     FSEDFGRL0IF  E           K        DISK         KINFSR *PSSR      UC  CSE026
062000200610     F            SEDFTCD0                          KRENAMESEDFTGD0       CSE026
062100200610     FSEKEYD  O   E           K        DISK         KINFDS SEKDDS
062200200610     F                                              KINFSR SEKDSR
062300200610     FPOSETD  O   E           K        DISK         KINFDS POSDDS
062400200610     F                                              KINFSR POSDSR
062401200616     FPSAUTD  O   E           K        DISK                                                 AR324886
062402200616      ** SE Position Settlement Authorisation detail                                        AR324886
062403200616      *                                                                                     AR324886
062500200610     FMATEXD  O   E           K        DISK         KINFDS MXDDDS
062600200610     F                                              KINFSR MXDDSR
062700200610     FCSPAC   IF  E           K        DISK
062800200610     FCPOSHI  IF  E           K        DISK
062900200610     F            CPOSNDF                           KRENAMECPOSNI
063000200610     FCPOSH   UF  E           K        DISK         KINFDS CPOHDSA
063100200610     F                                              KINFSR CPOHSR
063200200610     FSDBRCHL0IF  E           K        DISK                               136297
063300200610     FTABTB20 IF  E                    DISK                               136297
063400200610     FACCNT   IF  E           K        DISK                               136297
063500200610     F            ACCNTABF                          KRENAMEACCOUNTF       136297
063600200610     FSDCUSQL0IF  E           K        DISK                                                 AR853119
063700200610      **  Midas SD Stamp Tax Customer Extension file                                        AR853119
063800200610     FPOSETDX3O   E           K        DISK         KINFSR *PSSR                            AR853119
063900200610      ***  Position Settlements - Extension File                                            AR853119
064000200610     FSDSTMDPDO   E           K        DISK         KINFSR *PSSR                            AR853119
064100200610      **  Midas SD Stamp Tax History Detail file                                            AR853119
064200200610      *                                                                                     AR853119
064300200610      *                                                                   S01408
064400200610     F/COPY WNCPYSRC,SE2380FFP1                                           S01408
064500200610      *                                                                   S01408
064600200610      /EJECT
064700200610     F*****************************************************************
064800200610     F*                                                               *
064900200610     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
065000200610     F*                                                               *
065100200610     F*   01 - CUSTOMER MOVEMENT ACTION RECORD READ IN                *
065200200610     F*   02 - SETTLEMENT ACTION RECORD READ IN                       *
065300200610     F*   03 - TRADE ACTION RECORD READ IN                            *
065400200610     F*   30 - PRINT DIFFERENCE MESSAGE CUST. MVMNTS AUDIT & COUNT    *
065500200610      *   40 - Set on when S01496 and autocharge flag are ON.         *   CSE026
065600200610     F*   54 - CUSTOMER RECORD READ IN (FORMAT CB)                    *   S01447
065700200610      *   72 - Beginning of file on READP for SEDEVD                  *                     BUG11104
065800200610     F*   77 - END OF FILE ON READE OR RECORD EXISTS ON SETLL         *
065900200610     F*   79 - GENERAL DATA BASE ERROR/RECORD NOT FOUND/DELETED       *
066000200610     F*   87 - EXCEPTION ERROR ON UPDATED FILE - PRINTS STATUS/AUDIT  *
066100200610     F*   88 - Chain indicator for STDSED                             *   147514
066200200610     F*   89 - END OF FILE ON CUST. ACTIONS FILE                      *
066300200610     F*                                                               *
066400200610     F*90-99 - USED IN Z SUBROUTINES                                  *
066500200610     F*                                                               *
066600200610     F*   U7 - DATABASE ERROR                                         *
066700200610     F*   U8 - DATABASE ERROR                                         *
066800200610     F*                                                               *
066900200610     F*****************************************************************
067000200610      /EJECT
067100200610     F*****************************************************************
067200200610     F*                                                               *
067300200610     F*  S U B R O U T I N E   I N D E X                              *
067400200610     F*                                                               *
067500200610     F*  GETCTY-  Get Country of Branch                               *   S01447
067600200610     F*  FIRST   - ACCESSES ICD INFORMATION                           *
067700200610     F*  CH01    - CHANGE OF POSITION ON INPUT RECORDS - UPDATE FOR   *
067800200610     F*            LAST DATE READ AND ANY SUCCEEDING DATES FOR        *
067900200610     F*            POSITION UP TO END OF DATES FOR THIS POSITION.     *
068000200610     F*  CH02    - CHANGE OF DATE ON INPUT RECORDS - UPDATE FOR LAST  *
068100200610     F*            DATE READ AND ANY SUCCEEDING DATES FOR POSITION    *
068200200610     F*            UP TO NEW DATE READ IN.                            *
068300200610     F*  NW01    - NEW POSITION READ IN - GET NEWEST DATE FOR THIS    *
068400200610     F*            POSITION AND THEN ESTABLISH LATEST DATE HELD FOR   *
068500200610     F*            THIS NEW DATE READ IN.                             *
068600200610     F*            (I.E. BALANCE AS AT DATE READ IN)                  *
068700200610     F*  NW02    - NEW DATE FOR POSITION BEING PROCESSED IS READ IN - *
068800200610     F*            ESTABLISH LATEST DATE HELD FOR THIS                *
068900200610     F*            NEW DATE READ IN.(I.E. BALANCE AS AT DATE READ IN) *
069000200610     F*  U01     - UPDATE POSITIONS WITH ACTIONS ON THIS DATE FOR EACH*
069100200610     F*            EXISTING POSITION DATE WITH ACTIONS-CHG OF DATE    *
069200200610     F*  U02     - UPDATE POSITIONS WITH ACTIONS ON THIS DATE FOR EACH*
069300200610     F*            EXISTING POSITION DATE WITH ACTIONS-CHG OF POSITION*
069400200610     F*  W01     - WRITE A NEW POSITION RECORD                        *
069500200610     F*  PR01    - WRITE PRINT REPORT OF CUST. MOVEMENTS              *
069600200610     F*  ACCUM   - ACCUMULATES VALUES OF ACTIONS FOR A DATE           *
069700200610     F*  CLRUPD  - ZEROISE CUST. POSN RECORD FIELDS                   *
069800200610     F*  NOPOSN  - NO EXISTING CUST. POSITION,INITIALISE FIELDS       *
069900200610     F*  CHGPOS  - UPDATE CUST. POSN RECORDS FROM LAST DATE UPDATED   *
070000200610     F*            TO MOST RECENT.                                    *
070100200610     F*  GETDEP  - OBTAIN LATEST CORRECT CUST. POSITION DATE          *
070200200610     F*  DIVIND  - PRODUCE DIVIDEND A/C KEY &/OR POSITION SETTLEMENT  *
070300200610     F*  COUPON  - PRODUCE COUPON A/C KEY &/OR POSITION SETTLEMENT    *
070400200610     F*  PARTPY  - PRODUCE PART PAYMENT POSITION SETTLEMENT           *
070500200610     F*  MORTPY  - PRODUCE MORTGAGE PAYMENT POSITION SETTLEMENT       *
070600200610     F*  MATURE  - PRODUCE MATURITY POSITION SETTLEMENT               *
070700200610     F*  NEXT    - GET DATE OF NEXT INTERVENING POSITION USING CPOSHI *
070800200610     F*  W02     - WRITE POSITION SETTLEMENT                          *
070900200610     F*  P04    - CALCULATE THE DEFAULT CHARGE/COMMISSION AMOUNT      *   S01519
071000200610     F*  P05    - CALCULATE DEFAULT AMOUNTS                           *   S01519
071100200610     F*  P06    - CALCULATE SETTLEMENT AMOUNT                         *   S01519
071200200610     F*  CALAMT - DETERMINE IF AMOUNTS NEED TO BE CALCULATED FOR      *   S01519
071300200610     F*           CHARGES                                             *   S01519
071400200610     F*  CALAM2 - CALCULATE CHARGE AMOUNTS                            *   S01519
071500200610     F*  CALCTX - Calculate tax amounts for dividends/Coupons         *   S01447
071600200610     F*  W03     - WRITE ACCOUNT KEY                                  *
071700200610     F*  W04     - WRITE MATURED SECURITY POSITIONS EXTRACT           *
071800200610     F*  SECTIN  - GET SECURITY DETAIL RECORD IN                      *
071900200610     F*  INVTIN  - GET INVESTMENT TYPE DETAIL RECORD IN               *
072000200610     F*  CLNTIN  - GET CLINTSE FOR THIS CUSTOMER FOR THIS PORTFOLIO   *
072100200610     F*            INDICATOR.                                         *
072200200610     F***SECEDI**-*GET*SECURITY*EVENTS*DETAIL*RECORD*IN*******************081239
072300200610     F*  SECEDC  - GET SECURITY EVENTS DETAIL RECORD IN               *   081239
072400200610     F*  TG10    - GET TABTG10 RECORD FOR EACH CURRENCY AS REQUIRED   *
072500200610     F*  #LCURR  - GET SDCURRPD RECORD FOR EACH CURRENCY AS REQUIRED  *   S01446
072600200610     F*                                                               *
072700200610     F*  CPOASR  - ERROR HANDLING FOR CPOSNA                          *
072800200610     F*  CPOHSR  - ERROR HANDLING FOR CPOSH                           *
072900200610     F*  SEKDSR  - ERROR HANDLING FOR SEKEYD                          *
073000200610     F*  SEKASR  - ERROR HANDLING FOR SEKEYA                          *
073100200610     F*  POSDSR  - ERROR HANDLING FOR POSETD                          *
073200200610     F*  POSASR  - ERROR HANDLING FOR POSETA                          *
073300200610     F*  MXDSSR  - ERROR HANDLING FOR MATEXD                          *
073400200610     F*                                                               *
073500200610     F*  AUDIT   - OUTPUTS AUDIT RECORD CPOSNA AND CONTROL REPORT     *
073600200610     F*                                                               *
073700200610     F*  ZACCH  - ACCESS RECORD FOR HOLIDAYS FILE                     *   S01512
073800200610     F*  ZFWDT  - FIND WORKING DAYS FORWARD                           *   S01512
073900200610     F*  ZHASH   - HASH TOTALLING STD SUBROUTINE                      *
074000200610     F*  ZICD2   - OBTAINS ICD2                                       *
074100200610     F*  ZSYSTM  - OBTAINS ICD1                                       *
074200200610     F***ZXRATE*-*CROSS*REF*EXCHANGE*RATE*CALCULATED*******************   E23169
074300200610     F*  ZXRATE - CROSS REF EXCHANGE RATE CALCULATED                  *   S01446
074400200610     F*                                                               *
074500200610     F*  ZACCRC  - CALCULATE ACCRUED INTEREST ** PROGRAM CALL **      *
074600200610     F*  *PSSR   - EXCEPTION ERROR ROUTINE                            *   S01117
074700200610     F*                                                               *
074800200610     F*****************************************************************
074900200610      /EJECT
075000200610     F/COPY WNCPYSRC,SE2380F001
075100200610     E                    CPY@    1   1 80
075200200610     E**********          WAD        10  6 0                                    AR1001183 AR1001183A
075300200610     E**********          WBR        10  2 0                                    AR1001183 AR1001183A
075400200610     E**********          WBS        10 11 7                                    AR1001183 AR1001183A
075500200610     E**********          WSI        10  1                                      AR1001183 AR1001183A
075600200610     E**********          WRM        10  7                                      AR1001183 AR1001183A
075700200610     E**********          WRF        10  4                                      AR1001183 AR1001183A
075800200610     E/COPY ZSRSRC,ZPOWER8Z1
075900200610     E/COPY ZSRSRC,ZPOWERZ1                                               S01509
076000200610     E/COPY ZSRSRC,ZCCAL1Z1                                               S01519
076100200610     E/COPY ZSRSRC,ZDATE2Z1
076200200610     E/COPY ZSRSRC,ZHASHZ1
076300200610     E/COPY ZSRSRC,ZSDESCZ1
076400200610     E/COPY ZSRSRC,ZSEDITZ1
076500200610     E/COPY ZSRSRC,ZNCDZ1                                                 E29307
076600200610     E/COPY ZSRSRC,ZHOLE                                                  S01512
076700200610     E/COPY ZSRSRC,ZDAYSZ1                                                S01486
076800200610     E/COPY ZSRSRC,ZACCRZ0                                                S01486
076900200610     E/COPY WNCPYSRC,SE2380E001
077000200610      /EJECT
077100200610     I*                                                                   033988
077200200610     ISECTYDF                                                             033988
077300200610     I              RECI                            RECIS                 033988
077400200610     I*
077500200610     I* USER CUST. ACTIONS RECORD FORMATS       -    LF/UDPAC
077600200610     I*
077700200610     ICDPMVDF     01
077800200610     I              PTFR                            WPTFR                 S01486
077900200610     I*
078000200610     I* USER CUST. MOVEMENTS RECORD - ID 01
078100200610     I*
078200200610     ISETACDF     02
078300200610     I*
078400200610     I* SETTLEMENTS ACTION   RECORD - ID 02
078500200610     I*
078600200610     ITRDACDF     03
078700200610     I              PTFR                            WPTFR                 S01486
078800200610     I*
078900200610     I* TRADE ACTION         RECORD - ID 03
079000200610     I*
079100200610     ICPOSNI
079200200610     I*
079300200610     I* CUST. POSITIONS FILE - NEXT POSITION    LF/CPOSH RENAMED CPOSHI
079400200610     I*
079500200610     I              RECI                            XRECI
079600200610     I***********   CSBR                            XCSBR                 S01117
079700200610     I              CSBA                            XCSBA                 S01117
079800200610     I              CSSC                            XCSSC
079900200610     I              CSCN                            XCSCN
080000200610     I              CSNV                            XCSNV
080100200610     I              CSNT                            XCSNT
080200200610     I              CSNS                            XCSNS
080300200610     I              CSEX                            XCSEX
080400200610     I              CSDA                            XCSDA
080500200610     I              CSPT                            XCSPT
080600200610     I              CSPV                            XCSPV
080700200610     I              CSBT                            XCSBT
080800200610     I              CSBV                            XCSBV
080900200610     I              CSCT                            XCSCT
081000200610     I              CSCV                            XCSCV
081100200610     I              CSPI                            XCSPI                                     CGL031
081200200610     I              CSAT                            XCSAT                                     233703
081300200610     I              CSAV                            XCSAV                                     233703
081400200610     ISEDEVDF                                                             E20086
081500200610     I              NMCY                            SNMCY                 E20086
081600200610     ISNDEVDF                                                             E15549
081700200610     I              SNSN                            SDSN                  E15549
081800200610     I              SNDT                            SDED                  E15549
081900200610     I              SNET                            SDET                  E15549
082000200610     ISEDEVDO                                                             E20086
082100200610      *                                                                   E20086
082200200610      ***  Rename of fields for Security Diary (by Reverse Date).         E20086
082300200610      *                                                                   E20086
082400200610     I              RECI                            SORECI                E20086
082500200610     I              SDSN                            SOSDSN                E20086
082600200610     I              SDED                            SOSDED                E20086
082700200610     I              SDET                            SOSDET                E20086
082800200610     I              SDNV                            SOSDNV                E20086
082900200610     I              SDVA                            SOSDVA                E20086
083000200610     I              SDCP                            SOSDCP                E20086
083100200610     I              SRPT                            SOSRPT                E20086
083200200610     I              SDTR                            SOSDTR                E20086
083300200610     I              SRMI                            SOSRMI                E20086
083400200610     I              SDPD                            SOSDPD                E20086
083500200610     I              SDNC                            SOSDNC                E20086
083600200610     I              SDPP                            SOSDPP                E20086
083700200610     I              SDPC                            SOSDPC                E20086
083800200610     I              SDTA                            SOSDTA                E20086
083900200610     I              SDTP                            SOSDTP                E20086
084000200610     I              SDRP                            SOSDRP                E20086
084100200610     I              SDCV                            SOSDCV                E20086
084200200610     I              SDCX                            SOSDCX                E20086
084300200610     I              SDCE                            SOSDCE                E20086
084400200610     I              SDMD                            SOSDMD                E20086
084500200610     I              NMCY                            SONMCY                E20086
084600200610     I              SDAD                            SOSDAD                E20086
084700200610     I              SDDT                            SOSDDT                E20086
084800200610     IPMBVALD1                                                            S01486
084900200610     I              GGTDSS                          RVTDSS                S01486
085000200610     I              GGCNUM                          RVCNUM                S01486
085100200610     I              GGPTFR                          RVPTFR                S01486
085200200610     I              GGPDAT                          RVPDAT                S01486
085300200610     I              GGNDAT                          RVNDAT                S01486
085400200610     I              GGCSBR                          RVCSBR                S01486
085500200610     I              GGCSNT                          RVCSNT                S01486
085600200610     I              GGCSNV                          RVCSNV                S01486
085700200610     I              GGCSEX                          RVCSEX                S01486
085800200610     IACCNTABF                                                            S01486
085900200610     I              PTFR                            RNPTFR                S01486
086000200610     IACCNTL1F                                                            219688
086100200610     I              PTFR                            L1PTFR                219688
086200200610     I*                                                                   S01486
086300200610     I** RENAME NO-DIARY EVENT FIELDS                                     S01486
086400200610     ISNDEVDI                                                             S01486
086500200610     I              SNSN                            SDSN                  S01486
086600200610     I              SNDT                            SDED                  S01486
086700200610     I              SNET                            SDET                  S01486
086800200610      *                                                                   CAC002
086900200610      **  Rename some SEPCCD fields                                       CAC002
087000200610     ISEPCCDF                                                             CAC002
087100200610     I              CNUM                            PCCNUM                CAC002
087200200610     I              BRCA                            PCBRCA                CAC002
087300200610     I              SESN                            PCSESN                CAC002
087400200610     I              LCD                             PCLCD                 CAC002
087500200610     I              CHTP                            PCCHTP                CAC002
087600200610     I              TNLU                            PCTNLU                CAC002
087700200610      *                                                                                       CSE037
087800200610     IINVTPDF                                                                                 CSE037
087900200610     I              RECI                            RECII                                   BUG11104
088000200610     I              SFLG                            ISFLG                                     CSE037
088100200610      ** Rename RECI field from LF/SECET                                                    BUG11104
088200200610     ISEDEVD2                                                                               BUG11104
088300200610     I              RECI                            WRECI                                   BUG11104
088400200610     I*
088500200610     ITABLKY      DS
088600200610     I*
088700200610     I*  TABTB11 TABLE KEY FIELD DATA STRUCTURE FOR DB ERROR
088800200610     I*
088900200610     I                                        1  12 TKEY
089000200610     I                                        1   20RECT
089100200610     I                                        3  10 ZZ008
089200200610     I                                       11  120RCDE
089300200610     I***********                            10  120WBRCDE                S01117
089400200610     I                                       10  12 WBRCDE                S01117
089500200610     I*
089600200610     ICOMARA      DS
089700200610     I*
089800200610     I* COMMON AREA FOR KEY FIELDS ON ACTION RECORDS READ FROM LF/UDPAC
089900200610     I*
090000200610     I***********                             1   30WBC                   S01117
090100200610     I                                        1   3 WBC                   S01117
090200200610     I                                        4  13 WSS
090300200610     I**********                             14  190WDP                                       CSD027
090400200610     I                                       14  19 WDP                                       CSD027
090500200610     I***********                             1   30WBCB           S01486 081363
090600200610     I                                        1   3 WBCB                  081363
090700200610     I*
090800200610     ISTGARA      DS
090900200610     I*
091000200610     I* STORAGE  AREA FOR KEY FIELDS ON PREVIOUS ACTION RECORD
091100200610     I*
091200200610     I***********                             1   30WSBC                  S01117
091300200610     I                                        1   3 WSBC                  S01117
091400200610     I                                        4  13 WSSS
091500200610     I**********                             14  190WSDP                                      CSD027
091600200610     I                                       14  19 WSDP                                      CSD027
091700200610     I*
091800200610     IPRTARA      DS
091900200610     I*
092000200610     I* PRINT AREA FOR KEY FIELDS ON PREVIOUS PRINTED POSITION
092100200610     I*
092200200610     I                                        1   30WSPBC
092300200610     I                                        4  13 WSPSS
092400200610     I                                       14  190WSPDP
092500200610     I*
092600200610     ICPOADS      DS                            366
092700200610     I*
092800200610     I*  USER CUST. POSITIONS AUDIT FILE ERROR EXCEPTIOND DATA STRUCT.
092900200610     I*
093000200610     I                                     *STATUS  STSUDD
093100200610     I*
093200200610     ICPOHDS      DS                            366
093300200610     I*
093400200610     I*  USER CUST. POSITIONS FILE ERROR EXCEPTIOND DATA STRUCT.
093500200610     I*
093600200610     I                                     *STATUS  STSUDA
093700200610     I*
093800200610     IPOSDDS      DS                            366
093900200610     I*
094000200610     I*  POSITION SETTLEMENTS  FILE ERROR EXCEPTION  DATA STRUCT.
094100200610     I*
094200200610     I                                     *STATUS  STSPSD
094300200610     I*
094400200610     ISEKDDS      DS                            366
094500200610     I*
094600200610     I*  GENERATED ACCOUNT KEYS FILE ERROR EXCEPTION  DATA STRUCT.
094700200610     I*
094800200610     I                                     *STATUS  STSSKD
094900200610     I*
095000200610     IPOSADS      DS                            366
095100200610     I*
095200200610     I*  POSITION SETTLEMENTS  AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
095300200610     I*
095400200610     I                                     *STATUS  STSPSA
095500200610     I*
095600200610     IMXDDDS      DS                            366
095700200610     I*
095800200610     I*  MATURED CUSTOMERS SECURITY EXTRACT FILE DATA EXCPT/ERROR STRCT
095900200610     I*
096000200610     I                                     *STATUS  STSMXD
096100200610     I*
096200200610     IMXAADS      DS                            366
096300200610     I*
096400200610     I*  MATURED CUSTOMERS SECURITY AUDIT FILE DATA EXCPT/ERROR STRCT
096500200610     I*
096600200610     I                                     *STATUS  STSMXA
096700200610     I*
096800200610     ISEKADS      DS                            366
096900200610     I*
097000200610     I* GENERATED ACCOUNT KEYS AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
097100200610     I*
097200200610     I                                     *STATUS  STSSKA
097300200610     I*                                                                   S01486
097400200610     I*    MIDAS 'Next Available Transaction No.' Data Area  MNATN .      S01486
097500200610     IDNATN       DS                              5                       S01486
097600200610     I                                        1   50FNATN                 S01486
097700200610     I*
097800200610     I*  INPUT SPECIFICATIONS FOR ZSEDIT SUBROUTINE
097900200610     I*
098000200610     I/COPY ZSRSRC,ZSEDITZ2
098100200610     I/COPY ZSRSRC,ZHASHZ2
098200200610     I*
098300200610     I/COPY ZSRSRC,ZSDESCZ2
098400200610     I/COPY ZSRSRC,ZNCDZ2                                                 E29307
098500200610     I/COPY ZSRSRC,ZHOLI                                                  S01512
098600200610     I*
098700200610     IWACKEY      DS
098800200610     I*
098900200610     I* ACCOUNT KEY DATA STRUCTURE SEE SUBR W01
099000200610     I*
099100200610     I                                        1   3 WACITY
099200200610     I                                        4   4 WACEVC
099300200610     I                                        5   5 WACTRT
099400200610     I                                        6   6 WACPFI
099500200610     I                                        7   8 WACBKC
099600200610     I                                        9  10 WACTST
099700200610     I                                        9  10 WACPSB
099800200610     I                                       11  12 WACCCC
099900200610     I                                       13  13 WACMKT
100000200610     I                                       14  14 WACCON
100100200610     I                                       15  15 WACNEG
100200200610     I                                       19  20 WACAMC
100300200610     I*                                                                   S01117
100400200610     I* Customer Position Profit Centres PF/SEPCCD                        S01117
100500200610     I*                                                                   S01117
100600200610     IKSEPCR      DS                                                      S01117
100700200610     I**********                              1   60CSCN                               S01117 CSD027
100800200610     I                                        1   6 CSCN                                      CSD027
100900200610     I                                        1   6 ZCUST                 E37297
101000200610     I                                        7   9 CSBA                  S01117
101100200610     I                                       10  19 CSSC                  S01117
101200200610     I*
101300200610     IINVKEY      DS
101400200610     I*
101500200610     I* INVESTMENT TYPE FILE KEY FOR DB ERROR PRINTOUT
101600200610     I*
101700200610     I                                        1   3 NMCY
101800200610     I                                        4   6 SITP
101900200610     I*
102000200610     IPOSDDB      DS
102100200610     I*
102200200610     I* FILE POSETD DB ERROR KEY - OUTPUT FILE
102300200610     I*
102400200610     I***********                             1   30PBCH                  S01117
102500200610     I***********                             1   3 PBCH            S01117E33032
102600200610     I**********                              1   3 PBCA           E33032 CSE023
102700200610     I**********                              4  13 PSSH                  CSE023
102800200610     I**********                             14  190PCPY                  CSE023
102900200610     I                                        1   3 PBCAK                 CSE023
103000200610     I                                        4  13 PSSHK                 CSE023
103100200610     I**********                             14  190PCPYK                              CSE023 CSD027
103200200610     I                                       14  19 PCPYK                                     CSD027
103300200610     I*
103400200610     I***********LDA        UDS                            256            S01117
103500200610     I***********                                                         S01117
103600200610     I**LDA*(256)*IN QTEMP USED FOR DATA BASE ERROR PRINTOUT              S01117
103700200610     I***********                                                         S01117
103800200610     I***********                           134 177 DBLOT                 S01117
103900200610     I***********                           134 138 DBFILE                S01117
104000200610     I***********                           139 167 DBKEY                 S01117
104100200610     I***********                           168 175 DBPGM                 S01117
104200200610     I***********                           176 1770DBASE                 S01117
104300200610     I*                                                                   S01117
104400200610     ILDA         DS                            256                       S01117
104500200610     I*                                                                   S01117
104600200610     I* LDA (256) IN QTEMP USED FOR DATA BASE ERROR PRINTOUT              S01117
104700200610     I*                                                                   S01117
104800200610     I                                      134 183 DBLOT                 S01117
104900200610     I                                      134 141 DBFILE                S01117
105000200610     I                                      142 170 DBKEY                 S01117
105100200610     I                                      171 180 DBPGM                 S01117
105200200610     I                                      181 1830DBASE                 S01117
105300200610     I*                                                                   087178
105400200610     I/COPY WNCPYSRC,SE2380I002
105500200610     I*P@DATA******DS**                          100               087178 CAC002
105600200610     I***Data*structure for the parameter passed to and from SEZ01 087178 CAC002
105700200610     I***P@DATA*     DS                            128                               CAC002 AR853119
105800200610     IP@DATA      DS                            141                                         AR853119
105900200610     I/COPY WNCPYSRC,SE2380I004
106000200610     I** Data structure for the parameter passed to and from SEZ010       CAC002
106100200610     I** Amended to include margin information for PCA                    CAC002
106200200610     I                                        1   1 P@CLAS                087178
106300200610     I                                        2   2 P@PPRE                087178
106400200610     I                                        3  150P@PAMD                087178
106500200610     I                                       16  280P@PCHA                087178
106600200610     I                                       29  410P@PCAM                087178
106700200610     I                                       42  540P@TASO                087178
106800200610     I                                       55  670P@TAUS                087178
106900200610     I                                       68  808P@PSXR                087178
107000200610     I                                       81  81 P@PMDI                087178
107100200610     I                                       82  84 P@PNCY                087178
107200200610     I                                       85  87 P@PSCU                087178
107300200610     I                                       88 1000P@PSAT                087178
107400200610     I                                      101 1138P@FXMR                CAC002
107500200610     I                                      114 1260P@MAMT                CAC002
107600200610     I                                      127 128 P@TDTP                CAC002
107700200610     I                                      129 1410P@STAM                                  AR853119
107800200610     I/COPY WNCPYSRC,SE2380I003
107900200610      * Prime account code                                                103361
108000200610     I            DS                                                      103361
108100200610     I**********                              1  12 PRACCT                             103361 CGL029
108200200610     I                                        1  18 PRACCT                                    CGL029
108300200610     I                                        1   6 PRCNUM                103361
108400200610     I**********                              7  10 PRACOD                             103361 CGL029
108500200610     I**********                             11  12 PRACSQ                             103361 CGL029
108600200610     I                                        7  16 PRACOD                                    CGL029
108700200610     I                                       17  18 PRACSQ                                    CGL029
108800200610     I*
108900200610     ICPYR@#      DS
109000200610     I*
109100200610     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
109200200610     I*
109300200610     I                                        1  80 CPY@
109400200610     I                                        1  20 CPY@##
109500200610      *                                                                   S01408
109600200610     I/COPY WNCPYSRC,SE2378IIP2                                           S01408
109700200610      *                                                                   S01408
109800200610     IPPOSET    E DSPOSETD                                                CSE023
109900200610     I*  Position Settlement record for calling SE2310                    CSE023
110000200610     ISDMMOD    E DSSDMMODPD                                              S01486
110100200610     I**  Data structure for module details                               S01486
110200200610     I*                                                                   S01486
110300200610     ISDPLCS    E DSSDPLCSPD                                              S01486
110400200610     I**  Data structure for portfolio client                             S01486
110500200610     I*                                                                   S01486
110600200610     ISECSPD    E DSSDSECSPD                                              S01486
110700200610     I** Securities Trading Customer Details access object                S01486
110800200610     I*
110900200610     ISDBRCH    E DSSDBRCHPD                                              S01447
111000200610     I** Branch Details                                                   S01447
111100200610     I*                                                                   S01446
111200200610     ISDCURR    E DSSDCURRPD                                              S01446
111300200610     I** Currency Details                                                 S01446
111400200610     I*                                                                   S01519
111500200610     ISDSTRD    E DSSDSTRDPD                                              S01519
111600200610     I** Securities Trading ICD                                           S01519
111700200610     I*                                                                   095033
111800200610     ISDGELR    E DSSDGELRPD                                              095033
111900200610     I** General Ledger details                                           095033
112000200610     I              QQACCD                          QQACC1                                    CGL029
112100200610     I*                                                                   S01447
112200200610     ISECNTR    E DSSECNTRPD                                              S01447
112300200610     I** SE Country tax rate details                                      S01447
112400200610     I*                                                                   S01447
112500200610     ISECBTX    E DSSECBTXPD                                              S01447
112600200610     I** SE Country to Branch tax rate details                            S01447
112700200610     I*                                                                   103361
112800200610     ISDRETL    E DSSDRETLPD                                              103361
112900200610     I** Retail ICD details                                               103361
113000200610     I              QQACCD                          QQACC2                                    CGL029
113100200610     ISDBANK    E DSSDBANKPD                                                                AR853119
113200200610      ***  Data structure for bank details                                                  AR853119
113300200610     ISDBRCE    E DSSDBRCHEXPD                                                              AR853119
113400200610      ** Branch Details Extension                                                           AR853119
113500200610     ISDSTPD    E DSSDSTPDPD                                                                AR853119
113600200610      *                                                                   S01408
113700200610     ISCSARD    E DSSCSARDPD                                              CSE026
113800200610      ** Data structure for switchable features file                      CSE026
113900200610      *                                                                   CSE026
114000200610     I              LCD                             SCLCD                 CSE026
114100200610     I/COPY WNCPYSRC,SE2380IIP1                                           S01408
114200200610      *                                                                   S01408
114300200610     I*                                                                   S01447
114400200610     IDSFDY     E DSDSFDY                                                 S01447
114500200610     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01447
114600200610     I*                                                                   S01447
114700200610     IDSSDY     E DSDSSDY                                                 S01447
114800200610     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01447
114900200610     I*                                                                   S01447
115000200610      ***Data*Structure*to*receive*Base*Rate*Details                            AR1001183 AR1001183A
115100200610     I***SDBSRT*   E DSSDBSRTPD                                                 AR1001183 AR1001183A
115200200610      *                                                                                       CSE028
115300200610      ** DS for customer/book standard settlement instruction                                 CSE028
115400200610      **  to be passed to SESSIR0                                                             CSE028
115500200610      *                                                                                       CSE028
115600200610     IPCBSTD    E DSSTDSED                    2                                               CSE028
115700200610     I              RECI                            STRECI                                    CSE028
115800200610     I              LCD                             STLCD                                     CSE028
115900200610     I              CHTP                            STCHTP                                    CSE028
116000200610     I              TNLU                            STTNLU                                    CSE028
116100200610      *                                                                                       CSE028
116200200610      ** Data structure for standard additional settlement details                            CSE028
116300200610      ** for customer/book to be passed to SESSIR0                                            CSE028
116400200610      *                                                                                       CSE028
116500200610     IPCBSAD    E DSSTDADSED                  8                                               CSE028
116600200610      *                                                                                       CSE028
116700200610     I              'ZAAMLSETSE'          C         ZAAMLP                                    CGL020
116800200610     I**********    'ZACALCSPRT'          C         SPRDSR                      AR1001183 AR1001183A
116900200610      *                                                                                       CGL020
117000200610      *                                                                                       219566
117100200610      * Data structure for AOSVALR0 string                                                    219566
117200200610     I            DS                                                                          219566
117300200610     I                                        1 200 SVAL1                                     219566
117400200610     I                                        1   1 DEF001                                    219566
117500200610      *                                                                                       219566
117600200610      * System Value                                                                          219566
117700200610     I            DS                                                                          219566
117800200610     I I            'UseDefaultSettAccnt'     1  20 SVALK1                                    219566
117900200610      *                                                                                       219566
117901200616     ISDSTAT    E DSSDSTAT                                                                  AR324886
117902200616      ** SD Data area                                                                       AR324886
117903200616      *                                                                                     AR324886
118000200610     I/COPY WNCPYSRC,SE2380I001
118100200610      /EJECT
118200200610      *================================================================
118300200610      *  P R O G R A M   S T A R T                                    *
118400200610      *================================================================
118500200610     C*
118600200610     C* KEYLISTS FOR CHAINING TO FILES
118700200610     C*
118800200610     C* USER CUST. POSITIONS - HIST. & CURR (UPDATED) LF/CPOSH
118900200610     C*
119000200610     C           CPHKEY    KLIST
119100200610     C***********          KFLD           CSBR                            S01117
119200200610     C                     KFLD           CSBA                            S01117
119300200610     C                     KFLD           CSSC
119400200610     C                     KFLD           CSCN
119500200610     C                     KFLD           WDT
119600200610     C*
119700200610     C* USER CUST. POSITIONS - NO DATE ON KEY (UPDATED) LF/CPOSH
119800200610     C*
119900200610     C           CPHKND    KLIST
120000200610     C***********          KFLD           CSBR                            S01117
120100200610     C                     KFLD           CSBA                            S01117
120200200610     C                     KFLD           CSSC
120300200610     C                     KFLD           CSCN
120400200610     C*
120500200610     C* USER CUST. POSITIONS - HIST. & CURR (UPDATED) LF/CPOSH
120600200610     C*
120700200610     C           STGKEY    KLIST
120800200610     C                     KFLD           WSBC
120900200610     C                     KFLD           WSSS
121000200610     C                     KFLD           WSDP
121100200610     C                     KFLD           STGDAT
121200200610     C*
121300200610     C* USER CUST. POSITIONS - HIST. & CURR (UPDATED) LF/CPOSH
121400200610     C* NO DATE ON KEY OF STORED BRAN/SEC/CUST./BOOK/MARKET-SEE CHGPOS
121500200610     C*
121600200610     C           STGKY2    KLIST
121700200610     C                     KFLD           WSBC
121800200610     C                     KFLD           WSSS
121900200610     C                     KFLD           WSDP
122000200610     C*
122100200610     C* USER CUST. POSITIONS - HIST. & CURR (INPUT) LF/CPOSHI
122200200610     C*
122300200610     C           CPIKEY    KLIST
122400200610     C***********          KFLD           XCSBR                           S01117
122500200610     C                     KFLD           XCSBA                           S01117
122600200610     C                     KFLD           XCSSC
122700200610     C                     KFLD           XCSCN
122800200610     C                     KFLD           XCSDA
122900200610     C*
123000200610     C* USER CUST. POSITIONS - NO DATE ON KEY (INPUT) LF/CPOSHI
123100200610     C*
123200200610     C           CPIKND    KLIST
123300200610     C***********          KFLD           XCSBR                           S01117
123400200610     C                     KFLD           XCSBA                           S01117
123500200610     C                     KFLD           XCSSC
123600200610     C                     KFLD           XCSCN
123700200610     C*
123800200610     C*  TABLES TABTB11 AND TABTB10
123900200610     C*
124000200610     C           TABKEY    KLIST
124100200610     C                     KFLD           TKEY
124200200610     C*
124300200610     C*  CUST. NAME INFORMATION - LF/CLINT (PF/CLINTSE)
124400200610     C*
124500200610     C           CLINTK    KLIST
124600200610     C**********           KFLD           WCLNTK  60                                          CSD027
124700200610     C                     KFLD           WCLNTK  6                                           CSD027
124800200610     C                     KFLD           WLITA   1
124900200610     C*                                                                   S01447
125000200610     C* GET COUNTRY LOCATION - LF/CLINT (PF/CLINTCB)                      S01447
125100200610     C*                                                                   S01447
125200200610     C           CLKYCB    KLIST                                          S01447
125300200610     C**********           KFLD           WCUST   60                                   S01447 CSD027
125400200610     C                     KFLD           WCUST   6                                           CSD027
125500200610     C                     KFLD           WRTYP   1                       S01447
125600200610     C*                                                                   S01447
125700200610     C*
125800200610     C* CUST. POSITIONS -  HISTORY AND CURRENT   LF/CPOSH
125900200610     C*
126000200610     C           CPOHKY    KLIST
126100200610     C***********          KFLD           WCSBR                           S01117
126200200610     C                     KFLD           WCSBA                           S01117
126300200610     C                     KFLD           WCSSC
126400200610     C                     KFLD           WCSCN
126500200610     C                     KFLD           WCSDA
126600200610     C*
126700200610     C* SECURITY EVENTS -  BY SEC/DATE/TYPE      LF/SECED
126800200610     C*
126900200610     C           SECDKY    KLIST
127000200610     C                     KFLD           WCSSC
127100200610     C                     KFLD           SDED
127200200610     C                     KFLD           SDET
127300200610     C*
127400200610     C**SECURITY*EVENTS*-*BY*SEC/TYPE/DATE*******LF/SECED**************   E20086
127500200610     C*** Security Diary Events by Security/Event Type /REVERSE Date.     E20086
127600200610     C*
127700200610     C           SECETY    KLIST
127800200610     C                     KFLD           WCSSC
127900200610     C                     KFLD           SDET
128000200610     C                     KFLD           SDED
128100200610     C*
128200200610     C* SECURITY EVENTS - LF/SECED
128300200610     C*
128400200610     C           SECKEY    KLIST
128500200610     C                     KFLD           WSSS
128600200610     C                     KFLD           STGDAT
128700200610     C*
128800200610     C* SECURITY EVENTS - PARTIAL KEY (NO DATE) LF/SECED
128900200610     C*
129000200610     C           SECK      KLIST
129100200610     C                     KFLD           WSSS
129200200610     C*
129300200610     C* SECURITES   LF/SECTY
129400200610     C*
129500200610     C           SECTKY    KLIST
129600200610     C                     KFLD           WCSSC
129700200610     C*
129800200610     C* INVESTMENT TYPES  LF/INVTP
129900200610     C*
130000200610     C           INVTKY    KLIST
130100200610     C                     KFLD           NMCY
130200200610     C                     KFLD           SITP
130300200610     C*
130400200610     C* STANDARD SETTLEMENT INSTRUCTIONS  PF/STDSED
130500200610     C*
130600200610     C           STDSKY    KLIST
130700200610     C**********           KFLD           SBRH                            S01117
130800200610     C                     KFLD           SBRA                            S01117
130900200610     C                     KFLD           CSTM
131000200610     C                     KFLD           WBOOK   2                                           CSE028
131100200610     C                     KFLD           CYSI
131200200610     C                     KFLD           ITSI                                                CSE028
131300200610     C                     KFLD           WKPTFR  4                                           CSE028
131400200610      *                                                                                       CSE028
131500200610     C                     MOVE *BLANKS   WBOOK                                               CSE028
131600200610     C                     MOVE *BLANKS   WKPTFR                                              CSE028
131700200610     C*                                                                   S01117
131800200610     C* Customer Position Profit Centres PF/SEPCCD                        S01117
131900200610     C*                                                                   S01117
132000200610     C           KSEPCC    KLIST                                          S01117
132100200610     C                     KFLD           CSCN                            S01117
132200200610     C                     KFLD           CSBA                            S01117
132300200610     C                     KFLD           CSSC                            S01117
132400200610     C*                                                                   S01519
132500200610     C** Default charges table                                            S01519
132600200610     C*                                                                   S01519
132700200610     C           DFTKY1    KLIST                                          S01519
132800200610     C                     KFLD           DCCLAS                          S01519
132900200610     C                     KFLD           DCINVT                          S01519
133000200610     C                     KFLD           DCCUST                          S01519
133100200610      *                                                                   CSE026
133200200610     C           DFTKYG    KLIST                                          CSE026
133300200610     C                     KFLD           DCCLGR                          CSE026
133400200610     C                     KFLD           DCINVT                          CSE026
133500200610     C/COPY WNCPYSRC,SE2380C061
133600200610     C                     KFLD           DCCUST                          CSE026
133700200610     C*                                                                   S01519
133800200610     C** List for security details                                        S01519
133900200610     C*                                                                   S01519
134000200610     C           @CCOD     KLIST                                          S01519
134100200610     C                     KFLD           @CCY                            S01519
134200200610     C                     KFLD           @CAM    2                       S01519
134300200610     C*                                                                   S01486
134400200610     C* PM CHANGED POSITION DETAILS              PF/PMBVALPD              S01486
134500200610     C           BVALKY    KLIST                                          S01486
134600200610     C                     KFLD           WBCB                            S01486
134700200610     C                     KFLD           WSS                             S01486
134800200610     C                     KFLD           WDP                             S01486
134900200610     C                     KFLD           WPTFR                           S01486
135000200610     C                     KFLD           WACTDT                          S01486
135100200610     C*                                                                   S01486
135200200610     C* PM CHANGED POSITION DETAILS              PF/PMBVALP1              S01486
135300200610     C           BVALK1    KLIST                                          S01486
135400200610     C                     KFLD           ZCSBR                           S01486
135500200610     C                     KFLD           ZSSNM                           S01486
135600200610     C**********           KFLD           XCUST   60                                   S01486 CSD027
135700200610     C                     KFLD           XCUST   6                                           CSD027
135800200610     C                     KFLD           ZPTFR                           S01486
135900200610     C                     KFLD           ZFMDAT                          S01486
136000200610     C*                                                                   S01486
136100200610     C** ACCOUNT DETAILS PMACCNL0                                         S01486
136200200610     C           ACCNTP    KLIST                                          S01486
136300200610     C                     KFLD           WZCNUM                          S01486
136400200610     C                     KFLD           WZCCY                           S01486
136500200610     C                     KFLD           WZPTFR                          S01486
136600200610     C                     KFLD           WZACSQ  20                      S01486
136700200610     C*                                                                   219688
136800200610     C** ACCOUNT DETAILS PMACCNL1                                         219688
136900200610     C           ACCNTL    KLIST                                          219688
137000200610     C                     KFLD           WZCNUM                          219688
137100200610     C                     KFLD           WZPTFR                          219688
137200200610     C                     KFLD           WZCCY                           219688
137300200610     C                     KFLD           WZACOD                          219688
137400200610     C                     KFLD           WZACSQ                          219688
137500200610     C*                                                                   S01486
137600200610     C** PORTFOLIO DETAILS PMPORTPD                                       S01486
137700200610     C           PMPORT    KLIST                                          S01486
137800200610     C**********           KFLD           WWCNU1  60                                   S01486 CSD027
137900200610     C                     KFLD           WWCNU1  6                                           CSD027
138000200610     C                     KFLD           WWPTF1  4                       S01486
138100200610     C*                                                                   S01486
138200200610      ** Key to ACCNTAB                                                   136297
138300200610      *                                                                   136297
138400200610     C           KEYACC    KLIST                                          136297
138500200610     C**********           KFLD           KYCNUM  60                                   136297 CSD027
138600200610     C                     KFLD           KYCNUM  6                                           CSD027
138700200610     C                     KFLD           KYCCY   3                       136297
138800200610     C**********           KFLD           KYACOD  40                                   136297 CGL029
138900200610     C                     KFLD           KYACOD 100                                          CGL029
139000200610     C                     KFLD           KYACSQ  20                      136297
139100200610     C                     KFLD           KYBRCA  3                       136297
139200200610      *                                                                                     BUG11104
139300200610      ** Key to diary event details                                                         BUG11104
139400200610      *                                                                                     BUG11104
139500200610     C           P4KEY     KLIST                                                            BUG11104
139600200610     C                     KFLD           WWSDSN 10                                         BUG11104
139700200610     C                     KFLD           WWSDET  2                                         BUG11104
139800200610     C                     KFLD           SDED                                              BUG11104
139900200610     C*                                                                   S01117
140000200610     C/COPY WNCPYSRC,SE2380C020
140100200610     C           *ENTRY    PLIST                                          E15549
140200200610     C                     PARM           ACRLRN  1                       E15549
140300200610     C*
140400200610     C* ACCESS ICD INFORMATION
140500200610     C*
140600200610     C                     MOVE *BLANK    DBLOT
140700200610     C                     Z-ADD0         DBASE
140800200610      *** Correct setup of DBPGM
140900200610     C***********          MOVE 'SE2380  'DBPGM
141000200610     C                     MOVE *BLANKS   DBPGM
141100200610     C                     MOVEL'SE2380'  DBPGM
141101200616     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
141102200616     C                     IN   SDSTAT                                                      AR324886
141200200610     C*                                                                   S01447
141300200610     C                     EXSR FIRST
141400200610     C*                                                                   S01447
141500200610     C* CHECK FOR DATABASE ERRORS
141600200610     C*
141700200610     C           *IN99     IFEQ '1'
141800200610     C                     GOTO EAUDIT
141900200610     C                     END
142000200610     C*                                                                   E15549
142100200610     C** SET EVENT CONTROL DATE ACCORDING TO RUN (SEE SE2100)             E15549
142200200610     C*                                                                   E15549
142300200610     C           ACRLRN    IFNE '3'                                       E15549
142400200610     C                     Z-ADDDNWD      ECD     50                      E15549
142500200610     C                     ELSE                                           E15549
142600200610     C                     Z-ADDAPDA      ECD                             E15549
142700200610     C                     END                                            E15549
142800200610     C*
142900200610     C* DEFINE AND CLEAR WORK FIELDS
143000200610     C*
143100200610     C           *LIKE     DEFN CSDA      WACTDT
143200200610     C           *LIKE     DEFN CSDA      WDT
143300200610     C           *LIKE     DEFN CSDA      WLASTD
143400200610     C           *LIKE     DEFN CSDA      WLCSDA
143500200610     C           *LIKE     DEFN CSDA      STGDAT
143600200610     C           *LIKE     DEFN CSDA      WPRTDT
143700200610     C           *LIKE     DEFN CSDA      WCOMPD
143800200610     C           *LIKE     DEFN CDBA      WDBASE
143900200610     C           *LIKE     DEFN CPMV      WTYPE
144000200610     C           *LIKE     DEFN CRIN      WREVER
144100200610     C*
144200200610     C           *LIKE     DEFN CSSC      WCSSC
144300200610     C           *LIKE     DEFN CSCN      WCSCN
144400200610     C************LIKE     DEFN CSBR      WCSBR                           S01117
144500200610     C           *LIKE     DEFN CSBA      WCSBA                           S01117
144600200610     C           *LIKE     DEFN CSDA      WCSDA
144700200610     C           *LIKE     DEFN RECI      WSRECI
144800200610     C           *LIKE     DEFN CFCT      CFDIF                           052254
144900200610      *                                                                                       CGL031
145000200610     C           *LIKE     DEFN CSPI      WCSPI                                               CGL031
145100200610     C           *LIKE     DEFN CSPI      WCSPIP                                              CGL031
145200200610     C*
145300200610     C** DEFINE ACCUMULATOR FIELDS FOR ACTIONS ON ONE DATE
145400200610     C*
145500200610     C           *LIKE     DEFN CSNT      WCSNT
145600200610     C           *LIKE     DEFN CSNV      WCSNV
145700200610     C           *LIKE     DEFN CSNS      WCSNS
145800200610     C           *LIKE     DEFN CSEX      WCSEX
145900200610     C*
146000200610     C** DEFINE ACCUMULATOR FIELDS FOR ACTIONS ON ONE POSITION
146100200610     C*
146200200610     C           *LIKE     DEFN CSNT      WCSNTP
146300200610     C           *LIKE     DEFN CSNV      WCSNVP
146400200610     C           *LIKE     DEFN CSNS      WCSNSP
146500200610     C           *LIKE     DEFN CSEX      WCSEXP
146600200610     C           *LIKE     DEFN CSDA      WNEXTD
146700200610     C********** *LIKE     DEFN BASC      UBASC                                 AR1001183 AR1001183A
146800200610     C********** *LIKE     DEFN BASS      UBASS                                 AR1001183 AR1001183A
146900200610     C********** *LIKE     DEFN SPRI      USPRI                                 AR1001183 AR1001183A
147000200610     C********** *LIKE     DEFN RDMT      URDMT                                 AR1001183 AR1001183A
147100200610     C********** *LIKE     DEFN RDFD      URDFD                                 AR1001183 AR1001183A
147200200610     C********** *LIKE     DEFN CNSP      UCNSP                                 AR1001183 AR1001183A
147300200610     C********** *LIKE     DEFN CNSG      UCNSG                                 AR1001183 AR1001183A
147400200610     C***********          Z-ADD0         WBC                             S01117
147500200610     C                     MOVE *BLANKS   WBC                             S01117
147600200610     C***********          Z-ADD0         WSBC                            S01117
147700200610     C                     MOVE *BLANKS   WSBC                            S01117
147800200610     C**********           Z-ADD0         WDP                                                 CSD027
147900200610     C**********           Z-ADD0         WSDP                                                CSD027
148000200610     C                     MOVE *BLANKS   WDP                                                 CSD027
148100200610     C                     MOVE *BLANKS   WSDP                                                CSD027
148200200610     C                     Z-ADD0         RECT
148300200610     C                     Z-ADD0         RCDE
148400200610     C***********          Z-ADD0         WBRCDE                          S01117
148500200610     C                     MOVE *BLANKS   WBRCDE                          S01117
148600200610     C                     MOVE '1'       WLITA
148700200610     C                     MOVE 'A'       WRTYP                           S01447
148800200610      *                                                                                     AR853119
148900200610     C                     CALL 'AOBANKR0'                                                  AR853119
149000200610     C                     PARM *BLANKS   @RTCD                                             AR853119
149100200610     C                     PARM '*FIRST  '@OPTN                                             AR853119
149200200610     C           SDBANK    PARM SDBANK    DSFDY                                             AR853119
149300200610      *                                                                                     AR853119
149400200610     C           @RTCD     IFNE *BLANK                                                      AR853119
149500200610     C           *LOCK     IN   LDA                                                         AR853119
149600200610     C                     Z-ADD33        DBASE                                             AR853119
149700200610     C                     MOVE *BLANKS   DBFILE                                            AR853119
149800200610     C                     MOVEL'SDBANKPD'DBFILE    P                                       AR853119
149900200610     C                     MOVEL'*FIRST  'DBKEY     P                                       AR853119
150000200610     C                     MOVEL'SE2380'  DBPGM     P                                       AR853119
150100200610     C                     OUT  LDA                                                         AR853119
150200200610     C                     EXSR *PSSR                                                       AR853119
150300200610     C                     ENDIF                                                            AR853119
150400200610      *                                                                                     AR853119
150500200610     C*                                                                   095066
150600200610     C*** Check if Value date position is to be used for Dividend.        095066
150700200610     C*                                                                   095066
150800200610     C                     CALL 'AOSARDR0'                                095066
150900200610     C                     PARM '       ' @RTCD   7                       095066
151000200610     C                     PARM '*VERIFY' @OPTN   7                       095066
151100200610     C                     PARM 'CSE008'  @SARD   6                       095066
151200200610     C*                                                                   095066
151300200610     C           @RTCD     IFEQ *BLANK                                    095066
151400200610     C                     MOVE 'Y'       CSE008  1                       095066
151500200610     C                     ELSE                                           095066
151600200610     C                     MOVE 'N'       CSE008  1                       095066
151700200610     C                     ENDIF                                          095066
151800200610     C*
151900200610     C* LOOP ROUND PROCESSING FOR EACH ACTION RECORD READ LF/UDPAC
152000200610     C*
152100200610     C           *IN89     DOWEQ'0'
152200200610     C*
152300200610     C** SETOF RECORD IDENTIFYING INDICAT'S FOR ACTION FILE 01,02,03,04
152400200610     C*
152500200610     C                     MOVEA'0000'    *IN,01
152600200610     C*
152700200610     C* READ ACTION FILE OF CUST. MOVEMENTS
152800200610     C*
152900200610     C                     READ CSPAC                    89
153000200610     C*
153100200610     C* IF NOT END OF FILE & IF DELETED RECORD IGNORE
153200200610     C*
153300200610     C           *IN89     IFEQ '0'
153400200610     C           RECI      ANDEQ'*'
153500200610     C                     GOTO ENDLP
153600200610     C                     END
153700200610     C*
153800200610     C* OR IF NOT END OF FILE AND EVENT DATE EQUALS DATE NEXT WORKING
153900200610     C* DAY THEN ADD TO COUNT AND IGNORE
154000200610     C*
154100200610     C           *IN89     IFEQ '0'
154200200610     C   01                Z-ADDCADA      WACTDT
154300200610     C   02                Z-ADDSEDE      WACTDT
154400200610     C   03                Z-ADDEVTD      WACTDT
154500200610     C           WACTDT    IFEQ DNWD
154600200610     C           *IN03     OREQ '1'                                       S01269
154700200610     C           ACTS      ANDEQ'11'                                      S01269
154800200610     C   01                ADD  1         WCCMVT  50
154900200610     C   02                ADD  1         WCSETT
155000200610     C   03                ADD  1         WCTRAD
155100200610     C                     GOTO ENDLP
155200200610     C                     END
155300200610     C                     END
155400200610     C*
155500200610     C* AT END OF FILE - DO UPDATES FOR LAST DATE AND LAST POSITION
155600200610     C*
155700200610     C           *IN89     IFEQ '1'
155800200610     C*                                                                   S01486
155900200610     C** OUTPUT LAST SET OF POSITION DETAILS IF REQUIRED                  S01486
156000200610     C           BGPFMG    IFEQ 'Y'                                       S01486
156100200610     C           BGN4ST    OREQ 'Y'                                       CPB002
156200200610     C*                                                                   S01486
156300200610     C           GGCSNT    IFNE 0                                         S01486
156400200610     C           GGCSNV    ORNE 0                                         S01486
156500200610     C           GGCSEX    ORNE 0                                         S01486
156600200610     C                     WRITEPMBVALD0                                  S01486
156700200610     C                     END                                            S01486
156800200610     C*                                                                   S01486
156900200610     C                     END                                            S01486
157000200610     C*
157100200610     C*   END OF FILE - EXECUTE CHANGE OF POSITION SUBROUTINE
157200200610     C*
157300200610     C                     EXSR CH01
157400200610     C                     GOTO ENDLP
157500200610     C                     END
157600200610     C*
157700200610     C** DETERMINE RECORD TYPE AND ADD TO COUNTER FOR EACH TYPE
157800200610     C*    CUST. MOVEMENTS COUNT
157900200610     C*
158000200610     C           *IN01     IFEQ '1'
158100200610     C                     ADD  1         WCCMVT  50
158200200610     C*
158300200610     C* MOVE KEYS AND DATE TO DATA STRUCTURE FOR COMPARISON
158400200610     C*
158500200610     C***********          MOVE CPBC      WBC                             S01117
158600200610     C                     MOVE CPBA      WBC                             S01117
158700200610     C                     MOVE CPSS      WSS
158800200610     C*                    Z-ADDCDEP      WDP
158900200610     C**********           Z-ADDCCRT      WDP                                                 CSD027
159000200610     C                     MOVE CCRT      WDP                                                 CSD027
159100200610     C                     Z-ADDCADA      WACTDT
159200200610     C                     MOVE CDBA      WDBASE
159300200610     C                     MOVE CPMV      WTYPE
159400200610     C                     MOVE CRIN      WREVER
159500200610     C                     END
159600200610     C*
159700200610     C*  SETTLEMENTS COUNT
159800200610     C*
159900200610     C           *IN02     IFEQ '1'
160000200610     C                     ADD  1         WCSETT  50
160100200610     C*
160200200610     C* MOVE KEYS AND DATE TO DATA STRUCTURE FOR COMPARISON
160300200610     C*
160400200610     C***********          MOVE SBCD      WBC                             S01117
160500200610     C                     MOVE SBCA      WBC                             S01117
160600200610     C                     MOVE SSSN      WSS
160700200610     C*                    Z-ADDSODP      WDP
160800200610     C**********           Z-ADDSCPT      WDP                                                 CSD027
160900200610     C                     MOVE SCPT      WDP                                                 CSD027
161000200610     C                     Z-ADDSEDE      WACTDT
161100200610     C                     MOVE 'S'       WDBASE
161200200610     C                     MOVE STET      WTYPE
161300200610     C                     MOVE SRIN      WREVER
161400200610     C                     END
161500200610     C*
161600200610     C*  TRADE ACTIONS COUNT
161700200610     C*
161800200610     C           *IN03     IFEQ '1'
161900200610     C                     ADD  1         WCTRAD  50
162000200610     C*
162100200610     C* MOVE KEYS AND DATE TO DATA STRUCTURE FOR COMPARISON
162200200610     C*
162300200610     C***********          MOVE TDBR      WBC                             S01117
162400200610     C                     MOVE TDBA      WBC                             S01117
162500200610     C                     MOVE TDSS      WSS
162600200610     C**********           Z-ADDTRCP      WDP                                                 CSD027
162700200610     C                     MOVE TRCP      WDP                                                 CSD027
162800200610     C                     Z-ADDEVTD      WACTDT
162900200610     C                     MOVE TVDA      WDBASE
163000200610     C                     MOVE '  '      WTYPE
163100200610     C                     MOVE PRSL      WTYPE
163200200610     C                     MOVE RVLI      WREVER
163300200610     C                     END
163400200610     C*                                                                   S01486
163500200610     C** IF TRADE OR DEPOT MOVEMENT ACTION FOR A PORTFOLIO POSITION       S01486
163600200610     C** UPDATE PORTFOLIO DETAILS                                         S01486
163700200610     C*                                                                   S01486
163800200610     C           BGPFMG    IFEQ 'Y'                                       S01486
163900200610     C           BGN4ST    OREQ 'Y'                                       CPB002
164000200610     C*                                                                   S01486
164100200610     C           *IN01     IFEQ '1'                                       S01486
164200200610     C           *IN03     OREQ '1'                                       S01486
164300200610     C           WPTFR     IFNE *BLANKS                                   S01486
164400200610     C                     EXSR WRITPM                                    S01486
164500200610     C                     END                                            S01486
164600200610     C                     END                                            S01486
164700200610     C*                                                                   S01486
164800200610     C                     END                                            S01486
164900200610      *                                                                   S01447
165000200610      *** IF THE BOOKING BRANCH READ IS DIFFERENT FROM PREVIOUS RECORD,   S01447
165100200610      *** GET COUNTRY LOCATION OF BRANCH.                                 S01447
165200200610      *                                                                   S01447
165300200610     C           WBC       IFNE WSBC                                      S01447
165400200610     C                     EXSR GETCTY                                    S01447
165500200610     C                     END                                            S01447
165600200610     C*
165700200610     C** COMPARE KEY AND DATE TO STORED KEY AND DATE
165800200610     C*
165900200610     C* CHANGE OF POSITION - PROCESS CHG OF DATE, LAST POSN & NEXT POSN
166000200610     C*
166100200610     C           COMARA    IFNE STGARA
166200200610     C*
166300200610     C*  CHANGE POSITION - EXECUTE CHANGE OF POSITION SUBROUTINE
166400200610     C*
166500200610     C                     EXSR CH01
166600200610     C*
166700200610     C** GET LATEST DATE FOR THE POSITION IN SUBR NW01
166800200610     C*
166900200610     C                     EXSR NW01
167000200610     C*                                                                   E21430
167100200610     C** ON CHANGE OF SECURITY ENSURE THAT SECURITIES AND INVESTMENT      E21430
167200200610     C*  TYPES FILES ARE ACCESSED                                         E21430
167300200610     C*                                                                   E21430
167400200610     C           WSS       IFNE WSSS                                      E21430
167500200610     C                     MOVE WSS       WCSSC                           E21430
167600200610     C                     EXSR SECTIN                                    E21430
167700200610     C                     EXSR INVTIN                                    E21430
167800200610     C                     END                                            E21430
167900200610     C*
168000200610     C                     ELSE
168100200610     C*
168200200610     C** PROCESS CHANGE OF DATE WITHIN SAME POSITION
168300200610     C*
168400200610     C           WACTDT    IFNE STGDAT
168500200610     C*
168600200610     C**  ON CHANGE OF DATE PROCESS PREVIOUS DATES ACTIONS FOR POSN.
168700200610     C*
168800200610     C                     EXSR CH02
168900200610     C*
169000200610     C**  ON CHANGE OF DATE GET BASE POSITION FOR THIS DATE
169100200610     C*
169200200610     C                     EXSR NW02
169300200610     C*
169400200610     C                     END
169500200610     C                     END
169600200610     C*
169700200610     C** NOW PROCESS ACTION RECORD READ BY ACCUMULATING CHANGES
169800200610     C*
169900200610     C*   ACCUMULATE
170000200610     C*
170100200610     C                     EXSR ACCUM
170200200610     C*
170300200610     C*  MOVE KEY AND DATE OF RECORD IN TO KE/DATE OF LAST RECORD IN
170400200610     C*
170500200610     C                     MOVE COMARA    STGARA
170600200610     C                     Z-ADDWACTDT    STGDAT
170700200610     C           BGPFMG    IFEQ 'Y'                                       S01486
170800200610     C           BGN4ST    OREQ 'Y'                                       CPB002
170900200610     C                     MOVE WPTFR     WPTFRS  4                       S01486
171000200610     C                     END                                            S01486
171100200610     C           ENDLP     TAG                             ** ENDLP **
171200200610     C*
171300200610     C                     END
171400200610     C*                                                                   S01486
171500200610     C** GENERATE PORTFOLIO POSITION SETTLEMENT                           S01486
171600200610     C           BGPFMG    IFEQ 'Y'                                       S01486
171700200610     C           BGN4ST    OREQ 'Y'                                       CPB002
171800200610     C                     EXSR GENPTF                                    S01486
171900200610     C                     END                                            S01486
172000200610     C*
172100200610     C* ACCESS CDPMVA AUDIT RECORD FOR CUST. MOVEMENT ACTIONS
172200200610     C*
172300200610     C                     READ CDPMVA                   79
172400200610     C********** *IN79     IFNE '1'                                       E15035
172500200610     C********** RECI      ANDEQ'*'                                       E15035
172600200610     C**********           MOVE '1'       *IN79                           E15035
172700200610     C**********           END                                            E15035
172800200610     C*
172900200610     C* DATA BASE ERROR
173000200610     C*
173100200610     C           *IN79     IFEQ '1'
173200200610     C           *LOCK     IN   LDA                                       S01117
173300200610     C                     MOVEL'CDPMVA'  DBFILE           ***************
173400200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 04 *
173500200610     C                     Z-ADD4         DBASE            ***************
173600200610     C                     SETON                       U7U8
173700200610     C                     DUMP                                           S01117
173800200610     C                     GOTO EAUDIT
173900200610     C                     END
174000200610     C                     Z-ADDNORE      DCNORE  50
174100200610     C*
174200200610     C* ACCESS SETACA AUDIT RECORD FOR SETTLEMENT ACTIONS
174300200610     C*
174400200610     C                     READ SETACA                   79
174500200610     C********** *IN79     IFNE '1'                                       E15035
174600200610     C********** RECI      ANDEQ'*'                                       E15035
174700200610     C**********           MOVE '1'       *IN79                           E15035
174800200610     C**********           END                                            E15035
174900200610     C*
175000200610     C* DATA BASE ERROR
175100200610     C*
175200200610     C           *IN79     IFEQ '1'
175300200610     C           *LOCK     IN   LDA                                       S01117
175400200610     C                     MOVEL'SETACA'  DBFILE           ***************
175500200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 05 *
175600200610     C                     Z-ADD5         DBASE            ***************
175700200610     C                     SETON                       U7U8
175800200610     C                     DUMP                                           S01117
175900200610     C                     GOTO EAUDIT
176000200610     C                     END
176100200610     C                     Z-ADDNORE      DSNORE  50
176200200610     C*
176300200610     C* ACCESS TRDACA AUDIT RECORD FOR TRADE ACTIONS
176400200610     C*
176500200610     C                     READ TRDACA                   79
176600200610     C********** *IN79     IFNE '1'                                       E15035
176700200610     C********** RECI      ANDEQ'*'                                       E15035
176800200610     C**********           MOVE '1'       *IN79                           E15035
176900200610     C**********           END                                            E15035
177000200610     C*
177100200610     C* DATA BASE ERROR
177200200610     C*
177300200610     C           *IN79     IFEQ '1'
177400200610     C           *LOCK     IN   LDA                                       S01117
177500200610     C                     MOVEL'TRDACA'  DBFILE           ***************
177600200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 06 *
177700200610     C                     Z-ADD6         DBASE            ***************
177800200610     C                     SETON                       U7U8
177900200610     C                     DUMP                                           S01117
178000200610     C                     GOTO EAUDIT
178100200610     C                     END
178200200610     C           NORT      ADD  NRDT      TRNORE  50
178300200610     C           EAUDIT    TAG                             ** EAUDIT **
178400200610     C*
178500200610     C* OUTPUT RUN CONTROL REPORT
178600200610     C*
178700200610     C                     EXSR AUDIT
178800200610      *
178900200610      *================================================================
179000200610      *  P R O G R A M   E N D                                        *
179100200610      *                                                               *
179200200610     C***********          OUT  LDA                                       S01117
179300200610     C/COPY WNCPYSRC,SE2380C036
179400200610     C                     SETON                     LR
179500200610      *                                                               *
179600200610      *================================================================
179700200610      /EJECT
179800200610      *****************************************************************   S01447
179900200610      *                                                               *   S01447
180000200610      *  GETCTY - Get Country of Branch                               *   S01447
180100200610      *                                                               *   S01447
180200200610      *  CALLED FROM: MAIN                                            *   S01447
180300200610      *                                                               *   S01447
180400200610      *****************************************************************   S01447
180500200610      *                                                                   S01447
180600200610     C           GETCTY    BEGSR                                          S01447
180700200610      *                                                                   S01447
180800200610     C**********           CALL 'AOBRCHR0'                                             S01447 CGL029
180900200610     C                     CALL 'AOBRCHR1'                                                    CGL029
181000200610     C                     PARM *BLANKS   @RTCD   7                       S01447
181100200610     C                     PARM '*KEY   ' @OPTN   7                       S01447
181200200610     C                     PARM WBC       @BRCD   3                       S01447
181300200610     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01447 CGL029
181400200610     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
181500200610      *                                                                   S01447
181600200610     C           @RTCD     IFNE *BLANKS                    *B1            S01447
181700200610     C           *LOCK     IN   LDA                                       S01447
181800200610     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01447
181900200610     C                     MOVELWBC       DBKEY            ** DBERROR 023 S01447
182000200610     C                     Z-ADD23        DBASE            ***************S01447
182100200610     C                     SETON                       U7U8               S01447
182200200610     C                     EXSR *PSSR                                     S01447
182300200610     C                     GOTO EAUDIT                                    S01447
182400200610     C                     ELSE                            *X1            S01447
182500200610      *                                                                   S01447
182600200610     C                     MOVE A8BICN    WCUST                           S01447
182700200610     C           CLKYCB    CHAINCLINT                54    *B2            S01447
182800200610     C           *IN54     IFEQ '1'                                       S01447
182900200610     C           RECI      OREQ '*'                        ***************S01447
183000200610     C           *LOCK     IN   LDA                                       S01447
183100200610     C                     Z-ADD24        DBASE            * DBERROR 024 *S01447
183200200610     C                     MOVEL'CLINTCBF'DBFILE           ***************S01447
183300200610     C                     MOVELA8BICN    DBKEY                           S01447
183400200610     C                     SETON                       U7U8               S01447
183500200610     C                     EXSR *PSSR                                     S01447
183600200610     C                     GOTO EAUDIT                                    S01447
183700200610     C                     ELSE                            *X2            S01447
183800200610      *                                                                   S01447
183900200610     C                     MOVE CLOC      UBRLOC                          S01447
184000200610     C                     END                             *E2            S01447
184100200610     C                     END                             *E1            S01447
184200200610      *                                                                   S01447
184300200610     C                     ENDSR                                          S01447
184400200610      *****************************************************************   S01447
184500200610      /EJECT                                                              S01447
184600200610     C*****************************************************************
184700200610     C*                                                               *
184800200610     C* CH01  - SUBROUTINE TO DEAL WITH END OF POSITION               *
184900200610     C*                                                               *
185000200610     C*****************************************************************
185100200610     C*
185200200610     C           CH01      BEGSR                           ** CH01  **
185300200610     C*
185400200610     C* UPDATE FOR LAST ACTION READ AND EXISTING POSITIONS AFTER
185500200610     C* FIRST, PROCESS ONLY IF THE END OF FILE CONDITION - 89 IS ON
185600200610     C*
185700200610     C           *IN89     IFEQ '1'
185800200610     C           WSS       IFNE *BLANK
185900200610     C*
186000200610     C**  ON CHANGE OF POSN ADD LAST DATE ACCUMULATORS TO POSITION CHGS
186100200610     C*
186200200610     C                     EXSR ADDDAT
186300200610     C*
186400200610     C           WEQUAL    IFEQ '1'
186500200610     C           WLASTD    ANDNE0
186600200610     C                     Z-ADDSTGDAT    WCOMPD
186700200610     C                     EXSR U01
186800200610     C                     ELSE
186900200610     C                     EXSR W01
187000200610     C                     END
187100200610     C*
187200200610     C* EXECUTE ADJUST A/C KEYS/POSN.SETT. SUBR - P/SEC
187300200610     C*
187400200610     C                     Z-ADDSTGDAT    WFRMDT  60
187500200610     C*
187600200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
187700200610     C* OR DATE OF LAST POSITION WHICHEVER IS LOWEST
187800200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
187900200610     C* (DATE OF LAST POSITION MAY NOT BE THE LATEST POSITION BECAUSE IT  E15549
188000200610     C*  IS OBTAINED PRIOR TO MOVEMENT UPDATES. CHECK THIS IS NOT SO)     E15549
188100200610     C*
188200200610     C           WLASTD    IFGT STGDAT                                    E15449
188300200610     C                     Z-ADDWLASTD    WTODAT  60
188400200610     C                     EXSR NEXT
188500200610     C                     Z-ADDWNEXTD    WTODAT  60
188600200610     C                     EXSR SEC
188700200610     C                     END                                            E15449
188800200610     C*
188900200610     C* EXECUTE CHANGE OF POSITION SUBROUTINE
189000200610     C*
189100200610     C*  UPDATE CUST. POSITION RECORDS FROM LAST DATE UPDATED TO MOST
189200200610     C*  RECENT.
189300200610     C*
189400200610     C                     EXSR CHGPOS
189500200610     C                     END
189600200610     C                     ELSE
189700200610     C*
189800200610     C* IF ACTION DATE EQUALS POSITION RECORD DATE OR NXT WRKING DAY
189900200610     C* THEN UPDATE IN SUBR U02, ELSE ADD POSITION RECORD IN SUBR W01
190000200610     C* NB. ON FIRST POSITION, DO NOT EXSR U02/W01/CHGPOS
190100200610     C*
190200200610     C           WSSS      IFNE *BLANK
190300200610     C*
190400200610     C**  ON CHANGE OF POSN ADD LAST DATE ACCUMULATORS TO POSITION CHGS
190500200610     C*
190600200610     C                     EXSR ADDDAT
190700200610     C           STGDAT    IFEQ CSDA
190800200610     C           WLASTD    ANDNE0
190900200610     C                     Z-ADDSTGDAT    WCOMPD
191000200610     C                     EXSR U01
191100200610     C                     ELSE
191200200610     C                     EXSR W01
191300200610     C                     END
191400200610     C*
191500200610     C* EXECUTE ADJUST A/C KEYS/POSN.SETT. SUBR - P/SEC
191600200610     C*
191700200610     C                     Z-ADDSTGDAT    WFRMDT
191800200610     C*
191900200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
192000200610     C* OR DATE OF LAST POSITION WHICHEVER IS LOWEST
192100200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
192200200610     C* (DATE OF LAST POSITION MAY NOT BE THE LATEST POSITION BECAUSE IT  E15549
192300200610     C*  IS OBTAINED PRIOR TO MOVEMENT UPDATES.CHECK THIS IS NOT SO)      E15549
192400200610     C*
192500200610     C           WLASTD    IFGT STGDAT                                    E15549
192600200610     C                     Z-ADDWLASTD    WTODAT  60
192700200610     C                     EXSR NEXT
192800200610     C                     Z-ADDWNEXTD    WTODAT  60
192900200610     C                     EXSR SEC
193000200610     C                     END                                            E15549
193100200610     C*
193200200610     C* EXECUTE CHANGE OF POSITION SUBROUTINE
193300200610     C*
193400200610     C                     EXSR CHGPOS
193500200610     C                     END
193600200610     C                     END
193700200610     C*
193800200610     C                     ENDSR
193900200610      *
194000200610      *****************************************************************
194100200610      /EJECT
194200200610      *****************************************************************
194300200610      *                                                               *
194400200610      *  NW01   - NEW POSITION READ IN - GET NEWEST DATE FOR THIS     *
194500200610      *           POSITION AND THEN ESTABLISH LATEST DATE HELD FOR THIS
194600200610      *           NEW DATE READ IN.(I.E. BALANCE AS AT DATE READ IN)  *
194700200610      *                                                               *
194800200610      *****************************************************************
194900200610      *
195000200610     C           NW01      BEGSR                            ** NW01 **
195100200610     C*
195200200610     C* GET LATEST DATE FOR THIS NEW POSITION
195300200610     C*
195400200610     C** CONSTRUCT KEY TO CUST. POSITIONS HIST/CURR LF/CPOSH
195500200610     C*
195600200610     C** INCREMENT COUNT OF POSITIONS FOR NEW POSITION
195700200610     C*
195800200610     C                     ADD  1         WCPOSN  50
195900200610     C***********          MOVE WBC       CSBR                            S01117
196000200610     C                     MOVE WBC       CSBA                            S01117
196100200610     C                     MOVE WSS       CSSC
196200200610     C                     MOVE WDP       CSCN
196300200610     C                     MOVE *HIVAL    WDT
196400200610     C           CPHKEY    SETGTCPOSH
196500200610     C*
196600200610     C           RDLOOP    TAG                             ** RDLOOP **
196700200610     C*
196800200610     C                     READPCPOSH                    77
196900200610     C*
197000200610     C*  IF DELETED RECORD GO TO RDLOOP AND READ NEXT PREVIOUS RCD
197100200610     C*
197200200610     C           *IN77     IFEQ '0'
197300200610     C           RECI      CABEQ'*'       RDLOOP
197400200610     C                     END
197500200610     C*
197600200610     C*  IF BEGINNING OF FILE - NO POSITION YET FOR SECURITY
197700200610     C*
197800200610     C           *IN77     IFEQ '1'
197900200610     C                     EXSR NOPOSN
198000200610     C                     GOTO POSVAL
198100200610     C                     END
198200200610     C*
198300200610     C* CHECK IF RECORD RETRIEVED IS SAME AS ACTION RECORD KEY
198400200610     C* ELSE NO POSITION FOR SECURITY - EXSR NOPOSN
198500200610     C*
198600200610     C***********WBC       IFNE CSBR                                      S01117
198700200610     C           WBC       IFNE CSBA                                      S01117
198800200610     C           WSS       ORNE CSSC
198900200610     C           WDP       ORNE CSCN
199000200610     C                     EXSR NOPOSN
199100200610     C                     GOTO POSVAL
199200200610     C                     END
199300200610     C*
199400200610     C** STORE LAST POSITION DATE HELD ON FILE IN WLASTD FIELD
199500200610     C*
199600200610     C                     Z-ADDCSDA      WLASTD
199700200610     C*
199800200610     C** IF NEW DATE IN FOR THIS POSITION IS GREATER THAN LAST DATE
199900200610     C** FOR THIS POSITION AND ACTION DATE IS NOT EQUAL TO DATE NEXT
200000200610     C** WORKING DAY, UPDATE THIS LAST RECORD TO REC.ID = H HISTORY
200100200610     C*
200200200610     C           WACTDT    IFGT CSDA
200300200610     C                     MOVE 'H'       RECI
200400200610     C                     UPDATCPOSNDF
200500200610     C                     END
200600200610     C*
200700200610     C*   - OBTAIN LATEST CORRECT POSITION DATE AND BALANCES
200800200610     C*     FOR EACH POSITION WITH ACTIONS TODAY
200900200610     C*
201000200610     C           POSVAL    TAG                             **POSVAL**
201100200610     C*
201200200610     C** CONSTRUCT KEY TO CUST. POSITIONS HIST/CURR LF/CPOSH
201300200610     C*
201400200610     C                     Z-ADD*ZERO     WLCSDA                          E29307
201500200610     C***********          MOVE WBC       CSBR                            S01117
201600200610     C                     MOVE WBC       CSBA                            S01117
201700200610     C                     MOVE WSS       CSSC
201800200610     C                     MOVE WDP       CSCN
201900200610     C                     Z-ADDWACTDT    WDT
202000200610     C           CPHKEY    SETLLCPOSH                    77
202100200610     C*
202200200610     C           *IN77     IFEQ '1'
202300200610     C           CPHKEY    READECPOSH                    77
202400200610     C*
202500200610     C**  DATES ARE EQUAL - SET FLAG TO INDICATE THIS - SEE W01 SUBR
202600200610     C*
202700200610     C           RECI      IFNE '*'
202800200610     C                     Z-ADDCSDA      WLCSDA                          E29307
202900200610     C                     MOVE '1'       WEQUAL  1
203000200610     C                     GOTO ENDNW1
203100200610     C                     END
203200200610     C                     ELSE
203300200610     C                     MOVE '0'       WEQUAL
203400200610     C                     END
203500200610     C*
203600200610     C** SEARCH FOR NEXT EARLIEST DATE EQUAL OR BEFORE ACTION DATE
203700200610     C*
203800200610     C           RPLOOP    TAG                             ** RPLOOP**
203900200610     C*
204000200610     C                     READPCPOSH                    77
204100200610     C  N77      RECI      CABEQ'*'       RPLOOP
204200200610     C*
204300200610     C** IF BEGINNING OF FILE ITS FOR FIRST DATE OF FIRST POSITION
204400200610     C*
204500200610     C           *IN77     IFEQ '1'
204600200610     C                     EXSR CLRUPD
204700200610     C                     GOTO ENDNW1
204800200610     C                     END
204900200610     C*
205000200610     C* CHECK IF RECORD RETRIEVED IS SAME AS ACTION RECORD KEY
205100200610     C* ELSE ZEROISE FIELDS IN FILE LAYOUT CPOSNDF
205200200610     C*
205300200610     C***********WBC       IFNE CSBR                                      S01117
205400200610     C           WBC       IFNE CSBA                                      S01117
205500200610     C           WSS       ORNE CSSC
205600200610     C           WDP       ORNE CSCN
205700200610     C                     READ CPOSH                    77               E15426
205800200610     C           WACTDT    IFNE CSDA                                      E15426
205900200610     C                     EXSR CLRUPD
206000200610     C                     ELSE                                           E29307
206100200610     C                     Z-ADDCSDA      WLCSDA                          E29307
206200200610     C                     END                                            E15426
206300200610     C***********          MOVE WBC       CSBR                            S01117
206400200610     C                     MOVE WBC       CSBA                            S01117
206500200610     C                     MOVE WSS       CSSC
206600200610     C                     MOVE WDP       CSCN
206700200610     C                     END
206800200610     C*
206900200610     C           ENDNW1    ENDSR                           ** ENDNW1 **
207000200610      *
207100200610      *****************************************************************
207200200610      /EJECT
207300200610      *****************************************************************
207400200610      *                                                               *
207500200610      *  CH02   - CHANGE OF DATE ON INPUT RECORDS - UPDATE FOR LAST   *
207600200610      *           DATE READ AND ANY SUCCEEDING DATES FOR POSITION UP  *
207700200610      *           TO NEW DATE READ IN.                                *
207800200610      *                                                               *
207900200610      *****************************************************************
208000200610      *
208100200610     C           CH02      BEGSR                            ** CH02 **
208200200610     C*
208300200610     C* CHANGE OF DATE - PROCESS PREVIOUS DATE
208400200610     C*
208500200610     C* IF ACTION DATE EQUALS POSITION RECORD DATE OR NXT WRKING DAY
208600200610     C* THEN UPDATE IN SUBR U01, ELSE ADD POSITION RECORD IN SUBR W01
208700200610     C*
208800200610     C                     EXSR ADDDAT
208900200610     C           WEQUAL    IFEQ '1'
209000200610     C                     Z-ADDWACTDT    WCOMPD
209100200610     C                     EXSR U01
209200200610     C                     ELSE
209300200610     C                     EXSR W01
209400200610     C                     END
209500200610     C*
209600200610     C* EXECUTE ADJUST A/C KEYS/POSN.SETT. SUBR - P/SEC
209700200610     C*
209800200610     C                     Z-ADDCSDA      WFRMDT
209900200610     C*
210000200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
210100200610     C* OR DATE OF NEXT ACTION FOR THIS POSITION WHICHEVER IS LOWEST
210200200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
210300200610     C*
210400200610     C                     Z-ADDWACTDT    WTODAT  60
210500200610     C                     EXSR NEXT
210600200610     C                     Z-ADDWNEXTD    WTODAT  60
210700200610     C                     EXSR SEC
210800200610     C*
210900200610     C*  UPDATE INTERVENING POSITION RECORDS
211000200610     C*  FOR EACH NEW ACTION DATE
211100200610     C*
211200200610     C***********CPHKEY    SETGTCPOSH                77                   E19403
211300200610     C*
211400200610     C** WLCSDA IS DATE OF LAST CUST. POSN. RECORD UPDATED
211500200610     C*
211600200610     C           WLCSDA    DOWLTWACTDT
211700200610     C           CPHKEY    SETGTCPOSH                77                   E19403
211800200610     C           CPHKND    READECPOSH                    77
211900200610     C                     Z-ADDCSDA      WDT                             E19403
212000200610     C           *IN77     IFEQ '0'
212100200610     C           RECI      ANDNE'*'
212200200610     C           CSDA      ANDLEWACTDT
212300200610     C*
212400200610     C** SUBR U02 HAS TO RESET RECORD TO H IF LATER DATE ADDED.
212500200610     C** A TEST IS MADE AGAINST WCOMPD - SET TO ACTION DATE WHEN U02
212600200610     C** CALLED HERE WHILST SET TO STORAGE DATE (WACTDT) IF FROM CHGPOS
212700200610     C*
212800200610     C                     Z-ADDWACTDT    WCOMPD
212900200610     C                     EXSR U02
213000200610     C*
213100200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
213200200610     C* OR DATE OF NEXT ACTION FOR THIS POSITION WHICHEVER IS LOWEST
213300200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
213400200610     C*
213500200610     C                     Z-ADDCSDA      WFRMDT
213600200610     C                     Z-ADDWACTDT    WTODAT  60
213700200610     C                     EXSR NEXT
213800200610     C                     Z-ADDWNEXTD    WTODAT  60
213900200610     C                     EXSR SEC
214000200610     C           CSDA      IFEQ WACTDT
214100200610     C           WCUPDE    SUB  1         WCUPDE
214200200610     C                     END
214300200610     C                     Z-ADDCSDA      WLCSDA
214400200610     C                     ELSE
214500200610     C*
214600200610     C* *IF 77 ON END OF FILE - FORCE END OF DO LOOP
214700200610     C*
214800200610     C   77                Z-ADDWACTDT    WLCSDA
214900200610     C                     END
215000200610     C*
215100200610     C                     END
215200200610     C*
215300200610     C*  AT END OF UPDATES ZEROISE DATE ACCUMULATORS
215400200610     C*
215500200610     C                     Z-ADD0         WCSNT
215600200610     C                     Z-ADD0         WCSNV
215700200610     C                     Z-ADD0         WCSNS
215800200610     C                     Z-ADD0         WCSEX
215900200610      *                                                                                       CGL031
216000200610     C           CGL031    IFEQ 'Y'                                                           CGL031
216100200610     C                     Z-ADD0         WCSPI                                               CGL031
216200200610     C                     ENDIF                                                              CGL031
216300200610      *
216400200610     C                     ENDSR
216500200610      *
216600200610      *****************************************************************
216700200610      /EJECT
216800200610      *****************************************************************
216900200610      *                                                               *
217000200610      *  NW02   - NEW DATE FOR POSITION BEING PROCESSED IS READ IN -  *
217100200610      *           ESTABLISH LATEST DATE HELD FOR THIS                 *
217200200610      *           NEW DATE READ IN.(I.E. BALANCE AS AT DATE READ IN)  *
217300200610      *                                                               *
217400200610      *****************************************************************
217500200610      *
217600200610     C           NW02      BEGSR                            ** NW02 **
217700200610     C*
217800200610     C* CHANGE OF DATE - PROCESS NEW DATE IN
217900200610     C*
218000200610     C** ACCESS CUST. POSITION RECORD CPOSNDF FOR LATEST POSITION
218100200610     C** DATE WHICH IS LESS THAN ACTION DATE
218200200610     C*
218300200610     C** CONSTRUCT KEY TO CUST. POSITIONS HIST/CURR LF/CPOSH
218400200610     C*
218500200610     C***********          MOVE WBC       CSBR                            S01117
218600200610     C                     MOVE WBC       CSBA                            S01117
218700200610     C                     MOVE WSS       CSSC
218800200610     C**********           Z-ADDWDP       CSCN                                                CSD027
218900200610     C                     MOVE WDP       CSCN                                                CSD027
219000200610     C                     Z-ADDWACTDT    WDT
219100200610     C           CPHKEY    SETLLCPOSH                    77
219200200610     C*
219300200610     C*  77 ON MEANS RECORD MATCHES A DATE ON CPOSND FILE
219400200610     C*
219500200610     C           *IN77     IFEQ '1'
219600200610     C                     MOVE '1'       WEQUAL
219700200610     C           CPHKEY    READECPOSH                    77
219800200610     C           RECI      IFNE '*'
219900200610     C                     GOTO ENDNW2
220000200610     C                     END
220100200610     C                     END
220200200610     C*
220300200610     C* IF NOT A DATE MATCH READ PREVIOUS ONE FOR LATEST EARLIER DATE
220400200610     C*
220500200610     C                     MOVE '0'       WEQUAL
220600200610     C           RP2LOP    TAG
220700200610     C*
220800200610     C                     READPCPOSH                    77
220900200610     C  N77      RECI      CABEQ'*'       RP2LOP
221000200610     C*
221100200610     C           ENDNW2    ENDSR                           ** ENDNW2 **
221200200610      *
221300200610      *****************************************************************
221400200610      /EJECT
221500200610      *****************************************************************
221600200610      *                                                               *
221700200610      *  CLRUPD - Subroutine to Clear fields in Format CPOSNDF.       *
221800200610      *                                                               *
221900200610      *****************************************************************
222000200610      *
222100200610     C           CLRUPD    BEGSR                           ** CLRUPD **
222200200610     C*
222300200610     C** CLEAR EACH FIELD - NO CUST. POSITION EQUAL OR BEFORE THIS ACTION
222400200610     C*
222500200610     C                     Z-ADD0         CSNT
222600200610     C                     Z-ADD0         CSNV
222700200610     C                     Z-ADD0         CSNS
222800200610     C                     Z-ADD0         CSEX
222900200610      *                                                                                       CGL031
223000200610     C           CGL031    IFEQ 'Y'                                                           CGL031
223100200610     C                     Z-ADD0         CSPI                                                CGL031
223200200610     C                     ENDIF                                                              CGL031
223300200610      *
223400200610     C                     ENDSR
223500200610      *
223600200610      *****************************************************************
223700200610      /EJECT
223800200610      *****************************************************************
223900200610      *                                                               *
224000200610      *  ADDDAT - Subroutine to add Date accumulated changes to       *
224100200610      *           Position changes.                                   *
224200200610      *                                                               *
224300200610      *****************************************************************
224400200610      *
224500200610     C           ADDDAT    BEGSR                           ** ADDDAT **
224600200610     C*
224700200610     C** ADD EACH DATE ACCUMULATED FIELD TO POSTION FIELDS
224800200610     C*
224900200610     C                     ADD  WCSNT     WCSNTP
225000200610     C                     ADD  WCSNV     WCSNVP
225100200610     C                     ADD  WCSNS     WCSNSP
225200200610     C                     ADD  WCSEX     WCSEXP
225300200610      *                                                                                       CGL031
225400200610     C           CGL031    IFEQ 'Y'                                                           CGL031
225500200610     C                     ADD  WCSPI     WCSPIP                                              CGL031
225600200610     C                     ENDIF                                                              CGL031
225700200610      *
225800200610     C                     ENDSR
225900200610      *
226000200610      *****************************************************************
226100200610      /EJECT
226200200610      *****************************************************************
226300200610      *                                                               *
226400200610      *  NOPOSN - Subroutine called when there is no existing         *
226500200610      *           Position on a Security.                             *
226600200610      *                                                               *
226700200610      *****************************************************************
226800200610      *
226900200610     C           NOPOSN    BEGSR                           ** NOPOSN **
227000200610     C*
227100200610     C*  ZEROISE WLASTD (DATE OF LAST POSITION)
227200200610     C*  AND ZEROISE VALUE FIELDS
227300200610     C*
227400200610     C                     Z-ADD0         WLASTD
227500200610     C                     Z-ADD0         CSDA
227600200610     C                     Z-ADD0         CSEX
227700200610     C                     Z-ADD0         CSNT
227800200610     C                     Z-ADD0         CSNV
227900200610     C                     Z-ADD0         CSNS
228000200610     C                     Z-ADD0         TNLU
228100200610      *                                                                                       CGL031
228200200610     C           CGL031    IFEQ 'Y'                                                           CGL031
228300200610     C                     Z-ADD0         CSPI                                                CGL031
228400200610     C                     ENDIF                                                              CGL031
228500200610     C*
228600200610     C                     ENDSR
228700200610      *
228800200610      *****************************************************************
228900200610      /EJECT
229000200610      *****************************************************************
229100200610      *                                                               *
229200200610      *  CHGPOS - Subroutine called on change of Position.            *
229300200610      *                                                               *
229400200610      *****************************************************************
229500200610      *
229600200610     C           CHGPOS    BEGSR                           ** CHGPOS **
229700200610     C*
229800200610     C*  UPDATE CUST. POSITION RECORDS FROM LAST DATE UPDATED TO MOST
229900200610     C*  RECENT.
230000200610     C*
230100200610     C           STGKEY    SETLLCPOSH                    77
230200200610     C           STGKY2    READECPOSH                    77               E19403
230300200610     C                     Z-ADDCSDA      STGDAT                          E19403
230400200610     C           WLCSDA    DOWLEWLASTD
230500200610     C********** STGKY2    READECPOSH                    77               E19403
230600200610     C           *IN77     IFNE '1'
230700200610     C           RECI      ANDNE'*'
230800200610     C           CSDA      IFGT WLCSDA
230900200610     C*
231000200610     C** SUBR U02 HAS TO RESET RECORD TO H IF LATER DATE ADDED AND
231100200610     C** A TEST IS MADE AGAINST WCOMPD SET TO STORAGE DATE WHEN U02
231200200610     C** CALLED FROM WHILST SET TO ACTION DATE (WACTDT) IF FROM CH02
231300200610     C*
231400200610     C                     Z-ADDSTGDAT    WCOMPD
231500200610     C                     EXSR U02
231600200610     C*
231700200610     C* SUBROUTINE NEXT GETS DATE OF NEXT INTERVENING POSITION
231800200610     C* OR DATE OF LAST POSITION WHICHEVER IS LOWEST
231900200610     C* AND PUTS IT INTO WNEXTD WHICH BECOMES WTODAT FOR SUBR P/SEC
232000200610     C*
232100200610     C                     Z-ADDCSDA      WFRMDT
232200200610     C                     Z-ADDWLASTD    WTODAT  60
232300200610     C                     EXSR NEXT
232400200610     C                     Z-ADDWNEXTD    WTODAT  60
232500200610     C                     EXSR SEC
232600200610     C*
232700200610     C                     Z-ADDCSDA      WLCSDA
232800200610     C*
232900200610     C***********          END                                            E20394
233000200610     C           STGKEY    CHAINCPOSH                77                   E19403
233100200610     C                     END                                            E20394
233200200610     C           STGKY2    READECPOSH                    77               E19403
233300200610     C                     Z-ADDCSDA      STGDAT                          E19403
233400200610     C*
233500200610     C* ELSE 77 ON IS END OF FILE - FORCE END OF LOOP
233600200610     C*
233700200610     C                     ELSE
233800200610     C   77                Z-SUB1         WLASTD
233900200610     C                     END
234000200610     C                     END
234100200610     C*                                                                   E15549
234200200610     C** CHECK FOR ADJUSTMENTS TO ACCOUNT KEYS/POSITION SETTLEMENTS       E15549
234300200610     C** FROM THE LATEST POSITION UP TO THE EVENT CONTROL DATE            E15549
234400200610     C*                                                                   E15549
234500200610     C           WLCSDA    IFLT STGDAT                                    E15549
234600200610     C                     Z-ADDSTGDAT    WFRMDT                          E15549
234700200610     C                     ELSE                                           E15549
234800200610     C                     Z-ADDWLCSDA    WFRMDT                          E15549
234900200610     C                     END                                            E15549
235000200610     C                     Z-ADDECD       WTODAT                          E15549
235100200610     C           WTODAT    IFGT WFRMDT                                    E15549
235200200610     C                     EXSR SEC                                       E15549
235300200610     C                     END                                            E15549
235400200610     C***********          MOVEL'N'       COUPDX                   E15549 E29307
235500200610     C*
235600200610     C* ZEROISE ALL ACCUMULATORS AFTER UPDATING HAS OCCURRED
235700200610     C*
235800200610     C*   DATE ACCUMULATORS
235900200610     C*
236000200610     C                     Z-ADD0         WCSNT
236100200610     C                     Z-ADD0         WCSNV
236200200610     C                     Z-ADD0         WCSNS
236300200610     C                     Z-ADD0         WCSEX
236400200610     C*
236500200610     C*   POSITION ACCUMULATORS
236600200610     C*
236700200610     C                     Z-ADD0         WCSNTP
236800200610     C                     Z-ADD0         WCSNVP
236900200610     C                     Z-ADD0         WCSNSP
237000200610     C                     Z-ADD0         WCSEXP
237100200610      *                                                                                       CGL031
237200200610     C           CGL031    IFEQ 'Y'                                                           CGL031
237300200610     C                     Z-ADD0         WCSPIP                                              CGL031
237400200610     C                     ENDIF                                                              CGL031
237500200610      *
237600200610     C           ENDCHP    ENDSR                           **ENDCHP**
237700200610      *
237800200610      *****************************************************************
237900200610      /EJECT
238000200610      *****************************************************************
238100200610      *                                                               *
238200200610      *  U01    - Subroutine to Update Positions with Actions on this *
238300200610      *           Date for each existing Position Date with Actions.  *
238400200610      *                                                               *
238500200610      *****************************************************************
238600200610      *
238700200610     C           U01       BEGSR                           ** U01 **
238800200610     C*
238900200610     C** DETERMINE IF LAST DATE FOR POSITION
239000200610     C*
239100200610     C           CSDA      IFLT WLASTD
239200200610     C                     MOVE 'H'       RECI
239300200610     C                     ELSE
239400200610     C           CSDA      IFEQ WLASTD
239500200610     C           WCOMPD    ANDGTCSDA
239600200610     C                     MOVE 'H'       RECI
239700200610     C                     END
239800200610     C                     END
239900200610     C*
240000200610     C**   UPDATE IN SUBR U01
240100200610     C*
240200200610     C*      - UPDATE USER CUST. POSITION RECORD FOR EACH
240300200610     C*        EXISTING POSITION DATE WITH ACTIONS.
240400200610     C*
240500200610     C** ADD ACCUMULATED CHANGES TO CURRENT RECORD VALUES AND UPDATE
240600200610     C*
240700200610     C***IF*COUPON*DATE*CROSSED*RESET*EX-COUPON*NOMINAL************E15549 E29307
240800200610     C*                                                                   E15549
240900200610     C***********COUPDX    IFEQ 'Y'                                E15549 E29307
241000200610     C***********          Z-ADD*ZERO     CSEX                     E15549 E29307
241100200610     C***********          END                                     E15549 E29307
241200200610     C*                                                                   E15549
241300200610     C                     ADD  WCSNT     CSNT
241400200610     C                     ADD  WCSNV     CSNV
241500200610     C                     ADD  WCSNS     CSNS
241600200610     C                     ADD  WCSEX     CSEX
241700200610      *                                                                                       CGL031
241800200610     C           CGL031    IFEQ 'Y'                                                           CGL031
241900200610     C                     ADD  WCSPI     CSPI                                                CGL031
242000200610     C                     ENDIF                                                              CGL031
242100200610      *                                                                                       CGL031
242200200610     C* IF NOMINAL TRADE OR VALUE EQUAL ZERO, ZEROISE APPROPRIATE         173976
242300200610     C* NUMERATOR                                                         173976
242400200610     C           CSNT      IFEQ 0                                         173976
242500200610     C                     Z-ADD0         CSPT                            173976
242600200610     C                     END                                            173976
242700200610     C           CSNV      IFEQ 0                                         173976
242800200610     C                     Z-ADD0         CSPV                            173976
242900200610     C                     END                                            173976
243000200610     C*
243100200610     C* IF TRADE DATE BAL OR VALUE DATE BAL UPDATE DATE LAST CHGD DATE
243200200610     C* AS APPROPRIATE WITH RUN DATE
243300200610     C*
243400200610     C           WCSNT     IFNE 0
243500200610     C                     Z-ADDRUND      CSCT
243600200610     C                     END
243700200610     C           WCSNV     IFNE 0
243800200610     C                     Z-ADDRUND      CSCV
243900200610     C                     END
244000200610     C           CSSC      CHAINSECTY                99                   100024
244100200610      *                                                                                     BUG11104
244200200610      ** For shares obtain date of previous dividend from diary                             BUG11104
244300200610      ** events file                                                                        BUG11104
244400200610      *                                                                                     BUG11104
244500200610     C                     MOVE CSSC      WCSSC                                             BUG11104
244600200610     C                     EXSR SECTIN                                                      BUG11104
244700200610     C                     EXSR INVTIN                                                      BUG11104
244800200610     C           PROT      IFEQ '4'                                                         BUG11104
244900200610     C                     MOVELCSSC      WWSDSN                                            BUG11104
245000200610     C                     MOVE 'DV'      WWSDET                                            BUG11104
245100200610     C                     Z-ADDDNWD      SDED                                              BUG11104
245200200610     C           P4KEY     SETGTSECET                                                       BUG11104
245300200610     C                     READPSECET                    72                                 BUG11104
245400200610      *                                                                                     BUG11104
245500200610     C           *IN72     IFEQ '0'                                                         BUG11104
245600200610     C           SDSN      ANDEQWWSDSN                                                      BUG11104
245700200610     C           SDET      ANDEQWWSDET                                                      BUG11104
245800200610     C                     Z-ADDSDED      ZZLCD                                             BUG11104
245900200610     C                     ELSE                                                             BUG11104
246000200610     C                     Z-ADD0         ZZLCD                                             BUG11104
246100200610     C                     ENDIF                                                            BUG11104
246200200610      *                                                                   094403
246300200610      * OBTAIN LAST COUPON DATE FROM ZLCDZ1, EVENT CONTROL DATE IS DNWD   094403
246400200610      *                                                                   094403
246500200610     C                     Z-ADDDNWD      ZECD                            094403
246600200610     C                     EXSR ZLCD                                      094403
246700200610     C                     ENDIF                                                            BUG11104
246800200610      *                                                                   094403
246900200610      * IF LAST COUPON DATE FALLS BETWEEN LAST/CURRENT POSITION DATES     094403
247000200610      * SET EX-COUPON NOMINAL TO ZERO                                     094403
247100200610      *                                                                   094403
247200200610     C           ZZLCD     IFGT WLASTD                                    094403
247300200610     C           ZZLCD     ANDLECSDA                                      094403
247400200610     C                     Z-ADD*ZEROS    CSEX                            094403
247500200610      *                                                                                       CGL031
247600200610     C           CGL031    IFEQ 'Y'                                                           CGL031
247700200610     C                     Z-ADD*ZEROS    CSPI                                                CGL031
247800200610     C                     ENDIF                                                              CGL031
247900200610      *                                                                                       CGL031
248000200610     C                     END                                            094403
248100200610     C*
248200200610     C                     UPDATCPOSNDF
248300200610     C                     ADD  1         WCUPDE  50
248400200610     C                     Z-ADDCSDA      WLCSDA
248500200610      *
248600200610     C           ENDU01    ENDSR                            **ENDU01**
248700200610      *
248800200610      *****************************************************************
248900200610      /EJECT
249000200610      *****************************************************************
249100200610      *                                                               *
249200200610      *  U02   - Subroutine to Update intervening Positions for each  *
249300200610      *          existing Position Date with no Actions.              *
249400200610      *                                                               *
249500200610      *****************************************************************
249600200610      *
249700200610     C           U02       BEGSR                           ** U02 **
249800200610     C*
249900200610     C** DETERMINE IF LAST DATE FOR POSITION
250000200610     C*
250100200610     C           CSDA      IFLT WLASTD
250200200610     C                     MOVE 'H'       RECI
250300200610     C                     ELSE
250400200610     C           CSDA      IFEQ WLASTD
250500200610     C           WCOMPD    ANDGTCSDA
250600200610     C                     MOVE 'H'       RECI
250700200610     C                     END
250800200610     C                     END
250900200610     C*
251000200610     C** ADD ACCUMULATED CHANGES TO CURRENT RECORD VALUES AND UPDATE
251100200610     C*
251200200610     C***IF*COUPON*DATE*CROSSED,*RESET*EX-COUPON*NOMINAL***********E15549 E29307
251300200610     C*                                                                   E15549
251400200610     C***********COUPDX    IFEQ 'Y'                                E15549 E29307
251500200610     C***********          Z-ADD*ZERO     CSEX                     E15549 E29307
251600200610     C***********          END                                     E15549 E29307
251700200610     C*                                                                   E15549
251800200610     C                     ADD  WCSNTP    CSNT
251900200610     C                     ADD  WCSNVP    CSNV
252000200610     C                     ADD  WCSNSP    CSNS
252100200610     C                     ADD  WCSEXP    CSEX
252200200610      *                                                                                       CGL031
252300200610     C           CGL031    IFEQ 'Y'                                                           CGL031
252400200610     C                     ADD  WCSPIP    CSPI                                                CGL031
252500200610     C                     ENDIF                                                              CGL031
252600200610     C*
252700200610     C* IF TRADE DATE BAL OR VALUE DATE BAL UPDATE DATE LAST CHGD DATE
252800200610     C* AS APPROPRIATE WITH RUN DATE
252900200610     C*
253000200610     C           WCSNTP    IFNE 0
253100200610     C                     Z-ADDRUND      CSCT
253200200610     C                     END
253300200610     C           WCSNVP    IFNE 0
253400200610     C                     Z-ADDRUND      CSCV
253500200610     C                     END
253600200610     C* IF NOMINAL TRADE OR VALUE EQUAL ZERO, ZEROISE APPROPRIATE         173976
253700200610     C* NUMERATOR                                                         173976
253800200610     C           CSNT      IFEQ 0                                         173976
253900200610     C                     Z-ADD0         CSPT                            173976
254000200610     C                     END                                            173976
254100200610     C           CSNV      IFEQ 0                                         173976
254200200610     C                     Z-ADD0         CSPV                            173976
254300200610     C                     END                                            173976
254400200610      *                                                                   094403
254500200610      * OBTAIN LAST COUPON DATE FROM ZLCDZ1, EVENT CONTROL DATE IS DNWD   094403
254600200610      *                                                                   094403
254700200610     C           CSSC      CHAINSECTY                99                   100024
254800200610      *                                                                                     BUG11104
254900200610      ** For shares obtain date of previous dividend from diary                             BUG11104
255000200610      ** events file                                                                        BUG11104
255100200610      *                                                                                     BUG11104
255200200610     C                     MOVE CSSC      WCSSC                                             BUG11104
255300200610     C                     EXSR SECTIN                                                      BUG11104
255400200610     C                     EXSR INVTIN                                                      BUG11104
255500200610     C           PROT      IFEQ '4'                                                         BUG11104
255600200610     C                     MOVELCSSC      WWSDSN                                            BUG11104
255700200610     C                     MOVE 'DV'      WWSDET                                            BUG11104
255800200610     C                     Z-ADDDNWD      SDED                                              BUG11104
255900200610     C           P4KEY     SETGTSECET                                                       BUG11104
256000200610     C                     READPSECET                    72                                 BUG11104
256100200610      *                                                                                     BUG11104
256200200610     C           *IN72     IFEQ '0'                                                         BUG11104
256300200610     C           SDSN      ANDEQWWSDSN                                                      BUG11104
256400200610     C           SDET      ANDEQWWSDET                                                      BUG11104
256500200610     C                     Z-ADDSDED      ZZLCD                                             BUG11104
256600200610     C                     ELSE                                                             BUG11104
256700200610     C                     Z-ADD0         ZZLCD                                             BUG11104
256800200610     C                     ENDIF                                                            BUG11104
256900200610      *                                                                                     BUG11104
257000200610      ** For other instruments obtain Last Coupon Date using details                        BUG11104
257100200610      ** from LF/SECTY                                                                      BUG11104
257200200610      *                                                                                     BUG11104
257300200610     C                     ELSE                                                             BUG11104
257400200610     C                     Z-ADDDNWD      ZECD                            094403
257500200610     C                     EXSR ZLCD                                      094403
257600200610     C                     ENDIF                                                            BUG11104
257700200610      *                                                                   094403
257800200610      * IF LAST COUPON DATE FALLS BETWEEN LAST/CURRENT POSITION DATES     094403
257900200610      * SET EX-COUPON NOMINAL TO ZERO                                     094403
258000200610      *                                                                   094403
258100200610     C           ZZLCD     IFGT WLASTD                                    094403
258200200610     C           ZZLCD     ANDLECSDA                                      094403
258300200610     C                     Z-ADD*ZEROS    CSEX                            094403
258400200610      *                                                                                       CGL031
258500200610     C           CGL031    IFEQ 'Y'                                                           CGL031
258600200610     C                     Z-ADD*ZEROS    CSPI                                                CGL031
258700200610     C                     ENDIF                                                              CGL031
258800200610      *                                                                                       CGL031
258900200610     C                     END                                            094403
259000200610      *                                                                   094403
259100200610     C                     UPDATCPOSNDF
259200200610     C                     ADD  1         WCUPDE  50
259300200610     C                     Z-ADDCSDA      WLCSDA
259400200610     C*
259500200610     C           ENDU02    ENDSR                            **ENDU02**
259600200610      *
259700200610      *****************************************************************
259800200610      /EJECT
259900200610      *****************************************************************
260000200610      *                                                               *
260100200610      *  W01    - Subroutine to Write a new Position Record for each  *
260200200610      *           Position for a new Date.                            *
260300200610      *                                                               *
260400200610      *****************************************************************
260500200610      *
260600200610     C           W01       BEGSR                           ** W01 **
260700200610     C*
260800200610     C* IF LAST DATE FOR POSITION AND ACTION DATE GT LAST POSN DATE
260900200610     C* RECI IS MADE EQUAL TO D - ELSE RECI IS EQUAL TO H
261000200610     C*
261100200610     C           COMARA    IFNE STGARA
261200200610     C           STGDAT    ANDGTWLASTD
261300200610     C           *IN89     OREQ '1'
261400200610     C           STGDAT    ANDGTWLASTD
261500200610     C                     MOVE 'D'       RECI
261600200610     C                     ELSE
261700200610     C                     MOVE 'H'       RECI
261800200610     C                     END
261900200610     C*
262000200610     C* SET UP KEY FIELDS FROM ACTION RECORD
262100200610     C*
262200200610     C***********          MOVE WSBC      CSBR                            S01117
262300200610     C                     MOVE WSBC      CSBA                            S01117
262400200610     C                     MOVE WSSS      CSSC
262500200610     C**********           Z-ADDWSDP      CSCN                                                CSD027
262600200610     C                     MOVE WSDP      CSCN                                                CSD027
262700200610     C                     Z-ADDSTGDAT    CSDA
262800200610     C*
262900200610     C** ADD ACCUMULATED CHANGES TO CURRENT RECORD VALUES AND UPDATE
263000200610     C*
263100200610     C** IF COUPON DATE CROSSED, RESET EX-COUPON NOMINAL                  E15549
263200200610     C*                                                                   E15549
263300200610     C***********COUPDX    IFEQ 'Y'                                E15549 E29307
263400200610     C***********          Z-ADD*ZERO     CSEX                     E15549 E29307
263500200610     C***********          END                                     E15549 E29307
263600200610     C***********                                                  E15549 E29307
263700200610     C***********CSDA      ADD  1         ZECD                     E29307 094403
263800200610     C***********          EXSR ZLCD                               E29307 094403
263900200610     C***********ZZLCD     IFGT WLCSDA                             E29307 094403
264000200610     C***********          Z-ADD*ZERO     CSEX                     E29307 094403
264100200610     C***********          END                                     E29307 094403
264200200610      *                                                                   094403
264300200610     C           CSSC      CHAINSECTY                99                   100024
264400200610      *                                                                                     BUG11104
264500200610      ** For shares obtain date of previous dividend from diary                             BUG11104
264600200610      ** events file                                                                        BUG11104
264700200610      *                                                                                     BUG11104
264800200610     C                     MOVE CSSC      WCSSC                                             BUG11104
264900200610     C                     EXSR SECTIN                                                      BUG11104
265000200610     C                     EXSR INVTIN                                                      BUG11104
265100200610     C           PROT      IFEQ '4'                                                         BUG11104
265200200610     C                     MOVELCSSC      WWSDSN                                            BUG11104
265300200610     C                     MOVE 'DV'      WWSDET                                            BUG11104
265400200610     C                     Z-ADDDNWD      SDED                                              BUG11104
265500200610     C           P4KEY     SETGTSECET                                                       BUG11104
265600200610     C                     READPSECET                    72                                 BUG11104
265700200610      *                                                                                     BUG11104
265800200610     C           *IN72     IFEQ '0'                                                         BUG11104
265900200610     C           SDSN      ANDEQWWSDSN                                                      BUG11104
266000200610     C           SDET      ANDEQWWSDET                                                      BUG11104
266100200610     C                     Z-ADDSDED      ZZLCD                                             BUG11104
266200200610     C                     ELSE                                                             BUG11104
266300200610     C                     Z-ADD0         ZZLCD                                             BUG11104
266400200610     C                     ENDIF                                                            BUG11104
266500200610      * OBTAIN LAST COUPON DATE FROM ZLCDZ1, EVENT CONTROL DATE IS DNWD   094403
266600200610      *                                                                   094403
266700200610     C                     ELSE                                                             BUG11104
266800200610     C                     Z-ADDDNWD      ZECD                            094403
266900200610     C                     EXSR ZLCD                                      094403
267000200610     C                     ENDIF                                                            BUG11104
267100200610      *                                                                   094403
267200200610      * IF LAST COUPON DATE FALLS BETWEEN LAST/CURRENT POSITION DATES     094403
267300200610      * SET EX-COUPON NOMINAL TO ZERO                                     094403
267400200610      *                                                                   094403
267500200610     C           ZZLCD     IFGT WLASTD                                    094403
267600200610     C           ZZLCD     ANDLECSDA                                      094403
267700200610     C                     Z-ADD*ZEROS    CSEX                            094403
267800200610      *                                                                                       CGL031
267900200610     C           CGL031    IFEQ 'Y'                                                           CGL031
268000200610     C                     Z-ADD*ZEROS    CSPI                                                CGL031
268100200610     C                     ENDIF                                                              CGL031
268200200610      *                                                                                       CGL031
268300200610     C                     END                                            094403
268400200610      *                                                                   094403
268500200610     C           PROT      IFEQ '6'                                       038963
268600200610     C                     Z-ADD*ZEROS    CSEX                            038963
268700200610     C                     END                                            038963
268800200610     C*                                                                   038963
268900200610     C                     ADD  WCSNT     CSNT
269000200610     C                     ADD  WCSNV     CSNV
269100200610     C                     ADD  WCSNS     CSNS
269200200610     C                     ADD  WCSEX     CSEX
269300200610     C*
269400200610     C                     Z-ADD0         TNLU
269500200610     C*
269600200610     C* IF TRADE DATE BAL OR VALUE DATE BAL UPDATE DATE LAST CHGD DATE
269700200610     C* AS APPROPRIATE WITH RUN DATE
269800200610     C*
269900200610     C           CSNT      IFNE 0
270000200610     C                     Z-ADDRUND      CSCT
270100200610     C                     END
270200200610     C           CSNV      IFNE 0
270300200610     C                     Z-ADDRUND      CSCV
270400200610     C                     END
270500200610     C*
270600200610     C* INSERT NEW POSITION RECORD
270700200610     C*
270800200610     C                     Z-ADD*ZEROS    CSPT                            E13561
270900200610     C                     Z-ADD*ZEROS    CSPV                            E13561
271000200610     C                     WRITECPOSNDF
271100200610     C*
271200200610     C* COUNT NO OF RECORDS ADDED AND STORE LAST DATE HELD FOR POSN.
271300200610     C*
271400200610     C                     ADD  1         WCADDP  50
271500200610     C                     Z-ADDCSDA      WLCSDA
271600200610     C*
271700200610     C           ENDW01    ENDSR                           **ENDW01**
271800200610      *
271900200610      *****************************************************************
272000200610      /EJECT
272100200610      *****************************************************************
272200200610      *                                                               *
272300200610      *  SEC    - Subroutine to produce Adjusted or New Account Keys  *
272400200610      *           and Position Settlements for each revised/new Depot *
272500200610      *           Positions.                                          *
272600200610      *                                                               *
272700200610      * INPUT: FROM DATE  -  DATE OF LAST ACTION/POSITION             *
272800200610      *        TO DATE    -  DATE OF NEXT POSITION ON CUST. POSN FILE *
272900200610      *                      AS DETERMINED BY SUBR 'NEXT' BEFORE EACH *
273000200610      *                      CALL TO P/SEC.                           *
273100200610      *        BALANCES   -  NEW AND DIFFERENT                        *
273200200610      *                                                               *
273300200610      *****************************************************************
273400200610      *
273500200610     C           SEC       BEGSR                           ** SEC **
273600200610     C*
273700200610     C**ACCES*LF/SECED*SECURITY*EVENT*FILE*FORMAT*SEDEVDF*FOR**********   E15549
273800200610     C*       ACCES LF/SECED SECURITY EVENT FILE FOR                      E15549
273900200610     C*       SECURITY ACTIONS BETWEEN LAST POSN DATE (FROM DATE)
274000200610     C*       AND LESS THAN TO DATE (NEXT ACTION DATE INPUT OR TO END
274100200610     C*       OF DATES FOR THIS POSN ON CHANGE OF POSITION)
274200200610     C*
274300200610     C***********SECKEY    SETLLSEDEVDF                  77               E15549
274400200610     C***********          MOVEL'N'       COUPDX  1                E15549 E29307
274500200610     C           SECKEY    SETLLSECED                    77               E15549
274600200610     C*
274700200610     C* GET RECORD ON LF/SECED AS DETAILED ABOVE
274800200610     C*
274900200610     C                     Z-ADD0         WPCNTI  50
275000200610     C                     MOVE '0'       *IN79
275100200610     C           *IN79     DOWEQ'0'
275200200610     C*
275300200610     C                     MOVEL'N'       WRVPOS  1                                           260331
275400200610     C**********                                                          E20086
275500200610     C***STORE*NOM*CCY*FROM*SECTYD*AS*SEDEVDF*HAS*NMCY*FIELD*TOO******    E20086
275600200610     C**********                                                          E20086
275700200610     C**********           MOVE NMCY      WNMCY                           E20086
275800200610     C***********SECK      READESEDEVDF                  79               E15549
275900200610     C           SECK      READESECED                    79               E15549
276000200610     C***********          MOVE WNMCY     NMCY                            E20086
276100200610     C*
276200200610     C***IF*EVENT*DATE*(SDED/SEDEVDF)*GT*TO*DATE**(WTODAT),*END*LOOP***   E15549
276300200610     C** IF EVENT DATE (SDED/SECED) GT TO DATE (WTODAT), END LOOP         E15549
276400200610     C*
276500200610     C           SDED      IFGT WTODAT
276600200610     C                     MOVE '1'       *IN79
276700200610     C                     END
276800200610     C*
276900200610     C* IND 79 IS SET ON WHEN NO MORE ACTIONS FOR THIS SECURITY/PERIOD
277000200610     C*
277100200610     C************IN79     CABEQ'1'       ENDSC1                          S01510
277200200610     C           *IN79     IFEQ '1'                                       S01510
277300200610     C           S01510    IFEQ 'Y'                                       S01510
277400200610      *                                                                                      251950A
277500200610      ** If trade or depot movement action for a portfolio position, do not generate         251950A
277600200610      ** DV position settlement yet.  Record will be generated later via SR/GENPTF.          251950A
277700200610      ** Otherwise, a duplicate record will be written in POSETD.                            251950A
277800200610      *                                                                                      251950A
277900200610     C           BGPFMG    IFEQ 'Y'                                                          251950A
278000200610     C           BGN4ST    OREQ 'Y'                                                          251950A
278100200610     C           WPTFRS    IFEQ *BLANKS                                                      251950A
278200200610     C                     EXSR #LEXDV                                    S01510
278300200610     C                     ENDIF                                                             251950A
278400200610     C                     ENDIF                                                             251950A
278500200610     C                     END                                            S01510
278600200610     C                     GOTO ENDSC1                                    S01510
278700200610     C                     END                                            S01510
278800200610     C                     MOVE RECI      WSRECI
278900200610     C*
279000200610     C***IF*EVENT*DATE*(SDED/SEDEVDF)*LT*FROM*DATE(WFRMDT),*IGNORE*****   E15549
279100200610     C***IF*EVENT*DATE*(SDED/SECED)*LT*FROM*DATE(WFRMDT),*IGNORE** E15549 051107
279200200610      ***  If the Event Date (from SECED) is Less Than or Equal To the    051107
279300200610      ***  From Date, it will not be affected, so ignore.                 051107
279400200610     C*
279500200610     C***********SDED      CABLTWFRMDT    ENDSC1                          051107
279600200610     C           SDED      IFLE WFRMDT                                    051107
279700200610     C           SDET      ANDNE'MA'                                      S01510
279800200610     C           SDED      ORLT WFRMDT                                    S01510
279900200610     C                     GOTO ENDSC1                                    051107
280000200610     C                     END                                            051107
280100200610     C*
280200200610     C** PROCESS SELECTED SECURITY EVENT RECORD
280300200610     C*
280400200610     C** RECORD SELECTED - IGNORE IF EVENT TYPE NOT DV/CP/PP/MA/MP
280500200610     C*
280600200610     C           SDET      IFNE 'DV'
280700200610     C           SDET      ANDNE'CP'
280800200610     C           SDET      ANDNE'PP'
280900200610     C           SDET      ANDNE'MA'
281000200610     C           SDET      ANDNE'MP'
281100200610     C                     GOTO ENDSC1
281200200610     C                     END
281300200610     C*                                                                   S01510
281400200610     C** If S01510 is active, ignore if event type is DV                  S01510
281500200610     C*                                                                   S01510
281600200610     C           S01510    IFEQ 'Y'                                       S01510
281700200610     C           SDET      ANDEQ'DV'                                      S01510
281800200610     C                     GOTO ENDSC1                                    S01510
281900200610     C                     END                                            S01510
282000200610     C*
282100200610      ***  This test now catered for above.                               051107
282200200610     C***RECORD*SELECTED*-*IGNORE*IF*EVENT*TYPE*=*PP*AND*EVENT*DATE****   051107
282300200610     C***IS*EQUAL*TO*FROM*DATE**(WFRMDT)*******************************   051107
282400200610     C***********                                                         051107
282500200610     C***********SDET      IFEQ 'PP'                                      051107
282600200610     C***********SDED      ANDEQWFRMDT                                    051107
282700200610     C***********          GOTO ENDSC1                                    051107
282800200610     C***********          END                                            051107
282900200610     C***********                                                  E15549 051107
283000200610     C***********                                                  E15549 051107
283100200610     C***NEXT*POSITION*TO*BE*PROCESSED*WILL*CROSS*A*COUPON/DIVIDENDE15549 E29307
283200200610     C***********                                                  E15549 051107
283300200610     C***********SDET      IFEQ 'CP'                               E15549 E29307
283400200610     C***********SDET      OREQ 'DV'                               E15549 E29307
283500200610     C***********          MOVEL'Y'       COUPDX                   E15549 E29307
283600200610     C***********          END                                     E15549 E29307
283700200610     C*
283800200610     C** RECORD SELECTED - IGNORE IF EVENT TYPE = DV,CP,MP,MA AND
283900200610     C** EVENT DATE IS EQUAL TO NEW DATE = WTODAT
284000200610     C*
284100200610     C***********SDET      IFEQ 'DV'                                      S01510
284200200610     C***********SDET      OREQ 'CP'                                      S01510
284300200610     C***********SDET      OREQ 'MP'                                      S01510
284400200610     C***********SDET      OREQ 'MA'                                      S01510
284500200610     C***********SDED      IFEQ WTODAT                                    S01510
284600200610     C           SDET      IFEQ 'MA'                                      S01510
284700200610     C           SDED      ANDEQWTODAT                                    S01510
284800200610     C           ECD       ANDNEWTODAT                                    S01510
284900200610     C                     GOTO ENDSC1
285000200610     C                     END
285100200610     C***********          END                                            S01510
285200200610     C*                                                                   E15549
285300200610     C** CHECK IF EVENT IS BEING ACTIONED IN THIS RUN                     E15549
285400200610     C*                                                                   E15549
285500200610     C           SECDKY    CHAINSECACE               77                   E15549
285600200610     C*                                                                   E15549
285700200610     C           *IN77     IFEQ '1'                                       E15549
285800200610     C*                                                                   E15549
285900200610     C** IF NON-DIARY EVENT (COUPON OR MATURITY) SET ACTION DATES.ACTION  E15549
286000200610     C** PROCESSED PRIOR TO THIS RUN SO PROGRAM MAY CHECK FOR ADJUSTMENTS E15549
286100200610     C*                                                                   E15549
286200200610     C           SDET      IFEQ 'CP'                                      E15549
286300200610     C           SDET      OREQ 'MA'                                      E15549
286400200610     C                     Z-ADDSDED      SDAD                            E15549
286500200610     C                     Z-ADDSDED      SDDT                            E15549
286600200610     C                     END                                            E15549
286700200610     C*                                                                   E15549
286800200610     C                     ELSE                                           E15549
286900200610     C           RECI      IFEQ 'R'                                                           260331
287000200610     C           SAAT      IFEQ 'DV'                                                          260331
287100200610     C           SAAT      OREQ 'MP'                                                          260331
287200200610     C           SAAT      OREQ 'PP'                                                          260331
287300200610     C                     MOVEL'Y'       WRVPOS                                              260331
287400200610     C                     ENDIF                                                              260331
287500200610     C                     ENDIF                                                              260331
287600200610     C***********                                                  E15549 S01510
287700200610     C**BEING*ACTIONED*THIS*RUN.*SE2400*WILL*DO*THE*POSITION*SETTLEE15549 S01510
287800200610     C***********                                                  E15549 S01510
287900200610     C***********          GOTO ENDSC1                             E15549 S01510
288000200610     C*                                                                   S01510
288100200610     C** Let this program do the processing that SE2400 won't do.         S01510
288200200610     C*                                                                   S01510
288300200610     C           SDET      IFEQ 'CP'                                      S01510
288400200610     C           SDET      OREQ 'MA'                                      S01510
288500200610     C                     Z-ADD*ZERO     SDAD                            S01510
288600200610     C                     Z-ADD*ZERO     SDDT                            S01510
288700200610     C           PSRI      IFNE 'Y'                                       S01510
288800200610     C                     Z-ADDSDED      SDDT                            S01510
288900200610     C                     END                                            S01510
289000200610     C                     ELSE                                           S01510
289100200610     C           AKRI      IFEQ 'Y'                                       S01510
289200200610     C                     Z-ADD*ZERO     SDAD                            S01510
289300200610     C                     END                                            S01510
289400200610     C           PSRI      IFEQ 'Y'                                       S01510
289500200610     C                     Z-ADD*ZERO     SDDT                            S01510
289600200610     C                     END                                            S01510
289700200610     C                     END                                            S01510
289800200610     C*                                                                   E15549
289900200610     C                     END                                            E15549
290000200610     C*
290100200610     C** RECORD SELECTED - IGNORE IF BOTH ACTIONED DATES ARE ZERO
290200200610     C*
290300200610     C           SDAD      IFEQ 0
290400200610     C           SDDT      ANDEQ0
290500200610     C                     GOTO ENDSC1
290600200610     C                     END
290700200610     C*
290800200610     C** CALCULATE BALANCES THAT SUBROUTINES BELOW WILL OPERATE UPON
290900200610     C*
291000200610     C***IF*ACTIONED*DATE*(EVENT)*IS*EQUAL*TO*RUN*DATE*USE*NEW*BALANCES** E15549
291100200610     C** PROGRAM NOW ONLY WORKS OUT DIFFERENCES TO PROCESS DUE TO         E15549
291200200610     C** BACKVALUATIONS. SECURITY EVENTS ARE PROCESSED IN SE2400          E15549
291300200610     C*
291400200610     C***IF*WDIFF*IS*SET*TO*Y*IN*COUPON/MORTPY/MATURE*SUBRS*THEN*THE***** E20086
291500200610     C***IF*WDIFF*IS*SET*TO*Y*IN*COUPON/MATURE*SUBROUTINES*THEN*THE 20086 E21573
291600200610     C** IF WDIFF IS SET TO Y IN COUPON SUBROUTINE, THEN THE              E21573
291700200610     C** INTEREST CALCULATING PGMS ZACCRC/ZACCRD MUST BE CALLED WITH
291800200610     C** STATUS OF A AND THEN B AND A SUBTRACTION DONE ON RESULTS
291900200610     C*
292000200610     C                     MOVE ' '       WDIFF   1
292100200610     C*
292200200610     C***********SDAD      IFEQ RUND                                      E15549
292300200610     C*
292400200610     C** CALCULATE CUM-COUPON VALUE
292500200610     C*
292600200610     C***********          Z-ADDCSNV      WBCSNV 150                      E15549
292700200610     C***********          Z-ADDCSEX      WBCSEX 150                      E15549
292800200610     C***********CSNV      SUB  CSEX      WCUMCP 150                      E15549
292900200610     C***********          ELSE                                           E15549
293000200610     C*
293100200610     C** ELSE USE DIFFERENCE ONLY BALANCES
293200200610     C*
293300200610     C                     MOVE 'Y'       WDIFF
293400200610     C                     Z-ADDWCSNTP    WBCSNT 150                      E19610
293500200610     C                     Z-ADDWCSNVP    WBCSNV 150
293600200610     C                     Z-ADDWCSEXP    WBCSEX 150
293700200610     C           WBCSNV    SUB  WBCSEX    WCUMCP 150                      E15549
293800200610     C           CSNV      SUB  CSEX      WCPSN  150                      157260
293900200610     C***********WBCSNV    SUB  WBCSEX    WCUMCP                          E15549
294000200610     C***********          END                                            E15549
294100200610     C*
294200200610     C** EXECUTE SUBROUTINE SECTIN TO RETRIEVE SECURITY RECORD
294300200610     C*
294400200610     C***********WBCSNV    IFEQ 0                                         E24421
294500200610     C***********WBCSEX    ANDEQ0                                         E24421
294600200610     C***********          GOTO ENDSC1                                    E24421
294700200610     C***********          END                                            E24421
294800200610     C*                                                                   S01486
294900200610     C** IF PORTFOLIO REFERENCE BLANK ON ACTION GENERATE POSITION         S01486
295000200610     C** SETTLEMENT IMMEDIATELY                                           S01486
295100200610     C           WPTFRS    IFEQ *BLANKS                                   S01486
295200200610     C           BGPFMG    ANDEQ'Y'                                       S01486
295300200610     C*                                                                   S01486
295400200610     C           WPTFRS    OREQ *BLANKS                                   CPB002
295500200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
295600200610     C*                                                                   CPB002
295700200610     C           SDET      OREQ 'MA'                                      S01486
295800200610     C           BGPFMG    ANDEQ'Y'                                       S01486
295900200610     C*                                                                   S01486
296000200610     C           SDET      OREQ 'MA'                                      CPB002
296100200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
296200200610     C*                                                                   CPB002
296300200610     C           BGPFMG    ORNE 'Y'                                       S01486
296400200610     C           BGN4ST    ANDNE'Y'                                       CPB002
296500200610     C*                                                                   S01486
296600200610     C*
296700200610     C                     MOVE SDSN      WCSSC
296800200610     C                     EXSR SECTIN
296900200610     C** Execute Subroutine INVTIN to retrieve INVESTMENT Record          E23169
297000200610     C*                                                                   E23169
297100200610     C                     EXSR INVTIN                                    E23169
297200200610     C*                                                                   E23169
297300200610     C*                                                                   S01117
297400200610     C**  Obtain related Customer Position Profit Centre Details          S01117
297500200610     C*                                                                   S01117
297600200610     C           BKPRCU    IFEQ 'Y'                                       095033
297700200610     C                     EXSR SEPCIN                                    S01117
297800200610     C                     END                                            095033
297900200610     C*
298000200610     C** EXECUTE SUBROUTINES DEPENDING ON ACTION TYPE
298100200610     C*
298200200610     C           SDET      CASEQ'DV'      DIVIDN
298300200610     C           SDET      CASEQ'CP'      COUPON
298400200610     C           SDET      CASEQ'MP'      MORTPY
298500200610     C           SDET      CASEQ'MA'      MATURE
298600200610     C                     END
298700200610     C*
298800200610     C           SDDT      IFNE 0
298900200610     C           SDET      CASEQ'PP'      PARTPY
299000200610     C                     END
299100200610     C                     END
299200200610     C*
299300200610     C* IF PP,MP,MA ACTIONED (SDDT NOT 0) OR DV, CP ACTIONED
299400200610     C* INCREMENT COUNT AND TEST WHEN NO MORE - IF NOT ZERO THEN
299500200610     C* ADD 1 TO COUNT OF POSITIONS ACTIONED
299600200610     C*
299700200610     C           SDDT      IFNE 0
299800200610     C           SDET      OREQ 'DV'
299900200610     C           SDET      OREQ 'CP'
300000200610     C           SDET      OREQ 'MP'
300100200610     C           SDET      OREQ 'MA'
300200200610     C                     ADD  1         WPCNTI
300300200610     C                     END
300400200610     C                     END                                            S01486
300500200610     C           ENDSC1    TAG                             **ENDSC1**
300600200610     C*
300700200610     C                     END
300800200610     C*
300900200610     C* ADD TO COUNT OF POSITIONS PROCESSED
301000200610     C*
301100200610     C           WPCNTI    IFGT 0
301200200610     C                     ADD  1         WCPOSK  50
301300200610     C                     END
301400200610     C           ENDSEC    ENDSR                           **ENDSEC**
301500200610      *
301600200610      *****************************************************************
301700200610     C/EJECT                                                              S01510
301800200610     C*****************************************************************   S01510
301900200610     C*                                                               *   S01510
302000200610     C*  #LEXDV - Subroutine to take positions at the ex-date on      *   S01510
302100200610     C*           the diary event                                     *   S01510
302200200610     C*                                                               *   S01510
302300200610     C*****************************************************************   S01510
302400200610     C*                                                                   S01510
302500200610     C           #LEXDV    BEGSR                                          S01510
302600200610     C*                                                                   S01510
302700200610     C           SECKEY    SETLLSEDEVD1                  77               S01510
302800200610     C*                                                                   S01510
302900200610     C** Do until all records for the security are read                   S01510
303000200610     C*                                                                   S01510
303100200610     C           *IN77     DOUEQ'1'                                       S01510
303200200610     C***********SDSN      READESEDEVD1                  77        S01510 082248
303300200610     C           WSSS      READESEDEVD1                  77               082248
303400200610     C*                                                                   S01510
303500200610     C** Process if Ex-date is within the range specified                 S01510
303600200610     C*                                                                   S01510
303700200610     C           *IN77     IFEQ '0'                                       S01510
303800200610     C           SDXD      ANDGTWFRMDT                                    S01510
303900200610     C           SDXD      ANDLEWTODAT                                    S01510
304000200610     C*                                                                   S01510
304100200610     C                     MOVEL'N'       WRVPOS                                              260331
304200200610      *                                                                                       260331
304300200610     C           SECDKY    CHAINSECACE               80                   S01510
304400200610     C           *IN80     IFEQ '0'                                       S01510
304500200610     C           RECI      IFEQ 'R'                                                           260331
304600200610     C           SAAT      ANDEQ'DV'                                                          260331
304700200610     C                     MOVEL'Y'       WRVPOS                                              260331
304800200610     C                     ENDIF                                                              260331
304900200610     C           AKRI      IFEQ 'Y'                                       S01510
305000200610     C                     Z-ADD0         SDAD                            S01510
305100200610     C                     END                                            S01510
305200200610     C           PSRI      IFEQ 'Y'                                       S01510
305300200610     C                     Z-ADD0         SDDT                            S01510
305400200610     C                     END                                            S01510
305500200610     C                     END                                            S01510
305600200610     C*                                                                   S01510
305700200610     C           SDAD      IFNE *ZEROS                                    S01510
305800200610     C           SDDT      ORNE *ZEROS                                    S01510
305900200610     C                     MOVE 'Y'       WDIFF                           S01510
306000200610     C                     Z-ADDWCSNTP    WBCSNT                          S01510
306100200610     C           BKPRCU    IFEQ 'Y'                                       174703
306200200610     C                     EXSR SEPCIN                                    S01510
306300200610     C                     ENDIF                                          174703
306400200610     C                     EXSR DIVIDN                                    S01510
306500200610     C           SDDT      IFNE *ZEROS                                    S01510
306600200610     C                     ADD  1         WPCNTI                          S01510
306700200610     C                     END                                            S01510
306800200610     C                     END                                            S01510
306900200610     C*                                                                   S01510
307000200610     C                     END                                            S01510
307100200610     C                     END                                            S01510
307200200610     C*                                                                   S01510
307300200610     C                     MOVE '1'       *IN79                           S01510
307400200610     C*                                                                   S01510
307500200610     C                     ENDSR                                          S01510
307600200610      *                                                                   S01510
307700200610      *****************************************************************   S01510
307800200610      /EJECT
307900200610      *****************************************************************
308000200610      *                                                               *
308100200610      *  ACCUM  - Subroutine to accumulate changes for this Date.     *
308200200610      *                                                               *
308300200610      *****************************************************************
308400200610      *
308500200610     C           ACCUM     BEGSR                           ** ACCUM **
308600200610     C*
308700200610     C*  ACCUMULATE ALL MOVEMENTS/TRADES/SETTLEMENTS FOR ONE DATE
308800200610     C*
308900200610     C*  CUST. MOVEMENT
309000200610     C*
309100200610     C           *IN01     IFEQ '1'
309200200610     C*
309300200610     C* IF A REVERSAL, REVERSE THE SIGN OF THE NOMINAL
309400200610     C*
309500200610     C           WREVER    IFEQ 'Y'
309600200610     C                     Z-SUBCMNA      CMNA
309700200610     C                     END
309800200610     C/COPY WNCPYSRC,SE2380C021
309900200610      *                                                                   CSE017
310000200610     C           WTYPE     IFEQ 'CI'                                      CSE017
310100200610     C           WDBASE    ANDEQ'T'                                       CSE017
310200200610     C           PROT      ANDEQ'4'                                       CSE017
310300200610     C           CPIN      ANDEQ'X'                                       CSE017
310400200610     C                     ADD  CMNA      WCSEX                           CSE017
310500200610      *                                                                                       CGL031
310600200610     C           CGL031    IFEQ 'Y'                                                           CGL031
310700200610     C                     ADD  PCHI      WCSPI                                               CGL031
310800200610     C                     ENDIF                                                              CGL031
310900200610      *                                                                                       CGL031
311000200610     C                     ENDIF                                          CSE017
311100200610      *                                                                   CSE017
311200200610     C           WTYPE     IFEQ 'CI'                                      CSE017
311300200610     C           WDBASE    ANDEQ'C'                                       CSE017
311400200610     C           PROT      ANDNE'4'                                       CSE017
311500200610     C           CPIN      ANDEQ'X'                                       CSE017
311600200610     C                     ADD  CMNA      WCSEX                           CSE017
311700200610      *                                                                                       CGL031
311800200610     C           CGL031    IFEQ 'Y'                                                           CGL031
311900200610     C                     ADD  PCHI      WCSPI                                               CGL031
312000200610     C                     ENDIF                                                              CGL031
312100200610      *                                                                                       CGL031
312200200610     C                     ENDIF                                          CSE017
312300200610      *                                                                   CSE017
312400200610     C           WTYPE     IFEQ 'CI'                                      CSE017
312500200610     C           WDBASE    ANDEQ'A'                                       CSE017
312600200610     C           CPIN      ANDEQ'X'                                       CSE017
312700200610     C                     ADD  CMNA      WCSEX                           CSE017
312800200610      *                                                                                       CGL031
312900200610     C           CGL031    IFEQ 'Y'                                                           CGL031
313000200610     C                     ADD  PCHI      WCSPI                                               CGL031
313100200610     C                     ENDIF                                                              CGL031
313200200610      *                                                                                       CGL031
313300200610     C                     ENDIF                                          CSE017
313400200610      *                                                                   CSE017
313500200610     C           WTYPE     IFEQ 'CO'                                      CSE017
313600200610     C           WDBASE    ANDEQ'T'                                       CSE017
313700200610     C           PROT      ANDEQ'4'                                       CSE017
313800200610     C           CPIN      ANDEQ'X'                                       CSE017
313900200610     C                     SUB  CMNA      WCSEX                           CSE017
314000200610      *                                                                                       CGL031
314100200610     C           CGL031    IFEQ 'Y'                                                           CGL031
314200200610     C                     SUB  PCHI      WCSPI                                               CGL031
314300200610     C                     ENDIF                                                              CGL031
314400200610      *                                                                                       CGL031
314500200610     C                     ENDIF                                          CSE017
314600200610      *                                                                   CSE017
314700200610     C           WTYPE     IFEQ 'CO'                                      CSE017
314800200610     C           WDBASE    ANDEQ'C'                                       CSE017
314900200610     C           PROT      ANDNE'4'                                       CSE017
315000200610     C           CPIN      ANDEQ'X'                                       CSE017
315100200610     C                     SUB  CMNA      WCSEX                           CSE017
315200200610      *                                                                                       CGL031
315300200610     C           CGL031    IFEQ 'Y'                                                           CGL031
315400200610     C                     SUB  PCHI      WCSPI                                               CGL031
315500200610     C                     ENDIF                                                              CGL031
315600200610      *                                                                                       CGL031
315700200610     C                     ENDIF                                          CSE017
315800200610      *                                                                   CSE017
315900200610     C           WTYPE     IFEQ 'CO'                                      CSE017
316000200610     C           WDBASE    ANDEQ'A'                                       CSE017
316100200610     C           CPIN      ANDEQ'X'                                       CSE017
316200200610     C                     SUB  CMNA      WCSEX                           CSE017
316300200610      *                                                                                       CGL031
316400200610     C           CGL031    IFEQ 'Y'                                                           CGL031
316500200610     C                     SUB  PCHI      WCSPI                                               CGL031
316600200610     C                     ENDIF                                                              CGL031
316700200610      *                                                                                       CGL031
316800200610     C                     ENDIF                                          CSE017
316900200610      *                                                                   CSE017
317000200610     C*
317100200610     C**  TYPE IS USER TRANSFER IN, DATE BASIS IS T = TRADE
317200200610     C*
317300200610     C           WTYPE     IFEQ 'CI'
317400200610     C           WDBASE    ANDEQ'T'
317500200610     C*
317600200610     C* ADD TO TRADE NOMINAL
317700200610     C*
317800200610     C                     ADD  CMNA      WCSNT
317900200610     C                     END
318000200610     C*
318100200610     C**  TYPE IS USER TRANSFER IN, DATE BASIS IS C = VALUE AND SETTL.
318200200610     C*
318300200610     C           WTYPE     IFEQ 'CI'
318400200610     C           WDBASE    ANDEQ'C'
318500200610     C*
318600200610     C* ADD TO VALUE NOMINAL AND SETTLEMENT NOMINAL
318700200610     C*
318800200610     C                     ADD  CMNA      WCSNV
318900200610     C                     ADD  CMNA      WCSNS
319000200610     C                     END
319100200610     C*
319200200610     C**  TYPE IS USER TRANSFER IN, DATE BASIS IS A = ALL DATES
319300200610     C*
319400200610     C           WTYPE     IFEQ 'CI'
319500200610     C           WDBASE    ANDEQ'A'
319600200610     C*
319700200610     C* ADD TO NOMINAL TRADE, SETTLEMENT AND VALUE
319800200610     C*
319900200610     C                     ADD  CMNA      WCSNT
320000200610     C                     ADD  CMNA      WCSNV
320100200610     C                     ADD  CMNA      WCSNS
320200200610     C                     END
320300200610     C*
320400200610     C**  TYPE IS USER TRANSFER OUT, DATE BASIS IS T = TRADE
320500200610     C*
320600200610     C           WTYPE     IFEQ 'CO'
320700200610     C           WDBASE    ANDEQ'T'
320800200610     C*
320900200610     C* SUB FROM TRADE NOMINAL
321000200610     C*
321100200610     C                     SUB  CMNA      WCSNT
321200200610     C                     END
321300200610     C*
321400200610     C**  TYPE IS USER TRANSFER OUT, DATE BASIS IS C = VALUE AND SETTL.
321500200610     C*
321600200610     C           WTYPE     IFEQ 'CO'
321700200610     C           WDBASE    ANDEQ'C'
321800200610     C*
321900200610     C* SUB FROM VALUE NOMINAL AND SETTLEMENT NOMINAL
322000200610     C*
322100200610     C                     SUB  CMNA      WCSNV
322200200610     C                     SUB  CMNA      WCSNS
322300200610     C                     END
322400200610     C*
322500200610     C**  TYPE IS USER TRANSFER OUT, DATE BASIS IS A = ALL DATES
322600200610     C*
322700200610     C           WTYPE     IFEQ 'CO'
322800200610     C           WDBASE    ANDEQ'A'
322900200610     C*
323000200610     C* SUB FROM NOMINAL TRADE, SETTLEMENT AND VALUE
323100200610     C*
323200200610     C                     SUB  CMNA      WCSNT
323300200610     C                     SUB  CMNA      WCSNV
323400200610     C                     SUB  CMNA      WCSNS
323500200610     C                     END
323600200610     C*
323700200610     C** TYPE IS CUSTOMER WALK IN
323800200610     C*
323900200610     C**  TYPE IS CUST WALK IN, DATE BASIS IS T = TRADE
324000200610     C*
324100200610     C           WTYPE     IFEQ 'WI'
324200200610     C           WDBASE    ANDEQ'T'
324300200610     C*
324400200610     C* ADD TO TRADE NOMINAL
324500200610     C*
324600200610     C                     ADD  CMNA      WCSNT
324700200610     C                     END
324800200610     C*
324900200610     C**  TYPE IS CUST WALK IN, DATE BASIS IS C = VALUE AND SETTL.
325000200610     C*
325100200610     C           WTYPE     IFEQ 'WI'
325200200610     C           WDBASE    ANDEQ'C'
325300200610     C*
325400200610     C* ADD TO VALUE NOMINAL AND SETTLEMENT NOMINAL
325500200610     C*
325600200610     C                     ADD  CMNA      WCSNV
325700200610     C                     ADD  CMNA      WCSNS
325800200610     C                     END
325900200610     C*
326000200610     C**  TYPE IS CUST WALK IN, DATE BASIS IS A = ALL DATES
326100200610     C*
326200200610     C           WTYPE     IFEQ 'WI'
326300200610     C           WDBASE    ANDEQ'A'
326400200610     C*
326500200610     C* ADD TO NOMINAL TRADE, SETTLEMENT AND VALUE
326600200610     C*
326700200610     C                     ADD  CMNA      WCSNT
326800200610     C                     ADD  CMNA      WCSNV
326900200610     C                     ADD  CMNA      WCSNS
327000200610     C                     END
327100200610     C*
327200200610     C**  TYPE IS CUST WALK OUT, DATE BASIS IS T = TRADE
327300200610     C*
327400200610     C           WTYPE     IFEQ 'WO'
327500200610     C           WDBASE    ANDEQ'T'
327600200610     C*
327700200610     C* SUB FROM TRADE NOMINAL
327800200610     C*
327900200610     C                     SUB  CMNA      WCSNT
328000200610     C                     END
328100200610     C*
328200200610     C**  TYPE IS CUST WALK OUT, DATE BASIS IS C = VALUE AND SETTL.
328300200610     C*
328400200610     C           WTYPE     IFEQ 'WO'
328500200610     C           WDBASE    ANDEQ'C'
328600200610     C*
328700200610     C* SUB FROM VALUE NOMINAL AND SETTLEMENT NOMINAL
328800200610     C*
328900200610     C                     SUB  CMNA      WCSNV
329000200610     C                     SUB  CMNA      WCSNS
329100200610     C                     END
329200200610     C*
329300200610     C**  TYPE IS CUST WALK OUT, DATE BASIS IS A = ALL DATES
329400200610     C*
329500200610     C           WTYPE     IFEQ 'WO'
329600200610     C           WDBASE    ANDEQ'A'
329700200610     C*
329800200610     C* SUB FROM NOMINAL TRADE, SETTLEMENT AND VALUE
329900200610     C*
330000200610     C                     SUB  CMNA      WCSNT
330100200610     C                     SUB  CMNA      WCSNV
330200200610     C                     SUB  CMNA      WCSNS
330300200610     C                     END
330400200610     C*
330500200610     C* NEXT END IS END OF *IN04 IFEQ '1',= CUST .MOVEMENT ACTION TYPES
330600200610     C*
330700200610     C                     END
330800200610     C*
330900200610     C*  SETTLEMENTS ACTION RECORD
331000200610     C*
331100200610     C           *IN02     IFEQ '1'
331200200610     C*
331300200610     C* IF A REVERSAL, REVERSE THE SIGN OF THE NOMINAL
331400200610     C*
331500200610     C           WREVER    IFEQ 'Y'
331600200610     C                     Z-SUBSNMS      SNMS
331700200610     C                     END
331800200610     C*
331900200610     C*
332000200610     C**  TYPE IS SETTLEMENT PURCHASE, DATE BASIS IS S = SETTLEMENT
332100200610     C*
332200200610     C           WTYPE     IFEQ 'TP'
332300200610     C           WDBASE    ANDEQ'S'
332400200610     C*
332500200610     C**ADD*TO*NOMINAL**SETTLEMENT*************************************   E13561
332600200610     C* SUB FROM NOMINAL SETTLEMENT                                       E13561
332700200610     C*
332800200610     C**********           ADD  SNMS      WCSNS                           E13561
332900200610     C                     SUB  SNMS      WCSNS                           E13561
333000200610     C                     END
333100200610     C*
333200200610     C**  TYPE IS SETTLEMENT SALE, DATE BASIS IS S = SETTLEMENT
333300200610     C*
333400200610     C           WTYPE     IFEQ 'TS'
333500200610     C           WDBASE    ANDEQ'S'
333600200610     C*
333700200610     C**SUB*FROM*NOMINAL**SETTLEMENT***********************************   E13561
333800200610     C* ADD TO NOMINAL SETTLEMENT                                         E13561
333900200610     C*
334000200610     C**********           SUB  SNMS      WCSNS                           E13561
334100200610     C                     ADD  SNMS      WCSNS                           E13561
334200200610     C                     END
334300200610     C*
334400200610     C* NEXT END IS END OF *IN02 IFEQ '1',= SETTLEMENT ACTION TYPES
334500200610     C*
334600200610     C                     END
334700200610     C*
334800200610     C*  TRADE ACTION RECORD
334900200610     C*
335000200610     C           *IN03     IFEQ '1'
335100200610     C*
335200200610     C* IF A REVERSAL REVERSE THE SIGN OF THE NOMINAL
335300200610     C*
335400200610     C           WREVER    IFEQ 'Y'
335500200610     C                     Z-SUBNOML      NOML
335600200610     C                     END
335700200610     C*
335800200610     C**  TYPE IS TRADE PURCHASE, DATE BASIS IS T = TRADE
335900200610     C*
336000200610     C           WTYPE     IFEQ ' P'
336100200610     C           WDBASE    ANDEQ'T'
336200200610     C*
336300200610     C**ADD*TO*NOMINAL**TRADE******************************************   E13561
336400200610     C* SUB FROM NOMINAL TRADE                                            E13561
336500200610     C*
336600200610     C**********           ADD  NOML      WCSNT                           E13561
336700200610     C                     SUB  NOML      WCSNT                           E13561
336800200610     C*                                                                   E21303
336900200610     C** IF A SHARE & ACCRUAL IND. IS X IT IS EX-DIVIDEND.UPDATE THIS TOO E21303
337000200610     C*                                                                   E21303
337100200610     C           PROT      IFEQ '4'                                       E21303
337200200610     C           ACRI      ANDEQ'X'                                       E21303
337300200610     C                     SUB  NOML      WCSEX                           E21303
337400200610      *                                                                                       CGL031
337500200610     C           CGL031    IFEQ 'Y'                                                           CGL031
337600200610     C                     SUB  NOML      WCSPI                                               CGL031
337700200610     C                     ENDIF                                                              CGL031
337800200610      *                                                                                       CGL031
337900200610     C                     END                                            E21303
338000200610     C                     END
338100200610     C*
338200200610     C**  TYPE IS TRADE PURCHASE, DATE BASIS IS V = VALUE
338300200610     C*
338400200610     C           WTYPE     IFEQ ' P'
338500200610     C           WDBASE    ANDEQ'V'
338600200610     C*
338700200610     C**ADD*TO*NOMINAL**VALUE******************************************   E13561
338800200610     C* SUB FROM NOMINAL VALUE                                            E13561
338900200610     C*
339000200610     C**********           ADD  NOML      WCSNV                           E13561
339100200610     C                     SUB  NOML      WCSNV                           E13561
339200200610     C*
339300200610     C** IF A ACCRUAL INDICATOR IS X IT IS EX-COUPON - UPDATE THIS TOO
339400200610     C*
339500200610     C           ACRI      IFEQ 'X'
339600200610     C           PROT      ANDNE'4'                                       E21303
339700200610     C**********           ADD  NOML      WCSEX                           E13561
339800200610     C                     SUB  NOML      WCSEX                           E13561
339900200610      *                                                                                       CGL031
340000200610     C           CGL031    IFEQ 'Y'                                                           CGL031
340100200610     C                     SUB  NOML      WCSPI                                               CGL031
340200200610     C                     ENDIF                                                              CGL031
340300200610      *                                                                                       CGL031
340400200610     C                     END
340500200610     C                     END
340600200610     C*
340700200610     C**  TYPE IS TRADE SALE, DATE BASIS IS T = TRADE
340800200610     C*
340900200610     C           WTYPE     IFEQ ' S'
341000200610     C           WDBASE    ANDEQ'T'
341100200610     C*
341200200610     C**SUB*FROM*NOMINAL**TRADE****************************************   E13561
341300200610     C* ADD TO NOMINAL TRADE                                              E13561
341400200610     C*
341500200610     C**********           SUB  NOML      WCSNT                           E13561
341600200610     C                     ADD  NOML      WCSNT                           E13561
341700200610     C*                                                                   E21303
341800200610     C** IF A SHARE & ACCRUAL IND. IS X IT IS EX-DIVIDEND.UPDATE THIS TOO E21303
341900200610     C*                                                                   E21303
342000200610     C           PROT      IFEQ '4'                                       E21303
342100200610     C           ACRI      ANDEQ'X'                                       E21303
342200200610     C                     ADD  NOML      WCSEX                           E21303
342300200610      *                                                                                       CGL031
342400200610     C           CGL031    IFEQ 'Y'                                                           CGL031
342500200610     C                     ADD  NOML      WCSPI                                               CGL031
342600200610     C                     ENDIF                                                              CGL031
342700200610      *                                                                                       CGL031
342800200610     C                     END                                            E21303
342900200610     C                     END
343000200610     C*
343100200610     C**  TYPE IS TRADE SALE, DATE BASIS IS V = VALUE
343200200610     C*
343300200610     C           WTYPE     IFEQ ' S'
343400200610     C           WDBASE    ANDEQ'V'
343500200610     C*
343600200610     C**SUB*FROM*NOMINAL**VALUE****************************************   E13561
343700200610     C* ADD TO NOMINAL VALUE                                              E13561
343800200610     C*
343900200610     C**********           SUB  NOML      WCSNV                           E13561
344000200610     C                     ADD  NOML      WCSNV                           E13561
344100200610     C*
344200200610     C** IF A ACCRUAL INDICATOR IS X IT IS EX-COUPON - UPDATE THIS TOO
344300200610     C*
344400200610     C           ACRI      IFEQ 'X'
344500200610     C           PROT      ANDNE'4'                                       E21303
344600200610     C**********           SUB  NOML      WCSEX                           E13561
344700200610     C                     ADD  NOML      WCSEX                           E13561
344800200610      *                                                                                       CGL031
344900200610     C           CGL031    IFEQ 'Y'                                                           CGL031
345000200610     C                     ADD  NOML      WCSPI                                               CGL031
345100200610     C                     ENDIF                                                              CGL031
345200200610      *                                                                                       CGL031
345300200610     C                     END
345400200610     C                     END
345500200610     C*
345600200610     C* NEXT END IS END OF *IN03 IFEQ '1',= TRADE ACTION TYPES
345700200610     C*
345800200610     C                     END
345900200610     C*
346000200610     C                     ENDSR
346100200610      *
346200200610      *****************************************************************
346300200610      /EJECT
346400200610      *****************************************************************
346500200610      *                                                               *
346600200610      *  DIVIDN - Subroutine to produce Dividend Account Keys and/or  *
346700200610      *           Position Settlements.                               *
346800200610      *                                                               *
346900200610      *****************************************************************
347000200610      *
347100200610     C           DIVIDN    BEGSR                           ** DIVIDN **
347200200610     C*
347300200610     C** CALCULATE DIVIDEND DUE
347400200610     C*
347500200610     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
347600200610     C** If S01509 is active, use value ccy rather than nominal ccy       S01509
347700200610     C*
347800200610     C********** S01509    IFEQ 'Y'                                                  S01509 BUG11198
347900200610     C**********           MOVE VLCY      WCURR                                      S01509 BUG11198
348000200610     C**********           ELSE                                                      S01509 BUG11198
348100200610     C                     MOVE NMCY      WCURR   3
348200200610     C**********           END                                                       S01509 BUG11198
348300200610     C                     EXSR TG10
348400200610     C*                                                                   S01446
348500200610     C** For Courtage Enhancement, if Autocharge option is 'Y' and        S01446
348600200610     C** charge currency is not blank, update fields                      S01446
348700200610     C*                                                                   S01446
348800200610     C           S01446    IFEQ 'Y'                                       S01446
348900200610     C           BVACOP    ANDEQ'Y'                                       S01446
349000200610     C           BVCHRC    ANDNE*BLANKS                                   S01446
349100200610     C*                                                                   S01446
349200200610     C** Get M/D indicator and spot rate of input ccy from SDCURRPD       S01446
349300200610     C*                                                                   S01446
349400200610     C                     Z-ADD29        WDBAS1  30                      S01446
349500200610     C                     EXSR #LCURR                                    S01446
349600200610     C                     Z-ADDA6SPRT    ZRATE2 138                      S01446
349700200610     C                     MOVE A6MDIN    ZMDI2   1                       S01446
349800200610     C                     Z-ADDTXSPOT    ZRATE1 138                      S01446
349900200610     C                     MOVE TXMDI     ZMDI1   1                       S01446
350000200610     C                     EXSR ZXRATE                                    S01446
350100200610     C                     MOVE ZRATEX    TRATEX 138                      S01446
350200200610     C                     MOVE ZMDIX     TMDIX   1                       S01446
350300200610     C                     END                                            S01446
350400200610      *                                                                   E19610
350500200610      *  FOR DIVIDENDS, CALCULATE CUM-COUPON VALUE USING THE TRADE DATE   E19610
350600200610      *  POSITION INSTEAD OF THE VALUE DATE.                              E19610
350700200610     C** If S01510 is active, then the cum-coupon value must be the       S01510
350800200610     C** trade date nominal                                               S01510
350900200610     C*** (Use Value date position if required)                           095066
351000200610      *                                                                                      251950A
351100200610      ** If WPORTP = 'Y' retrieve the correct nominal from PF/PMBVALPD                       251950A
351200200610      *                                                                   E19610
351300200610     C           S01510    IFEQ 'Y'                                       S01510
351400200610     C           CSE008    IFNE 'Y'                                       095066
351500200610      *                                                                                      251950A
351600200610     C           WPORTP    IFEQ 'Y'                                                          251950A
351700200610     C                     Z-ADDGGCSNT    WCUMCP                                             251950A
351800200610     C                     ELSE                                                              251950A
351900200610     C                     Z-ADDWBCSNT    WCUMCP                          S01510
352000200610     C                     ENDIF                                                             251950A
352100200610      *                                                                                      251950A
352200200610     C                     ELSE                                           095066
352300200610      *                                                                                      251950A
352400200610     C           WPORTP    IFEQ 'Y'                                                          251950A
352500200610     C                     Z-ADDGGCSNV    WCUMCP                                             251950A
352600200610     C                     ELSE                                                              251950A
352700200610     C                     Z-ADDWBCSNV    WCUMCP                          095066
352800200610     C                     ENDIF                                                             251950A
352900200610      *                                                                                      251950A
353000200610     C                     END                                            095066
353100200610     C                     ELSE                                           S01510
353200200610     C           WPORTP    IFNE 'Y'                                       S01486
353300200610     C           BGPFMG    ANDEQ'Y'                                       S01486
353400200610     C*                                                                   CPB002
353500200610     C           WPORTP    ORNE 'Y'                                       CPB002
353600200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
353700200610     C*
353800200610     C           BGPFMG    ORNE 'Y'                                       S01486
353900200610     C           BGN4ST    ANDNE'Y'                                       CPB002
354000200610     C*
354100200610     C           CSE008    IFNE 'Y'                                       095066
354200200610     C           WBCSNT    SUB  WBCSEX    WCUMCP                          E19610
354300200610     C                     ELSE                                           095066
354400200610     C           WBCSNV    SUB  WBCSEX    WCUMCP                          095066
354500200610     C                     END                                            095066
354600200610     C                     END                                            S01486
354700200610     C                     END                                            S01510
354800200610     C*
354900200610     C* DIVIDEND DUE CALCULATION
355000200610     C* CUM-COUPON MULTIPLIED BY AMOUNT PER UNIT (SDDV)
355100200610     C* GIVING WORK (15/4). MULTIPLY BY POWER VALUE AND RESULT IN 13/0
355200200610     C*
355300200610     C***********          Z-ADD0         DC                              E22638
355400200610     C*
355500200610     C***********          SUB  NMDP      DC      10                      E22638
355600200610     C***********DC        ADD  5         DC      10                      E22638
355700200610     C***********WCUMCP    MULT POWER8,DC WRK154                          E20086
355800200610     C***********WCUMCP    MULT POWER8,DC WRK154 154                E20086E22638
355900200610     C*
356000200610     C***********WRK154    MULT SDDV      WRK154 154                      E16772
356100200610     C***********WRK154    MULT SDVA      WRK158                   E16772 E20086
356200200610     C***********WRK154    MULT SDVA      WRK158 158         E16772 E20086E22638
356300200610     C***********CDP       ADD  5         DC                              E22638
356400200610     C***********WRK154    MULT POWER8,DC WRK154                          E16772
356500200610     C***********WRK158    MULT POWER8,DC WRK158                    E16772E22638
356600200610     C***********WRK154    DIV  1         WDIVDU 130H                     E16772
356700200610     C***********WRK158    DIV  1         WDIVDU 130H               E16772E22638
356800200610     C*
356900200610     C** IF PRICE BASIS (SECTYD) IS 'P', DIVIDE BY 100
357000200610     C*
357100200610     C***********SPBS      IFEQ 'P'                                       E22638
357200200610     C***********WDIVDU    DIV  100       WDIVDU    H                     E22638
357300200610     C***********          END                                            E22638
357400200610     C** USE SUBROUTINE ZCNSD TO CALCULATE DIVIDEND DUE                   E22638
357500200610     C                     Z-ADDWCUMCP    ZNOML                           E22638
357600200610     C                     Z-ADDSDVA      ZPRC                            E22638
357700200610     C***********SPBS      IFEQ 'P'                                E23169 087712
357800200610     C***********          MULT 100       ZPRC                     E23169 087712
357900200610     C***********          END                                     E23169 087712
358000200610     C                     EXSR ZCNSD                                     E22638
358100200610     C                     Z-ADDZCONS     WDIVDU 150                      E22638
358200200610     C** If S01509 is active, and value currency is different from                          BUG11198
358300200610     C** nominal currency, convert coupon amount to value currency                          BUG11198
358400200610     C*                                                                                     BUG11198
358500200610     C           S01509    IFEQ 'Y'                                                         BUG11198
358600200610     C           NMCY      ANDNEVLCY                                                        BUG11198
358700200610     C                     MOVE NMCY      WCURR   3                                         BUG11198
358800200610     C                     EXSR TG10                                                        BUG11198
358900200610     C                     Z-ADDZCDP      ZCDPI                                             BUG11198
359000200610     C                     MOVE VLCY      WCURR   3                                         BUG11198
359100200610     C                     EXSR TG10                                                        BUG11198
359200200610     C                     Z-ADDZCDP      ZCDPO                                             BUG11198
359300200610     C                     MOVE NMCY      ZCCYI                                             BUG11198
359400200610     C                     MOVE VLCY      ZCCYO                                             BUG11198
359500200610     C                     Z-ADDWDIVDU    ZAMTCI                                            BUG11198
359600200610     C*                                                                                     BUG11198
359700200610     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event                     BUG11198
359800200610     C** found, else from SECTYD                                                            BUG11198
359900200610     C*                                                                                     BUG11198
360000200610     C                     MOVE SDET      WKDET   2                                         BUG11198
360100200610     C                     MOVE 'XR'      SDET                                              BUG11198
360200200610     C           SECETY    SETLLSEDEVDO                                                     BUG11198
360300200610     C                     READ SEDEVDO                  81                                 BUG11198
360400200610     C           *IN81     IFEQ '0'                                                         BUG11198
360500200610     C           SDSN      ANDEQSASN                                                        BUG11198
360600200610     C           SDET      ANDEQ'XR'                                                        BUG11198
360700200610     C                     Z-ADDSDCE      ZEXCH                                             BUG11198
360800200610     C                     MOVE SDMD      ZMD                                               BUG11198
360900200610     C                     ELSE                                                             BUG11198
361000200610     C                     Z-ADDSEXR      ZEXCH                                             BUG11198
361100200610     C                     MOVE SMDI      ZMD                                               BUG11198
361200200610     C                     ENDIF                                                            BUG11198
361300200610     C                     MOVE WKDET     SDET                                              BUG11198
361400200610     C                     EXSR ZCONV                                                       BUG11198
361500200610     C                     Z-ADDZAMTCO    WDIVDU                                            BUG11198
361600200610     C                     ENDIF                                                            BUG11198
361700200610     C/COPY WNCPYSRC,SE2380C045
361800200610     C*
361900200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W03
362000200610     C*
362100200610     C           SDAD      IFNE 0
362200200610     C                     MOVE 'H'       WACEVC
362300200610     C*
362400200610     C** SET NEGATIVE IND TO N IF SPLIT NEG ACCRUAL IS NOT N AND
362500200610     C** AND CUM-COUPON VALUE NOT GREATER THAN ZERO
362600200610     C*
362700200610     C           SNAC      IFEQ 'N'
362800200610     C           WCUMCP    ORGT 0
362900200610     C                     MOVE ' '       WACNEG
363000200610     C                     ELSE
363100200610     C                     MOVE 'N'       WACNEG
363200200610     C                     END
363300200610     C                     MOVE 'DI'      WACAMC
363400200610     C                     Z-ADDWDIVDU    EVAM
363500200610     C*
363600200610     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG ACCRUAL IS Y AND
363700200610     C** CUM-COUPON VALUE IS LESS THAN ZERO
363800200610     C*
363900200610     C           WCUMCP    IFLT 0
364000200610     C           SNAC      ANDEQ'Y'
364100200610     C                     Z-SUBEVAM      EVAM
364200200610     C                     END
364300200610     C                     EXSR W03
364400200610     C/COPY WNCPYSRC,SE2380C001
364500200610     C                     END
364600200610     C*
364700200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
364800200610     C*
364900200610     C           SDDT      IFNE 0
365000200610     C                     MOVE 'DV'      PEVT
365100200610     C***********          Z-ADDWCUMCP    PNMP                      E23169S01486
365200200610     C***********CSNV      SUB  CSEX      WRK150 150                      E23169
365300200610     C***********          Z-ADDWRK150    PNMP                            E23169
365400200610     C           BGPFMG    IFNE 'Y'                                       081239
365500200610     C           BGN4ST    ANDNE'Y'                                       CPB002
365600200610     C                     Z-ADDWCUMCP    PNMP                            081239
365700200610     C                     ELSE                                           081239
365800200610     C                     Z-ADDWCUMCP    WRK150 150                      S01486
365900200610     C                     Z-ADDWRK150    PNMP                            S01486
366000200610     C                     END                                            081239
366100200610     C           WDIVDU    IFLT 0
366200200610     C                     Z-SUBWDIVDU    PAMD
366300200610     C/COPY WNCPYSRC,SE2380C046
366400200610     C                     ELSE
366500200610     C                     Z-ADDWDIVDU    PAMD
366600200610     C                     END
366700200610     C***********WRK150    IFGT 0                                         E23169
366800200610     C           WCUMCP    IFGT 0                                         E23169
366900200610     C**********           MOVE 'R'       PPRE                            E14704
367000200610     C                     MOVE 'P'       PPRE                            E14704
367100200610     C                     ELSE
367200200610     C**********           MOVE 'P'       PPRE                            E14704
367300200610     C                     MOVE 'R'       PPRE                            E14704
367400200610     C                     END
367500200610      *                                                                                       260331
367600200610     C           WRVPOS    IFEQ 'Y'                                                           260331
367700200610     C           PPRE      IFEQ 'R'                                                           260331
367800200610     C                     MOVEL'P'       PPRE                                                260331
367900200610     C                     ELSE                                                               260331
368000200610     C           PPRE      IFEQ 'P'                                                           260331
368100200610     C                     MOVEL'R'       PPRE                                                260331
368200200610     C                     ENDIF                                                              260331
368300200610     C                     ENDIF                                                              260331
368400200610     C                     ENDIF                                                              260331
368500200610      *                                                                                       260331
368600200610     C                     EXSR W02
368700200610     C/COPY WNCPYSRC,SE2380C047
368800200610     C                     END
368900200610     C*
369000200610     C           ENDDIV    ENDSR                           **ENDDIV**
369100200610      *
369200200610      *****************************************************************
369300200610      /EJECT
369400200610      *****************************************************************
369500200610      *                                                               *
369600200610      *  COUPON - Subroutine to produce Coupon Account Keys and/or    *
369700200610      *           Position Settlements.                               *
369800200610      *                                                               *
369900200610      *****************************************************************
370000200610      *
370100200610     C           COUPON    BEGSR                           ** COUPON **
370200200610      *
370300200610      *  WORK FIELDS FOR THE A/K COUPON DATE AND POS. SETL. COUPON DATE   064754
370400200610      *                                                                   064754
370500200610     C                     Z-ADD0         SAVDAD  50                      064754
370600200610     C                     Z-ADD0         SAVDDT  50                      064754
370700200610     C*
370800200610     C** CALCULATE INTEREST DUE VIA P/ZACCRC FOR SECURITY
370900200610     C** FROM DATE IS LAST COUPON / TO DATE IS EVENT DATE.
371000200610     C** GET NOMINAL CCY DEC PLACES FROM TABTG10 FIRST (CDP)
371100200610     C*
371200200610     C                     MOVE NMCY      WCURR   3
371300200610     C                     EXSR TG10
371400200610     C*                                                                   S01486
371500200610     C**  If Portfolio Management is on...                                S01486
371600200610     C*                                                                   S01486
371700200610     C           BGPFMG    IFEQ 'Y'                                       S01486
371800200610     C           BGN4ST    OREQ 'Y'                                       CPB002
371900200610     C*                                                                   S01486
372000200610     C** IF SETTLEMENTS BASED ON PORTFOLIO POSITIONS USE STANDARD PM      S01486
372100200610     C** SUBROUTINES TO CALCULATE ACCRUAL AMOUNT                          S01486
372200200610     C           WPORTP    IFEQ 'Y'                                       S01486
372300200610     C*                                                                   S01486
372400200610     C** CALCULATE LAST COUPON DATE                                       S01486
372500200610     C           SDED      SUB  1         ZECD                            S01486
372600200610     C                     EXSR ZLCD                                      S01486
372700200610     C*                                                                   S01486
372800200610     C** IF THE PROCESSING TYPE FROM LF/INVTP IS NOT EQUAL TO 6 IE.       S01486
372900200610     C** THIS IS NOT A SCHULDSCHEIN SECURITY                              S01486
373000200610     C           PROT      IFNE '6'                                       S01486
373100200610     C                     Z-ADDWCUMCP    ZAMTP                           S01486
373200200610     C                     Z-ADDZZLCD     ZFMDAT                          S01486
373300200610     C                     Z-ADDSDED      ZTODAT                          S01486
373400200610     C                     Z-ADDSDED      NCD     50                      S01486
373500200610     C                     Z-ADDSDED      NDED    50                      053999
373600200610     C                     MOVELGGTDSS    ZSSNM                           S01486
373700200610     C                     Z-ADDCDP       A6NBDP                          S01486
373800200610     C*                                                                   S01486
373900200610      *  TO GENERATE ADJUSTED POSITION SETTLENENT FOR COUPON, SAVE        064754
374000200610      *  THE A/K COUPON DATE AND POS. SETL. COUPON DATE                   064754
374100200610      *                                                                   064754
374200200610     C                     Z-ADDSDAD      SAVDAD                          064754
374300200610     C                     Z-ADDSDDT      SAVDDT                          064754
374400200610      *                                                                   064754
374500200610     C** CALCULATE THE ACCRUED INTEREST FROM THE LAST COUPON DATE TO      S01486
374600200610     C** THE EVENT CONTROL DATE AS PER STANDARD SUBROUTINE ZAINSH         S01486
374700200610     C                     EXSR ZAINSH                                    S01486
374800200610     C                     Z-ADDNDED      SDED                            053999
374900200610     C                     Z-ADDNDED      SDDT                            053999
375000200610     C                     END                                            S01486
375100200610     C*                                                                   S01486
375200200610     C** IF THE PROCESSING TYPE FROM LF/INVTP IS EQUAL TO 6 IE.           S01486
375300200610     C** THIS IS A SCHULDSCHEIN SECURITY                                  S01486
375400200610     C           PROT      IFEQ '6'                                       S01486
375500200610     C                     Z-ADDZZLCD     ZFMDAT                          S01486
375600200610     C                     Z-ADDSDED      ZTODAT                          S01486
375700200610     C                     Z-ADDSDED      NCD                             S01486
375800200610     C******************** Z-ADDGGCSBR    ZCSBR                    S01486 081363
375900200610     C                     MOVELGGCSBR    ZCSBR                           081363
376000200610     C**********           Z-ADDGGCNUM    XCUST                                        S01486 CSD027
376100200610     C                     MOVE GGCNUM    XCUST                                               CSD027
376200200610     C                     MOVELGGPTFR    ZPTFR                           S01486
376300200610     C                     MOVELGGTDSS    ZSSNM                           S01486
376400200610     C                     Z-ADDCDP       A6NBDP                          S01486
376500200610     C*                                                                   S01486
376600200610     C** CALCULATE THE ACCRUED INTEREST FROM THE LAST COUPON DATE         S01486
376700200610     C** TO THE EVENT CONTROL DATE AS PER STANDARD SUBROUTINE ZAISCH      S01486
376800200610     C                     EXSR PSCH                                      S01486
376900200610     C                     END                                            S01486
377000200610     C*                                                                   S01486
377100200610     C                     Z-ADDZTOAI     ZINTDU                          S01486
377200200610     C*                                                                   S01486
377300200610     C** WHEN PARM ZAB IS 'A' , INTEREST IS CALCULATED AFTER CHANGES      S01486
377400200610     C*                                                                   S01486
377500200610     C                     END                                            S01486
377600200610     C                     END                                            S01486
377700200610     C*                                                                   S01486
377800200610     C           BGPFMG    IFNE 'Y'                                       S01486
377900200610     C           BGN4ST    ANDNE'Y'                                       CPB002
378000200610     C*                                                                   S01486
378100200610     C           WPORTP    ORNE 'Y'                                       S01486
378200200610     C           BGPFMG    ANDEQ'Y'                                       S01486
378300200610     C*                                                                   CPB002
378400200610     C           WPORTP    ORNE 'Y'                                       CPB002
378500200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
378600200610     C*
378700200610     C** WHEN PARM ZAB IS 'A', INTEREST IS CALCULATED AFTER CHANGES
378800200610     C** WHEN PARM ZAB IS 'B', INTEREST IS CALCULATED BEFORE CHANGES
378900200610     C*      I.E. 'CHANGES' ARE UPDATES DUE TO BACKVALUATIONS IN PGM
379000200610     C*
379100200610     C                     MOVE 'A'       ZAB
379200200610     C***********          UNLCKLDA                                       S01117
379300200610     C                     MOVE 'A'       ZAB
379400200610     C/COPY WNCPYSRC,SE2380C028
379500200610     C                     CALL 'ZACCRC'
379600200610     C***********          PARM           LCPN                            E21669
379700200610     C                     PARM           LCCP                            E21669
379800200610     C                     PARM           SDED
379900200610     C***********          PARM           CSBR                            S01117
380000200610     C                     PARM           CSBA                            S01117
380100200610     C***********          PARM           CSCN                            E37297
380200200610     C                     PARM           ZCUST                           E37297
380300200610     C                     PARM           CSSC
380400200610     C                     PARM           CDP
380500200610     C                     PARM           ZINTDU 150
380600200610     C                     PARM           ZAB     1
380700200610     C/COPY WNCPYSRC,SE2380C029
380800200610     C*
380900200610     C** IF WDIFF = Y, CALL ZACCRC AGAIN WITH STATUS B AND SUBTRACT 'A'
381000200610     C*
381100200610     C           WDIFF     IFEQ 'Y'
381200200610     C                     Z-ADDZINTDU    ZWINTD 150
381300200610     C                     MOVE 'B'       ZAB
381400200610     C***********          UNLCKLDA                                       S01117
381500200610     C/COPY WNCPYSRC,SE2380C030
381600200610     C                     CALL 'ZACCRC'
381700200610     C***********          PARM           LCPN                            E21669
381800200610     C                     PARM           LCCP                            E21669
381900200610     C                     PARM           SDED
382000200610     C***********          PARM           CSBR                            S01117
382100200610     C                     PARM           CSBA                            S01117
382200200610     C                     PARM           CSCN
382300200610     C                     PARM           CSSC
382400200610     C                     PARM           CDP
382500200610     C                     PARM           ZINTDU 150
382600200610     C                     PARM           ZAB     1
382700200610     C/COPY WNCPYSRC,SE2380C031
382800200610     C*
382900200610     C*   U7 AND U8 ON IF DATABASE ERROR DURING ZACCR PROCESSING
383000200610     C*
383100200610     C   U7 U8             GOTO EAUDIT
383200200610     C           ZWINTD    SUB  ZINTDU    ZINTDU
383300200610     C                     END
383400200610     C/COPY WNCPYSRC,SE2380C002
383500200610     C                     END                                            S01486
383600200610     C*
383700200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
383800200610     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
383900200610     C********** FRATE     IFLE 0                                               AR1001183 AR1001183A
384000200610      ***The*following*field*sets*PAMD*to*zero                                  AR1001183 AR1001183A
384100200610     C**********           Z-ADD0         ZINTDU                                AR1001183 AR1001183A
384200200610     C**********           ENDIF                                                AR1001183 AR1001183A
384300200610     C**********           ENDIF                                                AR1001183 AR1001183A
384400200610     C           *LOCK     IN   LDA
384500200610      *** Correct setup of DBPGM
384600200610     C***********          MOVE 'SE2380  'DBPGM
384700200610     C                     MOVE *BLANKS   DBPGM
384800200610     C                     MOVEL'SE2380'  DBPGM
384900200610     C                     OUT  LDA                                       S01117
385000200610     C           BGPFMG    IFEQ 'Y'                                       S01486
385100200610     C           BGN4ST    OREQ 'Y'                                       CPB002
385200200610     C           W03FLG    CABEQ'Y'       ENDCPN                          S01486
385300200610     C                     END                                            S01486
385400200610     C*                                                                   S01509
385500200610     C** If S01509 is active, and value currency is different from        S01509
385600200610     C** nominal currency, convert coupon amount to value currency        S01509
385700200610     C*                                                                   S01509
385800200610     C           S01509    IFEQ 'Y'                                       S01509
385900200610     C           NMCY      ANDNEVLCY                                      S01509
386000200610     C                     MOVE NMCY      WCURR   3                       S01509
386100200610     C                     EXSR TG10                                      S01509
386200200610     C                     Z-ADDZCDP      ZCDPI                           S01509
386300200610     C                     MOVE VLCY      WCURR   3                       S01509
386400200610     C                     EXSR TG10                                      S01509
386500200610     C                     Z-ADDZCDP      ZCDPO                           S01509
386600200610     C                     MOVE NMCY      ZCCYI                           S01509
386700200610     C                     MOVE VLCY      ZCCYO                           S01509
386800200610     C                     Z-ADDZINTDU    ZAMTCI                          S01509
386900200610     C*                                                                   S01509
387000200610     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event   S01509
387100200610     C** found, else from SECTYD                                          S01509
387200200610     C*                                                                   S01509
387300200610     C                     MOVE SDET      WKDET   2                       S01509
387400200610     C                     MOVE 'XR'      SDET                            S01509
387500200610     C           SECETY    SETLLSEDEVDO                                   S01509
387600200610     C                     READ SEDEVDO                  75               S01509
387700200610     C           *IN75     IFEQ '0'                                       S01509
387800200610     C           SOSDSN    ANDEQWCSSC                                     S01509
387900200610     C           SOSDET    ANDEQ'XR'                                      S01509
388000200610     C                     Z-ADDSOSDCE    ZEXCH                           S01509
388100200610     C                     MOVE SOSDMD    ZMD                             S01509
388200200610     C                     ELSE                                           S01509
388300200610     C                     Z-ADDSEXR      ZEXCH                           S01509
388400200610     C                     MOVE SMDI      ZMD                             S01509
388500200610     C                     END                                            S01509
388600200610     C                     MOVE WKDET     SDET                            S01509
388700200610     C                     EXSR ZCONV                                     S01509
388800200610     C                     Z-ADDZAMTCO    ZINTDU                          S01509
388900200610     C                     END                                            S01509
389000200610     C*                                                                   S01446
389100200610     C** For Courtage Enhancement, if Autocharge option is 'Y' and        S01446
389200200610     C** charge currency is not blank, update fields                      S01446
389300200610     C*                                                                   S01446
389400200610     C           S01446    IFEQ 'Y'                                       S01446
389500200610     C           BVACOP    ANDEQ'Y'                                       S01446
389600200610     C           BVCHRC    ANDNE*BLANKS                                   S01446
389700200610     C*                                                                   S01446
389800200610     C** Get M/D indicator and spot rate of input ccy from SDCURRPD       S01446
389900200610     C*                                                                   S01446
390000200610     C                     Z-ADD30        WDBAS1                          S01446
390100200610     C                     EXSR #LCURR                                    S01446
390200200610     C                     Z-ADDA6SPRT    ZRATE2                          S01446
390300200610     C                     MOVE A6MDIN    ZMDI2                           S01446
390400200610     C                     Z-ADDTXSPOT    ZRATE1                          S01446
390500200610     C                     MOVE TXMDI     ZMDI1                           S01446
390600200610     C                     EXSR ZXRATE                                    S01446
390700200610     C                     MOVE ZRATEX    TRATEX                          S01446
390800200610     C                     MOVE ZMDIX     TMDIX                           S01446
390900200610     C                     END                                            S01446
391000200610     C*
391100200610     C*** GENERATE A/C KEY AND POSITION SETTLEMENT IF THERE ARE           064754
391200200610     C*** ADJECTMENTS.                                                    064754
391300200610     C*                                                                   064754
391400200610     C           ZINTDU    IFNE 0                                         064754
391500200610     C           WCPSN     ANDNE0                                         157260
391600200610     C*                                                                   064754
391700200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W03
391800200610     C*
391900200610     C           SDAD      IFNE 0
392000200610     C           SAVDAD    ORNE 0                                          64754
392100200610     C                     MOVE 'C'       WACEVC
392200200610     C           SNAC      IFEQ 'N'
392300200610     C           WCUMCP    ORGT 0
392400200610     C                     MOVE ' '       WACNEG
392500200610     C                     ELSE
392600200610     C                     MOVE 'N'       WACNEG
392700200610     C                     END
392800200610     C                     MOVE 'DI'      WACAMC
392900200610     C                     Z-ADDZINTDU    EVAM
393000200610     C           ZINTDU    IFLT 0
393100200610     C           SNAC      ANDEQ'Y'
393200200610     C                     Z-SUBEVAM      EVAM
393300200610     C/COPY WNCPYSRC,SE2380C003
393400200610     C                     END
393500200610     C                     EXSR W03
393600200610     C/COPY WNCPYSRC,SE2380C004
393700200610     C                     END
393800200610     C*
393900200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
394000200610     C*
394100200610     C           SDDT      IFNE 0
394200200610     C           SAVDDT    ORNE 0                                         064754
394300200610     C*                                                                   064754
394400200610     C           SDED      IFEQ 0                                         064754
394500200610     C                     Z-ADDSAVDDT    SDED                            064754
394600200610     C                     END                                            064754
394700200610      *
394800200610     C                     MOVE 'CP'      PEVT
394900200610     C***********          Z-ADDWCUMCP    PNMP                      E23169S01486
395000200610     C***********CSNV      SUB  CSEX      WRK150 150                      E23169
395100200610     C***********          Z-ADDWRK150    PNMP                            E23169
395200200610     C           BGPFMG    IFNE 'Y'                                       081239
395300200610     C           BGN4ST    ANDNE'Y'                                       CPB002
395400200610     C                     Z-ADDWCUMCP    WRK150 150                      S01486
395500200610     C                     Z-ADDWRK150    PNMP                            S01486
395600200610     C                     ELSE                                           081239
395700200610     C                     Z-ADDWCUMCP    PNMP                            081239
395800200610     C                     END                                            081239
395900200610     C           ZINTDU    IFLT 0
396000200610     C                     Z-SUBZINTDU    PAMD
396100200610     C/COPY WNCPYSRC,SE2380C005
396200200610     C**********           MOVE 'P'       PPRE                            E14704
396300200610     C                     MOVE 'R'       PPRE                            E14704
396400200610     C                     ELSE
396500200610     C                     Z-ADDZINTDU    PAMD
396600200610     C/COPY WNCPYSRC,SE2380C006
396700200610     C**********           MOVE 'R'       PPRE                            E14704
396800200610     C                     MOVE 'P'       PPRE                            E14704
396900200610     C                     END
397000200610     C/COPY WNCPYSRC,SE2380C032
397100200610     C                     EXSR W02
397200200610     C                     END
397300200610     C/COPY WNCPYSRC,SE2380C007
397400200610     C*                                                                   064754
397500200610     C                     END                                            064754
397600200610     C*
397700200610     C           ENDCPN    ENDSR                           ** ENDCPN **
397800200610      *
397900200610      *****************************************************************
398000200610      /EJECT
398100200610      *****************************************************************
398200200610      *                                                               *
398300200610      *  PARTPY - Subroutine to produce Part Payment Position         *
398400200610      *           Settlement.                                         *
398500200610      *                                                               *
398600200610      *****************************************************************
398700200610      *
398800200610     C           PARTPY    BEGSR                           ** PARTPY **
398900200610     C*
399000200610     C** CALCULATE PAYMENT DUE AS:
399100200610     C*   NOMINAL TRADE DATE BASIS TIMES CALL AMOUNT
399200200610     C*   HOLDING IS IN NOM.DEC PLACES, RESULT AS 13/0 WITH CCY DEC
399300200610     C*
399400200610     C*   GET SECURITY RECORD IN
399500200610     C*
399600200610     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
399700200610     C*
399800200610     C                     MOVE NMCY      WCURR   3
399900200610     C                     EXSR TG10
400000200610     C*
400100200610     C***********CDP       SUB  NMDP      DC                              E23169
400200200610     C***********DC        ADD  5         DC                              E23169
400300200610     C***********                                                         E23169
400400200610     C***IF*DC*LESS*THAN*5*IT*IS*A*DIVIDE*-*DO*LATER********************* E23169
400500200610     C***********                                                         E23169
400600200610     C***********DC        IFGT 4                                         E23169
400700200610     C***********WBCSNV    MULT POWER8,DC WRK130 130                      E23169
400800200610     C***********          ELSE                                           E23169
400900200610     C***********          Z-ADDWBCSNV    WRK130                          E23169
401000200610     C***********          END                                            E23169
401100200610     C***********                                                         E23169
401200200610     C**USE*PERCENTAGE*FIELD*OR*AMOUNT*FIELD*WHICHEVER*IS*NOT*ZERO******* E23169
401300200610     C**IF*BOTH*ZERO*DATA*BASE*ERROR************************************* E23169
401400200610     C***********                                                         E23169
401500200610     C***********SDPC      IFNE 0                                         E23169
401600200610     C***********WRK130    MULT SDPC      WRK154                          E23169
401700200610     C***********WRK154    DIV  100       WRK154    H                     E22638
401800200610     C***********WRK154    DIV  100       WRK154 154H                     E22638
401900200610     C***********          ELSE                                           E23169
402000200610     C***********SDPP      IFNE 0                                         E23169
402100200610     C***********                                                         E23169
402200200610     C**CONVERT*AMOUNT*FIELD*FROM*15/0*TO*CCY*DECIMAL*PLACES************* E23169
402300200610     C***********                                                         E23169
402400200610     C***********5         SUB  CDP       DC                              E23169
402500200610     C***********SDPP      MULT POWER8,DC WRK154                          E23169
402600200610     C***********WRK130    MULT WRK154    WRK150    H                     E23169
402700200610     C***********          ELSE                                           E23169
402800200610     C***********                                                         E23169
402900200610     C**DB*ERROR*-*BOTH*PRICES*ARE*ZERO********************************** E23169
403000200610     C***********                                                         E23169
403100200610     C***********          MOVEL'SEDEVD'  DBFILE           *****************3169
403200200610     C***********          MOVEL'CALL%0'  DBKEY            ** DB ERROR 07 **3169
403300200610     C***********          SETON                     U7U8  *****************3169
403400200610     C***********          Z-ADD07        DBASE                           E23169
403500200610     C***********          GOTO EAUDIT                                    E23169
403600200610     C***********          END                                            E23169
403700200610     C***********          END                                            E23169
403800200610     C***********                                                         E23169
403900200610     C***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR**** E23169
404000200610     C***********                                                         E23169
404100200610     C***********          EXSR INVTIN                                    E23169
404200200610     C***********                                                         E23169
404300200610     C***********PROT      IFEQ '8'                                       E23169
404400200610     C***********SDPC      IFNE 0                                         E23169
404500200610     C***********WRK154    MULT SDCP      WRK154                          E23169
404600200610     C***********          ELSE                                           E23169
404700200610     C***********WRK150    MULT SDCP      WRK154                          E23169
404800200610     C***********          END                                            E23169
404900200610     C***********          ELSE                                           E23169
405000200610     C***********          Z-ADDWRK150    WRK154                          E23169
405100200610     C***********          END                                            E23169
405200200610     C***********                                                         E23169
405300200610     C***IF*DC*LESS*THAN*5*DO*FINAL*DIVIDE*HERE************************** E23169
405400200610     C***********                                                         E23169
405500200610     C***********DC        IFLT 5                                         E23169
405600200610     C***********WRK154    MULT POWER8,DC WRK154                          E23169
405700200610     C***********          END                                            E23169
405800200610     C***********                                                         E23169
405900200610     C***********                                                         E23169
406000200610     C***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100******************** E23169
406100200610     C***********                                                         E23169
406200200610     C***********SPBS      IFEQ 'P'                                       E23169
406300200610     C***********WRK154    DIV  100       WPAYDU    H                     E23169
406400200610     C***********          ELSE                                           E23169
406500200610     C***********WRK154    DIV  1         WPAYDU 130H                     E23169
406600200610     C***********          END                                            E23169
406700200610     C           PROT      IFNE '4'                                       E23169
406800200610     C           SDPC      DIV  100000    ZPRC                            E23169
406900200610     C                     ELSE                                           E23169
407000200610     C           5         ADD  CDP       DC                              E23169
407100200610     C           SDPP      DIV  POWER8,DC ZPRC                            E23169
407200200610     C                     END                                            E23169
407300200610     C           SPBS      IFEQ 'P'                                       E23169
407400200610     C                     MULT 100       ZPRC                            E23169
407500200610     C                     END                                            E23169
407600200610     C                     Z-ADDWBCSNV    ZNOML                           E23169
407700200610     C                     EXSR ZCNSD                                     E23169
407800200610     C                     Z-ADDZCONS     WPAYDU 130                      E23169
407900200610     C*
408000200610     C* WRITE POSITION SETTLEMENT
408100200610     C*
408200200610     C                     MOVE 'PP'      PEVT
408300200610     C***********          Z-ADDCSNV      PNMP                            E23169
408400200610     C                     Z-ADDWBCSNV    PNMP                            E23169
408500200610     C                     Z-ADDWPAYDU    PAMD
408600200610     C           PAMD      IFLT 0
408700200610     C                     Z-SUBPAMD      PAMD
408800200610     C                     END
408900200610     C*
409000200610     C           WBCSNV    IFLE 0
409100200610     C**********           MOVE 'R'       PPRE                            E14704
409200200610     C                     MOVE 'P'       PPRE                            E14704
409300200610     C                     ELSE
409400200610     C**********           MOVE 'P'       PPRE                            E14704
409500200610     C                     MOVE 'R'       PPRE                            E14704
409600200610     C                     END
409700200610      *                                                                                       260331
409800200610     C           WRVPOS    IFEQ 'Y'                                                           260331
409900200610     C           PPRE      IFEQ 'R'                                                           260331
410000200610     C                     MOVEL'P'       PPRE                                                260331
410100200610     C                     ELSE                                                               260331
410200200610     C           PPRE      IFEQ 'P'                                                           260331
410300200610     C                     MOVEL'R'       PPRE                                                260331
410400200610     C                     ENDIF                                                              260331
410500200610     C                     ENDIF                                                              260331
410600200610     C                     ENDIF                                                              260331
410700200610      *                                                                                       260331
410800200610     C                     EXSR W02
410900200610     C           ENDPPY    ENDSR                           ** ENDPPY **
411000200610     C*
411100200610     C*****************************************************************
411200200610      /EJECT
411300200610      *****************************************************************   E20086
411400200610      *                                                               *   E20086
411500200610      * MORTPY SUBROUTINE REWRITTEN BELOW                             *   E20086
411600200610      *                                                               *   E20086
411700200610      *****************************************************************   E20086
411800200610     C***********                                                         E20086
411900200610     C**MORTPY***-*PRODUCE*MORTGAGE*PAYMENT**POSITION*SETTLEMENT*******   E20086
412000200610     C***********                                                         E20086
412100200610     C***********MORTPY    BEGSR                           ** MORTPY **   E20086
412200200610     C***********                                                         E20086
412300200610     C***********                                                         E20086
412400200610     C****GET*PREVIOUS*CURRENT*FACTOR*FROM*PREV.RECORD*SEDEVD*FOR*THIS*   E20086
412500200610     C****TYPE,FROM*LGL*OF*SEDEVD*BY*SEC/TYPE/DATE*LF/SECET************   E20086
412600200610     C****SAVE*KEY*OF*CURRENT*SEDEVD*RECORD*AND*RECHAIN*AFTERWARDS*****   E20086
412700200610     C***********                                                         E20086
412800200610     C************LIKE     DEFN SDET      WSDET                           E20086
412900200610     C************LIKE     DEFN SDED      WSDED                           E20086
413000200610     C***********          Z-ADDWPCFA     WPCFA  118                      E20086
413100200610     C************LIKE     DEFN SDCP      WSDCP                           E20086
413200200610     C************LIKE     DEFN SDDT      WSDDT                           E20086
413300200610     C***********          MOVE SDET      WSDET                           E20086
413400200610     C***********          Z-ADDSDED      WSDED                           E20086
413500200610     C***********          Z-ADDSDCP      WSDCP                           E20086
413600200610     C***********          Z-ADDSDDT      WSDDT                           E20086
413700200610     C***********SECETY    SETLLSEDETD                                    E20086
413800200610     C***********                                                         E20086
413900200610     C***STORE*NOM*CCY*FROM*SECTYD*AS*SEDEVDF*HAS*NMCY*FIELD*TOO*******   E20086
414000200610     C***********                                                         E20086
414100200610     C***********          MOVE NMCY      WNMCY                           E20086
414200200610     C***********          READPSEDETD                   79               E20086
414300200610     C***********          MOVE WNMCY     NMCY                            E20086
414400200610     C************IN79     IFNE '1'                                       E20086
414500200610     C***********SDSN      IFNE WCSSC                                     E20086
414600200610     C***********SDET      ORNE WSDET                                     E20086
414700200610     C***********          MOVE '1'       *IN79                           E20086
414800200610     C***********          END                                            E20086
414900200610     C***********          END                                            E20086
415000200610     C***********                                                         E20086
415100200610     C**IF*NOT*FOUND*OR*NOT*SAME*SEC/TYPE,DEFAULT*TO*100***************   E20086
415200200610     C***********                                                         E20086
415300200610     C************IN79     IFEQ '1'                                       E20086
415400200610     C***********          Z-ADD1         WPCFA                           E20086
415500200610     C***********          ELSE                                           E20086
415600200610     C***********          Z-ADDSDCP      WPCFA                           E20086
415700200610     C***********          END                                            E20086
415800200610     C***********                                                         E20086
415900200610     C***NOW*RECHAIN*TO*SEDEVD*FOR*CURRENT*FACTOR*AND*OTHER*CURRENT*FLD   E20086
416000200610     C***********                                                         E20086
416100200610     C***********          Z-ADDWSDCP     SDCP                            E20086
416200200610     C***********          Z-ADDWSDED     SDED                            E20086
416300200610     C***********          Z-ADDWSDDT     SDDT                            E20086
416400200610     C***********          MOVE WSDET     SDET                            E20086
416500200610     C***********          EXSR SECEDI                                    E20086
416600200610     C***********                                                         E20086
416700200610     C***CALCULATE*PRINCIPAL*REPAYMENT*AS:*****************************   E20086
416800200610     C**********IF*REPAYMENT*METHOD*IND*IS*Y,*REPAYMENT*AMOUNT*ON*SECAD   E20086
416900200610     C***********                                                         E20086
417000200610     C***********SRMI      IFEQ 'Y'                                       E20086
417100200610     C***********          Z-ADDSRPT      WPREPA 130                      E20086
417200200610     C***********          ELSE                                           E20086
417300200610     C***********                                                         E20086
417400200610     C**********ELSE***************************************************   E20086
417500200610     C**************NOMINAL*VALUE*DATE*BASIS*TIMES*********************   E20086
417600200610     C**************(PREVIOUS*CURRENT*FACTOR*MINUS*CURRENT*FACTOR)*****   E20086
417700200610     C**NB*ALTHOUGH*NOM*DEC*=*NOM*DEC*CCY*FOR*MORTGAGE*BACKED*SEC'TS***   E20086
417800200610     C**FIELD*RTAI*IS*IN*CCY*DEC*PLACES*AND*THIS*CALC*OF*WPREPA*IS*TOO*   E20086
417900200610     C***********                                                         E20086
418000200610     C***********                                                         E20086
418100200610     C***********WPCFA     SUB  SDCP      WACF    98                      E20086
418200200610     C***********                                                         E20086
418300200610     C***SPLIT*FIELD*WACF*9/8*TO*1/0*AND*8/8*WRK*FLDS*TO*PREVENT*LOSS**   E20086
418400200610     C***OF*HIGH*ORDER*DIGITS******************************************   E20086
418500200610     C***********                                                         E20086
418600200610     C***********          Z-ADDWACF      WRK10   10                      E20086
418700200610     C***********          Z-ADDWACF      WRK88   88                      E20086
418800200610     C***********                                                         E20086
418900200610     C***MULTIPLY*NOMINAL*VALUE*DATE*BASIS*BY*EACH*WORK*FIELD*AND*SUM**   E20086
419000200610     C***********                                                         E20086
419100200610     C***********WBDSNV    MULT WRK88     WRK158 158                      E20086
419200200610     C***********WBDSNV    MULT WRK10     WRK150 150                      E20086
419300200610     C***********WRK158    DIV  1         WRK154 154H                     E20086
419400200610     C***********WRK150    ADD  WRK154    WRK154                          E20086
419500200610     C***********                                                         E20086
419600200610     C*NOMINAL*DECIMAL*PLACES*RETRIEVED*-*NOW*USE*CCY**TO*GET*CCY**DP**   E20086
419700200610     C***********                                                         E20086
419800200610     C***********          MOVE NMCY      WCURR   3                       E20086
419900200610     C***********          EXSR TG10                                      E20086
420000200610     C***********                                                         E20086
420100200610     C***********CDP       SUB  NMDP      DC      10                      E20086
420200200610     C***********DC        ADD  5         DC                              E20086
420300200610     C***********WRK154    MULT POWER8,DC WRK154                          E20086
420400200610     C***********WRK154    DIV  1         WPREPA 130H                     E20086
420500200610     C***********          END                                            E20086
420600200610     C***********                                                         E20086
420700200610     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRD*FOR*SECURITY**************   E20086
420800200610     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E20086
420900200610     C***GET*NOMINAL*CCY*DEC*PLACES*FROM*TABTG10*FIRST*(CDP)***********   E20086
421000200610     C***********                                                         E20086
421100200610     C***********          MOVE NMCY      WCURR   3                       E20086
421200200610     C***********          EXSR TG10                                      E20086
421300200610     C***********                                                         E20086
421400200610     C***WHEN*PARM*ZAB*IS*'A'*,*INTEREST*IS*CALCULATED*AFTER*CHANGES***   E20086
421500200610     C***WHEN*PARM*ZAB*IS*'B'*,*INTEREST*IS*CALCULATED*BEFORE*CHANGES**   E20086
421600200610     C*******I.E.*'CHANGES'*ARE*UPDATES*DUE*TO*BACKVALUATIONS*IN*PGM***   E20086
421700200610     C***********                                                         E20086
421800200610     C***********          MOVE 'A'       ZAB                             E20086
421900200610     C***********          UNLCKLDA                                       E20086
422000200610     C***********          MOVE 'A'       ZAB                             E20086
422100200610     C***********          CALL 'ZACCRC'                                  E20086
422200200610     C***********          PARM           LCPN                            E20086
422300200610     C***********          PARM           SDED                            E20086
422400200610     C***********          PARM           CSBR                            E20086
422500200610     C***********          PARM           CDPT                            E20086
422600200610     C***********          PARM           CSSC                            E20086
422700200610     C***********          PARM           CDP                             E20086
422800200610     C***********          PARM           ZINTDU 150                      E20086
422900200610     C***********          PARM           ZAB                             E20086
423000200610     C***********                                                         E20086
423100200610     C****U7*AND*U8*ON*IF*DATABASE*ERROR*DURING*ZACCR**PROCESSING******   E20086
423200200610     C***********                                                         E20086
423300200610     C***U7*U8***          GOTO EAUDIT                                    E20086
423400200610     C***********                                                         E20086
423500200610     C***IF*WDIFF*=*Y,*CALL*ZACCRD*AGAIN*WITH*STAUS*B*AND*SUBTRACT*'A'*   E20086
423600200610     C***********                                                         E20086
423700200610     C***********WDIFF     IFEQ 'Y'                                       E20086
423800200610     C***********          Z-ADDZINTDU    ZWINTD 150                      E20086
423900200610     C***********          MOVE 'B'       ZAB                             E20086
424000200610     C***********          UNLCKLDA                                       E20086
424100200610     C***********          CALL 'ZACCRC'                                  E20086
424200200610     C***********          PARM           LCPN                            E20086
424300200610     C***********          PARM           SDED                            E20086
424400200610     C***********          PARM           CSBR                            E20086
424500200610     C***********          PARM           CDPT                            E20086
424600200610     C***********          PARM           CSSC                            E20086
424700200610     C***********          PARM           CDP                             E20086
424800200610     C***********          PARM           ZINTDU 150                      E20086
424900200610     C***********          PARM           ZAB     1                       E20086
425000200610     C***********                                                         E20086
425100200610     C****U7*AND*U8*ON*IF*DATABASE*ERROR*DURING*ZACCR**PROCESSING******   E20086
425200200610     C***********                                                         E20086
425300200610     C***U7*U8***          GOTO EAUDIT                                    E20086
425400200610     C***********ZWINTD    SUB  ZINTDU    ZINTDU                          E20086
425500200610     C***********          END                                            E20086
425600200610     C***********                                                         E20086
425700200610     C************LOCK     IN   LDA                                       E20086
425800200610     C***********          MOVE 'SE2380  'DBPGM                           E20086
425900200610     C***********                                                         E20086
426000200610     C****MULTIPLY*RESULT*OF*ZACCRD*BY*PREVIOUS*CURR*FACTOR************   E20086
426100200610     C***********                                                         E20086
426200200610     C***********ZINTDU    MULT WPCFA     WRK154                          E20086
426300200610     C***********WRK154    DIV  1         WINTPY 130H                     E20086
426400200610     C***********                                                         E20086
426500200610     C**WRITE*POSITION*SETTLEMENT*RECORD*SUBR*W02**********************   E20086
426600200610     C***********                                                         E20086
426700200610     C***********SDDT      IFNE 0                                         E20086
426800200610     C***********          MOVE 'MP'      PEVT                            E20086
426900200610     C***********          Z-ADDCSNV      PNMP                            E20086
427000200610     C***********                                                         E20086
427100200610     C***AMOUNT*DUE*IS*PRINCIPAL*REPAYMNT*+*INTEREST*******************   E20086
427200200610     C***********                                                         E20086
427300200610     C***********WPREPA    ADD  WINTPY    WRK130 130                      E20086
427400200610     C***********          Z-ADDWRK130    PAMD                            E20086
427500200610     C***********PAMD      IFLT 0                                         E20086
427600200610     C***********          Z-SUBPAMD      PAMD                            E20086
427700200610     C***********          END                                            E20086
427800200610     C***********                                                         E20086
427900200610     C***********                                                         E20086
428000200610     C***********WRK130    IFLE 0                                         E20086
428100200610     C***                  MOVE 'P'       PPRE                            E14704
428200200610     C***********          MOVE 'R'       PPRE                     E14704 E20086
428300200610     C***********          ELSE                                           E20086
428400200610     C***                  MOVE 'R'       PPRE                            E14704
428500200610     C***********          MOVE 'P'       PPRE                     E14704 E20086
428600200610     C***********          END                                            E20086
428700200610     C***********                                                         E20086
428800200610     C***********          EXSR W02                                       E20086
428900200610     C***********                                                         E20086
429000200610     C***********          END                                            E20086
429100200610     C***********                                                         E20086
429200200610     C***********                                                         E20086
429300200610     C**WRITE*ACCOUNT*KEYS*RECORD*SUBR*W03**IF*DATE*NOT*ZERO***********   E20086
429400200610     C***********                                                         E20086
429500200610     C***********SDAD      IFNE 0                                         E20086
429600200610     C***********          MOVE 'R'       WACEVC                          E20086
429700200610     C***********                                                         E20086
429800200610     C***SET*NEGATIVE*IND*TO*' 'IF*NEG*POSN*ON*A/C*IS*N*OR*************   E20086
429900200610     C***NOM.MATURING*+*INTEREST*IS*GREATER*THAN*ZERO******************   E20086
430000200610     C***********                                                         E20086
430100200610     C***********NPAC      IFEQ 'N'                                       E20086
430200200610     C***********WRK130    ORGT 0                                         E20086
430300200610     C***********          MOVE ' '       WACNEG                          E20086
430400200610     C***********          ELSE                                           E20086
430500200610     C***********          MOVE 'N'       WACNEG                          E20086
430600200610     C***********          END                                            E20086
430700200610     C***********          MOVE 'FV'      WACAMC                          E20086
430800200610     C***********          Z-ADDWRK130    EVAM                            E20086
430900200610     C***********                                                         E20086
431000200610     C***REVERSE*SIGN*ON*OUTPUT*FILE*IF*SPLIT*NEG*POSITIONON*ACC*IS*Y**   E20086
431100200610     C***AND*AMNT*DUE*IS*LESS*THAN*ZERO********************************   E20086
431200200610     C***********                                                         E20086
431300200610     C***********WRK130    IFLT 0                                         E20086
431400200610     C***********NPAC      ANDEQ'Y'                                       E20086
431500200610     C***********          Z-SUBEVAM      EVAM                            E20086
431600200610     C***********          END                                            E20086
431700200610     C***********          EXSR W03                                       E20086
431800200610     C***********                                                         E20086
431900200610     C***********          END                                            E20086
432000200610     C***********                                                         E20086
432100200610     C***********          MOVE '0'       *IN79                           E20086
432200200610     C***********                                                         E20086
432300200610     C***********ENDMPY    ENDSR                           ** ENDMPY **   E20086
432400200610     C***********                                                         E20086
432500200610     C*****************************************************************   E20086
432600200610      /EJECT                                                              E20086
432700200610      *****************************************************************   E20086
432800200610      *                                                               *   E20086
432900200610      *  MORTPY - Subroutine to produce Mortgage Payment Account Keys *   E20086
433000200610      *           and/or Position Settlements.                        *   E20086
433100200610      *                                                               *   E20086
433200200610      *****************************************************************   E20086
433300200610      *                                                                   E20086
433400200610     C           MORTPY    BEGSR                           *** MORTPY *** E20086
433500200610      *                                                                   E20086
433600200610      ***  Obtain Principal Repayment.                                    E20086
433700200610      *** If Repayment Method = 'Y', use the Repayment Amount.            E20086
433800200610      *                                                                   E20086
433900200610     C           SRMI      IFEQ 'Y'                                       E20086
434000200610     C                     Z-ADDSRPT      PAMD                            E20086
434100200610      *                                                                   E20086
434200200610      ***  Else, obtain the previous Current Factor from the Security     E20086
434300200610      ***  Diary, then calculate Principal Repayment as:                  E20086
434400200610      ***     (Old CF - New CF) * Current Position                        E20086
434500200610      *                                                                   E20086
434600200610     C                     ELSE                                           E20086
434700200610      *                                                                   E20086
434800200610     C           SECETY    SETGTSEDEVDO                                   E20086
434900200610     C                     READ SEDEVDO                  79               E20086
435000200610      *                                                                   E20086
435100200610     C           *IN79     IFEQ '1'                                       E20086
435200200610     C           SOSDSN    ORNE WCSSC                                     E20086
435300200610     C           SOSDET    ORNE 'MP'                                      E20086
435400200610     C                     Z-ADD1         SOSDCP                          E20086
435500200610     C                     END                                            E20086
435600200610      *                                                                   E20086
435700200610     C********** SOSDCP    SUB  SDCP      CFDIF   98               E20086 052254
435800200610     C           SOSDCP    SUB  SDCP      CFDIF                           052254
435900200610     C***********CFDIF     MULT WBCSNV    WMPAMT 152H              E20086 E23169
436000200610      *                                                                   E20086
436100200610      ***  Convert from Nominal D.p. to the Currency D.p.                 E20086
436200200610      *                                                                   E20086
436300200610     C                     MOVE NMCY      WCURR   3                       E20086
436400200610     C                     EXSR TG10                                      E20086
436500200610      *                                                                   E20086
436600200610     C***********CDP       SUB  NMDP      DC      10               E20086 E23169
436700200610     C***********          ADD  5         DC                       E20086 E23169
436800200610     C***********WMPAMT    MULT POWER8,DC PAMD      H              E20086 E23169
436900200610     C*                                                            E20086 E23169
437000200610     C                     Z-ADDWBCSNV    ZNOML                           E23169
437100200610     C                     Z-ADDCFDIF     ZPRC                            E23169
437200200610     C           SPBS      IFEQ 'P'                                       E23169
437300200610     C           ZPRC      MULT 100       ZPRC                            E23169
437400200610     C                     END                                            E23169
437500200610     C                     EXSR ZCNSD                                     E23169
437600200610     C                     Z-ADDZCONS     PAMD                            E23169
437700200610      *                                                                   E20086
437800200610     C                     END                                            E20086
437900200610      *                                                                   E20086
438000200610      ***  Write Position Settlement Record.                              E20086
438100200610      *                                                                   E20086
438200200610     C           SDDT      IFNE 0                                         E20086
438300200610     C                     MOVE 'MP'      PEVT                            E20086
438400200610     C***********          Z-ADDCSNV      PNMP                     E20086 E23169
438500200610     C                     Z-ADDWBCSNV    PNMP                            E23169
438600200610      *                                                                   E20086
438700200610     C           PAMD      IFLE 0                                         E20086
438800200610     C                     MOVE 'R'       PPRE                            E20086
438900200610     C                     ELSE                                           E20086
439000200610     C                     MOVE 'P'       PPRE                            E20086
439100200610     C                     END                                            E20086
439200200610      *                                                                                       260331
439300200610     C           WRVPOS    IFEQ 'Y'                                                           260331
439400200610     C           PPRE      IFEQ 'R'                                                           260331
439500200610     C                     MOVEL'P'       PPRE                                                260331
439600200610     C                     ELSE                                                               260331
439700200610     C           PPRE      IFEQ 'P'                                                           260331
439800200610     C                     MOVEL'R'       PPRE                                                260331
439900200610     C                     ENDIF                                                              260331
440000200610     C                     ENDIF                                                              260331
440100200610     C                     ENDIF                                                              260331
440200200610      *                                                                   E20086
440300200610      ***  Save PAMD for later testing.                                   E20086
440400200610      *                                                                   E20086
440500200610     C                     Z-ADDPAMD      SPAMD  130                      E20086
440600200610      *                                                                   E20086
440700200610      ***  Amount posted should be positive.                              E20086
440800200610      *                                                                   E20086
440900200610     C           PAMD      IFLT 0                                         E20086
441000200610     C                     Z-SUBPAMD      PAMD                            E20086
441100200610     C                     END                                            E20086
441200200610      *                                                                   E20086
441300200610     C                     EXSR W02                                       E20086
441400200610      *                                                                   E20086
441500200610     C                     END                                            E20086
441600200610      *                                                                   E20086
441700200610      ***  Write Account Key Record if Date NOT = zero.                   E20086
441800200610      *                                                                   E20086
441900200610     C           SDAD      IFNE 0                                         E20086
442000200610     C                     MOVE 'R'       WACEVC                          E20086
442100200610      *                                                                   E20086
442200200610      ***  Set Negative Indicator to ' ' if Negative Position on A/c      E20086
442300200610      ***  Keys is 'N' OR Principal Repayment is Greater Than zero.       E20086
442400200610      *                                                                   E20086
442500200610     C           NPAC      IFEQ 'N'                                       E20086
442600200610     C           SPAMD     ORGT 0                                         E20086
442700200610     C                     MOVE ' '       WACNEG                          E20086
442800200610     C                     ELSE                                           E20086
442900200610     C                     MOVE 'N'       WACNEG                          E20086
443000200610     C                     END                                            E20086
443100200610      *                                                                   E20086
443200200610     C                     MOVE 'FV'      WACAMC                          E20086
443300200610     C                     Z-ADDSPAMD     EVAM                            E20086
443400200610      *                                                                   E20086
443500200610      ***  Reverse sign on output file if Negative Position on A/c Keys   E20086
443600200610      ***  is 'Y' AND Principal Repayment is Less Than zero.              E20086
443700200610      *                                                                   E20086
443800200610     C           NPAC      IFEQ 'Y'                                       E20086
443900200610     C           SPAMD     ANDLT0                                         E20086
444000200610     C                     Z-SUBEVAM      EVAM                            E20086
444100200610     C                     END                                            E20086
444200200610      *                                                                   E20086
444300200610     C                     EXSR W03                                       E20086
444400200610     C/COPY WNCPYSRC,SE2380C008
444500200610      *                                                                   E20086
444600200610     C                     END                                            E20086
444700200610      *                                                                   E20086
444800200610     C                     SETOF                     79                   E20086
444900200610      *                                                                   E20086
445000200610     C                     ENDSR                                          E20086
445100200610      *                                                                   E20086
445200200610      *****************************************************************   E20086
445300200610      /EJECT
445400200610      *****************************************************************
445500200610      *                                                               *
445600200610      *  MATURE - Subroutine to produce Maturity Position Settlements.*
445700200610      *                                                               *
445800200610      *****************************************************************
445900200610      *
446000200610     C           MATURE    BEGSR                           ** MATURE **
446100200610     C*
446200200610      ***  A separate Coupon Event is now produced at Maturity and this   E21573
446300200610      ***  should be used to generate Position Settlement for Interest.   E21573
446400200610     C*                                                                   E21573
446500200610     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRC*FOR*SECURITY**************   E21573
446600200610     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E21573
446700200610     C***GET*NOMINAL*CCY*DEC*PLACES*FROM*TABTG10*FIRST*(CDP)***********   E21573
446800200610     C***********                                                         E21573
446900200610     C***********          MOVE NMCY      WCURR   3                       E21573
447000200610     C***********          EXSR TG10                                      E21573
447100200610     C***********                                                         E21573
447200200610     C***WHEN*PARM*ZAB*IS*'A'*,*INTEREST*IS*CALCULATED*AFTER*CHANGES***   E21573
447300200610     C***WHEN*PARM*ZAB*IS*'B'*,*INTEREST*IS*CALCULATED*BEFORE*CHANGES**   E21573
447400200610     C*******I.E.*'CHANGES'*ARE*UPDATES*DUE*TO*BACKVALUATIONS*IN*PGM***   E21573
447500200610     C***********                                                         E21573
447600200610     C***********          MOVE 'A'       ZAB                             E21573
447700200610     C***********          UNLCKLDA                                       E21573
447800200610     C***********          CALL 'ZACCRC'                                  E21573
447900200610     C***********          PARM           LCPN                            E21669
448000200610     C***********          PARM           LCCP                     E21669 E21573
448100200610     C***********          PARM           MATY                            E21573
448200200610     C***********          PARM           CSBR                            E21573
448300200610     C***********          PARM           CSCN                            E21573
448400200610     C***********          PARM           CSSC                            E21573
448500200610     C***********          PARM           CDP                             E21573
448600200610     C***********          PARM           ZINTDU 150                      E21573
448700200610     C***********          PARM           ZAB     1                       E21573
448800200610     C***********                                                         E21573
448900200610     C***IF*WDIFF*=*Y,*CALL*ZACCRC*AGAIN*WITH*STAUS*B*AND*SUBTRACT*'A'*   E21573
449000200610     C***********                                                         E21573
449100200610     C***********WDIFF     IFEQ 'Y'                                       E21573
449200200610     C***********          Z-ADDZINTDU    ZWINTD 150                      E21573
449300200610     C***********          MOVE 'B'       ZAB                             E21573
449400200610     C***********          UNLCKLDA                                       E21573
449500200610     C***********          CALL 'ZACCRC'                                  E21573
449600200610     C***********          PARM           LCPN                            E21669
449700200610     C***********          PARM           LCCP                     E21669 E21573
449800200610     C***********          PARM           SDED                            E21573
449900200610     C***********          PARM           CSBR                            E21573
450000200610     C***********          PARM           CSCN                            E21573
450100200610     C***********          PARM           CSSC                            E21573
450200200610     C***********          PARM           CDP                             E21573
450300200610     C***********          PARM           ZINTDU 150                      E21573
450400200610     C***********          PARM           ZAB     1                       E21573
450500200610     C***********                                                         E21573
450600200610     C****U7*AND*U8*ON*IF*DATABASE*ERROR*DURING*ZACCR**PROCESSING******   E21573
450700200610     C***********                                                         E21573
450800200610     C***U7*U8***          GOTO EAUDIT                                    E21573
450900200610     C***********ZWINTD    SUB  ZINTDU    ZINTDU                          E21573
451000200610     C***********          END                                            E21573
451100200610     C*
451200200610     C           *LOCK     IN   LDA
451300200610      *** Correct setup of DBPGM
451400200610     C***********          MOVE 'SE2380  'DBPGM
451500200610     C                     MOVE *BLANKS   DBPGM
451600200610     C                     MOVEL'SE2380'  DBPGM
451700200610     C                     OUT  LDA                                       S01117
451800200610     C*
451900200610     C** OBTAIN PRICE AT MATURITY - CHECK LF/SECED FOR REDEMPTION PRICE
452000200610     C*
452100200610     C           *LIKE     DEFN SDCP      WSDCP                           E20086
452200200610     C                     Z-ADDSDCP      WSDCP
452300200610     C           *LIKE     DEFN SDED      WSDED                           E20086
452400200610     C                     Z-ADDSDED      WSDED
452500200610     C           *LIKE     DEFN SDDT      WSDDT                           E20086
452600200610     C                     Z-ADDSDDT      WSDDT
452700200610     C           *LIKE     DEFN SDET      WSDET                           E20086
452800200610     C                     MOVE SDET      WSDET
452900200610     C           *LIKE     DEFN SDAD      WSDAD                           S01510
453000200610     C                     MOVE SDAD      WSDAD                           S01510
453100200610     C*
453200200610     C                     Z-ADD0         SDRP
453300200610     C                     Z-ADDMATY      SDED
453400200610     C                     MOVE 'RC'      SDET
453500200610     C*
453600200610     C** CHECK FILE FOR EITHER 'RC' TYPE OR 'RP' TYPE IN KEY FIELD
453700200610     C*
453800200610     C***********          EXSR SECEDI                                    S01486
453900200610     C                     EXSR SECEDC                                    S01486
454000200610     C           *IN78     IFEQ '1'
454100200610     C                     MOVE 'RP'      SDET
454200200610     C***********          EXSR SECEDI                                    S01486
454300200610     C                     EXSR SECEDC                                    S01486
454400200610     C                     END
454500200610     C           *IN78     IFEQ '1'
454600200610     C*
454700200610     C** IF NEITHER RC NOR RP USE 100 IF PRICE BASIS IS P,ELSE 1 (U)
454800200610     C** Or if RP/RC record found AND price is zero and S01509 is         S01509
454900200610     C** active, use 100 if price basis is P, else 1                      S01509
455000200610     C*
455100200610     C           *IN78     OREQ '0'                                       S01509
455200200610     C           SDRP      ANDEQ0                                         S01509
455300200610     C           S01509    ANDEQ'Y'                                       S01509
455400200610     C*                                                                   S01509
455500200610     C           SPBS      IFEQ 'P'
455600200610     C                     Z-ADD100       SDRP
455700200610     C                     END
455800200610     C***********SPBS      IFEQ 'U'                                       103011
455900200610     C***********          Z-ADD1         SDRP                            103011
456000200610     C***********          END                                            103011
456100200610     C           PROT      IFEQ '1'                                                           192467
456200200610     C           SPBS      ANDEQ'U'                                                           192467
456300200610     C                     Z-ADD1         SDRP                                                192467
456400200610     C                     ENDIF                                                              192467
456500200610     C                     END
456600200610     C                     Z-ADDWSDCP     SDCP
456700200610     C                     Z-ADDWSDED     SDED
456800200610     C                     Z-ADDWSDDT     SDDT
456900200610     C                     Z-ADDWSDAD     SDAD                            S01510
457000200610     C                     MOVE WSDET     SDET
457100200610     C*
457200200610     C**  CALCULATE NOMINAL MATURING FOR CUSTOMER AS
457300200610     C**  NOMINAL VALUE DATE BASIS TIMES PRICE AT MATURITY
457400200610     C*
457500200610     C***********          Z-ADDSDRP      WRK08   88                      E23169
457600200610     C***********          Z-ADDSDRP      WRK150 150                      E23169
457700200610     C           WPORTP    IFEQ 'Y'                                       S01486
457800200610     C           BGPFMG    ANDEQ'Y'                                       S01486
457900200610     C           WPORTP    OREQ 'Y'                                       CPB002
458000200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
458100200610     C                     Z-ADDWCUMCP    WBCSNV                          S01486
458200200610     C                     END                                            S01486
458300200610     C***********WBCSNV    MULT WRK08     WRK156 156                      E23169
458400200610     C***********WRK156    DIV  1         WNOMAT 130H                     E20151
458500200610     C***********WRK156    DIV  1         WNOMAT 150H              E20151 E23169
458600200610     C***********                                                         E23169
458700200610     C***********WBCSNV    MULT WRK150    WRK150                          E23169
458800200610     C***********WRK150    ADD  WNOMAT    WNOMAT                          E23169
458900200610     C*
459000200610     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
459100200610     C*
459200200610     C                     MOVE NMCY      WCURR   3
459300200610     C                     EXSR TG10
459400200610     C*
459500200610     C**IF*78*IS*ON,*NO*PRICE*ON*SEC*EVENT*FILE*SO*CCY*FLD*'CDP'*IS*0**   E20151
459600200610     C*
459700200610     C***********CDP       SUB  NMDP      DC      10                      E23169
459800200610     C***78******          Z-SUBNMDP      DC                              E20151
459900200610     C***********DC        ADD  5         DC                              E23169
460000200610     C***********                                                  E20151 E23169
460100200610     C***Adjust*for*percentage*pricing.****************************E20151 E23169
460200200610     C***********SPBS      IFEQ 'P'                                E20151 E23169
460300200610     C***********          SUB  2         DC                       E20151 E23169
460400200610     C***********          END                                     E20151 E23169
460500200610     C***********                                                  E20151 E23169
460600200610     C***********DC        IFLT 5                                         E23169
460700200610     C***********WNOMAT    MULT POWER8,DC WRK151 151                      E23169
460800200610     C***********WRK151    DIV  1         WNOMAT    H                     E23169
460900200610     C***********          ELSE                                           E23169
461000200610     C***********WNOMAT    MULT POWER8,DC WNOMAT                          E23169
461100200610     C***********          END                                            E23169
461200200610     C***********SPBS      IFEQ 'P'                                       E23169
461300200610     C***********WNOMAT    DIV  100       WNOMAT    H                     E23169
461400200610     C***********          END                                            E23169
461500200610     C***********                                                         E23169
461600200610     C*                                                                   E23169
461700200610     C** Use ZCNSD subroutin to calculate Amount                          E23169
461800200610     C*                                                                   E23169
461900200610     C                     Z-ADDSDRP      ZPRC                            E23169
462000200610     C***********          Z-ADDCSNV      ZNOML                    E23169 S01510
462100200610     C                     Z-ADDWBCSNV    ZNOML                           S01510
462200200610     C                     EXSR ZCNSD                                     E23169
462300200610     C                     Z-ADDZCONS     WNOMAT 150                      E23169
462400200610     C*                                                                   S01486
462500200610     C** MATURITY SETTLEMENT WILL BE PAID IN VALUE CURRENCY. HENCE IF     S01486
462600200610     C** NOMINAL CURRENCY DIFFERENT TO VALUE CURRENCY CONVERT AMMOUNT     S01486
462700200610     C           BGPFMG    IFEQ 'Y'                                       S01486
462800200610     C           BGN4ST    OREQ 'Y'                                       CPB002
462900200610     C                     Z-ADDWNOMAT    WNOMA1 150                      S01486
463000200610     C                     END                                            S01486
463100200610     C*
463200200610     C** If S01509 is active and redemption currency is not blank and     S01509
463300200610     C** is different from the nominal currency, convert maturity         S01509
463400200610     C** amount to redemption currency                                    S01509
463500200610     C*                                                                   S01509
463600200610     C           S01509    IFEQ 'Y'                                       S01509
463700200610     C           *IN78     ANDEQ'0'                                       S01509
463800200610     C           SDCX      ANDNE*BLANKS                                   S01509
463900200610     C           SDCX      ANDNENMCY                                      S01509
464000200610     C                     MOVE NMCY      WCURR   3                       S01509
464100200610     C                     EXSR TG10                                      S01509
464200200610     C                     Z-ADDZCDP      ZCDPI                           S01509
464300200610     C                     MOVE SDCX      WCURR   3                       S01509
464400200610     C                     EXSR TG10                                      S01509
464500200610     C                     Z-ADDZCDP      ZCDPO                           S01509
464600200610     C                     MOVE NMCY      ZCCYI                           S01509
464700200610     C                     MOVE SDCX      ZCCYO                           S01509
464800200610     C                     Z-ADDWNOMAT    ZAMTCI                          S01509
464900200610     C                     Z-ADDSDCE      ZEXCH                           S01509
465000200610     C                     MOVE SDMD      ZMD                             S01509
465100200610     C                     EXSR ZCONV                                     S01509
465200200610     C                     Z-ADDZAMTCO    WNOMAT                          S01509
465300200610     C                     END                                            S01509
465400200610     C*                                                                   S01446
465500200610     C** For Courtage Enhancement, if Autocharge option is 'Y' and        S01446
465600200610     C** charge currency is not blank, update fields                      S01446
465700200610     C*                                                                   S01446
465800200610     C           S01446    IFEQ 'Y'                                       S01446
465900200610     C           BVACOP    ANDEQ'Y'                                       S01446
466000200610     C           BVCHRC    ANDNE*BLANKS                                   S01446
466100200610     C*                                                                   S01446
466200200610     C** Get M/D indicator and spot rate of input ccy from SDCURRPD       S01446
466300200610     C*                                                                   S01446
466400200610     C                     Z-ADD31        WDBAS1                          S01446
466500200610     C                     EXSR #LCURR                                    S01446
466600200610     C                     Z-ADDA6SPRT    ZRATE2                          S01446
466700200610     C                     MOVE A6MDIN    ZMDI2                           S01446
466800200610     C                     Z-ADDTXSPOT    ZRATE1                          S01446
466900200610     C                     MOVE TXMDI     ZMDI1                           S01446
467000200610     C                     EXSR ZXRATE                                    S01446
467100200610     C                     MOVE ZRATEX    TRATEX                          S01446
467200200610     C                     MOVE ZMDIX     TMDIX                           S01446
467300200610     C                     END                                            S01446
467400200610     C*                                                                   E23169
467500200610     C* WRITE POSITION SETTLEMENT RECORD SUBR W02 IF DATE NOT ZERO
467600200610     C*
467700200610     C           SDDT      IFNE 0
467800200610     C**********           MOVE 'MA'      PEVT                            E14716
467900200610     C                     MOVE 'MT'      PEVT                            E14716
468000200610     C                     Z-ADDWBCSNV    PNMP
468100200610     C*
468200200610     C***AMOUNT*DUE*IS*PRINCIPAL*REPAYMNT*+*INTEREST**********************E23169
468300200610     C*
468400200610     C***********ZINTDU    ADD  WNOMAT    WRK130 130                      E23169
468500200610     C***********          Z-ADDWRK130    PAMD                            E23169
468600200610     C                     Z-ADDWNOMAT    PAMD                            E23169
468700200610     C           PAMD      IFLT 0
468800200610     C                     Z-SUBPAMD      PAMD
468900200610     C                     END
469000200610     C*
469100200610     C***********WRK130    IFLE 0                                         E23169
469200200610     C           WNOMAT    IFLE 0                                         E23169
469300200610     C**********           MOVE 'P'       PPRE                            E14704
469400200610     C                     MOVE 'R'       PPRE                            E14704
469500200610     C                     ELSE
469600200610     C**********           MOVE 'R'       PPRE                            E14704
469700200610     C                     MOVE 'P'       PPRE                            E14704
469800200610     C                     END
469900200610     C/COPY WNCPYSRC,SE2380C037
470000200610     C           WPORTP    IFEQ 'Y'                                       S01486
470100200610     C           BGPFMG    ANDEQ'Y'                                       S01486
470200200610     C*                                                                   CPB002
470300200610     C           WPORTP    OREQ 'Y'                                       CPB002
470400200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
470500200610     C*                                                                   S01486
470600200610     C           BGPFMG    ORNE 'Y'                                       S01486
470700200610     C           BGN4ST    ANDNE'Y'                                       CPB002
470800200610     C*
470900200610     C                     EXSR W02
471000200610     C/COPY WNCPYSRC,SE2380C038
471100200610     C*
471200200610     C                     END
471300200610     C                     END                                            S01486
471400200610     C*
471500200610     C* WRITE ACCOUNT KEYS RECORD SUBR W03 IF DATE NOT ZERO
471600200610     C*
471700200610     C           SDAD      IFNE 0
471800200610     C           BGPFMG    ANDNE'Y'                                       S01486
471900200610     C           BGN4ST    ANDNE'Y'                                       CPB002
472000200610     C*                                                                   S01486
472100200610     C           SDAD      ORNE 0                                         S01486
472200200610     C           WPORTP    ANDEQ'Y'                                       S01486
472300200610     C           BGPFMG    ANDEQ'Y'                                       S01486
472400200610     C*                                                                   CPB002
472500200610     C           SDAD      ORNE 0                                         CPB002
472600200610     C           WPORTP    ANDEQ'Y'                                       CPB002
472700200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
472800200610     C*                                                                   S01486
472900200610     C                     MOVE 'M'       WACEVC
473000200610     C                     Z-ADDWNOMAT    WRK130 130                      E23169
473100200610     C*
473200200610     C** SET NEGATIVE IND TO ' 'IF NEG POSN ON A/C IS N OR
473300200610     C** NOM.MATURING + INTEREST IS GREATER THAN ZERO
473400200610     C*
473500200610     C           NPAC      IFEQ 'N'
473600200610     C           WRK130    ORGT 0
473700200610     C                     MOVE ' '       WACNEG
473800200610     C                     ELSE
473900200610     C                     MOVE 'N'       WACNEG
474000200610     C                     END
474100200610     C                     MOVE 'CV'      WACAMC
474200200610     C                     Z-ADDWRK130    EVAM
474300200610     C*
474400200610     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG POSITION ON ACC IS Y
474500200610     C** AND AMNT DUE IS LESS THAN ZERO
474600200610     C*
474700200610     C           WRK130    IFLT 0
474800200610     C           NPAC      ANDEQ'Y'
474900200610     C                     Z-SUBEVAM      EVAM
475000200610     C                     END
475100200610     C                     EXSR W03
475200200610     C/COPY WNCPYSRC,SE2380C009
475300200610     C*
475400200610     C                     END
475500200610     C*
475600200610     C* WRITE MATURITY RECORD MATEXD
475700200610     C*
475800200610     C           WPORTP    IFNE 'Y'                                       S01486
475900200610     C           BGPFMG    ANDEQ'Y'                                       S01486
476000200610     C*                                                                   CPB002
476100200610     C           WPORTP    ORNE 'Y'                                       CPB002
476200200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
476300200610     C*                                                                   S01486
476400200610     C           BGPFMG    ORNE 'Y'                                       S01486
476500200610     C           BGN4ST    ANDNE'Y'                                       CPB002
476600200610     C*                                                                   S01486
476700200610     C                     EXSR W04
476800200610     C                     END                                            S01486
476900200610     C*
477000200610     C           ENDMAT    ENDSR                           ** ENDMAT **
477100200610      *
477200200610      *****************************************************************
477300200610      /EJECT
477400200610      *****************************************************************
477500200610      *                                                               *
477600200610      *  NEXT   - Subroutine to get the Date of the next Position     *
477700200610      *           held for this Security.                             *
477800200610      *                                                               *
477900200610      *****************************************************************
478000200610      *
478100200610     C           NEXT      BEGSR                           **  NEXT  **
478200200610     C*
478300200610     C** BUILD KEY, SET GREATER THAN AND READ NEXT INTERVENING POSITION
478400200610     C*
478500200610     C***********          MOVE CSBR      XCSBR                           S01117
478600200610     C                     MOVE CSBA      XCSBA                           S01117
478700200610     C                     MOVE CSSC      XCSSC
478800200610     C                     MOVE CSCN      XCSCN
478900200610     C                     MOVE CSDA      XCSDA
479000200610     C                     Z-ADDWTODAT    WNEXTD
479100200610     C           CPIKEY    SETGTCPOSHI               79
479200200610     C           *IN79     IFNE '1'
479300200610     C*
479400200610     C           CPIKND    READECPOSHI                   79
479500200610     C           *IN79     IFEQ '1'
479600200610     C                     Z-ADDWTODAT    WNEXTD
479700200610     C                     ELSE
479800200610     C*
479900200610     C* SUBR NEXT IS CALLED WITH WTODAT SET TO NEXT ACTION DATE (OR
480000200610     C* LAST POSN DATE IF CHANGE OF POSITION) AND IF NEXT POSN.DATE IS
480100200610     C* GREATER THAN THAT DATE, SET WNEXTD TO WTODAT FOR USE IN P/SEC
480200200610     C*
480300200610     C           XCSDA     IFGT WTODAT
480400200610     C                     Z-ADDWTODAT    WNEXTD
480500200610     C                     ELSE
480600200610     C                     Z-ADDXCSDA     WNEXTD
480700200610     C                     END
480800200610     C                     END
480900200610     C                     END
481000200610     C*
481100200610     C           ENDNXT    ENDSR                           ** ENDNXT **
481200200610      *
481300200610      *****************************************************************
481400200610      /EJECT
481500200610      *****************************************************************
481600200610      *                                                               *
481700200610      *  W03    - Subroutine to Write an Account Key.                 *
481800200610      *                                                               *
481900200610      *****************************************************************
482000200610      *
482100200610     C           W03       BEGSR                           **   W03  **
482200200610     C*
482300200610     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
482400200610     C*
482500200610     C           EVAM      CABEQ0         ENDW03
482600200610     C*
482700200610     C* GET CUSTOMER PORTFOLIO INDICATOR FROM CLINTSE FLD C1DI
482800200610     C           WPORTP    IFEQ 'Y'                                       S01486
482900200610     C           BGPFMG    ANDEQ'Y'                                       S01486
483000200610     C           WPORTP    OREQ 'Y'                                       CPB002
483100200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
483200200610     C                     MOVE GGCNUM    WCLNTK                          S01486
483300200610     C                     ELSE                                           S01486
483400200610     C*
483500200610     C                     MOVE CSCN      WCLNTK
483600200610     C                     END                                            S01486
483700200610     C                     EXSR CLNTIN
483800200610     C*
483900200610     C* COUNT RECORDS WRITTEN AND USE STD HASH SUBROUTINE
484000200610     C*
484100200610     C                     ADD  1         W01CNT  50
484200200610     C*
484300200610     C**  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
484400200610     C*   ARRAY ELEMENTS (IND,S DEC,S) SO S=1, ACCUMULATING ZZAMT(15/3)
484500200610     C*
484600200610     C                     Z-ADD1         Z
484700200610     C                     Z-ADD1         S
484800200610     C                     Z-ADDEVAM      ZZAMT
484900200610     C                     EXSR ZHASH
485000200610     C*
485100200610     C* BUILD OUTPUT RECORD
485200200610     C*
485300200610     C                     MOVE SITP      WACITY
485400200610     C                     MOVE ' '       WACTRT
485500200610     C           C1DI      IFEQ 'M'
485600200610     C                     MOVE *BLANKS   WACPFI
485700200610     C                     ELSE
485800200610     C                     MOVE C1DI      WACPFI
485900200610     C                     END
486000200610     C                     MOVE '  '      WACBKC
486100200610     C                     MOVE '  '      WACTST
486200200610     C                     MOVE '  '      WACPSB
486300200610     C                     MOVE '  '      WACCCC
486400200610     C***********          MOVE 'S'       WACMKT                          131379
486500200610     C                     MOVE MKTI      WACMKT                          131379
486600200610     C           CIAK      IFEQ 'Y'
486700200610     C           SCVI      ANDEQ'Y'                                       E14522
486800200610     C                     MOVE SCVI      WACCON
486900200610     C                     ELSE
487000200610     C                     MOVE ' '       WACCON
487100200610     C                     END
487200200610     C           WACAMC    IFEQ 'FP'                                      E16085
487300200610     C           WACAMC    OREQ 'FR'                                      E16085
487400200610     C           WACAMC    OREQ 'CP'                                      E16085
487500200610     C           WACAMC    OREQ 'CR'                                      E16085
487600200610     C                     MOVE *BLANKS   WACBKC                          E16085
487700200610     C                     END                                            E16085
487800200610     C                     MOVE WACKEY    ACKY
487900200610     C                     MOVE 'D'       RECI
488000200610     C*                                                                   S01509
488100200610     C** If S01509 is active, event currency could be equal to value      S01509
488200200610     C** redemption ccy or nominal ccy depending on the event type        S01509
488300200610     C*                                                                   S01509
488400200610     C           S01509    IFEQ 'Y'                                       S01509
488500200610     C                     SELEC                                          S01509
488600200610     C           SDET      WHEQ 'DV'                                      S01509
488700200610     C           SDET      OREQ 'CP'                                      S01509
488800200610     C                     MOVE VLCY      EVCY                            S01509
488900200610     C           SDET      WHEQ 'MA'                                      S01509
489000200610     C           *IN78     ANDEQ'0'                                       S01509
489100200610     C           SDCX      ANDNE*BLANKS                                   S01509
489200200610     C                     MOVE SDCX      EVCY                            S01509
489300200610     C                     OTHER                                          S01509
489400200610     C                     MOVE NMCY      EVCY                            S01509
489500200610     C                     ENDSL                                          S01509
489600200610     C*                                                                   S01509
489700200610     C                     ELSE                                           S01509
489800200610     C                     MOVE NMCY      EVCY
489900200610     C                     ENDIF                                          S01509
490000200610     C*                                                                   S01509
490100200610     C***********BGPFMG    IFNE 'Y'                                S01486 094225
490200200610     C***********          MOVE NMCY      EVCY                            094225
490300200610     C***********          END                                     S01486 094225
490400200610     C***********                                                  S01486 094225
490500200610     C***********BGPFMG    IFEQ 'Y'                                S01486 094225
490600200610     C***********                                                  S01486 094225
490700200610     C***********SDET      IFEQ 'PP'                               S01486 094225
490800200610     C***********SDET      OREQ 'MP'                               S01486 094225
490900200610     C***********SDET      OREQ 'MA'                               S01486 094225
491000200610     C***********          MOVE NMCY      EVCY                     S01486 094225
491100200610     C***********          ELSE                                    S01486 094225
491200200610     C***********          MOVE VLCY      EVCY                     S01486 094225
491300200610     C***********          END                                     S01486 094225
491400200610     C***********                                                  S01486 094225
491500200610     C***********          END                                     S01486 094225
491600200610     C*                                                                   103361
491700200610     C***********AUMO      IFEQ 'Y'                                 103361074380
491800200610     C***********PPRE      ANDEQ'R'                                 103361074380
491900200610     C           PPRE      IFEQ 'R'                                       074380
492000200610     C           SRSM      ANDEQ04                                        103361
492100200610     C***********AUMO      OREQ 'Y'                                 103361074380
492200200610     C***********PPRE      ANDEQ'P'                                 103361074380
492300200610     C           PPRE      OREQ 'P'                                       074380
492400200610     C           SPSM      ANDEQ04                                        103361
492500200610     C                     ELSE                                           103361
492600200610     C                     MOVE *BLANK    STLA
492700200610     C                     END                                            103361
492800200610     C*                                                                   103361
492900200610     C           WSRECI    IFEQ 'R'
493000200610     C                     MOVE '1'       RVRS
493100200610     C                     ELSE
493200200610     C                     MOVE '0'       RVRS
493300200610     C                     END
493400200610     C                     MOVE CSSC      SESH
493500200610     C                     Z-ADD0         TRFR
493600200610     C                     MOVELCSCN      CSTN
493700200610     C***********          MOVE CSBR      BRCH                            S01117
493800200610     C                     MOVE CSBA      BRHA                            S01117
493900200610     C**********           Z-ADD01        ASQN                            E18803
494000200610     C                     Z-ADD00        ASQN                            E18803
494100200610     C                     Z-ADDSDED      EVDT
494200200610     C                     Z-ADD0         KNCA
494300200610     C                     Z-ADD0         KBCA
494400200610     C                     MOVELCSCN      KCUST
494500200610     C*                                                                   103361
494600200610     C***********AUMO      IFEQ 'Y'                                 103361074380
494700200610     C***********PPRE      ANDEQ'R'                                 103361074380
494800200610     C           PPRE      IFEQ 'R'                                       074380
494900200610     C           SRSM      ANDEQ04                                        103361
495000200610     C***********AUMO      OREQ 'Y'                                 103361074380
495100200610     C***********PPRE      ANDEQ'P'                                 103361074380
495200200610     C           PPRE      OREQ 'P'                                       074380
495300200610     C           SPSM      ANDEQ04                                        103361
495400200610     C                     ELSE                                           103361
495500200610     C                     Z-ADD0         STLT
495600200610     C                     END                                            103361
495700200610     C*                                                                   103361
495800200610     C***********          MOVE '   '     KCCY                            E15549
495900200610     C                     MOVE NMCY      KCCY                            E15549
496000200610     C           WPORTP    IFEQ 'Y'                                       S01486
496100200610     C           BGPFMG    ANDEQ'Y'                                       S01486
496200200610     C           WPORTP    OREQ 'Y'                                       CPB002
496300200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
496400200610     C                     MOVE GGTDSS    SESH                            S01486
496500200610     C                     MOVELGGCNUM    CSTN                            S01486
496600200610     C                     MOVE GGCSBR    BRHA                            S01486
496700200610     C                     MOVELGGCNUM    KCUST                           S01486
496800200610     C                     END                                            S01486
496900200610     C*                                                                   S01486
497000200610     C* CHECK PORTFOLIO MANAGEMENT IS INSTALLED, AND,                     S01486
497100200610     C* GENERATE PORTFOLIO POSITION IS NOT EQUAL TO 'Y', AND,             S01486
497200200610     C* THE AMOUNT CODE IS FOR DIVIDENDS/INTEREST.                        S01486
497300200610     C*                                                                   S01486
497400200610     C           BGPFMG    IFEQ 'Y'                                       S01486
497500200610     C           BGN4ST    OREQ 'Y'                                       CPB002
497600200610     C*                                                                   S01486
497700200610     C** SET UP PORTFOLIO REFERENCE TO BE OUTPUT                          S01486
497800200610     C                     MOVE PTFR      SSPTFR  4                       S01486
497900200610     C           WPORTP    IFEQ 'Y'                                       S01486
498000200610     C                     MOVE GGPTFR    PTFR                            S01486
498100200610     C                     ELSE                                           S01486
498200200610     C                     MOVE *BLANKS   PTFR                            S01486
498300200610     C                     END                                            S01486
498400200610     C*                                                                   S01486
498500200610     C                     END                                            S01486
498600200610     C*                                                                   S01117
498700200610     C** Use Customer Position Profit Centre for Posn. Settlement         S01117
498800200610     C*                                                                   S01117
498900200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
499000200610     C                     MOVE CSTN      CSCN                            CAC002
499100200610     C                     MOVE BRHA      CSBA                            CAC002
499200200610     C                     MOVE SESH      CSSC                            CAC002
499300200610     C                     EXSR SEPCIN                                    CAC002
499400200610     C                     ENDIF                                          CAC002
499500200610     C*                                                                   CAC002
499600200610     C**    If Analytical Accounting is installed and customer            CAC002
499700200610     C**    position profit centre is blank, set the profit centre to     CAC002
499800200610     C**    SE ICD default profit centre.                                 CAC002
499900200610     C*                                                                   CAC002
500000200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
500100200610     C           PCCU      ANDEQ*BLANKS                                   CAC002
500200200610     C                     MOVE BVSEPC    PRFC                            CAC002
500300200610     C                     ELSE                                           CAC002
500400200610     C                     MOVE PCCU      PRFC                            S01117
500500200610     C                     ENDIF                                          CAC002
500600200610      *                                                                                       CGL020
500700200610     C           CGL020    IFEQ 'Y'                                                           CGL020
500800200610      *                                                                                       CGL020
500900200610     C           STLA      IFEQ *BLANKS                                                       CGL020
501000200610     C                     MOVE *BLANKS   F1RACT                                              CGL020
501100200610     C                     MOVE *BLANKS   F1RCTY                                              CGL020
501200200610     C                     MOVE *BLANKS   F1RBNK                                              CGL020
501300200610     C                     MOVE *BLANKS   F1RCDE                                              CGL020
501400200610     C                     MOVE *BLANKS   F1PACT                                              CGL020
501500200610     C                     MOVE *BLANKS   F1PCTY                                              CGL020
501600200610     C                     MOVE *BLANKS   F1PBNK                                              CGL020
501700200610     C                     MOVE *BLANKS   F1PCDE                                              CGL020
501800200610     C                     MOVE *BLANKS   F1DACT                                              CGL020
501900200610     C                     MOVE *BLANKS   F1DCTY                                              CGL020
502000200610     C                     MOVE *BLANKS   F1DBNK                                              CGL020
502100200610     C                     Z-ADD*ZEROS    F1SDAT                                              CGL020
502200200610      *                                                                                       CGL020
502300200610     C                     ELSE                                                               CGL020
502400200610     C                     MOVE WWRACT    F1RACT                                              CGL020
502500200610     C                     MOVE WWRCTY    F1RCTY                                              CGL020
502600200610     C                     MOVE WWRBNK    F1RBNK                                              CGL020
502700200610     C                     MOVE WWRCDE    F1RCDE                                              CGL020
502800200610     C                     MOVE WWPACT    F1PACT                                              CGL020
502900200610     C                     MOVE WWPCTY    F1PCTY                                              CGL020
503000200610     C                     MOVE WWPBNK    F1PBNK                                              CGL020
503100200610     C                     MOVE WWPCDE    F1PCDE                                              CGL020
503200200610     C                     MOVE WWDACT    F1DACT                                              CGL020
503300200610     C                     MOVE WWDCTY    F1DCTY                                              CGL020
503400200610     C                     MOVE WWDBNK    F1DBNK                                              CGL020
503500200610     C                     Z-ADDWWSDAT    F1SDAT                                              CGL020
503600200610      *                                                                                       CGL020
503700200610     C                     ENDIF                                                              CGL020
503800200610      *                                                                                       CGL020
503900200610     C                     MOVE *BLANKS   F1TICK                                              CGL020
504000200610     C                     MOVE *BLANKS   F1EXCH                                              CGL020
504100200610     C                     Z-ADD*ZEROS    F1NOML                                              CGL020
504200200610     C                     ENDIF                                                              CGL020
504300200610     C*
504400200610     C* WRITE GENERATED ACCOUNT KEY RECORD
504500200610     C*
504600200610     C                     WRITESEKEYDF
504700200610     C*                                                                   S01486
504800200610     C           BGPFMG    IFEQ 'Y'                                       S01486
504900200610     C           BGN4ST    OREQ 'Y'                                       CPB002
505000200610     C                     MOVE SSPTFR    PTFR                            S01486
505100200610     C                     END                                            S01486
505200200610     C*
505300200610     C           ENDW03    ENDSR                           ** ENDW03 **
505400200610      *
505500200610      *****************************************************************
505600200610      /EJECT
505700200610      *****************************************************************
505800200610      *                                                               *
505900200610      *  W04    - Subroutine to Write Matured Customer Security       *
506000200610      *           Positions Extract record.                           *
506100200610      *                                                               *
506200200610      *****************************************************************
506300200610      *
506400200610     C           W04       BEGSR                           **   W04  **
506500200610     C*
506600200610     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
506700200610     C*
506800200610     C           EVAM      CABEQ0         ENDW04
506900200610     C*
507000200610     C*                                                                   S01486
507100200610     C**  If Portfolio Management is on...                                S01486
507200200610     C*                                                                   S01486
507300200610     C           BGPFMG    IFEQ 'Y'                                       S01486
507400200610     C           BGN4ST    OREQ 'Y'                                       CPB002
507500200610     C*                                                                   S01486
507600200610     C** COUPON AND MATURITY EVENTS SEPARATE THEREFORE NEED TO PERFORM    S01486
507700200610     C** SR/COUPON TO CALCULATE COUPON AMOUNT                             S01486
507800200610     C                     Z-ADDCSNT      WCUMCP                          S01486
507900200610     C                     Z-ADDSDED      ZECD                            S01486
508000200610     C                     EXSR ZLCD                                      S01486
508100200610     C                     Z-ADDZZLCD     LCCP                            S01486
508200200610     C                     MOVE 'Y'       W03FLG  1                       S01486
508300200610     C                     EXSR COUPON                                    S01486
508400200610     C                     MOVE 'N'       W03FLG  1                       S01486
508500200610     C                     Z-ADDZINTDU    CPNA                            S01486
508600200610     C*                                                                   S01486
508700200610     C                     END                                            S01486
508800200610     C* COUNT RECORDS WRITTEN
508900200610     C*
509000200610     C                     ADD  1         W04CNT  50
509100200610     C*
509200200610     C                     MOVE 'C'       RECI
509300200610     C***********          MOVE CSBR      BHBR                            S01117
509400200610     C                     MOVE CSBA      BHBA                            S01117
509500200610     C                     MOVE CSSC      BHSC
509600200610     C                     MOVE *BLANK    BHBK
509700200610     C                     MOVE CSCN      CSCN
509800200610     C                     Z-ADDCSNT      CSNT
509900200610     C                     Z-ADDCSNV      CSNV
510000200610     C           BGPFMG    IFNE 'Y'                                       S01486
510100200610     C           BGN4ST    ANDNE'Y'                                       CPB002
510200200610     C                     Z-ADDWNOMAT    TCTR
510300200610     C                     ELSE                                           S01486
510400200610     C                     Z-ADDWNOMA1    TCTR                            S01486
510500200610     C                     END                                            S01486
510600200610     C                     Z-ADDSDRP      SDRP
510700200610     C                     Z-ADDZINTDU    CPNA
510800200610     C*
510900200610     C* WRITE MATURED CUSTOMER SECURITY EXTRACT FILE RECORD
511000200610     C*
511100200610     C                     WRITEMATEXDF
511200200610     C*
511300200610     C           ENDW04    ENDSR                           ** ENDW04 **
511400200610      *
511500200610      *****************************************************************
511600200610      /EJECT
511700200610      *****************************************************************
511800200610      *                                                               *
511900200610      *  W02    - Subroutine to Write a Position Settlement.          *
512000200610      *                                                               *
512100200610      *****************************************************************
512200200610      *
512300200610     C           W02       BEGSR                           **   W02  **
512400200610     C/COPY WNCPYSRC,SE2380C049
512500200610     C*
512600200610     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
512700200610     C********** BGPFMG    IFNE 'Y'                                                    S01486 263929
512800200610     C********** BGN4ST    ANDNE'Y'                                                    CPB002 263929
512900200610     C*
513000200610     C           PAMD      CABEQ0         ENDW02
513100200610     C**********           END                                                         S01486 263929
513200200610     C*                                                                   S01486
513300200610     C********** PAMD      IFEQ 0                                                      S01486 263929
513400200610     C********** PEVT      ANDNE'MT'                                                   S01486 263929
513500200610     C********** BGPFMG    ANDEQ'Y'                                                    S01486 263929
513600200610     C********** PAMD      OREQ 0                                                      CPB002 263929
513700200610     C********** PEVT      ANDNE'MT'                                                   CPB002 263929
513800200610     C********** BGN4ST    ANDEQ'Y'                                                    CPB002 263929
513900200610     C**********           GOTO ENDW02                                                 S01486 263929
514000200610     C**********           END                                                         S01486 263929
514100200610     C/COPY WNCPYSRC,SE2380C050
514200200610     C*
514300200610     C* COUNT RECORDS WRITTEN
514400200610     C*
514500200610     C***********          ADD  1         W02CNT  50                      046500
514600200610     C*
514700200610     C***********          MOVE 'D'       RECI                            081366
514800200610     C***********          MOVE 'S'       PMAR                            162208
514900200610     C                     MOVE MKTI      PMAR                            162208
515000200610     C***********          MOVE CSBR      PBCH                            S01117
515100200610     C***********          MOVE CSBA      PBCH                      S01117E33032
515200200610     C                     MOVE CSBA      PBCA                            E33032
515300200610     C                     MOVE CSSC      PSSH
515400200610     C                     MOVELCSCN      PCPY
515500200610     C*                                                                   CSE023
515600200610     C                     MOVE 'C'       CTYP                            CSE023
515700200610     C                     Z-ADD0         BAUS                            CSE023
515800200610     C                     Z-ADD0         MAMT                            CSE023
515900200610     C                     Z-ADD0         DAMT                            CSE023
516000200610     C                     Z-ADD0         PSEQ                            CSE023
516100200610     C                     Z-ADD0         SABC                            CSE023
516200200610      *                                                                   CSE023
516300200610     C           WPORTP    IFEQ 'Y'                                       S01486
516400200610     C           BGPFMG    ANDEQ'Y'                                       S01486
516500200610     C           WPORTP    OREQ 'Y'                                       CPB002
516600200610     C           BGN4ST    ANDEQ'Y'                                       CPB002
516700200610     C                     MOVE GGTDSS    PSSH                            S01486
516800200610     C                     MOVE GGCNUM    PCPY                            S01486
516900200610     C                     MOVE GGCSBR    PBCA                            104632
517000200610     C                     END                                            S01486
517100200610     C           BGPFMG    IFEQ 'Y'                                       S01486
517200200610     C           BGN4ST    OREQ 'Y'                                       CPB002
517300200610     C           SDET      IFEQ 'PP'                                      S01486
517400200610     C           SDET      OREQ 'MP'                                      S01486
517500200610     C           SDET      OREQ 'MA'                                      S01486
517600200610     C                     MOVE NMCY      PNCY                            S01486
517700200610     C                     ELSE                                           S01486
517800200610     C                     MOVE VLCY      PNCY                            S01486
517900200610     C                     END                                            S01486
518000200610     C                     ELSE                                           081239
518100200610     C                     MOVE NMCY      PNCY                            081239
518200200610     C                     END                                            S01486
518300200610     C           SDET      IFEQ 'MP'
518400200610     C           SDET      OREQ 'DV'
518500200610     C           S01512    ANDNE'Y'                                       088423
518600200610     C                     Z-ADDSDPD      PDUD
518700200610     C                     ELSE
518800200610     C                     Z-ADDSDED      PDUD
518900200610     C                     END
519000200610     C*                                                                   S01512
519100200610     C           APNS      IFEQ 'Y'
519200200610     C                     MOVE 'Y'       PAUI
519300200610     C                     MOVE 'Y'       PSMI                            S01401
519400200610     C                     ELSE
519500200610     C                     MOVE ' '       PAUI
519600200610     C                     END
519700200610     C*                                                                   S01509
519800200610     C** If S01509 is active, position currency could be equal to value   S01509
519900200610     C** ccy, redemption ccy or nominal ccy depending on the event type   S01509
520000200610     C*                                                                   S01509
520100200610     C           S01509    IFEQ 'Y'                                       S01509
520200200610     C                     SELEC                                          S01509
520300200610     C           SDET      WHEQ 'DV'                                      S01509
520400200610     C           SDET      OREQ 'CP'                                      S01509
520500200610     C                     MOVE VLCY      PNCY                            S01509
520600200610     C           SDET      WHEQ 'MA'                                      S01509
520700200610     C           *IN78     ANDEQ'0'                                       S01509
520800200610     C           SDCX      ANDNE*BLANKS                                   S01509
520900200610     C                     MOVE SDCX      PNCY                            S01509
521000200610     C                     OTHER                                          S01509
521100200610     C                     MOVE NMCY      PNCY                            S01509
521200200610     C                     ENDSL                                          S01509
521300200610     C*                                                                   S01509
521400200610     C                     ELSE                                           S01509
521500200610     C                     MOVE NMCY      PNCY
521600200610     C                     ENDIF                                          S01509
521700200610     C*                                                                   S01512
521800200610     C** Value date - set initially to due date.                          S01512
521900200610     C** Should be date of the next working day after value date in       S01512
522000200610     C** value currency if S01512 is active                               S01512
522100200610     C*                                                                   S01512
522200200610     C           S01512    IFEQ 'Y'                                       S01512
522300200610     C           SDET      IFEQ 'DV'                                      088423
522400200610     C           SDPD      SUB  1         ZDAYNO                          088423
522500200610     C                     ELSE                                           088423
522600200610     C           PDUD      SUB  1         ZDAYNO                          S01512
522700200610     C                     ENDIF                                          088423
522800200610     C                     Z-ADD1         ZNRDYS                          S01512
522900200610     C                     MOVE PNCY      ZCCY                            S01512
523000200610     C                     EXSR ZFWDT                                     S01512
523100200610     C                     Z-ADDZDYNBR    PSVL                            S01512
523200200610     C                     ELSE                                           S01512
523300200610     C           SDET      IFEQ 'DV'                                      088423
523400200610     C                     Z-ADDSDPD      PSVL                            088423
523500200610     C                     ELSE                                           088423
523600200610     C                     Z-ADDPDUD      PSVL                            S01512
523700200610     C                     ENDIF                                          088423
523800200610     C                     END                                            S01512
523900200610     C*                                                                   S01509
524000200610     C**********           MOVE DMKB      PBCD                            E14718
524100200610     C                     MOVE DPFB      PBCD                            E14718
524200200610     C                     MOVE '0'       PYCUSD  1
524300200610      *                                                                   E23169
524400200610      ** Payment currency and settlement exchange rate are held on        E23169
524500200610      ** SECTYD for straight, dual- and multi-currency securities.        E23169
524600200610      ** Exchange rate=1 for straight securities.                         E23169
524700200610     C** If S01509 is active, settle = pay currency, exchange rate is     S01509
524800200610     C** 1 with mult/div indicator as 'M'                                 S01509
524900200610      *                                                                   E23169
525000200610     C           S01509    IFEQ 'Y'                                       S01509
525100200610     C                     MOVE PNCY      PSCU                            S01509
525200200610     C                     Z-ADD1         PSXR                            S01509
525300200610     C                     MOVE 'M'       PMDI                            S01509
525400200610     C                     ELSE                                           S01509
525500200610     C                     MOVE SPYC      PSCU                            E23169
525600200610     C                     Z-ADDSEXR      PSXR                            E23169
525700200610     C                     MOVE SMDI      PMDI                            E23169
525800200610     C                     END                                            S01509
525900200610      *                                                                   E23169
526000200610     C***********VLCY      IFNE '   '                                     E23169
526100200610     C***********          MOVE VLCY      PSCU                            E23169
526200200610     C***********          ELSE                                           E23169
526300200610     C***********SPYC      IFNE '   '                                     E23169
526400200610     C*                                                                   E23169
526500200610     C***IF*PAYMENT*CURRENCY*USED*SET*FLAG*PYCUSD*TO*1*-*CHECK*BELOW***** E23169
526600200610     C*                                                                   E23169
526700200610     C***********          MOVE '1'       PYCUSD                          E23169
526800200610     C***********          MOVE SPYC      PSCU                            E23169
526900200610     C***********          ELSE                                           E23169
527000200610     C***********          MOVE NMCY      PSCU                            E23169
527100200610     C***********          END                                            E23169
527200200610     C***********          END                                            E23169
527300200610     C*                                                                   E23169
527400200610     C***CALCULATE*SETTLEMENT*EXCHANGE*RATE*-*CHECK*FLAG*PYCUSD********** E23169
527500200610     C*                                                                   E23169
527600200610     C***********PYCUSD    IFEQ '1'                                       E23169
527700200610     C***********          Z-ADDSEXR      PSXR                            E23169
527800200610     C***********          MOVE SMDI      PMDI                            E23169
527900200610     C***********          ELSE                                           E23169
528000200610     C*                                                                   E23169
528100200610     C**GET*SPOT*RATE*FOR*EACH*OF*SETT.*CCY*AND*NOM*CCY*FROM*TABTG10***** E23169
528200200610     C**THEN*CALCULATE*CROSS*RATE*USING*ZXRATE*************************** E23169
528300200610     C*                                                                   E23169
528400200610     C***********          MOVE PSCU      WCURR                           E23169
528500200610     C***********          EXSR TG10                                      E23169
528600200610     C***********          Z-ADDSPOT      ZRATE1 138                      E23169
528700200610     C***********          MOVE MDIN      ZMDI1   1                       E23169
528800200610     C***********          MOVE PNCY      WCURR                           E23169
528900200610     C***********          EXSR TG10                                      E23169
529000200610     C***********          Z-ADDSPOT      ZRATE2 138                      E23169
529100200610     C***********          MOVE MDIN      ZMDI2   1                       E23169
529200200610     C***********          EXSR ZXRATE                                    E23169
529300200610     C***********          Z-ADDZRATEX    PSXR                            E23169
529400200610     C*                                                                   E23169
529500200610     C***MULTIPLY/DIVIDE*IND*ON*TABTG10*IS*0=DIV*1=MULT****************** E23169
529600200610     C*                                                                   E23169
529700200610     C***********ZMDIX     IFEQ '0'                                       E23169
529800200610     C***********          MOVEL'D'       PMDI                            E23169
529900200610     C***********          ELSE                                           E23169
530000200610     C***********          MOVEL'M'       PMDI                            E23169
530100200610     C***********          END                                            E23169
530200200610     C***********          END
530300200610     C*
530400200610     C** BASIC CURR EXCHANGE RATE IS SPOT RATE FOR SETTLEMENT CURRCY
530500200610     C*
530600200610     C/COPY WNCPYSRC,SE2380C010
530700200610     C                     MOVE PSCU      WCURR
530800200610     C                     EXSR TG10
530900200610     C                     Z-ADDSPOT      PBRX
531000200610     C/COPY WNCPYSRC,SE2380C011
531100200610     C*
531200200610     C** ACCESS STANDARD SETTLEMENT INSTRUCTIONS FILE
531300200610     C*
531400200610     C***********          MOVE PBCH      SBRH                            S01117
531500200610     C***********          MOVE PBCH      SBRA                      S01117E33032
531600200610     C                     MOVE PBCA      SBRA                            E33032
531700200610     C                     MOVELPCPY      CSTM
531800200610     C                     MOVE PSCU      CYSI
531900200610     C                     MOVE SITP      ITSI
532000200610     C                     MOVE *BLANK    PSEA
532100200610     C                     MOVE *BLANK    PSEB
532200200610     C                     MOVE *BLANK    PCPN
532300200610     C                     MOVE *BLANK    PFAC
532400200610     C                     MOVE *BLANK    PSPI
532500200610     C                     MOVE *ZEROS    PSMT                            048612
532600200610     C                     MOVE PCPY      WCLNTK                          E16085
532700200610     C                     Z-ADD*ZERO     PSMT                            074380
532800200610     C           CLINTK    CHAINCLINT                99                   E16085
532900200610     C           *IN99     IFEQ '0'                                       E16085
533000200610     C           C1DI      ANDNE'M'                                       E16085
533100200610     C                     MOVE *BLANK    ITSI                            E16085
533200200610     C                     END                                            E16085
533300200610     C/COPY WNCPYSRC,SE2380C034
533400200610      *                                                                                       CSE028
533500200610      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
533600200610      *                                                                                       CSE028
533700200610     C           CSE028    IFEQ 'Y'                                                           CSE028
533800200610      *                                                                                       CSE028
533900200610     C                     MOVE *OFF      *IN77                                               CSE028
534000200610     C                     MOVELCSTM      PCUST                                               CSE028
534100200610     C                     CALL 'SESSIR0'                                                     CSE028
534200200610     C                     PARM 'D'       POTYP   1                                           CSE028
534300200610     C                     PARM SBRA      PBRCH   3                                           CSE028
534400200610     C                     PARM           PCUST   6                                           CSE028
534500200610     C                     PARM PBCD      PBOOK   2                                           CSE028
534600200610     C                     PARM CYSI      PCURR   3                                           CSE028
534700200610     C                     PARM SMCC      PMRKT   2                                           CSE034
534800200610     C                     PARM ITSI      PINVT   3                                           CSE028
534900200610     C                     PARM PTFR      PPTFR   4                                           CSE028
535000200610     C                     PARM           PCBSTD                                              CSE028
535100200610     C                     PARM           PCBSAD                                              CSE028
535200200610     C                     PARM *BLANKS   PRTCD   5                                           CSE028
535300200610      *                                                                                       CSE028
535400200610     C           PRTCD     IFNE '*NRF '                                                       CSE028
535500200610     C                     SELEC                                                              CSE028
535600200610     C           PRTCD     WHNE '*NCRF'                                                       CSE028
535700200610     C           2         OCUR PCBSTD                                                        CSE028
535800200610     C           PRTCD     WHNE '*NBRF'                                                       CSE028
535900200610     C           1         OCUR PCBSTD                                                        CSE028
536000200610     C                     ENDSL                                                              CSE028
536100200610     C                     MOVE STRECI    RECI                                                CSE028
536200200610     C                     ELSE                                                               CSE028
536300200610      *                                                                                       CSE028
536400200610      ** Set on Record Not Found indicator.                                                   CSE028
536500200610     C                     MOVE *ON       *IN77                                               CSE028
536600200610     C                     ENDIF                                                              CSE028
536700200610      *                                                                                       CSE028
536800200610     C                     ELSE                                                               CSE028
536900200610     C           STDSKY    CHAINSTDSED               77
537000200610     C                     ENDIF                                                              CSE028
537100200610      *                                                                                       CSE028
537200200610     C/COPY WNCPYSRC,SE2380C057
537300200610     C           *IN77     IFNE '1'
537400200610     C           RECI      OREQ '*'                                       081366
537500200610      *                                                                   147514
537600200610     C                     MOVE *OFF      *IN88                           147514
537700200610      *                                                                   CEU005
537800200610      * CEU005 active and Settlement Ccy used on STDSED.                  CEU005
537900200610     C           CEU005    IFEQ 'Y'                                       CEU005
538000200610     C           SCCY      ANDNE*BLANKS                                   CEU005
538100200610      *                                                                   CEU005
538200200610      * Access currencies file for EURO rate, EURO M/D indicator and      CEU005
538300200610      * Transition Date for 'In' Ccy.                                     CEU005
538400200610      *                                                                   CEU005
538500200610     C           PSCU      IFEQ BKEURO                                    CEU005
538600200610     C                     CALL 'AOCURRR0'                                CEU005
538700200610     C                     PARM           @RTCD   7                       CEU005
538800200610     C                     PARM '*KEY   ' @OPTN   7                       CEU005
538900200610     C                     PARM SCCY      @AJCD   3                       CEU005
539000200610     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
539100200610     C           @RTCD     IFNE *BLANKS                                   CEU005
539200200610     C                     SETON                     U7U8                 CEU005
539300200610     C                     MOVE '44'      DBASE             ************  CEU005
539400200610     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  CEU005
539500200610     C                     MOVELSCCY      DBKEY             * ERROR 44 *  CEU005
539600200610     C                     EXSR *PSSR                       ************  CEU005
539700200610     C                     GOTO EAUDIT                                    CEU005
539800200610     C                     ENDIF                                          CEU005
539900200610     C                     ELSE                                           CEU005
540000200610     C           SCCY      IFEQ BKEURO                                    CEU005
540100200610     C                     CALL 'AOCURRR0'                                CEU005
540200200610     C                     PARM           @RTCD   7                       CEU005
540300200610     C                     PARM '*KEY   ' @OPTN   7                       CEU005
540400200610     C                     PARM PSCU      @AJCD   3                       CEU005
540500200610     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
540600200610     C           @RTCD     IFNE *BLANKS                                   CEU005
540700200610     C                     SETON                     U7U8                 CEU005
540800200610     C                     MOVE '45'      DBASE             ************  CEU005
540900200610     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  CEU005
541000200610     C                     MOVELPSCU      DBKEY             * ERROR 45 *  CEU005
541100200610     C                     EXSR *PSSR                       ************  CEU005
541200200610     C                     GOTO EAUDIT                                    CEU005
541300200610     C                     ENDIF                                          CEU005
541400200610     C                     ENDIF                                          CEU005
541500200610     C                     ENDIF                                          CEU005
541600200610      *                                                                   CEU005
541700200610      * Value date is later than Transition Start Date.                   CEU005
541800200610     C           PSVL      IFGE A6TPSD                                    CEU005
541900200610     C           A6INCY    ANDEQ'Y'                                       143690
542000200610     C                     Z-ADDA6EUER    PSXR                            CEU005
542100200610      *                                                                   CEU005
542200200610      **Settlement ccy*is*Euro*currency,*reverse*M/D*indicator.    CEU005 143690
542300200610     C** Nominal ccy is Euro currency, reverse M/D indicator.             143690
542400200610     C***********SCCY      IFEQ BKEURO                             CEU005 143690
542500200610     C           PSCU      IFEQ BKEURO                                    143690
542600200610     C           A6EUMD    IFEQ 'M'                                       CEU005
542700200610     C                     MOVE 'D'       PMDI                            CEU005
542800200610     C                     ELSE                                           CEU005
542900200610     C                     MOVE 'M'       PMDI                            CEU005
543000200610     C                     ENDIF                                          CEU005
543100200610      *                                                                   CEU005
543200200610      **Settlement*ccy*not*Euro*ccy,*use*Euro*M/D*indicator.       CEU005 143690
543300200610     C** Settlement ccy is Euro ccy, use Euro M/D indicator.              143690
543400200610     C                     ELSE                                           CEU005
543500200610     C                     MOVE A6EUMD    PMDI                            CEU005
543600200610     C                     ENDIF                                          CEU005
543700200610      *                                                                   CEU005
543800200610      * Use standard settlement ccy for position settlement ccy           CEU005
543900200610     C                     MOVE SCCY      PSCU                            CEU005
544000200610      *                                                                   194195
544100200610     C                     MOVE PSCU      WCURR                           194195
544200200610     C                     EXSR TG10                                      194195
544300200610     C                     Z-ADDSPOT      PBRX                            194195
544400200610      *                                                                   CEU005
544500200610      * Chain STDSED again.                                               CEU005
544600200610     C                     MOVE SCCY      CYSI                            CEU005
544700200610     C***********STDSKY    CHAINSTDSED               77            CEU005 147514
544800200610      *                                                                                       CSE028
544900200610      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
545000200610      *                                                                                       CSE028
545100200610     C           CSE028    IFEQ 'Y'                                                           CSE028
545200200610      *                                                                                       CSE028
545300200610     C                     MOVE *OFF      *IN88                                               CSE028
545400200610     C                     MOVELCSTM      PCUST                                               CSE028
545500200610     C                     CALL 'SESSIR0'                                                     CSE028
545600200610     C                     PARM 'D'       POTYP                                               CSE028
545700200610     C                     PARM SBRA      PBRCH                                               CSE028
545800200610     C                     PARM           PCUST                                               CSE028
545900200610     C                     PARM PBCD      PBOOK                                               CSE028
546000200610     C                     PARM CYSI      PCURR                                               CSE028
546100200610     C                     PARM SMCC      PMRKT                                               CSE034
546200200610     C                     PARM ITSI      PINVT                                               CSE028
546300200610     C                     PARM PTFR      PPTFR                                               CSE028
546400200610     C                     PARM           PCBSTD                                              CSE028
546500200610     C                     PARM           PCBSAD                                              CSE028
546600200610     C                     PARM *BLANKS   PRTCD                                               CSE028
546700200610      *                                                                                       CSE028
546800200610     C           PRTCD     IFNE '*NRF '                                                       CSE028
546900200610     C                     SELEC                                                              CSE028
547000200610     C           PRTCD     WHNE '*NCRF'                                                       CSE028
547100200610     C           2         OCUR PCBSTD                                                        CSE028
547200200610     C           PRTCD     WHNE '*NBRF'                                                       CSE028
547300200610     C           1         OCUR PCBSTD                                                        CSE028
547400200610     C                     ENDSL                                                              CSE028
547500200610     C                     MOVE STRECI    RECI                                                CSE028
547600200610     C                     ELSE                                                               CSE028
547700200610      *                                                                                       CSE028
547800200610      ** Set on Record Not Found indicator.                                                   CSE028
547900200610     C                     MOVE *ON       *IN88                                               CSE028
548000200610     C                     ENDIF                                                              CSE028
548100200610      *                                                                                       CSE028
548200200610     C                     ELSE                                                               CSE028
548300200610     C           STDSKY    CHAINSTDSED               88                   147514
548400200610     C                     ENDIF                                                              CSE028
548500200610      *                                                                                       CSE028
548600200610     C/COPY WNCPYSRC,SE2380C058
548700200610     C*****                ENDIF                                   CEU005 147869
548800200610     C*****                ENDIF                                   CEU005 147869
548900200610     C                     ENDIF                                          175400
549000200610     C                     ENDIF                                          175400
549100200610      *                                                                   CEU005
549200200610      * If no record found ensure fields from last chain not loaded       CEU005
549300200610      * to output fields.                                                 CEU005
549400200610     C************IN77     IFEQ '1'                                CEU005 147514
549500200610     C           *IN88     IFEQ *ON                                       147514
549600200610     C           CEU005    ANDEQ'Y'                                       CEU005
549700200610     C                     MOVE *BLANKS   PSMT                            CEU005
549800200610     C                     MOVE *BLANKS   PSEA                            CEU005
549900200610     C                     MOVE *BLANKS   PSEB                            CEU005
550000200610     C                     MOVE *BLANKS   PCPN                            CEU005
550100200610     C                     MOVE *BLANKS   PFAC                            CEU005
550200200610     C                     MOVE *BLANKS   PSPI                            CEU005
550300200610     C                     MOVE *BLANKS   STLA                            CEU005
550400200610     C                     Z-ADD0         STLT                            CEU005
550500200610     C                     MOVE *BLANKS   PRCNUM                          CEU005
550600200610     C                     MOVE *BLANKS   PRACOD                          CEU005
550700200610     C                     MOVE *BLANKS   PRACSQ                          CEU005
550800200610     C                     MOVE *BLANKS   PPFC                            CEU005
550900200610     C***********          ENDIF                                    147869175400
551000200610     C***********          ENDIF                                    147869175400
551100200610     C                     ELSE                                           CEU005
551200200610     C*
551300200610     C** USE RECEIVE FIELDS IF PAY/RECEIVE IND IS SET TO P
551400200610     C*
551500200610     C           PPRE      IFEQ 'P'
551600200610     C                     MOVE SPSM      PSMT
551700200610     C                     MOVE SPAT      PSEA
551800200610     C***********          MOVE SPBR      PSEB                            S01117
551900200610     C                     MOVE SPBA      PSEB                            S01117
552000200610     C                     MOVE SPCB      PCPN
552100200610     C                     MOVE SPFA      PFAC
552200200610     C                     MOVE SPSI      PSPI
552300200610     C*                                                                   103361
552400200610     C***********AUMO      IFEQ 'Y'                                 103361074380
552500200610     C                     MOVE SPAT      STLA                            103361
552600200610     C                     Z-ADDSPSM      STLT                            103361
552700200610      *                                                                   103361
552800200610      ** If settlement method is '04' and settlement account is blank,    103361
552900200610      ** retrieve prime account number                                    103361
553000200610      *                                                                   103361
553100200610     C           STLT      IFEQ 04                         B5             103361
553200200610     C           STLA      ANDEQ*BLANKS                                   103361
553300200610      *                                                                   103361
553400200610      * Retrieve prime account number                                     103361
553500200610      *                                                                   103361
553600200610     C                     MOVE CSTM      PRCNUM                          103361
553700200610     C                     MOVE BMACCD    PRACOD                          103361
553800200610     C                     MOVE '01'      PRACSQ                          103361
553900200610      *                                                                   136297
554000200610      ** Check if account exists else use suspense account                136297
554100200610      *                                                                   136297
554200200610     C                     MOVE PRCNUM    KYCNUM                          136297
554300200610     C                     MOVE PSCU      KYCCY                           136297
554400200610     C                     MOVE PRACOD    KYACOD                          136297
554500200610     C                     MOVE PRACSQ    KYACSQ                          136297
554600200610     C                     MOVE PSEB      KYBRCA                          136297
554700200610     C           KEYACC    CHAINACCOUNTF             20                   136297
554800200610     C           *IN20     IFEQ '1'                                       136297
554900200610     C           RECI      OREQ '*'                                       136297
555000200610     C           1         CHAINTABTB20              21                   136297
555100200610     C           *IN21     IFEQ '0'                                       136297
555200200610     C                     MOVE COMS      PRACOD                          136297
555300200610     C                     ENDIF                                          136297
555400200610     C           PSEB      CHAINSDBRCHL0             22                   136297
555500200610     C           *IN22     IFEQ '0'                                       136297
555600200610     C                     MOVE A8BICN    PRCNUM                          136297
555700200610     C                     ENDIF                                          136297
555800200610     C                     ENDIF                                          136297
555900200610      *                                                                   103361
556000200610     C                     MOVE PRACCT    STLA                            103361
556100200610     C                     MOVE PRACCT    PSEA                            103361
556200200610     C                     END                             E5             103361
556300200610     C***********          END                                      103361074380
556400200610      *                                                                   103361
556500200610     C                     ELSE
556600200610     C*
556700200610     C***********                                                   S01486081239
556800200610     C****If*Portfolio*Management*is*on...**************************S01486081239
556900200610     C***********                                                   S01486081239
557000200610     C***********BGPFMG    IFEQ 'Y'                                 S01486081239
557100200610     C***********                                                   S01486081239
557200200610     C***SET*UP*PORTFOLIO*REFERENCE*********************************S01486081239
557300200610     C***********WPORTP    IFEQ 'Y'                                 S01486081239
557400200610     C***********          MOVE GGPTFR    PTFR                      S01486081239
557500200610     C***********          ELSE                                     S01486081239
557600200610     C***********          MOVE *BLANKS   PTFR                      S01486081239
557700200610     C***********          END                                      S01486081239
557800200610     C***********                                                   S01486081239
557900200610     C***PERFORM*P/P07*TO*SET*UP*SETTLEMENT*DETAILS*(LEUMI*SAR)*****S01486081239
558000200610     C***********          EXSR P07                                 S01486081239
558100200610     C***********                                                   S01486081239
558200200610     C***********          END                                      S01486081239
558300200610     C** USE PAY FIELDS IF PAY/RECEIVE IND IS SET TO R
558400200610     C*
558500200610     C           PPRE      IFEQ 'R'
558600200610     C                     MOVE SRSM      PSMT
558700200610     C                     MOVE SRAC      PSEA
558800200610     C***********          MOVE SRBR      PSEB                            S01117
558900200610     C                     MOVE SRAB      PSEB                            S01117
559000200610     C                     MOVE SRCB      PCPN
559100200610     C                     MOVE *BLANK    PFAC
559200200610     C                     MOVE *BLANK    PSPI
559300200610     C*                                                                   103361
559400200610     C***********AUMO      IFEQ 'Y'                                 103361074380
559500200610     C                     MOVE SRAC      STLA                            103361
559600200610     C                     Z-ADDSRSM      STLT                            103361
559700200610      *                                                                   103361
559800200610      ** If settlement method is '04' and settlement account is blank,    103361
559900200610      ** retrieve prime account number                                    103361
560000200610      *                                                                   103361
560100200610     C           STLT      IFEQ 04                         B6             103361
560200200610     C           STLA      ANDEQ*BLANKS                                   103361
560300200610      *                                                                   103361
560400200610      * Retrieve prime account number                                     103361
560500200610      *                                                                   103361
560600200610     C                     MOVE CSTM      PRCNUM                          103361
560700200610     C                     MOVE BMACCD    PRACOD                          103361
560800200610     C                     MOVE '01'      PRACSQ                          103361
560900200610      *                                                                   136297
561000200610      ** Check if account exists else use suspense account                136297
561100200610      *                                                                   136297
561200200610     C                     MOVE PRCNUM    KYCNUM                          136297
561300200610     C                     MOVE PSCU      KYCCY                           136297
561400200610     C                     MOVE PRACOD    KYACOD                          136297
561500200610     C                     MOVE PRACSQ    KYACSQ                          136297
561600200610     C                     MOVE PSEB      KYBRCA                          136297
561700200610     C           KEYACC    CHAINACCOUNTF             20                   136297
561800200610     C           *IN20     IFEQ '1'                                       136297
561900200610     C           RECI      OREQ '*'                                       136297
562000200610     C           1         CHAINTABTB20              21                   136297
562100200610     C           *IN21     IFEQ '0'                                       136297
562200200610     C                     MOVE COMS      PRACOD                          136297
562300200610     C                     ENDIF                                          136297
562400200610     C           PSEB      CHAINSDBRCHL0             22                   136297
562500200610     C           *IN22     IFEQ '0'                                       136297
562600200610     C                     MOVE A8BICN    PRCNUM                          136297
562700200610     C                     ENDIF                                          136297
562800200610     C                     ENDIF                                          136297
562900200610      *                                                                   103361
563000200610     C                     MOVE PRACCT    STLA                            103361
563100200610     C                     MOVE PRACCT    PSEA                            103361
563200200610     C                     END                             E5             103361
563300200610     C***********          END                                      103361074380
563400200610     C*                                                                   103361
563500200610     C                     END
563600200610     C                     END
563700200610     C/COPY WNCPYSRC,SE2380C035
563800200610     C                     END
563900200610     C*                                                                   084669
564000200610     C           PSEB      IFEQ *BLANKS                                   084669
564100200610     C                     MOVE PBCA      PSEB                            084669
564200200610     C                     END                                            084669
564300200610     C/COPY WNCPYSRC,SE2380C059
564400200610     C*                                                                   S01117
564500200610     C** Use Customer Position Profit Centre for Posn. Settlement         S01117
564600200610     C*                                                                   S01117
564700200610     C                     MOVE PCCU      PPFC                            S01117
564800200610     C*
564900200610     C                     ENDIF                                          CEU005
565000200610     C           PSEB      IFEQ *BLANKS                                                     BUG11272
565100200610     C                     MOVE PBCA      PSEB                                              BUG11272
565200200610     C                     END                                                              BUG11272
565300200610     C                     Z-ADDRUND      PDTG
565400200610      *                                                                                       CGL020
565500200610      ** If Settlement Account is not blank                                                   CGL020
565600200610      *                                                                                       CGL020
565700200610     C           CGL020    IFEQ 'Y'                                                           CGL020
565800200610     C           PSEA      ANDNE*BLANKS                                                       CGL020
565900200610      *                                                                                       CGL020
566000200610     C                     MOVE *BLANKS   PINTG                                               CGL020
566100200610     C                     MOVE *BLANKS   PINTGA                                              CGL020
566200200610     C                     MOVE *BLANKS   PINST                                               CGL020
566300200610     C                     MOVE *BLANKS   PINSTA                                              CGL020
566400200610     C                     MOVE *BLANKS   PBENM                                               CGL020
566500200610     C                     MOVE *BLANKS   PBENMA                                              CGL020
566600200610      *                                                                                       CGL020
566700200610     C                     CALL ZAAMLP                                                        CGL020
566800200610     C                     PARM           PINTG  10                                           CGL020
566900200610     C                     PARM           PINTGA 35                                           CGL020
567000200610     C                     PARM           PINST  10                                           CGL020
567100200610     C                     PARM           PINSTA 35                                           CGL020
567200200610     C                     PARM           PBENM  10                                           CGL020
567300200610     C                     PARM           PBENMA 35                                           CGL020
567400200610     C                     PARM           PDEBT  10                                           CSW210
567500200610     C                     PARM           PDEBTA 35                                           CSW210
567600200610     C                     PARM           PCPY                                                CGL020
567700200610     C                     PARM           PFAC                                                CGL020
567800200610     C                     PARM           PSEA                                                CGL020
567900200610     C                     PARM           PSEB                                                CGL020
568000200610     C                     PARM           PSCU                                                CGL020
568100200610     C                     PARM           WWRACT 20                                           CGL020
568200200610     C                     PARM           WWRCTY  2                                           CGL020
568300200610     C                     PARM           WWRBNK 20                                           CGL020
568400200610     C                     PARM           WWRCDE 11                                           CGL020
568500200610     C                     PARM           WWPACT 20                                           CGL020
568600200610     C                     PARM           WWPCTY  2                                           CGL020
568700200610     C                     PARM           WWPBNK 20                                           CGL020
568800200610     C                     PARM           WWPCDE 11                                           CGL020
568900200610     C                     PARM           WWDACT 35                                           CGL020
569000200610     C                     PARM           WWDCTY  2                                           CGL020
569100200610     C                     PARM           WWDBNK 20                                           CGL020
569200200610      *                                                                                       CGL020
569300200610     C                     Z-ADDPDUD      WWSDAT  50                                          CGL020
569400200610      *                                                                                       CGL020
569500200610     C                     ENDIF                                                              CGL020
569600200610      *                                                                   S01447
569700200610      *** If S01447 installed, and settlement type = Dividend or Coupon   S01447
569800200610      *** and a security WHT record for the security exists, calcu-       S01447
569900200610      *** late tax amounts.                                               S01447
570000200610      *                                                                   S01447
570100200610     C           S01447    IFEQ 'N'                                       S01447
570200200610     C           *IN80     OREQ '1'                                       S01447
570300200610     C           PPRE      OREQ 'R'                                       S01447
570400200610     C           SDET      ORNE 'DV'                                      S01447
570500200610     C           SDET      ANDNE'CP'                                      S01447
570600200610     C                     CLEARTASO                                      S01447
570700200610     C                     CLEARTASR                                      S01447
570800200610     C                     CLEARTAUS                                      S01447
570900200610     C                     ELSE                                           S01447
571000200610     C/COPY WNCPYSRC,SE2380C055
571100200610     C                     EXSR CALCTX                                    S01447
571200200610     C/COPY WNCPYSRC,SE2380C056
571300200610     C                     END                                            S01447
571400200610     C*
571500200610     C* ZEROISE NUMERIC FIELDS WITH NO SPECIFIED VALUE
571600200610     C*
571700200610     C                     Z-ADD0         PCHA
571800200610     C/COPY WNCPYSRC,SE2380C012
571900200610     C                     Z-ADD0         PCAM
572000200610     C/COPY WNCPYSRC,SE2380C013
572100200610     C                     MOVE *BLANKS   PCHC                            S01519
572200200610     C                     MOVE *BLANKS   PCCD                            S01519
572300200610     C*                                                                   081239
572400200610     C**  If Portfolio Management is on...                                081239
572500200610     C*                                                                   081239
572600200610     C           BGPFMG    IFEQ 'Y'                                       081239
572700200610     C           BGN4ST    OREQ 'Y'                                       CPB002
572800200610     C*                                                                   081239
572900200610     C** SET UP PORTFOLIO REFERENCE                                       081239
573000200610     C*                                                                   081239
573100200610     C           WPORTP    IFEQ 'Y'                                       081239
573200200610     C                     MOVE GGPTFR    PTFR                            081239
573300200610     C                     ELSE                                           081239
573400200610     C                     MOVE *BLANKS   PTFR                            081239
573500200610     C                     END                                            081239
573600200610     C*                                                                   081239
573700200610     C** PERFORM P/P07 TO SET UP SETTLEMENT DETAILS                       081239
573800200610     C*                                                                   081239
573900200610     C                     EXSR P07                                       081239
574000200610     C*                                                                   081239
574100200610     C                     END                                            081239
574200200610     C                     Z-ADD0         PSAT
574300200610     C***********          Z-ADD0         LCD                             066777
574400200610     C           BGPFMG    IFNE 'Y'                                       S01486
574500200610     C           BGN4ST    ANDNE'Y'                                       CPB002
574600200610     C                     Z-ADDRUND      LCD                             066777
574700200610     C                     Z-ADD0         TNLU
574800200610     C                     END                                            S01486
574900200610     C***********          MOVE ' '       CHTP                           *E18221
575000200610     C                     MOVE 'I'       CHTP                           *E18221
575100200610     C/COPY WNCPYSRC,SE2380C014
575200200610     C                     MOVE 'D'       RECI                            103017
575300200610      *                                                                                     AR853119
575400200610     C           CER049    IFEQ 'Y'                                                         AR853119
575500200610     C                     EXSR SRPOST                                                      AR853119
575600200610     C                     ENDIF                                                            AR853119
575700200610     C*                                                                   S01519
575800200610     C** If S01519 is active and autocharge option field is Y,            S01519
575900200610     C** calculate the default charge/commission amount and settlement    S01519
576000200610     C** amount                                                           S01519
576100200610     C*                                                                   S01519
576200200610     C           S01519    IFEQ 'Y'                                       S01519
576300200610     C           BVACOP    ANDEQ'Y'                                       S01519
576400200610     C                     EXSR P04                                       S01519
576500200610     C           WRVPOS    IFEQ 'Y'                                                           260331
576600200610     C                     Z-SUBPCAM      PCAM                                                260331
576700200610     C                     Z-SUBPCHA      PCHA                                                260331
576800200610     C                     ENDIF                                                              260331
576900200610     C***********          EXSR P06                                S01519 094229
577000200610     C                     END                                            S01519
577100200610     C/COPY WNCPYSRC,SE2380C022
577200200610     C                     EXSR P06                                       094229
577300200610     C/COPY WNCPYSRC,SE2380C023
577400200610     C*
577500200610     C** Write position settlement record
577600200610     C*                                                                   S01486
577700200610     C**  If Portfolio Management is on...                                S01486
577800200610     C*                                                                   S01486
577900200610     C           BGPFMG    IFEQ 'Y'                                       S01486
578000200610     C           BGN4ST    OREQ 'Y'                                       CPB002
578100200610     C*                                                                   S01486
578200200610     C** CONVERT SETTLEMENT TOTAL AMOUNT USING SR ZCCYGB                  S01486
578300200610     C*                                                                   S01486
578400200610     C           PSCU      IFNE PNCY                                      S01486
578500200610     C                     Z-ADDPSAT      ZAMTF                           S01486
578600200610     C                     MOVE PNCY      ZCCYF                           S01486
578700200610     C                     MOVE PSCU      ZCCYT                           S01486
578800200610     C                     MOVE BCCY      ZCCYB                           S01486
578900200610     C/COPY WNCPYSRC,SE2380C017
579000200610     C                     EXSR ZCCYGB                                    S01486
579100200610     C/COPY WNCPYSRC,SE2380C018
579200200610     C*                                                                   S01486
579300200610     C                     Z-ADDZCRSRT    PSXR                            S01486
579400200610     C                     MOVE ZCRSMD    PMDI                            S01486
579500200610     C                     Z-ADDZAMTT     PSAT                            S01486
579600200610     C                     ELSE                                           S01486
579700200610     C                     Z-ADD1         PSXR                            S01486
579800200610     C                     MOVE 'M'       PMDI                            S01486
579900200610     C                     END                                            S01486
580000200610     C***********BGPFMG    IFEQ 'Y'                                 S01486081239
580100200610     C                     Z-ADDTNLU      PTNLU   50                      S01486
580200200610     C***********          EXSR ZTNLU1                              S01486081239
580300200610     C                     MOVELNATN      TNLU                            S01486
580400200610     C                     MOVE 'I'       CHTP                            S01486
580500200610     C***********          END                                      S01486081239
580600200610     C*                                                                   S01486
580700200610     C** IF MATURITY POSITION SETTLEMENT FOR ZERO AMOUNT DUE FOR          S01486
580800200610     C** FOR PORTFOLIO PERFORMANCE WITH PERFROMANCE SET ALL AMOUNT        S01486
580900200610     C** FIELDS TO ZERO                                                   S01486
581000200610     C           PEVT      IFEQ 'MT'                       B1             S01486
581100200610     C           PAMD      ANDEQ0                                         S01486
581200200610     C*                                                                   S01486
581300200610     C           WPORTP    IFEQ 'Y'                        B2             S01486
581400200610     C           GGPTFR    ANDNE'9997'                                    S01486
581500200610     C           PNPSDT    ANDLTECD                                       S01486
581600200610     C                     MOVE *BLANKS   PCHC                            S01486
581700200610     C                     MOVE *BLANKS   PCCD                            S01486
581800200610     C                     Z-ADD0         PCHA                            S01486
581900200610     C                     Z-ADD0         PCAM                            S01486
582000200610     C/COPY WNCPYSRC,SE2380C024
582100200610     C                     Z-ADD0         PSAT                            S01486
582200200610     C                     Z-ADD0         TASO                            S01486
582300200610     C                     Z-ADD0         TASR                            S01486
582400200610     C                     Z-ADD0         TAUS                            S01486
582500200610     C                     Z-ADD0         P3STAF                                            AR853119
582600200610     C                     Z-ADD0         T2TATC                                            AR853119
582700200610     C*                                                                   S01486
582800200610     C** ....OTHERWISE DO NOT OUTPUT POSITION SETTLEMENT RECORED          S01486
582900200610     C                     ELSE                            X2             S01486
583000200610     C                     GOTO ENDW02                                    S01486
583100200610     C                     END                             E2             S01486
583200200610     C                     END                             E1             S01486
583300200610     C                     END                                            S01486
583400200610     C*                                                                   046500
583500200610     C**********           ADD  1         W02CNT  50               046500 CSE023
583600200610     C*                                                                   CAC002
583700200610     C** Use Customer Position Profit Centre for Posn. Settlement         CAC002
583800200610     C*                                                                   CAC002
583900200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
584000200610     C                     MOVE PCPY      CSCN                            CAC002
584100200610     C                     MOVE PBCA      CSBA                            CAC002
584200200610     C                     MOVE PSSH      CSSC                            CAC002
584300200610     C                     EXSR SEPCIN                                    CAC002
584400200610     C                     ENDIF                                          CAC002
584500200610     C*                                                                   CAC002
584600200610     C**    If Analytical Accounting is installed and customer            CAC002
584700200610     C**    position profit centre is blank, set the profit centre to     CAC002
584800200610     C**    SE ICD default profit centre.                                 CAC002
584900200610     C*                                                                   CAC002
585000200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
585100200610     C           PCCU      ANDEQ*BLANKS                                   CAC002
585200200610     C                     MOVE BVSEPC    PPFC                            CAC002
585300200610     C                     ELSE                                           CAC002
585400200610     C                     MOVE PCCU      PPFC                            CAC002
585500200610     C                     ENDIF                                          CAC002
585600200610     C*                                                                   CAC002
585700200610     C                     Z-ADD0         FXMP                            CAC002
585800200610     C                     Z-ADD0         FXMR                            CAC002
585900200610     C                     Z-ADD0         MAMT                            CAC002
586000200610      *                                                                                      251950A
586100200610     C           PSEB      IFEQ *BLANKS                                                      251950A
586200200610     C                     MOVE PBCA      PSEB                                               251950A
586300200610     C                     END                                                               251950A
586400200610      *                                                                                      251950A
586500200610     C/COPY WNCPYSRC,SE2380C060
586600200610     C*
586700200610     C** WRITE POSITION SETTLMENT RECORD
586800200610     C*
586900200610     C                     MOVE 'D'       RECI                            081366
587000200610      *                                                                   CSE023
587100200610      ** If CSE023 is not installed or if CSE023 is installed and         CSE023
587200200610      ** the events is not for Coupon, Dividend or Maturity then          CSE023
587300200610      ** use the normal processing.                                       CSE023
587400200610      *                                                                   CSE023
587500200610     C           CSE023    IFEQ 'N'                                       CSE023
587600200610      *                                                                   CSE023
587700200610     C           CSE023    OREQ 'Y'                                       CSE023
587800200610     C           PEVT      ANDNE'CP'                                      CSE023
587900200610     C           PEVT      ANDNE'MT'                                      CSE023
588000200610     C           PEVT      ANDNE'DV'                                      CSE023
588100200610      *                                                                   CSE023
588200200610     C           CRTT      OREQ *BLANKS                                   CSE023
588300200610      *                                                                   CSE023
588400200610      ** Count records written                                            CSE023
588500200610      *                                                                   CSE023
588600200610     C                     ADD  1         W02CNT  50                      CSE023
588700200610     C                     WRITEPOSETDF
588701200616     C                     EXSR PSAUDT                                                      AR324886
588800200610      *                                                                                     AR853119
588900200610     C           CER049    IFEQ 'Y'                                                         AR853119
589000200610     C                     WRITEPOSETDD3                                                    AR853119
589100200610     C           P3TAX     IFEQ 'Y'                                                        AR864714B
589200200610     C                     WRITE@STMDP0                                                     AR853119
589300200610     C                     ENDIF                                                           AR864714B
589400200610     C                     ENDIF                                                            AR853119
589500200610      *                                                                   CSE023
589600200610     C                     ELSE                                           CSE023
589700200610      *                                                                   CSE023
589800200610      ** If Treaty Withholding Tax is installed, then set up fields       CSE023
589900200610      ** for SE2310.                                                      CSE023
590000200610      *                                                                   CSE023
590100200610      ** For Coupon Event, @DIVDT is the Last Coupon Date.                CSE023
590200200610      ** For Dividend Event, @DIVDT is equal to the dividend date.        CSE023
590300200610      *                                                                   CSE023
590400200610     C                     Z-ADD0         @DIVDT                          CSE023
590500200610     C                     MOVE ' '       @TVBAS                          CSE023
590600200610      *                                                                   CSE023
590700200610     C           PEVT      IFEQ 'CP'                                      CSE023
590800200610     C                     Z-ADDLCCP      @DIVDT                          CSE023
590900200610     C                     END                                            CSE023
591000200610      *                                                                   CSE023
591100200610     C           PEVT      IFEQ 'DV'                                      CSE023
591200200610     C           S01510    IFEQ 'Y'                                       CSE023
591300200610     C                     Z-ADDSDXD      @DIVDT                          CSE023
591400200610     C                     ELSE                                           CSE023
591500200610     C                     Z-ADDPDUD      @DIVDT                          CSE023
591600200610     C                     END                                            CSE023
591700200610      *                                                                   CSE023
591800200610      ** If CSE008 is ON then use value date position for dividend.       CSE023
591900200610      *                                                                   CSE023
592000200610     C           CSE008    IFEQ 'Y'                                       CSE023
592100200610     C                     MOVE 'V'       @TVBAS                          CSE023
592200200610     C                     ELSE                                           CSE023
592300200610     C                     MOVE 'T'       @TVBAS                          CSE023
592400200610     C                     END                                            CSE023
592500200610     C                     END                                            CSE023
592600200610     C*                                                                   CSE023
592700200610     C                     CALL 'SE2310'                                  CSE023
592800200610     C                     PARM           PPOSET                          CSE023
592900200610     C                     PARM           @TVBAS  1                       CSE023
593000200610     C                     PARM           @DIVDT  50                      CSE023
593100200610     C                     PARM           @NREC   30                      CSE023
593200200610     C                     PARM           @ERR    1                       CSE023
593300200610      *                                                                   CSE023
593400200610     C           @ERR      IFEQ 'N'                                       CSE023
593500200610     C                     ADD  @NREC     W02CNT                          CSE023
593600200610     C                     ELSE                                           CSE023
593700200610     C                     EXSR *PSSR                                     CSE023
593800200610     C                     EXSR AUDIT                                     CSE023
593900200610     C                     MOVE '1'       *INLR                           CSE023
594000200610     C                     ENDIF                                          CSE023
594100200610     C                     ENDIF                                          CSE023
594200200610      *                                                                   S01408
594300200610     C/COPY WNCPYSRC,SE2380CCP1                                           S01408
594400200610      *                                                                   S01408
594500200610     C           BGPFMG    IFEQ 'Y'                                       S01486
594600200610     C           BGN4ST    OREQ 'Y'                                       CPB002
594700200610     C                     Z-ADDPTNLU     TNLU                            S01486
594800200610     C                     END                                            S01486
594900200610     C*
595000200610     C           ENDW02    ENDSR                           ** ENDW02 **
595100200610      *
595200200610      *****************************************************************
595300200610     C/EJECT                                                              S01519
595400200610     C********************************************************************S01519
595500200610     C*                                                                   S01519
595600200610     C*  P04    - SUBROUTINE TO CALCULATE CHARGE/COMMISSION AMOUNTS       S01519
595700200610     C*                                                                   S01519
595800200610     C********************************************************************S01519
595900200610     C           P04       BEGSR                           **   P04  **   S01519
596000200610     C*                                                                   S01519
596100200610     C** Only access file if 'PEVT' is coupon, dividend, or maturity.     S01519
596200200610     C*                                                                   S01519
596300200610     C           PEVT      IFEQ 'CP'                                      S01519
596400200610     C           PEVT      OREQ 'DV'                                      S01519
596500200610     C           PEVT      OREQ 'MT'                                      S01519
596600200610      *                                                                   S01408
596700200610     C/COPY WNCPYSRC,SE2380CCP2                                           S01408
596800200610      *                                                                   S01408
596900200610     C*                                                                   S01519
597000200610     C** Setup key for chaining to default charges table (SEDFTCL2).      S01519
597100200610      ** If *IN40 is On, chain SEDFRGL0 instead.                          CSE026
597200200610     C*                                                                   S01519
597300200610     C           *IN40     IFEQ *ON                                       CSE026
597400200610     C                     MOVELBFPSCG    DCCLGR                          CSE026
597500200610     C                     ELSE                                           CSE026
597600200610     C                     MOVE C1DI      DCCLAS                          S01519
597700200610     C                     ENDIF                                          CSE026
597800200610      *                                                                   CSE026
597900200610     C                     MOVE SITP      DCINVT                          S01519
598000200610     C                     MOVE CSCN      DCCUST                          S01519
598100200610     C*                                                                   S01519
598200200610     C           *IN40     IFEQ *ON                                       CSE026
598300200610     C           DFTKYG    CHAINSEDFGRL0             70                   CSE026
598400200610     C                     ELSE                                           CSE026
598500200610     C           DFTKY1    CHAINSEDFTCL2             70                   S01519
598600200610     C                     ENDIF                                          CSE026
598700200610     C*                                                                   S01519
598800200610     C           *IN70     IFEQ '0'                                       S01519
598900200610     C                     EXSR P05                                       S01519
599000200610     C                     ELSE                                           S01519
599100200610     C*                                                                   S01519
599200200610     C**********           MOVE *ZEROS    DCCUST                                       S01519 CSD027
599300200610     C                     MOVE *BLANKS   DCCUST                                              CSD027
599400200610     C           *IN40     IFEQ *ON                                       CSE026
599500200610     C           DFTKYG    CHAINSEDFGRL0             70                   CSE026
599600200610     C                     ELSE                                           CSE026
599700200610     C           DFTKY1    CHAINSEDFTCL2             70                   S01519
599800200610     C                     ENDIF                                          CSE026
599900200610     C*                                                                   S01519
600000200610     C           *IN70     IFEQ '0'                                       S01519
600100200610     C                     EXSR P05                                       S01519
600200200610     C                     ELSE                                           S01519
600300200610     C*                                                                   S01519
600400200610     C                     MOVE *BLANKS   DCINVT                          S01519
600500200610     C           *IN40     IFEQ *ON                                       CSE026
600600200610     C           DFTKYG    CHAINSEDFGRL0             70                   CSE026
600700200610     C                     ELSE                                           CSE026
600800200610     C           DFTKY1    CHAINSEDFTCL2             70                   S01519
600900200610     C                     ENDIF                                          CSE026
601000200610      *                                                                   CSE026
601100200610     C           *IN70     IFEQ '0'                                       S01519
601200200610     C                     EXSR P05                                       S01519
601300200610     C                     ELSE                                           S01519
601400200610     C*                                                                   S01519
601500200610     C** If no records found zeroize default charge/commission            S01519
601600200610     C** amount fields.                                                   S01519
601700200610     C*                                                                   S01519
601800200610     C                     MOVE *ZEROS    PCHA                            S01519
601900200610     C                     MOVE *ZEROS    PCAM                            S01519
602000200610     C/COPY WNCPYSRC,SE2380C025
602100200610     C                     END                                            S01519
602200200610     C*                                                                   S01519
602300200610     C                     END                                            S01519
602400200610     C                     END                                            S01519
602500200610      *                                                                   S01408
602600200610     C/COPY WNCPYSRC,SE2380CCP3                                           S01408
602700200610      *                                                                   S01408
602800200610     C                     END                                            S01519
602900200610     C*                                                                   S01519
603000200610     C           ENDP04    ENDSR                           ** ENDP04 **   S01519
603100200610     C*                                                                   S01519
603200200610     C********************************************************************S01519
603300200610     C/EJECT                                                              S01519
603400200610     C/COPY WNCPYSRC,SE2380C026
603500200610     C********************************************************************S01519
603600200610     C*                                                                   S01519
603700200610     C*  P05    - SUBROUTINE TO CALCULATE DEFAULT AMOUNTS                 S01519
603800200610     C*                                                                   S01519
603900200610     C********************************************************************S01519
604000200610     C           P05       BEGSR                           **   P05  **   S01519
604100200610     C/COPY WNCPYSRC,SE2380C039
604200200610     C*                                                                   S01519
604300200610     C                     SELEC                                          S01519
604400200610     C*                                                                   S01519
604500200610     C** Event type if equal to coupon.                                   S01519
604600200610     C*                                                                   S01519
604700200610     C           PEVT      WHEQ 'CP'                                      S01519
604800200610     C*                                                                   S01519
604900200610     C** Update commissions amount.                                       S01519
605000200610     C*                                                                   S01519
605100200610     C           DCCPCM    IFEQ *BLANKS                                   S01519
605200200610     C                     Z-ADD*ZEROS    PCAM                            S01519
605300200610     C                     ELSE                                           S01519
605400200610     C                     MOVE DCCPCM    @CAM                            S01519
605500200610     C                     EXSR CALAMT                                    S01519
605600200610     C                     Z-ADDZCHGA     PCAM                            S01519
605700200610     C                     END                                            S01519
605800200610     C                     MOVE DCCPCM    PCCD                            S01519
605900200610     C*                                                                   S01519
606000200610     C** Update charge amount.                                            S01519
606100200610     C*                                                                   S01519
606200200610     C           DCCPCC    IFEQ *BLANKS                                   S01519
606300200610     C                     Z-ADD*ZEROS    PCHA                            S01519
606400200610     C                     ELSE                                           S01519
606500200610     C                     MOVE DCCPCC    @CAM                            S01519
606600200610     C                     EXSR CALAMT                                    S01519
606700200610     C                     Z-ADDZCHGA     PCHA                            S01519
606800200610     C                     END                                            S01519
606900200610     C                     MOVE DCCPCC    PCHC                            S01519
607000200610     C/COPY WNCPYSRC,SE2380C040
607100200610     C*                                                                   S01519
607200200610     C** Event type if equal to dividend                                  S01519
607300200610     C*                                                                   S01519
607400200610     C           PEVT      WHEQ 'DV'                                      S01519
607500200610     C*                                                                   S01519
607600200610     C** Update commissions amount.                                       S01519
607700200610     C*                                                                   S01519
607800200610     C           DCDVCM    IFEQ *BLANKS                                   S01519
607900200610     C                     Z-ADD*ZEROS    PCAM                            S01519
608000200610     C                     ELSE                                           S01519
608100200610     C                     MOVE DCDVCM    @CAM                            S01519
608200200610     C                     EXSR CALAMT                                    S01519
608300200610     C                     Z-ADDZCHGA     PCAM                            S01519
608400200610     C                     END                                            S01519
608500200610     C                     MOVE DCDVCM    PCCD                            S01519
608600200610     C*                                                                   S01519
608700200610     C** Update charge amount.                                            S01519
608800200610     C*                                                                   S01519
608900200610     C           DCDVCC    IFEQ *BLANKS                                   S01519
609000200610     C                     Z-ADD*ZEROS    PCHA                            S01519
609100200610     C                     ELSE                                           S01519
609200200610     C                     MOVE DCDVCC    @CAM                            S01519
609300200610     C                     EXSR CALAMT                                    S01519
609400200610     C                     Z-ADDZCHGA     PCHA                            S01519
609500200610     C                     END                                            S01519
609600200610     C                     MOVE DCDVCC    PCHC                            S01519
609700200610     C/COPY WNCPYSRC,SE2380C041
609800200610     C*                                                                   S01519
609900200610     C** Event type if equal to maturity.                                 S01519
610000200610     C*                                                                   S01519
610100200610     C           PEVT      WHEQ 'MT'                                      S01519
610200200610     C*                                                                   S01519
610300200610     C** Update commissions amount.                                       S01519
610400200610     C*                                                                   S01519
610500200610     C           DCMTCM    IFEQ *BLANKS                                   S01519
610600200610     C                     Z-ADD*ZEROS    PCAM                            S01519
610700200610     C                     ELSE                                           S01519
610800200610     C                     MOVE DCMTCM    @CAM                            S01519
610900200610     C                     EXSR CALAMT                                    S01519
611000200610     C                     Z-ADDZCHGA     PCAM                            S01519
611100200610     C                     END                                            S01519
611200200610     C                     MOVE DCMTCM    PCCD                            S01519
611300200610     C*                                                                   S01519
611400200610     C* Update charge amount.                                             S01519
611500200610     C*                                                                   S01519
611600200610     C           DCMTCC    IFEQ *BLANKS                                   S01519
611700200610     C                     Z-ADD*ZEROS    PCHA                            S01519
611800200610     C                     ELSE                                           S01519
611900200610     C                     MOVE DCMTCC    @CAM                            S01519
612000200610     C                     EXSR CALAMT                                    S01519
612100200610     C                     Z-ADDZCHGA     PCHA                            S01519
612200200610     C                     END                                            S01519
612300200610     C                     MOVE DCMTCC    PCHC                            S01519
612400200610     C/COPY WNCPYSRC,SE2380C042
612500200610     C*                                                                   S01519
612600200610     C                     ENDSL                                          S01519
612700200610     C*                                                                   S01519
612800200610     C           ENDP05    ENDSR                           ** ENDP05 **   S01519
612900200610     C*                                                                   S01519
613000200610     C********************************************************************S01519
613100200610     C/EJECT                                                              S01519
613200200610     C********************************************************************S01519
613300200610     C*                                                                   S01519
613400200610     C*  P06    - SUBROUTINE TO CALCULATE SETTLEMENT AMOUNTS              S01519
613500200610     C*                                                                   S01519
613600200610     C********************************************************************S01519
613700200610     C           P06       BEGSR                           **   P06  **   S01519
613800200610     C***********                                                  S01519 087178
613900200610     C***Initialis**calculation*workfield**************************S01519 087178
614000200610     C***********                                                  S01519 087178
614100200610     C***********          Z-ADD*ZEROS    WKCALC 140               S01519 087178
614200200610     C***********                                                  S01519 087178
614300200610     C***********C1DI      IFEQ 'S'                                S01519 087178
614400200610     C***********PPRE      ANDEQ'R'                                S01519 087178
614500200610     C***********C1DI      OREQ 'D'                                S01519 087178
614600200610     C***********PPRE      ANDEQ'R'                                S01519 087178
614700200610     C***********PPRE      OREQ 'P'                                S01519 087178
614800200610     C***********C1DI      ANDNE'D'                                S01519 087178
614900200610     C***********C1DI      ANDNE'S'                                S01519 087178
615000200610     C***********                                                  S01519 087178
615100200610     C***Calculate*and*update*settlement*amount********************S01519 087178
615200200610     C***********                                                  S01519 087178
615300200610     C***********PAMD      ADD  PCHA      WKCALC                   S01519 087178
615400200610     C***********WKCALC    ADD  PCAM      WKCALC                   S01519 087178
615500200610     C***********          Z-ADDWKCALC    PSAT                     S01519 087178
615600200610     C***********                                                  S01519 087178
615700200610     C***********          ELSE                                    S01519 087178
615800200610     C***********                                                  S01519 087178
615900200610     C***********C1DI      IFEQ 'S'                                S01519 087178
616000200610     C***********PPRE      ANDEQ'P'                                S01519 087178
616100200610     C***********C1DI      OREQ 'D'                                S01519 087178
616200200610     C***********PPRE      ANDEQ'P'                                S01519 087178
616300200610     C***********PPRE      OREQ 'R'                                S01519 087178
616400200610     C***********C1DI      ANDNE'D'                                S01519 087178
616500200610     C***********C1DI      ANDNE'S'                                S01519 087178
616600200610     C***********                                                  S01519 087178
616700200610     C***Calculate*and*update*settlement*amount.*******************S01519 087178
616800200610     C***********                                                  S01519 087178
616900200610     C***********PAMD      SUB  PCHA      WKCALC                   S01519 087178
617000200610     C***********WKCALC    SUB  PCAM      WKCALC                   S01519 087178
617100200610     C***********          Z-ADDWKCALC    PSAT                     S01519 087178
617200200610     C***********                                                  S01519 087178
617300200610     C***********          ELSE                                    S01519 087178
617400200610     C***********          Z-ADDPAMD      PSAT                     S01519 087178
617500200610     C***********          END                                     S01519 087178
617600200610     C***********                                                  S01519 087178
617700200610     C***********          END                                     S01519 087178
617800200610     C*                                                                   087178
617900200610     C** Set up parameter for call to SEZ010                              087178
618000200610     C*                                                                   087178
618100200610     C                     MOVELC1DI      P@CLAS                          087178
618200200610     C                     MOVELPPRE      P@PPRE                          087178
618300200610     C                     Z-ADDPAMD      P@PAMD                          087178
618400200610     C                     Z-ADDPCHA      P@PCHA                          087178
618500200610     C                     Z-ADDPCAM      P@PCAM                          087178
618600200610     C                     Z-ADDTASO      P@TASO                          087178
618700200610     C                     Z-ADDTAUS      P@TAUS                          087178
618800200610     C                     Z-ADDPSXR      P@PSXR                          087178
618900200610      ***Override*coupon*rate                                                   AR1001183 AR1001183A
619000200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
619100200610     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
619200200610     C**********           Z-ADDWPSXR     P@PSXR                                AR1001183 AR1001183A
619300200610     C**********           ENDIF                                                AR1001183 AR1001183A
619400200610     C**********           MOVE 'N'       WRCHG                                 AR1001183 AR1001183A
619500200610     C                     MOVELPMDI      P@PMDI                          087178
619600200610     C                     MOVELPNCY      P@PNCY                          087178
619700200610     C                     MOVELPSCU      P@PSCU                          087178
619800200610     C                     MOVELWSTAXA    P@STAM                                            AR875302
619900200610     C/COPY WNCPYSRC,SE2380C027
620000200610     C*                                                                   CAC002
620100200610     C                     MOVE 'TP'      P@TDTP                          CAC002
620200200610     C                     Z-ADD0         P@FXMR                          CAC002
620300200610     C                     Z-ADD0         P@MAMT                          CAC002
620400200610     C*                                                                   087178
620500200610     C** Call SEZ010 to calculate the settlement amount in settle ccy     087178
620600200610     C*                                                                   087178
620700200610     C                     CALL 'SEZ010'                                  087178
620800200610     C                     PARM *BLANKS   P@RCDE  7                       087178
620900200610     C                     PARM           P@DATA                          087178
621000200610     C           P@RCDE    IFEQ *BLANKS                                   087178
621100200610     C                     Z-ADDP@PSAT    PSAT                            087178
621200200610     C                     ELSE                                           087178
621300200610     C                     EXSR *PSSR                                     087178
621400200610     C                     EXSR AUDIT                                     087178
621500200610     C                     MOVE '1'       *INLR                           087178
621600200610     C                     ENDIF                                          087178
621700200610     C*                                                                   S01519
621800200610     C           ENDP06    ENDSR                           ** ENDP06 **   S01519
621900200610     C*                                                                   S01519
622000200610     C*****************************************************************   S01519
622100200610     C/EJECT                                                              S01519
622200200610     C*****************************************************************   S01519
622300200610     C*                                                               *   S01519
622400200610     C*  CALAMT - SUBROUTINE TO DETERMINE IF AMOUNTS NEED TO BE       *   S01519
622500200610     C*           DEFAULTED FOR CHARGES                               *   S01519
622600200610     C*                                                               *   S01519
622700200610     C*****************************************************************   S01519
622800200610     C*                                                                   S01519
622900200610     C           CALAMT    BEGSR                                          S01519
623000200610     C*                                                                   S01519
623100200610     C** Charges to be displayed in nominal currency whether the          S01519
623200200610     C** security is single, dual or multi currency (ref amend to FS)     S01519
623300200610     C*                                                                   S01519
623400200610     C                     MOVE PNCY      @CCY    3                       S01519
623500200610     C           @CCOD     CHAINSECGT                21                   S01519
623600200610     C*                                                                   S01519
623700200610     C** If no live record found, field defaults to blank                 S01519
623800200610     C*                                                                   S01519
623900200610     C           *IN21     IFEQ '1'                                       S01519
624000200610     C           RECI      ORNE 'D'                                       S01519
624100200610     C                     Z-ADD*ZEROS    ZCHGA                           S01519
624200200610     C                     END                                            S01519
624300200610     C*                                                                   S01519
624400200610     C           *IN21     IFEQ '0'                                       S01519
624500200610     C           RECI      ANDEQ'D'                                       S01519
624600200610     C*                                                                   S01519
624700200610     C** If trade type is purchase and levy on sale or trade type is      S01519
624800200610     C** sale and levy on purchase field is blank, otherwise calculate    S01519
624900200610     C** amount                                                           S01519
625000200610     C*                                                                   S01519
625100200610     C           LPSI      IFEQ 'S'                                       S01519
625200200610     C           LPSI      OREQ 'P'                                       S01519
625300200610     C                     Z-ADD*ZEROS    ZCHGA                           S01519
625400200610     C                     ELSE                                           S01519
625500200610     C                     EXSR CALAM2                                    S01519
625600200610     C                     END                                            S01519
625700200610     C*                                                                   S01519
625800200610     C                     END                                            S01519
625900200610     C*                                                                   S01519
626000200610     C                     ENDSR                                          S01519
626100200610     C*                                                                   S01519
626200200610     C*****************************************************************   S01519
626300200610     C/EJECT                                                              S01519
626400200610     C*****************************************************************   S01519
626500200610     C*                                                               *   S01519
626600200610     C*  CALAM2 - SUBROUTINE TO CALCULATE CHARGE AMOUNTS              *   S01519
626700200610     C*                                                               *   S01519
626800200610     C*****************************************************************   S01519
626900200610     C*                                                                   S01519
627000200610     C           CALAM2    BEGSR                                          S01519
627100200610     C*                                                                   S01519
627200200610     C** Charge details                                                   S01519
627300200610     C*                                                                   S01519
627400200610     C                     MOVE CHGB      ZCHGB                           S01519
627500200610     C                     MOVE THRI      ZTHRI                           S01519
627600200610     C                     Z-ADDMNCH      ZMNCH                           S01519
627700200610     C                     Z-ADDMXCH      ZMXCH                           S01519
627800200610     C*                                                                   S01519
627900200610     C** Set up array for upper range limits                              S01519
628000200610     C*                                                                   S01519
628100200610     C                     Z-ADDSTU1      ZRA,1                           S01519
628200200610     C                     Z-ADDSTU2      ZRA,2                           S01519
628300200610     C                     Z-ADDSTU3      ZRA,3                           S01519
628400200610     C                     Z-ADDSTU4      ZRA,4                           S01519
628500200610     C                     Z-ADDSTU5      ZRA,5                           S01519
628600200610     C                     Z-ADDSTU6      ZRA,6                           S01519
628700200610     C                     Z-ADDSTU7      ZRA,7                           S01519
628800200610     C                     Z-ADDSTU8      ZRA,8                           S01519
628900200610     C                     Z-ADDSTU9      ZRA,9                           S01519
629000200610     C                     Z-ADDST10      ZRA,10                          S01519
629100200610     C                     Z-ADDST11      ZRA,11                          S01519
629200200610     C                     Z-ADDST12      ZRA,12                          S01519
629300200610     C                     Z-ADDST13      ZRA,13                          S01519
629400200610     C                     Z-ADDST14      ZRA,14                          S01519
629500200610     C*                                                                   S01519
629600200610     C** Set up array for percentage levels                               S01519
629700200610     C*                                                                   S01519
629800200610     C                     Z-ADDPL01      ZPC,1                           S01519
629900200610     C                     Z-ADDPL02      ZPC,2                           S01519
630000200610     C                     Z-ADDPL03      ZPC,3                           S01519
630100200610     C                     Z-ADDPL04      ZPC,4                           S01519
630200200610     C                     Z-ADDPL05      ZPC,5                           S01519
630300200610     C                     Z-ADDPL06      ZPC,6                           S01519
630400200610     C                     Z-ADDPL07      ZPC,7                           S01519
630500200610     C                     Z-ADDPL08      ZPC,8                           S01519
630600200610     C                     Z-ADDPL09      ZPC,9                           S01519
630700200610     C                     Z-ADDPL10      ZPC,10                          S01519
630800200610     C                     Z-ADDPL11      ZPC,11                          S01519
630900200610     C                     Z-ADDPL12      ZPC,12                          S01519
631000200610     C                     Z-ADDPL13      ZPC,13                          S01519
631100200610     C                     Z-ADDPL14      ZPC,14                          S01519
631200200610     C                     Z-ADDPL15      ZPC,15                          S01519
631300200610     C*                                                                   S01519
631400200610     C** Set up array for flat charges                                    S01519
631500200610     C*                                                                   S01519
631600200610     C                     Z-ADDFC01      ZCG,1                           S01519
631700200610     C                     Z-ADDFC02      ZCG,2                           S01519
631800200610     C                     Z-ADDFC03      ZCG,3                           S01519
631900200610     C                     Z-ADDFC04      ZCG,4                           S01519
632000200610     C                     Z-ADDFC05      ZCG,5                           S01519
632100200610     C                     Z-ADDFC06      ZCG,6                           S01519
632200200610     C                     Z-ADDFC07      ZCG,7                           S01519
632300200610     C                     Z-ADDFC08      ZCG,8                           S01519
632400200610     C                     Z-ADDFC09      ZCG,9                           S01519
632500200610     C                     Z-ADDFC10      ZCG,10                          S01519
632600200610     C                     Z-ADDFC11      ZCG,11                          S01519
632700200610     C                     Z-ADDFC12      ZCG,12                          S01519
632800200610     C                     Z-ADDFC13      ZCG,13                          S01519
632900200610     C                     Z-ADDFC14      ZCG,14                          S01519
633000200610     C                     Z-ADDFC15      ZCG,15                          S01519
633100200610     C*                                                                   S01519
633200200610     C** Get value currency decimal places from TABTG10.                  S01519
633300200610     C*                                                                   S01519
633400200610     C                     MOVE PNCY      WCURR                           S01519
633500200610     C                     EXSR TG10                                      S01519
633600200610     C                     MOVE CDP       ZDECS                           S01519
633700200610     C                     MOVE CDP       ZCDP                            S01519
633800200610     C*                                                                   S01519
633900200610     C** Nominal decimal places                                           S01519
634000200610     C*                                                                   S01519
634100200610     C                     Z-ADDNMDP      ZNMDP                           S01519
634200200610     C*                                                                   S01519
634300200610     C** Use SR/ZAVPR to calculate the price                              S01519
634400200610     C*                                                                   S01519
634500200610     C                     MOVE PNMP      ZNOML                           S01519
634600200610     C                     Z-ADDPAMD      ZAPNC                           S01519
634700200610     C                     EXSR ZAVPR                                     S01519
634800200610     C                     Z-ADDZPRC      ZPRICE                          S01519
634900200610     C*                                                                   S01519
635000200610     C                     Z-ADD1         ZTCFC                           S01519
635100200610     C                     MOVE PROT      ZPROT                           S01519
635200200610     C                     MOVE SPBS      ZSPBS                           S01519
635300200610     C*                                                                   S01446
635400200610     C** For courtage enhancements, convert charge to value currency      S01446
635500200610     C*                                                                   S01446
635600200610     C           S01446    IFEQ 'Y'                                       S01446
635700200610     C*                                                                   S01446
635800200610     C** Purchase interest and total consideration                        S01446
635900200610     C*                                                                   S01446
636000200610     C                     Z-ADD*ZEROS    ZTPI                            S01446
636100200610     C                     Z-ADD*ZEROS    ZTCON                           S01446
636200200610     C*                                                                   S01446
636300200610     C           BVCHRC    IFNE *BLANKS                                   S01446
636400200610     C                     MOVE BVCHRC    ZCCYI                           S01446
636500200610     C                     MOVE PNCY      ZCCYO                           S01446
636600200610     C                     MOVE TRATEX    ZEXCH                           S01446
636700200610     C                     MOVE TMDIX     ZMD                             S01446
636800200610     C                     MOVE TXCDP     ZCDPI                           S01446
636900200610     C                     MOVE ZDECS     ZCDPO                           S01446
637000200610     C*                                                                   S01446
637100200610     C                     ELSE                                           S01446
637200200610     C                     MOVE *BLANKS   ZCCYI                           S01446
637300200610     C                     MOVE *BLANKS   ZCCYO                           S01446
637400200610     C                     MOVE *BLANKS   ZEXCH                           S01446
637500200610     C                     MOVE *BLANKS   ZMD                             S01446
637600200610     C                     MOVE *BLANKS   ZCDPI                           S01446
637700200610     C                     MOVE *BLANKS   ZCDPO                           S01446
637800200610     C                     END                                            S01446
637900200610     C                     END                                            S01446
638000200610     C*                                                                   S01446
638100200610     C** Total nominal                                                    S01446
638200200610     C*                                                                   S01446
638300200610     C                     Z-ADD*ZEROS    ZTNOM  150                      S01446
638400200610     C/COPY WNCPYSRC,SE2380C043
638500200610     C*                                                                   S01519
638600200610     C                     EXSR ZCCAL1                                    S01519
638700200610     C/COPY WNCPYSRC,SE2380C044
638800200610     C*                                                                   S01519
638900200610     C                     ENDSR                                          S01519
639000200610     C*                                                                   S01519
639100200610     C*****************************************************************   S01519
639200200610     C/EJECT                                                              S01486
639300200610     C*****************************************************************   S01486
639400200610     C*                                                               *   S01486
639500200610     C*  P07  DETERMINE SETTLEMENT INFORMATION                        *   S01486
639600200610     C*                                                               *   S01486
639700200610     C*****************************************************************   S01486
639800200610     C*                                                                   S01486
639900200610     C           P07       BEGSR                                          S01486
640000200610     C                     MOVE 'N'       WWPMCS  1                                           206040
640100200610     C*                                                                   S01486
640200200610     C** IF POSITION SETTLEMENT FOR A PORTFOLIO POSITION OBTAIN           S01486
640300200610     C** PORTFOLIO CURRENCY AND CUSTOMER CURRENCY                         S01486
640400200610     C           WPORTP    IFEQ 'Y'                        B1             S01486
640500200610     C                     MOVE *BLANKS   WZACOD 100                      219688
640600200610     C*                                                                   S01486
640700200610     C** IF POSITION SETTLEMENT FOR A DEFINED PORTFOLIO OBTAIN PORTFOLIO  S01486
640800200610     C** CURRENCY                                                         S01486
640900200610     C           GGPTFR    IFNE '9997'                     B2             S01486
641000200610     C                     MOVE GGCNUM    WWCNU1                          S01486
641100200610     C                     MOVE GGPTFR    WWPTF1                          S01486
641200200610     C*                                                                   S01486
641300200610     C           PMPORT    CHAINPMPORTPD             79                   S01486
641400200610     C           *IN79     IFEQ '1'                        B3             S01486
641500200610     C           *LOCK     IN   LDA                                       081239
641600200610     C************         MOVEL'MPORT'   DBFILE           *********S01486081239
641700200610     C                     MOVEL'PMPORTPD'DBFILE           ***************081239
641800200610     C                     MOVELGGCNUM    DBKEY            ** DB ERROR 04 S01486
641900200610     C                     MOVE GGPTFR    DBKEY            ***************S01486
642000200610     C                     Z-ADD40        DBASE                           S01486
642100200610     C                     SETON                       U7U8               081239
642200200610     C                     GOTO EAUDIT                                    S01486
642300200610     C                     END                             E3             S01486
642400200610     C*                                                                   S01486
642500200610     C                     END                             E2             S01486
642600200610     C*                                                                   S01486
642700200610     C** ACCESS PORTFOLIO CUSTOMER DETAILS                                S01486
642800200610     C                     MOVE GGCNUM    WWCNUA  6                       S01486
642900200610     C*                                                                   S01486
643000200610     C                     MOVELWWCNUA    WWCLIN 10                       S01486
643100200610     C                     CALL 'AOPLCSR0'                                S01486
643200200610     C                     PARM *BLANKS   @RTCD                           S01486
643300200610     C                     PARM '*KEY   ' @OPTN                           S01486
643400200610     C                     PARM WWCLIN    WWKY10 10                       S01486
643500200610     C           SDPLCS    PARM SDPLCS    DSSDY                           S01486
643600200610     C           @RTCD     IFNE *BLANKS                                   S01486
643700200610     C           BGN4ST    IFNE 'Y'                                                           206040
643800200610     C           *LOCK     IN   LDA                                       S01486
643900200610     C***********          MOVEL'DPLCS'   DBFILE           *********S01486081239
644000200610     C                     MOVEL'SDPLCSPD'DBFILE           ***************081239
644100200610     C                     MOVELWWCNUA    DBKEY            ** DB ERROR 04 S01486
644200200610     C                     Z-ADD41        DBASE            ***************S01486
644300200610     C                     SETON                       U7U8               S01486
644400200610     C                     EXSR *PSSR                                     S01486
644500200610     C                     GOTO EAUDIT                                    S01486
644600200610     C                     ENDIF                                                              206040
644700200610     C                     ELSE                                                               206040
644800200610     C                     MOVE 'Y'       WWPMCS                                              206040
644900200610     C                     END                             E2             S01486
645000200610      *                                                                   219688
645100200610     C                     MOVE BFACCD    WZACOD                          219688
645200200610      *                                                                   219688
645300200610     C*                                                                   S01486
645400200610     C** ... OTHERWISE POSITION SETTLEMENT FOR A NON-PORTFOLIO CUSTOMER   S01486
645500200610     C** HENCE ACCES SDSECSL0 FOR SECURITY CUSTOMER BASE CURRENCY         S01486
645600200610     C                     ELSE                            X1             S01486
645700200610     C*                                                                   S01486
645800200610     C                     MOVE CSCN      WWCNUA  6                       S01486
645900200610     C*                                                                   S01486
646000200610     C                     MOVELWWCNUA    @CUST  10                       S01486
646100200610     C                     CALL 'AOSECSR0'                                S01486
646200200610     C                     PARM *BLANKS   @RTCD                           S01486
646300200610     C                     PARM '*KEY   ' @OPTN                           S01486
646400200610     C                     PARM           @CUST                           S01486
646500200610     C           SECSPD    PARM SECSPD    DSSDY                           S01486
646600200610      *                                                                   S01486
646700200610     C           @RTCD     IFNE *BLANKS                    *B3            S01486
646800200610     C           *LOCK     IN   LDA                                       S01486
646900200610     C                     MOVEL'SDSECSL0'DBFILE           ***************S01486
647000200610     C                     MOVEL@CUST     DBKEY            ** DB ERROR 04 S01486
647100200610     C                     Z-ADD42        DBASE            ***************S01486
647200200610     C                     SETON                       U7U8               S01486
647300200610     C                     EXSR *PSSR                                     S01486
647400200610     C                     GOTO EAUDIT                                    S01486
647500200610     C                     END                             E2             S01486
647600200610     C                     END                             E1             S01486
647700200610     C*                                                                   S01486
647800200610     C** USE FIRST ACCOUNT IN FOUND FOR CUSTOMER / PORTFOLIO AS           S01486
647900200610     C** APPROPRIATE IN VALUE, PORTFOLIO OR CUSTOMER CURRENCY VIA P08     S01486
648000200610     C           WPORTP    IFEQ 'Y'                        B1             S01486
648100200610     C**********           Z-ADDGGCNUM    WZCNUM  60                                   S01486 CSD027
648200200610     C                     MOVE GGCNUM    WZCNUM  6                                           CSD027
648300200610     C                     MOVE GGPTFR    WZPTFR  4                       S01486
648400200610     C                     MOVE PNCY      WWCCY1  3                       S01486
648500200610     C           WWPMCS    IFEQ 'Y'                                                           206040
648600200610     C                     MOVE QBCSBY    WWCCY3  3                       S01486
648700200610     C                     ELSE                                                               206040
648800200610     C                     MOVE PNCY      WWCCY3                                              206040
648900200610     C                     ENDIF                                                              206040
649000200610     C*                                                                   S01486
649100200610     C           GGPTFR    IFNE '9997'                     B2             S01486
649200200610     C                     MOVE PNPTCY    WWCCY2  3                       S01486
649300200610     C                     ELSE                            X2             S01486
649400200610     C           WWPMCS    IFEQ 'Y'                                                           206040
649500200610     C                     MOVE QBCSBY    WWCCY2  3                       S01486
649600200610     C                     ELSE                                                               206040
649700200610     C                     MOVE PNPTCY    WWCCY2                                              206040
649800200610     C                     ENDIF                                                              206040
649900200610     C                     END                             E2             S01486
650000200610     C*                                                                   S01486
650100200610     C                     ELSE                            X1             S01486
650200200610     C**********           Z-ADDCSCN      WZCNUM  60                                   S01486 CSD027
650300200610     C                     MOVE CSCN      WZCNUM  6                                           CSD027
650400200610     C                     MOVE *BLANKS   WZPTFR  4                       S01486
650500200610     C                     MOVE PNCY      WWCCY1  3                       S01486
650600200610     C                     MOVE BFPCYC    WWCCY2  3                       S01486
650700200610     C                     MOVE BFPCYC    WWCCY3  3                       S01486
650800200610     C                     END                             E1             S01486
650900200610     C*                                                                   S01486
651000200610     C** CHECK WHETHER ACCOUNT EXISTS IN VALUE CURRENCY                   S01486
651100200610     C                     MOVE WWCCY1    WZCCY   3                       S01486
651200200610     C                     EXSR P08                                       S01486
651300200610     C*                                                                   S01486
651400200610     C** IF NO ACCOUNT FOUND SEARCH FOR ACCOUNT IN PORTFOLIO CCY          S01486
651500200610     C           WZFOND    IFEQ 'N'                        B1             S01486
651600200610     C                     MOVE WWCCY2    WZCCY   3                       S01486
651700200610     C                     EXSR P08                                       S01486
651800200610     C                     END                             E1             S01486
651900200610     C*                                                                   S01486
652000200610     C** IF NO ACCOUNT FOUND SEARCH FOR ACCOUNT IN CUSTOMER CCY           S01486
652100200610     C           WZFOND    IFEQ 'N'                        B1             S01486
652200200610     C                     MOVE WWCCY3    WZCCY   3                       S01486
652300200610     C                     EXSR P08                                       S01486
652400200610     C                     END                             E1             S01486
652500200610     C*                                                                   S01486
652600200610     C** IF A SETTLEMENT ACCOUNT HAS BEEN FOUND OUTPUT SETTLEMENT         S01486
652700200610     C** DETAILS                                                          S01486
652800200610     C           WZFOND    IFEQ 'Y'                        B1             S01486
652900200610     C                     MOVE WZCCY     PSCU                            S01486
653000200610     C*                                                                   S01486
653100200610     C                     MOVE '05'      PSMT                            S01486
653200200610     C                     MOVE WZSETA    PSEA                            S01486
653300200610     C                     MOVE WZBRCD    PSEB                            S01486
653400200610     C                     ELSE                            X1             S01486
653500200610     C                     MOVE PNCY      PSCU                            S01486
653600200610     C                     MOVE *BLANKS   PSEA                            S01486
653700200610     C                     MOVE *BLANKS   PSMT                            S01486
653800200610     C                     MOVE *BLANKS   PSEB                            S01486
653900200610     C                     END                             E1             S01486
654000200610     C*                                                                   S01486
654100200610     C*  BASE CURR EXCHANGE RATE IS SPOT RATE FOR SETTLEMENT CURRCY       S01486
654200200610     C*                                                                   S01486
654300200610     C                     MOVE PSCU      WCURR                           S01486
654400200610     C                     EXSR TG10                                      S01486
654500200610     C                     Z-ADDSPOT      PBRX                            S01486
654600200610     C                     Z-ADD1         ZAMTF                           S01486
654700200610     C                     MOVE PNCY      ZCCYF                           S01486
654800200610     C                     MOVE PSCU      ZCCYT                           S01486
654900200610     C*                                                                   S01486
655000200610     C                     ENDSR                                          S01486
655100200610     C********************************************************************S01486
655200200610     C/EJECT                                                              S01486
655300200610     C*****************************************************************   S01486
655400200610     C*                                                               *   S01486
655500200610     C*  P08  DETERMINE SETTLEMENT ACCOUNT                            *   S01486
655600200610     C*                                                               *   S01486
655700200610     C*****************************************************************   S01486
655800200610     C*                                                                   S01486
655900200610     C           P08       BEGSR                                          S01486
656000200610     C*                                                                   S01486
656100200610     C                     MOVE 'N'       WZFOND  1                       S01486
656200200610     C                     Z-ADD0         WZACSQ                          S01486
656300200610     C*                                                                   S01486
656400200610     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
656500200610     C           ACCNTL    SETLLPMACCNL1                                  219688
656600200610     C                     READ PMACCNL1                 83               219688
656700200610     C           *IN83     IFEQ '0'                                       219688
656800200610     C           CNUM      ANDEQWZCNUM                                    219688
656900200610     C           CCY       ANDEQWZCCY                                     219688
657000200610     C           ACOD      ANDEQWZACOD                                    219688
657100200610     C           L1PTFR    ANDEQWZPTFR                                    219688
657200200610     C                     MOVE 'Y'       WZFOND                          219688
657300200610     C                     MOVELBRCA      WZBRCD                          219688
657400200610     C                     MOVELCNUM      WRK16                           219688
657500200610     C                     MOVE ACOD      WRK16                           219688
657600200610     C                     MOVELWRK16     WZSETA                          219688
657700200610     C                     MOVE ACSQ      WZSETA                          219688
657800200610     C                     ELSE                                           219688
657900200610     C*                                                                   219688
658000200610     C** READ FIRST RECORD FOR ACCOUNT                                    S01486
658100200610     C           ACCNTP    SETLLPMACCNL0                                  S01486
658200200610     C                     READ PMACCNL0                 79               S01486
658300200610     C*                                                                   S01486
658400200610     C** IF DETAILS READ FOR SAME CUSTOMER CURRENCY AND PORTFOLIO         S01486
658500200610     C** SET UP OUTPUT DETAILS                                            S01486
658600200610     C           *IN79     IFEQ '0'                                       S01486
658700200610     C           CNUM      ANDEQWZCNUM                                    S01486
658800200610     C           CCY       ANDEQWZCCY                                     S01486
658900200610     C           RNPTFR    ANDEQWZPTFR                                    S01486
659000200610     C                     MOVE 'Y'       WZFOND                          S01486
659100200610     C***********          MOVELBRCA      WZBRCD  30                S01486081239
659200200610     C                     MOVELBRCA      WZBRCD  3                       081239
659300200610     C**********           MOVELCNUM      WRK10  10                                    S01486 CGL029
659400200610     C**********           MOVE ACOD      WRK10                                        S01486 CGL029
659500200610     C**********           MOVELWRK10     WZSETA 12                                    S01486 CGL029
659600200610     C**********           MOVE ACSQ      WZSETA                                       S01486 CGL029
659700200610     C                     MOVELCNUM      WRK16  16                                           CGL029
659800200610     C                     MOVE ACOD      WRK16                                               CGL029
659900200610     C                     MOVELWRK16     WZSETA 18                                           CGL029
660000200610     C                     MOVE ACSQ      WZSETA                                              CGL029
660100200610     C                     ELSE                                                               219566
660200200610     C** ELSE IF system value 'UseDefaultSettAccnt' to Y'then                                 219566
660300200610     C           DEF001    IFEQ 'Y'                                                           219566
660400200610     C**                                                                                      219566
660500200610     C**      RETRIEVE AN ACCOUNT FROM THIS CLIENT                                            219566
660600200610     C                     MOVE *BLANKS   WZPTFR                                              219566
660700200610     C           ACCNTP    SETLLPMACCNL0                                                      219566
660800200610     C                     READ PMACCNL0                 79                                   219566
660900200610     C*                                                                                       219566
661000200610     C** IF DETAILS READ FOR SAME CUSTOMER,CURRENCY                                           219566
661100200610     C** SET UP OUTPUT DETAILS                                                                219566
661200200610     C           *IN79     IFEQ '0'                                                           219566
661300200610     C           CNUM      ANDEQWZCNUM                                                        219566
661400200610     C           CCY       ANDEQWZCCY                                                         219566
661500200610     C                     MOVE 'Y'       WZFOND                                              219566
661600200610     C                     MOVELBRCA      WZBRCD                                              219566
661700200610     C                     MOVELCNUM      WRK16                                               219566
661800200610     C                     MOVE ACOD      WRK16                                               219566
661900200610     C                     MOVELWRK16     WZSETA                                              219566
662000200610     C                     MOVE ACSQ      WZSETA                                              219566
662100200610     C                     END                                                                219566
662200200610      *                                                                                       219566
662300200610     C                     END                             Endif DEF001=Y                     219566
662400200610      *                                                                                       219566
662500200610     C                     END                                            219688
662600200610     C*                                                                   219688
662700200610     C                     END                                            S01486
662800200610     C*                                                                   S01486
662900200610     C                     ENDSR                                          S01486
663000200610     C********************************************************************S01486
663100200610      /EJECT                                                              S01447
663200200610      *****************************************************************   S01447
663300200610      *                                                               *   S01447
663400200610      *  CALCTX - Subroutine to calculate tax amounts for dividends   *   S01447
663500200610      *           and Coupons                                         *   S01447
663600200610      *                                                               *   S01447
663700200610      *  CALLED FROM: W02                                             *   S01447
663800200610      *  CALLS:       NONE                                            *   S01447
663900200610      *                                                               *   S01447
664000200610      *****************************************************************   S01447
664100200610      *                                                                   S01447
664200200610     C           CALCTX    BEGSR                                       ** S01447
664300200610      *                                                                   S01447
664400200610      *** Initialise tax work fields                                      S01447
664500200610      *                                                                   S01447
664600200610     C                     CLEARUTXRSR                                    S01447
664700200610     C                     CLEARUTXRRF                                    S01447
664800200610     C                     CLEARUTXRUS                                    S01447
664900200610     C                     CLEARUDLOR                                     S01447
665000200610      *                                                                   S01447
665100200610      *** If tax band at source is zero, then take rate from security     S01447
665200200610      *** WHT details file; Otherwise access SEcountry tax rate file to   S01447
665300200610      *** get tax rate at source                                          S01447
665400200610      *                                                                   S01447
665500200610     C           S1TABD    IFEQ *ZERO                      *B1            S01447
665600200610     C                     Z-ADDS1RASO    UTXRSR                          S01447
665700200610     C                     ELSE                            *X1            S01447
665800200610      *                                                                   S01447
665900200610     C                     MOVELS1CTTA    UKEY    3                       S01447
666000200610     C                     MOVE S1TABD    UKEY                            S01447
666100200610      *                                                                   S01447
666200200610     C                     CALL 'AOSCTXR0'                                S01447
666300200610     C                     PARM *BLANKS   @RTCD                           S01447
666400200610     C                     PARM '*KEY   ' @OPTN                           S01447
666500200610     C                     PARM S1CTTA    @CTTA   2                       S01447
666600200610     C                     PARM S1TABD    @TABD   10                      S01447
666700200610     C           SECNTR    PARM SECNTR    DSSDY                           S01447
666800200610     C*                                                                   S01447
666900200610     C           @RTCD     IFNE *BLANKS                    *B2            S01447
667000200610     C           TXRECI    ORNE 'D'                                       S01447
667100200610     C           *LOCK     IN   LDA                                       S01447
667200200610     C                     MOVEL'SECNTRL0'DBFILE           ***************S01447
667300200610     C                     MOVELUKEY      DBKEY            ** DBERROR 025 S01447
667400200610     C                     Z-ADD25        DBASE            ***************S01447
667500200610     C                     SETON                       U7U8               S01447
667600200610     C                     EXSR *PSSR                                     S01447
667700200610     C                     GOTO EAUDIT                                    S01447
667800200610     C                     ELSE                            *X2            S01447
667900200610     C                     Z-ADDTXRASO    UTXRSR                          S01447
668000200610     C                     END                             *E2            S01447
668100200610     C                     END                             *E1            S01447
668200200610      *                                                                   S01447
668300200610      *** If tax band by user is not zero, then access country to         S01447
668400200610      *** branch tax rate file to get tax rate by user                    S01447
668500200610      *** Otherwise set to zero.                                          S01447
668600200610      *                                                                   S01447
668700200610     C           S1TABU    IFNE *ZERO                      *B1            S01447
668800200610     C/COPY WNCPYSRC,SE2380C051
668900200610     C                     CALL 'AOCBTXR0'                                S01447
669000200610     C                     PARM *BLANKS   @RTCD                           S01447
669100200610     C                     PARM '*KEY   ' @OPTN                           S01447
669200200610     C                     PARM WBC       @BRCA   3                       S01447
669300200610     C                     PARM S1CTTA    @CTTA                           S01447
669400200610     C                     PARM S1TABU    @TABU   10                      S01447
669500200610     C           SECBTX    PARM SECBTX    DSFDY                           S01447
669600200610     C/COPY WNCPYSRC,SE2380C052
669700200610     C*                                                                   S01447
669800200610     C           @RTCD     IFEQ *BLANKS                    *B2            S01447
669900200610     C           TBRECI    ANDEQ'D'                                       S01447
670000200610     C                     Z-ADDTBRAUS    UTXRUS                          S01447
670100200610     C                     Z-ADDTBRASR    UTXRRF                          S01447
670200200610     C                     MOVE TBDLOR    UDLOR                           S01447
670300200610     C                     END                             *E2            S01447
670400200610     C                     END                             *E1            S01447
670500200610      *                                                                   S01447
670600200610      *** calculate amount deducted at source                             S01447
670700200610      *                                                                   S01447
670800200610     C           S01496    IFEQ 'Y'                                                           248184
670900200610     C           PAMD      MULT UTXRSR    WTASO  204                                          248184
671000200610     C           WTASO     DIV  100       TASO      H                                         248184
671100200610     C                     ELSE                                                               248184
671200200610     C           UTXRSR    DIV  100       URATE   54                      S01447
671300200610     C           PAMD      MULT URATE     TASO      H                     S01447
671400200610     C                     ENDIF                                                              248184
671500200610      *                                                                   S01447
671600200610      *** calculate amount deducted at source - refundable                S01447
671700200610      *                                                                   S01447
671800200610     C           S01496    IFEQ 'Y'                                                           248184
671900200610     C           PAMD      MULT UTXRRF    WTASR  204                                          248184
672000200610     C           WTASR     DIV  100       TASR      H                                         248184
672100200610     C                     ELSE                                                               248184
672200200610     C           UTXRRF    DIV  100       URATE                           S01447
672300200610     C           PAMD      MULT URATE     TASR      H                     S01447
672400200610     C                     ENDIF                                                              248184
672500200610      *                                                                   S01447
672600200610      *** calculate amount deducted by user: ONLY if deduct for local     S01447
672700200610      *** residents is 'Y', or deduct for local residents is 'N' and      S01447
672800200610      *** customer is a foreign resident.                                 S01447
672900200610      *                                                                   S01447
673000200610     C                     CLEARTAUS                                      S01447
673100200610      *                                                                   S01447
673200200610     C           UTXRUS    IFGT *ZERO                      *B1            S01447
673300200610      *                                                                   S01447
673400200610     C           UDLOR     IFNE 'Y'                        *B2            S01447
673500200610     C                     MOVE PCPY      WCUST                           S01447
673600200610     C           CLKYCB    CHAINCLINT                54                   S01447
673700200610     C           *IN54     IFEQ '1'                        *B3            S01447
673800200610     C           RECI      OREQ '*'                                       S01447
673900200610     C           *LOCK     IN   LDA                                       S01447
674000200610     C                     MOVEL'CLINTCB 'DBFILE           ***************S01447
674100200610     C                     MOVELPCPY      DBKEY            ** DBERROR 026 S01447
674200200610     C                     Z-ADD26        DBASE            ***************S01447
674300200610     C                     SETON                       U7U8               S01447
674400200610     C                     EXSR *PSSR                                     S01447
674500200610     C                     GOTO EAUDIT                                    S01447
674600200610     C                     END                             *E3            S01447
674700200610     C                     END                             *E2            S01447
674800200610      *                                                                   S01447
674900200610     C           UDLOR     IFEQ 'Y'                        *B2            S01447
675000200610     C           CLOC      ORNE UBRLOC                                    S01447
675100200610      *                                                                   S01447
675200200610     C           S01496    IFEQ 'Y'                                                           248184
675300200610     C           PAMD      MULT UTXRUS    WTAUS  204                                          248184
675400200610     C           WTAUS     DIV  100       TAUS      H                                         248184
675500200610     C                     ELSE                                                               248184
675600200610      *                                                                                       248184
675700200610     C           UTXRUS    DIV  100       URATE                           S01447
675800200610     C/COPY WNCPYSRC,SE2380C053
675900200610     C           PAMD      MULT URATE     TAUS      H                     S01447
676000200610     C/COPY WNCPYSRC,SE2380C054
676100200610     C                     ENDIF                                                              248184
676200200610     C                     END                             *E2            S01447
676300200610      *                                                                   S01447
676400200610     C                     END                             *E1            S01447
676500200610      *                                                                   S01447
676600200610     C                     ENDSR                                          S01447
676700200610      *                                                                   S01447
676800200610      *****************************************************************   S01447
676900200610      /EJECT                                                              S01117
677000200610      *****************************************************************   S01117
677100200610      *                                                               *   S01117
677200200610      *  SEPCIN - Subroutine to get Customer Position Profit Centre   *   S01117
677300200610      *  Called From - SR SEC                                         *   S01117
677400200610      *  Calls       - *none                                          *   S01117
677500200610      *                                                               *   S01117
677600200610      *                                                               *   S01117
677700200610      *****************************************************************   S01117
677800200610      *                                                                   S01117
677900200610     C           SEPCIN    BEGSR                           ** SEPCIN **   S01117
678000200610     C*                                                                   S01117
678100200610     C** Chain for Customer Position Profit Centre                        S01117
678200200610     C*                                                                   S01117
678300200610     C           KSEPCC    CHAINSEPCCD               79                   S01117
678400200610     C           *IN79     IFNE '1'                                       S01117
678500200610     C           RECI      COMP '*'                      79               S01117
678600200610     C                     END                                            S01117
678700200610     C           *IN79     IFEQ '1'                                       S01117
678800200610     C           *LOCK     IN   LDA                                       S01117
678900200610     C                     MOVEL'SEPCCD'  DBFILE           ***************S01117
679000200610     C                     MOVELKSEPCR    DBKEY            * DB ERROR 23 *
679100200610     C                     SETON                     U7U8  ***************
679200200610     C                     Z-ADD23        DBASE
679300200610     C                     DUMP                                           S01117
679400200610     C                     GOTO EAUDIT
679500200610     C                     END
679600200610      *
679700200610     C                     ENDSR
679800200610      *
679900200610      *                                                                   S01486
680000200610      *****************************************************************   S01486
680100200610     C/EJECT                                                              S01486
680200200610     C********************************************************************S01486
680300200610     C*                                                                   S01486
680400200610     C* WRITPM   - OUTPUT CHANGED POSITION DETAILS TO PF/PMBVALPD         S01486
680500200610     C*                                                                   S01486
680600200610     C********************************************************************S01486
680700200610     C           WRITPM    BEGSR                           ** WRITPM **   S01486
680800200610     C*                                                                   S01486
680900200610     C** IF ACTION READ IN FOR NEW POSITION OR DATE WRITE DETAILS TO      S01486
681000200610     C** PF/PMBVALD AND THEN OBTAIN DETAILS OF PREVIOUS POSITION FOR      S01486
681100200610     C** CURRENT ACTION                                                   S01486
681200200610     C           GGCSBR    IFNE WBCB                       B1             S01486
681300200610     C           GGTDSS    ORNE WSS                                       S01486
681400200610     C           GGCNUM    ORNE WDP                                       S01486
681500200610     C           GGPTFR    ORNE WPTFR                                     S01486
681600200610     C           GGPDAT    ORNE WACTDT                                    S01486
681700200610     C*                                                                   S01486
681800200610     C           GGCSNT    IFNE 0                          B2             S01486
681900200610     C           GGCSNV    ORNE 0                                         S01486
682000200610     C           GGCSEX    ORNE 0                                         S01486
682100200610     C                     WRITEPMBVALD0                                  S01486
682200200610     C                     END                             E2             S01486
682300200610     C*                                                                   S01486
682400200610     C           BVALKY    SETGTPMBVALPD                                  S01486
682500200610     C                     READPPMBVALPD                 79               S01486
682600200610     C*                                                                   S01486
682700200610     C** NO RECORD FOUND FOR PORTFOLIO POSITION IMPLIES THAT THIS IS      S01486
682800200610     C** THE FIRST ACTION READ FOR THE POSITIONAND HENCE THE CHANGED      S01486
682900200610     C** NOMINAL FIELDS SET TO ZERO                                       S01486
683000200610     C           *IN79     IFEQ '1'                        B2             S01486
683100200610     C           GGTDSS    ORNE WSS                                       S01486
683200200610     C           GGCNUM    ORNE WDP                                       S01486
683300200610     C           GGPTFR    ORNE WPTFR                                     S01486
683400200610     C                     Z-ADD0         GGCSNT                          S01486
683500200610     C                     Z-ADD0         GGCSNV                          S01486
683600200610     C                     Z-ADD0         GGCSEX                          S01486
683700200610     C*                                                                   S01486
683800200610     C** ...OTHERWISE USE CHANGE ACCUMULATED FROM PREVIOUS ACTIONS AS     S01486
683900200610     C** STARTING POSITION. SET CHANGE OF POSITION DATE TO DATE OF        S01486
684000200610     C** CURRENT ACTION AND UPDATE PMVALPD                                S01486
684100200610     C                     ELSE                            X2             S01486
684200200610     C                     Z-ADDWACTDT    GGNDAT                          S01486
684300200610     C                     UPDATPMBVALD0                                  S01486
684400200610     C*                                                                   S01486
684500200610     C** CHECK THAT THERE HAS BEEN NO COUPON OR DIVIDEND EVENT BETWEEN    S01486
684600200610     C** LAST POSITION AND CURRENT POSITION                               S01486
684700200610     C*                                                                   S01486
684800200610     C           WSS       IFNE SESN                       B3             S01486
684900200610     C                     MOVE WSS       WCSSC                           S01486
685000200610     C                     EXSR SECTIN                                    S01486
685100200610     C                     END                             E3             S01486
685200200610     C*                                                                   S01486
685300200610     C** CALCULATE LAST COUPON DATE PRIOR TO CURRENT ACTION               S01486
685400200610     C                     Z-ADDWACTDT    ZECD                            S01486
685500200610     C                     EXSR ZLCD                                      S01486
685600200610     C*                                                                   S01486
685700200610     C** IF LAST COUPON DATE *GE TO LAST DATE PROCESSED SET EX COUPON     S01486
685800200610     C** NOMINAL TO ZERO                                                  S01486
685900200610     C           ZZLCD     IFGE GGPDAT                     B3             S01486
686000200610     C                     Z-ADD0         GGCSEX                          S01486
686100200610     C                     END                             E3             S01486
686200200610     C*                                                                   S01486
686300200610     C                     END                             E2             S01486
686400200610     C*                                                                   S01486
686500200610     C                     END                             E1             S01486
686600200610     C*                                                                   S01486
686700200610     C** ADD ACTION NOMINAL TO EXISTING NOMINAL AND EX-COUPON NOMINAL     S01486
686800200610     C** POSITIONS FOR DEPOT MOVEMENTS                                    S01486
686900200610     C           *IN01     IFEQ '1'                        B1             S01486
687000200610     C*                                                                   S01486
687100200610     C** IF A REVERSAL REVERSE THE SIGN OF THE NOMINAL                    S01486
687200200610     C           WREVER    IFEQ 'Y'                        B2             S01486
687300200610     C                     Z-SUBCMNA      CMNA                            S01486
687400200610     C                     END                             E2             S01486
687500200610     C*                                                                   S01486
687600200610     C** CALCULATE NEW TRADE AND VALUE DATE NOMINAL POSITIONS FOR         S01486
687700200610     C** CUSTOMER WALK IN                                                 S01486
687800200610     C           WTYPE     IFEQ 'CI'                       B2             S01486
687900200610     C           WTYPE     OREQ 'WI'                                      S01486
688000200610     C           WDBASE    IFEQ 'T'                        B3             S01486
688100200610     C           WDBASE    OREQ 'A'                                       S01486
688200200610     C                     ADD  CMNA      GGCSNT                          S01486
688300200610     C                     END                             E3             S01486
688400200610     C*                                                                   S01486
688500200610     C           WDBASE    IFEQ 'C'                        B3             S01486
688600200610     C           WDBASE    OREQ 'A'                                       S01486
688700200610     C                     ADD  CMNA      GGCSNV                          S01486
688800200610     C                     END                             E3             S01486
688900200610     C                     END                             E2             S01486
689000200610     C*                                                                   S01486
689100200610     C** CALCULATE NEW TRADE AND VALUE DATE NOMINAL POSITIONS FOR         S01486
689200200610     C** CUSTOMER WALK OUT                                                S01486
689300200610     C           WTYPE     IFEQ 'CO'                       B2             S01486
689400200610     C           WTYPE     OREQ 'WO'                                      S01486
689500200610     C           WDBASE    IFEQ 'T'                        B3             S01486
689600200610     C           WDBASE    OREQ 'A'                                       S01486
689700200610     C                     SUB  CMNA      GGCSNT                          S01486
689800200610     C                     END                             E3             S01486
689900200610     C*                                                                   S01486
690000200610     C           WDBASE    IFEQ 'C'                        B3             S01486
690100200610     C           WDBASE    OREQ 'A'                                       S01486
690200200610     C                     SUB  CMNA      GGCSNV                          S01486
690300200610     C                     END                             E3             S01486
690400200610     C                     END                             E2             S01486
690500200610     C*                                                                   S01486
690600200610     C** IF ACCRUAL INDICATOR IS X IT IS EX-COUPON - UPDATE THIS TOO      S01486
690700200610     C           WREVER    IFEQ 'Y'                        B2             S01486
690800200610     C                     Z-SUBCMNA      CMNA                            S01486
690900200610     C                     END                             E2             S01486
691000200610     C                     END                             E1             S01486
691100200610     C*                                                                   S01486
691200200610     C** ALTER NOMINAL POSITIONS FOR TRADE ACTIONS                        S01486
691300200610     C           *IN03     IFEQ '1'                        B1             S01486
691400200610     C*                                                                   S01486
691500200610     C** IF A REVERSAL REVERSE THE SIGN OF THE NOMINAL                    S01486
691600200610     C           WREVER    IFEQ 'Y'                        B2             S01486
691700200610     C                     Z-SUBNOML      NOML                            S01486
691800200610     C                     END                             E2             S01486
691900200610     C*                                                                   S01486
692000200610     C** ALTER NOMINAL FOR TRADE PURCHASES                                S01486
692100200610     C           WTYPE     IFEQ ' P'                       B2             S01486
692200200610     C           WDBASE    IFEQ 'T'                        B3             S01486
692300200610     C                     SUB  NOML      GGCSNT                          S01486
692400200610     C*                                                                   S01486
692500200610     C** IF A SHARE & ACCRUAL IND. IS X IT IS EX-DIVIDEND.UPDATE THIS TOO S01486
692600200610     C           ACRI      IFEQ 'X'                                       S01486
692700200610     C           PROT      ANDEQ'4'                                       S01486
692800200610     C                     SUB  NOML      GGCSEX                          S01486
692900200610     C                     END                             E4             S01486
693000200610     C                     END                             E3             S01486
693100200610     C*                                                                   S01486
693200200610     C           WDBASE    IFEQ 'V'                        B3             S01486
693300200610     C                     SUB  NOML      GGCSNV                          S01486
693400200610     C*                                                                   S01486
693500200610     C** IF A ACCRUAL INDICATOR IS X IT IS EX-COUPON - UPDATE THIS TOO    S01486
693600200610     C           ACRI      IFEQ 'X'                        B4             S01486
693700200610     C           PROT      ANDNE'4'                                       S01486
693800200610     C                     SUB  NOML      GGCSEX                          S01486
693900200610     C                     END                             E4             S01486
694000200610     C                     END                             E3             S01486
694100200610     C                     END                             E2             S01486
694200200610     C*                                                                   S01486
694300200610     C**  TYPE IS TRADE SALE, DATE BASIS IS T = TRADE                     S01486
694400200610     C           WTYPE     IFEQ ' S'                       B2             S01486
694500200610     C           WDBASE    IFEQ 'T'                        B3             S01486
694600200610     C                     ADD  NOML      GGCSNT                          S01486
694700200610     C*                                                                   S01486
694800200610     C** IF A SHARE & ACCRUAL IND. IS X IT IS EX-DIVIDEND.UPDATE THIS TOO S01486
694900200610     C           ACRI      IFEQ 'X'                                       S01486
695000200610     C           PROT      ANDEQ'4'                                       S01486
695100200610     C                     ADD  NOML      GGCSEX                          S01486
695200200610     C                     END                             E4             S01486
695300200610     C                     END                             E3             S01486
695400200610     C*                                                                   S01486
695500200610     C**  TYPE IS TRADE SALE, DATE BASIS IS V = VALUE                     S01486
695600200610     C           WDBASE    IFEQ 'V'                        B3             S01486
695700200610     C                     ADD  NOML      GGCSNV                          S01486
695800200610     C*                                                                   S01486
695900200610     C** IF ACCRUAL INDICATOR IS X IT IS EX-COUPON - UPDATE THIS TOO      S01486
696000200610     C           ACRI      IFEQ 'X'                        B4             S01486
696100200610     C           PROT      ANDNE'4'                                       S01486
696200200610     C                     ADD  NOML      GGCSEX                          S01486
696300200610     C                     END                             E4             S01486
696400200610     C                     END                             E3             S01486
696500200610     C                     END                             E2             S01486
696600200610     C*                                                                   S01486
696700200610     C** IF A REVERSAL RESET THE SIGN OF THE NOMINAL                      S01486
696800200610     C           WREVER    IFEQ 'Y'                        B2             S01486
696900200610     C                     Z-SUBNOML      NOML                            S01486
697000200610     C                     END                             E2             S01486
697100200610     C                     END                             E1             S01486
697200200610     C*                                                                   S01486
697300200610     C** UPDATE REMAINING FIELDS                                          S01486
697400200610     C**********           Z-ADDWDP       GGCNUM                                       S01486 CSD027
697500200610     C                     MOVE WDP       GGCNUM                                              CSD027
697600200610     C                     MOVE WPTFR     GGPTFR                          S01486
697700200610     C                     MOVE WSS       GGTDSS                          S01486
697800200610     C                     Z-ADDWACTDT    GGPDAT                          S01486
697900200610     C                     MOVE WBC       GGCSBR                          S01486
698000200610     C                     Z-ADDDNWD      GGNDAT                          S01486
698100200610     C*                                                                   S01486
698200200610     C                     ENDSR                                          S01486
698300200610     C*                                                                   S01486
698400200610     C*****************************************************************   S01486
698500200610     C/EJECT                                                              S01486
698600200610     C********************************************************************S01486
698700200610     C*                                                                   S01486
698800200610     C* GENPTF   - GENERATE PORTFOLIO POSITION SETTLEMENTS                S01486
698900200610     C*                                                                   S01486
699000200610     C********************************************************************S01486
699100200610     C           GENPTF    BEGSR                           ** GENPTF **   S01486
699200200610     C*                                                                   S01486
699300200610     C                     MOVE 'Y'       WPORTP  1                       S01486
699400200610     C                     MOVE *LOVAL    WBCB                            S01486
699500200610     C                     MOVE *LOVAL    WSS                             S01486
699600200610     C                     MOVE *LOVAL    WDP                             S01486
699700200610     C                     MOVE *LOVAL    WPTFR                           S01486
699800200610     C                     MOVE *LOVAL    WACTDT                          S01486
699900200610     C           BVALKY    SETLLPMBVALPD                                  S01486
700000200610     C*                                                                   S01486
700100200610     C** READ THROUGH FILE CONTAINING CHANGED PORTFOLIO POSITIONS         S01486
700200200610     C                     READ PMBVALPD                 79               S01486
700300200610     C           *IN79     DOWEQ'0'                        B1             S01486
700400200610     C*                                                                   S01486
700500200610     C** SET POINTER ON DIARY EVENTS BEFORE FIRST EVENT WITH A DATE       S01486
700600200610     C** EQUAL TO THE POSITION DATE FROM PMBVALPD                         S01486
700700200610     C                     MOVE GGTDSS    WSSS                            S01486
700800200610     C                     Z-ADDGGPDAT    STGDAT                          S01486
700900200610     C           SECKEY    SETLLSECEDI                                    S01486
701000200610     C                     READ SECEDI                   76               S01486
701100200610     C*                                                                   S01486
701200200610     C** READ THROUGH DIARY EVENTS UNTIL CHANGE OF SECURITY OR EVENT      S01486
701300200610     C** DATE GREATER THAN DATE OF NEXT POSITION                          S01486
701400200610     C           *IN76     DOWEQ'0'                        B2             S01486
701500200610     C           SDSN      ANDEQGGTDSS                                    S01486
701600200610     C           SDED      ANDLEGGNDAT                                    S01486
701700200610     C*                                                                   S01486
701800200610     C** DETERMINE WHETHER EVENT TO BE PROCESSED. IF EVENT NOT TO BE      S01486
701900200610     C** PROCESSED READ NEXT RECORD FROM LF/SECEDI                        S01486
702000200610     C*                                                                   S01486
702100200610     C** ONLY PROCESS CERTAIN EVENTS                                      S01486
702200200610     C           SDET      IFNE 'DV'                       B3             S01486
702300200610     C           SDET      ANDNE'CP'                                      S01486
702400200610     C           SDET      ANDNE'PP'                                      S01486
702500200610     C           SDET      ANDNE'MA'                                      S01486
702600200610     C           SDET      ANDNE'MP'                                      S01486
702700200610     C                     GOTO ENDSC2                                    S01486
702800200610     C                     END                             E3             S01486
702900200610     C*                                                                   S01486
703000200610     C** MATURITY EVENTS SHOULD ONLY BE PROCESSED WHEN THE POSITION       S01486
703100200610     C** DATE IS *LE MATURITY EVENT DATE AND THE NEXT POSITION DATE IS    S01486
703200200610     C** *GT EVENT DATE                                                   S01486
703300200610     C           SDET      IFEQ 'MA'                       B3             S01486
703400200610     C           GGPDAT    IFLE SDED                       B4             S01486
703500200610     C           GGNDAT    ANDGTSDED                                      S01486
703600200610     C                     GOTO CONT1                                     S01486
703700200610     C                     ELSE                            X4             S01486
703800200610     C                     GOTO ENDSC2                                    S01486
703900200610     C                     END                             E4             S01486
704000200610     C                     END                             E3             S01486
704100200610     C           CONT1     TAG                                            S01486
704200200610     C*                                                                   S01486
704300200610     C** CP, DV, PP AND MP EVENTS SHOULD ONLY BE PROCESSED IF POSITION    S01486
704400200610     C** DATE IS *LT EVENT DATE AND THE NEXT POSITION DATE IS *GE         S01486
704500200610     C** EVENT DATE                                                       S01486
704600200610     C           SDET      IFNE 'MA'                       B3             S01486
704700200610     C           GGPDAT    IFLT SDED                       B4             S01486
704800200610     C           GGNDAT    ANDGESDED                                      S01486
704900200610     C                     GOTO CONT2                                     S01486
705000200610     C                     ELSE                            X4             S01486
705100200610     C                     GOTO ENDSC2                                    S01486
705200200610     C                     END                             E4             S01486
705300200610     C                     END                             E3             S01486
705400200610     C           CONT2     TAG                                            S01486
705500200610     C*                                                                   S01486
705600200610     C** CHECK IF EVENT IS BEING ACTIONED IN THIS RUN                     S01486
705700200610     C                     MOVE GGTDSS    WCSSC                           S01486
705800200610     C                     MOVEL'N'       WRVPOS                                              260331
705900200610      *                                                                                       260331
706000200610     C           SECDKY    CHAINSECACE               77                   S01486
706100200610     C*                                                                   S01486
706200200610     C           *IN77     IFEQ '1'                        B3             S01486
706300200610     C*                                                                   S01486
706400200610     C** IF NON-DIARY EVENT (COUPON OR MATURITY) SET ACTION DATES.ACTION  S01486
706500200610     C** PROCESSED PRIOR TO THIS RUN SO PROGRAM MAY CHECK FOR ADJUSTMENTS S01486
706600200610     C           SDET      IFEQ 'CP'                       B4             S01486
706700200610     C           SDET      OREQ 'MA'                                      S01486
706800200610     C                     Z-ADDSDED      SDAD                            S01486
706900200610     C                     Z-ADDSDED      SDDT                            S01486
707000200610     C                     END                             E4             S01486
707100200610     C*                                                                   S01486
707200200610     C                     ELSE                            X3             S01486
707300200610     C           RECI      IFEQ 'R'                                                           260331
707400200610     C           SAAT      IFEQ 'DV'                                                          260331
707500200610     C           SAAT      OREQ 'MP'                                                          260331
707600200610     C           SAAT      OREQ 'PP'                                                          260331
707700200610     C                     MOVEL'Y'       WRVPOS                                              260331
707800200610     C                     ENDIF                                                              260331
707900200610     C                     ENDIF                                                              260331
708000200610     C*                                                                   S01486
708100200610     C*  LET THIS PROGRAM DO THE PROCESSING NOT PERFORMED IN SE2400       064754
708200200610     C*                                                                   064754
708300200610     C           SDET      IFEQ 'CP'                                      064754
708400200610     C           SDET      OREQ 'MA'                                      064754
708500200610     C                     Z-ADD*ZERO     SDAD                            064754
708600200610     C                     Z-ADD*ZERO     SDDT                            064754
708700200610     C           AKRI      IFNE 'Y'                                       064754
708800200610     C                     Z-ADDSDED      SDAD                            064754
708900200610     C                     END                                            064754
709000200610     C           PSRI      IFNE 'Y'                                       064754
709100200610     C                     Z-ADDSDED      SDDT                            064754
709200200610     C                     END                                            064754
709300200610     C                     ELSE                                           064754
709400200610     C           AKRI      IFEQ 'Y'                                       064754
709500200610     C                     Z-ADD*ZERO     SDAD                            064754
709600200610     C                     END                                            064754
709700200610     C           PSRI      IFEQ 'Y'                                       064754
709800200610     C                     Z-ADD*ZERO     SDDT                            064754
709900200610     C                     END                                            064754
710000200610     C                     END                                            064754
710100200610     C*                                                                   064754
710200200610     C                     END                                            064754
710300200610     C*                                                                   064754
710400200610     C**BEING ACTIONED THIS RUN.SE2400 WILL DO THE POSITION SETT.  S01486 064754
710500200610     C***                  GOTO ENDSC2                             S01486 064754
710600200610     C***                  END                             E3      S01486 064754
710700200610     C*                                                                   S01486
710800200610     C** RECORD SELECTED - IGNORE IF BOTH ACTIONED DATES ARE ZERO         S01486
710900200610     C           SDAD      IFEQ 0                          B3             S01486
711000200610     C           SDDT      ANDEQ0                                         S01486
711100200610     C                     GOTO ENDSC2                                    S01486
711200200610     C                     END                             E3             S01486
711300200610     C*                                                                   S01486
711400200610     C** CALCULATE BALANCES THAT SUBROUTINES BELOW WILL OPERATE UPON      S01486
711500200610     C           SDET      IFEQ 'PP'                       B3             S01486
711600200610     C           SDET      OREQ 'DV'                                      S01486
711700200610     C           GGCSNT    SUB  GGCSEX    WCUMCP 150                      S01486
711800200610     C                     ELSE                            X3             S01486
711900200610     C           GGCSNV    SUB  GGCSEX    WCUMCP 150                      S01486
712000200610     C                     END                             E3             S01486
712100200610     C*                                                                   S01486
712200200610     C** IF EVENT IS A DIVIDEND OR COUPON EVENT RESET EX-COUPON NOMINAL   S01486
712300200610     C           SDET      IFEQ 'PP'                       B3             S01486
712400200610     C           SDET      OREQ 'DV'                                      S01486
712500200610     C                     Z-ADD0         GGCSEX                          S01486
712600200610     C                     END                             E3             S01486
712700200610     C*                                                                   S01486
712800200610     C** IF NOMINAL AMOUNT IS ZERO NO FURTHER PROCESSING FOR POSITION     S01486
712900200610     C           WCUMCP    IFEQ 0                          B3             S01486
713000200610     C                     GOTO ENDSC2                                    S01486
713100200610     C                     END                             E3             S01486
713200200610     C*                                                                   S01486
713300200610     C** OBTAIN SECURITY DETAILS                                          S01486
713400200610     C                     MOVE GGTDSS    WCSSC                           S01486
713500200610     C                     EXSR SECTIN                                    S01486
713600200610     C                     EXSR INVTIN                                    S01486
713700200610     C*                                                                   S01486
713800200610     C** EXECUTE SUBROUTINES DEPENDING ON ACTION TYPE                     S01486
713900200610     C           SDET      CASEQ'DV'      DIVIDN           B3             S01486
714000200610     C           SDET      CASEQ'CP'      COUPON                          S01486
714100200610     C           SDET      CASEQ'MP'      MORTPY                          S01486
714200200610     C           SDET      CASEQ'MA'      MATURE                          S01486
714300200610     C                     END                             E3             S01486
714400200610     C*                                                                   S01486
714500200610     C           SDDT      IFNE 0                          B3             S01486
714600200610     C           SDET      CASEQ'PP'      PARTPY           B4             S01486
714700200610     C                     END                             E4             S01486
714800200610     C                     END                             E3             S01486
714900200610     C*                                                                   S01486
715000200610     C* IF PP,MP,MA ACTIONED (SDDT NOT 0) OR DV,CP ACTIONED               S01486
715100200610     C* INCREMENT COUNT AND TEST WHEN NO MORE -  IF NOT ZERO THEN         S01486
715200200610     C* ADD 1 TO COUNT OF POSITIONS ACTIONED                              S01486
715300200610     C*                                                                   S01486
715400200610     C           SDDT      IFNE 0                          B3             S01486
715500200610     C           SDET      OREQ 'DV'                                      S01486
715600200610     C           SDET      OREQ 'CP'                                      S01486
715700200610     C           SDET      OREQ 'MP'                                      S01486
715800200610     C           SDET      OREQ 'MA'                                      S01486
715900200610     C                     ADD  1         WPCNTI                          S01486
716000200610     C                     END                             E3             S01486
716100200610     C*                                                                   S01486
716200200610     C           ENDSC2    TAG                             **ENDSC1**     S01486
716300200610     C                     READ SECEDI                   76               S01486
716400200610     C                     END                             E2             S01486
716500200610     C*                                                                   S01486
716600200610     C                     READ PMBVALPD                 79               S01486
716700200610     C                     END                             E1             S01486
716800200610     C*                                                                   S01486
716900200610     C                     ENDSR                                          S01486
717000200610      *****************************************************************
717100200610      /EJECT
717200200610      *****************************************************************
717300200610      *                                                               *
717400200610      *  SECTIN - Subroutine to get Security record.                  *
717500200610      *                                                               *
717600200610      *****************************************************************
717700200610      *
717800200610     C           SECTIN    BEGSR                           ** SECTIN **
717900200610     C*
718000200610     C** CHAIN FOR SECURITY RECORD AND DATA BASE ERROR
718100200610     C*
718200200610     C           SECTKY    CHAINSECTY                79
718300200610     C           *IN79     IFNE '1'
718400200610     C***********RECI      COMP '*'                      79               033988
718500200610     C           RECIS     COMP '*'                      79               033988
718600200610     C                     END
718700200610     C           *IN79     IFEQ '1'
718800200610     C           *LOCK     IN   LDA                                       S01117
718900200610     C                     MOVEL'SECTY'   DBFILE           ***************
719000200610     C                     MOVELWCSSC     DBKEY            * DB ERROR 08 *
719100200610     C                     SETON                     U7U8  ***************
719200200610     C                     Z-ADD08        DBASE
719300200610     C                     DUMP                                           S01117
719400200610     C                     GOTO EAUDIT
719500200610     C                     END
719600200610      *                                                                   S01447
719700200610      *** Access security WHT details file                                S01447
719800200610      *                                                                   S01447
719900200610     C           SECTKY    CHAINSESWHTL0             80                   S01447
720000200610      *
720100200610     C                     ENDSR
720200200610      *
720300200610      *****************************************************************
720400200610      /SPACE 3
720500200610      *****************************************************************
720600200610      *                                                               *
720700200610      *  INVTIN - Subroutine to get Investment Type record.           *
720800200610      *                                                               *
720900200610      *****************************************************************
721000200610      *
721100200610     C           INVTIN    BEGSR                           ** INVTIN **
721200200610     C*
721300200610     C** CHAIN FOR INVESTMENT TYPE RECORD AND DATA BASE ERROR
721400200610     C*
721500200610     C           INVTKY    CHAININVTP                79
721600200610     C           *IN79     IFNE '1'
721700200610     C           RECI      COMP '*'                      79
721800200610     C                     END
721900200610     C           *IN79     IFEQ '1'
722000200610     C           *LOCK     IN   LDA                                       S01117
722100200610     C                     MOVEL'INVTP'   DBFILE           ***************
722200200610     C                     MOVELINVKEY    DBKEY            * DB ERROR 09 *
722300200610     C                     SETON                     U7U8  ***************
722400200610     C                     Z-ADD09        DBASE
722500200610     C                     DUMP                                           S01117
722600200610     C                     GOTO EAUDIT
722700200610     C                     END
722800200610      *                                                                                    AR1001183
722900200610      ***Get*next*coupon*rate                                                   AR1001183 AR1001183A
723000200610      *                                                                                    AR1001183
723100200610     C**********           MOVE 'N'       WRCHG   1                             AR1001183 AR1001183A
723200200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
723300200610     C********** PROT      ANDEQ'3'                                             AR1001183 AR1001183A
723400200610     C********** PROT      OREQ '8'                                             AR1001183 AR1001183A
723500200610     C**********           Z-ADDWACTDT    WDAT    50                            AR1001183 AR1001183A
723600200610     C**********           EXSR GETNCR                                          AR1001183 AR1001183A
723700200610     C**********           ENDIF                                                AR1001183 AR1001183A
723800200610      *
723900200610     C                     ENDSR
724000200610      *
724100200610      *****************************************************************
724200200610      /SPACE 3
724300200610      *****************************************************************
724400200610      *                                                               *
724500200610      ***CLNTIN***Subroutine to get CLINTCB Client record.            *   S01447
724600200610      *  CLNTIN - Subroutine to get CLINTSE Client record.            *   S01447
724700200610      *                                                               *
724800200610      *****************************************************************
724900200610      *
725000200610     C           CLNTIN    BEGSR                           ** CLNTIN **
725100200610     C*
725200200610     C           CLINTK    CHAINCLINT                79
725300200610     C           *IN79     IFNE '1'
725400200610     C           RECI      COMP '*'                      79
725500200610     C                     END
725600200610     C           *IN79     IFEQ '1'
725700200610     C           *LOCK     IN   LDA                                       S01117
725800200610     C***********          MOVEL'CLINT'   DBFILE           ***************S01447
725900200610     C                     MOVEL'CLINTSE' DBFILE           ***************S01447
726000200610     C                     MOVELWCLNTK    DBKEY            * DB ERROR 10 *
726100200610     C                     SETON                     U7U8  ***************
726200200610     C                     Z-ADD10        DBASE
726300200610     C                     DUMP                                           S01117
726400200610     C                     GOTO EAUDIT
726500200610     C*
726600200610     C                     END
726700200610     C*
726800200610     C                     ENDSR
726900200610      *
727000200610      *****************************************************************
727100200610      /SPACE 3
727200200610      *****************************************************************
727300200610      *                                                               *
727400200610      ***SECEDI*-*Subroutine*to*get*Security*Diary*Event*record.      *   S01486
727500200610     C* SECEDC   - GET SECURITY EVENT FILE RECORD                         S01486
727600200610      *                                                               *
727700200610      *****************************************************************
727800200610      *
727900200610     C***********SECEDI    BEGSR                           ** SECEDI **   S01486
728000200610     C           SECEDC    BEGSR                           ** SECEDC **   S01486
728100200610     C*
728200200610     C** CHAIN FOR SECURITY EVENT RECORD AND DATA BASE ERROR
728300200610     C*
728400200610     C***********                                                         E20086
728500200610     C***STORE*NOM*CCY*FROM*SECTYD*AS*SEDEVDF*HAS*NMCY*FIELD*TOO********* E20086
728600200610     C***********                                                         E20086
728700200610     C***********          MOVE NMCY      WNMCY   3                       E20086
728800200610     C           SECDKY    CHAINSEDEVDF              7877
728900200610     C           *IN78     IFNE '1'
729000200610     C           RECI      COMP '*'                      78
729100200610     C                     END
729200200610     C           *IN77     IFEQ '1'
729300200610     C           *LOCK     IN   LDA                                       S01117
729400200610     C                     MOVEL'SECED'   DBFILE           ***************
729500200610     C                     MOVELWCSSC     DBKEY            * DB ERROR 11 *
729600200610     C                     Z-ADD11        DBASE            ***************
729700200610     C                     SETON                     U7U8
729800200610     C                     DUMP                                           S01117
729900200610     C                     GOTO EAUDIT
730000200610     C                     END
730100200610     C***********          MOVE WNMCY     NMCY                            E20086
730200200610      *
730300200610     C                     ENDSR
730400200610      *
730500200610      *****************************************************************
730600200610      /SPACE 3
730700200610      *****************************************************************
730800200610      *                                                               *
730900200610      *  TG10   - Subroutine to get Security Currency Decimal Places  *
731000200610      *           from TABTG10.                                       *
731100200610      *                                                               *
731200200610      *****************************************************************
731300200610      *
731400200610     C           TG10      BEGSR                           ** TG10   **
731500200610     C*
731600200610     C** CHAIN FOR CURRENCY RECORD IN TABLE TABTG10
731700200610     C** FIELD WCURR CONTAINS THE CURRENCY WHEN THIS SUBROUTINE EXECUTED
731800200610     C*
731900200610     C* IF WCURR IS EQUAL TO WLSTCY (LAST CCY TO ACCESS TABTG10) IGNORE
732000200610     C*
732100200610     C           WCURR     CABEQWLSTCY    ENDT10
732200200610     C                     MOVE WCURR     WLSTCY  3
732300200610     C*
732400200610     C                     MOVEL'20      'ZTABKY 12
732500200610     C                     MOVE '1'       WRK4    4
732600200610     C                     MOVELWCURR     WRK4
732700200610     C                     MOVE WRK4      ZTABKY
732800200610     C**
732900200610     C           ZTABKY    CHAINTABTG10F             99
733000200610     C*
733100200610     C* ERROR IF NO RECORD FOUND OR IF IT IS DELETED
733200200610     C*
733300200610     C           *IN99     IFEQ '1'
733400200610     C                     SETON                     U7U8
733500200610     C                     ELSE
733600200610     C           RECI      IFEQ '*'
733700200610     C                     SETON                     U7U8
733800200610     C                     END
733900200610     C                     END
734000200610     C           *INU7     IFEQ '1'
734100200610     C           *LOCK     IN   LDA                                       S01117
734200200610     C                     MOVE 'TABLE'   DBFILE           ***************
734300200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 12 *
734400200610     C                     Z-ADD12        DBASE            ***************
734500200610     C                     DUMP                                           S01117
734600200610     C                     GOTO EAUDIT
734700200610     C                     END
734800200610     C*                                                                   S01117
734900200610     C** Set up Parameter for use in SR.ZCNSD                             S01117
735000200610     C*                                                                   S01117
735100200610     C                     Z-ADDCDP       ZCDP                            S01117
735200200610     C*
735300200610     C           ENDT10    ENDSR                           ** ENDT10 **
735400200610     C*
735500200610     C*****************************************************************   S01446
735600200610     C/SPACE 3                                                            S01446
735700200610     C*****************************************************************   S01446
735800200610     C*                                                               *   S01446
735900200610     C*  #LCURR - Subroutine to get currency details from SDCURRPD    *   S01446
736000200610     C*                                                               *   S01446
736100200610     C*****************************************************************   S01446
736200200610     C*                                                                   S01446
736300200610     C           #LCURR    BEGSR                                          S01446
736400200610     C*                                                                   S01446
736500200610     C                     CALL 'AOCURRR0'                                S01446
736600200610     C                     PARM *BLANKS   @RTCD   7                       S01446
736700200610     C                     PARM '*KEY   ' @OPTN   7                       S01446
736800200610     C                     PARM WCURR     @AJCD   3                       S01446
736900200610     C           SDCURR    PARM SDCURR    DSSDY                           S01446
737000200610     C*                                                                   S01446
737100200610     C           @RTCD     IFNE *BLANKS                                   S01446
737200200610     C                     SETON                     U7U899               S01446
737300200610     C           *LOCK     IN   LDA                                       S01446
737400200610     C                     MOVE 'SDCURRPD'DBFILE           ***************S01446
737500200610     C                     MOVELWCURR     DBKEY            * DB ERROR    *S01446
737600200610     C                     Z-ADDWDBAS1    DBASE            ***************S01446
737700200610     C                     DUMP                                           S01446
737800200610     C                     GOTO EAUDIT                                    S01446
737900200610     C                     END                                            S01446
738000200610     C*                                                                   S01446
738100200610     C                     ENDSR                                          S01446
738200200610      *****************************************************************   S01446
738300200610      /EJECT                                                                                AR853119
738400200610      *****************************************************************                     AR853119
738500200610      *                                                               *                     AR853119
738600200610      * SRPOST - Create Position Settlement extension                 *                     AR853119
738700200610      *                                                               *                     AR853119
738800200610      *****************************************************************                     AR853119
738900200610     C           SRPOST    BEGSR                                                            AR853119
739000200610      *                                                                                     AR853119
739100200610     C                     MOVE *BLANK    WSTAX   1                                         AR853119
739200200610     C                     MOVE *BLANK    WZTAX   1                                         AR853119
739300200610     C                     MOVE *ZERO     WSTAXA                                            AR875302
739400200610     C                     MOVE 'N'       P3TAX                                             AR853119
739500200610     C                     Z-ADD0         P3STAF                                            AR853119
739600200610     C                     MOVELBJRDNB    P3CDTE                                            AR853119
739700200610     C                     MOVELPBCA      P3PBCA                                            AR853119
739800200610     C                     MOVELPSSH      P3PSSH                                            AR853119
739900200610     C                     MOVELPCPY      P3PCPY                                            AR853119
740000200610     C                     MOVELPDUD      P3PDUD                                            AR853119
740100200610     C                     MOVELPEVT      P3PEVT                                            AR853119
740200200610      *                                                                                     AR853119
740300200610     C                     CALL 'AOBRCHR2'                                                  AR853119
740400200610     C                     PARM *BLANKS   @RTCD                                             AR853119
740500200610     C                     PARM '*KEY   ' @OPTN                                             AR853119
740600200610     C                     PARM PBCA      @DSNB   3                                         AR853119
740700200610     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR853119
740800200610     C           @RTCD     IFEQ *BLANKS                                                     AR853119
740900200610     C                     MOVE BXTAX     WSTAX                                             AR853119
741000200610     C                     ENDIF                                                            AR853119
741100200610      *                                                                                     AR853119
741200200610     C           PCPY      CHAINSDCUSQL0             99                                     AR853119
741300200610     C           *IN99     IFEQ '0'                                                         AR853119
741400200610     C                     MOVE CQTAX     WZTAX                                             AR853119
741500200610     C                     ENDIF                                                            AR853119
741600200610      *                                                                                     AR853119
741700200610      ** Calculate Stamp tax                                                                AR853119
741800200610      *                                                                                     AR853119
741900200610     C           WSTAX     IFEQ 'Y'                                                         AR853119
742000200610     C           WZTAX     ANDEQ'Y'                                                         AR853119
742100200610     C                     CALL 'SD008141'                                                  AR853119
742200200610     C                     PARM BJRDNB    U#DATE  50                                        AR853119
742300200610     C                     PARM 'POSSET  'U#ORGN 10                                         AR853119
742400200610     C                     PARM           ##TYPE  4                                         AR853119
742500200610     C                     PARM           U#CTAX 138                                        AR853119
742600200610     C                     PARM           U#MTAX 138                                        AR853119
742700200610     C                     PARM           U#CCCY  3                                         AR853119
742800200610     C                     PARM           U#MCCY  3                                         AR853119
742900200610     C                     PARM           U#CSCC  2                                         AR853119
743000200610     C                     PARM           U#MSCC  2                                         AR853119
743100200610     C                     PARM           U#TXTY  1                                         AR853119
743200200610     C                     PARM           SDSTPD                                            AR853119
743300200610      *                                                                                     AR853119
743400200610      ** If there is a default for the Module use this tax rate and ccy                     AR853119
743500200610      ** otherwise use the ICD Control defaults.                                            AR853119
743600200610      *                                                                                     AR853119
743700200610     C           U#MTAX    IFNE *ZEROS                                                      AR853119
743800200610     C                     Z-ADDU#MTAX    U#TAXR 138                                        AR853119
743900200610     C                     MOVE U#MCCY    U#SCCY  3                                         AR853119
744000200610     C                     ELSE                                                             AR853119
744100200610     C                     MOVE U#CCCY    U#SCCY                                            AR853119
744200200610     C                     Z-ADDU#CTAX    U#TAXR                                            AR853119
744300200610     C                     ENDIF                                                            AR853119
744400200610      *                                                                                     AR853119
744500200610     C                     MOVELPCHA      WSTAXA 130                                        AR853119
744600200610     C                     ADD  PCAM      WSTAXA                                            AR853119
744700200610     C                     MULT U#TAXR    WSTAXA    H                                       AR853119
744800200610     C                     MOVE WSTAXA    P3STAF                                            AR853119
744900200610     C                     MOVE 'Y'       P3TAX                                             AR853119
745000200610     C                     EXSR SRSTMD                                                      AR853119
745100200610     C                     ENDIF                                                            AR853119
745200200610      *                                                                                     AR853119
745300200610     C                     ENDSR                                                            AR853119
745400200610      *****************************************************************                     AR853119
745500200610      /EJECT                                                                                AR853119
745600200610      *****************************************************************                     AR853119
745700200610      * Subroutine  :  SRSTMD                                         *                     AR853119
745800200610      * Function    :  This subroutine will write/update records in   *                     AR853119
745900200610      *                Stamp Tax Historic/Details (SDSTMDPD)          *                     AR853119
746000200610      *****************************************************************                     AR853119
746100200610      *                                                                                     AR853119
746200200610     C           SRSTMD    BEGSR                                                            AR853119
746300200610      *                                                                                     AR853119
746400200610     C                     MOVE PBCA      T2PBRC                                            AR853119
746500200610     C                     MOVE PSSH      T2PSSH                                            AR853119
746600200610     C                     MOVE PCPY      T2PCPY                                            AR853119
746700200610     C                     MOVE PDUD      T2PDUD                                            AR853119
746800200610     C                     MOVE PEVT      T2PEVT                                            AR853119
746900200610     C                     MOVEL'POSSET'  T2KEY                                             AR853119
747000200610     C                     MOVE 'T'       T2RCTP                                            AR853119
747100200610     C                     MOVE U#SCCY    T2SCCY                                            AR853119
747200200610     C                     MOVE PSCU      T2ECCY                                            AR853119
747300200610     C                     MOVE 'Y'       T2TCAL                                            AR853119
747400200610     C                     MOVE U#TAXR    T2TXRT                                            AR853119
747500200610     C                     Z-ADDWSTAXA    T2TATC                                            AR853119
747600200610     C                     MOVE 'Y'       T2STFF                                            AR853119
747700200610     C                     Z-ADDBJRDNB    T2LCD                                             AR853119
747800200610     C                     MOVE 'I'       T2TYLC                                            AR853119
747900200610     C           PCHA      ADD  PCAM      T2GROS                                           AR864714B
748000200610      *                                                                                     AR853119
748100200610     C                     ENDSR                                                            AR853119
748200200610      *****************************************************************                     AR853119
748300200610      /SPACE 3
748400200610      *****************************************************************
748500200610      *                                                               *
748600200610      *  TR10   - Subroutine to get Branch Name from TABLETR.         *
748700200610      *                                                               *
748800200610      *****************************************************************
748900200610      *
749000200610     C***********TR10      BEGSR                           ** TR10   **   081366
749100200610     C*                                                                   081366
749200200610     C***CHAIN*FOR*BRANCH*NAME*IN TABLE TABTG10                           081366
749300200610     C***FIELD*WBC*CONTAINS*THE*BRANCH CODE WHEN SUBROUTINE EXECUTES      081366
749400200610     C*                                                                   081366
749500200610     C***********          Z-ADD10        RECT                            081366
749600200610     C***********          Z-ADDWBC       WBRCDE                    S01117081366
749700200610     C***********          MOVE WBC       WBRCDE                          081366
749800200610     C**                                                                  081366
749900200610     C***********TKEY      CHAINTABLETRF             99                   081366
750000200610     C*                                                                   081366
750100200610     C**ERROR*IF*NO*RECORD*FOUND*OR IF IT IS DELETED                      081366
750200200610     C*                                                                   081366
750300200610     C************IN99     IFEQ '1'                                       081366
750400200610     C***********          SETON                     U7U8                 081366
750500200610     C***********          ELSE                                           081366
750600200610     C***********RECI      IFEQ '*'                                       081366
750700200610     C***********          SETON                     U7U8                 081366
750800200610     C***********          END                                            081366
750900200610     C***********          END                                            081366
751000200610     C************INU7     IFEQ '1'                                       081366
751100200610     C************LOCK     IN   LDA                                 S01117081366
751200200610     C************         MOVE 'TABLE'   DBFILE           ***************081366
751300200610     C************         MOVELTKEY      DBKEY            * DB ERROR 13 *081366
751400200610     C************         Z-ADD13        DBASE            ***************081366
751500200610     C************         DUMP                                     S01117081366
751600200610     C************         GOTO EAUDIT                                    081366
751700200610     C************         END                                            081366
751800200610     C*                                                                   081366
751900200610     C***********ENTR10    ENDSR                           ** ENTR10 **   081366
752000200610      *
752100200610      *****************************************************************
752200200610      /EJECT
752300200610      *****************************************************************
752400200610      *                                                               *
752500200610      *  AUDIT  - Subroutine to update the Audit Files and Output the *
752600200610      *           Control Report.                                     *
752700200610      *                                                               *
752800200610      *****************************************************************
752900200610      *
753000200610     C           AUDIT     BEGSR                           ** AUDIT **
753100200610     C*
753200200610     C** COMPARE COUNT OF CUSTOMER MOVEMENTS TO AUDIT MOVEMENTS
753300200610     C*
753400200610     C           *INU8     IFNE '1'
753500200610     C           WCCMVT    IFNE DCNORE
753600200610     C                     MOVE '1'       *INU8
753700200610     C                     MOVE '1'       *IN30
753800200610     C                     END
753900200610     C                     END
754000200610     C*
754100200610     C** READ CUST. POSITIONS AUDIT FILE UNLESS ALREADY DB ERROR U7
754200200610     C*
754300200610     C           *INU7     IFNE '1'
754400200610     C                     READ CPOSNA                   79
754500200610     C********** *IN79     IFNE '1'                                       E15035
754600200610     C********** RECI      ANDEQ'*'                                       E15035
754700200610     C**********           MOVE '1'       *IN79                           E15035
754800200610     C**********           END                                            E15035
754900200610     C*
755000200610     C* DATA BASE ERROR
755100200610     C*
755200200610     C           *IN79     IFEQ '1'
755300200610     C           *LOCK     IN   LDA                                       S01117
755400200610     C                     MOVEL'CPOSNA'  DBFILE           ***************
755500200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 14 *
755600200610     C                     Z-ADD14        DBASE            ***************
755700200610     C                     SETON                       U7U8
755800200610     C                     DUMP                                           S01117
755900200610     C                     END
756000200610     C                     END
756100200610     C*
756200200610     C** UPDATE CPOSNA IF U8 NOT ON
756300200610     C*
756400200610     C           *INU8     IFNE '1'
756500200610     C                     Z-ADDNORE      DPNORE  50
756600200610     C                     ADD  WCADDP    NORE
756700200610     C                     UPDATCPOSNAF
756800200610     C                     Z-ADDNORE      WNEWDP  50
756900200610     C                     END
757000200610     C           *INU8     IFEQ '1'
757100200610     C                     Z-ADD0         NORE
757200200610     C                     Z-ADD0         WNEWDP
757300200610     C                     END
757400200610     C*
757500200610     C** IF U8 NOT ON WRITE GEN A/C KEYS AUDIT AND POSN.SETT.AUDIT FILES
757600200610     C*
757700200610     C           *INU8     IFNE '1'
757800200610     C                     Z-ADDW01CNT    NORE
757900200610AW   C                     Z-ADDINT,1     HRWN
758000200610AW   C                     Z-ADDDEC,1     HRDC
758100200610     C                     WRITESEKEYAF
758200200610     C*
758300200610     C* WRITE POSETA AUDIT RECORD WITH NO OF RECORDS ON FILE
758400200610     C*
758500200610     C                     Z-ADDW02CNT    NORE
758600200610     C                     WRITEPOSETAF
758700200610     C*
758800200610     C* WRITE MATURED CUSTOMER SECURITY EXTRACT FILE RECORD
758900200610     C*
759000200610AW   C                     MOVE 'C'       RECI
759100200610     C                     Z-ADDW04CNT    NORE
759200200610     C                     WRITEMATEXAF
759300200610     C*
759400200610     C                     END
759500200610     C*
759600200610     C* OUTPUT CONTROL REPORT
759700200610     C*
759800200610     C                     WRITEHEADAU
759900200610     C           *INU7     IFEQ '1'
760000200610     C                     WRITEERROR
760100200610     C                     ELSE
760200200610     C*
760300200610     C**IF*RECORD*COUNT*IS*ZERO*OUTPUT*NONE****************************   E29170
760400200610     C***********                                                         E29170
760500200610     C***********WCSETT    ADD  WORK1     WORK1   50                      E29170
760600200610     C***********WCTRAD    ADD  WORK1     WORK1   50                      E29170
760700200610     C***********WCCMVT    ADD  WORK1     WORK1   50                      E29170
760800200610     C***********WORK1     IFEQ 0                                         E29170
760900200610     C***********          WRITENONE                                      E29170
761000200610     C***********          ELSE                                           E29170
761100200610     C           DCNORE    COMP WCCMVT               3030
761200200610     C                     Z-ADDINT,1     WHASHT
761300200610AW   C                     Z-ADDDEC,1     WHASHD
761400200610     C                     WRITECONTROL
761500200610     C*
761600200610     C***********          END                                            E29170
761700200610     C                     END
761800200610     C*                                                                   S01117
761900200610     C**  Update the local data area with Database Error Details          S01117
762000200610     C*                                                                   S01117
762100200610     C           *INU7     IFEQ '1'                                       S01117
762200200610     C           *INU8     ANDEQ'1'                                       S01117
762300200610     C                     OUT  LDA                                       S01117
762400200610     C                     END                                            S01117
762500200610     C*                                                                   S01486
762600200610     C**  If Portfolio Management is on, close PM files                   S01486
762700200610     C*                                                                   S01486
762800200610     C********** BGPFMG    IFEQ 'Y'                                                  S01486 BUG11617
762900200610     C********** BGN4ST    OREQ 'Y'                                                  CPB002 BUG11617
763000200610     C                     CLOSEPMPORTPD                                  S01486
763100200610     C                     CLOSEPMBVALPD                                  S01486
763200200610     C                     CLOSEPMBVALP1                                  S01486
763300200610     C                     CLOSEPMACCNL0                                  S01486
763400200610     C                     CLOSEPMACCNL1                                  219688
763500200610     C**********           CLOSESECET                                               S01486 BUG11104A
763600200610     C                     CLOSESECEDI                                    S01486
763700200610     C**********           END                                                       S01486 BUG11617
763800200610     C                     CLOSESECET                                                      BUG11104A
763900200610     C***********                                                         E29170
764000200610     C***********          WRITETRAILAU                                   E29170
764100200610     C*
764200200610     C                     ENDSR
764300200610      *
764400200610      *****************************************************************
764500200610      /EJECT
764600200610      *****************************************************************
764700200610      *                                                               *
764800200610      *  MXDDSR - Subroutine for Error Handling of PF/MATEXD.         *
764900200610      *                                                               *
765000200610      *****************************************************************
765100200610      *
765200200610     C           MXDDSR    BEGSR                            **MXDDSR**
765300200610     C*
765400200610     C           *LOCK     IN   LDA                                       S01117
765500200610     C                     MOVEL'MATEXD'  DBFILE           ***************
765600200610     C                     MOVEL'WRITE'   DBKEY            * DB ERROR 15 *
765700200610     C                     Z-ADD15        DBASE            ***************
765800200610     C                     MOVE STSMXD    DBSTAT
765900200610     C                     MOVE '1'       *IN87
766000200610     C                     SETON                     99U7U8
766100200610     C                     DUMP                                           S01117
766200200610     C                     GOTO EAUDIT
766300200610     C*
766400200610     C                     ENDSR
766500200610      *
766600200610      *****************************************************************
766700200610      /SPACE 3
766800200610      *****************************************************************
766900200610      *                                                               *
767000200610      *  MXAASR - Subroutine for Error Handling of PF/MATEXA.         *
767100200610      *                                                               *
767200200610      *****************************************************************
767300200610      *
767400200610     C           MXAASR    BEGSR                            **MXAASR**
767500200610     C*
767600200610     C           *LOCK     IN   LDA                                       S01117
767700200610     C                     MOVEL'MATEXA'  DBFILE           ***************
767800200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 16 *
767900200610     C                     Z-ADD16        DBASE            ***************
768000200610     C                     MOVE STSMXA    DBSTAT
768100200610     C                     MOVE '1'       *IN87
768200200610     C                     SETON                     99U7U8
768300200610     C                     DUMP                                           S01117
768400200610     C                     GOTO EAUDIT
768500200610     C*
768600200610     C                     ENDSR
768700200610      *
768800200610      *****************************************************************
768900200610      /SPACE 3
769000200610      *****************************************************************
769100200610      *                                                               *
769200200610      *  CPOASR - Subroutine for Error Handling of PF/CPOSNA.         *
769300200610      *                                                               *
769400200610      *****************************************************************
769500200610      *
769600200610     C           CPOASR    BEGSR                            **CPOASR**
769700200610     C*
769800200610     C           *LOCK     IN   LDA                                       S01117
769900200610     C                     MOVEL'CPOSNA'  DBFILE           ***************
770000200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 17 *
770100200610     C***********          Z-ADD217       DBASE            ***************E20651
770200200610     C                     Z-ADD17        DBASE                           E20651
770300200610     C                     MOVE STSUDD    DBSTAT
770400200610     C                     MOVE '1'       *IN87
770500200610     C                     SETON                     99U7U8
770600200610     C                     DUMP                                           S01117
770700200610     C                     GOTO EAUDIT
770800200610     C*
770900200610     C                     ENDSR
771000200610      *
771100200610      *****************************************************************
771200200610      /SPACE 3
771300200610      *****************************************************************
771400200610      *                                                               *
771500200610      *  CPOHSR - Subroutine for Error Handling of LF/CPOSH.          *
771600200610      *                                                               *
771700200610      *****************************************************************
771800200610      *
771900200610     C           CPOHSR    BEGSR                           ** CPOHSR **
772000200610     C*
772100200610     C           *LOCK     IN   LDA                                       S01117
772200200610     C                     MOVE 'CPOSH'   DBFILE           ***************
772300200610     C                     MOVELCOMARA    DBKEY            * DB ERROR 18 *
772400200610     C                     Z-ADD018       DBASE            ***************
772500200610     C                     MOVE STSUDA    DBSTAT
772600200610     C                     MOVE '1'       *IN87
772700200610     C                     SETON                     99U7U8
772800200610     C                     DUMP                                           S01117
772900200610     C                     GOTO EAUDIT
773000200610     C*
773100200610     C                     ENDSR
773200200610      *
773300200610      *****************************************************************
773400200610      /SPACE 3
773500200610      *****************************************************************
773600200610      *                                                               *
773700200610      *  POSDSR - Subroutine for Error Handling of PF/POSETD.         *
773800200610      *                                                               *
773900200610      *****************************************************************
774000200610      *
774100200610     C           POSDSR    BEGSR                            ** POSDSR **
774200200610     C*
774300200610     C                     MOVE PBCA      PBCAK                           CSE023
774400200610     C                     MOVE PSSH      PSSHK                           CSE023
774500200610     C                     MOVE PCPY      PCPYK                           CSE023
774600200610     C           *LOCK     IN   LDA                                       S01117
774700200610     C                     MOVE 'POSETD'  DBFILE           ***************
774800200610     C                     MOVELPOSDDB    DBKEY            * DB ERROR 19 *
774900200610     C                     Z-ADD019       DBASE            ***************
775000200610     C                     MOVE STSPSD    DBSTAT
775100200610     C                     MOVE '1'       *IN87
775200200610     C                     SETON                     99U7U8
775300200610     C                     DUMP                                           S01117
775400200610     C                     GOTO EAUDIT
775500200610     C*
775600200610     C                     ENDSR
775700200610      *
775800200610      *****************************************************************
775900200610      /SPACE 3
776000200610      *****************************************************************
776100200610      *                                                               *
776200200610      *  SEKDSR - Subroutine for Error Handling of LF/SEKEYD.         *
776300200610      *                                                               *
776400200610      *****************************************************************
776500200610      *
776600200610     C           SEKDSR    BEGSR                            **SEKDSR**
776700200610     C*
776800200610     C           *LOCK     IN   LDA                                       S01117
776900200610     C                     MOVE 'SEKEYD'  DBFILE           ***************
777000200610     C                     MOVELACKY      DBKEY            * DB ERROR 20 *
777100200610     C                     Z-ADD020       DBASE            ***************
777200200610     C                     MOVE STSSKD    DBSTAT
777300200610     C                     MOVE '1'       *IN87
777400200610     C                     SETON                     99U7U8
777500200610     C                     DUMP                                           S01117
777600200610     C                     GOTO EAUDIT
777700200610     C*
777800200610     C                     ENDSR
777900200610      *
778000200610      *****************************************************************
778100200610      /SPACE 3
778200200610      *****************************************************************
778300200610      *                                                               *
778400200610      *  POSASR - Subroutine for Error Handling of PF/POSETA.         *
778500200610      *                                                               *
778600200610      *****************************************************************
778700200610      *
778800200610     C           POSASR    BEGSR                              **POSASR**
778900200610     C*
779000200610     C           *LOCK     IN   LDA                                       S01117
779100200610     C                     MOVE 'POSETA'  DBFILE           ***************
779200200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 21 *
779300200610     C                     Z-ADD21        DBASE            ***************
779400200610     C                     MOVE STSPSA    DBSTAT
779500200610     C                     MOVE '1'       *IN87
779600200610     C                     SETON                     99U7U8
779700200610     C                     DUMP                                           S01117
779800200610     C                     GOTO EAUDIT
779900200610     C*
780000200610     C                     ENDSR
780100200610      *
780200200610      *****************************************************************
780300200610      /SPACE 3
780400200610      *****************************************************************
780500200610      *                                                               *
780600200610      *  SEKASR - Subroutine for Error Handling of PF/SEKEYA.         *
780700200610      *                                                               *
780800200610      *****************************************************************
780900200610      *
781000200610     C           SEKASR    BEGSR                             **SEKASR**
781100200610     C*
781200200610     C           *LOCK     IN   LDA                                       S01117
781300200610     C                     MOVE 'SEKEYA'  DBFILE           ***************
781400200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 22 *
781500200610     C                     Z-ADD22        DBASE            ***************
781600200610     C                     MOVE STSSKA    DBSTAT
781700200610     C                     MOVE '1'       *IN87
781800200610     C                     SETON                     99U7U8
781900200610     C                     DUMP                                           S01117
782000200610     C                     GOTO EAUDIT
782100200610     C*
782200200610     C                     ENDSR
782300200610      *
782400200610      *****************************************************************
782500200610      /EJECT
782600200610      *****************************************************************
782700200610      *                                                               *
782800200610      *  FIRST  - Subroutine to access ICD Information.               *
782900200610      *                                                               *
783000200610      *****************************************************************
783100200610      *
783200200610     C           FIRST     BEGSR                           ** FIRST **
783300200610     C*
783400200610     C           *NAMVAR   DEFN           LDA
783500200610     C           *LOCK     IN   LDA                                       S01117
783600200610     C                     MOVE *BLANKS   DBLOT                           S01117
783700200610     C                     MOVEL'SE2380'  DBPGM                           S01117
783800200610     C                     Z-ADD0         DBASE                           S01117
783900200610     C                     OUT  LDA                                       S01117
784000200610     C*
784100200610     C* ACCESS ICD    TABTB10
784200200610     C*
784300200610     C                     EXSR ZSYSTM
784400200610     C           *IN99     IFEQ '1'
784500200610     C                     MOVE '1'       *INU7
784600200610     C                     MOVE '1'       *INU8
784700200610     C           *LOCK     IN   LDA                                       S01117
784800200610     C                     MOVE 'TABLE'   DBFILE           ***************
784900200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 01 *
785000200610     C                     Z-ADD1         DBASE            ***************
785100200610     C                     DUMP                                           S01117
785200200610     C                     ELSE
785300200610     C*
785400200610     C* ACCESS ICD2   TABTB11
785500200610     C*
785600200610     C                     EXSR ZICD2
785700200610     C           *INU7     IFEQ '1'
785800200610     C                     MOVE '1'       *IN99
785900200610     C           *LOCK     IN   LDA                                       S01117
786000200610     C                     MOVE 'TABLE'   DBFILE           ***************
786100200610     C                     MOVELTKEY      DBKEY            * DB ERROR 02 *
786200200610     C                     Z-ADD2         DBASE            ***************
786300200610     C                     DUMP                                           S01117
786400200610     C                     ELSE
786500200610      * Retrieve account code                                      103361 114458
786600200610     C**********           CALL 'AORETLR0'                         103361 114458
786700200610     C**********           PARM *BLANKS   @RTCD   7                103361 114458
786800200610     C**********           PARM '*FIRST'  @OPTN   7                103361 114458
786900200610     C********** SDRETL    PARM SDRETL    DSFDY                    103361 114458
787000200610     C********** @RTCD     IFNE *BLANKS                            103361 114458
787100200610     C********** *LOCK     IN   LDA                                103361 114458
787200200610     C**********           MOVE '1'       *INU7                    103361 114458
787300200610     C**********           MOVE '1'       *INU8            ***************114458
787400200610     C**********           Z-ADD43        DBASE            * DB ERR103361*114458
787500200610     C**********           MOVEL'SDRETLL1'DBFILE           ***************114458
787600200610     C**********           MOVEL*BLANK    DBKEY                    103361 114458
787700200610     C**********           EXSR *PSSR                              103361 114458
787800200610     C**********           END                                     103361 114458
787900200610     C*
788000200610     C* ACCESS ICDSE  TABTB36
788100200610     C*
788200200610     C                     EXSR ZICDSE
788300200610     C           *INU7     IFEQ '1'
788400200610     C                     MOVE '1'       *IN99
788500200610     C           *LOCK     IN   LDA                                       S01117
788600200610     C                     MOVE 'TABLE'   DBFILE           ***************
788700200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 03 *
788800200610     C                     Z-ADD3         DBASE            ***************
788900200610     C                     DUMP                                           S01117
789000200610     C                     END
789100200610     C*                                                                   S01117
789200200610     C** Set up Parameter for use in SR.ZSDESC                            S01117
789300200610     C*                                                                   S01117
789400200610     C                     MOVE RSFD      ZRSFD                           S01117
789500200610     C                     END
789600200610     C                     END
789700200610     C*                                                                   095033
789800200610     C/COPY WNCPYSRC,SE2380C015
789900200610     C** Access General Ledger file for Profit Centres Used               095033
790000200610     C*                                                                   095033
790100200610     C**********           CALL 'AOGELRR0'                                             095033 CGL029
790200200610     C                     CALL 'AOGELRR1'                                                    CGL029
790300200610     C                     PARM *BLANKS   @RTCD   7                       095033
790400200610     C                     PARM '*FIRST ' @OPTN   7                       095033
790500200610     C********** SDGELR    PARM SDGELR    DSFDY                                        095033 CGL029
790600200610     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
790700200610     C*                                                                   095033
790800200610     C           @RTCD     IFNE *BLANKS                                   095033
790900200610     C                     SETON                     U7U899               095033
791000200610     C           *LOCK     IN   LDA                                       095033
791100200610     C                     MOVE 'SDGELRPD'DBFILE           ***************095033
791200200610     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 28 *095033
791300200610     C                     Z-ADD28        DBASE            ***************095033
791400200610     C                     DUMP                                           095033
791500200610     C                     END                                            095033
791600200610     C*                                                                   S01519
791700200610     C** Access Securities Trading file for the Autocharge option         S01519
791800200610     C*                                                                   S01519
791900200610     C                     CALL 'AOSTRDR0'                                S01519
792000200610     C                     PARM *BLANKS   @RTCD   7                       S01519
792100200610     C                     PARM '*FIRST ' @OPTN   7                       S01519
792200200610     C           SDSTRD    PARM SDSTRD    DSFDY                           S01519
792300200610     C*                                                                   S01519
792400200610     C           @RTCD     IFNE *BLANKS                                   S01519
792500200610     C                     SETON                     U7U899               S01519
792600200610     C           *LOCK     IN   LDA                                       S01519
792700200610     C                     MOVE 'SDSTRDPD'DBFILE           ***************S01519
792800200610     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 27 *S01519
792900200610     C                     Z-ADD27        DBASE            ***************S01519
793000200610     C                     DUMP                                           S01519
793100200610     C                     END                                            S01519
793200200610     C*                                                                   S01446
793300200610     C** If Autocharge option is set to 'Y', check if Customer            S01446
793400200610     C** Commission (Courtage) is installed                               S01446
793500200610     C*                                                                   S01446
793600200610     C           BVACOP    IFEQ 'Y'                                       S01446
793700200610     C                     MOVE 'N'       S01446                          S01446
793800200610     C                     CALL 'AOSARDR0'                                S01446
793900200610     C                     PARM *BLANKS   @RTCD                           S01446
794000200610     C                     PARM '*VERIFY' @OPTN                           S01446
794100200610     C                     PARM 'S01446'  @SARD   6                       S01446
794200200610     C*                                                                   S01446
794300200610     C           @RTCD     IFEQ *BLANK                                    S01446
794400200610     C                     MOVE 'Y'       S01446  1                       S01446
794500200610     C*                                                                   S01446
794600200610     C** If it is and charge ccy is defined, get the spot rate            S01446
794700200610     C** and save multiply/divide indicator and number of dec places      S01446
794800200610     C** from SDCURRPD                                                    S01446
794900200610     C*                                                                   S01446
795000200610     C           BVCHRC    IFNE *BLANKS                                   S01446
795100200610     C                     MOVE BVCHRC    WCURR                           S01446
795200200610     C                     Z-ADD28        WDBAS1                          S01446
795300200610     C                     EXSR #LCURR                                    S01446
795400200610     C                     Z-ADDA6SPRT    TXSPOT 138                      S01446
795500200610     C                     MOVE A6MDIN    TXMDI   1                       S01446
795600200610     C                     MOVE A6NBDP    TXCDP   10                      S01446
795700200610     C                     END                                            S01446
795800200610     C                     END                                            S01446
795900200610     C                     END                                            S01446
796000200610      *                                                                   CSE026
796100200610      ** Check if Posn Settlement Default Charges by Customer Grp is On.  CSE026
796200200610      *                                                                   CSE026
796300200610     C                     CALL 'AOSARDR0'                                CSE026
796400200610     C                     PARM *BLANKS   @RTCD                           CSE026
796500200610     C                     PARM '*VERIFY' @OPTN                           CSE026
796600200610     C                     PARM 'S01496'  @SARD                           CSE026
796700200610     C           SCSARD    PARM SCSARD    DSSDY                           CSE026
796800200610      *                                                                   CSE026
796900200610     C           @RTCD     IFEQ *BLANKS                                   CSE026
797000200610     C                     MOVE 'Y'       S01496  1                       CSE026
797100200610     C                     ELSE                                           CSE026
797200200610      *                                                                   CSE026
797300200610      ** Error if return code other than '*NRF'                           CSE026
797400200610      *                                                                   CSE026
797500200610     C           @RTCD     IFNE '*NRF'                                    CSE026
797600200610     C           *LOCK     IN   LDA                                       CSE026
797700200610     C                     Z-ADD32        DBASE                           CSE026
797800200610     C                     MOVE 'SCSARDPD'DBFILE                          CSE026
797900200610     C                     MOVEL'*VERIFY' DBKEY                           CSE026
798000200610     C                     MOVE *ON       *INU7                           CSE026
798100200610     C                     MOVE *ON       *INU8                           CSE026
798200200610     C                     MOVE *ON       *INLR                           CSE026
798300200610     C                     EXSR *PSSR                                     CSE026
798400200610     C                     ELSE                                           CSE026
798500200610     C                     MOVE 'N'       S01496                          CSE026
798600200610     C                     ENDIF                                          CSE026
798700200610      *                                                                   CSE026
798800200610     C                     ENDIF                                          CSE026
798900200610      *                                                                   CSE026
799000200610      ** If S01496 is On & Autocharge flag on Securities Trading ICD is   CSE026
799100200610      ** 'Y', set on Indicator 40.                                        CSE026
799200200610      *                                                                   CSE026
799300200610     C           S01496    IFEQ 'Y'                                       CSE026
799400200610     C           BVACOP    ANDEQ'Y'                                       CSE026
799500200610     C                     MOVE *ON       *IN40                           CSE026
799600200610     C                     OPEN SEDFGRL0                                  CSE026
799700200610     C                     ELSE                                           CSE026
799800200610     C                     MOVE *OFF      *IN40                           CSE026
799900200610     C                     ENDIF                                          CSE026
800000200610      *                                                                   S01447
800100200610     C*                                                                   S01486
800200200610     C**  Get module details using access object                          S01486
800300200610     C*                                                                   S01486
800400200610     C                     CALL 'AOMMODR0'                                S01486
800500200610     C                     PARM '*MSG   ' @RTCD                           S01486
800600200610     C                     PARM '*FIRST ' @OPTN                           S01486
800700200610     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
800800200610     C*                                                                   S01486
800900200610     C**  Check if error occurred                                         S01486
801000200610     C*                                                                   S01486
801100200610     C           @RTCD     IFNE *BLANKS                                   S01486
801200200610     C           *LOCK     IN   LDA                                       S01486
801300200610     C                     MOVEL'SDMMODPD'DBFILE           ***************S01486
801400200610     C                     Z-ADD23        DBASE            * DB ERROR 22 *S01486
801500200610     C                     SETON                       U7U8***************S01486
801600200610     C                     EXSR *PSSR                                     S01486
801700200610     C                     END                                            S01486
801800200610     C*                                                                   S01486
801900200610     C**  If Portfolio Management is on, open PM files                    S01486
802000200610     C*                                                                   S01486
802100200610     C********** BGPFMG    IFEQ 'Y'                                                  S01486 BUG11617
802200200610     C********** BGN4ST    OREQ 'Y'                                                  CPB002 BUG11617
802300200610     C                     OPEN PMPORTPD                                  S01486
802400200610     C                     OPEN PMBVALPD                                  S01486
802500200610     C                     OPEN PMBVALP1                                  S01486
802600200610     C                     OPEN PMACCNL0                                  S01486
802700200610     C                     OPEN PMACCNL1                                  219688
802800200610     C**********           OPEN SECET                                               S01486 BUG11104A
802900200610     C                     OPEN SECEDI                                    S01486
803000200610     C**********           END                                                       S01486 BUG11617
803100200610     C                     OPEN SECET                                                      BUG11104A
803200200610      * Retrieve account code                                             114458
803300200610     C           BGRTBN    IFEQ 'Y'                                       114458
803400200610     C                     CALL 'AORETLR0'                                114458
803500200610     C                     PARM *BLANKS   @RTCD   7                       114458
803600200610     C                     PARM '*FIRST'  @OPTN   7                       114458
803700200610     C           SDRETL    PARM SDRETL    DSFDY                           114458
803800200610     C           @RTCD     IFNE *BLANKS                                   114458
803900200610     C           *LOCK     IN   LDA                                       114458
804000200610     C                     MOVE '1'       *INU7                           114458
804100200610     C                     MOVE '1'       *INU8            ***************114458
804200200610     C                     Z-ADD43        DBASE            * DB ERROR 43 *114458
804300200610     C                     MOVEL'SDRETLL1'DBFILE           ***************114458
804400200610     C                     MOVEL*BLANK    DBKEY                           114458
804500200610     C                     EXSR *PSSR                                     114458
804600200610     C                     END                                            114458
804700200610     C                     END                                            114458
804800200610     C*                                                                   S01486
804900200610      *** Check Withholding tax is installed                              S01447
805000200610      *                                                                   S01447
805100200610     C                     CALL 'AOSARDR0'                                S01447
805200200610     C                     PARM *BLANKS   @RTCD                           S01447
805300200610     C                     PARM '*VERIFY' @OPTN                           S01447
805400200610     C                     PARM 'S01447'  @SARD   6                       S01447
805500200610      *                                                                   S01447
805600200610     C           @RTCD     IFEQ *BLANK                                    S01447
805700200610     C                     MOVE 'Y'       S01447  1                       S01447
805800200610     C                     ELSE                                           S01447
805900200610     C                     MOVE 'N'       S01447                          S01447
806000200610     C                     END                                            S01447
806100200610     C*                                                                   S01509
806200200610     C** Check if Value Currency is Currency of Issuer of Payments is     S01509
806300200610     C** installed                                                        S01509
806400200610     C*                                                                   S01509
806500200610     C                     CALL 'AOSARDR0'                                S01509
806600200610     C                     PARM *BLANKS   @RTCD                           S01509
806700200610     C                     PARM '*VERIFY' @OPTN                           S01509
806800200610     C                     PARM 'S01509'  @SARD   6                       S01509
806900200610     C*                                                                   S01509
807000200610     C           @RTCD     IFEQ *BLANK                                    S01509
807100200610     C                     MOVE 'Y'       S01509  1                       S01509
807200200610     C                     ELSE                                           S01509
807300200610     C                     MOVE 'N'       S01509                          S01509
807400200610     C                     END                                            S01509
807500200610     C*                                                                   S01510
807600200610     C** Check if Dividend Payments Based on Ex-date is installed         S01510
807700200610     C*                                                                   S01510
807800200610     C                     CALL 'AOSARDR0'                                S01510
807900200610     C                     PARM *BLANKS   @RTCD                           S01510
808000200610     C                     PARM '*VERIFY' @OPTN                           S01510
808100200610     C                     PARM 'S01510'  @SARD   6                       S01510
808200200610     C*                                                                   S01510
808300200610     C           @RTCD     IFEQ *BLANK                                    S01510
808400200610     C                     MOVE 'Y'       S01510  1                       S01510
808500200610     C                     ELSE                                           S01510
808600200610     C                     MOVE 'N'       S01510                          S01510
808700200610     C                     END                                            S01510
808800200610     C*                                                                   S01512
808900200610     C** Check if Position Settlements is installed                       S01512
809000200610     C*                                                                   S01512
809100200610     C                     CALL 'AOSARDR0'                                S01512
809200200610     C                     PARM *BLANKS   @RTCD                           S01512
809300200610     C                     PARM '*VERIFY' @OPTN                           S01512
809400200610     C                     PARM 'S01512'  @SARD   6                       S01512
809500200610     C*                                                                   S01512
809600200610     C           @RTCD     IFEQ *BLANK                                    S01512
809700200610     C                     MOVE 'Y'       S01512  1                       S01512
809800200610     C                     ELSE                                           S01512
809900200610     C                     MOVE 'N'       S01512                          S01512
810000200610     C                     END                                            S01512
810100200610     C*                                                                   S01519
810200200610     C** Check if Position Settlements Automatic Charges is installed     S01519
810300200610     C*                                                                   S01519
810400200610     C                     CALL 'AOSARDR0'                                S01519
810500200610     C                     PARM *BLANKS   @RTCD                           S01519
810600200610     C                     PARM '*VERIFY' @OPTN                           S01519
810700200610     C                     PARM 'S01519'  @SARD   6                       S01519
810800200610     C*                                                                   S01519
810900200610     C           @RTCD     IFEQ *BLANK                                    S01519
811000200610     C                     MOVE 'Y'       S01519  1                       S01519
811100200610     C                     ELSE                                           S01519
811200200610     C                     MOVE 'N'       S01519                          S01519
811300200610     C                     END                                            S01519
811400200610     C*                                                                   CEU005
811500200610     C**  Access SAR details file to see if CEU005 SAR is installed.      CEU005
811600200610     C*                                                                   CEU005
811700200610     C                     CALL 'AOSARDR0'                                CEU005
811800200610     C                     PARM *BLANKS   @RTCD                           CEU005
811900200610     C                     PARM '*VERIFY' @OPTN                           CEU005
812000200610     C                     PARM 'CEU005'  @SARD                           CEU005
812100200610     C*                                                                   CEU005
812200200610     C           @RTCD     IFEQ *BLANK                                    CEU005
812300200610     C                     MOVE 'Y'       CEU005  1                       CEU005
812400200610     C                     ELSE                                           CEU005
812500200610     C                     MOVE 'N'       CEU005                          CEU005
812600200610     C                     ENDIF                                          CEU005
812700200610      *                                                                   CSE023
812800200610      ** Check if CSE023 - Treaty withholding Tax is switched ON          CSE023
812900200610      *                                                                   CSE023
813000200610     C                     CALL 'AOSARDR0'                                CSE023
813100200610     C                     PARM *BLANKS   @RTCD                           CSE023
813200200610     C                     PARM '*VERIFY' @OPTN                           CSE023
813300200610     C                     PARM 'CSE023'  @SARD   6                       CSE023
813400200610     C*                                                                   CSE023
813500200610     C           @RTCD     IFEQ *BLANK                                    CSE023
813600200610     C                     MOVE 'Y'       CSE023  1                       CSE023
813700200610     C                     ELSE                                           CSE023
813800200610     C                     MOVE 'N'       CSE023                          CSE023
813900200610     C                     ENDIF                                          CSE023
814000200610      *                                                                                       CSE028
814100200610      ** Check if CSE028 feature is installed                                                 CSE028
814200200610      *                                                                                       CSE028
814300200610     C                     MOVE 'N'       CSE028  1                                           CSE028
814400200610     C                     CALL 'AOSARDR0'                                                    CSE028
814500200610     C                     PARM *BLANKS   @RTCD                                               CSE028
814600200610     C                     PARM '*VERIFY' @OPTN                                               CSE028
814700200610     C                     PARM 'CSE028'  @SARD                                               CSE028
814800200610      *                                                                                       CSE028
814900200610     C           @RTCD     IFNE *BLANKS                                                       CSE028
815000200610     C           @RTCD     ANDNE'*NRF   '                                                     CSE028
815100200610     C           *LOCK     IN   LDA                                                           CSE028
815200200610     C                     MOVEL@SARD     DBKEY                                               CSE028
815300200610     C                     MOVEL'SCSARDPD'DBFILE                                              CSE028
815400200610     C                     Z-ADD29        DBASE                                               CSE028
815500200610     C                     OUT  LDA                                                           CSE028
815600200610     C                     MOVE *ON       *INU7                                               CSE028
815700200610     C                     MOVE *ON       *INU8                                               CSE028
815800200610     C                     MOVE *ON       *INLR                                               CSE028
815900200610     C                     EXSR *PSSR                                                         CSE028
816000200610     C                     ENDIF                                                              CSE028
816100200610      *                                                                                       CSE028
816200200610     C           @RTCD     IFEQ *BLANKS                                                       CSE028
816300200610     C                     MOVE 'Y'       CSE028                                              CSE028
816400200610     C                     ENDIF                                                              CSE028
816500200610      *                                                                                       CSE035
816600200610      ** Access SAR details file to see if CSE035 is installed                                CSE035
816700200610      *                                                                                       CSE035
816800200610     C                     CALL 'AOSARDR0'                                                    CSE035
816900200610     C                     PARM *BLANKS   @RTCD                                               CSE035
817000200610     C                     PARM '*VERIFY' @OPTN                                               CSE035
817100200610     C                     PARM 'CSE035'  @SARD                                               CSE035
817200200610      *                                                                                       CSE035
817300200610     C           @RTCD     IFEQ *BLANK                                                        CSE035
817400200610     C                     MOVE 'Y'       CSE035  1                                           CSE035
817500200610     C                     ELSE                                                               CSE035
817600200610     C                     MOVE 'N'       CSE035                                              CSE035
817700200610     C                     ENDIF                                                              CSE035
817800200610      *                                                                                       CSE035
817900200610      *                                                                   S01408
818000200610      ** Determine if Midas Compliance Watch is installed                                     CGL020
818100200610      *                                                                                       CGL020
818200200610     C                     MOVE 'N'       CGL020  1                                           CGL020
818300200610     C                     CALL 'AOSARDR0'                                                    CGL020
818400200610     C                     PARM '       ' @RTCD                                               CGL020
818500200610     C                     PARM '*VERIFY' @OPTN                                               CGL020
818600200610     C                     PARM 'CGL020'  @SARD                                               CGL020
818700200610     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
818800200610      *                                                                                       CGL020
818900200610     C           @RTCD     IFNE *BLANK                                                        CGL020
819000200610     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
819100200610     C           *LOCK     IN   LDA                                                           CGL020
819200200610     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
819300200610     C                     Z-ADD26        DBASE                                               CGL020
819400200610     C                     MOVEL@SARD     DBKEY                                               CGL020
819500200610     C                     OUT  LDA                                                           CGL020
819600200610     C                     MOVE *ON       *INU7                                               CGL020
819700200610     C                     MOVE *ON       *INU8                                               CGL020
819800200610     C                     MOVE *ON       *INLR                                               CGL020
819900200610     C                     EXSR *PSSR                                                         CGL020
820000200610      *                                                                                       CGL020
820100200610     C                     ELSE                                                               CGL020
820200200610     C                     MOVE 'Y'       CGL020                                              CGL020
820300200610     C                     ENDIF                                                              CGL020
820400200610      *                                                                                       CGL031
820500200610      ** Check if Taxation of Savings Income (CGL031) is installed                            CGL031
820600200610      *                                                                                       CGL031
820700200610     C                     MOVE 'N'       CGL031  1                                           CGL031
820800200610     C                     CALL 'AOSARDR0'                                                    CGL031
820900200610     C                     PARM *BLANKS   PRETN   7                                           CGL031
821000200610     C                     PARM '*VERIFY' POPTN   7                                           CGL031
821100200610     C                     PARM 'CGL031'  PSARD   6                                           CGL031
821200200610     C           SCSARD    PARM SCSARD    DSFDY                                               CGL031
821300200610      *                                                                                       CGL031
821400200610     C           PRETN     IFNE *BLANKS                                                       CGL031
821500200610     C           PRETN     ANDNE'*NRF   '                                                     CGL031
821600200610     C           *LOCK     IN   LDA                                                           CGL031
821700200610     C                     MOVEL'CGL031'  DBKEY                                               CGL031
821800200610     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
821900200610     C                     Z-ADD44        DBASE                                               CGL031
822000200610     C                     OUT  LDA                                                           CGL031
822100200610     C                     MOVE *ON       *INU7                                               CGL031
822200200610     C                     MOVE *ON       *INU8                                               CGL031
822300200610     C                     MOVE *ON       *INLR                                               CGL031
822400200610     C                     EXSR *PSSR                                                         CGL031
822500200610     C                     ENDIF                                                              CGL031
822600200610      *                                                                                       CGL031
822700200610     C           PRETN     IFEQ *BLANKS                                                       CGL031
822800200610     C                     MOVE 'Y'       CGL031                                              CGL031
822900200610     C                     ENDIF                                                              CGL031
823000200610      *                                                                                     AR853119
823100200610      ** Check if CER049 - Stamp Tax is switch on                                           AR853119
823200200610      *                                                                                     AR853119
823300200610     C                     CALL 'AOSARDR0'                                                  AR853119
823400200610     C                     PARM *BLANKS   PRETN                                             AR853119
823500200610     C                     PARM '*VERIFY' POPTN                                             AR853119
823600200610     C                     PARM 'CER049'  PSARD                                             AR853119
823700200610      *                                                                                     AR853119
823800200610     C           PRETN     IFEQ *BLANK                                                      AR853119
823900200610     C                     MOVE 'Y'       CER049  1                                         AR853119
824000200610     C                     ELSE                                                             AR853119
824100200610     C                     MOVE 'N'       CER049                                            AR853119
824200200610     C                     ENDIF                                                            AR853119
824300200610      **********                                                                AR1001183 AR1001183A
824400200610      ***Check*if*CRE073*is*switched*on                                         AR1001183 AR1001183A
824500200610      **********                                                                AR1001183 AR1001183A
824600200610     C**********           CALL 'AOSARDR0'                                      AR1001183 AR1001183A
824700200610     C**********           PARM           @RTCD                                 AR1001183 AR1001183A
824800200610     C**********           PARM '*VERIFY' @OPTN                                 AR1001183 AR1001183A
824900200610     C**********           PARM 'CRE073'  @SARD                                 AR1001183 AR1001183A
825000200610      **********                                                                AR1001183 AR1001183A
825100200610      ***Process*database*error                                                 AR1001183 AR1001183A
825200200610      **********                                                                AR1001183 AR1001183A
825300200610     C********** @RTCD     IFEQ *BLANKS                                         AR1001183 AR1001183A
825400200610     C**********           MOVE 'Y'       CRE073  1                             AR1001183 AR1001183A
825500200610     C**********           ELSE                                                 AR1001183 AR1001183A
825600200610     C**********           MOVE 'N'       CRE073                                AR1001183 AR1001183A
825700200610     C**********           ENDIF                                                AR1001183 AR1001183A
825800200610      **********                                                                AR1001183 AR1001183A
825900200610      *                                                                                       CGL020
826000200610      **  Access SDSAVLPD for Default settlement account to portfolio 001 indicator (Y/N)     219566
826100200610     C                     CALL 'AOSVALR0'                                                    219566
826200200610     C                     PARM *BLANKS   RTNCDE  7                                           219566
826300200610     C                     PARM           SVALK1 20                                           219566
826400200610     C                     PARM           SVAL1 200                                           219566
826500200610     C                     PARM           SVALK2 20                                           219566
826600200610     C                     PARM           SVAL2 200                                           219566
826700200610     C                     PARM           SVALK3 20                                           219566
826800200610     C                     PARM           SVAL3 200                                           219566
826900200610     C                     PARM           SVALK4 20                                           219566
827000200610     C                     PARM           SVAL4 200                                           219566
827100200610     C                     PARM           SVALK5 20                                           219566
827200200610     C                     PARM           SVAL5 200                                           219566
827300200610     C                     PARM           SVALK6 20                                           219566
827400200610     C                     PARM           SVAL6 200                                           219566
827500200610     C                     PARM           SVALK7 20                                           219566
827600200610     C                     PARM           SVAL7 200                                           219566
827700200610     C                     PARM           SVALK8 20                                           219566
827800200610     C                     PARM           SVAL8 200                                           219566
827900200610     C                     PARM           SVALK9 20                                           219566
828000200610     C                     PARM           SVAL9 200                                           219566
828100200610     C                     PARM           SVALK0 20                                           219566
828200200610     C                     PARM           SVAL10200                                           219566
828300200610      *                                                                                       219566
828400200610     C           RTNCDE    IFNE *BLANKS                                                       219566
828500200610     C           *LOCK     IN   LDA                                                           219566
828600200610     C                     MOVE SVALK1    DBKEY            * DB ERROR 47 *                    219566
828700200610     C                     Z-ADD47        DBASE                                               219566
828800200610     C                     MOVE 'SDSVALPD'DBFILE                                              219566
828900200610     C                     MOVEL'SE2380'  DBPGM                                               219566
829000200610     C                     OUT  LDA                                                           219566
829100200610     C                     SETON                     U7U8LR                                   219566
829200200610     C                     EXSR *PSSR                                                         219566
829300200610     C                     ENDIF                                                              219566
829400200610      *                                                                                       219566
829500200610     C/COPY WNCPYSRC,SE2380CCP4                                           S01408
829600200610      *                                                                   S01408
829700200610      *                                                                   S01447
829800200610      *                                                                   S01447
829900200610      ***  Define like field definitions                                  S01447
830000200610      *                                                                   S01447
830100200610     C           *LIKE     DEFN CLOC      UBRLOC           brch ctry      S01447
830200200610     C           *LIKE     DEFN CLOC      UCLOC            cust's ctry    S01447
830300200610     C           *LIKE     DEFN S1RASO    UTXRSR           src tax rate   S01447
830400200610     C           *LIKE     DEFN TBRASR    UTXRRF           ref tax rate   S01447
830500200610     C           *LIKE     DEFN TBRAUS    UTXRUS           usr tax rate   S01447
830600200610     C           *LIKE     DEFN TBDLOR    UDLOR            ded.tax local  S01447
830700200610     C*
830800200610     C                     ENDSR
830801200616     C********************************************************************                  AR324886
830802200616     C/EJECT                                                                                AR324886
830803200616     C********************************************************************                  AR324886
830804200616     C           PSAUDT    BEGSR                                                            AR324886
830805200616      *                                                                                     AR324886
830806200616     C                     MOVE RECI      PARECI                                            AR324886
830807200616     C                     MOVE PBCA      PAPBCA                                            AR324886
830808200616     C                     MOVE PSSH      PAPSSH                                            AR324886
830809200616     C                     MOVE PCPY      PAPCPY                                            AR324886
830810200616     C                     MOVE PDUD      PAPDUD                                            AR324886
830811200616     C                     MOVE PEVT      PAPEVT                                            AR324886
830812200616     C                     MOVE PTFR      PAPTFR                                            AR324886
830813200616     C                     MOVE TNLU      PATNLU                                            AR324886
830814200616     C                     MOVE TXBS      PATXBS                                            AR324886
830815200616     C                     MOVE BNFO      PABNFO                                            AR324886
830816200616     C                     MOVE EXCD      PAEXCD                                            AR324886
830817200616     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
830818200616     C                     MOVE LCD       PALCD                                             AR324886
830819200616     C                     MOVE CHTP      PALCTP                                            AR324886
830820200616     C                     WRITEPSAUTDF                                                     AR324886
830821200616      *                                                                                     AR324886
830822200616     C                     ENDSR                                                            AR324886
830900200610     C********************************************************************S01486
831000200610     C/EJECT                                                              S01486
831100200610     C********************************************************************S01486
831200200610     C*                                                                   S01486
831300200610     C*  PSCH   - CALCULATE SE ACCRUED INTEREST - SCHULDSCHEIN            S01486
831400200610     C*                                                                   S01486
831500200610     C*  PURPOSE : TO CALCULATE SE ACCRUED INTEREST FOR                   S01486
831600200610     C*            SCHULDSCHEIN SECURITIES                                S01486
831700200610     C*                                                                   S01486
831800200610     C*  FILE USED                                                        S01486
831900200610     C*       PF/PMBVALP1 - BACKVALUED POSITION CHANGES                   S01486
832000200610     C*                                                                   S01486
832100200610     C*  FILES NEEDED (THESE FILES AND DATA AREA MUST HAVE BEEN           S01486
832200200610     C*                ACCESSED BEFORE THIS SUBROUTINE IS EXECUTED)       S01486
832300200610     C*       LF/SECTY: SECURITIES                                        S01486
832400200610     C*       LF/INVTP: INVESTMENT TYPES                                  S01486
832500200610     C*       LF/SDCURRL0: CURRENCIES, FOR NOMINAL CURRENCY D.P.          S01486
832600200610     C*       DTAARA/PMSTAT: FOR EVENT CONTROL DATE                       S01486
832700200610     C*                                                                   S01486
832800200610     C*  SUBROUTINES NEEDED                                               S01486
832900200610     C*       ZNCD MUST HAVE BEEN CALLED BEFORE CALLING THIS SUBROUTINE   S01486
833000200610     C*                                                                   S01486
833100200610     C*  INPUT  FIELDS                                                    S01486
833200200610     C*       ZFMDAT  5 0     FROM DATE                                   S01486
833300200610     C*       ZTODAT  5 0     TO DATE                                     S01486
833400200610     C******* ZCSBR***3 0     BRANCH                               S01486 081363
833500200610     C*       ZCSBR   3       BRANCH                                      081363
833600200610     C******* ZCUST***6 0     CUSTOMER                                    S01486
833700200610     C*       XCUST   6 0     CUSTOMER                                    S01486
833800200610     C*       ZPTFR   4       PORTFOLIO REFERENCE                         S01486
833900200610     C*       ZSSNM  10       SECURITY SHORTNAME                          S01486
834000200610     C*                                                                   S01486
834100200610     C*  OUTPUT  FIELDS                                                   S01486
834200200610     C*       ZTOAI  15 0     TOTAL ACCRUED INTEREST                      S01486
834300200610     C*       ZTOND   5 0     TOTAL NUMBER OF INTEREST DAYS               S01486
834400200610     C*                                                                   S01486
834500200610     C*  WORK FIELDS:                                                     S01486
834600200610     C*                                                                   S01486
834700200610     C*  CALLS:  ZACCR                                                    S01486
834800200610     C*                                                                   S01486
834900200610     C*  CALLED FROM:                                                     S01486
835000200610     C*                                                                   S01486
835100200610     C*  N.B. THE DEFINITION OF KEY LIST KSEE IS IN SUBROUTINE ZAINSH     S01486
835200200610     C*                                                                   S01486
835300200610     C********************************************************************S01486
835400200610     C           PSCH      BEGSR                             *** PSCH *** S01486
835500200610     C*                                                                   S01486
835600200610     C** DEFINE FIELDS                                                    S01486
835700200610     C                     Z-ADDZFMDAT    ZFMDAT  50                      S01486
835800200610     C                     Z-ADDZTODAT    ZTODAT  50                      S01486
835900200610     C******************** Z-ADDZCSBR     ZCSBR   30               S01486 081363
836000200610     C                     MOVELZCSBR     ZCSBR   3                       081363
836100200610     C**********           Z-ADDXCUST     XCUST   60                                   S01486 CSD027
836200200610     C                     MOVE XCUST     XCUST   6                                           CSD027
836300200610     C                     MOVE ZPTFR     ZPTFR   4                       S01486
836400200610     C                     MOVE ZSSNM     ZSSNM  10                       S01486
836500200610     C*                                                                   S01486
836600200610     C** SET THE TOTAL ACCRUED INTEREST ZTOAI AND TOTAL NUMBER OF         S01486
836700200610     C** INTEREST DAYS ZTOND EQUAL TO ZERO                                S01486
836800200610     C                     Z-ADD0         ZTOAI  150                      S01486
836900200610     C                     Z-ADD0         ZTOND   50                      S01486
837000200610     C*                                                                   S01486
837100200610     C** READ FIRST POSITION CHANGE AFTER LAST COUPON DATE                S01486
837200200610     C           BVALK1    SETLLPMBVALP1                                  S01486
837300200610     C                     READ PMBVALP1                 91               S01486
837400200610     C           *IN91     DOWEQ'0'                                       S01486
837500200610     C           RVPDAT    ANDLTZTODAT                                    S01486
837600200610     C           RVCSBR    ANDEQZCSBR                                     S01486
837700200610     C           RVTDSS    ANDEQZSSNM                                     S01486
837800200610     C           RVCNUM    ANDEQXCUST                                     S01486
837900200610     C           RVPTFR    ANDEQZPTFR                                     S01486
838000200610     C*                                                                   S01486
838100200610     C           RVCSNV    SUB  RVCSEX    ZAMT                            S01486
838200200610     C*                                                                   S01486
838300200610     C** SET UP PARAMETERS AND PERFORM SR/ZACCR. COUPON INTEREST IS       S01486
838400200610     C** CALCULATED USING THE POSITION FROM THE DAY AFTER THE POSITION    S01486
838500200610     C** CHANGED                                                          S01486
838600200610     C                     Z-ADDRVPDAT    ZSDATE                          S01486
838700200610     C           NCD       IFLT RVNDAT                                    S01486
838800200610     C                     Z-ADDNCD       ZEDATE                          S01486
838900200610     C                     ELSE                                           S01486
839000200610     C                     Z-ADDRVNDAT    ZEDATE                          S01486
839100200610     C                     END                                            S01486
839200200610     C                     Z-ADDCPNR      IRATE                           S01486
839300200610     C*                                                                   S01486
839400200610     C** EXECUTE STANDARD SUBROUTINE ZACCR TO CALCULATE THE INTEREST      S01486
839500200610     C** FOR THE PERIOD                                                   S01486
839600200610     C                     EXSR ZACCR                                     S01486
839700200610     C/COPY WNCPYSRC,SE2380C048
839800200610     C*                                                                   S01486
839900200610     C** ADD THE ACCRUED INTEREST ZACCRD FROM ZACCR TO THE TOTAL          S01486
840000200610     C** ACCRUED INTEREST ZTOAI                                           S01486
840100200610     C                     ADD  ZACCRD    ZTOAI                           S01486
840200200610     C*                                                                   S01486
840300200610     C** ADD THE NUMBER OF DAYS ZDDAYS FROM ZACCR TO THE TOTAL NUMBER     S01486
840400200610     C** OF INTEREST DAYS ZTOND                                           S01486
840500200610     C                     ADD  ZDDAYS    ZTOND                           S01486
840600200610     C                     READ PMBVALP1                 91               S01486
840700200610     C                     END                                            S01486
840800200610     C*                                                                   S01486
840900200610     C                     ENDSR                                          S01486
841000200610      *****************************************************************
841100200610     C/EJECT                                                              S01486
841200200610     C********************************************************************S01486
841300200610     C**  ZTNLU1     :       TO LOCK THE TRANSACTION NUMBER DATA AREA,    S01486
841400200610     C**                     ACCESS THE NEXT AVAILABLE TRANSACTION NUMBER,S01486
841500200610     C**                     THEN UPDATE AND RELEASE THE DATA AREA.       S01486
841600200610     C********************************************************************S01486
841700200610     C           ZTNLU1    BEGSR                            ** ZTNLU1 BSR*S01486
841800200610     C*                                                                   S01486
841900200610     C           *NAMVAR   DEFN MNATN     DNATN                           S01486
842000200610     C           *LOCK     IN   DNATN                                     S01486
842100200610     C                     MOVE FNATN     NATN    50                      S01486
842200200610     C                     MOVE FNATN     ZZWK05  50                      S01486
842300200610     C                     ADD  1         ZZWK05                          S01486
842400200610     C                     MOVE ZZWK05    FNATN                           S01486
842500200610     C                     OUT  DNATN                                     S01486
842600200610     C*                                                                   S01486
842700200610     C                     ENDSR                            ** ZTNLU1 ESR*S01486
842800200610      *****************************************************************   S01486
842900200610      *****************************************************************                    AR1001183
843000200610      ***/SPACE*3                                                               AR1001183 AR1001183A
843100200610      *****************************************************************                    AR1001183
843200200610      *****************************************************************         AR1001183 AR1001183A
843300200610      ***GETNCR*-*SubroutiNE*to*get*next*coupon*rate*******************         AR1001183 AR1001183A
843400200610      *************************************************************** *         AR1001183 AR1001183A
843500200610      *****************************************************************                    AR1001183
843600200610      **********                                                                AR1001183 AR1001183A
843700200610     C********** GETNCR    BEGSR                                                AR1001183 AR1001183A
843800200610      **********                                                                AR1001183 AR1001183A
843900200610     C**********           Z-ADDBASC      UBASC                                 AR1001183 AR1001183A
844000200610     C**********           Z-ADDBASS      UBASS                                 AR1001183 AR1001183A
844100200610     C**********           MOVE SPRI      USPRI                                 AR1001183 AR1001183A
844200200610     C**********           MOVELCNSP      UCNSP                                 AR1001183 AR1001183A
844300200610     C**********           MOVELCNSG      UCNSG                                 AR1001183 AR1001183A
844400200610     C**********           MOVELRDMT      URDMT                                 AR1001183 AR1001183A
844500200610     C**********           MOVELRDFD      URDFD                                 AR1001183 AR1001183A
844600200610      ***Initialize*work*fields                                                 AR1001183 AR1001183A
844700200610      **********                                                                AR1001183 AR1001183A
844800200610     C**********           MOVEL*BLANKS   WAD                                   AR1001183 AR1001183A
844900200610     C**********           MOVEL*BLANKS   WBR                                   AR1001183 AR1001183A
845000200610     C**********           MOVEL*BLANKS   WBS                                   AR1001183 AR1001183A
845100200610     C**********           MOVEL*BLANKS   WSI                                   AR1001183 AR1001183A
845200200610     C**********           MOVEL*BLANKS   WRM                                   AR1001183 AR1001183A
845300200610     C**********           MOVEL*BLANKS   WRF                                   AR1001183 AR1001183A
845400200610      **********                                                                AR1001183 AR1001183A
845500200610      ***LOAD*APPLICABLE*DATE*INTO*ARRAY                                        AR1001183 AR1001183A
845600200610     C**********           Z-ADDAD01      WAD,1                                 AR1001183 AR1001183A
845700200610     C**********           Z-ADDAD02      WAD,2                                 AR1001183 AR1001183A
845800200610     C**********           Z-ADDAD03      WAD,3                                 AR1001183 AR1001183A
845900200610     C**********           Z-ADDAD04      WAD,4                                 AR1001183 AR1001183A
846000200610     C**********           Z-ADDAD05      WAD,5                                 AR1001183 AR1001183A
846100200610     C**********           Z-ADDAD06      WAD,6                                 AR1001183 AR1001183A
846200200610     C**********           Z-ADDAD07      WAD,7                                 AR1001183 AR1001183A
846300200610     C**********           Z-ADDAD08      WAD,8                                 AR1001183 AR1001183A
846400200610     C**********           Z-ADDAD09      WAD,9                                 AR1001183 AR1001183A
846500200610     C**********           Z-ADDAD10      WAD,10                                AR1001183 AR1001183A
846600200610      **********                                                                AR1001183 AR1001183A
846700200610      ***LOAD*BASE*RATE*INTO*ARRAY                                              AR1001183 AR1001183A
846800200610     C**********           Z-ADDBR01      WBR,1                                 AR1001183 AR1001183A
846900200610     C**********           Z-ADDBR02      WBR,2                                 AR1001183 AR1001183A
847000200610     C**********           Z-ADDBR03      WBR,3                                 AR1001183 AR1001183A
847100200610     C**********           Z-ADDBR04      WBR,4                                 AR1001183 AR1001183A
847200200610     C**********           Z-ADDBR05      WBR,5                                 AR1001183 AR1001183A
847300200610     C**********           Z-ADDBR06      WBR,6                                 AR1001183 AR1001183A
847400200610     C**********           Z-ADDBR07      WBR,7                                 AR1001183 AR1001183A
847500200610     C**********           Z-ADDBR08      WBR,8                                 AR1001183 AR1001183A
847600200610     C**********           Z-ADDBR09      WBR,9                                 AR1001183 AR1001183A
847700200610     C**********           Z-ADDBR10      WBR,10                                AR1001183 AR1001183A
847800200610      **********                                                                AR1001183 AR1001183A
847900200610     C**********           Z-ADDCNP01     WBS,1                                 AR1001183 AR1001183A
848000200610     C**********           Z-ADDCNP02     WBS,2                                 AR1001183 AR1001183A
848100200610     C**********           Z-ADDCNP03     WBS,3                                 AR1001183 AR1001183A
848200200610     C**********           Z-ADDCNP04     WBS,4                                 AR1001183 AR1001183A
848300200610     C**********           Z-ADDCNP05     WBS,5                                 AR1001183 AR1001183A
848400200610     C**********           Z-ADDCNP06     WBS,6                                 AR1001183 AR1001183A
848500200610     C**********           Z-ADDCNP07     WBS,7                                 AR1001183 AR1001183A
848600200610     C**********           Z-ADDCNP08     WBS,8                                 AR1001183 AR1001183A
848700200610     C**********           Z-ADDCNP09     WBS,9                                 AR1001183 AR1001183A
848800200610     C**********           Z-ADDCNP10     WBS,10                                AR1001183 AR1001183A
848900200610      **********                                                                AR1001183 AR1001183A
849000200610      ***LOAD*CONTRACTUAL*SPREAD*INDICATOR*INTO*ARRAY                           AR1001183 AR1001183A
849100200610      **********                                                                AR1001183 AR1001183A
849200200610     C**********           MOVEACNG01     WSI,1                                 AR1001183 AR1001183A
849300200610     C**********           MOVEACNG02     WSI,2                                 AR1001183 AR1001183A
849400200610     C**********           MOVEACNG03     WSI,3                                 AR1001183 AR1001183A
849500200610     C**********           MOVEACNG04     WSI,4                                 AR1001183 AR1001183A
849600200610     C**********           MOVEACNG05     WSI,5                                 AR1001183 AR1001183A
849700200610     C**********           MOVEACNG06     WSI,6                                 AR1001183 AR1001183A
849800200610     C**********           MOVEACNG07     WSI,7                                 AR1001183 AR1001183A
849900200610     C**********           MOVEACNG08     WSI,8                                 AR1001183 AR1001183A
850000200610     C**********           MOVEACNG09     WSI,9                                 AR1001183 AR1001183A
850100200610     C**********           MOVEACNG10     WSI,10                                AR1001183 AR1001183A
850200200610      **********                                                                AR1001183 AR1001183A
850300200610      ***LOAD*ROUNDING*METHOD*INTO ARRAY                                        AR1001183 AR1001183A
850400200610      **********                                                                AR1001183 AR1001183A
850500200610     C**********           MOVELRDM01     WRM,1                                 AR1001183 AR1001183A
850600200610     C**********           MOVELRDM02     WRM,2                                 AR1001183 AR1001183A
850700200610     C**********           MOVELRDM03     WRM,3                                 AR1001183 AR1001183A
850800200610     C**********           MOVELRDM04     WRM,4                                 AR1001183 AR1001183A
850900200610     C**********           MOVELRDM05     WRM,5                                 AR1001183 AR1001183A
851000200610     C**********           MOVELRDM06     WRM,6                                 AR1001183 AR1001183A
851100200610     C**********           MOVELRDM07     WRM,7                                 AR1001183 AR1001183A
851200200610     C**********           MOVELRDM08     WRM,8                                 AR1001183 AR1001183A
851300200610     C**********           MOVELRDM09     WRM,9                                 AR1001183 AR1001183A
851400200610     C**********           MOVELRDM10     WRM,10                                AR1001183 AR1001183A
851500200610      **********                                                                AR1001183 AR1001183A
851600200610      ***LOAD*ROUNDING*FRACTION/DECIMAL*INTO*ARRAY                              AR1001183 AR1001183A
851700200610      **********                                                                AR1001183 AR1001183A
851800200610     C**********           MOVELRDF01     WRF,1                                 AR1001183 AR1001183A
851900200610     C**********           MOVELRDF02     WRF,2                                 AR1001183 AR1001183A
852000200610     C**********           MOVELRDF03     WRF,3                                 AR1001183 AR1001183A
852100200610     C**********           MOVELRDF04     WRF,4                                 AR1001183 AR1001183A
852200200610     C**********           MOVELRDF05     WRF,5                                 AR1001183 AR1001183A
852300200610     C**********           MOVELRDF06     WRF,6                                 AR1001183 AR1001183A
852400200610     C**********           MOVELRDF07     WRF,7                                 AR1001183 AR1001183A
852500200610     C**********           MOVELRDF08     WRF,8                                 AR1001183 AR1001183A
852600200610     C**********           MOVELRDF09     WRF,9                                 AR1001183 AR1001183A
852700200610     C**********           MOVELRDF10     WRF,10                                AR1001183 AR1001183A
852800200610      ***CHECK*IF*THE*NEXT*COUPON*DATE*IS*GREATER*OR*EQUAL*TO*ANY*OF            AR1001183 AR1001183A
852900200610      ***THE*ADDITIONAL*COUPON*DATES.*IF*IT*IS*THAN*USE*THE*BASE*RATE           AR1001183 AR1001183A
853000200610      ***INFORMATION*SUPPLIED.                                                  AR1001183 AR1001183A
853100200610      **********                                                                AR1001183 AR1001183A
853200200610     C**********           MOVE 'N'       WAPP    1                             AR1001183 AR1001183A
853300200610     C**********           Z-ADD10        X       20                            AR1001183 AR1001183A
853400200610      **********                                                                AR1001183 AR1001183A
853500200610     C********** X         DOWGT0                                               AR1001183 AR1001183A
853600200610      **********                                                                AR1001183 AR1001183A
853700200610     C********** WAD,X     IFNE *ZERO                                           AR1001183 AR1001183A
853800200610      **********                                                                AR1001183 AR1001183A
853900200610      ***CONVERT*DATE*TO*DAY*NUMBER                                             AR1001183 AR1001183A
854000200610     C**********           Z-ADDWAD,X     ZDATE                                 AR1001183 AR1001183A
854100200610     C**********           EXSR ZDATE1                                          AR1001183 AR1001183A
854200200610      **********                                                                AR1001183 AR1001183A
854300200610     C********** WDAT      IFGE ZDAYNO                                          AR1001183 AR1001183A
854400200610     C**********           MOVE 'Y'       WAPP                                  AR1001183 AR1001183A
854500200610     C**********           LEAVE                                                AR1001183 AR1001183A
854600200610     C**********           ENDIF                                                AR1001183 AR1001183A
854700200610      **********                                                                AR1001183 AR1001183A
854800200610     C**********           ENDIF                                                AR1001183 AR1001183A
854900200610     C**********           SUB  1         X                                     AR1001183 AR1001183A
855000200610     C**********           ENDDO                                                AR1001183 AR1001183A
855100200610      **********                                                                AR1001183 AR1001183A
855200200610      ***USE*RATE*FROM*ADDITIONAL*COUPON*DATE*INFORMATION                       AR1001183 AR1001183A
855300200610     C********** WAPP      IFEQ 'Y'                                             AR1001183 AR1001183A
855400200610      **********                                                                AR1001183 AR1001183A
855500200610      ***SET*NEW*BASE*RATE                                                      AR1001183 AR1001183A
855600200610     C********** WBR,X     IFNE *ZERO                                           AR1001183 AR1001183A
855700200610     C**********           Z-ADDWBR,X     UBASC                                 AR1001183 AR1001183A
855800200610     C**********           ENDIF                                                AR1001183 AR1001183A
855900200610      **********                                                                AR1001183 AR1001183A
856000200610      ***SET*NEW*SPREAD*RATE                                                    AR1001183 AR1001183A
856100200610     C********** WBS,X     IFNE *ZERO                                           AR1001183 AR1001183A
856200200610     C**********           Z-ADDWBS,X     UBASS                                 AR1001183 AR1001183A
856300200610     C**********           ENDIF                                                AR1001183 AR1001183A
856400200610      **********                                                                AR1001183 AR1001183A
856500200610      ***SET*NEW*SPREAD*INDICATOR                                               AR1001183 AR1001183A
856600200610     C**********           MOVEAWSI,X     USPRI                                 AR1001183 AR1001183A
856700200610      **********                                                                AR1001183 AR1001183A
856800200610      ***SET*ROUNDING*METHOD                                                    AR1001183 AR1001183A
856900200610      **********                                                                AR1001183 AR1001183A
857000200610     C**********           MOVELWRM,X     URDMT                                 AR1001183 AR1001183A
857100200610      **********                                                                AR1001183 AR1001183A
857200200610      ***SET*ROUNDING*FRACTION/DECIMAL                                          AR1001183 AR1001183A
857300200610      **********                                                                AR1001183 AR1001183A
857400200610     C**********           MOVELWRF,X     URDFD                                 AR1001183 AR1001183A
857500200610      **********                                                                AR1001183 AR1001183A
857600200610     C**********           ENDIF                                                AR1001183 AR1001183A
857700200610      **********                                                                AR1001183 AR1001183A
857800200610     C********** UBASC     IFGT 0                                               AR1001183 AR1001183A
857900200610     C********** UBASS     ORGT 0                                               AR1001183 AR1001183A
858000200610      **********                                                                AR1001183 AR1001183A
858100200610      ***OBTAIN*BASE*RATE*INFO*FROM*SDBSRTPD                                    AR1001183 AR1001183A
858200200610     C**********           MOVE UBASC     PBSRC   2                             AR1001183 AR1001183A
858300200610      **********                                                                AR1001183 AR1001183A
858400200610     C**********           CALL 'AOBSRTR0'                                      AR1001183 AR1001183A
858500200610     C**********           PARM *BLANKS   @RTCD                                 AR1001183 AR1001183A
858600200610     C**********           PARM '*KEY   ' @OPTN                                 AR1001183 AR1001183A
858700200610     C**********           PARM VLCY      PCCY    3                             AR1001183 AR1001183A
858800200610     C**********           PARM           PBSRC                                 AR1001183 AR1001183A
858900200610     C********** SDBSRT    PARM SDBSRT    DSFDY                                 AR1001183 AR1001183A
859000200610      **********                                                                AR1001183 AR1001183A
859100200610     C********** @RTCD     IFNE *BLANKS                                         AR1001183 AR1001183A
859200200610     C**********           MOVELVLCY      WKEY2   5                             AR1001183 AR1001183A
859300200610     C**********           MOVE UBASC     WKEY2                                 AR1001183 AR1001183A
859400200610     C**********           Z-ADD69        DBASE                                 AR1001183 AR1001183A
859500200610     C**********           MOVEL'SDBSRTPD'DBFILE                                AR1001183 AR1001183A
859600200610     C**********           MOVELWKEY2     DBKEY                                 AR1001183 AR1001183A
859700200610     C**********           EXSR *PSSR                                           AR1001183 AR1001183A
859800200610     C**********           ENDIF                                                AR1001183 AR1001183A
859900200610      **********                                                                AR1001183 AR1001183A
860000200610      ***USE*NEW*BASE*RATE*IF*APPROPRIATE,*OTHERWISE*USE*CURRENT*RATE           AR1001183 AR1001183A
860100200610     C********** BAVDNR    IFLE WDAT                                            AR1001183 AR1001183A
860200200610     C**********           Z-ADDBANBRT    USDNC  117                            AR1001183 AR1001183A
860300200610     C**********           ELSE                                                 AR1001183 AR1001183A
860400200610     C**********           Z-ADDBACBSR    USDNC                                 AR1001183 AR1001183A
860500200610     C**********           ENDIF                                                AR1001183 AR1001183A
860600200610      **********                                                                AR1001183 AR1001183A
860700200610     C**********           CALL SPRDSR                                          AR1001183 AR1001183A
860800200610     C**********           PARM *BLANKS   PRTCD                                 AR1001183 AR1001183A
860900200610     C**********           PARM           BANBRT                                AR1001183 AR1001183A
861000200610     C**********           PARM           UBASS                                 AR1001183 AR1001183A
861100200610     C**********           PARM           USPRI                                 AR1001183 AR1001183A
861200200610     C**********           PARM           URDMT                                 AR1001183 AR1001183A
861300200610     C**********           PARM           URDFD                                 AR1001183 AR1001183A
861400200610     C**********           PARM *ZERO     NSPRD  117                            AR1001183 AR1001183A
861500200610     C**********           PARM *ZERO     FRATE  117                            AR1001183 AR1001183A
861600200610      **********                                                                AR1001183 AR1001183A
861700200610     C********** PRTCD     IFNE *BLANK                                          AR1001183 AR1001183A
861800200610     C********** *LOCK     IN   LDA                                             AR1001183 AR1001183A
861900200610     C**********           Z-ADD70        DBASE                                 AR1001183 AR1001183A
862000200610     C**********           MOVELSPRDSR    DBPGM                                 AR1001183 AR1001183A
862100200610     C**********           MOVELBANBRT    DBKEY                                 AR1001183 AR1001183A
862200200610     C**********           OUT  LDA                                             AR1001183 AR1001183A
862300200610     C**********           EXSR *PSSR                                           AR1001183 AR1001183A
862400200610     C**********           ENDIF                                                AR1001183 AR1001183A
862500200610      **********                                                                AR1001183 AR1001183A
862600200610     C**********           Z-ADDFRATE     WPSXR  138                            AR1001183 AR1001183A
862700200610     C**********           MOVE 'Y'       WRCHG                                 AR1001183 AR1001183A
862800200610      **********                                                                AR1001183 AR1001183A
862900200610      ***Override*value*of*PSXR*if*final*rate*<=*zero                           AR1001183 AR1001183A
863000200610      **********                                                                AR1001183 AR1001183A
863100200610     C********** FRATE     IFLE 0                                               AR1001183 AR1001183A
863200200610     C**********           Z-ADD0         WPSXR                                 AR1001183 AR1001183A
863300200610     C**********           ENDIF                                                AR1001183 AR1001183A
863400200610      **********                                                                AR1001183 AR1001183A
863500200610     C**********           ENDIF                                                AR1001183 AR1001183A
863600200610      **********                                                                AR1001183 AR1001183A
863700200610     C**********           ENDSR                                                AR1001183 AR1001183A
863800200610      **********                                                                AR1001183 AR1001183A
863900200610      *
864000200610      *****************************************************************
864100200610      /EJECT                                                              S01117
864200200610      *****************************************************************   S01117
864300200610      *                                                               *   S01117
864400200610      *  *PSSR  - Error control subroutine                            *   S01117
864500200610      *                                                               *   S01117
864600200610      *****************************************************************   S01117
864700200610      *                                                                   S01117
864800200610     C           *PSSR     BEGSR                           ** *PSSR **    S01117
864900200610     C**                                                                  S01117
865000200610     C           @RUN      IFEQ *BLANKS                                   S01117
865100200610     C                     MOVE 'Y'       @RUN    1                       S01117
865200200610     C                     DUMP                                           S01117
865300200610     C                     END                                            S01117
865400200610     C**                                                                  S01117
865500200610     C                     ENDSR                                          S01117
865600200610      *                                                                   S01117
865700200610     C*****************************************************************
865800200610     C/COPY WNCPYSRC,SE2380C016
865900200610      /EJECT                                                              064754
866000200610     C/COPY ZSRSRC,ZNCDZ3                                                 064754
866100200610      /EJECT                                                              S01512
866200200610     C/COPY ZSRSRC,ZACCH                                                  S01512
866300200610      /EJECT                                                              S01519
866400200610     C/COPY ZSRSRC,ZAVPRZ1                                                S01519
866500200610      /EJECT                                                              S01519
866600200610     C/COPY ZSRSRC,ZCCAL1Z2                                               S01519
866700200610      /EJECT                                                              S01519
866800200610     C/COPY ZSRSRC,ZCCAL2Z1                                               S01519
866900200610      /EJECT
867000200610     C/COPY ZSRSRC,ZCNSDZ1                                                E22638
867100200610      /EJECT                                                              S01509
867200200610     C/COPY ZSRSRC,ZCONVZ1                                                S01509
867300200610      /EJECT                                                              E22638
867400200610     C/COPY ZSRSRC,ZCCYGBZ1                                               S01486
867500200610     C/COPY ZSRSRC,ZCCYCN                                                 S01486
867600200610     C/COPY ZSRSRC,ZCCYXR                                                 S01486
867700200610     C/COPY ZSRSRC,ZAINSH                                                 S01486
867800200610     C/COPY ZSRSRC,ZACCRZ1                                                S01486
867900200610     C/COPY ZSRSRC,ZRATEZ1                                                S01486
868000200610     C/COPY ZSRSRC,ZDYYRZ3                                                S01486
868100200610     C/COPY ZSRSRC,ZDAYSZ2                                                S01486
868200200610     C/COPY ZSRSRC,ZDATE2Z4
868300200610      /EJECT
868400200610     C/COPY ZSRSRC,ZDATE1Z2                                               E29307
868500200610      /EJECT                                                              S01512
868600200610     C/COPY ZSRSRC,ZFWDT                                                  S01512
868700200610      /EJECT
868800200610     C/COPY ZSRSRC,ZLCDZ1                                                 E29307
868900200610      /EJECT
869000200610     C/COPY ZSRSRC,ZHASHZ3
869100200610      /EJECT
869200200610     C/COPY ZSRSRC,ZICD2Z1
869300200610      /EJECT
869400200610     C/COPY ZSRSRC,ZICDSEZ1
869500200610      /EJECT
869600200610     C/COPY ZSRSRC,ZSDESCZ3
869700200610      /EJECT
869800200610     C/COPY ZSRSRC,ZSEDITZ3
869900200610      /EJECT
870000200610     C/COPY ZSRSRC,ZSYSTMZ1
870100200610      ****/EJECT                                                          E23169
870200200610     C**********/COPY ZSRSRC,ZXRATEZ1                                     E23169
870300200610     C/COPY ZSRSRC,ZXRATEZ1                                               S01446
870400200610     C/COPY WNCPYSRC,SE2380C019
870500200610      /EJECT
870600200610      ***
870700200610     C/COPY WNCPYSRC,SE2380C033
870800200610**  CPY@
870900200610(c) Finastra International Limited 2001
871000200610**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
87110020061000000001
87120020061000000010
87130020061000000100
87140020061000001000
87150020061000010000
87160020061000100000
87170020061001000000
87180020061010000000
871900200610**  POWER - Array of powers for currency conversion
8720002006100000001
8721002006100000010
8722002006100000100
8723002006100001000
8724002006100010000
8725002006100100000
8726002006101000000
872700200610**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
8728002006100366073110961461
872900200610**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
873000200610000031059090120151181212243273304334365
873100200610**   ZMNM - MONTHS SHORT NAMES
873200200610JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
873300200610**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
8734002006100006001521029820444305904073650882610287117481320914670161311759219053
8735002006102051421975234362489726358278192928030741322023366335124365853804639507
87360020061040968424294389045351
