000100200610     H        1
000200200610      *****************************************************************
000300200610/*STD *  RPGBASE                                                      *
000400200610/*EXI *  TEXT('Midas SE Gen a/c keys posn settles - depots')          *
000500200610     F*****************************************************************
000600200610     F*                                                               *
000700200610     F*  Midas - Securities Trading Module                            *
000800200610     F*                                                               *
000900200610     F*  SE2390  - GENERATE NEW ACCOUNT KEYS AND POSITION SETTLEMENTS *
001000200610     F*            - DEPOT POSITIONS                                  *
001100200610     F*                                                               *
001200200610     F*  Function: This program reads through the Security Actions by *
001300200610     F*   (COB)    Security File and for each live Security Action,   *
001400200610     F*            accesses the Depot Positions by Security File. For *
001500200610     F*            each Depot Position found for the Security where   *
001600200610     F*            the Position Date is before the Action Date, the   *
001700200610     F*            program produces an Account Key and/or a Position  *
001800200610     F*            Settlement as required, (determined by indicators  *
001900200610     F*            on the Security Actions File). Account Keys are    *
002000200610     F*            written to PF/SEKEYD and Position Settlements to   *
002100200610     F*            PF/POSETD. In both cases, data is written to member*
002200200610     F*            DPOSN2, the Files having been overridden in the CL.*
002300200610     F*            Position Settlements are generated for these       *
002400200610     F*            Actions: Dividend, Coupon, Part Payment, Mortgage  *
002500200610     F*            Payment, Maturity.                                 *
002600200610     F*                                                               *
002700200610     F*  Called By: SEC0606E - Generate Account Keys and Position     *
002800200610     F*                        Settlements for Depot Positions        *
002900200610     F*                        (which have not changed today and have *
003000200610     F*                        security actions due)                  *
003100200610     F*                                                               *
003200200610     F*  Calls: ZACCRD - Calculate Interest - Depot Positions         *
003300200610     F*                                                               *
003400200610      *  (c) Finastra International Limited 2001                      *
003500200610     F*                                                               *
003501200616      *  Last Amend No. AR324886           Date 01JUN20               *
003600200616      *  PREV Amend No. 248698             Date 01Jun20               *
003700200616      *                 248184             Date 01Jun20               *
003800200610      *                 MD052583           Date 22Jan19               *
003900200610      *                 MD046248           Date 27Oct17               *
004000200610      *                 MD037742           Date 04Apr16               *
004100200610      *                 260331             Date 31Mar16               *
004200200610      *                 215959             Date 21Mar16               *
004300200610      *                 AR1067108          Date 11Dec12               *
004400200610      *                 AR1001183A         Date 20Nov12               *
004500200610      *                 AR1001183          Date 14Jul12               *
004600200610      *                 251950A            Date 27Feb12               *
004700200610      *                 AR853119           Date 24Nov11               *
004800200610      *                 CSW210             Date 04May10               *
004900200610      * Bank Fusion Midas 1.4 Base -----------------------------------*
005000200610      * Midas Plus 1.4 Base 04 ---------------------------------------*
005100200610      * Midas Plus 1.4 Base ------------------------------------------*
005200200610      * Midas Plus 1.3 ----------- Base ------------------------------*
005300200610      *                 CSD031             Date 10Apr06               *
005400200610      *                 BUG11046           Date 05May06               *
005500200610      *                 BUG11198           Date 26Apr06               *
005600200610      *                 CSD027             Date 09Dec05               *
005700200610      *                 233709             Date 16Jun05               *
005800200610      *                 CSE075             Date 17Nov05               *
005900200610      *                 CSE071             Date 19Jul05               *
006000200610      *                 CLE025             Date 20Oct03               *
006100200610      *                 CGL029             Date 01Sep03               *
006200200610      *                 CAS006             Date 21Jan03               *
006300200610      *                 CAP182             Date 19Feb03               *
006400200610      *                 CSE037             Date 29Apr02               *
006500200610      *                 CSE035             Date 22Apr02               *
006600200610      *                 CGL020             Date 12Dec02               *
006700200610      * Midas Release 4.01.02 ----------------------------------------*
006800200610      *                 192467             Date 26Jul01               *
006900200610      *                 194195             Date 15Apr02               *
007000200610      * Midas Release 4.01 -------------------------------------------*
007100200610      *                 CSE034             Date 18Apr02               *
007200200610      *                 136297             Date 07Feb02               *
007300200610      * Midas Release 4 --------------- Base -------------------------*
007400200610      *                 CSE028             Date 06Jun01               *
007500200610      * Midas DBA 3.04 -----------------------------------------------*
007600200610      *                 CSE023             Date 31Aug00               *
007700200610      * Midas DBA 3.03 -----------------------------------------------*
007800200610      *                 175400             Date 03Mar00               *
007900200610      *                 162208             Date 04May00               *
008000200610     F*                 131379             Date 27MAR00               *
008100200610     F*                 152391             DATE 15Mar00               *
008200200610     F*                 147449             DATE 15Mar00               *
008300200610      * Midas DBA 3.02 -----------------------------------------------*
008400200610      * Midas DBA 3.00 ---------------- Base -------------------------*
008500200610     F*                 147514             Date 20Nov98               *
008600200610     F*                 147869             Date 19NOV98               *
008700200610     F*                 143690             Date 05Oct98               *
008800200610     F*                 CEU005             Date 04Feb98               *
008900200610     F*                 095066             DATE 19FEB98               *
009000200610     F*                 100537             DATE 05FEB98               *
009100200610     F*                 114458             DATE 03FEB98               *  *
009200200610     F*                 CAC002             Date 15Sep96               *
009300200610     F*                 S01408             Date 14Oct96               *
009400200610     F*                 S01408             Date 27Sep96               *
009500200610     F*                 094839             Date 16Jul96               *
009600200610     F*                 074380             Date 28May96               *
009700200610     F*                 103361             DATE 28MAY96               *
009800200610     F*                 103017             DATE 09MAY96               *
009900200610     F*                 103011             DATE 09MAY96               *
010000200610     F*                 088423             DATE 16JUN95               *
010100200610     F*                 087712             DATE 15JUN95               *
010200200610     F*                 087178             DATE 15JUN95               *
010300200610     F*                 084669             DATE 06JUN95               *
010400200610     F*                 086386             DATE 16MAR95               *
010500200610     F*                 081439             DATE 10JAN95               *
010600200610     F*                 S01486             DATE 06JUN94               *
010700200610     F*                 S01496             DATE 07OCT94               *
010800200610     F*                 S01512             DATE 10AUG94               *
010900200610     F*                 S01510             DATE 10AUG94               *
011000200610     F*                 S01509             DATE 10AUG94               *
011100200610     F*                 065301             DATE 06MAY94               *
011200200610     F*                 066777             DATE 26FEB94               *
011300200610     F*                 S01447             DATE 29NOV93               *
011400200610     F*                 055420             DATE 26NOV93               *
011500200610     F*                 054257             DATE 26NOV93               *
011600200610     F*                 052254             DATE 26NOV93               *
011700200610     F*                 051107             DATE 26NOV93               *
011800200610     F*                 S01401             DATE 16JUN93               *
011900200610     F*                 S01397             DATE 10SEP92               *
012000200610     F*                 E37528             DATE 30MAR92               *
012100200610     F*                 E36391             DATE 17MAR92               *
012200200610     F*                 E29170             DATE 07NOV91               *
012300200610     F*                 S01117             DATE 23MAY91               *
012400200610     F*                 S01269             DATE 01AUG90               *
012500200610     F*                 S01271             DATE 19JUN90               *
012600200610     F*                 E23807             DATE 02OCT90               *
012700200610     F*                 E23169             DATE 12SEP90               *
012800200610     F*                 E21584             DATE 26JUN90               *
012900200610     F*                 E21573             DATE 26JUN90               *
013000200610     F*                 E21715             DATE 20JUN90               *
013100200610     F*                 E20972             DATE 15FEB90               *
013200200610     F*                 E21138             DATE 15FEB90               *
013300200610     F*                 E19610             DATE 06DEC89               *
013400200610     F*                 E20016             DATE 04DEC89               *
013500200610     F*                 E19430             DATE 09NOV89               *
013600200610     F*                 E20151             DATE 09NOV89               *
013700200610     F*                 E20086             DATE 08NOV89               *
013800200610     F*                 E19770             DATE 20OCT89               *
013900200610     F*                 E16085             DATE 25AUG89               *
014000200610     F*                 E18803             DATE 17AUG89               *
014100200610     F*                 E18221             DATE 15AUG89               *
014200200610     F*                 E16772             DATE 31/05/89              *
014300200610     F*                 S01176             DATE 08/11/88              *
014400200610     F*                 E15696             DATE 20/10/88              *
014500200610     F*                 E15549             DATE 10/10/88              *
014600200610     F*                 E14236             DATE 12/09/88              *
014700200610     F*                 E14716             DATE 05/09/88              *
014800200610     F*                 E14506             DATE 08/08/88              *
014900200610     F*                 E14522             DATE 08/08/88              *
015000200610     F*                 E14438             DATE 27/07/88              *
015100200610     F*                                                               *
015200200610     F*---------------------------------------------------------------*
015300200610     F*                                                               *
015301200616      *  AR324886 - Implement 4-eyes processing in Position           *
015302200616      *             Settlement Maintenance.                           *
015400200610      *  248698 - Rounding discrepancies on some SE reports. Applied  *
015500200610      *           fix 228682.                                         *
015600200610      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
015700200610      *  248184 - Wrong security withholding tax calculation.  If     *
015800200610      *           S01496, use 4 dec places for tax rate else use 2.   *
015900200610      *  MD052583 - Reinstate deleted fixes CSE110                    *
016000200610      *  MD046248 - Finastra Rebranding                               *
016100200610      *  CSE110 - Condition Output of Partly Paid Account Key on      *
016200200610      *           Position Settlement.                                *
016300200610      *  MD037742 - Security diary events - pool factor reversal.     *
016400200610      *             Additional fix to initialize tax fields to prevent*
016500200610      *             garbage which cause decimal data error in COB.    *
016600200610      *  260331 - Incorrect posting created due to a deleted diary    *
016700200610      *           event. Applied fix 255857.                          *
016800200610      *         - Applied for MD-37742.                               *
016900200610      *  215959 - Truncation error on event amount in SE2450P3.       *
017000200610      *           Recompiled due to changes in PF/SEKEYD.             *
017100200610      *         - Applied for MD-37439.                               *
017200200610      *  AR1067108 - PMC1140 Component failed during Clean COB        *
017300200610      *              Applied fix AR1001183A                           *
017400200610      *  AR1001183A - Coupon rate was still used in computation of    *
017500200610      *              interest instead of using the details in FRN tab *
017600200610      *              (Reopen)                                         *
017700200610      *  AR1001183 - Coupon rate was still used in computation of     *
017800200610      *              interest instead of using the details in FRN tab *
017900200610      *  251950A - Component SEC1112 0001 terminated abnormally.      *
018000200610      *            Check if PSEB is blank, if it is move value of     *
018100200610      *            PBCA to CCTA, if not move value of PSEB to CCTA.   *
018200200610      *          - Applied for AR964313 (Child:AR964316)              *
018300200610      *  AR853119 - Position settlements generated from corporate     *
018400200610      *             action did not calculate stamp tax.               *
018500200610      *  CSW210 - SWIFT 2010 Changes                                  *
018600200610      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
018700200610      *  BUG11046 - Due date in position settlement should be equal   *
018800200610      *             to the coupon date. Remove the CSE075 codings     *
018900200610      *             which updates the due date field.                 *
019000200610      *  BUG11198 - Incorrect due amount on position settlement.      *
019100200610      *  CSD027 - Conversion Of Customer Number to Alpha              *
019200200610      *  233709 - Decimal Data error in SE2310                        *
019300200610      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
019400200610      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
019500200610      *  CLE025 - Credit Lines (Recompile)                            *
019600200610      *  CGL029 - Increase Account Code to 10 digits                  *
019700200610      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
019800200610      *  CAP182 - Auto Settlement of Trades                           *
019900200610      *           Recompile over changed SETLED                       *
020000200610      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
020100200610      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
020200200610      *  CGL020 - Compliance Watch - Addtl A/C Postings Information   *
020300200610      *  192467 - No maturity position settlement was generated.  Set *
020400200610      *           price for records with processing type '1' and      *
020500200610      *           price basis 'U'.                                    *
020600200610      *  194195 - Position settlements in base ccy incorrect when the *
020700200610      *           nominal ccy is an 'IN' ccy and settled in EUR via   *
020800200610      *           the standard settlement instructions (in STDSED).   *
020900200610      *  CSE034 - Standing Settlement Instruction improvements        *
021000200610      *  136297 - When settlement method 04 and no settlement account *
021100200610      *           defined, prime account number is defaulted ... If   *
021200200610      *           it does not exist, use suspense computer account    *
021300200610      *  CSE028 - Standing Settlement Instructions Enhancement.       *
021400200610      *  CSE023 - Treaty Withholding Tax                              *
021500200610     F*  175400 - Security position settlements not picking up the    *
021600200610     F*           security standard settlements if the securit nominal*
021700200610     F*           currency is an 'in' currency and being settled in   *
021800200610     F*           EURO. Remove fix 147869 and fix it differently since*
021900200610     F*           it caused the above problem. Based on 170568.      *
022000200610     F*  162208 - Amended program to move the Market Indicator of     *
022100200610     F*           the security to PMAR field.                         *
022200200610     F*  131379 - Incorrect account key for primary market at maturity*
022300200610     F*  152391 - Ensure that Mortgage Payment FV key is same sign    *
022400200610     F*           as nominal before Split Negative processing.        *
022500200610     F*  147449 - If position is short then mortgage payment is a     *
022600200610     F*           pay rather than a receive.                          *
022700200610     F*           If Nominal Position is zero then do not produce     *
022800200610     F*           MP Position Settlement record.                      *
022900200610     F*  147514 - Position settlement preparations are not taking     *
023000200610     F*           into account the Standard Settlement Instructions.  *
023100200610     F*           Apply fix 143851.  Use *IN88 when chaining to file  *
023200200610     F*           STDSED instead of *IN78 which is already in use.    *
023300200610     F*  147869 - Wrong settlement amount on accounting               *
023400200610     F*  143690 - Incorrect Mult/Div Ind. was being used when EURO    *
023500200610     F*           CCY was involved. Fix is to reverse the M/D ind. if *
023600200610     F*           Nominal CCY is equal to the EURO CCY.               *
023700200610     F*  CEU005 - EMU SE Settlement Ccy Conversion                    *
023800200610     F*  095066 - Switchable Feature introduced to use value date     *
023900200610     F*           position to calculate Dividend Payment, and should  *
024000200610     F*           also include position on Dividend day.              *
024100200610     F*  100537 - Take current factor into account when calculating   *
024200200610     F*           maturity amount                                     *
024300200610     F*  114458 - DATABASE ERROR IN SDRETLPD.  DO NOT CALL AORETLR0   *
024400200610     F*           IF RETAIL IS NOT SWITCH ON.                         *
024500200610     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
024600200610     F*           If Analytical Accounting is available, define the   *
024700200610     F*           profit centre for posting.                          *
024800200610     F*  S01408 - Addition of core hook SE2390CCP2                    *
024900200610     F*  S01408 - Addition of core hook SE2390CCP1                    *
025000200610     F*  094839 - For shares, trading on ex-dividend date not         *
025100200610     F*           considered.  Fix is to check trade date less than   *
025200200610     F*           or equal to SAEXD.                                  *
025300200610     F*  074380 - No check if AUMO is 'Y' because Position Settle-    *
025400200610     F*           ment with Settlement method '04' are posted on the  *
025500200610     F*           Suspense account.                                   *
025600200610     F*  103361 - If settlement method is '04' and settlement account *
025700200610     F*           is blank, retrieve prime account number.            *
025800200610     F*  103017 - Set RECI to 'D' when writing position settlement rec*
025900200610     F*  103011 - The system creates a position settlement MT* for    *
026000200610     F*           warrant which can lead to confusion for cashflow    *
026100200610     F*  088423 - If S01512 is on, event date should no longer be     *
026200200610     F*           payment date                                        *
026300200610     F*  087712 - Percentage price-based shares have dividend amount  *
026400200610     F*           calculated 100 times too much                       *
026500200610     F*  087178 - Settlement amount has to include charges, commis-   *
026600200610     F*           sions and taxes added to or deducted from amount due*
026700200610     F*  084669 - If no standard settlement method defined, settlement*
026800200610     F*           branch must be equal to booking branch              *
026900200610     F*  086386 - R10 Private Banking Rework                          *
027000200610     F*  081439 - Wrong update of field tax rate - Recompile          *
027100200610     F*  S01486 - PORTFOLIO MANAGEMENT UPGRADE                        *
027200200610     F*  S01496 - INCORPORATION OF JYSKE ENHANCEMENTS (S01512)        *
027300200610     F*           JUST RECOMPILE.                                     *
027400200610     F*  S01512 - Add Value Date to Position Settlements              *
027500200610     F*  S01510 - Dividend Payments based on Ex-date                  *
027600200610     F*  S01509 - Value Currency to be currency of Issuer of Payments *
027700200610     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
027800200610     F*           with ZAMT increased to 15,0.                        *
027900200610     F*  066777 - Output Last Change Date on new POSETD records.      *
028000200610     F*  S01447 - Withholding Tax.                                    *
028100200610     F*           Calculates withholding tax which are written to     *
028200200610     F*           new fields on position settlements file.            *
028300200610     F*  055420 - ROUNDING PROBLEM FOR MORTGAGE BACKED SECURITIES.    *
028400200610     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
028500200610     F*           to 10,9                                             *
028600200610     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
028700200610     F*  051107 - Program ignores Events BEFORE first Action Date. It *
028800200610     F*           should ALSO ignore Events ON the first Action Date  *
028900200610     F*           as they will not be affected, (eg. Coupon).         *
029000200610     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
029100200610     F*           - Position Settlement Message Indicator set to 'Y'  *
029200200610     F*             when Settlement Authorised by System.             *
029300200610     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
029400200610     F*           - Recompiled due to changes to files.               *
029500200610     F*  E37528 - Program recompiled for minor change to Audit Report.*
029600200610     F*  E36391 - Mortgage repayment amounts on A/C keys and Position *
029700200610     F*           Settlements use a incorrect change in current factor*
029800200610     F*  E29170 - Report Control Facility changes                     *
029900200610     F*  S01117 - Multi branching                                     *
030000200610     F*  S01269 - Trade authorisation: recompile over changed file    *
030100200610     F*           TABSE.                                              *
030200200610     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
030300200610     F*           to TRADSD and/or DPTMVD                             *
030400200610     F*  E23807 - Record locked by this job on DPOSS - remove E21715  *
030500200610     F*  E23169 - Partly paid call amount should be 10 times smaller  *
030600200610     F*           since pcntge amount is held on POSEB1 to 3 decimal  *
030700200610     F*           places. Settlement exchange rate should be equal    *
030800200610     F*           to exchange and not spot rate from SECTYD.          *
030900200610     F*           Processing changed to use ZCNSD for accuracy        *
031000200610     F*  E21584 - When accessing Standard Settlements, first look for *
031100200610     F*           a record with appropriate Investment Type; then, if *
031200200610     F*           no such record exists, try again with ITSI blank.   *
031300200610     F*  E21573 - Coupon at Maturity is now produced separately and   *
031400200610     F*           requires a Position Settlement to be generated from *
031500200610     F*           the Coupon Action.                                  *
031600200610     F*  E21715 - Must reset Ex-Coupon/Dividend field after Coupon/   *
031700200610     F*           Dividend Date processing.                           *
031800200610     F*  E20972 - Dividend Due Amount being truncated. Use SR/ZCNSD.  *
031900200610     F*  E21138 - Position Settlement Fixes:                          *
032000200610     F*           1.Amount due at maturity for customers must just be *
032100200610     F*             face value                                        *
032200200610     F*           2.A/C Keys produced when position settlements       *
032300200610     F*             produced and not on event date                    *
032400200610     F*  E19610 - For Shares/Equities use the Trade Date instead of   *
032500200610     F*           Value Date to calculate the Dividend Due.           *
032600200610     F*  E20016 - Use LF/SEDEV instead of SECED as SEDEV now ignores  *
032700200610     F*           records with RECI='C'                               *
032800200610     F*  E19430 - AT MATURITY , GENERATE SEPARATE POSITION SETTLEMENTS*
032900200610     F*           FOR INTEREST AND PRINCIPAL.                         *
033000200610     F*  E20151 - AMOUNT DUE AT MATURITY INFLATED BY FACTOR OF 100    *
033100200610     F*           FOR A YEN INSTRUMENT.                               *
033200200610     F*  E20086 - Mortgage-Backs and Current Factor Processing Rewrite*
033300200610     F*  E19770 - TO PRODUCE THE FOLLOWING A/C KEYS:-                 *
033400200610     F*           1) IIIR_X______MVN___FV  (MORTGAGE REPAYMENT)       *
033500200610     F*           2) IIIM_X______MVN___CV  (MATURITY)                 *
033600200610     F*  E16085 - TO RESET INVESTMENT TYPE IF DEPOT IS CEDEL AND      *
033700200610     F*           CUSTOMER NOT A MARKET CLIENT.                       *
033800200610     F*           TO SUPPRESS BOOK CODE IN ACCOUNT KEYS FOR           *
033900200610     F*           CHARGES AND COMMISSIONS.                            *
034000200610     F*  E18803 - SET ACCOUNT KEY SEQUENCE NO. TO ZERO TO ALLOW FOR   *
034100200610     F*           MULTI-BRANCH SYSTEMS.                               *
034200200610     F*  E18221 - BLANK CHTP FIELD CAUSING OVERPRINTING IN POS.       *
034300200610     F*           SETTL. AUDIT LIST.                                  *
034400200610     F*  E16772 - The Dividend Payment Amount field SDAU has been     *
034500200610     F*           replaced by the field SDUN, to increase its size    *
034600200610     F*           from 9,4 to 13,8                                    *
034700200610     F*  S01176 - SECURITIES TRADING 3.1 (AUSTRALIA)                  *
034800200610     F*  E15696 - UPDATE DEPOT POSNS ON MATURITY DATE (NOT BEFORE)    *
034900200610     F*  E15549 - FIXES CONNECTED WITH REDELIVERY OF POSITION         *
035000200610     F*           SETTLEMENT PROGRAMS FROM CD.                        *
035100200610     F*           1.LAST COUPON DATE MUST BE FOR 'CURRENT' PERIOD     *
035200200610     F*           2.IF POSITION IS PRIOR TO LAST COUPON DATE          *
035300200610     F*             ZEROIZE EX-COUPON NOMINAL.                        *
035400200610     F*           3.PROCESS ALL POSITIONS IF SECURITY ACTIONS PRESENT *
035500200610     F*           4.CALCULATE INTEREST ON LATEST POSITION (ZAB=A)     *
035600200610     F*  E14236 - PROCESS MATURITY DEPOT POSITION ACTIONS.            *
035700200610     F*  E14716 - EVENT CODE 'MA' CHANGED TO 'MT'                     *
035800200610     F*  E14506 - NO POSITION SETTLEMENTS ARE GENERATED FOR THE NEXT  *
035900200610     F*           DAY.                                                *
036000200610     F*  E14522 - TEST CONVERTIBLE INDICATOR (POSN 14 IN ACCOUNT      *
036100200610     F*           KEY) CORRECTLY.                                     *
036200200610     F*  E14438 - RECOMPILE PROGRAM FOR EUCLID INCORPORATION          *
036300200610     F*           AND UPGRADING OF FILES.                             *
036400200610     F*                                                               *
036500200610     F*****************************************************************
036600200610     F*                                                               *
036700200610     F*  C R E A T I O N     P A R A M E T E R S                      *
036800200610     F*                                                               *
036900200610     F*                                                               *
037000200610     F*****************************************************************
037100200610     F*
037200200610     FSECACA  IF  E                    DISK
037300200610     FPOSETA  O   E                    DISK         KINFDS POSADS
037400200610     F                                              KINFSR POSASR
037500200610     FSEKEYA  O   E                    DISK         KINFDS SEKADS
037600200610     F                                              KINFSR SEKASR
037700200610     FTABSE   IF  E           K        DISK
037800200610     F* ICD 1     TABTB10F                          KIGNORE
037900200610     F* ICD 2     TABTB11F                          KIGNORE
038000200610     F*           TABTB36F                          KIGNORE
038100200610     F            TABTB40F                          KIGNORE
038200200610     F** CRCY     TABTG10F                          KIGNORE
038300200610     F            TABTG20F                          KIGNORE
038400200610     F            TABLETHF                          KIGNORE
038500200610     F************TABLETJF                          KIGNORE               S01117
038600200610     F            TABLETLF                          KIGNORE
038700200610     F            TABLETRF                          KIGNORE
038800200610     F            TABLETXF                          KIGNORE
038900200610     F            TABLET2F                          KIGNORE
039000200610     F            TABLET3F                          KIGNORE
039100200610     F            TABLET5F                          KIGNORE
039200200610     F            TABTE10F                          KIGNORE
039300200610     F            TABLETNF                          KIGNORE
039400200610     F            TABLETKF                          KIGNORE
039500200610     F            TABLETPF                          KIGNORE
039600200610     F            TABLETAF                          KIGNORE
039700200610     F            TABTE20F                          KIGNORE
039800200610     FSE2390AUO   E                    PRINTER
039900200610     FSECTY   IF  E           K        DISK
040000200610     FSESWHTL0IF  E           K        DISK                               S01447
040100200610     F* Securities WHT details file                                       S01447
040200200610     F***********SECED   IF  E           K        DISK                    E20016
040300200610     FSEDEV   IF  E           K        DISK                               E20016
040400200610     FSECEO   IF  E           K        DISK                               E36391
040500200610     F            SEDEVDF                           KRENAMESEDEVDO        E36391
040600200610     F            SNDEVDF                           KRENAMESNDEVDO        E36391
040700200610     FINVTP   IF  E           K        DISK
040800200610     FSTDSED  IF  E           K        DISK
040900200610     FSECAC   IF  E           K        DISK
041000200610     F*DPOSH***IF**E           K        DISK                              E21715
041100200610     F*DPOSH***UF**E           K        DISK                       E21715 E23807
041200200610     FDPOSH   IF  E           K        DISK                               E23807
041300200610     F            DPOSNDF                           KRENAMEDPOSNDFH
041400200610     FSDCUSQL0IF  E           K        DISK                                                 AR853119
041500200610      **  Midas SD Stamp Tax Customer Extension file                                        AR853119
041600200610     FPOSETDX3O   E           K        DISK         KINFSR *PSSR                            AR853119
041700200610      ***  Position Settlements - Extension File                                            AR853119
041800200610      *                                                                                     AR853119
041900200610     F*POSS***IF**E           K        DISK                               E14236
042000200610     FDPOSS   UF  E           K        DISK                               E14236
042100200610     FSEKEYD  O   E           K        DISK         KINFDS SEKDDS
042200200610     F                                              KINFSR SEKDSR
042300200610     FPOSETD  O   E           K        DISK         KINFDS POSDDS
042400200610     F                                              KINFSR POSDSR
042401200616     FPSAUTD  O   E           K        DISK                                                 AR324886
042402200616      ** SE Position Settlement Authorisation detail                                        AR324886
042403200616      *                                                                                     AR324886
042500200610     FCLINT   IF  E           K        DISK                               E16085
042600200610     F            CLINTCAF                          KIGNORE               E16085
042700200610     F            CLINTCBF                          KIGNORE               E16085
042800200610     F            CLINTCCF                          KIGNORE               E16085
042900200610     F            CLINTC1F                          KIGNORE               E16085
043000200610     F************CLINTSEF                          KIGNORE               S01447
043100200610     FSDBRCHL0IF  E           K        DISK                               136297
043200200610     FTABTB20 IF  E                    DISK                               136297
043300200610     FACCNT   IF  E           K        DISK                               136297
043400200610     F/COPY WNCPYSRC,SE2390F001
043500200610      /EJECT
043600200610     F*****************************************************************
043700200610     F*                                                               *
043800200610     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
043900200610     F*                                                               *
044000200610     F*   29 - DIFFERENCE MESSAGE IS PRINTED                          *
044100200610     F*   44 - END OF RELEVANT RECORDS ON DPOSH                       *   E21715
044200200610     F*   60 - CURRENCY REQUIRES 0 DEC PLACES FOR CALCS               *
044300200610     F*   61 - CURRENCY REQUIRES 1 DEC PLACES FOR CALCS               *
044400200610     F*   62 - CURRENCY REQUIRES 2 DEC PLACES FOR CALCS               *
044500200610     F*   63 - CURRENCY REQUIRES 3 DEC PLACES FOR CALCS               *
044600200610     F*   66 - POSITION READ IS FROM DPOSH                            *   E21715
044700200610     F*   77 - END OF FILE ON READE OR RECORD EXISTS ON SETLL         *
044800200610     F*   79 - END OF DEPOT POSITIONS FOR THIS SECURITY               *
044900200610     F*   80 - SECURITIES WHT DETAILS FILE READ IN                    *   S01447
045000200610     F*   89 - END OF SECURITY ACTIONS FILE - STD REPORT AND END      *
045100200610     F*   87 - EXCEPTION ERROR ON UPDATED FILE - PRINTS STATUS/AUDIT  *
045200200610     F*   88 - Chain indicator for STDSED                             *   147514
045300200610     F*                                                               *
045400200610     F*90-99 - USED IN Z SUBROUTINES                                  *
045500200610     F*                                                               *
045600200610     F*   U7 - DATABASE ERROR                                         *
045700200610     F*   U8 - DATABASE ERROR                                         *
045800200610     F*                                                               *
045900200610     F*****************************************************************
046000200610      /EJECT
046100200610     F*****************************************************************
046200200610     F*                                                               *
046300200610     F*  S U B R O U T I N E   I N D E X                              *
046400200610     F*                                                               *
046500200610     F*  FIRST  - ACCESSES ICD INFORMATION                            *
046600200610     F*  GETDEP - OBTAIN LATEST CORRECT DEPOT POSITION DATE           *
046700200610     F*  DIVIND - PRODUCE DIVIDEND A/C KEY &/OR POSITION SETTLEMENT   *
046800200610     F*  COUPON - PRODUCE COUPON A/C KEY &/OR POSITION SETTLEMENT     *
046900200610     F*  PARTPY - PRODUCE PART PAYMENT POSITION SETTLEMENT            *
047000200610     F*  MORTPY - PRODUCE MORTGAGE PAYMENT POSITION SETTLEMENT        *
047100200610     F*  MATURE - PRODUCE MATURITY POSITION SETTLEMENT                *
047200200610     F*  W01    - WRITE ACCOUNT KEY                                  *
047300200610     F*  W02    - WRITE POSITION SETTLEMENT                           *
047400200610     F*  CALCTX - Calculate tax amounts for dividends/Coupons         *   S01447
047500200610     F*  SECTIN - GET SECURITY DETAIL RECORD IN                       *
047600200610     F*  INVTIN - GET INVESTMENT TYPE DETAIL RECORD IN                *
047700200610     F*  SECEDI - GET SECURITY EVENTS DETAIL RECORD IN                *
047800200610     F*  TG10   - GET TABTG10 RECORD FOR EACH CURRENCY AS REQUIRED    *
047900200610     F*  AUDIT  - OUTPUTS AUDIT RECORD UDEPPA AND CONTROL REPORT      *
048000200610     F*                                                               *
048100200610     F*  SEKDSR - ERROR HANDLING FOR SEKEYD                           *
048200200610     F*  SEKASR - ERROR HANDLING FOR SEKEYA                           *
048300200610     F*  POSDSR - ERROR HANDLING FOR POSETD                           *
048400200610     F*  POSASR - ERROR HANDLING FOR POSETA                           *
048500200610     F*                                                               *
048600200610     F*  ZACCH  - ACCESS RECORD FOR HOLIDAYS FILE                     *   S01512
048700200610     F*  ZFWDT  - FIND WORKING DAYS FORWARD                           *   S01512
048800200610     F*  ZHASH  - HASH TOTALLING STD SUBROUTINE                       *
048900200610     F*  ZICDSE - GET TABTB36 ICD                                     *
049000200610     F*  ZICD2  - GET TABTB11 ICD                                     *
049100200610     F*  ZSYSTM - GET TABTB10 ICD                                     *
049200200610     F***ZXRATE*-*CROSS*REF*EXCHANGE*RATE*CALCULATED**********************E23169
049300200610     F*                                                               *
049400200610     F*  ZACCRD - CALCULATE ACCRUED INTEREST ** PROGRAM CALL **       *
049500200610     F*  *PSSR  - EXCEPTION ERROR ROUTINE                             *   S01117
049600200610     F*                                                               *
049700200610     F*****************************************************************
049800200610      /EJECT
049900200610     F/COPY WNCPYSRC,SE2390F002
050000200610     E/COPY ZSRSRC,ZPOWER8Z1
050100200610     E/COPY ZSRSRC,ZPOWERZ1                                               S01509
050200200610     E/COPY ZSRSRC,ZHASHZ1
050300200610     E/COPY ZSRSRC,ZHOLE                                                  S01512
050400200610     E                    CPY@    1   1 80
050500200610     E**********          WAD        10  6 0                                    AR1001183 AR1001183A
050600200610     E**********          WBR        10  2 0                                    AR1001183 AR1001183A
050700200610     E**********          WBS        10 11 7                                    AR1001183 AR1001183A
050800200610     E**********          WSI        10  1                                      AR1001183 AR1001183A
050900200610     E**********          WRM        10  7                                      AR1001183 AR1001183A
051000200610     E**********          WRF        10  4                                      AR1001183 AR1001183A
051100200610     E***/COPY*ZSRSRC,ZDATE2Z1                                                  AR1001183 AR1001183A
051200200610     E***/COPY*ZSRSRC,ZDAYSZ1                                                   AR1001183 AR1001183A
051300200610      /EJECT
051400200610     ISECACDF                                                             E15549
051500200610     I              LCCP                            SALCCP                E15549
051600200610     ISEDEVDF                                                             E20086
051700200610     I              NMCY                            SNMCY                 E20086
051800200610     ISEDEVDO                                                             E36391
051900200610     I              NMCY                            SNMCY                 E36391
052000200610      *                                                                                       CSE037
052100200610     IINVTPDF                                                                                 CSE037
052200200610     I              SFLG                            ISFLG                                     CSE037
052300200610      *                                                                                       CSE028
052400200610      ** DS for customer/book standard settlement instruction                                 CSE028
052500200610      **  to be passed to SESSIR0                                                             CSE028
052600200610      *                                                                                       CSE028
052700200610     IPCBSTD    E DSSTDSED                    2                                               CSE028
052800200610     I              RECI                            WRECI                                     CSE028
052900200610     I              LCD                             WLCD                                      CSE028
053000200610     I              CHTP                            WCHTP                                     CSE028
053100200610     I              TNLU                            WTNLU                                     CSE028
053200200610      *                                                                                       CSE028
053300200610      ** Data structure for standard additional settlement details                            CSE028
053400200610      ** for customer/book to be passed to SESSIR0                                            CSE028
053500200610      *                                                                                       CSE028
053600200610     IPCBSAD    E DSSTDADSED                  8                                               CSE028
053700200610     I*
053800200610     ITABLKY      DS
053900200610     I*
054000200610     I*  TABTB11 TABLE KEY FIELD DATA STRUCTURE FOR DB ERROR
054100200610     I*
054200200610     I                                        1  12 TABKEY
054300200610     I                                        1   20RECT
054400200610     I                                        3  10 ZZ008
054500200610     I                                       11  120RCDE
054600200610     I*
054700200610     IPOSDDS      DS                            366
054800200610     I*
054900200610     I*  POSITION SETTLEMENTS  FILE ERROR EXCEPTION  DATA STRUCT.
055000200610     I*
055100200610     I                                     *STATUS  STSPSD
055200200610     I*
055300200610     ISEKDDS      DS                            366
055400200610     I*
055500200610     I*  GENERATED ACCOUNT KEYS FILE ERROR EXCEPTION  DATA STRUCT.
055600200610     I*
055700200610     I                                     *STATUS  STSSKD
055800200610     I*
055900200610     IPOSADS      DS                            366
056000200610     I*
056100200610     I*  POSITION SETTLEMENTS  AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
056200200610     I*
056300200610     I                                     *STATUS  STSPSA
056400200610     I*
056500200610     ISEKADS      DS                            366
056600200610     I*
056700200610     I* GENERATED ACCOUNT KEYS AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
056800200610     I*
056900200610     I                                     *STATUS  STSSKA
057000200610     I/COPY ZSRSRC,ZHASHZ2
057100200610     I*
057200200610     IWACKEY      DS
057300200610     I*
057400200610     I* ACCOUNT KEY DATA STRUCTURE SEE SUBR W01
057500200610     I*
057600200610     I                                        1   3 WACITY
057700200610     I                                        4   4 WACEVC
057800200610     I                                        5   5 WACTRT
057900200610     I                                        6   6 WACPFI
058000200610     I                                        7   8 WACBKC
058100200610     I                                        9  10 WACTST
058200200610     I                                        9  10 WACPSB
058300200610     I                                       11  12 WACCCC
058400200610     I                                       13  13 WACMKT
058500200610     I                                       14  14 WACCON
058600200610     I                                       15  15 WACNEG
058700200610     I                                       19  20 WACAMC
058800200610     I*
058900200610     IINVKEY      DS
059000200610     I*
059100200610     I* INVESTMENT TYPE FILE KEY FOR DB ERROR PRINTOUT
059200200610     I*
059300200610     I                                        1   3 NMCY
059400200610     I                                        4   6 SITP
059500200610     I* MIDAS ' NEXT AVAILABLE TRANSACTION NUMBER NO.'DATA AREA MNATN.    S01486
059600200610     IDNATN       DS                              5                       S01486
059700200610     I                                        1   50FNATN                 S01486
059800200610     ISDMMOD    E DSSDMMODPD                                              S01486
059900200610     I**  DS FOR ACCESS TO MODULES FILE                                   S01486
060000200610     I*
060100200610     ISDSTRD    E DSSDSTRDPD                                              CAC002
060200200610     I**  Securities Trading Details                                      CAC002
060300200610     I*                                                                   CAC002
060400200610     I/COPY WNCPYSRC,SE2390I002
060500200610     ILDA         DS                            256                       S01117
060600200610     I                                      134 183 DBLOT                 S01117
060700200610     I                                      134 141 DBFILE                S01117
060800200610     I                                      142 170 DBKEY                 S01117
060900200610     I                                      171 180 DBPGM                 S01117
061000200610     I                                      181 1830DBASE                 S01117
061100200610     I*                                                                   S01117
061200200610     I************LDA         DS                256                       S01117
061300200610     I************                          134 177 DBLOT                 S01117
061400200610     I************                          134 138 DBFILE                S01117
061500200610     I************                          139 167 DBKEY                 S01117
061600200610     I************                          168 175 DBPGM                 S01117
061700200610     I************                          176 1770DBASE                 S01117
061800200610     I*
061900200610     IPOSDDB      DS
062000200610     I*
062100200610     I* FILE POSETD DB ERROR KEY - OUTPUT FILE
062200200610     I*
062300200610     I***********                             1   30PBCH                  S01117
062400200610     I************                            1   3 PBCA          S01117  CSE023
062500200610     I************                            4  13 PSSH                  CSE023
062600200610     I************                           14  190PCPY                  CSE023
062700200610     I                                        1   3 PBCAK                 CSE023
062800200610     I                                        4  13 PSSHK                 CSE023
062900200610     I**********                             14  190PCPYK                              CSE023 CSD027
063000200610     I                                       14  19 PCPYK                                     CSD027
063100200610     I*                                                                   087178
063200200610     I***P@DATA******DS                         100                087178 CAC002
063300200610     I/COPY WNCPYSRC,SE2390I003
063400200610     I***P@DATA*     DS                            128                               CAC002 AR853119
063500200610     IP@DATA      DS                            141                                         AR853119
063600200610     I** Data structure for the parameter passed to and from SEZ010       087178
063700200610     I                                        1   1 P@CLAS                087178
063800200610     I                                        2   2 P@PPRE                087178
063900200610     I                                        3  150P@PAMD                087178
064000200610     I                                       16  280P@PCHA                087178
064100200610     I                                       29  410P@PCAM                087178
064200200610     I                                       42  540P@TASO                087178
064300200610     I                                       55  670P@TAUS                087178
064400200610     I                                       68  808P@PSXR                087178
064500200610     I                                       81  81 P@PMDI                087178
064600200610     I                                       82  84 P@PNCY                087178
064700200610     I                                       85  87 P@PSCU                087178
064800200610     I                                       88 1000P@PSAT                087178
064900200610     I                                      101 1138P@FXMR                CAC002
065000200610     I                                      114 1260P@MAMT                CAC002
065100200610     I                                      127 128 P@TDTP                CAC002
065200200610     I                                      129 1410P@STAM                                  AR853119
065300200610     I/COPY WNCPYSRC,SE2390I004
065400200610      * Prime account code                                                103361
065500200610     I            DS                                                      103361
065600200610     I**********                              1  12 PRACCT                             103361 CGL029
065700200610     I                                        1  18 PRACCT                                    CGL029
065800200610     I                                        1   6 PRCNUM                103361
065900200610     I**********                              7  10 PRACOD                             103361 CGL029
066000200610     I**********                             11  12 PRACSQ                             103361 CGL029
066100200610     I                                        7  16 PRACOD                                    CGL029
066200200610     I                                       17  18 PRACSQ                                    CGL029
066300200610     I*
066400200610     ICPYR@#      DS
066500200610     I*
066600200610     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
066700200610     I*
066800200610     I                                        1  80 CPY@
066900200610     I                                        1  20 CPY@##
067000200610     IPPOSET    E DSPOSETD                                                CSE023
067100200610     I*  Position Settlement record for calling SE2310                    CSE023
067200200610     ISECNTR    E DSSECNTRPD                                              S01447
067300200610     I** SE Country tax rate details                                      S01447
067400200610     I*                                                                   S01447
067500200610     ISECBTX    E DSSECBTXPD                                              S01447
067600200610     I** SE Country to Branch tax rate details                            S01447
067700200610     I*                                                                   S01447
067800200610     ISDRETL    E DSSDRETLPD                                              103361
067900200610     I** Retail ICD details                                               103361
068000200610     I*                                                                   103361
068100200610     ISDCURR    E DSSDCURRPD                                              CEU005
068200200610     I** Currency details                                                 CEU005
068300200610     I*                                                                   CEU005
068400200610     ISDGELR    E DSSDGELRPD                                              CEU005
068500200610     I** General ledger details                                           CEU005
068600200610     I              QQACCD                          QQACC1                                    CGL029
068700200610     I*                                                                   CEU005
068800200610     ISDBANK    E DSSDBANKPD                                                                AR853119
068900200610      ***  Data structure for bank details                                                  AR853119
069000200610     ISDBRCE    E DSSDBRCHEXPD                                                              AR853119
069100200610      ** Branch Details Extension                                                           AR853119
069200200610     ISDSTPD    E DSSDSTPDPD                                                                AR853119
069300200610      *                                                                                     AR853119
069400200610     IDSFDY     E DSDSFDY                                                 S01447
069500200610     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01447
069600200610     I*                                                                   S01447
069700200610     IDSSDY     E DSDSSDY                                                 S01447
069800200610     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01447
069900200610     I*                                                                   S01447
070000200610     ISCSARD    E DSSCSARDPD                                                                  CGL020
070100200610      ** Data structure for switchable features file                                          CGL020
070200200610     I              LCD                             SCLCD                 CSE026              CGL020
070300200610     I***SDBSRT*   E DSSDBSRTPD                                                 AR1001183 AR1001183A
070400200610      ***Data*Structure*to*receive*Base*Rate*Details                            AR1001183 AR1001183A
070500200610      *                                                                                       CGL020
070600200610     I              'ZAAMLSETSE'          C         ZAAMLP                                    CGL020
070700200610     I**********    'ZACALCSPRT'          C         SPRDSR                      AR1001183 AR1001183A
070800200610      *                                                                                       CGL020
070801200616     ISDSTAT    E DSSDSTAT                                                                  AR324886
070802200616      ** SD Data area                                                                       AR324886
070803200616      *                                                                                     AR324886
070900200610     I/COPY ZSRSRC,ZHOLI                                                  S01512
071000200610     I*                                                                   S01512
071100200610     I/COPY WNCPYSRC,SE2390I001
071200200610     C/EJECT
071300200610      *================================================================
071400200610      *  P R O G R A M   S T A R T                                    *
071500200610      *================================================================
071600200610     C*
071700200610     C* KEYLISTS FOR CHAINING TO FILES
071800200610     C*
071900200610     C* DEPOT POSITIONS -   SHORT KEY,CURRENT ONLY LF/DPOSS
072000200610     C*
072100200610     C           DPOSKY    KLIST
072200200610     C                     KFLD           WDSSC
072300200610     C*
072400200610     C* DEPOT POSITIONS -  HISTORY AND CURRENT   LF/DPOSH
072500200610     C*
072600200610     C           DPOHKY    KLIST
072700200610     C********             KFLD           WDSBR                           S01117
072800200610     C                     KFLD           WDSBA                           S01117
072900200610     C                     KFLD           WDSSC
073000200610     C                     KFLD           WDDPT
073100200610     C                     KFLD           WDDTE
073200200610     C*                                                                   E16085
073300200610     C* DEPOT NAME INFORMATION - LF/CLINT (PF/CLINTSE)                    E16085
073400200610     C*                                                                   E16085
073500200610     C           CLIKEY    KLIST                                          E16085
073600200610     C                     KFLD           PCPY                            E16085
073700200610     C                     KFLD           WRECT   1                       E16085
073800200610     C*
073900200610     C**SECURITY*EVENTS*-************************LF/SECED                 E20016
074000200610     C* SECURITY EVENTS -                        LF/SEDEV                 E20016
074100200610     C*
074200200610     C           SECDKY    KLIST
074300200610     C                     KFLD           SASN
074400200610     C                     KFLD           SDED
074500200610     C                     KFLD           SDET
074600200610     C*                                                                   E36391
074700200610     C*  - SECURITY DIARY EVENTS                                          E36391
074800200610     C           SEDKEY    KLIST                                          E36391
074900200610     C                     KFLD           SASN                            E36391
075000200610     C                     KFLD           SAAT                            E36391
075100200610     C                     KFLD           SAED                            E36391
075200200610     C*
075300200610     C* SECURITES LF/SECTY
075400200610     C*
075500200610     C           SECTKY    KLIST
075600200610     C                     KFLD           SASN
075700200610     C*
075800200610     C* INVESTMENT TYPES LF/INVTP
075900200610     C*
076000200610     C           INVTKY    KLIST
076100200610     C                     KFLD           NMCY
076200200610     C                     KFLD           SITP
076300200610     C*
076400200610     C* STANDARD SETTLEMENT INSTRUCTIONS PF/STDSED
076500200610     C*
076600200610     C           STDSKY    KLIST
076700200610     C***********          KFLD           SBRH                            S01117
076800200610     C                     KFLD           SBRA                            S01117
076900200610     C                     KFLD           CSTM
077000200610     C                     KFLD           WBKCD   2                                           CSE028
077100200610     C                     KFLD           CYSI
077200200610     C                     KFLD           ITSI
077300200610     C                     KFLD           WPTFR   4                                           CSE028
077400200610      *                                                                   136297
077500200610      ** Key to ACCNTAB                                                   136297
077600200610      *                                                                   136297
077700200610     C           KEYACC    KLIST                                          136297
077800200610     C**********           KFLD           KYCNUM  60                                   136297 CSD027
077900200610     C                     KFLD           KYCNUM  6                                           CSD027
078000200610     C                     KFLD           KYCCY   3                       136297
078100200610     C**********           KFLD           KYACOD  40                                   136297 CGL029
078200200610     C                     KFLD           KYACOD 100                                          CGL029
078300200610     C                     KFLD           KYACSQ  20                      136297
078400200610     C                     KFLD           KYBRCA  3                       136297
078500200610     C*
078600200610     C* ACCESS ICD INFORMATION IN SUBROUTINE FIRST
078700200610     C*
078800200610     C           *NAMVAR   DEFN           LDA                             S01117
078900200610     C           *LOCK     IN   LDA                                       S01117
079000200610     C                     MOVE *BLANK    DBLOT
079100200610     C                     Z-ADD0         DBASE
079200200610      *** Correct setup of DBPGM                                          S01447
079300200610     C***********          MOVE 'SE2390  'DBPGM                           S01447
079400200610     C                     MOVE *BLANKS   DBPGM                           S01447
079500200610     C                     MOVEL'SE2390'  DBPGM                           S01447
079600200610     C                     OUT  LDA                                       S01117
079601200616     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
079602200616     C                     IN   SDSTAT                                                      AR324886
079700200610     C                     EXSR FIRST
079800200610     C*
079900200610     C* CHECK FOR DATABASE ERRORS
080000200610     C*
080100200610     C           *IN99     IFEQ '1'
080200200610     C                     GOTO EAUDIT
080300200610     C                     END
080400200610     C/COPY WNCPYSRC,SE2390C039
080500200610     C*
080600200610     C** WHEN PARM ZAB IS 'A',INTEREST IS CALCULATED ON LATEST POSITION  E1 5549
080700200610     C*                                                                   E15549
080800200610     C                     MOVE 'A'       ZAB                             E15549
080900200610     C*                                                                   E15549
081000200610     C* DEFINE AND CLEAR WORK FIELDS
081100200610     C*
081200200610     C           *LIKE     DEFN DSSC      WDSSC
081300200610     C           *LIKE     DEFN DDPT      WDDPT
081400200610     C************LIKE     DEFN DSBR      WDSBR                           S01117
081500200610     C           *LIKE     DEFN DSBA      WDSBA                           S01117
081600200610     C           *LIKE     DEFN DDTE      WDDTE
081700200610     C           *LIKE     DEFN RECI      WSRECI
081800200610     C           *LIKE     DEFN CFCT      WACF                            052254
081900200610     C********** *LIKE     DEFN BASC      UBASC                                 AR1001183 AR1001183A
082000200610     C********** *LIKE     DEFN BASS      UBASS                                 AR1001183 AR1001183A
082100200610     C********** *LIKE     DEFN SPRI      USPRI                                 AR1001183 AR1001183A
082200200610     C********** *LIKE     DEFN RDMT      URDMT                                 AR1001183 AR1001183A
082300200610     C********** *LIKE     DEFN RDFD      URDFD                                 AR1001183 AR1001183A
082400200610     C********** *LIKE     DEFN CNSP      UCNSP                                 AR1001183 AR1001183A
082500200610     C********** *LIKE     DEFN CNSG      UCNSG                                 AR1001183 AR1001183A
082600200610     C*                                                                   095066
082700200610     C*** Check if Value date position is to be used for Dividend.        095066
082800200610     C*                                                                   095066
082900200610     C                     CALL 'AOSARDR0'                                095066
083000200610     C                     PARM '       ' @RTCD   7                       095066
083100200610     C                     PARM '*VERIFY' @OPTN   7                       095066
083200200610     C                     PARM 'CSE008'  @SARD   6                       095066
083300200610     C*                                                                   095066
083400200610     C           @RTCD     IFEQ *BLANK                                    095066
083500200610     C                     MOVE 'Y'       CSE008  1                       095066
083600200610     C                     ELSE                                           095066
083700200610     C                     MOVE 'N'       CSE008                          095066
083800200610     C                     ENDIF                                          095066
083900200610     C*
084000200610     C* LOOP ROUND PROCESSING FOR EACH ACTION RECORD READ LF/SECAC
084100200610     C*
084200200610     C           *IN89     DOWEQ'0'
084300200610     C*
084400200610     C* READ ACTION FILE OF SECURITY ACTIONS
084500200610     C*
084600200610     C                     READ SECAC                    89
084700200610     C*
084800200610     C* IF ACTION RECORD DELETED GOTO END OF LOOP FOR NEXT ACTION
084900200610     C*
085000200610     C  N89      RECI      CABEQ'*'       ENDLP
085100200610     C*
085200200610     C* AT END OF FILE -
085300200610     C*
085400200610     C           *IN89     CABEQ'1'       ENDLP
085500200610     C*
085600200610     C                     MOVE RECI      WSRECI
085700200610     C*
085800200610     C** ADD TO COUNTER FOR EACH RECORD READ
085900200610     C*    SECURITY ACTION COUNT
086000200610     C*
086100200610     C                     ADD  1         WCSECT  50
086200200610     C                     MOVE '1'       WNEWSC  1
086300200610     C                     MOVE '0'       *IN79
086400200610     C                     MOVE SASN      WDSSC
086500200610     C*
086600200610     C* GET EACH DEPOT WHERE THIS SECURITY IS HELD - EXSR GETDEP
086700200610     C*
086800200610     C           *IN79     DOWEQ'0'
086900200610     C*
087000200610     C                     EXSR GETDEP
087100200610     C*
087200200610     C* IND 79 IS SET ON WHEN NO MORE DEPOTS FOR THIS SECURITY
087300200610     C*
087400200610     C           *IN79     CABEQ'1'       ENDLP
087500200610     C*
087600200610     C** PROCESS SELECTED SECURITY / DEPOT /DATE RECORD
087700200610     C*
087800200610     C*
087900200610     C***RECORD*SELECTED*-*IGNORE*IF*LAST*CHG*DATE*=*RUN*DATE**********   E15549
088000200610     C*  NOTE THAT SE2390 WILL PROCESS ALL SECURITY ACTIONS NEW 'TODAY'   E15549
088100200610     C*  (AS DEFINED BY THE EVENT CONTROL DATE IN SE2100)                 E15549
088200200610     C* ((LINES ASTERIXED BELOW BY E14506 RELEVANT TO E15549))            E15549
088300200610     C*                                                                   E15549
088400200610     C*
088500200610     C***********DSCV      CABEQRUND      ENDLP                           E14506
088600200610     C***********DSCT      CABEQRUND      ENDLP                           E14506
088700200610     C*                                                                   E15549
088800200610     C** IF THIS POSITION DATE IS LESS THAN OR EQUAL TO THE               E15549
088900200610     C** LAST COUPON DATE THEN THE EX-COUPON NOMINAL WILL BE ZERO         E15549
089000200610     C*                                                                   E15549
089100200610     C           DDTE      IFLE SALCCP                                    E15549
089200200610     C                     Z-ADD*ZERO     DEXN                            E15549
089300200610     C                     END                                            E15549
089400200610     C*
089500200610     C** CALCULATE CUM-COUPON VALUE
089600200610     C*
089700200610     C           DSNV      SUB  DEXN      WCUMCP 150
089800200610     C*
089900200610      *                                                                   S01447
090000200610      *** For efficiency purposes, make calls to following subroutines    S01447
090100200610      *** dependant on change of security.                                S01447
090200200610      *                                                                   S01447
090300200610     C           DSSC      IFNE UDSSC                                     S01447
090400200610      *                                                                   S01447
090500200610     C** EXECUTE SUBROUTINE SECTIN TO RETRIEVE SECURITY RECORD
090600200610     C*
090700200610     C                     EXSR SECTIN
090800200610     C*
090900200610     C** Execute Subroutine INVTIN to retrieve INVESTMENT Record          E23169
091000200610     C*                                                                   E23169
091100200610     C                     EXSR INVTIN                                    E23169
091200200610     C*                                                                   E23169
091300200610      **********                                                                AR1001183 AR1001183A
091400200610      ***Get*next*coupon*rate                                                   AR1001183 AR1001183A
091500200610      **********                                                                AR1001183 AR1001183A
091600200610     C**********           MOVE 'N'       WRCHG   1                             AR1001183 AR1001183A
091700200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
091800200610     C********** PROT      ANDEQ'3'                                             AR1001183 AR1001183A
091900200610     C********** PROT      OREQ '8'                                             AR1001183 AR1001183A
092000200610      **********                                                                AR1001183 AR1001183A
092100200610     C********** SAAT      IFEQ 'MP'                                            AR1001183 AR1001183A
092200200610     C********** SAAT      OREQ 'DV'                                            AR1001183 AR1001183A
092300200610     C********** S01512    ANDNE'Y'                                             AR1001183 AR1001183A
092400200610     C**********           Z-ADDSAOD      WDAT    50                            AR1001183 AR1001183A
092500200610     C**********           ELSE                                                 AR1001183 AR1001183A
092600200610     C**********           Z-ADDSAED      WDAT                                  AR1001183 AR1001183A
092700200610     C**********           ENDIF                                                AR1001183 AR1001183A
092800200610      **********                                                                AR1001183 AR1001183A
092900200610     C**********           EXSR GETNCR                                          AR1001183 AR1001183A
093000200610     C**********           ENDIF                                                AR1001183 AR1001183A
093100200610      **********                                                                AR1001183 AR1001183A
093200200610     C                     MOVE DSSC      UDSSC  10                       S01447
093300200610     C                     END                                            S01447
093400200610      *                                                                   S01447
093500200610     C** EXECUTE SUBROUTINES DEPENDING ON ACTION TYPE
093600200610     C*
093700200610     C           SAAT      CASEQ'DV'      DIVIDN
093800200610     C           SAAT      CASEQ'CP'      COUPON
093900200610     C           SAAT      CASEQ'MP'      MORTPY                          E21138
094000200610     C           SAAT      CASEQ'MA'      MATURE                          E21138
094100200610     C         71SAAT      CASEQ'PP'      PARTPY                                              CSE110
094200200610     C                     END
094300200610     C*
094400200610     C********** PSRI      IFEQ 'Y'                                                           CSE110
094500200610     C********** SAAT      CASEQ'PP'      PARTPY                                              CSE110
094600200610     C***********SAAT      CASEQ'MP'      MORTPY                          E21138
094700200610     C***********SAAT      CASEQ'MA'      MATURE                          E21138
094800200610     C           CSE110    IFEQ 'N'                                                           CSE110
094900200610     C           PSRI      ANDEQ'Y'                                                           CSE110
095000200610     C           SAAT      CASEQ'PP'      PARTPY                                              CSE110
095100200610     C                     END
095200200610     C                     END
095300200610     C*
095400200610     C* ADD TO COUNT OF POSITIONS PROCESSED
095500200610     C*
095600200610     C                     ADD  1         WCPOSN  50
095700200610     C*
095800200610     C           ENDLP     TAG                             ** ENDLP **
095900200610     C*
096000200610     C                     END
096100200610     C                     END
096200200610     C*
096300200610     C           EAUDIT    TAG                             ** EAUDIT **
096400200610     C*
096500200610     C* OUTPUT RUN CONTROL REPORT
096600200610     C*
096700200610     C                     EXSR AUDIT
096800200610      *
096900200610      *================================================================
097000200610      *  P R O G R A M   E N D                                        *
097100200610      *                                                               *
097200200610     C/COPY WNCPYSRC,SE2390C038
097300200610     C                     SETON                     LR
097400200610      *                                                               *
097500200610      *================================================================
097600200610      /EJECT
097700200610     C*****************************************************************
097800200610     C*                                                               *
097900200610     C* GETDEP   - GET DEPOT POSITION RECORD TO UPDATE NEXT FOR THIS  *
098000200610     C*            SECURITY ACTION.                                   *
098100200610     C*                                                               *
098200200610     C*****************************************************************
098300200610     C*
098400200610     C           GETDEP    BEGSR                           ** GETDEP **
098500200610     C*
098600200610     C*  IF IN THIS SUBR A DEPOT IS IGNORED BECAUSE DATE OF EARLIEST
098700200610     C*  POSITION IS GREATER THAN ACTION DATE, SEARCH FOR NEXT DEPOT
098800200610     C*  RESUMES AT GETIN
098900200610     C***********                                                  E21715 E23807
099000200610     C***********                                                  E21715 E23807
099100200610     C***********          SETOF                     66            E21715 E23807
099200200610     C*
099300200610     C           GETIN     TAG                             ** GETIN  **
099400200610     C*
099500200610     C** IF NEW SECURITY ACTION RECORD, USE SHORT KEY TO SETLL ON
099600200610     C*  DPOSS FILE - LATEST DATES ONLY ARE ACCESSED VIA THIS LOGICAL
099700200610     C*
099800200610     C           WNEWSC    IFEQ '1'
099900200610     C                     MOVE '0'       WNEWSC
100000200610     C           DPOSKY    SETLLDPOSS                    77
100100200610     C           *IN77     IFEQ '0'
100200200610     C                     MOVE '1'       *IN79
100300200610     C                     GOTO ENDDEP
100400200610     C                     END
100500200610     C                     END
100600200610     C*
100700200610     C** READ THE NEXT SECURITY/DEPOT/BRANCH/LAST POSITION DATE
100800200610     C*
100900200610     C           DPOSKY    READEDPOSS                    79
101000200610     C           *IN79     IFNE '1'
101100200610     C           RECI      ANDEQ'*'
101200200610     C                     GOTO GETIN
101300200610     C                     END
101400200610     C           *IN79     CABEQ'1'       ENDDEP
101500200610     C*
101600200610     C** IF THE EVENT TYPE ON THE SECURITY ACTION IS 'MA' (MATURITY)      E14236
101700200610     C** UPDATE THE LATEST DEPOT POSITION WITH RECI = 'H'.                E14236
101800200610     C*                                                                   E14236
101900200610     C           SAAT      IFEQ 'MA'                                      E14236
102000200610     C           AKRI      ANDEQ'Y'                                       E15696
102100200610     C                     MOVEL'H'       RECI                            E14236
102200200610     C                     UPDATDPOSNDF                                   E14236
102300200610     C                     END                                            E14236
102400200610     C*
102500200610     C**SELECT*THIS*RECORD FOR UPDATE IF THE POSITION DATE (DDTE)         051107
102600200610     C**IS*LESS*THAN SECURITY ACTION DATE OR EQUAL TO IT IF ACTION TYPE   051107
102700200610     C**IS*VALUE*'PP'.                                                    051107
102800200610     C***********                                                         051107
102900200610     C***********SAAT      IFEQ 'PP'                                      051107
103000200610     C***********DDTE      ANDLTSAED                                      051107
103100200610     C***********SAAT      ORNE 'PP'                                      051107
103200200610     C***********DDTE      ANDLESAED                                      051107
103300200610     C***********          GOTO ENDDEP                                    051107
103400200610     C***********          END                                            051107
103500200610     C***********                                                  051107 S01510
103600200610     C**SELECT*THIS*RECORD*FOR*UPDATE*IF*THE*POSITION*DATE*(DDTE)**051107 S01510
103700200610     C**IS*LESS*THAN*SECURITY*ACTION DATE**************************051107 S01510
103800200610     C***********                                                  051107 S01510
103900200610     C***********DDTE      IFLT SAED                               051107 S01510
104000200610     C***********                                                         S01510
104100200610     C** Select the record that satisfies any of the following            S01510
104200200610     C** ..event type = DV AND position date < ex-dividend date AND       S01510
104300200610     C**      S01510 is active                                            S01510
104400200610     C** ..OR event type = MA AND position date <= security action date   S01510
104500200610     C** ..OR event type <> MA AND position date < security action date   S01510
104600200610     C**      AND S01510 is not active                                    S01510
104700200610     C** ..OR event type <> MA and DV AND position date < secutity        S01510
104800200610     C**      action date AND S01510 is active                            S01510
104900200610     C*                                                                   S01510
105000200610     C           SAAT      IFEQ 'DV'                                      S01510
105100200610     C***********DDTE      ANDLTSAEXD                               S01510094839
105200200610     C           DDTE      ANDLESAEXD                                     094839
105300200610     C           S01510    ANDEQ'Y'                                       S01510
105400200610     C*                                                                   S01510
105500200610     C           SAAT      OREQ 'MA'                                      S01510
105600200610     C           DDTE      ANDLESAED                                      S01510
105700200610     C*                                                                   S01510
105800200610     C           SAAT      ORNE 'MA'                                      S01510
105900200610     C           DDTE      ANDLTSAED                                      S01510
106000200610     C           S01510    ANDEQ'N'                                       S01510
106100200610     C*                                                                   S01510
106200200610     C           SAAT      ORNE 'MA'                                      S01510
106300200610     C           SAAT      ANDNE'DV'                                      S01510
106400200610     C           DDTE      ANDLTSAED                                      S01510
106500200610     C           S01510    ANDEQ'Y'                                       S01510
106600200610     C                     GOTO ENDDEP                                    051107
106700200610     C                     END                                            051107
106800200610     C*
106900200610     C** MOST TRANSACTIONS WILL HAVE BEEN SELECTED BY THE ABOVE TEST
107000200610     C**
107100200610     C** ONLY BACKVALUATIONS REMAIN AND DPOSH IS USED TO FIND THE
107200200610     C*  CORRECT DATE TO UPDATE. USE THE FULL KEY ON FILE DPOSH
107300200610     C*
107400200610     C***RELEASE*LOCK*ON*RECORD************************************E21715 E23807
107500200610     C***********                                                  E21715 E23807
107600200610     C***********          UPDATDPOSNDF                            E21715 E23807
107700200610     C*
107800200610     C** SET UP KEY WITH BRANCH, DEPOT AND ACTION DATE
107900200610     C*
108000200610     C***********          MOVE DSBR      WDSBR                           S01117
108100200610     C                     MOVE DSBA      WDSBA                           S01117
108200200610     C                     MOVE DDPT      WDDPT
108300200610     C*                                                                   S01510
108400200610     C** If S01510 is active AND event type = DV, use ex-dividend date    S01510
108500200610     C*                                                                   S01510
108600200610     C           S01510    IFEQ 'Y'                                       S01510
108700200610     C           SAAT      ANDEQ'DV'                                      S01510
108800200610     C***********          Z-ADDSAEXD     WDDTE                     S01510094839
108900200610     C           SAEXD     ADD  1         WDDTE                           094839
109000200610     C                     ELSE                                           S01510
109100200610     C                     Z-ADDSAED      WDDTE
109200200610     C                     END                                            S01510
109300200610     C*                                                                   S01510
109400200610     C           DPOHKY    SETLLDPOSH                    77
109500200610      *                                                                   051107
109600200610      ***  If Backvaluation is Equal To the Action Date, it should not    051107
109700200610      ***  be selected for any Action, not just 'PP'.                     051107
109800200610     C*
109900200610     C***IF*77*IS*ON*A*MATCH*IS*FOUND*-*IF*ACTION*TYPE*NOT*PP*SELECT*IT   051107
110000200610     C***********                                                         051107
110100200610     C************IN77     IFEQ '1'                                       051107
110200200610     C***********SAAT      ANDNE'PP'                                      051107
110300200610     C***********                                                         051107
110400200610     C***NOW*READ*RECORD*FROM*DPOSH*FILE*******************************   051107
110500200610     C***********                                                         051107
110600200610     C***********DPOHKY    READEDPOSH                    77               051107
110700200610     C***********          SETON                     66            E21715 E23807
110800200610     C***********          GOTO ENDDEP                                    051107
110900200610     C***********          END                                            051107
111000200610     C*
111100200610     C***IF VALUE DATE POSITION IS NEEDED FOR DIVIDEND                    095066
111200200610     C*                                                                   095066
111300200610     C           *IN77     IFEQ '1'                                       095066
111400200610     C           SAAT      ANDEQ'DV'                                      095066
111500200610     C           CSE008    ANDEQ'Y'                                       095066
111600200610     C*                                                                   095066
111700200610     C           DPOHKY    READEDPOSH                    77               095066
111800200610     C           *IN77     IFEQ '0'                                       095066
111900200610     C           RECI      ANDNE'*'                                       095066
112000200610     C                     GOTO ENDDEP                                    095066
112100200610     C                     END                                            095066
112200200610     C*                                                                   095066
112300200610     C                     END                                            095066
112400200610     C*                                                                   095066
112500200610     C* THIS LEAVES A BACKVALUATION AGAINST A DEPOT POSITION
112600200610     C* ON A DATE PRIOR TO THE SEC.ACTION DATE
112700200610     C*
112800200610     C           RDLOOP    TAG                              **RDLOOP**
112900200610     C                     READPDPOSH                    77
113000200610     C           *IN77     CABEQ'1'       GETIN
113100200610     C           RECI      CABEQ'*'       RDLOOP
113200200610     C           WDSSC     IFNE DSSC
113300200610     C           WDDPT     ORNE DDPT
113400200610     C***********WDSBR     ORNE DSBR                                      S01117
113500200610     C           WDSBA     ORNE DSBA                                      S01117
113600200610     C                     GOTO GETIN
113700200610     C                     END
113800200610     C*
113900200610     C**IF*DATE*IS*LESS*THAN*ACTION*DATE*SELECT*IT************************S01510
114000200610     C***********                                                         S01510
114100200610     C***********DDTE      IFLT SAED                                      S01510
114200200610     C***********          SETON                     66            E21715 E23807
114300200610     C** The selection is as follows:                                     S01510
114400200610     C** .. if event type is DV AND position date < ex-dividend date      S01510
114500200610     C**       AND S01510 is active                                       S01510
114600200610     C** .. if position date < security action date AND S01510 is off     S01510
114700200610     C** .. if position date < security action date AND event type not    S01510
114800200610     C**       DV AND S01510 is active                                    S01510
114900200610     C*                                                                   S01510
115000200610     C           SAAT      IFEQ 'DV'                                      S01510
115100200610     C***********DDTE      ANDLTSAEXD                               S01510094839
115200200610     C           DDTE      ANDLESAEXD                                     094839
115300200610     C           S01510    ANDEQ'Y'                                       S01510
115400200610     C*                                                                   S01510
115500200610     C           DDTE      ORLT SAED                                      S01510
115600200610     C           S01510    ANDEQ'N'                                       S01510
115700200610     C*                                                                   S01510
115800200610     C           DDTE      ORLT SAED                                      S01510
115900200610     C           SAAT      ANDNE'DV'                                      S01510
116000200610     C           S01510    ANDEQ'Y'                                       S01510
116100200610     C                     GOTO ENDDEP
116200200610     C                     END
116300200610      *                                                                   051107
116400200610      ***  If the Event Date is Equal To the Action Date, it should not   051107
116500200610      ***  be selected for any Action, not just 'PP'.                     051107
116600200610     C*
116700200610     C**IF*DATE*IS*EQUAL*TO*ACTION*DATE*AND*ACTION*TYPE*IS*NOT*=*PP****   051107
116800200610     C**THEN*SELECT*IT*.***********************************************   051107
116900200610     C***********                                                         051107
117000200610     C***********DDTE      IFEQ SAED                                      051107
117100200610     C***********SAAT      ANDNE'PP'                                      051107
117200200610     C***********          SETON                     66            E21715 E23807
117300200610     C***********          GOTO ENDDEP                                    051107
117400200610     C***********          END                                            051107
117500200610     C*
117600200610     C* DATE IS NOT LESS THAN ACTION DATE - READ PREVIOUS
117700200610     C*
117800200610     C                     GOTO RDLOOP
117900200610     C*
118000200610     C           ENDDEP    ENDSR                            **ENDDEP**
118100200610      *
118200200610      *****************************************************************
118300200610      /EJECT
118400200610      *****************************************************************
118500200610      *                                                               *
118600200610      *  DIVIDN - Subroutine to produce Dividend Account Keys and/or  *
118700200610      *           Position Settlements.                               *
118800200610      *                                                               *
118900200610      *****************************************************************
119000200610      *
119100200610     C           DIVIDN    BEGSR                           ** DIVIDN **
119200200610     C*
119300200610     C** CALCULATE DIVIDEND DUE
119400200610     C*
119500200610     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
119600200610     C** If S01509 is active, use value currency instead of nominal ccyy  S01509
119700200610     C*
119800200610     C********** S01509    IFEQ 'Y'                                                  S01509 BUG11198
119900200610     C**********           MOVE VLCY      WCURR                                      S01509 BUG11198
120000200610     C**********           ELSE                                                      S01509 BUG11198
120100200610     C                     MOVE NMCY      WCURR   3
120200200610     C**********           END                                                       S01509 BUG11198
120300200610     C                     EXSR TG10
120400200610      *                                                                   E19610
120500200610      *  FOR DIVIDENDS, CALCULATE CUM-COUPON VALUE USING THE TRADE DATE   E19610
120600200610      *  POSITION INSTEAD OF THE VALUE DATE.                              E19610
120700200610     C** If S01510 is active, the cum-coupon value must be the trade      S01510
120800200610     C** date nominal                                                     S01510
120900200610      *                                                                   E19610
121000200610     C           S01510    IFEQ 'Y'                                       S01510
121100200610     C           CSE008    IFNE 'Y'                                       095066
121200200610     C                     Z-ADDDSNT      WCUMCP                          S01510
121300200610     C                     ELSE                                           095066
121400200610     C                     Z-ADDDSNV      WCUMCP                          095066
121500200610     C                     END                                            095066
121600200610     C                     ELSE                                           S01510
121700200610     C           CSE008    IFNE 'Y'                                       095066
121800200610     C           DSNT      SUB  DEXN      WCUMCP                          E19610
121900200610     C                     ELSE                                           095066
122000200610     C           DSNV      SUB  DEXN      WCUMCP                          095066
122100200610     C                     END                                            095066
122200200610     C                     END                                            S01510
122300200610     C*
122400200610     C**DIVIDEND*DUE*CALCULATION***************************************   E20972
122500200610     C**CUM-COUPON**MULTIPLIED*BY*AMOUNT*PER*UNIT*(SDDV)***************   E20972
122600200610     C**GIVING*WORK*(15/4).*MULTIPLY*BY*POWER*VALUE*AND*RESULT*IN*13/0*   E20972
122700200610     C***********                                                         E20972
122800200610     C***********          Z-ADD0         DC                              E20972
122900200610     C***********                                                         E20972
123000200610     C***********          SUB  NMDP      DC      10                      E20972
123100200610     C***********DC        ADD  5         DC      10                      E20972
123200200610     C***********WCUMCP    MULT POWER8,DC WRK154                          E20086
123300200610     C***********WCUMCP    MULT POWER8,DC WRK154 154               E20086 E20972
123400200610     C***********                                                         E20972
123500200610     C***********WRK154    MULT SDAU      WRK154 154                      E16772
123600200610     C***********WRK154    MULT SDUN      WRK158                          E16772
123700200610     C***********WRK154    MULT SDUN      WRK158 158               E20086 E20972
123800200610     C***********CDP       ADD  5         DC                              E20972
123900200610     C***********WRK154    MULT POWER8,DC WRK154                          E16772
124000200610     C***********WRK158    MULT POWER8,DC WRK158                   E16772 E20972
124100200610     C***********WRK154    DIV  1         WDIVDU 130H                     E16772
124200200610     C***********WRK158    DIV  1         WDIVDU 130H              E16772 E20972
124300200610     C***********                                                         E20972
124400200610     C***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100******************   E20972
124500200610     C***********                                                         E20972
124600200610     C***********SPBS      IFEQ 'P'                                       E20972
124700200610     C***********WDIVDU    DIV  100       WDIVDU    H                     E20972
124800200610     C***********          END                                            E20972
124900200610     C*                                                                   E20972
125000200610     C** USE SUBROUTINE ZCNSD TO CALCULATE DIVIDEND DUE.                  E20972
125100200610     C*                                                                   E20972
125200200610     C                     Z-ADDWCUMCP    ZNOML                           E20972
125300200610     C                     Z-ADDSDUN      ZPRC                            E20972
125400200610     C***********SPBS      IFEQ 'P'                                E23169 087712
125500200610     C***********          MULT 100       ZPRC                     E23169 087712
125600200610     C***********          END                                     E23169 087712
125700200610     C                     EXSR ZCNSD                                     E20972
125800200610     C                     Z-ADDZCONS     WDIVDU 150                      E20972
125900200610     C** If S01509 is active, and value currency is different from                          BUG11198
126000200610     C** nominal currency, convert coupon amount to value currency                          BUG11198
126100200610     C*                                                                                     BUG11198
126200200610     C           S01509    IFEQ 'Y'                                                         BUG11198
126300200610     C           NMCY      ANDNEVLCY                                                        BUG11198
126400200610     C                     MOVE NMCY      WCURR   3                                         BUG11198
126500200610     C                     EXSR TG10                                                        BUG11198
126600200610     C                     Z-ADDZCDP      ZCDPI                                             BUG11198
126700200610     C                     MOVE VLCY      WCURR   3                                         BUG11198
126800200610     C                     EXSR TG10                                                        BUG11198
126900200610     C                     Z-ADDZCDP      ZCDPO                                             BUG11198
127000200610     C                     MOVE NMCY      ZCCYI                                             BUG11198
127100200610     C                     MOVE VLCY      ZCCYO                                             BUG11198
127200200610     C                     Z-ADDWDIVDU    ZAMTCI                                            BUG11198
127300200610     C*                                                                                     BUG11198
127400200610     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event                     BUG11198
127500200610     C** found, else from SECTYD                                                            BUG11198
127600200610     C*                                                                                     BUG11198
127700200610     C                     MOVE SAAT      WSAAT   2                                         BUG11198
127800200610     C                     MOVE 'XR'      SAAT                                              BUG11198
127900200610     C           SEDKEY    SETLLSEDEVDO                                                     BUG11198
128000200610     C                     READ SEDEVDO                  81                                 BUG11198
128100200610     C           *IN81     IFEQ '0'                                                         BUG11198
128200200610     C           SDSN      ANDEQSASN                                                        BUG11198
128300200610     C           SDET      ANDEQ'XR'                                                        BUG11198
128400200610     C                     Z-ADDSDCE      ZEXCH                                             BUG11198
128500200610     C                     MOVE SDMD      ZMD                                               BUG11198
128600200610     C                     ELSE                                                             BUG11198
128700200610     C                     Z-ADDSEXR      ZEXCH                                             BUG11198
128800200610     C                     MOVE SMDI      ZMD                                               BUG11198
128900200610     C                     ENDIF                                                            BUG11198
129000200610     C                     MOVE WSAAT     SAAT                                              BUG11198
129100200610     C                     EXSR ZCONV                                                       BUG11198
129200200610     C                     Z-ADDZAMTCO    WDIVDU                                            BUG11198
129300200610     C                     ENDIF                                                            BUG11198
129400200610     C/COPY WNCPYSRC,SE2390C001
129500200610     C*
129600200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
129700200610     C*
129800200610     C           AKRI      IFEQ 'Y'
129900200610     C                     MOVE 'H'       WACEVC
130000200610     C*
130100200610     C** SET NEGATIVE IND TO N IF SPLIT NEG ACCRUAL IS NOT N AND
130200200610     C** AND CUM-COUPON VALUE NOT GREATER THAN ZERO
130300200610     C*
130400200610     C           SNAC      IFEQ 'N'
130500200610     C           WCUMCP    ORGT 0
130600200610     C                     MOVE ' '       WACNEG
130700200610     C                     ELSE
130800200610     C                     MOVE 'N'       WACNEG
130900200610     C                     END
131000200610     C                     MOVE 'DI'      WACAMC
131100200610     C                     Z-ADDWDIVDU    EVAM
131200200610     C*
131300200610     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG ACCRUAL IS Y AND
131400200610     C** CUM-COUPON VALUE IS LESS THAN ZERO
131500200610     C*
131600200610     C           WCUMCP    IFLT 0
131700200610     C           SNAC      ANDEQ'Y'
131800200610     C                     Z-SUBEVAM      EVAM
131900200610     C/COPY WNCPYSRC,SE2390C002
132000200610     C                     END
132100200610     C                     EXSR W01
132200200610     C/COPY WNCPYSRC,SE2390C003
132300200610     C                     END
132400200610     C*
132500200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
132600200610     C*
132700200610     C           PSRI      IFEQ 'Y'
132800200610     C/COPY WNCPYSRC,SE2390C004
132900200610     C                     MOVE 'DV'      PEVT
133000200610     C                     Z-ADDWCUMCP    PNMP
133100200610     C           WDIVDU    IFLT 0
133200200610     C                     Z-SUBWDIVDU    PAMD
133300200610     C/COPY WNCPYSRC,SE2390C005
133400200610     C                     ELSE
133500200610     C                     Z-ADDWDIVDU    PAMD
133600200610     C/COPY WNCPYSRC,SE2390C006
133700200610     C                     END
133800200610     C           WCUMCP    IFGT 0
133900200610     C                     MOVE 'R'       PPRE
134000200610     C                     ELSE
134100200610     C                     MOVE 'P'       PPRE
134200200610     C                     END
134300200610     C                     EXSR W02
134400200610     C                     END
134500200610     C/COPY WNCPYSRC,SE2390C007
134600200610     C***********                                                  E21715 E23807
134700200610     C***RESET*EX/DIVIDEND*NOMINAL*FOR*NEXT*DIVIDEND*PERIOD********E21715 E23807
134800200610     C***********                                                  E21715 E23807
134900200610     C***********LCPN      IFEQ SAED                               E21715 E23807
135000200610     C***********                                                  E21715 E23807
135100200610     C***IF*'DV'*EVENT*IS*BACKVALUED*ZEROIZE*EX-DIVIDEND*NOMINAL*FOR21715 E23807
135200200610     C***THIS*POSITION*RECORD*AND*SUBTRACT*THIS*AMOUNT*FROM*THE*NOMINAL15 E23807
135300200610     C***ON*SUBSEQUENT*POSTION*RECORDS*****************************E21715 E23807
135400200610     C***********                                                  E21715 E23807
135500200610     C************IN66     IFEQ '1'                                E21715 E23807
135600200610     C***********          Z-ADDDEXN      SDEXN  130               E21715 E23807
135700200610     C************IN44     DOWEQ'0'                                E21715 E23807
135800200610     C***********          SUB  SDEXN     DEXN                     E21715 E23807
135900200610     C***********          UPDATDPOSNDFH                           E21715 E23807
136000200610     C***********          READ DPOSH                    44        E21715 E23807
136100200610     C************IN44     IFEQ '0'                                E21715 E23807
136200200610     C***********                                                  E21715 E23807
136300200610     C***********WDSSC     IFNE DSSC                               E21715 E23807
136400200610     C***********WDDPT     ORNE DDPT                               E21715 E23807
136500200610     C***********WDSBR     ORNE DSBR                               E21715 E23807
136600200610     C***********          SETON                         44        E21715 E23807
136700200610     C***********          END                                     E21715 E23807
136800200610     C***********                                                  E21715 E23807
136900200610     C***RELEASE*LOCK**********************************************E21715 E23807
137000200610     C************IN44     IFEQ '1'                                E21715 E23807
137100200610     C***********          UPDATDPOSNDFH                           E21715 E23807
137200200610     C***********          END                                     E21715 E23807
137300200610     C***********                                                  E21715 E23807
137400200610     C***********          END                                     E21715 E23807
137500200610     C***********          END                                     E21715 E23807
137600200610     C***********                                                  E21715 E23807
137700200610     C***NORMAL*CASE*-*DIVIDEND*EVENT*IS*NOT*BACKVALUED************E21715 E23807
137800200610     C***********                                                  E21715 E23807
137900200610     C***********          ELSE                                    E21715 E23807
138000200610     C***********          Z-ADD0         DEXN                     E21715 E23807
138100200610     C***********          UPDATDPOSNDF                            E21715 E23807
138200200610     C***********          END                                     E21715 E23807
138300200610     C***********          END                                     E21715 E23807
138400200610      *
138500200610     C           ENDDIV    ENDSR                           **ENDDIV**
138600200610      *****************************************************************
138700200610      /EJECT
138800200610      *****************************************************************
138900200610      *                                                               *
139000200610      *  COUPON - Subroutine to produce Coupon Account Keys and/or    *
139100200610      *           Position Settlements.                               *
139200200610      *                                                               *
139300200610      *****************************************************************
139400200610      *
139500200610     C           COUPON    BEGSR                           ** COUPON **
139600200610     C*                                                                   E15549
139700200610     C** USE LAST COUPON DATE FROM THE SECURITY ACTION                    E15549
139800200610     C*                                                                   E15549
139900200610     C***********          Z-ADDSALCCP    LCPN                     E15549 E21715
140000200610     C*
140100200610     C** CALCULATE INTEREST DUE VIA P/ZACCRD FOR SECURITY
140200200610     C*  FROM DATE IS LAST COUPON / TO DATE IS EVENT DATE.
140300200610     C*  GET NOMINAL CCY DEC PLACES FROM TABTG10 FIRST (CDP)
140400200610     C*
140500200610     C                     MOVE NMCY      WCURR   3
140600200610     C                     EXSR TG10
140700200610     C***********          UNLCKLDA                                       S01117
140800200610     C/COPY WNCPYSRC,SE2390C027
140900200610     C                     CALL 'ZACCRD'
141000200610     C***********          PARM           LCPN                            E21715
141100200610     C                     PARM           SALCCP                          E21715
141200200610     C                     PARM           SAED
141300200610     C***********          PARM           DSBR                            S01117
141400200610     C                     PARM           DSBA                            S01117
141500200610     C                     PARM           DDPT
141600200610     C                     PARM           DSSC
141700200610     C                     PARM           CDP
141800200610     C                     PARM           ZINTDU 150
141900200610     C                     PARM           ZINDUE 151                      055420
142000200610     C                     PARM           ZAB     1
142100200610     C/COPY WNCPYSRC,SE2390C008
142200200610      *                                                                   S01447
142300200610      *   U7 AND U8 OFF IF NO DATABASE ERROR DURING ZACCR PROCESSING      S01447
142400200610      *   BUT DBPGM NEEDS TO RESET                                        S01447
142500200610      *                                                                   S01447
142600200610     C           *INU7     IFEQ '0'                                       S01447
142700200610     C           *INU8     ANDEQ'0'                                       S01447
142800200610     C           *LOCK     IN   LDA                                       S01447
142900200610     C                     MOVE *BLANKS   DBPGM                           S01447
143000200610     C                     MOVEL'SE2390'  DBPGM                           S01447
143100200610     C                     OUT  LDA                                       S01447
143200200610     C                     END                                            S01447
143300200610      *
143400200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
143500200610     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
143600200610     C********** FRATE     IFLE 0                                               AR1001183 AR1001183A
143700200610      ***The*following*fields*set*PAMD*to*any*value(ie zero)                    AR1001183 AR1001183A
143800200610     C**********           Z-ADD0         ZINTDU                                AR1001183 AR1001183A
143900200610     C**********           Z-ADD0         ZINDUE                                AR1001183 AR1001183A
144000200610     C**********           ENDIF                                                AR1001183 AR1001183A
144100200610     C**********           ENDIF                                                AR1001183 AR1001183A
144200200610     C*                                                                   S01509
144300200610     C** If S01509 is active, and value currency is different from        S01509
144400200610     C** nominal currency, convert coupon amount to value currency        S01509
144500200610     C*                                                                   S01509
144600200610     C           S01509    IFEQ 'Y'                                       S01509
144700200610     C           NMCY      ANDNEVLCY                                      S01509
144800200610     C                     MOVE NMCY      WCURR   3                       S01509
144900200610     C                     EXSR TG10                                      S01509
145000200610     C                     Z-ADDZCDP      ZCDPI                           S01509
145100200610     C                     MOVE VLCY      WCURR   3                       S01509
145200200610     C                     EXSR TG10                                      S01509
145300200610     C                     Z-ADDZCDP      ZCDPO                           S01509
145400200610     C                     MOVE NMCY      ZCCYI                           S01509
145500200610     C                     MOVE VLCY      ZCCYO                           S01509
145600200610     C                     Z-ADDZINTDU    ZAMTCI                          S01509
145700200610     C*                                                                   S01509
145800200610     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event   S01509
145900200610     C** found, else from SECTYD                                          S01509
146000200610     C*                                                                   S01509
146100200610     C                     MOVE SAAT      WSAAT   2                       S01509
146200200610     C                     MOVE 'XR'      SAAT                            S01509
146300200610     C           SEDKEY    SETLLSEDEVDO                                   S01509
146400200610     C                     READ SEDEVDO                  81               S01509
146500200610     C           *IN81     IFEQ '0'                                       S01509
146600200610     C           SDSN      ANDEQSASN                                      S01509
146700200610     C           SDET      ANDEQ'XR'                                      S01509
146800200610     C                     Z-ADDSDCE      ZEXCH                           S01509
146900200610     C                     MOVE SDMD      ZMD                             S01509
147000200610     C                     ELSE                                           S01509
147100200610     C                     Z-ADDSEXR      ZEXCH                           S01509
147200200610     C                     MOVE SMDI      ZMD                             S01509
147300200610     C                     END                                            S01509
147400200610     C                     MOVE WSAAT     SAAT                            S01509
147500200610     C                     EXSR ZCONV                                     S01509
147600200610     C                     Z-ADDZAMTCO    ZINTDU                          S01509
147700200610     C                     END                                            S01509
147800200610     C*
147900200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
148000200610     C*
148100200610     C           AKRI      IFEQ 'Y'
148200200610     C                     MOVE 'C'       WACEVC
148300200610     C           SNAC      IFEQ 'N'
148400200610     C           WCUMCP    ORGT 0
148500200610     C                     MOVE ' '       WACNEG
148600200610     C                     ELSE
148700200610     C                     MOVE 'N'       WACNEG
148800200610     C                     END
148900200610     C                     MOVE 'DI'      WACAMC
149000200610     C                     Z-ADDZINTDU    EVAM
149100200610     C           ZINTDU    IFLT 0
149200200610     C           SNAC      ANDEQ'Y'
149300200610     C                     Z-SUBEVAM      EVAM
149400200610     C/COPY WNCPYSRC,SE2390C009
149500200610     C                     END
149600200610     C                     EXSR W01
149700200610     C/COPY WNCPYSRC,SE2390C010
149800200610     C                     END
149900200610     C*
150000200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
150100200610     C*
150200200610     C           PSRI      IFEQ 'Y'
150300200610     C                     MOVE 'CP'      PEVT
150400200610     C                     Z-ADDWCUMCP    PNMP
150500200610     C           ZINTDU    IFLT 0
150600200610     C                     Z-SUBZINTDU    PAMD
150700200610     C/COPY WNCPYSRC,SE2390C011
150800200610     C                     MOVE 'P'       PPRE
150900200610     C                     ELSE
151000200610     C                     Z-ADDZINTDU    PAMD
151100200610     C/COPY WNCPYSRC,SE2390C012
151200200610     C                     MOVE 'R'       PPRE
151300200610     C                     END
151400200610     C                     EXSR W02
151500200610     C                     END
151600200610     C/COPY WNCPYSRC,SE2390C013
151700200610     C*                                                                   E21715
151800200610     C***********                                                  E21715 E23807
151900200610     C***RESET*EX/COUPON NOMINAL*FOR*NEXT*COUPON*PERIOD************E21715 E23807
152000200610     C***********                                                  E21715 E23807
152100200610     C***********LCPN      IFEQ SAED                               E21715 E23807
152200200610     C***********          Z-ADD0         DEXN                     E21715 E23807
152300200610     C***********          UPDATDPOSNDF                            E21715 E23807
152400200610     C***********          END                                     E21715 E23807
152500200610     C*
152600200610     C           ENDCPN    ENDSR
152700200610      *
152800200610      *****************************************************************
152900200610      /EJECT
153000200610      *****************************************************************
153100200610      *                                                               *
153200200610      *  PARTPY - Subroutine to produce Part Payment Position         *
153300200610      *           Settlements.                                        *
153400200610      *                                                               *
153500200610      *****************************************************************
153600200610      *
153700200610     C           PARTPY    BEGSR                           ** PARTPY **
153800200610     C*
153900200610     C** CALCULATE PAYMENT DUE AS:
154000200610     C*   NOMINAL TRADE DATE BASIS TIMES CALL AMOUNT
154100200610     C*   HOLDING IS IN NOM.DEC PLACES, RESULT AS 13/0 WITH CCY DEC
154200200610     C*
154300200610     C*   GET SECURITY RECORD IN
154400200610     C*
154500200610     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
154600200610     C*
154700200610     C                     MOVE NMCY      WCURR   3
154800200610     C                     EXSR TG10
154900200610      *
155000200610      ****CLEAR*WORK*FIELDS********************************************** E23169
155100200610      ******************************************************************* E23169
155200200610     C*********************Z-ADD0         WORK0  150                      E23169
155300200610     C*********************Z-ADD0         WORK1  151                      E23169
155400200610     C*********************Z-ADD0         WORK2  152                      E23169
155500200610     C*********************Z-ADD0         WORK3  153                      E23169
155600200610      ******************************************************************* E23169
155700200610     C*********************MOVEA'0000'    *IN,60                          E23169
155800200610      ******************************************************************* E23169
155900200610     C***********60        ADD  CDP       I       30                      E23169
156000200610      **********************                                              E23169
156100200610     C*********************MOVEA'1'       *IN,I                           E23169
156200200610      ******************************************************************* E23169
156300200610     C******************************************************************* E23169
156400200610     C***CALCULATE*OFFSET*FOR*TABLE*POWER8******************************* E23169
156500200610     C******************************************************************* E23169
156600200610     C***********CDP       SUB  NMDP      DC                              E23169
156700200610     C***********DC        ADD  5         DC                              E23169
156800200610      ******************************************************************* E23169
156900200610     C*********************EXSR INVTIN                                    E23169
157000200610      ******************************************************************* E23169
157100200610      ****PROCESS*CALCS*DEPENDING*ON*CURRENCY*DPS.***                     E23169
157200200610      ******************************************************************* E23169
157300200610     C************IN60     IFEQ '1'                                       E23169
157400200610      ******************************************************************* E23169
157500200610      ****ZERO*DECIMAL*PLACES**---------------------------------------*** E23169
157600200610      ******************************************************************* E23169
157700200610     C*********************MOVE SDCA      WORK0                           E23169
157800200610     C*********************MULT DSNV      WORK0                           E23169
157900200610      ******************************************************************* E23169
158000200610     C***********PROT      IFEQ '8'                                       E23169
158100200610      ******************************************************************* E23169
158200200610      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR**** E23169
158300200610      *****************************************************************   E23169
158400200610     C*********************MULT SACF      WORK0                           E23169
158500200610     C*********************END                                            E23169
158600200610      ******************************************************************* E23169
158700200610      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100******************** E23169
158800200610      ******************************************************************* E23169
158900200610     C***********SPBS      IFEQ 'P'                                       E23169
159000200610     C*********************DIV  100       WORK0     H                     E23169
159100200610     C*********************END                                            E23169
159200200610      ******************************************************************* E23169
159300200610     *********** WORK0     MULT POWER8,DC WPAYDU 130H                     E23169
159400200610     ******************************************************************** E23169
159500200610     C*********************ELSE                                           E23169
159600200610     C************IN61     IFEQ '1'                                       E23169
159700200610      ******************************************************************* E23169
159800200610      ****ONE*DECIMAL*PLACE****----------------------------------------** E23169
159900200610      ******************************************************************* E23169
160000200610     C*********************MOVE SDCA      WORK1                           E23169
160100200610     C*********************MULT DSNV      WORK1                           E23169
160200200610      ******************************************************************* E23169
160300200610     C***********PROT      IFEQ '8'                                       E23169
160400200610      ******************************************************************* E23169
160500200610      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR**** E23169
160600200610      ******************************************************************* E23169
160700200610     C*********************MULT SACF      WORK1                           E23169
160800200610     C*********************END                                            E23169
160900200610      ******************************************************************* E23169
161000200610      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100******************** E23169
161100200610      ******************************************************************* E23169
161200200610     C***********SPBS      IFEQ 'P'                                       E23169
161300200610     C*********************DIV  100       WORK1     H                     E23169
161400200610     C*********************END                                            E23169
161500200610      ******************************************************************* E23169
161600200610     C***********WORK1     MULT POWER8,DC WPAYDU    H                     E23169
161700200610      ******************************************************************* E23169
161800200610     C*********************ELSE                                           E23169
161900200610     C************IN62     IFEQ '1'                                       E23169
162000200610      ******************************************************************* E23169
162100200610      ****TWO*DECIMAL*PLACES***----------------------------------------** E23169
162200200610      ******************************************************************* E23169
162300200610     C*********************MOVE SDCA      WORK2                           E23169
162400200610     C*********************MULT DSNV      WORK2                           E23169
162500200610      ******************************************************************* E23169
162600200610     C***********PROT      IFEQ '8'                                       E23169
162700200610      ******************************************************************* E23169
162800200610      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR**** E23169
162900200610      ******************************************************************  E23169
163000200610     C*********************MULT SACF      WORK2                           E23169
163100200610     C*********************END                                            E23169
163200200610      ******************************************************************* E23169
163300200610      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100******************** E23169
163400200610      ******************************************************************* E23169
163500200610     C***********SPBS      IFEQ 'P'                                       E23169
163600200610     C*********************DIV  100       WORK2     H                     E23169
163700200610     C*********************END                                            E23169
163800200610      ******************************************************************* E23169
163900200610     C***********WORK2     MULT POWER8,DC WPAYDU    H                     E23169
164000200610      *********************                                               E23169
164100200610     C*********************ELSE                                           E23169
164200200610     C************IN63     IFEQ '1'                                       E23169
164300200610      *********************                                               E23169
164400200610      ****THREE*DECIMAL*PLACES*--------------------------------------**** E23169
164500200610      ******************************************************************* E23169
164600200610     C*********************MOVE SDCA      WORK3                           E23169
164700200610     C*********************MULT DSNV      WORK3                           E23169
164800200610      ******************************************************************* E23169
164900200610     C***********PROT      IFEQ '8'                                       E23169
165000200610      ******************************************************************* E23169
165100200610      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR**** E23169
165200200610      ******************************************************************* E23169
165300200610     C*********************MULT SACF      WORK3                           E23169
165400200610     C*********************END                                            E23169
165500200610      ******************************************************************* E23169
165600200610      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100******************** E23169
165700200610      ******************************************************************* E23169
165800200610     C***********SPBS      IFEQ 'P'                                       E23169
165900200610     C*********************DIV  100       WORK3     H                     E23169
166000200610     C*********************END                                            E23169
166100200610      ******************************************************************* E23169
166200200610     C***********WORK3     MULT POWER8,DC WPAYDU    H                     E23169
166300200610      ******************************************************************* E23169
166400200610     C*********************END                                            E23169
166500200610     C*********************END                                            E23169
166600200610     C*********************END                                            E23169
166700200610     C*********************END                                            E23169
166800200610     C*                                                                   E23169
166900200610     C           PROT      IFNE '4'                                       E23169
167000200610     C           SDCA      DIV  100000    ZPRC                            E23169
167100200610     C                     ELSE                                           E23169
167200200610     C           5         ADD  CDP       DC                              E23169
167300200610     C           SDCA      DIV  POWER8,DC ZPRC                            E23169
167400200610     C                     END                                            E23169
167500200610     C           SPBS      IFEQ 'P'                                       E23169
167600200610     C                     MULT 100       ZPRC                            E23169
167700200610     C                     END                                            E23169
167800200610     C                     Z-ADDDSNV      ZNOML                           E23169
167900200610     C                     EXSR ZCNSD                                     E23169
168000200610     C                     Z-ADDZCONS     WPAYDU 130                      E23169
168100200610     C*                                                                   E23169
168200200610     C** IF PROCESSING TYPE ON INVPTD IS 8 MULTIPLY BY CURRENT FACTOR     E23169
168300200610     C*                                                                   E23169
168400200610     C           PROT      IFEQ '8'                                       E23169
168500200610     C                     MULT SACF      WPAYDU    H                     E23169
168600200610     C                     END                                            E23169
168700200610      *                                                                                       CSE110
168800200610      ** If account key required write A/C key in W01                                         CSE110
168900200610      *                                                                                       CSE110
169000200610     C           CSE110    IFEQ 'Y'                                                           CSE110
169100200610      *                                                                                       CSE110
169200200610     C           AKRI      IFEQ 'Y'                                                           CSE110
169300200610     C                     MOVE 'P'       WACEVC                                              CSE110
169400200610      *                                                                                       CSE110
169500200610     C           NPAC      IFEQ 'N'                                                           CSE110
169600200610     C           DSNV      ORGT 0                                                             CSE110
169700200610     C                     MOVE ' '       WACNEG                                              CSE110
169800200610     C                     ELSE                                                               CSE110
169900200610     C                     MOVE 'N'       WACNEG                                              CSE110
170000200610     C                     ENDIF                                                              CSE110
170100200610      *                                                                                       CSE110
170200200610     C                     MOVE 'PP'      WACAMC                                              CSE110
170300200610     C                     Z-ADDWPAYDU    EVAM                                                CSE110
170400200610      *                                                                                       CSE110
170500200610     C           WACNEG    IFEQ 'N'                                                           CSE110
170600200610     C                     Z-SUBEVAM      EVAM                                                CSE110
170700200610     C                     ENDIF                                                              CSE110
170800200610      *                                                                                       CSE110
170900200610     C                     EXSR W01                                                           CSE110
171000200610     C                     ENDIF                                                              CSE110
171100200610      *                                                                                       CSE110
171200200610     C                     ENDIF                                                              CSE110
171300200610     C*
171400200610     C* WRITE POSITION SETTLEMENT
171500200610     C*
171600200610     C           PSRI      IFEQ 'Y'                                                           CSE110
171700200610     C           WSRECI    ANDNE'R'                                                           CSE110
171800200610     C           CSE110    ANDEQ'Y'                                                           CSE110
171900200610     C           CSE110    OREQ 'N'                                                           CSE110
172000200610      *                                                                                       CSE110
172100200610     C                     MOVE 'PP'      PEVT
172200200610     C                     Z-ADDDSNV      PNMP
172300200610     C                     Z-ADDWPAYDU    PAMD
172400200610      *                                                                                       CSE110
172500200610     C           CSE110    IFEQ 'Y'                                                           CSE110
172600200610      *                                                                                       CSE110
172700200610     C           PAMD      IFLE 0                                                             CSE110
172800200610     C                     MOVE 'R'       PPRE                                                CSE110
172900200610     C                     ELSE                                                               CSE110
173000200610     C                     MOVE 'P'       PPRE                                                CSE110
173100200610     C                     ENDIF                                                              CSE110
173200200610      *                                                                                       CSE110
173300200610     C                     ENDIF                                                              CSE110
173400200610      *                                                                                       CSE110
173500200610     C           PAMD      IFLT 0
173600200610     C                     Z-SUBPAMD      PAMD
173700200610     C                     END
173800200610     C*
173900200610     C           CSE110    IFEQ 'N'                                                           CSE110
174000200610      *                                                                                       CSE110
174100200610     C           DSNV      IFLE 0
174200200610     C                     MOVE 'R'       PPRE
174300200610     C                     ELSE
174400200610     C                     MOVE 'P'       PPRE
174500200610     C                     END
174600200610      *                                                                                       CSE110
174700200610     C                     ENDIF                                                              CSE110
174800200610     C                     EXSR W02
174900200610      *                                                                                       CSE110
175000200610     C                     ENDIF                                                              CSE110
175100200610      *
175200200610     C           ENDPPY    ENDSR
175300200610      *
175400200610      *****************************************************************
175500200610      /EJECT
175600200610      *****************************************************************
175700200610      *                                                               *
175800200610      *  MORTPY - Subroutine to produce Mortgage Payment Account Keys *
175900200610      *           and/or Position Settlements.                        *
176000200610      *                                                               *
176100200610      *****************************************************************
176200200610      *
176300200610     C           MORTPY    BEGSR                           ** MORTPY **
176400200610     C*                                                                   E36391
176500200610     C** Get the current factor prior to the action date from the         E36391
176600200610     C** security diary. If no details are present, use the current       E36391
176700200610     C** factor from the security.                                        E36391
176800200610     C*                                                                   E36391
176900200610     C           SEDKEY    SETGTSEDEVDO                                   E36391
177000200610     C                     READ SEDEVDO                  81               E36391
177100200610     C           *IN81     IFEQ '0'                                       E36391
177200200610     C           SDSN      ANDEQSASN                                      E36391
177300200610     C           SDET      ANDEQ'MP'                                      E36391
177400200610     C                     Z-ADDSDCP      PCFA                            E36391
177500200610     C                     ELSE                                           E36391
177600200610     C                     Z-ADDCFCT      PCFA                            E36391
177700200610     C                     END                                            E36391
177800200610     C*
177900200610     C** CALCULATE PRINCIPAL REPAYMENT AS:
178000200610     C*    IF REPAYMENT METHOD IND IS Y, REPAYMENT AMOUNT ON SECAD
178100200610     C*
178200200610     C           RTMI      IFEQ 'Y'
178300200610     C***********          Z-ADDRTAI      WPREPA 130                      E23169
178400200610     C                     Z-ADDRTAI      PAMD                            E23169
178500200610     C                     ELSE
178600200610     C*
178700200610     C* ELSE
178800200610     C* NOMINAL VALUE DATE BASIS TIMES
178900200610     C* (PREVIOUS CURRENT FACTOR MINUS CURRENT FACTOR)
179000200610     C* NB ALTHOUGH NOM DEC = NOM DEC CCY FOR MORTGAGE BACKED SEC'TS
179100200610     C* FIELD RTAI IS IN CCY DEC PLACES AND THIS CALC OF WPREPA IS TOO
179200200610     C*
179300200610     C********** PCFA      SUB  SACF      WACF    98                      052254
179400200610     C           PCFA      SUB  SACF      WACF                            052254
179500200610     C*
179600200610      ***  AS THE FIRST DIGIT OF THE DIFFERENCE WILL ALWAYS BE ZERO       E20086
179700200610      ***  THE FOLLOWING PROCESSING IS UNNECESSARY                        E20086
179800200610     C***SPLIT*FIELD*WACF*9/8*TO*1/0*AND*8/8*WRK*FLDS*TO*PREVENT*LOSS**   E20086
179900200610     C***OF*HIGH*ORDER*DIGITS******************************************   E20086
180000200610     C**********                                                          E20086
180100200610     C**********           Z-ADDWACF      WRK10   10                      E20086
180200200610     C**********           Z-ADDWACF      WRK88   88                      E20086
180300200610     C**********                                                          E20086
180400200610     C***MULTIPLY*NOMINAL*VALUE*DATE*BASIS*BY*EACH*WORK*FIELD*AND*SUM     E20086
180500200610     C*
180600200610     C********** DSNV      MULT WRK88     WRK158 158                      E20086
180700200610     C********** DSNV      MULT WRK10     WRK150 150                      E20086
180800200610     C********** WRK158    DIV  1         WRK154 154H                     E20086
180900200610     C********** WRK150    ADD  WRK154    WRK154                          E20086
181000200610     C***********DSNV      MULT WACF      WRK152 152H              E20086 E23169
181100200610     C*
181200200610     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
181300200610     C*
181400200610     C                     MOVE NMCY      WCURR   3
181500200610     C                     EXSR TG10
181600200610     C                     Z-ADDDSNV      ZNOML                           E23169
181700200610     C                     Z-ADDWACF      ZPRC                            E23169
181800200610     C           SPBS      IFEQ 'P'                                       E23169
181900200610     C                     MULT 100       ZPRC                            E23169
182000200610     C                     END                                            E23169
182100200610     C                     EXSR ZCNSD                                     E23169
182200200610     C                     Z-ADDZCONS     PAMD                            E23169
182300200610     C*
182400200610     C***********CDP       SUB  NMDP      DC      10                      E23169
182500200610     C***********DC        ADD  5         DC                              E23169
182600200610     C***********WRK154    MULT POWER8,DC WRK154                   E20086 E23169
182700200610     C***********WRK154    DIV  1         WPREPA 130H              E20086 E23169
182800200610     C***********WRK152    MULT POWER8,DC PAMD      H              E20086 E23169
182900200610     C                     END
183000200610     C*
183100200610      ***  INTEREST IS CALCULATED IN A SEPARATE COUPON EVENT - DO NOT     E20086
183200200610      ***  INCLUDE IN THE MORTGAGE PAYMENT.                               E20086
183300200610      *                                                                   E20086
183400200610     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRD*FOR*SECURITY**************   E20086
183500200610     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E20086
183600200610     C***GET*NOMINAL*CCY*DEC*PLACES*FROM*TABTG10*FIRST*(CDP)***********   E20086
183700200610     C**********                                                          E20086
183800200610     C**********           MOVE NMCY      WCURR   3                       E20086
183900200610     C**********           EXSR TG10                                      E20086
184000200610     C**********           UNLCKLDA                                       E20086
184100200610     C**********           CALL 'ZACCRD'                                  E20086
184200200610     C**********           PARM           LCPN                            E20086
184300200610     C**********           PARM           SAED                            E20086
184400200610     C**********           PARM           DSBR                            E20086
184500200610     C**********           PARM           DDPT                            E20086
184600200610     C**********           PARM           DSSC                            E20086
184700200610     C**********           PARM           CDP                             E20086
184800200610     C**********           PARM           ZINTDU 150                      E20086
184900200610     C**********           PARM           ZAB     1                       E20086
185000200610     C**********                                                          E20086
185100200610     C****MULTIPLY*RESULT*OF*ZACCRD*BY*PREVIOUS*CURR*FACTOR               E20086
185200200610     C**********                                                          E20086
185300200610     C********** ZINTDU    MULT PCFA      WRK154                          E20086
185400200610     C********** WRK154    DIV  1         WINTPY 130H                     E20086
185500200610     C*
185600200610     C* IF POSITION SETTLEMENT REQUIRED                                   E21138
185700200610     C* WRITE POSITION SETTLEMENT RECORD SUBR W02
185800200610     C*
185900200610     C           PSRI      IFEQ 'Y'                                       E21138
186000200610     C           DSNV      ANDNE*ZERO                                     147449
186100200610     C                     MOVE 'MP'      PEVT
186200200610     C                     Z-ADDDSNV      PNMP
186300200610     C*
186400200610     C***AMOUNT*DUE*IS*PRINCIPAL*REPAYMNT*+*INTEREST*******************   E20086
186500200610     C**********                                                          E20086
186600200610     C********** WPREPA    ADD  WINTPY    WRK130 130                      E20086
186700200610     C**********           Z-ADDWRK130    PAMD                            E20086
186800200610     C********** PAMD      IFLT 0                                         E20086
186900200610     C**********           Z-SUBPAMD      PAMD                            E20086
187000200610     C**********           END                                            E20086
187100200610     C**********                                                          E20086
187200200610     C**********                                                          E20086
187300200610     C********** WRK130    IFLE 0                                         E20086
187400200610     C********** PAMD      IFLE 0                                  E20086 147449
187500200610     C           DSNV      IFLE 0                                         147449
187600200610     C                     MOVE 'P'       PPRE
187700200610     C                     ELSE
187800200610     C                     MOVE 'R'       PPRE
187900200610     C                     END
188000200610      *                                                                   E20086
188100200610     C           PAMD      IFLT 0                                         E20086
188200200610     C                     Z-SUBPAMD      PAMD                            E20086
188300200610     C                     END                                            E20086
188400200610     C*
188500200610     C                     EXSR W02
188600200610     C                     END                                            E21138
188700200610     C*
188800200610     C** IF ACCOUNT KEY REQUIRED                                          E21138
188900200610     C* WRITE ACCOUNT KEYS RECORD SUBR W01 - IIIR_X______MVN___FV         E19770
189000200610     C*                                                                   E19770
189100200610     C           AKRI      IFEQ 'Y'                                       E21138
189200200610     C           DSNV      ANDNE*ZERO                                     147449
189300200610     C                     MOVE 'R'       WACEVC                          E19770
189400200610     C*                                                                   E19770
189500200610     C** SET NEGATIVE IND TO ' 'IF NEG POSN ON A/C IS N OR                E19770
189600200610     C** NOM.MATURING IS GREATER THAN ZERO                                E19770
189700200610     C*                                                                   E19770
189800200610     C***********          Z-ADDWPREPA    WRK130 130               E19770 E23169
189900200610     C           NPAC      IFEQ 'N'                                       E19770
190000200610     C***********WRK130    ORGT 0                                  E19770 E23169
190100200610     C***********PAMD      ORGT 0                                  E23169 152391
190200200610     C           DSNV      ORGT 0                                         152391
190300200610     C                     MOVE ' '       WACNEG                          E19770
190400200610     C                     ELSE                                           E19770
190500200610     C                     MOVE 'N'       WACNEG                          E19770
190600200610     C                     END                                            E19770
190700200610     C                     MOVE 'FV'      WACAMC                          E19770
190800200610     C***********          Z-ADDWRK130    EVAM                     E19770 E23169
190900200610      *                                                                   152391
191000200610      * Ensure event amount is same sign as nominal                       152391
191100200610      *                                                                   152391
191200200610     C           DSNV      IFLT *ZERO                                     152391
191300200610     C                     Z-SUBPAMD      EVAM                            152391
191400200610     C                     ELSE                                           152391
191500200610     C                     Z-ADDPAMD      EVAM                            E23169
191600200610     C                     ENDIF                                          152391
191700200610     C*                                                                   E19770
191800200610     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG POSITION ON ACC IS Y    E19770
191900200610     C** AND AMNT DUE IS LESS THAN ZERO                                   E19770
192000200610     C*                                                                   E19770
192100200610     C***********WRK130    IFLT 0                                  E19770 E23169
192200200610     C***********PAMD      IFLT 0                                  E23169 152391
192300200610     C           EVAM      IFLT 0                                         152391
192400200610     C           NPAC      ANDEQ'Y'                                       E19770
192500200610     C                     Z-SUBEVAM      EVAM                            E19770
192600200610     C                     END                                            E19770
192700200610     C                     EXSR W01                                       E19770
192800200610     C/COPY WNCPYSRC,SE2390C014
192900200610     C                     END                                            E21138
193000200610     C*
193100200610     C           ENDMPY    ENDSR
193200200610      *
193300200610      *****************************************************************
193400200610      /EJECT
193500200610      *****************************************************************
193600200610      *                                                               *
193700200610      *  MATURE - Subroutine to produce Maturity Position Settlements.*
193800200610      *                                                               *
193900200610      *****************************************************************
194000200610      *
194100200610     C           MATURE    BEGSR                           ** MATURE **
194200200610     C*
194300200610      ***  A separate Coupon Event is now produced at Maturity and this   E21573
194400200610      ***  should be used to generate Position Settlement for Interest.   E21573
194500200610     C*                                                                   E21573
194600200610     C***USE*LAST*COUPON*DATE*FROM*THE*SECURITY*ACTION************ E15549 E21573
194700200610     C***********                                                  E15549 E21573
194800200610     C***********          Z-ADDSALCCP    LCPN                     E15549 E21573
194900200610     C***********                                                         E21573
195000200610     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRD*FOR*SECURITY**************   E21573
195100200610     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E21573
195200200610     C***GET*NOMINAL*CCY*DEC*PLACES*FROM*TABTG10*FIRST*(CDP)***********   E21573
195300200610     C***********                                                         E21573
195400200610     C***********          MOVE NMCY      WCURR   3                       E21573
195500200610     C***********          EXSR TG10                                      E21573
195600200610     C***********          UNLCKLDA                                       E21573
195700200610     C***********          CALL 'ZACCRD'                                  E21573
195800200610     C***********          PARM           LCPN                            E21573
195900200610     C***********          PARM           SAED                            E21573
196000200610     C***********          PARM           DSBR                            E21573
196100200610     C***********          PARM           DDPT                            E21573
196200200610     C***********          PARM           DSSC                            E21573
196300200610     C***********          PARM           CDP                             E21573
196400200610     C***********          PARM           ZINTDU 150                      E21573
196500200610     C***********          PARM           ZAB     1                       E21573
196600200610     C*
196700200610     C** USE LAST COUPON DATE FROM THE SECURITY ACTION                    E15549
196800200610     C*                                                                   E15549
196900200610     C                     Z-ADDSALCCP    LCPN                            E15549
197000200610     C*
197100200610     C** CALCULATE INTEREST DUE VIA P/ZACCRD FOR SECURITY
197200200610     C*  FROM DATE IS LAST COUPON / TO DATE IS EVENT DATE.
197300200610     C*  GET NOMINAL CCY DEC PLACES FROM TABTG10 FIRST (CDP)
197400200610     C*
197500200610     C                     MOVE NMCY      WCURR   3
197600200610     C                     EXSR TG10
197700200610     C***********          UNLCKLDA                                       S01117
197800200610     C/COPY WNCPYSRC,SE2390C028
197900200610     C                     CALL 'ZACCRD'
198000200610     C                     PARM           LCPN
198100200610     C                     PARM           SAED
198200200610     C***********          PARM           DSBR                            S01117
198300200610     C                     PARM           DSBA                            S01117
198400200610     C                     PARM           DDPT
198500200610     C                     PARM           DSSC
198600200610     C                     PARM           CDP
198700200610     C                     PARM           ZINTDU 150
198800200610     C                     PARM           ZINDUE 151                      055420
198900200610     C                     PARM           ZAB     1
199000200610      *                                                                         AR1001183 AR1001183A
199100200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
199200200610     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
199300200610     C********** FRATE     IFLE 0                                               AR1001183 AR1001183A
199400200610      ***The*following*fields*sets*PAMD*to*zero                                 AR1001183 AR1001183A
199500200610     C**********           Z-ADD0         ZINTDU                                AR1001183 AR1001183A
199600200610     C**********           Z-ADD0         ZINDUE                                AR1001183 AR1001183A
199700200610     C**********           ENDIF                                                AR1001183 AR1001183A
199800200610     C**********           ENDIF                                                AR1001183 AR1001183A
199900200610     C/COPY WNCPYSRC,SE2390C029
200000200610     C*
200100200610     C***OBTAIN*PRICE*AT*MATURITY*-*CHECK*LF/SECED*FOR*REDEMPTION*PRICE   E20016
200200200610     C** OBTAIN PRICE AT MATURITY - CHECK LF/SEDEV FOR REDEMPTION PRICE   E20016
200300200610     C*
200400200610     C                     Z-ADD0         SDRP
200500200610     C                     Z-ADDMATY      SDED
200600200610     C                     MOVE 'RC'      SDET
200700200610     C*
200800200610     C** CHECK FILE FOR EITHER 'RC' TYPE OR 'RP' TYPE IN KEY FIELD
200900200610     C*
201000200610     C                     EXSR SECEDI
201100200610     C           *IN78     IFEQ '1'
201200200610     C                     MOVE 'RP'      SDET
201300200610     C                     EXSR SECEDI
201400200610     C                     END
201500200610     C           *IN78     IFEQ '1'
201600200610     C*
201700200610     C** IF NEITHER RC NOR RP USE 100 IF PRICE BASIS IS P,ELSE 1 (U)
201800200610     C** Or if RP/RC record found AND price is zero and S01509 is         S01509
201900200610     C** active, use 100 if price basis is P, else 1                      S01509
202000200610     C*
202100200610     C           *IN78     OREQ '0'                                       S01509
202200200610     C           SDRP      ANDEQ0                                         S01509
202300200610     C           S01509    ANDEQ'Y'                                       S01509
202400200610     C*                                                                   S01509
202500200610     C           SPBS      IFEQ 'P'
202600200610     C                     Z-ADD100       SDRP
202700200610     C                     END
202800200610     C***********SPBS      IFEQ 'U'                                       103011
202900200610     C***********          Z-ADD1         SDRP                            103011
203000200610     C***********          END                                            103011
203100200610     C           PROT      IFEQ '1'                                       192467
203200200610     C           SPBS      ANDEQ'U'                                       192467
203300200610     C                     Z-ADD1         SDRP                            192467
203400200610     C                     ENDIF                                          192467
203500200610     C                     END
203600200610     C*                                                                   100537
203700200610     C           PROT      IFEQ '8'                                       100537
203800200610     C*                                                                   100537
203900200610     C** Get the current factor prior to the action date from the         100537
204000200610     C** security diary. If no details are present, use the current       100537
204100200610     C** factor from the security. As these securities are always         100537
204200200610     C** SBPS = P, multiply by 100.                                       100537
204300200610     C*                                                                   100537
204400200610     C           SEDKEY    SETGTSEDEVDO                                   100537
204500200610     C                     READ SEDEVDO                  81               100537
204600200610     C           *IN81     IFEQ '0'                                       100537
204700200610     C           SDSN      ANDEQSASN                                      100537
204800200610     C           SDET      ANDEQ'MP'                                      100537
204900200610     C           SDCP      MULT 100       SDRP                            100537
205000200610     C                     ELSE                                           100537
205100200610     C           CFCT      MULT 100       SDRP                            100537
205200200610     C                     END                                            100537
205300200610     C*                                                                   100537
205400200610     C                     END                                            100537
205500200610     C*
205600200610     C**  CALCULATE NOMINAL MATURING AT DEPOT AS
205700200610     C**  NOMINAL VALUE DATE BASIS TIMES PRICE AT MATURITY
205800200610     C*
205900200610     C***********          Z-ADDSDRP      WRK08   88                      E23169
206000200610     C***********          Z-ADDSDRP      WRK150 150                      E23169
206100200610     C***********DSNV      MULT WRK08     WRK156 156                      E23169
206200200610     C***********WRK156    DIV  1         WNOMAT 130H                     E20151
206300200610     C***********WRK156    DIV  1         WNOMAT 150H              E20151 E23169
206400200610     C***********                                                         E23169
206500200610     C***********DSNV      MULT WRK150    WRK150                          E23169
206600200610     C***********WRK150    ADD  WNOMAT    WNOMAT                          E23169
206700200610     C*
206800200610     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
206900200610     C*
207000200610     C                     MOVE NMCY      WCURR   3
207100200610     C                     EXSR TG10
207200200610     C*
207300200610     C**IF*78*IS*ON,*NO*PRICE*ON*SEC*EVENT*FILE*SO*CCY*FLD*'CDP'*IS*0     E20151
207400200610     C*
207500200610     C***********CDP       SUB  NMDP      DC      10                      E23169
207600200610     C***78******          Z-SUBNMDP      DC                              E20151
207700200610     C***********DC        ADD  5         DC                              E23169
207800200610     C***********                                                  E20151 E23169
207900200610     C***ADJUST*FOR PERCENTAGE PRICING                             E20151 E23169
208000200610     C***********                                                  E20151 E23169
208100200610     C***********SPBS      IFEQ 'P'                                E20151 E23169
208200200610     C***********          SUB  2         DC                       E20151 E23169
208300200610     C***********          END                                     E20151 E23169
208400200610     C***********                                                  E20151 E23169
208500200610     C***********DC        IFLT 5                                         E23169
208600200610     C***********WNOMAT    MULT POWER8,DC WRK151 151                      E23169
208700200610     C***********WRK151    DIV  1         WNOMAT    H                     E23169
208800200610     C***********          ELSE                                           E23169
208900200610     C***********WNOMAT    MULT POWER8,DC WNOMAT                          E23169
209000200610     C***********          END                                            E23169
209100200610     C*                                                                   E23169
209200200610     C** Use ZCNSD subroutin to calculate Amount                          E23169
209300200610     C*                                                                   E23169
209400200610     C                     Z-ADDSDRP      ZPRC                            E23169
209500200610     C                     Z-ADDDSNV      ZNOML                           E23169
209600200610     C                     EXSR ZCNSD                                     E23169
209700200610     C                     Z-ADDZCONS     WNOMAT 150                      E23169
209800200610     C*                                                                   S01509
209900200610     C** If S01509 is active and redemption currency is not blank and     S01509
210000200610     C** is different from the nominal currency, convert maturity         S01509
210100200610     C** amount to redemption currency                                    S01509
210200200610     C*                                                                   S01509
210300200610     C           S01509    IFEQ 'Y'                                       S01509
210400200610     C           *IN78     ANDEQ'0'                                       S01509
210500200610     C           SDCX      ANDNE*BLANKS                                   S01509
210600200610     C           SDCX      ANDNENMCY                                      S01509
210700200610     C                     MOVE NMCY      WCURR   3                       S01509
210800200610     C                     EXSR TG10                                      S01509
210900200610     C                     Z-ADDZCDP      ZCDPI                           S01509
211000200610     C                     MOVE SDCX      WCURR   3                       S01509
211100200610     C                     EXSR TG10                                      S01509
211200200610     C                     Z-ADDZCDP      ZCDPO                           S01509
211300200610     C                     MOVE NMCY      ZCCYI                           S01509
211400200610     C                     MOVE SDCX      ZCCYO                           S01509
211500200610     C                     Z-ADDWNOMAT    ZAMTCI                          S01509
211600200610     C                     Z-ADDSDCE      ZEXCH                           S01509
211700200610     C                     MOVE SDMD      ZMD                             S01509
211800200610     C                     EXSR ZCONV                                     S01509
211900200610     C                     Z-ADDZAMTCO    WNOMAT                          S01509
212000200610     C                     END                                            S01509
212100200610     C/COPY WNCPYSRC,SE2390C036
212200200610     C*                                                                   E23169
212300200610     C*
212400200610     C* WRITE POSITION SETTLEMENT RECORD SUBR W02
212500200610     C*
212600200610     C**********           MOVE 'MA'      PEVT                            E14716
212700200610     C                     MOVE 'MT'      PEVT                            E14716
212800200610     C                     Z-ADDDSNV      PNMP
212900200610     C*
213000200610     C***AMOUNT*DUE*IS*NOMINAL*MATURING**AT*DEPOT**+*INTEREST*****        E19430
213100200610     C** Amount due is nominal maturing at depot (interest is separate).  E19430
213200200610     C*
213300200610     C********** WNOMAT    ADD  ZINTDU    WRK130 130                      E19430
213400200610     C**********           Z-ADDWRK130    PAMD                            E19430
213500200610     C*                                                                   E21138
213600200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02     E21138
213700200610     C*                                                                   E21138
213800200610     C           PSRI      IFEQ 'Y'                                       E21138
213900200610     C                     Z-ADDWNOMAT    PAMD                            E19430
214000200610     C           PAMD      IFLT 0
214100200610     C                     Z-SUBPAMD      PAMD
214200200610     C                     END
214300200610     C*
214400200610     C********** WRK130    IFLE 0                                         E19430
214500200610     C           WNOMAT    IFLE 0                                         E19430
214600200610     C                     MOVE 'P'       PPRE
214700200610     C                     ELSE
214800200610     C                     MOVE 'R'       PPRE
214900200610     C                     END
215000200610     C/COPY WNCPYSRC,SE2390C031
215100200610     C                     EXSR W02
215200200610     C/COPY WNCPYSRC,SE2390C035
215300200610     C                     END                                            E21138
215400200610     C*
215500200610     C* IF ACCOUNT KEY REQUIRED                                           E21138
215600200610     C* WRITE ACCOUNT KEYS RECORD SUBR W01 - IIIM_X______MVN___CV         E19770
215700200610     C*                                                                   E19770
215800200610     C           AKRI      IFEQ 'Y'                                       E21138
215900200610     C                     MOVE 'M'       WACEVC                          E19770
216000200610     C***********          Z-ADDWNOMAT    WRK130                   E19430 E23169
216100200610     C                     Z-ADDWNOMAT    WRK130 130                      E23169
216200200610     C*                                                                   E19770
216300200610     C** SET NEGATIVE IND TO ' 'IF NEG POSN ON A/C IS N OR                E19770
216400200610     C** NOM.MATURING + INTEREST IS GREATER THAN ZERO                     E19770
216500200610     C*                                                                   E19770
216600200610     C           NPAC      IFEQ 'N'                                       E19770
216700200610     C           WRK130    ORGT 0                                         E19770
216800200610     C                     MOVE ' '       WACNEG                          E19770
216900200610     C                     ELSE                                           E19770
217000200610     C                     MOVE 'N'       WACNEG                          E19770
217100200610     C                     END                                            E19770
217200200610     C                     MOVE 'CV'      WACAMC                          E19770
217300200610     C                     Z-ADDWRK130    EVAM                            E19770
217400200610     C*                                                                   E19770
217500200610     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG POSITION ON ACC IS Y    E19770
217600200610     C** AND AMNT DUE IS LESS THAN ZERO                                   E19770
217700200610     C*                                                                   E19770
217800200610     C           WRK130    IFLT 0                                         E19770
217900200610     C           NPAC      ANDEQ'Y'                                       E19770
218000200610     C                     Z-SUBEVAM      EVAM                            E19770
218100200610     C                     END                                            E19770
218200200610     C                     EXSR W01                                       E19770
218300200610     C/COPY WNCPYSRC,SE2390C015
218400200610     C                     END                                            E21138
218500200610     C*                                                                   E19770
218600200610     C           ENDMAT    ENDSR
218700200610      *
218800200610      *****************************************************************
218900200610      /EJECT
219000200610      *****************************************************************
219100200610      *                                                               *
219200200610      *  W01    - Subroutine to Write an Account Key.                 *
219300200610      *                                                               *
219400200610      *****************************************************************
219500200610      *
219600200610     C           W01       BEGSR                           **   W01  **
219700200610     C*
219800200610     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
219900200610     C*
220000200610     C           EVAM      CABEQ0         ENDW01
220100200610     C*
220200200610     C* COUNT RECORDS WRITTEN AND USE STD HASH SUBROUTINE
220300200610     C*
220400200610     C                     ADD  1         W01CNT  50
220500200610     C*
220600200610     C**  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
220700200610     C*   ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
220800200610     C*
220900200610     C                     Z-ADD1         Z
221000200610     C                     Z-ADD1         S
221100200610     C                     Z-ADDEVAM      ZZAMT
221200200610     C                     EXSR ZHASH
221300200610     C*
221400200610     C* BUILD OUTPUT RECORD
221500200610     C*
221600200610     C                     MOVE SITP      WACITY
221700200610     C                     MOVE ' '       WACTRT
221800200610     C                     MOVE 'X'       WACPFI
221900200610     C                     MOVE '  '      WACBKC
222000200610     C                     MOVE '  '      WACTST
222100200610     C                     MOVE '  '      WACPSB
222200200610     C                     MOVE '  '      WACCCC
222300200610     C***********          MOVE 'S'       WACMKT                          131379
222400200610     C                     MOVE MKTI      WACMKT                          131379
222500200610     C           CIAK      IFEQ 'Y'
222600200610     C           SCVI      ANDEQ'Y'                                       E14522
222700200610     C                     MOVE SCVI      WACCON
222800200610     C                     ELSE
222900200610     C                     MOVE ' '       WACCON
223000200610     C                     END
223100200610     C           WACAMC    IFEQ 'FP'                                      E16085
223200200610     C           WACAMC    OREQ 'FR'                                      E16085
223300200610     C           WACAMC    OREQ 'CP'                                      E16085
223400200610     C           WACAMC    OREQ 'CR'                                      E16085
223500200610     C                     MOVE *BLANKS   WACBKC                          E16085
223600200610     C                     END                                            E16085
223700200610     C                     MOVE WACKEY    ACKY
223800200610     C                     MOVE 'D'       RECI
223900200610     C*                                                                   S01509
224000200610     C** If S01509 is active, event currency could be equal to value ccy, S01509
224100200610     C** redemption ccy or nominal ccy depending on the event type        S01509
224200200610     C*                                                                   S01509
224300200610     C           S01509    IFEQ 'Y'                                       S01509
224400200610     C                     SELEC                                          S01509
224500200610     C           SAAT      WHEQ 'DV'                                      S01509
224600200610     C           SAAT      OREQ 'CP'                                      S01509
224700200610     C                     MOVE VLCY      EVCY                            S01509
224800200610     C           SAAT      WHEQ 'MA'                                      S01509
224900200610     C           *IN78     ANDEQ'0'                                       S01509
225000200610     C           SDCX      ANDNE*BLANKS                                   S01509
225100200610     C                     MOVE SDCX      EVCY                            S01509
225200200610     C                     OTHER                                          S01509
225300200610     C                     MOVE NMCY      EVCY                            S01509
225400200610     C                     ENDSL                                          S01509
225500200610     C*                                                                   S01509
225600200610     C                     ELSE                                           S01509
225700200610     C                     MOVE NMCY      EVCY
225800200610     C                     ENDIF                                          S01509
225900200610     C*                                                                   S01509
226000200610     C***********AUMO      IFEQ 'Y'                                 103361074380
226100200610     C***********PPRE      ANDEQ'R'                                 103361074380
226200200610     C           PPRE      IFEQ 'R'                                       074380
226300200610     C           SRSM      ANDEQ04                                        103361
226400200610     C***********AUMO      OREQ 'Y'                                 103361074380
226500200610     C***********PPRE      ANDEQ'P'                                 103361074380
226600200610     C           PPRE      OREQ 'P'                                       074380
226700200610     C           SPSM      ANDEQ04                                        103361
226800200610     C                     ELSE                                           103361
226900200610     C                     MOVE *BLANK    STLA
227000200610     C                     END                                            103361
227100200610     C*                                                                   103361
227200200610     C           WSRECI    IFEQ 'R'
227300200610     C                     MOVE '1'       RVRS
227400200610     C                     ELSE
227500200610     C                     MOVE '0'       RVRS
227600200610     C                     END
227700200610     C                     MOVE DSSC      SESH
227800200610     C                     Z-ADD0         TRFR
227900200610     C                     MOVELDDPT      CSTN              ??10A-6N
228000200610     C***********          MOVE DSBR      BRCH                            S01117
228100200610     C                     MOVE DSBA      BRHA                            S01117
228200200610     C**********           Z-ADD01        ASQN                            E18803
228300200610     C                     Z-ADD00        ASQN                            E18803
228400200610     C                     Z-ADDSAED      EVDT
228500200610     C                     Z-ADD0         KNCA
228600200610     C                     Z-ADD0         KBCA
228700200610     C                     MOVELDDPT      KCUST            ?10A/6N
228800200610     C*                                                                   103361
228900200610     C***********AUMO      IFEQ 'Y'                                 103361074380
229000200610     C***********PPRE      ANDEQ'R'                                 103361074380
229100200610     C           PPRE      IFEQ 'R'                                       074380
229200200610     C           SRSM      ANDEQ04                                        103361
229300200610     C***********AUMO      OREQ 'Y'                                 103361074380
229400200610     C***********PPRE      ANDEQ'P'                                 103361074380
229500200610     C           PPRE      OREQ 'P'                                       074380
229600200610     C           SPSM      ANDEQ04                                        103361
229700200610     C                     ELSE                                           103361
229800200610     C                     Z-ADD0         STLT
229900200610     C                     END                                            103361
230000200610     C*                                                                   103361
230100200610     C***********          MOVE '   '     KCCY                            S01176
230200200610     C                     MOVE NMCY      KCCY                            S01176
230300200610     C*                                                                   S01117
230400200610     C** Profit Centres are not applicaable to depot positions            S01117
230500200610     C** therefore ensure that any depot position account keys have       S01117
230600200610     C** a blank profit centre                                            S01117
230700200610     C*                                                                   S01117
230800200610     C                     MOVE *BLANKS   PRFC                            S01117
230900200610     C*                                                                   CAC002
231000200610     C**  If Analytical Accounting is installed, set the profit centre    CAC002
231100200610     C**  SE ICD default profit centre.                                   CAC002
231200200610     C*                                                                   CAC002
231300200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
231400200610     C                     MOVE BVSEPC    PRFC                            CAC002
231500200610     C                     ENDIF                                          CAC002
231600200610      *                                                                                       CGL020
231700200610     C           CGL020    IFEQ 'Y'                                                           CGL020
231800200610      *                                                                                       CGL020
231900200610     C           STLA      IFEQ *BLANKS                                                       CGL020
232000200610     C                     MOVE *BLANKS   F1RACT                                              CGL020
232100200610     C                     MOVE *BLANKS   F1RCTY                                              CGL020
232200200610     C                     MOVE *BLANKS   F1RBNK                                              CGL020
232300200610     C                     MOVE *BLANKS   F1RCDE                                              CGL020
232400200610     C                     MOVE *BLANKS   F1PACT                                              CGL020
232500200610     C                     MOVE *BLANKS   F1PCTY                                              CGL020
232600200610     C                     MOVE *BLANKS   F1PBNK                                              CGL020
232700200610     C                     MOVE *BLANKS   F1PCDE                                              CGL020
232800200610     C                     MOVE *BLANKS   F1DACT                                              CGL020
232900200610     C                     MOVE *BLANKS   F1DCTY                                              CGL020
233000200610     C                     MOVE *BLANKS   F1DBNK                                              CGL020
233100200610     C                     Z-ADD*ZEROS    F1SDAT                                              CGL020
233200200610      *                                                                                       CGL020
233300200610     C                     ELSE                                                               CGL020
233400200610     C                     MOVE WWRACT    F1RACT                                              CGL020
233500200610     C                     MOVE WWRCTY    F1RCTY                                              CGL020
233600200610     C                     MOVE WWRBNK    F1RBNK                                              CGL020
233700200610     C                     MOVE WWRCDE    F1RCDE                                              CGL020
233800200610     C                     MOVE WWPACT    F1PACT                                              CGL020
233900200610     C                     MOVE WWPCTY    F1PCTY                                              CGL020
234000200610     C                     MOVE WWPBNK    F1PBNK                                              CGL020
234100200610     C                     MOVE WWPCDE    F1PCDE                                              CGL020
234200200610     C                     MOVE WWDACT    F1DACT                                              CGL020
234300200610     C                     MOVE WWDCTY    F1DCTY                                              CGL020
234400200610     C                     MOVE WWDBNK    F1DBNK                                              CGL020
234500200610     C                     Z-ADDWWSDAT    F1SDAT                                              CGL020
234600200610      *                                                                                       CGL020
234700200610     C                     ENDIF                                                              CGL020
234800200610      *                                                                                       CGL020
234900200610     C                     MOVE *BLANKS   F1TICK                                              CGL020
235000200610     C                     MOVE *BLANKS   F1EXCH                                              CGL020
235100200610     C                     Z-ADD*ZEROS    F1NOML                                              CGL020
235200200610     C                     ENDIF                                                              CGL020
235300200610     C*
235400200610     C* WRITE GENERATED ACCOUNT KEY RECORD
235500200610     C*
235600200610     C                     WRITESEKEYDF
235700200610     C*
235800200610     C           ENDW01    ENDSR
235900200610      *
236000200610      *****************************************************************
236100200610      /EJECT
236200200610      *****************************************************************
236300200610      *                                                               *
236400200610      *  W02    - Subroutine to Write a Position Settlement.          *
236500200610      *                                                               *
236600200610      *****************************************************************
236700200610      *
236800200610     C           W02       BEGSR                           **   W02  **
236900200610     C*
237000200610     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
237100200610     C*
237200200610     C           PAMD      CABEQ0         ENDW02
237300200610      *                                                                                       260331
237400200610     C           WSRECI    IFEQ 'R'                                                           260331
237500200610     C           PPRE      IFEQ 'R'                                                           260331
237600200610     C                     MOVEL'P'       PPRE                                                260331
237700200610     C                     ELSE                                                               260331
237800200610     C           PPRE      IFEQ 'P'                                                           260331
237900200610     C                     MOVEL'R'       PPRE                                                260331
238000200610     C                     ENDIF                                                              260331
238100200610     C                     ENDIF                                                              260331
238200200610     C                     ENDIF                                                              260331
238300200610     C*
238400200610     C**COUNT*RECORDS*WRITTEN**************************************       CSE023
238500200610     C*************************************************************       CSE023
238600200610     C***********          ADD  1         W02CNT  50                      CSE023
238700200610     C*
238800200610     C                     MOVE 'D'       RECI
238900200610     C***********          MOVE 'S'       PMAR                            162208
239000200610     C                     MOVE MKTI      PMAR                            162208
239100200610     C***********          MOVE DSBR      PBCH                            S01117
239200200610     C                     MOVE DSBA      PBCA                            S01117
239300200610     C                     MOVE DSSC      PSSH
239400200610     C                     MOVELDDPT      PCPY             ??10A/6N
239500200610     C*                                                                   CSE023
239600200610     C                     MOVE 'D'       CTYP                            CSE023
239700200610     C                     Z-ADD0         BAUS                            CSE023
239800200610     C                     Z-ADD0         MAMT                            CSE023
239900200610     C                     Z-ADD0         DAMT                            CSE023
240000200610     C                     Z-ADD0         PSEQ                            CSE023
240100200610     C                     Z-ADD0         SABC                            CSE023
240200200610     C*                                                                   CSE023
240300200610     C           SAAT      IFEQ 'MP'
240400200610     C           SAAT      OREQ 'DV'
240500200610     C           S01512    ANDNE'Y'                                       088423
240600200610      *                                                                   S01408
240700200610     C/COPY WNCPYSRC,SE2390CCP2                                           S01408
240800200610      *                                                                   S01408
240900200610      ** If Enhanced Treasury is switched on:                                                 CSE075
241000200610      ** Some securities have a standard coupon delay.  If SE2100 has set                     CSE075
241100200610      ** up the 'Other Date' field, use this as the due date for payments.                    CSE075
241200200610      *                                                                                       CSE075
241300200610     C********** SAAT      OREQ 'CP'                                                 CSE075 BUG11046
241400200610     C********** SAOD      ANDNE0                                                    CSE075 BUG11046
241500200610     C********** CSE075    ANDEQ'Y'                                                  CSE075 BUG11046
241600200610     C                     Z-ADDSAOD      PDUD
241700200610     C                     ELSE
241800200610     C                     Z-ADDSAED      PDUD
241900200610     C                     END
242000200610     C/COPY WNCPYSRC,SE2390C016
242100200610     C*
242200200610     C           APNS      IFEQ 'Y'
242300200610     C                     MOVE 'Y'       PAUI
242400200610     C                     MOVE 'Y'       PSMI                            S01401
242500200610     C                     ELSE
242600200610     C                     MOVE ' '       PAUI
242700200610     C                     END
242800200610     C*                                                                   S01509
242900200610     C** If S01509 is active, position currency could be equal to value   S01509
243000200610     C** ccy, redemption ccy or nominal ccy depending on the event type   S01509
243100200610     C*                                                                   S01509
243200200610     C           S01509    IFEQ 'Y'                                       S01509
243300200610     C                     SELEC                                          S01509
243400200610     C           SAAT      WHEQ 'DV'                                      S01509
243500200610     C           SAAT      OREQ 'CP'                                      S01509
243600200610     C                     MOVE VLCY      PNCY                            S01509
243700200610     C           SAAT      WHEQ 'MA'                                      S01509
243800200610     C           *IN78     ANDEQ'0'                                       S01509
243900200610     C           SDCX      ANDNE*BLANKS                                   S01509
244000200610     C                     MOVE SDCX      PNCY                            S01509
244100200610     C                     OTHER                                          S01509
244200200610     C                     MOVE NMCY      PNCY                            S01509
244300200610     C                     ENDSL                                          S01509
244400200610     C*                                                                   S01509
244500200610     C                     ELSE                                           S01509
244600200610     C                     MOVE NMCY      PNCY
244700200610     C                     ENDIF                                          S01509
244800200610     C*                                                                   S01512
244900200610     C** Value date - set initially to due date                           S01512
245000200610     C** Should be date of the next working day after value date in       S01512
245100200610     C** value currency if S01512 is active                               S01512
245200200610     C*                                                                   S01512
245300200610     C           S01512    IFEQ 'Y'                                       S01512
245400200610     C           SAAT      IFEQ 'DV'                                      088423
245500200610     C           SAOD      SUB  1         ZDAYNO                          088423
245600200610     C                     ELSE                                           088423
245700200610     C           PDUD      SUB  1         ZDAYNO                          S01512
245800200610     C                     ENDIF                                          088423
245900200610     C                     MOVE PNCY      ZCCY                            S01512
246000200610     C                     Z-ADD1         ZNRDYS                          S01512
246100200610     C                     EXSR ZFWDT                                     S01512
246200200610     C                     Z-ADDZDYNBR    PSVL                            S01512
246300200610     C                     ELSE                                           S01512
246400200610     C           SAAT      IFEQ 'DV'                                      088423
246500200610     C                     Z-ADDSAOD      PSVL                            088423
246600200610     C                     ELSE                                           088423
246700200610     C                     Z-ADDPDUD      PSVL                            S01512
246800200610     C                     ENDIF                                          088423
246900200610     C                     END                                            S01512
247000200610     C           CSE075    IFEQ 'Y'                                                         BUG11046
247100200610     C           SAAT      ANDEQ'CP'                                                        BUG11046
247200200610     C           SAOD      ANDNE0                                                           BUG11046
247300200610     C                     Z-ADDSAOD      PSVL                                              BUG11046
247400200610     C                     ENDIF                                                            BUG11046
247500200610     C*                                                                   S01512
247600200610     C                     MOVE DMKB      PBCD
247700200610     C                     MOVE '0'       PYCUSD  1
247800200610      *                                                                   E23169
247900200610      ** Payment currency and settlement exchange rate are held on        E23169
248000200610      ** SECTYD for straight, dual- and multi-currency securities.        E23169
248100200610      ** Exchange rate=1 for straight securities.                         E23169
248200200610     C** If S01509 is active, settle = pos currency, exchange rate is     S01509
248300200610     C** 1 with mult/div indicator as 'M'                                 S01509
248400200610      *                                                                   E23169
248500200610     C           S01509    IFEQ 'Y'                                       S01509
248600200610     C                     MOVE PNCY      PSCU                            S01509
248700200610     C                     Z-ADD1         PSXR                            S01509
248800200610     C                     MOVE 'M'       PMDI                            S01509
248900200610     C                     ELSE                                           S01509
249000200610     C                     MOVE SPYC      PSCU                            E23169
249100200610     C                     Z-ADDSEXR      PSXR                            E23169
249200200610     C                     MOVE SMDI      PMDI                            E23169
249300200610     C                     END                                            S01509
249400200610      *                                                                   E23169
249500200610     C***********VLCY      IFNE '   '                                     E23169
249600200610     C*********************MOVE VLCY      PSCU                            E23169
249700200610     C*********************ELSE                                           E23169
249800200610     C***********SPYC      IFNE '   '                                     E23169
249900200610     C******************************************************************* E23169
250000200610     C***IF*PAYMENT*CURRENCY*USED*SET*FLAG*PYCUSD*TO*1*-*CHECK*BELOW***** E23169
250100200610     C*********************                                               E23169
250200200610     C*********************MOVE '1'       PYCUSD                          E23169
250300200610     C*********************MOVE SPYC      PSCU                            E23169
250400200610     C*********************ELSE                                           E23169
250500200610     C*********************MOVE NMCY      PSCU                            E23169
250600200610     C*********************END                                            E23169
250700200610     C*********************END                                            E23169
250800200610     C******************************************************************* E23169
250900200610     C** CALCULATE SETTLEMENT*EXCHANGE*RATE*-*CHECK*FLAG*PYCUSD********** E23169
251000200610     C******************************************************************* E23169
251100200610     C***********PYCUSD    IFEQ '1'                                       E23169
251200200610     C*********************Z-ADDSEXR      PSXR                            E23169
251300200610     C*********************MOVE SMDI      PMDI                            E23169
251400200610     C*********************ELSE                                           E23169
251500200610     C******************************************************************* E23169
251600200610     C* GET SPOT RATE*FOR*EACH*OF*SETT.*CCY*AND*NOM*CCY*FROM*TABTG10***** E23169
251700200610     C* THEN CALCULATE*CROSS*RATE*USING*ZXRATE*************************** E23169
251800200610     C******************************************************************* E23169
251900200610     C*********************MOVE PSCU      WCURR                           E23169
252000200610     C*********************EXSR TG10                                      E23169
252100200610     C*********************Z-ADDSPOT      ZRATE1 138                      E23169
252200200610     C*********************MOVE MDIN      ZMDI1   1                       E23169
252300200610     C*********************MOVE PNCY      WCURR                           E23169
252400200610     C*********************EXSR TG10                                      E23169
252500200610     C*********************Z-ADDSPOT      ZRATE2 138                      E23169
252600200610     C*********************MOVE MDIN      ZMDI2   1                       E23169
252700200610     C*********************EXSR ZXRATE                                    E23169
252800200610     C*********************Z-ADDZRATEX    PSXR                            E23169
252900200610     C******************************************************************* E23169
253000200610     C***MULTIPLY/DIVIDE*IND*ON*TABTG10*IS*0=DIV*1=MULT*******************E23169
253100200610     C******************************************************************* E23169
253200200610     C***********ZMDIX     IFEQ '0'                                       E23169
253300200610     C*********************MOVEL'D'       PMDI                            E23169
253400200610     C*********************ELSE                                           E23169
253500200610     C*********************MOVEL'M'       PMDI                            E23169
253600200610     C*********************END                                            E23169
253700200610     C*********************END                                            E23169
253800200610     C/COPY WNCPYSRC,SE2390C017
253900200610     C*
254000200610     C** BASIC CURR EXCHANGE RATE IS SPOT RATE FOR SETTLEMENT CURRCY
254100200610     C*
254200200610     C                     MOVE PSCU      WCURR
254300200610     C                     EXSR TG10
254400200610     C                     Z-ADDSPOT      PBRX
254500200610     C/COPY WNCPYSRC,SE2390C018
254600200610     C*
254700200610     C** ACCESS STANDARD SETTLEMENT INSTRUCTIONS FILE
254800200610     C*
254900200610     C***********          MOVE PBCH      SBRH                            S01117
255000200610     C                     MOVE PBCA      SBRA                            S01117
255100200610     C                     MOVELPCPY      CSTM
255200200610     C                     MOVE PSCU      CYSI
255300200610     C                     MOVE SITP      ITSI
255400200610     C*
255500200610     C                     Z-ADD0         PSMT
255600200610     C                     MOVE *BLANK    PSEA
255700200610     C                     MOVE *BLANK    PSEB
255800200610     C                     MOVE *BLANK    PCPN
255900200610     C                     MOVE *BLANK    PFAC
256000200610     C                     MOVE *BLANK    PSPI
256100200610      *                                                                                       CSE028
256200200610      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
256300200610      *                                                                                       CSE028
256400200610     C           CSE028    IFEQ 'Y'                                                           CSE028
256500200610      *                                                                                       CSE028
256600200610     C                     MOVELPBCD      WBKCD                                               CSE028
256700200610     C                     MOVELPTFR      WPTFR                                               CSE028
256800200610     C                     MOVELCSTM      WCUST   6                                           CSE028
256900200610      *                                                                                       CSE028
257000200610     C                     CALL 'SESSIR0'                                                     CSE028
257100200610     C                     PARM 'D'       POTYP   1                                           CSE028
257200200610     C**********           PARM           SBRA                                         CSE028 CSE034
257300200610     C                     PARM SBRA      PSBRA   3                                           CSE034
257400200610     C                     PARM           WCUST                                               CSE028
257500200610     C                     PARM           WBKCD                                               CSE028
257600200610     C**********           PARM           CYSI                                         CSE028 CSE034
257700200610     C                     PARM CYSI      PCYSI   3                                           CSE034
257800200610     C                     PARM SMCC      PMRKT   2                                           CSE034
257900200610     C**********           PARM           ITSI                                         CSE028 CSE034
258000200610     C                     PARM ITSI      PITSI   3                                           CSE034
258100200610     C                     PARM           WPTFR                                               CSE028
258200200610     C                     PARM           PCBSTD                                              CSE028
258300200610     C                     PARM           PCBSAD                                              CSE028
258400200610     C                     PARM *BLANKS   PRTCD   5                                           CSE028
258500200610      *                                                                                       CSE028
258600200610     C                     MOVE '0'       *IN77                                               CSE028
258700200610     C           PRTCD     IFNE '*NCRF'                                                       CSE028
258800200610     C           PRTCD     ANDNE'*NRF '                                                       CSE028
258900200610     C           2         OCUR PCBSTD                                                        CSE028
259000200610     C                     ELSE                                                               CSE028
259100200610     C           PRTCD     IFNE '*NBRF'                                                       CSE028
259200200610     C           PRTCD     ANDNE'*NRF '                                                       CSE028
259300200610     C           1         OCUR PCBSTD                                                        CSE028
259400200610     C                     ELSE                                                               CSE028
259500200610     C                     MOVE '1'       *IN77                                               CSE028
259600200610     C                     ENDIF                                                              CSE028
259700200610     C                     ENDIF                                                              CSE028
259800200610      *                                                                                       CSE028
259900200610     C                     ELSE                                                               CSE028
260000200610      *                                                                                       CSE028
260100200610     C                     MOVEL*BLANKS   WBKCD                                               CSE028
260200200610     C                     MOVEL*BLANKS   WPTFR                                               CSE028
260300200610      *                                                                   E21584
260400200610      ***  First try chaining to STDSE with appropriate Investment Type   E21584
260500200610      *                                                                   E21584
260600200610     C           STDSKY    CHAINSTDSED               77                   E21584
260700200610      *                                                                   E21584
260800200610     C                     MOVE '1'       WRECT                           E16085
260900200610     C           CLIKEY    CHAINCLINT                99                   E16085
261000200610     C           *IN99     IFEQ '0'                                       E16085
261100200610     C           C1DI      ANDNE'M'                                       E16085
261200200610      *                                                                   E21584
261300200610      ***  If first chain to STDSED failed, retry with blank ITSI.        E21584
261400200610      *                                                                   E21584
261500200610     C           *IN77     ANDEQ'1'                                       E21584
261600200610     C                     MOVE *BLANK    ITSI                            E16085
261700200610     C***********          END                                     E16085 E21584
261800200610     C           STDSKY    CHAINSTDSED               77
261900200610     C                     END                                            E21584
262000200610      *                                                                                       CSE028
262100200610     C                     ENDIF                                                              CSE028
262200200610      *                                                                                       CSE028
262300200610     C/COPY WNCPYSRC,SE2390C033
262400200610      *                                                                   E21584
262500200610     C           *IN77     IFNE '1'
262600200610     C           RECI      ANDNE'*'
262700200610      *                                                                   147514
262800200610     C                     MOVE *OFF      *IN88                           147514
262900200610      *                                                                   CEU005
263000200610      * CEU005 active and Settlement Ccy used on STDSED.                  CEU005
263100200610     C           CEU005    IFEQ 'Y'                                       CEU005
263200200610     C           SCCY      ANDNE*BLANKS                                   CEU005
263300200610      *                                                                   CEU005
263400200610      * Access currencies file for EURO rate, EURO M/D indicator and      CEU005
263500200610      * Transition Date for 'In' Ccy.                                     CEU005
263600200610      *                                                                   CEU005
263700200610     C           PNCY      IFEQ BKEURO                                    CEU005
263800200610     C                     CALL 'AOCURRR0'                                CEU005
263900200610     C                     PARM           @RTCD   7                       CEU005
264000200610     C                     PARM '*KEY   ' @OPTN   7                       CEU005
264100200610     C                     PARM SCCY      @AJCD   3                       CEU005
264200200610     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
264300200610     C           @RTCD     IFNE *BLANKS                                   CEU005
264400200610     C                     SETON                     U7U8                 CEU005
264500200610     C                     MOVE '44'      DBASE             ************  CEU005
264600200610     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  CEU005
264700200610     C                     MOVELSCCY      DBKEY             * ERROR 44 *  CEU005
264800200610     C                     EXSR *PSSR                       ************  CEU005
264900200610     C                     GOTO EAUDIT                                    CEU005
265000200610     C                     ENDIF                                          CEU005
265100200610     C                     ELSE                                           CEU005
265200200610     C           SCCY      IFEQ BKEURO                                    CEU005
265300200610     C                     CALL 'AOCURRR0'                                CEU005
265400200610     C                     PARM           @RTCD   7                       CEU005
265500200610     C                     PARM '*KEY   ' @OPTN   7                       CEU005
265600200610     C                     PARM PNCY      @AJCD   3                       CEU005
265700200610     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
265800200610     C           @RTCD     IFNE *BLANKS                                   CEU005
265900200610     C                     SETON                     U7U8                 CEU005
266000200610     C                     MOVE '45'      DBASE             ************  CEU005
266100200610     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  CEU005
266200200610     C                     MOVELPSCU      DBKEY             * ERROR 45 *  CEU005
266300200610     C                     EXSR *PSSR                       ************  CEU005
266400200610     C                     GOTO EAUDIT                                    CEU005
266500200610     C                     ENDIF                                          CEU005
266600200610     C                     ENDIF                                          CEU005
266700200610     C                     ENDIF                                          CEU005
266800200610      *                                                                   CEU005
266900200610      * Value date is later than Transition Start Date.                   CEU005
267000200610     C           PSVL      IFGE A6TPSD                                    CEU005
267100200610     C           A6INCY    ANDEQ'Y'                                       143690
267200200610     C                     Z-ADDA6EUER    PSXR                            CEU005
267300200610      *                                                                   CEU005
267400200610      **Settlement*ccy*is*Euro*currency,*reverse*M/D*indicator.    CEU005 143690
267500200610     C** Nominal ccy is Euro currency, reverse M/D indicator.             143690
267600200610     C***********SCCY      IFEQ BKEURO                             CEU005 143690
267700200610     C           PNCY      IFEQ BKEURO                                    143690
267800200610     C           A6EUMD    IFEQ 'M'                                       CEU005
267900200610     C                     MOVE 'D'       PMDI                            CEU005
268000200610     C                     ELSE                                           CEU005
268100200610     C                     MOVE 'M'       PMDI                            CEU005
268200200610     C                     ENDIF                                          CEU005
268300200610      *                                                                   CEU005
268400200610      **Settlement*ccy*not*Euro*ccy,*use*Euro*M/D*indicator.       CEU005 143690
268500200610     C** Settlement ccy is Euro ccy, use Euro M/D indicator.              143690
268600200610     C                     ELSE                                           CEU005
268700200610     C                     MOVE A6EUMD    PMDI                            CEU005
268800200610     C                     ENDIF                                          CEU005
268900200610      *                                                                   CEU005
269000200610      * Use standard settlement ccy for position settlement ccy           CEU005
269100200610     C                     MOVE SCCY      PSCU                            CEU005
269200200610      *                                                                   194195
269300200610     C                     MOVE PSCU      WCURR                           194195
269400200610     C                     EXSR TG10                                      194195
269500200610     C                     Z-ADDSPOT      PBRX                            194195
269600200610      *                                                                   CEU005
269700200610      * Chain STDSED again.                                               CEU005
269800200610     C                     MOVE SCCY      CYSI                            CEU005
269900200610     C***********STDSKY    CHAINSTDSED               78            CEU005 147514
270000200610      *                                                                                       CSE028
270100200610      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
270200200610      *                                                                                       CSE028
270300200610     C           CSE028    IFEQ 'Y'                                                           CSE028
270400200610      *                                                                                       CSE028
270500200610     C                     CALL 'SESSIR0'                                                     CSE028
270600200610     C                     PARM 'D'       POTYP   1                                           CSE028
270700200610     C**********           PARM           SBRA                                         CSE028 CSE034
270800200610     C                     PARM SBRA      PSBRA                                               CSE034
270900200610     C                     PARM           WCUST                                               CSE028
271000200610     C                     PARM           WBKCD                                               CSE028
271100200610     C**********           PARM           CYSI                                         CSE028 CSE034
271200200610     C                     PARM CYSI      PCYSI                                               CSE034
271300200610     C                     PARM SMCC      PMRKT                                               CSE034
271400200610     C**********           PARM           ITSI                                         CSE028 CSE034
271500200610     C                     PARM ITSI      PITSI                                               CSE034
271600200610     C                     PARM           WPTFR                                               CSE028
271700200610     C                     PARM           PCBSTD                                              CSE028
271800200610     C                     PARM           PCBSAD                                              CSE028
271900200610     C                     PARM *BLANKS   PRTCD                                               CSE028
272000200610      *                                                                                       CSE028
272100200610     C                     MOVE '0'       *IN88                                               CSE028
272200200610     C           PRTCD     IFNE '*NCRF'                                                       CSE028
272300200610     C           PRTCD     ANDNE'*NRF '                                                       CSE028
272400200610     C           2         OCUR PCBSTD                                                        CSE028
272500200610     C                     ELSE                                                               CSE028
272600200610     C           PRTCD     IFNE '*NBRF'                                                       CSE028
272700200610     C           PRTCD     ANDNE'*NRF '                                                       CSE028
272800200610     C           1         OCUR PCBSTD                                                        CSE028
272900200610     C                     ELSE                                                               CSE028
273000200610     C                     MOVE '1'       *IN88                                               CSE028
273100200610     C                     ENDIF                                                              CSE028
273200200610     C                     ENDIF                                                              CSE028
273300200610      *                                                                                       CSE028
273400200610     C                     ELSE                                                               CSE028
273500200610      *                                                                                       CSE028
273600200610     C           STDSKY    CHAINSTDSED               88                   147514
273700200610      *                                                                                       CSE028
273800200610     C                     ENDIF                                                              CSE028
273900200610      *                                                                                       CSE028
274000200610     C/COPY WNCPYSRC,SE2390C042
274100200610     C*****                ENDIF                                   CEU005 147869
274200200610     C*****                ENDIF                                   CEU005 147869
274300200610     C                     ENDIF                                          175400
274400200610     C                     ENDIF                                          175400
274500200610      *                                                                   CEU005
274600200610      * If no record found ensure fields from last chain not loaded       CEU005
274700200610      * to output fields.                                                 CEU005
274800200610     C************IN78     IFEQ '1'                                CEU005 147514
274900200610     C           *IN88     IFEQ *ON                                       147514
275000200610     C           CEU005    ANDEQ'Y'                                       175400
275100200610     C                     MOVE *BLANKS   PSMT                            CEU005
275200200610     C                     MOVE *BLANKS   PSEA                            CEU005
275300200610     C                     MOVE *BLANKS   PSEB                            CEU005
275400200610     C                     MOVE *BLANKS   PCPN                            CEU005
275500200610     C                     MOVE *BLANKS   PFAC                            CEU005
275600200610     C                     MOVE *BLANKS   PSPI                            CEU005
275700200610     C                     MOVE *BLANKS   STLA                            CEU005
275800200610     C                     Z-ADD0         STLT                            CEU005
275900200610     C                     MOVE *BLANKS   PRCNUM                          CEU005
276000200610     C                     MOVE *BLANKS   PRACOD                          CEU005
276100200610     C                     MOVE *BLANKS   PRACSQ                          CEU005
276200200610     C                     MOVE *BLANKS   PPFC                            CEU005
276300200610     C***********          ENDIF                                    147869175400
276400200610     C***********          ENDIF                                    147869175400
276500200610     C                     ELSE                                           CEU005
276600200610     C*
276700200610     C** USE RECEIVE FIELDS IF PAY/RECEIVE IND IS SET TO P
276800200610     C*
276900200610     C           PPRE      IFEQ 'P'
277000200610     C                     MOVE SPSM      PSMT
277100200610     C                     MOVE SPAT      PSEA
277200200610     C***********          MOVE SPBR      PSEB                            S01117
277300200610     C                     MOVE SPBA      PSEB                            S01117
277400200610     C                     MOVE SPCB      PCPN
277500200610     C                     MOVE SPFA      PFAC
277600200610     C                     MOVE SPSI      PSPI
277700200610      *                                                                   103361
277800200610     C***********AUMO      IFEQ 'Y'                                 103361074380
277900200610     C                     MOVE SPAT      STLA                            103361
278000200610     C                     Z-ADDSPSM      STLT                            103361
278100200610      *                                                                   103361
278200200610      * If settlement method is '04' and settlement account is blank,     103361
278300200610      * retrieve prime account number                                     103361
278400200610      *                                                                   103361
278500200610     C           STLT      IFEQ 04                                        103361
278600200610     C           STLA      ANDEQ*BLANKS                                   103361
278700200610      *                                                                   103361
278800200610      * Retrieve prime account number                                     103361
278900200610      *                                                                   103361
279000200610     C                     MOVE CSTM      PRCNUM                          103361
279100200610     C                     MOVE BMACCD    PRACOD                          103361
279200200610     C                     MOVE '01'      PRACSQ                          103361
279300200610      *                                                                   136297
279400200610      ** Check if account exists else use suspense account                136297
279500200610      *                                                                   136297
279600200610     C                     MOVE PRCNUM    KYCNUM                          136297
279700200610     C                     MOVE PSCU      KYCCY                           136297
279800200610     C                     MOVE PRACOD    KYACOD                          136297
279900200610     C                     MOVE PRACSQ    KYACSQ                          136297
280000200610     C                     MOVE PSEB      KYBRCA                          136297
280100200610     C           KEYACC    CHAINACCNTABF             20                   136297
280200200610     C           *IN20     IFEQ '1'                                       136297
280300200610     C           RECI      OREQ '*'                                       136297
280400200610     C           1         CHAINTABTB20              21                   136297
280500200610     C           *IN21     IFEQ '0'                                       136297
280600200610     C                     MOVE COMS      PRACOD                          136297
280700200610     C                     ENDIF                                          136297
280800200610     C           PSEB      CHAINSDBRCHL0             22                   136297
280900200610     C           *IN22     IFEQ '0'                                       136297
281000200610     C                     MOVE A8BICN    PRCNUM                          136297
281100200610     C                     ENDIF                                          136297
281200200610     C                     ENDIF                                          136297
281300200610      *                                                                   103361
281400200610     C                     MOVE PRACCT    STLA                            103361
281500200610     C                     MOVE PRACCT    PSEA                            103361
281600200610     C                     END                                            103361
281700200610     C***********          END                                      103361074380
281800200610      *                                                                   103361
281900200610     C                     ELSE
282000200610     C*
282100200610     C** USE PAY FIELDS IF PAY/RECEIVE IND IS SET TO R
282200200610     C*
282300200610     C           PPRE      IFEQ 'R'
282400200610     C                     MOVE SRSM      PSMT
282500200610     C                     MOVE SRAC      PSEA
282600200610     C********             MOVE SRBR      PSEB                            S01117
282700200610     C                     MOVE SRAB      PSEB                            S01117
282800200610     C                     MOVE SRCB      PCPN
282900200610     C                     MOVE *BLANK    PFAC
283000200610     C                     MOVE *BLANK    PSPI
283100200610      *                                                                   103361
283200200610     C***********AUMO      IFEQ 'Y'                                 103361074380
283300200610     C                     MOVE SRAC      STLA                            103361
283400200610     C                     Z-ADDSRSM      STLT                            103361
283500200610      *                                                                   103361
283600200610      ** If settlement method is '04' and settlement account is blank,    103361
283700200610      ** retrieve prime account number                                    103361
283800200610      *                                                                   103361
283900200610     C           STLT      IFEQ 04                                        103361
284000200610     C           STLA      ANDEQ*BLANKS                                   103361
284100200610      *                                                                   103361
284200200610      * Retrieve prime account                                            103361
284300200610      *                                                                   103361
284400200610     C                     MOVE CSTM      PRCNUM                          103361
284500200610     C                     MOVE BMACCD    PRACOD                          103361
284600200610     C                     MOVE '01'      PRACSQ                          103361
284700200610      *                                                                   103361
284800200610      ** Check if account exists else use suspense account                136297
284900200610      *                                                                   136297
285000200610     C                     MOVE PRCNUM    KYCNUM                          136297
285100200610     C                     MOVE PSCU      KYCCY                           136297
285200200610     C                     MOVE PRACOD    KYACOD                          136297
285300200610     C                     MOVE PRACSQ    KYACSQ                          136297
285400200610     C                     MOVE PSEB      KYBRCA                          136297
285500200610     C           KEYACC    CHAINACCNTABF             20                   136297
285600200610     C           *IN20     IFEQ '1'                                       136297
285700200610     C           RECI      OREQ '*'                                       136297
285800200610     C           1         CHAINTABTB20              21                   136297
285900200610     C           *IN21     IFEQ '0'                                       136297
286000200610     C                     MOVE COMS      PRACOD                          136297
286100200610     C                     ENDIF                                          136297
286200200610     C           PSEB      CHAINSDBRCHL0             22                   136297
286300200610     C           *IN22     IFEQ '0'                                       136297
286400200610     C                     MOVE A8BICN    PRCNUM                          136297
286500200610     C                     ENDIF                                          136297
286600200610     C                     ENDIF                                          136297
286700200610     C                     MOVE PRACCT    STLA                            103361
286800200610     C                     MOVE PRACCT    PSEA                            103361
286900200610     C                     END                                            103361
287000200610     C***********          END                                      103361074380
287100200610     C*                                                                   103361
287200200610     C                     END
287300200610     C                     END
287400200610     C/COPY WNCPYSRC,SE2390C034
287500200610     C                     END
287600200610     C                     ENDIF                                          CEU005
287700200610     C/COPY WNCPYSRC,SE2390C043
287800200610     C*
287900200610     C                     Z-ADDRUND      PDTG
288000200610      *                                                                                       CGL020
288100200610      ** If Settlement Account is not blank                                                   CGL020
288200200610      *                                                                                       CGL020
288300200610     C           CGL020    IFEQ 'Y'                                                           CGL020
288400200610     C           PSEA      ANDNE*BLANKS                                                       CGL020
288500200610      *                                                                                       CGL020
288600200610     C                     MOVE *BLANKS   PINTG                                               CGL020
288700200610     C                     MOVE *BLANKS   PINTGA                                              CGL020
288800200610     C                     MOVE *BLANKS   PINST                                               CGL020
288900200610     C                     MOVE *BLANKS   PINSTA                                              CGL020
289000200610     C                     MOVE *BLANKS   PBENM                                               CGL020
289100200610     C                     MOVE *BLANKS   PBENMA                                              CGL020
289200200610      *                                                                                       CGL020
289300200610     C                     CALL ZAAMLP                                                        CGL020
289400200610     C                     PARM           PINTG  10                                           CGL020
289500200610     C                     PARM           PINTGA 35                                           CGL020
289600200610     C                     PARM           PINST  10                                           CGL020
289700200610     C                     PARM           PINSTA 35                                           CGL020
289800200610     C                     PARM           PBENM  10                                           CGL020
289900200610     C                     PARM           PBENMA 35                                           CGL020
290000200610     C                     PARM           PDEBT  10                                           CSW210
290100200610     C                     PARM           PDEBTA 35                                           CSW210
290200200610     C                     PARM           PCPY                                                CGL020
290300200610     C                     PARM           PFAC                                                CGL020
290400200610     C                     PARM           PSEA                                                CGL020
290500200610     C                     PARM           PSEB                                                CGL020
290600200610     C                     PARM           PSCU                                                CGL020
290700200610     C                     PARM           WWRACT 20                                           CGL020
290800200610     C                     PARM           WWRCTY  2                                           CGL020
290900200610     C                     PARM           WWRBNK 20                                           CGL020
291000200610     C                     PARM           WWRCDE 11                                           CGL020
291100200610     C                     PARM           WWPACT 20                                           CGL020
291200200610     C                     PARM           WWPCTY  2                                           CGL020
291300200610     C                     PARM           WWPBNK 20                                           CGL020
291400200610     C                     PARM           WWPCDE 11                                           CGL020
291500200610     C                     PARM           WWDACT 35                                           CGL020
291600200610     C                     PARM           WWDCTY  2                                           CGL020
291700200610     C                     PARM           WWDBNK 20                                           CGL020
291800200610      *                                                                                       CGL020
291900200610     C                     MOVE PDUD      WWSDAT  50                                          CGL020
292000200610      *                                                                                       CGL020
292100200610     C                     ENDIF                                                              CGL020
292200200610     C*
292300200610      *** If S01447 installed, and settlement type = Dividend or Coupon   S01447
292400200610      *** and a Security WHT rcd for the security exists, and             S01447
292500200610      *** settlement is not a payment, calculate tax amounts.             S01447
292600200610      *                                                                   S01447
292700200610     C           S01447    IFEQ 'N'                                       S01447
292800200610     C           *IN80     OREQ '1'                                       S01447
292900200610     C           PPRE      OREQ 'P'                                       S01447
293000200610     C           SAAT      ORNE 'DV'                                      S01447
293100200610     C           SAAT      ANDNE'CP'                                      S01447
293200200610     C                     CLEARTASO                                      S01447
293300200610     C                     CLEARTASR                                      S01447
293400200610     C                     CLEARTAUS                                      S01447
293500200610     C                     ELSE                                           S01447
293600200610     C/COPY WNCPYSRC,SE2390C040
293700200610     C                     EXSR CALCTX                                    S01447
293800200610     C/COPY WNCPYSRC,SE2390C041
293900200610     C                     END                                            S01447
294000200610      *                                                                   S01447
294100200610     C* ZEROISE NUMERIC FIELDS WITH NO SPECIFIED VALUE
294200200610     C*
294300200610     C                     Z-ADD0         PCHA
294400200610     C/COPY WNCPYSRC,SE2390C019
294500200610     C                     Z-ADD0         PCAM
294600200610     C/COPY WNCPYSRC,SE2390C020
294700200610     C***********          Z-ADD0         PSAT                            087178
294800200610     C*                                                                   087178
294900200610     C** Set up parameter for call to SEZ010                              087178
295000200610     C*                                                                   087178
295100200610     C                     MOVE 'M'       P@CLAS                          087178
295200200610     C                     MOVELPPRE      P@PPRE                          087178
295300200610     C                     Z-ADDPAMD      P@PAMD                          087178
295400200610     C                     Z-ADDPCHA      P@PCHA                          087178
295500200610     C                     Z-ADDPCAM      P@PCAM                          087178
295600200610     C                     Z-ADDTASO      P@TASO                          087178
295700200610     C                     Z-ADDTAUS      P@TAUS                          087178
295800200610     C                     Z-ADDPSXR      P@PSXR                          087178
295900200610      ***Override*coupon*rate                                                   AR1001183 AR1001183A
296000200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
296100200610     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
296200200610     C**********           Z-ADDWPSXR     P@PSXR                                AR1001183 AR1001183A
296300200610     C**********           ENDIF                                                AR1001183 AR1001183A
296400200610     C**********           MOVE 'N'       WRCHG                                 AR1001183 AR1001183A
296500200610     C                     MOVELPMDI      P@PMDI                          087178
296600200610     C                     MOVELPNCY      P@PNCY                          087178
296700200610     C                     MOVELPSCU      P@PSCU                          087178
296800200610     C                     Z-ADD0         P@STAM                                            AR853119
296900200610     C/COPY WNCPYSRC,SE2390C024
297000200610     C*                                                                   CAC002
297100200610     C                     MOVE 'TS'      P@TDTP                          CAC002
297200200610     C                     Z-ADD0         P@FXMR                          CAC002
297300200610     C                     Z-ADD0         P@MAMT                          CAC002
297400200610     C                     Z-ADD0         FXMP                            CAC002
297500200610     C                     Z-ADD0         FXMR                            CAC002
297600200610     C                     Z-ADD0         MAMT                            CAC002
297700200610     C*                                                                   087178
297800200610     C** Call SEZ010 to calculate the settlement amount in settle ccy     087178
297900200610     C*                                                                   087178
298000200610     C                     CALL 'SEZ010'                                  087178
298100200610     C                     PARM *BLANKS   P@RCDE  7                       087178
298200200610     C                     PARM           P@DATA                          087178
298300200610     C           P@RCDE    IFEQ *BLANKS                                   087178
298400200610     C                     Z-ADDP@PSAT    PSAT                            087178
298500200610     C                     ELSE                                           087178
298600200610     C                     EXSR *PSSR                                     087178
298700200610     C                     EXSR AUDIT                                     087178
298800200610     C                     MOVE '1'       *INLR                           087178
298900200610     C                     ENDIF                                          087178
299000200610     C*                                                                   087178
299100200610     C***********          Z-ADD0         LCD                             066777
299200200610     C                     Z-ADDRUND      LCD                             066777
299300200610     C                     Z-ADD0         TNLU
299400200610     C*                                                                   086386
299500200610     C** IF PORTFOLIO MANAGEMENT IS ON, OUTPUT TNLU ON POSETD             086386
299600200610     C*                                                                   086386
299700200610     C           BGPFMG    IFEQ 'Y'                                       086386
299800200610     C                     EXSR ZTNLU1                                    086386
299900200610     C                     MOVELNATN      TNLU                            086386
300000200610     C                     END                                            086386
300100200610     C***********          MOVE ' '       CHTP                           *E18221
300200200610     C                     MOVE 'I'       CHTP                           *E18221
300300200610     C                     MOVE 'D'       RECI                            103017
300400200610     C*                                                                   084669
300500200610     C           PSEB      IFEQ *BLANKS                                   084669
300600200610     C                     MOVE PBCA      PSEB                            084669
300700200610     C                     END                                            084669
300800200610     C*                                                                   S01117
300900200610     C** Profit Centres are not applicable to depot positions             S01117
301000200610     C** therefore ensure that any depot position position settlements    S01117
301100200610     C** have a blank profit centre                                       S01117
301200200610     C*                                                                   S01117
301300200610     C                     MOVE *BLANKS   PPFC                            S01117
301400200610     C/COPY WNCPYSRC,SE2390C021
301500200610     C*                                                                   CAC002
301600200610     C**  If Analytical Accounting is installed, set the profit centre    CAC002
301700200610     C**  SE ICD default profit centre.                                   CAC002
301800200610     C*                                                                   CAC002
301900200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
302000200610     C                     MOVE BVSEPC    PPFC                            CAC002
302100200610     C                     ENDIF                                          CAC002
302200200610      *                                                                                      251950A
302300200610     C           PSEB      IFEQ *BLANKS                                                      251950A
302400200610     C                     MOVE PBCA      PSEB                                               251950A
302500200610     C                     END                                                               251950A
302600200610     C*
302700200610     C* WRITE POSITION SETTLMENT RECORD
302800200610     C*
302900200610     C** If CSE023 is not installed or if CSE023 is installed and         CSE023
303000200610     C** the events is not for Coupon, Dividend or Maturity then          CSE023
303100200610     C** use the normal processing.                                       CSE023
303200200610     C*                                                                   CSE023
303300200610     C           CSE023    IFEQ 'N'                                       CSE023
303400200610     C*                                                                   CSE023
303500200610     C           CSE023    OREQ 'Y'                                       CSE023
303600200610     C           PEVT      ANDNE'CP'                                      CSE023
303700200610     C           PEVT      ANDNE'MT'                                      CSE023
303800200610     C           PEVT      ANDNE'DV'                                      CSE023
303900200610     C*                                                                   CSE023
304000200610     C           CRTT      OREQ *BLANKS                                   CSE023
304100200610      *                                                                                     MD037742
304200200610      ** Initialize tax fields to prevent garbage in POSETD                                 MD037742
304300200610      *                                                                                     MD037742
304400200610     C                     Z-ADD0         TAXA                                              MD037742
304500200610     C                     Z-ADD0         TXNM                                              MD037742
304600200610     C                     Z-ADD0         TXST                                              MD037742
304700200610     C*                                                                   CSE023
304800200610     C* COUNT RECORDS WRITTEN                                             CSE023
304900200610     C*                                                                   CSE023
305000200610     C                     ADD  1         W02CNT  50                      CSE023
305100200610     C                     WRITEPOSETDF
305101200616     C                     EXSR PSAUDT                                                      AR324886
305200200610      *                                                                                     AR853119
305300200610      ***  Write extension file                                                             AR853119
305400200610      *                                                                                     AR853119
305500200610     C           CER049    IFEQ 'Y'                                                         AR853119
305600200610     C                     EXSR SRPOST                                                      AR853119
305700200610     C                     ENDIF                                                            AR853119
305800200610     C*                                                                   CSE023
305900200610     C                     ELSE                                           CSE023
306000200610     C*                                                                   CSE023
306100200610     C** If Treaty Withholding Tax is installed, then set up fields       CSE023
306200200610     C** for SE2310.                                                      CSE023
306300200610     C*                                                                   CSE023
306400200610     C** For Coupon Event, @DIVDT is the Last Coupon Date.                CSE023
306500200610     C** For Dividend Event, @DIVDT is equal to the dividend date.        CSE023
306600200610     C*                                                                   CSE023
306700200610     C                     Z-ADD0         @DIVDT                          CSE023
306800200610     C*                                                                   CSE023
306900200610     C           PEVT      IFEQ 'CP'                                      CSE023
307000200610     C                     Z-ADDSALCCP    @DIVDT                          CSE023
307100200610     C                     END                                            CSE023
307200200610     C*                                                                   CSE023
307300200610     C           PEVT      IFEQ 'DV'                                      CSE023
307400200610     C*                                                                   CSE023
307500200610     C** If S01510 is active AND event type = DV, use ex-dividend date    CSE023
307600200610     C*                                                                   CSE023
307700200610     C           S01510    IFEQ 'Y'                                       CSE023
307800200610     C           SAEXD     ADD  1         @DIVDT                          CSE023
307900200610     C                     ELSE                                           CSE023
308000200610     C                     Z-ADDSAED      @DIVDT                          CSE023
308100200610     C                     END                                            CSE023
308200200610     C*                                                                   CSE023
308300200610     C** If CSE008 is ON then use value date position for dividend.       CSE023
308400200610     C*                                                                   CSE023
308500200610     C           CSE008    IFEQ 'Y'                                       CSE023
308600200610     C                     MOVE 'V'       @TVBAS                          CSE023
308700200610     C                     ELSE                                           CSE023
308800200610     C                     MOVE 'T'       @TVBAS                          CSE023
308900200610     C                     END                                            CSE023
309000200610     C                     END                                            CSE023
309100200610     C*                                                                   CSE023
309200200610     C                     Z-ADD0         TAXA                                                233709
309300200610     C                     Z-ADD0         TXNM                                                233709
309400200610     C                     Z-ADD0         TXST                                                233709
309500200610     C                     CALL 'SE2310'                                  CSE023
309600200610     C                     PARM           PPOSET                          CSE023
309700200610     C                     PARM           @TVBAS  1                       CSE023
309800200610     C                     PARM           @DIVDT  50                      CSE023
309900200610     C                     PARM           @NREC   30                      CSE023
310000200610     C                     PARM           @ERR    1                       CSE023
310100200610     C*                                                                   CSE023
310200200610     C           @ERR      IFEQ 'N'                                       CSE023
310300200610     C                     ADD  @NREC     W02CNT                          CSE023
310400200610     C                     ELSE                                           CSE023
310500200610     C                     EXSR *PSSR                                     CSE023
310600200610     C                     EXSR AUDIT                                     CSE023
310700200610     C                     MOVE '1'       *INLR                           CSE023
310800200610     C                     END                                            CSE023
310900200610     C                     END                                            CSE023
311000200610     C/COPY WNCPYSRC,SE2390C025
311100200610     C*                                                                   086386
311200200610     C** IF PORTFOLIO MANAGEMENT IS ON, OUTPUT TNLU ON POSETD             086386
311300200610     C*                                                                   086386
311400200610     C           BGPFMG    IFEQ 'Y'                                       086386
311500200610     C                     Z-ADD0         TNLU                            086386
311600200610     C                     END                                            086386
311700200610     C*
311800200610     C           ENDW02    ENDSR
311900200610      *
312000200610      *****************************************************************
312100200610      /EJECT                                                              S01447
312200200610      *****************************************************************   S01447
312300200610      *                                                               *   S01447
312400200610      *  CALCTX - Subroutine to calculate tax amounts for dividends   *   S01447
312500200610      *           and Coupons                                         *   S01447
312600200610      *                                                               *   S01447
312700200610      *  CALLED FROM: W02                                             *   S01447
312800200610      *  CALLS:       NONE                                            *   S01447
312900200610      *                                                               *   S01447
313000200610      *****************************************************************   S01447
313100200610      *                                                                   S01447
313200200610     C           CALCTX    BEGSR                                          S01447
313300200610      *                                                                   S01447
313400200610      *** Initialise work tax rate and amount fields                      S01447
313500200610      *                                                                   S01447
313600200610     C                     CLEARUTXRSR                                    S01447
313700200610     C                     CLEARUTXRRF                                    S01447
313800200610     C                     CLEARUTXRUS                                    S01447
313900200610      *                                                                   S01447
314000200610      *** If tax band at source is zero, then take rate from security     S01447
314100200610      *** WHT details file; Otherwise access SEcountry tax rate file to   S01447
314200200610      *** get tax rate at source                                          S01447
314300200610      *                                                                   S01447
314400200610     C           S1TABD    IFEQ *ZERO                      *B1            S01447
314500200610     C                     Z-ADDS1RASO    UTXRSR                          S01447
314600200610     C                     ELSE                            *X1            S01447
314700200610      *                                                                   S01447
314800200610     C                     MOVELS1CTTA    UKEY    3                       S01447
314900200610     C                     MOVE S1TABD    UKEY                            S01447
315000200610      *                                                                   S01447
315100200610     C                     CALL 'AOSCTXR0'                                S01447
315200200610     C                     PARM *BLANKS   @RTCD                           S01447
315300200610     C                     PARM '*KEY   ' @OPTN                           S01447
315400200610     C                     PARM S1CTTA    @CTTA   2                       S01447
315500200610     C                     PARM S1TABD    @TABD   10                      S01447
315600200610     C           SECNTR    PARM SECNTR    DSSDY                           S01447
315700200610     C*                                                                   S01447
315800200610     C           @RTCD     IFNE *BLANKS                    *B2            S01447
315900200610     C           TXRECI    ORNE 'D'                                       S01447
316000200610     C           *LOCK     IN   LDA                                       S01117
316100200610     C                     MOVEL'SECNTRL0'DBFILE           ***************S01447
316200200610     C                     MOVELUKEY      DBKEY            ** DBERROR 015 S01447
316300200610     C                     Z-ADD15        DBASE            ***************S01447
316400200610     C                     SETON                       U7U8               S01447
316500200610     C                     EXSR *PSSR                                     S01447
316600200610     C                     GOTO EAUDIT                                    S01447
316700200610     C                     ELSE                            *X2            S01447
316800200610     C                     Z-ADDTXRASO    UTXRSR                          S01447
316900200610     C                     END                             *E2            S01447
317000200610     C                     END                             *E1            S01447
317100200610      *                                                                   S01447
317200200610      *** If tax band by user is not zero, then access country to         S01447
317300200610      *** branch tax rate file to get tax rate by user                    S01447
317400200610      *** Otherwise set to zero.                                          S01447
317500200610      *                                                                   S01447
317600200610     C           S1TABU    IFNE *ZERO                      *B1            S01447
317700200610     C                     CALL 'AOCBTXR0'                                S01447
317800200610     C                     PARM *BLANKS   @RTCD                           S01447
317900200610     C                     PARM '*KEY   ' @OPTN                           S01447
318000200610     C                     PARM DSBA      @BRCA   3                       S01447
318100200610     C                     PARM S1CTTA    @CTTA                           S01447
318200200610     C                     PARM S1TABU    @TABU   10                      S01447
318300200610     C           SECBTX    PARM SECBTX    DSFDY                           S01447
318400200610     C*                                                                   S01447
318500200610     C           @RTCD     IFEQ *BLANKS                    *B2            S01447
318600200610     C           TBRECI    ANDEQ'D'                                       S01447
318700200610     C                     Z-ADDTBRASR    UTXRRF                          S01447
318800200610     C                     Z-ADDTBRAUS    UTXRUS                          S01447
318900200610     C                     END                             *E2            S01447
319000200610     C                     END                             *E1            S01447
319100200610      *                                                                   S01447
319200200610      *** calculate amount deducted at source                             S01447
319300200610      *                                                                   S01447
319400200610     C           S01496    IFEQ 'Y'                                                           248184
319500200610     C           PAMD      MULT UTXRSR    WTASO  204                                          248184
319600200610     C           WTASO     DIV  100       TASO      H                                         248184
319700200610     C                     ELSE                                                               248184
319800200610     C           UTXRSR    DIV  100       URATE   54                      S01447
319900200610     C           PAMD      MULT URATE     TASO      H                     S01447
320000200610     C                     ENDIF                                                              248184
320100200610      *                                                                   S01447
320200200610      *** calculate amount deducted refundable                            S01447
320300200610      *                                                                   S01447
320400200610     C           S01496    IFEQ 'Y'                                                           248184
320500200610     C           PAMD      MULT UTXRRF    WTASR  204                                          248184
320600200610     C           WTASR     DIV  100       TASR      H                                         248184
320700200610     C                     ELSE                                                               248184
320800200610     C           UTXRRF    DIV  100       URATE                           S01447
320900200610     C           PAMD      MULT URATE     TASR      H                     S01447
321000200610     C                     ENDIF                                                              248184
321100200610      *                                                                   S01447
321200200610      *** Amount deducted by user is set to zero, as this is a depot      S01447
321300200610      *** position.                                                       S01447
321400200610      *                                                                   S01447
321500200610     C                     CLEARTAUS                                      S01447
321600200610      *                                                                   S01447
321700200610     C                     ENDSR                                          S01447
321800200610      *                                                                   S01447
321900200610      *****************************************************************   S01447
322000200610      /EJECT
322100200610      *****************************************************************
322200200610      *                                                               *
322300200610      *  SECTIN - Subroutine to get Security record.                  *
322400200610      *                                                               *
322500200610      *****************************************************************
322600200610      *
322700200610     C           SECTIN    BEGSR                           ** SECTIN **
322800200610     C*
322900200610     C** CHAIN FOR SECURITY RECORD AND DATA BASE ERROR
323000200610     C*
323100200610     C           SECTKY    CHAINSECTY                79
323200200610     C           *IN79     IFNE '1'
323300200610     C           RECI      COMP '*'                      79
323400200610     C                     END
323500200610     C           *IN79     IFEQ '1'
323600200610     C           *LOCK     IN   LDA                                       S01117
323700200610     C                     MOVEL'SECTY'   DBFILE           ***************
323800200610     C                     MOVELSASN      DBKEY            * DB ERROR 04 *
323900200610     C                     Z-ADD4         DBASE            ***************
324000200610     C                     SETON                     U7U8                 S01117
324100200610     C                     DUMP                                           S01117
324200200610     C                     GOTO EAUDIT
324300200610     C                     END
324400200610     C/COPY WNCPYSRC,SE2390C037
324500200610      *                                                                   S01447
324600200610      *** Access Security WHT Details file                                S01447
324700200610      *                                                                   S01447
324800200610     C           SECTKY    CHAINSESWHTL0             80                   S01447
324900200610      *                                                                   S01447
325000200610     C                     ENDSR
325100200610      *
325200200610      *****************************************************************
325300200610      /SPACE 3
325400200610      *****************************************************************
325500200610      *                                                               *
325600200610      *  INVTIN - Subroutine to get Investment Type record.           *
325700200610      *                                                               *
325800200610      *****************************************************************
325900200610      *
326000200610     C           INVTIN    BEGSR                           ** INVTIN **
326100200610     C*
326200200610     C** CHAIN FOR INVESTMENT TYPE RECORD AND DATA BASE ERROR
326300200610     C*
326400200610     C           INVTKY    CHAININVTP                79
326500200610     C           *IN79     IFNE '1'
326600200610     C           RECI      COMP '*'                      79
326700200610     C                     END
326800200610     C           *IN79     IFEQ '1'
326900200610     C           *LOCK     IN   LDA                                       S01117
327000200610     C                     MOVEL'INVTP'   DBFILE           ***************
327100200610     C                     MOVELINVKEY    DBKEY            * DB ERROR 05 *
327200200610     C                     Z-ADD5         DBASE            ***************
327300200610     C                     SETON                     U7U8                 S01117
327400200610     C                     DUMP                                           S01117
327500200610     C                     GOTO EAUDIT
327600200610     C                     END
327700200610      *
327800200610     C                     ENDSR
327900200610      *
328000200610      *****************************************************************
328100200610      /SPACE 3
328200200610      *****************************************************************
328300200610      *                                                               *
328400200610      *  SECEDI - Subroutine to get Security Diary Event record.      *
328500200610      *                                                               *
328600200610      *****************************************************************
328700200610      *
328800200610     C           SECEDI    BEGSR                           ** SECEDI **
328900200610     C*
329000200610     C** CHAIN FOR SECURITY EVENT RECORD AND DATA BASE ERROR
329100200610     C*
329200200610     C**********                                                          E20086
329300200610     C***STORE*NOM*CCY*FROM*SECTYD*AS*SEDEVDF*HAS*NMCY*FIELD*TOO***       E20086
329400200610     C**********                                                          E20086
329500200610     C**********           MOVE NMCY      WNMCY   3                       E20086
329600200610     C           SECDKY    CHAINSEDEVDF              7877
329700200610     C           *IN78     IFNE '1'
329800200610     C           RECI      COMP '*'                      78
329900200610     C                     END
330000200610     C           *IN77     IFEQ '1'
330100200610     C           *LOCK     IN   LDA                                       S01117
330200200610     C***********          MOVEL'SECED'   DBFILE           ***************E20016
330300200610     C                     MOVEL'SEDEV'   DBFILE           ***************E20016
330400200610     C                     MOVELSASN      DBKEY            * DB ERROR 06 *
330500200610     C                     Z-ADD6         DBASE            ***************
330600200610     C                     SETON                     U7U8                 S01117
330700200610     C                     DUMP                                           S01117
330800200610     C                     GOTO EAUDIT
330900200610     C                     END
331000200610     C***********          MOVE WNMCY     NMCY                            E20086
331100200610      *
331200200610     C                     ENDSR
331300200610      *
331400200610      *****************************************************************
331500200610      /SPACE 3
331600200610      *****************************************************************
331700200610      *                                                               *
331800200610      *  TG10   - Subroutine to get Security Currency Decimal Places  *
331900200610      *           from TABTG10.                                       *
332000200610      *                                                               *
332100200610      *****************************************************************
332200200610      *
332300200610     C           TG10      BEGSR                           ** TG10   **
332400200610     C*
332500200610     C** CHAIN FOR CURRENCY RECORD IN TABLE TABTG10
332600200610     C** FIELD WCURR CONTAINS THE CURRENCY WHEN THIS SUBROUTINE EXECUTED
332700200610     C*
332800200610     C* IF WCURR IS EQUAL TO WLSTCY (LAST CCY TO ACCESS TABTG10) IGNORE
332900200610     C*
333000200610     C           WCURR     CABEQWLSTCY    ENDT10
333100200610     C                     MOVE WCURR     WLSTCY  3
333200200610     C*
333300200610     C                     MOVEL'20      'ZTABKY 12
333400200610     C                     MOVE '1'       WRK4    4
333500200610     C                     MOVELWCURR     WRK4
333600200610     C                     MOVE WRK4      ZTABKY
333700200610     C**
333800200610     C           ZTABKY    CHAINTABTG10F             99
333900200610     C*
334000200610     C* ERROR IF NO RECORD FOUND OR IF IT IS DELETED
334100200610     C*
334200200610     C           *IN99     IFEQ '1'
334300200610     C                     SETON                     U7U8
334400200610     C                     ELSE
334500200610     C           RECI      IFEQ '*'
334600200610     C                     SETON                     U7U8
334700200610     C                     END
334800200610     C                     END
334900200610     C           *INU7     IFEQ '1'
335000200610     C           *LOCK     IN   LDA                                       S01117
335100200610     C                     MOVE 'TABLE'   DBFILE           ***************
335200200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 07 *
335300200610     C                     Z-ADD7         DBASE            ***************
335400200610     C                     DUMP                                           S01117
335500200610     C                     GOTO EAUDIT
335600200610     C                     END
335700200610     C*                                                                   S01117
335800200610     C**  Set up new output parameter for use in SR.ZCNSD                 S01117
335900200610     C*                                                                   S01117
336000200610     C                     Z-ADDCDP       ZCDP                            S01117
336100200610     C*
336200200610     C           ENDT10    ENDSR
336300200610      *
336400200610      *****************************************************************
336500200610      /EJECT
336600200610      *****************************************************************
336700200610      *                                                               *
336800200610      *  AUDIT  - Subroutine to update the Audit Files and Output the *
336900200610      *           Control Report.                                     *
337000200610      *                                                               *
337100200610      *****************************************************************
337200200610      *
337300200610     C           AUDIT     BEGSR                           ** AUDIT **
337400200610     C*
337500200610     C** COMPARE COUNT OF ACTIONS TO AUDIT FILE ACTIONS
337600200610     C*
337700200610     C                     READ SECACA                   79
337800200610     C*
337900200610     C* DATA BASE ERROR
338000200610     C*
338100200610     C           *IN79     IFEQ '1'
338200200610     C           *LOCK     IN   LDA                                       S01117
338300200610     C                     MOVEL'SECACA'  DBFILE           ***************
338400200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 08 *
338500200610     C                     Z-ADD8         DBASE            ***************
338600200610     C                     SETON                       U7U8
338700200610     C                     DUMP                                           S01117
338800200610     C                     ELSE
338900200610     C                     Z-ADDNORE      SANORE  50
339000200610     C                     END
339100200610     C*                                                                   S01117
339200200610     C** IN THIS PROGRAM IF A DATABASE ERROR IS ENCOUNTERED THEN IT       S01117
339300200610     C** 'JUMPS' TO THIS ROUTINE TO PRINT OUT THE AUDIT REPORT.           S01117
339400200610     C*  THEREFORE IT IS NECESSARY TO 'OUT' THE LDA HERE.                 S01117
339500200610     C*                                                                   S01117
339600200610     C           *INU7     IFEQ '1'                                       S01117
339700200610     C           *INU8     ANDEQ'1'                                       S01117
339800200610     C                     OUT  LDA                                       S01117
339900200610     C                     END                                            S01117
340000200610     C*
340100200610     C           *INU8     IFNE '1'
340200200610     C           NORE      IFNE WCSECT
340300200610     C                     MOVE '1'       *INU8
340400200610     C                     MOVE '1'       *IN29
340500200610     C                     END
340600200610     C                     END
340700200610     C*
340800200610     C** IF U8 NOT ON UPDATE GEN A/C KEYS AUDIT AND POSN.SETT.AUDIT FILES
340900200610     C*
341000200610     C           *INU8     IFNE '1'
341100200610     C                     Z-ADDW01CNT    NORE
341200200610AW   C                     Z-ADDINT,1     HRWN
341300200610AW   C                     Z-ADDDEC,1     HRDC
341400200610     C                     WRITESEKEYAF
341500200610     C                     Z-ADDW02CNT    NORE
341600200610     C                     WRITEPOSETAF
341700200610     C                     END
341800200610     C*
341900200610     C* OUTPUT CONTROL REPORT
342000200610     C*
342100200610     C                     WRITEHEADAU
342200200610     C           *INU7     IFEQ '1'
342300200610     C                     WRITEERROR
342400200610     C                     ELSE
342500200610     C***********WCSECT    IFEQ 0                                         E29170
342600200610     C***********          WRITENONE                                      E29170
342700200610     C***********          ELSE                                           E29170
342800200610     C                     Z-ADDINT,1     WHASHT
342900200610AW   C                     Z-ADDDEC,1     WHASHD
343000200610     C                     WRITECONTROL
343100200610     C*
343200200610     C***********          END                                            E29170
343300200610     C                     END
343400200610     C***********                                                         E29170
343500200610     C***********          WRITETRAILAU                                   E29170
343600200610     C*
343700200610     C                     ENDSR
343800200610      *
343900200610      *****************************************************************
344000200610      /EJECT
344100200610      *****************************************************************
344200200610      *                                                               *
344300200610      *  POSDSR - Subroutine for Error handling of PF/POSETD.         *
344400200610      *                                                               *
344500200610      *****************************************************************
344600200610      *
344700200610     C           POSDSR    BEGSR                            ** POSDSR **
344800200610     C*
344900200610     C                     MOVE PBCA      PBCAK                           CSE023
345000200610     C                     MOVE PSSH      PSSHK                           CSE023
345100200610     C                     MOVE PCPY      PCPYK                           CSE023
345200200610     C           *LOCK     IN   LDA                                       S01117
345300200610     C                     MOVE 'POSETD'  DBFILE           ***************
345400200610     C                     MOVELPOSDDB    DBKEY            * DB ERROR 09 *
345500200610     C                     Z-ADD009       DBASE            ***************
345600200610     C                     MOVE STSPSD    DBSTAT
345700200610     C                     MOVE '1'       *IN87
345800200610     C                     SETON                     99U7U8
345900200610     C                     DUMP                                           S01117
346000200610     C                     GOTO EAUDIT
346100200610     C*
346200200610     C                     ENDSR
346300200610      *
346400200610      *****************************************************************
346500200610      /SPACE 3
346600200610      *****************************************************************
346700200610      *                                                               *
346800200610      *  SEKDSR - Subroutine for Error handling of LF/SEKEYD.         *
346900200610      *                                                               *
347000200610      *****************************************************************
347100200610      *
347200200610     C           SEKDSR    BEGSR                            **SEKDSR**
347300200610     C*
347400200610     C           *LOCK     IN   LDA                                       S01117
347500200610     C                     MOVE 'SEKEYD'  DBFILE           ***************
347600200610     C                     MOVELACKY      DBKEY            * DB ERROR 10 *
347700200610     C                     Z-ADD010       DBASE            ***************
347800200610     C                     MOVE STSSKD    DBSTAT
347900200610     C                     MOVE '1'       *IN87
348000200610     C                     SETON                     99U7U8
348100200610     C                     DUMP                                           S01117
348200200610     C                     GOTO EAUDIT
348300200610     C*
348400200610     C                     ENDSR
348500200610      *
348600200610      *****************************************************************
348700200610      /SPACE 3
348800200610      *****************************************************************
348900200610      *                                                               *
349000200610      *  POSASR - Subroutine for Error handling of PF/POSETA.         *
349100200610      *                                                               *
349200200610      *****************************************************************
349300200610      *
349400200610     C           POSASR    BEGSR                              **POSASR**
349500200610     C*
349600200610     C           *LOCK     IN   LDA                                       S01117
349700200610     C                     MOVE 'POSETA'  DBFILE           ***************
349800200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 11 *
349900200610     C                     Z-ADD11        DBASE            ***************
350000200610     C                     MOVE STSPSA    DBSTAT
350100200610     C                     MOVE '1'       *IN87
350200200610     C                     SETON                     99U7U8
350300200610     C                     DUMP                                           S01117
350400200610     C                     GOTO EAUDIT
350500200610     C*
350600200610     C                     ENDSR
350700200610      *
350800200610      *****************************************************************
350900200610     C/COPY WNCPYSRC,SE2390C026
351000200610      /SPACE 3
351100200610      *****************************************************************
351200200610      *                                                               *
351300200610      *  SEKASR - Subroutine for Error handling of PF/SEKEYA.         *
351400200610      *                                                               *
351500200610      *****************************************************************
351600200610      *
351700200610     C           SEKASR    BEGSR                             **SEKASR**
351800200610     C*
351900200610     C           *LOCK     IN   LDA                                       S01117
352000200610     C                     MOVE 'SEKEYA'  DBFILE           ***************
352100200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 12 *
352200200610     C                     Z-ADD12        DBASE            ***************
352300200610     C                     MOVE STSSKA    DBSTAT
352400200610     C                     MOVE '1'       *IN87
352500200610     C                     SETON                     99U7U8
352600200610     C                     DUMP                                           S01117
352700200610     C                     GOTO EAUDIT
352800200610     C*
352900200610     C                     ENDSR
353000200610      *
353100200610      *****************************************************************
353200200610      /SPACE 3
353300200610      *****************************************************************
353400200610      *                                                               *
353500200610      *  FIRST  - Subroutine to access ICD Information.               *
353600200610      *                                                               *
353700200610      *****************************************************************
353800200610      *
353900200610     C           FIRST     BEGSR                           ** FIRST **
354000200610     C*
354100200610     C************NAMVAR   DEFN           LDA                             S01117
354200200610     C*
354300200610     C* ACCESS ICD    TABTB10
354400200610     C*
354500200610     C                     EXSR ZSYSTM
354600200610     C           *IN99     IFEQ '1'
354700200610     C                     MOVE '1'       *INU7
354800200610     C                     MOVE '1'       *INU8
354900200610     C           *LOCK     IN   LDA                                       S01117
355000200610     C                     MOVE 'TABLE'   DBFILE           ***************
355100200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 01 *
355200200610     C                     Z-ADD1         DBASE            ***************
355300200610     C                     DUMP                                           S01117
355400200610     C                     ELSE
355500200610     C*
355600200610     C* ACCESS ICD2   TABTB11
355700200610     C*
355800200610     C                     EXSR ZICD2
355900200610     C           *INU7     IFEQ '1'
356000200610     C                     MOVE '1'       *IN99
356100200610     C           *LOCK     IN   LDA                                       S01117
356200200610     C                     MOVE 'TABLE'   DBFILE           ***************
356300200610     C                     MOVELTABKEY    DBKEY            * DB ERROR 02 *
356400200610     C                     Z-ADD2         DBASE            ***************
356500200610     C                     DUMP                                           S01117
356600200610     C                     ELSE
356700200610     C*                                                                   114458
356800200610     C**  Get module details using access object                          114458
356900200610     C*                                                                   CSE023
357000200610     C** Check if CSE023 - Treaty withholding Tax is switched ON          CSE023
357100200610     C*                                                                   CSE023
357200200610     C                     CALL 'AOSARDR0'                                CSE023
357300200610     C                     PARM *BLANKS   @RTCD                           CSE023
357400200610     C                     PARM '*VERIFY' @OPTN                           CSE023
357500200610     C                     PARM 'CSE023'  @SARD   6                       CSE023
357600200610     C*                                                                   CSE023
357700200610     C           @RTCD     IFEQ *BLANK                                    CSE023
357800200610     C                     MOVE 'Y'       CSE023  1                       CSE023
357900200610     C                     ELSE                                           CSE023
358000200610     C                     MOVE 'N'       CSE023                          CSE023
358100200610     C                     END                                            CSE023
358200200610      *                                                                                       CSE028
358300200610      ** Check if CSE028 - MT5xx Standing Settlements Instructions is                         CSE028
358400200610      **   is switched on.                                                                    CSE028
358500200610      *                                                                                       CSE028
358600200610     C                     CALL 'AOSARDR0'                                                    CSE028
358700200610     C                     PARM *BLANKS   @RTCD                                               CSE028
358800200610     C                     PARM '*VERIFY' @OPTN                                               CSE028
358900200610     C                     PARM 'CSE028'  @SARD                                               CSE028
359000200610      *                                                                                       CSE028
359100200610     C           @RTCD     IFEQ *BLANK                                                        CSE028
359200200610     C                     MOVE 'Y'       CSE028  1                                           CSE028
359300200610     C                     ELSE                                                               CSE028
359400200610     C                     MOVE 'N'       CSE028                                              CSE028
359500200610     C                     ENDIF                                                              CSE028
359600200610     C*                                                                   114458
359700200610     C                     CALL 'AOMMODR0'                                114458
359800200610     C                     PARM '*MSG   ' @RTCD                           114458
359900200610     C                     PARM '*FIRST ' @OPTN                           114458
360000200610     C           SDMMOD    PARM SDMMOD    DSFDY                           114458
360100200610     C*                                                                   114458
360200200610     C**  Check if error occurred                                         114458
360300200610     C*                                                                   114458
360400200610     C           @RTCD     IFNE *BLANKS                                   114458
360500200610     C           *LOCK     IN   LDA                                       114458
360600200610     C                     MOVEL'SDMMODPD'DBFILE           ***************114458
360700200610     C                     Z-ADD17        DBASE            * DB ERROR 17 *114458
360800200610     C                     SETON                       U7U8***************114458
360900200610     C                     OUT  LDA                                       114458
361000200610     C                     EXSR *PSSR                                     114458
361100200610     C                     END                                            114458
361200200610     C*                                                                   114458
361300200610      * Retrieve account code                                             103361
361400200610     C           BGRTBN    IFEQ 'Y'                                       114458
361500200610     C                     CALL 'AORETLR0'                                103361
361600200610     C                     PARM *BLANKS   @RTCD   7                       103361
361700200610     C                     PARM '*FIRST'  @OPTN   7                       103361
361800200610     C           SDRETL    PARM SDRETL    DSFDY                           103361
361900200610     C           @RTCD     IFNE *BLANKS                                   103361
362000200610     C           *LOCK     IN   LDA                                       103361
362100200610     C                     SETON                       U7U8***************103361
362200200610     C                     Z-ADD16        DBASE            * DB ERROR 16 *103361
362300200610     C                     MOVEL'SDRETLL1'DBFILE           ***************103361
362400200610     C                     MOVEL*BLANK    DBKEY                           103361
362500200610     C                     EXSR *PSSR                                     103361
362600200610     C                     END                                            103361
362700200610     C                     END                                            114458
362800200610     C*
362900200610     C* ACCESS ICDSE  TABTB36
363000200610     C*
363100200610     C                     EXSR ZICDSE
363200200610     C           *INU7     IFEQ '1'
363300200610     C                     MOVE '1'       *IN99
363400200610     C           *LOCK     IN   LDA                                       S01117
363500200610     C                     MOVE 'TABLE'   DBFILE           ***************
363600200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 03 *
363700200610     C                     Z-ADD3         DBASE            ***************
363800200610     C                     DUMP                                           S01117
363900200610     C                     END
364000200610     C                     END
364100200610     C                     END
364200200610     C/COPY WNCPYSRC,SE2390C022
364300200610     C*
364400200610      *** Obtain General ledger details                                   CEU005
364500200610      *                                                                   CEU005
364600200610     C**********           CALL 'AOGELRR0'                                             CEU005 CGL029
364700200610     C                     CALL 'AOGELRR1'                                                    CGL029
364800200610     C                     PARM '*DBERR ' @RTCD   7                       CEU005
364900200610     C                     PARM '*FIRST ' @OPTN   7                       CEU005
365000200610     C********** SDGELR    PARM SDGELR    DSFDY                                        CEU005 CGL029
365100200610     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
365200200610      *                                                                   CEU005
365300200610      *** Check Withholding tax is installed                              S01447
365400200610      *                                                                   S01447
365500200610     C                     CALL 'AOSARDR0'                                S01447
365600200610     C                     PARM *BLANKS   @RTCD   7                       S01447
365700200610     C                     PARM '*VERIFY' @OPTN   7                       S01447
365800200610     C                     PARM 'S01447'  @SARD   6                       S01447
365900200610      *                                                                   S01447
366000200610     C           @RTCD     IFEQ *BLANK                                    S01447
366100200610     C                     MOVE 'Y'       S01447  1                       S01447
366200200610     C                     ELSE                                           S01447
366300200610     C                     MOVE 'N'       S01447                          S01447
366400200610     C                     END                                            S01447
366500200610     C*                                                                   S01509
366600200610     C** Check if Value Currency is installed                             S01509
366700200610     C*                                                                   S01509
366800200610     C                     CALL 'AOSARDR0'                                S01509
366900200610     C                     PARM *BLANKS   @RTCD   7                       S01509
367000200610     C                     PARM '*VERIFY' @OPTN   7                       S01509
367100200610     C                     PARM 'S01509'  @SARD   6                       S01509
367200200610     C*                                                                   S01509
367300200610     C           @RTCD     IFEQ *BLANK                                    S01509
367400200610     C                     MOVE 'Y'       S01509  1                       S01509
367500200610     C                     ELSE                                           S01509
367600200610     C                     MOVE 'N'       S01509                          S01509
367700200610     C                     END                                            S01509
367800200610     C*                                                                   S01510
367900200610     C** Check if Dividend Payments based on Ex-date is installed         S01510
368000200610     C*                                                                   S01510
368100200610     C                     CALL 'AOSARDR0'                                S01510
368200200610     C                     PARM *BLANKS   @RTCD   7                       S01510
368300200610     C                     PARM '*VERIFY' @OPTN   7                       S01510
368400200610     C                     PARM 'S01510'  @SARD   6                       S01510
368500200610     C*                                                                   S01510
368600200610     C           @RTCD     IFEQ *BLANK                                    S01510
368700200610     C                     MOVE 'Y'       S01510  1                       S01510
368800200610     C                     ELSE                                           S01510
368900200610     C                     MOVE 'N'       S01510                          S01510
369000200610     C                     END                                            S01510
369100200610     C*                                                                   S01512
369200200610     C** Check if Position Settlements is installed                       S01512
369300200610     C*                                                                   S01512
369400200610     C                     CALL 'AOSARDR0'                                S01512
369500200610     C                     PARM *BLANKS   @RTCD   7                       S01512
369600200610     C                     PARM '*VERIFY' @OPTN   7                       S01512
369700200610     C                     PARM 'S01512'  @SARD   6                       S01512
369800200610      *                                                                   S01512
369900200610     C           @RTCD     IFEQ *BLANK                                    S01512
370000200610     C                     MOVE 'Y'       S01512  1                       S01512
370100200610     C                     ELSE                                           S01512
370200200610     C                     MOVE 'N'       S01512                          S01512
370300200610     C                     END                                            S01512
370400200610     C*                                                                   CEU005
370500200610     C** Check if EMU Settlement Ccy switchable feature is installed      CEU005
370600200610     C*                                                                   CEU005
370700200610     C                     CALL 'AOSARDR0'                                CEU005
370800200610     C                     PARM *BLANKS   @RTCD   7                       CEU005
370900200610     C                     PARM '*VERIFY' @OPTN   7                       CEU005
371000200610     C                     PARM 'CEU005'  @SARD   6                       CEU005
371100200610     C*                                                                   CEU005
371200200610     C           @RTCD     IFEQ *BLANK                                    CEU005
371300200610     C                     MOVE 'Y'       CEU005  1                       CEU005
371400200610     C                     ELSE                                           CEU005
371500200610     C                     MOVE 'N'       CEU005                          CEU005
371600200610     C                     END                                            CEU005
371700200610      *                                                                                       CSE110
371800200610      ** Access SAR details file to check CSE110 feature if installed.                        CSE110
371900200610      *                                                                                       CSE110
372000200610     C                     MOVE 'N'       CSE110  1                                           CSE110
372100200610     C                     CALL 'AOSARDR0'                                                    CSE110
372200200610     C                     PARM *BLANKS   @RTCD                                               CSE110
372300200610     C                     PARM '*VERIFY' @OPTN                                               CSE110
372400200610     C                     PARM 'CSE110'  @SARD                                               CSE110
372500200610      *                                                                                       CSE110
372600200610     C                     SELEC                                                              CSE110
372700200610     C           @RTCD     WHEQ *BLANK                                                        CSE110
372800200610     C                     MOVE *ON       *IN71                                               CSE110
372900200610     C                     MOVE 'Y'       CSE110                                              CSE110
373000200610      *                                                                                       CSE110
373100200610     C           @RTCD     WHEQ '*NRF'                                                        CSE110
373200200610     C                     MOVE *OFF      *IN71                                               CSE110
373300200610     C                     MOVE 'N'       CSE110                                              CSE110
373400200610      *                                                                                       CSE110
373500200610     C                     OTHER                                                              CSE110
373600200610     C           *LOCK     IN   LDA                                                           CSE110
373700200610     C                     MOVEL'SCSARDPD'DBFILE            *************                     CSE110
373800200610     C                     MOVEL'013'     DBASE             *DBERROR 013*                     CSE110
373900200610     C                     MOVEL@OPTN     DBKEY             *************                     CSE110
374000200610     C                     SETON                     U7U8                                     CSE110
374100200610     C                     OUT  LDA                                                           CSE110
374200200610     C                     EXSR *PSSR                                                         CSE110
374300200610     C                     ENDSL                                                              CSE110
374400200610      *                                                                                       CSE110
374500200610     C/COPY WNCPYSRC,SE2390C044
374600200610     C*                                                                   CAC002
374700200610     C**  Access MIDAS Module details                                     CAC002
374800200610     C*                                                                   CAC002
374900200610     C                     CALL 'AOMMODR0'                                CAC002
375000200610     C                     PARM '*MSG   ' @RTCD                           CAC002
375100200610     C                     PARM '*FIRST ' @OPTN                           CAC002
375200200610     C           SDMMOD    PARM SDMMOD    DSFDY                           CAC002
375300200610     C*                                                                   CAC002
375400200610     C           @RTCD     IFNE *BLANKS                                   CAC002
375500200610     C           *LOCK     IN   LDA                                       CAC002
375600200610     C                     Z-ADD23        DBASE            ************   CAC002
375700200610     C                     MOVEL'SDMMODPD'DBFILE           * DBERR 23 *   CAC002
375800200610     C                     MOVEL@OPTN     DBKEY            ************   CAC002
375900200610     C                     SETON                     U7U899               CAC002
376000200610     C                     DUMP                                           CAC002
376100200610     C                     ENDIF                                          CAC002
376200200610     C*                                                                   CAC002
376300200610     C**  Access Securities Trading details                               CAC002
376400200610     C*                                                                   CAC002
376500200610     C                     CALL 'AOSTRDR0'                                CAC002
376600200610     C                     PARM '*MSG   ' @RTCD                           CAC002
376700200610     C                     PARM '*FIRST ' @OPTN                           CAC002
376800200610     C           SDSTRD    PARM SDSTRD    DSSDY                           CAC002
376900200610     C*                                                                   CAC002
377000200610     C           @RTCD     IFNE *BLANKS                                   CAC002
377100200610     C           *LOCK     IN   LDA                                       CAC002
377200200610     C                     Z-ADD24        DBASE            ************   CAC002
377300200610     C                     MOVEL'SDSTRDPD'DBFILE           * DBERR 24 *   CAC002
377400200610     C                     MOVEL@OPTN     DBKEY            ************   CAC002
377500200610     C                     SETON                     U7U899               CAC002
377600200610     C                     DUMP                                           CAC002
377700200610     C                     ENDIF                                          CAC002
377800200610      *                                                                                       CSE035
377900200610      ** Access SAR details file to see if CSE035 is installed                                CSE035
378000200610      *                                                                                       CSE035
378100200610     C                     CALL 'AOSARDR0'                                                    CSE035
378200200610     C                     PARM *BLANKS   @RTCD                                               CSE035
378300200610     C                     PARM '*VERIFY' @OPTN                                               CSE035
378400200610     C                     PARM 'CSE035'  @SARD                                               CSE035
378500200610      *                                                                                       CSE035
378600200610     C           @RTCD     IFEQ *BLANK                                                        CSE035
378700200610     C                     MOVE 'Y'       CSE035  1                                           CSE035
378800200610     C                     ELSE                                                               CSE035
378900200610     C                     MOVE 'N'       CSE035                                              CSE035
379000200610     C                     ENDIF                                                              CSE035
379100200610      *                                                                                       CSE035
379200200610      *                                                                                       CGL020
379300200610      ** Determine if Midas Compliance Watch is installed                                     CGL020
379400200610      *                                                                                       CGL020
379500200610     C                     MOVE 'N'       CGL020  1                                           CGL020
379600200610     C                     CALL 'AOSARDR0'                                                    CGL020
379700200610     C                     PARM '       ' @RTCD                                               CGL020
379800200610     C                     PARM '*VERIFY' @OPTN                                               CGL020
379900200610     C                     PARM 'CGL020'  @SARD                                               CGL020
380000200610     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
380100200610      *                                                                                       CGL020
380200200610     C           @RTCD     IFNE *BLANK                                                        CGL020
380300200610     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
380400200610     C           *LOCK     IN   LDA                                                           CGL020
380500200610     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
380600200610     C                     Z-ADD25        DBASE                                               CGL020
380700200610     C                     MOVEL@SARD     DBKEY                                               CGL020
380800200610     C                     OUT  LDA                                                           CGL020
380900200610     C                     MOVE *ON       *INU7                                               CGL020
381000200610     C                     MOVE *ON       *INU8                                               CGL020
381100200610     C                     MOVE *ON       *INLR                                               CGL020
381200200610     C                     EXSR *PSSR                                                         CGL020
381300200610      *                                                                                       CGL020
381400200610     C                     ELSE                                                               CGL020
381500200610     C                     MOVE 'Y'       CGL020                                              CGL020
381600200610     C                     ENDIF                                                              CGL020
381700200610      *                                                                                       248184
381800200610      ** Check if S01496 - Private Banking Securities Trading Enhancements                    248184
381900200610      *                                                                                       248184
382000200610     C                     CALL 'AOSARDR0'                                                    248184
382100200610     C                     PARM *BLANKS   @RTCD                                               248184
382200200610     C                     PARM '*VERIFY' @OPTN                                               248184
382300200610     C                     PARM 'S01496'  @SARD                                               248184
382400200610      *                                                                                       248184
382500200610     C           @RTCD     IFEQ *BLANK                                                        248184
382600200610     C                     MOVE 'Y'       S01496  1                                           248184
382700200610     C                     ELSE                                                               248184
382800200610     C                     MOVE 'N'       S01496                                              248184
382900200610     C                     END                                                                248184
383000200610      *                                                                   S01447
383100200610     C/COPY WNCPYSRC,SE2390C030
383200200610      *                                                                   S01447
383300200610      ***  Define like field definitions                                  S01447
383400200610      *                                                                   S01447
383500200610     C           *LIKE     DEFN S1RASO    UTXRSR           src tax rate   S01447
383600200610     C           *LIKE     DEFN TBRASR    UTXRRF           ref tax rate   S01447
383700200610     C           *LIKE     DEFN TBRAUS    UTXRUS           usr tax rate   S01447
383800200610     C*                                                                   S01447
383900200610     C*                                                                   S01408
384000200610     C/COPY WNCPYSRC,SE2390CCP1                                           S01408
384100200610     C*                                                                   S01408
384200200610      *                                                                                       CSE075
384300200610      ** Determine if Midas Compliance Watch is installed                                     CSE075
384400200610      *                                                                                       CSE075
384500200610     C                     CALL 'AOSARDR0'                                                    CSE075
384600200610     C                     PARM '       ' @RTCD   7                                           CSE075
384700200610     C                     PARM '*VERIFY' POPTN   7                                           CSE075
384800200610     C                     PARM 'CSE075'  PSARD   6                                           CSE075
384900200610     C           SCSARD    PARM SCSARD    DSFDY                                               CSE075
385000200610      *                                                                                       CSE075
385100200610     C           @RTCD     IFNE *BLANK                                                        CSE075
385200200610     C           @RTCD     ANDNE'*NRF   '                                                     CSE075
385300200610     C           *LOCK     IN   LDA                                                           CSE075
385400200610     C                     MOVEL'SCSARDPD'DBFILE                                              CSE075
385500200610     C                     MOVEL'CSE075 ' DBKEY                                               CSE075
385600200610     C                     Z-ADD26        DBASE                                               CSE075
385700200610     C                     OUT  LDA                                                           CSE075
385800200610     C                     MOVE *ON       *INU7                                               CSE075
385900200610     C                     MOVE *ON       *INU8                                               CSE075
386000200610     C                     MOVE *ON       *INLR                                               CSE075
386100200610     C                     EXSR *PSSR                                                         CSE075
386200200610     C                     ENDIF                                                              CSE075
386300200610      *                                                                                       CSE075
386400200610     C           @RTCD     IFEQ *BLANKS                                                       CSE075
386500200610     C                     MOVE 'Y'       CSE075  1                                           CSE075
386600200610     C                     ELSE                                                               CSE075
386700200610     C                     MOVE 'N'       CSE075                                              CSE075
386800200610     C                     ENDIF                                                              CSE075
386900200610      *                                                                                     AR853119
387000200610      ** Check if CER049 - Stamp Tax is switch on                                           AR853119
387100200610      *                                                                                     AR853119
387200200610     C                     CALL 'AOSARDR0'                                                  AR853119
387300200610     C                     PARM *BLANKS   @RTCD                                             AR853119
387400200610     C                     PARM '*VERIFY' POPTN                                             AR853119
387500200610     C                     PARM 'CER049'  PSARD                                             AR853119
387600200610      *                                                                                     AR853119
387700200610     C           @RTCD     IFEQ *BLANK                                                      AR853119
387800200610     C                     MOVE 'Y'       CER049  1                                         AR853119
387900200610     C                     ELSE                                                             AR853119
388000200610     C                     MOVE 'N'       CER049                                            AR853119
388100200610     C                     ENDIF                                                            AR853119
388200200610      *********                                                                 AR1001183 AR1001183A
388300200610      ** Check if CRE073 is switched on                                         AR1001183 AR1001183A
388400200610      **********                                                                AR1001183 AR1001183A
388500200610     C**********           CALL 'AOSARDR0'                                      AR1001183 AR1001183A
388600200610     C**********           PARM           @RTCD                                 AR1001183 AR1001183A
388700200610     C**********           PARM '*VERIFY' @OPTN                                 AR1001183 AR1001183A
388800200610     C**********           PARM 'CRE073'  @SARD                                 AR1001183 AR1001183A
388900200610      **********                                                                AR1001183 AR1001183A
389000200610      ***Process*database*error                                                 AR1001183 AR1001183A
389100200610      **********                                                                AR1001183 AR1001183A
389200200610     C********** @RTCD     IFEQ *BLANKS                                         AR1001183 AR1001183A
389300200610     C**********           MOVE 'Y'       CRE073  1                             AR1001183 AR1001183A
389400200610     C**********           ELSE                                                 AR1001183 AR1001183A
389500200610     C**********           MOVE 'N'       CRE073                                AR1001183 AR1001183A
389600200610     C**********           ENDIF                                                AR1001183 AR1001183A
389700200610      *                                                                                     AR853119
389800200610      ***  Access bank details                                                              AR853119
389900200610      *                                                                                     AR853119
390000200610     C                     CALL 'AOBANKR0'                                                  AR853119
390100200610     C                     PARM *BLANKS   @RTCD                                             AR853119
390200200610     C                     PARM '*FIRST  'POPTN                                             AR853119
390300200610     C           SDBANK    PARM SDBANK    DSFDY                                             AR853119
390400200610      *                                                                                     AR853119
390500200610     C           @RTCD     IFNE *BLANK                                                      AR853119
390600200610     C           *LOCK     IN   LDA                                                         AR853119
390700200610     C                     Z-ADD27        DBASE            *****************                AR853119
390800200610     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 18 **                AR853119
390900200610     C                     MOVEL'SDBANKPD'DBFILE    P      *****************                AR853119
391000200610     C                     MOVEL'*FIRST  'DBKEY     P                                       AR853119
391100200610     C                     MOVEL'SE2390'  DBPGM     P                                       AR853119
391200200610     C                     OUT  LDA                                                         AR853119
391300200610     C                     EXSR *PSSR                                                       AR853119
391400200610     C                     ENDIF                                                            AR853119
391500200610      *                                                                                     AR853119
391600200610     C                     ENDSR
391700200610     C*
391800200610      *****************************************************************                     AR853119
391900200610      /EJECT                                                                                AR853119
392000200610      *****************************************************************                     AR853119
392100200610      *                                                               *                     AR853119
392200200610      * SRPOST - Create Position Settlement extension                 *                     AR853119
392300200610      *                                                               *                     AR853119
392400200610      *****************************************************************                     AR853119
392500200610     C           SRPOST    BEGSR                                                            AR853119
392600200610      *                                                                                     AR853119
392700200610     C                     MOVE *BLANK    WSTAX   1                                         AR853119
392800200610     C                     MOVE *BLANK    WCTAX   1                                         AR853119
392900200610     C                     Z-ADD0         P3STAF                                            AR853119
393000200610     C                     MOVELBJRDNB    P3CDTE                                            AR853119
393100200610     C                     MOVE 'N'       P3TAX                                             AR853119
393200200610     C                     MOVELPBCA      P3PBCA                                            AR853119
393300200610     C                     MOVELPSSH      P3PSSH                                            AR853119
393400200610     C                     MOVELPCPY      P3PCPY                                            AR853119
393500200610     C                     MOVELPDUD      P3PDUD                                            AR853119
393600200610     C                     MOVELPEVT      P3PEVT                                            AR853119
393700200610      *                                                                                     AR853119
393800200610     C                     CALL 'AOBRCHR2'                                                  AR853119
393900200610     C                     PARM *BLANKS   @RTCD                                             AR853119
394000200610     C                     PARM '*KEY   ' @OPTN                                             AR853119
394100200610     C                     PARM PBCA      @DSNB   3                                         AR853119
394200200610     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR853119
394300200610     C           @RTCD     IFEQ *BLANKS                                                     AR853119
394400200610     C                     MOVE BXTAX     WSTAX                                             AR853119
394500200610     C                     ENDIF                                                            AR853119
394600200610      *                                                                                     AR853119
394700200610     C           PCPY      CHAINSDCUSQL0             99                                     AR853119
394800200610     C           *IN99     IFEQ '0'                                                         AR853119
394900200610     C                     MOVE CQTAX     WCTAX                                             AR853119
395000200610     C                     ENDIF                                                            AR853119
395100200610      *                                                                                     AR853119
395200200610      ** Calculate Stamp tax                                                                AR853119
395300200610      *                                                                                     AR853119
395400200610     C           WSTAX     IFEQ 'Y'                                                         AR853119
395500200610     C           WCTAX     ANDEQ'Y'                                                         AR853119
395600200610     C                     MOVE 'Y'       P3TAX                                             AR853119
395700200610     C                     ENDIF                                                            AR853119
395800200610      *                                                                                     AR853119
395900200610     C                     WRITEPOSETDD3                                                    AR853119
396000200610      *                                                                                     AR853119
396100200610     C                     ENDSR                                                            AR853119
396200200610      *****************************************************************                    AR1001183
396300200610      ***/SPACE*3                                                               AR1001183 AR1001183A
396400200610      *****************************************************************                    AR1001183
396500200610      *****************************************************************         AR1001183 AR1001183A
396600200610      ***GETNCR*- *ubroutien*to*get*next*coupon*rate*******************         AR1001183 AR1001183A
396700200610      *****************************************************************         AR1001183 AR1001183A
396800200610      *****************************************************************         AR1001183 AR1001183A
396900200610      **********                                                                AR1001183 AR1001183A
397000200610     C********** GETNCR    BEGSR                                                AR1001183 AR1001183A
397100200610      **********                                                                AR1001183 AR1001183A
397200200610     C**********           Z-ADDBASC      UBASC                                 AR1001183 AR1001183A
397300200610     C**********           Z-ADDBASS      UBASS                                 AR1001183 AR1001183A
397400200610     C**********           MOVE SPRI      USPRI                                 AR1001183 AR1001183A
397500200610     C**********           MOVELCNSP      UCNSP                                 AR1001183 AR1001183A
397600200610     C**********           MOVELCNSG      UCNSG                                 AR1001183 AR1001183A
397700200610     C**********           MOVELRDMT      URDMT                                 AR1001183 AR1001183A
397800200610     C**********           MOVELRDFD      URDFD                                 AR1001183 AR1001183A
397900200610      ***Initialize*work*fields                                                 AR1001183 AR1001183A
398000200610      **********                                                                AR1001183 AR1001183A
398100200610     C**********           MOVEL*BLANKS   WAD                                   AR1001183 AR1001183A
398200200610     C**********           MOVEL*BLANKS   WBR                                   AR1001183 AR1001183A
398300200610     C**********           MOVEL*BLANKS   WBS                                   AR1001183 AR1001183A
398400200610     C**********           MOVEL*BLANKS   WSI                                   AR1001183 AR1001183A
398500200610     C**********           MOVEL*BLANKS   WRM                                   AR1001183 AR1001183A
398600200610     C**********           MOVEL*BLANKS   WRF                                   AR1001183 AR1001183A
398700200610      **********                                                                AR1001183 AR1001183A
398800200610      ***LOAD*APPLICABLE*DATE*INTO*ARRAY                                        AR1001183 AR1001183A
398900200610     C**********           Z-ADDAD01      WAD,1                                 AR1001183 AR1001183A
399000200610     C**********           Z-ADDAD02      WAD,2                                 AR1001183 AR1001183A
399100200610     C**********           Z-ADDAD03      WAD,3                                 AR1001183 AR1001183A
399200200610     C**********           Z-ADDAD04      WAD,4                                 AR1001183 AR1001183A
399300200610     C**********           Z-ADDAD05      WAD,5                                 AR1001183 AR1001183A
399400200610     C**********           Z-ADDAD06      WAD,6                                 AR1001183 AR1001183A
399500200610     C**********           Z-ADDAD07      WAD,7                                 AR1001183 AR1001183A
399600200610     C**********           Z-ADDAD08      WAD,8                                 AR1001183 AR1001183A
399700200610     C**********           Z-ADDAD09      WAD,9                                 AR1001183 AR1001183A
399800200610     C**********           Z-ADDAD10      WAD,10                                AR1001183 AR1001183A
399900200610      **********                                                                AR1001183 AR1001183A
400000200610      ***LOAD*BASE*RATE*INTO*ARRAY                                              AR1001183 AR1001183A
400100200610     C**********           Z-ADDBR01      WBR,1                                 AR1001183 AR1001183A
400200200610     C**********           Z-ADDBR02      WBR,2                                 AR1001183 AR1001183A
400300200610     C**********           Z-ADDBR03      WBR,3                                 AR1001183 AR1001183A
400400200610     C**********           Z-ADDBR04      WBR,4                                 AR1001183 AR1001183A
400500200610     C**********           Z-ADDBR05      WBR,5                                 AR1001183 AR1001183A
400600200610     C**********           Z-ADDBR06      WBR,6                                 AR1001183 AR1001183A
400700200610     C**********           Z-ADDBR07      WBR,7                                 AR1001183 AR1001183A
400800200610     C**********           Z-ADDBR08      WBR,8                                 AR1001183 AR1001183A
400900200610     C**********           Z-ADDBR09      WBR,9                                 AR1001183 AR1001183A
401000200610     C**********           Z-ADDBR10      WBR,10                                AR1001183 AR1001183A
401100200610      **********                                                                AR1001183 AR1001183A
401200200610     C**********           Z-ADDCNP01     WBS,1                                 AR1001183 AR1001183A
401300200610     C**********           Z-ADDCNP02     WBS,2                                 AR1001183 AR1001183A
401400200610     C**********           Z-ADDCNP03     WBS,3                                 AR1001183 AR1001183A
401500200610     C**********           Z-ADDCNP04     WBS,4                                 AR1001183 AR1001183A
401600200610     C**********           Z-ADDCNP05     WBS,5                                 AR1001183 AR1001183A
401700200610     C**********           Z-ADDCNP06     WBS,6                                 AR1001183 AR1001183A
401800200610     C**********           Z-ADDCNP07     WBS,7                                 AR1001183 AR1001183A
401900200610     C**********           Z-ADDCNP08     WBS,8                                 AR1001183 AR1001183A
402000200610     C**********           Z-ADDCNP09     WBS,9                                 AR1001183 AR1001183A
402100200610     C**********           Z-ADDCNP10     WBS,10                                AR1001183 AR1001183A
402200200610      **********                                                                AR1001183 AR1001183A
402300200610      ***LOAD*CONTRACTUAL*SPREAD*INDICATOR*INTO*ARRAY                           AR1001183 AR1001183A
402400200610      **********                                                                AR1001183 AR1001183A
402500200610     C**********           MOVEACNG01     WSI,1                                 AR1001183 AR1001183A
402600200610     C**********           MOVEACNG02     WSI,2                                 AR1001183 AR1001183A
402700200610     C**********           MOVEACNG03     WSI,3                                 AR1001183 AR1001183A
402800200610     C**********           MOVEACNG04     WSI,4                                 AR1001183 AR1001183A
402900200610     C**********           MOVEACNG05     WSI,5                                 AR1001183 AR1001183A
403000200610     C**********           MOVEACNG06     WSI,6                                 AR1001183 AR1001183A
403100200610     C**********           MOVEACNG07     WSI,7                                 AR1001183 AR1001183A
403200200610     C**********           MOVEACNG08     WSI,8                                 AR1001183 AR1001183A
403300200610     C**********           MOVEACNG09     WSI,9                                 AR1001183 AR1001183A
403400200610     C**********           MOVEACNG10     WSI,10                                AR1001183 AR1001183A
403500200610      **********                                                                AR1001183 AR1001183A
403600200610      ***LOAD*ROUNDING*METHOD*INTO*ARRAY                                        AR1001183 AR1001183A
403700200610      **********                                                                AR1001183 AR1001183A
403800200610     C**********           MOVELRDM01     WRM,1                                 AR1001183 AR1001183A
403900200610     C**********           MOVELRDM02     WRM,2                                 AR1001183 AR1001183A
404000200610     C**********           MOVELRDM03     WRM,3                                 AR1001183 AR1001183A
404100200610     C**********           MOVELRDM04     WRM,4                                 AR1001183 AR1001183A
404200200610     C**********           MOVELRDM05     WRM,5                                 AR1001183 AR1001183A
404300200610     C**********           MOVELRDM06     WRM,6                                 AR1001183 AR1001183A
404400200610     C**********           MOVELRDM07     WRM,7                                 AR1001183 AR1001183A
404500200610     C**********           MOVELRDM08     WRM,8                                 AR1001183 AR1001183A
404600200610     C**********           MOVELRDM09     WRM,9                                 AR1001183 AR1001183A
404700200610     C**********           MOVELRDM10     WRM,10                                AR1001183 AR1001183A
404800200610      **********                                                                AR1001183 AR1001183A
404900200610      ***LOAD*ROUNDING*FRACTION/DECIMAL*INTO*ARRAY                              AR1001183 AR1001183A
405000200610      **********                                                                AR1001183 AR1001183A
405100200610     C**********           MOVELRDF01     WRF,1                                 AR1001183 AR1001183A
405200200610     C**********           MOVELRDF02     WRF,2                                 AR1001183 AR1001183A
405300200610     C**********           MOVELRDF03     WRF,3                                 AR1001183 AR1001183A
405400200610     C**********           MOVELRDF04     WRF,4                                 AR1001183 AR1001183A
405500200610     C**********           MOVELRDF05     WRF,5                                 AR1001183 AR1001183A
405600200610     C**********           MOVELRDF06     WRF,6                                 AR1001183 AR1001183A
405700200610     C**********           MOVELRDF07     WRF,7                                 AR1001183 AR1001183A
405800200610     C**********           MOVELRDF08     WRF,8                                 AR1001183 AR1001183A
405900200610     C**********           MOVELRDF09     WRF,9                                 AR1001183 AR1001183A
406000200610     C**********           MOVELRDF10     WRF,10                                AR1001183 AR1001183A
406100200610      ***CHECK*IF*THE*NEXT*COUPON*DATE*IS*GREATER*OR*EQUAL*TO*ANY*OF            AR1001183 AR1001183A
406200200610      ***THE*ADDITIONAL*COUPON*DATES.*IF*IT*IS*THAN*USE*THE*BASE*RATE           AR1001183 AR1001183A
406300200610      ***INFORMATION*SUPPLIED.                                                  AR1001183 AR1001183A
406400200610      *                                                                         AR1001183 AR1001183A
406500200610     C**********           MOVE 'N'       WAPP    1                             AR1001183 AR1001183A
406600200610     C**********           Z-ADD10        X       20                            AR1001183 AR1001183A
406700200610      **********                                                                AR1001183 AR1001183A
406800200610     C********** X         DOWGT0                                               AR1001183 AR1001183A
406900200610      **********                                                                AR1001183 AR1001183A
407000200610     C********** WAD,X     IFNE *ZERO                                           AR1001183 AR1001183A
407100200610      **********                                                                AR1001183 AR1001183A
407200200610      ***CONVERT*DATE*TO*DAY*NUMBER                                             AR1001183 AR1001183A
407300200610     C**********           Z-ADDWAD,X     ZDATE                                 AR1001183 AR1001183A
407400200610     C**********           EXSR ZDATE1                                          AR1001183 AR1001183A
407500200610      **********                                                                AR1001183 AR1001183A
407600200610     C********** WDAT      IFGE ZDAYNO                                          AR1001183 AR1001183A
407700200610     C**********           MOVE 'Y'       WAPP                                  AR1001183 AR1001183A
407800200610     C**********           LEAVE                                                AR1001183 AR1001183A
407900200610     C**********           ENDIF                                                AR1001183 AR1001183A
408000200610      **********                                                                AR1001183 AR1001183A
408100200610     C**********           ENDIF                                                AR1001183 AR1001183A
408200200610     C**********           SUB  1         X                                     AR1001183 AR1001183A
408300200610     C**********           ENDDO                                                AR1001183 AR1001183A
408400200610      **********                                                                AR1001183 AR1001183A
408500200610      ***USE*RATE*FROM*ADDITIONAL*COUPON*DATE*INFORMATION                       AR1001183 AR1001183A
408600200610     C********** WAPP      IFEQ 'Y'                                             AR1001183 AR1001183A
408700200610      **********                                                                AR1001183 AR1001183A
408800200610      ***SET*NEW*BASE*RATE                                                      AR1001183 AR1001183A
408900200610     C**********  BR,X     IFNE *ZERO                                           AR1001183 AR1001183A
409000200610     C**********           Z-ADDWBR,X     UBASC                                 AR1001183 AR1001183A
409100200610     C**********           ENDIF                                                AR1001183 AR1001183A
409200200610      **********                                                                AR1001183 AR1001183A
409300200610      ***SET*NEW*SPREAD*RATE                                                    AR1001183 AR1001183A
409400200610     C**********  BS,X     IFNE *ZERO                                           AR1001183 AR1001183A
409500200610     C**********           Z-ADDWBS,X     UBASS                                 AR1001183 AR1001183A
409600200610     C**********           ENDIF                                                AR1001183 AR1001183A
409700200610      **********                                                                AR1001183 AR1001183A
409800200610      ***SET*NEW*SPREAD*INDICATOR                                               AR1001183 AR1001183A
409900200610     C**********           MOVEAWSI,X     USPRI                                 AR1001183 AR1001183A
410000200610      **********                                                                AR1001183 AR1001183A
410100200610      ***SET*ROUNDING*METHOD                                                    AR1001183 AR1001183A
410200200610      **********                                                                AR1001183 AR1001183A
410300200610     C**********           MOVELWRM,X     URDMT                                 AR1001183 AR1001183A
410400200610      **********                                                                AR1001183 AR1001183A
410500200610      ***SET*ROUNDING*FRACTION/DECIMAL                                          AR1001183 AR1001183A
410600200610      **********                                                                AR1001183 AR1001183A
410700200610     C**********           MOVELWRF,X     URDFD                                 AR1001183 AR1001183A
410800200610      **********                                                                AR1001183 AR1001183A
410900200610     C**********           ENDIF                                                AR1001183 AR1001183A
411000200610      **********                                                                AR1001183 AR1001183A
411100200610     C**********  BASC     IFGT 0                                               AR1001183 AR1001183A
411200200610     C**********  BASS     ORGT 0                                               AR1001183 AR1001183A
411300200610      **********                                                                AR1001183 AR1001183A
411400200610      ***OBTAIN*BASE*RATE*INFO*FROM SDBSRTPD                                    AR1001183 AR1001183A
411500200610     C**********           MOVE UBASC     PBSRC   2                             AR1001183 AR1001183A
411600200610      **********                                                                AR1001183 AR1001183A
411700200610     C**********           CALL 'AOBSRTR0'                                      AR1001183 AR1001183A
411800200610     C**********           PARM *BLANKS   @RTCD                                 AR1001183 AR1001183A
411900200610     C**********           PARM '*KEY   ' @OPTN                                 AR1001183 AR1001183A
412000200610     C**********           PARM VLCY      PCCY    3                             AR1001183 AR1001183A
412100200610     C**********           PARM           PBSRC                                 AR1001183 AR1001183A
412200200610     C********** SDBSRT    PARM SDBSRT    DSFDY                                 AR1001183 AR1001183A
412300200610      **********                                                                AR1001183 AR1001183A
412400200610     C********** @RTCD     IFNE *BLANKS                                         AR1001183 AR1001183A
412500200610     C**********           MOVELVLCY      WKEY2   5                             AR1001183 AR1001183A
412600200610     C**********           MOVE UBASC     WKEY2                                 AR1001183 AR1001183A
412700200610     C**********           Z-ADD69        DBASE                                 AR1001183 AR1001183A
412800200610     C**********           MOVEL'SDBSRTPD'DBFILE                                AR1001183 AR1001183A
412900200610     C**********           MOVELWKEY2     DBKEY                                 AR1001183 AR1001183A
413000200610     C**********           EXSR *PSSR                                           AR1001183 AR1001183A
413100200610     C**********           ENDIF                                                AR1001183 AR1001183A
413200200610      **********                                                                AR1001183 AR1001183A
413300200610      ***USE*NEW*BASE*RATE*IF*APPROPRIATE,*OTHERWISE*USE*CURRENT*RATE           AR1001183 AR1001183A
413400200610     C********** BAVDNR    IFLE WDAT                                            AR1001183 AR1001183A
413500200610     C**********           Z-ADDBANBRT    USDNC  117                            AR1001183 AR1001183A
413600200610     C**********           ELSE                                                 AR1001183 AR1001183A
413700200610     C**********           Z-ADDBACBSR    USDNC                                 AR1001183 AR1001183A
413800200610     C**********           ENDIF                                                AR1001183 AR1001183A
413900200610      **********                                                                AR1001183 AR1001183A
414000200610     C**********           CALL SPRDSR                                          AR1001183 AR1001183A
414100200610     C**********           PARM *BLANKS   PRTCD                                 AR1001183 AR1001183A
414200200610     C**********           PARM           BANBRT                                AR1001183 AR1001183A
414300200610     C**********           PARM           UBASS                                 AR1001183 AR1001183A
414400200610     C**********           PARM           USPRI                                 AR1001183 AR1001183A
414500200610     C**********           PARM           URDMT                                 AR1001183 AR1001183A
414600200610     C**********           PARM           URDFD                                 AR1001183 AR1001183A
414700200610     C**********           PARM *ZERO     NSPRD  117                            AR1001183 AR1001183A
414800200610     C**********           PARM *ZERO     FRATE  117                            AR1001183 AR1001183A
414900200610      **********                                                                AR1001183 AR1001183A
415000200610     C********** PRTCD     IFNE *BLANK                                          AR1001183 AR1001183A
415100200610     C********** *LOCK     IN   LDA                                             AR1001183 AR1001183A
415200200610     C**********           Z-ADD70        DBASE                                 AR1001183 AR1001183A
415300200610     C**********           MOVELSPRDSR    DBPGM                                 AR1001183 AR1001183A
415400200610     C**********           MOVELBANBRT    DBKEY                                 AR1001183 AR1001183A
415500200610     C**********           OUT  LDA                                             AR1001183 AR1001183A
415600200610     C**********           EXSR *PSSR                                           AR1001183 AR1001183A
415700200610     C**********           ENDIF                                                AR1001183 AR1001183A
415800200610      **********                                                                AR1001183 AR1001183A
415900200610     C**********           Z-ADDFRATE     WPSXR  138                            AR1001183 AR1001183A
416000200610     C**********           MOVE 'Y'       WRCHG                                 AR1001183 AR1001183A
416100200610      **********                                                                AR1001183 AR1001183A
416200200610      ***Override*value*of*PSXR*if*final*rate*<= zero                           AR1001183 AR1001183A
416300200610      **********                                                                AR1001183 AR1001183A
416400200610     C********** FRATE     IFLE 0                                               AR1001183 AR1001183A
416500200610     C**********           Z-ADD0         WPSXR                                 AR1001183 AR1001183A
416600200610     C**********           ENDIF                                                AR1001183 AR1001183A
416700200610      **********                                                                AR1001183 AR1001183A
416800200610     C**********           ENDIF                                                AR1001183 AR1001183A
416900200610      **********                                                                AR1001183 AR1001183A
417000200610     C**********           ENDSR                                                AR1001183 AR1001183A
417100200610      **********                                                                AR1001183 AR1001183A
417101200616     C********************************************************************                  AR324886
417102200616     C/EJECT                                                                                AR324886
417103200616     C********************************************************************                  AR324886
417104200616     C           PSAUDT    BEGSR                                                            AR324886
417105200616      *                                                                                     AR324886
417106200616     C                     MOVE RECI      PARECI                                            AR324886
417107200616     C                     MOVE PBCA      PAPBCA                                            AR324886
417108200616     C                     MOVE PSSH      PAPSSH                                            AR324886
417109200616     C                     MOVE PCPY      PAPCPY                                            AR324886
417110200616     C                     MOVE PDUD      PAPDUD                                            AR324886
417111200616     C                     MOVE PEVT      PAPEVT                                            AR324886
417112200616     C                     MOVE PTFR      PAPTFR                                            AR324886
417113200616     C                     MOVE TNLU      PATNLU                                            AR324886
417114200616     C                     MOVE TXBS      PATXBS                                            AR324886
417115200616     C                     MOVE BNFO      PABNFO                                            AR324886
417116200616     C                     MOVE EXCD      PAEXCD                                            AR324886
417117200616     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
417118200616     C                     MOVE LCD       PALCD                                             AR324886
417119200616     C                     MOVE CHTP      PALCTP                                            AR324886
417120200616     C                     WRITEPSAUTDF                                                     AR324886
417121200616      *                                                                                     AR324886
417122200616     C                     ENDSR                                                            AR324886
417200200610     C*****************************************************************
417300200610      /EJECT                                                              S01117
417400200610      *****************************************************************   S01117
417500200610      *                                                               *   S01117
417600200610      *  *PSSR  - Error control subroutine                            *   S01117
417700200610      *                                                               *   S01117
417800200610      *****************************************************************   S01117
417900200610      *                                                                   S01117
418000200610     C           *PSSR     BEGSR                           ** *PSSR **    S01117
418100200610     C**                                                                  S01117
418200200610     C           @RUN      IFEQ *BLANKS                                   S01117
418300200610     C                     MOVE 'Y'       @RUN    1                       S01117
418400200610     C                     DUMP                                           S01117
418500200610     C                     END                                            S01117
418600200610     C**                                                                  S01117
418700200610     C                     ENDSR                                          S01117
418800200610      *                                                                   S01117
418900200610     C***************************************************************     S01486
419000200610     C**   ZTNLU1      *TO LOCK THE TRANSACTION NUMBER DATA AREA,         S01486
419100200610     C**                ACCESS THE NEXT AVAILABLE TRANSACTION NUMBER,     S01486
419200200610     C**                THEN UPDATE AND RELEASE THE DATAAREA              S01486
419300200610     C****************************************************************    S01486
419400200610     C           ZTNLU1    BEGSR                           ** ZTNLU1 BSR* S01486
419500200610     C           *NAMVAR   DEFN MNATN     DNATN                           S01486
419600200610     C           *LOCK     IN   DNATN                                     S01486
419700200610     C                     MOVE FNATN     NATN    50                      S01486
419800200610     C                     MOVE FNATN     ZZWK05  50                      S01486
419900200610     C                     ADD  1         ZZWK05                          S01486
420000200610     C                     MOVE ZZWK05    FNATN                           S01486
420100200610     C                     OUT  DNATN                                     S01486
420200200610     C                     ENDSR                           ** ZTNLU1 ESR**S01486
420300200610     C***************************************************************     S01486
420400200610     C/COPY WNCPYSRC,SE2390C023
420500200610     C*****************************************************************
420600200610      /EJECT                                                              S01512
420700200610     C/COPY ZSRSRC,ZACCH                                                  S01512
420800200610      /EJECT                                                              E20972
420900200610     C/COPY ZSRSRC,ZCNSDZ1                                                E20972
421000200610      /EJECT                                                              S01509
421100200610     C/COPY ZSRSRC,ZCONVZ1                                                S01509
421200200610      /EJECT                                                              S01512
421300200610     C/COPY ZSRSRC,ZFWDT                                                  S01512
421400200610      /EJECT
421500200610     C/COPY ZSRSRC,ZHASHZ3
421600200610      /EJECT
421700200610     C/COPY ZSRSRC,ZICD2Z1
421800200610      /EJECT
421900200610     C/COPY ZSRSRC,ZICDSEZ1
422000200610      /EJECT
422100200610     C/COPY ZSRSRC,ZSYSTMZ1
422200200610      /EJECT
422300200610     C* XRATE subroutine now redundant                                    E23169
422400200610     C**********/COPY ZSRSRC,ZXRATEZ1                                     E23169
422500200610      /EJECT
422600200610      ***
422700200610     C/COPY WNCPYSRC,SE2390C032
422800200610     C***/COPY*ZSRSRC,ZDATE1Z2                                                  AR1001183 AR1001183A
422900200610     C***/COPY*ZSRSRC,ZDAYSZ2                                                   AR1001183 AR1001183A
423000200610     C***/COPY*ZSRSRC,ZDATE2Z4                                                  AR1001183 AR1001183A
423100200610**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
42320020061000000001
42330020061000000010
42340020061000000100
42350020061000001000
42360020061000010000
42370020061000100000
42380020061001000000
42390020061010000000
424000200610**  POWER - Array of powers for currency conversion
4241002006100000001
4242002006100000010
4243002006100000100
4244002006100001000
4245002006100010000
4246002006100100000
4247002006101000000
424800200610**  CPY@
424900200610(c) Finastra International Limited 2001
