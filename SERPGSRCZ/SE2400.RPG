000100200610     H        1
000110200610     F*****************************************************************
000120200610/*STD *  RPGBASE                                                      *
000130200610/*EXI *  TEXT('Midas SE Gen a/c keys posn settles - custs')           *
000140200610/*OVRF*: OVRDBF FILE(SECET) SHARE(*NO)                              : *   S01486
000150200610/*OVRF*: OVRDBF FILE(SEEVNT) TOFILE(SECED) SHARE(*NO)               : *   S01486
000160200610     F*****************************************************************
000170200610     F*                                                               *
000180200610     F*  Midas - Securities Trading Module                            *
000190200610     F*                                                               *
000200200610     F*  SE2400  - GENERATE NEW ACCOUNT KEYS AND POSITION SETTLEMENTS *
000210200610     F*            - CUST POSITIONS                                   *
000220200610     F*                                                               *
000230200610     F*  Function: This program reads through the Security Actions by *
000240200610     F*   (COB)    Security File and for each live Security Action,   *
000250200610     F*            accesses the Customer Positions File. For  each    *
000260200610     F*            Customer Position found for the Security where the *
000270200610     F*            Position Date is before the Action Date, the       *
000280200610     F*            program produces an Account Key and/or a Position  *
000290200610     F*            Settlement as required, (determined by indicators  *
000300200610     F*            on the Security Actions File). Account Keys are    *
000310200610     F*            written to PF/SEKEYD and Position Settlements to   *
000320200610     F*            PF/POSETD. Also, a record is written to PF/MATEXD  *
000330200610     F*            (Matured Security Positions Extract), for each     *
000340200610     F*            Matured Security. In Files PF/SEKEYD and PF/POSETD,*
000350200610     F*            data is written to member CPOSN2, and in PF/MATEXD,*
000360200610     F*            to member CUSTOMER. The Files have been overridden *
000370200610     F*            in the CL.                                        *
000380200610     F*            Position Settlements are generated for these       *
000390200610     F*            Actions: Dividend, Coupon, Part Payment, Mortgage  *
000400200610     F*            Payment, Maturity.                                 *
000410200610     F*                                                               *
000420200610     F*  Called by: SEC0606F - Generate Account Keys and Position     *
000430200610     F*                        Settlements for Customer Positions     *
000440200610     F*                        (which have not changed today and have *
000450200610     F*                        security actions due)                  *
000460200616     F*                                                               *
000470200610     F*  Calls: ZACCRC - Calculate Interest - Customer Positions      *
000480200610     F*                                                               *
000490200610      *  (c) Finastra International Limited 2001                      *
000500200610      *                                                               *
000501200616      *  Last Amend No. AR324886           Date 01JUN20               *
000510200616      *  PREV Amend No. 248698             Date 01Jun20               *
000520200616      *                 248184             Date 01Jun20               *
000530200610      *                 263929             Date 01Jun20               *
000540200610      *                 MD052583           Date 22Jan19               *
000550200610      *                 MD046248           Date 27Oct17               *
000560200610      *                 CSE110             Date 06Oct17               *
000570200610      *                 260331             Date 31Mar16               *
000580200610      *                 215959             Date 21Mar16               *
000590200610      *                 226449             Date 24Jun15               *
000600200610      *                 AR1067108          Date 11Dec12               *
000610200610      *                 AR1001183A         Date 20Nov12               *
000620200610      *                 CLE134             Date 01Aug12               *
000630200610      *                 CLE148             Date 23Jul12               *
000640200610      *                 AR1001183          Date 14Jul12               *
000650200610      *                 251950A            Date 27Feb12               *
000660200610      *                 AR888911           Date 26Jan12               *
000670200610      *                 AR864714B          Date 28Mar12               *
000680200610      *                 AR877365           Date 13Jan12               *
000690200610      *                 AR875302           Date 09Jan12               *
000700200610      *                 AR877352           Date 21Dec11               *
000710200610      *                 AR879983           Date 21Dec11               *
000720200610      *                 AR853119           Date 24Nov11               *
000730200610      *                 CSW210             Date 04May10               *
000740200610      *                 BUG26839           Date 05Jan10               *
000750200610      *                 CER054             Date 07Apr09               *
000760200610      *                 BUG23123           Date 09Mar09               *
000770200610      *                 BUG22911           Date 17Feb09               *
000780200610      *                 CER048             Date 19May08               *
000790200610      *                 CER043             Date 19May08               *
000800200610      * Bank Fusion Midas 1.4 Base -----------------------------------*
000810200610      * Midas Plus 1.4 Base 04 ---------------------------------------*
000820200610      * Midas Plus 1.4 Base ------------------------------------------*
000830200610      *                 219566             Date 08Feb07               *
000840200610      * Midas Plus 1.3 ----------- Base ------------------------------*
000850200610      *                 219688             Date 11Oct06               *
000860200610      *                 CSD027A            Date 11May06               *
000870200610      *                 CSD027             Date 09Dec05               *
000880200610      *                 BUG11104A          Date 14Jun06               *
000890200610      *                 BUG11198           Date 26Apr06               *
000900200610      *                 BUG11104           Date 25Apr06               *
000910200610      *                 BUG11164           Date 06Apr06               *
000920200610      *                 236137             Date 20Sep05               *
000930200610      *                 236480             Date 24Oct05               *
000940200610      *                 234813             Date 14Jul05               *
000950200610      *                 234577             Date 29Jun05               *
000960200610      *                 234552             Date 28Jun05               *
000970200610      *                 236816             Date 28Jun05               *
000980200610      *                 236815             Date 28Jun05               *
000990200610      *                 236696             Date 27Jun05               *
001000200610      *                 234440             Date 24Jun05               *
001010200610      *                 234406             Date 23Jun05               *
001020200610      *                 233792             Date 30May05               *
001030200610      *                 233615             Date 16May05               *
001040200610      *                 233709             Date 07Jun05               *
001050200610      *                 233863             Date 01Jun05               *
001060200610      *                 233568             Date 19May05               *
001070200610      *                 233567             Date 19May05               *
001080200610      *                 232543             Date 16Mar04               *
001090200610      *                 CGL035             Date 01Mar05               *
001100200610      *                 CGL031             Date 05Jul04               *
001110200610      *                 CSE071             Date 19Jul05               *
001120200610      *                 BUG3122            Date 17Jul04               *
001130200610      *                 CLE025             Date 20Oct03               *
001140200610      *                 CGL029             Date 01Sep03               *
001150200610      *                 194370             Date 12Jul01               *
001160200610      *                 211407             Date 07Jan03               *
001170200610      *                 180056             Date 18Oct00               *
001180200610      *                 CSE037             Date 29Apr02               *
001190200610      *                 CSE035             Date 22Apr02               *
001200200610      *                 CGL020             Date 12Dec02               *
001210200610      *                 206316             Date 19Jul02               *
001220200610      * Midas Release 4.01.02 ----------------------------------------*
001230200610      *                 192467             Date 26Jul01               *
001240200610      *                 194195             Date 15Apr02               *
001250200610      * Midas Release 4.01 -------------------------------------------*
001260200610      *                 CSE034             Date 18Apr02               *
001270200610      *                 CSE031             Date 09Nov01               *
001280200610      *                 180707             Date 25Jul00               *
001290200610      *                 136297             Date 07Feb02               *
001300200610      * Midas Release 4 --------------- Base -------------------------*
001310200610      *                 CSE028             Date 06Jun01               *
001320200610      *                 CSE026             Date 17Jan01               *
001330200610      *                 171874             Date 26Jun01               *
001340200610      *                 192099             Date 19Jun01               *
001350200610      *                 CSE026             Date 17Jan01               *
001360200610      * Midas DBA 3.05 -----------------------------------------------*
001370200610      *                 189942             Date 14Feb01               *
001380200610      *                 133844             Date 24Apr98               *
001390200610      *                 187805             Date 18Dec00               *
001400200610      * Midas DBA 3.04 -----------------------------------------------*
001410200610      *                 187183             Date 01Dec00               *
001420200610      *                 CSE023             Date 30Aug00               *
001430200610      *                 182952             Date 08Nov00               *
001440200610      * Midas DBA 3.03 -----------------------------------------------*
001450200610     F*                 175400             Date 05Jun00               *
001460200610     F*                 162208             Date 23Jul99               *
001470200610     F*                 131379             Date 27Mar00               *  *
001480200610      * Midas DBA 3.02 -----------------------------------------------*
001490200610     F*                 CPB001             DATE 05Aug99               *
001500200610      * Midas DBA 3.00 ---------------- Base -------------------------*
001510200610     F*                 130862             Date 18Oct98               *  *
001520200610      *                 151945             DATE 06Jan99               *
001530200610     F*                 147514             Date 20Nov98               *
001540200610     F*                 147869             Date 19NOV98               *
001550200610     F*                 143690             Date 05Oct98               *  *
001560200610     F*                 CEU005             Date 04Feb98               *  *
001570200610     F*                 121921             DATE 24FEB98               *  *
001580200610     F*                 105035             DATE 24FEB98               *  *
001590200610     F*                 095066             DATE 19FEB98               *  *
001600200610     F*                 114458             DATE 03FEB98               *  *
001610200610     F*                 CSE005             DATE 04FEB97               *  *
001620200610     F*                 099266             Date 02Jan97               *  *
001630200610     F*                 111923             Date 16Dec96               *
001640200610     F*                 111922             Date 16Dec96               *
001650200610     F*                 CAC002             Date 15Sep96               *
001660200610     F*                 S10408             Date 02Sep96               *  *
001670200610     F*                 102708             Date 02Aug96               *
001680200610     F*                 097890             DATE 22JUL96               *
001690200610     F*                 101317             DATE 18JUL96               *
001700200610     F*                 094839             DATE 16JUL96               *
001710200610     F*                 074380             DATE 28MAY96               *
001720200610     F*                 103361             DATE 28MAY96               *
001730200610     F*                 103017             DATE 09MAY96               *
001740200610     F*                 103011             DATE 09MAY96               *
001750200610     F*                 046500             DATE 02MAY96               *
001760200610     F*                 033988             DATE 01MAY96               *
001770200610     F*                 100017             DATE 18APR96               *
001780200610     F*                 095548             DATE 17JAN96               *
001790200610     F*                 093385             DATE 11OCT95               *
001800200610     F*                 093827             DATE 10OCT95               *
001810200610     F*                 093817             DATE 09OCT95               *
001820200610     F*                 092961             DATE 04OCT95               *
001830200610     F*                 094229             DATE 18OCT95               *
001840200610     F*                 094748             DATE 16OCT95               *
001850200610     F*                 088423             DATE 16JUN95               *
001860200610     F*                 086491             DATE 15JUN95               *
001870200610     F*                 087712             DATE 15JUN95               *
001880200610     F*                 087178             DATE 15JUN95               *
001890200610     F*                 084669             DATE 06JUN95               *
001900200610     F*                 081239             DATE 01FEB95               *
001910200610     F*                 080741             DATE 23JAN95               *
001920200610     F*                 081439             DATE 10JAN95               *
001930200610     F*                 081336             DATE 09JAN95               *
001940200610     F*                 081383             DATE 19DEC94               *
001950200610     F*                 S01486             DATE 22NOV94               *
001960200610     F*                 S01496  JSV        DATE 07OCT94               *
001970200610     F*                 S01446             DATE 28OCT94               *
001980200610     F*                 S01519             DATE 10AUG94               *
001990200610     F*                 S01512             DATE 10AUG94               *
002000200610     F*                 S01510             DATE 10AUG94               *
002010200610     F*                 S01509             DATE 10AUG94               *
002020200610     F*                 063199             DATE 25JUL94               *
002030200610     F*                 065301             DATE 06MAY94               *
002040200610     F*                 066777             DATE 26FEB94               *
002050200610     F*                 048612             DATE 08FEB94               *
002060200610     F*                 S01447             DATE 08NOV93               *
002070200610     F*                 054257             DATE 25NOV93               *
002080200610     F*                 052254             DATE 25NOV93               *
002090200610     F*                 051107             DATE 25NOV93               *
002100200610     F*                 S01401             DATE 16JUN93               *
002110200610     F*                 S01397             DATE 10SEP92               *
002120200610     F*                 E37528             DATE 30MAR92               *
002130200610     F*                 E37289             DATE 25MAR92               *
002140200610     F*                 E36391             DATE 17MAR92               *
002150200610     F*                 E37051             DATE 16MAR92               *
002160200610     F*                 E33032             DATE 10DEC91               *
002170200610     F*                 E29170             DATE 07NOV91               *
002180200610     F*                 S01117             DATE 23MAY91               *
002190200610     F*                 E24422             DATE 23JAN91               *
002200200610     F*                 S01269             DATE 31JUL90               *
002210200610     F*                 E23807             DATE 02OCT90               *
002220200610     F*                 E23169             DATE 02OCT90               *
002230200610     F*                 E22638             DATE 31JUL90               *
002240200610     F*                 E21573             DATE 26JUN90               *
002250200610     F*                 E21715             DATE 20JUN90               *
002260200610     F*                 E21138             DATE 15FEB90               *
002270200610     F*                 E19610             DATE 06DEC89               *
002280200610     F*                 E20016             DATE 04DEC89               *
002290200610     F*                 E19975             DATE 23NOV89               *
002300200610     F*                 E20151             DATE 10NOV89               *
002310200610     F*                 E20086             DATE 09NOV89               *
002320200610     F*                 E16085             DATE 25AUG89               *
002330200610     F*                 E18803             DATE 17AUG89               *
002340200610     F*                 E18221             DATE 15AUG89               *
002350200610     F*                 E16772             DATE 31/05/89              *
002360200610     F*                 E16815             DATE 08/02/89              *
002370200610     F*                 E15696             DATE 20/10/88              *
002380200610     F*                 E15549             DATE 05/10/88              *
002390200610     F*                 E14704             DATE 29/09/88              *
002400200610     F*                 E14236             DATE 12/09/88              *
002410200610     F*                 E14716             DATE 07/09/88              *
002420200610     F*                 E14703             DATE 18/08/88              *
002430200610     F*                 E14718             DATE 17/08/88              *
002440200610     F*                 E14522             DATE 08/08/88              *
002450200610     F*                 E14506             DATE 04/08/88              *
002460200610     F*                 E14438             DATE 27/07/88              *
002470200610     F*                 E13817             DATE 22/06/88              *
002480200610     F*                                                               *
002490200610     F*---------------------------------------------------------------*
002500200610     F*                                                               *
002501200616      *  AR324886 - Implement 4-eyes processing in Position           *
002502200616      *             Settlement Maintenance.                           *
002510200610      *  248698 - Rounding discrepancies on some SE reports. Applied  *
002520200610      *           fix 228682.                                         *
002530200610      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
002540200610      *  248184 - Wrong security withholding tax calculation.  If     *
002550200610      *           S01496, use 4 dec places for tax rate else use 2.   *
002560200610      *  263929 - Maturity position settlement with 0 nominal         *
002570200610      *           position and 0 amount due was generated.            *
002580200610      *           Applied fix of 238137. Does not include reopen fix. *
002590200610      *           Check if Amount Due is zero for none-generation of  *
002600200610      *           record.                                             *
002610200610      *           Do not write maturity position settlement for PM    *
002620200610      *           customer having a position of zero.                 *
002630200610      *  MD052583 - Reinstate deleted fixes CSE110                    *
002640200610      *  MD046248 - Finastra Rebranding                               *
002650200610      *  CSE110 - Condition Output of Partly Paid Account Key on      *
002660200610      *           Position Settlement.                                *
002670200610      *  260331 - Incorrect posting created due to a deleted diary    *
002680200610      *           event. Applied fix 255857.                          *
002690200610      *         - Applied for MD-37742.                               *
002700200610      *  215959 - Truncation error on event amount in SE2450P3.       *
002710200610      *           Recompiled due to changes in PF/SEKEYD.             *
002720200610      *         - Applied for MD-37439.                               *
002730200610      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
002740200610      *         - Applied for MD034387.                               *
002750200610      *  AR1067108 - PMC1140 Component failed during Clean COB        *
002760200610      *              Applied fix AR1001183A                           *
002770200610      *  AR1001183A - Coupon rate was still used in computation of    *
002780200610      *              interest instead of using the details in FRN tab *
002790200610      *              (Reopen)                                         *
002800200610      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
002810200610      *  CLE148 - Alpha Loan Reference (Recompile)                    *
002820200610      *  AR1001183 - Coupon rate was still used in computation of     *
002830200610      *              interest instead of using the details in FRN tab *
002840200610      *  251950A - Component SEC1112 0001 terminated abnormally.      *
002850200610      *            Check if PSEB is blank, if it is move value of     *
002860200610      *            PBCA to CCTA, if not move value of PSEB to CCTA.   *
002870200610      *          - Applied for AR964313 (Child:AR964316)              *
002880200610      *  AR888911 - In reversing a deal, REV column in Stamp Tax      *
002890200610      *             Movements Enquiry is not changing from N to Y     *
002900200610      *             (Recompile)                                       *
002910200610      *           - Applied for AR944923                              *
002920200610      *  AR864714B - No movement is posted in Stamp Tax Movement      *
002930200610      *              enquiry for Position Settlements                 *
002940200610      *            - Applied for AR942839                             *
002950200610      *  AR877365 - Duplicate position settlement generated           *
002960200610      *             Patterned after fixes 212074 (POST - Duplicate    *
002970200610      *             generated for one dividend payment) and 218122    *
002980200610      *             (CPOSND - Matured security position stays with    *
002990200610      *             reci = 'D')                                       *
003000200610      *  AR875302 - Position settlement generated calculates Stamp    *
003010200610      *             Tax even when it is not stamp tax liable          *
003020200610      *  AR877352 - System did not default values for charges and     *
003030200610      *             commission code/amount                            *
003040200610      *  AR879983 - Add stamp tax exchange rate (Recompile)           *
003050200610      *  AR853119 - Position settlements generated from corporate     *
003060200610      *             action did not calculate stamp tax.               *
003070200610      *  CSW210 - SWIFT 2010 Changes                                  *
003080200610      *  CER054 - German Features - Church Tax (Recompile)            *
003090200610      *  BUG23123 - Report: Does not show Retail Account Number       *
003100200610      *                     Date is not Midas Standard Date           *
003110200610      *                     Period should be actual int. calc. period *
003120200610      *                     Secondary Tax amount is not printed       *
003130200610      *                     Added field TSSLID                        *
003140200610      *                     (Recompile)                               *
003150200610      *  BUG22911 - Changes for Correct Tax Calculation               *
003160200610      *  CER048 - German Features - Taxes                             *
003170200610      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
003180200610      *           (Recompile)                                         *
003190200610      *  219566 - Default the settlement account if no account for    *
003200200610      *           the specified portfolio. This is a LUX local fix    *
003210200610      *           so conditioned in core using new system value       *
003220200610      *           "UseDefaultSettAccnt" in SDSVALPD.                  *
003230200610      *  219688 - Settlement account not correctly retrieved          *
003240200610      *           If the customer is a portfolio one, access first    *
003250200610      *           with the account code defined as settlement in      *
003260200610      *           SDSECSPD. If not found use the PMACCNL0 account.    *
003270200610      *  CSD027A - Conversion Of Customer Number to Alpha             *
003280200610      *  CSD027 - Conversion Of Customer Number to Alpha              *
003290200610      *  BUG11104A - Customer position do not balance. Applied        *
003300200610      *              169173, 177328.                                  *
003310200610      *  BUG11198 - Incorrect due amount on position settlement.      *
003320200610      *  BUG11104 - Customer position do not balance. If ex-coupon    *
003330200610      *             trade was inserted and dividend event has occured *
003340200610      *             reset ex-coupon nominal. Applied 197652.          *
003350200610      *  BUG11164 - A Serious Midas Error on SETRAD insert/amend      *
003360200610      *  236137 - Change Control for CGL031 Parts 4 & 5.              *
003370200610      *           Several changes in the Taxation of Savings Income   *
003380200610      *           functionality.                                      *
003390200610      *           - De Minimis Rules consideration.                   *
003400200610      *           - Taxable Amount of Amortized Discount basis        *
003410200610      *           consideration.                                      *
003420200610      *           - Amortized Premium deduction consideration.        *
003430200610      *  236480 - EU tax wrong on coupon when security position       *
003440200610      *           kept by 2 custodians.                               *
003450200610      *  234813 - Field UTXRSR must be used instead of S1RASO to      *
003460200610      *           calculate the EU Tax.                               *
003470200610      *  234577 - Dividends must check diary tax indicator            *
003480200610      *  234552 - Tax not calculated                                  *
003490200610      *  236816 - Incorrect tax if portolio positions used            *
003500200610      *  236815 - Purchased interest no included in tax calculation   *
003510200610      *           Local tax not deducted. No EU tax at maturity       *
003520200610      *  236696 - @@TOTO must be used instead of @@TOTI to deduct the *
003530200610      *           local tax                                           *
003540200610      *  234406 - No tax were calculated for position settlements     *
003550200610      *           PAMD field has been renamed to WPAMD in MORTAX subr.*
003560200610      *  234440 - Use new file ETCPOSND for average price, average    *
003570200610      *           fiscal price, purchased interest etc                *
003580200610      *         - Change Control 1 Part 4 - For Switzerland only,     *
003590200610      *           bonds at at a discount will have their fiscal price *
003600200610      *           calculated on a yield curve, and funds will not     *
003610200610      *           take into account the profit on a sale when deciding*
003620200610      *           the tax amount - THE LATTER PART HAS BEEN INSERTED  *
003630200610      *           AND THEN REMOVED AGAIN                              *
003640200610      *  233792 - Database error 55 in SE2400 - EUTAX                 *
003650200610      *  233615 - Takeon programs for CGL031 (Recompile)              *
003660200610      *  233709 - The tax must be calculated prorata temporis between *
003670200610      *           the effective date and the event date               *
003680200610      *           The customer income must be generated in SE2300     *
003690200610      *           after the position settlements authorisation        *
003700200610      *           The EUSD tax account keys must be generated in      *
003710200610      *           SE2300                                              *
003720200610      *  233863 - In case of coupon position settlement, the tax      *
003730200610      *           must be accessed with the coupon date instead of the*
003740200610      *           current run date                                    *
003750200610      *  233568 - Nominal currency must be used                       *
003760200610      *  233567 - Wrong average fiscal price                          *
003770200610      *  232543 - Fix to CGL031                                       *
003780200610      *  CGL035 - EUSD Upgrade to Midasplus                           *
003790200610      *  CGL031 - Taxation of Savings Income                          *
003800200610      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
003810200610      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
003820200610      *  CLE025 - Credit Lines (Recompile)                            *
003830200610      *  CGL029 - Increase Account Code to 10 digits                  *
003840200610      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
003850200610      *           For securities with divisor basis = '5' and first   *
003860200610      *           coupon date > valuation date (rundate + 1), set     *
003870200610      *           event control date to first coupon date before      *
003880200610      *           processing SR/ZDYYR. This is to ensure that the     *
003890200610      *           correct hypothetical last and next coupon dates are *
003900200610      *           used in deriving the price/yield rate.              *
003910200610      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
003920200610      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
003930200610      *           The change was to call subroutine ZLCD1 instead     *
003940200610      *           of ZLCD in retrieving the PERIOD for NNX processing *
003950200610      *           and ZNCD1 is called instead of ZNCD in retrieving   *
003960200610      *           the WBENCD for NNX processing. Also rewrite tests   *
003970200610      *           for identifying if position is NX,NNX or CUM.       *
003980200610      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
003990200610      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
004000200610      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
004010200610      *  CGL020 - Compliance Watch - Addtl A/C Postings Information   *
004020200610      *  206316 - Recompiled over changed ZLCDZ1.                     *
004030200610      *  192467 - No maturity position settlement was generated.  Set *
004040200610      *           price for records with processing type '1' and      *
004050200610      *           price basis 'U'.                                    *
004060200610      *  194195 - Position settlements in base ccy incorrect when the *
004070200610      *           nominal ccy is an 'IN' ccy and settled in EUR via   *
004080200610      *           the standard settlement instructions (in STDSED).   *
004090200610      *  CSE034 - Standing Settlement Instruction improvements        *
004100200610      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
004110200610      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
004120200610      *  180707 - No Position Settlements generated. Recompile over   *
004130200610      *           changes in /COPY ZNCDZ3.                            *
004140200610      *  136297 - When settlement method 04 and no settlement account *
004150200610      *           defined, prime account number is defaulted ... If   *
004160200610      *           it does not exist, use suspense computer account    *
004170200610      *  CSE028 - Standing Settlement Instructions Enhancement.       *
004180200610      *  171874 - ZAINSH changes - only recompile                     *
004190200610     F*  192099 - Avoid DB Error in file SDPLCSPD at 041 when         *
004200200610     F*           Customer is PB and not PM                           *
004210200610      *  CSE026 - Position Settlement Default Charges by Customer     *
004220200610      *           Group.                                              *
004230200610     F*  189942 - When PM or PB is on, generate the position          *
004240200610     F*           settlements based on file CDEPPD and no more on     *
004250200610     F*           PMCPOSPD.                                           *
004260200610     F*           By this way, the correct portfolio reference and    *
004270200610     F*           the correct branch code will be used.               *
004280200610     F*  133844 - Even if customer is portfolio, access securities    *
004290200610     F*           customer details to check position settlements      *
004300200610     F*           charge group used to calculate default charges and  *
004310200610     F*           commissions                                         *
004320200610      *  187805 - Incorrect position settlement being generated       *
004330200610      *           because field CTYP being corrupted by field in      *
004340200610      *           CLINTCB.                                            *
004350200610     F*  187183 - Problem when output to LDA                          *
004360200610      *  CSE023 - Treaty Withholding Tax                              *
004370200610      *  182952 - Applied part of fix 094970 to suppress dberror17.   *
004380200610      *           (the remainder if the fix - to initialise blank     *
004390200610      *           profit centre - is in core already under CAC002)    *
004400200610     F*  175400 - Security position settlements not picking up the    *
004410200610     F*           security standard settlements if the securit nominal*
004420200610     F*           currency is an 'in' currency and being settled in   *
004430200610     F*           EURO. Remove fix 147869 and fix it differently since*
004440200610     F*           it caused the above problem. Based on 170568.      *
004450200610     F*  162208 - Amended program to move the Market Indicator of     *
004460200610     F*           the security to PMAR field.                         *
004470200610     F*  131379 - Incorrect account key for primary market at maturity*
004480200610     F*  CPB001 - 'Private Banking' Module                            *
004490200610     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
004500200610     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
004510200610     F*  147514 - Position settlement preparations are not taking     *
004520200610     F*           into account the Standard Settlement Instructions.  *
004530200610     F*           Apply fix 143851.  Use *IN88 when chaining to file  *
004540200610     F*           STDSED instead of *IN78 which is already in use.    *
004550200610     F*  147869 - Wrong settlement amount on accounting               *
004560200610     F*  143690 - Incorrect Mult/Div Ind. was being used when EURO    *
004570200610     F*           CCY was involved. Fix is to reverse the M/D ind. if *
004580200610     F*           Nominal CCY is equal to the EURO CCY.               *
004590200610     F*  CEU005 - EMU SE Settlement Ccy Conversion                    *
004600200610     F*  121921 - SEPCCD record is not necessary for zero position    *
004610200610     F*           record at maturity because there is nothing being   *
004620200610     F*           produce.                                            *
004630200610     F*  105035 - VALUE DATE SETUP INCORPORATED AT A WRONG PLACE,     *
004640200610     F*           AT THIS MOMENT , NOMINAL CURRENCY IS STILL BLANK    *
004650200610     F*           ... SO FIRST NEXT DATE IS TAKEN EVEN  IF HOLIDAY IN *
004660200610     F*           IN THE CURRENCY                                     *
004670200610     F*  095066 - Switchable feature introduced to use value date     *
004680200610     F*           position to calculate Dividend Payment, and should  *
004690200610     F*           also include position on Dividend day.              *
004700200610     F*  114458 - DATABASE ERROR IN SDRETLPD.  DO NOT CALL AORETLR0   *
004710200610     F*           IF RETAIL IS NOT SWITCH ON.                         *
004720200610     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
004730200610     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
004740200610     F*  099266 - For dividend with ex-date, wrong position is        *
004750200610     F*           considered : - in CPOSND if portfolio off           *
004760200610     F*                      : - in PMCPOSPD if portfolio on          *
004770200610     F*  111923 - Database error in file CLINT.                       *
004780200610     F*         - Reinstate the code assigning the customer number    *
004790200610     F*           which was removed by core fix 074380.               *
004800200610     F*  111922 - I/O operation was applied to closed file PMACCNL0.  *
004810200610     F*         - Only check the existence of the account in value    *
004820200610     F*           currency if Portfolio management is installed.      *
004830200610     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
004840200610     F*           If Analytical Accounting is available, define the   *
004850200610     F*           profit centre for posting.                          *
004860200610     F*  S10408 - Addition of hooks SE2400CCP4                        *
004870200610     F*         - Addition of hooks SE2400CCP3                        *
004880200610     F*         - Addition of hooks SE2400CCP2                        *
004890200610     F*         - Addition of hooks SE2400CCP1                        *
004900200610     F*         - Addition of hooks SE2400FFP1                        *
004910200610     F*         - Addition of hooks SE2400IIP2                        *
004920200610     F*         - Addition of hooks SE2400IIP1                        *
004930200610     F*  102708 - IF THE CUSTOMER IS PORTFOLIO, USE CUSTOMER REFERENCE*
004940200610     F*           OF PM POSITION FILE TO SETUP THE ACCOUNT KEY        *
004950200610     F*           OTHERWISE POSTINGS ARE ALL GENERATED ON SAME CUSTOMER
004960200610     F*           ACCOUNT
004970200610     F*  097890 - For portfolio customer, if no account exists in     *
004980200610     F*           security custoner, post position settlement to      *
004990200610     F*           suspense account and not to account in customer     *
005000200610     F*           currency or portfolio currency                      *
005010200610     F*  101317 - Coupon payments credited to incorrect account.      *
005020200610     F*           Even if the customer is not portfolio, check if     *
005030200610     F*           account exists in value currency, else WZFOND not   *
005040200610     F*           reset to 'N' and account and settlement details     *
005050200610     F*           from previous portfolio customer used in error.     *
005060200610     F*  094839 - For shares, trading on ex-dividend date not         *
005070200610     F*           considered.  Fix is to check trade date less than   *
005080200610     F*           or equal to SAEXD.                                  *
005090200610     F*  074380 - No check if AUMO is 'Y' because Position Settle-    *
005100200610     F*           ment with Settlement method '04' are posted on the  *
005110200610     F*           Suspense account.                                   *
005120200610     F*  103361 - If settlement method is '04' and settlement account *
005130200610     F*           is blank, retrieve prime account number.            *
005140200610     F*  103017 - Set RECI to 'D' when writing position settlement rec*
005150200610     F*  103011 - The system creates a position settlement MT* for    *
005160200610     F*           warrant which can lead to confusion for cashflow    *
005170200610     F*  046500 - CORRECT FILE OUT OF BALANCE IN COB                  *
005180200610     F*  033988 - WHEN SECURITY MATURED, RECI ON CPOSND IS WRONGLY    *
005190200610     F*           UPDATED TO 'M'.                                     *
005200200610     F*  100017 - Position settlement unable to pick up day adj. on   *
005210200610     F*           SECTYD. Change subroutine to use DADJN to stop      *
005220200610     F*           interest day adjustment being used for amortisation.*
005230200610     F*           Recompile over amended subroutine ZDAYS.            *
005240200610     F*  095548 - Redefine NMCY for SEDEVD1 & SEDEVD2                 *
005250200610     F*  093385 - Dividends not shown in SE0640 after input of DV in  *
005260200610     F*           diary - output correct nominal position for dividend*
005270200610     F*  093827 - SE Holdings positions incorrect in SE0640 - output  *
005280200610     F*           correct nominal position for maturity.              *
005290200610     F*  093817 - If no standard settlement instructions found on     *
005300200610     F*           STDSED, EXSR SR/P07 to determine the settlement     *
005310200610     F*           account to use.                                     *
005320200610     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
005330200610     F*           (Wrong number of days calculated for day basis 1    *
005340200610     F*           when start or end day is last day of February)      *
005350200610     F*  094229 - Calculate settlement amount regardless of S01519    *
005360200610     F*  094748 - Only 1 position settlement produced per security    *
005370200610     F*           event (caused by S01486)                            *
005380200610     F*  088423 - If S01512 is on, event date should no longer be     *
005390200610     F*           payment date                                        *
005400200610     F*  086491 - Wrong nbr of days calculated for day basis 1        *
005410200610     F*           when start or end day is last day of February       *
005420200610     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
005430200610     F*  087712 - Percentage price-based shares have dividend amount  *
005440200610     F*           calculated 100 times too much                       *
005450200610     F*  087178 - Settlement amount has to include taxes added to or  *
005460200610     F*           subtracted from it                                  *
005470200610     F*  084669 - If no standard settlement method defined, settlement*
005480200610     F*           branch must be equal to booking branch              *
005490200610     F*  081239 - R10 Private Banking Rework                          *
005500200610     F*  080741 - Position settlement generated with figures for      *
005510200610     F*           other customers                                     *
005520200610     F*  081439 - Wrong update of field tax rate - Recompile          *
005530200610     F*  081336 - Fix's on upgrade                                    *
005540200610     F*  081383 - Duplicate use of indicator 79 causes pgm loop       *
005550200610     F*  S01486 - Incorporation of PM Enhancements (S01313)           *
005560200610     F*           (Fix's S01313 - R05803                              *
005570200610     F*  S01496 - Incorporation of Jyske Enhancements (S10982, S10984)*
005580200610     F*           Just recompilation.                                 *
005590200610     F*  S01446 - Customer Commissions (Courtage) enhancement:        *
005600200610     F*           Get details of single charge currency (from SE ICD) *
005610200610     F*           for conversion of charge amount to value currency.  *
005620200610     F*  S01519 - Position Settlements Automatic Charges              *
005630200610     F*  S01512 - Add value date to Position Settlements              *
005640200610     F*  S01510 - Dividend Payments based on Ex-date                  *
005650200610     F*  S01509 - Value Currency to be currency of Issuer of Payments *
005660200610     F*  063199 - Program access the Customer Position Profit Centre  *
005670200610     F*           file even when Profit Centres are not used, which   *
005680200610     F*           causes a spurious database error.  Condition the    *
005690200610     F*           access to this file.                                *
005700200610     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
005710200610     F*           with ZAMT increased to 15,0.                        *
005720200610     F*  066777 - Output Last Change Date on new POSETD records.      *
005730200610     F*  048612 - Clear settlement method field before accessing stan-*
005740200610     F*           dard settlements file so that if no record is found,*
005750200610     F*           the value from a previous transaction is not used.  *
005760200610     F*  S01447 - Withholding Tax.                                    *
005770200610     F*           Calculates withholding tax which are written to     *
005780200610     F*           new fields on position settlements file.            *
005790200610     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
005800200610     F*           to 10,9                                             *
005810200610     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
005820200610     F*  051107 - Program ignores Events BEFORE first Action Date. It *
005830200610     F*           should ALSO ignore Events ON the first Action Date  *
005840200610     F*           as they will not be affected, (eg. Coupon).         *
005850200610     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
005860200610     F*           - Position Settlement Message Indicator set to 'Y'  *
005870200610     F*             when Settlement Authorised by System.             *
005880200610     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
005890200610     F*           - Recompiled due to changes to files.               *
005900200610     F*  E37528 - Program recompiled for minor change to Audit Report.*
005910200610     F*  E37289 - Coupon amount on Matured Securities file was wrong  *
005920200610     F*  E36391 - Mortgage repayment amounts on A/C keys and Position *
005930200610     F*           Settlements use a incorrect change in current factor*
005940200610     F*  E37051 - Problems with zoned parameter field CSCN.  This     *
005950200610     F*           appears to be an error in the compiler.  Fix gets   *
005960200610     F*           round the problem                                   *
005970200610     F*  E33032 - Outputting wrong branch field to POSETD             *
005980200610     F*  E29170 - Report Control Facility changes                     *
005990200610     F*  S01117 - Multibranching                                      *
006000200610     F*  E24422 - Remove E16815 - error in DV processing              *
006010200610     F*  S01269 - Trade Authorisation: Recompiled for change to file  *
006020200610     F*           TABSE                                               *
006030200610     F*  E23807 - Record locked by this job  - remove E21715          *
006040200610     F*  E23169 - Settlement exchange rate should be equal to         *
006050200610     F*           exchange (not spot rate) from SECTYD.               *
006060200610     F*           Processing changed to use ZCNSD for accuracy        *
006070200610     F*  E22638 - Dividend due amount being truncated. Use standard   *
006080200610     F*           subroutine ZCNSD to calculate dividend due.         *
006090200610     F*  E21573 - Coupon at Maturity is now produced separately and   *
006100200610     F*           requires a Position Settlement to be generated from *
006110200610     F*           the Coupon Action.                                  *
006120200610     F*  E21715 - Must reset Ex-Coupon/Dividend field after Coupon/   *
006130200610     F*           Dividend Date processing.                           *
006140200610     F*  E21138 - Position Settlement Fixes:                          *
006150200610     F*           1.Amount due at maturity for customers must just be *
006160200610     F*             face value                                        *
006170200610     F*           2.A/C Keys produced when position settlements       *
006180200610     F*             produced and not on event date                    *
006190200610     F*  E19610 - For Shares/Equities use the Trade Date instead of   *
006200200610     F*           Value Date to calculate the Dividend Due.           *
006210200610     F*  E20016 - Use LF/SEDEV instead of SECED as SEDEV now ignores  *
006220200610     F*           records with RECI='C'                               *
006230200610     F*  E19975 - KCUST shouldn't be zeroized before writing          *
006240200610     F*           SEKEYD as  issuer and depot cust nos are needed for *
006250200610     F*           account keys with posting ref 4 and 5.              *
006260200610     F*  E20151 - Amount due at maturity inflated by factor of 100    *
006270200610     F*           for a Yen instrument.                               *
006280200610     F*  E20086 - Mortgage-Backs and Current Factor Processing Rewrite*
006290200610     F*           - Rewrite of SR/MORTPY:                             *
006300200610     F*           - Coupon is produced separately - do not include it *
006310200610     F*             in the MP Amount. (It was wrong anyway).          *
006320200610     F*           - Amount calculation is unnecessarily complicated.  *
006330200610     F*           - Rename NMCY on SEDEVDF instead of moving it back  *
006340200610     F*             and forth all the time.                           *
006350200610     F*  E16085 - TO RESET INVESTMENT TYPE IF DEPOT IS CEDEL AND      *
006360200610     F*           CUSTOMER NOT A MARKET CLIENT.                       *
006370200610     F*           TO SUPPRESS BOOK CODE IN ACCOUNT KEYS FOR           *
006380200610     F*           CHARGES AND COMMISSIONS.                            *
006390200610     F*  E18803 - SET ACCOUNT KEY SEQUENCE NO. TO ZERO TO ALLOW FOR   *
006400200610     F*           MULTI-BRANCH SYSTEMS.                               *
006410200610     F*  E18221 - BLANK CHTP FIELD CAUSING OVERPRINTING IN POS.       *
006420200610     F*           SETTL. AUDIT LIST.                                  *
006430200610     F*  E16772 - The Dividend Payment Amount field SDAU has been     *
006440200610     F*           replaced by the field SDUN, to increase its size    *
006450200610     F*           from 9,4 to 13,8                                    *
006460200610     F*  E16815 - THE POSITION GENERATED FROM A SECURITY DIARY EVENT  *
006470200610     F*           SHOWS INCORRECT AMOUNT FOR DIVIDENDS.               *
006480200610     F*  E15696 - UPDATE DEPOT POSNS ON MATURITY DATE (NOT BEFORE)    *
006490200610     F*  E15549 - FIXES CONNECTED WITH REDELIVERY OF POSITION         *
006500200610     F*           SETTLEMENT PROGRAMS FROM CD.                        *
006510200610     F*           1.LAST COUPON DATE MUST BE FOR 'CURRENT' PERIOD     *
006520200610     F*           2.CURRENCY DECIMAL PLACES NOT SET AT RIGHT TIME     *
006530200610     F*           3.IF POSITION IS PRIOR TO LAST COUPON DATE          *
006540200610     F*             ZEROIZE EX-COUPON NOMINAL                         *
006550200610     F*           4.PROCESS ALL POSITIONS IF SECURITY ACTIONS PRESENT *
006560200610     F*  E14704 - REVERSE SET UP OF PAY RECEIVE INDICATOR.            *
006570200610     F*  E14236 - PROCESS MATURITY CUSTOMER POSITIONS ACTIONS.        *
006580200610     F*  E14716 - EVENT CODE 'MA' CHANGED TO 'MT'                     *
006590200610     F*  E14703 - ONLY WRITE MATURED SECURITY RECORD IF ACCOUNT KEY   *
006600200610     F*           REQUIRED INDICATOR IS 'Y'.                          *
006610200610     F*  E14718 - SET UP BOOK CODE CORRECTLY, USING PORTFOLIO         *
006620200610     F*           BOOK CODE DEFAULT.                                  *
006630200610     F*  E14522 - TEST CONVERTIBLE INDICATOR (POSN 14 IN ACCOUNT      *
006640200610     F*           KEY) CORRECTLY.                                     *
006650200610     F*  E14506 - NO POSITION SETTLEMENTS ARE GENERATED FOR THE NEXT  *
006660200610     F*           DAY.                                                *
006670200610     F*  E14438 - RECOMPILE PROGRAM FOR EUCLID INCORPORATION          *
006680200610     F*           AND UPGRADING OF FILES.                             *
006690200610     F*  E13817 - OUTPUT 'FV' KEY WITH NOM. CURRENCY AND              *
006700200610     F*           NOM. DECIMAL PLACES.                                *
006710200610     F*                                                               *
006720200610     F*****************************************************************
006730200610     F*
006740200610     FSECACA  IF  E                    DISK
006750200610     F***PMFPSNLLIF  E           K        DISK                 UC  S01486 189942
006760200610     F***PMCPSSLLIF  E           K        DISK                 UC  S01486 189942
006770200610     F***PMAPOSLLIF  E           K        DISK                 UC  S01486 189942
006780200610     FSECDEPL0IF  E           K        DISK                               189942
006790200610     F            CDEPPDF                           KRENAMECDEPP0         189942
006800200610     FCDEPS   IF  E           K        DISK                               189942
006810200610     F            CDEPPDF                           KRENAMECDEPPS         189942
006820200610     FSECDEPL5IF  E           K        DISK                               189942
006830200610     F            CDEPPDF                           KRENAMECDEPP5         189942
006840200610     FPOSETA  O   E                    DISK         KINFDS POSADS
006850200610     F                                              KINFSR POSASR
006860200610     FMATEXA  UF  E                    DISK         KINFDS MATADS
006870200610     F                                              KINFSR MATASR
006880200610     FSEKEYA  O   E                    DISK         KINFDS SEKADS
006890200610     F                                              KINFSR SEKASR
006900200610     FCLINT   IF  E           K        DISK
006910200610     F            CLINTCAF                          KIGNORE
006920200610     F            CLINTCCF                          KIGNORE
006930200610     F            CLINTC1F                          KIGNORE
006940200610     F*********** CLINTSEF                          KIGNORE               S01447
006950200610     F************CLINTCBF                          KIGNORE               S01447
006960200610     FTABSE   IF  E           K        DISK
006970200610     F* ICD 1     TABTB10F                          KIGNORE
006980200610     F* ICD 2     TABTB11F                          KIGNORE
006990200610     F*           TABTB36F                          KIGNORE
007000200610     F            TABTB40F                          KIGNORE
007010200610     F** CRCY     TABTG10F                          KIGNORE
007020200610     F            TABTG20F                          KIGNORE
007030200610     F            TABLETHF                          KIGNORE
007040200610     F*********** TABLETJF                          KIGNORE               S01117
007050200610     F            TABLETLF                          KIGNORE
007060200610     F            TABLETRF                          KIGNORE
007070200610     F            TABLETXF                          KIGNORE
007080200610     F            TABLET2F                          KIGNORE
007090200610     F            TABLET3F                          KIGNORE
007100200610     F            TABLET5F                          KIGNORE
007110200610     F            TABTE10F                          KIGNORE
007120200610     F            TABLETNF                          KIGNORE
007130200610     F            TABLETKF                          KIGNORE
007140200610     F            TABLETPF                          KIGNORE
007150200610     F            TABLETAF                          KIGNORE
007160200610     F            TABTE20F                          KIGNORE
007170200610     FSE2400AUO   E                    PRINTER
007180200610     FSECTY   IF  E           K        DISK
007190200610     FSESWHTL0IF  E           K        DISK                               S01447
007200200610     F* Securities WHT details file                                       S01447
007210200610     F***********SECED   IF  E           K        DISK                    E20016
007220200610     FSEDEV   IF  E           K        DISK                               E20016
007230200610     F* RECORD ID PN                                                      S01486
007240200610     FPMPORTPDIF  E           K        DISK                           UC  S01486
007250200610     F*                                                                   S01486
007260200610     FSECET   IF  E           K        DISK                           UC  S01486
007270200610     F            SEDEVDF                           KRENAMESEDEVD1        S01486
007280200610     F*                                                                   S01486
007290200610     FSEEVNT  IF  E           K        DISK                           UC  S01486
007300200610     F            SNDEVDF                           KRENAMESNDEVD2        S01486
007310200610     F            SEDEVDF                           KRENAMESEDEVD2        S01486
007320200610     F*                                                                   S01486
007330200610     F**   ACCOUNT DETAILS                                                S01486
007340200610     FPMACCNL0IF  E           K        DISK                           UC  S01486
007350200610     F*                                                                   S01486
007360200610     FPMACCNL1IF  E           K        DISK                           UC  219688
007370200610     F            ACCNTABF                          KRENAMEACCNTL1F       219688
007380200610     F*                                                                   219688
007390200610     FSDCURRL0IF  E           K        DISK                               081336
007400200610     FSECEO   IF  E           K        DISK                               E36391
007410200610     F            SEDEVDF                           KRENAMESEDEVDO        E36391
007420200610     F            SNDEVDF                           KRENAMESNDEVDO        E36391
007430200610     FSEPCCD  IF  E           K        DISK                               S01117
007440200610     FINVTP   IF  E           K        DISK
007450200610     FSTDSED  IF  E           K        DISK
007460200610     FSECAC   IF  E           K        DISK
007470200610     F*CPOSH***IF**E           K        DISK                              E21715
007480200610     F*CPOSH***UF**E           K        DISK                       E21715 E23807
007490200610     FCPOSH   IF  E           K        DISK                               E23807
007500200610     F            CPOSNDF                           KRENAMECPOSNDFH
007510200610     F*POSS***IF**E           K        DISK                               E14236
007520200610     FSECGT   IF  E           K        DISK                               S01519
007530200610     F** Charge/commissions Rates Table.                                  S01519
007540200610     FSEDFTCL2IF  E           K        DISK                               S01519
007550200610     F** Default charges table.                                           S01519
007560200610     FSEDFGRL0IF  E           K        DISK                           UC  CSE026
007570200610     F            SEDFTCD0                          KRENAMESEDFTGD0       CSE026
007580200610     FCPOSS   UF  E           K        DISK                               E14236
007590200610     F            DPOSNDF                           KIGNORE
007600200610     FSEKEYD  O   E           K        DISK         KINFDS SEKDDS
007610200610     F                                              KINFSR SEKDSR
007620200610     FPOSETD  O   E           K        DISK         KINFDS POSDDS
007630200610     F                                              KINFSR POSDSR
007631200616     FPSAUTD  O   E           K        DISK                                                 AR324886
007632200616      ** SE Position Settlement Authorisation detail                                        AR324886
007633200616      *                                                                                     AR324886
007640200610     FSDCUSQL0IF  E           K        DISK                                                 AR853119
007650200610      **  Midas SD Stamp Tax Customer Extension file                                        AR853119
007660200610     FPOSETDX3O   E           K        DISK         KINFSR *PSSR                            AR853119
007670200610      ***  Position Settlements - Extension File                                            AR853119
007680200610     FSDSTMDPDO   E           K        DISK         KINFSR *PSSR                            AR853119
007690200610      **  Midas SD Stamp Tax History Detail file                                            AR853119
007700200610      *                                                                                     AR853119
007710200610     FMATEXD  O   E           K        DISK         KINFDS MATDDS
007720200610     F                                              KINFSR MATDSR
007730200610     FSDBRCHL0IF  E           K        DISK                               136297
007740200610     FTABTB20 IF  E                    DISK                               136297
007750200610     FACCNT   IF  E           K        DISK                               136297
007760200610     F            ACCNTABF                          KRENAMEACCOUNTF       136297
007770200610      ** Midas SD Tax Calculation Method                                                      CGL031
007780200610     FSDTXCML1IF  E           K        DISK         KINFSR *PSSR                              CGL031
007790200610      *                                                                                       CGL031
007800200610      ** Midas SD Joint Account Member                                                        CGL031
007810200610     FSDJACCLBIF  E           K        DISK         KINFSR *PSSR                              CGL031
007820200610      *                                                                                       CGL031
007830200610      ***Midas*SD*Additional*Customer*Details**************************                CGL031 233709
007840200610     F***SDACUSL1IF  E           K        DISK         KINFSR *PSSR                    CGL031 233709
007850200610      *****************************************************************                CGL031 233709
007860200610      ***Midas*SD*Non-Account*Holder***********************************                CGL031 233709
007870200610     F***SDNAHOL1IF  E           K        DISK         KINFSR *PSSR                    CGL031 233709
007880200610      *****************************************************************                CGL031 233709
007890200610      ***Midas*SD*Customer*Income**************************************                CGL031 233709
007900200610     F***SDCSINPDO   E           K        DISK         KINFSR *PSSR                    CGL031 233709
007910200610      *                                                                   S01408
007920200610     F/COPY WNCPYSRC,SE2400FFP1                                           S01408
007930200610      *                                                                   S01408
007940200610      /EJECT
007950200610     F*****************************************************************
007960200610     F*                                                               *
007970200610     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
007980200610     F*                                                               *
007990200610     F*   29 - DIFFERENCE MESSAGE IS PRINTED                          *
008000200610      *   40 - Set on when S01496 and Autocharge flag on ICD are ON.  *   CSE026
008010200610     F*   44 - END OF RELEVANT RECORDS ON CPOSH                       *   E21715
008020200610     F*   54 - CUSTOMER RECORD READ IN (FORMAT CLINTCB)               *   S01447
008030200610     F*   60 - CURRENCY REQUIRES 0 DEC PLACES FOR CALCS               *
008040200610     F*   61 - CURRENCY REQUIRES 1 DEC PLACES FOR CALCS               *
008050200610     F*   62 - CURRENCY REQUIRES 2 DEC PLACES FOR CALCS               *
008060200610     F*   63 - CURRENCY REQUIRES 3 DEC PLACES FOR CALCS               *
008070200610     F*   66 - POSITION READ IS FROM CPOSH                            *   E21715
008080200610     F*   72 - Beginning of file on READP for SEDEVD                  *                     BUG11104
008090200610     F*   74 - READING ALL VALUE DATE PORTFOLIO POSITIONS - PMAPOSLL  *   S01486
008100200610     F*   75 - READING FIRST CUSTOMER POSITION DATES FILE - PMFPSNLL  *   S01486
008110200610     F*   76 - READING CURRENT POSITIONS BY SECURITY FILE - PMCPSSLL  *   S01486
008120200610     F*   77 - END OF FILE ON READE OR RECORD EXISTS ON SETLL         *
008130200610     F*   78 - CHAIN OF STDSED FOR SETTLEMENT DETAILS                 *   CEU005
008140200610     F*   79 - END OF CUST DEPOT POSITIONS FOR THIS SECURITY          *
008150200610     F*   80 - SECURITY WHT RECORD READ IN                            *   S01447
008160200610     F*   89 - END OF SECURITY ACTIONS FILE - STD REPORT AND END      *
008170200610     F*   87 - EXCEPTION ERROR ON UPDATED FILE - PRINTS STATUS/AUDIT  *
008180200610     F*   88 - Chain indicator for STDSED                             *   147514
008190200610     F*                                                               *
008200200610     F*90-99 - USED IN Z SUBROUTINES                                  *
008210200610     F*                                                               *
008220200610     F*   U7 - DATABASE ERROR                                         *
008230200610     F*   U8 - DATABASE ERROR                                         *
008240200610     F*                                                               *
008250200610     F*****************************************************************
008260200610      /EJECT
008270200610     F*****************************************************************
008280200610     F*                                                               *
008290200610     F*  S U B R O U T I N E   I N D E X                              *
008300200610     F*                                                               *
008310200610     F*   GETCTY-  Get Country of Branch                              *   S01447
008320200610     F*   FIRST  - ACCESSES ICD INFORMATION                           *
008330200610     F*   GETDEP - OBTAIN LATEST CORRECT CUST/DEPOT POSITION DATE     *
008340200610     F*   DIVIND - PRODUCE DIVIDEND A/C KEY &/OR POSITION SETTLEMENT  *
008350200610     F*   COUPON - PRODUCE COUPON A/C KEY &/OR POSITION SETTLEMENT    *
008360200610     F*   PARTPY - PRODUCE PART PAYMENT POSITION SETTLEMENT           *
008370200610     F*   MORTPY - PRODUCE MORTGAGE PAYMENT POSITION SETTLEMENT       *
008380200610     F*   MATURE - PRODUCE MATURITY POSITION SETTLEMENT               *
008390200610     F*   W01    - WRITE ACCOUNT KEY                                  *
008400200610     F*   W02    - WRITE POSITION SETTLEMENT                          *
008410200610     F*   P04    - CALCULATE THE DEFAULT CHARGE/COMMISSION AMOUNT     *   S01519
008420200610     F*   P05    - CALCULATE DEFAULT AMOUNTS                          *   S01519
008430200610     F*   P06    - CALCULATE SETTLEMENT AMOUNT                        *   S01519
008440200610     F*   CALAMT - DETERMINE IF AMOUNTS NEED TO BE CALCULATED FOR     *   S01519
008450200610     F*            CHARGES                                            *   S01519
008460200610     F*   CALAM2 - CALCULATE CHARGE AMOUNTS                           *   S01519
008470200610     F*   CALCTX - Calculate tax amounts for dividends/Coupons        *   S01447
008480200610     F*   CHKTAX - Check if record is existing in SDCTTXPD for taxing *                       CGL031
008490200610     F*   CPNTAX - Calculate tax for descretionary and Safe           *                       CGL031
008500200610     F*            Custody Customers for Coupon                       *                       CGL031
008510200610     F*   DIVTAX - Calculate tax for descretionary and Safe           *                       CGL031
008520200610     F*            Custody Customers for Dividends                    *                       CGL031
008530200610     F*   MATTAX - Calculate tax for descretionary and Safe           *                       CGL031
008540200610     F*            Custody Customers for Mature                       *                       CGL031
008550200610     F*   MORTAX - Calculate tax for descretionary and Safe           *                       CGL031
008560200610     F*            Custody Customers for Mortgage                     *                       CGL031
008570200610     F*   CPTXCL - Calculate tax amount for the Coupon and to Output  *                       CGL031
008580200610     F*            Information on SDCSINPD                            *                       CGL031
008590200610     F*   DVTXCL - Calculate tax amount for the Dividend and to Output*                       CGL031
008600200610     F*            Information on SDCSINPD                            *                       CGL031
008610200610     F*   MATXCL - Calculate tax amount for the Maturity or Early     *                       CGL031
008620200610     F*            Redemption and to Output Information on SDCSINPD   *                       CGL031
008630200610     F*   MPTXCL - Calculate tax amount for the Mortgage Repayment    *                       CGL031
008640200610     F*            and to Output Information on SDCSINPD              *                       CGL031
008650200610     F****CSINSR*-*Output*Information*on*SDCSINPD**********************                CGL031 233709
008660200610     F*   CSINSR - Calculate Tax Amounts on POSETD                    *                       233709
008670200610     F*   W03    - WRITE MATURED SECURITY POSITIONS EXTRACT           *
008680200610     F*   SECTIN - GET SECURITY DETAIL RECORD IN                      *
008690200610     F*   INVTIN - GET INVESTMENT TYPE DETAIL RECORD IN               *
008700200610     F*   SECEDI - GET SECURITY EVENTS DETAIL RECORD IN               *
008710200610     F*   TG10   - GET TABTG10 RECORD FOR EACH CURRENCY AS REQUIRED   *
008720200610     F*   #LCURR - GET SDCURRPD RECORD FOR EACH CURRENCY AS REQUIRED  *   S01446
008730200610     F*   AUDIT  - OUTPUTS AUDIT RECORD UDEPPA AND CONTROL REPORT     *
008740200610     F*                                                               *
008750200610     F*   SEKDSR - ERROR HANDLING FOR SEKEYD                          *
008760200610     F*   SEKASR - ERROR HANDLING FOR SEKEYA                          *
008770200610     F*   POSDSR - ERROR HANDLING FOR POSETD                          *
008780200610     F*   POSASR - ERROR HANDLING FOR POSETA                          *
008790200610     F*   MATDSR - ERROR HANDLING FOR MATEXD                          *
008800200610     F*   MATASR - ERROR HANDLING FOR MATEXA                          *
008810200610     F*                                                               *
008820200610     F*   ZACCH  - ACCESS RECORD FOR HOLIDAYS FILE                    *   S01512
008830200610     F*   ZFWDT  - FIND WORKING DAYS FORWARD                          *   S01512
008840200610     F*   ZHASH  - HASH TOTALLING STD SUBROUTINE                      *
008850200610     F*   ZICDSE - GET TABTB36 ICD                                    *
008860200610     F*   ZICD2  - GET TABTB11 ICD                                    *
008870200610     F*   ZSYSTM - GET TABTB10 ICD                                    *
008880200610     F***ZXRATE*-*CROSS*REF*EXCHANGE*RATE*CALCULATED**********************E23169
008890200610     F*   ZXRATE - CROSS REF EXCHANGE RATE CALCULATED                 *   S01446
008900200610     F*                                                               *
008910200610     F*   ZACCRC - CALCULATE INTEREST DUE     ** PROGRAM CALL **      *
008920200610     F*   *PSSR  - EXCEPTION ERROR ROUTINE                            *   S01117
008930200610     F*                                                               *
008940200610     F*****************************************************************
008950200610      /EJECT
008960200610     E/COPY ZSRSRC,ZPOWER8Z1
008970200610     E/COPY ZSRSRC,ZPOWERZ1                                               S01509
008980200610     E/COPY ZSRSRC,ZHASHZ1
008990200610     E/COPY ZSRSRC,ZHOLE                                                  S01512
009000200610     E/COPY ZSRSRC,ZCCAL1Z1                                               S01519
009010200610     E/COPY ZSRSRC,ZDAYSZ1                                                S01486
009020200610     E/COPY ZSRSRC,ZDATE2Z1                                               S01486
009030200610     E/COPY ZSRSRC,ZDATE9Z1                                                                   CGL031
009040200610     E                    CPY@    1   1 80
009050200610     E**********          WAD        10  6 0                                    AR1001183 AR1001183A
009060200610     E**********          WBR        10  2 0                                    AR1001183 AR1001183A
009070200610     E**********          WBS        10 11 7                                    AR1001183 AR1001183A
009080200610     E**********          WSI        10  1                                      AR1001183 AR1001183A
009090200610     E**********          WRM        10  7                                      AR1001183 AR1001183A
009100200610     E**********          WRF        10  4                                      AR1001183 AR1001183A
009110200610     E/COPY ZSRSRC,ZACCRZ0                                                S01486
009120200610     E/COPY ZSRSRC,ZNCDZ1                                                 S01486
009130200610     E/COPY WNCPYSRC,SE2400E001
009140200610      /EJECT
009150200610     I*                                                                   033988
009160200610     ISECTYDF                                                             033988
009170200610     I              RECI                            RECIS                 033988
009180200610     I*                                                                   033988
009190200610     ISECACDF                                                             E15549
009200200610     I              LCCP                            SALCCP                E15549
009210200610     ISEDEVDF                                                             E20086
009220200610     I              NMCY                            SNMCY                 E20086
009230200610     I              SETX                            NSETX                 234552
009240200610     ISEDEVDO                                                             E36391
009250200610     I              NMCY                            SNMCY                 E36391
009260200610     I              SETX                            NSETX                 234552
009270200610     ISEDEVD1                                                             095548
009280200610     I              NMCY                            SNMCY                 095548
009290200610     I              SETX                            NSETX                 234552
009300200610     ISEDEVD2                                                             095548
009310200610     I              NMCY                            SNMCY                 095548
009320200610     I              SETX                            NSETX                 234552
009330200610     IACCNTABF                                                            S01486
009340200610     I              PTFR                            RNPTFR                S01486
009350200610     IACCNTL1F                                                            219688
009360200610     I              PTFR                            L1PTFR                219688
009370200610     ISEPCCDF                                                             189942
009380200610     I              PTFR                            PCPTFR                189942
009390200610     ICDEPP0                                                              189942
009400200610     I              RECI                            CDRECI                189942
009410200610     ICDEPPS                                                              189942
009420200610     I              RECI                            CDRECI                189942
009430200610     ICDEPP5                                                              189942
009440200610     I              RECI                            CDRECI                189942
009450200610      *                                                                                       CSE037
009460200610     IINVTPDF                                                                                 CSE037
009470200610     I              RECI                            RECII                                   BUG11104
009480200610     I              SFLG                            ISFLG                                     CSE037
009490200610      *                                                                                       CSE028
009500200610      ** DS for customer/book standard settlement instruction                                 CSE028
009510200610      **  to be passed to SESSIR0                                                             CSE028
009520200610      *                                                                                       CSE028
009530200610     IPCBSTD    E DSSTDSED                    2                                               CSE028
009540200610     I              RECI                            WRECI                                     CSE028
009550200610     I              LCD                             WLCD                                      CSE028
009560200610     I              CHTP                            WCHTP                                     CSE028
009570200610     I              TNLU                            WTNLU                                     CSE028
009580200610      *                                                                                       CSE028
009590200610      ** Data structure for standard additional settlement details                            CSE028
009600200610      ** for customer/book to be passed to SESSIR0                                            CSE028
009610200610      *                                                                                       CSE028
009620200610     IPCBSAD    E DSSTDADSED                  8                                               CSE028
009630200610     I*
009640200610     ITABLKY      DS
009650200610     I*
009660200610     I*  TABTB11 TABLE KEY FIELD DATA STRUCTURE FOR DB ERROR
009670200610     I*
009680200610     I                                        1  12 TABKEY
009690200610     I                                        1   20RECT
009700200610     I                                        3  10 ZZ008
009710200610     I                                       11  120RCDE
009720200610     I*
009730200610     IPOSDDS      DS                            366
009740200610     I*
009750200610     I*  POSITION SETTLEMENTS  FILE ERROR EXCEPTION  DATA STRUCT.
009760200610     I*
009770200610     I                                     *STATUS  STSPSD
009780200610     I*
009790200610     ISEKDDS      DS                            366
009800200610     I*
009810200610     I*  GENERATED ACCOUNT KEYS FILE ERROR EXCEPTION  DATA STRUCT.
009820200610     I*
009830200610     I                                     *STATUS  STSSKD
009840200610     I*
009850200610     IPOSADS      DS                            366
009860200610     I*
009870200610     I*  POSITION SETTLEMENTS  AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
009880200610     I*
009890200610     I                                     *STATUS  STSPSA
009900200610     I*
009910200610     IMATDDS      DS                            366
009920200610     I*
009930200610     I*  MATURED SECURITY EXTRACT FILE ERROR EXCEPTION  DATA STRUCT.
009940200610     I*
009950200610     I                                     *STATUS  STSMTD
009960200610     I*
009970200610     IMATADS      DS                            366
009980200610     I*
009990200610     I* MATURED SECURITY EXTRACT AUDIT FILE ERROR EXCEPTION DATA STRUCT
010000200610     I*
010010200610     I                                     *STATUS  STSMTA
010020200610     I*
010030200610     ISEKADS      DS                            366
010040200610     I*
010050200610     I* GENERATED ACCOUNT KEYS AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
010060200610     I*
010070200610     I                                     *STATUS  STSSKA
010080200610     I*    MIDAS 'Next Available Transaction No.' Data Area  MNATN .      S01486
010090200610     IDNATN       DS                              5                       S01486
010100200610     I                                        1   50FNATN                 S01486
010110200610     I/COPY ZSRSRC,ZHASHZ2
010120200610     I/COPY ZSRSRC,ZNCDZ2                                                 S01486
010130200610     I/COPY ZSRSRC,ZDATE9Z2                                                                   CGL031
010140200610     I*
010150200610     IWACKEY      DS
010160200610     I*
010170200610     I* ACCOUNT KEY DATA STRUCTURE SEE SUBR W01
010180200610     I*
010190200610     I                                        1   3 WACITY
010200200610     I                                        4   4 WACEVC
010210200610     I                                        5   5 WACTRT
010220200610     I                                        6   6 WACPFI
010230200610     I                                        7   8 WACBKC
010240200610     I                                        9  10 WACTST
010250200610     I                                        9  10 WACPSB
010260200610     I                                       11  12 WACCCC
010270200610     I                                       13  13 WACMKT
010280200610     I                                       14  14 WACCON
010290200610     I                                       15  15 WACNEG
010300200610     I                                       17  18 WARCTR                                    CGL031
010310200610     I                                       19  20 WACAMC
010320200610     I*
010330200610     IINVKEY      DS
010340200610     I*
010350200610     I* INVESTMENT TYPE FILE KEY FOR DB ERROR PRINTOUT
010360200610     I*
010370200610     I                                        1   3 NMCY
010380200610     I                                        4   6 SITP
010390200610     I*
010400200610     I***********LDA        UDS                            256            S01117
010410200610     I***********                           134 177 DBLOT                 S01117
010420200610     I***********                           134 138 DBFILE                S01117
010430200610     I***********                           139 167 DBKEY                 S01117
010440200610     I***********                           168 175 DBPGM                 S01117
010450200610     I***********                           176 1770DBASE                 S01117
010460200610     I*                                                                   S01117
010470200610     ILDA         DS                            256                       S01117
010480200610     I*                                                                   S01117
010490200610     I** Local Data area for Database Error Reporting                     S01117
010500200610     I*                                                                   S01117
010510200610     I                                      134 183 DBLOT                 S01117
010520200610     I                                      134 141 DBFILE                S01117
010530200610     I                                      142 170 DBKEY                 S01117
010540200610     I                                      171 180 DBPGM                 S01117
010550200610     I                                      181 1830DBASE                 S01117
010560200610     I*
010570200610     IPOSDDB      DS
010580200610     I*
010590200610     I* FILE POSETD DB ERROR KEY - OUTPUT FILE
010600200610     I*
010610200610     I***********                             1   30PBCH                  S01117
010620200610     I***********                             1   3 PBCH            S01117E33032
010630200610     I**********                              1   3 PBCA           E33032 CSE023
010640200610     I**********                              4  13 PSSH                  CSE023
010650200610     I**********                             14  190PCPY                  CSE023
010660200610     I                                        1   3 PBCAK                 CSE023
010670200610     I                                        4  13 PSSHK                 CSE023
010680200610     I**********                             14  190PCPYK                              CSE023 CSD027
010690200610     I                                       14  19 PCPYK                                     CSD027
010700200610      *                                                                   103361
010710200610      * Prime account code                                                103361
010720200610     I            DS                                                      103361
010730200610     I**********                              1  12 PRACCT                             103361 CGL029
010740200610     I                                        1  18 PRACCT                                    CGL029
010750200610     I                                        1   6 PRCNUM                103361
010760200610     I**********                              7  10 PRACOD                             103361 CGL029
010770200610     I**********                             11  12 PRACSQ                             103361 CGL029
010780200610     I                                        7  16 PRACOD                                    CGL029
010790200610     I                                       17  18 PRACSQ                                    CGL029
010800200610     I*                                                                   S01117
010810200610     IKSEPCR      DS                                                      S01117
010820200610     I*                                                                   S01117
010830200610     I* File SEPCCD database error key                                    S01117
010840200610     I*                                                                   S01117
010850200610     I**********                              1   60CSCN                               S01117 CSD027
010860200610     I                                        1   6 CSCN                                      CSD027
010870200610     I                                        1   6 ZCUST                 E37051
010880200610     I                                        7   9 CSBA                  S01117
010890200610     I                                       10  19 CSSC                  S01117
010900200610     I*                                                                   087178
010910200610     I/COPY WNCPYSRC,SE2400I002
010920200610     I***P@DATA******DS                         100                087178 CAC002
010930200610     I***P@DATA*     DS                            128                               CAC002 AR853119
010940200610     IP@DATA      DS                            141                                         AR853119
010950200610     I/COPY WNCPYSRC,SE2400I004
010960200610     I** Data structure of the parameter passed to and from SEZ010        087178
010970200610     I                                        1   1 P@CLAS                087178
010980200610     I                                        2   2 P@PPRE                087178
010990200610     I                                        3  150P@PAMD                087178
011000200610     I                                       16  280P@PCHA                087178
011010200610     I                                       29  410P@PCAM                087178
011020200610     I                                       42  540P@TASO                087178
011030200610     I                                       55  670P@TAUS                087178
011040200610     I                                       68  808P@PSXR                087178
011050200610     I                                       81  81 P@PMDI                087178
011060200610     I                                       82  84 P@PNCY                087178
011070200610     I                                       85  87 P@PSCU                087178
011080200610     I                                       88 1000P@PSAT                087178
011090200610     I                                      101 1138P@FXMR                CAC002
011100200610     I                                      114 1260P@MAMT                CAC002
011110200610     I                                      127 128 P@TDTP                CAC002
011120200610     I                                      129 1410P@STAM                                  AR853119
011130200610     I            DS                                                      236816
011140200610     I**********                              1   60CDCNZN                             236816 CSD027
011150200610     I                                        1   6 CDCNZN                                    CSD027
011160200610     I/COPY WNCPYSRC,SE2400I003
011170200610     I*
011180200610     ICPYR@#      DS
011190200610     I*
011200200610     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
011210200610     I*
011220200610     I                                        1  80 CPY@
011230200610     I                                        1  20 CPY@##
011240200610      *                                                                   S01408
011250200610     C/COPY WNCPYSRC,SE2400IIP2                                           S01408
011260200610      *                                                                   S01408
011270200610     ISDBRCH    E DSSDBRCHPD                                              S01447
011280200610     I** Branch Details                                                   S01447
011290200610     I*                                                                   S01446
011300200610     ISDCURR    E DSSDCURRPD                                              S01446
011310200610     I** Currency Details                                                 S01446
011320200610     I*                                                                   063199
011330200610     ISDGELR    E DSSDGELRPD                                              063199
011340200610     I** General Ledger details                                           063199
011350200610     I*                                                                   063199
011360200610     ISDSTRD    E DSSDSTRDPD                                              S01519
011370200610     I** Securities Trading ICD                                           S01519
011380200610     I*                                                                   S01447
011390200610     ISECNTR    E DSSECNTRPD                                              S01447
011400200610     I** SE Country tax rate details                                      S01447
011410200610     I*                                                                   S01447
011420200610     ISECBTX    E DSSECBTXPD                                              S01447
011430200610     I** SE Country to Branch tax rate details                            S01447
011440200610     ISDMMOD    E DSSDMMODPD                                              S01486
011450200610     I**  Data structure for module details                               S01486
011460200610     I*                                                                   S01486
011470200610     ISDPORT    E DSSDPORTPD                                              S01486
011480200610     I**  Data structure for portfolio management details                 S01486
011490200610     I*                                                                   S01486
011500200610     ISDPLCS    E DSSDPLCSPD                                              S01486
011510200610     I**  Data structure for portfolio client                             S01486
011520200610     I*                                                                   S01486
011530200610     ISECSPD    E DSSDSECSPD                                              S01486
011540200610     I** Securities Trading Customer Details access object                S01486
011550200610     I              QQACCD                          QQACC1                                    CGL029
011560200610     I*                                                                   S01486
011570200610     ISDRETL    E DSSDRETLPD                                              103361
011580200610     I** Retail ICD details                                               103361
011590200610     I              QQACCD                          QQACC2                                    CGL029
011600200610     I*                                                                   S01447
011610200610      *                                                                   S01408
011620200610     ISCSARD    E DSSCSARDPD                                              CSE026
011630200610      ** Data structure for switchable features file                      CSE026
011640200610      *                                                                   CSE026
011650200610     I              LCD                             SCLCD                 CSE026
011660200610     I/COPY WNCPYSRC,SE2400IIP1                                           S01408
011670200610      *                                                                   S01408
011680200610     IDSFDY     E DSDSFDY                                                 S01447
011690200610     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01447
011700200610     I*                                                                   S01447
011710200610     IDSSDY     E DSDSSDY                                                 S01447
011720200610     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01447
011730200610     I*                                                                   S01447
011740200610     IDSLDY     E DSDSLDY                                                                     233792
011750200610      ** Data structure for access program, extra long data structure                         233792
011760200610      *                                                                                       233792
011770200610     IPPOSET    E DSPOSETD                                                CSE023
011780200610     I*  Position Settlement record for calling SE2310                    CSE023
011790200610      *                                                                                       CGL031
011800200610     ISDLOCN    E DSSDLOCNPD                                                                  CGL031
011810200610      ** Midas SD Location Codes                                                              CGL031
011820200610      *                                                                                       CGL031
011830200610     ISDCUST    E DSSDCUSTPD                                                                  CGL031
011840200610      ** Midas SD Customer Details File                                                       CGL031
011850200610     I              QQDFAC                          QQDFA1                                    CGL031
011860200610      *                                                                                       CGL031
011870200610     ISDCTTX    E DSSDCTTXPD                                                                  CGL031
011880200610      ** Midas SD Country of Tax Codes                                                        CGL031
011890200610      *                                                                                       CGL031
011900200610     ISDBANK    E DSSDBANKPD                                                                  CGL031
011910200610      ** Midas SD Bank Details ICD Files                                                      CGL031
011920200610     ISDBRCE    E DSSDBRCHEXPD                                                              AR853119
011930200610      ** Branch Details Extension                                                           AR853119
011940200610     ISDSTPD    E DSSDSTPDPD                                                                AR853119
011950200610      *                                                                                     AR853119
011960200610     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
011970200610      ** Data structure for Tax Parameter File                                              BUG22911
011980200610      *                                                                                     BUG22911
011990200610      ***Data*Structure*to*receive*Base*Rate*Details                            AR1001183 AR1001183A
012000200610     I***SDBSRT*   E DSSDBSRTPD                                                 AR1001183 AR1001183A
012010200610     IETCPOS    E DSETCPOSND                                                                  234440
012020200610      ** customer position for EU Savings tax                                                 234440
012030200610     I              RECI                            ETRECI                                    234440
012040200610     I              CSBA                            ETCSBA                                    234440
012050200610     I              CSSC                            ETCSSC                                    234440
012060200610     I              CSCN                            ETCSCN                                    234440
012070200610     I              PTFR                            ETPTFR                                    234440
012080200610     I              SAPD                            ETSAPD                                    234440
012090200610      *                                                                                       CGL031
012100200610      ** Constant for Instrument Reference                                                    CGL031
012110200610     I              ' - Coupon'           C         WINST1                                    CGL031
012120200610     I              ' - Dividend'         C         WINST2                                    CGL031
012130200610     I              ' - Maturity'         C         WINST3                                    CGL031
012140200610     I              ' - Mortgage Payment' C         WINST4                                    CGL031
012150200610      *                                                                                       CGL031
012160200610      *                                                                                       CGL020
012170200610     I              'ZAAMLSETSE'          C         ZAAMLP                                    CGL020
012180200610      *                                                                                       CGL020
012190200610     I**********    'ZACALCSPRT'          C         SPRDSR                      AR1001183 AR1001183A
012191200616     ISDSTAT    E DSSDSTAT                                                                  AR324886
012192200616      ** SD Data area                                                                       AR324886
012193200616      *                                                                                     AR324886
012200200610     I/COPY ZSRSRC,ZHOLI                                                  S01512
012210200610     I*                                                                   S01512
012220200610      *                                                                                       219566
012230200610      * Data structure for AOSVALR0 string                                                    219566
012240200610     I            DS                                                                          219566
012250200610     I                                        1 200 SVAL1                                     219566
012260200610     I                                        1   1 DEF001                                    219566
012270200610      *                                                                                       219566
012280200610      * System Value                                                                          219566
012290200610     I            DS                                                                          219566
012300200610     I I            'UseDefaultSettAccnt '    1  20 SVALK1                                    219566
012310200610      *                                                                                       219566
012320200610     I/COPY WNCPYSRC,SE2400I001
012330200610      /EJECT
012340200610      *================================================================
012350200610      *  P R O G R A M   S T A R T                                    *
012360200610      *================================================================
012370200610     C*
012380200610     C* KEYLISTS FOR CHAINING TO FILES
012390200610     C*
012400200610     C* CUST. POSITIONS -   SHORT KEY,CURRENT ONLY LF/CPOSS
012410200610     C*
012420200610     C           CPOSKY    KLIST
012430200610     C                     KFLD           WCSSC
012440200610     C*
012450200610     C* CUST. POSITIONS -  HISTORY AND CURRENT   LF/CPOSH
012460200610     C*
012470200610     C           CPOHKY    KLIST
012480200610     C***********          KFLD           WCSBR                           S01117
012490200610     C                     KFLD           WCSBA                           S01117
012500200610     C                     KFLD           WCSSC
012510200610     C                     KFLD           WCSCN
012520200610     C                     KFLD           WCSDA
012530200610     C*
012540200610     C**SECURITY*EVENTS*-************************LF/SECED                 E20016
012550200610     C* SECURITY EVENTS -                        LF/SEDEV                 E20016
012560200610     C*
012570200610     C           SECDKY    KLIST
012580200610     C                     KFLD           SASN
012590200610     C                     KFLD           SDED
012600200610     C                     KFLD           SDET
012610200610     C*                                                                   E36391
012620200610     C*  - SECURITY DIARY EVENTS                                          E36391
012630200610     C           SEDKEY    KLIST                                          E36391
012640200610     C                     KFLD           SASN                            E36391
012650200610     C                     KFLD           SAAT                            E36391
012660200610     C                     KFLD           SAED                            E36391
012670200610     C*
012680200610     C* SECURITIES LF/SECTY
012690200610     C*
012700200610     C           SECTKY    KLIST
012710200610     C                     KFLD           SASN
012720200610     C*
012730200610     C* INVESTMENT TYPES LF/INVTP
012740200610     C*
012750200610     C           INVTKY    KLIST
012760200610     C                     KFLD           NMCY
012770200610     C                     KFLD           SITP
012780200610     C*
012790200610     C* STANDARD SETTLEMENT INSTRUCTIONS PF/STDSED
012800200610     C*
012810200610     C           STDSKY    KLIST
012820200610     C***********          KFLD           SBRH                            S01117
012830200610     C                     KFLD           SBRA                            S01117
012840200610     C                     KFLD           CSTM
012850200610     C                     KFLD           WBKCD   2                                           CSE028
012860200610     C                     KFLD           CYSI
012870200610     C                     KFLD           ITSI
012880200610     C                     KFLD           WPTFR   4                                           CSE028
012890200610     C*                                                                   S01117
012900200610     C* Customer Position Profit Centre Record PF/SEPCCD                  S01117
012910200610     C*                                                                   S01117
012920200610     C           KSEPCC    KLIST                                          S01117
012930200610     C                     KFLD           CSCN                            S01117
012940200610     C                     KFLD           CSBA                            S01117
012950200610     C                     KFLD           CSSC                            S01117
012960200610     C*                                                                   S01519
012970200610     C** Default charges table.  LF/SEDFTCPD                              S01519
012980200610     C*                                                                   S01519
012990200610     C           DFTKY1    KLIST                                          S01519
013000200610     C                     KFLD           DCCLAS                          S01519
013010200610     C                     KFLD           DCINVT                          S01519
013020200610     C                     KFLD           DCCUST                          S01519
013030200610      *                                                                   CSE026
013040200610     C           DFTKYG    KLIST                                          CSE026
013050200610     C                     KFLD           DCCLGR                          CSE026
013060200610     C                     KFLD           DCINVT                          CSE026
013070200610     C/COPY WNCPYSRC,SE2400C067
013080200610     C                     KFLD           DCCUST                          CSE026
013090200610     C*                                                                   S01519
013100200610     C** Security details                                                 S01519
013110200610     C*                                                                   S01519
013120200610     C           @CCOD     KLIST                                          S01519
013130200610     C                     KFLD           @CCY                            S01519
013140200610     C                     KFLD           @CAM    2                       S01519
013150200610     C*                                                                   S01486
013160200610     C**FIRST*CUSTOMER*POSITION FILE             LF/PMFPSNLL       S01486 189942
013170200610     C***********                                                  S01486 189942
013180200610     C***********PMFPKY    KLIST                                   S01486 189942
013190200610     C***********          KFLD           CSCN                     S01486 189942
013200200610     C***********          KFLD           WWPDAT                   S01486 189942
013210200610     C***********                                                  S01486 189942
013220200610     C**CURRENT*CUSTOMER*POSITION FILE           LF/PMCPSSLL       S01486 189942
013230200610     C***********                                                  S01486 189942
013240200610     C***********PMCPSS    KLIST                                   S01486 189942
013250200610     C***********          KFLD           WWTDVA  1                S01486 189942
013260200610     C***********          KFLD           SASN                     S01486 189942
013270200610     C***********                                                  S01486 189942
013280200610     C**ALL*VALUE*DATE*PORTFOLIO POSITIONS       LF/PMVPOSLL       S01486 189942
013290200610     C***********                                                  S01486 189942
013300200610     C***********PMVPKY    KLIST                                   S01486 189942
013310200610     C***********          KFLD           WWCNUM  60               S01486 189942
013320200610     C***********          KFLD           WWPTFR  4                S01486 189942
013330200610     C***********          KFLD           WWTDSS 10                S01486 189942
013340200610     C***********          KFLD           WWTDVA  1                S01486 189942
013350200610     C***********          KFLD           WWPDAT  50               S01486 189942
013360200610     C*                                                                   189942
013370200610     C* FIRST CUSTOMER POSITION FILE             LF/SECDEPL0              189942
013380200610     C*                                                                   189942
013390200610     C           PMFPKY    KLIST                                          189942
013400200610     C                     KFLD           CSCN                            189942
013410200610     C                     KFLD           WWCDPA                          189942
013420200610     C*                                                                   189942
013430200610     C* CURRENT CUSTOMER POSITION FILE           LF/CDEPS                 189942
013440200610     C*                                                                   189942
013450200610     C           PMCPSS    KLIST                                          189942
013460200610     C                     KFLD           SASN                            189942
013470200610     C*                                                                   189942
013480200610     C* ALL VALUE DATE PORTFOLIO POSITIONS       LF/SECDEPL5              189942
013490200610     C*                                                                   189942
013500200610     C           PMVPKY    KLIST                                          189942
013510200610     C                     KFLD           WWCDPA  3                       189942
013520200610     C**********           KFLD           WWCNUM  60                                   189942 CSD027
013530200610     C                     KFLD           WWCNUM  6                                           CSD027
013540200610     C                     KFLD           WWPTFR  4                       189942
013550200610     C                     KFLD           WWTDSS 10                       189942
013560200610     C**********           KFLD           WWCDPT  60                                   189942 CSD027
013570200610     C                     KFLD           WWCDPT  6                                           CSD027
013580200610     C                     KFLD           WWCDMK  1                       189942
013590200610     C                     KFLD           WWDDTE  50                      189942
013600200610     C*                                                                   S01486
013610200610     C** PORTFOLIO DETAILS PMPORTPD                                       S01486
013620200610     C           PMPORT    KLIST                                          S01486
013630200610     C**********           KFLD           WWCNU1  60                                   S01486 CSD027
013640200610     C                     KFLD           WWCNU1  6                                           CSD027
013650200610     C                     KFLD           WWPTF1  4                       S01486
013660200610     C*                                                                   S01486
013670200610     C** ACCOUNT DETAILS PMACCNL0                                         S01486
013680200610     C           ACCNTP    KLIST                                          S01486
013690200610     C                     KFLD           WZCNUM                          S01486
013700200610     C                     KFLD           WZCCY                           S01486
013710200610     C                     KFLD           WZPTFR                          S01486
013720200610     C                     KFLD           WZACSQ  20                      S01486
013730200610     C*                                                                   219688
013740200610     C** ACCOUNT DETAILS PMACCNL1                                         219688
013750200610     C           ACCNTL    KLIST                                          219688
013760200610     C                     KFLD           WZCNUM                          219688
013770200610     C                     KFLD           WZPTFR                          219688
013780200610     C                     KFLD           WZCCY                           219688
013790200610     C                     KFLD           WZACOD                          219688
013800200610     C                     KFLD           WZACSQ                          219688
013810200610     C*                                                                   219688
013820200610      ** Key to ACCNTAB                                                   136297
013830200610      *                                                                   136297
013840200610     C           KEYACC    KLIST                                          136297
013850200610     C**********           KFLD           KYCNUM  60                                   136297 CSD027
013860200610     C                     KFLD           KYCNUM  6                                           CSD027
013870200610     C                     KFLD           KYCCY   3                       136297
013880200610     C**********           KFLD           KYACOD  40                                   136297 CGL029
013890200610     C                     KFLD           KYACOD 100                                          CGL029
013900200610     C                     KFLD           KYACSQ  20                      136297
013910200610     C                     KFLD           KYBRCA  3                       136297
013920200610     C/COPY WNCPYSRC,SE2400C044
013930200610     C*
013940200610     C* ACCESS ICD INFORMATION IN SUBROUTINE FIRST
013950200610     C*
013960200610     C           *NAMVAR   DEFN           LDA                             S01117
013970200610     C           *LOCK     IN   LDA                                       S01117
013980200610     C                     MOVE *BLANK    DBLOT
013990200610     C                     Z-ADD0         DBASE
014000200610      *** Correct setup of DBPGM                                          S01447
014010200610     C***********          MOVE 'SE2400  'DBPGM                           S01447
014020200610     C                     MOVE *BLANKS   DBPGM                           S01447
014030200610     C                     MOVEL'SE2400'  DBPGM                           S01447
014040200610     C                     OUT  LDA                                       S01117
014041200616     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
014042200616     C                     IN   SDSTAT                                                      AR324886
014050200610     C                     EXSR FIRST
014060200610     C*
014070200610     C*  DEPOT NAME INFORMATION - LF/CLINT (PF/CLINTSE)
014080200610     C*
014090200610     C           CLINTK    KLIST
014100200610     C**********           KFLD           WCLNTK  60                                          CSD027
014110200610     C                     KFLD           WCLNTK  6                                           CSD027
014120200610     C                     KFLD           WLIT1   1
014130200610     C*
014140200610     C* GET COUNTRY LOCATION - LF/CLINT (PF/CLINTCB)                      S01447
014150200610     C*                                                                   S01447
014160200610     C           CLKYCB    KLIST                                          S01447
014170200610     C**********           KFLD           WCUST   60                                   S01447 CSD027
014180200610     C                     KFLD           WCUST   6                                           CSD027
014190200610     C                     KFLD           WRTYP   1                       S01447
014200200610      *                                                                                     BUG11104
014210200610      ** Key to diary event details                                                         BUG11104
014220200610      *                                                                                     BUG11104
014230200610     C           P4KEY     KLIST                                                            BUG11104
014240200610     C                     KFLD           WWSDSN 10                                         BUG11104
014250200610     C                     KFLD           WWSDET  2                                         BUG11104
014260200610     C                     KFLD           SDED                                              BUG11104
014270200610     C*                                                                   S01447
014280200610      ** Get Tax Calculation Method - LF/SDTXCML1 (PF/SDTXCMPD)                               CGL031
014290200610      *                                                                                       CGL031
014300200610     C           KTXCM     KLIST                                                              CGL031
014310200610     C                     KFLD           KCSIS   2                                           CGL031
014320200610     C                     KFLD           KCTRT   2                                           CGL031
014330200610      *                                                                                       CGL031
014340200610     C* CHECK FOR DATABASE ERRORS
014350200610     C*
014360200610     C           *IN99     IFEQ '1'
014370200610     C                     GOTO EAUDIT
014380200610     C                     END
014390200610     C*
014400200610     C* DEFINE AND CLEAR WORK FIELDS
014410200610     C*
014420200610     C           *LIKE     DEFN CSSC      WCSSC
014430200610     C           *LIKE     DEFN CSCN      WCSCN
014440200610     C************LIKE     DEFN CSBR      WCSBR                           S01117
014450200610     C           *LIKE     DEFN CSBA      WCSBA                           S01117
014460200610     C           *LIKE     DEFN CSDA      WCSDA
014470200610     C           *LIKE     DEFN RECI      WSRECI
014480200610     C           *LIKE     DEFN CFCT      WACF                            052254
014490200610     C********** *LIKE     DEFN BASC      UBASC                                 AR1001183 AR1001183A
014500200610     C********** *LIKE     DEFN BASS      UBASS                                 AR1001183 AR1001183A
014510200610     C********** *LIKE     DEFN SPRI      USPRI                                 AR1001183 AR1001183A
014520200610     C********** *LIKE     DEFN RDMT      URDMT                                 AR1001183 AR1001183A
014530200610     C********** *LIKE     DEFN RDFD      URDFD                                 AR1001183 AR1001183A
014540200610     C********** *LIKE     DEFN CNSP      UCNSP                                 AR1001183 AR1001183A
014550200610     C********** *LIKE     DEFN CNSG      UCNSG                                 AR1001183 AR1001183A
014560200610     C*                                                                   095066
014570200610     C*** Check if Value date position is to be used for Dividend.        095066
014580200610     C*                                                                   095066
014590200610     C                     CALL 'AOSARDR0'                                095066
014600200610     C                     PARM '       ' @RTCD   7                       095066
014610200610     C                     PARM '*VERIFY' @OPTN   7                       095066
014620200610     C                     PARM 'CSE008'  @SARD   6                       095066
014630200610     C*                                                                   095066
014640200610     C           @RTCD     IFEQ *BLANKS                                   095066
014650200610     C                     MOVE 'Y'       CSE008  1                       095066
014660200610     C                     ELSE                                           095066
014670200610     C                     MOVE 'N'       CSE008                          095066
014680200610     C                     ENDIF                                          095066
014690200610     C*
014700200610     C* LOOP ROUND PROCESSING FOR EACH ACTION RECORD READ LF/SECAC
014710200610     C*
014720200610     C           *IN89     DOWEQ'0'
014730200610     C*
014740200610     C* READ ACTION FILE OF SECURITY ACTIONS
014750200610     C*
014760200610     C                     READ SECAC                    89
014770200610     C           BGPFMG    IFEQ 'Y'                                       S01486
014780200610     C           BGN4ST    OREQ 'Y'                                       CPB001
014790200610     C                     Z-ADDSAED      ECD     50                      S01486
014800200610     C                     END                                            S01486
014810200610     C*
014820200610     C* IF ACTION RECORD DELETED GOTO END OF LOOP FOR NEXT ACTION
014830200610     C*
014840200610     C  N89      RECI      CABEQ'*'       ENDLP
014850200610     C*
014860200610     C* AT END OF FILE -
014870200610     C*
014880200610     C           *IN89     CABEQ'1'       ENDLP
014890200610     C*
014900200610     C                     MOVE RECI      WSRECI
014910200610     C*
014920200610     C** ADD TO COUNTER FOR EACH RECORD READ
014930200610     C*      SECURITY ACTION COUNT
014940200610     C*
014950200610     C                     ADD  1         WCSECT  50
014960200610     C                     MOVE '1'       WNEWSC  1
014970200610     C                     MOVE '0'       *IN79
014980200610     C                     MOVE SASN      WCSSC
014990200610     C*
015000200610     C* GET EACH CUST WHO HOLDS THIS SECURITY  - EXSR GETDEP
015010200610     C*
015020200610     C           *IN79     DOWEQ'0'
015030200610     C*
015040200610     C                     EXSR GETDEP
015050200610     C*
015060200610     C* IND 79 IS SET ON WHEN NO MORE CUSTS FOR THIS SECURITY
015070200610     C*
015080200610     C********** *IN79     CABEQ'1'       ENDLP                           S01486
015090200610     C           *IN79     CABEQ'1'       PRCPTF                          S01486
015100200610     C*
015110200610     C** PROCESS SELECTED SECURITY / CUST /DATE RECORD
015120200610     C*
015130200610     C           BGPFMG    IFNE 'Y'                                                         AR877365
015140200610     C           BGN4ST    ANDNE'Y'                                                         AR877365
015150200610     C*
015160200610     C***RECORD*SELECTED*-*IGNORE*IF*LAST*CHG*DATE*=*RUN*DATE**********   E15549
015170200610     C*  NOTE THAT SE2400 WILL PROCESS ALL SECURITY ACTIONS NEW 'TODAY'   E15549
015180200610     C*  (AS DEFINED BY THE EVENT CONTROL DATE IN SE2100).                E15549
015190200610     C* ((LINES ASTERISKED BELOW BY E14506 RELEVANT TO E15549))           E15549
015200200610     C*
015210200610     C***********CSCV      CABEQRUND      ENDLP                           E14506
015220200610     C***********CSCT      CABEQRUND      ENDLP                           E14506
015230200610     C*
015240200610     C** IF THIS POSITION DATE IS LESS THAN OR EQUAL TO THE               E15549
015250200610     C** LAST COUPON DATE THEN THE EX-COUPON NOMINAL WILL BE ZERO         E15549
015260200610      *                                                                                     BUG11104
015270200610      **  For shares, obtain DATE of previous dividend from Diary                           BUG11104
015280200610      **  Events File.                                                                      BUG11104
015290200610      *                                                                                     BUG11104
015300200610     C                     EXSR SECTIN                                                      BUG11104
015310200610     C                     EXSR INVTIN                                                      BUG11104
015320200610     C           PROT      IFEQ '4'                                                         BUG11104
015330200610     C                     MOVELSASN      WWSDSN                                            BUG11104
015340200610     C                     MOVE 'DV'      WWSDET                                            BUG11104
015350200610     C                     Z-ADDSAED      SDED                                              BUG11104
015360200610     C           P4KEY     SETGTSECET                                                       BUG11104
015370200610     C                     READPSECET                    72                                 BUG11104
015380200610      *                                                                                     BUG11104
015390200610     C           *IN72     IFEQ '0'                                                         BUG11104
015400200610     C           SDSN      ANDEQWWSDSN                                                      BUG11104
015410200610     C           SDET      ANDEQWWSDET                                                      BUG11104
015420200610     C                     Z-ADDSDED      SALCCP                                            BUG11104
015430200610     C                     ELSE                                                             BUG11104
015440200610     C                     Z-ADD0         SALCCP                                            BUG11104
015450200610     C                     ENDIF                                                            BUG11104
015460200610     C                     ENDIF                                                            BUG11104
015470200610     C*                                                                   E15549
015480200610     C           CSDA      IFLE SALCCP                                    E15549
015490200610     C                     Z-ADD*ZERO     CSEX                            E15549
015500200610     C                     Z-ADD*ZERO     CPCH                                                CGL031
015510200610     C                     Z-ADD*ZERO     CSPI                                                CGL031
015520200610     C                     END                                            E15549
015530200610     C*                                                                   E15549
015540200610     C** CALCULATE CUM-COUPON VALUE
015550200610     C*
015560200610     C           CSNV      SUB  CSEX      WCUMCP 150
015570200610     C*                                                                   S01117
015580200610     C** EXECUTE SUBROUTINE SECPPC TO RETRIEVE CUSTOMER POSITION          S01117
015590200610     C** PROFIT CENTRE DETAILS                                            S01117
015600200610     C*                                                                   S01117
015610200610     C           BKPRCU    IFEQ 'Y'                                       063199
015620200610     C           WCUMCP    ANDNE0                                         121921
015630200610     C                     EXSR SECPPC                                    S01117
015640200610     C                     END                                            063199
015650200610     C*
015660200610      *** For efficiency purposes, make calls to following subroutines    S01447
015670200610      *** dependant on change of security.                                S01447
015680200610      *                                                                   S01447
015690200610     C           CSSC      IFNE UCSSC                                     S01447
015700200610      *                                                                   S01447
015710200610     C** EXECUTE SUBROUTINE SECTIN TO RETRIEVE SECURITY RECORD
015720200610     C*
015730200610     C                     EXSR SECTIN
015740200610     C*
015750200610     C** Execute Subroutine INVTIN to retrieve INVESTMENT Record          E23169
015760200610     C*                                                                   E23169
015770200610     C                     EXSR INVTIN                                    E23169
015780200610      *                                                                   S01447
015790200610     C                     MOVE CSSC      UCSSC  10                       S01447
015800200610     C                     END                                            S01447
015810200610     C*                                                                   E23169
015820200610      *** IF THE BOOKING BRANCH READ IS DIFFERENT FROM PREVIOUS RECORD,   S01447
015830200610      *** GET COUNTRY LOCATION OF BRANCH.                                 S01447
015840200610      *                                                                   S01447
015850200610     C           CSBA      IFNE UCSBA                                     S01447
015860200610     C                     EXSR GETCTY                                    S01447
015870200610     C                     MOVE CSBA      UCSBA   3                       S01447
015880200610     C                     END                                            S01447
015890200610      *                                                                   S01447
015900200610     C** EXECUTE SUBROUTINES DEPENDING ON ACTION TYPE
015910200610     C*
015920200610     C           SAAT      CASEQ'DV'      DIVIDN
015930200610     C           SAAT      CASEQ'CP'      COUPON
015940200610     C           SAAT      CASEQ'MA'      MATURE
015950200610     C           SAAT      CASEQ'MP'      MORTPY
015960200610     C         71SAAT      CASEQ'PP'      PARTPY                                              CSE110
015970200610     C                     END
015980200610     C*
015990200610     C********** PSRI      IFEQ 'Y'                                                           CSE110
016000200610     C********** SAAT      CASEQ'PP'      PARTPY                                              CSE110
016010200610     C           CSE110    IFEQ 'N'                                                           CSE110
016020200610     C           PSRI      ANDEQ'Y'                                                           CSE110
016030200610     C           SAAT      CASEQ'PP'      PARTPY                                              CSE110
016040200610     C                     END
016050200610     C                     END
016060200610     C                     ENDIF                                                            AR877365
016070200610     C                     END                                            080741
016080200610     C*
016090200610     C* ADD TO COUNT OF POSITIONS PROCESSED
016100200610     C*
016110200610     C                     ADD  1         WCPOSN  50
016120200610     C*
016130200610     C********** ENDLP     TAG                             ** ENDLP **    S01486
016140200610     C           PRCPTF    TAG                                            S01486
016150200610     C*                                                                   S01486
016160200610     C* CHECK THAT PORTFOLIO MANAGEMENT IS PRESENT IN THE SYSTEM          S01486
016170200610     C* OR PRIVATE BANKING MODULE IS ACTVE                                CPB001
016180200610     C*                                                                   S01486
016190200610     C           BGPFMG    IFEQ 'Y'                        B2             S01486
016200200610     C           BGN4ST    OREQ 'Y'                                       CPB001
016210200610     C*                                                                   S01486
016220200610     C* GENERATE POSITION SETTLEMENTS FOR ALL PORTFOLIO POSITIONS         S01486
016230200610     C* SET FLAG FOR FIRST SECURITY POSITION                              S01486
016240200610     C*                                                                   S01486
016250200610     C                     MOVE 'Y'       WSPOSN  1                       S01486
016260200610     C*                                                                   S01486
016270200610     C* SET FLAG FOR POSITIONS TO PROCESS                                 S01486
016280200610     C*                                                                   S01486
016290200610     C                     MOVE 'Y'       WPORTP  1                       S01486
016300200610     C*                                                                   S01486
016310200610     C* GET NEXT PORTFOLIO POSITION FOR SECURITY ACTION                   S01486
016320200610     C*                                                                   S01486
016330200610     C                     EXSR GETPTF                                    S01486
016340200610     C*                                                                   S01486
016350200610     C* SET FIRST SECURITY FLAG TO 'N'                                    S01486
016360200610     C*                                                                   S01486
016370200610     C                     MOVE 'N'       WSPOSN                          S01486
016380200610     C*                                                                   S01486
016390200610     C* DO WHILE PORTFOLIO POSITIONS FOUND                                S01486
016400200610     C*                                                                   S01486
016410200610     C           WPORTP    DOWEQ'Y'                        B3             S01486
016420200610     C*                                                                   S01486
016430200610     C* IF THE POSITION DATE IS LESS THAN OR EQUAL TO THE LAST COUPON     S01486
016440200610     C* DATE THEN THE EX-COUPON NOMINAL WILL BE ZERO                      S01486
016450200610      **  For shares, obtain DATE of previous dividend from Diary                           BUG11104
016460200610      **  Events File.                                                                      BUG11104
016470200610      *                                                                                     BUG11104
016480200610     C                     EXSR SECTIN                                                      BUG11104
016490200610     C                     EXSR INVTIN                                                      BUG11104
016500200610     C           PROT      IFEQ '4'                                                         BUG11104
016510200610     C                     MOVELSASN      WWSDSN                                            BUG11104
016520200610     C                     MOVE 'DV'      WWSDET                                            BUG11104
016530200610     C                     Z-ADDSAED      SDED                                              BUG11104
016540200610     C           P4KEY     SETGTSECET                                                       BUG11104
016550200610     C                     READPSECET                    72                                 BUG11104
016560200610      *                                                                                     BUG11104
016570200610     C           *IN72     IFEQ '0'                                                         BUG11104
016580200610     C           SDSN      ANDEQWWSDSN                                                      BUG11104
016590200610     C           SDET      ANDEQWWSDET                                                      BUG11104
016600200610     C                     Z-ADDSDED      SALCCP                                            BUG11104
016610200610     C                     ELSE                                                             BUG11104
016620200610     C                     Z-ADD0         SALCCP                                            BUG11104
016630200610     C                     ENDIF                                                            BUG11104
016640200610     C                     ENDIF                                                            BUG11104
016650200610     C*                                                                   S01486
016660200610     C***********QAPDAT    IFLE SALCCP                     B4      S01486 189942
016670200610     C***********          Z-ADD0         QACSEX                   S01486 189942
016680200610     C***********          END                             E4      S01486 189942
016690200610     C***********                                                  S01486 189942
016700200610     C           DDTE      IFLE SALCCP                     B4             189942
016710200610     C                     Z-ADD0         CSEX                            189942
016720200610     C                     Z-ADD0         CPCH                                                CGL031
016730200610     C                     Z-ADD0         CSPI                                                CGL031
016740200610     C                     END                             E4             189942
016750200610     C*                                                                   189942
016760200610     C* CALCULATE CUMULATIVE COUPON NOMINAL VALUE                         S01486
016770200610     C***********                                                  S01486 189942
016780200610     C***********QANOML    SUB  QACSEX    WCUMCP                   S01486 189942
016790200610     C*                                                                   189942
016800200610     C           CDNV      SUB  CSEX      WCUMCP                          189942
016810200610     C*                                                                   080741
016820200610     C** EXECUTE SUBROUTINE SECPPC TO RETRIEVE CUSTOMER POSITION          080741
016830200610     C** PROFIT CENTRE DETAILS                                            080741
016840200610     C*                                                                   080741
016850200610     C           BKPRCU    IFEQ 'Y'                                       080741
016860200610     C                     EXSR SECPPC                                    080741
016870200610     C                     END                                            080741
016880200610     C*                                                                   S01486
016890200610     C** EXECUTE SUBROUTINE SECTIN TO RETRIEVE SECURITY RECORD            S01486
016900200610     C*                                                                   S01486
016910200610     C***********          MOVE QATDSS    SASN                     S01486 189942
016920200610     C                     MOVE CDSN      SASN                            189942
016930200610     C                     EXSR SECTIN                                    S01486
016940200610     C*                                                                   S01486
016950200610     C                     EXSR INVTIN                                    S01486
016960200610     C*                                                                   S01486
016970200610     C** EXECUTE SUBROUTINES DEPENDING ON ACTION TYPE                     S01486
016980200610     C*                                                                   S01486
016990200610     C                     MOVE WWPTFR    PTFR                            S01486
017000200610     C           SAAT      CASEQ'DV'      DIVIDN           B4             S01486
017010200610     C           SAAT      CASEQ'CP'      COUPON                          S01486
017020200610     C           SAAT      CASEQ'MA'      MATURE                          S01486
017030200610     C           SAAT      CASEQ'MP'      MORTPY                          S01486
017040200610     C                     END                             E4             S01486
017050200610     C*                                                                   S01486
017060200610     C           PSRI      IFEQ 'Y'                        B4             S01486
017070200610     C           SAAT      CASEQ'PP'      PARTPY           B5             S01486
017080200610     C                     END                             E5             S01486
017090200610     C                     END                             E4             S01486
017100200610     C*                                                                   S01486
017110200610     C* GET NEXT PORTFOLIO POSITION FOR SECURITY ACTION                   S01486
017120200610     C*                                                                   S01486
017130200610     C                     EXSR GETPTF                                    S01486
017140200610     C*                                                                   S01486
017150200610     C                     END                             E3             S01486
017160200610     C                     END                             E2             S01486
017170200610     C******************** END                                            080741
017180200610     C                     END
017190200610     C*
017200200610     C           ENDLP     TAG                             ** ENDLP **    S01486
017210200610     C*
017220200610     C           EAUDIT    TAG                             ** EAUDIT **
017230200610     C*
017240200610     C* OUTPUT RUN CONTROL REPORT
017250200610     C*
017260200610     C                     EXSR AUDIT
017270200610      *
017280200610      *================================================================
017290200610      *  P R O G R A M   E N D                                        *
017300200610      *                                                               *
017310200610     C/COPY WNCPYSRC,SE2400C040
017320200610     C                     SETON                     LR
017330200610      *                                                               *
017340200610      *================================================================
017350200610      /EJECT
017360200610      *****************************************************************   S01447
017370200610      *                                                               *   S01447
017380200610      *  GETCTY - Get Country of Branch                               *   S01447
017390200610      *                                                               *   S01447
017400200610      *  CALLED FROM: MAIN                                            *   S01447
017410200610      *                                                               *   S01447
017420200610      *****************************************************************   S01447
017430200610      *                                                                   S01447
017440200610     C           GETCTY    BEGSR                                          S01447
017450200610      *                                                                   S01447
017460200610     C**********           CALL 'AOBRCHR0'                                             S01447 CGL029
017470200610     C                     CALL 'AOBRCHR1'                                                    CGL029
017480200610     C                     PARM *BLANKS   @RTCD   7                       S01447
017490200610     C                     PARM '*KEY   ' @OPTN   7                       S01447
017500200610     C                     PARM CSBA      @BRCD   3                       S01447
017510200610     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01447 CGL029
017520200610     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
017530200610      *                                                                   S01447
017540200610     C           @RTCD     IFNE *BLANKS                    *B1            S01447
017550200610     C           *LOCK     IN   LDA                                       S01447
017560200610     C                     MOVEL'SDBRCHL1'DBFILE           ***************S01447
017570200610     C                     MOVELCSBA      DBKEY            ** DBERROR 019 S01447
017580200610     C                     Z-ADD19        DBASE            ***************S01447
017590200610     C                     SETON                       U7U8               S01447
017600200610     C                     EXSR *PSSR                                     S01447
017610200610     C                     GOTO EAUDIT                                    S01447
017620200610     C                     ELSE                            *X1            S01447
017630200610      *                                                                   S01447
017640200610     C                     MOVE A8BICN    WCUST                           S01447
017650200610     C           CLKYCB    CHAINCLINT                54    *B2            S01447
017660200610     C           *IN54     IFEQ '1'                                       S01447
017670200610     C           RECI      OREQ '*'                                       S01447
017680200610     C           *LOCK     IN   LDA                        ***************S01447
017690200610     C                     Z-ADD20        DBASE            * DBERROR 020 *S01447
017700200610     C                     MOVEL'CLINTCBF'DBFILE           ***************S01447
017710200610     C                     MOVELA8BICN    DBKEY                           S01447
017720200610     C                     SETON                       U7U8               S01447
017730200610     C                     EXSR *PSSR                                     S01447
017740200610     C                     GOTO EAUDIT                                    S01447
017750200610     C                     ELSE                            *X2            S01447
017760200610      *                                                                   S01447
017770200610     C                     MOVE CLOC      UBRLOC                          S01447
017780200610     C                     END                             *E2            S01447
017790200610     C                     END                             *E1            S01447
017800200610      *                                                                   S01447
017810200610     C                     ENDSR                                          S01447
017820200610      *****************************************************************   S01447
017830200610      /EJECT                                                              S01447
017840200610     C*****************************************************************
017850200610     C*                                                               *
017860200610     C* GETDEP   - GET CUST. POSITION RECORD TO UPDATE NEXT FOR THIS  *
017870200610     C*            SECURITY ACTION.                                   *
017880200610     C*                                                               *
017890200610     C*****************************************************************
017900200610     C*
017910200610     C           GETDEP    BEGSR                           ** GETDEP **
017920200610     C*
017930200610     C*  IF,IN THIS SUBR,A CUST. IS IGNORED BECAUSE DATE OF EARLIEST
017940200610     C*  POSITION IS GREATER THAN ACTION DATE, SEARCH FOR NEXT CUSTOMER
017950200610     C*  RESUMES AT GETIN
017960200610     C***********                                                  E21715 E23807
017970200610     C***********                                                  E21715 E23807
017980200610     C***********          SETOF                     66            E21715 E23807
017990200610     C*                                                                   E21715
018000200610     C           BGPFMG    IFEQ 'Y'                                       S01486
018010200610     C           BGN4ST    OREQ 'Y'                                       CPB001
018020200610     C                     MOVE *BLANKS   PTFR                            S01486
018030200610     C                     END                                            S01486
018040200610     C*
018050200610     C           GETIN     TAG                             ** GETIN  **
018060200610     C*
018070200610     C** IF NEW SECURITY ACTION RECORD, USE SHORT KEY TO SETLL ON
018080200610     C*  CPOSS FILE - LATEST DATES ONLY ARE ACCESSED VIA THIS LOGICAL
018090200610     C*
018100200610     C           WNEWSC    IFEQ '1'
018110200610     C                     MOVE '0'       WNEWSC
018120200610     C           CPOSKY    SETLLCPOSS                    77
018130200610     C           *IN77     IFEQ '0'
018140200610     C                     MOVE '1'       *IN79
018150200610     C                     GOTO ENDDEP
018160200610     C                     END
018170200610     C                     END
018180200610     C*
018190200610     C** READ THE NEXT SECURITY/CUST./BRANCH/LAST POSITION DATE
018200200610     C*
018210200610     C           CPOSKY    READECPOSS                    79
018220200610     C           *IN79     CABEQ'1'       ENDDEP
018230200610     C           RECI      CABEQ'*'       GETIN
018240200610      *                                                                                       CGL031
018250200610      ** Place the retrieve CSCN,CSBA into a work variable                                    CGL031
018260200610      ** to be used in ZATXCLPI/ZATXCLJA later.                                               CGL031
018270200610      *                                                                                       CGL031
018280200610     C**********           Z-ADDCSCN      YCSCN   60                                  CGL031 CSD027A
018290200610     C                     MOVE CSCN      YCSCN   6                                          CSD027A
018300200610     C                     MOVELCSBA      YCSBA   3                                           CGL031
018310200610     C*
018320200610     C** IF THE EVENT TYPE ON THE SECURITY ACTION IS 'MA' (MATURITY)      E14236
018330200610     C** UPDATE THE LATEST DEPOT POSITION WITH RECI = 'H'.                E14236
018340200610     C*                                                                   E14236
018350200610     C           SAAT      IFEQ 'MA'                                      E14236
018360200610     C           AKRI      ANDEQ'Y'                                       E15696
018370200610     C                     MOVEL'H'       RECI                            E14236
018380200610     C                     UPDATCPOSNDF                                   E14236
018390200610     C                     END                                            E14236
018400200610     C*
018410200610     C**SELECT*THIS*RECORD*FOR*UPDATE*IF*THE*POSITION*DATE*(CSDA)******   S01510
018420200610     C**IS*LESS*THAN*SECURITY*ACTION*DATE*OR*EQUAL*TO*IT*IF*ACTION*TYPE   S01510
018430200610     C**IS*VALUE*'PP'.*************************************************   S01510
018440200610     C***********                                                         S01510
018450200610     C***********SAAT      IFEQ 'PP'                                      S01510
018460200610     C***********CSDA      ANDLTSAED                                      S01510
018470200610     C***********SAAT      ORNE 'PP'                                      S01510
018480200610     C***********CSDA      ANDLESAED                                      S01510
018490200610     C***********SAAT      OREQ 'DV'                               E16815 E24422
018500200610     C* SELECT THIS RECORD FOR UPDATE IF THE POSITION DATE (CSDA)
018510200610     C* IS LESS THAN SECURITY ACTION DATE OR EQUAL TO IT IF ACTION TYPE
018520200610     C* IS VALUE 'PP'.& S01486 ON
018530200610     C*
018540200610     C           BGPFMG    IFEQ 'Y'                                       S01486
018550200610     C           BGN4ST    OREQ 'Y'                                       CPB001
018560200610     C           SAAT      IFEQ 'MA'                                      S01486
018570200610     C           CSDA      ANDLESAED                                      S01486
018580200610     C           SAAT      OREQ 'DV'                                      099266
018590200610     C           CSDA      ANDLESAEXD                                     099266
018600200610     C           S01510    ANDEQ'Y'                                       099266
018610200610     C           SAAT      ORNE 'MA'                                      S01486
018620200610     C           CSDA      ANDLTSAED                                      S01486
018630200610     C           S01510    ANDEQ'N'                                       099266
018640200610     C           SAAT      ORNE 'MA'                                      099266
018650200610     C           SAAT      ANDNE'DV'                                      099266
018660200610     C           CSDA      ANDLTSAED                                      099266
018670200610     C           S01510    ANDEQ'Y'                                       099266
018680200610     C                     GOTO ENDDEP                                    S01486
018690200610     C                     END                                            S01486
018700200610     C                     ELSE                                           S01486
018710200610     C*                                                                   S01510
018720200610     C** Select the record based on the following                         S01510
018730200610     C** ..event type is DV AND position date < ex-dividend date          S01510
018740200610     C**        AND S01510 is active                                      S01510
018750200610     C** ..OR event type = MA AND position date <= security action date   S01510
018760200610     C** ..OR event type <> MA and position date < security action date   S01510
018770200610     C**        AND S01510 is not active                                  S01510
018780200610     C** ..OR event type <> MA and DV and position < security action      S01510
018790200610     C**        date AND S01510 is active                                 S01510
018800200610     C*                                                                   S01510
018810200610     C           SAAT      IFEQ 'DV'                                      S01510
018820200610     C***********CSDA      ANDLTSAEXD                               S01510094839
018830200610     C           CSDA      ANDLESAEXD                                     094839
018840200610     C           S01510    ANDEQ'Y'                                       S01510
018850200610     C*                                                                   S01510
018860200610     C           SAAT      OREQ 'MA'                                      S01510
018870200610     C           CSDA      ANDLESAED                                      S01510
018880200610     C*                                                                   S01510
018890200610     C           SAAT      ORNE 'MA'                                      S01510
018900200610     C           CSDA      ANDLTSAED                                      S01510
018910200610     C           S01510    ANDEQ'N'                                       S01510
018920200610     C*                                                                   S01510
018930200610     C           SAAT      ORNE 'MA'                                      S01510
018940200610     C           SAAT      ANDNE'DV'                                      S01510
018950200610     C           CSDA      ANDLTSAED                                      S01510
018960200610     C           S01510    ANDEQ'Y'                                       S01510
018970200610     C                     GOTO ENDDEP
018980200610     C                     END
018990200610     C*********************GOTO ENDDEP                                    094748
019000200610     C                     END
019010200610     C*
019020200610     C** MOST TRANSACTIONS WILL HAVE BEEN SELECTED BY THE ABOVE TEST
019030200610     C**
019040200610     C** ONLY BACKVALUATIONS REMAIN AND CPOSH IS USED TO FIND THE
019050200610     C*  CORRECT DATE TO UPDATE. USE THE FULL KEY ON FILE CPOSH
019060200610     C*
019070200610     C***RELEASE*LOCK*ON*RECORD************************************E21715 E23807
019080200610     C***********                                                  E21715 E23807
019090200610     C***********          UPDATCPOSNDF                            E21715 E23807
019100200610     C*
019110200610     C** SET UP KEY WITH BRANCH,CUST. AND ACTION DATE
019120200610     C*
019130200610     C***********          MOVE CSBR      WCSBR                           S01117
019140200610     C                     MOVE CSBA      WCSBA                           S01117
019150200610     C                     MOVE CSCN      WCSCN
019160200610     C*
019170200610     C** If S01510 is active AND event type = DV, use ex-dividend date    S01510
019180200610     C*                                                                   S01510
019190200610     C           S01510    IFEQ 'Y'                                       S01510
019200200610     C           SAAT      ANDEQ'DV'                                      S01510
019210200610     C***********          Z-ADDSAEXD     WCSDA                     S01510094839
019220200610     C           SAEXD     ADD  1         WCSDA                           094839
019230200610     C                     ELSE                                           S01510
019240200610     C                     Z-ADDSAED      WCSDA
019250200610     C                     END                                            S01510
019260200610     C*                                                                   S01510
019270200610     C           CPOHKY    SETLLCPOSH                    77
019280200610      *                                                                   051107
019290200610      ***  If Backvaluation is Equal To the Action Date, it should not    051107
019300200610      ***  be selected for any Action, not just 'PP'.                     051107
019310200610     C*
019320200610     C***IF*77*IS*ON*A*MATCH*IS*FOUND*-*IF*ACTION*TYPE*NOT*PP*SELECT*IT   051107
019330200610     C***********                                                         051107
019340200610     C************IN77     IFEQ '1'                                       051107
019350200610     C***********SAAT      ANDNE'PP'                                      051107
019360200610     C***********                                                         051107
019370200610     C***NOW*READ*RECORD*FROM*CPOSH*FILE*******************************   051107
019380200610     C***********                                                         051107
019390200610     C***********CPOHKY    READECPOSH                    77               051107
019400200610     C***********RECI      IFNE '*'                                       051107
019410200610     C***********          SETON                     66            E21715 E23807
019420200610     C***********          GOTO ENDDEP                                    051107
019430200610     C***********          END                                            051107
019440200610     C***********          END                                            051107
019450200610     C*
019460200610     C***IF VALUE DATE POSITION IS NEEDED FOR DIVIDEND                    095066
019470200610     C*                                                                   095066
019480200610     C           *IN77     IFEQ '1'                                       095066
019490200610     C           SAAT      ANDEQ'DV'                                      095066
019500200610     C           CSE008    ANDEQ'Y'                                       095066
019510200610     C*                                                                   095066
019520200610     C           CPOHKY    READECPOSH                    77               095066
019530200610     C           *IN77     IFEQ '0'                                       095066
019540200610     C           RECI      ANDNE'*'                                       095066
019550200610     C                     GOTO ENDDEP                                    095066
019560200610     C                     END                                            095066
019570200610     C*                                                                   095066
019580200610     C                     END                                            095066
019590200610     C*                                                                   095066
019600200610     C* THIS LEAVES A BACKVALUATION  AGAINST A CUST. POSITION
019610200610     C* ON A DATE PRIOR TO THE SEC.ACTION DATE
019620200610     C*
019630200610     C           RDLOOP    TAG                              **RDLOOP**
019640200610     C                     READPCPOSH                    77
019650200610     C           *IN77     CABEQ'1'       GETIN
019660200610     C           RECI      CABEQ'*'       RDLOOP
019670200610     C           WCSSC     IFNE CSSC
019680200610     C           WCSCN     ORNE CSCN
019690200610     C***********WCSBR     ORNE CSBR                                      S01117
019700200610     C           WCSBA     ORNE CSBA                                      S01117
019710200610     C                     GOTO GETIN
019720200610     C                     END
019730200610     C*
019740200610     C**IF*DATE*IS*LESS*THAN*ACTION*DATE**SELECT*IT********************   S01510
019750200610     C***********                                                         S01510
019760200610     C***********CSDA      IFLT SAED                                      S01510
019770200610     C***********          SETON                     66            E21715 E23807
019780200610     C** The selection is as follows:                                     S01510
019790200610     C** .. if event type is DV AND position date < ex-dividend date      S01510
019800200610     C**       AND S01510 is active                                       S01510
019810200610     C** .. if position date < security action date and S01510 is off     S01510
019820200610     C** .. if position date < security action date and event type is     S01510
019830200610     C**       not DV and S01510 is active                                S01510
019840200610     C*                                                                   S01510
019850200610     C           SAAT      IFEQ 'DV'                                      S01510
019860200610     C***********CSDA      ANDLTSAEXD                               S01510094839
019870200610     C           CSDA      ANDLESAEXD                                     094839
019880200610     C           S01510    ANDEQ'Y'                                       S01510
019890200610     C*                                                                   S01510
019900200610     C           CSDA      ORLT SAED                                      S01510
019910200610     C           S01510    ANDEQ'N'                                       S01510
019920200610     C*                                                                   S01510
019930200610     C           CSDA      ORLT SAED                                      S01510
019940200610     C           SAAT      ANDNE'DV'                                      S01510
019950200610     C           S01510    ANDEQ'Y'                                       S01510
019960200610     C                     GOTO ENDDEP
019970200610     C                     END
019980200610      *                                                                   051107
019990200610      ***  If the Event Date is Equal To the Action Date, it should not   051107
020000200610      ***  be selected for any Action, not just 'PP'.                     051107
020010200610     C*
020020200610     C**IF*DATE*IS*EQUAL*TO*ACTION*DATE*AND*ACTION*TYPE*IS*NOT*=*PP****   051107
020030200610     C**THEN*SELECT*IT*.***********************************************   051107
020040200610     C***********                                                         051107
020050200610     C***********CSDA      IFEQ SAED                                      051107
020060200610     C***********SAAT      ANDNE'PP'                                      051107
020070200610     C***********          SETON                     66            E21715 E23807
020080200610     C***********          GOTO ENDDEP                                    051107
020090200610     C***********          END                                            051107
020100200610     C*
020110200610     C* DATE IS NOT LESS THAN ACTION DATE - READ PREVIOUS
020120200610     C*
020130200610     C                     GOTO RDLOOP
020140200610     C*                                                                   S01486
020150200610     C* CHECK WHETHER PORTFOLIO POSITIONS EXISTED FOR THE SECURITY        S01486
020160200610     C* ON THE SECURITY ACTION EVENT DATE                                 S01486
020170200610     C* SET PORTFOLIO POSITION FLAG                                       S01486
020180200610     C*                                                                   S01486
020190200610     C           ENDDEP    TAG                                            S01486
020200200610     C                     MOVE 'N'       WPPOSN  1                       S01486
020210200610     C*                                                                   S01486
020220200610     C* CHECK IF CUSTOMER POSITION AND IF PM IS PRESENT ON THE SYSTEM     S01486
020230200610     C* OR IF CUSTOMER POSITION AND IF PB IS PRESENT ON THE SYSTEM        CPB001
020240200610     C*                                                                   S01486
020250200610     C           *IN79     IFEQ '0'                                       S01486
020260200610     C           BGPFMG    ANDEQ'Y'                                       S01486
020270200610     C           *IN79     OREQ '0'                                       CPB001
020280200610     C           BGN4ST    ANDEQ'Y'                                       CPB001
020290200610     C*                                                                   S01486
020300200610     C* SET POSITION DATE TO *LOVAL                                       S01486
020310200610     C*                                                                   S01486
020320200610     C***********          MOVE *LOVAL    WWPDAT  50               S01486 189942
020330200610     C                     MOVE CSBA      WWCDPA  3                       189942
020340200610     C*                                                                   S01486
020350200610     C**SET*LOWER*LIMITS ON PMFPSNLL USING CUST. NO/ POSITION DATE S01486 189942
020360200610     C***********                                                  S01486 189942
020370200610     C***********PMFPKY    SETLLPMFPSNLL                           S01486 189942
020380200610     C***********          READ PMFPSNLL                 75        S01486 189942
020390200610     C***********                                                  S01486 189942
020400200610     C* SET LOWER LIMITS ON SECDEPL0 USING CUST. NO/ DEPOT REF            189942
020410200610     C*                                                                   189942
020420200610     C           PMFPKY    SETLLSECDEPL0                                  189942
020430200610     C                     READ SECDEPL0                 75               189942
020440200610     C*                                                                   189942
020450200610     C* CHECK THAT RECORD EXISTS ON THE FILE FOR THE CUSTOMER             S01486
020460200610     C*                                                                   S01486
020470200610     C           *IN75     IFEQ '0'                                       S01486
020480200610     C***********QACNUM    ANDEQCSCN                               S01486 189942
020490200610     C           CDCN      ANDEQCSCN                                      189942
020500200610     C           CDPA      ANDEQCSBA                                      189942
020510200610     C*                                                                   S01486
020520200610     C* CHECK SECURITY ACTION AND POSTING DATE                            S01486
020530200610     C*                                                                   S01486
020540200610     C           SAAT      IFEQ 'MA'                                      S01486
020550200610     C***********QAPDAT    ANDLESAED                               S01486 189942
020560200610     C           DDTE      ANDLESAED                                      189942
020570200610     C           SAAT      OREQ 'DV'                                      099266
020580200610     C***********QAPDAT    ANDLTSAEXD                              099266 189942
020590200610     C           DDTE      ANDLTSAEXD                                     189942
020600200610     C           S01510    ANDEQ'Y'                                       099266
020610200610     C           SAAT      ORNE 'MA'                                      S01486
020620200610     C***********QAPDAT    ANDLTSAED                               S01486 189942
020630200610     C           DDTE      ANDLTSAED                                      189942
020640200610     C           S01510    ANDEQ'N'                                       099266
020650200610     C           SAAT      ORNE 'MA'                                      099266
020660200610     C           SAAT      ANDNE'DV'                                      099266
020670200610     C***********QAPDAT    ANDLTSAED                               099266 189942
020680200610     C           DDTE      ANDLTSAED                                      189942
020690200610     C           S01510    ANDEQ'Y'                                       099266
020700200610     C*                                                                   S01486
020710200610     C** EXECUTE SUBROUTINE SECTIN TO RETRIEVE SECURITY RECORD            S01486
020720200610     C*                                                                   S01486
020730200610     C                     EXSR SECTIN                                    S01486
020740200610     C*                                                                   S01486
020750200610     C* CHECK SECURITY FOR MATURITY EVENT                                 S01486
020760200610     C*                                                                   S01486
020770200610     C           SAAT      IFEQ 'MA'                                      S01486
020780200610     C                     MOVE 'Y'       WPPOSN                          S01486
020790200610     C*                                                                   S01486
020800200610     C**  .... OTHERWISE THIS CUSTOMER POSITION SHOULD NOT BE PROCESSED   S01486
020810200610     C                     ELSE                                           S01486
020820200610     C*                                                                   S01486
020830200610     C** RETURN TO SEARCH FOR NEXT CUSTOMER POSITION                      S01486
020840200610     C                     GOTO GETIN                                     S01486
020850200610     C                     END                                            S01486
020860200610     C                     END                                            S01486
020870200610     C*                                                                   S01486
020880200610     C                     END                                            S01486
020890200610     C                     END                                            S01486
020900200610     C/COPY WNCPYSRC,SE2400C034
020910200610     C*
020920200610     C********** ENDDEP    ENDSR                            **ENDDEP**    S01486
020930200610     C                     ENDSR                                          S01486
020940200610     C*
020950200610      *
020960200610      *****************************************************************
020970200610      /EJECT
020980200610     C********************************************************************S01486
020990200610     C*                                                                   S01486
021000200610     C* GETPTF   - GET PORTFOLIO POSITIONS FOR A SECURITY.                S01486
021010200610     C*                                                                   S01486
021020200610     C           GETPTF    BEGSR                           ** GETPTF **   S01486
021030200610     C*          ******                                                   S01486
021040200610     C*                                                                   S01486
021050200610     C* CHECK THAT THIS IS THE FIRST SECURITY POSITION                    S01486
021060200610     C*                                                                   S01486
021070200610     C           WSPOSN    IFEQ 'Y'                        B1             S01486
021080200610     C*                                                                   S01486
021090200610     C***FOR*GIVIDEND*EVENTS CHECK WHETHER TRADE DATE POSITION EXI S01486 189942
021100200610     C***OTHERWISE*SETTLEMENTS GENERATED AGAINST VALUE DATE POSITI S01486 189942
021110200610     C***********SAAT      IFEQ 'DV'                       B2      S01486 189942
021120200610     C***********          MOVE 'T'       WWTDVA                   S01486 189942
021130200610     C***********          ELSE                            X2      S01486 189942
021140200610     C***********          MOVE 'V'       WWTDVA                   S01486 189942
021150200610     C***********          END                             E2      S01486 189942
021160200610     C***********                                                  S01486 189942
021170200610     C**SET*LOWER*LIMITS*ON CURRENT POSITION FILE. LF/PMCPSSLL     S01486 189942
021180200610     C***********                                                  S01486 189942
021190200610     C***********PMCPSS    SETLLPMCPSSLL                           S01486 189942
021200200610     C*                                                                   189942
021210200610     C* SET LOWER LIMITS ON CURRENT POSITION FILE. LF/CDEPS               189942
021220200610     C*                                                                   189942
021230200610     C           PMCPSS    SETLLCDEPS                                     189942
021240200610     C                     END                             E1             S01486
021250200610     C*                                                                   S01486
021260200610     C* READ CURRENT POSITIONS BY SECURITY FILE                           S01486
021270200610     C*                                                                   S01486
021280200610     C           RDNEXT    TAG                                            S01486
021290200610     C***********PMCPSS    READEPMCPSSLL                 76        S01486 189942
021300200610     C           PMCPSS    READECDEPS                    76               189942
021310200610     C*                                                                   S01486
021320200610     C* DO WHILE RECORDS EXIST FOR THE SECURITY                           S01486
021330200610     C*                                                                   S01486
021340200610     C           *IN76     IFEQ '0'                        B1             S01486
021350200610     C*                                                                   S01486
021360200610     C***********          MOVE QACNUM    WWCNUM                   S01486 189942
021370200610     C***********          MOVE QAPTFR    WWPTFR                   S01486 189942
021380200610     C***********          MOVE QATDSS    WWTDSS                   S01486 189942
021390200610     C                     MOVE CDCN      WWCNUM                          189942
021400200610     C                     MOVE PTFR      WWPTFR                          189942
021410200610     C                     MOVE CDSN      WWTDSS                          189942
021420200610      *                                                                                       CGL031
021430200610      ** Place the retrieve CDCN,CDPA into a work variable                                    CGL031
021440200610      ** to be used in ZATXCLPI/ZATXCLJA later.                                               CGL031
021450200610      *                                                                                       CGL031
021460200610     C**********           Z-ADDCDCN      YCSCN                                       CGL031 CSD027A
021470200610     C                     MOVE CDCN      YCSCN                                              CSD027A
021480200610     C                     MOVELCDPA      YCSBA                                               CGL031
021490200610      *                                                                                       CGL031
021500200610     C*                                                                   S01486
021510200610     C* CHECK SECURITY ACTION AND POSTING DATE                            S01486
021520200610     C*                                                                   S01486
021530200610     C           SAAT      IFEQ 'MA'                       B2             S01486
021540200610     C***********QAPDAT    ANDLESAED                               S01486 189942
021550200610     C           DDTE      ANDLESAED                                      189942
021560200610     C           SAAT      ORNE 'MA'                                      S01486
021570200610     C***********QAPDAT    ANDLTSAED                               S01486 189942
021580200610     C           DDTE      ANDLTSAED                                      189942
021590200610     C           S01510    ANDEQ'N'                                       099266
021600200610     C           SAAT      ORNE 'MA'                                      099266
021610200610     C           SAAT      ANDNE'DV'                                      099266
021620200610     C***********QAPDAT    ANDLTSAED                               099266 189942
021630200610     C           DDTE      ANDLTSAED                                      189942
021640200610     C           S01510    ANDEQ'Y'                                       099266
021650200610     C           SAAT      OREQ 'DV'                                      094839
021660200610     C***********QAPDAT    ANDLESAEXD                              094839 189942
021670200610     C           DDTE      ANDLESAEXD                                     189942
021680200610     C           S01510    ANDEQ'Y'                                       094839
021690200610     C*                                                                   S01486
021700200610     C* VALID RECORD - EXIT TO GENERATE POSITION SETTLEMENTS              S01486
021710200610     C*                                                                   S01486
021720200610     C                     GOTO ENDPTF                                    S01486
021730200610     C                     END                             E2             S01486
021740200610     C*                                                                   S01486
021750200610     C* DETERMINE WHETHER POSITION EXISTED BEFORE SECURITY ACTION         S01486
021760200610     C* SET GREATER THAN ON PMVPOSLL WITH KEY OF CUSTOMER/                S01486
021770200610     C* PORTFOLIO REF./ SECURITY/ SECURITY ACTION DATE                    S01486
021780200610     C*                                                                   S01486
021790200610     C***********          MOVE QACNUM    WWCNUM                   S01486 189942
021800200610     C***********          MOVE QAPTFR    WWPTFR                   S01486 189942
021810200610     C***********          MOVE QATDSS    WWTDSS                   S01486 189942
021820200610     C***********          MOVE SAED      WWPDAT                   S01486 189942
021830200610     C***********                                                  S01486 189942
021840200610     C***********PMVPKY    SETGTPMAPOSLL                           S01486 189942
021850200610     C***********          READPPMAPOSLL                 74        S01486 189942
021860200610     C***********                                                  S01486 189942
021870200610     C                     MOVE CDPA      WWCDPA                          189942
021880200610     C                     MOVE CDCN      WWCNUM                          189942
021890200610     C                     MOVE PTFR      WWPTFR                          189942
021900200610     C                     MOVE CDSN      WWTDSS                          189942
021910200610     C                     MOVE CDPT      WWCDPT                          189942
021920200610     C                     MOVE CDMK      WWCDMK                          189942
021930200610     C                     MOVE SAED      WWDDTE                          189942
021940200610      *                                                                                      251950A
021950200610      ** If S01510 is active and event type is 'DV', use ex-dividend                         251950A
021960200610      ** date.                                                                               251950A
021970200610      *                                                                                      251950A
021980200610     C           S01510    IFEQ 'Y'                                                          251950A
021990200610     C           SAAT      ANDEQ'DV'                                                         251950A
022000200610     C                     MOVE SAEXD     WWDDTE                                             251950A
022010200610     C                     ELSE                                                              251950A
022020200610     C                     MOVE SAED      WWDDTE                                             251950A
022030200610     C                     END                                                               251950A
022040200610     C*                                                                   189942
022050200610     C           PMVPKY    SETGTSECDEPL5                                  189942
022060200610     C                     READPSECDEPL5                 74               189942
022070200610     C*                                                                   189942
022080200610     C* CHECK RECORD EXISTS FOR CUST/PORTFOLIO REFERENCE/SECURITY         S01486
022090200610     C*                                                                   S01486
022100200610     C           *IN74     IFEQ '0'                        B2             S01486
022110200610     C***********QACNUM    ANDEQWWCNUM                             S01486 189942
022120200610     C***********QAPTFR    ANDEQWWPTFR                             S01486 189942
022130200610     C***********QATDSS    ANDEQWWTDSS                             S01486 189942
022140200610     C***********QATVDA    ANDEQWWTDVA                             S01486 189942
022150200610     C           CDCN      ANDEQWWCNUM                                    189942
022160200610     C           PTFR      ANDEQWWPTFR                                    189942
022170200610     C           CDSN      ANDEQWWTDSS                                    189942
022180200610     C           CDPT      ANDEQWWCDPT                                                       251950A
022190200610     C           CDMK      ANDEQWWCDMK                                                       251950A
022200200610     C           CDPA      ANDEQWWCDPA                                                       251950A
022210200610     C*                                                                   S01486
022220200610     C* CHECK SECURITY ACTION                                             S01486
022230200610     C*                                                                   S01486
022240200610     C           SAAT      IFEQ 'MA'                       B3             S01486
022250200610     C*                                                                   S01486
022260200610     C* VALID RECORD - EXIT TO GENERATE POSITION SETTLEMENTS              S01486
022270200610     C*                                                                   S01486
022280200610     C                     GOTO ENDPTF                                    S01486
022290200610     C                     ELSE                            X3             S01486
022300200610     C*                                                                   S01486
022310200610     C* CHECK POSTING DATE IS LESS THAN EVENT DATE                        S01486
022320200610     C*                                                                   S01486
022330200610     C***********QAPDAT    IFLT SAED                       B4      S01486 189942
022340200610     C           DDTE      IFLT SAED                       B4             189942
022350200610     C           SAAT      ANDNE'DV'                                      099266
022360200610     C***********QAPDAT    ORLT SAEXD                              099266 189942
022370200610     C           DDTE      ORLT SAEXD                                     189942
022380200610     C           SAAT      ANDEQ'DV'                                      099266
022390200610     C*                                                                   S01486
022400200610     C* VALID RECORD - EXIT TO GENERATE POSITION SETTLEMENTS              S01486
022410200610     C*                                                                   S01486
022420200610     C                     GOTO ENDPTF                                    S01486
022430200610     C                     END                             E4             S01486
022440200610     C                     END                             E3             S01486
022450200610     C*                                                                   S01486
022460200610     C* READ PREVIOUS RECORD                                              S01486
022470200610     C*                                                                   S01486
022480200610     C***********          READPPMAPOSLL                 74        S01486 189942
022490200610     C                     READPSECDEPL5                 74               189942
022500200610     C*                                                                   S01486
022510200610     C* CHECK RECORD EXISTS FOR CUST/PORTFOLIO REFERENCE/SECURITY         S01486
022520200610     C*                                                                   S01486
022530200610     C           *IN74     IFEQ '0'                        B3             S01486
022540200610     C***********QACNUM    ANDEQWWCNUM                             S01486 189942
022550200610     C***********QAPTFR    ANDEQWWPTFR                             S01486 189942
022560200610     C***********QATDSS    ANDEQWWTDSS                             S01486 189942
022570200610     C***********QATVDA    ANDEQWWTDVA                             S01486 189942
022580200610     C           CDCN      ANDEQWWCNUM                                    189942
022590200610     C           PTFR      ANDEQWWPTFR                                    189942
022600200610     C           CDSN      ANDEQWWTDSS                                    189942
022610200610     C           CDPT      ANDEQWWCDPT                                                       251950A
022620200610     C           CDMK      ANDEQWWCDMK                                                       251950A
022630200610     C           CDPA      ANDEQWWCDPA                                                       251950A
022640200610     C*                                                                   S01486
022650200610     C* RECORD EXISTS - EXIT PROCESS                                      S01486
022660200610     C*                                                                   S01486
022670200610     C                     GOTO ENDPTF                                    S01486
022680200610     C                     END                             E3             S01486
022690200610     C*                                                                   S01486
022700200610     C                     END                             E2             S01486
022710200610     C                     GOTO RDNEXT                                    S01486
022720200610     C                     END                             E1             S01486
022730200610     C*                                                                   S01486
022740200610     C* SET NO MORE POSITIONS TO PROCESS FLAG                             S01486
022750200610     C*                                                                   S01486
022760200610     C                     MOVE 'N'       WPORTP                          S01486
022770200610     C*                                                                   S01486
022780200610     C           ENDPTF    ENDSR                            **ENDPTF**    S01486
022790200610     C*                                                                   S01486
022800200610     C********************************************************************S01486
022810200610      /EJECT                                                              S01486
022820200610      *****************************************************************
022830200610      *                                                               *
022840200610      *  DIVIDN - Subroutine to produce Dividend Account Keys and/or  *
022850200610      *           Position Settlements.                               *
022860200610      *                                                               *
022870200610      *****************************************************************
022880200610      *
022890200610     C           DIVIDN    BEGSR                           ** DIVIDN **
022900200610     C*
022910200610     C** CALCULATE DIVIDEND DUE
022920200610     C*
022930200610     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
022940200610     C** IF S01509 is active, user value ccy instead of nominal ccy       S01509
022950200610     C*
022960200610     C********** S01509    IFEQ 'Y'                                                  S01509 BUG11198
022970200610     C**********           MOVE VLCY      WCURR   3                                  S01509 BUG11198
022980200610     C**********           ELSE                                                      S01509 BUG11198
022990200610     C                     MOVE NMCY      WCURR   3
023000200610     C**********           END                                                       S01509 BUG11198
023010200610     C                     EXSR TG10
023020200610     C*                                                                   S01446
023030200610     C** For Courtage Enhancement, if Autocharge option is 'Y' and        S01446
023040200610     C** charge currency is not blank, update fields                      S01446
023050200610     C*                                                                   S01446
023060200610     C           S01446    IFEQ 'Y'                                       S01446
023070200610     C           BVACOP    ANDEQ'Y'                                       S01446
023080200610     C           BVCHRC    ANDNE*BLANKS                                   S01446
023090200610     C*                                                                   S01446
023100200610     C** Get M/D indicator and spot rate of input ccy from SDCURRPD       S01446
023110200610     C*                                                                   S01446
023120200610     C                     Z-ADD25        WDBAS1  30                      S01446
023130200610     C                     EXSR #LCURR                                    S01446
023140200610     C                     Z-ADDA6SPRT    ZRATE2 138                      S01446
023150200610     C                     MOVE A6MDIN    ZMDI2   1                       S01446
023160200610     C                     Z-ADDTXSPOT    ZRATE1 138                      S01446
023170200610     C                     MOVE TXMDI     ZMDI1   1                       S01446
023180200610     C                     EXSR ZXRATE                                    S01446
023190200610     C                     MOVE ZRATEX    TRATEX 138                      S01446
023200200610     C                     MOVE ZMDIX     TMDIX   1                       S01446
023210200610     C                     END                                            S01446
023220200610      *                                                                   E19610
023230200610      *  FOR DIVIDENDS, CALCULATE CUM-COUPON VALUE USING THE TRADE DATE   E19610
023240200610      *  POSITION INSTEAD OF THE VALUE DATE.                              E19610
023250200610     C** If S01510 is active, the cum-coupon value must be the trade      S01510
023260200610     C** nominal                                                          S01510
023270200610     C*** (Use Value date position if required)                           095066
023280200610     C*                                                                   095066
023290200610      *                                                                   E19610
023300200610     C           S01510    IFEQ 'Y'                                       S01510
023310200610     C           CSE008    IFNE 'Y'                                       095066
023320200610     C                     Z-ADDCSNT      WCUMCP                          S01510
023330200610     C                     ELSE                                           095066
023340200610     C                     Z-ADDCSNV      WCUMCP                          095066
023350200610     C                     END                                            095066
023360200610     C                     ELSE                                           S01510
023370200610     C           CSE008    IFNE 'Y'                                       095066
023380200610     C           CSNT      SUB  CSEX      WCUMCP                          E19610
023390200610     C                     ELSE                                           095066
023400200610     C           CSNV      SUB  CSEX      WCUMCP                          095066
023410200610     C                     END                                            093385
023420200610     C                     END                                            095066
023430200610     C*                                                                   093385
023440200610     C           WPORTP    IFEQ 'Y'                                       S01486
023450200610     C           BGPFMG    ANDEQ'Y'                                       S01486
023460200610     C           WPORTP    OREQ 'Y'                                       CPB001
023470200610     C           BGN4ST    ANDEQ'Y'                                       CPB001
023480200610     C***********QANOML    SUB  QACSEX    WCUMCP                   S01486 189942
023490200610     C********** CDNT      SUB  CSEX      WCUMCP                                     189942 AR877365
023500200610     C           CDNT      SUB  CECN      WCUMCP                                            AR877365
023510200610     C                     END                                            S01486
023520200610     C*********************END                                     S01510 093385
023530200610     C*
023540200610     C* DIVIDEND DUE CALCULATION
023550200610     C* CUM-COUPON MULTIPLIED BY AMOUNT PER UNIT (SAED)
023560200610     C* GIVING WORK (15/4). MULTIPLY BY POWER VALUE AND RESULT IN 13/0
023570200610     C*
023580200610     C*********************Z-ADD0         DC                              E22638
023590200610     C*********************SUB  NMDP      DC      10                      E22638
023600200610     C***********DC        ADD  5         DC      10                      E22638
023610200610     C***********WCUMCP    MULT POWER8,DC WRK154                          E20086
023620200610     C***********WCUMCP    MULT POWER8,DC WRK154 154                E20086E22638
023630200610     C*
023640200610     C***********WRK154    MULT SDAU      WRK154 154                      E16772
023650200610     C***********WRK154    MULT SDUN      WRK158                    E16772E20086
023660200610     C***********WRK154    MULT SDUN      WRK158 158                E20086E22638
023670200610     C***********CDP       ADD  5         DC                              E22638
023680200610     C***********WRK154    MULT POWER8,DC WRK154                          E16772
023690200610     C***********WRK158    MULT POWER8,DC WRK158                    E16772E22638
023700200610     C***********WRK154    DIV  1         WDIVDU 130H                     E16772
023710200610     C***********WRK158    DIV  1         WDIVDU 130H               E16772E22638
023720200610     C*
023730200610     C** IF PRICE BASIS (SECTYD) IS 'P', DIVIDE BY 100
023740200610     C*
023750200610     C***********SPBS      IFEQ 'P'                                       E22638
023760200610     C***********WDIVDU    DIV  100       WDIVDU    H                     E22638
023770200610     C*********************END                                            E22638
023780200610     C** USE SUBROUTINE SCNSD TO CALCULATE DIVIDEND DUE                   E22638
023790200610     C                     Z-ADDWCUMCP    ZNOML                           E22638
023800200610     C                     Z-ADDSDUN      ZPRC                            E22638
023810200610     C***********SPBS      IFEQ 'P'                                E23169 087712
023820200610     C***********          MULT 100       ZPRC                     E23169 087712
023830200610     C***********          END                                     E23169 087712
023840200610     C                     EXSR ZCNSD                                     E22638
023850200610     C                     Z-ADDZCONS     WDIVDU 150                      E22638
023860200610     C** If S01509 is active, and value currency is different from                          BUG11198
023870200610     C** nominal currency, convert coupon amount to value currency                          BUG11198
023880200610     C*                                                                                     BUG11198
023890200610     C           S01509    IFEQ 'Y'                                                         BUG11198
023900200610     C           NMCY      ANDNEVLCY                                                        BUG11198
023910200610     C                     MOVE NMCY      WCURR   3                                         BUG11198
023920200610     C                     EXSR TG10                                                        BUG11198
023930200610     C                     Z-ADDZCDP      ZCDPI                                             BUG11198
023940200610     C                     MOVE VLCY      WCURR   3                                         BUG11198
023950200610     C                     EXSR TG10                                                        BUG11198
023960200610     C                     Z-ADDZCDP      ZCDPO                                             BUG11198
023970200610     C                     MOVE NMCY      ZCCYI                                             BUG11198
023980200610     C                     MOVE VLCY      ZCCYO                                             BUG11198
023990200610     C                     Z-ADDWDIVDU    ZAMTCI                                            BUG11198
024000200610     C*                                                                                     BUG11198
024010200610     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event                     BUG11198
024020200610     C** found, else from SECTYD                                                            BUG11198
024030200610     C*                                                                                     BUG11198
024040200610     C                     MOVE SAAT      WSAAT   2                                         BUG11198
024050200610     C                     MOVE 'XR'      SAAT                                              BUG11198
024060200610     C           SEDKEY    SETLLSEDEVDO                                                     BUG11198
024070200610     C                     READ SEDEVDO                  81                                 BUG11198
024080200610     C           *IN81     IFEQ '0'                                                         BUG11198
024090200610     C           SDSN      ANDEQSASN                                                        BUG11198
024100200610     C           SDET      ANDEQ'XR'                                                        BUG11198
024110200610     C                     Z-ADDSDCE      ZEXCH                                             BUG11198
024120200610     C                     MOVE SDMD      ZMD                                               BUG11198
024130200610     C                     ELSE                                                             BUG11198
024140200610     C                     Z-ADDSEXR      ZEXCH                                             BUG11198
024150200610     C                     MOVE SMDI      ZMD                                               BUG11198
024160200610     C                     ENDIF                                                            BUG11198
024170200610     C                     MOVE WSAAT     SAAT                                              BUG11198
024180200610     C                     EXSR ZCONV                                                       BUG11198
024190200610     C                     Z-ADDZAMTCO    WDIVDU                                            BUG11198
024200200610     C                     ENDIF                                                            BUG11198
024210200610     C/COPY WNCPYSRC,SE2400C001
024220200610     C*
024230200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
024240200610     C*
024250200610     C           AKRI      IFEQ 'Y'
024260200610     C                     MOVE 'H'       WACEVC
024270200610     C*
024280200610     C** SET NEGATIVE IND TO N IF SPLIT NEG ACCRUAL IS NOT N AND
024290200610     C** AND CUM-COUPON VALUE NOT GREATER THAN ZERO
024300200610     C*
024310200610     C           SNAC      IFEQ 'N'
024320200610     C           WCUMCP    ORGT 0
024330200610     C                     MOVE ' '       WACNEG
024340200610     C                     ELSE
024350200610     C                     MOVE 'N'       WACNEG
024360200610     C                     END
024370200610     C                     MOVE 'DI'      WACAMC
024380200610     C                     Z-ADDWDIVDU    EVAM
024390200610     C*
024400200610     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG ACCRUAL IS Y AND
024410200610     C** CUM-COUPON VALUE IS LESS THAN ZERO
024420200610     C*
024430200610     C           WCUMCP    IFLT 0
024440200610     C           SNAC      ANDEQ'Y'
024450200610     C                     Z-SUBEVAM      EVAM
024460200610     C/COPY WNCPYSRC,SE2400C002
024470200610     C                     END
024480200610     C                     EXSR W01
024490200610     C/COPY WNCPYSRC,SE2400C003
024500200610     C                     END
024510200610     C*
024520200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
024530200610     C*
024540200610     C           PSRI      IFEQ 'Y'
024550200610     C/COPY WNCPYSRC,SE2400C004
024560200610     C                     MOVE 'DV'      PEVT
024570200610     C                     Z-ADDWCUMCP    PNMP
024580200610     C           WDIVDU    IFLT 0
024590200610     C                     Z-SUBWDIVDU    PAMD
024600200610     C/COPY WNCPYSRC,SE2400C005
024610200610     C                     ELSE
024620200610     C                     Z-ADDWDIVDU    PAMD
024630200610     C/COPY WNCPYSRC,SE2400C006
024640200610     C                     END
024650200610     C           WCUMCP    IFGT 0
024660200610     C**********           MOVE 'R'       PPRE                            E14704
024670200610     C                     MOVE 'P'       PPRE                            E14704
024680200610     C                     ELSE
024690200610     C**********           MOVE 'P'       PPRE                            E14704
024700200610     C                     MOVE 'R'       PPRE                            E14704
024710200610     C                     END
024720200610     C***********          EXSR W02                                                           233709
024730200610      *                                                                                       233709
024740200610     C                     Z-ADD0         TXNM                                                233709
024750200610     C                     Z-ADD0         TXST                                                233709
024760200610     C                     Z-ADD0         TAXA                                                233709
024770200610     C                     MOVE *BLANKS   TXCY                                                233709
024780200610      *                                                                                       CGL031
024790200610      ** If CGL031 is on                                                                      CGL031
024800200610      *                                                                                       CGL031
024810200610     C           CGL031    IFEQ 'Y'                                                           CGL031
024820200610      *                                                                                       CGL031
024830200610      ** If Security or Security Diary Event is not Taxable, nothing must be calculated and   CGL031
024840200610      ** nothing must be output on SDCSINPD.                                                  CGL031
024850200610      *                                                                                       CGL031
024860200610      ** Check if Security is Taxable                                                         CGL031
024870200610      *                                                                                       CGL031
024880200610     C           SETX      IFEQ 'Y'                                                           CGL031
024890200610     C                     MOVELSAAT      WSAAT                                               CGL031
024900200610     C                     MOVEL'DV'      SAAT                                                CGL031
024910200610      *                                                                                       CGL031
024920200610     C           SEDKEY    SETLLSEDEVDO                                                       CGL031
024930200610     C                     READ SEDEVDO                  81                                   CGL031
024940200610     C           *IN81     IFEQ *OFF                                                          CGL031
024950200610     C           SDSN      ANDEQSASN                                                          CGL031
024960200610     C           SDET      ANDEQ'DV'                                                          CGL031
024970200610      *                                                                                       CGL031
024980200610      ** Check if Diary Event is Taxable                                                      CGL031
024990200610      ** Check also the Classification must be D or S.                                        CGL031
025000200610      *                                                                                       CGL031
025010200610     C           NSETX     IFEQ 'Y'                                                           234577
025020200610     C********** SETX      IFEQ 'Y'                                                    CGL031 234577
025030200610     C********** SAED      ANDLTBJDNWD                                                 CGL031 233709
025040200610     C********** CSNV      ANDGT*ZERO                                                  CGL031 234406
025050200610     C********** C1DI      IFEQ 'D'                                                    CGL031 234440
025060200610     C********** C1DI      OREQ 'S'                                                    CGL031 234440
025070200610     C                     EXSR DIVTAX                                                        CGL031
025080200610     C**********           ENDIF                                                       CGL031 234440
025090200610     C                     ENDIF                                                              CGL031
025100200610      *                                                                                       CGL031
025110200610     C                     MOVELWSAAT     SAAT                                                CGL031
025120200610     C                     ENDIF                                                              CGL031
025130200610     C                     ENDIF                                                              CGL031
025140200610      *                                                                                       CGL031
025150200610     C                     ENDIF                                                              CGL031
025160200610      *                                                                                       CGL031
025170200610     C                     EXSR W02                                                           233709
025180200610     C                     END
025190200610     C/COPY WNCPYSRC,SE2400C007
025200200610     C***********                                                  E21715 E23807
025210200610     C***RESET*EX/DIVIDEND*NOMINAL*FOR*NEXT*DIVIDEND*PERIOD********E21715 E23807
025220200610     C***********                                                  E21715 E23807
025230200610     C***********LCPN      IFEQ SAED                               E21715 E23807
025240200610     C***********                                                  E21715 E23807
025250200610     C***IF*'DV'*EVENT*IS*BACKVALUED*ZEROIZE*EX-DIVIDEND*NOMINAL*FOR21715 E23807
025260200610     C***THIS*POSITION*RECORD*AND*SUBTRACT*THIS*AMOUNT*FROM*THE*NOMINAL15 E23807
025270200610     C***ON*SUBSEQUENT*POSTION*RECORDS*****************************E21715 E23807
025280200610     C***********                                                  E21715 E23807
025290200610     C************IN66     IFEQ '1'                                E21715 E23807
025300200610     C***********          Z-ADDCSEX      SCSEX  130               E21715 E23807
025310200610     C************IN44     DOWEQ'0'                                E21715 E23807
025320200610     C***********          SUB  SCSEX     CSEX                     E21715 E23807
025330200610     C***********          UPDATCPOSNDFH                           E21715 E23807
025340200610     C***********          READ CPOSH                    44        E21715 E23807
025350200610     C************IN44     IFEQ '0'                                E21715 E23807
025360200610     C***********                                                  E21715 E23807
025370200610     C***********WCSSC     IFNE CSSC                               E21715 E23807
025380200610     C***********WCSCN     ORNE CSCN                               E21715 E23807
025390200610     C***********WCSBR     ORNE CSBR                               E21715 E23807
025400200610     C***********          SETON                         44        E21715 E23807
025410200610     C***********          END                                     E21715 E23807
025420200610     C***********                                                  E21715 E23807
025430200610     C***RELEASE*LOCK**********************************************E21715 E23807
025440200610     C************IN44     IFEQ '1'                                E21715 E23807
025450200610     C***********          UPDATCPOSNDFH                           E21715 E23807
025460200610     C***********          END                                     E21715 E23807
025470200610     C***********                                                  E21715 E23807
025480200610     C***********          END                                     E21715 E23807
025490200610     C***********          END                                     E21715 E23807
025500200610     C***********                                                  E21715 E23807
025510200610     C***NORMAL*CASE*-*DIVIDEND*EVENT*IS*NOT*BACKVALUED************E21715 E23807
025520200610     C***********                                                  E21715 E23807
025530200610     C***********          ELSE                                    E21715 E23807
025540200610     C***********          Z-ADD0         CSEX                     E21715 E23807
025550200610     C***********          UPDATCPOSNDF                            E21715 E23807
025560200610     C***********          END                                     E21715 E23807
025570200610     C***********          END                                     E21715 E23807
025580200610     C           ENDDIV    ENDSR                           **ENDDIV**
025590200610      *
025600200610      *****************************************************************                       CGL031
025610200610      /EJECT                                                                                  CGL031
025620200610      *****************************************************************                       CGL031
025630200610      *                                                               *                       CGL031
025640200610      *  DIVTAX - Subroutine to calculate tax for descretionary and   *                       CGL031
025650200610      *           safe custody customers.                             *                       CGL031
025660200610      *                                                               *                       CGL031
025670200610      *****************************************************************                       CGL031
025680200610      *                                                                                       CGL031
025690200610     C           DIVTAX    BEGSR                                                              CGL031
025700200610      *                                                                                       CGL031
025710200610      ** Check if record needs to be taxed.                                                   CGL031
025720200610      *                                                                                       CGL031
025730200610     C                     EXSR CHKTAX                                                        CGL031
025740200610      *                                                                                       CGL031
025750200610      ** Calculate Dividend Due                                                               CGL031
025760200610      *                                                                                       CGL031
025770200610      ** Nominal Decimal places retrieved - Now use CCY to get CCY DP                         CGL031
025780200610      ** If S01509 is active, user value ccy instead of nominal ccy                           CGL031
025790200610      *                                                                                       CGL031
025800200610     C           S01509    IFEQ 'Y'                                                           CGL031
025810200610     C                     MOVE VLCY      WCURR                                               CGL031
025820200610     C                     ELSE                                                               CGL031
025830200610     C                     MOVE NMCY      WCURR                                               CGL031
025840200610     C                     ENDIF                                                              CGL031
025850200610     C                     EXSR TG10                                                          CGL031
025860200610      *                                                                                       CGL031
025870200610      *  For Dividends, calculate CUM-COUPON Value using the Trade Date                       CGL031
025880200610      *  Position instead of the Value Date.                                                  CGL031
025890200610      ** If S01510 is active, the cum-coupon value must be the trade                          CGL031
025900200610      ** nominal                                                                              CGL031
025910200610      *** (Use Value date position if required)                                               CGL031
025920200610      *                                                                                       CGL031
025930200610     C           S01510    IFEQ 'Y'                                                           CGL031
025940200610     C           CSE008    IFNE 'Y'                                                           CGL031
025950200610     C                     Z-ADDCSNT      WCUMCP                                              CGL031
025960200610     C                     ELSE                                                               CGL031
025970200610     C                     Z-ADDCSNV      WCUMCP                                              CGL031
025980200610     C                     ENDIF                                                              CGL031
025990200610     C                     ELSE                                                               CGL031
026000200610     C           CSE008    IFNE 'Y'                                                           CGL031
026010200610     C           CSNT      SUB  CSEX      WCUMCP                                              CGL031
026020200610     C                     ELSE                                                               CGL031
026030200610     C           CSNV      SUB  CSEX      WCUMCP                                              CGL031
026040200610     C                     ENDIF                                                              CGL031
026050200610     C                     ENDIF                                                              CGL031
026060200610      *                                                                                       CGL031
026070200610     C           WPORTP    IFEQ 'Y'                                                           CGL031
026080200610     C           BGPFMG    ANDEQ'Y'                                                           CGL031
026090200610     C           WPORTP    OREQ 'Y'                                                           CGL031
026100200610     C           BGN4ST    ANDEQ'Y'                                                           CGL031
026110200610     C           CDNT      SUB  CSEX      WCUMCP                                              CGL031
026120200610     C                     ENDIF                                                              CGL031
026130200610      *                                                                                       CGL031
026140200610      ** Dividend Due calculation                                                             CGL031
026150200610      ** CUM-COUPON multiplied by Amount per unit (SAED)                                      CGL031
026160200610      ** Giving Work (15/4). Multiply by Power Value and result in 13/0                       CGL031
026170200610      *                                                                                       CGL031
026180200610      ** Use Subroutine SCNSD to Calculate Dividend Due                                       CGL031
026190200610      *                                                                                       CGL031
026200200610     C                     Z-ADDWCUMCP    ZNOML                                               CGL031
026210200610     C                     Z-ADDSDUN      ZPRC                                                CGL031
026220200610     C                     EXSR ZCNSD                                                         CGL031
026230200610     C                     Z-ADDZCONS     WDIVDU                                              CGL031
026240200610      *                                                                                       CGL031
026250200610      ** If no record found, no tax is calculated                                             CGL031
026260200610      *                                                                                       CGL031
026270200610      ** Calculate the Tax Amount for the Dividend                                            CGL031
026280200610      ** Output Information on SDCSINPD file                                                  CGL031
026290200610      *                                                                                       CGL031
026300200610     C           WNOTAX    IFEQ ' '                                                           CGL031
026310200610     C                     EXSR DVTXCL                                                        CGL031
026320200610      *                                                                                       CGL031
026330200610      ***Output*Tax*Account*Keys***************************************                CGL031 233709
026340200610      *****************************************************************                CGL031 233709
026350200610     C**********           EXSR W04                                                    CGL031 233709
026360200610     C                     ENDIF                                                              CGL031
026370200610      *                                                                                       CGL031
026380200610     C                     ENDSR                                                              CGL031
026390200610      *****************************************************************                       CGL031
026400200610      /EJECT                                                                                  CGL031
026410200610      *****************************************************************                       CGL031
026420200610      *                                                               *                       CGL031
026430200610      *  DVTXCL - Subroutine to calculate tax for the Dividend and to *                       CGL031
026440200610      *           Output Information on SDCSINPD                      *                       CGL031
026450200610      *                                                               *                       CGL031
026460200610      *****************************************************************                       CGL031
026470200610      *                                                                                       CGL031
026480200610     C           DVTXCL    BEGSR                                                              CGL031
026490200610      *                                                                                       CGL031
026500200610      ** Initialise work variables                                                            CGL031
026510200610      *                                                                                       CGL031
026520200610     C***********          Z-ADD0         WTTXSR 150                                   CGL031 233709
026530200610     C***********          Z-ADD0         WTTXSS 150                                   CGL031 233709
026540200610     C***********          Z-ADD0         WTTXSC 150                                   CGL031 233709
026550200610     C***********          Z-ADD0         WTTXSB 150                                   CGL031 233709
026560200610     C***********          Z-ADD0         WTNINT 150                                   CGL031 233709
026570200610     C***********          Z-ADD0         WTNINS 150                                   CGL031 233709
026580200610     C***********          Z-ADD0         WTNINC 150                                   CGL031 233709
026590200610     C***********          Z-ADD0         WTNINB 150                                   CGL031 233709
026600200610     C                     Z-ADD0         TXNM                                                233709
026610200610     C                     Z-ADD0         TXST                                                233709
026620200610     C                     Z-ADD0         TAXA                                                233709
026630200610     C                     MOVE *BLANKS   TXCY                                                233709
026640200610     C                     MOVE ' '       WTXPI   1                                           CGL031
026650200610     C                     MOVE ' '       WTXJA   1                                           CGL031
026660200610      *                                                                                       CGL031
026670200610     C                     MOVE YCSCN     @@CUST                                              CGL031
026680200610      *                                                                                       CGL031
026690200610     C                     CALL 'ZATXCLPI'                                                    CGL031
026700200610      ** Input                                                                                CGL031
026710200610     C                     PARM 'S'       @@MODI                                              CGL031
026720200610     C                     PARM SASN      @@TRRF                                              CGL031
026730200610     C                     PARM YCSBA     @@BRCA                                              CGL031
026740200610     C                     PARM           @@CUST                                              CGL031
026750200610     C                     PARM *ZERO     @@STRD                                              CGL031
026760200610     C                     PARM *ZERO     @@ENDD                                              CGL031
026770200610     C                     PARM WDIVDU    @@TOTI                                              CGL031
026780200610     C                     PARM WTRAB     @@TAXR                                              CGL031
026790200610     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
026800200610     C                     PARM NMCY      @@OCCY                                              233568
026810200610     C                     PARM *BLANKS   PINTH   1                                           CER048
026820200610      ** Output                                                                               CGL031
026830200610     C                     PARM           @@IAED                                              CGL031
026840200610     C                     PARM           @@TAXA                                              CGL031
026850200610     C                     PARM           @@TOTO                                              CGL031
026860200610     C                     PARM           @@TXCY                                              CGL031
026870200610     C                     PARM           @@CTAX                                              CGL031
026880200610     C                     PARM           @@TXBS                                              CGL031
026890200610     C                     PARM           @@WTAC                                              CGL031
026900200610     C                     PARM           @@COLC                                              CGL031
026910200610     C                     PARM           @@STAT                                              CGL031
026920200610     C                     PARM           @@TRTE                                              CGL031
026930200610     C                     PARM           @@TXR1                                              CGL031
026940200610     C**********           PARM *ZEROS    PSTXB   20                                 CER048 BUG22911
026950200610     C**********           PARM *ZEROS    PSTAC  100                                 CER048 BUG22911
026960200610     C**********           PARM *ZEROS    PSTTR   64                                 CER048 BUG22911
026970200610     C**********           PARM *BLANKS   PSTTP   1                                  CER048 BUG22911
026980200610     C**********           PARM *ZEROS    PSTXA  150                                 CER048 BUG22911
026990200610     C                     PARM           @@KEY                                               CGL031
027000200610     C                     PARM           @@FILE                                              CGL031
027010200610     C                     PARM           @@RTRN                                              CGL031
027020200610     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
027030200610      *                                                                                       CGL031
027040200610     C                     SELEC                                                              CGL031
027050200610      *                                                                                       CGL031
027060200610      ** If return code = Error.                                                              CGL031
027070200610      *                                                                                       CGL031
027080200610     C           @@RTRN    WHEQ 'ERROR'                                                       CGL031
027090200610     C                     MOVE @@FILE    DBFILE                                              CGL031
027100200610     C                     MOVE @@KEY     DBKEY                                               CGL031
027110200610     C                     Z-ADD60        DBASE                                               CGL031
027120200610     C                     MOVE *ON       *INU7                                               CGL031
027130200610     C                     MOVE *ON       *INU8                                               CGL031
027140200610     C                     EXSR *PSSR                                                         CGL031
027150200610     C                     GOTO EAUDIT                                                        CGL031
027160200610      *                                                                                       CGL031
027170200610      ** If return code = Private Individual                                                  CGL031
027180200610      *                                                                                       CGL031
027190200610     C           @@RTRN    WHNE 'JOINT'                                                       CGL031
027200200610      *                                                                                       CGL031
027210200610     C           @@TOTO    IFNE *ZERO                                                         CGL031
027220200610     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
027230200610     C           @@STAT    OREQ 'DISCL'                                                       CGL031
027240200610     C           @@STAT    OREQ 'SELF'                                                        CGL031
027250200610      *                                                                                       CGL031
027260200610     C                     MOVE 'Y'       WTXPI                                               CGL031
027270200610     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
027280200610     C                     MOVE S1CTTA    KCSIS                                               236815
027290200610     C                     MOVE @@CTAX    KCTRT                                               CGL031
027300200610      *                                                                                       CGL031
027310200610     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
027320200610     C           *IN61     IFEQ *OFF                                                          CGL031
027330200610      *                                                                                       CGL031
027340200610     C                     SELEC                                                              CGL031
027350200610     C           TCTXCM    WHEQ 1                                                             CGL031
027360200610     C********** *IN80     OREQ *ON                                                    CGL031 236815
027370200610     C           SWHTFD    OREQ 'N'                                                           236815
027380200610     C********** S1RASO    OREQ 0                                                      CGL031 234813
027390200610     C           UTXRSR    OREQ 0                                                             234813
027400200610     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
027410200610      *                                                                                       CGL031
027420200610     C           TCTXCM    WHEQ 2                                                             CGL031
027430200610     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
027440200610     C********** @@TOTI    SUB  WTAXA     @@TAXA                                       CGL031 236696
027450200610     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
027460200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
027470200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
027480200610     C                     DIV  100       WTAXA                                               236815
027490200610     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236696
027500200610     C                     MULT @@TAXR    @@TAXA                                              CGL031
027510200610     C                     DIV  100       @@TAXA    H                                         CGL031
027520200610     C           @@TAXA    IFLT 0                                                             CGL031
027530200610     C                     Z-ADD0         @@TAXA                                              CGL031
027540200610     C                     ENDIF                                                              CGL031
027550200610      *                                                                                       CGL031
027560200610     C           TCTXCM    WHEQ 3                                                             CGL031
027570200610     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
027580200610     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
027590200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
027600200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
027610200610     C                     DIV  100       WTAXA                                               236815
027620200610     C                     SUB  WTAXA     @@TAXA                                              CGL031
027630200610     C           @@TAXA    IFLT 0                                                             CGL031
027640200610     C                     Z-ADD0         @@TAXA                                              CGL031
027650200610     C                     ENDIF                                                              CGL031
027660200610      *                                                                                       CGL031
027670200610     C           TCTXCM    WHEQ 4                                                             CGL031
027680200610     C                     Z-ADD0         @@TAXA                                              CGL031
027690200610     C                     ENDSL                                                              CGL031
027700200610      *                                                                                       CGL031
027710200610     C                     ENDIF                                                              CGL031
027720200610      *                                                                                       CGL031
027730200610      ** Write record to SDCSINPD                                                             CGL031
027740200610      *                                                                                       CGL031
027750200610     C                     EXSR CSINSR                                                        CGL031
027760200610      *                                                                                       CGL031
027770200610     C                     ENDIF                                                              CGL031
027780200610     C                     ENDIF                                                              CGL031
027790200610      *                                                                                       CGL031
027800200610      ** If return code = Joint Account                                                       CGL031
027810200610      *                                                                                       CGL031
027820200610     C           @@RTRN    WHEQ 'JOINT'                                                       CGL031
027830200610     C                     MOVE YCSCN     KJANO   6                                           CGL031
027840200610      *                                                                                       CGL031
027850200610     C           KJANO     SETLLSDJACCLB                                                      CGL031
027860200610     C           KJANO     READESDJACCLB                 60                                   CGL031
027870200610      *                                                                                       CGL031
027880200610     C           *IN60     DOWEQ*OFF                                                          CGL031
027890200610      *                                                                                       CGL031
027900200610     C                     CALL 'ZATXCLJA'                                                    CGL031
027910200610      ** Input                                                                                CGL031
027920200610     C                     PARM 'S'       @@MODI                                              CGL031
027930200610     C                     PARM SASN      @@TRRF                                              CGL031
027940200610     C                     PARM YCSBA     @@BRCA                                              CGL031
027950200610     C                     PARM JCJANO    @@JANO  6                                           CGL031
027960200610     C                     PARM JCCUST    @@CUST                                              CGL031
027970200610     C                     PARM JCNAHO    @@NARF 10                                           CGL031
027980200610     C                     PARM JCINVP    @@INVP 10                                           CGL031
027990200610     C                     PARM JCPAHT    @@PAHT  1                                         BUG26839
028000200610     C                     PARM *ZERO     @@STRD                                              CGL031
028010200610     C                     PARM *ZERO     @@ENDD                                              CGL031
028020200610     C                     PARM WDIVDU    @@TOTI                                              CGL031
028030200610     C                     PARM WTRAB     @@TAXR                                              CGL031
028040200610     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
028050200610     C                     PARM NMCY      @@OCCY                                              233568
028060200610     C                     PARM *BLANKS   PINTH                                               CER048
028070200610      ** Output                                                                               CGL031
028080200610     C                     PARM           @@IAED                                              CGL031
028090200610     C                     PARM           @@TAXA                                              CGL031
028100200610     C                     PARM           @@TOTO                                              CGL031
028110200610     C                     PARM           @@TXCY                                              CGL031
028120200610     C                     PARM           @@CTAX                                              CGL031
028130200610     C                     PARM           @@TXBS                                              CGL031
028140200610     C                     PARM           @@WTAC                                              CGL031
028150200610     C                     PARM           @@COLC                                              CGL031
028160200610     C                     PARM           @@STAT                                              CGL031
028170200610     C                     PARM           @@TRTE                                              CGL031
028180200610     C                     PARM           @@TXR1                                              CGL031
028190200610     C                     PARM           @@JAMG  1                                           CGL031
028200200610     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
028210200610     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
028220200610     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
028230200610     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
028240200610     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
028250200610     C                     PARM           @@KEY                                               CGL031
028260200610     C                     PARM           @@FILE                                              CGL031
028270200610     C                     PARM           @@RTRN                                              CGL031
028280200610     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
028290200610      *                                                                                       CGL031
028300200610      ** If return code = Error.                                                              CGL031
028310200610      *                                                                                       CGL031
028320200610     C           @@RTRN    IFEQ 'ERROR'                                                       CGL031
028330200610     C                     MOVE @@FILE    DBFILE                                              CGL031
028340200610     C                     MOVE @@KEY     DBKEY                                               CGL031
028350200610     C                     Z-ADD61        DBASE                                               CGL031
028360200610     C                     MOVE *ON       *INU7                                               CGL031
028370200610     C                     MOVE *ON       *INU8                                               CGL031
028380200610     C                     EXSR *PSSR                                                         CGL031
028390200610     C                     GOTO EAUDIT                                                        CGL031
028400200610     C                     ENDIF                                                              CGL031
028410200610      *                                                                                       CGL031
028420200610     C           @@TOTO    IFNE *ZERO                                                         CGL031
028430200610     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
028440200610     C           @@STAT    OREQ 'DISCL'                                                       CGL031
028450200610     C           @@STAT    OREQ 'SELF '                                                       CGL031
028460200610      *                                                                                       CGL031
028470200610     C                     MOVE 'Y'       WTXJA                                               CGL031
028480200610     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
028490200610     C                     MOVE S1CTTA    KCSIS                                               236815
028500200610     C                     MOVE @@CTAX    KCTRT                                               CGL031
028510200610      *                                                                                       CGL031
028520200610     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
028530200610     C           *IN61     IFEQ *OFF                                                          CGL031
028540200610      *                                                                                       CGL031
028550200610     C                     SELEC                                                              CGL031
028560200610     C           TCTXCM    WHEQ 1                                                             CGL031
028570200610     C********** *IN80     OREQ *ON                                                    CGL031 236815
028580200610     C           SWHTFD    OREQ 'N'                                                           236815
028590200610     C********** S1RASO    OREQ 0                                                      CGL031 234813
028600200610     C           UTXRSR    OREQ 0                                                             234813
028610200610     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
028620200610      *                                                                                       CGL031
028630200610     C           TCTXCM    WHEQ 2                                                             CGL031
028640200610     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
028650200610     C********** @@TOTI    SUB  WTAXA     @@TAXA                                       CGL031 236696
028660200610     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
028670200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
028680200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
028690200610     C           S1RASO    MULT @@TOTO    WTAXA                                               236815
028700200610     C                     DIV  100       WTAXA                                               236815
028710200610     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236696
028720200610     C                     MULT @@TAXR    @@TAXA                                              CGL031
028730200610     C                     DIV  100       @@TAXA    H                                         CGL031
028740200610     C           @@TAXA    IFLT 0                                                             CGL031
028750200610     C                     Z-ADD0         @@TAXA                                              CGL031
028760200610     C                     ENDIF                                                              CGL031
028770200610      *                                                                                       CGL031
028780200610     C           TCTXCM    WHEQ 3                                                             CGL031
028790200610     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
028800200610     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
028810200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
028820200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
028830200610     C                     DIV  100       WTAXA                                               236815
028840200610     C                     SUB  WTAXA     @@TAXA                                              CGL031
028850200610     C           @@TAXA    IFLT 0                                                             CGL031
028860200610     C                     Z-ADD0         @@TAXA                                              CGL031
028870200610     C                     ENDIF                                                              CGL031
028880200610      *                                                                                       CGL031
028890200610     C           TCTXCM    WHEQ 4                                                             CGL031
028900200610     C                     Z-ADD0         @@TAXA                                              CGL031
028910200610     C                     ENDSL                                                              CGL031
028920200610      *                                                                                       CGL031
028930200610     C                     ENDIF                                                              CGL031
028940200610      *                                                                                       CGL031
028950200610      ** Write record to SDCSINPD                                                             CGL031
028960200610      *                                                                                       CGL031
028970200610     C                     EXSR CSINSR                                                        CGL031
028980200610      *                                                                                       CGL031
028990200610     C                     ENDIF                                                              CGL031
029000200610     C                     ENDIF                                                              CGL031
029010200610      *                                                                                       CGL031
029020200610     C           @@RTRN    IFEQ 'NOTAX'                                                       CGL031
029030200610     C           @@RTRN    OREQ 'TAXAB'                                                       CGL031
029040200610     C           KJANO     READESDJACCLB                 60                                   CGL031
029050200610     C                     ENDIF                                                              CGL031
029060200610      *                                                                                       CGL031
029070200610      ** If @@RTRN = Last, end loop                                                           CGL031
029080200610      *                                                                                       CGL031
029090200610     C           @@RTRN    IFEQ 'LAST'                                                        CGL031
029100200610     C                     MOVE *ON       *IN60                                               CGL031
029110200610     C                     ENDIF                                                              CGL031
029120200610      *                                                                                       CGL031
029130200610     C                     ENDDO                                                              CGL031
029140200610      *                                                                                       CGL031
029150200610     C                     ENDSL                                                              CGL031
029160200610      *                                                                                       CGL031
029170200610     C           ENDDVT    ENDSR                                                              CGL031
029180200610      *****************************************************************
029190200610      /EJECT
029200200610      *****************************************************************
029210200610      *                                                               *
029220200610      *  COUPON - Subroutine to produce Coupon Account Keys and/or    *
029230200610      *           Position Settlements.                               *
029240200610      *                                                               *
029250200610      *****************************************************************
029260200610      *
029270200610     C           COUPON    BEGSR                           ** COUPON **
029280200610     C*                                                                   E15549
029290200610     C***USE*LAST*COUPON*DATE*FROM*THE*SECURITY*ACTION************ E15549 E21715
029300200610     C***********                                                  E15549 E21715
029310200610     C***********          Z-ADDSALCCP    LCPN                     E15549 E21715
029320200610     C*
029330200610     C** CALCULATE INTEREST DUE VIA P/ZACCRC FOR SECURITY
029340200610     C*  FROM DATE IS LAST COUPON / TO DATE IS EVENT DATE.
029350200610     C*  GET NOMINAL CCY DEC PLACES FROM TABTG10 FIRST (CDP)              E15549
029360200610     C*                                                                   E15549
029370200610     C                     MOVE NMCY      WCURR   3                       E15549
029380200610     C                     EXSR TG10                                      E15549
029390200610      *                                                                   S01486
029400200610      * SAVE_NO_OF_DECIMAL_PLACES.                                        S01486
029410200610     C           BGPFMG    IFEQ 'Y'                                       S01486
029420200610     C           BGN4ST    OREQ 'Y'                                       CPB001
029430200610     C           *LIKE     DEFN CDP       WWCDP                           S01486
029440200610     C                     Z-ADDCDP       WWCDP                           S01486
029450200610     C                     END                                            S01486
029460200610     C*
029470200610     C** WHEN PARM ZAB IS 'A' , INTEREST IS CALCULATED AFTER CHANGES
029480200610     C*
029490200610     C*                                                                   S01486
029500200610     C** IF SETTLEMENTS BASED ON PORTFOLIO POSITIONS USE STANDARD PM      S01486
029510200610     C** SUBROUTINES TO CALCULATE ACCRUAL AMOUNT                          S01486
029520200610     C           WPORTP    IFEQ 'Y'                                       S01486
029530200610     C           BGPFMG    ANDEQ'Y'                                       S01486
029540200610     C           WPORTP    OREQ 'Y'                                       CPB001
029550200610     C           BGN4ST    ANDEQ'Y'                                       CPB001
029560200610     C*                                                                   S01486
029570200610     C** IF THE PROCESSING TYPE FROM LF/INVTP IS NOT EQUAL TO 6 IE.       S01486
029580200610     C** THIS IS NOT A SCHULDSCHEIN SECURITY                              S01486
029590200610     C           PROT      IFNE '6'                                       S01486
029600200610     C                     Z-ADDWCUMCP    ZAMTP                           S01486
029610200610     C                     Z-ADDSALCCP    ZFMDAT                          S01486
029620200610     C                     Z-ADDSAED      ZTODAT                          S01486
029630200610     C                     Z-ADDSAED      NCD     50                      S01486
029640200610     C***********          MOVELQATDSS    ZSSNM                    S01486 189942
029650200610     C                     MOVELCDSN      ZSSNM                           189942
029660200610     C                     Z-ADDWWCDP     A6NBDP                          S01486
029670200610     C*                                                                   S01486
029680200610     C** CALCULATE THE ACCRUED INTEREST FROM THE LAST COUPON DATE TO      S01486
029690200610     C** THE EVENT CONTROL DATE AS PER STANDARD SUBROUTINE ZAINSH         S01486
029700200610     C                     EXSR ZAINSH                                    S01486
029710200610     C                     END                                            S01486
029720200610     C*                                                                   S01486
029730200610     C** IF THE PROCESSING TYPE FROM LF/INVTP IS EQUAL TO 6 IE.           S01486
029740200610     C** THIS IS A SCHULDSCHEIN SECURITY                                  S01486
029750200610     C           PROT      IFEQ '6'                                       S01486
029760200610     C                     Z-ADDSALCCP    ZFMDAT                          S01486
029770200610     C                     Z-ADDSAED      ZTODAT                          S01486
029780200610     C                     Z-ADDSAED      NCD                             S01486
029790200610     C***********          Z-ADDQACNUM    XCUST   60               S01486 189942
029800200610     C***********          MOVELQAPTFR    ZPTRF                    S01486 189942
029810200610     C***********          MOVELQATDSS    ZSSNM                    S01486 189942
029820200610     C***********          MOVELQATVDA    ZTVBS                    S01486 189942
029830200610     C                     MOVE CDPA      ZCDPA                           189942
029840200610     C**********           Z-ADDCDCN      XCUST   60                                   189942 CSD027
029850200610     C                     MOVE CDCN      XCUST   6                                           CSD027
029860200610     C                     MOVELPTFR      ZPTRF                           189942
029870200610     C                     MOVELCDSN      ZSSNM                           189942
029880200610     C**********           Z-ADDCDPT      ZCDDP                                        189942 CSD027
029890200610     C                     MOVE CDPT      ZCDDP                                               CSD027
029900200610     C                     MOVELCDMK      ZCDMK                           189942
029910200610     C                     Z-ADDWWCDP     A6NBDP                          S01486
029920200610     C*                                                                   S01486
029930200610     C** CALCULATE THE ACCRUED INTEREST FROM THE LAST COUPON DATE         S01486
029940200610     C** TO THE EVENT CONTROL DATE AS PER STANDARD SUBROUTINE ZAISCH      S01486
029950200610     C                     EXSR ZAISCH                                    S01486
029960200610     C                     END                                            S01486
029970200610     C*                                                                   S01486
029980200610     C                     Z-ADDZTOAI     ZINTDU                          S01486
029990200610     C*                                                                   S01486
030000200610     C** WHEN PARM ZAB IS 'A' , INTEREST IS CALCULATED AFTER CHANGES      S01486
030010200610     C*                                                                   S01486
030020200610     C                     ELSE                                           S01486
030030200610     C***********          UNLCKLDA                                       S01117
030040200610     C                     MOVE 'A'       ZAB
030050200610     C/COPY WNCPYSRC,SE2400C032
030060200610     C                     CALL 'ZACCRC'
030070200610     C***********          PARM           LCPN                            E21715
030080200610     C                     PARM           SALCCP                          E21715
030090200610     C                     PARM           SAED
030100200610     C***********          PARM           CSBR                            S01117
030110200610     C                     PARM           CSBA                            S01117
030120200610     C***********          PARM           CSCN                            E37051
030130200610     C                     PARM           ZCUST                           E37051
030140200610     C                     PARM           CSSC
030150200610     C                     PARM           CDP
030160200610     C                     PARM           ZINTDU 150
030170200610     C                     PARM           ZAB     1
030180200610     C**********           PARM           WU8     1
030190200610      *                                                                                    AR1001183
030200200610     C**********                                                                AR1001183 AR1001183A
030210200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
030220200610     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
030230200610      ********** FRATE     IFLE 0                                               AR1001183 AR1001183A
030240200610     C***The*following*field*set2*PAMD*to*zero                                  AR1001183 AR1001183A
030250200610     C**********           Z-ADD0         ZINTDU                                AR1001183 AR1001183A
030260200610     C**********           ENDIF                                                AR1001183 AR1001183A
030270200610      **********           ENDIF                                                AR1001183 AR1001183A
030280200610     C/COPY WNCPYSRC,SE2400C033
030290200610     C*
030300200610      *   U7 AND U8 OFF IF NO DATABASE ERROR DURING ZACCR PROCESSING      S01447
030310200610      *   BUT DBPGM NEEDS TO RESET                                        S01447
030320200610      *                                                                   S01447
030330200610     C           *INU7     IFEQ '0'                                       S01447
030340200610     C           *INU8     ANDEQ'0'                                       S01447
030350200610     C           *LOCK     IN   LDA                                       S01447
030360200610     C                     MOVE *BLANKS   DBPGM                           S01447
030370200610     C                     MOVEL'SE2400'  DBPGM                           S01447
030380200610     C                     OUT  LDA                                       S01447
030390200610     C                     END                                            S01447
030400200610     C                     END                                            S01486
030410200610     C/COPY WNCPYSRC,SE2400C008
030420200610     C*                                                                   S01509
030430200610     C** If S01509 is active, and value currency is different from        S01509
030440200610     C** nominal currency, convert coupon amount to value currency        S01509
030450200610     C*                                                                   S01509
030460200610     C           S01509    IFEQ 'Y'                                       S01509
030470200610     C           NMCY      ANDNEVLCY                                      S01509
030480200610     C                     MOVE NMCY      WCURR   3                       S01509
030490200610     C                     EXSR TG10                                      S01509
030500200610     C                     Z-ADDZCDP      ZCDPI                           S01509
030510200610     C                     MOVE VLCY      WCURR   3                       S01509
030520200610     C                     EXSR TG10                                      S01509
030530200610     C                     Z-ADDZCDP      ZCDPO                           S01509
030540200610     C                     MOVE NMCY      ZCCYI                           S01509
030550200610     C                     MOVE VLCY      ZCCYO                           S01509
030560200610     C                     Z-ADDZINTDU    ZAMTCI                          S01509
030570200610     C*                                                                   S01509
030580200610     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event   S01509
030590200610     C** found, else from SECTYD                                          S01509
030600200610     C*                                                                   S01509
030610200610     C                     MOVE SAAT      WSAAT   2                       S01509
030620200610     C                     MOVE 'XR'      SAAT                            S01509
030630200610     C           SEDKEY    SETLLSEDEVDO                                   S01509
030640200610     C                     READ SEDEVDO                  81               S01509
030650200610     C           *IN81     IFEQ '0'                                       S01509
030660200610     C           SDSN      ANDEQSASN                                      S01509
030670200610     C           SDET      ANDEQ'XR'                                      S01509
030680200610     C                     Z-ADDSDCE      ZEXCH                           S01509
030690200610     C                     MOVE SDMD      ZMD                             S01509
030700200610     C                     ELSE                                           S01509
030710200610     C                     Z-ADDSEXR      ZEXCH                           S01509
030720200610     C                     MOVE SMDI      ZMD                             S01509
030730200610     C                     END                                            S01509
030740200610     C                     MOVE WSAAT     SAAT                            S01509
030750200610     C                     EXSR ZCONV                                     S01509
030760200610     C                     Z-ADDZAMTCO    ZINTDU                          S01509
030770200610     C                     END                                            S01509
030780200610     C*                                                                   S01446
030790200610     C** For Courtage Enhancement, if Autocharge option is 'Y' and        S01446
030800200610     C** charge currency is not blank, update fields                      S01446
030810200610     C*                                                                   S01446
030820200610     C           S01446    IFEQ 'Y'                                       S01446
030830200610     C           BVACOP    ANDEQ'Y'                                       S01446
030840200610     C           BVCHRC    ANDNE*BLANKS                                   S01446
030850200610     C*                                                                   S01446
030860200610     C** Get M/D indicator and spot rate of input ccy from SDCURRPD       S01446
030870200610     C*                                                                   S01446
030880200610     C                     Z-ADD26        WDBAS1                          S01446
030890200610     C                     EXSR #LCURR                                    S01446
030900200610     C                     Z-ADDA6SPRT    ZRATE2                          S01446
030910200610     C                     MOVE A6MDIN    ZMDI2                           S01446
030920200610     C                     Z-ADDTXSPOT    ZRATE1                          S01446
030930200610     C                     MOVE TXMDI     ZMDI1                           S01446
030940200610     C                     EXSR ZXRATE                                    S01446
030950200610     C                     MOVE ZRATEX    TRATEX                          S01446
030960200610     C                     MOVE ZMDIX     TMDIX                           S01446
030970200610     C                     END                                            S01446
030980200610      *                                                                   S01447
030990200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
031000200610     C*
031010200610     C           AKRI      IFEQ 'Y'
031020200610     C                     MOVE 'C'       WACEVC
031030200610     C           SNAC      IFEQ 'N'
031040200610     C           WCUMCP    ORGT 0
031050200610     C                     MOVE ' '       WACNEG
031060200610     C                     ELSE
031070200610     C                     MOVE 'N'       WACNEG
031080200610     C                     END
031090200610     C                     MOVE 'DI'      WACAMC
031100200610     C                     Z-ADDZINTDU    EVAM
031110200610     C           ZINTDU    IFLT 0
031120200610     C           SNAC      ANDEQ'Y'
031130200610     C                     Z-SUBEVAM      EVAM
031140200610     C/COPY WNCPYSRC,SE2400C009
031150200610     C                     END
031160200610     C                     EXSR W01
031170200610     C/COPY WNCPYSRC,SE2400C010
031180200610     C                     END
031190200610     C*
031200200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
031210200610     C*
031220200610     C           PSRI      IFEQ 'Y'
031230200610     C                     MOVE 'CP'      PEVT
031240200610     C                     Z-ADDWCUMCP    PNMP
031250200610     C           ZINTDU    IFLT 0
031260200610     C                     Z-SUBZINTDU    PAMD
031270200610     C/COPY WNCPYSRC,SE2400C011
031280200610     C**********           MOVE 'P'       PPRE                            E14704
031290200610     C                     MOVE 'R'       PPRE                            E14704
031300200610     C                     ELSE
031310200610     C                     Z-ADDZINTDU    PAMD
031320200610     C/COPY WNCPYSRC,SE2400C012
031330200610     C**********           MOVE 'R'       PPRE                            E14704
031340200610     C                     MOVE 'P'       PPRE                            E14704
031350200610     C                     END
031360200610      *                                                                                       233709
031370200610     C                     Z-ADD0         TXNM                                                233709
031380200610     C                     Z-ADD0         TXST                                                233709
031390200610     C                     Z-ADD0         TAXA                                                233709
031400200610     C                     MOVE *BLANKS   TXCY                                                233709
031410200610      *                                                                                       233709
031420200610      ** If CGL031 is on and security is taxable and classification is D or S                 233709
031430200610      ** perform tax calculation, otherwise nothing must be calculated and                    233709
031440200610      ** nothing must be output on SDCSINPD                                                   233709
031450200610      *                                                                                       233709
031460200610     C           CGL031    IFEQ 'Y'                                                           233709
031470200610     C           SETX      ANDEQ'Y'                                                           233709
031480200610     C********** CSNV      ANDGT*ZERO                                                  233709 234406
031490200610      *                                                                                       233709
031500200610     C********** C1DI      IFEQ 'D'                                                    233709 234440
031510200610     C********** C1DI      OREQ 'S'                                                    233709 234440
031520200610     C                     EXSR CPNTAX                                                        233709
031530200610     C**********           ENDIF                                                       233709 234440
031540200610     C                     ENDIF                                                              233709
031550200610     C/COPY WNCPYSRC,SE2400C041
031560200610     C                     EXSR W02
031570200610     C                     END
031580200610     C/COPY WNCPYSRC,SE2400C013
031590200610     C*                                                                   E21715
031600200610     C***********                                                  E21715 E23807
031610200610     C***RESET*EX/COUPON*NOMINAL*FOR*NEXT*COUPON*PERIOD************E21715 E23807
031620200610     C***********                                                  E21715 E23807
031630200610     C***********LCPN      IFEQ SAED                               E21715 E23807
031640200610     C***********          Z-ADD0         CSEX                     E21715 E23807
031650200610     C***********          UPDATCPOSNDF                            E21715 E23807
031660200610     C***********          END                                     E21715 E23807
031670200610     C*                                                                   E37289
031680200610     C           AKRI      IFEQ 'Y'                                       E37289
031690200610     C           SCRECI    ANDEQ'M'                                       E37289
031700200610     C                     EXSR W03                                       E37289
031710200610     C                     END                                            E37289
031720200610      *****************************************************************                CGL031 233709
031730200610      ***If*CGL031*is*on*and*security*is*taxable*and*classification*is*D or S          CGL031 233709
031740200610      ***perform*tax*calculation,*otherwise*nothing*must*be*calculated*and             CGL031 233709
031750200610      ***nothing*must*be*output*on*SDCSINPD****************************                CGL031 233709
031760200610      *****************************************************************                CGL031 233709
031770200610     C********** CGL031    IFEQ 'Y'                                                    CGL031 233709
031780200610     C********** SETX      ANDEQ'Y'                                                    CGL031 233709
031790200610     C********** SAED      ANDLTBJDNWD                                                 CGL031 233709
031800200610     C********** CSNV      ANDGT*ZERO                                                  CGL031 233709
031810200610     C********** C1DI      IFEQ 'D'                                                    CGL031 233709
031820200610     C********** C1DI      OREQ 'S'                                                    CGL031 233709
031830200610     C**********           EXSR CPNTAX                                                 CGL031 233709
031840200610     C**********           ENDIF                                                       CGL031 233709
031850200610     C**********           ENDIF                                                       CGL031 233709
031860200610     C*
031870200610     C           ENDCPN    ENDSR                           ** ENDCPN**
031880200610      *
031890200610      *****************************************************************
031900200610      /EJECT
031910200610      *****************************************************************
031920200610      *                                                               *
031930200610      *  PARTPY - Subroutine to produce Part Payment Position         *
031940200610      *           Settlements.                                        *
031950200610      *                                                               *
031960200610      *****************************************************************
031970200610      *
031980200610     C           PARTPY    BEGSR                           ** PARTPY **
031990200610     C*
032000200610     C** CALCULATE PAYMENT DUE AS:
032010200610     C*       NOMINAL TRADE DATE BASIS TIMES CALL AMOUNT
032020200610     C*       HOLDING IS IN NOM.DEC PLACES, RESULT AS 13/0 WITH CCY DEC
032030200610     C*
032040200610     C*   GET SECURITY RECORD IN
032050200610     C*
032060200610     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY  TO GET CCY DP
032070200610     C*
032080200610     C                     MOVE NMCY      WCURR   3
032090200610     C                     EXSR TG10
032100200610      *
032110200610      ****CLEAR*WORK*FIELDS***********************************************E23169
032120200610      ***********                                                         E23169
032130200610     C***********          Z-ADD0         WORK0  150                      E23169
032140200610     C***********          Z-ADD0         WORK1  151                      E23169
032150200610     C***********          Z-ADD0         WORK2  152                      E23169
032160200610     C***********          Z-ADD0         WORK3  153                      E23169
032170200610      ***********                                                         E23169
032180200610     C***********          MOVEA'0000'    *IN,60                          E23169
032190200610      ***********                                                         E23169
032200200610     C***********60        ADD  CDP       I       30                      E23169
032210200610      ***********                                                         E23169
032220200610     C***********          MOVEA'1'       *IN,I                           E23169
032230200610      ***********                                                         E23169
032240200610     C***********                                                         E23169
032250200610     C***CALCULATE*OFFSET*FOR*TABLE*POWER8********************************E23169
032260200610     C***********                                                         E23169
032270200610     C***********CDP       SUB  NMDP      DC                              E23169
032280200610     C***********DC        ADD  5         DC                              E23169
032290200610      ***********                                                         E23169
032300200610     C***********          EXSR INVTIN                                    E23169
032310200610      ***********                                                         E23169
032320200610      ****PROCESS*CALCS*DEPENDING*ON*CURRENCY*DPS.************************E23169
032330200610      ***********                                                         E23169
032340200610     C************IN60     IFEQ '1'                                       E23169
032350200610      ***********                                                         E23169
032360200610      ****ZERO*DECIMAL*PLACES**---------------------------------------****E23169
032370200610      ***********                                                         E23169
032380200610     C***********          MOVE SDCA      WORK0                           E23169
032390200610     C***********          MULT CSNV      WORK0                           E23169
032400200610      ***********                                                         E23169
032410200610     C***********PROT      IFEQ '8'                                       E23169
032420200610      ***********                                                         E23169
032430200610      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR*****E23169
032440200610      ***********                                                         E23169
032450200610     C***********          MULT SACF      WORK0                           E23169
032460200610     C***********          END                                            E23169
032470200610      ***********                                                         E23169
032480200610      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100*********************E23169
032490200610      ***********                                                         E23169
032500200610     C***********SPBS      IFEQ 'P'                                       E23169
032510200610     C***********          DIV  100       WORK0     H                     E23169
032520200610     C***********          END                                            E23169
032530200610      ***********                                                         E23169
032540200610     C***********WORK0*****MULT*POWER8,DC*WPAYDU*130H*********************E23169
032550200610      ***********                                                         E23169
032560200610     C***********          ELSE                                           E23169
032570200610     C************IN61     IFEQ '1'                                       E23169
032580200610      ***********                                                         E23169
032590200610      ****ONE*DECIMAL*PLACE****----------------------------------------***E23169
032600200610      ***********                                                         E23169
032610200610     C***********          MOVE SDCA      WORK1                           E23169
032620200610     C***********          MULT CSNV      WORK1                           E23169
032630200610      ***********                                                         E23169
032640200610     C***********PROT      IFEQ '8'                                       E23169
032650200610      ***********                                                         E23169
032660200610      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR*****E23169
032670200610      ***********                                                         E23169
032680200610     C***********          MULT SACF      WORK1                           E23169
032690200610     C***********          END                                            E23169
032700200610      ***********                                                         E23169
032710200610      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100*********************E23169
032720200610      ***********                                                         E23169
032730200610     C***********SPBS      IFEQ 'P'                                       E23169
032740200610     C***********          DIV  100       WORK1     H                     E23169
032750200610     C***********          END                                            E23169
032760200610      ***********                                                         E23169
032770200610     C***********WORK1     MULT POWER8,DC WPAYDU    H                     E23169
032780200610      ***********                                                         E23169
032790200610     C***********          ELSE                                           E23169
032800200610     C************IN62     IFEQ '1'                                       E23169
032810200610      ***********                                                         E23169
032820200610      ****TWO*DECIMAL*PLACES***----------------------------------------***E23169
032830200610      ***********                                                         E23169
032840200610     C***********          MOVE SDCA      WORK2                           E23169
032850200610     C***********          MULT CSNV      WORK2                           E23169
032860200610      ***********                                                         E23169
032870200610     C***********PROT      IFEQ '8'                                       E23169
032880200610      ***********                                                         E23169
032890200610      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR*****E23169
032900200610      ***********                                                         E23169
032910200610     C***********          MULT SACF      WORK2                           E23169
032920200610     C***********          END                                            E23169
032930200610      ***********                                                         E23169
032940200610      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100*********************E23169
032950200610      ***********                                                         E23169
032960200610     C***********SPBS      IFEQ 'P'                                       E23169
032970200610     C***********          DIV  100       WORK2     H                     E23169
032980200610     C***********          END                                            E23169
032990200610      ***********                                                         E23169
033000200610     C***********WORK2*****MULT*POWER8,DC*WPAYDU****H*********************E23169
033010200610      ***********                                                         E23169
033020200610     C***********          ELSE                                           E23169
033030200610     C************IN63     IFEQ '1'                                       E23169
033040200610      ***********                                                         E23169
033050200610      ****THREE*DECIMAL*PLACES*--------------------------------------*****E23169
033060200610      ***********                                                         E23169
033070200610     C***********          MOVE SDCA      WORK3                           E23169
033080200610     C***********          MULT CSNV      WORK3                           E23169
033090200610      ***********                                                         E23169
033100200610     C***********PROT      IFEQ '8'                                       E23169
033110200610      ***********                                                         E23169
033120200610      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR*****E23169
033130200610      ***********                                                         E23169
033140200610     C***********          MULT SACF      WORK3                           E23169
033150200610     C***********          END                                            E23169
033160200610      ***********                                                         E23169
033170200610      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100*********************E23169
033180200610      ***********                                                         E23169
033190200610     C***********SPBS      IFEQ 'P'                                       E23169
033200200610     C***********          DIV  100       WORK3     H                     E23169
033210200610     C***********          END                                            E23169
033220200610      ***********                                                         E23169
033230200610     C***********WORK3     MULT POWER8,DC WPAYDU    H                     E23169
033240200610      ***********                                                         E23169
033250200610     C***********          END                                            E23169
033260200610     C***********          END                                            E23169
033270200610     C***********          END                                            E23169
033280200610     C***********          END                                            E23169
033290200610     C*
033300200610     C*                                                                   E23169
033310200610     C           PROT      IFNE '4'                                       E23169
033320200610     C           SDCA      DIV  100000    ZPRC                            E23169
033330200610     C                     ELSE                                           E23169
033340200610     C           5         ADD  CDP       DC                              E23169
033350200610     C           SDCA      DIV  POWER8,DC ZPRC                            E23169
033360200610     C                     END                                            E23169
033370200610     C           SPBS      IFEQ 'P'                                       E23169
033380200610     C                     MULT 100       ZPRC                            E23169
033390200610     C                     END                                            E23169
033400200610     C******************** Z-ADDCSNV      ZNOML                    E23169 S01486
033410200610     C           WPORTP    IFEQ 'Y'                                       S01486
033420200610     C           BGPFMG    ANDEQ'Y'                                       S01486
033430200610     C           WPORTP    OREQ 'Y'                                       CPB001
033440200610     C           BGN4ST    ANDEQ'Y'                                       CPB001
033450200610     C***********          Z-ADDQANOML    ZNOML                    S01486 189942
033460200610     C                     Z-ADDCDNV      ZNOML                           189942
033470200610     C                     ELSE                                           S01486
033480200610     C                     Z-ADDCSNV      ZNOML                           S01486
033490200610     C                     END                                            S01486
033500200610     C*                                                                   S01486
033510200610     C                     EXSR ZCNSD                                     E23169
033520200610     C                     Z-ADDZCONS     WPAYDU 130                      E23169
033530200610     C*                                                                   E23169
033540200610     C** IF PROCESSING TYPE ON INVPTD IS 8 MULTIPLY BY CURRENT FACTOR     E23169
033550200610     C*                                                                   E23169
033560200610     C           PROT      IFEQ '8'                                       E23169
033570200610     C                     MULT SACF      WPAYDU    H                     E23169
033580200610     C                     END                                            E23169
033590200610      *                                                                                       CSE110
033600200610      ** If account key required write A/C key in W01.                                        CSE110
033610200610      *                                                                                       CSE110
033620200610     C           CSE110    IFEQ 'Y'                                                           CSE110
033630200610      *                                                                                       CSE110
033640200610     C           AKRI      IFEQ 'Y'                                                           CSE110
033650200610     C                     MOVE 'P'       WACEVC                                              CSE110
033660200610     C           NPAC      IFEQ 'N'                                                           CSE110
033670200610     C           CSNV      ORGT 0                                                             CSE110
033680200610     C                     MOVE ' '       WACNEG                                              CSE110
033690200610     C                     ELSE                                                               CSE110
033700200610     C                     MOVE 'N'       WACNEG                                              CSE110
033710200610     C                     ENDIF                                                              CSE110
033720200610     C                     MOVE 'PP'      WACAMC                                              CSE110
033730200610     C                     Z-ADDWPAYDU    EVAM                                                CSE110
033740200610     C           WACNEG    IFEQ 'N'                                                           CSE110
033750200610     C                     Z-SUBEVAM      EVAM                                                CSE110
033760200610     C                     ENDIF                                                              CSE110
033770200610     C                     EXSR W01                                                           CSE110
033780200610     C                     ENDIF                                                              CSE110
033790200610      *                                                                                       CSE110
033800200610     C                     ENDIF                                                              CSE110
033810200610     C*
033820200610     C* WRITE POSITION SETTLEMENT
033830200610     C*
033840200610     C           PSRI      IFEQ 'Y'                                                           CSE110
033850200610     C           WSRECI    ANDNE'R'                                                           CSE110
033860200610     C           CSE110    ANDEQ'Y'                                                           CSE110
033870200610     C           CSE110    OREQ 'N'                                                           CSE110
033880200610      *                                                                                       CSE110
033890200610     C                     MOVE 'PP'      PEVT
033900200610     C******************** Z-ADDCSNV      PNMP                            S01486
033910200610     C*                                                                   S01486
033920200610     C           WPORTP    IFEQ 'Y'                                       S01486
033930200610     C           BGPFMG    ANDEQ'Y'                                       S01486
033940200610     C           WPORTP    OREQ 'Y'                                       CPB001
033950200610     C           BGN4ST    ANDEQ'Y'                                       CPB001
033960200610     C***********          Z-ADDQANOML    PNMP                     S01486 189942
033970200610     C                     Z-ADDCDNV      PNMP                            189942
033980200610     C                     ELSE                                           S01486
033990200610     C                     Z-ADDCSNV      PNMP                            S01486
034000200610     C                     END                                            S01486
034010200610     C*                                                                   S01486
034020200610     C                     Z-ADDWPAYDU    PAMD
034030200610      *                                                                                       CSE110
034040200610     C           CSE110    IFEQ 'Y'                                                           CSE110
034050200610      *                                                                                       CSE110
034060200610     C           PAMD      IFLE 0                                                             CSE110
034070200610     C                     MOVE 'R'       PPRE                                                CSE110
034080200610     C                     ELSE                                                               CSE110
034090200610     C                     MOVE 'P'       PPRE                                                CSE110
034100200610     C                     END                                                                CSE110
034110200610      *                                                                                       CSE110
034120200610     C                     ENDIF                                                              CSE110
034130200610      *                                                                                       CSE110
034140200610     C           PAMD      IFLT 0
034150200610     C                     Z-SUBPAMD      PAMD
034160200610     C                     END
034170200610     C*
034180200610     C           CSE110    IFEQ 'N'                                                           CSE110
034190200610      *                                                                                       CSE110
034200200610     C           CSNV      IFLE 0
034210200610     C**********           MOVE 'R'       PPRE                            E14704
034220200610     C                     MOVE 'P'       PPRE                            E14704
034230200610     C                     ELSE
034240200610     C**********           MOVE 'P'       PPRE                            E14704
034250200610     C                     MOVE 'R'       PPRE                            E14704
034260200610     C                     END
034270200610      *                                                                                       CSE110
034280200610     C                     ENDIF                                                              CSE110
034290200610     C                     EXSR W02
034300200610      *                                                                                       CSE110
034310200610     C                     ENDIF                                                              CSE110
034320200610      *
034330200610     C           ENDPPY    ENDSR                           ** ENDPPY **
034340200610      *
034350200610      *****************************************************************
034360200610      /EJECT
034370200610      *****************************************************************
034380200610      *                                                               *
034390200610      *  MORTPY - Subroutine to produce Mortgage Payment Account Keys *
034400200610      *           and/or Position Settlements.                        *
034410200610      *                                                               *
034420200610      *****************************************************************
034430200610      *
034440200610     C           MORTPY    BEGSR                           ** MORTPY **
034450200610     C*                                                                   E36391
034460200610     C** Get the current factor prior to the action date from the         E36391
034470200610     C** security diary. If no details are present, use the current       E36391
034480200610     C** factor from the security.                                        E36391
034490200610     C*                                                                   E36391
034500200610     C           SEDKEY    SETGTSEDEVDO                                   E36391
034510200610     C                     READ SEDEVDO                  81               E36391
034520200610     C           *IN81     IFEQ '0'                                       E36391
034530200610     C           SDSN      ANDEQSASN                                      E36391
034540200610     C           SDET      ANDEQ'MP'                                      E36391
034550200610     C                     Z-ADDSDCP      PCFA                            E36391
034560200610     C                     ELSE                                           E36391
034570200610     C                     Z-ADDCFCT      PCFA                            E36391
034580200610     C                     END                                            E36391
034590200610     C*
034600200610     C** CALCULATE PRINCIPAL REPAYMENT AS:
034610200610     C*   IF REPAYMENT METHOD IND IS Y, REPAYMENT AMOUNT ON SECAD
034620200610     C*
034630200610     C           RTMI      IFEQ 'Y'
034640200610     C***********          Z-ADDRTAI      WPREPA 130                      E23169
034650200610     C                     Z-ADDRTAI      PAMD                            E23169
034660200610     C                     ELSE
034670200610     C*
034680200610     C*         ELSE
034690200610     C* NOMINAL VALUE DATE BASIS TIMES
034700200610     C* (PREVIOUS CURRENT FACTOR MINUS CURRENT FACTOR)
034710200610     C* NB ALTHOUGH NOM DEC = NOM DEC CCY FOR MORTGAGE BACKED SEC'TS
034720200610     C* FIELD RTAI IS IN CCY DEC PLACES AND THIS CALC OF WPREPA IS TOO
034730200610     C*
034740200610     C********** PCFA      SUB  SACF      WACF    98                      052254
034750200610     C           PCFA      SUB  SACF      WACF                            052254
034760200610     C*
034770200610      ***  As the first digit of the difference will always be zero       E20086
034780200610      ***  the following processing is unnecessary.                       E20086
034790200610      *                                                                   E20086
034800200610     C***SPLIT*FIELD*WACF*9/8*TO*1/0*AND*8/8*WRK*FLDS*TO*PREVENT*LOSS**   E20086
034810200610     C***OF*HIGH*ORDER*DIGITS******************************************   E20086
034820200610     C***********                                                         E20086
034830200610     C***********          Z-ADDWACF      WRK10   10                      E20086
034840200610     C***********          Z-ADDWACF      WRK88   88                      E20086
034850200610     C***********                                                         E20086
034860200610     C***MULTIPLY*NOMINAL*VALUE*DATE*BASIS*BY*EACH*WORK*FIELD*AND*SUM**   E20086
034870200610     C***********                                                         E20086
034880200610     C***********CSNV      MULT WRK88     WRK158 158                      E20086
034890200610     C***********WRK150    ADD  WRK154    WRK154                          E20086
034900200610     C***********CSNV      MULT WACF      WRK152 152H              E20086 E23169
034910200610     C*
034920200610     C*NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
034930200610     C*
034940200610     C                     MOVE NMCY      WCURR   3
034950200610     C                     EXSR TG10
034960200610     C           BGPFMG    IFNE 'Y'                                       080741
034970200610     C           BGN4ST    ANDNE'Y'                                       CPB001
034980200610     C           WPORTP    ORNE 'Y'                                                           236137
034990200610     C                     Z-ADDCSNV      ZNOML                           E23169
035000200610     C                     ELSE                                           080741
035010200610     C***********          Z-ADDQANOML    ZNOML                    080741 189942
035020200610     C                     Z-ADDCDNV      ZNOML                           189942
035030200610     C                     END                                            080741
035040200610     C                     Z-ADDWACF      ZPRC                            E23169
035050200610     C           SPBS      IFEQ 'P'                                       E23169
035060200610     C                     MULT 100       ZPRC                            E23169
035070200610     C                     END                                            E23169
035080200610     C                     EXSR ZCNSD                                     E23169
035090200610     C                     Z-ADDZCONS     PAMD                            E23169
035100200610     C*
035110200610     C***********CDP       SUB  NMDP      DC      10                      E23169
035120200610     C***********DC        ADD  5         DC                              E23169
035130200610     C***********WRK154    MULT POWER8,DC WRK154                          E20086
035140200610     C***********WRK154    DIV  1         WPREPA 130H                     E20086
035150200610     C***********WRK152    MULT POWER8,DC PAMD      H              E20086 E23169
035160200610     C                     END
035170200610     C*
035180200610      ***  Interest is calculated in a separate Coupon Event - do not     E20086
035190200610      ***  include in the Mortgage Payment.                               E20086
035200200610      *                                                                   E20086
035210200610     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRD*FOR*SECURITY**************   E20086
035220200610     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E20086
035230200610     C***********                                                         E20086
035240200610     C***WHEN*PARM*ZAB*IS*'A'*,*INTEREST*IS*CALCULATED*AFTER*CHANGES***   E20086
035250200610     C***********                                                         E20086
035260200610     C***********          UNLCKLDA                                       E20086
035270200610     C***********          CALL 'ZACCRC'                                  E20086
035280200610     C***********          PARM           LCPN                            E20086
035290200610     C***********          PARM           SAED                            E20086
035300200610     C***********          PARM           CSBR                            E20086
035310200610     C***********          PARM           CDPT                            E20086
035320200610     C***********          PARM           CSSC                            E20086
035330200610     C***********          PARM           CDP                             E20086
035340200610     C***********          PARM           ZINTDU 150                      E20086
035350200610     C***********          PARM           ZAB     1                       E20086
035360200610     C***********          PARM           WU8     1
035370200610     C***********                                                         E20086
035380200610     C****MULTIPLY*RESULT*OF*ZACCRD*BY*PREVIOUS*CURR*FACTOR************   E20086
035390200610     C***********                                                         E20086
035400200610     C***********ZINTDU    MULT PCFA      WRK154                          E20086
035410200610     C***********WRK154    DIV  1         WINTPY 130H                     E20086
035420200610     C*
035430200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
035440200610     C*
035450200610     C           PSRI      IFEQ 'Y'
035460200610     C*
035470200610     C                     MOVE 'MP'      PEVT
035480200610     C           BGPFMG    IFNE 'Y'                                       080741
035490200610     C           BGN4ST    ANDNE'Y'                                       CPB001
035500200610     C           WPORTP    ORNE 'Y'                                                           236137
035510200610     C                     Z-ADDCSNV      PNMP
035520200610     C                     ELSE                                           080741
035530200610     C***********          Z-ADDQANOML    PNMP                     080741 189942
035540200610     C                     Z-ADDCDNV      PNMP                            189942
035550200610     C                     END                                            080741
035560200610     C*
035570200610     C***AMOUNT*DUE*IS*PRINCIPAL*REPAYMNT*+*INTEREST*******************   E20086
035580200610     C***********                                                         E20086
035590200610     C***********WPREPA    ADD  WINTPY    WRK130 130                      E20086
035600200610     C***********          Z-ADDWRK130    PAMD                            E20086
035610200610     C***********                                                         E20086
035620200610     C***********PAMD      IFLT 0                                         E20086
035630200610     C***********          Z-SUBPAMD      PAMD                            E20086
035640200610     C***********          END                                            E20086
035650200610     C***********                                                         E20086
035660200610     C***********WRK130    IFLE 0                                         E20086
035670200610     C           PAMD      IFLE 0                                         E20086
035680200610     C**********           MOVE 'P'       PPRE                            E14704
035690200610     C                     MOVE 'R'       PPRE                            E14704
035700200610     C                     ELSE
035710200610     C**********           MOVE 'R'       PPRE                            E14704
035720200610     C                     MOVE 'P'       PPRE                            E14704
035730200610     C                     END
035740200610      *                                                                   E20086
035750200610     C           PAMD      IFLT 0                                         E20086
035760200610     C                     Z-SUBPAMD      PAMD                            E20086
035770200610     C                     END                                            E20086
035780200610      *                                                                                       233709
035790200610     C                     Z-ADD0         TXNM                                                233709
035800200610     C                     Z-ADD0         TXST                                                233709
035810200610     C                     Z-ADD0         TAXA                                                233709
035820200610     C                     MOVE *BLANKS   TXCY                                                233709
035830200610     C*                                                                   E20086
035840200610      ** If CGL031 is on and security is taxable and classification is D or S                 233709
035850200610      ** perform the tax calculation                                                          233709
035860200610      *                                                                                       233709
035870200610     C           CGL031    IFEQ 'Y'                                                           233709
035880200610     C           SETX      ANDEQ'Y'                                                           233709
035890200610     C********** CSNV      ANDGT*ZERO                                                  233709 234406
035900200610      *                                                                                       233709
035910200610     C********** C1DI      IFEQ 'D'                                                    233709 234440
035920200610     C********** C1DI      OREQ 'S'                                                    233709 234440
035930200610     C                     EXSR MORTAX                                                        233709
035940200610     C**********           ENDIF                                                       233709 234440
035950200610     C                     ENDIF                                                              233709
035960200610      *                                                                                       233709
035970200610     C                     EXSR W02
035980200610     C*
035990200610     C                     END
036000200610     C*
036010200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
036020200610     C*
036030200610     C           AKRI      IFEQ 'Y'
036040200610     C                     MOVE 'R'       WACEVC
036050200610     C***********          Z-ADDWPREPA    WRK130 130               E21138 E23169
036060200610     C***********WRK130    IFGT 0                                         E23169
036070200610     C           PAMD      IFGT 0                                         E23169
036080200610     C           NPAC      OREQ 'N'
036090200610     C                     MOVE ' '       WACNEG
036100200610     C                     ELSE
036110200610     C                     MOVE 'N'       WACNEG
036120200610     C                     END
036130200610     C                     MOVE 'FV'      WACAMC
036140200610     C***********          Z-ADDWRK130    EVAM                            E23169
036150200610     C                     Z-ADDPAMD      EVAM                            E23169
036160200610     C***********          MOVE WNMCY     WCURR   3                E13817 E20086
036170200610     C***********                                                         E23169
036180200610     C***********          MOVE SNMCY     WCURR   3                E20086 E23169
036190200610     C***********          EXSR TG10                               E13817 E23169
036200200610     C***********5         SUB  NMDP      DC      10               E13817 E23169
036210200610     C***********          ADD  CDP       DC                       E13817 E23169
036220200610     C***********WRK130    MULT POWER8,DC EVAM                     E13817 E23169
036230200610     C***********WRK130    IFLT 0                                         E23169
036240200610     C           PAMD      IFLT 0                                         E23169
036250200610     C           NPAC      ANDEQ'Y'
036260200610     C                     Z-SUBEVAM      EVAM
036270200610     C                     END
036280200610     C*
036290200610     C                     EXSR W01
036300200610     C/COPY WNCPYSRC,SE2400C014
036310200610     C*
036320200610     C                     END
036330200610     C*
036340200610      ***If*CGL031*is*on*and*security*is*taxable*and*classification*is*D or S          CGL031 233709
036350200610      ***perform*the*tax*calculation***********************************                CGL031 233709
036360200610      *****************************************************************                CGL031 233709
036370200610     C********** CGL031    IFEQ 'Y'                                                    CGL031 233709
036380200610     C********** SETX      ANDEQ'Y'                                                    CGL031 233709
036390200610     C********** SAED      ANDLTBJDNWD                                                 CGL031 233709
036400200610     C********** CSNV      ANDGT*ZERO                                                  CGL031 233709
036410200610     C********** C1DI      IFEQ 'D'                                                    CGL031 233709
036420200610     C********** C1DI      OREQ 'S'                                                    CGL031 233709
036430200610     C**********           EXSR MORTAX                                                 CGL031 233709
036440200610     C**********           ENDIF                                                       CGL031 233709
036450200610     C**********           ENDIF                                                       CGL031 233709
036460200610      *****************************************************************                CGL031 233709
036470200610     C           ENDMPY    ENDSR                           ** ENDMPY **
036480200610      *
036490200610      *****************************************************************                       CGL031
036500200610      /EJECT                                                                                  CGL031
036510200610      *****************************************************************                       CGL031
036520200610      *                                                               *                       CGL031
036530200610      *  MORTAX - Subroutine to calculate tax for descretionary and   *                       CGL031
036540200610      *           safe custody customers.                             *                       CGL031
036550200610      *                                                               *                       CGL031
036560200610      *****************************************************************                       CGL031
036570200610      *                                                                                       CGL031
036580200610     C           MORTAX    BEGSR                                                              CGL031
036590200610      *                                                                                       CGL031
036600200610      ** Initialize                                                                           CGL031
036610200610      *                                                                                       CGL031
036620200610     C                     Z-ADD1         WACF                                                CGL031
036630200610      *                                                                                       CGL031
036640200610      ** Check if record needs to be taxed.                                                   CGL031
036650200610      *                                                                                       CGL031
036660200610     C                     EXSR CHKTAX                                                        CGL031
036670200610      *                                                                                       CGL031
036680200610      ***Get*the*current*factor*prior*to*the*action*date*from*the******                CGL031 234440
036690200610      ***security*diary.*If*no*details*are*present,*use*the*current****                CGL031 234440
036700200610      ***factor*from*the*security.*************************************                CGL031 234440
036710200610      *                                                                                       CGL031
036720200610     C********** SEDKEY    SETGTSEDEVDO                                                CGL031 234440
036730200610     C**********           READ SEDEVDO                  81                            CGL031 234440
036740200610     C********** *IN81     IFEQ '0'                                                    CGL031 234440
036750200610     C********** SDSN      ANDEQSASN                                                   CGL031 234440
036760200610     C********** SDET      ANDEQ'MP'                                                   CGL031 234440
036770200610     C**********           Z-ADDSDCP      PCFA                                         CGL031 234440
036780200610     C**********           ELSE                                                        CGL031 234440
036790200610     C**********           Z-ADDCFCT      PCFA                                         CGL031 234440
036800200610     C**********           ENDIF                                                       CGL031 234440
036810200610      *                                                                                       CGL031
036820200610      ***Calculate*Principal*Repayment*as:*****************************                CGL031 234440
036830200610      ***If*Repayment*Method*Ind*is*Y,*Repayment*Amount*on*SECAD*******                CGL031 234440
036840200610      *                                                                                       CGL031
036850200610     C********** RTMI      IFEQ 'Y'                                                    CGL031 234440
036860200610     C**********           Z-ADDRTAI      PAMD                                         CGL031 234440
036870200610     C**********           ELSE                                                        CGL031 234440
036880200610      *                                                                                       CGL031
036890200610      ***Else**********************************************************                CGL031 234440
036900200610      ***Nominal*Value*Date*Basis*Times********************************                CGL031 234440
036910200610      ***(Previous*Current*Factor*Minus*Current*Factor)****************                CGL031 234440
036920200610      ***NB*although*NOM*DEC*=*NOM*DEC*CCY*for*Mortgage*backed*Sec'ts**                CGL031 234440
036930200610      ***field*RTAI*is*in*CCY*DEC*Places*and*this*CALC*of*WPREPA*is*too                CGL031 234440
036940200610      *                                                                                       CGL031
036950200610     C********** PCFA      SUB  SACF      WACF                                         CGL031 234440
036960200610      *                                                                                       CGL031
036970200610      ***Nominal*Decimal*Places*retrieved*-*Now*use*CCY*to*get*CCY*DP**                CGL031 234440
036980200610      *                                                                                       CGL031
036990200610     C**********           MOVE NMCY      WCURR                                        CGL031 234440
037000200610     C**********           EXSR TG10                                                   CGL031 234440
037010200610     C********** BGPFMG    IFNE 'Y'                                                    CGL031 233709
037020200610     C********** BGN4ST    ANDNE'Y'                                                    CGL031 233709
037030200610     C**********           Z-ADDCSNV      ZNOML                                        CGL031 234440
037040200610     C**********           ELSE                                                        CGL031 233709
037050200610     C**********           Z-ADDCDNV      ZNOML                                        CGL031 233709
037060200610     C**********           ENDIF                                                       CGL031 233709
037070200610     C**********           Z-ADDWACF      ZPRC                                         CGL031 234440
037080200610     C********** SPBS      IFEQ 'P'                                                    CGL031 234440
037090200610     C**********           MULT 100       ZPRC                                         CGL031 234440
037100200610     C**********           ENDIF                                                       CGL031 234440
037110200610     C**********           EXSR ZCNSD                                                  CGL031 234440
037120200610     C**********           Z-ADDZCONS     PAMD                                         CGL031 234440
037130200610      *                                                                                       CGL031
037140200610     C**********           ENDIF                                                       CGL031 234440
037150200610      *                                                                                       CGL031
037160200610     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233567
037170200610     C**********           Z-ADDAFPV      WCSAV                                        CGL031 233567
037180200610     C**********           ELSE                                                        CGL031 233567
037190200610     C**********           Z-ADDCSAV      WCSAV                                        CGL031 233567
037200200610     C**********           ENDIF                                                       CGL031 233567
037210200610      *                                                                                       CGL031
037220200610      ** If no record found, no tax is calculated                                             CGL031
037230200610      ** Or if Issue Price is 100, (i.e. not dicsount or premium),                            234440
037240200610      ** no tax is calculated.                                                                234440
037250200610     C                     MOVE 'Y'       WTXBLE  1        Amount is taxable                  236137
037260200610     C           WNOTAX    IFEQ 'Y'                        Begin Taxable                      236137
037270200610     C           ISSP      OREQ 100                                                           236137
037280200610     C                     MOVE 'N'       WTXBLE                                              236137
037290200610      *                                                                                       236137
037300200610     C                     ELSE                                                               236137
037310200610      *                                                                                       236137
037320200610      ** If record was found and De Minimis Rule is applicable, determine if                  236137
037330200610      ** amortized discount is taxable.                                                       236137
037340200610     C           EWDMAP    IFEQ 'Y'                        Begin EWDMAP                       236137
037350200610     C           ISSP      ANDLT100                                                           236137
037360200610      *                                                                                       236137
037370200610     C           100       SUB  ISSP      WWAMT  158       Amortized Discount                 236137
037380200610      *                                                                                       236137
037390200610     C           WWAMT     IFLE EWTTDP                                                        236137
037400200610     C           MATY      SUB  ISSD      WWDAYS  83                                          236137
037410200610     C                     DIV  365       WWDAYS    H                                         236137
037420200610      *                                                                                       236137
037430200610     C           WWDAYS    IFGT *ZEROS                                                        236137
037440200610     C                     DIV  WWDAYS    WWAMT                                               236137
037450200610      *                                                                                       236137
037460200610     C           WWAMT     IFLE EWYRDP                                                        236137
037470200610     C                     MOVE 'N'       WTXBLE           Amount is not taxable              236137
037480200610      *                                                                                       236137
037490200610     C                     ENDIF                                                              236137
037500200610      *                                                                                       236137
037510200610     C                     ENDIF                                                              236137
037520200610      *                                                                                       236137
037530200610     C                     ENDIF                                                              236137
037540200610      *                                                                                       236137
037550200610     C                     ENDIF                           End EWDMAP                         236137
037560200610      *                                                                                       236137
037570200610     C                     ENDIF                           End Taxable                        236137
037580200610      *                                                                                       CGL031
037590200610      ** Calculate Tax Amount for the Coupon and Output Information on SDCSINPD               CGL031
037600200610      *                                                                                       CGL031
037610200610     C***********WNOTAX****IFEQ*' '************************************                CGL031 236137
037620200610     C***********ISSP******ANDNE100************************************                234440 236137
037630200610     C           WTXBLE    IFEQ 'Y'                                                           236137
037640200610      *                                                                                       CGL031
037650200610      ***If*PAMD*minus*(WCSAV*multiply*by*WACF)*is*negative*or*zero*nothing must be    CGL031 234440
037660200610      ***calculated*or*output*in*SDCSINPD.*****************************                CGL031 234440
037670200610      *                                                                                       CGL031
037680200610     C********** WCSAV     MULT WACF      WVALU  269                                   CGL031 234440
037690200610     C********** PAMD      SUB  WVALU     WNEGA  269                                   CGL031 234440
037700200610      *                                                                                       234440
037710200610      ** Get Fiscal Price at Event Date                                                       234440
037720200610      *                                                                                       CGL031
037730200610      ** Get redemption price                                                                 234440
037740200610     C                     Z-ADD0         SDRP                                                234440
037750200610     C                     Z-ADDMATY      SDED                                                234440
037760200610     C                     MOVE 'RC'      SDET                                                234440
037770200610      *                                                                                       234440
037780200610      ** Check file for either 'RC' type or 'RP' type in key field                            234440
037790200610      *                                                                                       234440
037800200610     C                     EXSR SECEDI                                                        234440
037810200610     C           *IN78     IFEQ '1'                                                           234440
037820200610     C                     MOVE 'RP'      SDET                                                234440
037830200610     C                     EXSR SECEDI                                                        234440
037840200610     C                     END                                                                234440
037850200610     C           *IN78     IFEQ '1'                                                           234440
037860200610      *                                                                                       234440
037870200610      ** If neither RC nor RP use 100 if price basis is P, else 1 (U)                         234440
037880200610      ** Or if RP/RC record found AND price is zero and S01509 is                             234440
037890200610      ** active, use 100 if price basis is P, else 1                                          234440
037900200610      *                                                                                       234440
037910200610     C           *IN78     OREQ '0'                                                           234440
037920200610     C           SDRP      ANDEQ0                                                             234440
037930200610     C           S01509    ANDEQ'Y'                                                           234440
037940200610      *                                                                                       234440
037950200610     C           SPBS      IFEQ 'P'                                                           234440
037960200610     C                     Z-ADD100       SDRP                                                234440
037970200610     C                     END                                                                234440
037980200610     C           PROT      IFEQ '1'                                                           234440
037990200610     C           SPBS      ANDEQ'U'                                                           234440
038000200610     C                     Z-ADD1         SDRP                                                234440
038010200610     C                     ENDIF                                                              234440
038020200610     C                     END                                                                234440
038030200610      *                                                                                       234440
038040200610      ** If Country of Tax is not Switzerland, use straight line basis                        234440
038050200610      *                                                                                       234440
038060200610     C           EWCTRT    IFNE 'CH'                                                          234440
038070200610     C                     CALL 'ZAINTPL2'                                                    234440
038080200610     C                     PARM           ISSD    50                                          234440
038090200610     C                     PARM           SAED    50                                          234440
038100200610     C                     PARM           MATY    50                                          234440
038110200610     C                     PARM           ISSP   158                                          234440
038120200610     C                     PARM           SDRP                                                234440
038130200610     C                     PARM           WFSPR  158                                          234440
038140200610      *                                                                                       234440
038150200610      ***If*Country*of*Tax*is*Switzerland,*use*analytical*interpolation                234440 236137
038160200610      ** Else, use Actuarial Interpolation.                                                   236137
038170200610      *                                                                                       234440
038180200610     C                     ELSE                                                               234440
038190200610     C                     CALL 'ZAACTUAR'                                                    234440
038200200610     C                     PARM           WRTCD  10                                           234440
038210200610     C                     PARM           ISSD                                                234440
038220200610     C                     PARM           ISSP                                                234440
038230200610     C                     PARM           MATY                                                234440
038240200610     C                     PARM           SDRP                                                234440
038250200610     C                     PARM           DYBS                                                234440
038260200610     C                     PARM           DVBS                                                234440
038270200610     C                     PARM           CDDS                                                234440
038280200610     C                     PARM           CRDS                                                234440
038290200610     C                     PARM           LCPN                                              BUG11164
038300200610     C                     PARM           SAED                                                234440
038310200610     C                     PARM           WFSPR                                               234440
038320200610     C                     ENDIF                                                              234440
038330200610      *                                                                                       234440
038340200610      ** Get Average Fiscal Price of Position                                                 234440
038350200610      *                                                                                       234440
038360200610     C********** SAED      SUB  1         WDATE   50                                   234440 234552
038370200610     C                     Z-ADDSAED      WDATE   50                                          234552
038380200610      *                                                                                       234440
038390200610     C           WPORTP    IFEQ 'Y'                                                           234440
038400200610     C           BGPFMG    ANDEQ'Y'                                                           234440
038410200610     C           WPORTP    OREQ 'Y'                                                           234440
038420200610     C           BGN4ST    ANDEQ'Y'                                                           234440
038430200610     C**********           Z-ADDCDNV      ZNOML                                        234440 234440
038440200610      *                                                                                       234440
038450200610      ** Access Customer Position                                                             234440
038460200610      *                                                                                       234440
038470200610     C**********           Z-ADDCDCN      CDCNZN                                       236816 CSD027
038480200610     C                     MOVELCDCN      CDCNZN                                              CSD027
038490200610     C                     CALL WPGM                                                          234440
038500200610     C                     PARM           WRTCD  10                                           234440
038510200610     C                     PARM           CDPA                                                234440
038520200610     C**********           PARM           CDCN                                         234440 236816
038530200610     C                     PARM           CDCNZN                                              236816
038540200610     C                     PARM           CDSN                                                234440
038550200610     C                     PARM           PTFR                                                234440
038560200610     C                     PARM           CDMK                                                234440
038570200610     C                     PARM           WDATE                                               234440
038580200610     C                     PARM           ETCPOS                                              234440
038590200610     C                     ELSE                                                               234440
038600200610     C**********           Z-ADDCSNV      ZNOML                                        234440 234440
038610200610     C                     CALL WPGM                                                          234440
038620200610     C                     PARM           WRTCD  10                                           234440
038630200610     C                     PARM           CSBA                                                234440
038640200610     C                     PARM           CSCN                                                236815
038650200610     C                     PARM           CSSC                                                234440
038660200610     C**********           PARM           CSCN                                         234440 236815
038670200610     C                     PARM *BLANKS   WPTFR   4                                           234440
038680200610     C                     PARM 'S'       WMKT    1                                           234440
038690200610     C                     PARM           WDATE                                               234440
038700200610     C                     PARM           ETCPOS                                              234440
038710200610     C                     END                                                                234440
038720200610      *                                                                                       234440
038730200610     C                     Z-ADDAVFP      WAVFP  158                                          234440
038740200610      *                                                                                       234440
038750200610     C********** WCSAV     DIV  ZNOML     WAVFP  158H                                         234440
038760200610      *                                                                                       234440
038770200610      **If*price*basis*'P',*multiply*by*100*to*fetch*true*price********                234440 234440
038780200610      *                                                                                       234440
038790200610     C********** SPBS      IFEQ 'P'                                                    234440 234440
038800200610     C**********           MULT 100       WAVFP                                        234440 234440
038810200610     C**********           END                                                         234440 234440
038820200610      *                                                                                       234440
038830200610      **reformat*average*fiscal*price*for*currency*decimal*places,*as*it               234440 234440
038840200610      ***was*calculated*from*AP*Numerator*to*a*straight*15/8*price*****                234440 234440
038850200610      *                                                                                       234440
038860200610     C********** 5         ADD  CDP       DC      10                                   234440 234440
038870200610     C**********           SUB  NMDP      DC                                           234440 234440
038880200610     C********** WAVFP     DIV  POWER8,DC WAVFP                                        234440 234440
038890200610      *                                                                                       234440
038900200610      ** Taxable amount is the difference between Fiscal Price and average                    234440
038910200610      ** Fiscal price x Payment Amount (amount due PAMD)                                      234440
038920200610      *                                                                                       234440
038930200610     C           WFSPR     SUB  WAVFP     WFISC  158                                          234440
038940200610      *                                                                                       234440
038950200610     C           SPBS      IFEQ 'P'                                                           234440
038960200610     C                     DIV  100       WFISC     H                                         234440
038970200610     C                     END                                                                234440
038980200610     C           PAMD      MULT WFISC     WFSCA  150                                          234440
038990200610      *                                                                                       234440
039000200610      ** Now do comparison with profit on mortgage repayment, if country                      234440
039010200610      ** of tax is not Switzerland, and take the lower figure as the                          234440
039020200610      ** the taxable amount                                                                   234440
039030200610      *                                                                                       234440
039040200610      ** bit about CH is added and removed by this change control                             234440
039050200610      ** it is left in the code in case the situation changes again.                          234440
039060200610     C********** EWCTRT    IFNE 'CH'                                                          234440
039070200610      *                                                                                       234440
039080200610     C********** CSPV      DIV  ZNOML     WAVPR  158H                                         234440
039090200610      *                                                                                       234440
039100200610      **If*price*basis*'P',*multiply*by*100*to*fetch*true*price********                       234440
039110200610      *                                                                                       234440
039120200610     C********** SPBS      IFEQ 'P'                                                           234440
039130200610     C**********           MULT 100       WAVPR                                               234440
039140200610     C**********           END                                                                234440
039150200610      *                                                                                       234440
039160200610      **reformat*average*fiscal*price*for*currency*decimal*places,*as*it                      234440
039170200610      ***was*calculated*from*AP*Numerator*to*a*straight*15/8*price****q                       234440
039180200610      *                                                                                       234440
039190200610     C********** 5         ADD  CDP       DC      10                                          234440
039200200610     C**********           SUB  NMDP      DC                                                  234440
039210200610     C********** WAVPR     DIV  POWER8,DC WAVPR                                               234440
039220200610      *                                                                                       234440
039230200610      ** If average price is greater than 100 then there is no profit and so                  234440
039240200610      ** not tax (mortage repayments deemed to be at price 100)                               234440
039250200610     C           WAVPR     IFGT 100                                                           234440
039260200610     C                     Z-ADD0         WNEGA  150                                          234440
039270200610     C                     ELSE                                                               234440
039280200610     C           100       SUB  LAVP      WAVPR  158                                          234440
039290200610      *                                                                                       234440
039300200610     C           SPBS      IFEQ 'P'                                                           234440
039310200610     C                     DIV  100       WAVPR     H                                         234440
039320200610     C                     END                                                                234440
039330200610      *                                                                                       234440
039340200610     C           PAMD      MULT WAVPR     WPRFA  150                                          234440
039350200610     C           WPRFA     IFLT WFSCA                                                         234440
039360200610     C                     Z-ADDWPRFA     WNEGA                                               234440
039370200610     C                     ELSE                                                               234440
039380200610     C                     Z-ADDWFSCA     WNEGA                                               234440
039390200610     C                     ENDIF                                                              234440
039400200610     C                     ENDIF                                                              234440
039410200610      *                                                                                       234440
039420200610      ** If Switzerland then just take "fiscal" amount                                        234440
039430200610      *                                                                                       234440
039440200610     C**********           ELSE                                                               234440
039450200610     C**********           Z-ADDWFSCA     WNEGA                                               234440
039460200610     C**********           ENDIF                                                              234440
039470200610      *                                                                                       234440
039480200610     C           WNEGA     IFGT 0                                                             CGL031
039490200610      *                                                                                       CGL031
039500200610     C                     EXSR MPTXCL                                                        CGL031
039510200610      *                                                                                       CGL031
039520200610      ***Output*Tax*Account*Keys***************************************                CGL031 233709
039530200610      *****************************************************************                CGL031 233709
039540200610     C**********           EXSR W04                                                    CGL031 233709
039550200610     C                     ENDIF                                                              CGL031
039560200610     C                     ENDIF                                                              CGL031
039570200610      *                                                                                       CGL031
039580200610     C                     ENDSR                                                              CGL031
039590200610      *****************************************************************                       CGL031
039600200610      /EJECT                                                                                  CGL031
039610200610      *****************************************************************                       CGL031
039620200610      *                                                               *                       CGL031
039630200610      *  MPTXCL - Subroutine to calculate tax amount for the Mortgage *                       CGL031
039640200610      *           Repayment and to Output Information on SDCSINPD     *                       CGL031
039650200610      *                                                               *                       CGL031
039660200610      *****************************************************************                       CGL031
039670200610      *                                                                                       CGL031
039680200610     C           MPTXCL    BEGSR                                                              CGL031
039690200610      *                                                                                       CGL031
039700200610      ** Initialise work variables                                                            CGL031
039710200610      *                                                                                       CGL031
039720200610     C***********          Z-ADD0         WTTXSR                                       CGL031 233709
039730200610     C***********          Z-ADD0         WTTXSS                                       CGL031 233709
039740200610     C***********          Z-ADD0         WTTXSC                                       CGL031 233709
039750200610     C***********          Z-ADD0         WTTXSB                                       CGL031 233709
039760200610     C***********          Z-ADD0         WTNINT                                       CGL031 233709
039770200610     C***********          Z-ADD0         WTNINS                                       CGL031 233709
039780200610     C***********          Z-ADD0         WTNINC                                       CGL031 233709
039790200610     C***********          Z-ADD0         WTNINB                                       CGL031 233709
039800200610     C                     Z-ADD0         TXNM                                                233709
039810200610     C                     Z-ADD0         TXST                                                233709
039820200610     C                     Z-ADD0         TAXA                                                233709
039830200610     C                     MOVE *BLANKS   TXCY                                                233709
039840200610     C                     MOVE ' '       WTXPI                                               CGL031
039850200610     C                     MOVE ' '       WTXJA                                               CGL031
039860200610      *                                                                                       CGL031
039870200610     C                     MOVE YCSCN     @@CUST                                              CGL031
039880200610      *                                                                                       CGL031
039890200610     C                     CALL 'ZATXCLPI'                                                    CGL031
039900200610      ** Input                                                                                CGL031
039910200610     C                     PARM 'S'       @@MODI                                              CGL031
039920200610     C                     PARM SASN      @@TRRF                                              CGL031
039930200610     C                     PARM YCSBA     @@BRCA                                              CGL031
039940200610     C                     PARM           @@CUST                                              CGL031
039950200610     C                     PARM *ZERO     @@STRD                                              CGL031
039960200610     C                     PARM *ZERO     @@ENDD                                              CGL031
039970200610     C                     PARM WNEGA     @@TOTI                                              CGL031
039980200610     C                     PARM WTRAB     @@TAXR                                              CGL031
039990200610     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
040000200610     C                     PARM NMCY      @@OCCY                                              233568
040010200610     C                     PARM *BLANKS   PINTH                                               CER048
040020200610      ** Output                                                                               CGL031
040030200610     C                     PARM           @@IAED                                              CGL031
040040200610     C                     PARM           @@TAXA                                              CGL031
040050200610     C                     PARM           @@TOTO                                              CGL031
040060200610     C                     PARM           @@TXCY                                              CGL031
040070200610     C                     PARM           @@CTAX                                              CGL031
040080200610     C                     PARM           @@TXBS                                              CGL031
040090200610     C                     PARM           @@WTAC                                              CGL031
040100200610     C                     PARM           @@COLC                                              CGL031
040110200610     C                     PARM           @@STAT                                              CGL031
040120200610     C                     PARM           @@TRTE                                              CGL031
040130200610     C                     PARM           @@TXR1                                              CGL031
040140200610     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
040150200610     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
040160200610     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
040170200610     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
040180200610     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
040190200610     C                     PARM           @@KEY                                               CGL031
040200200610     C                     PARM           @@FILE                                              CGL031
040210200610     C                     PARM           @@RTRN                                              CGL031
040220200610     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
040230200610      *                                                                                       CGL031
040240200610     C                     SELEC                                                              CGL031
040250200610      *                                                                                       CGL031
040260200610      ** If return code = Error.                                                              CGL031
040270200610      *                                                                                       CGL031
040280200610     C           @@RTRN    WHEQ 'ERROR'                                                       CGL031
040290200610     C                     MOVE @@FILE    DBFILE                                              CGL031
040300200610     C                     MOVE @@KEY     DBKEY                                               CGL031
040310200610     C                     Z-ADD67        DBASE                                               CGL031
040320200610     C                     MOVE *ON       *INU7                                               CGL031
040330200610     C                     MOVE *ON       *INU8                                               CGL031
040340200610     C                     EXSR *PSSR                                                         CGL031
040350200610     C                     GOTO EAUDIT                                                        CGL031
040360200610      *                                                                                       CGL031
040370200610      ** If return code = Private Individual                                                  CGL031
040380200610      *                                                                                       CGL031
040390200610     C           @@RTRN    WHNE 'JOINT'                                                       CGL031
040400200610      *                                                                                       CGL031
040410200610     C           @@TOTO    IFNE *ZERO                                                         CGL031
040420200610     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
040430200610     C           @@STAT    OREQ 'DISCL'                                                       CGL031
040440200610     C           @@STAT    OREQ 'SELF'                                                        CGL031
040450200610      *                                                                                       CGL031
040460200610     C                     MOVE 'Y'       WTXPI                                               CGL031
040470200610     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
040480200610     C                     MOVE S1CTTA    KCSIS                                               236815
040490200610     C                     MOVE @@CTAX    KCTRT                                               CGL031
040500200610      *                                                                                       CGL031
040510200610     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
040520200610     C           *IN61     IFEQ *OFF                                                          CGL031
040530200610      *                                                                                       CGL031
040540200610     C                     SELEC                                                              CGL031
040550200610     C           TCTXCM    WHEQ 1                                                             CGL031
040560200610     C           SWHTFD    OREQ 'N'                                                           236815
040570200610     C********** S1RASO    OREQ 0                                                      236815 234813
040580200610     C           UTXRSR    OREQ 0                                                             234813
040590200610     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
040600200610     C           TCTXCM    WHEQ 2                                                             CGL031
040610200610     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
040620200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
040630200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
040640200610     C                     DIV  100       WTAXA                                               236815
040650200610     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236815
040660200610     C                     MULT @@TAXR    @@TAXA                                              236815
040670200610     C                     DIV  100       @@TAXA    H                                         236815
040680200610     C           @@TAXA    IFLT 0                                                             236815
040690200610     C                     Z-ADD0         @@TAXA                                              236815
040700200610     C                     ENDIF                                                              236815
040710200610     C           TCTXCM    WHEQ 3                                                             CGL031
040720200610     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
040730200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
040740200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
040750200610     C                     DIV  100       WTAXA                                               236815
040760200610     C                     SUB  WTAXA     @@TAXA                                              236815
040770200610     C           @@TAXA    IFLT 0                                                             236815
040780200610     C                     Z-ADD0         @@TAXA                                              236815
040790200610     C                     ENDIF                                                              236815
040800200610     C           TCTXCM    WHEQ 4                                                             CGL031
040810200610     C                     Z-ADD0         @@TAXA                                              CGL031
040820200610     C                     ENDSL                                                              CGL031
040830200610      *                                                                                       CGL031
040840200610     C                     ENDIF                                                              CGL031
040850200610      *                                                                                       CGL031
040860200610      ** Write record to SDCSINPD                                                             CGL031
040870200610      *                                                                                       CGL031
040880200610     C                     EXSR CSINSR                                                        CGL031
040890200610      *                                                                                       CGL031
040900200610     C                     ENDIF                                                              CGL031
040910200610     C                     ENDIF                                                              CGL031
040920200610      *                                                                                       CGL031
040930200610      ** If return code = Joint Account                                                       CGL031
040940200610      *                                                                                       CGL031
040950200610     C           @@RTRN    WHEQ 'JOINT'                                                       CGL031
040960200610     C                     MOVE YCSCN     KJANO                                               CGL031
040970200610      *                                                                                       CGL031
040980200610     C           KJANO     SETLLSDJACCLB                                                      CGL031
040990200610     C           KJANO     READESDJACCLB                 60                                   CGL031
041000200610      *                                                                                       CGL031
041010200610     C           *IN60     DOWEQ*OFF                                                          CGL031
041020200610      *                                                                                       CGL031
041030200610     C                     CALL 'ZATXCLJA'                                                    CGL031
041040200610      ** Input                                                                                CGL031
041050200610     C                     PARM 'S'       @@MODI                                              CGL031
041060200610     C                     PARM SASN      @@TRRF                                              CGL031
041070200610     C                     PARM YCSBA     @@BRCA                                              CGL031
041080200610     C                     PARM JCJANO    @@JANO                                              CGL031
041090200610     C                     PARM JCCUST    @@CUST                                              CGL031
041100200610     C                     PARM JCNAHO    @@NARF                                              CGL031
041110200610     C                     PARM JCINVP    @@INVP                                              CGL031
041120200610     C                     PARM *ZERO     @@STRD                                              CGL031
041130200610     C                     PARM *ZERO     @@ENDD                                              CGL031
041140200610     C                     PARM WNEGA     @@TOTI                                              CGL031
041150200610     C                     PARM WTRAB     @@TAXR                                              CGL031
041160200610     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
041170200610     C                     PARM NMCY      @@OCCY                                              233568
041180200610     C                     PARM *BLANKS   PINTH                                               CER048
041190200610      ** Output                                                                               CGL031
041200200610     C                     PARM           @@IAED                                              CGL031
041210200610     C                     PARM           @@TAXA                                              CGL031
041220200610     C                     PARM           @@TOTO                                              CGL031
041230200610     C                     PARM           @@TXCY                                              CGL031
041240200610     C                     PARM           @@CTAX                                              CGL031
041250200610     C                     PARM           @@TXBS                                              CGL031
041260200610     C                     PARM           @@WTAC                                              CGL031
041270200610     C                     PARM           @@COLC                                              CGL031
041280200610     C                     PARM           @@STAT                                              CGL031
041290200610     C                     PARM           @@TRTE                                              CGL031
041300200610     C                     PARM           @@TXR1                                              CGL031
041310200610     C                     PARM           @@JAMG                                              CGL031
041320200610     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
041330200610     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
041340200610     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
041350200610     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
041360200610     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
041370200610     C                     PARM           @@KEY                                               CGL031
041380200610     C                     PARM           @@FILE                                              CGL031
041390200610     C                     PARM           @@RTRN                                              CGL031
041400200610     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
041410200610      *                                                                                       CGL031
041420200610      ** If return code = Error.                                                              CGL031
041430200610      *                                                                                       CGL031
041440200610     C           @@RTRN    IFEQ 'ERROR'                                                       CGL031
041450200610     C                     MOVE @@FILE    DBFILE                                              CGL031
041460200610     C                     MOVE @@KEY     DBKEY                                               CGL031
041470200610     C                     Z-ADD68        DBASE                                               CGL031
041480200610     C                     MOVE *ON       *INU7                                               CGL031
041490200610     C                     MOVE *ON       *INU8                                               CGL031
041500200610     C                     EXSR *PSSR                                                         CGL031
041510200610     C                     GOTO EAUDIT                                                        CGL031
041520200610     C                     ENDIF                                                              CGL031
041530200610      *                                                                                       CGL031
041540200610     C           @@RTRN    IFNE *ZERO                                                         CGL031
041550200610     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
041560200610     C           @@STAT    OREQ 'DISCL'                                                       CGL031
041570200610     C           @@STAT    OREQ 'SELF '                                                       CGL031
041580200610      *                                                                                       CGL031
041590200610     C                     MOVE 'Y'       WTXJA                                               CGL031
041600200610     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
041610200610     C                     MOVE S1CTTA    KCSIS                                               236815
041620200610     C                     MOVE @@CTAX    KCTRT                                               CGL031
041630200610      *                                                                                       CGL031
041640200610     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
041650200610     C           *IN61     IFEQ *OFF                                                          CGL031
041660200610      *                                                                                       CGL031
041670200610     C                     SELEC                                                              CGL031
041680200610     C           TCTXCM    WHEQ 1                                                             CGL031
041690200610     C           SWHTFD    OREQ 'N'                                                           236815
041700200610     C********** S1RASO    OREQ 0                                                      236815 234813
041710200610     C           UTXRSR    OREQ 0                                                             234813
041720200610     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
041730200610     C           TCTXCM    WHEQ 2                                                             CGL031
041740200610     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
041750200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
041760200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
041770200610     C                     DIV  100       WTAXA                                               236815
041780200610     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236815
041790200610     C                     MULT @@TAXR    @@TAXA                                              236815
041800200610     C                     DIV  100       @@TAXA    H                                         236815
041810200610     C           @@TAXA    IFLT 0                                                             236815
041820200610     C                     Z-ADD0         @@TAXA                                              236815
041830200610     C                     ENDIF                                                              236815
041840200610     C           TCTXCM    WHEQ 3                                                             CGL031
041850200610     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
041860200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
041870200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
041880200610     C                     DIV  100       WTAXA                                               236815
041890200610     C                     SUB  WTAXA     @@TAXA                                              236815
041900200610     C           @@TAXA    IFLT 0                                                             236815
041910200610     C                     Z-ADD0         @@TAXA                                              236815
041920200610     C                     ENDIF                                                              236815
041930200610     C           TCTXCM    WHEQ 4                                                             CGL031
041940200610     C                     Z-ADD0         @@TAXA                                              CGL031
041950200610     C                     ENDSL                                                              CGL031
041960200610      *                                                                                       CGL031
041970200610     C                     ENDIF                                                              CGL031
041980200610      *                                                                                       CGL031
041990200610      ** Write record to SDCSINPD                                                             CGL031
042000200610      *                                                                                       CGL031
042010200610     C                     EXSR CSINSR                                                        CGL031
042020200610      *                                                                                       CGL031
042030200610     C                     ENDIF                                                              CGL031
042040200610     C                     ENDIF                                                              CGL031
042050200610      *                                                                                       CGL031
042060200610     C           @@RTRN    IFEQ 'NOTAX'                                                       CGL031
042070200610     C           @@RTRN    OREQ 'TAXAB'                                                       CGL031
042080200610     C           KJANO     READESDJACCLB                 60                                   CGL031
042090200610     C                     ENDIF                                                              CGL031
042100200610      *                                                                                       CGL031
042110200610      ** If @@RTRN = Last, end loop                                                           CGL031
042120200610      *                                                                                       CGL031
042130200610     C           @@RTRN    IFEQ 'LAST'                                                        CGL031
042140200610     C                     MOVE *ON       *IN60                                               CGL031
042150200610     C                     ENDIF                                                              CGL031
042160200610      *                                                                                       CGL031
042170200610     C                     ENDDO                                                              CGL031
042180200610      *                                                                                       CGL031
042190200610     C                     ENDSL                                                              CGL031
042200200610      *                                                                                       CGL031
042210200610     C           ENDMPT    ENDSR                                                              CGL031
042220200610      *****************************************************************
042230200610      /EJECT
042240200610      *****************************************************************
042250200610      *                                                               *
042260200610      *  MATURE - Subroutine to produce Maturity Position Settlements.*
042270200610      *                                                               *
042280200610      *****************************************************************
042290200610      *
042300200610     C           MATURE    BEGSR                           ** MATURE **
042310200610      *                                                                   E21573
042320200610      ***  A separate Coupon Event is now produced at Maturity and this   E21573
042330200610      ***  should be used to generate Position Settlement for Interest.   E21573
042340200610      *                                                                   E21573
042350200610     C***USE*LAST*COUPON*DATE*FROM*THE*SECURITY*ACTION************ E15549 E21573
042360200610     C***********                                                  E15549 E21573
042370200610     C***********          Z-ADDSALCCP    LCPN                     E15549 E21573
042380200610     C***********                                                         E21573
042390200610     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRc*FOR*SECURITY**************   E21573
042400200610     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E21573
042410200610     C***GET*NOMINAL*CCY*DEC*PLACES*FROM*TABTG10*FIRST*(CDP)***********   E21573
042420200610     C***********                                                         E21573
042430200610     C*                                                                   S01486
042440200610     C           BGPFMG    IFEQ 'Y'                                       S01486
042450200610     C           BGN4ST    OREQ 'Y'                                       CPB001
042460200610     C                     MOVE NMCY      WCURR   3                       S01486
042470200610     C                     EXSR TG10                                      S01486
042480200610     C                     Z-ADDCDP       ZCDPF                           S01486
042490200610     C                     END                                            S01486
042500200610     C*                                                                   S01486
042510200610     C***********          MOVE NMCY      WCURR   3                       E21573
042520200610     C***********          EXSR TG10                                      E21573
042530200610     C***********                                                         E21573
042540200610     C***WHEN*PARM*ZAB*IS*'A'*,*INTEREST*IS*CALCULATED*AFTER*CHANGES***   E21573
042550200610     C***********                                                         E21573
042560200610     C***********          UNLCKLDA                                       E21573
042570200610     C***********          MOVE 'A'       ZAB                             E21573
042580200610     C***********          CALL 'ZACCRC'                                  E21573
042590200610     C***********          PARM           LCPN                            E21573
042600200610     C***********          PARM           SAED                            E21573
042610200610     C***********          PARM           CSBR                            E21573
042620200610     C***********          PARM           CSCN                            E21573
042630200610     C***********          PARM           CSSC                            E21573
042640200610     C***********          PARM           CDP                             E21573
042650200610     C***********          PARM           ZINTDU 150                      E21573
042660200610     C***********          PARM           ZAB     1                       E21573
042670200610     C**********           PARM           WU8     1
042680200610     C*
042690200610     C***OBTAIN*PRICE*AT*MATURITY*-*CHECK*LF/SECED*FOR*REDEMPTION*PRICE   E20016
042700200610     C** OBTAIN PRICE AT MATURITY - CHECK LF/SEDEV FOR REDEMPTION PRICE   E20016
042710200610     C*
042720200610     C                     Z-ADD0         SDRP
042730200610     C                     Z-ADDMATY      SDED
042740200610     C                     MOVE 'RC'      SDET
042750200610     C*
042760200610     C** CHECK FILE FOR EITHER 'RC' TYPE OR 'RP' TYPE IN KEY FIELD
042770200610     C*
042780200610     C                     EXSR SECEDI
042790200610     C           *IN78     IFEQ '1'
042800200610     C                     MOVE 'RP'      SDET
042810200610     C                     EXSR SECEDI
042820200610     C                     END
042830200610     C           *IN78     IFEQ '1'
042840200610     C*
042850200610     C** IF NEITHER RC NOR RP USE 100 IF PRICE BASIS IS P,ELSE 1 (U)
042860200610     C** Or if RP/RC record found AND price is zero and S01509 is         S01509
042870200610     C** active, use 100 if price basis is P, else 1                      S01509
042880200610     C*
042890200610     C           *IN78     OREQ '0'                                       S01509
042900200610     C           SDRP      ANDEQ0                                         S01509
042910200610     C           S01509    ANDEQ'Y'                                       S01509
042920200610     C*                                                                   S01509
042930200610     C           SPBS      IFEQ 'P'
042940200610     C                     Z-ADD100       SDRP
042950200610     C                     END
042960200610     C***********SPBS      IFEQ 'U'                                       103011
042970200610     C***********          Z-ADD1         SDRP                            103011
042980200610     C***********          END                                            103011
042990200610     C           PROT      IFEQ '1'                                       192467
043000200610     C           SPBS      ANDEQ'U'                                       192467
043010200610     C                     Z-ADD1         SDRP                            192467
043020200610     C                     ENDIF                                          192467
043030200610     C                     END
043040200610     C*                                                                   S01486
043050200610     C** SET NOMINAL VALUE TO FIGURE FROM PF/PMCPOSPD                     S01486
043060200610     C           BGPFMG    IFEQ 'Y'                                       S01486
043070200610     C           BGN4ST    OREQ 'Y'                                       CPB001
043080200610     C*                                                                   S01486
043090200610     C           WPORTP    IFEQ 'Y'                                       S01486
043100200610     C***********          Z-ADDQANOML    WWCSNV 150               S01486 189942
043110200610     C                     Z-ADDCDNV      WWCSNV 150                      189942
043120200610     C                     ELSE                                           S01486
043130200610     C                     Z-ADDCSNV      WWCSNV 150                      S01486
043140200610     C                     END                                            S01486
043150200610     C*                                                                   S01486
043160200610     C                     END                                            S01486
043170200610     C*                                                                   S01486
043180200610     C*
043190200610     C**  CALCULATE NOMINAL MATURING AT CUST. AS
043200200610     C**  NOMINAL VALUE DATE BASIS TIMES PRICE AT MATURITY
043210200610     C*
043220200610     C***********          Z-ADDSDRP      WRK08   88                      E23169
043230200610     C***********          Z-ADDSDRP      WRK150 150                      E23169
043240200610     C***********CSNV      MULT WRK08     WRK156 156                      E23169
043250200610     C***********WRK156    DIV  1         WNOMAT 130H                     E20151
043260200610     C**IF*78*IS*ON,*NO*PRICE*ON*SEC*EVENT*FILE*SO*CCY*FLD*'CDP'*IS*0**   E20151
043270200610     C***********                                                         E23169
043280200610     C***********CDP       SUB  NMDP      DC      10                      E23169
043290200610     C***78******          Z-SUBNMDP      DC                              E20151
043300200610     C***********DC        ADD  5         DC                              E23169
043310200610     C***********                                                  E20151 E23169
043320200610     C***Adjust*for percentage pricing.                            E20151 E23169
043330200610     C***********SPBS      IFEQ 'P'                                E20151 E23169
043340200610     C***********          SUB  2         DC                       E20151 E23169
043350200610     C***********          END                                     E20151 E23169
043360200610     C***********                                                  E20151 E23169
043370200610     C***********DC        IFLT 5                                         E23169
043380200610     C***********WNOMAT    MULT POWER8,DC WRK151 151                      E23169
043390200610     C***********WRK151    DIV  1         WNOMAT    H                     E23169
043400200610     C***********          ELSE                                           E23169
043410200610     C***********WNOMAT    MULT POWER8,DC WNOMAT                          E23169
043420200610     C***********          END                                            E23169
043430200610     C*                                                                   E23169
043440200610     C*NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY  TO GET CCY  DP     E23169
043450200610     C*                                                                   E23169
043460200610     C                     MOVE NMCY      WCURR   3                       E23169
043470200610     C                     EXSR TG10                                      E23169
043480200610     C*                                                                   E23169
043490200610     C** Use ZCNSD subroutin to calculate Amount                          E23169
043500200610     C*                                                                   E23169
043510200610     C                     Z-ADDSDRP      ZPRC                            E23169
043520200610     C           BGPFMG    IFNE 'Y'                                       S01486
043530200610     C           BGN4ST    ANDNE'Y'                                       CPB001
043540200610     C                     Z-ADDCSNV      ZNOML                           E23169
043550200610     C                     ELSE                                           S01486
043560200610     C                     Z-ADDWWCSNV    ZNOML                           S01486
043570200610     C                     END                                            S01486
043580200610     C                     EXSR ZCNSD                                     E23169
043590200610     C                     Z-ADDZCONS     WNOMAT 150                      E23169
043600200610     C*
043610200610     C** If S01509 is active and redemption currency is not blank and     S01509
043620200610     C** is different from the nominal currency, convert maturity         S01509
043630200610     C** amount to redemption currency                                    S01509
043640200610     C*                                                                   S01509
043650200610     C           S01509    IFEQ 'Y'                                       S01509
043660200610     C           *IN78     ANDEQ'0'                                       S01509
043670200610     C           SDCX      ANDNE*BLANKS                                   S01509
043680200610     C           SDCX      ANDNENMCY                                      S01509
043690200610     C                     MOVE NMCY      WCURR   3                       S01509
043700200610     C                     EXSR TG10                                      S01509
043710200610     C                     Z-ADDZCDP      ZCDPI                           S01509
043720200610     C                     MOVE SDCX      WCURR   3                       S01509
043730200610     C                     EXSR TG10                                      S01509
043740200610     C                     Z-ADDZCDP      ZCDPO                           S01509
043750200610     C                     MOVE NMCY      ZCCYI                           S01509
043760200610     C                     MOVE SDCX      ZCCYO                           S01509
043770200610     C                     Z-ADDWNOMAT    ZAMTCI                          S01509
043780200610     C                     Z-ADDSDCE      ZEXCH                           S01509
043790200610     C                     MOVE SDMD      ZMD                             S01509
043800200610     C                     EXSR ZCONV                                     S01509
043810200610     C                     Z-ADDZAMTCO    WNOMAT                          S01509
043820200610     C                     END                                            S01509
043830200610     C*                                                                   S01446
043840200610     C** For Courtage Enhancement, if Autocharge option is 'Y' and        S01446
043850200610     C** charge currency is not blank, update fields                      S01446
043860200610     C*                                                                   S01446
043870200610     C           S01446    IFEQ 'Y'                                       S01446
043880200610     C           BVACOP    ANDEQ'Y'                                       S01446
043890200610     C           BVCHRC    ANDNE*BLANKS                                   S01446
043900200610     C*                                                                   S01446
043910200610     C** Get M/D indicator and spot rate of input ccy from SDCURRPD       S01446
043920200610     C*                                                                   S01446
043930200610     C                     Z-ADD27        WDBAS1                          S01446
043940200610     C                     EXSR #LCURR                                    S01446
043950200610     C                     Z-ADDA6SPRT    ZRATE2                          S01446
043960200610     C                     MOVE A6MDIN    ZMDI2                           S01446
043970200610     C                     Z-ADDTXSPOT    ZRATE1                          S01446
043980200610     C                     MOVE TXMDI     ZMDI1                           S01446
043990200610     C                     EXSR ZXRATE                                    S01446
044000200610     C                     MOVE ZRATEX    TRATEX                          S01446
044010200610     C                     MOVE ZMDIX     TMDIX                           S01446
044020200610     C                     END                                            S01446
044030200610     C*
044040200610     C***AMOUNT*DUE*IS*NOMINAL*MATURING**AT*CUST.**+*INTEREST             E21138
044050200610     C** Amount due is nominal maturing at Customer (interest is separate)E21138
044060200610     C*
044070200610     C***********WNOMAT    ADD  ZINTDU    WRK130 130                      E21138
044080200610     C*
044090200610     C*                                                                   S01486
044100200610     C           BGPFMG    IFEQ 'Y'                                       S01486
044110200610     C           BGN4ST    OREQ 'Y'                                       CPB001
044120200610     C** MATURITY SETTLEMENT WILL BE PAID IN VALUE CURRENCY. HENCE IF     S01486
044130200610     C** NOMINAL CURRENCY DIFFERENT TO VALUE CURRENCY CONVERT AMMOUNT     S01486
044140200610     C                     Z-ADDWNOMAT    WNOMA1 150                      S01486
044150200610     C                     END                                            S01486
044160200610     C*
044170200610     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
044180200610     C*
044190200610     C*                                                                   S01486
044200200610     C           BGPFMG    IFEQ 'Y'                                       S01486
044210200610     C           BGN4ST    OREQ 'Y'                                       CPB001
044220200610     C           WPORTP    IFEQ 'Y'                                       S01486
044230200610     C           WPPOSN    OREQ 'N'                                       S01486
044240200610     C           PSRI      IFEQ 'Y'                                       S01486
044250200610     C*                                                                   S01486
044260200610     C* WRITE POSITION SETTLEMENT RECORD SUBR W02                         S01486
044270200610     C*                                                                   S01486
044280200610     C                     Z-ADDWNOMAT    PAMD                            S01486
044290200610     C                     MOVE 'MT'      PEVT                            S01486
044300200610     C*********************Z-ADDCSNV      PNMP                     S01486 093827
044310200610     C                     Z-ADDWWCSNV    PNMP                            093827
044320200610     C           PAMD      IFLT 0                                         S01486
044330200610     C                     Z-SUBPAMD      PAMD                            S01486
044340200610     C                     END                                            S01486
044350200610     C*                                                                   S01486
044360200610     C           WNOMAT    IFLE 0                                         S01486
044370200610     C                     MOVE 'R'       PPRE                            S01486
044380200610     C                     ELSE                                           S01486
044390200610     C                     MOVE 'P'       PPRE                            S01486
044400200610     C                     END                                            S01486
044410200610      *                                                                                       233709
044420200610     C                     Z-ADD0         TXNM                                                233709
044430200610     C                     Z-ADD0         TXST                                                233709
044440200610     C                     Z-ADD0         TAXA                                                233709
044450200610     C                     MOVE *BLANKS   TXCY                                                233709
044460200610     C*                                                                   S01486
044470200610      ** If CGL031 is on and security is taxable and classification is D or S,                233709
044480200610      ** perform the tax calulation.                                                          233709
044490200610      *                                                                                       233709
044500200610     C           CGL031    IFEQ 'Y'                                                           233709
044510200610     C           SETX      ANDEQ'Y'                                                           233709
044520200610     C********** CSNV      ANDGT*ZERO                                                  233709 234406
044530200610      *                                                                                       233709
044540200610     C********** C1DI      IFEQ 'D'                                                    CGL031 234440
044550200610     C********** C1DI      OREQ 'S'                                                    CGL031 234440
044560200610     C                     EXSR MATTAX                                                        233709
044570200610     C**********           ENDIF                                                       CGL031 234440
044580200610     C                     ENDIF                                                              233709
044590200610      *                                                                                       233709
044600200610     C/COPY WNCPYSRC,SE2400C036
044610200610     C                     EXSR W02                                       S01486
044620200610     C*                                                                   S01486
044630200610     C/COPY WNCPYSRC,SE2400C037
044640200610     C                     END                                            S01486
044650200610     C*                                                                   S01486
044660200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01                     S01486
044670200610     C*                                                                   S01486
044680200610     C           AKRI      IFEQ 'Y'                                       S01486
044690200610     C                     MOVE 'M'       WACEVC                          S01486
044700200610     C                     Z-ADDWNOMAT    WRK130 130                      S01486
044710200610     C           WRK130    IFGT 0                                         S01486
044720200610     C           NPAC      OREQ 'N'                                       S01486
044730200610     C                     MOVE ' '       WACNEG                          S01486
044740200610     C                     ELSE                                           S01486
044750200610     C                     MOVE 'N'       WACNEG                          S01486
044760200610     C                     END                                            S01486
044770200610     C                     MOVE 'CV'      WACAMC                          S01486
044780200610     C                     Z-ADDWRK130    EVAM                            S01486
044790200610     C           WRK130    IFLT 0                                         S01486
044800200610     C           NPAC      ANDEQ'Y'                                       S01486
044810200610     C                     Z-SUBEVAM      EVAM                            S01486
044820200610     C                     END                                            S01486
044830200610      *                                                                                       CGL031
044840200610     C                     Z-ADDEVAM      MATAMT 150                                          CGL031
044850200610     C*                                                                   S01486
044860200610     C* CHECK PORTFOLIO POSITION FLAG                                     S01486
044870200610     C                     EXSR W01                                       S01486
044880200610     C                     END                                            S01486
044890200610     C*                                                                   S01486
044900200610     C                     END                                            S01486
044910200610     C*                                                                   S01486
044920200610     C*  WRITE MATURED SECURITY POSITION EXTRACT FILE                     S01486
044930200610     C*                                                                   S01486
044940200610     C           WPORTP    IFNE 'Y'                                       S01486
044950200610     C                     EXSR W03                                       S01486
044960200610     C                     END                                            S01486
044970200610     C*                                                                   S01486
044980200610     C                     ELSE                                           S01486
044990200610     C*                                                                   S01486
045000200610     C*
045010200610     C           PSRI      IFEQ 'Y'
045020200610     C*
045030200610     C* WRITE POSITION SETTLEMENT RECORD SUBR W02
045040200610     C*
045050200610     C***********          Z-ADDWRK130    PAMD                            E21138
045060200610     C                     Z-ADDWNOMAT    PAMD                            E21138
045070200610     C**********           MOVE 'MA'      PEVT                            E14716
045080200610     C                     MOVE 'MT'      PEVT                            E14716
045090200610     C                     Z-ADDCSNV      PNMP
045100200610     C           PAMD      IFLT 0
045110200610     C                     Z-SUBPAMD      PAMD
045120200610     C                     END
045130200610     C*
045140200610     C***********WRK130    IFLE 0                                         E21138
045150200610     C           WNOMAT    IFLE 0                                         E21138
045160200610     C**********           MOVE 'P'       PPRE                            E14704
045170200610     C                     MOVE 'R'       PPRE                            E14704
045180200610     C                     ELSE
045190200610     C**********           MOVE 'R'       PPRE                            E14704
045200200610     C                     MOVE 'P'       PPRE                            E14704
045210200610     C                     END
045220200610      *                                                                                       233709
045230200610     C                     Z-ADD0         TXNM                                                233709
045240200610     C                     Z-ADD0         TXST                                                233709
045250200610     C                     Z-ADD0         TAXA                                                233709
045260200610     C                     MOVE *BLANKS   TXCY                                                233709
045270200610     C*
045280200610      ** If CGL031 is on and security is taxable and classification is D or S,                233709
045290200610      ** perform the tax calulation.                                                          233709
045300200610      *                                                                                       233709
045310200610     C           CGL031    IFEQ 'Y'                                                           233709
045320200610     C           SETX      ANDEQ'Y'                                                           233709
045330200610     C********** CSNV      ANDGT*ZERO                                                  233709 234406
045340200610      *                                                                                       233709
045350200610     C********** C1DI      IFEQ 'D'                                                    233709 234440
045360200610     C********** C1DI      OREQ 'S'                                                    233709 234440
045370200610     C                     EXSR MATTAX                                                        233709
045380200610     C**********           ENDIF                                                       233709 234440
045390200610     C                     ENDIF                                                              233709
045400200610      *                                                                                       233709
045410200610     C/COPY WNCPYSRC,SE2400C042
045420200610     C                     EXSR W02
045430200610     C/COPY WNCPYSRC,SE2400C043
045440200610     C*
045450200610     C                     END
045460200610     C*
045470200610     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
045480200610     C*
045490200610     C           AKRI      IFEQ 'Y'
045500200610     C                     MOVE 'M'       WACEVC
045510200610     C***********          Z-ADDWNOMAT    WRK130                   E21138 E23169
045520200610     C                     Z-ADDWNOMAT    WRK130 130                      E23169
045530200610     C           WRK130    IFGT 0
045540200610     C           NPAC      OREQ 'N'
045550200610     C                     MOVE ' '       WACNEG
045560200610     C                     ELSE
045570200610     C                     MOVE 'N'       WACNEG
045580200610     C                     END
045590200610     C                     MOVE 'CV'      WACAMC
045600200610     C                     Z-ADDWRK130    EVAM
045610200610     C           WRK130    IFLT 0
045620200610     C           NPAC      ANDEQ'Y'
045630200610     C                     Z-SUBEVAM      EVAM
045640200610     C                     END
045650200610      *                                                                                       CGL031
045660200610     C                     Z-ADDEVAM      MATAMT                                              CGL031
045670200610     C*
045680200610     C                     EXSR W01
045690200610     C/COPY WNCPYSRC,SE2400C015
045700200610     C*
045710200610     C**********           END                                            E14703
045720200610     C*
045730200610     C*  WRITE MATURED SECURITY POSITION EXTRACT FILE
045740200610     C*
045750200610     C                     EXSR W03
045760200610     C*                                                                   E14703
045770200610     C                     END                                            E14703
045780200610     C                     END                                            S01486
045790200610     C*
045800200610      ***If*CGL031*is*on*and*security*is*taxable*and*classification*is*D or S          CGL031 233709
045810200610      ***and*if*BGPFMG*or*BGN4ST*=*Y,*perform*the*tax*calulation.******                CGL031 233709
045820200610      *****************************************************************                CGL031 233709
045830200610     C***********CGL031    IFEQ 'Y'                                                    CGL031 233709
045840200610     C***********SETX      ANDEQ'Y'                                                    CGL031 233709
045850200610     C***********SAED      ANDLTBJDNWD                                                 CGL031 233709
045860200610     C***********CSNV      ANDGT*ZERO                                                  CGL031 233709
045870200610     C***********C1DI      IFEQ 'D'                                                    CGL031 233709
045880200610     C***********C1DI      OREQ 'S'                                                    CGL031 233709
045890200610     C***********BGPFMG    IFEQ 'Y'                                                    CGL031 233709
045900200610     C***********BGN4ST    OREQ 'Y'                                                    CGL031 233709
045910200610     C***********          EXSR MATTAX                                                 CGL031 233709
045920200610     C***********          ENDIF                                                       CGL031 233709
045930200610     C***********          ENDIF                                                       CGL031 233709
045940200610     C***********          ENDIF                                                       CGL031 233709
045950200610      *****************************************************************                CGL031 233709
045960200610     C           ENDMAT    ENDSR                           ** ENDMAT **
045970200610      *
045980200610      *****************************************************************                       CGL031
045990200610      /EJECT                                                                                  CGL031
046000200610      *****************************************************************                       CGL031
046010200610      *                                                               *                       CGL031
046020200610      *  MATTAX - Subroutine to calculate tax for descretionary and   *                       CGL031
046030200610      *           safe custody customers.                             *                       CGL031
046040200610      *                                                               *                       CGL031
046050200610      *****************************************************************                       CGL031
046060200610      *                                                                                       CGL031
046070200610     C           MATTAX    BEGSR                                                              CGL031
046080200610      *                                                                                       CGL031
046090200610      ** Check if record needs to be taxed.                                                   CGL031
046100200610      *                                                                                       CGL031
046110200610     C                     EXSR CHKTAX                                                        CGL031
046120200610      *                                                                                       CGL031
046130200610      ***A*separate*Coupon*Event*is*now*produced*at*Maturity*and*this**                CGL031 234440
046140200610      ***should*be*used*to*generate*Position*Settlement*for*Interest.**                CGL031 234440
046150200610      *                                                                                       CGL031
046160200610     C**********           MOVE NMCY      WCURR                                        CGL031 234440
046170200610     C**********           EXSR TG10                                                   CGL031 234440
046180200610     C**********           Z-ADDCDP       ZCDPF                                        CGL031 234440
046190200610      *                                                                                       CGL031
046200200610      ***Obtain*Price*at*Maturity*-*Check*LF/SEDEV*for*Redemption*Price                CGL031 234440
046210200610      *                                                                                       CGL031
046220200610     C**********           Z-ADD0         SDRP                                         CGL031 234440
046230200610     C**********           Z-ADDMATY      SDED                                         CGL031 234440
046240200610     C**********           MOVE 'RC'      SDET                                         CGL031 234440
046250200610      *                                                                                       CGL031
046260200610      ***Check*file*for*either*'RC'*Type*or*'RP'*Type*in*Key*field*****                CGL031 234440
046270200610      *                                                                                       CGL031
046280200610     C**********           EXSR SECEDI                                                 CGL031 234440
046290200610     C********** *IN78     IFEQ '1'                                                    CGL031 234440
046300200610     C**********           MOVE 'RP'      SDET                                         CGL031 234440
046310200610     C**********           EXSR SECEDI                                                 CGL031 234440
046320200610     C**********           ENDIF                                                       CGL031 234440
046330200610      *                                                                                       CGL031
046340200610     C********** *IN78     IFEQ '1'                                                    CGL031 234440
046350200610      *                                                                                       CGL031
046360200610      ***If*neither*RC*nor*RP*use*100*if*PRICE*BASIS*is*P,*else*1*(U)**                CGL031 234440
046370200610      ***Or*if*RP/RC*record*found*and*price*is*zero*and*S01509*is******                CGL031 234440
046380200610      ***active,*use*100*if*price*basis*is*P,*else*1*******************                CGL031 234440
046390200610      *                                                                                       CGL031
046400200610     C********** *IN78     OREQ '0'                                                    CGL031 234440
046410200610     C********** SDRP      ANDEQ0                                                      CGL031 234440
046420200610     C********** S01509    ANDEQ'Y'                                                    CGL031 234440
046430200610      *                                                                                       CGL031
046440200610     C********** SPBS      IFEQ 'P'                                                    CGL031 234440
046450200610     C**********           Z-ADD100       SDRP                                         CGL031 234440
046460200610     C**********           ENDIF                                                       CGL031 234440
046470200610     C********** PROT      IFEQ '1'                                                    CGL031 233709
046480200610     C********** SPBS      ANDEQ'U'                                                    CGL031 233709
046490200610     C**********           Z-ADD1         SDRP                                         CGL031 233709
046500200610     C**********           ENDIF                                                       CGL031 233709
046510200610     C**********           ENDIF                                                       CGL031 233709
046520200610      *                                                                                       CGL031
046530200610      ***Set*Nominal*Value*to*figure*from*PF/PMCPOSPD******************                CGL031 234440
046540200610      *                                                                                       CGL031
046550200610     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233709
046560200610     C**********           Z-ADDCDNV      WWCSNV                                       CGL031 233709
046570200610     C**********           Z-ADDAFPV      WWCSAV 150                                   CGL031 233567
046580200610     C**********           ELSE                                                        CGL031 233709
046590200610     C**********           Z-ADDCSNV      WWCSNV                                       CGL031 234440
046600200610     C**********           Z-ADDCSAV      WWCSAV                                       CGL031 235243
046610200610     C**********           Z-ADDAFPV      WWCSAV                                       235243 233567
046620200610     C**********           Z-ADDCSAV      WWCSAV 150                                   233567 233709
046630200610     C**********           ENDIF                                                       CGL031 233709
046640200610      *                                                                                       CGL031
046650200610      ***Nominal*Decimal*Places*retrieved*-*now*use*CCY*to*get*CCY*DP**                CGL031 234440
046660200610      *                                                                                       CGL031
046670200610     C**********           MOVE NMCY      WCURR                                        CGL031 234440
046680200610     C**********           EXSR TG10                                                   CGL031 234440
046690200610      *                                                                                       CGL031
046700200610      ***Use*ZCNSD*subroutine*to*calculate*Amount*****************                     CGL031 234440
046710200610      *                                                                                       CGL031
046720200610     C**********           Z-ADDSDRP      ZPRC                                         CGL031 234440
046730200610     C**********           Z-ADDWWCSNV    ZNOML                                        CGL031 234440
046740200610     C**********           EXSR ZCNSD                                                  CGL031 234440
046750200610     C**********           Z-ADDZCONS     WNOMAT                                       CGL031 234440
046760200610      *                                                                                       CGL031
046770200610      ***Use*ZCNSD*subroutine*to*calculate*Amount*for*CSAV*and*AFPV****                CGL031 233709
046780200610      ***Use*ZCNSD*subroutine*to*calculate*Amount*for*AFPV*************                CGL031 234440
046790200610      *                                                                                       CGL031
046800200610     C**********           Z-ADDSDRP      ZPRC                                         CGL031 233709
046810200610     C**********           Z-ADDWWCSAV    ZNOML                                        CGL031 233709
046820200610     C**********           EXSR ZCNSD                                                  CGL031 233709
046830200610     C**********           Z-ADDZCONS     WCSAV  150                                   CGL031 233709
046840200610      *                                                                                       CGL031
046850200610      ***If*S01509*is*active*and*redemption*currency*is*not*blank*and**                CGL031 234440
046860200610      ***is*different*from*the*nominal*currency,*convert*maturity******                CGL031 234440
046870200610      ***amount*to*redemption*currency*********************************                CGL031 234440
046880200610      *                                                                                       CGL031
046890200610     C********** S01509    IFEQ 'Y'                                                    CGL031 234440
046900200610     C********** *IN78     ANDEQ'0'                                                    CGL031 234440
046910200610     C********** SDCX      ANDNE*BLANKS                                                CGL031 234440
046920200610     C********** SDCX      ANDNENMCY                                                   CGL031 234440
046930200610     C**********           MOVE NMCY      WCURR                                        CGL031 234440
046940200610     C**********           EXSR TG10                                                   CGL031 234440
046950200610     C**********           Z-ADDZCDP      ZCDPI                                        CGL031 234440
046960200610     C**********           MOVE SDCX      WCURR                                        CGL031 234440
046970200610     C**********           EXSR TG10                                                   CGL031 234440
046980200610     C**********           Z-ADDZCDP      ZCDPO                                        CGL031 234440
046990200610     C**********           MOVE NMCY      ZCCYI                                        CGL031 234440
047000200610     C**********           MOVE SDCX      ZCCYO                                        CGL031 234440
047010200610     C**********           Z-ADDWNOMAT    ZAMTCI                                       CGL031 234440
047020200610     C**********           Z-ADDSDCE      ZEXCH                                        CGL031 234440
047030200610     C**********           MOVE SDMD      ZMD                                          CGL031 234440
047040200610     C**********           EXSR ZCONV                                                  CGL031 234440
047050200610     C**********           Z-ADDZAMTCO    WNOMAT                                       CGL031 234440
047060200610     C**********           ENDIF                                                       CGL031 234440
047070200610      *                                                                                       CGL031
047080200610      * Take on pgms for new countries of tax should ensure there is                   CGL031 234440
047090200610      * always an average fiscal price, so no need to check this.                      CGL031 234440
047100200610      ***Calculate*fiscal*price*numerator*at*value*date*when*needed****                CGL031 234440
047110200610      *                                                                                       233709
047120200610     C********** CSAV      IFEQ *ZERO                                                  CGL031 234440
047130200610     C********** RUND      ANDGEEWEDT1                                                 CGL031 234440
047140200610      *                                                                                       233709
047150200610     C********** CSDA      IFGT EWEDT1                                                 CGL031 234440
047160200610     C**********           Z-ADDCSDA      WBRKD   50                                   CGL031 234440
047170200610     C**********           ELSE                                                        CGL031 234440
047180200610     C**********           Z-ADDEWEDT1    WBRKD                                        233709 234440
047190200610     C**********           ENDIF                                                       233709 234440
047200200610      *                                                                                       233709
047210200610     C**********           CALL 'ZAINTPL2'                                             233709 234440
047220200610     C**********           PARM           ISSD                                         233709 234440
047230200610     C**********           PARM           WBRKD                                        233709 234440
047240200610     C**********           PARM           MATY                                         233709 234440
047250200610     C**********           PARM           ISSP                                         233709 234440
047260200610     C**********           PARM           SDRP                                         233709 234440
047270200610     C**********           PARM           WFSPR  158                                   233709 234440
047280200610      *                                                                                       233709
047290200610      ***Use*ZCNSD*subroutine*to*calculate*Amount*for*CSAV*************                233709 234440
047300200610      *                                                                                       233709
047310200610     C**********           Z-ADDWFSPR     ZPRC                                         233709 234440
047320200610     C**********           Z-ADDWWCSNV    ZNOML                                        233709 234440
047330200610     C**********           EXSR ZCNSD                                                  233709 234440
047340200610     C**********           Z-ADDZCONS     CSAV                                         233709 234440
047350200610     C**********           ENDIF                                                       233709 234440
047360200610     C                     MOVE 'Y'       WTXBLE           Amount is taxable                  236137
047370200610     C           WNOTAX    IFEQ 'Y'                        Begin Taxable                      236137
047380200610     C           ISSP      OREQ 100                                                           236137
047390200610     C                     MOVE 'N'       WTXBLE                                              236137
047400200610      *                                                                                       236137
047410200610     C                     ELSE                                                               236137
047420200610      *                                                                                       236137
047430200610      ** If record was found and De Minimis Rule is applicable, determine if                  236137
047440200610      ** amortized discount is taxable.                                                       236137
047450200610     C           EWDMAP    IFEQ 'Y'                        Begin EWDMAP                       236137
047460200610      *                                                                                       236137
047470200610     C           100       SUB  ISSP      WWAMT            Amortized Discount                 236137
047480200610      *                                                                                       236137
047490200610     C           WWAMT     IFLE EWTTDP                                                        236137
047500200610     C           MATY      SUB  ISSD      WWDAYS                                              236137
047510200610     C                     DIV  365       WWDAYS    H                                         236137
047520200610      *                                                                                       236137
047530200610     C           WWDAYS    IFNE *ZEROS                                                        236137
047540200610     C                     DIV  WWDAYS    WWAMT                                               236137
047550200610      *                                                                                       236137
047560200610     C           WWAMT     IFLE EWYRDP                                                        236137
047570200610     C                     MOVE 'N'       WTXBLE           Amount is not taxable              236137
047580200610      *                                                                                       236137
047590200610     C                     ENDIF                                                              236137
047600200610      *                                                                                       236137
047610200610     C                     ENDIF                                                              236137
047620200610      *                                                                                       236137
047630200610     C                     ENDIF                                                              236137
047640200610      *                                                                                       236137
047650200610     C                     ENDIF                           End EWDMAP                         236137
047660200610      *                                                                                       236137
047670200610     C                     ENDIF                           End Taxable                        236137
047680200610      *                                                                                       234440
047690200610      ** Calculate Tax Amount for the Maturity                                                234440
047700200610      *                                                                                       234440
047710200610     C***********WNOTAX****IFEQ*' '************************************                234440 236137
047720200610     C***********ISSP******ANDNE100************************************                234440 236137
047730200610     C           WTXBLE    IFEQ 'Y'                                                           236137
047740200610      *                                                                                       234440
047750200610      ** Get Average Fiscal Price of Position                                                 234440
047760200610      *                                                                                       234440
047770200610     C           WPORTP    IFEQ 'Y'                                                           234440
047780200610     C           BGPFMG    ANDEQ'Y'                                                           234440
047790200610     C           WPORTP    OREQ 'Y'                                                           234440
047800200610     C           BGN4ST    ANDEQ'Y'                                                           234440
047810200610      *                                                                                       234440
047820200610      ** Access Customer Position                                                             234440
047830200610      *                                                                                       234440
047840200610     C**********           Z-ADDCDCN      CDCNZN                                       236816 CSD027
047850200610     C                     MOVELCDCN      CDCNZN                                              CSD027
047860200610     C                     CALL WPGM                                                          234440
047870200610     C                     PARM           WRTCD  10                                           234440
047880200610     C                     PARM           CDPA                                                234440
047890200610     C**********           PARM           CDCN                                         234440 236816
047900200610     C                     PARM           CDCNZN                                              236816
047910200610     C                     PARM           CDSN                                                234440
047920200610     C                     PARM           PTFR                                                234440
047930200610     C                     PARM           CDMK                                                234440
047940200610     C                     PARM           SAED                                                234440
047950200610     C                     PARM           ETCPOS                                              234440
047960200610     C                     ELSE                                                               234440
047970200610     C                     CALL WPGM                                                          234440
047980200610     C                     PARM           WRTCD  10                                           234440
047990200610     C                     PARM           CSBA                                                234440
048000200610     C**********           PARM           CSSC                                         234440 236815
048010200610     C                     PARM           CSCN                                                234440
048020200610     C                     PARM           CSSC                                                236815
048030200610     C                     PARM *BLANKS   WPTFR   4                                           234440
048040200610     C                     PARM 'S'       WMKT    1                                           234440
048050200610     C                     PARM           SAED                                                234440
048060200610     C                     PARM           ETCPOS                                              234440
048070200610     C                     END                                                                234440
048080200610      *                                                                                       234440
048090200610      *                                                                                       233709
048100200610      ** If S01509 is active and value currency is not blank and                              CGL031
048110200610      ** is different from the nominal currency, convert average fiscal                       CGL031
048120200610      ** price numerator at value date to value currency                                      CGL031
048130200610      *                                                                                       CGL031
048140200610     C           S01509    IFEQ 'Y'                                                           CGL031
048150200610     C           VLCY      ANDNE*BLANKS                                                       CGL031
048160200610     C           VLCY      ANDNENMCY                                                          CGL031
048170200610     C                     MOVE NMCY      WCURR                                               CGL031
048180200610     C                     EXSR #LCURR                                                        CGL031
048190200610     C                     Z-ADDA6NBDP    ZCDPI                                               CGL031
048200200610     C                     Z-ADDA6SPRT    ZRATE1                                              CGL031
048210200610     C                     MOVE A6MDIN    ZMDI1                                               CGL031
048220200610     C                     MOVE VLCY      WCURR                                               CGL031
048230200610     C                     EXSR #LCURR                                                        CGL031
048240200610     C                     Z-ADDA6NBDP    ZCDPO                                               CGL031
048250200610     C                     Z-ADDA6SPRT    ZRATE2                                              CGL031
048260200610     C                     MOVE A6MDIN    ZMDI2                                               CGL031
048270200610     C                     MOVE NMCY      ZCCYI                                               CGL031
048280200610     C                     MOVE VLCY      ZCCYO                                               CGL031
048290200610      *                                                                                       CGL031
048300200610     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233567
048310200610     C**********           Z-ADDAFPV      ZAMTCI                                       CGL031 233567
048320200610     C**********           ELSE                                                        CGL031 233567
048330200610     C                     Z-ADDCSAV      ZAMTCI                                              CGL031
048340200610     C**********           ENDIF                                                       CGL031 233567
048350200610      *                                                                                       CGL031
048360200610     C                     EXSR ZXRATE                                                        CGL031
048370200610     C                     Z-ADDZRATEX    ZEXCH                                               CGL031
048380200610     C                     MOVE ZMDIX     ZMD                                                 CGL031
048390200610     C                     EXSR ZCONV                                                         CGL031
048400200610     C***********          Z-ADDZAMTCO    WCSAV                                        CGL031 233709
048410200610     C                     Z-ADDZAMTCO    WCSAV  150                                          233709
048420200610     C                     ELSE                                                               234440
048430200610     C                     Z-ADDCSAV      WCSAV                                               234440
048440200610     C                     ENDIF                                                              CGL031
048450200610      *                                                                                       CGL031
048460200610      ** Amount due is nominal maturing at Customer (interest is separate)                    CGL031
048470200610      *                                                                                       CGL031
048480200610      ** Maturity settlement will be paid in value currency. Hence if                         CGL031
048490200610      ** Nominal Currency different to Value Currency convert amount                          CGL031
048500200610      *                                                                                       CGL031
048510200610     C                     Z-ADDWNOMAT    WNOMA1                                              CGL031
048520200610      *                                                                                       CGL031
048530200610      ** If no record found, no tax is calculated                                             CGL031
048540200610      *                                                                                       CGL031
048550200610      ** Calculate Tax Amount for the Maturity or Early Redemption                            CGL031
048560200610      ** and to Output Information on SDCSINPD                                                CGL031
048570200610      *                                                                                       CGL031
048580200610     C********** WNOTAX    IFEQ ' '                                                    CGL031 234440
048590200610      *                                                                                       CGL031
048600200610      ** Compute the difference between WNOMAT and WCSAV.                                     CGL031
048610200610      ** If WNOMAT - WCSAV = negative or 0 nothing must be calculated or output               CGL031
048620200610      ** in SDCSINPD.                                                                         CGL031
048630200610      *                                                                                       CGL031
048640200610     C           WNOMA1    SUB  WCSAV     WRESLT 150                                          CGL031
048650200610      *                                                                                       CGL031
048660200610     C           WRESLT    IFGT 0                                                             CGL031
048670200610      *                                                                                       234440
048680200610      ** Tax amount is based upon the lesser of the discount accrued                          234440
048690200610      ** and the profit from the maturity, so calculate this, if country                      234440
048700200610      *  of tax is not Switzerland.                                                           234440
048710200610      *                                                                                       234440
048720200610      ** bit about CH is added and removed by this change control                             234440
048730200610      ** it is left in the code in case the situation changes again.                          234440
048740200610     C********** EWCTRT    IFNE 'CH'                                                          234440
048750200610      *                                                                                       234440
048760200610      ** N.B. TAKE PRICE FROM NEW CUSTOMER/PORTFOLIO FILE                                     234440
048770200610      ** - NOT AVAILABLE YET SO USED AVERAG PRICE FROM CPOSN                                  234440
048780200610      *                                                                                       234440
048790200610      ** convert average price numerator to value currency if necessary                       234440
048800200610      *                                                                                       234440
048810200610     C********** S01509    IFEQ 'Y'                                                    234440 236815
048820200610     C********** VLCY      ANDNE*BLANKS                                                234440 236815
048830200610     C********** VLCY      ANDNENMCY                                                   234440 236815
048840200610     C**********           Z-ADDCSPV      ZAMTCI                                       234440 236815
048850200610     C**********           Z-ADDAPNC      ZAMTCI                                       234440 236815
048860200610     C**********           EXSR ZCONV                                                  234440 236815
048870200610     C********** WNOMA1    SUB  ZAMTCO    WAVPA  150                                   234440 236815
048880200610     C**********           ENDIF                                                       234440 236815
048890200610     C********** WAVPA     IFLT WRESLT                                                 234440 236815
048900200610     C**********           Z-ADDWAVPA     WRESLT                                       234440 236815
048910200610     C**********           ENDIF                                                       234440 236815
048920200610     C**********           ENDIF                                                              234440
048930200610     C           WRESLT    IFGT 0                                                             234440
048940200610     C                     EXSR MATXCL                                                        CGL031
048950200610      *                                                                                       CGL031
048960200610      ***Output*Tax*Account*Keys***************************************                CGL031 233709
048970200610      **********                                                                       CGL031 233709
048980200610     C**********           EXSR W04                                                    CGL031 233709
048990200610     C                     ENDIF                                                              CGL031
049000200610     C                     ENDIF                                                              CGL031
049010200610     C                     ENDIF                                                              234440
049020200610      *                                                                                       CGL031
049030200610     C                     ENDSR                                                              CGL031
049040200610      *****************************************************************                       CGL031
049050200610      /EJECT                                                                                  CGL031
049060200610      *****************************************************************                       CGL031
049070200610      *                                                               *                       CGL031
049080200610      *  MATXCL - Subroutine to calculate tax amount for the Maturity *                       CGL031
049090200610      *           or Early Redemption and to Output Information on    *                       CGL031
049100200610      *           SDCSINPD                                            *                       CGL031
049110200610      *                                                               *                       CGL031
049120200610      *****************************************************************                       CGL031
049130200610      *                                                                                       CGL031
049140200610     C           MATXCL    BEGSR                                                              CGL031
049150200610      *                                                                                       CGL031
049160200610      ** Initialise work variables                                                            CGL031
049170200610      *                                                                                       CGL031
049180200610     C**********           Z-ADD0         WTTXSR                                       CGL031 233709
049190200610     C**********           Z-ADD0         WTTXSS                                       CGL031 233709
049200200610     C**********           Z-ADD0         WTTXSC                                       CGL031 233709
049210200610     C**********           Z-ADD0         WTTXSB                                       CGL031 233709
049220200610     C**********           Z-ADD0         WTNINT                                       CGL031 233709
049230200610     C**********           Z-ADD0         WTNINS                                       CGL031 233709
049240200610     C**********           Z-ADD0         WTNINC                                       CGL031 233709
049250200610     C**********           Z-ADD0         WTNINB                                       CGL031 233709
049260200610      *                                                                                       233709
049270200610     C           ISSP      IFGE 100                                                           233709
049280200610     C           SPBS      OREQ 'U'                                                           233709
049290200610     C                     Z-ADD*ZERO     @@TAXA                                              233709
049300200610     C                     GOTO ENDMTX                                                        233709
049310200610     C                     ENDIF                                                              233709
049320200610      *                                                                                       233709
049330200610     C                     Z-ADD0         TXNM                                                233709
049340200610     C                     Z-ADD0         TXST                                                233709
049350200610     C                     Z-ADD0         TAXA                                                233709
049360200610     C                     MOVE *BLANKS   TXCY                                                233709
049370200610     C                     MOVE ' '       WTXPI   1                                           CGL031
049380200610     C                     MOVE ' '       WTXJA   1                                           CGL031
049390200610      *                                                                                       CGL031
049400200610     C                     MOVE YCSCN     @@CUST                                              CGL031
049410200610      *                                                                                       CGL031
049420200610     C                     CALL 'ZATXCLPI'                                                    CGL031
049430200610      ** Input                                                                                CGL031
049440200610     C                     PARM 'S'       @@MODI                                              CGL031
049450200610     C                     PARM SASN      @@TRRF                                              CGL031
049460200610     C                     PARM YCSBA     @@BRCA                                              CGL031
049470200610     C                     PARM           @@CUST                                              CGL031
049480200610     C                     PARM *ZERO     @@STRD                                              CGL031
049490200610     C                     PARM *ZERO     @@ENDD                                              CGL031
049500200610     C                     PARM WRESLT    @@TOTI                                              CGL031
049510200610     C                     PARM WTRAB     @@TAXR                                              CGL031
049520200610     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
049530200610     C                     PARM NMCY      @@OCCY                                              233568
049540200610     C                     PARM *BLANKS   PINTH                                               CER048
049550200610      ** Output                                                                               CGL031
049560200610     C                     PARM           @@IAED                                              CGL031
049570200610     C                     PARM           @@TAXA                                              CGL031
049580200610     C                     PARM           @@TOTO                                              CGL031
049590200610     C                     PARM           @@TXCY                                              CGL031
049600200610     C                     PARM           @@CTAX                                              CGL031
049610200610     C                     PARM           @@TXBS                                              CGL031
049620200610     C                     PARM           @@WTAC                                              CGL031
049630200610     C                     PARM           @@COLC                                              CGL031
049640200610     C                     PARM           @@STAT                                              CGL031
049650200610     C                     PARM           @@TRTE                                              CGL031
049660200610     C                     PARM           @@TXR1                                              CGL031
049670200610     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
049680200610     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
049690200610     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
049700200610     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
049710200610     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
049720200610     C                     PARM           @@KEY                                               CGL031
049730200610     C                     PARM           @@FILE                                              CGL031
049740200610     C                     PARM           @@RTRN                                              CGL031
049750200610     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
049760200610      *                                                                                       CGL031
049770200610     C                     SELEC                                                              CGL031
049780200610      *                                                                                       CGL031
049790200610      ** If return code = Error.                                                              CGL031
049800200610      *                                                                                       CGL031
049810200610     C           @@RTRN    WHEQ 'ERROR'                                                       CGL031
049820200610     C                     MOVE @@FILE    DBFILE                                              CGL031
049830200610     C                     MOVE @@KEY     DBKEY                                               CGL031
049840200610     C                     Z-ADD63        DBASE                                               CGL031
049850200610     C                     MOVE *ON       *INU7                                               CGL031
049860200610     C                     MOVE *ON       *INU8                                               CGL031
049870200610     C                     EXSR *PSSR                                                         CGL031
049880200610     C                     GOTO EAUDIT                                                        CGL031
049890200610      *                                                                                       CGL031
049900200610      ** If return code = Private Individual                                                  CGL031
049910200610      *                                                                                       CGL031
049920200610     C           @@RTRN    WHNE 'JOINT'                                                       CGL031
049930200610      *                                                                                       CGL031
049940200610     C           @@TOTO    IFNE *ZERO                                                         CGL031
049950200610     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
049960200610     C           @@STAT    OREQ 'DISCL'                                                       CGL031
049970200610     C           @@STAT    OREQ 'SELF'                                                        CGL031
049980200610      *                                                                                       CGL031
049990200610     C                     MOVE 'Y'       WTXPI                                               CGL031
050000200610     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
050010200610     C                     MOVE S1CTTA    KCSIS                                               236815
050020200610     C                     MOVE @@CTAX    KCTRT                                               CGL031
050030200610      *                                                                                       CGL031
050040200610     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
050050200610     C           *IN61     IFEQ *OFF                                                          CGL031
050060200610      *                                                                                       CGL031
050070200610     C                     SELEC                                                              CGL031
050080200610     C           TCTXCM    WHEQ 1                                                             CGL031
050090200610     C           SWHTFD    OREQ 'N'                                                           236815
050100200610     C********** S1RASO    OREQ 0                                                      236815 234813
050110200610     C           UTXRSR    OREQ 0                                                             234813
050120200610     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
050130200610     C           TCTXCM    WHEQ 2                                                             CGL031
050140200610     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
050150200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
050160200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
050170200610     C                     DIV  100       WTAXA                                               236815
050180200610     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236815
050190200610     C                     MULT @@TAXR    @@TAXA                                              236815
050200200610     C                     DIV  100       @@TAXA    H                                         236815
050210200610     C           @@TAXA    IFLT 0                                                             236815
050220200610     C                     Z-ADD0         @@TAXA                                              236815
050230200610     C                     ENDIF                                                              236815
050240200610     C           TCTXCM    WHEQ 3                                                             CGL031
050250200610     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
050260200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
050270200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
050280200610     C                     DIV  100       WTAXA                                               236815
050290200610     C                     SUB  WTAXA     @@TAXA                                              236815
050300200610     C           @@TAXA    IFLT 0                                                             236815
050310200610     C                     Z-ADD0         @@TAXA                                              236815
050320200610     C                     ENDIF                                                              236815
050330200610     C           TCTXCM    WHEQ 4                                                             CGL031
050340200610     C                     Z-ADD0         @@TAXA                                              CGL031
050350200610     C                     ENDSL                                                              CGL031
050360200610      *                                                                                       CGL031
050370200610     C                     ENDIF                                                              CGL031
050380200610      *                                                                                       CGL031
050390200610      ** Write record to SDCSINPD                                                             CGL031
050400200610      *                                                                                       CGL031
050410200610     C                     EXSR CSINSR                                                        CGL031
050420200610      *                                                                                       CGL031
050430200610     C                     ENDIF                                                              CGL031
050440200610     C                     ENDIF                                                              CGL031
050450200610      *                                                                                       CGL031
050460200610      ** If return code = Private Individual                                                  CGL031
050470200610      *                                                                                       CGL031
050480200610     C           @@RTRN    WHEQ 'JOINT'                                                       CGL031
050490200610     C                     MOVE YCSCN     KJANO                                               CGL031
050500200610      *                                                                                       CGL031
050510200610     C           KJANO     SETLLSDJACCLB                                                      CGL031
050520200610     C           KJANO     READESDJACCLB                 60                                   CGL031
050530200610      *                                                                                       CGL031
050540200610     C           *IN60     DOWEQ*OFF                                                          CGL031
050550200610      *                                                                                       CGL031
050560200610     C                     CALL 'ZATXCLJA'                                                    CGL031
050570200610      ** Input                                                                                CGL031
050580200610     C                     PARM 'S'       @@MODI                                              CGL031
050590200610     C                     PARM SASN      @@TRRF                                              CGL031
050600200610     C                     PARM YCSBA     @@BRCA                                              CGL031
050610200610     C                     PARM JCJANO    @@JANO                                              CGL031
050620200610     C                     PARM JCCUST    @@CUST                                              CGL031
050630200610     C                     PARM JCNAHO    @@NARF                                              CGL031
050640200610     C                     PARM JCINVP    @@INVP                                              CGL031
050650200610     C                     PARM *ZERO     @@STRD                                              CGL031
050660200610     C                     PARM *ZERO     @@ENDD                                              CGL031
050670200610     C                     PARM WRESLT    @@TOTI                                              CGL031
050680200610     C                     PARM WTRAB     @@TAXR                                              CGL031
050690200610     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
050700200610     C                     PARM NMCY      @@OCCY                                              233568
050710200610     C                     PARM *BLANKS   PINTH                                               CER048
050720200610      ** Output                                                                               CGL031
050730200610     C                     PARM           @@IAED                                              CGL031
050740200610     C                     PARM           @@TAXA                                              CGL031
050750200610     C                     PARM           @@TOTO                                              CGL031
050760200610     C                     PARM           @@TXCY                                              CGL031
050770200610     C                     PARM           @@CTAX                                              CGL031
050780200610     C                     PARM           @@TXBS                                              CGL031
050790200610     C                     PARM           @@WTAC                                              CGL031
050800200610     C                     PARM           @@COLC                                              CGL031
050810200610     C                     PARM           @@STAT                                              CGL031
050820200610     C                     PARM           @@TRTE                                              CGL031
050830200610     C                     PARM           @@TXR1                                              CGL031
050840200610     C                     PARM           @@JAMG                                              CGL031
050850200610     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
050860200610     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
050870200610     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
050880200610     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
050890200610     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
050900200610     C                     PARM           @@KEY                                               CGL031
050910200610     C                     PARM           @@FILE                                              CGL031
050920200610     C                     PARM           @@RTRN                                              CGL031
050930200610     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
050940200610      *                                                                                       CGL031
050950200610      ** If return code = Error.                                                              CGL031
050960200610      *                                                                                       CGL031
050970200610     C           @@RTRN    IFEQ 'ERROR'                                                       CGL031
050980200610     C                     MOVE @@FILE    DBFILE                                              CGL031
050990200610     C                     MOVE @@KEY     DBKEY                                               CGL031
051000200610     C                     Z-ADD65        DBASE                                               CGL031
051010200610     C                     MOVE *ON       *INU7                                               CGL031
051020200610     C                     MOVE *ON       *INU8                                               CGL031
051030200610     C                     EXSR *PSSR                                                         CGL031
051040200610     C                     GOTO EAUDIT                                                        CGL031
051050200610     C                     ENDIF                                                              CGL031
051060200610      *                                                                                       CGL031
051070200610     C           @@TOTO    IFNE *ZERO                                                         CGL031
051080200610     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
051090200610     C           @@STAT    OREQ 'DISCL'                                                       CGL031
051100200610     C           @@STAT    OREQ 'SELF '                                                       CGL031
051110200610      *                                                                                       CGL031
051120200610     C                     MOVE 'Y'       WTXJA                                               CGL031
051130200610     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
051140200610     C                     MOVE S1CTTA    KCSIS                                               236815
051150200610     C                     MOVE @@CTAX    KCTRT                                               CGL031
051160200610      *                                                                                       CGL031
051170200610     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
051180200610     C           *IN61     IFEQ *OFF                                                          CGL031
051190200610      *                                                                                       CGL031
051200200610     C                     SELEC                                                              CGL031
051210200610     C           TCTXCM    WHEQ 1                                                             CGL031
051220200610     C           SWHTFD    OREQ 'N'                                                           236815
051230200610     C********** S1RASO    OREQ 0                                                      236815 234813
051240200610     C           UTXRSR    OREQ 0                                                             234813
051250200610     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
051260200610     C           TCTXCM    WHEQ 2                                                             CGL031
051270200610     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
051280200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
051290200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
051300200610     C                     DIV  100       WTAXA                                               236815
051310200610     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236815
051320200610     C                     MULT @@TAXR    @@TAXA                                              236815
051330200610     C                     DIV  100       @@TAXA    H                                         236815
051340200610     C           @@TAXA    IFLT 0                                                             236815
051350200610     C                     Z-ADD0         @@TAXA                                              236815
051360200610     C                     ENDIF                                                              236815
051370200610     C           TCTXCM    WHEQ 3                                                             CGL031
051380200610     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
051390200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
051400200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
051410200610     C                     DIV  100       WTAXA                                               236815
051420200610     C                     SUB  WTAXA     @@TAXA                                              236815
051430200610     C           @@TAXA    IFLT 0                                                             236815
051440200610     C                     Z-ADD0         @@TAXA                                              236815
051450200610     C                     ENDIF                                                              236815
051460200610     C           TCTXCM    WHEQ 4                                                             CGL031
051470200610     C                     Z-ADD0         @@TAXA                                              CGL031
051480200610     C                     ENDSL                                                              CGL031
051490200610      *                                                                                       CGL031
051500200610     C                     ENDIF                                                              CGL031
051510200610      *                                                                                       CGL031
051520200610      ** Write record to SDCSINPD                                                             CGL031
051530200610      *                                                                                       CGL031
051540200610     C                     EXSR CSINSR                                                        CGL031
051550200610      *                                                                                       CGL031
051560200610     C                     ENDIF                                                              CGL031
051570200610     C                     ENDIF                                                              CGL031
051580200610      *                                                                                       CGL031
051590200610     C           @@RTRN    IFEQ 'NOTAX'                                                       CGL031
051600200610     C           @@RTRN    OREQ 'TAXAB'                                                       CGL031
051610200610     C           KJANO     READESDJACCLB                 60                                   CGL031
051620200610     C                     ENDIF                                                              CGL031
051630200610      *                                                                                       CGL031
051640200610      ** If @@RTRN = Last, end loop                                                           CGL031
051650200610      *                                                                                       CGL031
051660200610     C           @@RTRN    IFEQ 'LAST'                                                        CGL031
051670200610     C                     MOVE *ON       *IN60                                               CGL031
051680200610     C                     ENDIF                                                              CGL031
051690200610      *                                                                                       CGL031
051700200610     C                     ENDDO                                                              CGL031
051710200610      *                                                                                       CGL031
051720200610     C                     ENDSL                                                              CGL031
051730200610      *                                                                                       CGL031
051740200610     C           ENDMTX    ENDSR                                                              CGL031
051750200610      *****************************************************************
051760200610      /EJECT
051770200610      *****************************************************************
051780200610      *                                                               *
051790200610      *  W01    - Subroutine to Write an Account Key.                 *
051800200610      *                                                               *
051810200610      *****************************************************************
051820200610      *
051830200610     C           W01       BEGSR                           **   W01  **
051840200610     C*
051850200610     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
051860200610     C*
051870200610     C           EVAM      CABEQ0         ENDW01
051880200610     C*
051890200610     C* COUNT RECORDS WRITTEN AND USE STD HASH SUBROUTINE
051900200610     C*
051910200610     C                     ADD  1         W01CNT  50
051920200610     C*
051930200610     C**  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
051940200610     C*   ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
051950200610     C*
051960200610     C                     Z-ADD1         Z
051970200610     C                     Z-ADD1         S
051980200610     C                     Z-ADDEVAM      ZZAMT
051990200610     C                     EXSR ZHASH
052000200610     C*
052010200610     C* BUILD OUTPUT RECORD
052020200610     C*
052030200610     C                     MOVE SITP      WACITY
052040200610     C                     MOVE ' '       WACTRT
052050200610     C                     MOVE *BLANKS   WARCTR                                              CGL031
052060200610     C*
052070200610     C** ACCESS CLINT FOR DISCRT IND FOR PORTFOLIO FLAG IN KEY
052080200610     C*
052090200610     C************         Z-ADDCSCN      WCLNTK                          074380
052100200610     C**********           Z-ADDCSCN      WCLNTK                                       111923 CSD027
052110200610     C                     MOVE CSCN      WCLNTK                                              CSD027
052120200610     C*
052130200610     C           BGPFMG    IFEQ 'Y'                                       S01486
052140200610     C           BGN4ST    OREQ 'Y'                                       CPB001
052150200610     C           WPORTP    IFEQ 'Y'                                       S01486
052160200610     C***********          Z-ADDQACNUM    WCLNTK                   S01486 189942
052170200610     C**********           Z-ADDCDCN      WCLNTK                                       189942 CSD027
052180200610     C                     MOVE CDCN      WCLNTK                                              CSD027
052190200610     C                     ELSE                                           074380
052200200610     C                     MOVE CSCN      WCLNTK                          074380
052210200610     C                     END                                            074380
052220200610     C*                                                                   081336
052230200610     C** OBTAIN BRANCH CODE OF CUSTOMER FROM CLINTCB                      081336
052240200610     C                     MOVE 'A'       WLIT1                           081336
052250200610     C                     EXSR CLNTIN                                    081336
052260200610     C                     MOVE '1'       WLIT1                           081336
052270200610     C                     MOVE BRCB      CSBA                            081336
052280200610     C***********          END                                      S01486074380
052290200610     C                     END                                            S01486
052300200610     C                     EXSR CLNTIN
052310200610     C           C1DI      IFEQ 'M'
052320200610     C                     MOVE *BLANKS   WACPFI
052330200610     C                     ELSE
052340200610     C                     MOVE C1DI      WACPFI
052350200610     C                     END
052360200610     C*
052370200610     C                     MOVE '  '      WACBKC
052380200610     C                     MOVE '  '      WACTST
052390200610     C                     MOVE '  '      WACPSB
052400200610     C                     MOVE '  '      WACCCC
052410200610     C***********          MOVE 'S'       WACMKT                          131379
052420200610     C                     MOVE MKTI      WACMKT                          131379
052430200610     C           CIAK      IFEQ 'Y'
052440200610     C           SCVI      ANDEQ'Y'                                       E14522
052450200610     C                     MOVE SCVI      WACCON
052460200610     C                     ELSE
052470200610     C                     MOVE ' '       WACCON
052480200610     C                     END
052490200610     C           WACAMC    IFEQ 'FP'                                      E16085
052500200610     C           WACAMC    OREQ 'FR'                                      E16085
052510200610     C           WACAMC    OREQ 'CP'                                      E16085
052520200610     C           WACAMC    OREQ 'CR'                                      E16085
052530200610     C                     MOVE *BLANKS   WACBKC                          E16085
052540200610     C                     END                                            E16085
052550200610     C                     MOVE WACKEY    ACKY
052560200610     C                     MOVE 'D'       RECI
052570200610     C*                                                                   S01509
052580200610     C** If S01509 is active, event currency could be equal to value ccy, S01509
052590200610     C** redemption ccy or nominal ccy depending on the event type        S01509
052600200610     C*                                                                   S01509
052610200610     C           S01509    IFEQ 'Y'                                       S01509
052620200610     C                     SELEC                                          S01509
052630200610     C           SAAT      WHEQ 'DV'                                      S01509
052640200610     C           SAAT      OREQ 'CP'                                      S01509
052650200610     C                     MOVE VLCY      EVCY                            S01509
052660200610     C           SAAT      WHEQ 'MA'                                      S01509
052670200610     C           *IN78     ANDEQ'0'                                       S01509
052680200610     C           SDCX      ANDNE*BLANKS                                   S01509
052690200610     C                     MOVE SDCX      EVCY                            S01509
052700200610     C                     OTHER                                          S01509
052710200610     C                     MOVE NMCY      EVCY                            S01509
052720200610     C                     ENDSL                                          S01509
052730200610     C*                                                                   S01509
052740200610     C                     ELSE                                           S01509
052750200610     C                     MOVE NMCY      EVCY
052760200610     C                     ENDIF                                          S01509
052770200610     C*                                                                   S01509
052780200610     C***        AUMO      IFEQ 'Y'                                 103361074380
052790200610     C***        PPRE      ANDEQ'R'                                 103361074380
052800200610     C           PPRE      IFEQ 'R'                                       074380
052810200610     C           SRSM      ANDEQ04                                        103361
052820200610     C***        AUMO      OREQ 'Y'                                 103361074380
052830200610     C***        PPRE      ANDEQ'P'                                 103361074380
052840200610     C           PPRE      OREQ 'P'                                       074380
052850200610     C           SPSM      ANDEQ04                                        103361
052860200610     C                     ELSE                                           103361
052870200610     C                     MOVE *BLANK    STLA
052880200610     C                     END                                            103361
052890200610     C*                                                                   103361
052900200610     C           WSRECI    IFEQ 'R'
052910200610     C                     MOVE '1'       RVRS
052920200610     C                     ELSE
052930200610     C                     MOVE '0'       RVRS
052940200610     C                     END
052950200610     C                     MOVE CSSC      SESH
052960200610     C           BGPFMG    IFEQ 'Y'                                                         AR877365
052970200610     C           BGN4ST    OREQ 'Y'                                                         AR877365
052980200610     C                     MOVE CDSN      SESH                                              AR877365
052990200610     C                     ENDIF                                                            AR877365
053000200610     C                     Z-ADD0         TRFR
053010200610     C**********           MOVELCSCN      CSTN                            102708
053020200610     C                     MOVELWCLNTK    CSTN                            102708
053030200610     C***********          MOVE CSBR      BRCH                            S01117
053040200610     C                     MOVE CSBA      BRHA                            S01117
053050200610     C           BGPFMG    IFEQ 'Y'                                                         AR877365
053060200610     C           BGN4ST    OREQ 'Y'                                                         AR877365
053070200610     C                     MOVE CDPA      BRHA                                              AR877365
053080200610     C                     ENDIF                                                            AR877365
053090200610     C**********           Z-ADD01        ASQN                            E18803
053100200610     C                     Z-ADD00        ASQN                            E18803
053110200610     C                     Z-ADDSAED      EVDT
053120200610     C                     Z-ADD0         KNCA
053130200610     C                     Z-ADD0         KBCA
053140200610     C***********          Z-ADD0         KCUST                           E19975
053150200610     C*                                                                   103361
053160200610     C***        AUMO      IFEQ 'Y'                                 103361074380
053170200610     C***        PPRE      ANDEQ'R'                                 103361074380
053180200610     C           PPRE      IFEQ 'R'                                       074380
053190200610     C           SRSM      ANDEQ04                                        103361
053200200610     C***        AUMO      OREQ 'Y'                                 103361074380
053210200610     C***        PPRE      ANDEQ'P'                                 103361074380
053220200610     C           PPRE      OREQ 'P'                                       074380
053230200610     C           SPSM      ANDEQ04                                        103361
053240200610     C                     ELSE                                           103361
053250200610     C                     Z-ADD0         STLT
053260200610     C                     END                                            103361
053270200610     C*                                                                   103361
053280200610     C***********          MOVE '   '     KCCY                            E15549
053290200610     C                     MOVE NMCY      KCCY                            E15549
053300200610     C*                                                                   S01117
053310200610     C* Output profit centre from related customer position               S01117
053320200610     C*                                                                   S01117
053330200610     C**    If Analytical Accounting is installed and customer            CAC002
053340200610     C**    position profit centre is blank, set the profit centre to     CAC002
053350200610     C**    SE ICD default profit centre.                                 CAC002
053360200610     C*                                                                   CAC002
053370200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
053380200610     C           PCCU      ANDEQ*BLANKS                                   CAC002
053390200610     C                     MOVE BVSEPC    PRFC                            CAC002
053400200610     C                     ELSE                                           CAC002
053410200610     C                     MOVE PCCU      PRFC                            S01117
053420200610     C                     ENDIF                                          CAC002
053430200610     C*                                                                   S01486
053440200610     C** SET UP PORTFOLIO REFERENCE TO BE OUTPUT                          S01486
053450200610     C           BGPFMG    IFEQ 'Y'                                       S01486
053460200610     C           BGN4ST    OREQ 'Y'                                       CPB001
053470200610     C                     MOVE PTFR      SSPTFR  4                       S01486
053480200610     C           WPORTP    IFNE 'Y'                                       S01486
053490200610     C                     MOVE *BLANKS   PTFR                            S01486
053500200610     C                     END                                            S01486
053510200610     C                     END                                            S01486
053520200610      *                                                                                       CGL020
053530200610     C           CGL020    IFEQ 'Y'                                                           CGL020
053540200610      *                                                                                       CGL020
053550200610     C           STLA      IFEQ *BLANKS                                                       CGL020
053560200610     C                     MOVE *BLANKS   F1RACT                                              CGL020
053570200610     C                     MOVE *BLANKS   F1RCTY                                              CGL020
053580200610     C                     MOVE *BLANKS   F1RBNK                                              CGL020
053590200610     C                     MOVE *BLANKS   F1RCDE                                              CGL020
053600200610     C                     MOVE *BLANKS   F1PACT                                              CGL020
053610200610     C                     MOVE *BLANKS   F1PCTY                                              CGL020
053620200610     C                     MOVE *BLANKS   F1PBNK                                              CGL020
053630200610     C                     MOVE *BLANKS   F1PCDE                                              CGL020
053640200610     C                     MOVE *BLANKS   F1DACT                                              CGL020
053650200610     C                     MOVE *BLANKS   F1DCTY                                              CGL020
053660200610     C                     MOVE *BLANKS   F1DBNK                                              CGL020
053670200610     C                     Z-ADD*ZEROS    F1SDAT                                              CGL020
053680200610      *                                                                                       CGL020
053690200610     C                     ELSE                                                               CGL020
053700200610     C                     MOVE WWRACT    F1RACT                                              CGL020
053710200610     C                     MOVE WWRCTY    F1RCTY                                              CGL020
053720200610     C                     MOVE WWRBNK    F1RBNK                                              CGL020
053730200610     C                     MOVE WWRCDE    F1RCDE                                              CGL020
053740200610     C                     MOVE WWPACT    F1PACT                                              CGL020
053750200610     C                     MOVE WWPCTY    F1PCTY                                              CGL020
053760200610     C                     MOVE WWPBNK    F1PBNK                                              CGL020
053770200610     C                     MOVE WWPCDE    F1PCDE                                              CGL020
053780200610     C                     MOVE WWDACT    F1DACT                                              CGL020
053790200610     C                     MOVE WWDCTY    F1DCTY                                              CGL020
053800200610     C                     MOVE WWDBNK    F1DBNK                                              CGL020
053810200610     C                     Z-ADDWWSDAT    F1SDAT                                              CGL020
053820200610      *                                                                                       CGL020
053830200610     C                     ENDIF                                                              CGL020
053840200610      *                                                                                       CGL020
053850200610     C                     MOVE *BLANKS   F1TICK                                              CGL020
053860200610     C                     MOVE *BLANKS   F1EXCH                                              CGL020
053870200610     C                     Z-ADD*ZEROS    F1NOML                                              CGL020
053880200610     C                     ENDIF                                                              CGL020
053890200610     C*
053900200610     C* WRITE GENERATED ACCOUNT KEY RECORD
053910200610     C*
053920200610     C                     WRITESEKEYDF
053930200610     C           BGPFMG    IFEQ 'Y'                                       S01486
053940200610     C           BGN4ST    OREQ 'Y'                                       CPB001
053950200610     C                     MOVE SSPTFR    PTFR                            S01486
053960200610     C                     END                                            S01486
053970200610     C*
053980200610     C           ENDW01    ENDSR                           ** ENDW01 **
053990200610      *
054000200610      *****************************************************************
054010200610      /EJECT
054020200610      *****************************************************************
054030200610      *                                                               *
054040200610      *  W02    - Subroutine to Write a Position Settlement.          *
054050200610      *                                                               *
054060200610      *****************************************************************
054070200610      *
054080200610     C           W02       BEGSR                           **   W02  **
054090200610     C/COPY WNCPYSRC,SE2400C056
054100200610     C*
054110200610     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
054120200610     C*
054130200610     C********** PAMD      CABEQ0         ENDW02                          S01486
054140200610      *                                                                                       263929
054150200610     C           PAMD      CABEQ0         ENDW02                                              263929
054160200610      *                                                                                       263929
054170200610     C********** BGPFMG    IFEQ 'Y'                                                    S01486 263929
054180200610     C********** BGN4ST    OREQ 'Y'                                                    CPB001 263929
054190200610     C********** PAMD      IFEQ 0                                                      S01486 263929
054200200610     C********** PEVT      ANDNE'MT'                                                   S01486 263929
054210200610     C**********           GOTO ENDW02                                                 S01486 263929
054220200610     C**********           END                                                         S01486 263929
054230200610     C**********           ELSE                                                        S01486 263929
054240200610     C********** PAMD      IFEQ 0                                                      S01486 263929
054250200610     C**********           GOTO ENDW02                                                 S01486 263929
054260200610     C**********           END                                                         S01486 263929
054270200610     C**********           END                                                         S01486 263929
054280200610      *                                                                                       260331
054290200610     C           WSRECI    IFEQ 'R'                                                           260331
054300200610     C           PPRE      IFEQ 'R'                                                           260331
054310200610     C                     MOVEL'P'       PPRE                                                260331
054320200610     C                     ELSE                                                               260331
054330200610     C           PPRE      IFEQ 'P'                                                           260331
054340200610     C                     MOVEL'R'       PPRE                                                260331
054350200610     C                     ENDIF                                                              260331
054360200610     C                     ENDIF                                                              260331
054370200610     C                     ENDIF                                                              260331
054380200610      *                                                                                       260331
054390200610     C/COPY WNCPYSRC,SE2400C057
054400200610     C*
054410200610     C* COUNT RECORDS WRITTEN
054420200610     C*
054430200610     C***********          ADD  1         W02CNT  50                      046500
054440200610     C*
054450200610     C                     MOVE 'D'       RECI
054460200610     C***********          MOVE 'S'       PMAR                            162208
054470200610     C                     MOVE MKTI      PMAR                            162208
054480200610     C***********          MOVE CSBR      PBCH                            S01117
054490200610     C***********          MOVE CSBA      PBCH                      S01117E33032
054500200610     C                     MOVE CSBA      PBCA                            E33032
054510200610     C                     MOVE CSSC      PSSH
054520200610     C                     MOVELCSCN      PCPY             ??10A/6N
054530200610     C*                                                                   CSE023
054540200610     C** Set up of field CTYP moved to before call to SE2310 to           187805
054550200610     C** avoid corruption when CLINTCB is read.                           187805
054560200610     C***********          MOVE 'C'       CTYP                     CSE023 187805
054570200610     C                     Z-ADD0         BAUS                            CSE023
054580200610     C                     Z-ADD0         MAMT                            CSE023
054590200610     C                     Z-ADD0         DAMT                            CSE023
054600200610     C                     Z-ADD0         PSEQ                            CSE023
054610200610     C                     Z-ADD0         SABC                            CSE023
054620200610     C           WPORTP    IFEQ 'Y'                                       081336
054630200610     C           BGPFMG    ANDEQ'Y'                                       081336
054640200610     C           WPORTP    OREQ 'Y'                                       CPB001
054650200610     C           BGN4ST    ANDEQ'Y'                                       CPB001
054660200610     C***********          MOVE QATDSS    PSSH                     081336 189942
054670200610     C***********          MOVE QACNUM    PCPY                     081336 189942
054680200610     C***********          Z-ADDQACNUM    WCLNTK                   S01486 189942
054690200610     C                     MOVE CDSN      PSSH                            189942
054700200610     C                     MOVE CDCN      PCPY                            189942
054710200610     C**********           Z-ADDCDCN      WCLNTK                                       189942 CSD027
054720200610     C                     MOVE CDCN      WCLNTK                                              CSD027
054730200610     C***********                                                  081336 189942
054740200610     C***OBTAIN*BRANCH CODE OF CUSTOMER FROM CLINTCB               081336 189942
054750200610     C***********          MOVE 'A'       WLIT1                    081336 189942
054760200610     C***********          EXSR CLNTIN                             081336 189942
054770200610     C***********          MOVE BRCB      PBCA                     081336 189942
054780200610     C*                                                                   189942
054790200610     C** SETUP BRANCH CODE FROM CDEPPD                                    189942
054800200610     C                     MOVE CDPA      PBCA                            189942
054810200610     C                     END                                            081336
054820200610     C*                                                                   S01512
054830200610     C** If S01512 is active, the payment value date for dividends must   S01512
054840200610     C** be the value date entered in the diary                           S01512
054850200610     C*                                                                   S01512
054860200610     C           SAAT      IFEQ 'MP'
054870200610     C           SAAT      OREQ 'DV'
054880200610     C           S01512    ANDNE'Y'                                       088423
054890200610     C                     Z-ADDSAOD      PDUD
054900200610     C                     ELSE
054910200610     C                     Z-ADDSAED      PDUD
054920200610     C                     END
054930200610     C/COPY WNCPYSRC,SE2400C016
054940200610     C*                                                                   S01512
054950200610     C** Value date - initially defaulted to PDUD.                        S01512
054960200610     C** If S01512 is active, value date should be the date of the next   S01512
054970200610     C** working day after value date in value currency.  For dividends   S01512
054980200610     C** payment value date must be the value date entered in the diary   S01512
054990200610     C*                                                                   S01512
055000200610     C***********S01512    IFEQ 'Y'                                 S01512105035
055010200610     C***********SAAT      IFEQ 'DV'                                088423105035
055020200610     C***********SAOD      SUB  1         ZDAYNO                    088423105035
055030200610     C***********          ELSE                                     088423105035
055040200610     C***********PDUD      SUB  1         ZDAYNO                    S01512105035
055050200610     C***********          ENDIF                                    088423105035
055060200610     C***********          Z-ADD1         ZNRDYS                    S01512105035
055070200610     C***********          MOVE PNCY      ZCCY                      S01512105035
055080200610     C***********          EXSR ZFWDT                               S01512105035
055090200610     C***********          Z-ADDZDYNBR    PSVL                      S01512105035
055100200610     C***********          ELSE                                     S01512105035
055110200610     C***********SAAT      IFEQ 'DV'                                088423105035
055120200610     C***********          Z-ADDSAOD      PSVL                      088423105035
055130200610     C***********          ELSE                                     088423105035
055140200610     C************         Z-ADDPDUD      PSVL                      S01512105035
055150200610     C************         ENDIF                                    088423105035
055160200610     C************         END                                      S01512105035
055170200610     C*                                                                   S01512
055180200610     C           APNS      IFEQ 'Y'
055190200610     C                     MOVE 'Y'       PAUI
055200200610     C                     MOVE 'Y'       PSMI                            S01401
055210200610     C                     ELSE
055220200610     C                     MOVE ' '       PAUI
055230200610     C                     END
055240200610     C           BGPFMG    IFEQ 'Y'                                       081336
055250200610     C           BGN4ST    OREQ 'Y'                                       CPB001
055260200610     C           SAAT      IFEQ 'PP'                                      081336
055270200610     C           SAAT      OREQ 'MP'                                      081336
055280200610     C           SAAT      OREQ 'MA'                                      081336
055290200610     C                     MOVE NMCY      PNCY                            081336
055300200610     C                     ELSE                                           081336
055310200610     C                     MOVE VLCY      PNCY                            081336
055320200610     C                     END                                            081336
055330200610     C                     ELSE                                           081336
055340200610     C                     MOVE NMCY      PNCY
055350200610     C                     END                                            081336
055360200610     C*                                                                   S01509
055370200610     C** If S01509 is active, position currency could be equal to value   S01509
055380200610     C** ccy, redemption ccy or nominal ccy depending on the event type   S01509
055390200610     C*                                                                   S01509
055400200610     C           S01509    IFEQ 'Y'                                       S01509
055410200610     C                     SELEC                                          S01509
055420200610     C           SAAT      WHEQ 'DV'                                      S01509
055430200610     C           SAAT      OREQ 'CP'                                      S01509
055440200610     C                     MOVE VLCY      PNCY                            S01509
055450200610     C           SAAT      WHEQ 'MA'                                      S01509
055460200610     C           *IN78     ANDEQ'0'                                       S01509
055470200610     C           SDCX      ANDNE*BLANKS                                   S01509
055480200610     C                     MOVE SDCX      PNCY                            S01509
055490200610     C                     OTHER                                          S01509
055500200610     C                     MOVE NMCY      PNCY                            S01509
055510200610     C                     ENDSL                                          S01509
055520200610     C*                                                                   S01509
055530200610     C                     ELSE                                           S01509
055540200610     C                     MOVE NMCY      PNCY
055550200610     C                     ENDIF                                          S01509
055560200610     C**
055570200610     C** Value date - initially defaulted to PDUD.                        105035
055580200610     C** If S01512 is active, value date should be the date of the next   105035
055590200610     C** working day after value date in value currency.  For dividends   105035
055600200610     C** payment value date must be the value date entered in the diary   105035
055610200610     C*                                                                   105035
055620200610     C           S01512    IFEQ 'Y'                                       105035
055630200610     C           SAAT      IFEQ 'DV'                                      105035
055640200610     C           SAOD      SUB  1         ZDAYNO                          105035
055650200610     C                     ELSE                                           105035
055660200610     C           PDUD      SUB  1         ZDAYNO                          105035
055670200610     C                     ENDIF                                          105035
055680200610     C                     Z-ADD1         ZNRDYS                          105035
055690200610     C                     MOVE PNCY      ZCCY                            105035
055700200610     C                     EXSR ZFWDT                                     105035
055710200610     C                     Z-ADDZDYNBR    PSVL                            105035
055720200610     C                     ELSE                                           105035
055730200610     C           SAAT      IFEQ 'DV'                                      105035
055740200610     C                     Z-ADDSAOD      PSVL                            105035
055750200610     C                     ELSE                                           105035
055760200610     C                     Z-ADDPDUD      PSVL                            105035
055770200610     C                     ENDIF                                          105035
055780200610     C                     END                                            105035
055790200610     C*                                                                   S01509
055800200610     C**********           MOVE DMKB      PBCD                            E14718
055810200610     C                     MOVE DPFB      PBCD                            E14718
055820200610     C                     MOVE '0'       PYCUSD  1
055830200610      *                                                                   E23169
055840200610      ** Payment currency and settlement exchange rate are held on        E23169
055850200610      ** SECTYD for straight, dual- and multi-currency securities.        E23169
055860200610      ** Exchange rate=1 for straight securities.                         E23169
055870200610     C** If S01509 is active, settle = pos currency, exchange rate is     S01509
055880200610     C** 1 with mult/div indicator as 'M'                                 S01509
055890200610      *                                                                   E23169
055900200610     C           S01509    IFEQ 'Y'                                       S01509
055910200610     C                     MOVE PNCY      PSCU                            S01509
055920200610     C                     Z-ADD1         PSXR                            S01509
055930200610     C                     MOVE 'M'       PMDI                            S01509
055940200610     C                     ELSE                                           S01509
055950200610     C                     MOVE SPYC      PSCU                            E23169
055960200610     C                     Z-ADDSEXR      PSXR                            E23169
055970200610     C                     MOVE SMDI      PMDI                            E23169
055980200610     C                     END                                            S01509
055990200610      *                                                                   E23169
056000200610     C***********VLCY      IFNE '   '                                     E23169
056010200610     C*********************MOVE VLCY      PSCU                            E23169
056020200610     C*********************ELSE                                           E23169
056030200610     C***********SPYC      IFNE '   '                                     E23169
056040200610     C*                                                                   E23169
056050200610     C***IF*PAYMENT*CURRENCY*USED*SET*FLAG*PYCUSD*TO*1*-*CHECK*BELOW***** E23169
056060200610     C*                                                                   E23169
056070200610     C*********************MOVE '1'       PYCUSD                          E23169
056080200610     C*********************MOVE SPYC      PSCU                            E23169
056090200610     C*********************ELSE                                           E23169
056100200610     C*********************MOVE NMCY      PSCU                            E23169
056110200610     C*********************END                                            E23169
056120200610     C*********************END                                            E23169
056130200610     C*                                                                   E23169
056140200610     C***CALCULATE*SETTLEMENT*EXCHANGE*RATE*-*CHECK*FLAG*PYCUSD********** E23169
056150200610     C*                                                                   E23169
056160200610     C***********PYCUSD    IFEQ '1'                                       E23169
056170200610     C*********************Z-ADDSEXR      PSXR                            E23169
056180200610     C*********************MOVE SMDI      PMDI                            E23169
056190200610     C*********************ELSE                                           E23169
056200200610     C*                                                                   E23169
056210200610     C**GET*SPOT*RATE*FOR*EACH*OF*SETT.*CCY*AND*NOM*CCY*FROM*TABTG10*     E23169
056220200610     C**THEN*CALCULATE*CROSS*RATE*USING*ZXRATE*************************** E23169
056230200610     C*                                                                   E23169
056240200610     C*********************MOVE PSCU      WCURR                           E23169
056250200610     C*********************EXSR TG10                                      E23169
056260200610     C*********************Z-ADDSPOT      ZRATE1 138                      E23169
056270200610     C*********************MOVE MDIN      ZMDI1   1                       E23169
056280200610     C*********************MOVE PNCY      WCURR                           E23169
056290200610     C*********************EXSR TG10                                      E23169
056300200610     C*********************Z-ADDSPOT      ZRATE2 138                      E23169
056310200610     C*********************MOVE MDIN      ZMDI2   1                       E23169
056320200610     C*********************EXSR ZXRATE                                    E23169
056330200610     C*********************Z-ADDZRATEX    PSXR                            E23169
056340200610     C*                                                                   E23169
056350200610     C***MULTIPLY/DIVIDE*IND*ON*TABTG10*IS*0=DIV*1=MULT****************** E23169
056360200610     C*                                                                   E23169
056370200610     C***********ZMDIX     IFEQ '0'                                       E23169
056380200610     C*********************MOVEL'D'       PMDI                            E23169
056390200610     C*********************ELSE                                           E23169
056400200610     C*********************MOVEL'M'       PMDI                            E23169
056410200610     C*********************END                                            E23169
056420200610     C*********************END                                            E23169
056430200610     C/COPY WNCPYSRC,SE2400C017
056440200610     C*
056450200610     C** BASIC CURR EXCHANGE RATE IS SPOT RATE FOR SETTLEMENT CURRCY
056460200610     C*
056470200610     C                     MOVE PSCU      WCURR
056480200610     C                     EXSR TG10
056490200610     C                     Z-ADDSPOT      PBRX
056500200610     C/COPY WNCPYSRC,SE2400C018
056510200610     C*
056520200610     C** ACCESS STANDARD SETTLEMENT INSTRUCTIONS FILE
056530200610     C*
056540200610     C***********          MOVE PBCH      SBRH                            S01117
056550200610     C***********          MOVE PBCH      SBRA                      S01117E33032
056560200610     C                     MOVE PBCA      SBRA                            E33032
056570200610     C                     MOVELPCPY      CSTM
056580200610     C                     MOVE PSCU      CYSI
056590200610     C                     MOVE SITP      ITSI
056600200610     C                     MOVE *BLANK    PSEA
056610200610     C                     MOVE *BLANK    PSEB
056620200610     C                     MOVE *BLANK    PCPN
056630200610     C                     MOVE *BLANK    PFAC
056640200610     C                     MOVE *BLANK    PSPI
056650200610     C                     MOVE *ZEROS    PSMT                            048612
056660200610      *                                                                                       CSE028
056670200610      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
056680200610      *                                                                                       CSE028
056690200610     C           CSE028    IFEQ 'Y'                                                           CSE028
056700200610      *                                                                                       CSE028
056710200610     C                     MOVEL*BLANKS   WBKCD                                               CSE028
056720200610     C                     MOVELPTFR      WPTFR                                               CSE028
056730200610     C                     MOVELCSTM      WCUST2  6                                           CSE028
056740200610      *                                                                                       CSE028
056750200610     C                     CALL 'SESSIR0'                                                     CSE028
056760200610     C                     PARM 'D'       POTYP   1                                           CSE028
056770200610     C**********           PARM           SBRA                                         CSE028 CSE034
056780200610     C                     PARM SBRA      PSBRA   3                                           CSE034
056790200610     C                     PARM           WCUST2                                              CSE028
056800200610     C                     PARM           WBKCD                                               CSE028
056810200610     C**********           PARM           CYSI                                         CSE028 CSE034
056820200610     C                     PARM CYSI      PCYSI   3                                           CSE034
056830200610     C                     PARM SMCC      PMKTC   2                                           CSE034
056840200610     C**********           PARM           ITSI                                         CSE028 CSE034
056850200610     C                     PARM ITSI      PITSI   3                                           CSE034
056860200610     C                     PARM           WPTFR                                               CSE028
056870200610     C                     PARM           PCBSTD                                              CSE028
056880200610     C                     PARM           PCBSAD                                              CSE028
056890200610     C                     PARM *BLANKS   PRTCD   5                                           CSE028
056900200610      *                                                                                       CSE028
056910200610     C           PRTCD     IFNE '*NCRF'                                                       CSE028
056920200610     C           PRTCD     ANDNE'*NRF '                                                       CSE028
056930200610     C           2         OCUR PCBSTD                                                        CSE028
056940200610     C                     MOVE '0'       *IN77                                               CSE028
056950200610     C                     ELSE                                                               CSE028
056960200610     C                     MOVE '1'       *IN77                                               CSE028
056970200610     C                     ENDIF                                                              CSE028
056980200610      *                                                                                       CSE028
056990200610     C                     ELSE                                                               CSE028
057000200610      *                                                                                       CSE028
057010200610     C                     MOVEL*BLANKS   WBKCD                                               CSE028
057020200610     C                     MOVEL*BLANKS   WPTFR                                               CSE028
057030200610      *                                                                                       CSE028
057040200610     C                     MOVE PCPY      WCLNTK                          E16085
057050200610     C           CLINTK    CHAINCLINT                99                   E16085
057060200610     C           *IN99     IFEQ '0'                                       E16085
057070200610     C           C1DI      ANDNE'M'                                       E16085
057080200610     C                     MOVE *BLANK    ITSI                            E16085
057090200610     C                     END                                            E16085
057100200610     C/COPY WNCPYSRC,SE2400C038
057110200610     C           STDSKY    CHAINSTDSED               77
057120200610      *                                                                                       CSE028
057130200610     C                     ENDIF                                                              CSE028
057140200610      *                                                                                       CSE028
057150200610     C/COPY WNCPYSRC,SE2400C055
057160200610     C           *IN77     IFNE '1'
057170200610     C           RECI      ANDNE'*'
057180200610      *                                                                   147514
057190200610     C                     MOVE *OFF      *IN88                           147514
057200200610      *                                                                   CEU005
057210200610      * CEU005 active and Settlement Ccy used on STDSED.                  CEU005
057220200610     C           CEU005    IFEQ 'Y'                                       CEU005
057230200610     C           SCCY      ANDNE*BLANKS                                   CEU005
057240200610      *                                                                   CEU005
057250200610      * Access currencies file for EURO rate, EURO M/D indicator and      CEU005
057260200610      * Transition Date for 'In' Ccy.                                     CEU005
057270200610      * Settlement Currency is 'IN' ccy.                                  CEU005
057280200610      *                                                                   CEU005
057290200610     C           PSCU      IFEQ BKEURO                                    CEU005
057300200610     C                     CALL 'AOCURRR0'                                CEU005
057310200610     C                     PARM           @RTCD   7                       CEU005
057320200610     C                     PARM '*KEY   ' @OPTN   7                       CEU005
057330200610     C                     PARM SCCY      @AJCD   3                       CEU005
057340200610     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
057350200610      * Database error                                                    CEU005
057360200610     C           @RTCD     IFNE *BLANKS                                   CEU005
057370200610     C                     Z-ADD44        DBASE            ************** CEU005
057380200610     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 44* CEU005
057390200610     C                     MOVELSCCY      DBKEY            ************** CEU005
057400200610     C                     EXSR *PSSR                                     CEU005
057410200610     C                     ENDIF                                          CEU005
057420200610      *                                                                   CEU005
057430200610      * Due currency is 'IN' ccy.                                         CEU005
057440200610      *                                                                   CEU005
057450200610     C                     ELSE                                           CEU005
057460200610     C           SCCY      IFEQ BKEURO                                    CEU005
057470200610     C                     CALL 'AOCURRR0'                                CEU005
057480200610     C                     PARM           @RTCD   7                       CEU005
057490200610     C                     PARM '*KEY   ' @OPTN   7                       CEU005
057500200610     C                     PARM PSCU      @AJCD   3                       CEU005
057510200610     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
057520200610      * Database error                                                    CEU005
057530200610     C           @RTCD     IFNE *BLANKS                                   CEU005
057540200610     C                     Z-ADD45        DBASE             ************* CEU005
057550200610     C                     MOVEL'SDCURRPD'DBFILE            * DB ERROR 45*CEU005
057560200610     C                     MOVELPSCU      DBKEY             **************CEU005
057570200610     C                     EXSR *PSSR                                     CEU005
057580200610     C                     ENDIF                                          CEU005
057590200610     C                     ENDIF                                          CEU005
057600200610     C                     ENDIF                                          CEU005
057610200610      *                                                                   CEU005
057620200610      * Value date is later than Transition Start Date.                   CEU005
057630200610     C           PSVL      IFGE A6TPSD                                    CEU005
057640200610     C           A6INCY    ANDEQ'Y'                                       143690
057650200610     C                     Z-ADDA6EUER    PSXR                            CEU005
057660200610      *                                                                   CEU005
057670200610      **Settlement*ccy*is*Euro*currency,*reverse*M/D*indicator.    CEU005 143690
057680200610     C** Nominal ccy is Euro currency, reverse M/D indicator.             143690
057690200610     C***********SCCY      IFEQ BKEURO                             CEU005 143690
057700200610     C           PSCU      IFEQ BKEURO                                    143690
057710200610     C           A6EUMD    IFEQ 'M'                                       CEU005
057720200610     C                     MOVE 'D'       PMDI                            CEU005
057730200610     C                     ELSE                                           CEU005
057740200610     C                     MOVE 'M'       PMDI                            CEU005
057750200610     C                     ENDIF                                          CEU005
057760200610      *                                                                   CEU005
057770200610      **Settlement*ccy*not*Euro*ccy,*use*Euro*M/D*indicator.       CEU005 143690
057780200610     C** Settlement ccy is Euro ccy, use Euro M/D indicator.              143690
057790200610     C                     ELSE                                           CEU005
057800200610     C                     MOVE A6EUMD    PMDI                            CEU005
057810200610     C                     ENDIF                                          CEU005
057820200610      *                                                                   CEU005
057830200610      * Use standard settlement ccy for position settlement ccy           CEU005
057840200610     C                     MOVE SCCY      PSCU                            CEU005
057850200610      *                                                                   194195
057860200610     C                     MOVE PSCU      WCURR                           194195
057870200610     C                     EXSR TG10                                      194195
057880200610     C                     Z-ADDSPOT      PBRX                            194195
057890200610      * Chain STDSED again.                                               CEU005
057900200610     C                     MOVE SCCY      CYSI                            CEU005
057910200610     C***********STDSKY    CHAINSTDSED               78            CEU005 147514
057920200610      *                                                                                       CSE028
057930200610      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
057940200610      *                                                                                       CSE028
057950200610     C           CSE028    IFEQ 'Y'                                                           CSE028
057960200610      *                                                                                       CSE028
057970200610     C                     CALL 'SESSIR0'                                                     CSE028
057980200610     C                     PARM 'D'       POTYP   1                                           CSE028
057990200610     C**********           PARM           SBRA                                         CSE028 CSE034
058000200610     C                     PARM SBRA      PSBRA                                               CSE034
058010200610     C                     PARM           WCUST2                                              CSE028
058020200610     C                     PARM           WBKCD                                               CSE028
058030200610     C**********           PARM           CYSI                                         CSE028 CSE034
058040200610     C                     PARM CYSI      PCYSI                                               CSE034
058050200610     C                     PARM SMCC      PMKTC                                               CSE034
058060200610     C**********           PARM           ITSI                                         CSE028 CSE034
058070200610     C                     PARM ITSI      PITSI                                               CSE034
058080200610     C                     PARM           WPTFR                                               CSE028
058090200610     C                     PARM           PCBSTD                                              CSE028
058100200610     C                     PARM           PCBSAD                                              CSE028
058110200610     C                     PARM *BLANKS   PRTCD                                               CSE028
058120200610      *                                                                                       CSE028
058130200610     C           PRTCD     IFNE '*NCRF'                                                       CSE028
058140200610     C           PRTCD     ANDNE'*NRF '                                                       CSE028
058150200610     C           2         OCUR PCBSTD                                                        CSE028
058160200610     C                     MOVE '0'       *IN88                                               CSE028
058170200610     C                     ELSE                                                               CSE028
058180200610     C                     MOVE '1'       *IN88                                               CSE028
058190200610     C                     ENDIF                                                              CSE028
058200200610      *                                                                                       CSE028
058210200610     C                     ELSE                                                               CSE028
058220200610      *                                                                                       CSE028
058230200610     C           STDSKY    CHAINSTDSED               88                   147514
058240200610      *                                                                                       CSE028
058250200610     C                     ENDIF                                                              CSE028
058260200610      *                                                                                       CSE028
058270200610     C/COPY WNCPYSRC,SE2400C064
058280200610     C*****                ENDIF                                   CEU005 147869
058290200610     C*****                ENDIF                                   CEU005 147869
058300200610     C                     ENDIF                                          175400
058310200610     C                     ENDIF                                          175400
058320200610      *                                                                   CEU005
058330200610      * If no record found ensure fields from last chain not loaded       CEU005
058340200610      * to output fields.                                                 CEU005
058350200610     C************IN78     IFEQ '1'                                CEU005 147514
058360200610     C           *IN88     IFEQ *ON                                       147514
058370200610     C           CEU005    ANDEQ'Y'                                       175400
058380200610     C                     MOVE *BLANKS   PSMT                            CEU005
058390200610     C                     MOVE *BLANKS   PSEA                            CEU005
058400200610     C                     MOVE *BLANKS   PSEB                            CEU005
058410200610     C                     MOVE *BLANKS   PCPN                            CEU005
058420200610     C                     MOVE *BLANKS   PFAC                            CEU005
058430200610     C                     MOVE *BLANKS   PSPI                            CEU005
058440200610     C                     MOVE *BLANKS   STLA                            CEU005
058450200610     C                     Z-ADD0         STLT                            CEU005
058460200610     C                     MOVE *BLANKS   PRCNUM                          CEU005
058470200610     C                     MOVE *BLANKS   PRACOD                          CEU005
058480200610     C                     MOVE *BLANKS   PRACSQ                          CEU005
058490200610     C                     MOVE *BLANKS   PPFC                            CEU005
058500200610     C***********          ENDIF                                    147869175400
058510200610     C***********          ENDIF                                    147869175400
058520200610     C                     ELSE                                           CEU005
058530200610     C*
058540200610     C** USE RECEIVE FIELDS IF PAY/RECEIVE IND IS SET TO P
058550200610     C*
058560200610     C           PPRE      IFEQ 'P'
058570200610     C                     MOVE SPSM      PSMT
058580200610     C                     MOVE SPAT      PSEA
058590200610     C***********          MOVE SPBR      PSEB                            S01117
058600200610     C                     MOVE SPBA      PSEB                            S01117
058610200610     C                     MOVE SPCB      PCPN
058620200610     C                     MOVE SPFA      PFAC
058630200610     C                     MOVE SPSI      PSPI
058640200610      *                                                                   103361
058650200610     C                     MOVE SPAT      STLA                            103361
058660200610     C                     Z-ADDSPSM      STLT                            103361
058670200610      *                                                                   103361
058680200610      ** If settlement method is '04' and settlement account is blank,    103361
058690200610      ** retrieve prime account number                                    103361
058700200610      *                                                                   103361
058710200610     C           STLT      IFEQ 04                                        103361
058720200610     C           STLA      ANDEQ*BLANKS                                   103361
058730200610      *                                                                   103361
058740200610      * Retrieve prime account                                            103361
058750200610      *                                                                   103361
058760200610     C                     MOVE CSTM      PRCNUM                          103361
058770200610     C                     MOVE BMACCD    PRACOD                          103361
058780200610     C                     MOVE '01'      PRACSQ                          103361
058790200610      *                                                                   136297
058800200610      ** Check if account exists else use suspense account                136297
058810200610      *                                                                   136297
058820200610     C                     MOVE PRCNUM    KYCNUM                          136297
058830200610     C                     MOVE PSCU      KYCCY                           136297
058840200610     C                     MOVE PRACOD    KYACOD                          136297
058850200610     C                     MOVE PRACSQ    KYACSQ                          136297
058860200610     C                     MOVE PSEB      KYBRCA                          136297
058870200610     C           KEYACC    CHAINACCOUNTF             20                   136297
058880200610     C           *IN20     IFEQ '1'                                       136297
058890200610     C           RECI      OREQ '*'                                       136297
058900200610     C           1         CHAINTABTB20              21                   136297
058910200610     C           *IN21     IFEQ '0'                                       136297
058920200610     C                     MOVE COMS      PRACOD                          136297
058930200610     C                     ENDIF                                          136297
058940200610     C           PSEB      CHAINSDBRCHL0             22                   136297
058950200610     C           *IN22     IFEQ '0'                                       136297
058960200610     C                     MOVE A8BICN    PRCNUM                          136297
058970200610     C                     ENDIF                                          136297
058980200610     C                     ENDIF                                          136297
058990200610      *                                                                   103361
059000200610     C                     MOVE PRACCT    STLA                            103361
059010200610     C                     MOVE PRACCT    PSEA                            103361
059020200610     C                     END                                            103361
059030200610      *                                                                   103361
059040200610     C                     ELSE
059050200610     C*
059060200610     C** USE PAY FIELDS IF PAY/RECEIVE IND IS SET TO R
059070200610     C*
059080200610     C           PPRE      IFEQ 'R'
059090200610     C                     MOVE SRSM      PSMT
059100200610     C                     MOVE SRAC      PSEA
059110200610     C***********          MOVE SRBR      PSEB                            S01117
059120200610     C                     MOVE SRAB      PSEB                            S01117
059130200610     C                     MOVE SRCB      PCPN
059140200610     C                     MOVE *BLANK    PFAC
059150200610     C                     MOVE *BLANK    PSPI
059160200610      *                                                                   103361
059170200610     C                     MOVE SRAC      STLA                            103361
059180200610     C                     Z-ADDSRSM      STLT                            103361
059190200610      *                                                                   103361
059200200610      ** If settlement method is '04' and settlement account is blank,    103361
059210200610      ** retrieve prime account number                                    103361
059220200610      *                                                                   103361
059230200610     C           STLT      IFEQ 04                                        103361
059240200610     C           STLA      ANDEQ*BLANKS                                   103361
059250200610      *                                                                   103361
059260200610      * Retrieve prime account                                            103361
059270200610      *                                                                   103361
059280200610     C                     MOVE CSTM      PRCNUM                          103361
059290200610     C                     MOVE BMACCD    PRACOD                          103361
059300200610     C                     MOVE '01'      PRACSQ                          103361
059310200610      *                                                                   136297
059320200610      ** Check if account exists else use suspense account                136297
059330200610      *                                                                   136297
059340200610     C                     MOVE PRCNUM    KYCNUM                          136297
059350200610     C                     MOVE PSCU      KYCCY                           136297
059360200610     C                     MOVE PRACOD    KYACOD                          136297
059370200610     C                     MOVE PRACSQ    KYACSQ                          136297
059380200610     C                     MOVE PSEB      KYBRCA                          136297
059390200610     C           KEYACC    CHAINACCOUNTF             20                   136297
059400200610     C           *IN20     IFEQ '1'                                       136297
059410200610     C           RECI      OREQ '*'                                       136297
059420200610     C           1         CHAINTABTB20              21                   136297
059430200610     C           *IN21     IFEQ '0'                                       136297
059440200610     C                     MOVE COMS      PRACOD                          136297
059450200610     C                     ENDIF                                          136297
059460200610     C           PSEB      CHAINSDBRCHL0             22                   136297
059470200610     C           *IN22     IFEQ '0'                                       136297
059480200610     C                     MOVE A8BICN    PRCNUM                          136297
059490200610     C                     ENDIF                                          136297
059500200610     C                     ENDIF                                          136297
059510200610      *                                                                   103361
059520200610     C                     MOVE PRACCT    STLA                            103361
059530200610     C                     MOVE PRACCT    PSEA                            103361
059540200610     C                     END                                            103361
059550200610      *                                                                   103361
059560200610     C                     END
059570200610     C                     END
059580200610     C                     END                                            CEU005
059590200610     C*                                                                                     AR877352
059600200610     C           S01496    IFEQ 'Y'                                                         AR877352
059610200610     C           BVACOP    ANDEQ'Y'                                                         AR877352
059620200610     C                     MOVELPCPY      @CUST                                             AR877352
059630200610     C                     CALL 'AOSECSR0'                                                  AR877352
059640200610     C                     PARM *BLANKS   @RTCD                                             AR877352
059650200610     C                     PARM '*KEY   ' @OPTN                                             AR877352
059660200610     C                     PARM           @CUST                                             AR877352
059670200610     C           SECSPD    PARM SECSPD    DSSDY                                             AR877352
059680200610      *                                                                                     AR877352
059690200610     C           @RTCD     IFNE *BLANKS                                                     AR877352
059700200610     C           *LOCK     IN   LDA                                                         AR877352
059710200610     C                     MOVEL'SDSECSL0'DBFILE                                            AR877352
059720200610     C                     MOVEL@CUST     DBKEY                                             AR877352
059730200610     C                     Z-ADD46        DBASE                                             AR877352
059740200610     C                     SETON                       U7U8                                 AR877352
059750200610     C                     EXSR *PSSR                                                       AR877352
059760200610     C                     GOTO EAUDIT                                                      AR877352
059770200610     C                     ENDIF                                                            AR877352
059780200610     C                     ENDIF                                                            AR877352
059790200610      *                                                                   093817
059800200610      * OTHERWISE CHECK FOR ACCOUNT IN CUSTOMER CURRENCY                  093817
059810200610     C                     ELSE                                           093817
059820200610     C**********           Z-ADDPCPY      WCLNTK                                       093817 CSD027
059830200610     C                     MOVE PCPY      WCLNTK                                              CSD027
059840200610     C                     MOVE '1'       WLIT1                           093817
059850200610     C                     EXSR CLNTIN                                    093817
059860200610      * PERFORM P07 TO SET UP SETTLEMENT DETAILS                          093817
059870200610     C                     EXSR P07                                       093817
059880200610      *                                                                   093817
059890200610     C/COPY WNCPYSRC,SE2400C039
059900200610     C                     END
059910200610     C*                                                                   084669
059920200610     C           PSEB      IFEQ *BLANKS                                   084669
059930200610     C                     MOVE PBCA      PSEB                            084669
059940200610     C                     END                                            084669
059950200610     C/COPY WNCPYSRC,SE2400C065
059960200610     C*                                                                   S01117
059970200610     C* Output profit centre from related customer position               S01117
059980200610     C*                                                                   S01117
059990200610     C**    If Analytical Accounting is installed and customer            CAC002
060000200610     C**    position profit centre is blank, set the profit centre to     CAC002
060010200610     C**    SE ICD default profit centre.                                 CAC002
060020200610     C*                                                                   CAC002
060030200610     C           BGN0ST    IFEQ 'Y'                                       CAC002
060040200610     C           PCCU      ANDEQ*BLANKS                                   CAC002
060050200610     C                     MOVE BVSEPC    PPFC                            CAC002
060060200610     C                     ELSE                                           CAC002
060070200610     C                     MOVE PCCU      PPFC                            S01117
060080200610     C                     ENDIF                                          CAC002
060090200610     C*
060100200610     C                     Z-ADDRUND      PDTG
060110200610      *                                                                                       CGL020
060120200610      ** If Settlement Account is not blank                                                   CGL020
060130200610      *                                                                                       CGL020
060140200610     C           CGL020    IFEQ 'Y'                                                           CGL020
060150200610     C           PSEA      ANDNE*BLANKS                                                       CGL020
060160200610      *                                                                                       CGL020
060170200610     C                     MOVE *BLANKS   PINTG                                               CGL020
060180200610     C                     MOVE *BLANKS   PINTGA                                              CGL020
060190200610     C                     MOVE *BLANKS   PINST                                               CGL020
060200200610     C                     MOVE *BLANKS   PINSTA                                              CGL020
060210200610     C                     MOVE *BLANKS   PBENM                                               CGL020
060220200610     C                     MOVE *BLANKS   PBENMA                                              CGL020
060230200610      *                                                                                       CGL020
060240200610     C                     CALL ZAAMLP                                                        CGL020
060250200610     C                     PARM           PINTG  10                                           CGL020
060260200610     C                     PARM           PINTGA 35                                           CGL020
060270200610     C                     PARM           PINST  10                                           CGL020
060280200610     C                     PARM           PINSTA 35                                           CGL020
060290200610     C                     PARM           PBENM  10                                           CGL020
060300200610     C                     PARM           PBENMA 35                                           CGL020
060310200610     C                     PARM           PDEBT  10                                           CSW210
060320200610     C                     PARM           PDEBTA 35                                           CSW210
060330200610     C                     PARM           PCPY                                                CGL020
060340200610     C                     PARM           PFAC                                                CGL020
060350200610     C                     PARM           PSEA                                                CGL020
060360200610     C                     PARM           PSEB                                                CGL020
060370200610     C                     PARM           PSCU                                                CGL020
060380200610     C                     PARM           WWRACT 20                                           CGL020
060390200610     C                     PARM           WWRCTY  2                                           CGL020
060400200610     C                     PARM           WWRBNK 20                                           CGL020
060410200610     C                     PARM           WWRCDE 11                                           CGL020
060420200610     C                     PARM           WWPACT 20                                           CGL020
060430200610     C                     PARM           WWPCTY  2                                           CGL020
060440200610     C                     PARM           WWPBNK 20                                           CGL020
060450200610     C                     PARM           WWPCDE 11                                           CGL020
060460200610     C                     PARM           WWDACT 35                                           CGL020
060470200610     C                     PARM           WWDCTY  2                                           CGL020
060480200610     C                     PARM           WWDBNK 20                                           CGL020
060490200610      *                                                                                       CGL020
060500200610     C                     MOVE PDUD      WWSDAT  50                                          CGL020
060510200610      *                                                                                       CGL020
060520200610     C                     ENDIF                                                              CGL020
060530200610     C*
060540200610      *** If S01447 installed, and settlement type = Dividend or Coupon   S01447
060550200610      *** and a security WHT record  for the security exists, and         S01447
060560200610      *** settlement is a payment, calculate tax amounts.                 S01447
060570200610      *                                                                   S01447
060580200610     C           S01447    IFEQ 'N'                                       S01447
060590200610     C           *IN80     OREQ '1'                                       S01447
060600200610     C           PPRE      OREQ 'R'                                       S01447
060610200610     C           SAAT      ORNE 'DV'                                      S01447
060620200610     C           SAAT      ANDNE'CP'                                      S01447
060630200610     C/COPY WNCPYSRC,SE2400C035
060640200610     C                     CLEARTASO                                      S01447
060650200610     C                     CLEARTASR                                      S01447
060660200610     C                     CLEARTAUS                                      S01447
060670200610     C                     ELSE                                           S01447
060680200610     C/COPY WNCPYSRC,SE2400C062
060690200610     C                     EXSR CALCTX                                    S01447
060700200610     C/COPY WNCPYSRC,SE2400C063
060710200610     C                     END                                            S01447
060720200610      *                                                                   S01447
060730200610     C* ZEROISE NUMERIC FIELDS WITH NO SPECIFIED VALUE
060740200610     C*
060750200610     C                     Z-ADD0         PCHA
060760200610     C/COPY WNCPYSRC,SE2400C019
060770200610     C                     Z-ADD0         PCAM
060780200610     C/COPY WNCPYSRC,SE2400C020
060790200610     C                     MOVE *BLANKS   PCHC                            S01519
060800200610     C                     MOVE *BLANKS   PCCD                            S01519
060810200610     C                     Z-ADD0         PSAT
060820200610     C***********          Z-ADD0         LCD                             066777
060830200610     C                     Z-ADDRUND      LCD                             066777
060840200610     C                     Z-ADD0         TNLU
060850200610     C***********          MOVE ' '       CHTP                            E18221
060860200610     C                     MOVE 'I'       CHTP                            E18221
060870200610     C/COPY WNCPYSRC,SE2400C021
060880200610     C                     MOVE 'D'       RECI                            103017
060890200610     C*                                                                   S01519
060900200610     C** If S01519 is active AND autocharge option is Y, calculate        S01519
060910200610     C** the default charge/commission amount and settlement amount       S01519
060920200610     C*                                                                   S01519
060930200610     C           S01519    IFEQ 'Y'                                       S01519
060940200610     C           BVACOP    ANDEQ'Y'                                       S01519
060950200610     C                     EXSR P04                                       S01519
060960200610     C           WSRECI    IFEQ 'R'                                                           260331
060970200610     C                     Z-SUBPCHA      PCHA                                                260331
060980200610     C                     Z-SUBPCAM      PCAM                                                260331
060990200610     C                     ENDIF                                                              260331
061000200610     C***********          EXSR P06                                S01519 094229
061010200610     C                     END                                            S01519
061020200610     C           CER049    IFEQ 'Y'                                                         AR853119
061030200610     C                     EXSR SRPOST                                                      AR853119
061040200610     C                     ENDIF                                                            AR853119
061050200610     C/COPY WNCPYSRC,SE2400C026
061060200610     C                     EXSR P06                                       094229
061070200610     C/COPY WNCPYSRC,SE2400C027
061080200610     C*
061090200610     C* WRITE POSITION SETTLMENT RECORD
061100200610     C*
061110200610     C           BGPFMG    IFEQ 'Y'                                       S01486
061120200610     C           BGN4ST    OREQ 'Y'                                       CPB001
061130200610     C/COPY WNCPYSRC,SE2400C024
061140200610     C                     Z-ADDTNLU      PTNLU   50                      S01486
061150200610     C                     EXSR ZTNLU1                                    S01486
061160200610     C                     MOVELNATN      TNLU                            S01486
061170200610     C                     MOVE 'I'       CHTP                            S01486
061180200610     C*                                                                   S01486
061190200610     C** IF MATURITY POSITION SETTLEMENT FOR ZERO AMOUNT DUE FOR          S01486
061200200610     C** PORTFOLIO WITH PERFORMANCE SET ALL AMOUNT FIELDS TO ZERO         S01486
061210200610     C           PEVT      IFEQ 'MT'                       B1             S01486
061220200610     C           PAMD      ANDEQ0                                         S01486
061230200610     C*                                                                   S01486
061240200610     C           WPORTP    IFEQ 'Y'                        B2             S01486
061250200610     C***********QAPTFR    ANDNE'9997'                             S01486 189942
061260200610     C           PTFR      ANDNE'9997'                                    189942
061270200610     C           PNPSDT    ANDLTRUND                                      S01486
061280200610     C                     MOVE *BLANKS   PCHC                            S01486
061290200610     C                     MOVE *BLANKS   PCCD                            S01486
061300200610     C                     Z-ADD0         PCHA                            S01486
061310200610     C                     Z-ADD0         PCAM                            S01486
061320200610     C/COPY WNCPYSRC,SE2400C028
061330200610     C                     Z-ADD0         PSAT                            S01486
061340200610     C                     Z-ADD0         TASO                            S01486
061350200610     C                     Z-ADD0         TASR                            S01486
061360200610     C                     Z-ADD0         TAUS                            S01486
061370200610     C                     Z-ADD0         P3STAF                                            AR853119
061380200610     C                     Z-ADD0         T2TATC                                            AR853119
061390200610     C*                                                                   S01486
061400200610     C** ....OTHERWISE DO NOT OUTPUT POSITION SETTLEMENT RECORED          S01486
061410200610     C                     ELSE                            X2             S01486
061420200610     C                     GOTO ENDW02                                    S01486
061430200610     C                     END                             E2             S01486
061440200610     C                     END                             E1             S01486
061450200610     C                     END                                            S01486
061460200610      *                                                                   046500
061470200610     C                     Z-ADD0         FXMP                            CAC002
061480200610     C                     Z-ADD0         FXMR                            CAC002
061490200610     C                     Z-ADD0         MAMT                            CAC002
061500200610      *                                                                                      251950A
061510200610     C           PSEB      IFEQ *BLANKS                                                      251950A
061520200610     C                     MOVE PBCA      PSEB                                               251950A
061530200610     C                     END                                                               251950A
061540200610     C/COPY WNCPYSRC,SE2400C066
061550200610     C*                                                                   CAC002
061560200610      ** If CSE023 is not installed or if CSE023 is installed and         CSE023
061570200610      ** the events is not for Coupon, Dividend or Maturity then          CSE023
061580200610      ** use the normal processing.                                       CSE023
061590200610      *                                                                   CSE023
061600200610     C                     MOVE 'C'       CTYP                            187805
061610200610      *                                                                   187805
061620200610     C           CSE023    IFEQ 'N'                                       CSE023
061630200610      *                                                                   CSE023
061640200610     C           CSE023    OREQ 'Y'                                       CSE023
061650200610     C           PEVT      ANDNE'CP'                                      CSE023
061660200610     C           PEVT      ANDNE'MT'                                      CSE023
061670200610     C           PEVT      ANDNE'DV'                                      CSE023
061680200610     C*                                                                   CSE023
061690200610     C           CRTT      OREQ *BLANKS                                   CSE023
061700200610      *                                                                   CSE023
061710200610     C*                                                                   CAC002
061720200610     C                     ADD  1         W02CNT  50                      046500
061730200610     C                     WRITEPOSETDF
061731200616     C                     EXSR PSAUDT                                                      AR324886
061740200610      *                                                                                     AR853119
061750200610     C           CER049    IFEQ 'Y'                                                         AR853119
061760200610     C                     WRITEPOSETDD3                                                    AR853119
061770200610     C           P3TAX     IFEQ 'Y'                                                        AR864714B
061780200610     C                     WRITE@STMDP0                                                     AR853119
061790200610     C                     ENDIF                                                           AR864714B
061800200610     C                     ENDIF                                                            AR853119
061810200610      *                                                                   CSE023
061820200610     C                     ELSE                                           CSE023
061830200610      *                                                                   CSE023
061840200610      ** If Treaty Withholding Tax is installed, then set up fields       CSE023
061850200610      ** for SE2310.                                                      CSE023
061860200610      *                                                                   CSE023
061870200610      ** For Coupon Event, @DIVDT is the Last Coupon Date.                CSE023
061880200610      ** For Dividend Event, @DIVDT is equal to the dividend date.        CSE023
061890200610      *                                                                   CSE023
061900200610     C                     Z-ADD0         @DIVDT                          CSE023
061910200610     C                     MOVE ' '       @TVBAS                          CSE023
061920200610      *                                                                   CSE023
061930200610     C           PEVT      IFEQ 'CP'                                      CSE023
061940200610     C                     Z-ADDSALCCP    @DIVDT                          CSE023
061950200610     C                     END                                            CSE023
061960200610      *                                                                   CSE023
061970200610     C           PEVT      IFEQ 'DV'                                      CSE023
061980200610      *                                                                   CSE023
061990200610      ** If S01510 is active AND event type = DV, use ex-dividend date    CSE023
062000200610      *                                                                   CSE023
062010200610     C           S01510    IFEQ 'Y'                                       CSE023
062020200610     C           SAEXD     ADD  1         @DIVDT                          CSE023
062030200610     C                     ELSE                                           CSE023
062040200610     C                     Z-ADDSAED      @DIVDT                          CSE023
062050200610     C                     END                                            CSE023
062060200610      *                                                                   CSE023
062070200610      ** If CSE008 is ON then use value date position for dividend.       CSE023
062080200610      *                                                                   CSE023
062090200610     C           CSE008    IFEQ 'Y'                                       CSE023
062100200610     C                     MOVE 'V'       @TVBAS                          CSE023
062110200610     C                     ELSE                                           CSE023
062120200610     C                     MOVE 'T'       @TVBAS                          CSE023
062130200610     C                     END                                            CSE023
062140200610     C                     END                                            CSE023
062150200610      *                                                                   CSE023
062160200610     C                     CALL 'SE2310'                                  CSE023
062170200610     C                     PARM           PPOSET                          CSE023
062180200610     C                     PARM           @TVBAS  1                       CSE023
062190200610     C                     PARM           @DIVDT  50                      CSE023
062200200610     C                     PARM           @NREC   30                      CSE023
062210200610     C                     PARM           @ERR    1                       CSE023
062220200610      *                                                                   CSE023
062230200610     C           @ERR      IFEQ 'N'                                       CSE023
062240200610     C                     ADD  @NREC     W02CNT                          CSE023
062250200610     C                     ELSE                                           CSE023
062260200610     C           *LOCK     IN   LDA                                       187183
062270200610     C                     MOVE 'SE2310'  DBFILE           ***************CSE023
062280200610     C                     MOVEL'*CALL'   DBKEY            * DB ERROR 48 *CSE023
062290200610     C                     Z-ADD48        DBASE            ***************CSE023
062300200610     C                     SETON                     U7U8                 CSE023
062310200610     C                     EXSR *PSSR                                     CSE023
062320200610     C                     MOVE '1'       *INLR                           CSE023
062330200610     C                     END                                            CSE023
062340200610     C                     END                                            CSE023
062350200610      *                                                                   S01408
062360200610     C/COPY WNCPYSRC,SE2400CCP1                                           S01408
062370200610      *                                                                   S01408
062380200610     C           BGPFMG    IFEQ 'Y'                                       S01486
062390200610     C           BGN4ST    OREQ 'Y'                                       CPB001
062400200610     C                     Z-ADDPTNLU     TNLU                            S01486
062410200610     C                     END                                            S01486
062420200610     C*
062430200610     C           ENDW02    ENDSR                           ** ENDW02 **
062440200610      *
062450200610      *****************************************************************
062460200610     C/EJECT                                                              S01519
062470200610     C*****************************************************************   S01519
062480200610     C*                                                               *   S01519
062490200610     C*  P04   - SUBROUTINE TO CALCULATE CHARGE/COMMISSION AMOUNTS    *   S01519
062500200610     C*                                                               *   S01519
062510200610     C*****************************************************************   S01519
062520200610     C*                                                                   S01519
062530200610     C           P04       BEGSR                                          S01519
062540200610     C*                                                                   S01519
062550200610     C                     MOVE *ZEROS    PCHA                            S01519
062560200610     C/COPY WNCPYSRC,SE2400C045
062570200610     C                     MOVE *ZEROS    PCAM                            S01519
062580200610     C                     MOVE CSCN      DCCUST                          S01519
062590200610     C*                                                                   S01519
062600200610     C** Only access file if PEVT is coupon, dividend, or maturity.       S01519
062610200610     C*                                                                   S01519
062620200610     C           PEVT      IFEQ 'CP'                                      S01519
062630200610     C           PEVT      OREQ 'DV'                                      S01519
062640200610     C           PEVT      OREQ 'MT'                                      S01519
062650200610      *                                                                   S01408
062660200610     C/COPY WNCPYSRC,SE2400CCP2                                           S01408
062670200610      *                                                                   S01408
062680200610     C*                                                                   S01519
062690200610     C** Set up key for chaining to default charges table (SEDFTCL2).     S01519
062700200610      ** If *IN40 is On, chain SEDFRGL0 instead.                          CSE026
062710200610     C*                                                                   S01519
062720200610     C           *IN40     IFEQ *ON                                       CSE026
062730200610     C                     MOVELBFPSCG    DCCLGR                          CSE026
062740200610     C                     ELSE                                           CSE026
062750200610     C                     MOVE C1DI      DCCLAS                          S01519
062760200610     C                     ENDIF                                          CSE026
062770200610      *                                                                   CSE026
062780200610     C                     MOVE SITP      DCINVT                          S01519
062790200610     C                     MOVE CSCN      DCCUST                          S01519
062800200610     C*                                                                   S01519
062810200610     C           *IN40     IFEQ *ON                                       CSE026
062820200610     C           DFTKYG    CHAINSEDFGRL0             70                   CSE026
062830200610     C                     ELSE                                           CSE026
062840200610     C           DFTKY1    CHAINSEDFTCL2             70                   S01519
062850200610     C                     ENDIF                                          CSE026
062860200610     C*                                                                   S01519
062870200610     C           *IN70     IFEQ '0'                                       S01519
062880200610     C                     EXSR P05                                       S01519
062890200610     C                     ELSE                                           S01519
062900200610     C*                                                                   S01519
062910200610     C**********           MOVE *ZEROS    DCCUST                                       S01519 CSD027
062920200610     C                     MOVE *BLANKS   DCCUST                                              CSD027
062930200610     C           *IN40     IFEQ *ON                                       CSE026
062940200610     C           DFTKYG    CHAINSEDFGRL0             70                   CSE026
062950200610     C                     ELSE                                           CSE026
062960200610     C           DFTKY1    CHAINSEDFTCL2             70                   S01519
062970200610     C                     ENDIF                                          CSE026
062980200610     C*                                                                   S01519
062990200610     C           *IN70     IFEQ '0'                                       S01519
063000200610     C                     EXSR P05                                       S01519
063010200610     C                     ELSE                                           S01519
063020200610     C*                                                                   S01519
063030200610     C                     MOVE *BLANKS   DCINVT                          S01519
063040200610     C           *IN40     IFEQ *ON                                       CSE026
063050200610     C           DFTKYG    CHAINSEDFGRL0             70                   CSE026
063060200610     C                     ELSE                                           CSE026
063070200610     C           DFTKY1    CHAINSEDFTCL2             70                   S01519
063080200610     C                     ENDIF                                          CSE026
063090200610      *                                                                   CSE026
063100200610     C           *IN70     IFEQ '0'                                       S01519
063110200610     C                     EXSR P05                                       S01519
063120200610     C                     ELSE                                           S01519
063130200610     C*                                                                   S01519
063140200610     C** If no records found zeroise default charge/commission            S01519
063150200610     C** amount fields.                                                   S01519
063160200610     C*                                                                   S01519
063170200610     C                     MOVE *ZEROS    PCHA                            S01519
063180200610     C                     MOVE *ZEROS    PCAM                            S01519
063190200610     C/COPY WNCPYSRC,SE2400C029
063200200610     C                     END                                            S01519
063210200610     C*                                                                   S01519
063220200610     C                     END                                            S01519
063230200610     C                     END                                            S01519
063240200610      *                                                                   S01408
063250200610     C/COPY WNCPYSRC,SE2400CCP3                                           S01408
063260200610      *                                                                   S01408
063270200610     C                     END                                            S01519
063280200610     C*                                                                   S01519
063290200610     C                     ENDSR                           ** P04    **   S01519
063300200610     C*                                                                   S01519
063310200610     C*****************************************************************   S01519
063320200610     C*                                                                   S01519
063330200610     C/EJECT                                                              S01519
063340200610     C/COPY WNCPYSRC,SE2400C030
063350200610     C*****************************************************************   S01519
063360200610     C*                                                               *   S01519
063370200610     C*  P05   - SUBROUTINE TO CALCULATE DEFAULT AMOUNTS              *   S01519
063380200610     C*                                                               *   S01519
063390200610     C*****************************************************************   S01519
063400200610     C*                                                                   S01519
063410200610     C           P05       BEGSR                                          S01519
063420200610     C/COPY WNCPYSRC,SE2400C046
063430200610     C*                                                                   S01519
063440200610     C                     SELEC                                          S01519
063450200610     C*                                                                   S01519
063460200610     C** Event type if equal to coupon.                                   S01519
063470200610     C*                                                                   S01519
063480200610     C           PEVT      WHEQ 'CP'                                      S01519
063490200610     C*                                                                   S01519
063500200610     C** Update commissions amount.                                       S01519
063510200610     C*                                                                   S01519
063520200610     C           DCCPCM    IFEQ *BLANKS                                   S01519
063530200610     C                     Z-ADD*ZEROS    PCAM                            S01519
063540200610     C                     ELSE                                           S01519
063550200610     C                     MOVE DCCPCM    @CAM                            S01519
063560200610     C                     EXSR CALAMT                                    S01519
063570200610     C                     Z-ADDZCHGA     PCAM                            S01519
063580200610     C                     END                                            S01519
063590200610     C                     MOVE DCCPCM    PCCD                            S01519
063600200610     C*                                                                   S01519
063610200610     C** Update charge amount.                                            S01519
063620200610     C*                                                                   S01519
063630200610     C           DCCPCC    IFEQ *BLANKS                                   S01519
063640200610     C                     Z-ADD*ZEROS    PCHA                            S01519
063650200610     C                     ELSE                                           S01519
063660200610     C                     MOVE DCCPCC    @CAM                            S01519
063670200610     C                     EXSR CALAMT                                    S01519
063680200610     C                     Z-ADDZCHGA     PCHA                            S01519
063690200610     C                     END                                            S01519
063700200610     C                     MOVE DCCPCC    PCHC                            S01519
063710200610     C/COPY WNCPYSRC,SE2400C047
063720200610     C*                                                                   S01519
063730200610     C** Event type if equal to dividend                                  S01519
063740200610     C*                                                                   S01519
063750200610     C           PEVT      WHEQ 'DV'                                      S01519
063760200610     C*                                                                   S01519
063770200610     C** Update commissions amount.                                       S01519
063780200610     C*                                                                   S01519
063790200610     C           DCDVCM    IFEQ *BLANKS                                   S01519
063800200610     C                     Z-ADD*ZEROS    PCAM                            S01519
063810200610     C                     ELSE                                           S01519
063820200610     C                     MOVE DCDVCM    @CAM                            S01519
063830200610     C                     EXSR CALAMT                                    S01519
063840200610     C                     Z-ADDZCHGA     PCAM                            S01519
063850200610     C                     END                                            S01519
063860200610     C                     MOVE DCDVCM    PCCD                            S01519
063870200610     C*                                                                   S01519
063880200610     C** Update charge amount.                                            S01519
063890200610     C*                                                                   S01519
063900200610     C           DCDVCC    IFEQ *BLANKS                                   S01519
063910200610     C                     Z-ADD*ZEROS    PCHA                            S01519
063920200610     C                     ELSE                                           S01519
063930200610     C                     MOVE DCDVCC    @CAM                            S01519
063940200610     C                     EXSR CALAMT                                    S01519
063950200610     C                     Z-ADDZCHGA     PCHA                            S01519
063960200610     C                     END                                            S01519
063970200610     C                     MOVE DCDVCC    PCHC                            S01519
063980200610     C/COPY WNCPYSRC,SE2400C048
063990200610     C*                                                                   S01519
064000200610     C** Event type if equal to maturity.                                 S01519
064010200610     C*                                                                   S01519
064020200610     C           PEVT      WHEQ 'MT'                                      S01519
064030200610     C*                                                                   S01519
064040200610     C** Update commissions amount.                                       S01519
064050200610     C*                                                                   S01519
064060200610     C           DCMTCM    IFEQ *BLANKS                                   S01519
064070200610     C                     Z-ADD*ZEROS    PCAM                            S01519
064080200610     C                     ELSE                                           S01519
064090200610     C                     MOVE DCMTCM    @CAM                            S01519
064100200610     C                     EXSR CALAMT                                    S01519
064110200610     C                     Z-ADDZCHGA     PCAM                            S01519
064120200610     C                     END                                            S01519
064130200610     C                     MOVE DCMTCM    PCCD                            S01519
064140200610     C*                                                                   S01519
064150200610     C** Update charge amount.                                            S01519
064160200610     C*                                                                   S01519
064170200610     C           DCMTCC    IFEQ *BLANKS                                   S01519
064180200610     C                     Z-ADD*ZEROS    PCHA                            S01519
064190200610     C                     ELSE                                           S01519
064200200610     C                     MOVE DCMTCC    @CAM                            S01519
064210200610     C                     EXSR CALAMT                                    S01519
064220200610     C                     Z-ADDZCHGA     PCHA                            S01519
064230200610     C                     END                                            S01519
064240200610     C                     MOVE DCMTCC    PCHC                            S01519
064250200610     C/COPY WNCPYSRC,SE2400C049
064260200610     C*                                                                   S01519
064270200610     C                     ENDSL                                          S01519
064280200610     C*                                                                   S01519
064290200610     C                     ENDSR                           ** P05    **   S01519
064300200610     C*                                                                   S01519
064310200610     C*****************************************************************   S01519
064320200610     C/EJECT                                                              S01519
064330200610     C*****************************************************************   S01519
064340200610     C*                                                               *   S01519
064350200610     C*  P06   - SUBROUTINE TO CALCULATE SETTLEMENT AMOUNTS           *   S01519
064360200610     C*                                                               *   S01519
064370200610     C*****************************************************************   S01519
064380200610     C*                                                                   S01519
064390200610     C           P06       BEGSR                                          S01519
064400200610     C***********                                                  S01519 087178
064410200610     C***Initialise*calculation*workfield.*************************S01519 087178
064420200610     C***********                                                  S01519 087178
064430200610     C***********          Z-ADD*ZEROS    WKCALC 140               S01519 087178
064440200610     C***********                                                  S01519 087178
064450200610     C***********C1DI      IFEQ 'S'                                S01519 087178
064460200610     C***********PPRE      ANDEQ'R'                                S01519 087178
064470200610     C***********C1DI      OREQ 'D'                                S01519 087178
064480200610     C***********PPRE      ANDEQ'R'                                S01519 087178
064490200610     C***********PPRE      OREQ 'P'                                S01519 087178
064500200610     C***********C1DI      ANDNE'D'                                S01519 087178
064510200610     C***********C1DI      ANDNE'S'                                S01519 087178
064520200610     C***********                                                  S01519 087178
064530200610     C***Calculate*and*update*settlement*amount.*******************S01519 087178
064540200610     C***********                                                  S01519 087178
064550200610     C***********PAMD      ADD  PCHA      WKCALC                   S01519 087178
064560200610     C***********WKCALC    ADD  PCAM      WKCALC                   S01519 087178
064570200610     C***********          Z-ADDWKCALC    PSAT                     S01519 087178
064580200610     C***********                                                  S01519 087178
064590200610     C***********          ELSE                                    S01519 087178
064600200610     C***********                                                  S01519 087178
064610200610     C***********C1DI      IFEQ 'S'                                S01519 087178
064620200610     C***********PPRE      ANDEQ'P'                                S01519 087178
064630200610     C***********C1DI      OREQ 'D'                                S01519 087178
064640200610     C***********PPRE      ANDEQ'P'                                S01519 087178
064650200610     C***********PPRE      OREQ 'R'                                S01519 087178
064660200610     C***********C1DI      ANDNE'D'                                S01519 087178
064670200610     C***********C1DI      ANDNE'S'                                S01519 087178
064680200610     C***********                                                  S01519 087178
064690200610     C***Calculate*and*update*settlement*amount.*******************S01519 087178
064700200610     C***********                                                  S01519 087178
064710200610     C***********PAMD      SUB  PCHA      WKCALC                   S01519 087178
064720200610     C***********WKCALC    SUB  PCAM      WKCALC                   S01519 087178
064730200610     C***********          Z-ADDWKCALC    PSAT                     S01519 087178
064740200610     C***********                                                  S01519 087178
064750200610     C***********          ELSE                                    S01519 087178
064760200610     C***********          Z-ADDPAMD      PSAT                     S01519 087178
064770200610     C***********          END                                     S01519 087178
064780200610     C***********                                                  S01519 087178
064790200610     C***********          END                                     S01519 087178
064800200610     C*                                                                   087178
064810200610     C** Set up parameter for call to SEZ010                              087178
064820200610     C*                                                                   087178
064830200610     C                     MOVELC1DI      P@CLAS                          087178
064840200610     C                     MOVELPPRE      P@PPRE                          087178
064850200610     C                     Z-ADDPAMD      P@PAMD                          087178
064860200610     C                     Z-ADDPCHA      P@PCHA                          087178
064870200610     C                     Z-ADDPCAM      P@PCAM                          087178
064880200610     C                     Z-ADDTASO      P@TASO                          087178
064890200610     C                     Z-ADDTAUS      P@TAUS                          087178
064900200610     C                     Z-ADDPSXR      P@PSXR                          087178
064910200610      ***Override*coupon*rate                                                   AR1001183 AR1001183A
064920200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
064930200610     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
064940200610     C**********           Z-ADDWPSXR     P@PSXR                                AR1001183 AR1001183A
064950200610     C*********            ENDIF                                                AR1001183 AR1001183A
064960200610     C*********            MOVE 'N'       WRCHG                                 AR1001183 AR1001183A
064970200610     C                     MOVELPMDI      P@PMDI                          087178
064980200610     C                     MOVELPNCY      P@PNCY                          087178
064990200610     C                     MOVELPSCU      P@PSCU                          087178
065000200610     C                     MOVELWSTAXA    P@STAM                                            AR853119
065010200610     C/COPY WNCPYSRC,SE2400C031
065020200610     C*                                                                   CAC002
065030200610     C                     MOVE 'TS'      P@TDTP                          CAC002
065040200610     C                     Z-ADD0         P@FXMR                          CAC002
065050200610     C                     Z-ADD0         P@MAMT                          CAC002
065060200610     C*                                                                   087178
065070200610     C** Call SEZ010 to calculate the settlement amount in settle ccy     087178
065080200610     C*                                                                   087178
065090200610     C                     CALL 'SEZ010'                                  087178
065100200610     C                     PARM *BLANKS   P@RCDE  7                       087178
065110200610     C                     PARM           P@DATA                          087178
065120200610     C           P@RCDE    IFEQ *BLANKS                                   087178
065130200610     C                     Z-ADDP@PSAT    PSAT                            087178
065140200610     C                     ELSE                                           087178
065150200610     C                     EXSR *PSSR                                     087178
065160200610     C                     EXSR AUDIT                                     087178
065170200610     C                     MOVE '1'       *INLR                           087178
065180200610     C                     ENDIF                                          087178
065190200610     C*                                                                   S01519
065200200610     C                     ENDSR                           ** P06    **   S01519
065210200610     C*                                                                   S01519
065220200610     C*****************************************************************   S01519
065230200610     C/EJECT                                                              S01519
065240200610      *****************************************************************   S01486
065250200610      *                                                               *   S01486
065260200610      *  P07  DETERMINE SETTLEMENT INFORMATION                        *   S01486
065270200610      *                                                               *   S01486
065280200610      *****************************************************************   S01486
065290200610      *                                                                   S01486
065300200610     C           P07       BEGSR                                          S01486
065310200610     C                     MOVE 'N'       WWPMCS  1                       192099
065320200610     C*                                                                   S01486
065330200610     C** IF POSITION SETTLEMENT FOR A PORTFOLIO POSITION OBTAIN           S01486
065340200610     C** PORTFOLIO CURRENCY AND CUSTOMER CURRENCY                         S01486
065350200610     C           WPORTP    IFEQ 'Y'                        B1             S01486
065360200610     C           PTFR      ANDNE*BLANKS                                   189942
065370200610     C                     MOVE *BLANKS   WZACOD 100                      219688
065380200610     C*                                                                   S01486
065390200610     C** IF POSITION SETTLEMENT FOR A DEFINED PORTFOLIO OBTAIN PORTFOLIO  S01486
065400200610     C** CURRENCY                                                         S01486
065410200610     C***********QAPTFR    IFNE '9997'                     B2      S01486 189942
065420200610     C***********          MOVE QACNUM    WWCNU1                   S01486 189942
065430200610     C***********          MOVE QAPTFR    WWPTF1                   S01486 189942
065440200610     C           PTFR      IFNE '9997'                     B2             189942
065450200610     C                     MOVE CDCN      WWCNU1                          189942
065460200610     C                     MOVE PTFR      WWPTF1                          189942
065470200610     C*                                                                   S01486
065480200610     C***********PMPORT    CHAINPMPORTPD             79            S01486 081383
065490200610     C************IN79     IFEQ '1'                        B3      S01486 081383
065500200610     C           PMPORT    CHAINPMPORTPD             83                   081383
065510200610     C           *IN83     IFEQ '1'                        B3             081383
065520200610     C           *LOCK     IN   LDA                                       081239
065530200610     C************         MOVEL'MPORT'   DBFILE           *********S01486081239
065540200610     C                     MOVEL'PMPORTPD'DBFILE           ***************081239
065550200610     C***********          MOVELQACNUM    DBKEY            ** DB ERS01486 189942
065560200610     C***********          MOVE QAPTFR    DBKEY            ********S01486 189942
065570200610     C                     MOVELCDCN      DBKEY            ** DB ERROR 04 189942
065580200610     C                     MOVE PTFR      DBKEY            ***************189942
065590200610     C                     Z-ADD40        DBASE                           S01486
065600200610     C                     SETON                       U7U8               081239
065610200610     C                     GOTO EAUDIT                                    S01486
065620200610     C                     END                             E3             S01486
065630200610     C*                                                                   S01486
065640200610     C                     END                             E2             S01486
065650200610     C*                                                                   S01486
065660200610     C** ACCESS PORTFOLIO CUSTOMER DETAILS                                S01486
065670200610     C***********          MOVE QACNUM    WWCNUA  6                S01486 189942
065680200610     C                     MOVE CDCN      WWCNUA  6                       189942
065690200610     C*                                                                   S01486
065700200610     C           BGPFMG    IFEQ 'Y'                                       CPB001
065710200610     C                     MOVELWWCNUA    WWCLIN 10                       S01486
065720200610     C                     CALL 'AOPLCSR0'                                S01486
065730200610     C                     PARM *BLANKS   @RTCD                           S01486
065740200610     C                     PARM '*KEY   ' @OPTN                           S01486
065750200610     C                     PARM WWCLIN    WWKY10 10                       S01486
065760200610     C           SDPLCS    PARM SDPLCS    DSSDY                           S01486
065770200610     C           @RTCD     IFNE *BLANKS                                   S01486
065780200610     C           BGN4ST    IFNE 'Y'                                       192099
065790200610     C           *LOCK     IN   LDA                                       S01486
065800200610     C************         MOVEL'DPLCS'   DBFILE           *********S01486081239
065810200610     C                     MOVEL'SDPLCSPD'DBFILE           ***************081239
065820200610     C                     MOVELWWCNUA    DBKEY            ** DB ERROR 04 S01486
065830200610     C                     Z-ADD41        DBASE            ***************S01486
065840200610     C                     SETON                       U7U8               S01486
065850200610     C                     EXSR *PSSR                                     S01486
065860200610     C                     GOTO EAUDIT                                    S01486
065870200610     C                     ENDIF                                          192099
065880200610     C                     ELSE                                           192099
065890200610     C                     MOVE 'Y'       WWPMCS                          192099
065900200610     C                     END                             E2             S01486
065910200610     C                     ENDIF                                          CPB001
065920200610     C***********          MOVE QACNUM    WWCNUA  6                133844 189942
065930200610     C                     MOVE CDCN      WWCNUA  6                       189942
065940200610     C*                                                                   133844
065950200610     C                     MOVELWWCNUA    @CUST  10                       133844
065960200610     C                     CALL 'AOSECSR0'                                133844
065970200610     C                     PARM *BLANKS   @RTCD                           133844
065980200610     C                     PARM '*KEY   ' @OPTN                           133844
065990200610     C                     PARM           @CUST                           133844
066000200610     C           SECSPD    PARM SECSPD    DSSDY                           133844
066010200610      *                                                                   133844
066020200610     C           @RTCD     IFNE *BLANKS                    *B3            133844
066030200610     C           *LOCK     IN   LDA                                       133844
066040200610     C                     MOVEL'SDSECSL0'DBFILE           ***************133844
066050200610     C                     MOVEL@CUST     DBKEY            ** DBERROR 044 133844
066060200610     C                     Z-ADD44        DBASE            ***************133844
066070200610     C                     SETON                       U7U8               133844
066080200610     C                     EXSR *PSSR                                     133844
066090200610     C                     GOTO EAUDIT                                    133844
066100200610     C                     END                                            133844
066110200610      *                                                                   219688
066120200610     C                     MOVE BFACCD    WZACOD                          219688
066130200610      *                                                                   219688
066140200610     C*                                                                   S01486
066150200610     C** ... OTHERWISE POSITION SETTLEMENT FOR A NON-PORTFOLIO CUSTOMER   S01486
066160200610     C** HENCE ACCES SDSECSL0 FOR SECURITY CUSTOMER BASE CURRENCY         S01486
066170200610     C                     ELSE                            X1             S01486
066180200610     C*                                                                   S01486
066190200610     C                     MOVE CSCN      WWCNUA  6                       S01486
066200200610     C*                                                                   S01486
066210200610      *                                                                   S01486
066220200610     C                     MOVELWWCNUA    @CUST  10                       S01486
066230200610     C                     CALL 'AOSECSR0'                                S01486
066240200610     C                     PARM *BLANKS   @RTCD                           S01486
066250200610     C                     PARM '*KEY   ' @OPTN                           S01486
066260200610     C                     PARM           @CUST                           S01486
066270200610     C           SECSPD    PARM SECSPD    DSSDY                           S01486
066280200610      *                                                                   S01486
066290200610     C           @RTCD     IFNE *BLANKS                    *B3            S01486
066300200610     C           *LOCK     IN   LDA                                       S01486
066310200610     C                     MOVEL'SDSECSL0'DBFILE           ***************S01486
066320200610     C                     MOVEL@CUST     DBKEY            ** DBERROR 010 S01486
066330200610     C                     Z-ADD42        DBASE            ***************S01486
066340200610     C                     SETON                       U7U8               S01486
066350200610     C                     EXSR *PSSR                                     S01486
066360200610     C                     GOTO EAUDIT                                    S01486
066370200610     C                     END                                            S01486
066380200610     C                     END                             E1             S01486
066390200610     C*                                                                   S01486
066400200610     C** USE FIRST ACCOUNT IN FOUND FOR CUSTOMER / PORTFOLIO AS           S01486
066410200610     C** APPROPRIATE IN VALUE, PORTFOLIO OR CUSTOMER CURRENCY VIA P08     S01486
066420200610     C           WPORTP    IFEQ 'Y'                        B1             S01486
066430200610     C           PTFR      ANDNE*BLANKS                                   189942
066440200610     C***********          Z-ADDQACNUM    WZCNUM  60               S01486 189942
066450200610     C***********          MOVE QAPTFR    WZPTFR  4                S01486 189942
066460200610     C**********           Z-ADDCDCN      WZCNUM  60                                   189942 CSD027
066470200610     C                     MOVE CDCN      WZCNUM  6                                           CSD027
066480200610     C                     MOVE PTFR      WZPTFR  4                       189942
066490200610     C                     MOVE PNCY      WWCCY1  3                       S01486
066500200610     C           WWPMCS    IFEQ 'Y'                                       192099
066510200610     C                     MOVE QBCSBY    WWCCY3  3                       S01486
066520200610     C                     ELSE                                           192099
066530200610     C                     MOVE PNCY      WWCCY3                          192099
066540200610     C                     ENDIF                                          192099
066550200610     C*                                                                   S01486
066560200610     C***********QAPTFR    IFNE '9997'                     B2      S01486 189942
066570200610     C           PTFR      IFNE '9997'                     B2             189942
066580200610     C                     MOVE PNPTCY    WWCCY2  3                       S01486
066590200610     C                     ELSE                            X2             S01486
066600200610     C           WWPMCS    IFEQ 'Y'                                       192099
066610200610     C                     MOVE QBCSBY    WWCCY2  3                       S01486
066620200610     C                     ELSE                                           192099
066630200610     C                     MOVE PNPTCY    WWCCY2                          192099
066640200610     C                     ENDIF                                          192099
066650200610     C                     END                             E2             S01486
066660200610     C*                                                                   S01486
066670200610     C                     ELSE                            X1             S01486
066680200610     C**********           Z-ADDCSCN      WZCNUM  60                                   S01486 CSD027
066690200610     C                     MOVE CSCN      WZCNUM  6                                           CSD027
066700200610     C                     MOVE *BLANKS   WZPTFR  4                       S01486
066710200610     C                     MOVE PNCY      WWCCY1  3                       S01486
066720200610     C                     MOVE BFPCYC    WWCCY2  3                       S01486
066730200610     C                     MOVE BFPCYC    WWCCY3  3                       S01486
066740200610     C                     END                             E1             S01486
066750200610     C*                                                                   S01486
066760200610     C** CHECK WHETHER ACCOUNT EXISTS IN VALUE CURRENCY                   S01486
066770200610     C***IF*THE*CUSTOMER*IS*A*PORTFOLIO*CUSTOMER****               S01486 101317
066780200610     C***********WPORTP    IFEQ 'Y'                        B1      S01486 101317
066790200610     C           BGPFMG    IFEQ 'Y'                        B1             111922
066800200610     C           BGN4ST    OREQ 'Y'                                       CPB001
066810200610     C                     MOVE WWCCY1    WZCCY   3                       S01486
066820200610     C                     EXSR P08                                       S01486
066830200610     C*                                                                   097890
066840200610     C** If no account in security currency, do NOT post to account       097890
066850200610     C** in customer currency or portfolio currency with sett. method     097890
066860200610     C** '05' - post to suspense account with sett. method '00' instead   097890
066870200610     C*                                                                   S01486
066880200610     C***IF*NO*ACCOUNT*FOUND*SEARCH*FOR*ACCOUNT*IN*PORTFOLIO*CCY   S01486 097890
066890200610     C***********WZFOND    IFEQ 'N'                        B2      S01486 097890
066900200610     C***********          MOVE WWCCY2    WZCCY   3                S01486 097890
066910200610     C***********          EXSR P08                                S01486 097890
066920200610     C***********          END                             E2      S01486 097890
066930200610     C*                                                                   S01486
066940200610     C***IF*NO*ACCOUNT*FOUND*SEARCH*FOR*ACCOUNT*IN*CUSTOMER*CCY    S01486 097890
066950200610     C***********WZFOND    IFEQ 'N'                        B2      S01486 097890
066960200610     C***********          MOVE WWCCY3    WZCCY   3                S01486 097890
066970200610     C***********          EXSR P08                                S01486 097890
066980200610     C***********          END                             E2      S01486 097890
066990200610     C***********          END                             E1      S01486 101317
067000200610     C                     ENDIF                           E1             111922
067010200610     C*                                                                   S01486
067020200610     C** IF A SETTLEMENT ACCOUNT HAS BEEN FOUND OUTPUT SETTLEMENT         S01486
067030200610     C** DETAILS                                                          S01486
067040200610     C           WZFOND    IFEQ 'Y'                        B1             S01486
067050200610     C                     MOVE WZCCY     PSCU                            S01486
067060200610     C*                                                                   S01486
067070200610     C                     MOVE '05'      PSMT                            S01486
067080200610     C                     MOVE WZSETA    PSEA                            S01486
067090200610     C                     MOVE WZBRCD    PSEB                            S01486
067100200610     C                     ELSE                            X1             S01486
067110200610     C                     MOVE PNCY      PSCU                            S01486
067120200610     C                     MOVE *BLANKS   PSEA                            S01486
067130200610     C                     MOVE *BLANKS   PSMT                            S01486
067140200610     C                     MOVE *BLANKS   PSEB                            S01486
067150200610     C                     END                             E1             S01486
067160200610     C*                                                                   S01486
067170200610     C*  BASE CURR EXCHANGE RATE IS SPOT RATE FOR SETTLEMENT CURRCY       S01486
067180200610     C*                                                                   S01486
067190200610     C           TPBRY     TAG                                            SA9108
067200200610     C*  PBRX IS NOW EXCHANGE RATE BETWEEN VALUE AND BASE                 S01486
067210200610     C                     MOVE PSCU      WCURR                           S01486
067220200610     C                     EXSR TG10                                      S01486
067230200610     C                     Z-ADDSPOT      PBRX                            S01486
067240200610     C                     Z-ADD1         ZAMTF                           S01486
067250200610     C                     MOVE PNCY      ZCCYF                           S01486
067260200610     C                     MOVE PSCU      ZCCYT                           S01486
067270200610     C                     Z-ADDSPOT      PBRX                            S01486
067280200610     C*                                                                   S01486
067290200610     C                     ENDSR                                          S01486
067300200610     C********************************************************************S01486
067310200610      /EJECT                                                              S01486
067320200610      *****************************************************************   S01486
067330200610      *                                                               *   S01486
067340200610      *  P08  DETERMINE SETTLEMENT ACCOUNT                            *   S01486
067350200610      *                                                               *   S01486
067360200610      *****************************************************************   S01486
067370200610      *                                                                   S01486
067380200610     C           P08       BEGSR                                          S01486
067390200610     C*                                                                   S01486
067400200610     C                     MOVE 'N'       WZFOND  1                       S01486
067410200610     C                     Z-ADD0         WZACSQ                          S01486
067420200610     C*                                                                   S01486
067430200610     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
067440200610     C           ACCNTL    SETLLPMACCNL1                                  219688
067450200610     C                     READ PMACCNL1                 83               219688
067460200610     C           *IN83     IFEQ '0'                                       219688
067470200610     C           CNUM      ANDEQWZCNUM                                    219688
067480200610     C           CCY       ANDEQWZCCY                                     219688
067490200610     C           ACOD      ANDEQWZACOD                                    219688
067500200610     C           L1PTFR    ANDEQWZPTFR                                    219688
067510200610     C                     MOVE 'Y'       WZFOND                          219688
067520200610     C                     MOVELBRCA      WZBRCD                          219688
067530200610     C                     MOVELCNUM      WRK16                           219688
067540200610     C                     MOVE ACOD      WRK16                           219688
067550200610     C                     MOVELWRK16     WZSETA                          219688
067560200610     C                     MOVE ACSQ      WZSETA                          219688
067570200610     C                     ELSE                                           219688
067580200610     C*                                                                   219688
067590200610     C** READ FIRST RECORD FOR ACCOUNT                                    S01486
067600200610     C           ACCNTP    SETLLPMACCNL0                                  S01486
067610200610     C***********          READ PMACCNL0                 79        S01486 081383
067620200610     C                     READ PMACCNL0                 83        S01486 081383
067630200610     C*                                                                   S01486
067640200610     C** IF DETAILS READ FOR SAME CUSTOMER CURRENCY AND PORTFOLIO         S01486
067650200610     C** SET UP OUTPUT DETAILS                                            S01486
067660200610     C************IN79     IFEQ '0'                                S01486 081383
067670200610     C           *IN83     IFEQ '0'                                       081383
067680200610     C           CNUM      ANDEQWZCNUM                                    S01486
067690200610     C           CCY       ANDEQWZCCY                                     S01486
067700200610     C           RNPTFR    ANDEQWZPTFR                                    S01486
067710200610     C                     MOVE 'Y'       WZFOND                          S01486
067720200610     C***********          MOVELBRCA      WZBRCD  30                S01486081239
067730200610     C                     MOVELBRCA      WZBRCD  3                       081239
067740200610     C**********           MOVELCNUM      WRK10  10                                    S01486 CGL029
067750200610     C**********           MOVE ACOD      WRK10                                        S01486 CGL029
067760200610     C**********           MOVELWRK10     WZSETA 12                                    S01486 CGL029
067770200610     C**********           MOVE ACSQ      WZSETA                                       S01486 CGL029
067780200610     C                     MOVELCNUM      WRK16  16                                           CGL029
067790200610     C                     MOVE ACOD      WRK16                                               CGL029
067800200610     C                     MOVELWRK16     WZSETA 18                                           CGL029
067810200610     C                     MOVE ACSQ      WZSETA                                              CGL029
067820200610     C                     ELSE                                                               219566
067830200610     C** ELSE IF system value 'UseDefaultSettAccnt' is 'Y' then                               219566
067840200610     C           DEF001    IFEQ 'Y'                                                           219566
067850200610     C**                                                                                      219566
067860200610     C**      RETRIEVE AN ACCOUNT FROM THIS CLIENT                                            219566
067870200610     C                     MOVE *BLANKS   WZPTFR                                              219566
067880200610     C           ACCNTP    SETLLPMACCNL0                                                      219566
067890200610     C                     READ PMACCNL0                 83                                   219566
067900200610     C*                                                                                       219566
067910200610     C** IF DETAILS READ FOR SAME CUSTOMER,CURRENCY                                           219566
067920200610     C** SET UP OUTPUT DETAILS                                                                219566
067930200610     C           *IN83     IFEQ '0'                                                           219566
067940200610     C           CNUM      ANDEQWZCNUM                                                        219566
067950200610     C           CCY       ANDEQWZCCY                                                         219566
067960200610     C                     MOVE 'Y'       WZFOND                                              219566
067970200610     C                     MOVELBRCA      WZBRCD                                              219566
067980200610     C                     MOVELCNUM      WRK16                                               219566
067990200610     C                     MOVE ACOD      WRK16                                               219566
068000200610     C                     MOVELWRK16     WZSETA                                              219566
068010200610     C                     MOVE ACSQ      WZSETA                                              219566
068020200610     C                     END                                                                219566
068030200610      *                                                                                       219566
068040200610     C                     END                             Endif DEF001=Y                     219566
068050200610      *                                                                                       219566
068060200610     C                     END                                            S01486
068070200610     C*                                                                   S01486
068080200610     C                     END                                            219688
068090200610     C*                                                                   219688
068100200610     C                     ENDSR                                          S01486
068110200610     C********************************************************************S01486
068120200610      /EJECT                                                              S01447
068130200610     C*****************************************************************   S01519
068140200610     C*                                                               *   S01519
068150200610     C*  CALAMT  SUB ROUTINE TO DETERMINE IF AMOUNTS NEED TO BE       *   S01519
068160200610     C*          DEFAULTED FOR CHARGES                                *   S01519
068170200610     C*                                                               *   S01519
068180200610     C*****************************************************************   S01519
068190200610     C*                                                                   S01519
068200200610     C           CALAMT    BEGSR                                          S01519
068210200610     C*                                                                   S01519
068220200610     C** Charges to be displayed in nominal currency whether the          S01519
068230200610     C** security is single, dual or multi currency (ref amend to FS)     S01519
068240200610     C*                                                                   S01519
068250200610     C                     MOVE PNCY      @CCY    3                       S01519
068260200610     C           @CCOD     CHAINSECGT                21                   S01519
068270200610     C*                                                                   S01519
068280200610     C** If no live record found, field defaults to blank                 S01519
068290200610     C*                                                                   S01519
068300200610     C           *IN21     IFEQ '1'                                       S01519
068310200610     C           RECI      ORNE 'D'                                       S01519
068320200610     C                     Z-ADD*ZEROS    ZCHGA                           S01519
068330200610     C                     END                                            S01519
068340200610     C*                                                                   S01519
068350200610     C           *IN21     IFEQ '0'                                       S01519
068360200610     C           RECI      ANDEQ'D'                                       S01519
068370200610     C*                                                                   S01519
068380200610     C** If trade type is purchase and levy on sale or trade type is      S01519
068390200610     C** sale and levy on purchase field is blank, otherwise calculate    S01519
068400200610     C** amount                                                           S01519
068410200610     C*                                                                   S01519
068420200610     C           LPSI      IFEQ 'S'                                       S01519
068430200610     C           LPSI      OREQ 'P'                                       S01519
068440200610     C                     Z-ADD*ZEROS    ZCHGA                           S01519
068450200610     C                     ELSE                                           S01519
068460200610     C                     EXSR CALAM2                                    S01519
068470200610     C                     END                                            S01519
068480200610     C*                                                                   S01519
068490200610     C                     END                                            S01519
068500200610     C*                                                                   S01519
068510200610     C                     ENDSR                                          S01519
068520200610     C*                                                                   S01519
068530200610     C*****************************************************************   S01519
068540200610     C/EJECT                                                              S01519
068550200610     C*****************************************************************   S01519
068560200610     C*                                                               *   S01519
068570200610     C*  CALAM2  SUB ROUTINE TO CALCULATE CHARGE AMOUNTS              *   S01519
068580200610     C*                                                               *   S01519
068590200610     C*****************************************************************   S01519
068600200610     C*                                                                   S01519
068610200610     C           CALAM2    BEGSR                                          S01519
068620200610     C*                                                                   S01519
068630200610     C** Charge details                                                   S01519
068640200610     C*                                                                   S01519
068650200610     C                     MOVE CHGB      ZCHGB                           S01519
068660200610     C                     MOVE THRI      ZTHRI                           S01519
068670200610     C                     Z-ADDMNCH      ZMNCH                           S01519
068680200610     C                     Z-ADDMXCH      ZMXCH                           S01519
068690200610     C*                                                                   S01519
068700200610     C** Set up array for upper range limits                              S01519
068710200610     C*                                                                   S01519
068720200610     C                     Z-ADDSTU1      ZRA,1                           S01519
068730200610     C                     Z-ADDSTU2      ZRA,2                           S01519
068740200610     C                     Z-ADDSTU3      ZRA,3                           S01519
068750200610     C                     Z-ADDSTU4      ZRA,4                           S01519
068760200610     C                     Z-ADDSTU5      ZRA,5                           S01519
068770200610     C                     Z-ADDSTU6      ZRA,6                           S01519
068780200610     C                     Z-ADDSTU7      ZRA,7                           S01519
068790200610     C                     Z-ADDSTU8      ZRA,8                           S01519
068800200610     C                     Z-ADDSTU9      ZRA,9                           S01519
068810200610     C                     Z-ADDST10      ZRA,10                          S01519
068820200610     C                     Z-ADDST11      ZRA,11                          S01519
068830200610     C                     Z-ADDST12      ZRA,12                          S01519
068840200610     C                     Z-ADDST13      ZRA,13                          S01519
068850200610     C                     Z-ADDST14      ZRA,14                          S01519
068860200610     C*                                                                   S01519
068870200610     C** Set up array for percentage levels                               S01519
068880200610     C*                                                                   S01519
068890200610     C                     Z-ADDPL01      ZPC,1                           S01519
068900200610     C                     Z-ADDPL02      ZPC,2                           S01519
068910200610     C                     Z-ADDPL03      ZPC,3                           S01519
068920200610     C                     Z-ADDPL04      ZPC,4                           S01519
068930200610     C                     Z-ADDPL05      ZPC,5                           S01519
068940200610     C                     Z-ADDPL06      ZPC,6                           S01519
068950200610     C                     Z-ADDPL07      ZPC,7                           S01519
068960200610     C                     Z-ADDPL08      ZPC,8                           S01519
068970200610     C                     Z-ADDPL09      ZPC,9                           S01519
068980200610     C                     Z-ADDPL10      ZPC,10                          S01519
068990200610     C                     Z-ADDPL11      ZPC,11                          S01519
069000200610     C                     Z-ADDPL12      ZPC,12                          S01519
069010200610     C                     Z-ADDPL13      ZPC,13                          S01519
069020200610     C                     Z-ADDPL14      ZPC,14                          S01519
069030200610     C                     Z-ADDPL15      ZPC,15                          S01519
069040200610     C*                                                                   S01519
069050200610     C** Set up array for flat charges                                    S01519
069060200610     C*                                                                   S01519
069070200610     C                     Z-ADDFC01      ZCG,1                           S01519
069080200610     C                     Z-ADDFC02      ZCG,2                           S01519
069090200610     C                     Z-ADDFC03      ZCG,3                           S01519
069100200610     C                     Z-ADDFC04      ZCG,4                           S01519
069110200610     C                     Z-ADDFC05      ZCG,5                           S01519
069120200610     C                     Z-ADDFC06      ZCG,6                           S01519
069130200610     C                     Z-ADDFC07      ZCG,7                           S01519
069140200610     C                     Z-ADDFC08      ZCG,8                           S01519
069150200610     C                     Z-ADDFC09      ZCG,9                           S01519
069160200610     C                     Z-ADDFC10      ZCG,10                          S01519
069170200610     C                     Z-ADDFC11      ZCG,11                          S01519
069180200610     C                     Z-ADDFC12      ZCG,12                          S01519
069190200610     C                     Z-ADDFC13      ZCG,13                          S01519
069200200610     C                     Z-ADDFC14      ZCG,14                          S01519
069210200610     C                     Z-ADDFC15      ZCG,15                          S01519
069220200610     C*                                                                   S01519
069230200610     C** Get nominal currency dec. places from TABTG10                    S01519
069240200610     C*                                                                   S01519
069250200610     C                     MOVE PNCY      WCURR                           S01519
069260200610     C                     EXSR TG10                                      S01519
069270200610     C                     MOVE CDP       ZDECS                           S01519
069280200610     C                     MOVE CDP       ZCDP                            S01519
069290200610     C*                                                                   S01519
069300200610     C** Nominal decimal places                                           S01519
069310200610     C*                                                                   S01519
069320200610     C                     Z-ADDNMDP      ZNMDP                           S01519
069330200610     C*                                                                   S01519
069340200610     C** Use SR/ZAVPR to calculate the price                              S01519
069350200610     C*                                                                   S01519
069360200610     C                     MOVE PNMP      ZNOML                           S01519
069370200610     C                     Z-ADDPAMD      ZAPNC                           S01519
069380200610     C                     EXSR ZAVPR                                     S01519
069390200610     C                     Z-ADDZPRC      ZPRICE                          S01519
069400200610     C*                                                                   S01519
069410200610     C                     Z-ADD1         ZTCFC                           S01519
069420200610     C                     MOVE PROT      ZPROT                           S01519
069430200610     C                     MOVE SPBS      ZSPBS                           S01519
069440200610     C*                                                                   S01446
069450200610     C** For courtage enhancements, convert charge to value currency      S01446
069460200610     C*                                                                   S01446
069470200610     C           S01446    IFEQ 'Y'                                       S01446
069480200610     C*                                                                   S01446
069490200610     C** Purchase interest and total consideration                        S01446
069500200610     C*                                                                   S01446
069510200610     C                     Z-ADD*ZEROS    ZTPI                            S01446
069520200610     C                     Z-ADD*ZEROS    ZTCON                           S01446
069530200610     C*                                                                   S01446
069540200610     C           BVCHRC    IFNE *BLANKS                                   S01446
069550200610     C                     MOVE BVCHRC    ZCCYI                           S01446
069560200610     C                     MOVE PNCY      ZCCYO                           S01446
069570200610     C                     MOVE TRATEX    ZEXCH                           S01446
069580200610     C                     MOVE TMDIX     ZMD                             S01446
069590200610     C                     MOVE TXCDP     ZCDPI                           S01446
069600200610     C                     MOVE ZDECS     ZCDPO                           S01446
069610200610     C*                                                                   S01446
069620200610     C                     ELSE                                           S01446
069630200610     C                     MOVE *BLANKS   ZCCYI                           S01446
069640200610     C                     MOVE *BLANKS   ZCCYO                           S01446
069650200610     C                     MOVE *BLANKS   ZEXCH                           S01446
069660200610     C                     MOVE *BLANKS   ZMD                             S01446
069670200610     C                     MOVE *BLANKS   ZCDPI                           S01446
069680200610     C                     MOVE *BLANKS   ZCDPO                           S01446
069690200610     C                     END                                            S01446
069700200610     C                     END                                            S01446
069710200610     C*                                                                   S01446
069720200610     C** Total nominal                                                    S01446
069730200610     C*                                                                   S01446
069740200610     C                     Z-ADD*ZEROS    ZTNOM  150                      S01446
069750200610     C/COPY WNCPYSRC,SE2400C050
069760200610     C*                                                                   S01446
069770200610     C                     EXSR ZCCAL1                                    S01519
069780200610     C/COPY WNCPYSRC,SE2400C051
069790200610     C*                                                                   S01519
069800200610     C                     ENDSR                                          S01519
069810200610     C*                                                                   S01519
069820200610     C*****************************************************************   S01519
069830200610      /EJECT                                                              S01447
069840200610      *****************************************************************   S01447
069850200610      *                                                               *   S01447
069860200610      *  CALCTX - Subroutine to calculate tax amounts for dividends   *   S01447
069870200610      *           and Coupons                                         *   S01447
069880200610      *                                                               *   S01447
069890200610      *  CALLED FROM: W02                                             *   S01447
069900200610      *  CALLS:       NONE                                            *   S01447
069910200610      *                                                               *   S01447
069920200610      *****************************************************************   S01447
069930200610      *                                                                   S01447
069940200610     C           CALCTX    BEGSR                                          S01447
069950200610      *                                                                   S01447
069960200610      *** Initialise work tax rate and amount fields                      S01447
069970200610      *                                                                   S01447
069980200610     C                     CLEARUTXRSR                                    S01447
069990200610     C                     CLEARUTXRRF                                    S01447
070000200610     C                     CLEARUTXRUS                                    S01447
070010200610     C                     CLEARUDLOR                                     S01447
070020200610      *                                                                   S01447
070030200610      *** If tax band at source is zero, then take rate from security     S01447
070040200610      *** WHT file; Otherwise access SEcountry tax rate file to           S01447
070050200610      *** get tax rate at source                                          S01447
070060200610      *                                                                   S01447
070070200610     C           S1TABD    IFEQ *ZERO                      *B1            S01447
070080200610     C                     Z-ADDS1RASO    UTXRSR                          S01447
070090200610     C                     ELSE                            *X1            S01447
070100200610      *                                                                   S01447
070110200610     C                     MOVELS1CTTA    UKEY    3                       S01447
070120200610     C                     MOVE S1TABD    UKEY                            S01447
070130200610      *                                                                   S01447
070140200610     C                     CALL 'AOSCTXR0'                                S01447
070150200610     C                     PARM *BLANKS   @RTCD                           S01447
070160200610     C                     PARM '*KEY   ' @OPTN                           S01447
070170200610     C                     PARM S1CTTA    @CTTA   2                       S01447
070180200610     C                     PARM S1TABD    @TABD   10                      S01447
070190200610     C           SECNTR    PARM SECNTR    DSSDY                           S01447
070200200610     C*                                                                   S01447
070210200610     C           @RTCD     IFNE *BLANKS                    *B2            S01447
070220200610     C           TXRECI    ORNE 'D'                                       S01447
070230200610     C           *LOCK     IN   LDA                                       S01447
070240200610     C                     MOVEL'SECNTRL0'DBFILE           ***************S01447
070250200610     C                     MOVELUKEY      DBKEY            ** DBERROR 018 S01447
070260200610     C                     Z-ADD18        DBASE            ***************S01447
070270200610     C                     SETON                       U7U8               S01447
070280200610     C                     EXSR *PSSR                                     S01447
070290200610     C                     GOTO EAUDIT                                    S01447
070300200610     C                     ELSE                            *X2            S01447
070310200610     C                     Z-ADDTXRASO    UTXRSR                          S01447
070320200610     C                     END                             *E2            S01447
070330200610     C                     END                             *E1            S01447
070340200610      *                                                                   S01447
070350200610      *** If tax band by user is not zero, then access country to         S01447
070360200610      *** branch tax rate file to get tax rate by user                    S01447
070370200610      *** Otherwise set to zero.                                          S01447
070380200610      *                                                                   S01447
070390200610     C           S1TABU    IFNE *ZERO                      *B1            S01447
070400200610     C                     MOVE CSBA      @BRCA   3                                         AR877365
070410200610     C           BGPFMG    IFEQ 'Y'                                                         AR877365
070420200610     C           BGN4ST    OREQ 'Y'                                                         AR877365
070430200610     C                     MOVE CDPA      @BRCA                                             AR877365
070440200610     C                     ENDIF                                                            AR877365
070450200610     C/COPY WNCPYSRC,SE2400C058
070460200610     C                     CALL 'AOCBTXR0'                                S01447
070470200610     C                     PARM *BLANKS   @RTCD                           S01447
070480200610     C                     PARM '*KEY   ' @OPTN                           S01447
070490200610     C**********           PARM CSBA      @BRCA   3                                  S01447 AR877365
070500200610     C                     PARM           @BRCA                                             AR877365
070510200610     C                     PARM S1CTTA    @CTTA                           S01447
070520200610     C                     PARM S1TABU    @TABU   10                      S01447
070530200610     C           SECBTX    PARM SECBTX    DSFDY                           S01447
070540200610     C/COPY WNCPYSRC,SE2400C059
070550200610     C*                                                                   S01447
070560200610     C           @RTCD     IFEQ *BLANKS                    *B2            S01447
070570200610     C           TBRECI    ANDEQ'D'                                       S01447
070580200610     C                     Z-ADDTBRASR    UTXRRF                          S01447
070590200610     C                     Z-ADDTBRAUS    UTXRUS                          S01447
070600200610     C                     MOVE TBDLOR    UDLOR                           S01447
070610200610     C                     END                             *E2            S01447
070620200610     C                     END                             *E1            S01447
070630200610      *                                                                   S01447
070640200610      *** calculate amount deducted at source                             S01447
070650200610      *                                                                   S01447
070660200610     C           S01496    IFEQ 'Y'                                                           248184
070670200610     C           PAMD      MULT UTXRSR    WTASO  204                                          248184
070680200610     C           WTASO     DIV  100       TASO      H                                         248184
070690200610     C                     ELSE                                                               248184
070700200610     C           UTXRSR    DIV  100       URATE   54                      S01447
070710200610     C           PAMD      MULT URATE     TASO      H                     S01447
070720200610     C                     ENDIF                                                              248184
070730200610      *                                                                   S01447
070740200610      *** calculate amount deducted refundable                            S01447
070750200610      *                                                                   S01447
070760200610     C           S01496    IFEQ 'Y'                                                           248184
070770200610     C           PAMD      MULT UTXRRF    WTASR  204                                          248184
070780200610     C           WTASR     DIV  100       TASR      H                                         248184
070790200610     C                     ELSE                                                               248184
070800200610     C           UTXRRF    DIV  100       URATE                           S01447
070810200610     C           PAMD      MULT URATE     TASR      H                     S01447
070820200610     C                     ENDIF                                                              248184
070830200610      *                                                                   S01447
070840200610      *** calculate amount deducted by user                               S01447
070850200610      *                                                                   S01447
070860200610     C                     CLEARTAUS                                      S01447
070870200610      *                                                                   S01447
070880200610     C           UTXRUS    IFGT *ZERO                      *B1            S01447
070890200610      *                                                                   S01447
070900200610     C           UDLOR     IFEQ 'N'                        *B2            S01447
070910200610     C                     MOVE PCPY      WCUST                           S01447
070920200610     C           CLKYCB    CHAINCLINT                54                   S01447
070930200610     C           *IN54     IFEQ '1'                        *B3            S01447
070940200610     C           RECI      OREQ '*'                                       S01447
070950200610     C           *LOCK     IN   LDA                                       S01447
070960200610     C                     MOVEL'CLINTCB 'DBFILE           ***************S01447
070970200610     C                     MOVELPCPY      DBKEY            ** DBERROR 021 S01447
070980200610     C                     Z-ADD21        DBASE            ***************S01447
070990200610     C                     SETON                       U7U8               S01447
071000200610     C                     EXSR *PSSR                                     S01447
071010200610     C                     GOTO EAUDIT                                    S01447
071020200610     C                     END                             *E3            S01447
071030200610     C                     END                             *E2            S01447
071040200610      *                                                                   S01447
071050200610     C           UDLOR     IFEQ 'Y'                        *B2            S01447
071060200610     C           UDLOR     OREQ 'N'                                       S01447
071070200610     C           CLOC      ANDNEUBRLOC                                    S01447
071080200610      *                                                                   S01447
071090200610     C           S01496    IFEQ 'Y'                                                           248184
071100200610     C           PAMD      MULT UTXRUS    WTAUS  204                                          248184
071110200610     C           WTAUS     DIV  100       TAUS      H                                         248184
071120200610     C                     ELSE                                                               248184
071130200610     C           UTXRUS    DIV  100       URATE                           S01447
071140200610     C/COPY WNCPYSRC,SE2400C060
071150200610     C           PAMD      MULT URATE     TAUS      H                     S01447
071160200610     C/COPY WNCPYSRC,SE2400C061
071170200610     C                     ENDIF                                                              248184
071180200610     C                     END                             *E2            S01447
071190200610      *                                                                   S01447
071200200610     C                     END                             *E1            S01447
071210200610      *                                                                   S01447
071220200610     C                     ENDSR                                          S01447
071230200610      *                                                                   S01447
071240200610      *****************************************************************   S01447
071250200610      /EJECT
071260200610      *****************************************************************
071270200610      *                                                               *
071280200610      *  W03    - Subroutine to Write Matured Security Positions      *
071290200610      *           Extract record.                                     *
071300200610      *                                                               *
071310200610      *****************************************************************
071320200610      *
071330200610     C           W03       BEGSR                           ** W03    **
071340200610     C*                                                                   S01486
071350200610     C***FS***** BGPFMG    IFEQ 'Y'                                S01486
071360200610     C** COUPON AND MATURITY EVENTS SEPARATE THEREFORE NEED TO PERFS01486
071370200610     C** SR/COUPON TO CALCULATE COUPON AMOUNT                      S01486
071380200610     C***FS*************** Z-ADDCSNT      WCUMCP                   S01486
071390200610     C***FS*************** Z-ADDSAED      ZECD                     S01486
071400200610     C***FS*************** EXSR ZLCD                               S01486
071410200610     C***FS*************** Z-ADDZZLCD     SALCCP                   S01486
071420200610     C***FS*************** MOVE 'Y'       W03FLG  1                S01486
071430200610     C***FS*************** EXSR COUPON                             S01486
071440200610     C***FS*************** MOVE 'N'       W03FLG  1                S01486
071450200610     C***FS*************** Z-ADDZINTDU    CPNA                     S01486
071460200610     C********** SAAT      IFEQ 'MA'                                      S01486
071470200610     C******************** MOVE 'C'       RECI                            S01486
071480200610     C******************** ELSE                                           S01486
071490200610     C******************** MOVE 'P'       RECI                            S01486
071500200610     C******************** END                                            S01486
071510200610     C******************** ADD  1         WMATUR  50                      S01486
071520200610     C******************** MOVE CSBA      BHBA                            S01486
071530200610     C******************** MOVE CSSC      BHSC                            S01486
071540200610     C******************** MOVE '  '      BHBK                            S01486
071550200610     C********** SAAT      IFEQ 'MA'                                      S01486
071560200610     C******************** Z-ADDWNOMA1    TCTR                            S01486
071570200610     C******************** Z-ADD*ZEROS    CPNA                            S01486
071580200610     C******************** ELSE                                           S01486
071590200610     C******************** Z-ADD*ZEROS    TCTR                            S01486
071600200610     C******************** Z-ADDZINTDU    CPNA                            S01486
071610200610     C******************** END                                            S01486
071620200610     C******************** ELSE                                           S01486
071630200610     C*
071640200610     C** WRITE MATURED SECURITY EXTRACT FILE FOR EACH MATURED SECURITY
071650200610     C*
071660200610     C           SAAT      IFEQ 'MA'                                      E37289
071670200610     C                     MOVE 'C'       RECI
071680200610     C                     ELSE                                           E37289
071690200610     C                     MOVE 'P'       RECI                            E37289
071700200610     C                     END                                            E37289
071710200610     C                     ADD  1         WMATUR  50
071720200610     C***********          MOVE CSBR      BHBR                            S01117
071730200610     C                     MOVE CSBA      BHBA                            S01117
071740200610     C                     MOVE CSSC      BHSC
071750200610     C                     MOVE '  '      BHBK
071760200610     C           SAAT      IFEQ 'MA'                                      E37289
071770200610     C                     Z-ADDWNOMAT    TCTR
071780200610     C                     Z-ADD*ZEROS    CPNA                            E37289
071790200610     C                     ELSE                                           E37289
071800200610     C                     Z-ADD*ZEROS    TCTR                            E37289
071810200610     C                     Z-ADDZINTDU    CPNA
071820200610     C                     END                                            E37289
071830200610     C***FS*************** END                                            S01486
071840200610      *
071850200610      ***  Implicit Moves (i.e. same names on output) as follows:
071860200610      ***  CSCN, SDRP, CSNT, CSNV.
071870200610      *
071880200610     C                     WRITEMATEXDF
071890200610     C*
071900200610     C           ENDW03    ENDSR                           ** ENDW03 **
071910200610      *
071920200610      *****************************************************************                CGL031 233709
071930200610      /EJECT                                                                           CGL031 233709
071940200610      *****************************************************************                CGL031 233709
071950200610      *****************************************************************                CGL031 233709
071960200610      ***W04****-*Subroutine*to*Output*Tax*Account*Key*&*Amount*Key****                CGL031 233709
071970200610      *****************************************************************                CGL031 233709
071980200610      *****************************************************************                CGL031 233709
071990200610      **********                                                                       CGL031 233709
072000200610     C********** W04       BEGSR                                                       CGL031 233709
072010200610      **********                                                                       CGL031 233709
072020200610      ***Tax*Account*Key*Generation************************************                CGL031 233709
072030200610      ***Initialise*fields*********************************************                CGL031 233709
072040200610      **********                                                                       CGL031 233709
072050200610     C**********           MOVEL'E'       WACEVC                                       CGL031 233709
072060200610     C**********           MOVELWCOLC     WARCTR                                       CGL031 233709
072070200610     C**********           MOVEL'ET'      WACAMC                                       CGL031 233709
072080200610     C**********           Z-ADDWTTXSC    EVAM                                         CGL031 233709
072090200610      *****************************************************************                CGL031 233709
072100200610     C**********           MOVELTSTXCY    EVCY                                         CGL031 233709
072110200610     C**********           MOVELTSOCCY    KCCY                                         CGL031 233709
072120200610      *****************************************************************                CGL031 233709
072130200610     C********** TSTXCY    IFNE TSOCCY                                                 CGL031 233709
072140200610     C**********           Z-ADDWTTXSS    KNCA                                         CGL031 233709
072150200610     C**********           Z-ADDWTTXSB    KBCA                                         CGL031 233709
072160200610     C**********           ELSE                                                        CGL031 233709
072170200610     C**********           Z-ADD0         KNCA                                         CGL031 233709
072180200610     C**********           Z-ADD0         KBCA                                         CGL031 233709
072190200610     C**********           ENDIF                                                       CGL031 233709
072200200610      *****************************************************************                CGL031 233709
072210200610      ***Do*not*output*records*if*Amount*Due*is*zero*******************                CGL031 233709
072220200610      *****************************************************************                CGL031 233709
072230200610     C********** EVAM      IFEQ *ZERO                                                  CGL031 233709
072240200610     C**********           MOVEL*BLANK    WARCTR                                       CGL031 233709
072250200610     C**********           ENDIF                                                       CGL031 233709
072260200610      *****************************************************************                CGL031 233709
072270200610     C********** EVAM      CABEQ0         ENDW04                                       CGL031 233709
072280200610      *****************************************************************                CGL031 233709
072290200610      ***Count*records*written*and*use*STD*HASH*Subroutine*************                CGL031 233709
072300200610      *****************************************************************                CGL031 233709
072310200610     C**********           ADD  1         W01CNT  50                                   CGL031 233709
072320200610      **********                                                                       CGL031 233709
072330200610      ***Execute*HASH*TOTALLING*Subroutine*once*(Z=1)*for*First********                CGL031 233709
072340200610      ***Array*Elements*(IND,S*DEC,S)*SO*S=1*,Accumulating*ZZAMT(15/3)*                CGL031 233709
072350200610      **********                                                                       CGL031 233709
072360200610     C**********           Z-ADD1         Z                                            CGL031 233709
072370200610     C**********           Z-ADD1         S                                            CGL031 233709
072380200610     C**********           Z-ADDEVAM      ZZAMT                                        CGL031 233709
072390200610     C**********           EXSR ZHASH                                                  CGL031 233709
072400200610      *****************************************************************                CGL031 233709
072410200610      ***Build*output*record*******************************************                CGL031 233709
072420200610      *****************************************************************                CGL031 233709
072430200610     C**********           MOVE SITP      WACITY                                       CGL031 233709
072440200610     C**********           MOVE ' '       WACTRT                                       CGL031 233709
072450200610      *****************************************************************                CGL031 233709
072460200610      ***Access*CLINT*for*DISCRT*IND*for*Portfolio*Flag*in*Key*********                CGL031 233709
072470200610      *****************************************************************                CGL031 233709
072480200610     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
072490200610     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
072500200610     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233709
072510200610     C**********           Z-ADDCDCN      WCLNTK                                       CGL031 233709
072520200610     C**********           ELSE                                                        CGL031 233709
072530200610     C**********           MOVE CSCN      WCLNTK                                       CGL031 233709
072540200610     C**********           ENDIF                                                       CGL031 233709
072550200610      *****************************************************************                CGL031 233709
072560200610      ***Obtain*Branch*Code*of*Customer*from*CLINTCB*******************                CGL031 233709
072570200610      *****************************************************************                CGL031 233709
072580200610     C**********           MOVE 'A'       WLIT1                                        CGL031 233709
072590200610     C**********           EXSR CLNTIN                                                 CGL031 233709
072600200610     C**********           MOVE '1'       WLIT1                                        CGL031 233709
072610200610     C**********           MOVE BRCB      CSBA                                         CGL031 233709
072620200610     C**********           ENDIF                                                       CGL031 233709
072630200610     C**********           EXSR CLNTIN                                                 CGL031 233709
072640200610     C********** C1DI      IFEQ 'M'                                                    CGL031 233709
072650200610     C**********           MOVE *BLANKS   WACPFI                                       CGL031 233709
072660200610     C**********           ELSE                                                        CGL031 233709
072670200610     C**********           MOVE C1DI      WACPFI                                       CGL031 233709
072680200610     C**********           ENDIF                                                       CGL031 233709
072690200610      *****************************************************************                CGL031 233709
072700200610     C**********           MOVE '  '      WACBKC                                       CGL031 233709
072710200610     C**********           MOVE '  '      WACTST                                       CGL031 233709
072720200610     C**********           MOVE '  '      WACPSB                                       CGL031 233709
072730200610     C**********           MOVE '  '      WACCCC                                       CGL031 233709
072740200610     C**********           MOVE MKTI      WACMKT                                       CGL031 233709
072750200610     C********** CIAK      IFEQ 'Y'                                                    CGL031 233709
072760200610     C********** SCVI      ANDEQ'Y'                                                    CGL031 233709
072770200610     C**********           MOVE SCVI      WACCON                                       CGL031 233709
072780200610     C**********           ELSE                                                        CGL031 233709
072790200610     C**********           MOVE ' '       WACCON                                       CGL031 233709
072800200610     C**********           ENDIF                                                       CGL031 233709
072810200610     C********** WACAMC    IFEQ 'FP'                                                   CGL031 233709
072820200610     C********** WACAMC    OREQ 'FR'                                                   CGL031 233709
072830200610     C********** WACAMC    OREQ 'CP'                                                   CGL031 233709
072840200610     C********** WACAMC    OREQ 'CR'                                                   CGL031 233709
072850200610     C**********           MOVE *BLANKS   WACBKC                                       CGL031 233709
072860200610     C**********           ENDIF                                                       CGL031 233709
072870200610     C**********           MOVE WACKEY    ACKY                                         CGL031 233709
072880200610     C**********           MOVE 'D'       RECI                                         CGL031 233709
072890200610      *****************************************************************                CGL031 233709
072900200610     C********** PPRE      IFEQ 'R'                                                    CGL031 233709
072910200610     C********** SRSM      ANDEQ04                                                     CGL031 233709
072920200610     C********** PPRE      OREQ 'P'                                                    CGL031 233709
072930200610     C********** SPSM      ANDEQ04                                                     CGL031 233709
072940200610     C**********           ELSE                                                        CGL031 233709
072950200610     C**********           MOVE *BLANK    STLA                                         CGL031 233709
072960200610     C**********           ENDIF                                                       CGL031 233709
072970200610      *****************************************************************                CGL031 233709
072980200610     C********** WSRECI    IFEQ 'R'                                                    CGL031 233709
072990200610     C**********           MOVE '1'       RVRS                                         CGL031 233709
073000200610     C**********           ELSE                                                        CGL031 233709
073010200610     C**********           MOVE '0'       RVRS                                         CGL031 233709
073020200610     C**********           ENDIF                                                       CGL031 233709
073030200610      *****************************************************************                CGL031 233709
073040200610     C**********           MOVE SASN      SESH                                         CGL031 233709
073050200610     C**********           Z-ADD0         TRFR                                         CGL031 233709
073060200610     C**********           MOVELWCLNTK    CSTN                                         CGL031 233709
073070200610     C**********           MOVE CSBA      BRHA                                         CGL031 233709
073080200610     C**********           Z-ADD00        ASQN                                         CGL031 233709
073090200610     C**********           Z-ADDSAED      EVDT                                         CGL031 233709
073100200610      *****************************************************************                CGL031 233709
073110200610     C********** PPRE      IFEQ 'R'                                                    CGL031 233709
073120200610     C********** SRSM      ANDEQ04                                                     CGL031 233709
073130200610     C********** PPRE      OREQ 'P'                                                    CGL031 233709
073140200610     C********** SPSM      ANDEQ04                                                     CGL031 233709
073150200610     C**********           ELSE                                                        CGL031 233709
073160200610     C**********           Z-ADD0         STLT                                         CGL031 233709
073170200610     C**********           ENDIF                                                       CGL031 233709
073180200610      *****************************************************************                CGL031 233709
073190200610      ***Output*profit*centre*from*related*customer*position***********                CGL031 233709
073200200610      *****************************************************************                CGL031 233709
073210200610      ******If*Analytical*Accounting*is*installed*and*customer*********                CGL031 233709
073220200610      ******position*profit*centre*is*blank,*set*the*profit*centre*to**                CGL031 233709
073230200610      ******SE*ICD*default*profit*centre.******************************                CGL031 233709
073240200610      *****************************************************************                CGL031 233709
073250200610     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 233709
073260200610     C********** PCCU      ANDEQ*BLANKS                                                CGL031 233709
073270200610     C**********           MOVE BVSEPC    PRFC                                         CGL031 233709
073280200610     C**********           ELSE                                                        CGL031 233709
073290200610     C**********           MOVE PCCU      PRFC                                         CGL031 233709
073300200610     C**********           ENDIF                                                       CGL031 233709
073310200610      *****************************************************************                CGL031 233709
073320200610      ***Set*Up*Portfolio*Reference*to*be*Output***********************                CGL031 233709
073330200610      *****************************************************************                CGL031 233709
073340200610     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
073350200610     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
073360200610     C**********           MOVE PTFR      SSPTFR  4                                    CGL031 233709
073370200610     C********** WPORTP    IFNE 'Y'                                                    CGL031 233709
073380200610     C**********           MOVE *BLANKS   PTFR                                         CGL031 233709
073390200610     C**********           ENDIF                                                       CGL031 233709
073400200610     C**********           ENDIF                                                       CGL031 233709
073410200610      *****************************************************************                CGL031 233709
073420200610      ***Write*Generated*Account*Key*Record****************************                CGL031 233709
073430200610      *****************************************************************                CGL031 233709
073440200610     C**********           WRITESEKEYDF                                                CGL031 233709
073450200610     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
073460200610     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
073470200610     C**********           MOVE SSPTFR    PTFR                                         CGL031 233709
073480200610     C**********           ENDIF                                                       CGL031 233709
073490200610      *****************************************************************                CGL031 233709
073500200610      ***Net*Interest*Amount*Account*Key*Generation********************                CGL031 233709
073510200610      ***Initialise*fields*********************************************                CGL031 233709
073520200610      *****************************************************************                CGL031 233709
073530200610     C**********           CLEARSEKEYDF                                                CGL031 233709
073540200610      *****************************************************************                CGL031 233709
073550200610     C**********           MOVEL*BLANK    WARCTR                                       CGL031 233709
073560200610     C**********           MOVEL'NI'      WACAMC                                       CGL031 233709
073570200610      *****************************************************************                CGL031 233709
073580200610      ***Dividend*Process**********************************************                CGL031 233709
073590200610      *****************************************************************                CGL031 233709
073600200610     C********** TSETYP    IFEQ 'DV'                                                   CGL031 233709
073610200610     C**********           Z-ADDWDIVDU    EVAM                                         CGL031 233709
073620200610     C**********                                                                       CGL031 233709
073630200610     C***Reverse*sign*of*output*file*if*split*neg*accrual*is*Y*and*****                CGL031 233709
073640200610     C***cum-coupon*value*is*less*than*zero****************************                CGL031 233709
073650200610     C**********                                                                       CGL031 233709
073660200610     C********** WCUMCP    IFLT 0                                                      CGL031 233709
073670200610     C********** SNAC      ANDEQ'Y'                                                    CGL031 233709
073680200610     C**********           Z-SUBEVAM      EVAM                                         CGL031 233709
073690200610     C**********           ENDIF                                                       CGL031 233709
073700200610     C**********           ENDIF                                                       CGL031 233709
073710200610      *****************************************************************                CGL031 233709
073720200610      ***Coupon*Process************************************************                CGL031 233709
073730200610      *****************************************************************                CGL031 233709
073740200610     C********** TSETYP    IFEQ 'CP'                                                   CGL031 233709
073750200610     C**********           Z-ADDZINTDU    EVAM                                         CGL031 233709
073760200610     C**********                                                                       CGL031 233709
073770200610     C***Reverse*sign*of*output*file*if*split*neg*accrual*is*Y*and*****                CGL031 233709
073780200610     C***coupon*value*is*less*than*zero********************************                CGL031 233709
073790200610     C**********                                                                       CGL031 233709
073800200610     C********** ZINTDU    IFLT 0                                                      CGL031 233709
073810200610     C********** SNAC      ANDEQ'Y'                                                    CGL031 233709
073820200610     C**********           Z-SUBEVAM      EVAM                                         CGL031 233709
073830200610     C**********           ENDIF                                                       CGL031 233709
073840200610     C**********           ENDIF                                                       CGL031 233709
073850200610      *****************************************************************                CGL031 233709
073860200610      ***Mortgage*Back*Payment*Process*********************************                CGL031 233709
073870200610      *****************************************************************                CGL031 233709
073880200610     C********** TSETYP    IFEQ 'MP'                                                   CGL031 233709
073890200610     C**********           Z-ADDPAMD      EVAM                                         CGL031 233709
073900200610     C**********                                                                       CGL031 233709
073910200610     C***Reverse*sign*of*output*file*if*negative*position*is*Y*and*****                CGL031 233709
073920200610     C***payment*value*is*less*than*zero*******************************                CGL031 233709
073930200610     C**********                                                                       CGL031 233709
073940200610     C********** PAMD      IFLT 0                                                      CGL031 233709
073950200610     C********** NPAC      ANDEQ'Y'                                                    CGL031 233709
073960200610     C**********           Z-SUBEVAM      EVAM                                         CGL031 233709
073970200610     C**********           ENDIF                                                       CGL031 233709
073980200610     C**********           ENDIF                                                       CGL031 233709
073990200610      *****************************************************************                CGL031 233709
074000200610      ***Maturity*Process**********************************************                CGL031 233709
074010200610      *****************************************************************                CGL031 233709
074020200610     C********** TSETYP    IFEQ 'MT'                                                   CGL031 233709
074030200610     C**********           Z-ADDMATAMT    EVAM                                         CGL031 233709
074040200610     C**********           ENDIF                                                       CGL031 233709
074050200610      *****************************************************************                CGL031 233709
074060200610     C********** EVAM      SUB  WTTXSS    EVAM                                         CGL031 233709
074070200610      *****************************************************************                CGL031 233709
074080200610     C**********           MOVELTSOCCY    EVCY                                         CGL031 233709
074090200610     C**********           MOVELTSOCCY    KCCY                                         CGL031 233709
074100200610      *****************************************************************                CGL031 233709
074110200610      ***Do*not*output*records*if*Amount*Due*is*zero*******************                CGL031 233709
074120200610      *****************************************************************                CGL031 233709
074130200610     C********** EVAM      IFEQ *ZERO                                                  CGL031 233709
074140200610     C**********           MOVEL*BLANK    WARCTR                                       CGL031 233709
074150200610     C**********           ENDIF                                                       CGL031 233709
074160200610      *****************************************************************                CGL031 233709
074170200610     C********** EVAM      CABEQ0         ENDW04                                       CGL031 233709
074180200610      *****************************************************************                CGL031 233709
074190200610      ***Count*records*written*and*use*STD*HASH*Subroutine*************                CGL031 233709
074200200610      *****************************************************************                CGL031 233709
074210200610     C**********           ADD  1         W01CNT  50                                   CGL031 233709
074220200610      *****************************************************************                CGL031 233709
074230200610      ***Execute*HASH*TOTALLING*Subroutine*once*(Z=1)*for*First********                CGL031 233709
074240200610      ***Array*Elements*(IND,S*DEC,S)*SO*S=1*,Accumulating*ZZAMT(15/3)*                CGL031 233709
074250200610      *****************************************************************                CGL031 233709
074260200610     C**********           Z-ADD1         Z                                            CGL031 233709
074270200610     C**********           Z-ADD1         S                                            CGL031 233709
074280200610     C**********           Z-ADDEVAM      ZZAMT                                        CGL031 233709
074290200610     C**********           EXSR ZHASH                                                  CGL031 233709
074300200610      *****************************************************************                CGL031 233709
074310200610      ***Build*output*record*******************************************                CGL031 233709
074320200610      *****************************************************************                CGL031 233709
074330200610     C**********           MOVE SITP      WACITY                                       CGL031 233709
074340200610     C**********           MOVE ' '       WACTRT                                       CGL031 233709
074350200610      *****************************************************************                CGL031 233709
074360200610      ***Access*CLINT*for*DISCRT*IND*for*Portfolio*Flag*in*Key*********                CGL031 233709
074370200610      *****************************************************************                CGL031 233709
074380200610     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
074390200610     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
074400200610     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233709
074410200610     C**********           Z-ADDCDCN      WCLNTK                                       CGL031 233709
074420200610     C**********           ELSE                                                        CGL031 233709
074430200610     C**********           MOVE CSCN      WCLNTK                                       CGL031 233709
074440200610     C**********           ENDIF                                                       CGL031 233709
074450200610      *****************************************************************                CGL031 233709
074460200610      ***Obtain*Branch*Code*of*Customer*from*CLINTCB*******************                CGL031 233709
074470200610      *****************************************************************                CGL031 233709
074480200610     C**********           MOVE 'A'       WLIT1                                        CGL031 233709
074490200610     C**********           EXSR CLNTIN                                                 CGL031 233709
074500200610     C**********           MOVE '1'       WLIT1                                        CGL031 233709
074510200610     C**********           MOVE BRCB      CSBA                                         CGL031 233709
074520200610     C**********           ENDIF                                                       CGL031 233709
074530200610     C**********           EXSR CLNTIN                                                 CGL031 233709
074540200610     C********** C1DI      IFEQ 'M'                                                    CGL031 233709
074550200610     C**********           MOVE *BLANKS   WACPFI                                       CGL031 233709
074560200610     C**********           ELSE                                                        CGL031 233709
074570200610     C**********           MOVE C1DI      WACPFI                                       CGL031 233709
074580200610     C**********           ENDIF                                                       CGL031 233709
074590200610      *****************************************************************                CGL031 233709
074600200610     C**********           MOVE '  '      WACBKC                                       CGL031 233709
074610200610     C**********           MOVE '  '      WACTST                                       CGL031 233709
074620200610     C**********           MOVE '  '      WACPSB                                       CGL031 233709
074630200610     C**********           MOVE '  '      WACCCC                                       CGL031 233709
074640200610     C**********           MOVE MKTI      WACMKT                                       CGL031 233709
074650200610     C********** CIAK      IFEQ 'Y'                                                    CGL031 233709
074660200610     C********** SCVI      ANDEQ'Y'                                                    CGL031 233709
074670200610     C**********           MOVE SCVI      WACCON                                       CGL031 233709
074680200610     C**********           ELSE                                                        CGL031 233709
074690200610     C**********           MOVE ' '       WACCON                                       CGL031 233709
074700200610     C**********           ENDIF                                                       CGL031 233709
074710200610     C********** WACAMC    IFEQ 'FP'                                                   CGL031 233709
074720200610     C********** WACAMC    OREQ 'FR'                                                   CGL031 233709
074730200610     C********** WACAMC    OREQ 'CP'                                                   CGL031 233709
074740200610     C********** WACAMC    OREQ 'CR'                                                   CGL031 233709
074750200610     C**********           MOVE *BLANKS   WACBKC                                       CGL031 233709
074760200610     C**********           ENDIF                                                       CGL031 233709
074770200610     C**********           MOVE WACKEY    ACKY                                         CGL031 233709
074780200610     C**********           MOVE 'D'       RECI                                         CGL031 233709
074790200610      *****************************************************************                CGL031 233709
074800200610     C********** PPRE      IFEQ 'R'                                                    CGL031 233709
074810200610     C********** SRSM      ANDEQ04                                                     CGL031 233709
074820200610     C********** PPRE      OREQ 'P'                                                    CGL031 233709
074830200610     C********** SPSM      ANDEQ04                                                     CGL031 233709
074840200610     C**********           ELSE                                                        CGL031 233709
074850200610     C**********           MOVE *BLANK    STLA                                         CGL031 233709
074860200610     C**********           ENDIF                                                       CGL031 233709
074870200610      *****************************************************************                CGL031 233709
074880200610     C********** WSRECI    IFEQ 'R'                                                    CGL031 233709
074890200610     C**********           MOVE '1'       RVRS                                         CGL031 233709
074900200610     C**********           ELSE                                                        CGL031 233709
074910200610     C**********           MOVE '0'       RVRS                                         CGL031 233709
074920200610     C**********           ENDIF                                                       CGL031 233709
074930200610      *****************************************************************                CGL031 233709
074940200610     C**********           MOVE SASN      SESH                                         CGL031 233709
074950200610     C**********           Z-ADD0         TRFR                                         CGL031 233709
074960200610     C**********           MOVELWCLNTK    CSTN                                         CGL031 233709
074970200610     C**********           MOVE CSBA      BRHA                                         CGL031 233709
074980200610     C**********           Z-ADD00        ASQN                                         CGL031 233709
074990200610     C**********           Z-ADDSAED      EVDT                                         CGL031 233709
075000200610     C**********           Z-ADD0         KNCA                                         CGL031 233709
075010200610     C**********           Z-ADD0         KBCA                                         CGL031 233709
075020200610      *****************************************************************                CGL031 233709
075030200610     C********** PPRE      IFEQ 'R'                                                    CGL031 233709
075040200610     C********** SRSM      ANDEQ04                                                     CGL031 233709
075050200610     C********** PPRE      OREQ 'P'                                                    CGL031 233709
075060200610     C********** SPSM      ANDEQ04                                                     CGL031 233709
075070200610     C**********           ELSE                                                        CGL031 233709
075080200610     C**********           Z-ADD0         STLT                                         CGL031 233709
075090200610     C**********           ENDIF                                                       CGL031 233709
075100200610      *****************************************************************                CGL031 233709
075110200610      ***Output*profit*centre*from*related*customer*position***********                CGL031 233709
075120200610      *****************************************************************                CGL031 233709
075130200610      ******If*Analytical*Accounting*is*installed*and*customer*********                CGL031 233709
075140200610      ******position*profit*centre*is*blank,*set*the*profit*centre*to**                CGL031 233709
075150200610      ******SE*ICD*default*profit*centre.******************************                CGL031 233709
075160200610      *****************************************************************                CGL031 233709
075170200610     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 233709
075180200610     C********** PCCU      ANDEQ*BLANKS                                                CGL031 233709
075190200610     C**********           MOVE BVSEPC    PRFC                                         CGL031 233709
075200200610     C**********           ELSE                                                        CGL031 233709
075210200610     C**********           MOVE PCCU      PRFC                                         CGL031 233709
075220200610     C**********           ENDIF                                                       CGL031 233709
075230200610      *****************************************************************                CGL031 233709
075240200610      ***Set*Up*Portfolio*Reference*to*be*Output***********************                CGL031 233709
075250200610      *****************************************************************                CGL031 233709
075260200610     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
075270200610     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
075280200610     C**********           MOVE PTFR      SSPTFR  4                                    CGL031 233709
075290200610     C********** WPORTP    IFNE 'Y'                                                    CGL031 233709
075300200610     C**********           MOVE *BLANKS   PTFR                                         CGL031 233709
075310200610     C**********           ENDIF                                                       CGL031 233709
075320200610     C**********           ENDIF                                                       CGL031 233709
075330200610      *****************************************************************                CGL031 233709
075340200610      ***Write*Generated*Account*Key*Record****************************                CGL031 233709
075350200610      *****************************************************************                CGL031 233709
075360200610     C**********           WRITESEKEYDF                                                CGL031 233709
075370200610     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
075380200610     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
075390200610     C**********           MOVE SSPTFR    PTFR                                         CGL031 233709
075400200610     C**********           ENDIF                                                       CGL031 233709
075410200610      *****************************************************************                CGL031 233709
075420200610     C********** ENDW04    ENDSR                                                       CGL031 233709
075430200610      *****************************************************************                       CGL031
075440200610      /EJECT                                                                                  CGL031
075450200610      *****************************************************************                       CGL031
075460200610      *                                                               *                       CGL031
075470200610      *  CHKTAX - Subroutine to check if record is existing in        *                       CGL031
075480200610      *           SDCTTXPD for taxing.                                *                       CGL031
075490200610      *                                                               *                       CGL031
075500200610      *****************************************************************                       CGL031
075510200610      *                                                                                       CGL031
075520200610     C           CHKTAX    BEGSR                                                              CGL031
075530200610      *                                                                                       CGL031
075540200610      ** Retrieve Branch Location Code                                                        CGL031
075550200610      *                                                                                       CGL031
075560200610     C**********           CALL 'AOBRCHR0'                                             CGL031 CGL035
075570200610     C                     CALL 'AOBRCHR1'                                                    CGL035
075580200610     C                     PARM *BLANKS   P@RTCD                                              CGL031
075590200610     C                     PARM '*KEY   ' P@OPTN                                              CGL031
075600200610     C                     PARM YCSBA     P@BRCD  3                                           CGL031
075610200610     C********** SDBRCH    PARM SDBRCH    DSFDY                                        CGL031 CGL035
075620200610     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL035
075630200610      *                                                                                       CGL031
075640200610      ** Database Error                                                                       CGL031
075650200610      *                                                                                       CGL031
075660200610     C           P@RTCD    IFNE *BLANKS                                                       CGL031
075670200610     C           *LOCK     IN   LDA                                                           CGL031
075680200610     C                     MOVEL'SDBRCHL1'DBFILE                                              CGL031
075690200610     C                     MOVELYCSBA     DBKEY                                               CGL031
075700200610     C                     Z-ADD53        DBASE                                               CGL031
075710200610     C                     MOVE *ON       *INU7                                               CGL031
075720200610     C                     MOVE *ON       *INU8                                               CGL031
075730200610     C                     EXSR *PSSR                                                         CGL031
075740200610     C                     GOTO EAUDIT                                                        CGL031
075750200610     C                     ELSE                                                               CGL031
075760200610     C                     MOVELA8LCCD    P@LCCD  3                                           CGL031
075770200610      *                                                                                       CGL031
075780200610      ** Retrieve Country of Tax                                                              CGL031
075790200610      *                                                                                       CGL031
075800200610     C                     CALL 'AOLOCNR0'                                                    CGL031
075810200610     C                     PARM *BLANKS   P@RTCD                                              CGL031
075820200610     C                     PARM '*KEY   ' P@OPTN                                              CGL031
075830200610     C                     PARM           P@LCCD                                              CGL031
075840200610     C           SDLOCN    PARM SDLOCN    DSFDY                                               CGL031
075850200610      *                                                                                       CGL031
075860200610      ** Database Error                                                                       CGL031
075870200610      *                                                                                       CGL031
075880200610     C           P@RTCD    IFNE *BLANKS                                                       CGL031
075890200610     C           *LOCK     IN   LDA                                                           CGL031
075900200610     C                     MOVEL'SDLOCNL1'DBFILE                                              CGL031
075910200610     C                     MOVELA8LCCD    DBKEY                                               CGL031
075920200610     C                     Z-ADD54        DBASE                                               CGL031
075930200610     C                     MOVE *ON       *INU7                                               CGL031
075940200610     C                     MOVE *ON       *INU8                                               CGL031
075950200610     C                     EXSR *PSSR                                                         CGL031
075960200610     C                     GOTO EAUDIT                                                        CGL031
075970200610     C                     ELSE                                                               CGL031
075980200610     C                     MOVE DVCNCD    WCTAX   2                                           CGL031
075990200610     C                     ENDIF                                                              CGL031
076000200610     C                     ENDIF                                                              CGL031
076010200610      *                                                                                       CGL031
076020200610      ** Retrieve Country of Residence                                                        CGL031
076030200610      *                                                                                       CGL031
076040200610     C                     MOVELYCSCN     P@CSCN 10                                           CGL031
076050200610      *                                                                                       CGL031
076060200610     C**********           CALL 'AOCUSTR0'                                             CGL031 233792
076070200610     C                     CALL 'AOCUSTR1'                                                    233792
076080200610     C                     PARM *BLANKS   P@RTCD                                              CGL031
076090200610     C                     PARM '*KEY   ' P@OPTN                                              CGL031
076100200610     C                     PARM           P@CSCN                                              CGL031
076110200610     C                     PARM *BLANKS   P@KYST  7                                           CGL031
076120200610     C********** SDCUST    PARM SDCUST    DSSDY                                        CGL031 233792
076130200610     C           SDCUST    PARM SDCUST    DSLDY                                               233792
076140200610      *                                                                                       233792
076150200610      ** Check if customer is closed or deleted                                               233792
076160200610      *                                                                                       233792
076170200610     C           BBDTDL    IFNE *ZEROS                                                        233792
076180200610     C           BBCLST    OREQ 'Y'                                                           233792
076190200610     C                     MOVE 'Y'       WNOTAX                                              233792
076200200610     C                     GOTO ENCHKT                                                        233792
076210200610     C                     ENDIF                                                              233792
076220200610      *                                                                                       CGL031
076230200610      ** Database Error                                                                       CGL031
076240200610      *                                                                                       CGL031
076250200610     C           P@RTCD    IFNE *BLANKS                                                       CGL031
076260200610     C           *LOCK     IN   LDA                                                           CGL031
076270200610     C                     MOVEL'SDCUSTL1'DBFILE                                              CGL031
076280200610     C                     MOVELYCSCN     DBKEY                                               CGL031
076290200610     C                     Z-ADD55        DBASE                                               CGL031
076300200610     C                     MOVE *ON       *INU7                                               CGL031
076310200610     C                     MOVE *ON       *INU8                                               CGL031
076320200610     C                     EXSR *PSSR                                                         CGL031
076330200610     C                     GOTO EAUDIT                                                        CGL031
076340200610     C                     ELSE                                                               CGL031
076350200610     C                     MOVE BBCOLC    WCOLC   2                                           CGL031
076360200610     C                     ENDIF                                                              CGL031
076370200610      *                                                                                       CGL031
076380200610      ** Retrieve Tax Basket                                                                  CGL031
076390200610      *                                                                                       CGL031
076400200610     C                     CALL 'AOCTTXR0'                                                    CGL031
076410200610     C                     PARM *BLANKS   P@RTCD                                              CGL031
076420200610     C                     PARM '*KEY   ' P@OPTN                                              CGL031
076430200610     C                     PARM WCTAX     P@CTRT  2                                           CGL031
076440200610     C                     PARM WCOLC     P@CTRR  2                                           CGL031
076450200610     C           SDCTTX    PARM SDCTTX    DSFDY                                               CGL031
076460200610      *                                                                                       CGL031
076470200610      ** If no record found, accessed with a country of tax and                               CGL031
076480200610      ** a blank country of residence.                                                        CGL031
076490200610      *                                                                                       CGL031
076500200610     C********** P@RTCD    IFEQ 'NRF    '                                              CGL031 234577
076510200610     C           P@RTCD    IFEQ '*NRF   '                                                     234577
076520200610     C                     CALL 'AOCTTXR0'                                                    CGL031
076530200610     C                     PARM *BLANKS   P@RTCD                                              CGL031
076540200610     C                     PARM '*KEY   ' P@OPTN                                              CGL031
076550200610     C                     PARM WCTAX     P@CTRT                                              CGL031
076560200610     C                     PARM *BLANKS   P@CTRR                                              CGL031
076570200610     C           SDCTTX    PARM SDCTTX    DSFDY                                               CGL031
076580200610     C                     ENDIF                                                              CGL031
076590200610      *                                                                                       CGL031
076600200610      ***Database*Error****************                                                CGL031 234440
076610200610      *                                                                                       CGL031
076620200610      * No tax should be calculated if effective date is in the future                        234440
076630200610      *                                                                                       234440
076640200610     C           P@RTCD    IFNE *BLANKS                                                       CGL031
076650200610     C           EWEDT1    ORGT SAED                                                          234440
076660200610     C                     MOVE 'Y'       WNOTAX                                              234440
076670200610     C********** *LOCK     IN   LDA                                                    CGL031 234440
076680200610     C**********           MOVEL'SDCTTXL1'DBFILE                                       CGL031 234440
076690200610     C**********           MOVELWCTAX     DBKEY                                        CGL031 234440
076700200610     C**********           Z-ADD56        DBASE                                        CGL031 234440
076710200610     C**********           MOVE *ON       *INU7                                        CGL031 234440
076720200610     C**********           MOVE *ON       *INU8                                        CGL031 234440
076730200610     C**********           EXSR *PSSR                                                  CGL031 234440
076740200610     C**********           GOTO EAUDIT                                                 CGL031 234440
076750200610     C**********           ENDIF                                                       CGL031 234440
076760200610     C**********           ENDIF                                                       CGL031 234440
076770200610     C                     ELSE                                                               234440
076780200610      *                                                                                       CGL031
076790200610     C                     MOVE EWTXBS    WTAXBS  2                                           CGL031
076800200610      *                                                                                       CGL031
076810200610      ** Retrieve Tax Rate Applicable for Band                                                CGL031
076820200610      *                                                                                       CGL031
076830200610     C********** SAAT      IFEQ 'CP'                                                   233863 234440
076840200610     C                     Z-ADDSAED      P@DATE  50                                          233863
076850200610     C**********           ELSE                                                        233863 234440
076860200610     C**********           Z-ADDBJRDNB    P@DATE                                       233863 234440
076870200610     C**********           ENDIF                                                       233863 234440
076880200610      *                                                                                       233863
076890200610     C                     CALL 'AOTXBSR0'                                                    CGL031
076900200610     C                     PARM *BLANKS   P@RTCD                                              CGL031
076910200610     C                     PARM '*KEY   ' P@OPTN                                              CGL031
076920200610     C                     PARM WCTAX     P@CTTT  2                                           CGL031
076930200610     C                     PARM WTAXBS    P@TXBS  2                                           CGL031
076940200610     C***********          PARM BJRDNB    P@DATE  50                                   CGL031 233863
076950200610     C                     PARM           P@DATE                                              233863
076960200610     C                     PARM           P@NARR 15                                           CGL031
076970200610     C                     PARM           P@RATE  64                                          CGL031
076980200610      *                                                                                       CGL031
076990200610     C           P@RTCD    IFEQ *BLANKS                                                       CGL031
077000200610     C                     MOVE ' '       WNOTAX  1                                           CGL031
077010200610     C                     Z-ADDP@RATE    WTRAB   64                                          CGL031
077020200610     C                     ELSE                                                               CGL031
077030200610      *                                                                                       CGL031
077040200610      ** If no record found, no tax is calculated.                                            CGL031
077050200610      *                                                                                       CGL031
077060200610     C                     MOVE 'Y'       WNOTAX                                              CGL031
077070200610     C                     ENDIF                                                              CGL031
077080200610     C                     ENDIF                                                              234440
077090200610      *                                                                                       CGL031
077100200610     C**********           ENDSR                                                       CGL031 233792
077110200610     C           ENCHKT    ENDSR                                                              233792
077120200610      *****************************************************************                       CGL031
077130200610      /EJECT                                                                                  CGL031
077140200610      *****************************************************************                       CGL031
077150200610      *                                                               *                       CGL031
077160200610      *  CPNTAX - Subroutine to calculate tax for descretionary and   *                       CGL031
077170200610      *           safe custody customers.                             *                       CGL031
077180200610      *                                                               *                       CGL031
077190200610      *****************************************************************                       CGL031
077200200610      *                                                                                       CGL031
077210200610     C           CPNTAX    BEGSR                                                              CGL031
077220200610      *                                                                                       CGL031
077230200610      ** Check if record needs to be taxed.                                                   CGL031
077240200610      *                                                                                       CGL031
077250200610     C                     EXSR CHKTAX                                                        CGL031
077260200610      *                                                                                       CGL031
077270200610      ** Accrued Coupon must be calculated from the last coupon date upto                     CGL031
077280200610      ** event control date unless the last coupon date is before the effective               CGL031
077290200610      ** date from SDCTTXL1 and the transition type from SDCTTXL1 is equal to 1,              CGL031
077300200610      ** in which case the accrued coupon is calculated from the effective date               CGL031
077310200610      ** to the event control date.                                                           CGL031
077320200610      *                                                                                       CGL031
077330200610      ***Set*ZFMDAT*to*the*greater*value*between*SALCCP*and*Effective*Date             CGL031 234440
077340200610      *                                                                                       CGL031
077350200610     C           WNOTAX    IFEQ ' '                                                           CGL031
077360200610      *                                                                                       CGL031
077370200610     C**********           Z-ADDSALCCP    WFRDAT                                       CGL031 234440
077380200610     C                     Z-ADDSALCCP    WFRDAT  50                                          234440
077390200610     C********** EWTRT1    IFEQ '1'                                                    CGL031 234440
077400200610     C********** EWEDT1    ANDGTSALCCP                                                 CGL031 234440
077410200610     C**********           Z-ADDEWEDT1    WFRDAT  50                                   CGL031 234440
077420200610     C**********           ENDIF                                                       CGL031 234440
077430200610      *                                                                                       CGL031
077440200610      *                                                                                       CGL031
077450200610      ** Calculate Interest due via P/ZACCRC for Security                                     CGL031
077460200610      ** From Date is Last Coupon / To Date is Event Date.                                    CGL031
077470200610      ** Get Nominal CCY Dec Places from TABTG10 FIRST (CDP)                                  CGL031
077480200610      *                                                                                       CGL031
077490200610     C                     MOVE NMCY      WCURR                                               CGL031
077500200610     C                     EXSR TG10                                                          CGL031
077510200610      *                                                                                       CGL031
077520200610      ** Save_No_of_Decimal_Places.                                                           CGL031
077530200610      *                                                                                       CGL031
077540200610     C           BGPFMG    IFEQ 'Y'                                                           CGL031
077550200610     C           BGN4ST    OREQ 'Y'                                                           CGL031
077560200610     C                     Z-ADDCDP       WWCDP                                               CGL031
077570200610     C                     ENDIF                                                              CGL031
077580200610      *                                                                                       CGL031
077590200610      ** When Parm ZAB is 'A' , Interest is Calculated After Changes                          CGL031
077600200610      *                                                                                       CGL031
077610200610     C********** SAED      SUB  1         WDATE   50                                   234440 234552
077620200610     C                     Z-ADDSAED      WDATE   50                                          234552
077630200610      *                                                                                       CGL031
077640200610      ** If Settlements Based on Portfolio Positions use Standard PM                          CGL031
077650200610      ** Subroutines to Calculate Accrual Amount                                              CGL031
077660200610     C           WPORTP    IFEQ 'Y'                                                           CGL031
077670200610     C           BGPFMG    ANDEQ'Y'                                                           CGL031
077680200610     C           WPORTP    OREQ 'Y'                                                           CGL031
077690200610     C           BGN4ST    ANDEQ'Y'                                                           CGL031
077700200610      *                                                                                       CGL031
077710200610      ** If the Processing Type from LF/INVTP is not Equal to 6 IE.                           CGL031
077720200610      ** This is not a SCHULDSCHEIN Security                                                  CGL031
077730200610      *                                                                                       CGL031
077740200610     C           PROT      IFNE '6'                                                           CGL031
077750200610     C                     Z-ADDWCUMCP    ZAMTP                                               CGL031
077760200610     C                     Z-ADDWFRDAT    ZFMDAT                                              CGL031
077770200610     C                     Z-ADDSAED      ZTODAT                                              CGL031
077780200610     C                     Z-ADDSAED      NCD                                                 CGL031
077790200610     C                     MOVELCDSN      ZSSNM                                               CGL031
077800200610     C                     Z-ADDWWCDP     A6NBDP                                              CGL031
077810200610      *                                                                                       CGL031
077820200610      ** Calculate the Accrued Interest from the Last Coupon Date to                          CGL031
077830200610      ** the Event Control Date as per Standard Subroutine ZAINSH                             CGL031
077840200610      *                                                                                       CGL031
077850200610     C                     EXSR ZAINSH                                                        CGL031
077860200610     C                     ENDIF                                                              CGL031
077870200610      *                                                                                       CGL031
077880200610      ** If the Processing Type from LF/INVTP is Equal to 6 IE.                               CGL031
077890200610      ** This is a SCHULDSCHEIN Security                                                      CGL031
077900200610      *                                                                                       CGL031
077910200610     C           PROT      IFEQ '6'                                                           CGL031
077920200610     C                     Z-ADDWFRDAT    ZFMDAT                                              CGL031
077930200610     C                     Z-ADDSAED      ZTODAT                                              CGL031
077940200610     C                     Z-ADDSAED      NCD                                                 CGL031
077950200610     C                     MOVE CDPA      ZCDPA                                               CGL031
077960200610     C**********           Z-ADDCDCN      XCUST   60                                   CGL031 CSD027
077970200610     C                     MOVE CDCN      XCUST   6                                           CSD027
077980200610     C                     MOVELPTFR      ZPTRF                                               CGL031
077990200610     C                     MOVELCDSN      ZSSNM                                               CGL031
078000200610     C**********           Z-ADDCDPT      ZCDDP                                        CGL031 CSD027
078010200610     C                     MOVELCDPT      ZCDDP                                               CSD027
078020200610     C                     MOVELCDMK      ZCDMK                                               CGL031
078030200610     C                     Z-ADDWWCDP     A6NBDP                                              CGL031
078040200610      *                                                                                       CGL031
078050200610      ** Calculate the Accrued Interest from the Last Coupon Date                             CGL031
078060200610      ** to the Event Control Date as per Standard Subroutine ZAISCH                          CGL031
078070200610      *                                                                                       CGL031
078080200610     C                     EXSR ZAISCH                                                        CGL031
078090200610     C                     ENDIF                                                              CGL031
078100200610      *                                                                                       CGL031
078110200610     C                     Z-ADDZTOAI     ZINTDU                                              CGL031
078120200610      *                                                                                       234440
078130200610      ** Get Purchased interest on position by accessing ETCPOSND                             234440
078140200610      *                                                                                       234440
078150200610     C**********           Z-ADDCDCN      CDCNZN                                       236816 CSD027
078160200610     C                     MOVELCDCN      CDCNZN                                              CSD027
078170200610     C                     CALL WPGM                                                          234440
078180200610     C                     PARM           WRTCD  10                                           234440
078190200610     C                     PARM           CDPA                                                234440
078200200610     C*********************PARM           CDCN                                         234440 236816
078210200610     C                     PARM           CDCNZN                                              236816
078220200610     C                     PARM           CDSN                                                234440
078230200610     C                     PARM           PTFR                                                234440
078240200610     C                     PARM           CDMK                                                234440
078250200610     C                     PARM           WDATE                                               234440
078260200610     C                     PARM           ETCPOS                                              234440
078270200610      *                                                                                       CGL031
078280200610      ** When Parm ZAB is 'A' , Interest is Calculated After Changes                          CGL031
078290200610      *                                                                                       CGL031
078300200610     C                     ELSE                                                               CGL031
078310200610     C                     MOVE 'A'       ZAB                                                 CGL031
078320200610     C                     CALL 'ZACCRC'                                                      CGL031
078330200610     C                     PARM           WFRDAT                                              CGL031
078340200610     C                     PARM           SAED                                                CGL031
078350200610     C                     PARM           CSBA                                                CGL031
078360200610     C                     PARM           ZCUST                                               CGL031
078370200610     C                     PARM           CSSC                                                CGL031
078380200610     C                     PARM           CDP                                                 CGL031
078390200610     C                     PARM           ZINTDU                                              CGL031
078400200610     C                     PARM           ZAB                                                 CGL031
078410200610      **********                                                                AR1001183 AR1001183A
078420200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
078430200610     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
078440200610     C********** FRATE     IFLE 0                                               AR1001183 AR1001183A
078450200610      ***The*following*fields*set*PAMD*to*any*value(ie zero)                    AR1001183 AR1001183A
078460200610     C**********           Z-ADD0         ZINTDU                                AR1001183 AR1001183A
078470200610     C**********           ENDIF                                                AR1001183 AR1001183A
078480200610     C**********           ENDIF                                                AR1001183 AR1001183A
078490200610      *                                                                                       CGL031
078500200610      **  U7 and U8 off if no Database Error during ZACCR Processing                          CGL031
078510200610      **  but DBPGM nedds to reset                                                            CGL031
078520200610      *                                                                                       CGL031
078530200610     C           *INU7     IFEQ '0'                                                           CGL031
078540200610     C           *INU8     ANDEQ'0'                                                           CGL031
078550200610     C           *LOCK     IN   LDA                                                           CGL031
078560200610     C                     MOVE *BLANKS   DBPGM                                               CGL031
078570200610     C                     MOVEL'SE2400'  DBPGM                                               CGL031
078580200610     C                     OUT  LDA                                                           CGL031
078590200610     C                     ENDIF                                                              CGL031
078600200610      *                                                                                       234440
078610200610      ** Get Purchased interest on position by accessing ETCPOSND                             234440
078620200610      *                                                                                       234440
078630200610     C                     CALL WPGM                                                          234440
078640200610     C                     PARM           WRTCD  10                                           234440
078650200610     C                     PARM           CSBA                                                234440
078660200610     C**********           PARM           CSSC                                         234440 236815
078670200610     C                     PARM           CSCN                                                234440
078680200610     C                     PARM           CSSC                                                236815
078690200610     C                     PARM *BLANKS   WPTFR   4                                           234440
078700200610     C                     PARM 'S'       WMKT    1                                           234440
078710200610     C                     PARM           WDATE                                               234440
078720200610     C                     PARM           ETCPOS                                              234440
078730200610     C                     ENDIF                                                              CGL031
078740200610      *                                                                                       234440
078750200610      ** If Purchased interest is from a date prior to last coupon date                       234440
078760200610      *  then zero-ize it.                                                                    234440
078770200610      *                                                                                       234440
078780200610     C           CSDA      IFLT SALCCP                                                        234440
078790200610     C                     Z-ADD0         CSPI                                                234440
078800200610     C                     ENDIF                                                              234440
078810200610      *                                                                                       234440
078820200610      ** Calculate pro rate of purchased interest in case nominal on                          236480
078830200610      ** ETCPOSND (CSNV) not equal nominal of coupon (PNMP)                                   236480
078840200610     C           PNMP      IFNE CSNV                                                          236480
078850200610     C           CSNV      IFNE 0                                                             236480
078860200610     C           PNMP      DIV  CSNV      WORK   249H                                         236480
078870200610     C           CSPI      MULT WORK      CSPI      H                                         236480
078880200610     C                     ELSE                                                               236480
078890200610     C                     Z-ADD0         CSPI                                                236480
078900200610     C                     ENDIF                                                              236480
078910200610     C                     ENDIF                                                              236480
078920200610      *                                                                                       236480
078930200610      ** Taxable amount is amount due minus purchased interest                                234440
078940200610      *                                                                                       234440
078950200610     C           ZINTDU    SUB  CSPI      ZINTDU                                              234440
078960200610      *                                                                                       236137
078970200610      ** If Amortized premium has to be deducted from taxable amount,                         236137
078980200610      ** it must be calculated as follows:                                                    236137
078990200610      *                                                                                       236137
079000200610     C           EWPADD    IFEQ 'Y'                        Begin Premium to Deduct            236137
079010200610     C           ISSP      ANDGT100                                                           236137
079020200610      *                                                                                       236137
079030200610      ** Calculate the amortized premium amount from last position to                         236137
079040200610      ** maturity date of Security.                                                           236137
079050200610      *                                                                                       236137
079060200610     C           LAVP      SUB  100       WWPAMT 308                                          236137
079070200610     C                     MULT CSNV      WWPAMT                                              236137
079080200610     C           MATY      SUB  CSDA      WWDAYS                                              236137
079090200610     C                     DIV  WWDAYS    WWPAMT                                              236137
079100200610      *                                                                                       236137
079110200610      ** Final calculation must take in account taxable period between                        236137
079120200610      ** latter from the last coupon date and the taxation effective date,                    236137
079130200610      ** and the event control date.                                                          236137
079140200610      *                                                                                       236137
079150200610     C           SALCCP    IFGT EWEDT1                                                        236137
079160200610     C           SAED      SUB  SALCCP    WWDAYS                                              236137
079170200610      *                                                                                       236137
079180200610     C                     ELSE                                                               236137
079190200610     C           SAED      SUB  EWEDT1    WWDAYS                                              236137
079200200610      *                                                                                       236137
079210200610     C                     ENDIF                                                              236137
079220200610     C                     MULT WWDAYS    WWPAMT                                              236137
079230200610      *                                                                                       236137
079240200610      ** If amortized premium amount is less than 0, set it to 0.                             236137
079250200610      *                                                                                       236137
079260200610     C           WWPAMT    IFLT 0                                                             236137
079270200610     C                     Z-ADD0         WWPAMT                                              236137
079280200610      *                                                                                       236137
079290200610     C                     ENDIF                                                              236137
079300200610      *                                                                                       236137
079310200610      ** Taxable amount is amount due minus amortized premium amount.                         236137
079320200610      *                                                                                       236137
079330200610     C                     SUB  WWPAMT    ZINTDU                                              236137
079340200610     C           ZINTDU    IFLT 0                                                             236137
079350200610     C                     Z-ADD0         ZINTDU                                              236137
079360200610      *                                                                                       236137
079370200610     C                     ENDIF                                                              236137
079380200610      *                                                                                       236137
079390200610     C                     ENDIF                           End Premium to Deduct              236137
079400200610      *                                                                                       CGL031
079410200610      ** If S01509 is active, and value currency is different from                            CGL031
079420200610      ** nominal currency, convert coupon amount to value currency                            CGL031
079430200610      *                                                                                       CGL031
079440200610     C           S01509    IFEQ 'Y'                                                           CGL031
079450200610     C           NMCY      ANDNEVLCY                                                          CGL031
079460200610     C                     MOVE NMCY      WCURR                                               CGL031
079470200610     C                     EXSR TG10                                                          CGL031
079480200610     C                     Z-ADDZCDP      ZCDPI                                               CGL031
079490200610     C                     MOVE VLCY      WCURR                                               CGL031
079500200610     C                     EXSR TG10                                                          CGL031
079510200610     C                     Z-ADDZCDP      ZCDPO                                               CGL031
079520200610     C                     MOVE NMCY      ZCCYI                                               CGL031
079530200610     C                     MOVE VLCY      ZCCYO                                               CGL031
079540200610     C                     Z-ADDZINTDU    ZAMTCI                                              CGL031
079550200610      *                                                                                       CGL031
079560200610      ** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event                       CGL031
079570200610      ** found, else from SECTYD                                                              CGL031
079580200610      *                                                                                       CGL031
079590200610     C                     MOVE SAAT      WSAAT                                               CGL031
079600200610     C                     MOVE 'XR'      SAAT                                                CGL031
079610200610     C           SEDKEY    SETLLSEDEVDO                                                       CGL031
079620200610     C                     READ SEDEVDO                  81                                   CGL031
079630200610     C           *IN81     IFEQ '0'                                                           CGL031
079640200610     C           SDSN      ANDEQSASN                                                          CGL031
079650200610     C           SDET      ANDEQ'XR'                                                          CGL031
079660200610     C                     Z-ADDSDCE      ZEXCH                                               CGL031
079670200610     C                     MOVE SDMD      ZMD                                                 CGL031
079680200610     C                     ELSE                                                               CGL031
079690200610     C                     Z-ADDSEXR      ZEXCH                                               CGL031
079700200610     C                     MOVE SMDI      ZMD                                                 CGL031
079710200610     C                     ENDIF                                                              CGL031
079720200610     C                     MOVE WSAAT     SAAT                                                CGL031
079730200610     C                     EXSR ZCONV                                                         CGL031
079740200610     C                     Z-ADDZAMTCO    ZINTDU                                              CGL031
079750200610     C                     ENDIF                                                              CGL031
079760200610      *                                                                                       CGL031
079770200610      ** If no record found, no tax is calculated                                             CGL031
079780200610      *                                                                                       CGL031
079790200610      ** Calculate Tax Amount for the Coupon and Output Information on SDCSINPD               CGL031
079800200610      *                                                                                       CGL031
079810200610     C           WNOTAX    IFEQ ' '                                                           CGL031
079820200610     C                     EXSR CPTXCL                                                        CGL031
079830200610      *                                                                                       CGL031
079840200610      ***Output*Tax*Account*Keys***************************************                CGL031 233709
079850200610      ***********                                                                      CGL031 233709
079860200610     C***********          EXSR W04                                                    CGL031 233709
079870200610     C                     ENDIF                                                              CGL031
079880200610     C                     ENDIF                                                              234440
079890200610      *                                                                                       CGL031
079900200610     C                     ENDSR                                                              CGL031
079910200610      *****************************************************************                       CGL031
079920200610      /EJECT                                                                                  CGL031
079930200610      *****************************************************************                       CGL031
079940200610      *                                                               *                       CGL031
079950200610      *  CPTXCL - Subroutine to calculate tax amount for the Coupon   *                       CGL031
079960200610      *           and to Output Information on SDCSINPD               *                       CGL031
079970200610      *                                                               *                       CGL031
079980200610      *****************************************************************                       CGL031
079990200610      *                                                                                       CGL031
080000200610     C           CPTXCL    BEGSR                                                              CGL031
080010200610      *                                                                                       CGL031
080020200610      ** Initialise work variables                                                            CGL031
080030200610      *                                                                                       CGL031
080040200610     C**********           Z-ADD0         WTTXSR 150                                   CGL031 233709
080050200610     C**********           Z-ADD0         WTTXSS 150                                   CGL031 233709
080060200610     C**********           Z-ADD0         WTTXSC 150                                   CGL031 233709
080070200610     C**********           Z-ADD0         WTTXSB 150                                   CGL031 233709
080080200610     C**********           Z-ADD0         WTNINT 150                                   CGL031 233709
080090200610     C**********           Z-ADD0         WTNINS 150                                   CGL031 233709
080100200610     C**********           Z-ADD0         WTNINC 150                                   CGL031 233709
080110200610     C**********           Z-ADD0         WTNINB 150                                   CGL031 233709
080120200610     C                     Z-ADD0         TXNM                                                233709
080130200610     C                     Z-ADD0         TXST                                                233709
080140200610     C                     Z-ADD0         TAXA                                                233709
080150200610     C                     MOVE *BLANKS   TXCY                                                233709
080160200610     C                     MOVE ' '       WTXPI   1                                           CGL031
080170200610     C                     MOVE ' '       WTXJA   1                                           CGL031
080180200610      *                                                                                       CGL031
080190200610     C                     MOVE YCSCN     @@CUST                                              CGL031
080200200610      *                                                                                       CGL031
080210200610     C                     CALL 'ZATXCLPI'                                                    CGL031
080220200610      ** Input                                                                                CGL031
080230200610     C                     PARM 'S'       @@MODI  1                                           CGL031
080240200610     C**********           PARM SASN      @@TRRF 18                                    CGL031 CGL035
080250200610     C                     PARM SASN      @@TRRF 24                                           CGL035
080260200610     C                     PARM YCSBA     @@BRCA  3                                           CGL031
080270200610     C                     PARM           @@CUST  6                                           CGL031
080280200610     C                     PARM *ZERO     @@STRD  50                                          CGL031
080290200610     C                     PARM *ZERO     @@ENDD  50                                          CGL031
080300200610     C                     PARM ZINTDU    @@TOTI 150                                          CGL031
080310200610     C                     PARM WTRAB     @@TAXR  64                                          CGL031
080320200610     C**********           PARM EVCY      @@OCCY  3                                    CGL031 233568
080330200610     C                     PARM NMCY      @@OCCY  3                                           233568
080340200610     C                     PARM *BLANKS   PINTH                                               CER048
080350200610      ** Output                                                                               CGL031
080360200610     C                     PARM           @@IAED 150                                          CGL031
080370200610     C                     PARM           @@TAXA 150                                          CGL031
080380200610     C                     PARM           @@TOTO 150                                          CGL031
080390200610     C                     PARM           @@TXCY  3                                           CGL031
080400200610     C                     PARM           @@CTAX  2                                           CGL031
080410200610     C                     PARM           @@TXBS  2                                           CGL031
080420200610     C**********           PARM           @@WTAC  40                                   CGL031 CGL035
080430200610     C                     PARM           @@WTAC 100                                          CGL035
080440200610     C                     PARM           @@COLC  2                                           CGL031
080450200610     C                     PARM           @@STAT  5                                           CGL031
080460200610     C                     PARM           @@TRTE  1                                           CGL031
080470200610     C                     PARM           @@TXR1  64                                          CGL031
080480200610     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
080490200610     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
080500200610     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
080510200610     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
080520200610     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
080530200610     C                     PARM           @@KEY  10                                           CGL031
080540200610     C                     PARM           @@FILE 10                                           CGL031
080550200610     C                     PARM           @@RTRN  7                                           CGL031
080560200610     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
080570200610      *                                                                                       CGL031
080580200610     C                     SELEC                                                              CGL031
080590200610      *                                                                                       CGL031
080600200610      ** If return code = Error.                                                              CGL031
080610200610      *                                                                                       CGL031
080620200610     C           @@RTRN    WHEQ 'ERROR'                                                       CGL031
080630200610     C                     MOVE @@FILE    DBFILE                                              CGL031
080640200610     C                     MOVE @@KEY     DBKEY                                               CGL031
080650200610     C                     Z-ADD57        DBASE                                               CGL031
080660200610     C                     MOVE *ON       *INU7                                               CGL031
080670200610     C                     MOVE *ON       *INU8                                               CGL031
080680200610     C                     EXSR *PSSR                                                         CGL031
080690200610     C                     GOTO EAUDIT                                                        CGL031
080700200610      *                                                                                       CGL031
080710200610      ** If return code = Private Individual                                                  CGL031
080720200610      *                                                                                       CGL031
080730200610     C           @@RTRN    WHNE 'JOINT'                                                       CGL031
080740200610      *                                                                                       CGL031
080750200610     C           @@TOTO    IFNE *ZERO                                                         CGL031
080760200610     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
080770200610     C           @@STAT    OREQ 'DISCL'                                                       CGL031
080780200610     C           @@STAT    OREQ 'SELF'                                                        CGL031
080790200610      *                                                                                       CGL031
080800200610     C                     MOVE 'Y'       WTXPI                                               CGL031
080810200610     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
080820200610     C                     MOVE S1CTTA    KCSIS                                               236815
080830200610     C                     MOVE @@CTAX    KCTRT                                               CGL031
080840200610      *                                                                                       CGL031
080850200610     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
080860200610     C           *IN61     IFEQ *OFF                                                          CGL031
080870200610      *                                                                                       CGL031
080880200610     C                     SELEC                                                              CGL031
080890200610     C           TCTXCM    WHEQ 1                                                             CGL031
080900200610     C********** *IN80     OREQ *ON                                                    CGL031 236815
080910200610     C           SWHTFD    OREQ 'N'                                                           236815
080920200610     C********** S1RASO    OREQ 0                                                      CGL031 234813
080930200610     C           UTXRSR    OREQ 0                                                             234813
080940200610     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
080950200610      *                                                                                       CGL031
080960200610     C           TCTXCM    WHEQ 2                                                             CGL031
080970200610     C********** URATE     MULT @@TOTI    WTAXA  150                                   CGL031 236696
080980200610     C********** @@TOTI    SUB  WTAXA     @@TAXA                                       CGL031 236696
080990200610     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
081000200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
081010200610     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
081020200610     C                     DIV  100       WTAXA                                               236815
081030200610     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236696
081040200610     C                     MULT @@TAXR    @@TAXA                                              CGL031
081050200610     C                     DIV  100       @@TAXA    H                                         CGL031
081060200610     C           @@TAXA    IFLT 0                                                             CGL031
081070200610     C                     Z-ADD0         @@TAXA                                              CGL031
081080200610     C                     ENDIF                                                              CGL031
081090200610      *                                                                                       CGL031
081100200610     C           TCTXCM    WHEQ 3                                                             CGL031
081110200610     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
081120200610     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
081130200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
081140200610     C                     DIV  100       WTAXA                                               236815
081150200610     C                     SUB  WTAXA     @@TAXA                                              CGL031
081160200610     C           @@TAXA    IFLT 0                                                             CGL031
081170200610     C                     Z-ADD0         @@TAXA                                              CGL031
081180200610     C                     ENDIF                                                              CGL031
081190200610      *                                                                                       CGL031
081200200610     C           TCTXCM    WHEQ 4                                                             CGL031
081210200610     C                     Z-ADD0         @@TAXA                                              CGL031
081220200610     C                     ENDSL                                                              CGL031
081230200610      *                                                                                       CGL031
081240200610     C                     ENDIF                                                              CGL031
081250200610      *                                                                                       CGL031
081260200610      ** Write record to SDCSINPD                                                             CGL031
081270200610      *                                                                                       CGL031
081280200610     C                     EXSR CSINSR                                                        CGL031
081290200610      *                                                                                       CGL031
081300200610     C                     ENDIF                                                              CGL031
081310200610     C                     ENDIF                                                              CGL031
081320200610      *                                                                                       CGL031
081330200610      ** If return code = Joint Account                                                       CGL031
081340200610      *                                                                                       CGL031
081350200610     C           @@RTRN    WHEQ 'JOINT'                                                       CGL031
081360200610     C                     MOVE YCSCN     KJANO                                               CGL031
081370200610      *                                                                                       CGL031
081380200610     C           KJANO     SETLLSDJACCLB                                                      CGL031
081390200610     C           KJANO     READESDJACCLB                 60                                   CGL031
081400200610      *                                                                                       CGL031
081410200610     C           *IN60     DOWEQ*OFF                                                          CGL031
081420200610      *                                                                                       CGL031
081430200610     C                     CALL 'ZATXCLJA'                                                    CGL031
081440200610      ** Input                                                                                CGL031
081450200610     C                     PARM 'S'       @@MODI                                              CGL031
081460200610     C                     PARM SASN      @@TRRF                                              CGL031
081470200610     C                     PARM YCSBA     @@BRCA                                              CGL031
081480200610     C                     PARM JCJANO    @@JANO  6                                           CGL031
081490200610     C                     PARM JCCUST    @@CUST                                              CGL031
081500200610     C                     PARM JCNAHO    @@NARF 10                                           CGL031
081510200610     C                     PARM JCINVP    @@INVP 10                                           CGL031
081520200610     C                     PARM *ZERO     @@STRD                                              CGL031
081530200610     C                     PARM *ZERO     @@ENDD                                              CGL031
081540200610     C                     PARM ZINTDU    @@TOTI                                              CGL031
081550200610     C                     PARM WTRAB     @@TAXR                                              CGL031
081560200610     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
081570200610     C                     PARM NMCY      @@OCCY                                              233568
081580200610     C                     PARM *BLANKS   PINTH                                               CER048
081590200610      ** Output                                                                               CGL031
081600200610     C                     PARM           @@IAED                                              CGL031
081610200610     C                     PARM           @@TAXA                                              CGL031
081620200610     C                     PARM           @@TOTO                                              CGL031
081630200610     C                     PARM           @@TXCY                                              CGL031
081640200610     C                     PARM           @@CTAX                                              CGL031
081650200610     C                     PARM           @@TXBS                                              CGL031
081660200610     C                     PARM           @@WTAC                                              CGL031
081670200610     C                     PARM           @@COLC                                              CGL031
081680200610     C                     PARM           @@STAT                                              CGL031
081690200610     C                     PARM           @@TRTE                                              CGL031
081700200610     C                     PARM           @@TXR1                                              CGL031
081710200610     C                     PARM           @@JAMG                                              CGL031
081720200610     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
081730200610     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
081740200610     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
081750200610     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
081760200610     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
081770200610     C                     PARM           @@KEY                                               CGL031
081780200610     C                     PARM           @@FILE                                              CGL031
081790200610     C                     PARM           @@RTRN                                              CGL031
081800200610     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
081810200610      *                                                                                       CGL031
081820200610      ** If return code = Error.                                                              CGL031
081830200610      *                                                                                       CGL031
081840200610     C           @@RTRN    IFEQ 'ERROR'                                                       CGL031
081850200610     C                     MOVE @@FILE    DBFILE                                              CGL031
081860200610     C                     MOVE @@KEY     DBKEY                                               CGL031
081870200610     C                     Z-ADD58        DBASE                                               CGL031
081880200610     C                     MOVE *ON       *INU7                                               CGL031
081890200610     C                     MOVE *ON       *INU8                                               CGL031
081900200610     C                     EXSR *PSSR                                                         CGL031
081910200610     C                     GOTO EAUDIT                                                        CGL031
081920200610     C                     ENDIF                                                              CGL031
081930200610      *                                                                                       CGL031
081940200610     C           @@TOTO    IFNE *ZERO                                                         CGL031
081950200610     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
081960200610     C           @@STAT    OREQ 'DISCL'                                                       CGL031
081970200610     C           @@STAT    OREQ 'SELF '                                                       CGL031
081980200610      *                                                                                       CGL031
081990200610     C                     MOVE 'Y'       WTXJA                                               CGL031
082000200610     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
082010200610     C                     MOVE S1CTTA    KCSIS                                               236815
082020200610     C                     MOVE @@CTAX    KCTRT                                               CGL031
082030200610      *                                                                                       CGL031
082040200610     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
082050200610     C           *IN61     IFEQ *OFF                                                          CGL031
082060200610      *                                                                                       CGL031
082070200610     C                     SELEC                                                              CGL031
082080200610     C           TCTXCM    WHEQ 1                                                             CGL031
082090200610     C********** *IN80     OREQ *ON                                                    CGL031 236815
082100200610     C           SWHTFD    OREQ 'N'                                                           236815
082110200610     C********** S1RASO    OREQ 0                                                      CGL031 234813
082120200610     C           UTXRSR    OREQ 0                                                             234813
082130200610     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
082140200610      *                                                                                       CGL031
082150200610     C           TCTXCM    WHEQ 2                                                             CGL031
082160200610     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
082170200610     C********** @@TOTI    SUB  WTAXA     @@TAXA                                       CGL031 236696
082180200610     C********** URATE     MULT @@TOTO    WTAXA  150                                   236696 236815
082190200610     C********** S1RASO    MULT @@TOTO    WTAXA  150                                   236815 234813
082200200610     C           UTXRSR    MULT @@TOTO    WTAXA  150                                          234813
082210200610     C                     DIV  100       WTAXA                                               236815
082220200610     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236696
082230200610     C                     MULT @@TAXR    @@TAXA                                              CGL031
082240200610     C                     DIV  100       @@TAXA    H                                         CGL031
082250200610     C           @@TAXA    IFLT 0                                                             CGL031
082260200610     C                     Z-ADD0         @@TAXA                                              CGL031
082270200610     C                     ENDIF                                                              CGL031
082280200610      *                                                                                       CGL031
082290200610     C           TCTXCM    WHEQ 3                                                             CGL031
082300200610     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
082310200610     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
082320200610     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
082330200610     C                     DIV  100       WTAXA                                               236815
082340200610     C                     SUB  WTAXA     @@TAXA                                              CGL031
082350200610     C           @@TAXA    IFLT 0                                                             CGL031
082360200610     C                     Z-ADD0         @@TAXA                                              CGL031
082370200610     C                     ENDIF                                                              CGL031
082380200610      *                                                                                       CGL031
082390200610     C           TCTXCM    WHEQ 4                                                             CGL031
082400200610     C                     Z-ADD0         @@TAXA                                              CGL031
082410200610     C                     ENDSL                                                              CGL031
082420200610      *                                                                                       CGL031
082430200610     C                     ENDIF                                                              CGL031
082440200610      *                                                                                       CGL031
082450200610      ** Write record to SDCSINPD                                                             CGL031
082460200610      *                                                                                       CGL031
082470200610     C                     EXSR CSINSR                                                        CGL031
082480200610      *                                                                                       CGL031
082490200610     C                     ENDIF                                                              CGL031
082500200610     C                     ENDIF                                                              CGL031
082510200610      *                                                                                       CGL031
082520200610     C           @@RTRN    IFEQ 'NOTAX'                                                       CGL031
082530200610     C           @@RTRN    OREQ 'TAXAB'                                                       CGL031
082540200610     C           KJANO     READESDJACCLB                 60                                   CGL031
082550200610     C                     ENDIF                                                              CGL031
082560200610      *                                                                                       CGL031
082570200610      ** If @@RTRN = Last, end loop                                                           CGL031
082580200610      *                                                                                       CGL031
082590200610     C           @@RTRN    IFEQ 'LAST'                                                        CGL031
082600200610     C                     MOVE *ON       *IN60                                               CGL031
082610200610     C                     ENDIF                                                              CGL031
082620200610      *                                                                                       CGL031
082630200610     C                     ENDDO                                                              CGL031
082640200610      *                                                                                       CGL031
082650200610     C                     ENDSL                                                              CGL031
082660200610      *                                                                                       CGL031
082670200610     C           ENDCPT    ENDSR                                                              CGL031
082680200610      *****************************************************************                       CGL031
082690200610      /EJECT                                                                                  CGL031
082700200610      *****************************************************************                       CGL031
082710200610      *                                                               *                       CGL031
082720200610      ***CSINSR*-*Subroutine*to*Output*Information*on*PF/SDCSINPD******                CGL031 233709
082730200610      *  CSINSR - Subroutine to Calculate Tax Amounts for PF/POSETD   *                       233709
082740200610      *                                                               *                       CGL031
082750200610      *****************************************************************                       CGL031
082760200610      *                                                                                       CGL031
082770200610     C           CSINSR    BEGSR                                                              CGL031
082780200610      *                                                                                       CGL031
082790200610     C**********           Z-ADDBJRDNB    TSRDNB                                       CGL031 233709
082800200610     C**********           Z-ADDSAED      TSEDAT                                       CGL031 233709
082810200610      *****************************************************************                CGL031 233709
082820200610      ***Get*Tax*Year*from*Tax*Calculation*Date************************                CGL031 233709
082830200610      *****************************************************************                CGL031 233709
082840200610     C**********           Z-ADDTSEDAT    ZDAYNO                                       CGL031 233709
082850200610      *****************************************************************                CGL031 233709
082860200610     C**********           CALL 'ZDATE2'                                               CGL031 233709
082870200610     C**********           PARM           ZDAYNO  50                                   CGL031 233709
082880200610     C**********           PARM           BJDFIN                                       CGL031 233709
082890200610     C**********           PARM           ZDATE   60                                   CGL031 233709
082900200610     C**********           PARM           ZADATE  7                                    CGL031 233709
082910200610      *****************************************************************                CGL031 233709
082920200610     C**********           MOVE ZDATE     TSTAXY                                       CGL031 233709
082930200610     C**********           MOVEL'20'      TSTAXY                                       CGL031 233709
082940200610      *****************************************************************                CGL031 233709
082950200610     C********** BJDFIN    IFEQ 'D'                                                    CGL031 233709
082960200610     C**********           MOVELZDATE     WDATE1  4                                    CGL031 233709
082970200610     C**********           MOVE WDATE1    TSTAXM                                       CGL031 233709
082980200610     C**********           ELSE                                                        CGL031 233709
082990200610     C**********           MOVELZDATE     TSTAXM                                       CGL031 233709
083000200610     C**********           ENDIF                                                       CGL031 233709
083010200610      *****************************************************************                CGL031 233709
083020200610     C**********           MOVEL@@CTAX    TSCTRT                                       CGL031 233709
083030200610     C**********           MOVEL@@BRCA    TSBRCA                                       CGL031 233709
083040200610     C**********           MOVEL@@CUST    TSCUST                                       CGL031 233709
083050200610      *****************************************************************                CGL031 233709
083060200610     C********** WTXJA     IFEQ 'Y'                                                    CGL031 233709
083070200610     C**********           MOVEL@@JANO    TSJOIN                                       CGL031 233709
083080200610     C**********           MOVEL@@NARF    TSNAHO                                       CGL031 233709
083090200610     C**********           MOVEL@@INVP    TSINVP                                       CGL031 233709
083100200610     C**********           ELSE                                                        CGL031 233709
083110200610     C**********           Z-ADD*ZERO     TSJOIN                                       CGL031 233709
083120200610     C**********           MOVE *BLANKS   TSNAHO                                       CGL031 233709
083130200610     C**********           MOVE *BLANKS   TSINVP                                       CGL031 233709
083140200610     C**********           ENDIF                                                       CGL031 233709
083150200610      *                                                                                       CGL031
083160200610      ** Get Customer Status                                                                  CGL031
083170200610      *                                                                                       CGL031
083180200610     C                     SELEC                                                              CGL031
083190200610     C           @@STAT    WHEQ 'DISCL'                                                       CGL031
083200200610     C**********           MOVEL'D'       TSSTAT                                       CGL031 233709
083210200610     C                     MOVEL'D'       TSSTAT  1                                           233709
083220200610     C           @@STAT    WHEQ 'SELF'                                                        CGL031
083230200610     C                     MOVEL'S'       TSSTAT                                              CGL031
083240200610     C           @@STAT    WHEQ 'TAXAB'                                                       CGL031
083250200610     C                     MOVEL'T'       TSSTAT                                              CGL031
083260200610     C                     ENDSL                                                              CGL031
083270200610      *****************************************************************                CGL031 233709
083280200610      **Get*Details*either*from*SDACUSPD*or*SDNAHOPD*******************                CGL031 233709
083290200610      *****************************************************************                CGL031 233709
083300200610     C**********           SELEC                                                       CGL031 233709
083310200610     C********** @@CUST    WHNE *BLANK                                                 CGL031 233709
083320200610     C********** @@CUST    CHAINSDACUSL1             60                                CGL031 233709
083330200610     C********** *IN60     IFEQ *OFF                                                   CGL031 233709
083340200610     C**********           MOVELE5CNA1    TSFAMN                                       CGL031 233709
083350200610     C**********           MOVELE5CNA1    TSFIRN                                       CGL031 232543
083360200610     C**********           MOVELE5CNA2    TSFIRN                                       232543 233709
083370200610     C********** E5CNA3    CAT  E5CNA4:1  TSSTRT                                       CGL031 233709
083380200610     C**********           MOVELE5ZIPC    TSZIPC                                       CGL031 233709
083390200610     C**********           MOVELE5CITY    TSCITY                                       CGL031 233709
083400200610     C**********           MOVELE5TINO    TSRTIN                                       CGL031 233709
083410200610     C**********           MOVELE5DBTH    TSDBTH                                       CGL031 233709
083420200610     C**********           MOVELE5BTHT    TSTBTH                                       CGL031 233709
083430200610     C**********           MOVELE5BTHC    TSCBTH                                       CGL031 233709
083440200610     C**********           ENDIF                                                       CGL031 233709
083450200610      *****************************************************************                CGL031 233709
083460200610     C********** @@NARF    WHNE *BLANK                                                 CGL031 233709
083470200610     C********** @@NARF    CHAINSDNAHOL1             60                                CGL031 233709
083480200610     C********** *IN60     IFEQ *OFF                                                   CGL031 233709
083490200610     C**********           MOVELNHIDE1    TSFAMN                                       CGL031 233709
083500200610     C**********           MOVELNHIDE2    TSFIRN                                       CGL031 233709
083510200610     C********** NHIDE3    CAT  NHIDE4:1  TSSTRT                                       CGL031 233709
083520200610     C**********           MOVELNHZIPC    TSZIPC                                       CGL031 233709
083530200610     C**********           MOVELNHCITY    TSCITY                                       CGL031 233709
083540200610     C**********           MOVELNHTINO    TSRTIN                                       CGL031 233709
083550200610     C**********           MOVELNHDBTH    TSDBTH                                       CGL031 233709
083560200610     C**********           MOVELNHBTHT    TSTBTH                                       CGL031 233709
083570200610     C**********           MOVELNHBTHC    TSCBTH                                       CGL031 233709
083580200610     C**********           ENDIF                                                       CGL031 233709
083590200610      *****************************************************************                CGL031 233709
083600200610     C**********           ENDSL                                                       CGL031 233709
083610200610      *****************************************************************                CGL031 233709
083620200610      ***Get*Interest*Payment*Date*************************************                CGL031 233709
083630200610      *****************************************************************                CGL031 233709
083640200610     C**********           Z-ADDSAED      @@DAYN  50                                   CGL031 233709
083650200610     C**********           EXSR ZDATE9                                                 CGL031 233709
083660200610     C**********           MOVE @@VDT     TSIPDT                                       CGL031 233709
083670200610      *****************************************************************                CGL031 233709
083680200610     C**********           MOVEL@@COLC    TSRCTR                                       CGL031 233709
083690200610     C**********           MOVEL@@TXBS    TSTXBS                                       CGL031 233709
083700200610     C**********           MOVEL@@WTAC    TSWTAC                                       CGL031 233709
083710200610     C**********           MOVEL@@OCCY    TSOCCY                                       CGL031 233709
083720200610      *****************************************************************                CGL031 233709
083730200610     C                     MOVEL@@OCCY    TSOCCY  3                                           233709
083740200610     C                     Z-ADD@@DAYN    @@DAYN  50                                          233709
083750200610      *                                                                                       233709
083760200610      ** Get Original Spot Rate                                                               CGL031
083770200610      *                                                                                       CGL031
083780200610     C                     MOVELTSOCCY    WCURR                                               CGL031
083790200610     C                     Z-ADD29        WDBAS1                                              CGL031
083800200610     C                     EXSR #LCURR                                                        CGL031
083810200610     C           A6MDIN    IFEQ 'D'                                                           CGL031
083820200610     C                     MOVELA6SPRT    TSOCSR                                              CGL031
083830200610     C                     ELSE                                                               CGL031
083840200610     C********** 1         DIV  A6SPRT    TSOCSR    H                                  CGL031 233709
083850200610     C           1         DIV  A6SPRT    TSOCSR 138H                                         233709
083860200610     C                     ENDIF                                                              CGL031
083870200610      *                                                                                       CGL031
083880200610     C**********           MOVEL'D'       TSOCMD                                       CGL031 233709
083890200610     C**********           MOVELA6NBDP    TSOCDP                                       CGL031 233709
083900200610     C**********           MOVELTSOCCY    TSSCCY                                       CGL031 233709
083910200610     C**********           MOVELTSOCSR    TSSCSR                                       CGL031 233709
083920200610     C**********           MOVELTSOCMD    TSSCMD                                       CGL031 233709
083930200610     C**********           MOVELTSOCDP    TSSCDP                                       CGL031 233709
083940200610     C**********           MOVEL@@TXCY    TSTXCY                                       CGL031 233709
083950200610     C**********           MOVEL@@TXCY    TSTCSR                                       CGL031 232543
083960200610     C                     MOVEL'D'       TSOCMD  1                                           233709
083970200610     C                     MOVELA6NBDP    TSOCDP  10                                          233709
083980200610     C                     MOVELTSOCCY    TSSCCY  3                                           233709
083990200610     C                     MOVELTSOCSR    TSSCSR 138                                          233709
084000200610     C                     MOVELTSOCMD    TSSCMD  1                                           233709
084010200610     C                     MOVELTSOCDP    TSSCDP  10                                          233709
084020200610     C                     MOVEL@@TXCY    TSTXCY  3                                           233709
084030200610      *                                                                                       CGL031
084040200610      ** Get Currency Spot Rate                                                               CGL031
084050200610      *                                                                                       CGL031
084060200610     C                     MOVELTSTXCY    WCURR                                               CGL031
084070200610     C                     EXSR #LCURR                                                        CGL031
084080200610     C           A6MDIN    IFEQ 'D'                                                           CGL031
084090200610     C**********           MOVELA6SPRT    TSTCSR                                       CGL031 233709
084100200610     C                     MOVELA6SPRT    TSTCSR 138                                          233709
084110200610     C                     ELSE                                                               CGL031
084120200610     C           1         DIV  A6SPRT    TSTCSR    H                                         CGL031
084130200610     C                     ENDIF                                                              CGL031
084140200610      *                                                                                       CGL031
084150200610     C**********           MOVEL'D'       TSTCMD                                       CGL031 233709
084160200610     C**********           MOVELA6NBDP    TSTCDP                                       CGL031 233709
084170200610     C                     MOVEL'D'       TSTCMD  1                                           233709
084180200610     C                     MOVELA6NBDP    TSTCDP  10                                          233709
084190200610      *                                                                                       CGL031
084200200610      ** Get Orig/Settlement Currency Exchange Rate                                           CGL031
084210200610      ** Get Orig/Settlement Cross Rate                                                       CGL031
084220200610      *                                                                                       CGL031
084230200610     C                     Z-ADDTSOCSR    ZRATE1                                              CGL031
084240200610     C                     MOVE TSOCMD    ZMDI1                                               CGL031
084250200610     C                     Z-ADDTSSCSR    ZRATE2                                              CGL031
084260200610     C                     MOVE TSSCMD    ZMDI2                                               CGL031
084270200610     C                     EXSR ZXRATE                                                        CGL031
084280200610     C**********           Z-ADDZRATEX    TSXROS                                       CGL031 233709
084290200610     C**********           MOVE ZMDIX     TSOSMD                                       CGL031 233709
084300200610     C                     Z-ADDZRATEX    TSXROS 138                                          233709
084310200610     C                     MOVE ZMDIX     TSOSMD  1                                           233709
084320200610      *                                                                                       CGL031
084330200610      ** Get Settlement/Tax Currency Exchange Rate                                            CGL031
084340200610      *                                                                                       CGL031
084350200610     C                     Z-ADDTSSCSR    ZRATE1                                              CGL031
084360200610     C                     MOVE TSSCMD    ZMDI1                                               CGL031
084370200610     C                     Z-ADDTSTCSR    ZRATE2                                              CGL031
084380200610     C                     MOVE TSTCMD    ZMDI2                                               CGL031
084390200610     C                     EXSR ZXRATE                                                        CGL031
084400200610     C**********           Z-ADDZRATEX    TSXRST                                       CGL031 233709
084410200610     C**********           MOVE ZMDIX     TSSTMD                                       CGL031 233709
084420200610     C                     Z-ADDZRATEX    TSXRST 138                                          233709
084430200610     C                     MOVE ZMDIX     TSSTMD  1                                           233709
084440200610      *                                                                                       CGL031
084450200610     C**********           MOVEL'S'       TSMODI                                       CGL031 233709
084460200610      *****************************************************************                CGL031 233709
084470200610     C**********           MOVEL*BLANKS   TSINST                                       CGL031 233709
084480200610     C**********           SELEC                                                       CGL031 233709
084490200610     C********** SAAT      WHEQ 'CP'                                                   CGL031 233709
084500200610     C**********           MOVEL'CP'      TSETYP                                       CGL031 233709
084510200610     C********** SESN      CAT  WINST1    TSINST                                       CGL031 233709
084520200610     C********** SAAT      WHEQ 'DV'                                                   CGL031 233709
084530200610     C**********           MOVEL'DV'      TSETYP                                       CGL031 233709
084540200610     C********** SESN      CAT  WINST2    TSINST                                       CGL031 233709
084550200610     C********** SAAT      WHEQ 'MA'                                                   CGL031 233709
084560200610     C**********           MOVEL'MT'      TSETYP                                       CGL031 233709
084570200610     C********** SESN      CAT  WINST3    TSINST                                       CGL031 233709
084580200610     C********** SAAT      WHEQ 'MP'                                                   CGL031 233709
084590200610     C**********           MOVEL'MP'      TSETYP                                       CGL031 233709
084600200610     C********** SESN      CAT  WINST4    TSINST                                       CGL031 233709
084610200610     C**********           ENDSL                                                       CGL031 233709
084620200610      *****************************************************************                CGL031 233709
084630200610     C**********           Z-ADD*ZERO     TSDLLN                                       CGL031 233709
084640200610     C**********           Z-ADD*ZERO     TSACOD                                       CGL031 233709
084650200610     C**********           Z-ADD*ZERO     TSACSQ                                       CGL031 233709
084660200610      *****************************************************************                CGL031 233709
084670200610     C**********           MOVELSESN      TSSESN                                       CGL031 233709
084680200610     C**********           MOVELSRPN      TSSRPN                                       CGL031 233709
084690200610     C**********           MOVELISNO      TSISIN                                       CGL031 233709
084700200610     C**********           Z-ADDCSPV      TSPAMT                                       CGL031 233709
084710200610     C**********           Z-ADD@@TOTO    TSGINT                                       CGL031 233709
084720200610      *                                                                                       CGL031
084730200610      ** The following fields are calculated when the customer status = T only.               CGL031
084740200610      *                                                                                       CGL031
084750200610     C**********           Z-ADD*ZERO     TSTXRT                                       CGL031 233709
084760200610     C**********           Z-ADD*ZERO     TSTXSR                                       CGL031 233709
084770200610     C                     Z-ADD*ZERO     TSTXSR 150                                          233709
084780200610     C           TSSTAT    IFEQ 'T'                                                           CGL031
084790200610     C**********           Z-ADD@@TAXR    TSTXRT                                       CGL031 233709
084800200610     C                     Z-ADD@@TAXA    TSTXSR                                              CGL031
084810200610     C**********           ENDIF                                                       CGL031 233709
084820200610      *                                                                                       CGL031
084830200610     C********** TSGINT    SUB  TSTXSR    TSNINT                                       CGL031 233709
084840200610      *                                                                                       CGL031
084850200610     C           TSOCCY    IFEQ TSSCCY                                                        CGL031
084860200610     C**********           Z-ADDTSPAMT    TSPAMS                                       CGL031 233709
084870200610     C**********           Z-ADD@@TOTO    TSGINS                                       CGL031 233709
084880200610     C**********           Z-ADD@@TAXA    TSTXSS                                       CGL031 233709
084890200610     C                     Z-ADD@@TAXA    TSTXSS 150                                          233709
084900200610      *                                                                                       CGL031
084910200610     C                     ELSE                                                               CGL031
084920200610     C**********           Z-ADDTSPAMT    ZAMTF                                        CGL031 233709
084930200610     C**********           Z-ADDTSXROS    ZCRSRT                                       CGL031 233709
084940200610     C**********           MOVE TSOSMD    ZCRSMD                                       CGL031 233709
084950200610     C**********           Z-ADDTSOCDP    ZCDPF                                        CGL031 233709
084960200610     C**********           Z-ADDTSSCDP    ZCDPT                                        CGL031 233709
084970200610     C**********           EXSR ZCCYXR                                                 CGL031 233709
084980200610     C**********           Z-ADDZAMTT     TSPAMS                                       CGL031 233709
084990200610      *****************************************************************                CGL031 233709
085000200610     C**********           Z-ADD@@TOTO    ZAMTF                                        CGL031 233709
085010200610     C**********           Z-ADDTSXROS    ZCRSRT                                       CGL031 233709
085020200610     C**********           MOVE TSOSMD    ZCRSMD                                       CGL031 233709
085030200610     C**********           Z-ADDTSOCDP    ZCDPF                                        CGL031 233709
085040200610     C**********           Z-ADDTSSCDP    ZCDPT                                        CGL031 233709
085050200610     C**********           EXSR ZCCYXR                                                 CGL031 233709
085060200610     C**********           Z-ADDZAMTT     TSGINS                                       CGL031 233709
085070200610      *                                                                                       CGL031
085080200610     C                     Z-ADD@@TAXA    ZAMTF                                               CGL031
085090200610     C                     Z-ADDTSXROS    ZCRSRT                                              CGL031
085100200610     C                     MOVE TSOSMD    ZCRSMD                                              CGL031
085110200610     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
085120200610     C**********           Z-ADDTSSCDP    ZCDPT                                        CGL031 CSD027
085130200610     C                     MOVELTSSCDP    ZCDPT                                               CSD027
085140200610     C                     EXSR ZCCYXR                                                        CGL031
085150200610     C                     Z-ADDZAMTT     TSTXSS                                              CGL031
085160200610     C                     ENDIF                                                              CGL031
085170200610      *                                                                                       CGL031
085180200610     C********** TSGINS    SUB  TSTXSS    TSNINS                                       CGL031 233709
085190200610      *                                                                                       CGL031
085200200610     C           TSSCCY    IFEQ TSTXCY                                                        CGL031
085210200610     C**********           Z-ADDTSPAMS    TSPAMC                                       CGL031 233709
085220200610     C**********           Z-ADDTSGINS    TSGINC                                       CGL031 233709
085230200610     C**********           Z-ADDTSTXSS    TSTXSC                                       CGL031 233709
085240200610     C                     Z-ADDTSTXSS    TSTXSC 150                                          233709
085250200610      *                                                                                       CGL031
085260200610     C                     ELSE                                                               CGL031
085270200610     C**********           Z-ADDTSPAMS    ZAMTF                                        CGL031 233709
085280200610     C**********           Z-ADDTSXRST    ZCRSRT                                       CGL031 233709
085290200610     C**********           MOVE TSSTMD    ZCRSMD                                       CGL031 233709
085300200610     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
085310200610     C**********           Z-ADDTSTCDP    ZCDPT                                        CGL031 233709
085320200610     C**********           EXSR ZCCYXR                                                 CGL031 233709
085330200610     C**********           Z-ADDZAMTT     TSPAMC                                       CGL031 233709
085340200610      *****************************************************************                CGL031 233709
085350200610     C**********           Z-ADDTSGINS    ZAMTF                                        CGL031 233709
085360200610     C**********           Z-ADDTSXRST    ZCRSRT                                       CGL031 233709
085370200610     C**********           MOVE TSSTMD    ZCRSMD                                       CGL031 233709
085380200610     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
085390200610     C**********           Z-ADDTSTCDP    ZCDPT                                        CGL031 233709
085400200610     C**********           EXSR ZCCYXR                                                 CGL031 233709
085410200610     C**********           Z-ADDZAMTT     TSGINC                                       CGL031 233709
085420200610      *                                                                                       CGL031
085430200610     C                     Z-ADDTSTXSS    ZAMTF                                               CGL031
085440200610     C                     Z-ADDTSXRST    ZCRSRT                                              CGL031
085450200610     C                     MOVE TSSTMD    ZCRSMD                                              CGL031
085460200610     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
085470200610     C**********           Z-ADDTSTCDP    ZCDPT                                        CGL031 CSD027
085480200610     C                     MOVELTSTCDP    ZCDPT                                               CSD027
085490200610     C                     EXSR ZCCYXR                                                        CGL031
085500200610     C                     Z-ADDZAMTT     TSTXSC                                              CGL031
085510200610     C                     ENDIF                                                              CGL031
085520200610      *                                                                                       CGL031
085530200610     C********** TSGINC    SUB  TSTXSC    TSNINC                                       CGL031 233709
085540200610      *****************************************************************                CGL031 233709
085550200610     C********** TSSCCY    IFEQ BJCYCD                                                 CGL031 233709
085560200610     C**********           Z-ADDTSPAMS    TSPAMB                                       CGL031 233709
085570200610     C**********           Z-ADDTSGINS    TSGINB                                       CGL031 233709
085580200610     C**********           Z-ADDTSTXSS    TSTXSB                                       CGL031 233709
085590200610      *****************************************************************                CGL031 233709
085600200610     C**********           ELSE                                                        CGL031 233709
085610200610     C**********           Z-ADDTSPAMS    ZAMTF                                        CGL031 233709
085620200610     C**********           Z-ADDTSSCSR    ZCRSRT                                       CGL031 233709
085630200610     C**********           MOVE TSSCMD    ZCRSMD                                       CGL031 233709
085640200610     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
085650200610      *****************************************************************                CGL031 233709
085660200610      ***Get*Bsse*Currency*Decimal*Places******************************                CGL031 233709
085670200610      *****************************************************************                CGL031 233709
085680200610     C**********           MOVELBJCYCD    WCURR                                        CGL031 233709
085690200610     C**********           EXSR #LCURR                                                 CGL031 233709
085700200610     C**********           Z-ADDA6NBDP    ZCDPI                                        CGL031 233709
085710200610     C**********           Z-ADDZCDPI     ZCDPT                                        CGL031 233709
085720200610     C**********           EXSR ZCCYXR                                                 CGL031 233709
085730200610     C**********           Z-ADDZAMTT     TSPAMB                                       CGL031 233709
085740200610      *****************************************************************                CGL031 233709
085750200610     C**********           Z-ADDTSGINS    ZAMTF                                        CGL031 233709
085760200610     C**********           Z-ADDTSSCSR    ZCRSRT                                       CGL031 233709
085770200610     C**********           MOVE TSSCMD    ZCRSMD                                       CGL031 233709
085780200610     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
085790200610     C**********           Z-ADDZCDPI     ZCDPT                                        CGL031 233709
085800200610     C**********           EXSR ZCCYXR                                                 CGL031 233709
085810200610     C**********           Z-ADDZAMTT     TSGINB                                       CGL031 233709
085820200610      *****************************************************************                CGL031 233709
085830200610     C**********           Z-ADDTSTXSS    ZAMTF                                        CGL031 233709
085840200610     C**********           Z-ADDTSSCSR    ZCRSRT                                       CGL031 233709
085850200610     C**********           MOVE TSSCMD    ZCRSMD                                       CGL031 233709
085860200610     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
085870200610     C**********           Z-ADDZCDPI     ZCDPT                                        CGL031 233709
085880200610     C**********           EXSR ZCCYXR                                                 CGL031 233709
085890200610     C**********           Z-ADDZAMTT     TSTXSB                                       CGL031 233709
085900200610     C**********           ENDIF                                                       CGL031 233709
085910200610      *****************************************************************                CGL031 233709
085920200610     C********** TSGINB    SUB  TSTXSB    TSNINB                                       CGL031 233709
085930200610     C**********           MOVE 'N'       TSINPR                                       CGL031 233709
085940200610      *****************************************************************                CGL031 233709
085950200610     C**********           Z-ADD*ZERO     TSTNLU                                       CGL031 233709
085960200610      *****************************************************************                CGL031 233709
085970200610      ***Write*record*to*SDCSINPD**************************************                CGL031 233709
085980200610      *****************************************************************                CGL031 233709
085990200610     C**********           WRITESDCSIND0                                               CGL031 233709
086000200610      *****************************************************************                CGL031 233709
086010200610      ***Accumulate*relevant*amounts*for*net*total*********************                CGL031 233709
086020200610      *****************************************************************                CGL031 233709
086030200610     C********** TSSTAT    IFEQ 'T'                                                    CGL031 233709
086040200610     C**********           ADDQ TSTXSR    WTTXSR                                       CGL031 233709
086050200610     C**********           ADD  TSTXSR    WTTXSS                                       CGL031 233709
086060200610     C**********           ADD  TSTXSC    WTTXSC                                       CGL031 233709
086070200610     C**********           ADD  TSTXSB    WTTXSB                                       CGL031 233709
086080200610     C**********           ADD  TSNINT    WTNINT                                       CGL031 233709
086090200610     C**********           ADD  TSNINS    WTNINS                                       CGL031 233709
086100200610     C**********           ADD  TSNINC    WTNINC                                       CGL031 233709
086110200610     C**********           ADD  TSNINB    WTNINB                                       CGL031 233709
086120200610     C                     ADD  TSTXSR    TXNM                                                233709
086130200610     C                     ADD  TSTXSS    TXST                                                233709
086140200610     C                     ADD  TSTXSC    TAXA                                                233709
086150200610     C                     MOVE TSTXCY    TXCY                                                233709
086160200610     C                     ENDIF                                                              CGL031
086170200610      *                                                                                       CGL031
086180200610     C                     ENDSR                                                              CGL031
086190200610      *****************************************************************
086200200610      /EJECT                                                              S01117
086210200610      *****************************************************************   S01117
086220200610      *                                                               *   S01117
086230200610      *  SECPPC - Subroutine to get customer position profit centre   *   S01117
086240200610      *                                                               *   S01117
086250200610      *****************************************************************   S01117
086260200610      *                                                                   S01117
086270200610     C           SECPPC    BEGSR                           ** SECPPC **   S01117
086280200610     C*                                                                   S01117
086290200610     C** Chain for customer position profit centre record                 S01117
086300200610     C*                                                                   S01117
086310200610     C           KSEPCC    CHAINSEPCCDF              79            S01117 081336
086320200610     C           *IN79     IFNE '1'                                S01117 081336
086330200610     C           RECI      COMP '*'                      79        S01117 081336
086340200610     C                     END                                     S01117 081336
086350200610     C************IN79     IFEQ '1'                         S01117 081336 182952
086360200610     C************LOCK     IN   LDA                                S01117 182952
086370200610     C***********          MOVEL'SEPCCD'  DBFILE    ***************S01117 182952
086380200610     C***********          MOVELKSEPCR    DBKEY     * DB ERROR 17 *S01117 182952
086390200610     C***********          Z-ADD17        DBASE     ***************S01117 182952
086400200610     C***********          SETON                     U7U8          S01117 182952
086410200610     C***********          DUMP                                    S01117 182952
086420200610     C***********          GOTO EAUDIT                             S01117 182952
086430200610     C***********          END                                     S01117 182952
086440200610     C*                                                                   S01117
086450200610     C                     ENDSR                                          S01117
086460200610     C*                                                                   S01117
086470200610     C*****************************************************************   S01117
086480200610      /EJECT
086490200610      *****************************************************************
086500200610      *                                                               *
086510200610      *  SECTIN - Subroutine to get Security record.                  *
086520200610      *                                                               *
086530200610      *****************************************************************
086540200610      *
086550200610     C           SECTIN    BEGSR                           ** SECTIN **
086560200610     C*
086570200610     C** CHAIN FOR SECURITY RECORD AND DATA BASE ERROR
086580200610     C*
086590200610     C***********SECTKY    CHAINSECTY                79                   081383
086600200610     C************IN79     IFNE '1'                                       081383
086610200610     C***********RECI      COMP '*'                      79               081383
086620200610     C***********          END                                            081383
086630200610     C************IN79     IFEQ '1'                                       081383
086640200610     C           SECTKY    CHAINSECTY                82                   081383
086650200610     C           *IN82     IFNE '1'                                       081383
086660200610     C***********RECI      COMP '*'                      82        081383 033988
086670200610     C           RECIS     COMP '*'                      82               033988
086680200610     C                     END                                            081383
086690200610     C           *IN82     IFEQ '1'                                       081383
086700200610     C           *LOCK     IN   LDA                                       S01117
086710200610     C                     MOVEL'SECTY'   DBFILE           ***************
086720200610     C                     MOVELSASN      DBKEY            * DB ERROR 04 *
086730200610     C                     Z-ADD4         DBASE            ***************
086740200610     C                     SETON                     U7U8                 S01117
086750200610     C                     DUMP                                           S01117
086760200610     C                     GOTO EAUDIT
086770200610     C                     ELSE                                           E37289
086780200610     C                     MOVE RECI      SCRECI  1                       E37289
086790200610     C                     END
086800200610      *                                                                   S01447
086810200610      *** Access security WHT details file                                S01447
086820200610      *                                                                   S01447
086830200610     C                     MOVE *BLANKS   S1CTTA                          236815
086840200610     C           SECTKY    CHAINSESWHTL0             80                   S01447
086850200610     C   80                MOVEL'N'       SWHTFD  1                       236815
086860200610     C  N80                MOVEL'Y'       SWHTFD  1                       236815
086870200610      *
086880200610     C                     ENDSR
086890200610      *
086900200610      *****************************************************************
086910200610      /SPACE 3
086920200610      *****************************************************************
086930200610      *                                                               *
086940200610      *  INVTIN - Subroutine to get Investment Type record.           *
086950200610      *                                                               *
086960200610      *****************************************************************
086970200610      *
086980200610     C           INVTIN    BEGSR                           ** INVTIN **
086990200610     C*
087000200610     C** CHAIN FOR INVESTMENT TYPE RECORD AND DATA BASE ERROR
087010200610     C*
087020200610     C***********INVTKY    CHAININVTP                79                   081383
087030200610     C************IN79     IFNE '1'                                       081383
087040200610     C***********RECI      COMP '*'                      79               081383
087050200610     C***********          END                                            081383
087060200610     C************IN79     IFEQ '1'                                       081383
087070200610     C           INVTKY    CHAININVTP                82                   081383
087080200610     C           *IN82     IFNE '1'                                       081383
087090200610     C********** RECI      COMP '*'                      82                          081383 BUG11104
087100200610     C           RECII     COMP '*'                      82                                 BUG11104
087110200610     C                     END                                            081383
087120200610     C           *IN82     IFEQ '1'                                       081383
087130200610     C           *LOCK     IN   LDA                                       S01117
087140200610     C                     MOVEL'INVTP'   DBFILE           ***************
087150200610     C                     MOVELINVKEY    DBKEY            * DB ERROR 05 *
087160200610     C                     Z-ADD5         DBASE            ***************
087170200610     C                     SETON                     U7U8                 S01117
087180200610     C                     DUMP                                           S01117
087190200610     C                     GOTO EAUDIT
087200200610     C                     END
087210200610      **********                                                                AR1001183 AR1001183A
087220200610      ***Get*next*coupon*rate                                                   AR1001183 AR1001183A
087230200610     C**********           MOVE 'N'       WRCHG   1                             AR1001183 AR1001183A
087240200610     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
087250200610     C********** PROT      ANDEQ'3'                                             AR1001183 AR1001183A
087260200610     C********** PROT      OREQ '8'                                             AR1001183 AR1001183A
087270200610      **********                                                                AR1001183 AR1001183A
087280200610     C********** SDET      IFEQ 'MP'                                            AR1001183 AR1001183A
087290200610     C********** SDET      OREQ 'DV'                                            AR1001183 AR1001183A
087300200610     C********** S01512    ANDNE'Y'                                             AR1001183 AR1001183A
087310200610     C**********           Z-ADDSAOD      WDAT    50                            AR1001183 AR1001183A
087320200610     C**********           ELSE                                                 AR1001183 AR1001183A
087330200610     C**********           Z-ADDSAED      WDAT                                  AR1001183 AR1001183A
087340200610     C**********           ENDIF                                                AR1001183 AR1001183A
087350200610      **********                                                                AR1001183 AR1001183A
087360200610     C**********           EXSR GETNCR                                          AR1001183 AR1001183A
087370200610     C**********           ENDIF                                                AR1001183 AR1001183A
087380200610      *
087390200610     C                     ENDSR
087400200610      *
087410200610      *****************************************************************
087420200610      /SPACE 3
087430200610      *****************************************************************
087440200610      *                                                               *
087450200610      *  SECEDI - Subroutine to get Security Diary Event record.      *
087460200610      *                                                               *
087470200610      *****************************************************************
087480200610      *
087490200610     C           SECEDI    BEGSR                           ** SECEDI **
087500200610     C*
087510200610     C** CHAIN FOR SECURITY EVENT RECORD AND DATA BASE ERROR
087520200610     C*
087530200610     C***STORE*NOM*CCY*FROM*SECTYD*AS*SEDEVDF*HAS*NMCY*FIELD*TOO*******   E20086
087540200610     C***********                                                         E20086
087550200610     C***********          MOVE NMCY      WNMCY   3                       E20086
087560200610     C           SECDKY    CHAINSEDEVDF              7877
087570200610     C           *IN78     IFNE '1'
087580200610     C           RECI      COMP '*'                      78
087590200610     C                     END
087600200610     C           *IN77     IFEQ '1'
087610200610     C           *LOCK     IN   LDA                                       S01117
087620200610     C***********          MOVEL'SECED'   DBFILE           ***************E20016
087630200610     C                     MOVEL'SEDEV'   DBFILE           ***************E20016
087640200610     C                     MOVELSASN      DBKEY            * DB ERROR 06 *
087650200610     C                     Z-ADD6         DBASE            ***************
087660200610     C                     SETON                     U7U8                 S01117
087670200610     C                     DUMP                                           S01117
087680200610     C                     GOTO EAUDIT
087690200610     C                     END
087700200610     C************         MOVE WNMCY     NMCY                            E20086
087710200610      *
087720200610     C                     ENDSR
087730200610      *
087740200610      *****************************************************************
087750200610      /SPACE 3
087760200610      *****************************************************************
087770200610      *                                                               *
087780200610      *  TG10   - Subroutine to get Security Currency Decimal Places  *
087790200610      *           from TABTG10.                                       *
087800200610      *                                                               *
087810200610      *****************************************************************
087820200610      *
087830200610     C           TG10      BEGSR                           ** TG10   **
087840200610     C*
087850200610     C** CHAIN FOR CURRENCY RECORD IN TABLE TABTG10
087860200610     C** FIELD WCURR CONTAINS THE CURRENCY WHEN THIS SUBROUTINE EXECUTED
087870200610     C*
087880200610     C* IF WCURR IS EQUAL TO WLSTCY (LAST CCY TO ACCESS TABTG10) IGNORE
087890200610     C*
087900200610     C           WCURR     CABEQWLSTCY    ENDT10
087910200610     C                     MOVE WCURR     WLSTCY  3
087920200610     C*
087930200610     C                     MOVEL'20      'ZTABKY 12
087940200610     C                     MOVE '1'       WRK4    4
087950200610     C                     MOVELWCURR     WRK4
087960200610     C                     MOVE WRK4      ZTABKY
087970200610     C**
087980200610     C           ZTABKY    CHAINTABTG10F             99
087990200610     C*
088000200610     C* ERROR IF NO RECORD FOUND OR IF IT IS DELETED
088010200610     C*
088020200610     C           *IN99     IFEQ '1'
088030200610     C                     SETON                     U7U8
088040200610     C                     ELSE
088050200610     C           RECI      IFEQ '*'
088060200610     C                     SETON                     U7U8
088070200610     C                     END
088080200610     C                     END
088090200610     C           *INU7     IFEQ '1'
088100200610     C           *LOCK     IN   LDA                                       S01117
088110200610     C                     MOVE 'TABLE'   DBFILE           ***************
088120200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 07 *
088130200610     C                     Z-ADD7         DBASE            ***************
088140200610     C                     SETON                     U7U8                 S01117
088150200610     C                     DUMP                                           S01117
088160200610     C                     GOTO EAUDIT
088170200610     C                     END
088180200610     C*                                                                   S01117
088190200610     C**  Set up new output parameter for use in SR.ZCNSD                 S01117
088200200610     C*                                                                   S01117
088210200610     C                     Z-ADDCDP       ZCDP                            S01117
088220200610     C*
088230200610     C           ENDT10    ENDSR                           ** ENDT10 **
088240200610      *
088250200610      *****************************************************************
088260200610      /EJECT                                                              S01446
088270200610     C*****************************************************************   S01446
088280200610     C*                                                               *   S01446
088290200610     C*  #LCURR - Subroutine to get currency details from SDCURRPD    *   S01446
088300200610     C*                                                               *   S01446
088310200610     C*****************************************************************   S01446
088320200610     C*                                                                   S01446
088330200610     C           #LCURR    BEGSR                                          S01446
088340200610     C*                                                                   S01446
088350200610     C                     CALL 'AOCURRR0'                                S01446
088360200610     C                     PARM *BLANKS   @RTCD   7                       S01446
088370200610     C                     PARM '*KEY   ' @OPTN   7                       S01446
088380200610     C                     PARM WCURR     @AJCD   3                       S01446
088390200610     C           SDCURR    PARM SDCURR    DSSDY                           S01446
088400200610     C*                                                                   S01446
088410200610     C           @RTCD     IFNE *BLANKS                                   S01446
088420200610     C                     SETON                     U7U899               S01446
088430200610     C           *LOCK     IN   LDA                                       S01446
088440200610     C                     MOVE 'SDCURRPD'DBFILE           ***************S01446
088450200610     C                     MOVELWCURR     DBKEY            * DB ERROR    *S01446
088460200610     C                     Z-ADDWDBAS1    DBASE            ***************S01446
088470200610     C                     DUMP                                           S01446
088480200610     C                     GOTO EAUDIT                                    S01446
088490200610     C                     END                                            S01446
088500200610     C*                                                                   S01446
088510200610     C                     ENDSR                                          S01446
088520200610      *****************************************************************   S01446
088530200610      /EJECT                                                                                AR853119
088540200610      *****************************************************************                     AR853119
088550200610      *                                                               *                     AR853119
088560200610      * SRPOST - Create Position Settlement extension                 *                     AR853119
088570200610      *                                                               *                     AR853119
088580200610      *****************************************************************                     AR853119
088590200610     C           SRPOST    BEGSR                                                            AR853119
088600200610      *                                                                                     AR853119
088610200610     C                     MOVE *BLANK    WSTAX   1                                         AR853119
088620200610     C                     MOVE *BLANK    WZTAX   1                                         AR853119
088630200610     C                     MOVE *ZERO     WSTAXA                                            AR875302
088640200610     C                     Z-ADD0         P3STAF                                            AR853119
088650200610     C                     MOVE 'N'       P3TAX                                             AR853119
088660200610     C                     MOVELBJRDNB    P3CDTE                                            AR853119
088670200610     C                     MOVELPBCA      P3PBCA                                            AR853119
088680200610     C                     MOVELPSSH      P3PSSH                                            AR853119
088690200610     C                     MOVELPCPY      P3PCPY                                            AR853119
088700200610     C                     MOVELPDUD      P3PDUD                                            AR853119
088710200610     C                     MOVELPEVT      P3PEVT                                            AR853119
088720200610      *                                                                                     AR853119
088730200610     C                     CALL 'AOBRCHR2'                                                  AR853119
088740200610     C                     PARM *BLANKS   @RTCD                                             AR853119
088750200610     C                     PARM '*KEY   ' @OPTN                                             AR853119
088760200610     C                     PARM PBCA      @DSNB   3                                         AR853119
088770200610     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR853119
088780200610     C           @RTCD     IFEQ *BLANKS                                                     AR853119
088790200610     C                     MOVE BXTAX     WSTAX                                             AR853119
088800200610     C                     ENDIF                                                            AR853119
088810200610      *                                                                                     AR853119
088820200610     C           PCPY      CHAINSDCUSQL0             99                                     AR853119
088830200610     C           *IN99     IFEQ '0'                                                         AR853119
088840200610     C                     MOVE CQTAX     WZTAX                                             AR853119
088850200610     C                     ENDIF                                                            AR853119
088860200610      *                                                                                     AR853119
088870200610      ** Calculate Stamp tax                                                                AR853119
088880200610      *                                                                                     AR853119
088890200610     C           WSTAX     IFEQ 'Y'                                                         AR853119
088900200610     C           WZTAX     ANDEQ'Y'                                                         AR853119
088910200610     C                     CALL 'SD008141'                                                  AR853119
088920200610     C                     PARM BJRDNB    U#DATE  50                                        AR853119
088930200610     C                     PARM 'POSSET  'U#ORGN 10                                         AR853119
088940200610     C                     PARM           ##TYPE  4                                         AR853119
088950200610     C                     PARM           U#CTAX 138                                        AR853119
088960200610     C                     PARM           U#MTAX 138                                        AR853119
088970200610     C                     PARM           U#CCCY  3                                         AR853119
088980200610     C                     PARM           U#MCCY  3                                         AR853119
088990200610     C                     PARM           U#CSCC  2                                         AR853119
089000200610     C                     PARM           U#MSCC  2                                         AR853119
089010200610     C                     PARM           U#TXTY  1                                         AR853119
089020200610     C                     PARM           SDSTPD                                            AR853119
089030200610      *                                                                                     AR853119
089040200610      ** If there is a default for the Module use this tax rate and ccy                     AR853119
089050200610      ** otherwise use the ICD Control defaults.                                            AR853119
089060200610      *                                                                                     AR853119
089070200610     C           U#MTAX    IFNE *ZEROS                                                      AR853119
089080200610     C                     Z-ADDU#MTAX    U#TAXR 138                                        AR853119
089090200610     C                     MOVE U#MCCY    U#SCCY  3                                         AR853119
089100200610     C                     ELSE                                                             AR853119
089110200610     C                     MOVE U#CCCY    U#SCCY                                            AR853119
089120200610     C                     Z-ADDU#CTAX    U#TAXR                                            AR853119
089130200610     C                     ENDIF                                                            AR853119
089140200610      *                                                                                     AR853119
089150200610     C                     MOVELPCHA      WSTAXA 130                                        AR853119
089160200610     C                     ADD  PCAM      WSTAXA                                            AR853119
089170200610     C                     MULT U#TAXR    WSTAXA    H                                       AR853119
089180200610     C                     MOVE WSTAXA    P3STAF                                            AR853119
089190200610     C                     MOVE 'Y'       P3TAX                                             AR853119
089200200610     C                     EXSR SRSTMD                                                      AR853119
089210200610     C                     ENDIF                                                            AR853119
089220200610      *                                                                                     AR853119
089230200610     C                     ENDSR                                                            AR853119
089240200610      *****************************************************************                     AR853119
089250200610      /EJECT                                                                                AR853119
089260200610      *****************************************************************                     AR853119
089270200610      * Subroutine  :  SRSTMD                                         *                     AR853119
089280200610      * Function    :  This subroutine will write/update records in   *                     AR853119
089290200610      *                Stamp Tax Historic/Details (SDSTMDPD)          *                     AR853119
089300200610      *****************************************************************                     AR853119
089310200610      *                                                                                     AR853119
089320200610     C           SRSTMD    BEGSR                                                            AR853119
089330200610      *                                                                                     AR853119
089340200610     C                     MOVE PBCA      T2PBRC                                            AR853119
089350200610     C                     MOVE PSSH      T2PSSH                                            AR853119
089360200610     C                     MOVE PCPY      T2PCPY                                            AR853119
089370200610     C                     MOVE PDUD      T2PDUD                                            AR853119
089380200610     C                     MOVE PEVT      T2PEVT                                            AR853119
089390200610     C                     MOVEL'POSSET'  T2KEY                                             AR853119
089400200610     C                     MOVE 'T'       T2RCTP                                            AR853119
089410200610     C                     MOVE U#SCCY    T2SCCY                                            AR853119
089420200610     C                     MOVE PSCU      T2ECCY                                            AR853119
089430200610     C                     MOVE 'Y'       T2TCAL                                            AR853119
089440200610     C                     MOVE U#TAXR    T2TXRT                                            AR853119
089450200610     C                     Z-ADDWSTAXA    T2TATC                                            AR853119
089460200610     C                     MOVE 'Y'       T2STFF                                            AR853119
089470200610     C                     MOVE 'I'       T2TYLC                                            AR853119
089480200610     C           PCHA      ADD  PCAM      T2GROS                                           AR864714B
089490200610      *                                                                                     AR853119
089500200610     C                     ENDSR                                                            AR853119
089510200610      *****************************************************************                     AR853119
089520200610      /EJECT
089530200610      *****************************************************************
089540200610      *                                                               *
089550200610      *  AUDIT  - Subroutine to update the Audit Files and Output the *
089560200610      *           Control Report.                                     *
089570200610      *                                                               *
089580200610      *****************************************************************
089590200610      *
089600200610     C           AUDIT     BEGSR                           ** AUDIT **
089610200610     C*
089620200610     C** COMPARE COUNT OF ACTIONS TO AUDIT FILE ACTIONS
089630200610     C*
089640200610     C                     READ SECACA                   79
089650200610     C*
089660200610     C* DATA BASE ERROR
089670200610     C*
089680200610     C           *IN79     IFEQ '1'
089690200610     C           *LOCK     IN   LDA                                       S01117
089700200610     C                     MOVEL'SECACA'  DBFILE           ***************
089710200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 08 *
089720200610     C                     Z-ADD8         DBASE            ***************
089730200610     C                     SETON                       U7U8
089740200610     C                     DUMP                                           S01117
089750200610     C                     ELSE
089760200610     C                     Z-ADDNORE      SANORE  50
089770200610     C                     END
089780200610     C*
089790200610     C           *INU8     IFNE '1'
089800200610     C           NORE      IFNE WCSECT
089810200610     C                     MOVE '1'       *INU8
089820200610     C                     MOVE '1'       *IN29
089830200610     C                     END
089840200610     C                     END
089850200610     C*
089860200610     C** IF U8 NOT ON UPDATE GEN A/C KEYS AUDIT AND POSN.SETT.AUDIT FILES
089870200610     C*
089880200610     C           *INU8     IFNE '1'
089890200610     C                     Z-ADDW01CNT    NORE
089900200610     C                     Z-ADDINT,1     HRWN
089910200610     C                     Z-ADDDEC,1     HRDC
089920200610     C                     WRITESEKEYAF
089930200610     C                     Z-ADDW02CNT    NORE
089940200610     C                     WRITEPOSETAF
089950200610     C                     END
089960200610     C*
089970200610     C** WRITE MATURED SECURITIES EXTRACT AUDIT RECORD WITH
089980200610     C*  NUMBER OF RECORDS WRITTEN
089990200610     C*
090000200610     C           *INU8     IFNE '1'
090010200610     C                     READ MATEXA                   78
090020200610     C           *IN78     IFEQ '1'
090030200610     C           RECI      ORNE 'C'
090040200610     C           *LOCK     IN   LDA                                       S01117
090050200610     C                     MOVEL'MATEXA'  DBFILE           ***************
090060200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 09 *
090070200610     C                     Z-ADD9         DBASE            ***************
090080200610     C                     SETON                       U7U8
090090200610     C                     DUMP                                           S01117
090100200610     C                     ELSE
090110200610     C                     ADD  WMATUR    NORE
090120200610     C                     UPDATMATEXAF
090130200610     C                     END
090140200610     C                     END
090150200610     C*
090160200610     C* OUTPUT CONTROL REPORT
090170200610     C*
090180200610     C                     WRITEHEADAU
090190200610     C           *INU7     IFEQ '1'
090200200610     C                     WRITEERROR
090210200610     C                     ELSE
090220200610     C***********WCSECT    IFEQ 0                                         E29170
090230200610     C***********          WRITENONE                                      E29170
090240200610     C***********          ELSE                                           E29170
090250200610     C                     Z-ADDINT,1     WHASHT
090260200610     C                     Z-ADDDEC,1     WHASHD
090270200610     C                     WRITECONTROL
090280200610     C*
090290200610     C***********          END                                            E29170
090300200610     C                     END
090310200610     C***********                                                         E29170
090320200610     C***********          WRITETRAILAU                                   E29170
090330200610     C*                                                                   S01117
090340200610     C** Update LDA                                                       S01117
090350200610     C*                                                                   S01117
090360200610     C           *INU7     IFEQ '1'                                       S01117
090370200610     C           *INU8     ANDEQ'1'                                       S01117
090380200610     C                     OUT  LDA                                       S01117
090390200610     C                     END                                            S01117
090400200610     C*                                                                   S01486
090410200610     C**  If Portfolio Management is on, close PM files                   S01486
090420200610     C*                                                                   S01486
090430200610     C           BGPFMG    IFEQ 'Y'                                       S01486
090440200610     C           BGN4ST    OREQ 'Y'                                       CPB001
090450200610     C                     CLOSEPMPORTPD                                  S01486
090460200610     C***********          CLOSEPMFPSNLL                           S01486 189942
090470200610     C***********          CLOSEPMCPSSLL                           S01486 189942
090480200610     C***********          CLOSEPMAPOSLL                           S01486 189942
090490200610     C                     CLOSEPMACCNL0                                  S01486
090500200610     C                     CLOSEPMACCNL1                                  219688
090510200610     C**********           CLOSESECET                                               S01486 BUG11104A
090520200610     C                     CLOSESEEVNT                                    S01486
090530200610     C                     END                                            S01486
090540200610     C                     CLOSESECET                                                      BUG11104A
090550200610     C*
090560200610     C                     ENDSR
090570200610      *
090580200610      *****************************************************************
090590200610      /EJECT
090600200610      *****************************************************************
090610200610      *                                                               *
090620200610      *  CLNTIN - Subroutine to get CLINTSE Client record.            *
090630200610      *                                                               *
090640200610      *****************************************************************
090650200610      *
090660200610     C           CLNTIN    BEGSR                           ** CLNTIN **
090670200610     C*
090680200610     C           CLINTK    CHAINCLINT                76
090690200610     C           *IN76     IFNE '1'
090700200610     C           RECI      COMP '*'                      76
090710200610     C                     END
090720200610     C           *IN76     IFEQ '1'
090730200610     C           *LOCK     IN   LDA                                       S01117
090740200610     C                     MOVEL'CLINT'   DBFILE           ***************
090750200610     C                     MOVELWCLNTK    DBKEY            * DB ERROR 10 *
090760200610     C                     SETON                     U7U8  ***************
090770200610     C                     Z-ADD10        DBASE
090780200610     C                     DUMP                                           S01117
090790200610     C                     GOTO EAUDIT
090800200610     C                     END
090810200610     C*
090820200610     C                     ENDSR
090830200610      *
090840200610     C*****************************************************************
090850200610      *****************************************************************
090860200610      /SPACE 3
090870200610      *****************************************************************
090880200610      *                                                               *
090890200610      *  POSDSR - Subroutine for Error Handling of PF/POSETD.         *
090900200610      *                                                               *
090910200610      *****************************************************************
090920200610      *
090930200610     C           POSDSR    BEGSR                            ** POSDSR **
090940200610     C*
090950200610     C                     MOVE PCPY      PCPYK                           CSE023
090960200610     C                     MOVE PBCA      PBCAK                           CSE023
090970200610     C                     MOVE PSSH      PSSHK                           CSE023
090980200610     C           *LOCK     IN   LDA                                       S01117
090990200610     C                     MOVE 'POSETD'  DBFILE           ***************
091000200610     C                     MOVELPOSDDB    DBKEY            * DB ERROR 11 *
091010200610     C                     Z-ADD011       DBASE            ***************
091020200610     C                     MOVE STSPSD    DBSTAT
091030200610     C                     MOVE '1'       *IN87
091040200610     C                     SETON                     99U7U8
091050200610     C                     DUMP                                           S01117
091060200610     C                     GOTO EAUDIT
091070200610     C*
091080200610     C                     ENDSR
091090200610      *
091100200610      *****************************************************************
091110200610      /SPACE 3
091120200610      *****************************************************************
091130200610      *                                                               *
091140200610      *  SEKDSR - Subroutine for Error Handling of LF/SEKEYD.         *
091150200610      *                                                               *
091160200610      *****************************************************************
091170200610      *
091180200610     C           SEKDSR    BEGSR                            **SEKDSR**
091190200610     C*
091200200610     C           *LOCK     IN   LDA                                       S01117
091210200610     C                     MOVE 'SEKEYD'  DBFILE           ***************
091220200610     C                     MOVELACKY      DBKEY            * DB ERROR 12 *
091230200610     C                     Z-ADD012       DBASE            ***************
091240200610     C                     MOVE STSSKD    DBSTAT
091250200610     C                     MOVE '1'       *IN87
091260200610     C                     SETON                     99U7U8
091270200610     C                     DUMP                                           S01117
091280200610     C                     GOTO EAUDIT
091290200610     C*
091300200610     C                     ENDSR
091310200610      *
091320200610      *****************************************************************
091330200610      /SPACE 3
091340200610      *****************************************************************
091350200610      *                                                               *
091360200610      *  POSASR - Subroutine for Error Handling of PF/POSETA.         *
091370200610      *                                                               *
091380200610      *****************************************************************
091390200610      *
091400200610     C           POSASR    BEGSR                              **POSASR**
091410200610     C*
091420200610     C           *LOCK     IN   LDA                                       S01117
091430200610     C                     MOVE 'POSETA'  DBFILE           ***************
091440200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 13 *
091450200610     C                     Z-ADD13        DBASE            ***************
091460200610     C                     MOVE STSPSA    DBSTAT
091470200610     C                     MOVE '1'       *IN87
091480200610     C                     SETON                     99U7U8
091490200610     C                     DUMP                                           S01117
091500200610     C                     GOTO EAUDIT
091510200610     C*
091520200610     C                     ENDSR
091530200610      *
091540200610      *****************************************************************
091550200610      /SPACE 3
091560200610      *****************************************************************
091570200610      *                                                               *
091580200610      *  MATDSR - Subroutine for Error Handling of PF/MATEXD.         *
091590200610      *                                                               *
091600200610      *****************************************************************
091610200610      *
091620200610     C           MATDSR    BEGSR                              **MATDSR**
091630200610     C*
091640200610     C           *LOCK     IN   LDA                                       S01117
091650200610     C                     MOVE 'MATEXD'  DBFILE           ***************
091660200610     C                     MOVEL'NONE'    DBKEY            * DB ERROR 14 *
091670200610     C                     Z-ADD14        DBASE            ***************
091680200610     C                     MOVE STSMTD    DBSTAT
091690200610     C                     MOVE '1'       *IN87
091700200610     C                     SETON                     99U7U8
091710200610     C                     DUMP                                           S01117
091720200610     C                     GOTO EAUDIT
091730200610     C*
091740200610     C                     ENDSR
091750200610      *
091760200610      *****************************************************************
091770200610      /SPACE 3
091780200610      *****************************************************************
091790200610      *                                                               *
091800200610      *  MATASR - Subroutine for Error Handling of PF/MATEXA.         *
091810200610      *                                                               *
091820200610      *****************************************************************
091830200610      *
091840200610     C           MATASR    BEGSR                              **MATASR**
091850200610     C*
091860200610     C           *LOCK     IN   LDA                                       S01117
091870200610     C                     MOVE 'MATEXA'  DBFILE           ***************
091880200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 15 *
091890200610     C                     Z-ADD15        DBASE            ***************
091900200610     C                     MOVE STSMTD    DBSTAT
091910200610     C                     MOVE '1'       *IN87
091920200610     C                     SETON                     99U7U8
091930200610     C                     DUMP                                           S01117
091940200610     C                     GOTO EAUDIT
091950200610     C*
091960200610     C                     ENDSR
091970200610      *
091980200610      *****************************************************************
091990200610      /SPACE 3
092000200610      *****************************************************************
092010200610      *                                                               *
092020200610      *  SEKASR - Subroutine for Error Handling of PF/SEKEYA.         *
092030200610      *                                                               *
092040200610      *****************************************************************
092050200610      *
092060200610     C           SEKASR    BEGSR                             **SEKASR**
092070200610     C*
092080200610     C           *LOCK     IN   LDA                                       S01117
092090200610     C                     MOVE 'SEKEYA'  DBFILE           ***************
092100200610     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 16 *
092110200610     C                     Z-ADD16        DBASE            ***************
092120200610     C                     MOVE STSSKA    DBSTAT
092130200610     C                     MOVE '1'       *IN87
092140200610     C                     SETON                     99U7U8
092150200610     C                     DUMP                                           S01117
092160200610     C                     GOTO EAUDIT
092170200610     C*
092180200610     C                     ENDSR
092190200610      *
092200200610      *****************************************************************
092210200610      /EJECT
092220200610      *****************************************************************
092230200610      *                                                               *
092240200610      *  FIRST  - Subroutine to access ICD Information.               *
092250200610      *                                                               *
092260200610      *****************************************************************
092270200610      *
092280200610     C           FIRST     BEGSR                           ** FIRST **
092290200610     C*
092300200610     C************NAMVAR   DEFN           LDA                             S01117
092310200610     C                     MOVE '1'       WLIT1
092320200610     C                     MOVE 'A'       WRTYP                           S01447
092330200610     C*
092340200610     C* ACCESS ICD    TABTB10
092350200610     C*
092360200610     C                     EXSR ZSYSTM
092370200610     C           *IN99     IFEQ '1'
092380200610     C                     MOVE '1'       *INU7
092390200610     C                     MOVE '1'       *INU8
092400200610     C           *LOCK     IN   LDA                                       S01117
092410200610     C                     MOVE 'TABLE'   DBFILE           ***************
092420200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 01 *
092430200610     C                     Z-ADD1         DBASE            ***************
092440200610     C                     DUMP                                           S01117
092450200610     C                     ELSE
092460200610     C*
092470200610     C* ACCESS ICD2   TABTB11
092480200610     C*
092490200610     C                     EXSR ZICD2
092500200610     C           *INU7     IFEQ '1'
092510200610     C                     MOVE '1'       *IN99
092520200610     C           *LOCK     IN   LDA                                       S01117
092530200610     C                     MOVE 'TABLE'   DBFILE           ***************
092540200610     C                     MOVELTABKEY    DBKEY            * DB ERROR 02 *
092550200610     C                     Z-ADD2         DBASE            ***************
092560200610     C                     DUMP                                           S01117
092570200610     C                     ELSE
092580200610      *                                                                   103361
092590200610      **Retrieve*account*code                                      103361 114458
092600200610      *                                                                   103361
092610200610     C**********           CALL 'AORETLR0'                         103361 114458
092620200610     C**********           PARM *BLANKS   @RTCD   7                103361 114458
092630200610     C**********           PARM '*FIRST'  @OPTN   7                103361 114458
092640200610     C********** SDRETL    PARM SDRETL    DSFDY                    103361 114458
092650200610     C********** @RTCD     IFNE *BLANKS                            103361 114458
092660200610     C********** *LOCK     IN   LDA                                103361 114458
092670200610     C**********           MOVEL*BLANK    DBKEY            ********103361*114458
092680200610     C**********           Z-ADD43        DBASE            * DB ERR103361*114458
092690200610     C**********           MOVEL'SDRETLL1'DBFILE           ********103361*114458
092700200610     C**********           SETON                       U7U8        103361 114458
092710200610     C**********           EXSR *PSSR                              103361 114458
092720200610     C**********           END                                     103361 114458
092730200610     C*
092740200610     C* ACCESS ICDSE  TABTB36
092750200610     C*
092760200610     C                     EXSR ZICDSE
092770200610     C           *INU7     IFEQ '1'
092780200610     C                     MOVE '1'       *IN99
092790200610     C           *LOCK     IN   LDA                                       S01117
092800200610     C                     MOVE 'TABLE'   DBFILE           ***************
092810200610     C                     MOVELZTABKY    DBKEY            * DB ERROR 03 *
092820200610     C                     Z-ADD3         DBASE            ***************
092830200610     C                     DUMP                                           S01117
092840200610     C                     END
092850200610     C                     END
092860200610     C                     END
092870200610     C/COPY WNCPYSRC,SE2400C022
092880200610     C*                                                                   S01486
092890200610     C**  Get module details using access object                          S01486
092900200610     C*                                                                   S01486
092910200610     C                     CALL 'AOMMODR0'                                S01486
092920200610     C                     PARM '*MSG   ' @RTCD                           S01486
092930200610     C                     PARM '*FIRST ' @OPTN                           S01486
092940200610     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
092950200610     C*                                                                   S01486
092960200610     C**  Check if error occurred                                         S01486
092970200610     C*                                                                   S01486
092980200610     C           @RTCD     IFNE *BLANKS                                   S01486
092990200610     C           *LOCK     IN   LDA                                       S01486
093000200610     C                     MOVEL'SDMMODPD'DBFILE           ***************S01486
093010200610     C                     Z-ADD23        DBASE            * DB ERROR 22 *S01486
093020200610     C                     SETON                       U7U8***************S01486
093030200610     C                     OUT  LDA                                       081239
093040200610     C                     EXSR *PSSR                                     S01486
093050200610     C                     END                                            S01486
093060200610     C*                                                                   S01486
093070200610     C*                                                                   063199
093080200610     C** Access SDGELRPD for profit centres used flag                     063199
093090200610     C*                                                                   063199
093100200610     C**********           CALL 'AOGELRR0'                                             063199 CGL029
093110200610     C                     CALL 'AOGELRR1'                                                    CGL029
093120200610     C                     PARM '*MSG   ' @RTCD   7                       063199
093130200610     C                     PARM '*FIRST ' @OPTN   7                       063199
093140200610     C********** SDGELR    PARM SDGELR    DSFDY                                        063199 CGL029
093150200610     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
093160200610     C*                                                                   063199
093170200610     C           @RTCD     IFNE *BLANKS                                   063199
093180200610     C           *LOCK     IN   LDA                                       063199
093190200610     C                     MOVEL'SDGELRPD'DBFILE           ***************063199
093200200610     C                     Z-ADD22        DBASE            * DB ERROR 22 *063199
093210200610     C                     SETON                       U7U8***************063199
093220200610     C                     EXSR *PSSR                                     063199
093230200610     C                     END                                            063199
093240200610     C*                                                                   S01486
093250200610     C* CHECK IF PORTFOLIO MANAGEMENT IS INSTALLED                        S01486
093260200610     C*                                                                   S01486
093270200610     C           BGPFMG    IFEQ 'Y'                                       S01486
093280200610     C           BGN4ST    OREQ 'Y'                                       CPB001
093290200610     C*                                                                   S01486
093300200610     C* READ PM INSTALLATION AND CONTROL DATA                             S01486
093310200610     C*                                                                   S01486
093320200610     C           BGPFMG    IFEQ 'Y'                                       CPB001
093330200610     C                     CALL 'AOPORTR0'                                S01486
093340200610     C                     PARM '*MSG'    @RTCD                           S01486
093350200610     C                     PARM '*FIRST ' @OPTN                           S01486
093360200610     C           SDPORT    PARM SDPORT    DSFDY                           S01486
093370200610     C*                                                                   S01486
093380200610     C           @RTCD     IFNE *BLANKS                                   S01486
093390200610     C           *LOCK     IN   LDA                                       S01486
093400200610     C                     MOVEL'SDPORTPD'DBFILE           ***************S01486
093410200610     C                     Z-ADD24        DBASE            * DB ERROR 24 *S01486
093420200610     C                     SETON                       U7U8***************S01486
093430200610     C                     EXSR *PSSR                                     S01486
093440200610     C                     END                                            S01486
093450200610     C                     ENDIF                                          CPB001
093460200610     C*                                                                   S01486
093470200610     C**  Open Portfolio Management files                                 S01486
093480200610     C*                                                                   S01486
093490200610     C                     OPEN PMPORTPD                                  S01486
093500200610     C***********          OPEN PMFPSNLL                           S01486 189942
093510200610     C***********          OPEN PMCPSSLL                           S01486 189942
093520200610     C***********          OPEN PMAPOSLL                           S01486 189942
093530200610     C                     OPEN PMACCNL0                                  S01486
093540200610     C                     OPEN PMACCNL1                                  219688
093550200610     C**********           OPEN SECET                                               S01486 BUG11104A
093560200610     C                     OPEN SEEVNT                                    S01486
093570200610     C*                                                                   S01486
093580200610     C                     END                                            S01486
093590200610     C                     OPEN SECET                                                      BUG11104A
093600200610     C*
093610200610      *                                                                   114458
093620200610      * Retrieve account code                                             114458
093630200610      *                                                                   114458
093640200610     C           BGRTBN    IFEQ 'Y'                                       114458
093650200610     C                     CALL 'AORETLR0'                                114458
093660200610     C                     PARM *BLANKS   @RTCD   7                       114458
093670200610     C                     PARM '*FIRST'  @OPTN   7                       114458
093680200610     C           SDRETL    PARM SDRETL    DSFDY                           114458
093690200610     C           @RTCD     IFNE *BLANKS                                   114458
093700200610     C           *LOCK     IN   LDA                                       114458
093710200610     C                     MOVEL*BLANK    DBKEY            ***************114458
093720200610     C                     Z-ADD43        DBASE            * DB ERROR 43 *114458
093730200610     C                     MOVEL'SDRETLL1'DBFILE           ***************114458
093740200610     C                     SETON                       U7U8               114458
093750200610     C                     EXSR *PSSR                                     114458
093760200610     C                     END                                            114458
093770200610     C                     END                                            114458
093780200610     C*                                                                   S01519
093790200610     C** Access Securities Trading file for the Autocharge option         S01519
093800200610     C*                                                                   S01519
093810200610     C                     CALL 'AOSTRDR0'                                S01519
093820200610     C                     PARM *BLANKS   @RTCD   7                       S01519
093830200610     C                     PARM '*FIRST ' @OPTN   7                       S01519
093840200610     C********** SDSTRD    PARM SDSTRD    DSFDY                                        S01519 CGL031
093850200610     C           SDSTRD    PARM SDSTRD    DSSDY                                               CGL031
093860200610     C*                                                                   S01519
093870200610     C           @RTCD     IFNE *BLANKS                                   S01519
093880200610     C                     SETON                     U7U899               S01519
093890200610     C           *LOCK     IN   LDA                                       S01519
093900200610     C                     MOVE 'SDSTRDPD'DBFILE           ***************S01519
093910200610     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 23 *S01519
093920200610     C                     Z-ADD23        DBASE            ***************S01519
093930200610     C                     EXSR *PSSR                                     S01519
093940200610     C                     END                                            S01519
093950200610     C*                                                                   S01446
093960200610     C** If Autocharge option is set to 'Y', check if Customer            S01446
093970200610     C** Commission (Courtage) is installed                               S01446
093980200610     C*                                                                   S01446
093990200610     C           BVACOP    IFEQ 'Y'                                       S01446
094000200610     C                     MOVE 'N'       S01446                          S01446
094010200610     C                     CALL 'AOSARDR0'                                S01446
094020200610     C                     PARM *BLANKS   @RTCD                           S01446
094030200610     C                     PARM '*VERIFY' @OPTN                           S01446
094040200610     C                     PARM 'S01446'  @SARD   6                       S01446
094050200610     C*                                                                   S01446
094060200610     C           @RTCD     IFEQ *BLANK                                    S01446
094070200610     C                     MOVE 'Y'       S01446  1                       S01446
094080200610     C*                                                                   S01446
094090200610     C** If it is and charge ccy is defined, get the spot rate            S01446
094100200610     C** and save multiply/divide indicator and number of dec places      S01446
094110200610     C** from SDCURRPD                                                    S01446
094120200610     C*                                                                   S01446
094130200610     C           BVCHRC    IFNE *BLANKS                                   S01446
094140200610     C                     MOVE BVCHRC    WCURR                           S01446
094150200610     C                     Z-ADD24        WDBAS1                          S01446
094160200610     C                     EXSR #LCURR                                    S01446
094170200610     C                     Z-ADDA6SPRT    TXSPOT 138                      S01446
094180200610     C                     MOVE A6MDIN    TXMDI   1                       S01446
094190200610     C                     MOVE A6NBDP    TXCDP   10                      S01446
094200200610     C                     END                                            S01446
094210200610     C                     END                                            S01446
094220200610     C                     END                                            S01446
094230200610      *                                                                   CSE026
094240200610      ** Check if Posn Settlement Default Charges by Customer Grp is On.  CSE026
094250200610      *                                                                   CSE026
094260200610     C                     CALL 'AOSARDR0'                                CSE026
094270200610     C                     PARM *BLANKS   @RTCD                           CSE026
094280200610     C                     PARM '*VERIFY' @OPTN                           CSE026
094290200610     C                     PARM 'S01496'  @SARD                           CSE026
094300200610     C           SCSARD    PARM SCSARD    DSSDY                           CSE026
094310200610      *                                                                   CSE026
094320200610     C           @RTCD     IFEQ *BLANKS                                   CSE026
094330200610     C                     MOVE 'Y'       S01496  1                       CSE026
094340200610     C                     ELSE                                           CSE026
094350200610      *                                                                   CSE026
094360200610      ** Error if return code other than '*NRF'                           CSE026
094370200610      *                                                                   CSE026
094380200610     C           @RTCD     IFNE '*NRF'                                    CSE026
094390200610     C           *LOCK     IN   LDA                                       CSE026
094400200610     C                     Z-ADD52        DBASE                           CSE026
094410200610     C                     MOVE 'SCSARDPD'DBFILE                          CSE026
094420200610     C                     MOVEL'*VERIFY' DBKEY                           CSE026
094430200610     C                     MOVE *ON       *INU7                           CSE026
094440200610     C                     MOVE *ON       *INU8                           CSE026
094450200610     C                     EXSR *PSSR                                     CSE026
094460200610     C                     ELSE                                           CSE026
094470200610     C                     MOVE 'N'       S01496                          CSE026
094480200610     C                     ENDIF                                          CSE026
094490200610      *                                                                   CSE026
094500200610     C                     ENDIF                                          CSE026
094510200610      *                                                                   CSE026
094520200610      ** If S01496 is On & Autocharge flag on Securities Trading ICD is   CSE026
094530200610      ** 'Y', set on Indicator 40.                                        CSE026
094540200610      *                                                                   CSE026
094550200610     C           S01496    IFEQ 'Y'                                       CSE026
094560200610     C           BVACOP    ANDEQ'Y'                                       CSE026
094570200610     C                     MOVE *ON       *IN40                           CSE026
094580200610     C                     OPEN SEDFGRL0                                  CSE026
094590200610     C                     ELSE                                           CSE026
094600200610     C                     MOVE *OFF      *IN40                           CSE026
094610200610     C                     ENDIF                                          CSE026
094620200610     C*
094630200610      *** Check Withholding tax is installed                              S01447
094640200610      *                                                                   S01447
094650200610     C                     CALL 'AOSARDR0'                                S01447
094660200610     C                     PARM *BLANKS   @RTCD                           S01447
094670200610     C                     PARM '*VERIFY' @OPTN                           S01447
094680200610     C                     PARM 'S01447'  @SARD   6                       S01447
094690200610      *                                                                   S01447
094700200610     C           @RTCD     IFEQ *BLANK                                    S01447
094710200610     C                     MOVE 'Y'       S01447  1                       S01447
094720200610     C                     ELSE                                           S01447
094730200610     C                     MOVE 'N'       S01447                          S01447
094740200610     C                     END                                            S01447
094750200610     C*                                                                   S01509
094760200610     C** Check if Value currency is installed                             S01509
094770200610     C*                                                                   S01509
094780200610     C                     CALL 'AOSARDR0'                                S01509
094790200610     C                     PARM *BLANKS   @RTCD                           S01509
094800200610     C                     PARM '*VERIFY' @OPTN                           S01509
094810200610     C                     PARM 'S01509'  @SARD   6                       S01509
094820200610     C*                                                                   S01509
094830200610     C           @RTCD     IFEQ *BLANK                                    S01509
094840200610     C                     MOVE 'Y'       S01509  1                       S01509
094850200610     C                     ELSE                                           S01509
094860200610     C                     MOVE 'N'       S01509                          S01509
094870200610     C                     END                                            S01509
094880200610     C*                                                                   S01510
094890200610     C** Check if Dividend Payments is installed                          S01510
094900200610     C*                                                                   S01510
094910200610     C                     CALL 'AOSARDR0'                                S01510
094920200610     C                     PARM *BLANKS   @RTCD                           S01510
094930200610     C                     PARM '*VERIFY' @OPTN                           S01510
094940200610     C                     PARM 'S01510'  @SARD   6                       S01510
094950200610     C*                                                                   S01510
094960200610     C           @RTCD     IFEQ *BLANK                                    S01510
094970200610     C                     MOVE 'Y'       S01510  1                       S01510
094980200610     C                     ELSE                                           S01510
094990200610     C                     MOVE 'N'       S01510                          S01510
095000200610     C                     END                                            S01510
095010200610     C*                                                                   S01512
095020200610     C** Check if Position Settlements is installed                       S01512
095030200610     C*                                                                   S01512
095040200610     C                     CALL 'AOSARDR0'                                S01512
095050200610     C                     PARM *BLANKS   @RTCD                           S01512
095060200610     C                     PARM '*VERIFY' @OPTN                           S01512
095070200610     C                     PARM 'S01512'  @SARD   6                       S01512
095080200610     C*                                                                   S01512
095090200610     C           @RTCD     IFEQ *BLANK                                    S01512
095100200610     C                     MOVE 'Y'       S01512  1                       S01512
095110200610     C                     ELSE                                           S01512
095120200610     C                     MOVE 'N'       S01512                          S01512
095130200610     C                     END                                            S01512
095140200610     C*                                                                   S01519
095150200610     C** Check if Position Settlements Automatic Charges is installed     S01519
095160200610     C*                                                                   S01519
095170200610     C                     CALL 'AOSARDR0'                                S01519
095180200610     C                     PARM *BLANKS   @RTCD                           S01519
095190200610     C                     PARM '*VERIFY' @OPTN                           S01519
095200200610     C                     PARM 'S01519'  @SARD   6                       S01519
095210200610     C*                                                                   S01519
095220200610     C           @RTCD     IFEQ *BLANK                                    S01519
095230200610     C                     MOVE 'Y'       S01519  1                       S01519
095240200610     C                     ELSE                                           S01519
095250200610     C                     MOVE 'N'       S01519                          S01519
095260200610     C                     END                                            S01519
095270200610     C*                                                                   CEU005
095280200610     C** Check if EMU Settlement Ccy Conversion is installed              CEU005
095290200610     C*                                                                   CEU005
095300200610     C                     CALL 'AOSARDR0'                                CEU005
095310200610     C                     PARM *BLANKS   @RTCD                           CEU005
095320200610     C                     PARM '*VERIFY' @OPTN                           CEU005
095330200610     C                     PARM 'CEU005'  @SARD   6                       CEU005
095340200610     C*                                                                   CEU005
095350200610     C           @RTCD     IFEQ *BLANK                                    CEU005
095360200610     C                     MOVE 'Y'       CEU005  1                       CEU005
095370200610     C                     ELSE                                           CEU005
095380200610     C                     MOVE 'N'       CEU005                          CEU005
095390200610     C                     END                                            CEU005
095400200610      *                                                                   CSE023
095410200610      ** Check if CSE023 - Treaty withholding Tax is switched ON          CSE023
095420200610      *                                                                   CSE023
095430200610     C                     CALL 'AOSARDR0'                                CSE023
095440200610     C                     PARM *BLANKS   @RTCD                           CSE023
095450200610     C                     PARM '*VERIFY' @OPTN                           CSE023
095460200610     C                     PARM 'CSE023'  @SARD   6                       CSE023
095470200610      *                                                                   CSE023
095480200610     C           @RTCD     IFEQ *BLANK                                    CSE023
095490200610     C                     MOVE 'Y'       CSE023  1                       CSE023
095500200610     C                     ELSE                                           CSE023
095510200610     C                     MOVE 'N'       CSE023                          CSE023
095520200610     C                     ENDIF                                          CSE023
095530200610      *                                                                                       CSE028
095540200610      ** Check if CSE028 - MT5xx Standing Settlements Instructions is                         CSE028
095550200610      **   is switched on.                                                                    CSE028
095560200610      *                                                                                       CSE028
095570200610     C                     CALL 'AOSARDR0'                                                    CSE028
095580200610     C                     PARM *BLANKS   @RTCD                                               CSE028
095590200610     C                     PARM '*VERIFY' @OPTN                                               CSE028
095600200610     C                     PARM 'CSE028'  @SARD                                               CSE028
095610200610      *                                                                                       CSE028
095620200610     C           @RTCD     IFEQ *BLANK                                                        CSE028
095630200610     C                     MOVE 'Y'       CSE028  1                                           CSE028
095640200610     C                     ELSE                                                               CSE028
095650200610     C                     MOVE 'N'       CSE028                                              CSE028
095660200610     C                     ENDIF                                                              CSE028
095670200610      *                                                                                       CSE035
095680200610      ** Access SAR details file to see if CSE035 is installed                                CSE035
095690200610      *                                                                                       CSE035
095700200610     C                     CALL 'AOSARDR0'                                                    CSE035
095710200610     C                     PARM *BLANKS   @RTCD                                               CSE035
095720200610     C                     PARM '*VERIFY' @OPTN                                               CSE035
095730200610     C                     PARM 'CSE035'  @SARD                                               CSE035
095740200610      *                                                                                       CSE035
095750200610     C           @RTCD     IFEQ *BLANK                                                        CSE035
095760200610     C                     MOVE 'Y'       CSE035  1                                           CSE035
095770200610     C                     ELSE                                                               CSE035
095780200610     C                     MOVE 'N'       CSE035                                              CSE035
095790200610     C                     ENDIF                                                              CSE035
095800200610      *                                                                                       CSE035
095810200610      *                                                                                       CGL020
095820200610      ** Determine if Midas Compliance Watch is installed                                     CGL020
095830200610      *                                                                                       CGL020
095840200610     C                     MOVE 'N'       CGL020  1                                           CGL020
095850200610     C                     CALL 'AOSARDR0'                                                    CGL020
095860200610     C                     PARM '       ' @RTCD                                               CGL020
095870200610     C                     PARM '*VERIFY' @OPTN                                               CGL020
095880200610     C                     PARM 'CGL020'  @SARD                                               CGL020
095890200610     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
095900200610      *                                                                                       CGL020
095910200610     C           @RTCD     IFNE *BLANK                                                        CGL020
095920200610     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
095930200610     C           *LOCK     IN   LDA                                                           CGL020
095940200610     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
095950200610     C                     Z-ADD25        DBASE                                               CGL020
095960200610     C                     MOVEL@SARD     DBKEY                                               CGL020
095970200610     C                     OUT  LDA                                                           CGL020
095980200610     C                     MOVE *ON       *INU7                                               CGL020
095990200610     C                     MOVE *ON       *INU8                                               CGL020
096000200610     C                     MOVE *ON       *INLR                                               CGL020
096010200610     C                     EXSR *PSSR                                                         CGL020
096020200610      *                                                                                       CGL020
096030200610     C                     ELSE                                                               CGL020
096040200610     C                     MOVE 'Y'       CGL020                                              CGL020
096050200610     C                     ENDIF                                                              CGL020
096060200610      *                                                                                       CGL031
096070200610      ** Check if CGL031 - Taxation of Savings Income                                         CGL031
096080200610      **   is switched on.                                                                    CGL031
096090200610      *                                                                                       CGL031
096100200610     C                     CALL 'AOSARDR0'                                                    CGL031
096110200610     C                     PARM *BLANKS   P@RTCD  7                                           CGL031
096120200610     C                     PARM '*VERIFY' P@OPTN  7                                           CGL031
096130200610     C                     PARM 'CGL031'  P@SARD  6                                           CGL031
096140200610      *                                                                                       CGL031
096150200610     C           P@RTCD    IFEQ *BLANK                                                        CGL031
096160200610     C                     MOVE 'Y'       CGL031  1                                           CGL031
096170200610     C                     ELSE                                                               CGL031
096180200610     C                     MOVE 'N'       CGL031                                              CGL031
096190200610     C                     ENDIF                                                              CGL031
096200200610      *                                                                                     AR853119
096210200610      ** Check if CER049 - Stamp Tax is switch on                                           AR853119
096220200610      *                                                                                     AR853119
096230200610     C                     CALL 'AOSARDR0'                                                  AR853119
096240200610     C                     PARM *BLANKS   P@RTCD                                            AR853119
096250200610     C                     PARM '*VERIFY' P@OPTN                                            AR853119
096260200610     C                     PARM 'CER049'  P@SARD                                            AR853119
096270200610      *                                                                                     AR853119
096280200610     C           P@RTCD    IFEQ *BLANK                                                      AR853119
096290200610     C                     MOVE 'Y'       CER049  1                                         AR853119
096300200610     C                     ELSE                                                             AR853119
096310200610     C                     MOVE 'N'       CER049                                            AR853119
096320200610     C                     ENDIF                                                            AR853119
096330200610      **********                                                                AR1001183 AR1001183A
096340200610      ***Check*if*CRE073*is*switched*on                                         AR1001183 AR1001183A
096350200610      **********                                                                AR1001183 AR1001183A
096360200610     C**********           CALL 'AOSARDR0'                                      AR1001183 AR1001183A
096370200610     C**********           PARM           @RTCD                                 AR1001183 AR1001183A
096380200610     C**********           PARM '*VERIFY' @OPTN                                 AR1001183 AR1001183A
096390200610     C**********           PARM 'CRE073'  @SARD                                 AR1001183 AR1001183A
096400200610      **********                                                                AR1001183 AR1001183A
096410200610      ***Process*database*error                                                 AR1001183 AR1001183A
096420200610      **********                                                                AR1001183 AR1001183A
096430200610     C********** @RTCD     IFEQ *BLANKS                                         AR1001183 AR1001183A
096440200610     C**********           MOVE 'Y'       CRE073  1                             AR1001183 AR1001183A
096450200610     C**********           ELSE                                                 AR1001183 AR1001183A
096460200610     C**********           MOVE 'N'       CRE073                                AR1001183 AR1001183A
096470200610     C**********           ENDIF                                                AR1001183 AR1001183A
096480200610      *                                                                                       CGL031
096490200610      ** Access Bank Details                                                                  CGL031
096500200610      *                                                                                       CGL031
096510200610     C                     CALL 'AOBANKR0'                                                    CGL031
096520200610     C                     PARM *BLANKS   P@RTCD                                              CGL031
096530200610     C                     PARM '*FIRST ' P@OPTN                                              CGL031
096540200610     C           SDBANK    PARM SDBANK    DSFDY                                               CGL031
096550200610      *                                                                                       CGL031
096560200610     C           P@RTCD    IFNE *BLANK                                                        CGL031
096570200610     C                     MOVE 'SDBANKPD'DBFILE                                              CGL031
096580200610     C                     MOVE '*FIRST ' DBKEY                                               CGL031
096590200610     C                     Z-ADD64        DBASE                                               CGL031
096600200610     C                     MOVE *ON       *INU7                                               CGL031
096610200610     C                     MOVE *ON       *INU8                                               CGL031
096620200610     C                     EXSR *PSSR                                                         CGL031
096630200610     C                     ENDIF                                                              CGL031
096640200610      *                                                                                       219566
096650200610      **  Access SDSAVLPD for Default settlement account to portfolio 001 indicator (Y/N)     219566
096660200610     C                     CALL 'AOSVALR0'                                                    219566
096670200610     C                     PARM *BLANKS   RTNCDE  7                                           219566
096680200610     C                     PARM           SVALK1 20                                           219566
096690200610     C                     PARM           SVAL1 200                                           219566
096700200610     C                     PARM           SVALK2 20                                           219566
096710200610     C                     PARM           SVAL2 200                                           219566
096720200610     C                     PARM           SVALK3 20                                           219566
096730200610     C                     PARM           SVAL3 200                                           219566
096740200610     C                     PARM           SVALK4 20                                           219566
096750200610     C                     PARM           SVAL4 200                                           219566
096760200610     C                     PARM           SVALK5 20                                           219566
096770200610     C                     PARM           SVAL5 200                                           219566
096780200610     C                     PARM           SVALK6 20                                           219566
096790200610     C                     PARM           SVAL6 200                                           219566
096800200610     C                     PARM           SVALK7 20                                           219566
096810200610     C                     PARM           SVAL7 200                                           219566
096820200610     C                     PARM           SVALK8 20                                           219566
096830200610     C                     PARM           SVAL8 200                                           219566
096840200610     C                     PARM           SVALK9 20                                           219566
096850200610     C                     PARM           SVAL9 200                                           219566
096860200610     C                     PARM           SVALK0 20                                           219566
096870200610     C                     PARM           SVAL10200                                           219566
096880200610      *                                                                                       219566
096890200610     C           RTNCDE    IFNE *BLANKS                                                       219566
096900200610     C           *LOCK     IN   LDA                                                           219566
096910200610     C                     MOVE SVALK1    DBKEY            * DB ERROR 47 *                    219566
096920200610     C                     Z-ADD47        DBASE                                               219566
096930200610     C                     MOVE 'SDSVALPD'DBFILE                                              219566
096940200610     C                     MOVEL'SE2400'  DBPGM                                               219566
096950200610     C                     OUT  LDA                                                           219566
096960200610     C                     SETON                     U7U8LR                                   219566
096970200610     C                     EXSR *PSSR                                                         219566
096980200610     C                     ENDIF                                                              219566
096990200610      *                                                                                       219566
097000200610      ** Access SAR details file to check CSE110 feature if installed.                        CSE110
097010200610      *                                                                                       CSE110
097020200610     C                     MOVE 'N'       CSE110  1                                           CSE110
097030200610     C                     CALL 'AOSARDR0'                                                    CSE110
097040200610     C                     PARM *BLANKS   @RTCD                                               CSE110
097050200610     C                     PARM '*VERIFY' @OPTN                                               CSE110
097060200610     C                     PARM 'CSE110'  @SARD                                               CSE110
097070200610     C           SCSARD    PARM SCSARD    DSFDY                                               CSE110
097080200610      *                                                                                       CSE110
097090200610     C                     SELEC                                                              CSE110
097100200610     C           @RTCD     WHEQ *BLANK                                                        CSE110
097110200610     C                     MOVE *ON       *IN71                                               CSE110
097120200610     C                     MOVE 'Y'       CSE110                                              CSE110
097130200610     C           @RTCD     WHEQ '*NRF'                                                        CSE110
097140200610     C                     MOVE *OFF      *IN71                                               CSE110
097150200610     C                     MOVE 'N'       CSE110                                              CSE110
097160200610     C                     OTHER                                                              CSE110
097170200610     C           *LOCK     IN   LDA                                                           CSE110
097180200610     C                     MOVEL'SCSARDPD'DBFILE            *************                     CSE110
097190200610     C                     MOVEL'028'     DBASE             *DBERROR 028*                     CSE110
097200200610     C                     MOVEL@OPTN     DBKEY             *************                     CSE110
097210200610     C                     SETON                     U7U8LR                                   CSE110
097220200610     C                     OUT  LDA                                                           CSE110
097230200610     C                     EXSR *PSSR                                                         CSE110
097240200610     C                     ENDSL                                                              CSE110
097250200610      *                                                                   S01447
097260200610      ***  Define like field definitions                                  S01447
097270200610      *                                                                   S01447
097280200610      *                                                                   S01408
097290200610     C/COPY WNCPYSRC,SE2400CCP4                                           S01408
097300200610      *                                                                   S01408
097310200610     C           *LIKE     DEFN CLOC      UBRLOC           brch ctry      S01447
097320200610     C           *LIKE     DEFN S1RASO    UTXRSR           src tax rate   S01447
097330200610     C           *LIKE     DEFN TBRASR    UTXRRF           ref tax rate   S01447
097340200610     C           *LIKE     DEFN TBRAUS    UTXRUS           usr tax rate   S01447
097350200610     C           *LIKE     DEFN TBDLOR    UDLOR            ded.tax local  S01447
097360200610     C* Set up the pgm name                                                                   234440
097370200610     C*                                                                                       234440
097380200610     C                     MOVEL'SEETCPRT'WPGM    9                                           234440
097390200610     C                     MOVE 'V'       WPGM                                                234440
097400200610     C*                                                                                       234440
097410200610     C*                                                                   S01447
097420200610     C                     ENDSR
097430200610      *****************************************************************                    AR1001183
097440200610      ***/SPACE*3                                                               AR1001183 AR1001183A
097450200610      *****************************************************************                    AR1001183
097460200610      *****************************************************************         AR1001183 AR1001183A
097470200610      ***GETNCR*-*Subroutien*to*get*next*coupon*rate*******************         AR1001183 AR1001183A
097480200610      *****************************************************************         AR1001183 AR1001183A
097490200610      *****************************************************************         AR1001183 AR1001183A
097500200610      **********                                                                AR1001183 AR1001183A
097510200610     C********** GETNCR    BEGSR                                                AR1001183 AR1001183A
097520200610      **********                                                                AR1001183 AR1001183A
097530200610     C**********           Z-ADDBASC      UBASC                                 AR1001183 AR1001183A
097540200610     C**********           Z-ADDBASS      UBASS                                 AR1001183 AR1001183A
097550200610     C**********           MOVE SPRI      USPRI                                 AR1001183 AR1001183A
097560200610     C**********           MOVELCNSP      UCNSP                                 AR1001183 AR1001183A
097570200610     C**********           MOVELCNSG      UCNSG                                 AR1001183 AR1001183A
097580200610     C**********           MOVELRDMT      URDMT                                 AR1001183 AR1001183A
097590200610     C**********           MOVELRDFD      URDFD                                 AR1001183 AR1001183A
097600200610      ***Initialize*work*fields                                                 AR1001183 AR1001183A
097610200610      **********                                                                AR1001183 AR1001183A
097620200610     C**********           MOVEL*BLANKS   WAD                                   AR1001183 AR1001183A
097630200610     C**********           MOVEL*BLANKS   WBR                                   AR1001183 AR1001183A
097640200610     C**********           MOVEL*BLANKS   WBS                                   AR1001183 AR1001183A
097650200610     C**********           MOVEL*BLANKS   WSI                                   AR1001183 AR1001183A
097660200610     C**********           MOVEL*BLANKS   WRM                                   AR1001183 AR1001183A
097670200610     C**********           MOVEL*BLANKS   WRF                                   AR1001183 AR1001183A
097680200610      **********                                                                AR1001183 AR1001183A
097690200610      ***LOAD*APPLICABLE*DATE*INTO*ARRAY                                        AR1001183 AR1001183A
097700200610     C**********           Z-ADDAD01      WAD,1                                 AR1001183 AR1001183A
097710200610     C**********           Z-ADDAD02      WAD,2                                 AR1001183 AR1001183A
097720200610     C**********           Z-ADDAD03      WAD,3                                 AR1001183 AR1001183A
097730200610     C**********           Z-ADDAD04      WAD,4                                 AR1001183 AR1001183A
097740200610     C**********           Z-ADDAD05      WAD,5                                 AR1001183 AR1001183A
097750200610     C**********           Z-ADDAD06      WAD,6                                 AR1001183 AR1001183A
097760200610     C**********           Z-ADDAD07      WAD,7                                 AR1001183 AR1001183A
097770200610     C**********           Z-ADDAD08      WAD,8                                 AR1001183 AR1001183A
097780200610     C**********           Z-ADDAD09      WAD,9                                 AR1001183 AR1001183A
097790200610     C**********           Z-ADDAD10      WAD,10                                AR1001183 AR1001183A
097800200610      **********                                                                AR1001183 AR1001183A
097810200610      ***LOAD*BASE*RATE*INTO*ARRAY                                              AR1001183 AR1001183A
097820200610     C**********           Z-ADDBR01      WBR,1                                 AR1001183 AR1001183A
097830200610     C**********           Z-ADDBR02      WBR,2                                 AR1001183 AR1001183A
097840200610     C**********           Z-ADDBR03      WBR,3                                 AR1001183 AR1001183A
097850200610     C**********           Z-ADDBR04      WBR,4                                 AR1001183 AR1001183A
097860200610     C**********           Z-ADDBR05      WBR,5                                 AR1001183 AR1001183A
097870200610     C**********           Z-ADDBR06      WBR,6                                 AR1001183 AR1001183A
097880200610     C**********           Z-ADDBR07      WBR,7                                 AR1001183 AR1001183A
097890200610     C**********           Z-ADDBR08      WBR,8                                 AR1001183 AR1001183A
097900200610     C**********           Z-ADDBR09      WBR,9                                 AR1001183 AR1001183A
097910200610     C**********           Z-ADDBR10      WBR,10                                AR1001183 AR1001183A
097920200610      **********                                                                AR1001183 AR1001183A
097930200610     C**********           Z-ADDCNP01     WBS,1                                 AR1001183 AR1001183A
097940200610     C**********           Z-ADDCNP02     WBS,2                                 AR1001183 AR1001183A
097950200610     C**********           Z-ADDCNP03     WBS,3                                 AR1001183 AR1001183A
097960200610     C**********           Z-ADDCNP04     WBS,4                                 AR1001183 AR1001183A
097970200610     C**********           Z-ADDCNP05     WBS,5                                 AR1001183 AR1001183A
097980200610     C**********           Z-ADDCNP06     WBS,6                                 AR1001183 AR1001183A
097990200610     C**********           Z-ADDCNP07     WBS,7                                 AR1001183 AR1001183A
098000200610     C**********           Z-ADDCNP08     WBS,8                                 AR1001183 AR1001183A
098010200610     C**********           Z-ADDCNP09     WBS,9                                 AR1001183 AR1001183A
098020200610     C**********           Z-ADDCNP10     WBS,10                                AR1001183 AR1001183A
098030200610      **********                                                                AR1001183 AR1001183A
098040200610      ***LOAD*CONTRACTUAL*SPREAD*INDICATOR*INTO*ARRAY                           AR1001183 AR1001183A
098050200610      **********                                                                AR1001183 AR1001183A
098060200610     C**********           MOVEACNG01     WSI,1                                 AR1001183 AR1001183A
098070200610     C**********           MOVEACNG02     WSI,2                                 AR1001183 AR1001183A
098080200610     C**********           MOVEACNG03     WSI,3                                 AR1001183 AR1001183A
098090200610     C**********           MOVEACNG04     WSI,4                                 AR1001183 AR1001183A
098100200610     C**********           MOVEACNG05     WSI,5                                 AR1001183 AR1001183A
098110200610     C**********           MOVEACNG06     WSI,6                                 AR1001183 AR1001183A
098120200610     C**********           MOVEACNG07     WSI,7                                 AR1001183 AR1001183A
098130200610     C**********           MOVEACNG08     WSI,8                                 AR1001183 AR1001183A
098140200610     C**********           MOVEACNG09     WSI,9                                 AR1001183 AR1001183A
098150200610     C**********           MOVEACNG10     WSI,10                                AR1001183 AR1001183A
098160200610      **********                                                                AR1001183 AR1001183A
098170200610      ***LOAD*ROUNDING*METHOD*INTO*ARRAY                                        AR1001183 AR1001183A
098180200610      **********                                                                AR1001183 AR1001183A
098190200610     C**********           MOVELRDM01     WRM,1                                 AR1001183 AR1001183A
098200200610     C**********           MOVELRDM02     WRM,2                                 AR1001183 AR1001183A
098210200610     C**********           MOVELRDM03     WRM,3                                 AR1001183 AR1001183A
098220200610     C**********           MOVELRDM04     WRM,4                                 AR1001183 AR1001183A
098230200610     C**********           MOVELRDM05     WRM,5                                 AR1001183 AR1001183A
098240200610     C**********           MOVELRDM06     WRM,6                                 AR1001183 AR1001183A
098250200610     C**********           MOVELRDM07     WRM,7                                 AR1001183 AR1001183A
098260200610     C**********           MOVELRDM08     WRM,8                                 AR1001183 AR1001183A
098270200610     C**********           MOVELRDM09     WRM,9                                 AR1001183 AR1001183A
098280200610     C**********           MOVELRDM10     WRM,10                                AR1001183 AR1001183A
098290200610      **********                                                                AR1001183 AR1001183A
098300200610      ***LOAD*ROUNDING*FRACTION/DECIMAL*INTO*ARRAY                              AR1001183 AR1001183A
098310200610      **********                                                                AR1001183 AR1001183A
098320200610     C**********           MOVELRDF01     WRF,1                                 AR1001183 AR1001183A
098330200610     C**********           MOVELRDF02     WRF,2                                 AR1001183 AR1001183A
098340200610     C**********           MOVELRDF03     WRF,3                                 AR1001183 AR1001183A
098350200610     C**********           MOVELRDF04     WRF,4                                 AR1001183 AR1001183A
098360200610     C**********           MOVELRDF05     WRF,5                                 AR1001183 AR1001183A
098370200610     C**********           MOVELRDF06     WRF,6                                 AR1001183 AR1001183A
098380200610     C**********           MOVELRDF07     WRF,7                                 AR1001183 AR1001183A
098390200610     C**********           MOVELRDF08     WRF,8                                 AR1001183 AR1001183A
098400200610     C**********           MOVELRDF09     WRF,9                                 AR1001183 AR1001183A
098410200610     C**********           MOVELRDF10     WRF,10                                AR1001183 AR1001183A
098420200610      ***CHECK*IF*THE*NEXT*COUPON*DATE*IS*GREATER*OR*EQUAL*TO*ANY*OF            AR1001183 AR1001183A
098430200610      ***THE*ADDITIONAL*COUPON*DATES.*IF*IT*IS*THAN*USE*THE*BASE*RATE           AR1001183 AR1001183A
098440200610      ***INFORMATION*SUPPLIED.                                                  AR1001183 AR1001183A
098450200610      **********                                                                AR1001183 AR1001183A
098460200610     C**********           MOVE 'N'       WAPP    1                             AR1001183 AR1001183A
098470200610     C**********           Z-ADD10        X       20                            AR1001183 AR1001183A
098480200610      **********                                                                AR1001183 AR1001183A
098490200610     C********** X         DOWGT0                                               AR1001183 AR1001183A
098500200610      **********                                                                AR1001183 AR1001183A
098510200610     C********** WAD,X     IFNE *ZERO                                           AR1001183 AR1001183A
098520200610      **********                                                                AR1001183 AR1001183A
098530200610      ***CONVERT*DATE*TO*DAY*NUMBER                                             AR1001183 AR1001183A
098540200610     C**********           Z-ADDWAD,X     ZDATE                                 AR1001183 AR1001183A
098550200610     C**********           EXSR ZDATE1                                          AR1001183 AR1001183A
098560200610      **********                                                                AR1001183 AR1001183A
098570200610     C********** WDAT      IFGE ZDAYNO                                          AR1001183 AR1001183A
098580200610     C**********           MOVE 'Y'       WAPP                                  AR1001183 AR1001183A
098590200610     C**********           LEAVE                                                AR1001183 AR1001183A
098600200610     C**********           ENDIF                                                AR1001183 AR1001183A
098610200610      **********                                                                AR1001183 AR1001183A
098620200610     C**********           ENDIF                                                AR1001183 AR1001183A
098630200610     C**********           SUB  1         X                                     AR1001183 AR1001183A
098640200610     C**********           ENDDO                                                AR1001183 AR1001183A
098650200610      **********                                                                AR1001183 AR1001183A
098660200610      ***USE*RATE*FROM*ADDITIONAL*COUPON*DATE*INFORMATION                       AR1001183 AR1001183A
098670200610     C********** WAPP      IFEQ 'Y'                                             AR1001183 AR1001183A
098680200610      **********                                                                AR1001183 AR1001183A
098690200610      ***SET*NEW*BASE*RATE                                                      AR1001183 AR1001183A
098700200610     C********** WBR,X     IFNE *ZERO                                           AR1001183 AR1001183A
098710200610     C**********           Z-ADDWBR,X     UBASC                                 AR1001183 AR1001183A
098720200610     C**********           ENDIF                                                AR1001183 AR1001183A
098730200610      **********                                                                AR1001183 AR1001183A
098740200610      ***SET*NEW*SPREAD*RATE                                                    AR1001183 AR1001183A
098750200610     C********** WBS,X     IFNE *ZERO                                           AR1001183 AR1001183A
098760200610     C**********           Z-ADDWBS,X     UBASS                                 AR1001183 AR1001183A
098770200610     C**********           ENDIF                                                AR1001183 AR1001183A
098780200610      **********                                                                AR1001183 AR1001183A
098790200610      ***SET*NEW*SPREAD*INDICATOR                                               AR1001183 AR1001183A
098800200610     C**********           MOVEAWSI,X     USPRI                                 AR1001183 AR1001183A
098810200610      **********                                                                AR1001183 AR1001183A
098820200610      ** SET ROUNDING METHOD                                                    AR1001183 AR1001183A
098830200610      **********                                                                AR1001183 AR1001183A
098840200610     C**********           MOVELWRM,X     URDMT                                 AR1001183 AR1001183A
098850200610      **********                                                                AR1001183 AR1001183A
098860200610      ***SET*ROUNDING*FRACTION/DECIMAL                                          AR1001183 AR1001183A
098870200610      **********                                                                AR1001183 AR1001183A
098880200610     C**********           MOVELWRF,X     URDFD                                 AR1001183 AR1001183A
098890200610      **********                                                                AR1001183 AR1001183A
098900200610     C**********           ENDIF                                                AR1001183 AR1001183A
098910200610      **********                                                                AR1001183 AR1001183A
098920200610     C********** UBASC     IFGT 0                                               AR1001183 AR1001183A
098930200610     C********** UBASS     ORGT 0                                               AR1001183 AR1001183A
098940200610      **********                                                                AR1001183 AR1001183A
098950200610      ***OBTAIN*BASE*RATE*INFO*FROM*SDBSRTPD                                    AR1001183 AR1001183A
098960200610     C**********           MOVE UBASC     PBSRC   2                             AR1001183 AR1001183A
098970200610      **********                                                                AR1001183 AR1001183A
098980200610     C**********           CALL 'AOBSRTR0'                                      AR1001183 AR1001183A
098990200610     C**********           PARM *BLANKS   @RTCD                                 AR1001183 AR1001183A
099000200610     C**********           PARM '*KEY   ' @OPTN                                 AR1001183 AR1001183A
099010200610     C**********           PARM VLCY      PCCY    3                             AR1001183 AR1001183A
099020200610     C**********           PARM           PBSRC                                 AR1001183 AR1001183A
099030200610     C********** SDBSRT    PARM SDBSRT    DSFDY                                 AR1001183 AR1001183A
099040200610      **********                                                                AR1001183 AR1001183A
099050200610     C********** @RTCD     IFNE *BLANKS                                         AR1001183 AR1001183A
099060200610     C**********           MOVELVLCY      WKEY2   5                             AR1001183 AR1001183A
099070200610     C**********           MOVE UBASC     WKEY2                                 AR1001183 AR1001183A
099080200610     C**********           Z-ADD69        DBASE                                 AR1001183 AR1001183A
099090200610     C**********           MOVEL'SDBSRTPD'DBFILE                                AR1001183 AR1001183A
099100200610     C**********           MOVELWKEY2     DBKEY                                 AR1001183 AR1001183A
099110200610     C**********           EXSR *PSSR                                           AR1001183 AR1001183A
099120200610     C**********           ENDIF                                                AR1001183 AR1001183A
099130200610      **********                                                                AR1001183 AR1001183A
099140200610      ***USE*NEW*BASE*RATE*IF*APPROPRIATE,*OTHERWISE*USE*CURRENT*RATE           AR1001183 AR1001183A
099150200610     C********** BAVDNR    IFLE WDAT                                            AR1001183 AR1001183A
099160200610     C**********           Z-ADDBANBRT    USDNC  117                            AR1001183 AR1001183A
099170200610     C**********           ELSE                                                 AR1001183 AR1001183A
099180200610     C**********           Z-ADDBACBSR    USDNC                                 AR1001183 AR1001183A
099190200610     C**********           ENDIF                                                AR1001183 AR1001183A
099200200610      **********                                                                AR1001183 AR1001183A
099210200610     C**********           CALL SPRDSR                                          AR1001183 AR1001183A
099220200610     C**********           PARM *BLANKS   PRTCD                                 AR1001183 AR1001183A
099230200610     C**********           PARM           BANBRT                                AR1001183 AR1001183A
099240200610     C**********           PARM           UBASS                                 AR1001183 AR1001183A
099250200610     C**********           PARM           USPRI                                 AR1001183 AR1001183A
099260200610     C**********           PARM           URDMT                                 AR1001183 AR1001183A
099270200610     C**********           PARM           URDFD                                 AR1001183 AR1001183A
099280200610     C**********           PARM *ZERO     NSPRD  117                            AR1001183 AR1001183A
099290200610     C**********           PARM *ZERO     FRATE  117                            AR1001183 AR1001183A
099300200610      **********                                                                AR1001183 AR1001183A
099310200610     C********** PRTCD     IFNE *BLANK                                          AR1001183 AR1001183A
099320200610     C********** *LOCK     IN   LDA                                             AR1001183 AR1001183A
099330200610     C**********           Z-ADD70        DBASE                                 AR1001183 AR1001183A
099340200610     C**********           MOVELSPRDSR    DBPGM                                 AR1001183 AR1001183A
099350200610     C**********           MOVELBANBRT    DBKEY                                 AR1001183 AR1001183A
099360200610     C**********           OUT  LDA                                             AR1001183 AR1001183A
099370200610     C**********           EXSR *PSSR                                           AR1001183 AR1001183A
099380200610     C**********           ENDIF                                                AR1001183 AR1001183A
099390200610      **********                                                                AR1001183 AR1001183A
099400200610     C**********           Z-ADDFRATE     WPSXR  138                            AR1001183 AR1001183A
099410200610     C**********           MOVE 'Y'       WRCHG                                 AR1001183 AR1001183A
099420200610      **********                                                                AR1001183 AR1001183A
099430200610      ***Override*value*of*PSXR*if*final*rate*<=*zero                           AR1001183 AR1001183A
099440200610      **********                                                                AR1001183 AR1001183A
099450200610     C********** FRATE     IFLE 0                                               AR1001183 AR1001183A
099460200610     C**********           Z-ADD0         WPSXR                                 AR1001183 AR1001183A
099470200610     C**********           ENDIF                                                AR1001183 AR1001183A
099480200610      **********                                                                AR1001183 AR1001183A
099490200610     C**********           ENDIF                                                AR1001183 AR1001183A
099500200610      **********                                                                AR1001183 AR1001183A
099510200610     C**********           ENDSR                                                AR1001183 AR1001183A
099520200610      **********                                                                AR1001183 AR1001183A
099521200616     C********************************************************************                  AR324886
099522200616     C/EJECT                                                                                AR324886
099523200616     C********************************************************************                  AR324886
099524200616     C           PSAUDT    BEGSR                                                            AR324886
099525200616      *                                                                                     AR324886
099526200616     C                     MOVE RECI      PARECI                                            AR324886
099527200616     C                     MOVE PBCA      PAPBCA                                            AR324886
099528200616     C                     MOVE PSSH      PAPSSH                                            AR324886
099529200616     C                     MOVE PCPY      PAPCPY                                            AR324886
099530200616     C                     MOVE PDUD      PAPDUD                                            AR324886
099531200616     C                     MOVE PEVT      PAPEVT                                            AR324886
099532200616     C                     MOVE PTFR      PAPTFR                                            AR324886
099533200616     C                     MOVE TNLU      PATNLU                                            AR324886
099534200616     C                     MOVE TXBS      PATXBS                                            AR324886
099535200616     C                     MOVE BNFO      PABNFO                                            AR324886
099536200616     C                     MOVE EXCD      PAEXCD                                            AR324886
099537200616     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
099538200616     C                     MOVE LCD       PALCD                                             AR324886
099539200616     C                     MOVE CHTP      PALCTP                                            AR324886
099540200616     C                     WRITEPSAUTDF                                                     AR324886
099541200616      *                                                                                     AR324886
099542200616     C                     ENDSR                                                            AR324886
099543200610      *****************************************************************
099544200610      /EJECT                                                              S01117
099550200610      *****************************************************************   S01117
099560200610      *                                                               *   S01117
099570200610      *  *PSSR  - Error control subroutine                            *   S01117
099580200610      *                                                               *   S01117
099590200610      *****************************************************************   S01117
099600200610      *                                                                   S01117
099610200610     C           *PSSR     BEGSR                           ** *PSSR **    S01117
099620200610     C**                                                                  S01117
099630200610     C           @RUN      IFEQ *BLANKS                                   S01117
099640200610     C                     MOVE 'Y'       @RUN    1                       S01117
099650200610     C                     DUMP                                           S01117
099660200610     C                     END                                            S01117
099670200610     C**                                                                  S01117
099680200610     C                     ENDSR                                          S01117
099690200610      *                                                                   S01117
099700200610     C*****************************************************************
099710200610      /EJECT                                                              S01512
099720200610     C*                                                                   S01486
099730200610     C********************************************************************S01486
099740200610     C**  ZTNLU1     :       TO LOCK THE TRANSACTION NUMBER DATA AREA,    S01486
099750200610     C**                     ACCESS THE NEXT AVAILABLE TRANSACTION NUMBER,S01486
099760200610     C**                     THEN UPDATE AND RELEASE THE DATA AREA.       S01486
099770200610     C********************************************************************S01486
099780200610     C           ZTNLU1    BEGSR                            ** ZTNLU1 BSR*S01486
099790200610     C*                                                                   S01486
099800200610     C           *NAMVAR   DEFN MNATN     DNATN                           S01486
099810200610     C           *LOCK     IN   DNATN                                     S01486
099820200610     C                     MOVE FNATN     NATN    50                      S01486
099830200610     C                     MOVE FNATN     ZZWK05  50                      S01486
099840200610     C                     ADD  1         ZZWK05                          S01486
099850200610     C                     MOVE ZZWK05    FNATN                           S01486
099860200610     C                     OUT  DNATN                                     S01486
099870200610     C*                                                                   S01486
099880200610     C                     ENDSR                            ** ZTNLU1 ESR*S01486
099890200610     C********************************************************************S01486
099900200610     C/COPY WNCPYSRC,SE2400C023
099910200610      /EJECT                                                              064754
099920200610     C/COPY ZSRSRC,ZNCDZ3                                                 064754
099930200610      /EJECT
099940200610     C/COPY ZSRSRC,ZACCH                                                  S01512
099950200610      /EJECT                                                              S01519
099960200610     C/COPY ZSRSRC,ZAVPRZ1                                                S01519
099970200610      /EJECT                                                              S01519
099980200610     C/COPY ZSRSRC,ZCCAL1Z2                                               S01519
099990200610      /EJECT                                                              S01519
100000200610     C/COPY ZSRSRC,ZCCAL2Z1                                               S01519
100010200610      /EJECT
100020200610     C/COPY ZSRSRC,ZCNSDZ1                                                E22638
100030200610      /EJECT                                                              S01512
100040200610     C/COPY ZSRSRC,ZCONVZ1                                                S01509
100050200610      /EJECT                                                              S01512
100060200610     C/COPY ZSRSRC,ZFWDT                                                  S01512
100070200610     C/EJECT                                                              E22638
100080200610     C/COPY ZSRSRC,ZCCYGBZ1                                               S01486
100090200610     C/COPY ZSRSRC,ZCCYCN                                                 S01486
100100200610     C/COPY ZSRSRC,ZCCYXR                                                 S01486
100110200610     C/COPY ZSRSRC,ZAINSH                                                 S01486
100120200610     C*****************************************************************   S01486
100130200610     C*                                                               *   S01486
100140200610     C*  ZAISCH - CALCULATE SE ACCRUED INTEREST - SCHULDSCHEIN        *   S01486
100150200610     C*                                                               *   S01486
100160200610     C*  PURPOSE : TO CALCULATE SE ACCRUED INTEREST FOR               *   S01486
100170200610     C*            SCHULDSCHEIN SECURITIES                            *   S01486
100180200610     C*                                                               *   S01486
100190200610     C*  FILE USED                                                    *   S01486
100200200610     C*       LF/SEEVNT: SECURITY EVENTS FILE OVERRIDEN IN CALLING PGM*   S01486
100210200610     C*       FIELDS TO BE RENAMED IN I SPECS:                        *   S01486
100220200610     C*         SNDT (SNDEVD) TO SDED                                 *   S01486
100230200610     C*         SNET (SNDEVD) TO SDET                                 *   S01486
100240200610     C*       LF/PMAPOSLL:ALL PORTFOLIO POSITIONS                     *   S01486
100250200610     C*                                                               *   S01486
100260200610     C*  FILES NEEDED (THESE FILES AND DATA AREA MUST HAVE BEEN       *   S01486
100270200610     C*                ACCESSED BEFORE THIS SUBROUTINE IS EXECUTED)   *   S01486
100280200610     C*       LF/SECTY: SECURITIES                                    *   S01486
100290200610     C*       LF/INVTP: INVESTMENT TYPES                              *   S01486
100300200610     C*       LF/SDCURRL0: CURRENCIES, FOR NOMINAL CURRENCY D.P.      *   S01486
100310200610     C*       DTAARA/PMSTAT: FOR EVENT CONTROL DATE                   *   S01486
100320200610     C*                                                               *   S01486
100330200610     C*  SUBROUTINES NEEDED                                           *   S01486
100340200610     C*       ZNCD MUST HAVE BEEN CALLED BEFORE CALLING THIS SUBR.    *   S01486
100350200610     C*                                                               *   S01486
100360200610     C*  INPUT  FIELDS                                                *   S01486
100370200610     C*       ZFMDAT  5 0     FROM DATE                               *   S01486
100380200610     C*       ZTODAT  5 0     TO DATE                                 *   S01486
100390200610     C*       XCUST   6 0     CUSTOMER                                *   S01486
100400200610     C*       ZPTRF   4       PORTFOLIO REFERENCE                     *   S01486
100410200610     C*       ZSSNM  10       SECURITY SHORTNAME                      *   S01486
100420200610     C********ZTVBS   1       TRADE/VALUE BASIS                *   S01486 189942
100430200610     C*                                                               *   S01486
100440200610     C*  OUTPUT  FIELDS                                               *   S01486
100450200610     C*       ZTOAI  15 0     TOTAL ACCRUED INTEREST                  *   S01486
100460200610     C*       ZTOND   5 0     TOTAL NUMBER OF INTEREST DAYS           *   S01486
100470200610     C*                                                               *   S01486
100480200610     C*  WORK FIELDS:                                                 *   S01486
100490200610     C*                                                               *   S01486
100500200610     C*  CALLS:  ZRATE, ZACCR                                         *   S01486
100510200610     C*****************************************************************   S01486
100520200610     C           ZAISCH    BEGSR                           *** ZAISCH *** S01486
100530200610     C*                                                                   S01486
100540200610     C** DEFINE FIELDS                                                    S01486
100550200610     C                     Z-ADDZFMDAT    ZFMDAT  50                      S01486
100560200610     C                     Z-ADDZTODAT    ZTODAT  50                      S01486
100570200610     C                     MOVE ZCDPA     ZCDPA   3                       189942
100580200610     C**********           Z-ADDXCUST     XCUST   60                                   S01486 CSD027
100590200610     C                     MOVE XCUST     XCUST   6                                           CSD027
100600200610     C                     MOVE ZPTRF     ZPTRF   4                       S01486
100610200610     C                     MOVE ZSSNM     ZSSNM  10                       S01486
100620200610     C***********          MOVE ZTVBS     ZTVBS   1                S01486 189942
100630200610     C**********           Z-ADDZCDDP     ZCDDP   60                                   189942 CSD027
100640200610     C                     MOVE ZCDDP     ZCDDP   6                                           CSD027
100650200610     C                     MOVE ZCDMK     ZCDMK   1                       189942
100660200610     C*                                                                   S01486
100670200610     C** SET THE TOTAL ACCRUED INTEREST ZTOAI AND TOTAL NUMBER OF         S01486
100680200610     C** INTEREST DAYS ZTOND EQUAL TO ZERO                                S01486
100690200610     C                     Z-ADD0         ZTOAI  150                      S01486
100700200610     C                     Z-ADD0         ZTOND   50                      S01486
100710200610     C                     Z-ADD0         ZSINP  150                      S01486
100720200610     C*                                                                   S01486
100730200610     C           KSEE1     KLIST                                          S01486
100740200610     C                     KFLD           ZSSNM                           S01486
100750200610     C                     KFLD           ZFMDAT                          S01486
100760200610     C                     KFLD           ZTYP                            S01486
100770200610     C*                                                                   S01486
100780200610     C***SET*GREATER*THAN LIMITS ON LF/PMAPOSLL WITH A KEY OF CUSTOS01486 189942
100790200610     C***ZCUST,*PORTFOLIO*ZPTRF,*SECURITY*ZSSNM*AND*TRADE/VALUE*DATS01486 189942
100800200610     C***XCUST,*PORTFOLIO*ZPTRF,*SECURITY ZSSNM AND TRADE/VALUE DATS01486 189942
100810200610     C***BASIS*ZTVBS*AND*A*DATE EQUAL TO THE FROM DATE ZFMDAT      S01486 189942
100820200610     C***********KPMA1     KLIST                                   S01486 189942
100830200610     C***********          KFLD           XCUST                    S01486 189942
100840200610     C***********          KFLD           ZPTRF                    S01486 189942
100850200610     C***********          KFLD           ZSSNM                    S01486 189942
100860200610     C***********          KFLD           ZTVBS                    S01486 189942
100870200610     C***********          KFLD           ZFMDAT                   S01486 189942
100880200610     C***********KPMA1     SETGTPMAPOSLL                           S01486 189942
100890200610     C***********                                                  S01486 189942
100900200610     C***READ*PREVIOUS*FROM LF/PMAPOSLL                            S01486 189942
100910200610     C***********          READPPMAPOSLL                 91        S01486 189942
100920200610     C*                                                                   189942
100930200610     C           KPMA1     KLIST                                          189942
100940200610     C                     KFLD           ZCDPA                           189942
100950200610     C                     KFLD           XCUST                           189942
100960200610     C                     KFLD           ZPTRF                           189942
100970200610     C                     KFLD           ZSSNM                           189942
100980200610     C                     KFLD           ZCDDP                           189942
100990200610     C                     KFLD           ZCDMK                           189942
101000200610     C                     KFLD           ZFMDAT                          189942
101010200610     C*                                                                   189942
101020200610     C           KPMA1     SETGTSECDEPL5                                  189942
101030200610     C*                                                                   189942
101040200610     C** READ PREVIOUS FROM LF/SECDEPL5                                   189942
101050200610     C                     READPSECDEPL5                 91               189942
101060200610     C*                                                                   S01486
101070200610     C** IF THE CUSTOMER, PORTFOLIO, SECURITY AND TRADE/VALUE DATE        S01486
101080200610     C***BASIS*ON*LF/PMAPOSLL ARE THE SAME AS IN THE KEY ABOVE     S01486 189942
101090200610     C***********XCUST     IFEQ QACNUM                             S01486 189942
101100200610     C***********ZPTRF     ANDEQQAPTFR                             S01486 189942
101110200610     C***********ZSSNM     ANDEQQATDSS                             S01486 189942
101120200610     C***********ZTVBS     ANDEQQATVDA                             S01486 189942
101130200610     C** BASIS ON LF/SECDEPL5 ARE THE SAME AS IN THE KEY ABOVE            189942
101140200610     C           ZCDPA     IFEQ CDPA                                      189942
101150200610     C           XCUST     ANDEQCDCN                                      189942
101160200610     C           ZPTRF     ANDEQPTFR                                      189942
101170200610     C           ZPTRF     ANDEQPTFR                                      189942
101180200610     C           ZSSNM     ANDEQCDSN                                      189942
101190200610     C           ZCDDP     ANDEQCDPT                                      189942
101200200610     C           ZCDMK     ANDEQCDMK                                      189942
101210200610     C*                                                                   S01486
101220200610     C** SUBTRACT THE EX-COUPON NOMINAL FROM THE NOMINAL (BOTH FROM       S01486
101230200610     C***LF/PMAPOSLL)*AND*PUT THE RESULT IN PRINCIPAL AMOUNT ZAMT  S01486 189942
101240200610     C** LF/SECDEPL5) AND PUT THE RESULT IN PRINCIPAL AMOUNT ZAMT         189942
101250200610     C***********QANOML    SUB  QACSEX    ZAMT                     S01486 189942
101260200610     C********** CDNV      SUB  CSEX      ZAMT                                       189942 AR877365
101270200610     C           CDNV      SUB  CECN      ZAMT                                              AR877365
101280200610     C                     ELSE                                           S01486
101290200610     C*                                                                   S01486
101300200610     C** IF THEY ARE DIFFERENT OR EOF IS REACHED, SET THE PRINCIPAL       S01486
101310200610     C** AMOUNT ZAMT EQUAL TO ZERO                                        S01486
101320200610     C                     Z-ADD0         ZAMT                            S01486
101330200610     C                     END                                            S01486
101340200610     C*                                                                   S01486
101350200610     C** SET THE FOLLOWING FIELDS FOR STANDARD SUBROUTINE ZRATE           S01486
101360200610     C** SET ZPPCP EQUAL TO CPDP FROM LF/SECTY                            S01486
101370200610     C                     Z-ADDCPDP      ZPPCP                           S01486
101380200610     C** SET ZSFPP EQUAL TO SFPP FROM LF/SECTY                            S01486
101390200610     C                     Z-ADDSFPP      ZSFPP                           S01486
101400200610     C** SET ZSINP EQUAL TO SINP FROM LF/SECTY                            S01486
101410200610     C                     Z-ADDSINP      ZSINP                           S01486
101420200610     C** SET ZPPDI EQUAL TO PPDI FROM LF/SECTY                            S01486
101430200610     C                     MOVE PPDI      ZPPDI                           S01486
101440200610     C** SET ZCPNR EQUAL TO CPNR FROM LF/SECTY                            S01486
101450200610     C                     Z-ADDCPNR      ZCPNR                           S01486
101460200610     C** SET ZCFCT EQUAL TO CFCT FROM LF/SECTY                            S01486
101470200610     C                     Z-ADDCFCT      ZCFCT                           S01486
101480200610     C** SET ZPROT EQUAL TO PROT FROM LF/INVTP                            S01486
101490200610     C                     MOVE PROT      ZPROT                           S01486
101500200610     C*                                                                   S01486
101510200610     C** SET THE FOLLOWING FIELDS FOR STANDARD SUBROUTINE ZACCR           S01486
101520200610     C                     Z-ADDA6NBDP    ZCDP                            S01486
101530200610     C*                                                                   S01486
101540200610     C** ACCESS LF/SEEVNT USING A KEY OF SECURITY ZSSNM, FROM DATE        S01486
101550200610     C** ZFMDAT AND EVENT TYPE EQUAL TO 'CP'                              S01486
101560200610     C                     MOVEL'CP'      ZTYP    2                       S01486
101570200610     C           KSEE1     CHAINSEEVNT               91                   S01486
101580200610     C           *IN91     IFEQ '0'                                       S01486
101590200610     C*                                                                   S01486
101600200610     C** IF A LAST COUPON DATE EVENT IS READ ABOVE, (NOTE THAT ZFMDAT     S01486
101610200610     C** WILL BE A COUPON DATE) THEN SET THE FIELDS USED BY ZRATE         S01486
101620200610     C** AS FOLLOWS:                                                      S01486
101630200610     C** SET ZCPNR EQUAL TO SNCR FROM LF/SEEVNT                           S01486
101640200610     C                     Z-ADDSNCR      ZCPNR                           S01486
101650200610     C** SET ZCFCT EQUAL TO SNCF FROM LF/SEEVNT                           S01486
101660200610     C                     Z-ADDSNCF      ZCFCT                           S01486
101670200610     C** SET ZPPCP EQUAL TO SNCP FROM LF/SEEVNT                           S01486
101680200610     C                     Z-ADDSNCP      ZPPCP                           S01486
101690200610     C                     END                                            S01486
101700200610     C*                                                                   S01486
101710200610     C** SET START OF INTEREST PERIOD DATE ZSDATE EQUAL TO THE FROM       S01486
101720200610     C** DATE ZFMDAT                                                      S01486
101730200610     C                     Z-ADDZFMDAT    ZSDATE                          S01486
101740200610     C*                                                                   S01486
101750200610     C** SET GREATER THAN LIMITS ON LF/SEEVNT USING A KEY OF SECURITY     S01486
101760200610     C** ZSSNM, FROM DATE ZFMDAT AND EVENT TYPE EQUAL TO 'CP'             S01486
101770200610     C           KSEE1     SETGTSEEVNT                                    S01486
101780200610     C*                                                                   S01486
101790200610     C** READ EQUAL FROM LF/SEEVNT WITH A KEY EQUAL TO THE SECURITY       S01486
101800200610     C** SHORTNAME ZSSNM                                                  S01486
101810200610     C           ZSSNM     READESEEVNT                   91               S01486
101820200610     C*                                                                   S01486
101830200610     C** READ UNTIL THE EVENT HAS AN EVENT TYPE SDET EQUAL TO 'PP' 'MP' OR 'IR'
101840200610     C*                                                                   S01486
101850200610     C           *IN91     DOWEQ'0'                                       S01486
101860200610     C           SDET      ANDNE'PP'                                      S01486
101870200610     C           SDET      ANDNE'MP'                                      S01486
101880200610     C           SDET      ANDNE'IR'                                      S01486
101890200610     C           ZSSNM     READESEEVNT                   91               S01486
101900200610     C                     END                                            S01486
101910200610     C*                                                                   S01486
101920200610     C** SET GREATER THAN LIMITS ON LF/PMAPOSLL WITH A KEY OF CUSTOMER    S01486
101930200610     C***ZCUST,*PORTFOLIO*ZPTRF,*SECURITY*ZSSNM*AND*TRADE/VALUE*DATE      S01486
101940200610     C** XCUST, PORTFOLIO ZPTRF, SECURITY ZSSNM AND TRADE/VALUE DATE      S01486
101950200610     C** BASIS ZTVBS AND A DATE EQUAL TO THE FROM DATE ZFMDAT             S01486
101960200610     C***********KPMA1     SETGTPMAPOSLL                           S01486 189942
101970200610     C           KPMA1     SETGTSECDEPL5                                  189942
101980200610     C*                                                                   S01486
101990200610     C***READ*EQUAL*FROM*LF/PMAPOSLL*WITH*THE*CUSTOMER*ZCUST,*PORTFOLIO   S01486
102000200610     C***READ*EQUAL*FROM LF/PMAPOSLL WITH THE CUSTOMER XCUST, PORT S01486 189942
102010200610     C** READ EQUAL FROM LF/SECDEPL5 WITH THE CUSTOMER XCUST, PORTFOLIO   189942
102020200610     C** ZPTRF, SECURITY ZSSNM AND TRADE/VALUE DATE BASIS ZTVBS           S01486
102030200610     C***********KPMA2     KLIST                                   S01486 189942
102040200610     C***********          KFLD           XCUST                    S01486 189942
102050200610     C***********          KFLD           ZPTRF                    S01486 189942
102060200610     C***********          KFLD           ZSSNM                    S01486 189942
102070200610     C***********          KFLD           ZTVBS                    S01486 189942
102080200610     C***********KPMA2     READEPMAPOSLL                 92        S01486 189942
102090200610     C           KPMA2     KLIST                                          189942
102100200610     C                     KFLD           ZCDPA                           189942
102110200610     C                     KFLD           XCUST                           189942
102120200610     C                     KFLD           ZPTRF                           189942
102130200610     C                     KFLD           ZSSNM                           189942
102140200610     C                     KFLD           ZCDDP                           189942
102150200610     C                     KFLD           ZCDMK                           189942
102160200610     C           KPMA2     READESECDEPL5                 92               189942
102170200610     C*                                                                   S01486
102180200610     C** DO WHILE NOT END OF FILE (IE. SAME SECURITY) ON LF/SEEVNT        S01486
102190200610     C** AND NOT END OF FILE (IE. SAME CUSTOMER, PORTFOLIO, SECURITY,     S01486
102200200610     C** TRADE/VALUE BASIS) ON LF/PMAPOSLL                                S01486
102210200610     C           *IN91     DOWEQ'0'                                       S01486
102220200610     C           *IN92     OREQ '0'                                       S01486
102230200610     C*                                                                   S01486
102240200610     C** IF NOT END OF FILE ON LF/SEEVNT                                  S01486
102250200610     C           *IN91     IFEQ '0'                                       S01486
102260200610     C*                                                                   S01486
102270200610     C** IF NOT END OF FILE ON LF/PMAPOSLL AND THE EVENT DATE SDED        S01486
102280200610     C** FROM LF/SEEVNT IS LESS THAN OR EQUAL TO THE POSITION DATE        S01486
102290200610     C** FROM LF/PMAPOSLL OR END OF FILE ON LF/PMAPOSLL                   S01486
102300200610     C           *IN92     IFEQ '0'                                       S01486
102310200610     C***********SDED      ANDLEQAPDAT                             S01486 189942
102320200610     C           SDED      ANDLEDDTE                                      189942
102330200610     C           SDED      ANDLTZTODAT                                    S01486
102340200610     C           *IN92     OREQ '1'                                       S01486
102350200610     C           SDED      ANDLTZTODAT                                    S01486
102360200610     C*                                                                   S01486
102370200610     C** SET THE END OF INTEREST PERIOD DATE ZEDATE EQUAL TO THE EVENT    S01486
102380200610     C** DATE SDED FROM LF/SEEVNT                                         S01486
102390200610     C                     Z-ADDSDED      ZEDATE                          S01486
102400200610     C*                                                                   S01486
102410200610     C** EXECUTE STANDARD SUBROUTINE ZRATE TO GET THE EFFECTIVE           S01486
102420200610     C** INTEREST RATE FOR THE PERIOD                                     S01486
102430200610     C                     EXSR ZRATE                                     S01486
102440200610     C*                                                                   S01486
102450200610     C** EXECUTE STANDARD SUBROUTINE ZACCR TO CALCULATE THE INTEREST      S01486
102460200610     C** FOR THE PERIOD                                                   S01486
102470200610     C                     EXSR ZACCR                                     S01486
102480200610     C/COPY WNCPYSRC,SE2400C052
102490200610     C*                                                                   S01486
102500200610     C** ADD THE ACCRUED INTEREST ZACCRD FROM ZACCR TO THE TOTAL          S01486
102510200610     C** ACCRUED INTEREST ZTOAI                                           S01486
102520200610     C                     ADD  ZACCRD    ZTOAI                           S01486
102530200610     C*                                                                   S01486
102540200610     C** ADD THE NUMBER OF DAYS ZDDAYS FROM ZACCR TO THE TOTAL NUMBER     S01486
102550200610     C** OF INTEREST DAYS ZTOND                                           S01486
102560200610     C                     ADD  ZDDAYS    ZTOND                           S01486
102570200610     C*                                                                   S01486
102580200610     C** SET THE START OF INTEREST PERIOD DATE ZSDATE EQUAL TO THE        S01486
102590200610     C** EVENT DATE SDED FROM LF/SEEVNT                                   S01486
102600200610     C                     Z-ADDSDED      ZSDATE                          S01486
102610200610     C*                                                                   S01486
102620200610     C** SET THE FOLLOWING FIELDS USED BY ZRATE AS FOLLOWS:               S01486
102630200610     C** SET ZCPNR EQUAL TO SDNC FROM LF/SEEVNT                           S01486
102640200610     C** SET ZCFCT EQUAL TO SDCP FROM LF/SEEVNT                           S01486
102650200610     C** SET ZPPCP EQUAL TO SDTP FROM LF/SEEVNT                           S01486
102660200610     C                     Z-ADDSDNC      ZCPNR                           S01486
102670200610     C                     Z-ADDSDCP      ZCFCT                           S01486
102680200610     C                     MOVE SDTP      ZPPCP                           S01486
102690200610     C*                                                                   S01486
102700200610     C** READ EQUAL FROM LF/SEEVNT WITH THE SECURITY SHORTNAME ZSSNM      S01486
102710200610     C           ZSSNM     READESEEVNT                   91               S01486
102720200610     C*                                                                   S01486
102730200610     C** READ UNTIL THE EVENT HAS AN EVENT TYPE SDET EQUAL TO 'PP' 'MP' OR 'IR'
102740200610     C*                                                                   S01486
102750200610     C           *IN91     DOWEQ'0'                                       S01486
102760200610     C           SDET      ANDNE'PP'                                      S01486
102770200610     C           SDET      ANDNE'MP'                                      S01486
102780200610     C           SDET      ANDNE'IR'                                      S01486
102790200610     C           ZSSNM     READESEEVNT                   91               S01486
102800200610     C                     END                                            S01486
102810200610     C*                                                                   S01486
102820200610     C** ELSE, IF EVENT DATE SDED FROM LF/SEEVNT IS GREATER THAN OR       S01486
102830200610     C** EQUAL TO TO DATE PARAMETER, TREAT AS END OF FILE ON LF/SEEVNT    S01486
102840200610     C                     ELSE                                           S01486
102850200610     C           SDED      IFGE ZTODAT                                    S01486
102860200610     C                     MOVE '1'       *IN91                           S01486
102870200610     C                     END                                            S01486
102880200610     C*                                                                   S01486
102890200610     C                     END                                            S01486
102900200610     C                     END                                            S01486
102910200610     C*                                                                   S01486
102920200610     C***IF*NOT*END*OF*FILE ON LF/PMAPOSLL                         S01486 189942
102930200610     C** IF NOT END OF FILE ON LF/SECDEPL5                                189942
102940200610     C           *IN92     IFEQ '0'                                       S01486
102950200610     C*                                                                   S01486
102960200610     C** IF NOT END OF FILE ON LF/SEEVNT AND THE POSITION DATE FROM       S01486
102970200610     C***LF/PMAPOSLL*IS*LESS THAN THE EVENT DATE SDED FROM         S01486 189942
102980200610     C** LF/SECDEPL5 IS LESS THAN THE EVENT DATE SDED FROM                189942
102990200610     C** LF/SEEVNT OR END OF FILE ON LF/SEEVNT                            S01486
103000200610     C           *IN91     IFEQ '0'                                       S01486
103010200610     C***********QAPDAT    ANDLTSDED                               S01486 189942
103020200610     C***********QAPDAT    ANDLTZTODAT                             S01486 189942
103030200610     C           DDTE      ANDLTSDED                                      189942
103040200610     C           DDTE      ANDLTZTODAT                                    189942
103050200610     C           *IN91     OREQ '1'                                       S01486
103060200610     C***********QAPDAT    ANDLTZTODAT                             S01486 189942
103070200610     C           DDTE      ANDLTZTODAT                                    189942
103080200610     C*                                                                   S01486
103090200610     C** SET THE END OF INTEREST PERIOD DATE ZEDATE EQUAL TO THE          S01486
103100200610     C***POSITION*DATE*QAPDAT*FROM LF/PMAPOSLL                     S01486 189942
103110200610     C** POSITION DATE DDTE FROM LF/SECDEPL5                              189942
103120200610     C***********          Z-ADDQAPDAT    ZEDATE                   S01486 189942
103130200610     C                     Z-ADDDDTE      ZEDATE                          189942
103140200610     C*                                                                   S01486
103150200610     C** EXECUTE STANDARD SUBROUTINE ZRATE TO GET THE EFFECTIVE           S01486
103160200610     C** INTEREST RATE FOR THE PERIOD                                     S01486
103170200610     C                     EXSR ZRATE                                     S01486
103180200610     C*                                                                   S01486
103190200610     C** EXECUTE STANDARD SUBROUTINE ZACCR TO CALCULATE THE INTEREST      S01486
103200200610     C** FOR THE PERIOD                                                   S01486
103210200610     C                     EXSR ZACCR                                     S01486
103220200610     C/COPY WNCPYSRC,SE2400C053
103230200610     C*                                                                   S01486
103240200610     C** ADD THE ACCRUED INTEREST ZACCRD FROM ZACCR TO THE TOTAL          S01486
103250200610     C** ACCRUED INTEREST ZTOAI                                           S01486
103260200610     C                     ADD  ZACCRD    ZTOAI                           S01486
103270200610     C*                                                                   S01486
103280200610     C** ADD THE NUMBER OF DAYS ZDDAYS FROM ZACCR TO THE TOTAL NUMBER     S01486
103290200610     C** OF INTEREST DAYS ZTOND                                           S01486
103300200610     C                     ADD  ZDDAYS    ZTOND                           S01486
103310200610     C*                                                                   S01486
103320200610     C** SET THE START OF INTEREST PERIOD DATE ZSDATE EQUAL TO THE        S01486
103330200610     C***POSITION*DATE*QAPDAT FROM LF/PMAPOSLL                     S01486 189942
103340200610     C***********          Z-ADDQAPDAT    ZSDATE                   S01486 189942
103350200610     C** POSITION DATE DDTE   FROM LF/SECDEPL5                            189942
103360200610     C                     Z-ADDDDTE      ZSDATE                          189942
103370200610     C*                                                                   S01486
103380200610     C** SUBTRACT THE EX-COUPON NOMINAL FROM THE NOMINAL (BOTH FROM       S01486
103390200610     C***LF/PMAPOSLL)*AND*PUT THE RESULT IN PRINCIPAL AMOUNT ZAMT  S01486 189942
103400200610     C***********QANOML    SUB  QACSEX    ZAMT                     S01486 189942
103410200610     C** LF/SECDEPL5) AND PUT THE RESULT IN PRINCIPAL AMOUNT ZAMT         189942
103420200610     C********** CDNV      SUB  CSEX      ZAMT                                       189942 AR877365
103430200610     C           CDNV      SUB  CECN      ZAMT                                              AR877365
103440200610     C*                                                                   S01486
103450200610     C***READ*EQUAL*FROM*LF/PMAPOSLL*WITH*THE*CUSTOMER*ZCUST,*PORTFOLIO   S01486
103460200610     C***READ*EQUAL*FROM*LF/PMAPOSLL WITH THE CUSTOMER XCUST, PORT S01486 189942
103470200610     C** READ EQUAL FROM LF/SECDEPL5 WITH THE CUSTOMER XCUST, PORTFOLIO   189942
103480200610     C** ZPTRF, SECURITY ZSSNM AND TRADE/VALUE BASIS ZTVBS                S01486
103490200610     C***********KPMA2     READEPMAPOSLL                 92        S01486 189942
103500200610     C           KPMA2     READESECDEPL5                 92               189942
103510200610     C*                                                                   S01486
103520200610     C***ELSE,*IF*POSITION*DATE QAPDAT FROM LF/PMAPOSLL IS GREATER S01486 189942
103530200610     C** ELSE, IF POSITION DATE DDTE FROM LF/SECDEPL5 IS GREATER THAN     189942
103540200610     C** OR EQUAL TO TO DATE PARAMETER, TREAT AS END OF FILE ON           S01486
103550200610     C***LF/PMAPOSLL*******                                        S01486 189942
103560200610     C** LF/SECDEPL5                                                      189942
103570200610     C                     ELSE                                           S01486
103580200610     C***********QAPDAT    IFGE ZTODAT                             S01486 189942
103590200610     C           DDTE      IFGE ZTODAT                                    189942
103600200610     C                     MOVE '1'       *IN92                           S01486
103610200610     C                     END                                            S01486
103620200610     C*                                                                   S01486
103630200610     C                     END                                            S01486
103640200610     C                     END                                            S01486
103650200610     C                     END                                            S01486
103660200610     C*                                                                   S01486
103670200610     C** SET THE END OF INTEREST PERIOD DATE ZEDATE EQUAL TO THE TO       S01486
103680200610     C** DATE ZTODAT                                                      S01486
103690200610     C                     Z-ADDZTODAT    ZEDATE                          S01486
103700200610     C*                                                                   S01486
103710200610     C** EXECUTE STANDARD SUBROUTINE ZRATE TO GET THE EFFECTIVE           S01486
103720200610     C** INTEREST RATE FOR THE PERIOD                                     S01486
103730200610     C                     EXSR ZRATE                                     S01486
103740200610     C*                                                                   S01486
103750200610     C** EXECUTE STANDARD SUBROUTINE ZACCR TO CALCULATE THE INTEREST      S01486
103760200610     C** FOR THE PERIOD                                                   S01486
103770200610     C                     EXSR ZACCR                                     S01486
103780200610     C/COPY WNCPYSRC,SE2400C054
103790200610     C*                                                                   S01486
103800200610     C** ADD THE ACCRUED INTEREST ZACCRD FROM ZACCR TO THE TOTAL          S01486
103810200610     C** ACCRUED INTEREST ZTOAI                                           S01486
103820200610     C                     ADD  ZACCRD    ZTOAI                           S01486
103830200610     C*                                                                   S01486
103840200610     C** ADD THE NUMBER OF DAYS ZDDAYS FROM ZACCR TO THE TOTAL NUMBER     S01486
103850200610     C** OF INTEREST DAYS ZTOND                                           S01486
103860200610     C                     ADD  ZDDAYS    ZTOND                           S01486
103870200610     C*                                                                   S01486
103880200610     C           EAISCH    ENDSR                                          S01486
103890200610     C*****************************************************************   S01486
103900200610     C/COPY ZSRSRC,ZACCRZ1                                                S01486
103910200610     C/COPY ZSRSRC,ZRATEZ1                                                S01486
103920200610     C/COPY ZSRSRC,ZDYYRZ3                                                S01486
103930200610     C/COPY ZSRSRC,ZDAYSZ2                                                S01486
103940200610     C/COPY ZSRSRC,ZDATE1Z2                                               S01486
103950200610     C/COPY ZSRSRC,ZDATE2Z2                                               S01486
103960200610     C/COPY ZSRSRC,ZLCDZ1                                                 S01486
103970200610      /EJECT                                                              S01509
103980200610     C/COPY ZSRSRC,ZHASHZ3
103990200610      /EJECT
104000200610     C/COPY ZSRSRC,ZICD2Z1
104010200610      /EJECT
104020200610     C/COPY ZSRSRC,ZICDSEZ1
104030200610      /EJECT
104040200610     C/COPY ZSRSRC,ZSYSTMZ1
104050200610      /EJECT
104060200610     C* *XRATEsubroutine now redundant                                    E23169
104070200610     C**********/COPY ZSRSRC,ZXRATEZ1                                     E23169
104080200610     C/COPY ZSRSRC,ZXRATEZ1                                               S01446
104090200610     C/COPY ZSRSRC,ZDATE9Z3                                                                   CGL031
104100200610     C/COPY WNCPYSRC,SE2400C025
104110200610      /EJECT
104120200610      ***
104130200610**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
10414020061000000001
10415020061000000010
10416020061000000100
10417020061000001000
10418020061000010000
10419020061000100000
10420020061001000000
10421020061010000000
104220200610**  POWER - Array of powers for currency conversion
1042302006100000001
1042402006100000010
1042502006100000100
1042602006100001000
1042702006100010000
1042802006100100000
1042902006101000000
104300200610**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)                      S01486
1043102006100006001521029820444305904073650882610287117481320914670161311759219053
1043202006102051421975234362489726358278192928030741322023366335124365853804639507
10433020061040968424294389045351
104340200610**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                      S01486
1043502006100366073110961461
104360200610**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                        S01486
104370200610000031059090120151181212243273304334365
104380200610**   ZMNM - MONTHS SHORT NAMES                                            S01486
104390200610JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
104400200610** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN                        CGL031
10441020061000366007310109601461
104420200610** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                           CGL031
10443020061000000000310005900090001200015100181002120024300273003040033400365
104440200610**  CPY@
104450200610(c) Finastra International Limited 2001
