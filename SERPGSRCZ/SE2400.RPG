     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Gen a/c keys posn settles - custs')           *
/*OVRF*: OVRDBF FILE(SECET) SHARE(*NO)                              : *   S01486
/*OVRF*: OVRDBF FILE(SEEVNT) TOFILE(SECED) SHARE(*NO)               : *   S01486
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE2400  - GENERATE NEW ACCOUNT KEYS AND POSITION SETTLEMENTS *
     F*            - CUST POSITIONS                                   *
     F*                                                               *
     F*  Function: This program reads through the Security Actions by *
     F*   (COB)    Security File and for each live Security Action,   *
     F*            accesses the Customer Positions File. For  each    *
     F*            Customer Position found for the Security where the *
     F*            Position Date is before the Action Date, the       *
     F*            program produces an Account Key and/or a Position  *
     F*            Settlement as required, (determined by indicators  *
     F*            on the Security Actions File). Account Keys are    *
     F*            written to PF/SEKEYD and Position Settlements to   *
     F*            PF/POSETD. Also, a record is written to PF/MATEXD  *
     F*            (Matured Security Positions Extract), for each     *
     F*            Matured Security. In Files PF/SEKEYD and PF/POSETD,*
     F*            data is written to member CPOSN2, and in PF/MATEXD,*
     F*            to member CUSTOMER. The Files have been overridden *
     F*            in the CL.                                        *
     F*            Position Settlements are generated for these       *
     F*            Actions: Dividend, Coupon, Part Payment, Mortgage  *
     F*            Payment, Maturity.                                 *
     F*                                                               *
     F*  Called by: SEC0606F - Generate Account Keys and Position     *
     F*                        Settlements for Customer Positions     *
     F*                        (which have not changed today and have *
     F*                        security actions due)                  *
     F*                                                               *
     F*  Calls: ZACCRC - Calculate Interest - Customer Positions      *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. AR324886           Date 07Apr20               *
      *  Prev Amend No. HUT103             Date 03Apr20               *
      *                 MD052583           Date 22Jan19               *
      *                 MD046248           Date 27Oct17               *
      *                 CSE110             Date 06Oct17               *
      *                 260331             Date 31Mar16               *
      *                 215959             Date 21Mar16               *
      *                 226449             Date 24Jun15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR1001183          Date 14Jul12               *
      *                 251950A            Date 27Feb12               *
      *                 AR888911           Date 26Jan12               *
      *                 AR864714B          Date 28Mar12               *
      *                 AR877365           Date 13Jan12               *
      *                 AR875302           Date 09Jan12               *
      *                 AR877352           Date 21Dec11               *
      *                 AR879983           Date 21Dec11               *
      *                 AR853119           Date 24Nov11               *
      *                 CSW210             Date 04May10               *
      *                 BUG26839           Date 05Jan10               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23123           Date 09Mar09               *
      *                 BUG22911           Date 17Feb09               *
      *                 CER048             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 219566             Date 08Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 219688             Date 11Oct06               *
      *                 CSD027A            Date 11May06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG11104A          Date 14Jun06               *
      *                 BUG11198           Date 26Apr06               *
      *                 BUG11104           Date 25Apr06               *
      *                 BUG11164           Date 06Apr06               *
      *                 236137             Date 20Sep05               *
      *                 236480             Date 24Oct05               *
      *                 234813             Date 14Jul05               *
      *                 234577             Date 29Jun05               *
      *                 234552             Date 28Jun05               *
      *                 236816             Date 28Jun05               *
      *                 236815             Date 28Jun05               *
      *                 236696             Date 27Jun05               *
      *                 234440             Date 24Jun05               *
      *                 234406             Date 23Jun05               *
      *                 233792             Date 30May05               *
      *                 233615             Date 16May05               *
      *                 233709             Date 07Jun05               *
      *                 233863             Date 01Jun05               *
      *                 233568             Date 19May05               *
      *                 233567             Date 19May05               *
      *                 232543             Date 16Mar04               *
      *                 CGL035             Date 01Mar05               *
      *                 CGL031             Date 05Jul04               *
      *                 CSE071             Date 19Jul05               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 194370             Date 12Jul01               *
      *                 211407             Date 07Jan03               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
      *                 CSE035             Date 22Apr02               *
      *                 CGL020             Date 12Dec02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 192467             Date 26Jul01               *
      *                 194195             Date 15Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE034             Date 18Apr02               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      *                 136297             Date 07Feb02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      *                 CSE026             Date 17Jan01               *
      *                 171874             Date 26Jun01               *
      *                 192099             Date 19Jun01               *
      *                 CSE026             Date 17Jan01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 189942             Date 14Feb01               *
      *                 133844             Date 24Apr98               *
      *                 187805             Date 18Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 187183             Date 01Dec00               *
      *                 CSE023             Date 30Aug00               *
      *                 182952             Date 08Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
     F*                 175400             Date 05Jun00               *
     F*                 162208             Date 23Jul99               *
     F*                 131379             Date 27Mar00               *  *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CPB001             DATE 05Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 130862             Date 18Oct98               *  *
      *                 151945             DATE 06Jan99               *
     F*                 147514             Date 20Nov98               *
     F*                 147869             Date 19NOV98               *
     F*                 143690             Date 05Oct98               *  *
     F*                 CEU005             Date 04Feb98               *  *
     F*                 121921             DATE 24FEB98               *  *
     F*                 105035             DATE 24FEB98               *  *
     F*                 095066             DATE 19FEB98               *  *
     F*                 114458             DATE 03FEB98               *  *
     F*                 CSE005             DATE 04FEB97               *  *
     F*                 099266             Date 02Jan97               *  *
     F*                 111923             Date 16Dec96               *
     F*                 111922             Date 16Dec96               *
     F*                 CAC002             Date 15Sep96               *
     F*                 S10408             Date 02Sep96               *  *
     F*                 102708             Date 02Aug96               *
     F*                 097890             DATE 22JUL96               *
     F*                 101317             DATE 18JUL96               *
     F*                 094839             DATE 16JUL96               *
     F*                 074380             DATE 28MAY96               *
     F*                 103361             DATE 28MAY96               *
     F*                 103017             DATE 09MAY96               *
     F*                 103011             DATE 09MAY96               *
     F*                 046500             DATE 02MAY96               *
     F*                 033988             DATE 01MAY96               *
     F*                 100017             DATE 18APR96               *
     F*                 095548             DATE 17JAN96               *
     F*                 093385             DATE 11OCT95               *
     F*                 093827             DATE 10OCT95               *
     F*                 093817             DATE 09OCT95               *
     F*                 092961             DATE 04OCT95               *
     F*                 094229             DATE 18OCT95               *
     F*                 094748             DATE 16OCT95               *
     F*                 088423             DATE 16JUN95               *
     F*                 086491             DATE 15JUN95               *
     F*                 087712             DATE 15JUN95               *
     F*                 087178             DATE 15JUN95               *
     F*                 084669             DATE 06JUN95               *
     F*                 081239             DATE 01FEB95               *
     F*                 080741             DATE 23JAN95               *
     F*                 081439             DATE 10JAN95               *
     F*                 081336             DATE 09JAN95               *
     F*                 081383             DATE 19DEC94               *
     F*                 S01486             DATE 22NOV94               *
     F*                 S01496  JSV        DATE 07OCT94               *
     F*                 S01446             DATE 28OCT94               *
     F*                 S01519             DATE 10AUG94               *
     F*                 S01512             DATE 10AUG94               *
     F*                 S01510             DATE 10AUG94               *
     F*                 S01509             DATE 10AUG94               *
     F*                 063199             DATE 25JUL94               *
     F*                 065301             DATE 06MAY94               *
     F*                 066777             DATE 26FEB94               *
     F*                 048612             DATE 08FEB94               *
     F*                 S01447             DATE 08NOV93               *
     F*                 054257             DATE 25NOV93               *
     F*                 052254             DATE 25NOV93               *
     F*                 051107             DATE 25NOV93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E37528             DATE 30MAR92               *
     F*                 E37289             DATE 25MAR92               *
     F*                 E36391             DATE 17MAR92               *
     F*                 E37051             DATE 16MAR92               *
     F*                 E33032             DATE 10DEC91               *
     F*                 E29170             DATE 07NOV91               *
     F*                 S01117             DATE 23MAY91               *
     F*                 E24422             DATE 23JAN91               *
     F*                 S01269             DATE 31JUL90               *
     F*                 E23807             DATE 02OCT90               *
     F*                 E23169             DATE 02OCT90               *
     F*                 E22638             DATE 31JUL90               *
     F*                 E21573             DATE 26JUN90               *
     F*                 E21715             DATE 20JUN90               *
     F*                 E21138             DATE 15FEB90               *
     F*                 E19610             DATE 06DEC89               *
     F*                 E20016             DATE 04DEC89               *
     F*                 E19975             DATE 23NOV89               *
     F*                 E20151             DATE 10NOV89               *
     F*                 E20086             DATE 09NOV89               *
     F*                 E16085             DATE 25AUG89               *
     F*                 E18803             DATE 17AUG89               *
     F*                 E18221             DATE 15AUG89               *
     F*                 E16772             DATE 31/05/89              *
     F*                 E16815             DATE 08/02/89              *
     F*                 E15696             DATE 20/10/88              *
     F*                 E15549             DATE 05/10/88              *
     F*                 E14704             DATE 29/09/88              *
     F*                 E14236             DATE 12/09/88              *
     F*                 E14716             DATE 07/09/88              *
     F*                 E14703             DATE 18/08/88              *
     F*                 E14718             DATE 17/08/88              *
     F*                 E14522             DATE 08/08/88              *
     F*                 E14506             DATE 04/08/88              *
     F*                 E14438             DATE 27/07/88              *
     F*                 E13817             DATE 22/06/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  AR324886 - Implement 4-eyes processing in Position           *
      *             Settlement Maintenance.                           *
      *             (Upgrade as required by HUT105)                   *
      *  HUT103 - Position Settlement Account Defaulting              *
      *           Upgrade HUT009 to FM2.1 SP22                        *
      *           Amendmnet of core hook SE2400CCP4                   *
      *           Addition of hook HUT103_002                         *
      *           Addition of hook HUT103_003                         *
      *  MD052583 - Reinstate deleted fixes CSE110                    *
      *  MD046248 - Finastra Rebranding                               *
      *  CSE110 - Condition Output of Partly Paid Account Key on      *
      *           Position Settlement.                                *
      *  260331 - Incorrect posting created due to a deleted diary    *
      *           event. Applied fix 255857.                          *
      *         - Applied for MD-37742.                               *
      *  215959 - Truncation error on event amount in SE2450P3.       *
      *           Recompiled due to changes in PF/SEKEYD.             *
      *         - Applied for MD-37439.                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen)                                         *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  AR1001183 - Coupon rate was still used in computation of     *
      *              interest instead of using the details in FRN tab *
      *  251950A - Component SEC1112 0001 terminated abnormally.      *
      *            Check if PSEB is blank, if it is move value of     *
      *            PBCA to CCTA, if not move value of PSEB to CCTA.   *
      *          - Applied for AR964313 (Child:AR964316)              *
      *  AR888911 - In reversing a deal, REV column in Stamp Tax      *
      *             Movements Enquiry is not changing from N to Y     *
      *             (Recompile)                                       *
      *           - Applied for AR944923                              *
      *  AR864714B - No movement is posted in Stamp Tax Movement      *
      *              enquiry for Position Settlements                 *
      *            - Applied for AR942839                             *
      *  AR877365 - Duplicate position settlement generated           *
      *             Patterned after fixes 212074 (POST - Duplicate    *
      *             generated for one dividend payment) and 218122    *
      *             (CPOSND - Matured security position stays with    *
      *             reci = 'D')                                       *
      *  AR875302 - Position settlement generated calculates Stamp    *
      *             Tax even when it is not stamp tax liable          *
      *  AR877352 - System did not default values for charges and     *
      *             commission code/amount                            *
      *  AR879983 - Add stamp tax exchange rate (Recompile)           *
      *  AR853119 - Position settlements generated from corporate     *
      *             action did not calculate stamp tax.               *
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  BUG23123 - Report: Does not show Retail Account Number       *
      *                     Date is not Midas Standard Date           *
      *                     Period should be actual int. calc. period *
      *                     Secondary Tax amount is not printed       *
      *                     Added field TSSLID                        *
      *                     (Recompile)                               *
      *  BUG22911 - Changes for Correct Tax Calculation               *
      *  CER048 - German Features - Taxes                             *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  219566 - Default the settlement account if no account for    *
      *           the specified portfolio. This is a LUX local fix    *
      *           so conditioned in core using new system value       *
      *           "UseDefaultSettAccnt" in SDSVALPD.                  *
      *  219688 - Settlement account not correctly retrieved          *
      *           If the customer is a portfolio one, access first    *
      *           with the account code defined as settlement in      *
      *           SDSECSPD. If not found use the PMACCNL0 account.    *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG11104A - Customer position do not balance. Applied        *
      *              169173, 177328.                                  *
      *  BUG11198 - Incorrect due amount on position settlement.      *
      *  BUG11104 - Customer position do not balance. If ex-coupon    *
      *             trade was inserted and dividend event has occured *
      *             reset ex-coupon nominal. Applied 197652.          *
      *  BUG11164 - A Serious Midas Error on SETRAD insert/amend      *
      *  236137 - Change Control for CGL031 Parts 4 & 5.              *
      *           Several changes in the Taxation of Savings Income   *
      *           functionality.                                      *
      *           - De Minimis Rules consideration.                   *
      *           - Taxable Amount of Amortized Discount basis        *
      *           consideration.                                      *
      *           - Amortized Premium deduction consideration.        *
      *  236480 - EU tax wrong on coupon when security position       *
      *           kept by 2 custodians.                               *
      *  234813 - Field UTXRSR must be used instead of S1RASO to      *
      *           calculate the EU Tax.                               *
      *  234577 - Dividends must check diary tax indicator            *
      *  234552 - Tax not calculated                                  *
      *  236816 - Incorrect tax if portolio positions used            *
      *  236815 - Purchased interest no included in tax calculation   *
      *           Local tax not deducted. No EU tax at maturity       *
      *  236696 - @@TOTO must be used instead of @@TOTI to deduct the *
      *           local tax                                           *
      *  234406 - No tax were calculated for position settlements     *
      *           PAMD field has been renamed to WPAMD in MORTAX subr.*
      *  234440 - Use new file ETCPOSND for average price, average    *
      *           fiscal price, purchased interest etc                *
      *         - Change Control 1 Part 4 - For Switzerland only,     *
      *           bonds at at a discount will have their fiscal price *
      *           calculated on a yield curve, and funds will not     *
      *           take into account the profit on a sale when deciding*
      *           the tax amount - THE LATTER PART HAS BEEN INSERTED  *
      *           AND THEN REMOVED AGAIN                              *
      *  233792 - Database error 55 in SE2400 - EUTAX                 *
      *  233615 - Takeon programs for CGL031 (Recompile)              *
      *  233709 - The tax must be calculated prorata temporis between *
      *           the effective date and the event date               *
      *           The customer income must be generated in SE2300     *
      *           after the position settlements authorisation        *
      *           The EUSD tax account keys must be generated in      *
      *           SE2300                                              *
      *  233863 - In case of coupon position settlement, the tax      *
      *           must be accessed with the coupon date instead of the*
      *           current run date                                    *
      *  233568 - Nominal currency must be used                       *
      *  233567 - Wrong average fiscal price                          *
      *  232543 - Fix to CGL031                                       *
      *  CGL035 - EUSD Upgrade to Midasplus                           *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *  CGL020 - Compliance Watch - Addtl A/C Postings Information   *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  192467 - No maturity position settlement was generated.  Set *
      *           price for records with processing type '1' and      *
      *           price basis 'U'.                                    *
      *  194195 - Position settlements in base ccy incorrect when the *
      *           nominal ccy is an 'IN' ccy and settled in EUR via   *
      *           the standard settlement instructions (in STDSED).   *
      *  CSE034 - Standing Settlement Instruction improvements        *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  136297 - When settlement method 04 and no settlement account *
      *           defined, prime account number is defaulted ... If   *
      *           it does not exist, use suspense computer account    *
      *  CSE028 - Standing Settlement Instructions Enhancement.       *
      *  171874 - ZAINSH changes - only recompile                     *
     F*  192099 - Avoid DB Error in file SDPLCSPD at 041 when         *
     F*           Customer is PB and not PM                           *
      *  CSE026 - Position Settlement Default Charges by Customer     *
      *           Group.                                              *
     F*  189942 - When PM or PB is on, generate the position          *
     F*           settlements based on file CDEPPD and no more on     *
     F*           PMCPOSPD.                                           *
     F*           By this way, the correct portfolio reference and    *
     F*           the correct branch code will be used.               *
     F*  133844 - Even if customer is portfolio, access securities    *
     F*           customer details to check position settlements      *
     F*           charge group used to calculate default charges and  *
     F*           commissions                                         *
      *  187805 - Incorrect position settlement being generated       *
      *           because field CTYP being corrupted by field in      *
      *           CLINTCB.                                            *
     F*  187183 - Problem when output to LDA                          *
      *  CSE023 - Treaty Withholding Tax                              *
      *  182952 - Applied part of fix 094970 to suppress dberror17.   *
      *           (the remainder if the fix - to initialise blank     *
      *           profit centre - is in core already under CAC002)    *
     F*  175400 - Security position settlements not picking up the    *
     F*           security standard settlements if the securit nominal*
     F*           currency is an 'in' currency and being settled in   *
     F*           EURO. Remove fix 147869 and fix it differently since*
     F*           it caused the above problem. Based on 170568.      *
     F*  162208 - Amended program to move the Market Indicator of     *
     F*           the security to PMAR field.                         *
     F*  131379 - Incorrect account key for primary market at maturity*
     F*  CPB001 - 'Private Banking' Module                            *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  147514 - Position settlement preparations are not taking     *
     F*           into account the Standard Settlement Instructions.  *
     F*           Apply fix 143851.  Use *IN88 when chaining to file  *
     F*           STDSED instead of *IN78 which is already in use.    *
     F*  147869 - Wrong settlement amount on accounting               *
     F*  143690 - Incorrect Mult/Div Ind. was being used when EURO    *
     F*           CCY was involved. Fix is to reverse the M/D ind. if *
     F*           Nominal CCY is equal to the EURO CCY.               *
     F*  CEU005 - EMU SE Settlement Ccy Conversion                    *
     F*  121921 - SEPCCD record is not necessary for zero position    *
     F*           record at maturity because there is nothing being   *
     F*           produce.                                            *
     F*  105035 - VALUE DATE SETUP INCORPORATED AT A WRONG PLACE,     *
     F*           AT THIS MOMENT , NOMINAL CURRENCY IS STILL BLANK    *
     F*           ... SO FIRST NEXT DATE IS TAKEN EVEN  IF HOLIDAY IN *
     F*           IN THE CURRENCY                                     *
     F*  095066 - Switchable feature introduced to use value date     *
     F*           position to calculate Dividend Payment, and should  *
     F*           also include position on Dividend day.              *
     F*  114458 - DATABASE ERROR IN SDRETLPD.  DO NOT CALL AORETLR0   *
     F*           IF RETAIL IS NOT SWITCH ON.                         *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  099266 - For dividend with ex-date, wrong position is        *
     F*           considered : - in CPOSND if portfolio off           *
     F*                      : - in PMCPOSPD if portfolio on          *
     F*  111923 - Database error in file CLINT.                       *
     F*         - Reinstate the code assigning the customer number    *
     F*           which was removed by core fix 074380.               *
     F*  111922 - I/O operation was applied to closed file PMACCNL0.  *
     F*         - Only check the existence of the account in value    *
     F*           currency if Portfolio management is installed.      *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*           If Analytical Accounting is available, define the   *
     F*           profit centre for posting.                          *
     F*  S10408 - Addition of hooks SE2400CCP4                        *
     F*         - Addition of hooks SE2400CCP3                        *
     F*         - Addition of hooks SE2400CCP2                        *
     F*         - Addition of hooks SE2400CCP1                        *
     F*         - Addition of hooks SE2400FFP1                        *
     F*         - Addition of hooks SE2400IIP2                        *
     F*         - Addition of hooks SE2400IIP1                        *
     F*  102708 - IF THE CUSTOMER IS PORTFOLIO, USE CUSTOMER REFERENCE*
     F*           OF PM POSITION FILE TO SETUP THE ACCOUNT KEY        *
     F*           OTHERWISE POSTINGS ARE ALL GENERATED ON SAME CUSTOMER
     F*           ACCOUNT
     F*  097890 - For portfolio customer, if no account exists in     *
     F*           security custoner, post position settlement to      *
     F*           suspense account and not to account in customer     *
     F*           currency or portfolio currency                      *
     F*  101317 - Coupon payments credited to incorrect account.      *
     F*           Even if the customer is not portfolio, check if     *
     F*           account exists in value currency, else WZFOND not   *
     F*           reset to 'N' and account and settlement details     *
     F*           from previous portfolio customer used in error.     *
     F*  094839 - For shares, trading on ex-dividend date not         *
     F*           considered.  Fix is to check trade date less than   *
     F*           or equal to SAEXD.                                  *
     F*  074380 - No check if AUMO is 'Y' because Position Settle-    *
     F*           ment with Settlement method '04' are posted on the  *
     F*           Suspense account.                                   *
     F*  103361 - If settlement method is '04' and settlement account *
     F*           is blank, retrieve prime account number.            *
     F*  103017 - Set RECI to 'D' when writing position settlement rec*
     F*  103011 - The system creates a position settlement MT* for    *
     F*           warrant which can lead to confusion for cashflow    *
     F*  046500 - CORRECT FILE OUT OF BALANCE IN COB                  *
     F*  033988 - WHEN SECURITY MATURED, RECI ON CPOSND IS WRONGLY    *
     F*           UPDATED TO 'M'.                                     *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  095548 - Redefine NMCY for SEDEVD1 & SEDEVD2                 *
     F*  093385 - Dividends not shown in SE0640 after input of DV in  *
     F*           diary - output correct nominal position for dividend*
     F*  093827 - SE Holdings positions incorrect in SE0640 - output  *
     F*           correct nominal position for maturity.              *
     F*  093817 - If no standard settlement instructions found on     *
     F*           STDSED, EXSR SR/P07 to determine the settlement     *
     F*           account to use.                                     *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  094229 - Calculate settlement amount regardless of S01519    *
     F*  094748 - Only 1 position settlement produced per security    *
     F*           event (caused by S01486)                            *
     F*  088423 - If S01512 is on, event date should no longer be     *
     F*           payment date                                        *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  087712 - Percentage price-based shares have dividend amount  *
     F*           calculated 100 times too much                       *
     F*  087178 - Settlement amount has to include taxes added to or  *
     F*           subtracted from it                                  *
     F*  084669 - If no standard settlement method defined, settlement*
     F*           branch must be equal to booking branch              *
     F*  081239 - R10 Private Banking Rework                          *
     F*  080741 - Position settlement generated with figures for      *
     F*           other customers                                     *
     F*  081439 - Wrong update of field tax rate - Recompile          *
     F*  081336 - Fix's on upgrade                                    *
     F*  081383 - Duplicate use of indicator 79 causes pgm loop       *
     F*  S01486 - Incorporation of PM Enhancements (S01313)           *
     F*           (Fix's S01313 - R05803                              *
     F*  S01496 - Incorporation of Jyske Enhancements (S10982, S10984)*
     F*           Just recompilation.                                 *
     F*  S01446 - Customer Commissions (Courtage) enhancement:        *
     F*           Get details of single charge currency (from SE ICD) *
     F*           for conversion of charge amount to value currency.  *
     F*  S01519 - Position Settlements Automatic Charges              *
     F*  S01512 - Add value date to Position Settlements              *
     F*  S01510 - Dividend Payments based on Ex-date                  *
     F*  S01509 - Value Currency to be currency of Issuer of Payments *
     F*  063199 - Program access the Customer Position Profit Centre  *
     F*           file even when Profit Centres are not used, which   *
     F*           causes a spurious database error.  Condition the    *
     F*           access to this file.                                *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  066777 - Output Last Change Date on new POSETD records.      *
     F*  048612 - Clear settlement method field before accessing stan-*
     F*           dard settlements file so that if no record is found,*
     F*           the value from a previous transaction is not used.  *
     F*  S01447 - Withholding Tax.                                    *
     F*           Calculates withholding tax which are written to     *
     F*           new fields on position settlements file.            *
     F*  054257 - RECOMPILED as PREV CURRENT FACTOR amended from 9,8  *
     F*           to 10,9                                             *
     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
     F*  051107 - Program ignores Events BEFORE first Action Date. It *
     F*           should ALSO ignore Events ON the first Action Date  *
     F*           as they will not be affected, (eg. Coupon).         *
     F*  S01401 - MT5xx SWIFT Messages Feature:                       *
     F*           - Position Settlement Message Indicator set to 'Y'  *
     F*             when Settlement Authorised by System.             *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files.               *
     F*  E37528 - Program recompiled for minor change to Audit Report.*
     F*  E37289 - Coupon amount on Matured Securities file was wrong  *
     F*  E36391 - Mortgage repayment amounts on A/C keys and Position *
     F*           Settlements use a incorrect change in current factor*
     F*  E37051 - Problems with zoned parameter field CSCN.  This     *
     F*           appears to be an error in the compiler.  Fix gets   *
     F*           round the problem                                   *
     F*  E33032 - Outputting wrong branch field to POSETD             *
     F*  E29170 - Report Control Facility changes                     *
     F*  S01117 - Multibranching                                      *
     F*  E24422 - Remove E16815 - error in DV processing              *
     F*  S01269 - Trade Authorisation: Recompiled for change to file  *
     F*           TABSE                                               *
     F*  E23807 - Record locked by this job  - remove E21715          *
     F*  E23169 - Settlement exchange rate should be equal to         *
     F*           exchange (not spot rate) from SECTYD.               *
     F*           Processing changed to use ZCNSD for accuracy        *
     F*  E22638 - Dividend due amount being truncated. Use standard   *
     F*           subroutine ZCNSD to calculate dividend due.         *
     F*  E21573 - Coupon at Maturity is now produced separately and   *
     F*           requires a Position Settlement to be generated from *
     F*           the Coupon Action.                                  *
     F*  E21715 - Must reset Ex-Coupon/Dividend field after Coupon/   *
     F*           Dividend Date processing.                           *
     F*  E21138 - Position Settlement Fixes:                          *
     F*           1.Amount due at maturity for customers must just be *
     F*             face value                                        *
     F*           2.A/C Keys produced when position settlements       *
     F*             produced and not on event date                    *
     F*  E19610 - For Shares/Equities use the Trade Date instead of   *
     F*           Value Date to calculate the Dividend Due.           *
     F*  E20016 - Use LF/SEDEV instead of SECED as SEDEV now ignores  *
     F*           records with RECI='C'                               *
     F*  E19975 - KCUST shouldn't be zeroized before writing          *
     F*           SEKEYD as  issuer and depot cust nos are needed for *
     F*           account keys with posting ref 4 and 5.              *
     F*  E20151 - Amount due at maturity inflated by factor of 100    *
     F*           for a Yen instrument.                               *
     F*  E20086 - Mortgage-Backs and Current Factor Processing Rewrite*
     F*           - Rewrite of SR/MORTPY:                             *
     F*           - Coupon is produced separately - do not include it *
     F*             in the MP Amount. (It was wrong anyway).          *
     F*           - Amount calculation is unnecessarily complicated.  *
     F*           - Rename NMCY on SEDEVDF instead of moving it back  *
     F*             and forth all the time.                           *
     F*  E16085 - TO RESET INVESTMENT TYPE IF DEPOT IS CEDEL AND      *
     F*           CUSTOMER NOT A MARKET CLIENT.                       *
     F*           TO SUPPRESS BOOK CODE IN ACCOUNT KEYS FOR           *
     F*           CHARGES AND COMMISSIONS.                            *
     F*  E18803 - SET ACCOUNT KEY SEQUENCE NO. TO ZERO TO ALLOW FOR   *
     F*           MULTI-BRANCH SYSTEMS.                               *
     F*  E18221 - BLANK CHTP FIELD CAUSING OVERPRINTING IN POS.       *
     F*           SETTL. AUDIT LIST.                                  *
     F*  E16772 - The Dividend Payment Amount field SDAU has been     *
     F*           replaced by the field SDUN, to increase its size    *
     F*           from 9,4 to 13,8                                    *
     F*  E16815 - THE POSITION GENERATED FROM A SECURITY DIARY EVENT  *
     F*           SHOWS INCORRECT AMOUNT FOR DIVIDENDS.               *
     F*  E15696 - UPDATE DEPOT POSNS ON MATURITY DATE (NOT BEFORE)    *
     F*  E15549 - FIXES CONNECTED WITH REDELIVERY OF POSITION         *
     F*           SETTLEMENT PROGRAMS FROM CD.                        *
     F*           1.LAST COUPON DATE MUST BE FOR 'CURRENT' PERIOD     *
     F*           2.CURRENCY DECIMAL PLACES NOT SET AT RIGHT TIME     *
     F*           3.IF POSITION IS PRIOR TO LAST COUPON DATE          *
     F*             ZEROIZE EX-COUPON NOMINAL                         *
     F*           4.PROCESS ALL POSITIONS IF SECURITY ACTIONS PRESENT *
     F*  E14704 - REVERSE SET UP OF PAY RECEIVE INDICATOR.            *
     F*  E14236 - PROCESS MATURITY CUSTOMER POSITIONS ACTIONS.        *
     F*  E14716 - EVENT CODE 'MA' CHANGED TO 'MT'                     *
     F*  E14703 - ONLY WRITE MATURED SECURITY RECORD IF ACCOUNT KEY   *
     F*           REQUIRED INDICATOR IS 'Y'.                          *
     F*  E14718 - SET UP BOOK CODE CORRECTLY, USING PORTFOLIO         *
     F*           BOOK CODE DEFAULT.                                  *
     F*  E14522 - TEST CONVERTIBLE INDICATOR (POSN 14 IN ACCOUNT      *
     F*           KEY) CORRECTLY.                                     *
     F*  E14506 - NO POSITION SETTLEMENTS ARE GENERATED FOR THE NEXT  *
     F*           DAY.                                                *
     F*  E14438 - RECOMPILE PROGRAM FOR EUCLID INCORPORATION          *
     F*           AND UPGRADING OF FILES.                             *
     F*  E13817 - OUTPUT 'FV' KEY WITH NOM. CURRENCY AND              *
     F*           NOM. DECIMAL PLACES.                                *
     F*                                                               *
     F*****************************************************************
     F*
     FSECACA  IF  E                    DISK
     F***PMFPSNLLIF  E           K        DISK                 UC  S01486 189942
     F***PMCPSSLLIF  E           K        DISK                 UC  S01486 189942
     F***PMAPOSLLIF  E           K        DISK                 UC  S01486 189942
     FSECDEPL0IF  E           K        DISK                               189942
     F            CDEPPDF                           KRENAMECDEPP0         189942
     FCDEPS   IF  E           K        DISK                               189942
     F            CDEPPDF                           KRENAMECDEPPS         189942
     FSECDEPL5IF  E           K        DISK                               189942
     F            CDEPPDF                           KRENAMECDEPP5         189942
     FPOSETA  O   E                    DISK         KINFDS POSADS
     F                                              KINFSR POSASR
     FMATEXA  UF  E                    DISK         KINFDS MATADS
     F                                              KINFSR MATASR
     FSEKEYA  O   E                    DISK         KINFDS SEKADS
     F                                              KINFSR SEKASR
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     F*********** CLINTSEF                          KIGNORE               S01447
     F************CLINTCBF                          KIGNORE               S01447
     FTABSE   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F*           TABTB36F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F** CRCY     TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********** TABLETJF                          KIGNORE               S01117
     F            TABLETLF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETKF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLETAF                          KIGNORE
     F            TABTE20F                          KIGNORE
     FSE2400AUO   E                    PRINTER
     FSECTY   IF  E           K        DISK
     FSESWHTL0IF  E           K        DISK                               S01447
     F* Securities WHT details file                                       S01447
     F***********SECED   IF  E           K        DISK                    E20016
     FSEDEV   IF  E           K        DISK                               E20016
     F* RECORD ID PN                                                      S01486
     FPMPORTPDIF  E           K        DISK                           UC  S01486
     F*                                                                   S01486
     FSECET   IF  E           K        DISK                           UC  S01486
     F            SEDEVDF                           KRENAMESEDEVD1        S01486
     F*                                                                   S01486
     FSEEVNT  IF  E           K        DISK                           UC  S01486
     F            SNDEVDF                           KRENAMESNDEVD2        S01486
     F            SEDEVDF                           KRENAMESEDEVD2        S01486
     F*                                                                   S01486
     F**   ACCOUNT DETAILS                                                S01486
     FPMACCNL0IF  E           K        DISK                           UC  S01486
     F*                                                                   S01486
     FPMACCNL1IF  E           K        DISK                           UC  219688
     F            ACCNTABF                          KRENAMEACCNTL1F       219688
     F*                                                                   219688
     FSDCURRL0IF  E           K        DISK                               081336
     FSECEO   IF  E           K        DISK                               E36391
     F            SEDEVDF                           KRENAMESEDEVDO        E36391
     F            SNDEVDF                           KRENAMESNDEVDO        E36391
     FSEPCCD  IF  E           K        DISK                               S01117
     FINVTP   IF  E           K        DISK
     FSTDSED  IF  E           K        DISK
     FSECAC   IF  E           K        DISK
     F*CPOSH***IF**E           K        DISK                              E21715
     F*CPOSH***UF**E           K        DISK                       E21715 E23807
     FCPOSH   IF  E           K        DISK                               E23807
     F            CPOSNDF                           KRENAMECPOSNDFH
     F*POSS***IF**E           K        DISK                               E14236
     FSECGT   IF  E           K        DISK                               S01519
     F** Charge/commissions Rates Table.                                  S01519
     FSEDFTCL2IF  E           K        DISK                               S01519
     F** Default charges table.                                           S01519
     FSEDFGRL0IF  E           K        DISK                           UC  CSE026
     F            SEDFTCD0                          KRENAMESEDFTGD0       CSE026
     FCPOSS   UF  E           K        DISK                               E14236
     F            DPOSNDF                           KIGNORE
     FSEKEYD  O   E           K        DISK         KINFDS SEKDDS
     F                                              KINFSR SEKDSR
     FPOSETD  O   E           K        DISK         KINFDS POSDDS
     F                                              KINFSR POSDSR
     FPSAUTD  O   E           K        DISK                                                 AR324886
      ** SE Position Settlement Authorisation detail                                        AR324886
      *                                                                                     AR324886
     FSDCUSQL0IF  E           K        DISK                                                 AR853119
      **  Midas SD Stamp Tax Customer Extension file                                        AR853119
     FPOSETDX3O   E           K        DISK         KINFSR *PSSR                            AR853119
      ***  Position Settlements - Extension File                                            AR853119
     FSDSTMDPDO   E           K        DISK         KINFSR *PSSR                            AR853119
      **  Midas SD Stamp Tax History Detail file                                            AR853119
      *                                                                                     AR853119
     FMATEXD  O   E           K        DISK         KINFDS MATDDS
     F                                              KINFSR MATDSR
     FSDBRCHL0IF  E           K        DISK                               136297
     FTABTB20 IF  E                    DISK                               136297
     FACCNT   IF  E           K        DISK                               136297
     F            ACCNTABF                          KRENAMEACCOUNTF       136297
      ** Midas SD Tax Calculation Method                                                      CGL031
     FSDTXCML1IF  E           K        DISK         KINFSR *PSSR                              CGL031
      *                                                                                       CGL031
      ** Midas SD Joint Account Member                                                        CGL031
     FSDJACCLBIF  E           K        DISK         KINFSR *PSSR                              CGL031
      *                                                                                       CGL031
      ***Midas*SD*Additional*Customer*Details**************************                CGL031 233709
     F***SDACUSL1IF  E           K        DISK         KINFSR *PSSR                    CGL031 233709
      *****************************************************************                CGL031 233709
      ***Midas*SD*Non-Account*Holder***********************************                CGL031 233709
     F***SDNAHOL1IF  E           K        DISK         KINFSR *PSSR                    CGL031 233709
      *****************************************************************                CGL031 233709
      ***Midas*SD*Customer*Income**************************************                CGL031 233709
     F***SDCSINPDO   E           K        DISK         KINFSR *PSSR                    CGL031 233709
      *                                                                   S01408
     F/COPY WNCPYSRC,SE2400FFP1                                           S01408
      *                                                                   S01408
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   29 - DIFFERENCE MESSAGE IS PRINTED                          *
      *   40 - Set on when S01496 and Autocharge flag on ICD are ON.  *   CSE026
     F*   44 - END OF RELEVANT RECORDS ON CPOSH                       *   E21715
     F*   54 - CUSTOMER RECORD READ IN (FORMAT CLINTCB)               *   S01447
     F*   60 - CURRENCY REQUIRES 0 DEC PLACES FOR CALCS               *
     F*   61 - CURRENCY REQUIRES 1 DEC PLACES FOR CALCS               *
     F*   62 - CURRENCY REQUIRES 2 DEC PLACES FOR CALCS               *
     F*   63 - CURRENCY REQUIRES 3 DEC PLACES FOR CALCS               *
     F*   66 - POSITION READ IS FROM CPOSH                            *   E21715
     F*   72 - Beginning of file on READP for SEDEVD                  *                     BUG11104
     F*   74 - READING ALL VALUE DATE PORTFOLIO POSITIONS - PMAPOSLL  *   S01486
     F*   75 - READING FIRST CUSTOMER POSITION DATES FILE - PMFPSNLL  *   S01486
     F*   76 - READING CURRENT POSITIONS BY SECURITY FILE - PMCPSSLL  *   S01486
     F*   77 - END OF FILE ON READE OR RECORD EXISTS ON SETLL         *
     F*   78 - CHAIN OF STDSED FOR SETTLEMENT DETAILS                 *   CEU005
     F*   79 - END OF CUST DEPOT POSITIONS FOR THIS SECURITY          *
     F*   80 - SECURITY WHT RECORD READ IN                            *   S01447
     F*   89 - END OF SECURITY ACTIONS FILE - STD REPORT AND END      *
     F*   87 - EXCEPTION ERROR ON UPDATED FILE - PRINTS STATUS/AUDIT  *
     F*   88 - Chain indicator for STDSED                             *   147514
     F*                                                               *
     F*90-99 - USED IN Z SUBROUTINES                                  *
     F*                                                               *
     F*   U7 - DATABASE ERROR                                         *
     F*   U8 - DATABASE ERROR                                         *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*   GETCTY-  Get Country of Branch                              *   S01447
     F*   FIRST  - ACCESSES ICD INFORMATION                           *
     F*   GETDEP - OBTAIN LATEST CORRECT CUST/DEPOT POSITION DATE     *
     F*   DIVIND - PRODUCE DIVIDEND A/C KEY &/OR POSITION SETTLEMENT  *
     F*   COUPON - PRODUCE COUPON A/C KEY &/OR POSITION SETTLEMENT    *
     F*   PARTPY - PRODUCE PART PAYMENT POSITION SETTLEMENT           *
     F*   MORTPY - PRODUCE MORTGAGE PAYMENT POSITION SETTLEMENT       *
     F*   MATURE - PRODUCE MATURITY POSITION SETTLEMENT               *
     F*   W01    - WRITE ACCOUNT KEY                                  *
     F*   W02    - WRITE POSITION SETTLEMENT                          *
     F*   P04    - CALCULATE THE DEFAULT CHARGE/COMMISSION AMOUNT     *   S01519
     F*   P05    - CALCULATE DEFAULT AMOUNTS                          *   S01519
     F*   P06    - CALCULATE SETTLEMENT AMOUNT                        *   S01519
     F*   CALAMT - DETERMINE IF AMOUNTS NEED TO BE CALCULATED FOR     *   S01519
     F*            CHARGES                                            *   S01519
     F*   CALAM2 - CALCULATE CHARGE AMOUNTS                           *   S01519
     F*   CALCTX - Calculate tax amounts for dividends/Coupons        *   S01447
     F*   CHKTAX - Check if record is existing in SDCTTXPD for taxing *                       CGL031
     F*   CPNTAX - Calculate tax for descretionary and Safe           *                       CGL031
     F*            Custody Customers for Coupon                       *                       CGL031
     F*   DIVTAX - Calculate tax for descretionary and Safe           *                       CGL031
     F*            Custody Customers for Dividends                    *                       CGL031
     F*   MATTAX - Calculate tax for descretionary and Safe           *                       CGL031
     F*            Custody Customers for Mature                       *                       CGL031
     F*   MORTAX - Calculate tax for descretionary and Safe           *                       CGL031
     F*            Custody Customers for Mortgage                     *                       CGL031
     F*   CPTXCL - Calculate tax amount for the Coupon and to Output  *                       CGL031
     F*            Information on SDCSINPD                            *                       CGL031
     F*   DVTXCL - Calculate tax amount for the Dividend and to Output*                       CGL031
     F*            Information on SDCSINPD                            *                       CGL031
     F*   MATXCL - Calculate tax amount for the Maturity or Early     *                       CGL031
     F*            Redemption and to Output Information on SDCSINPD   *                       CGL031
     F*   MPTXCL - Calculate tax amount for the Mortgage Repayment    *                       CGL031
     F*            and to Output Information on SDCSINPD              *                       CGL031
     F****CSINSR*-*Output*Information*on*SDCSINPD**********************                CGL031 233709
     F*   CSINSR - Calculate Tax Amounts on POSETD                    *                       233709
     F*   W03    - WRITE MATURED SECURITY POSITIONS EXTRACT           *
     F*   SECTIN - GET SECURITY DETAIL RECORD IN                      *
     F*   INVTIN - GET INVESTMENT TYPE DETAIL RECORD IN               *
     F*   SECEDI - GET SECURITY EVENTS DETAIL RECORD IN               *
     F*   TG10   - GET TABTG10 RECORD FOR EACH CURRENCY AS REQUIRED   *
     F*   #LCURR - GET SDCURRPD RECORD FOR EACH CURRENCY AS REQUIRED  *   S01446
     F*   AUDIT  - OUTPUTS AUDIT RECORD UDEPPA AND CONTROL REPORT     *
     F*                                                               *
     F*   SEKDSR - ERROR HANDLING FOR SEKEYD                          *
     F*   SEKASR - ERROR HANDLING FOR SEKEYA                          *
     F*   POSDSR - ERROR HANDLING FOR POSETD                          *
     F*   POSASR - ERROR HANDLING FOR POSETA                          *
     F*   MATDSR - ERROR HANDLING FOR MATEXD                          *
     F*   MATASR - ERROR HANDLING FOR MATEXA                          *
     F*                                                               *
     F*   ZACCH  - ACCESS RECORD FOR HOLIDAYS FILE                    *   S01512
     F*   ZFWDT  - FIND WORKING DAYS FORWARD                          *   S01512
     F*   ZHASH  - HASH TOTALLING STD SUBROUTINE                      *
     F*   ZICDSE - GET TABTB36 ICD                                    *
     F*   ZICD2  - GET TABTB11 ICD                                    *
     F*   ZSYSTM - GET TABTB10 ICD                                    *
     F***ZXRATE*-*CROSS*REF*EXCHANGE*RATE*CALCULATED**********************E23169
     F*   ZXRATE - CROSS REF EXCHANGE RATE CALCULATED                 *   S01446
     F*                                                               *
     F*   ZACCRC - CALCULATE INTEREST DUE     ** PROGRAM CALL **      *
     F*   *PSSR  - EXCEPTION ERROR ROUTINE                            *   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZPOWERZ1                                               S01509
     E/COPY ZSRSRC,ZHASHZ1
     E/COPY ZSRSRC,ZHOLE                                                  S01512
     E/COPY ZSRSRC,ZCCAL1Z1                                               S01519
     E/COPY ZSRSRC,ZDAYSZ1                                                S01486
     E/COPY ZSRSRC,ZDATE2Z1                                               S01486
     E/COPY ZSRSRC,ZDATE9Z1                                                                   CGL031
     E                    CPY@    1   1 80
     E**********          WAD        10  6 0                                    AR1001183 AR1001183A
     E**********          WBR        10  2 0                                    AR1001183 AR1001183A
     E**********          WBS        10 11 7                                    AR1001183 AR1001183A
     E**********          WSI        10  1                                      AR1001183 AR1001183A
     E**********          WRM        10  7                                      AR1001183 AR1001183A
     E**********          WRF        10  4                                      AR1001183 AR1001183A
     E/COPY ZSRSRC,ZACCRZ0                                                S01486
     E/COPY ZSRSRC,ZNCDZ1                                                 S01486
     E/COPY WNCPYSRC,SE2400E001
      /EJECT
     I*                                                                   033988
     ISECTYDF                                                             033988
     I              RECI                            RECIS                 033988
     I*                                                                   033988
     ISECACDF                                                             E15549
     I              LCCP                            SALCCP                E15549
     ISEDEVDF                                                             E20086
     I              NMCY                            SNMCY                 E20086
     I              SETX                            NSETX                 234552
     ISEDEVDO                                                             E36391
     I              NMCY                            SNMCY                 E36391
     I              SETX                            NSETX                 234552
     ISEDEVD1                                                             095548
     I              NMCY                            SNMCY                 095548
     I              SETX                            NSETX                 234552
     ISEDEVD2                                                             095548
     I              NMCY                            SNMCY                 095548
     I              SETX                            NSETX                 234552
     IACCNTABF                                                            S01486
     I              PTFR                            RNPTFR                S01486
     IACCNTL1F                                                            219688
     I              PTFR                            L1PTFR                219688
     ISEPCCDF                                                             189942
     I              PTFR                            PCPTFR                189942
     ICDEPP0                                                              189942
     I              RECI                            CDRECI                189942
     ICDEPPS                                                              189942
     I              RECI                            CDRECI                189942
     ICDEPP5                                                              189942
     I              RECI                            CDRECI                189942
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              RECI                            RECII                                   BUG11104
     I              SFLG                            ISFLG                                     CSE037
      *                                                                                       CSE028
      ** DS for customer/book standard settlement instruction                                 CSE028
      **  to be passed to SESSIR0                                                             CSE028
      *                                                                                       CSE028
     IPCBSTD    E DSSTDSED                    2                                               CSE028
     I              RECI                            WRECI                                     CSE028
     I              LCD                             WLCD                                      CSE028
     I              CHTP                            WCHTP                                     CSE028
     I              TNLU                            WTNLU                                     CSE028
      *                                                                                       CSE028
      ** Data structure for standard additional settlement details                            CSE028
      ** for customer/book to be passed to SESSIR0                                            CSE028
      *                                                                                       CSE028
     IPCBSAD    E DSSTDADSED                  8                                               CSE028
     I*
     ITABLKY      DS
     I*
     I*  TABTB11 TABLE KEY FIELD DATA STRUCTURE FOR DB ERROR
     I*
     I                                        1  12 TABKEY
     I                                        1   20RECT
     I                                        3  10 ZZ008
     I                                       11  120RCDE
     I*
     IPOSDDS      DS                            366
     I*
     I*  POSITION SETTLEMENTS  FILE ERROR EXCEPTION  DATA STRUCT.
     I*
     I                                     *STATUS  STSPSD
     I*
     ISEKDDS      DS                            366
     I*
     I*  GENERATED ACCOUNT KEYS FILE ERROR EXCEPTION  DATA STRUCT.
     I*
     I                                     *STATUS  STSSKD
     I*
     IPOSADS      DS                            366
     I*
     I*  POSITION SETTLEMENTS  AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
     I*
     I                                     *STATUS  STSPSA
     I*
     IMATDDS      DS                            366
     I*
     I*  MATURED SECURITY EXTRACT FILE ERROR EXCEPTION  DATA STRUCT.
     I*
     I                                     *STATUS  STSMTD
     I*
     IMATADS      DS                            366
     I*
     I* MATURED SECURITY EXTRACT AUDIT FILE ERROR EXCEPTION DATA STRUCT
     I*
     I                                     *STATUS  STSMTA
     I*
     ISEKADS      DS                            366
     I*
     I* GENERATED ACCOUNT KEYS AUDIT FILE ERROR EXCEPTION  DATA STRUCT.
     I*
     I                                     *STATUS  STSSKA
     I*    MIDAS 'Next Available Transaction No.' Data Area  MNATN .      S01486
     IDNATN       DS                              5                       S01486
     I                                        1   50FNATN                 S01486
     I/COPY ZSRSRC,ZHASHZ2
     I/COPY ZSRSRC,ZNCDZ2                                                 S01486
     I/COPY ZSRSRC,ZDATE9Z2                                                                   CGL031
     I*
     IWACKEY      DS
     I*
     I* ACCOUNT KEY DATA STRUCTURE SEE SUBR W01
     I*
     I                                        1   3 WACITY
     I                                        4   4 WACEVC
     I                                        5   5 WACTRT
     I                                        6   6 WACPFI
     I                                        7   8 WACBKC
     I                                        9  10 WACTST
     I                                        9  10 WACPSB
     I                                       11  12 WACCCC
     I                                       13  13 WACMKT
     I                                       14  14 WACCON
     I                                       15  15 WACNEG
     I                                       17  18 WARCTR                                    CGL031
     I                                       19  20 WACAMC
     I*
     IINVKEY      DS
     I*
     I* INVESTMENT TYPE FILE KEY FOR DB ERROR PRINTOUT
     I*
     I                                        1   3 NMCY
     I                                        4   6 SITP
     I*
     I***********LDA        UDS                            256            S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I*                                                                   S01117
     ILDA         DS                            256                       S01117
     I*                                                                   S01117
     I** Local Data area for Database Error Reporting                     S01117
     I*                                                                   S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     IPOSDDB      DS
     I*
     I* FILE POSETD DB ERROR KEY - OUTPUT FILE
     I*
     I***********                             1   30PBCH                  S01117
     I***********                             1   3 PBCH            S01117E33032
     I**********                              1   3 PBCA           E33032 CSE023
     I**********                              4  13 PSSH                  CSE023
     I**********                             14  190PCPY                  CSE023
     I                                        1   3 PBCAK                 CSE023
     I                                        4  13 PSSHK                 CSE023
     I**********                             14  190PCPYK                              CSE023 CSD027
     I                                       14  19 PCPYK                                     CSD027
      *                                                                   103361
      * Prime account code                                                103361
     I            DS                                                      103361
     I**********                              1  12 PRACCT                             103361 CGL029
     I                                        1  18 PRACCT                                    CGL029
     I                                        1   6 PRCNUM                103361
     I**********                              7  10 PRACOD                             103361 CGL029
     I**********                             11  12 PRACSQ                             103361 CGL029
     I                                        7  16 PRACOD                                    CGL029
     I                                       17  18 PRACSQ                                    CGL029
     I*                                                                   S01117
     IKSEPCR      DS                                                      S01117
     I*                                                                   S01117
     I* File SEPCCD database error key                                    S01117
     I*                                                                   S01117
     I**********                              1   60CSCN                               S01117 CSD027
     I                                        1   6 CSCN                                      CSD027
     I                                        1   6 ZCUST                 E37051
     I                                        7   9 CSBA                  S01117
     I                                       10  19 CSSC                  S01117
     I*                                                                   087178
     I/COPY WNCPYSRC,SE2400I002
     I***P@DATA******DS                         100                087178 CAC002
     I***P@DATA*     DS                            128                               CAC002 AR853119
     IP@DATA      DS                            141                                         AR853119
     I/COPY WNCPYSRC,SE2400I004
     I** Data structure of the parameter passed to and from SEZ010        087178
     I                                        1   1 P@CLAS                087178
     I                                        2   2 P@PPRE                087178
     I                                        3  150P@PAMD                087178
     I                                       16  280P@PCHA                087178
     I                                       29  410P@PCAM                087178
     I                                       42  540P@TASO                087178
     I                                       55  670P@TAUS                087178
     I                                       68  808P@PSXR                087178
     I                                       81  81 P@PMDI                087178
     I                                       82  84 P@PNCY                087178
     I                                       85  87 P@PSCU                087178
     I                                       88 1000P@PSAT                087178
     I                                      101 1138P@FXMR                CAC002
     I                                      114 1260P@MAMT                CAC002
     I                                      127 128 P@TDTP                CAC002
     I                                      129 1410P@STAM                                  AR853119
     I            DS                                                      236816
     I**********                              1   60CDCNZN                             236816 CSD027
     I                                        1   6 CDCNZN                                    CSD027
     I/COPY WNCPYSRC,SE2400I003
     I*
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                   S01408
     C/COPY WNCPYSRC,SE2400IIP2                                           S01408
      *                                                                   S01408
     ISDBRCH    E DSSDBRCHPD                                              S01447
     I** Branch Details                                                   S01447
     I*                                                                   S01446
     ISDCURR    E DSSDCURRPD                                              S01446
     I** Currency Details                                                 S01446
     I*                                                                   063199
     ISDGELR    E DSSDGELRPD                                              063199
     I** General Ledger details                                           063199
     I*                                                                   063199
     ISDSTRD    E DSSDSTRDPD                                              S01519
     I** Securities Trading ICD                                           S01519
     I*                                                                   S01447
     ISECNTR    E DSSECNTRPD                                              S01447
     I** SE Country tax rate details                                      S01447
     I*                                                                   S01447
     ISECBTX    E DSSECBTXPD                                              S01447
     I** SE Country to Branch tax rate details                            S01447
     ISDMMOD    E DSSDMMODPD                                              S01486
     I**  Data structure for module details                               S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I**  Data structure for portfolio management details                 S01486
     I*                                                                   S01486
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I**  Data structure for portfolio client                             S01486
     I*                                                                   S01486
     ISECSPD    E DSSDSECSPD                                              S01486
     I** Securities Trading Customer Details access object                S01486
     I              QQACCD                          QQACC1                                    CGL029
     I*                                                                   S01486
     ISDRETL    E DSSDRETLPD                                              103361
     I** Retail ICD details                                               103361
     I              QQACCD                          QQACC2                                    CGL029
     I*                                                                   S01447
      *                                                                   S01408
     ISCSARD    E DSSCSARDPD                                              CSE026
      ** Data structure for switchable features file                      CSE026
      *                                                                   CSE026
     I              LCD                             SCLCD                 CSE026
     I/COPY WNCPYSRC,SE2400IIP1                                           S01408
      *                                                                   S01408
     IDSFDY     E DSDSFDY                                                 S01447
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01447
     I*                                                                   S01447
     IDSSDY     E DSDSSDY                                                 S01447
     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01447
     I*                                                                   S01447
     IDSLDY     E DSDSLDY                                                                     233792
      ** Data structure for access program, extra long data structure                         233792
      *                                                                                       233792
     IPPOSET    E DSPOSETD                                                CSE023
     I*  Position Settlement record for calling SE2310                    CSE023
      *                                                                                       CGL031
     ISDLOCN    E DSSDLOCNPD                                                                  CGL031
      ** Midas SD Location Codes                                                              CGL031
      *                                                                                       CGL031
     ISDCUST    E DSSDCUSTPD                                                                  CGL031
      ** Midas SD Customer Details File                                                       CGL031
     I              QQDFAC                          QQDFA1                                    CGL031
      *                                                                                       CGL031
     ISDCTTX    E DSSDCTTXPD                                                                  CGL031
      ** Midas SD Country of Tax Codes                                                        CGL031
      *                                                                                       CGL031
     ISDBANK    E DSSDBANKPD                                                                  CGL031
      ** Midas SD Bank Details ICD Files                                                      CGL031
     ISDBRCE    E DSSDBRCHEXPD                                                              AR853119
      ** Branch Details Extension                                                           AR853119
     ISDSTPD    E DSSDSTPDPD                                                                AR853119
      *                                                                                     AR853119
     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
      ** Data structure for Tax Parameter File                                              BUG22911
      *                                                                                     BUG22911
      ***Data*Structure*to*receive*Base*Rate*Details                            AR1001183 AR1001183A
     I***SDBSRT*   E DSSDBSRTPD                                                 AR1001183 AR1001183A
     IETCPOS    E DSETCPOSND                                                                  234440
      ** customer position for EU Savings tax                                                 234440
     I              RECI                            ETRECI                                    234440
     I              CSBA                            ETCSBA                                    234440
     I              CSSC                            ETCSSC                                    234440
     I              CSCN                            ETCSCN                                    234440
     I              PTFR                            ETPTFR                                    234440
     I              SAPD                            ETSAPD                                    234440
     I/COPY WNCPYSRC,HUT103_002                                                               HUT103
      *                                                                                       CGL031
      ** Constant for Instrument Reference                                                    CGL031
     I              ' - Coupon'           C         WINST1                                    CGL031
     I              ' - Dividend'         C         WINST2                                    CGL031
     I              ' - Maturity'         C         WINST3                                    CGL031
     I              ' - Mortgage Payment' C         WINST4                                    CGL031
      *                                                                                       CGL031
      *                                                                                       CGL020
     I              'ZAAMLSETSE'          C         ZAAMLP                                    CGL020
      *                                                                                       CGL020
     I**********    'ZACALCSPRT'          C         SPRDSR                      AR1001183 AR1001183A
     ISDSTAT    E DSSDSTAT                                                                  AR324886
      ** SD Data area                                                                       AR324886
      *                                                                                     AR324886
     I/COPY ZSRSRC,ZHOLI                                                  S01512
     I*                                                                   S01512
      *                                                                                       219566
      * Data structure for AOSVALR0 string                                                    219566
     I            DS                                                                          219566
     I                                        1 200 SVAL1                                     219566
     I                                        1   1 DEF001                                    219566
      *                                                                                       219566
      * System Value                                                                          219566
     I            DS                                                                          219566
     I I            'UseDefaultSettAccnt '    1  20 SVALK1                                    219566
      *                                                                                       219566
     I/COPY WNCPYSRC,SE2400I001
      /EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*
     C* KEYLISTS FOR CHAINING TO FILES
     C*
     C* CUST. POSITIONS -   SHORT KEY,CURRENT ONLY LF/CPOSS
     C*
     C           CPOSKY    KLIST
     C                     KFLD           WCSSC
     C*
     C* CUST. POSITIONS -  HISTORY AND CURRENT   LF/CPOSH
     C*
     C           CPOHKY    KLIST
     C***********          KFLD           WCSBR                           S01117
     C                     KFLD           WCSBA                           S01117
     C                     KFLD           WCSSC
     C                     KFLD           WCSCN
     C                     KFLD           WCSDA
     C*
     C**SECURITY*EVENTS*-************************LF/SECED                 E20016
     C* SECURITY EVENTS -                        LF/SEDEV                 E20016
     C*
     C           SECDKY    KLIST
     C                     KFLD           SASN
     C                     KFLD           SDED
     C                     KFLD           SDET
     C*                                                                   E36391
     C*  - SECURITY DIARY EVENTS                                          E36391
     C           SEDKEY    KLIST                                          E36391
     C                     KFLD           SASN                            E36391
     C                     KFLD           SAAT                            E36391
     C                     KFLD           SAED                            E36391
     C*
     C* SECURITIES LF/SECTY
     C*
     C           SECTKY    KLIST
     C                     KFLD           SASN
     C*
     C* INVESTMENT TYPES LF/INVTP
     C*
     C           INVTKY    KLIST
     C                     KFLD           NMCY
     C                     KFLD           SITP
     C*
     C* STANDARD SETTLEMENT INSTRUCTIONS PF/STDSED
     C*
     C           STDSKY    KLIST
     C***********          KFLD           SBRH                            S01117
     C                     KFLD           SBRA                            S01117
     C                     KFLD           CSTM
     C                     KFLD           WBKCD   2                                           CSE028
     C                     KFLD           CYSI
     C                     KFLD           ITSI
     C                     KFLD           WPTFR   4                                           CSE028
     C*                                                                   S01117
     C* Customer Position Profit Centre Record PF/SEPCCD                  S01117
     C*                                                                   S01117
     C           KSEPCC    KLIST                                          S01117
     C                     KFLD           CSCN                            S01117
     C                     KFLD           CSBA                            S01117
     C                     KFLD           CSSC                            S01117
     C*                                                                   S01519
     C** Default charges table.  LF/SEDFTCPD                              S01519
     C*                                                                   S01519
     C           DFTKY1    KLIST                                          S01519
     C                     KFLD           DCCLAS                          S01519
     C                     KFLD           DCINVT                          S01519
     C                     KFLD           DCCUST                          S01519
      *                                                                   CSE026
     C           DFTKYG    KLIST                                          CSE026
     C                     KFLD           DCCLGR                          CSE026
     C                     KFLD           DCINVT                          CSE026
     C/COPY WNCPYSRC,SE2400C067
     C                     KFLD           DCCUST                          CSE026
     C*                                                                   S01519
     C** Security details                                                 S01519
     C*                                                                   S01519
     C           @CCOD     KLIST                                          S01519
     C                     KFLD           @CCY                            S01519
     C                     KFLD           @CAM    2                       S01519
     C*                                                                   S01486
     C**FIRST*CUSTOMER*POSITION FILE             LF/PMFPSNLL       S01486 189942
     C***********                                                  S01486 189942
     C***********PMFPKY    KLIST                                   S01486 189942
     C***********          KFLD           CSCN                     S01486 189942
     C***********          KFLD           WWPDAT                   S01486 189942
     C***********                                                  S01486 189942
     C**CURRENT*CUSTOMER*POSITION FILE           LF/PMCPSSLL       S01486 189942
     C***********                                                  S01486 189942
     C***********PMCPSS    KLIST                                   S01486 189942
     C***********          KFLD           WWTDVA  1                S01486 189942
     C***********          KFLD           SASN                     S01486 189942
     C***********                                                  S01486 189942
     C**ALL*VALUE*DATE*PORTFOLIO POSITIONS       LF/PMVPOSLL       S01486 189942
     C***********                                                  S01486 189942
     C***********PMVPKY    KLIST                                   S01486 189942
     C***********          KFLD           WWCNUM  60               S01486 189942
     C***********          KFLD           WWPTFR  4                S01486 189942
     C***********          KFLD           WWTDSS 10                S01486 189942
     C***********          KFLD           WWTDVA  1                S01486 189942
     C***********          KFLD           WWPDAT  50               S01486 189942
     C*                                                                   189942
     C* FIRST CUSTOMER POSITION FILE             LF/SECDEPL0              189942
     C*                                                                   189942
     C           PMFPKY    KLIST                                          189942
     C                     KFLD           CSCN                            189942
     C                     KFLD           WWCDPA                          189942
     C*                                                                   189942
     C* CURRENT CUSTOMER POSITION FILE           LF/CDEPS                 189942
     C*                                                                   189942
     C           PMCPSS    KLIST                                          189942
     C                     KFLD           SASN                            189942
     C*                                                                   189942
     C* ALL VALUE DATE PORTFOLIO POSITIONS       LF/SECDEPL5              189942
     C*                                                                   189942
     C           PMVPKY    KLIST                                          189942
     C                     KFLD           WWCDPA  3                       189942
     C**********           KFLD           WWCNUM  60                                   189942 CSD027
     C                     KFLD           WWCNUM  6                                           CSD027
     C                     KFLD           WWPTFR  4                       189942
     C                     KFLD           WWTDSS 10                       189942
     C**********           KFLD           WWCDPT  60                                   189942 CSD027
     C                     KFLD           WWCDPT  6                                           CSD027
     C                     KFLD           WWCDMK  1                       189942
     C                     KFLD           WWDDTE  50                      189942
     C*                                                                   S01486
     C** PORTFOLIO DETAILS PMPORTPD                                       S01486
     C           PMPORT    KLIST                                          S01486
     C**********           KFLD           WWCNU1  60                                   S01486 CSD027
     C                     KFLD           WWCNU1  6                                           CSD027
     C                     KFLD           WWPTF1  4                       S01486
     C*                                                                   S01486
     C** ACCOUNT DETAILS PMACCNL0                                         S01486
     C           ACCNTP    KLIST                                          S01486
     C                     KFLD           WZCNUM                          S01486
     C                     KFLD           WZCCY                           S01486
     C                     KFLD           WZPTFR                          S01486
     C                     KFLD           WZACSQ  20                      S01486
     C*                                                                   219688
     C** ACCOUNT DETAILS PMACCNL1                                         219688
     C           ACCNTL    KLIST                                          219688
     C                     KFLD           WZCNUM                          219688
     C                     KFLD           WZPTFR                          219688
     C                     KFLD           WZCCY                           219688
     C                     KFLD           WZACOD                          219688
     C                     KFLD           WZACSQ                          219688
     C*                                                                   219688
      ** Key to ACCNTAB                                                   136297
      *                                                                   136297
     C           KEYACC    KLIST                                          136297
     C**********           KFLD           KYCNUM  60                                   136297 CSD027
     C                     KFLD           KYCNUM  6                                           CSD027
     C                     KFLD           KYCCY   3                       136297
     C**********           KFLD           KYACOD  40                                   136297 CGL029
     C                     KFLD           KYACOD 100                                          CGL029
     C                     KFLD           KYACSQ  20                      136297
     C                     KFLD           KYBRCA  3                       136297
     C/COPY WNCPYSRC,SE2400C044
     C*
     C* ACCESS ICD INFORMATION IN SUBROUTINE FIRST
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANK    DBLOT
     C                     Z-ADD0         DBASE
      *** Correct setup of DBPGM                                          S01447
     C***********          MOVE 'SE2400  'DBPGM                           S01447
     C                     MOVE *BLANKS   DBPGM                           S01447
     C                     MOVEL'SE2400'  DBPGM                           S01447
     C                     OUT  LDA                                       S01117
     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
     C                     IN   SDSTAT                                                      AR324886
     C                     EXSR FIRST
     C*
     C*  DEPOT NAME INFORMATION - LF/CLINT (PF/CLINTSE)
     C*
     C           CLINTK    KLIST
     C**********           KFLD           WCLNTK  60                                          CSD027
     C                     KFLD           WCLNTK  6                                           CSD027
     C                     KFLD           WLIT1   1
     C*
     C* GET COUNTRY LOCATION - LF/CLINT (PF/CLINTCB)                      S01447
     C*                                                                   S01447
     C           CLKYCB    KLIST                                          S01447
     C**********           KFLD           WCUST   60                                   S01447 CSD027
     C                     KFLD           WCUST   6                                           CSD027
     C                     KFLD           WRTYP   1                       S01447
      *                                                                                     BUG11104
      ** Key to diary event details                                                         BUG11104
      *                                                                                     BUG11104
     C           P4KEY     KLIST                                                            BUG11104
     C                     KFLD           WWSDSN 10                                         BUG11104
     C                     KFLD           WWSDET  2                                         BUG11104
     C                     KFLD           SDED                                              BUG11104
     C*                                                                   S01447
      ** Get Tax Calculation Method - LF/SDTXCML1 (PF/SDTXCMPD)                               CGL031
      *                                                                                       CGL031
     C           KTXCM     KLIST                                                              CGL031
     C                     KFLD           KCSIS   2                                           CGL031
     C                     KFLD           KCTRT   2                                           CGL031
      *                                                                                       CGL031
     C* CHECK FOR DATABASE ERRORS
     C*
     C           *IN99     IFEQ '1'
     C                     GOTO EAUDIT
     C                     END
     C*
     C* DEFINE AND CLEAR WORK FIELDS
     C*
     C           *LIKE     DEFN CSSC      WCSSC
     C           *LIKE     DEFN CSCN      WCSCN
     C************LIKE     DEFN CSBR      WCSBR                           S01117
     C           *LIKE     DEFN CSBA      WCSBA                           S01117
     C           *LIKE     DEFN CSDA      WCSDA
     C           *LIKE     DEFN RECI      WSRECI
     C           *LIKE     DEFN CFCT      WACF                            052254
     C********** *LIKE     DEFN BASC      UBASC                                 AR1001183 AR1001183A
     C********** *LIKE     DEFN BASS      UBASS                                 AR1001183 AR1001183A
     C********** *LIKE     DEFN SPRI      USPRI                                 AR1001183 AR1001183A
     C********** *LIKE     DEFN RDMT      URDMT                                 AR1001183 AR1001183A
     C********** *LIKE     DEFN RDFD      URDFD                                 AR1001183 AR1001183A
     C********** *LIKE     DEFN CNSP      UCNSP                                 AR1001183 AR1001183A
     C********** *LIKE     DEFN CNSG      UCNSG                                 AR1001183 AR1001183A
     C*                                                                   095066
     C*** Check if Value date position is to be used for Dividend.        095066
     C*                                                                   095066
     C                     CALL 'AOSARDR0'                                095066
     C                     PARM '       ' @RTCD   7                       095066
     C                     PARM '*VERIFY' @OPTN   7                       095066
     C                     PARM 'CSE008'  @SARD   6                       095066
     C*                                                                   095066
     C           @RTCD     IFEQ *BLANKS                                   095066
     C                     MOVE 'Y'       CSE008  1                       095066
     C                     ELSE                                           095066
     C                     MOVE 'N'       CSE008                          095066
     C                     ENDIF                                          095066
     C*
     C* LOOP ROUND PROCESSING FOR EACH ACTION RECORD READ LF/SECAC
     C*
     C           *IN89     DOWEQ'0'
     C*
     C* READ ACTION FILE OF SECURITY ACTIONS
     C*
     C                     READ SECAC                    89
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     Z-ADDSAED      ECD     50                      S01486
     C                     END                                            S01486
     C*
     C* IF ACTION RECORD DELETED GOTO END OF LOOP FOR NEXT ACTION
     C*
     C  N89      RECI      CABEQ'*'       ENDLP
     C*
     C* AT END OF FILE -
     C*
     C           *IN89     CABEQ'1'       ENDLP
     C*
     C                     MOVE RECI      WSRECI
     C*
     C** ADD TO COUNTER FOR EACH RECORD READ
     C*      SECURITY ACTION COUNT
     C*
     C                     ADD  1         WCSECT  50
     C                     MOVE '1'       WNEWSC  1
     C                     MOVE '0'       *IN79
     C                     MOVE SASN      WCSSC
     C*
     C* GET EACH CUST WHO HOLDS THIS SECURITY  - EXSR GETDEP
     C*
     C           *IN79     DOWEQ'0'
     C*
     C                     EXSR GETDEP
     C*
     C* IND 79 IS SET ON WHEN NO MORE CUSTS FOR THIS SECURITY
     C*
     C********** *IN79     CABEQ'1'       ENDLP                           S01486
     C           *IN79     CABEQ'1'       PRCPTF                          S01486
     C*
     C** PROCESS SELECTED SECURITY / CUST /DATE RECORD
     C*
     C           BGPFMG    IFNE 'Y'                                                         AR877365
     C           BGN4ST    ANDNE'Y'                                                         AR877365
     C*
     C***RECORD*SELECTED*-*IGNORE*IF*LAST*CHG*DATE*=*RUN*DATE**********   E15549
     C*  NOTE THAT SE2400 WILL PROCESS ALL SECURITY ACTIONS NEW 'TODAY'   E15549
     C*  (AS DEFINED BY THE EVENT CONTROL DATE IN SE2100).                E15549
     C* ((LINES ASTERISKED BELOW BY E14506 RELEVANT TO E15549))           E15549
     C*
     C***********CSCV      CABEQRUND      ENDLP                           E14506
     C***********CSCT      CABEQRUND      ENDLP                           E14506
     C*
     C** IF THIS POSITION DATE IS LESS THAN OR EQUAL TO THE               E15549
     C** LAST COUPON DATE THEN THE EX-COUPON NOMINAL WILL BE ZERO         E15549
      *                                                                                     BUG11104
      **  For shares, obtain DATE of previous dividend from Diary                           BUG11104
      **  Events File.                                                                      BUG11104
      *                                                                                     BUG11104
     C                     EXSR SECTIN                                                      BUG11104
     C                     EXSR INVTIN                                                      BUG11104
     C           PROT      IFEQ '4'                                                         BUG11104
     C                     MOVELSASN      WWSDSN                                            BUG11104
     C                     MOVE 'DV'      WWSDET                                            BUG11104
     C                     Z-ADDSAED      SDED                                              BUG11104
     C           P4KEY     SETGTSECET                                                       BUG11104
     C                     READPSECET                    72                                 BUG11104
      *                                                                                     BUG11104
     C           *IN72     IFEQ '0'                                                         BUG11104
     C           SDSN      ANDEQWWSDSN                                                      BUG11104
     C           SDET      ANDEQWWSDET                                                      BUG11104
     C                     Z-ADDSDED      SALCCP                                            BUG11104
     C                     ELSE                                                             BUG11104
     C                     Z-ADD0         SALCCP                                            BUG11104
     C                     ENDIF                                                            BUG11104
     C                     ENDIF                                                            BUG11104
     C*                                                                   E15549
     C           CSDA      IFLE SALCCP                                    E15549
     C                     Z-ADD*ZERO     CSEX                            E15549
     C                     Z-ADD*ZERO     CPCH                                                CGL031
     C                     Z-ADD*ZERO     CSPI                                                CGL031
     C                     END                                            E15549
     C*                                                                   E15549
     C** CALCULATE CUM-COUPON VALUE
     C*
     C           CSNV      SUB  CSEX      WCUMCP 150
     C*                                                                   S01117
     C** EXECUTE SUBROUTINE SECPPC TO RETRIEVE CUSTOMER POSITION          S01117
     C** PROFIT CENTRE DETAILS                                            S01117
     C*                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       063199
     C           WCUMCP    ANDNE0                                         121921
     C                     EXSR SECPPC                                    S01117
     C                     END                                            063199
     C*
      *** For efficiency purposes, make calls to following subroutines    S01447
      *** dependant on change of security.                                S01447
      *                                                                   S01447
     C           CSSC      IFNE UCSSC                                     S01447
      *                                                                   S01447
     C** EXECUTE SUBROUTINE SECTIN TO RETRIEVE SECURITY RECORD
     C*
     C                     EXSR SECTIN
     C*
     C** Execute Subroutine INVTIN to retrieve INVESTMENT Record          E23169
     C*                                                                   E23169
     C                     EXSR INVTIN                                    E23169
      *                                                                   S01447
     C                     MOVE CSSC      UCSSC  10                       S01447
     C                     END                                            S01447
     C*                                                                   E23169
      *** IF THE BOOKING BRANCH READ IS DIFFERENT FROM PREVIOUS RECORD,   S01447
      *** GET COUNTRY LOCATION OF BRANCH.                                 S01447
      *                                                                   S01447
     C           CSBA      IFNE UCSBA                                     S01447
     C                     EXSR GETCTY                                    S01447
     C                     MOVE CSBA      UCSBA   3                       S01447
     C                     END                                            S01447
      *                                                                   S01447
     C** EXECUTE SUBROUTINES DEPENDING ON ACTION TYPE
     C*
     C           SAAT      CASEQ'DV'      DIVIDN
     C           SAAT      CASEQ'CP'      COUPON
     C           SAAT      CASEQ'MA'      MATURE
     C           SAAT      CASEQ'MP'      MORTPY
     C         71SAAT      CASEQ'PP'      PARTPY                                              CSE110
     C                     END
     C*
     C********** PSRI      IFEQ 'Y'                                                           CSE110
     C********** SAAT      CASEQ'PP'      PARTPY                                              CSE110
     C           CSE110    IFEQ 'N'                                                           CSE110
     C           PSRI      ANDEQ'Y'                                                           CSE110
     C           SAAT      CASEQ'PP'      PARTPY                                              CSE110
     C                     END
     C                     END
     C                     ENDIF                                                            AR877365
     C                     END                                            080741
     C*
     C* ADD TO COUNT OF POSITIONS PROCESSED
     C*
     C                     ADD  1         WCPOSN  50
     C*
     C********** ENDLP     TAG                             ** ENDLP **    S01486
     C           PRCPTF    TAG                                            S01486
     C*                                                                   S01486
     C* CHECK THAT PORTFOLIO MANAGEMENT IS PRESENT IN THE SYSTEM          S01486
     C* OR PRIVATE BANKING MODULE IS ACTVE                                CPB001
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                        B2             S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   S01486
     C* GENERATE POSITION SETTLEMENTS FOR ALL PORTFOLIO POSITIONS         S01486
     C* SET FLAG FOR FIRST SECURITY POSITION                              S01486
     C*                                                                   S01486
     C                     MOVE 'Y'       WSPOSN  1                       S01486
     C*                                                                   S01486
     C* SET FLAG FOR POSITIONS TO PROCESS                                 S01486
     C*                                                                   S01486
     C                     MOVE 'Y'       WPORTP  1                       S01486
     C*                                                                   S01486
     C* GET NEXT PORTFOLIO POSITION FOR SECURITY ACTION                   S01486
     C*                                                                   S01486
     C                     EXSR GETPTF                                    S01486
     C*                                                                   S01486
     C* SET FIRST SECURITY FLAG TO 'N'                                    S01486
     C*                                                                   S01486
     C                     MOVE 'N'       WSPOSN                          S01486
     C*                                                                   S01486
     C* DO WHILE PORTFOLIO POSITIONS FOUND                                S01486
     C*                                                                   S01486
     C           WPORTP    DOWEQ'Y'                        B3             S01486
     C*                                                                   S01486
     C* IF THE POSITION DATE IS LESS THAN OR EQUAL TO THE LAST COUPON     S01486
     C* DATE THEN THE EX-COUPON NOMINAL WILL BE ZERO                      S01486
      **  For shares, obtain DATE of previous dividend from Diary                           BUG11104
      **  Events File.                                                                      BUG11104
      *                                                                                     BUG11104
     C                     EXSR SECTIN                                                      BUG11104
     C                     EXSR INVTIN                                                      BUG11104
     C           PROT      IFEQ '4'                                                         BUG11104
     C                     MOVELSASN      WWSDSN                                            BUG11104
     C                     MOVE 'DV'      WWSDET                                            BUG11104
     C                     Z-ADDSAED      SDED                                              BUG11104
     C           P4KEY     SETGTSECET                                                       BUG11104
     C                     READPSECET                    72                                 BUG11104
      *                                                                                     BUG11104
     C           *IN72     IFEQ '0'                                                         BUG11104
     C           SDSN      ANDEQWWSDSN                                                      BUG11104
     C           SDET      ANDEQWWSDET                                                      BUG11104
     C                     Z-ADDSDED      SALCCP                                            BUG11104
     C                     ELSE                                                             BUG11104
     C                     Z-ADD0         SALCCP                                            BUG11104
     C                     ENDIF                                                            BUG11104
     C                     ENDIF                                                            BUG11104
     C*                                                                   S01486
     C***********QAPDAT    IFLE SALCCP                     B4      S01486 189942
     C***********          Z-ADD0         QACSEX                   S01486 189942
     C***********          END                             E4      S01486 189942
     C***********                                                  S01486 189942
     C           DDTE      IFLE SALCCP                     B4             189942
     C                     Z-ADD0         CSEX                            189942
     C                     Z-ADD0         CPCH                                                CGL031
     C                     Z-ADD0         CSPI                                                CGL031
     C                     END                             E4             189942
     C*                                                                   189942
     C* CALCULATE CUMULATIVE COUPON NOMINAL VALUE                         S01486
     C***********                                                  S01486 189942
     C***********QANOML    SUB  QACSEX    WCUMCP                   S01486 189942
     C*                                                                   189942
     C           CDNV      SUB  CSEX      WCUMCP                          189942
     C*                                                                   080741
     C** EXECUTE SUBROUTINE SECPPC TO RETRIEVE CUSTOMER POSITION          080741
     C** PROFIT CENTRE DETAILS                                            080741
     C*                                                                   080741
     C           BKPRCU    IFEQ 'Y'                                       080741
     C                     EXSR SECPPC                                    080741
     C                     END                                            080741
     C*                                                                   S01486
     C** EXECUTE SUBROUTINE SECTIN TO RETRIEVE SECURITY RECORD            S01486
     C*                                                                   S01486
     C***********          MOVE QATDSS    SASN                     S01486 189942
     C                     MOVE CDSN      SASN                            189942
     C                     EXSR SECTIN                                    S01486
     C*                                                                   S01486
     C                     EXSR INVTIN                                    S01486
     C*                                                                   S01486
     C** EXECUTE SUBROUTINES DEPENDING ON ACTION TYPE                     S01486
     C*                                                                   S01486
     C                     MOVE WWPTFR    PTFR                            S01486
     C           SAAT      CASEQ'DV'      DIVIDN           B4             S01486
     C           SAAT      CASEQ'CP'      COUPON                          S01486
     C           SAAT      CASEQ'MA'      MATURE                          S01486
     C           SAAT      CASEQ'MP'      MORTPY                          S01486
     C                     END                             E4             S01486
     C*                                                                   S01486
     C           PSRI      IFEQ 'Y'                        B4             S01486
     C           SAAT      CASEQ'PP'      PARTPY           B5             S01486
     C                     END                             E5             S01486
     C                     END                             E4             S01486
     C*                                                                   S01486
     C* GET NEXT PORTFOLIO POSITION FOR SECURITY ACTION                   S01486
     C*                                                                   S01486
     C                     EXSR GETPTF                                    S01486
     C*                                                                   S01486
     C                     END                             E3             S01486
     C                     END                             E2             S01486
     C******************** END                                            080741
     C                     END
     C*
     C           ENDLP     TAG                             ** ENDLP **    S01486
     C*
     C           EAUDIT    TAG                             ** EAUDIT **
     C*
     C* OUTPUT RUN CONTROL REPORT
     C*
     C                     EXSR AUDIT
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C/COPY WNCPYSRC,SE2400C040
     C                     SETON                     LR
      *                                                               *
      *================================================================
      /EJECT
      *****************************************************************   S01447
      *                                                               *   S01447
      *  GETCTY - Get Country of Branch                               *   S01447
      *                                                               *   S01447
      *  CALLED FROM: MAIN                                            *   S01447
      *                                                               *   S01447
      *****************************************************************   S01447
      *                                                                   S01447
     C           GETCTY    BEGSR                                          S01447
      *                                                                   S01447
     C**********           CALL 'AOBRCHR0'                                             S01447 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01447
     C                     PARM '*KEY   ' @OPTN   7                       S01447
     C                     PARM CSBA      @BRCD   3                       S01447
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01447 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01447
     C           @RTCD     IFNE *BLANKS                    *B1            S01447
     C           *LOCK     IN   LDA                                       S01447
     C                     MOVEL'SDBRCHL1'DBFILE           ***************S01447
     C                     MOVELCSBA      DBKEY            ** DBERROR 019 S01447
     C                     Z-ADD19        DBASE            ***************S01447
     C                     SETON                       U7U8               S01447
     C                     EXSR *PSSR                                     S01447
     C                     GOTO EAUDIT                                    S01447
     C                     ELSE                            *X1            S01447
      *                                                                   S01447
     C                     MOVE A8BICN    WCUST                           S01447
     C           CLKYCB    CHAINCLINT                54    *B2            S01447
     C           *IN54     IFEQ '1'                                       S01447
     C           RECI      OREQ '*'                                       S01447
     C           *LOCK     IN   LDA                        ***************S01447
     C                     Z-ADD20        DBASE            * DBERROR 020 *S01447
     C                     MOVEL'CLINTCBF'DBFILE           ***************S01447
     C                     MOVELA8BICN    DBKEY                           S01447
     C                     SETON                       U7U8               S01447
     C                     EXSR *PSSR                                     S01447
     C                     GOTO EAUDIT                                    S01447
     C                     ELSE                            *X2            S01447
      *                                                                   S01447
     C                     MOVE CLOC      UBRLOC                          S01447
     C                     END                             *E2            S01447
     C                     END                             *E1            S01447
      *                                                                   S01447
     C                     ENDSR                                          S01447
      *****************************************************************   S01447
      /EJECT                                                              S01447
     C*****************************************************************
     C*                                                               *
     C* GETDEP   - GET CUST. POSITION RECORD TO UPDATE NEXT FOR THIS  *
     C*            SECURITY ACTION.                                   *
     C*                                                               *
     C*****************************************************************
     C*
     C           GETDEP    BEGSR                           ** GETDEP **
     C*
     C*  IF,IN THIS SUBR,A CUST. IS IGNORED BECAUSE DATE OF EARLIEST
     C*  POSITION IS GREATER THAN ACTION DATE, SEARCH FOR NEXT CUSTOMER
     C*  RESUMES AT GETIN
     C***********                                                  E21715 E23807
     C***********                                                  E21715 E23807
     C***********          SETOF                     66            E21715 E23807
     C*                                                                   E21715
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE *BLANKS   PTFR                            S01486
     C                     END                                            S01486
     C*
     C           GETIN     TAG                             ** GETIN  **
     C*
     C** IF NEW SECURITY ACTION RECORD, USE SHORT KEY TO SETLL ON
     C*  CPOSS FILE - LATEST DATES ONLY ARE ACCESSED VIA THIS LOGICAL
     C*
     C           WNEWSC    IFEQ '1'
     C                     MOVE '0'       WNEWSC
     C           CPOSKY    SETLLCPOSS                    77
     C           *IN77     IFEQ '0'
     C                     MOVE '1'       *IN79
     C                     GOTO ENDDEP
     C                     END
     C                     END
     C*
     C** READ THE NEXT SECURITY/CUST./BRANCH/LAST POSITION DATE
     C*
     C           CPOSKY    READECPOSS                    79
     C           *IN79     CABEQ'1'       ENDDEP
     C           RECI      CABEQ'*'       GETIN
      *                                                                                       CGL031
      ** Place the retrieve CSCN,CSBA into a work variable                                    CGL031
      ** to be used in ZATXCLPI/ZATXCLJA later.                                               CGL031
      *                                                                                       CGL031
     C**********           Z-ADDCSCN      YCSCN   60                                  CGL031 CSD027A
     C                     MOVE CSCN      YCSCN   6                                          CSD027A
     C                     MOVELCSBA      YCSBA   3                                           CGL031
     C*
     C** IF THE EVENT TYPE ON THE SECURITY ACTION IS 'MA' (MATURITY)      E14236
     C** UPDATE THE LATEST DEPOT POSITION WITH RECI = 'H'.                E14236
     C*                                                                   E14236
     C           SAAT      IFEQ 'MA'                                      E14236
     C           AKRI      ANDEQ'Y'                                       E15696
     C                     MOVEL'H'       RECI                            E14236
     C                     UPDATCPOSNDF                                   E14236
     C                     END                                            E14236
     C*
     C**SELECT*THIS*RECORD*FOR*UPDATE*IF*THE*POSITION*DATE*(CSDA)******   S01510
     C**IS*LESS*THAN*SECURITY*ACTION*DATE*OR*EQUAL*TO*IT*IF*ACTION*TYPE   S01510
     C**IS*VALUE*'PP'.*************************************************   S01510
     C***********                                                         S01510
     C***********SAAT      IFEQ 'PP'                                      S01510
     C***********CSDA      ANDLTSAED                                      S01510
     C***********SAAT      ORNE 'PP'                                      S01510
     C***********CSDA      ANDLESAED                                      S01510
     C***********SAAT      OREQ 'DV'                               E16815 E24422
     C* SELECT THIS RECORD FOR UPDATE IF THE POSITION DATE (CSDA)
     C* IS LESS THAN SECURITY ACTION DATE OR EQUAL TO IT IF ACTION TYPE
     C* IS VALUE 'PP'.& S01486 ON
     C*
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           SAAT      IFEQ 'MA'                                      S01486
     C           CSDA      ANDLESAED                                      S01486
     C           SAAT      OREQ 'DV'                                      099266
     C           CSDA      ANDLESAEXD                                     099266
     C           S01510    ANDEQ'Y'                                       099266
     C           SAAT      ORNE 'MA'                                      S01486
     C           CSDA      ANDLTSAED                                      S01486
     C           S01510    ANDEQ'N'                                       099266
     C           SAAT      ORNE 'MA'                                      099266
     C           SAAT      ANDNE'DV'                                      099266
     C           CSDA      ANDLTSAED                                      099266
     C           S01510    ANDEQ'Y'                                       099266
     C                     GOTO ENDDEP                                    S01486
     C                     END                                            S01486
     C                     ELSE                                           S01486
     C*                                                                   S01510
     C** Select the record based on the following                         S01510
     C** ..event type is DV AND position date < ex-dividend date          S01510
     C**        AND S01510 is active                                      S01510
     C** ..OR event type = MA AND position date <= security action date   S01510
     C** ..OR event type <> MA and position date < security action date   S01510
     C**        AND S01510 is not active                                  S01510
     C** ..OR event type <> MA and DV and position < security action      S01510
     C**        date AND S01510 is active                                 S01510
     C*                                                                   S01510
     C           SAAT      IFEQ 'DV'                                      S01510
     C***********CSDA      ANDLTSAEXD                               S01510094839
     C           CSDA      ANDLESAEXD                                     094839
     C           S01510    ANDEQ'Y'                                       S01510
     C*                                                                   S01510
     C           SAAT      OREQ 'MA'                                      S01510
     C           CSDA      ANDLESAED                                      S01510
     C*                                                                   S01510
     C           SAAT      ORNE 'MA'                                      S01510
     C           CSDA      ANDLTSAED                                      S01510
     C           S01510    ANDEQ'N'                                       S01510
     C*                                                                   S01510
     C           SAAT      ORNE 'MA'                                      S01510
     C           SAAT      ANDNE'DV'                                      S01510
     C           CSDA      ANDLTSAED                                      S01510
     C           S01510    ANDEQ'Y'                                       S01510
     C                     GOTO ENDDEP
     C                     END
     C*********************GOTO ENDDEP                                    094748
     C                     END
     C*
     C** MOST TRANSACTIONS WILL HAVE BEEN SELECTED BY THE ABOVE TEST
     C**
     C** ONLY BACKVALUATIONS REMAIN AND CPOSH IS USED TO FIND THE
     C*  CORRECT DATE TO UPDATE. USE THE FULL KEY ON FILE CPOSH
     C*
     C***RELEASE*LOCK*ON*RECORD************************************E21715 E23807
     C***********                                                  E21715 E23807
     C***********          UPDATCPOSNDF                            E21715 E23807
     C*
     C** SET UP KEY WITH BRANCH,CUST. AND ACTION DATE
     C*
     C***********          MOVE CSBR      WCSBR                           S01117
     C                     MOVE CSBA      WCSBA                           S01117
     C                     MOVE CSCN      WCSCN
     C*
     C** If S01510 is active AND event type = DV, use ex-dividend date    S01510
     C*                                                                   S01510
     C           S01510    IFEQ 'Y'                                       S01510
     C           SAAT      ANDEQ'DV'                                      S01510
     C***********          Z-ADDSAEXD     WCSDA                     S01510094839
     C           SAEXD     ADD  1         WCSDA                           094839
     C                     ELSE                                           S01510
     C                     Z-ADDSAED      WCSDA
     C                     END                                            S01510
     C*                                                                   S01510
     C           CPOHKY    SETLLCPOSH                    77
      *                                                                   051107
      ***  If Backvaluation is Equal To the Action Date, it should not    051107
      ***  be selected for any Action, not just 'PP'.                     051107
     C*
     C***IF*77*IS*ON*A*MATCH*IS*FOUND*-*IF*ACTION*TYPE*NOT*PP*SELECT*IT   051107
     C***********                                                         051107
     C************IN77     IFEQ '1'                                       051107
     C***********SAAT      ANDNE'PP'                                      051107
     C***********                                                         051107
     C***NOW*READ*RECORD*FROM*CPOSH*FILE*******************************   051107
     C***********                                                         051107
     C***********CPOHKY    READECPOSH                    77               051107
     C***********RECI      IFNE '*'                                       051107
     C***********          SETON                     66            E21715 E23807
     C***********          GOTO ENDDEP                                    051107
     C***********          END                                            051107
     C***********          END                                            051107
     C*
     C***IF VALUE DATE POSITION IS NEEDED FOR DIVIDEND                    095066
     C*                                                                   095066
     C           *IN77     IFEQ '1'                                       095066
     C           SAAT      ANDEQ'DV'                                      095066
     C           CSE008    ANDEQ'Y'                                       095066
     C*                                                                   095066
     C           CPOHKY    READECPOSH                    77               095066
     C           *IN77     IFEQ '0'                                       095066
     C           RECI      ANDNE'*'                                       095066
     C                     GOTO ENDDEP                                    095066
     C                     END                                            095066
     C*                                                                   095066
     C                     END                                            095066
     C*                                                                   095066
     C* THIS LEAVES A BACKVALUATION  AGAINST A CUST. POSITION
     C* ON A DATE PRIOR TO THE SEC.ACTION DATE
     C*
     C           RDLOOP    TAG                              **RDLOOP**
     C                     READPCPOSH                    77
     C           *IN77     CABEQ'1'       GETIN
     C           RECI      CABEQ'*'       RDLOOP
     C           WCSSC     IFNE CSSC
     C           WCSCN     ORNE CSCN
     C***********WCSBR     ORNE CSBR                                      S01117
     C           WCSBA     ORNE CSBA                                      S01117
     C                     GOTO GETIN
     C                     END
     C*
     C**IF*DATE*IS*LESS*THAN*ACTION*DATE**SELECT*IT********************   S01510
     C***********                                                         S01510
     C***********CSDA      IFLT SAED                                      S01510
     C***********          SETON                     66            E21715 E23807
     C** The selection is as follows:                                     S01510
     C** .. if event type is DV AND position date < ex-dividend date      S01510
     C**       AND S01510 is active                                       S01510
     C** .. if position date < security action date and S01510 is off     S01510
     C** .. if position date < security action date and event type is     S01510
     C**       not DV and S01510 is active                                S01510
     C*                                                                   S01510
     C           SAAT      IFEQ 'DV'                                      S01510
     C***********CSDA      ANDLTSAEXD                               S01510094839
     C           CSDA      ANDLESAEXD                                     094839
     C           S01510    ANDEQ'Y'                                       S01510
     C*                                                                   S01510
     C           CSDA      ORLT SAED                                      S01510
     C           S01510    ANDEQ'N'                                       S01510
     C*                                                                   S01510
     C           CSDA      ORLT SAED                                      S01510
     C           SAAT      ANDNE'DV'                                      S01510
     C           S01510    ANDEQ'Y'                                       S01510
     C                     GOTO ENDDEP
     C                     END
      *                                                                   051107
      ***  If the Event Date is Equal To the Action Date, it should not   051107
      ***  be selected for any Action, not just 'PP'.                     051107
     C*
     C**IF*DATE*IS*EQUAL*TO*ACTION*DATE*AND*ACTION*TYPE*IS*NOT*=*PP****   051107
     C**THEN*SELECT*IT*.***********************************************   051107
     C***********                                                         051107
     C***********CSDA      IFEQ SAED                                      051107
     C***********SAAT      ANDNE'PP'                                      051107
     C***********          SETON                     66            E21715 E23807
     C***********          GOTO ENDDEP                                    051107
     C***********          END                                            051107
     C*
     C* DATE IS NOT LESS THAN ACTION DATE - READ PREVIOUS
     C*
     C                     GOTO RDLOOP
     C*                                                                   S01486
     C* CHECK WHETHER PORTFOLIO POSITIONS EXISTED FOR THE SECURITY        S01486
     C* ON THE SECURITY ACTION EVENT DATE                                 S01486
     C* SET PORTFOLIO POSITION FLAG                                       S01486
     C*                                                                   S01486
     C           ENDDEP    TAG                                            S01486
     C                     MOVE 'N'       WPPOSN  1                       S01486
     C*                                                                   S01486
     C* CHECK IF CUSTOMER POSITION AND IF PM IS PRESENT ON THE SYSTEM     S01486
     C* OR IF CUSTOMER POSITION AND IF PB IS PRESENT ON THE SYSTEM        CPB001
     C*                                                                   S01486
     C           *IN79     IFEQ '0'                                       S01486
     C           BGPFMG    ANDEQ'Y'                                       S01486
     C           *IN79     OREQ '0'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C*                                                                   S01486
     C* SET POSITION DATE TO *LOVAL                                       S01486
     C*                                                                   S01486
     C***********          MOVE *LOVAL    WWPDAT  50               S01486 189942
     C                     MOVE CSBA      WWCDPA  3                       189942
     C*                                                                   S01486
     C**SET*LOWER*LIMITS ON PMFPSNLL USING CUST. NO/ POSITION DATE S01486 189942
     C***********                                                  S01486 189942
     C***********PMFPKY    SETLLPMFPSNLL                           S01486 189942
     C***********          READ PMFPSNLL                 75        S01486 189942
     C***********                                                  S01486 189942
     C* SET LOWER LIMITS ON SECDEPL0 USING CUST. NO/ DEPOT REF            189942
     C*                                                                   189942
     C           PMFPKY    SETLLSECDEPL0                                  189942
     C                     READ SECDEPL0                 75               189942
     C*                                                                   189942
     C* CHECK THAT RECORD EXISTS ON THE FILE FOR THE CUSTOMER             S01486
     C*                                                                   S01486
     C           *IN75     IFEQ '0'                                       S01486
     C***********QACNUM    ANDEQCSCN                               S01486 189942
     C           CDCN      ANDEQCSCN                                      189942
     C           CDPA      ANDEQCSBA                                      189942
     C*                                                                   S01486
     C* CHECK SECURITY ACTION AND POSTING DATE                            S01486
     C*                                                                   S01486
     C           SAAT      IFEQ 'MA'                                      S01486
     C***********QAPDAT    ANDLESAED                               S01486 189942
     C           DDTE      ANDLESAED                                      189942
     C           SAAT      OREQ 'DV'                                      099266
     C***********QAPDAT    ANDLTSAEXD                              099266 189942
     C           DDTE      ANDLTSAEXD                                     189942
     C           S01510    ANDEQ'Y'                                       099266
     C           SAAT      ORNE 'MA'                                      S01486
     C***********QAPDAT    ANDLTSAED                               S01486 189942
     C           DDTE      ANDLTSAED                                      189942
     C           S01510    ANDEQ'N'                                       099266
     C           SAAT      ORNE 'MA'                                      099266
     C           SAAT      ANDNE'DV'                                      099266
     C***********QAPDAT    ANDLTSAED                               099266 189942
     C           DDTE      ANDLTSAED                                      189942
     C           S01510    ANDEQ'Y'                                       099266
     C*                                                                   S01486
     C** EXECUTE SUBROUTINE SECTIN TO RETRIEVE SECURITY RECORD            S01486
     C*                                                                   S01486
     C                     EXSR SECTIN                                    S01486
     C*                                                                   S01486
     C* CHECK SECURITY FOR MATURITY EVENT                                 S01486
     C*                                                                   S01486
     C           SAAT      IFEQ 'MA'                                      S01486
     C                     MOVE 'Y'       WPPOSN                          S01486
     C*                                                                   S01486
     C**  .... OTHERWISE THIS CUSTOMER POSITION SHOULD NOT BE PROCESSED   S01486
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C** RETURN TO SEARCH FOR NEXT CUSTOMER POSITION                      S01486
     C                     GOTO GETIN                                     S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C/COPY WNCPYSRC,SE2400C034
     C*
     C********** ENDDEP    ENDSR                            **ENDDEP**    S01486
     C                     ENDSR                                          S01486
     C*
      *
      *****************************************************************
      /EJECT
     C********************************************************************S01486
     C*                                                                   S01486
     C* GETPTF   - GET PORTFOLIO POSITIONS FOR A SECURITY.                S01486
     C*                                                                   S01486
     C           GETPTF    BEGSR                           ** GETPTF **   S01486
     C*          ******                                                   S01486
     C*                                                                   S01486
     C* CHECK THAT THIS IS THE FIRST SECURITY POSITION                    S01486
     C*                                                                   S01486
     C           WSPOSN    IFEQ 'Y'                        B1             S01486
     C*                                                                   S01486
     C***FOR*GIVIDEND*EVENTS CHECK WHETHER TRADE DATE POSITION EXI S01486 189942
     C***OTHERWISE*SETTLEMENTS GENERATED AGAINST VALUE DATE POSITI S01486 189942
     C***********SAAT      IFEQ 'DV'                       B2      S01486 189942
     C***********          MOVE 'T'       WWTDVA                   S01486 189942
     C***********          ELSE                            X2      S01486 189942
     C***********          MOVE 'V'       WWTDVA                   S01486 189942
     C***********          END                             E2      S01486 189942
     C***********                                                  S01486 189942
     C**SET*LOWER*LIMITS*ON CURRENT POSITION FILE. LF/PMCPSSLL     S01486 189942
     C***********                                                  S01486 189942
     C***********PMCPSS    SETLLPMCPSSLL                           S01486 189942
     C*                                                                   189942
     C* SET LOWER LIMITS ON CURRENT POSITION FILE. LF/CDEPS               189942
     C*                                                                   189942
     C           PMCPSS    SETLLCDEPS                                     189942
     C                     END                             E1             S01486
     C*                                                                   S01486
     C* READ CURRENT POSITIONS BY SECURITY FILE                           S01486
     C*                                                                   S01486
     C           RDNEXT    TAG                                            S01486
     C***********PMCPSS    READEPMCPSSLL                 76        S01486 189942
     C           PMCPSS    READECDEPS                    76               189942
     C*                                                                   S01486
     C* DO WHILE RECORDS EXIST FOR THE SECURITY                           S01486
     C*                                                                   S01486
     C           *IN76     IFEQ '0'                        B1             S01486
     C*                                                                   S01486
     C***********          MOVE QACNUM    WWCNUM                   S01486 189942
     C***********          MOVE QAPTFR    WWPTFR                   S01486 189942
     C***********          MOVE QATDSS    WWTDSS                   S01486 189942
     C                     MOVE CDCN      WWCNUM                          189942
     C                     MOVE PTFR      WWPTFR                          189942
     C                     MOVE CDSN      WWTDSS                          189942
      *                                                                                       CGL031
      ** Place the retrieve CDCN,CDPA into a work variable                                    CGL031
      ** to be used in ZATXCLPI/ZATXCLJA later.                                               CGL031
      *                                                                                       CGL031
     C**********           Z-ADDCDCN      YCSCN                                       CGL031 CSD027A
     C                     MOVE CDCN      YCSCN                                              CSD027A
     C                     MOVELCDPA      YCSBA                                               CGL031
      *                                                                                       CGL031
     C*                                                                   S01486
     C* CHECK SECURITY ACTION AND POSTING DATE                            S01486
     C*                                                                   S01486
     C           SAAT      IFEQ 'MA'                       B2             S01486
     C***********QAPDAT    ANDLESAED                               S01486 189942
     C           DDTE      ANDLESAED                                      189942
     C           SAAT      ORNE 'MA'                                      S01486
     C***********QAPDAT    ANDLTSAED                               S01486 189942
     C           DDTE      ANDLTSAED                                      189942
     C           S01510    ANDEQ'N'                                       099266
     C           SAAT      ORNE 'MA'                                      099266
     C           SAAT      ANDNE'DV'                                      099266
     C***********QAPDAT    ANDLTSAED                               099266 189942
     C           DDTE      ANDLTSAED                                      189942
     C           S01510    ANDEQ'Y'                                       099266
     C           SAAT      OREQ 'DV'                                      094839
     C***********QAPDAT    ANDLESAEXD                              094839 189942
     C           DDTE      ANDLESAEXD                                     189942
     C           S01510    ANDEQ'Y'                                       094839
     C*                                                                   S01486
     C* VALID RECORD - EXIT TO GENERATE POSITION SETTLEMENTS              S01486
     C*                                                                   S01486
     C                     GOTO ENDPTF                                    S01486
     C                     END                             E2             S01486
     C*                                                                   S01486
     C* DETERMINE WHETHER POSITION EXISTED BEFORE SECURITY ACTION         S01486
     C* SET GREATER THAN ON PMVPOSLL WITH KEY OF CUSTOMER/                S01486
     C* PORTFOLIO REF./ SECURITY/ SECURITY ACTION DATE                    S01486
     C*                                                                   S01486
     C***********          MOVE QACNUM    WWCNUM                   S01486 189942
     C***********          MOVE QAPTFR    WWPTFR                   S01486 189942
     C***********          MOVE QATDSS    WWTDSS                   S01486 189942
     C***********          MOVE SAED      WWPDAT                   S01486 189942
     C***********                                                  S01486 189942
     C***********PMVPKY    SETGTPMAPOSLL                           S01486 189942
     C***********          READPPMAPOSLL                 74        S01486 189942
     C***********                                                  S01486 189942
     C                     MOVE CDPA      WWCDPA                          189942
     C                     MOVE CDCN      WWCNUM                          189942
     C                     MOVE PTFR      WWPTFR                          189942
     C                     MOVE CDSN      WWTDSS                          189942
     C                     MOVE CDPT      WWCDPT                          189942
     C                     MOVE CDMK      WWCDMK                          189942
     C                     MOVE SAED      WWDDTE                          189942
      *                                                                                      251950A
      ** If S01510 is active and event type is 'DV', use ex-dividend                         251950A
      ** date.                                                                               251950A
      *                                                                                      251950A
     C           S01510    IFEQ 'Y'                                                          251950A
     C           SAAT      ANDEQ'DV'                                                         251950A
     C                     MOVE SAEXD     WWDDTE                                             251950A
     C                     ELSE                                                              251950A
     C                     MOVE SAED      WWDDTE                                             251950A
     C                     END                                                               251950A
     C*                                                                   189942
     C           PMVPKY    SETGTSECDEPL5                                  189942
     C                     READPSECDEPL5                 74               189942
     C*                                                                   189942
     C* CHECK RECORD EXISTS FOR CUST/PORTFOLIO REFERENCE/SECURITY         S01486
     C*                                                                   S01486
     C           *IN74     IFEQ '0'                        B2             S01486
     C***********QACNUM    ANDEQWWCNUM                             S01486 189942
     C***********QAPTFR    ANDEQWWPTFR                             S01486 189942
     C***********QATDSS    ANDEQWWTDSS                             S01486 189942
     C***********QATVDA    ANDEQWWTDVA                             S01486 189942
     C           CDCN      ANDEQWWCNUM                                    189942
     C           PTFR      ANDEQWWPTFR                                    189942
     C           CDSN      ANDEQWWTDSS                                    189942
     C           CDPT      ANDEQWWCDPT                                                       251950A
     C           CDMK      ANDEQWWCDMK                                                       251950A
     C           CDPA      ANDEQWWCDPA                                                       251950A
     C*                                                                   S01486
     C* CHECK SECURITY ACTION                                             S01486
     C*                                                                   S01486
     C           SAAT      IFEQ 'MA'                       B3             S01486
     C*                                                                   S01486
     C* VALID RECORD - EXIT TO GENERATE POSITION SETTLEMENTS              S01486
     C*                                                                   S01486
     C                     GOTO ENDPTF                                    S01486
     C                     ELSE                            X3             S01486
     C*                                                                   S01486
     C* CHECK POSTING DATE IS LESS THAN EVENT DATE                        S01486
     C*                                                                   S01486
     C***********QAPDAT    IFLT SAED                       B4      S01486 189942
     C           DDTE      IFLT SAED                       B4             189942
     C           SAAT      ANDNE'DV'                                      099266
     C***********QAPDAT    ORLT SAEXD                              099266 189942
     C           DDTE      ORLT SAEXD                                     189942
     C           SAAT      ANDEQ'DV'                                      099266
     C*                                                                   S01486
     C* VALID RECORD - EXIT TO GENERATE POSITION SETTLEMENTS              S01486
     C*                                                                   S01486
     C                     GOTO ENDPTF                                    S01486
     C                     END                             E4             S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C* READ PREVIOUS RECORD                                              S01486
     C*                                                                   S01486
     C***********          READPPMAPOSLL                 74        S01486 189942
     C                     READPSECDEPL5                 74               189942
     C*                                                                   S01486
     C* CHECK RECORD EXISTS FOR CUST/PORTFOLIO REFERENCE/SECURITY         S01486
     C*                                                                   S01486
     C           *IN74     IFEQ '0'                        B3             S01486
     C***********QACNUM    ANDEQWWCNUM                             S01486 189942
     C***********QAPTFR    ANDEQWWPTFR                             S01486 189942
     C***********QATDSS    ANDEQWWTDSS                             S01486 189942
     C***********QATVDA    ANDEQWWTDVA                             S01486 189942
     C           CDCN      ANDEQWWCNUM                                    189942
     C           PTFR      ANDEQWWPTFR                                    189942
     C           CDSN      ANDEQWWTDSS                                    189942
     C           CDPT      ANDEQWWCDPT                                                       251950A
     C           CDMK      ANDEQWWCDMK                                                       251950A
     C           CDPA      ANDEQWWCDPA                                                       251950A
     C*                                                                   S01486
     C* RECORD EXISTS - EXIT PROCESS                                      S01486
     C*                                                                   S01486
     C                     GOTO ENDPTF                                    S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C                     END                             E2             S01486
     C                     GOTO RDNEXT                                    S01486
     C                     END                             E1             S01486
     C*                                                                   S01486
     C* SET NO MORE POSITIONS TO PROCESS FLAG                             S01486
     C*                                                                   S01486
     C                     MOVE 'N'       WPORTP                          S01486
     C*                                                                   S01486
     C           ENDPTF    ENDSR                            **ENDPTF**    S01486
     C*                                                                   S01486
     C********************************************************************S01486
      /EJECT                                                              S01486
      *****************************************************************
      *                                                               *
      *  DIVIDN - Subroutine to produce Dividend Account Keys and/or  *
      *           Position Settlements.                               *
      *                                                               *
      *****************************************************************
      *
     C           DIVIDN    BEGSR                           ** DIVIDN **
     C*
     C** CALCULATE DIVIDEND DUE
     C*
     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
     C** IF S01509 is active, user value ccy instead of nominal ccy       S01509
     C*
     C********** S01509    IFEQ 'Y'                                                  S01509 BUG11198
     C**********           MOVE VLCY      WCURR   3                                  S01509 BUG11198
     C**********           ELSE                                                      S01509 BUG11198
     C                     MOVE NMCY      WCURR   3
     C**********           END                                                       S01509 BUG11198
     C                     EXSR TG10
     C*                                                                   S01446
     C** For Courtage Enhancement, if Autocharge option is 'Y' and        S01446
     C** charge currency is not blank, update fields                      S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           BVACOP    ANDEQ'Y'                                       S01446
     C           BVCHRC    ANDNE*BLANKS                                   S01446
     C*                                                                   S01446
     C** Get M/D indicator and spot rate of input ccy from SDCURRPD       S01446
     C*                                                                   S01446
     C                     Z-ADD25        WDBAS1  30                      S01446
     C                     EXSR #LCURR                                    S01446
     C                     Z-ADDA6SPRT    ZRATE2 138                      S01446
     C                     MOVE A6MDIN    ZMDI2   1                       S01446
     C                     Z-ADDTXSPOT    ZRATE1 138                      S01446
     C                     MOVE TXMDI     ZMDI1   1                       S01446
     C                     EXSR ZXRATE                                    S01446
     C                     MOVE ZRATEX    TRATEX 138                      S01446
     C                     MOVE ZMDIX     TMDIX   1                       S01446
     C                     END                                            S01446
      *                                                                   E19610
      *  FOR DIVIDENDS, CALCULATE CUM-COUPON VALUE USING THE TRADE DATE   E19610
      *  POSITION INSTEAD OF THE VALUE DATE.                              E19610
     C** If S01510 is active, the cum-coupon value must be the trade      S01510
     C** nominal                                                          S01510
     C*** (Use Value date position if required)                           095066
     C*                                                                   095066
      *                                                                   E19610
     C           S01510    IFEQ 'Y'                                       S01510
     C           CSE008    IFNE 'Y'                                       095066
     C                     Z-ADDCSNT      WCUMCP                          S01510
     C                     ELSE                                           095066
     C                     Z-ADDCSNV      WCUMCP                          095066
     C                     END                                            095066
     C                     ELSE                                           S01510
     C           CSE008    IFNE 'Y'                                       095066
     C           CSNT      SUB  CSEX      WCUMCP                          E19610
     C                     ELSE                                           095066
     C           CSNV      SUB  CSEX      WCUMCP                          095066
     C                     END                                            093385
     C                     END                                            095066
     C*                                                                   093385
     C           WPORTP    IFEQ 'Y'                                       S01486
     C           BGPFMG    ANDEQ'Y'                                       S01486
     C           WPORTP    OREQ 'Y'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C***********QANOML    SUB  QACSEX    WCUMCP                   S01486 189942
     C********** CDNT      SUB  CSEX      WCUMCP                                     189942 AR877365
     C           CDNT      SUB  CECN      WCUMCP                                            AR877365
     C                     END                                            S01486
     C*********************END                                     S01510 093385
     C*
     C* DIVIDEND DUE CALCULATION
     C* CUM-COUPON MULTIPLIED BY AMOUNT PER UNIT (SAED)
     C* GIVING WORK (15/4). MULTIPLY BY POWER VALUE AND RESULT IN 13/0
     C*
     C*********************Z-ADD0         DC                              E22638
     C*********************SUB  NMDP      DC      10                      E22638
     C***********DC        ADD  5         DC      10                      E22638
     C***********WCUMCP    MULT POWER8,DC WRK154                          E20086
     C***********WCUMCP    MULT POWER8,DC WRK154 154                E20086E22638
     C*
     C***********WRK154    MULT SDAU      WRK154 154                      E16772
     C***********WRK154    MULT SDUN      WRK158                    E16772E20086
     C***********WRK154    MULT SDUN      WRK158 158                E20086E22638
     C***********CDP       ADD  5         DC                              E22638
     C***********WRK154    MULT POWER8,DC WRK154                          E16772
     C***********WRK158    MULT POWER8,DC WRK158                    E16772E22638
     C***********WRK154    DIV  1         WDIVDU 130H                     E16772
     C***********WRK158    DIV  1         WDIVDU 130H               E16772E22638
     C*
     C** IF PRICE BASIS (SECTYD) IS 'P', DIVIDE BY 100
     C*
     C***********SPBS      IFEQ 'P'                                       E22638
     C***********WDIVDU    DIV  100       WDIVDU    H                     E22638
     C*********************END                                            E22638
     C** USE SUBROUTINE SCNSD TO CALCULATE DIVIDEND DUE                   E22638
     C                     Z-ADDWCUMCP    ZNOML                           E22638
     C                     Z-ADDSDUN      ZPRC                            E22638
     C***********SPBS      IFEQ 'P'                                E23169 087712
     C***********          MULT 100       ZPRC                     E23169 087712
     C***********          END                                     E23169 087712
     C                     EXSR ZCNSD                                     E22638
     C                     Z-ADDZCONS     WDIVDU 150                      E22638
     C** If S01509 is active, and value currency is different from                          BUG11198
     C** nominal currency, convert coupon amount to value currency                          BUG11198
     C*                                                                                     BUG11198
     C           S01509    IFEQ 'Y'                                                         BUG11198
     C           NMCY      ANDNEVLCY                                                        BUG11198
     C                     MOVE NMCY      WCURR   3                                         BUG11198
     C                     EXSR TG10                                                        BUG11198
     C                     Z-ADDZCDP      ZCDPI                                             BUG11198
     C                     MOVE VLCY      WCURR   3                                         BUG11198
     C                     EXSR TG10                                                        BUG11198
     C                     Z-ADDZCDP      ZCDPO                                             BUG11198
     C                     MOVE NMCY      ZCCYI                                             BUG11198
     C                     MOVE VLCY      ZCCYO                                             BUG11198
     C                     Z-ADDWDIVDU    ZAMTCI                                            BUG11198
     C*                                                                                     BUG11198
     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event                     BUG11198
     C** found, else from SECTYD                                                            BUG11198
     C*                                                                                     BUG11198
     C                     MOVE SAAT      WSAAT   2                                         BUG11198
     C                     MOVE 'XR'      SAAT                                              BUG11198
     C           SEDKEY    SETLLSEDEVDO                                                     BUG11198
     C                     READ SEDEVDO                  81                                 BUG11198
     C           *IN81     IFEQ '0'                                                         BUG11198
     C           SDSN      ANDEQSASN                                                        BUG11198
     C           SDET      ANDEQ'XR'                                                        BUG11198
     C                     Z-ADDSDCE      ZEXCH                                             BUG11198
     C                     MOVE SDMD      ZMD                                               BUG11198
     C                     ELSE                                                             BUG11198
     C                     Z-ADDSEXR      ZEXCH                                             BUG11198
     C                     MOVE SMDI      ZMD                                               BUG11198
     C                     ENDIF                                                            BUG11198
     C                     MOVE WSAAT     SAAT                                              BUG11198
     C                     EXSR ZCONV                                                       BUG11198
     C                     Z-ADDZAMTCO    WDIVDU                                            BUG11198
     C                     ENDIF                                                            BUG11198
     C/COPY WNCPYSRC,SE2400C001
     C*
     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
     C*
     C           AKRI      IFEQ 'Y'
     C                     MOVE 'H'       WACEVC
     C*
     C** SET NEGATIVE IND TO N IF SPLIT NEG ACCRUAL IS NOT N AND
     C** AND CUM-COUPON VALUE NOT GREATER THAN ZERO
     C*
     C           SNAC      IFEQ 'N'
     C           WCUMCP    ORGT 0
     C                     MOVE ' '       WACNEG
     C                     ELSE
     C                     MOVE 'N'       WACNEG
     C                     END
     C                     MOVE 'DI'      WACAMC
     C                     Z-ADDWDIVDU    EVAM
     C*
     C** REVERSE SIGN ON OUTPUT FILE IF SPLIT NEG ACCRUAL IS Y AND
     C** CUM-COUPON VALUE IS LESS THAN ZERO
     C*
     C           WCUMCP    IFLT 0
     C           SNAC      ANDEQ'Y'
     C                     Z-SUBEVAM      EVAM
     C/COPY WNCPYSRC,SE2400C002
     C                     END
     C                     EXSR W01
     C/COPY WNCPYSRC,SE2400C003
     C                     END
     C*
     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
     C*
     C           PSRI      IFEQ 'Y'
     C/COPY WNCPYSRC,SE2400C004
     C                     MOVE 'DV'      PEVT
     C                     Z-ADDWCUMCP    PNMP
     C           WDIVDU    IFLT 0
     C                     Z-SUBWDIVDU    PAMD
     C/COPY WNCPYSRC,SE2400C005
     C                     ELSE
     C                     Z-ADDWDIVDU    PAMD
     C/COPY WNCPYSRC,SE2400C006
     C                     END
     C           WCUMCP    IFGT 0
     C**********           MOVE 'R'       PPRE                            E14704
     C                     MOVE 'P'       PPRE                            E14704
     C                     ELSE
     C**********           MOVE 'P'       PPRE                            E14704
     C                     MOVE 'R'       PPRE                            E14704
     C                     END
     C***********          EXSR W02                                                           233709
      *                                                                                       233709
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
      *                                                                                       CGL031
      ** If CGL031 is on                                                                      CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
      *                                                                                       CGL031
      ** If Security or Security Diary Event is not Taxable, nothing must be calculated and   CGL031
      ** nothing must be output on SDCSINPD.                                                  CGL031
      *                                                                                       CGL031
      ** Check if Security is Taxable                                                         CGL031
      *                                                                                       CGL031
     C           SETX      IFEQ 'Y'                                                           CGL031
     C                     MOVELSAAT      WSAAT                                               CGL031
     C                     MOVEL'DV'      SAAT                                                CGL031
      *                                                                                       CGL031
     C           SEDKEY    SETLLSEDEVDO                                                       CGL031
     C                     READ SEDEVDO                  81                                   CGL031
     C           *IN81     IFEQ *OFF                                                          CGL031
     C           SDSN      ANDEQSASN                                                          CGL031
     C           SDET      ANDEQ'DV'                                                          CGL031
      *                                                                                       CGL031
      ** Check if Diary Event is Taxable                                                      CGL031
      ** Check also the Classification must be D or S.                                        CGL031
      *                                                                                       CGL031
     C           NSETX     IFEQ 'Y'                                                           234577
     C********** SETX      IFEQ 'Y'                                                    CGL031 234577
     C********** SAED      ANDLTBJDNWD                                                 CGL031 233709
     C********** CSNV      ANDGT*ZERO                                                  CGL031 234406
     C********** C1DI      IFEQ 'D'                                                    CGL031 234440
     C********** C1DI      OREQ 'S'                                                    CGL031 234440
     C                     EXSR DIVTAX                                                        CGL031
     C**********           ENDIF                                                       CGL031 234440
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVELWSAAT     SAAT                                                CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     EXSR W02                                                           233709
     C                     END
     C/COPY WNCPYSRC,SE2400C007
     C***********                                                  E21715 E23807
     C***RESET*EX/DIVIDEND*NOMINAL*FOR*NEXT*DIVIDEND*PERIOD********E21715 E23807
     C***********                                                  E21715 E23807
     C***********LCPN      IFEQ SAED                               E21715 E23807
     C***********                                                  E21715 E23807
     C***IF*'DV'*EVENT*IS*BACKVALUED*ZEROIZE*EX-DIVIDEND*NOMINAL*FOR21715 E23807
     C***THIS*POSITION*RECORD*AND*SUBTRACT*THIS*AMOUNT*FROM*THE*NOMINAL15 E23807
     C***ON*SUBSEQUENT*POSTION*RECORDS*****************************E21715 E23807
     C***********                                                  E21715 E23807
     C************IN66     IFEQ '1'                                E21715 E23807
     C***********          Z-ADDCSEX      SCSEX  130               E21715 E23807
     C************IN44     DOWEQ'0'                                E21715 E23807
     C***********          SUB  SCSEX     CSEX                     E21715 E23807
     C***********          UPDATCPOSNDFH                           E21715 E23807
     C***********          READ CPOSH                    44        E21715 E23807
     C************IN44     IFEQ '0'                                E21715 E23807
     C***********                                                  E21715 E23807
     C***********WCSSC     IFNE CSSC                               E21715 E23807
     C***********WCSCN     ORNE CSCN                               E21715 E23807
     C***********WCSBR     ORNE CSBR                               E21715 E23807
     C***********          SETON                         44        E21715 E23807
     C***********          END                                     E21715 E23807
     C***********                                                  E21715 E23807
     C***RELEASE*LOCK**********************************************E21715 E23807
     C************IN44     IFEQ '1'                                E21715 E23807
     C***********          UPDATCPOSNDFH                           E21715 E23807
     C***********          END                                     E21715 E23807
     C***********                                                  E21715 E23807
     C***********          END                                     E21715 E23807
     C***********          END                                     E21715 E23807
     C***********                                                  E21715 E23807
     C***NORMAL*CASE*-*DIVIDEND*EVENT*IS*NOT*BACKVALUED************E21715 E23807
     C***********                                                  E21715 E23807
     C***********          ELSE                                    E21715 E23807
     C***********          Z-ADD0         CSEX                     E21715 E23807
     C***********          UPDATCPOSNDF                            E21715 E23807
     C***********          END                                     E21715 E23807
     C***********          END                                     E21715 E23807
     C           ENDDIV    ENDSR                           **ENDDIV**
      *
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  DIVTAX - Subroutine to calculate tax for descretionary and   *                       CGL031
      *           safe custody customers.                             *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           DIVTAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Check if record needs to be taxed.                                                   CGL031
      *                                                                                       CGL031
     C                     EXSR CHKTAX                                                        CGL031
      *                                                                                       CGL031
      ** Calculate Dividend Due                                                               CGL031
      *                                                                                       CGL031
      ** Nominal Decimal places retrieved - Now use CCY to get CCY DP                         CGL031
      ** If S01509 is active, user value ccy instead of nominal ccy                           CGL031
      *                                                                                       CGL031
     C           S01509    IFEQ 'Y'                                                           CGL031
     C                     MOVE VLCY      WCURR                                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE NMCY      WCURR                                               CGL031
     C                     ENDIF                                                              CGL031
     C                     EXSR TG10                                                          CGL031
      *                                                                                       CGL031
      *  For Dividends, calculate CUM-COUPON Value using the Trade Date                       CGL031
      *  Position instead of the Value Date.                                                  CGL031
      ** If S01510 is active, the cum-coupon value must be the trade                          CGL031
      ** nominal                                                                              CGL031
      *** (Use Value date position if required)                                               CGL031
      *                                                                                       CGL031
     C           S01510    IFEQ 'Y'                                                           CGL031
     C           CSE008    IFNE 'Y'                                                           CGL031
     C                     Z-ADDCSNT      WCUMCP                                              CGL031
     C                     ELSE                                                               CGL031
     C                     Z-ADDCSNV      WCUMCP                                              CGL031
     C                     ENDIF                                                              CGL031
     C                     ELSE                                                               CGL031
     C           CSE008    IFNE 'Y'                                                           CGL031
     C           CSNT      SUB  CSEX      WCUMCP                                              CGL031
     C                     ELSE                                                               CGL031
     C           CSNV      SUB  CSEX      WCUMCP                                              CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           WPORTP    IFEQ 'Y'                                                           CGL031
     C           BGPFMG    ANDEQ'Y'                                                           CGL031
     C           WPORTP    OREQ 'Y'                                                           CGL031
     C           BGN4ST    ANDEQ'Y'                                                           CGL031
     C           CDNT      SUB  CSEX      WCUMCP                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Dividend Due calculation                                                             CGL031
      ** CUM-COUPON multiplied by Amount per unit (SAED)                                      CGL031
      ** Giving Work (15/4). Multiply by Power Value and result in 13/0                       CGL031
      *                                                                                       CGL031
      ** Use Subroutine SCNSD to Calculate Dividend Due                                       CGL031
      *                                                                                       CGL031
     C                     Z-ADDWCUMCP    ZNOML                                               CGL031
     C                     Z-ADDSDUN      ZPRC                                                CGL031
     C                     EXSR ZCNSD                                                         CGL031
     C                     Z-ADDZCONS     WDIVDU                                              CGL031
      *                                                                                       CGL031
      ** If no record found, no tax is calculated                                             CGL031
      *                                                                                       CGL031
      ** Calculate the Tax Amount for the Dividend                                            CGL031
      ** Output Information on SDCSINPD file                                                  CGL031
      *                                                                                       CGL031
     C           WNOTAX    IFEQ ' '                                                           CGL031
     C                     EXSR DVTXCL                                                        CGL031
      *                                                                                       CGL031
      ***Output*Tax*Account*Keys***************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           EXSR W04                                                    CGL031 233709
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  DVTXCL - Subroutine to calculate tax for the Dividend and to *                       CGL031
      *           Output Information on SDCSINPD                      *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           DVTXCL    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialise work variables                                                            CGL031
      *                                                                                       CGL031
     C***********          Z-ADD0         WTTXSR 150                                   CGL031 233709
     C***********          Z-ADD0         WTTXSS 150                                   CGL031 233709
     C***********          Z-ADD0         WTTXSC 150                                   CGL031 233709
     C***********          Z-ADD0         WTTXSB 150                                   CGL031 233709
     C***********          Z-ADD0         WTNINT 150                                   CGL031 233709
     C***********          Z-ADD0         WTNINS 150                                   CGL031 233709
     C***********          Z-ADD0         WTNINC 150                                   CGL031 233709
     C***********          Z-ADD0         WTNINB 150                                   CGL031 233709
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
     C                     MOVE ' '       WTXPI   1                                           CGL031
     C                     MOVE ' '       WTXJA   1                                           CGL031
      *                                                                                       CGL031
     C                     MOVE YCSCN     @@CUST                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLPI'                                                    CGL031
      ** Input                                                                                CGL031
     C                     PARM 'S'       @@MODI                                              CGL031
     C                     PARM SASN      @@TRRF                                              CGL031
     C                     PARM YCSBA     @@BRCA                                              CGL031
     C                     PARM           @@CUST                                              CGL031
     C                     PARM *ZERO     @@STRD                                              CGL031
     C                     PARM *ZERO     @@ENDD                                              CGL031
     C                     PARM WDIVDU    @@TOTI                                              CGL031
     C                     PARM WTRAB     @@TAXR                                              CGL031
     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
     C                     PARM NMCY      @@OCCY                                              233568
     C                     PARM *BLANKS   PINTH   1                                           CER048
      ** Output                                                                               CGL031
     C                     PARM           @@IAED                                              CGL031
     C                     PARM           @@TAXA                                              CGL031
     C                     PARM           @@TOTO                                              CGL031
     C                     PARM           @@TXCY                                              CGL031
     C                     PARM           @@CTAX                                              CGL031
     C                     PARM           @@TXBS                                              CGL031
     C                     PARM           @@WTAC                                              CGL031
     C                     PARM           @@COLC                                              CGL031
     C                     PARM           @@STAT                                              CGL031
     C                     PARM           @@TRTE                                              CGL031
     C                     PARM           @@TXR1                                              CGL031
     C**********           PARM *ZEROS    PSTXB   20                                 CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC  100                                 CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR   64                                 CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP   1                                  CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA  150                                 CER048 BUG22911
     C                     PARM           @@KEY                                               CGL031
     C                     PARM           @@FILE                                              CGL031
     C                     PARM           @@RTRN                                              CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
      ** If return code = Error.                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHEQ 'ERROR'                                                       CGL031
     C                     MOVE @@FILE    DBFILE                                              CGL031
     C                     MOVE @@KEY     DBKEY                                               CGL031
     C                     Z-ADD60        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
      *                                                                                       CGL031
      ** If return code = Private Individual                                                  CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHNE 'JOINT'                                                       CGL031
      *                                                                                       CGL031
     C           @@TOTO    IFNE *ZERO                                                         CGL031
     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
     C           @@STAT    OREQ 'DISCL'                                                       CGL031
     C           @@STAT    OREQ 'SELF'                                                        CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WTXPI                                               CGL031
     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
     C                     MOVE S1CTTA    KCSIS                                               236815
     C                     MOVE @@CTAX    KCTRT                                               CGL031
      *                                                                                       CGL031
     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
     C           *IN61     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
     C           TCTXCM    WHEQ 1                                                             CGL031
     C********** *IN80     OREQ *ON                                                    CGL031 236815
     C           SWHTFD    OREQ 'N'                                                           236815
     C********** S1RASO    OREQ 0                                                      CGL031 234813
     C           UTXRSR    OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 2                                                             CGL031
     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
     C********** @@TOTI    SUB  WTAXA     @@TAXA                                       CGL031 236696
     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236696
     C                     MULT @@TAXR    @@TAXA                                              CGL031
     C                     DIV  100       @@TAXA    H                                         CGL031
     C           @@TAXA    IFLT 0                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 3                                                             CGL031
     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C                     SUB  WTAXA     @@TAXA                                              CGL031
     C           @@TAXA    IFLT 0                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 4                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Write record to SDCSINPD                                                             CGL031
      *                                                                                       CGL031
     C                     EXSR CSINSR                                                        CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If return code = Joint Account                                                       CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHEQ 'JOINT'                                                       CGL031
     C                     MOVE YCSCN     KJANO   6                                           CGL031
      *                                                                                       CGL031
     C           KJANO     SETLLSDJACCLB                                                      CGL031
     C           KJANO     READESDJACCLB                 60                                   CGL031
      *                                                                                       CGL031
     C           *IN60     DOWEQ*OFF                                                          CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLJA'                                                    CGL031
      ** Input                                                                                CGL031
     C                     PARM 'S'       @@MODI                                              CGL031
     C                     PARM SASN      @@TRRF                                              CGL031
     C                     PARM YCSBA     @@BRCA                                              CGL031
     C                     PARM JCJANO    @@JANO  6                                           CGL031
     C                     PARM JCCUST    @@CUST                                              CGL031
     C                     PARM JCNAHO    @@NARF 10                                           CGL031
     C                     PARM JCINVP    @@INVP 10                                           CGL031
     C                     PARM JCPAHT    @@PAHT  1                                         BUG26839
     C                     PARM *ZERO     @@STRD                                              CGL031
     C                     PARM *ZERO     @@ENDD                                              CGL031
     C                     PARM WDIVDU    @@TOTI                                              CGL031
     C                     PARM WTRAB     @@TAXR                                              CGL031
     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
     C                     PARM NMCY      @@OCCY                                              233568
     C                     PARM *BLANKS   PINTH                                               CER048
      ** Output                                                                               CGL031
     C                     PARM           @@IAED                                              CGL031
     C                     PARM           @@TAXA                                              CGL031
     C                     PARM           @@TOTO                                              CGL031
     C                     PARM           @@TXCY                                              CGL031
     C                     PARM           @@CTAX                                              CGL031
     C                     PARM           @@TXBS                                              CGL031
     C                     PARM           @@WTAC                                              CGL031
     C                     PARM           @@COLC                                              CGL031
     C                     PARM           @@STAT                                              CGL031
     C                     PARM           @@TRTE                                              CGL031
     C                     PARM           @@TXR1                                              CGL031
     C                     PARM           @@JAMG  1                                           CGL031
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY                                               CGL031
     C                     PARM           @@FILE                                              CGL031
     C                     PARM           @@RTRN                                              CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
      ** If return code = Error.                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'ERROR'                                                       CGL031
     C                     MOVE @@FILE    DBFILE                                              CGL031
     C                     MOVE @@KEY     DBKEY                                               CGL031
     C                     Z-ADD61        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           @@TOTO    IFNE *ZERO                                                         CGL031
     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
     C           @@STAT    OREQ 'DISCL'                                                       CGL031
     C           @@STAT    OREQ 'SELF '                                                       CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WTXJA                                               CGL031
     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
     C                     MOVE S1CTTA    KCSIS                                               236815
     C                     MOVE @@CTAX    KCTRT                                               CGL031
      *                                                                                       CGL031
     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
     C           *IN61     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
     C           TCTXCM    WHEQ 1                                                             CGL031
     C********** *IN80     OREQ *ON                                                    CGL031 236815
     C           SWHTFD    OREQ 'N'                                                           236815
     C********** S1RASO    OREQ 0                                                      CGL031 234813
     C           UTXRSR    OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 2                                                             CGL031
     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
     C********** @@TOTI    SUB  WTAXA     @@TAXA                                       CGL031 236696
     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C           S1RASO    MULT @@TOTO    WTAXA                                               236815
     C                     DIV  100       WTAXA                                               236815
     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236696
     C                     MULT @@TAXR    @@TAXA                                              CGL031
     C                     DIV  100       @@TAXA    H                                         CGL031
     C           @@TAXA    IFLT 0                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 3                                                             CGL031
     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C                     SUB  WTAXA     @@TAXA                                              CGL031
     C           @@TAXA    IFLT 0                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 4                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Write record to SDCSINPD                                                             CGL031
      *                                                                                       CGL031
     C                     EXSR CSINSR                                                        CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'NOTAX'                                                       CGL031
     C           @@RTRN    OREQ 'TAXAB'                                                       CGL031
     C           KJANO     READESDJACCLB                 60                                   CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If @@RTRN = Last, end loop                                                           CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'LAST'                                                        CGL031
     C                     MOVE *ON       *IN60                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C           ENDDVT    ENDSR                                                              CGL031
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  COUPON - Subroutine to produce Coupon Account Keys and/or    *
      *           Position Settlements.                               *
      *                                                               *
      *****************************************************************
      *
     C           COUPON    BEGSR                           ** COUPON **
     C*                                                                   E15549
     C***USE*LAST*COUPON*DATE*FROM*THE*SECURITY*ACTION************ E15549 E21715
     C***********                                                  E15549 E21715
     C***********          Z-ADDSALCCP    LCPN                     E15549 E21715
     C*
     C** CALCULATE INTEREST DUE VIA P/ZACCRC FOR SECURITY
     C*  FROM DATE IS LAST COUPON / TO DATE IS EVENT DATE.
     C*  GET NOMINAL CCY DEC PLACES FROM TABTG10 FIRST (CDP)              E15549
     C*                                                                   E15549
     C                     MOVE NMCY      WCURR   3                       E15549
     C                     EXSR TG10                                      E15549
      *                                                                   S01486
      * SAVE_NO_OF_DECIMAL_PLACES.                                        S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           *LIKE     DEFN CDP       WWCDP                           S01486
     C                     Z-ADDCDP       WWCDP                           S01486
     C                     END                                            S01486
     C*
     C** WHEN PARM ZAB IS 'A' , INTEREST IS CALCULATED AFTER CHANGES
     C*
     C*                                                                   S01486
     C** IF SETTLEMENTS BASED ON PORTFOLIO POSITIONS USE STANDARD PM      S01486
     C** SUBROUTINES TO CALCULATE ACCRUAL AMOUNT                          S01486
     C           WPORTP    IFEQ 'Y'                                       S01486
     C           BGPFMG    ANDEQ'Y'                                       S01486
     C           WPORTP    OREQ 'Y'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C*                                                                   S01486
     C** IF THE PROCESSING TYPE FROM LF/INVTP IS NOT EQUAL TO 6 IE.       S01486
     C** THIS IS NOT A SCHULDSCHEIN SECURITY                              S01486
     C           PROT      IFNE '6'                                       S01486
     C                     Z-ADDWCUMCP    ZAMTP                           S01486
     C                     Z-ADDSALCCP    ZFMDAT                          S01486
     C                     Z-ADDSAED      ZTODAT                          S01486
     C                     Z-ADDSAED      NCD     50                      S01486
     C***********          MOVELQATDSS    ZSSNM                    S01486 189942
     C                     MOVELCDSN      ZSSNM                           189942
     C                     Z-ADDWWCDP     A6NBDP                          S01486
     C*                                                                   S01486
     C** CALCULATE THE ACCRUED INTEREST FROM THE LAST COUPON DATE TO      S01486
     C** THE EVENT CONTROL DATE AS PER STANDARD SUBROUTINE ZAINSH         S01486
     C                     EXSR ZAINSH                                    S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** IF THE PROCESSING TYPE FROM LF/INVTP IS EQUAL TO 6 IE.           S01486
     C** THIS IS A SCHULDSCHEIN SECURITY                                  S01486
     C           PROT      IFEQ '6'                                       S01486
     C                     Z-ADDSALCCP    ZFMDAT                          S01486
     C                     Z-ADDSAED      ZTODAT                          S01486
     C                     Z-ADDSAED      NCD                             S01486
     C***********          Z-ADDQACNUM    XCUST   60               S01486 189942
     C***********          MOVELQAPTFR    ZPTRF                    S01486 189942
     C***********          MOVELQATDSS    ZSSNM                    S01486 189942
     C***********          MOVELQATVDA    ZTVBS                    S01486 189942
     C                     MOVE CDPA      ZCDPA                           189942
     C**********           Z-ADDCDCN      XCUST   60                                   189942 CSD027
     C                     MOVE CDCN      XCUST   6                                           CSD027
     C                     MOVELPTFR      ZPTRF                           189942
     C                     MOVELCDSN      ZSSNM                           189942
     C**********           Z-ADDCDPT      ZCDDP                                        189942 CSD027
     C                     MOVE CDPT      ZCDDP                                               CSD027
     C                     MOVELCDMK      ZCDMK                           189942
     C                     Z-ADDWWCDP     A6NBDP                          S01486
     C*                                                                   S01486
     C** CALCULATE THE ACCRUED INTEREST FROM THE LAST COUPON DATE         S01486
     C** TO THE EVENT CONTROL DATE AS PER STANDARD SUBROUTINE ZAISCH      S01486
     C                     EXSR ZAISCH                                    S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     Z-ADDZTOAI     ZINTDU                          S01486
     C*                                                                   S01486
     C** WHEN PARM ZAB IS 'A' , INTEREST IS CALCULATED AFTER CHANGES      S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C***********          UNLCKLDA                                       S01117
     C                     MOVE 'A'       ZAB
     C/COPY WNCPYSRC,SE2400C032
     C                     CALL 'ZACCRC'
     C***********          PARM           LCPN                            E21715
     C                     PARM           SALCCP                          E21715
     C                     PARM           SAED
     C***********          PARM           CSBR                            S01117
     C                     PARM           CSBA                            S01117
     C***********          PARM           CSCN                            E37051
     C                     PARM           ZCUST                           E37051
     C                     PARM           CSSC
     C                     PARM           CDP
     C                     PARM           ZINTDU 150
     C                     PARM           ZAB     1
     C**********           PARM           WU8     1
      *                                                                                    AR1001183
     C**********                                                                AR1001183 AR1001183A
     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
      ********** FRATE     IFLE 0                                               AR1001183 AR1001183A
     C***The*following*field*set2*PAMD*to*zero                                  AR1001183 AR1001183A
     C**********           Z-ADD0         ZINTDU                                AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********           ENDIF                                                AR1001183 AR1001183A
     C/COPY WNCPYSRC,SE2400C033
     C*
      *   U7 AND U8 OFF IF NO DATABASE ERROR DURING ZACCR PROCESSING      S01447
      *   BUT DBPGM NEEDS TO RESET                                        S01447
      *                                                                   S01447
     C           *INU7     IFEQ '0'                                       S01447
     C           *INU8     ANDEQ'0'                                       S01447
     C           *LOCK     IN   LDA                                       S01447
     C                     MOVE *BLANKS   DBPGM                           S01447
     C                     MOVEL'SE2400'  DBPGM                           S01447
     C                     OUT  LDA                                       S01447
     C                     END                                            S01447
     C                     END                                            S01486
     C/COPY WNCPYSRC,SE2400C008
     C*                                                                   S01509
     C** If S01509 is active, and value currency is different from        S01509
     C** nominal currency, convert coupon amount to value currency        S01509
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C           NMCY      ANDNEVLCY                                      S01509
     C                     MOVE NMCY      WCURR   3                       S01509
     C                     EXSR TG10                                      S01509
     C                     Z-ADDZCDP      ZCDPI                           S01509
     C                     MOVE VLCY      WCURR   3                       S01509
     C                     EXSR TG10                                      S01509
     C                     Z-ADDZCDP      ZCDPO                           S01509
     C                     MOVE NMCY      ZCCYI                           S01509
     C                     MOVE VLCY      ZCCYO                           S01509
     C                     Z-ADDZINTDU    ZAMTCI                          S01509
     C*                                                                   S01509
     C** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event   S01509
     C** found, else from SECTYD                                          S01509
     C*                                                                   S01509
     C                     MOVE SAAT      WSAAT   2                       S01509
     C                     MOVE 'XR'      SAAT                            S01509
     C           SEDKEY    SETLLSEDEVDO                                   S01509
     C                     READ SEDEVDO                  81               S01509
     C           *IN81     IFEQ '0'                                       S01509
     C           SDSN      ANDEQSASN                                      S01509
     C           SDET      ANDEQ'XR'                                      S01509
     C                     Z-ADDSDCE      ZEXCH                           S01509
     C                     MOVE SDMD      ZMD                             S01509
     C                     ELSE                                           S01509
     C                     Z-ADDSEXR      ZEXCH                           S01509
     C                     MOVE SMDI      ZMD                             S01509
     C                     END                                            S01509
     C                     MOVE WSAAT     SAAT                            S01509
     C                     EXSR ZCONV                                     S01509
     C                     Z-ADDZAMTCO    ZINTDU                          S01509
     C                     END                                            S01509
     C*                                                                   S01446
     C** For Courtage Enhancement, if Autocharge option is 'Y' and        S01446
     C** charge currency is not blank, update fields                      S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           BVACOP    ANDEQ'Y'                                       S01446
     C           BVCHRC    ANDNE*BLANKS                                   S01446
     C*                                                                   S01446
     C** Get M/D indicator and spot rate of input ccy from SDCURRPD       S01446
     C*                                                                   S01446
     C                     Z-ADD26        WDBAS1                          S01446
     C                     EXSR #LCURR                                    S01446
     C                     Z-ADDA6SPRT    ZRATE2                          S01446
     C                     MOVE A6MDIN    ZMDI2                           S01446
     C                     Z-ADDTXSPOT    ZRATE1                          S01446
     C                     MOVE TXMDI     ZMDI1                           S01446
     C                     EXSR ZXRATE                                    S01446
     C                     MOVE ZRATEX    TRATEX                          S01446
     C                     MOVE ZMDIX     TMDIX                           S01446
     C                     END                                            S01446
      *                                                                   S01447
     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
     C*
     C           AKRI      IFEQ 'Y'
     C                     MOVE 'C'       WACEVC
     C           SNAC      IFEQ 'N'
     C           WCUMCP    ORGT 0
     C                     MOVE ' '       WACNEG
     C                     ELSE
     C                     MOVE 'N'       WACNEG
     C                     END
     C                     MOVE 'DI'      WACAMC
     C                     Z-ADDZINTDU    EVAM
     C           ZINTDU    IFLT 0
     C           SNAC      ANDEQ'Y'
     C                     Z-SUBEVAM      EVAM
     C/COPY WNCPYSRC,SE2400C009
     C                     END
     C                     EXSR W01
     C/COPY WNCPYSRC,SE2400C010
     C                     END
     C*
     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
     C*
     C           PSRI      IFEQ 'Y'
     C                     MOVE 'CP'      PEVT
     C                     Z-ADDWCUMCP    PNMP
     C           ZINTDU    IFLT 0
     C                     Z-SUBZINTDU    PAMD
     C/COPY WNCPYSRC,SE2400C011
     C**********           MOVE 'P'       PPRE                            E14704
     C                     MOVE 'R'       PPRE                            E14704
     C                     ELSE
     C                     Z-ADDZINTDU    PAMD
     C/COPY WNCPYSRC,SE2400C012
     C**********           MOVE 'R'       PPRE                            E14704
     C                     MOVE 'P'       PPRE                            E14704
     C                     END
      *                                                                                       233709
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
      *                                                                                       233709
      ** If CGL031 is on and security is taxable and classification is D or S                 233709
      ** perform tax calculation, otherwise nothing must be calculated and                    233709
      ** nothing must be output on SDCSINPD                                                   233709
      *                                                                                       233709
     C           CGL031    IFEQ 'Y'                                                           233709
     C           SETX      ANDEQ'Y'                                                           233709
     C********** CSNV      ANDGT*ZERO                                                  233709 234406
      *                                                                                       233709
     C********** C1DI      IFEQ 'D'                                                    233709 234440
     C********** C1DI      OREQ 'S'                                                    233709 234440
     C                     EXSR CPNTAX                                                        233709
     C**********           ENDIF                                                       233709 234440
     C                     ENDIF                                                              233709
     C/COPY WNCPYSRC,SE2400C041
     C                     EXSR W02
     C                     END
     C/COPY WNCPYSRC,SE2400C013
     C*                                                                   E21715
     C***********                                                  E21715 E23807
     C***RESET*EX/COUPON*NOMINAL*FOR*NEXT*COUPON*PERIOD************E21715 E23807
     C***********                                                  E21715 E23807
     C***********LCPN      IFEQ SAED                               E21715 E23807
     C***********          Z-ADD0         CSEX                     E21715 E23807
     C***********          UPDATCPOSNDF                            E21715 E23807
     C***********          END                                     E21715 E23807
     C*                                                                   E37289
     C           AKRI      IFEQ 'Y'                                       E37289
     C           SCRECI    ANDEQ'M'                                       E37289
     C                     EXSR W03                                       E37289
     C                     END                                            E37289
      *****************************************************************                CGL031 233709
      ***If*CGL031*is*on*and*security*is*taxable*and*classification*is*D or S          CGL031 233709
      ***perform*tax*calculation,*otherwise*nothing*must*be*calculated*and             CGL031 233709
      ***nothing*must*be*output*on*SDCSINPD****************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** CGL031    IFEQ 'Y'                                                    CGL031 233709
     C********** SETX      ANDEQ'Y'                                                    CGL031 233709
     C********** SAED      ANDLTBJDNWD                                                 CGL031 233709
     C********** CSNV      ANDGT*ZERO                                                  CGL031 233709
     C********** C1DI      IFEQ 'D'                                                    CGL031 233709
     C********** C1DI      OREQ 'S'                                                    CGL031 233709
     C**********           EXSR CPNTAX                                                 CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C*
     C           ENDCPN    ENDSR                           ** ENDCPN**
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PARTPY - Subroutine to produce Part Payment Position         *
      *           Settlements.                                        *
      *                                                               *
      *****************************************************************
      *
     C           PARTPY    BEGSR                           ** PARTPY **
     C*
     C** CALCULATE PAYMENT DUE AS:
     C*       NOMINAL TRADE DATE BASIS TIMES CALL AMOUNT
     C*       HOLDING IS IN NOM.DEC PLACES, RESULT AS 13/0 WITH CCY DEC
     C*
     C*   GET SECURITY RECORD IN
     C*
     C* NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY  TO GET CCY DP
     C*
     C                     MOVE NMCY      WCURR   3
     C                     EXSR TG10
      *
      ****CLEAR*WORK*FIELDS***********************************************E23169
      ***********                                                         E23169
     C***********          Z-ADD0         WORK0  150                      E23169
     C***********          Z-ADD0         WORK1  151                      E23169
     C***********          Z-ADD0         WORK2  152                      E23169
     C***********          Z-ADD0         WORK3  153                      E23169
      ***********                                                         E23169
     C***********          MOVEA'0000'    *IN,60                          E23169
      ***********                                                         E23169
     C***********60        ADD  CDP       I       30                      E23169
      ***********                                                         E23169
     C***********          MOVEA'1'       *IN,I                           E23169
      ***********                                                         E23169
     C***********                                                         E23169
     C***CALCULATE*OFFSET*FOR*TABLE*POWER8********************************E23169
     C***********                                                         E23169
     C***********CDP       SUB  NMDP      DC                              E23169
     C***********DC        ADD  5         DC                              E23169
      ***********                                                         E23169
     C***********          EXSR INVTIN                                    E23169
      ***********                                                         E23169
      ****PROCESS*CALCS*DEPENDING*ON*CURRENCY*DPS.************************E23169
      ***********                                                         E23169
     C************IN60     IFEQ '1'                                       E23169
      ***********                                                         E23169
      ****ZERO*DECIMAL*PLACES**---------------------------------------****E23169
      ***********                                                         E23169
     C***********          MOVE SDCA      WORK0                           E23169
     C***********          MULT CSNV      WORK0                           E23169
      ***********                                                         E23169
     C***********PROT      IFEQ '8'                                       E23169
      ***********                                                         E23169
      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR*****E23169
      ***********                                                         E23169
     C***********          MULT SACF      WORK0                           E23169
     C***********          END                                            E23169
      ***********                                                         E23169
      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100*********************E23169
      ***********                                                         E23169
     C***********SPBS      IFEQ 'P'                                       E23169
     C***********          DIV  100       WORK0     H                     E23169
     C***********          END                                            E23169
      ***********                                                         E23169
     C***********WORK0*****MULT*POWER8,DC*WPAYDU*130H*********************E23169
      ***********                                                         E23169
     C***********          ELSE                                           E23169
     C************IN61     IFEQ '1'                                       E23169
      ***********                                                         E23169
      ****ONE*DECIMAL*PLACE****----------------------------------------***E23169
      ***********                                                         E23169
     C***********          MOVE SDCA      WORK1                           E23169
     C***********          MULT CSNV      WORK1                           E23169
      ***********                                                         E23169
     C***********PROT      IFEQ '8'                                       E23169
      ***********                                                         E23169
      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR*****E23169
      ***********                                                         E23169
     C***********          MULT SACF      WORK1                           E23169
     C***********          END                                            E23169
      ***********                                                         E23169
      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100*********************E23169
      ***********                                                         E23169
     C***********SPBS      IFEQ 'P'                                       E23169
     C***********          DIV  100       WORK1     H                     E23169
     C***********          END                                            E23169
      ***********                                                         E23169
     C***********WORK1     MULT POWER8,DC WPAYDU    H                     E23169
      ***********                                                         E23169
     C***********          ELSE                                           E23169
     C************IN62     IFEQ '1'                                       E23169
      ***********                                                         E23169
      ****TWO*DECIMAL*PLACES***----------------------------------------***E23169
      ***********                                                         E23169
     C***********          MOVE SDCA      WORK2                           E23169
     C***********          MULT CSNV      WORK2                           E23169
      ***********                                                         E23169
     C***********PROT      IFEQ '8'                                       E23169
      ***********                                                         E23169
      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR*****E23169
      ***********                                                         E23169
     C***********          MULT SACF      WORK2                           E23169
     C***********          END                                            E23169
      ***********                                                         E23169
      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100*********************E23169
      ***********                                                         E23169
     C***********SPBS      IFEQ 'P'                                       E23169
     C***********          DIV  100       WORK2     H                     E23169
     C***********          END                                            E23169
      ***********                                                         E23169
     C***********WORK2*****MULT*POWER8,DC*WPAYDU****H*********************E23169
      ***********                                                         E23169
     C***********          ELSE                                           E23169
     C************IN63     IFEQ '1'                                       E23169
      ***********                                                         E23169
      ****THREE*DECIMAL*PLACES*--------------------------------------*****E23169
      ***********                                                         E23169
     C***********          MOVE SDCA      WORK3                           E23169
     C***********          MULT CSNV      WORK3                           E23169
      ***********                                                         E23169
     C***********PROT      IFEQ '8'                                       E23169
      ***********                                                         E23169
      ***IF*PROCESSING*TYPE*ON*INVPTD*IS*8*MULTIPLY*BY*CURRENT*FACTOR*****E23169
      ***********                                                         E23169
     C***********          MULT SACF      WORK3                           E23169
     C***********          END                                            E23169
      ***********                                                         E23169
      ***IF*PRICE*BASIS*(SECTYD)*IS*'P',DIVIDE*BY*100*********************E23169
      ***********                                                         E23169
     C***********SPBS      IFEQ 'P'                                       E23169
     C***********          DIV  100       WORK3     H                     E23169
     C***********          END                                            E23169
      ***********                                                         E23169
     C***********WORK3     MULT POWER8,DC WPAYDU    H                     E23169
      ***********                                                         E23169
     C***********          END                                            E23169
     C***********          END                                            E23169
     C***********          END                                            E23169
     C***********          END                                            E23169
     C*
     C*                                                                   E23169
     C           PROT      IFNE '4'                                       E23169
     C           SDCA      DIV  100000    ZPRC                            E23169
     C                     ELSE                                           E23169
     C           5         ADD  CDP       DC                              E23169
     C           SDCA      DIV  POWER8,DC ZPRC                            E23169
     C                     END                                            E23169
     C           SPBS      IFEQ 'P'                                       E23169
     C                     MULT 100       ZPRC                            E23169
     C                     END                                            E23169
     C******************** Z-ADDCSNV      ZNOML                    E23169 S01486
     C           WPORTP    IFEQ 'Y'                                       S01486
     C           BGPFMG    ANDEQ'Y'                                       S01486
     C           WPORTP    OREQ 'Y'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C***********          Z-ADDQANOML    ZNOML                    S01486 189942
     C                     Z-ADDCDNV      ZNOML                           189942
     C                     ELSE                                           S01486
     C                     Z-ADDCSNV      ZNOML                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     EXSR ZCNSD                                     E23169
     C                     Z-ADDZCONS     WPAYDU 130                      E23169
     C*                                                                   E23169
     C** IF PROCESSING TYPE ON INVPTD IS 8 MULTIPLY BY CURRENT FACTOR     E23169
     C*                                                                   E23169
     C           PROT      IFEQ '8'                                       E23169
     C                     MULT SACF      WPAYDU    H                     E23169
     C                     END                                            E23169
      *                                                                                       CSE110
      ** If account key required write A/C key in W01.                                        CSE110
      *                                                                                       CSE110
     C           CSE110    IFEQ 'Y'                                                           CSE110
      *                                                                                       CSE110
     C           AKRI      IFEQ 'Y'                                                           CSE110
     C                     MOVE 'P'       WACEVC                                              CSE110
     C           NPAC      IFEQ 'N'                                                           CSE110
     C           CSNV      ORGT 0                                                             CSE110
     C                     MOVE ' '       WACNEG                                              CSE110
     C                     ELSE                                                               CSE110
     C                     MOVE 'N'       WACNEG                                              CSE110
     C                     ENDIF                                                              CSE110
     C                     MOVE 'PP'      WACAMC                                              CSE110
     C                     Z-ADDWPAYDU    EVAM                                                CSE110
     C           WACNEG    IFEQ 'N'                                                           CSE110
     C                     Z-SUBEVAM      EVAM                                                CSE110
     C                     ENDIF                                                              CSE110
     C                     EXSR W01                                                           CSE110
     C                     ENDIF                                                              CSE110
      *                                                                                       CSE110
     C                     ENDIF                                                              CSE110
     C*
     C* WRITE POSITION SETTLEMENT
     C*
     C           PSRI      IFEQ 'Y'                                                           CSE110
     C           WSRECI    ANDNE'R'                                                           CSE110
     C           CSE110    ANDEQ'Y'                                                           CSE110
     C           CSE110    OREQ 'N'                                                           CSE110
      *                                                                                       CSE110
     C                     MOVE 'PP'      PEVT
     C******************** Z-ADDCSNV      PNMP                            S01486
     C*                                                                   S01486
     C           WPORTP    IFEQ 'Y'                                       S01486
     C           BGPFMG    ANDEQ'Y'                                       S01486
     C           WPORTP    OREQ 'Y'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C***********          Z-ADDQANOML    PNMP                     S01486 189942
     C                     Z-ADDCDNV      PNMP                            189942
     C                     ELSE                                           S01486
     C                     Z-ADDCSNV      PNMP                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     Z-ADDWPAYDU    PAMD
      *                                                                                       CSE110
     C           CSE110    IFEQ 'Y'                                                           CSE110
      *                                                                                       CSE110
     C           PAMD      IFLE 0                                                             CSE110
     C                     MOVE 'R'       PPRE                                                CSE110
     C                     ELSE                                                               CSE110
     C                     MOVE 'P'       PPRE                                                CSE110
     C                     END                                                                CSE110
      *                                                                                       CSE110
     C                     ENDIF                                                              CSE110
      *                                                                                       CSE110
     C           PAMD      IFLT 0
     C                     Z-SUBPAMD      PAMD
     C                     END
     C*
     C           CSE110    IFEQ 'N'                                                           CSE110
      *                                                                                       CSE110
     C           CSNV      IFLE 0
     C**********           MOVE 'R'       PPRE                            E14704
     C                     MOVE 'P'       PPRE                            E14704
     C                     ELSE
     C**********           MOVE 'P'       PPRE                            E14704
     C                     MOVE 'R'       PPRE                            E14704
     C                     END
      *                                                                                       CSE110
     C                     ENDIF                                                              CSE110
     C                     EXSR W02
      *                                                                                       CSE110
     C                     ENDIF                                                              CSE110
      *
     C           ENDPPY    ENDSR                           ** ENDPPY **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  MORTPY - Subroutine to produce Mortgage Payment Account Keys *
      *           and/or Position Settlements.                        *
      *                                                               *
      *****************************************************************
      *
     C           MORTPY    BEGSR                           ** MORTPY **
     C*                                                                   E36391
     C** Get the current factor prior to the action date from the         E36391
     C** security diary. If no details are present, use the current       E36391
     C** factor from the security.                                        E36391
     C*                                                                   E36391
     C           SEDKEY    SETGTSEDEVDO                                   E36391
     C                     READ SEDEVDO                  81               E36391
     C           *IN81     IFEQ '0'                                       E36391
     C           SDSN      ANDEQSASN                                      E36391
     C           SDET      ANDEQ'MP'                                      E36391
     C                     Z-ADDSDCP      PCFA                            E36391
     C                     ELSE                                           E36391
     C                     Z-ADDCFCT      PCFA                            E36391
     C                     END                                            E36391
     C*
     C** CALCULATE PRINCIPAL REPAYMENT AS:
     C*   IF REPAYMENT METHOD IND IS Y, REPAYMENT AMOUNT ON SECAD
     C*
     C           RTMI      IFEQ 'Y'
     C***********          Z-ADDRTAI      WPREPA 130                      E23169
     C                     Z-ADDRTAI      PAMD                            E23169
     C                     ELSE
     C*
     C*         ELSE
     C* NOMINAL VALUE DATE BASIS TIMES
     C* (PREVIOUS CURRENT FACTOR MINUS CURRENT FACTOR)
     C* NB ALTHOUGH NOM DEC = NOM DEC CCY FOR MORTGAGE BACKED SEC'TS
     C* FIELD RTAI IS IN CCY DEC PLACES AND THIS CALC OF WPREPA IS TOO
     C*
     C********** PCFA      SUB  SACF      WACF    98                      052254
     C           PCFA      SUB  SACF      WACF                            052254
     C*
      ***  As the first digit of the difference will always be zero       E20086
      ***  the following processing is unnecessary.                       E20086
      *                                                                   E20086
     C***SPLIT*FIELD*WACF*9/8*TO*1/0*AND*8/8*WRK*FLDS*TO*PREVENT*LOSS**   E20086
     C***OF*HIGH*ORDER*DIGITS******************************************   E20086
     C***********                                                         E20086
     C***********          Z-ADDWACF      WRK10   10                      E20086
     C***********          Z-ADDWACF      WRK88   88                      E20086
     C***********                                                         E20086
     C***MULTIPLY*NOMINAL*VALUE*DATE*BASIS*BY*EACH*WORK*FIELD*AND*SUM**   E20086
     C***********                                                         E20086
     C***********CSNV      MULT WRK88     WRK158 158                      E20086
     C***********WRK150    ADD  WRK154    WRK154                          E20086
     C***********CSNV      MULT WACF      WRK152 152H              E20086 E23169
     C*
     C*NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY TO GET CCY DP
     C*
     C                     MOVE NMCY      WCURR   3
     C                     EXSR TG10
     C           BGPFMG    IFNE 'Y'                                       080741
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           WPORTP    ORNE 'Y'                                                           236137
     C                     Z-ADDCSNV      ZNOML                           E23169
     C                     ELSE                                           080741
     C***********          Z-ADDQANOML    ZNOML                    080741 189942
     C                     Z-ADDCDNV      ZNOML                           189942
     C                     END                                            080741
     C                     Z-ADDWACF      ZPRC                            E23169
     C           SPBS      IFEQ 'P'                                       E23169
     C                     MULT 100       ZPRC                            E23169
     C                     END                                            E23169
     C                     EXSR ZCNSD                                     E23169
     C                     Z-ADDZCONS     PAMD                            E23169
     C*
     C***********CDP       SUB  NMDP      DC      10                      E23169
     C***********DC        ADD  5         DC                              E23169
     C***********WRK154    MULT POWER8,DC WRK154                          E20086
     C***********WRK154    DIV  1         WPREPA 130H                     E20086
     C***********WRK152    MULT POWER8,DC PAMD      H              E20086 E23169
     C                     END
     C*
      ***  Interest is calculated in a separate Coupon Event - do not     E20086
      ***  include in the Mortgage Payment.                               E20086
      *                                                                   E20086
     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRD*FOR*SECURITY**************   E20086
     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E20086
     C***********                                                         E20086
     C***WHEN*PARM*ZAB*IS*'A'*,*INTEREST*IS*CALCULATED*AFTER*CHANGES***   E20086
     C***********                                                         E20086
     C***********          UNLCKLDA                                       E20086
     C***********          CALL 'ZACCRC'                                  E20086
     C***********          PARM           LCPN                            E20086
     C***********          PARM           SAED                            E20086
     C***********          PARM           CSBR                            E20086
     C***********          PARM           CDPT                            E20086
     C***********          PARM           CSSC                            E20086
     C***********          PARM           CDP                             E20086
     C***********          PARM           ZINTDU 150                      E20086
     C***********          PARM           ZAB     1                       E20086
     C***********          PARM           WU8     1
     C***********                                                         E20086
     C****MULTIPLY*RESULT*OF*ZACCRD*BY*PREVIOUS*CURR*FACTOR************   E20086
     C***********                                                         E20086
     C***********ZINTDU    MULT PCFA      WRK154                          E20086
     C***********WRK154    DIV  1         WINTPY 130H                     E20086
     C*
     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
     C*
     C           PSRI      IFEQ 'Y'
     C*
     C                     MOVE 'MP'      PEVT
     C           BGPFMG    IFNE 'Y'                                       080741
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           WPORTP    ORNE 'Y'                                                           236137
     C                     Z-ADDCSNV      PNMP
     C                     ELSE                                           080741
     C***********          Z-ADDQANOML    PNMP                     080741 189942
     C                     Z-ADDCDNV      PNMP                            189942
     C                     END                                            080741
     C*
     C***AMOUNT*DUE*IS*PRINCIPAL*REPAYMNT*+*INTEREST*******************   E20086
     C***********                                                         E20086
     C***********WPREPA    ADD  WINTPY    WRK130 130                      E20086
     C***********          Z-ADDWRK130    PAMD                            E20086
     C***********                                                         E20086
     C***********PAMD      IFLT 0                                         E20086
     C***********          Z-SUBPAMD      PAMD                            E20086
     C***********          END                                            E20086
     C***********                                                         E20086
     C***********WRK130    IFLE 0                                         E20086
     C           PAMD      IFLE 0                                         E20086
     C**********           MOVE 'P'       PPRE                            E14704
     C                     MOVE 'R'       PPRE                            E14704
     C                     ELSE
     C**********           MOVE 'R'       PPRE                            E14704
     C                     MOVE 'P'       PPRE                            E14704
     C                     END
      *                                                                   E20086
     C           PAMD      IFLT 0                                         E20086
     C                     Z-SUBPAMD      PAMD                            E20086
     C                     END                                            E20086
      *                                                                                       233709
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
     C*                                                                   E20086
      ** If CGL031 is on and security is taxable and classification is D or S                 233709
      ** perform the tax calculation                                                          233709
      *                                                                                       233709
     C           CGL031    IFEQ 'Y'                                                           233709
     C           SETX      ANDEQ'Y'                                                           233709
     C********** CSNV      ANDGT*ZERO                                                  233709 234406
      *                                                                                       233709
     C********** C1DI      IFEQ 'D'                                                    233709 234440
     C********** C1DI      OREQ 'S'                                                    233709 234440
     C                     EXSR MORTAX                                                        233709
     C**********           ENDIF                                                       233709 234440
     C                     ENDIF                                                              233709
      *                                                                                       233709
     C                     EXSR W02
     C*
     C                     END
     C*
     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
     C*
     C           AKRI      IFEQ 'Y'
     C                     MOVE 'R'       WACEVC
     C***********          Z-ADDWPREPA    WRK130 130               E21138 E23169
     C***********WRK130    IFGT 0                                         E23169
     C           PAMD      IFGT 0                                         E23169
     C           NPAC      OREQ 'N'
     C                     MOVE ' '       WACNEG
     C                     ELSE
     C                     MOVE 'N'       WACNEG
     C                     END
     C                     MOVE 'FV'      WACAMC
     C***********          Z-ADDWRK130    EVAM                            E23169
     C                     Z-ADDPAMD      EVAM                            E23169
     C***********          MOVE WNMCY     WCURR   3                E13817 E20086
     C***********                                                         E23169
     C***********          MOVE SNMCY     WCURR   3                E20086 E23169
     C***********          EXSR TG10                               E13817 E23169
     C***********5         SUB  NMDP      DC      10               E13817 E23169
     C***********          ADD  CDP       DC                       E13817 E23169
     C***********WRK130    MULT POWER8,DC EVAM                     E13817 E23169
     C***********WRK130    IFLT 0                                         E23169
     C           PAMD      IFLT 0                                         E23169
     C           NPAC      ANDEQ'Y'
     C                     Z-SUBEVAM      EVAM
     C                     END
     C*
     C                     EXSR W01
     C/COPY WNCPYSRC,SE2400C014
     C*
     C                     END
     C*
      ***If*CGL031*is*on*and*security*is*taxable*and*classification*is*D or S          CGL031 233709
      ***perform*the*tax*calculation***********************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** CGL031    IFEQ 'Y'                                                    CGL031 233709
     C********** SETX      ANDEQ'Y'                                                    CGL031 233709
     C********** SAED      ANDLTBJDNWD                                                 CGL031 233709
     C********** CSNV      ANDGT*ZERO                                                  CGL031 233709
     C********** C1DI      IFEQ 'D'                                                    CGL031 233709
     C********** C1DI      OREQ 'S'                                                    CGL031 233709
     C**********           EXSR MORTAX                                                 CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C           ENDMPY    ENDSR                           ** ENDMPY **
      *
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  MORTAX - Subroutine to calculate tax for descretionary and   *                       CGL031
      *           safe custody customers.                             *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           MORTAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialize                                                                           CGL031
      *                                                                                       CGL031
     C                     Z-ADD1         WACF                                                CGL031
      *                                                                                       CGL031
      ** Check if record needs to be taxed.                                                   CGL031
      *                                                                                       CGL031
     C                     EXSR CHKTAX                                                        CGL031
      *                                                                                       CGL031
      ***Get*the*current*factor*prior*to*the*action*date*from*the******                CGL031 234440
      ***security*diary.*If*no*details*are*present,*use*the*current****                CGL031 234440
      ***factor*from*the*security.*************************************                CGL031 234440
      *                                                                                       CGL031
     C********** SEDKEY    SETGTSEDEVDO                                                CGL031 234440
     C**********           READ SEDEVDO                  81                            CGL031 234440
     C********** *IN81     IFEQ '0'                                                    CGL031 234440
     C********** SDSN      ANDEQSASN                                                   CGL031 234440
     C********** SDET      ANDEQ'MP'                                                   CGL031 234440
     C**********           Z-ADDSDCP      PCFA                                         CGL031 234440
     C**********           ELSE                                                        CGL031 234440
     C**********           Z-ADDCFCT      PCFA                                         CGL031 234440
     C**********           ENDIF                                                       CGL031 234440
      *                                                                                       CGL031
      ***Calculate*Principal*Repayment*as:*****************************                CGL031 234440
      ***If*Repayment*Method*Ind*is*Y,*Repayment*Amount*on*SECAD*******                CGL031 234440
      *                                                                                       CGL031
     C********** RTMI      IFEQ 'Y'                                                    CGL031 234440
     C**********           Z-ADDRTAI      PAMD                                         CGL031 234440
     C**********           ELSE                                                        CGL031 234440
      *                                                                                       CGL031
      ***Else**********************************************************                CGL031 234440
      ***Nominal*Value*Date*Basis*Times********************************                CGL031 234440
      ***(Previous*Current*Factor*Minus*Current*Factor)****************                CGL031 234440
      ***NB*although*NOM*DEC*=*NOM*DEC*CCY*for*Mortgage*backed*Sec'ts**                CGL031 234440
      ***field*RTAI*is*in*CCY*DEC*Places*and*this*CALC*of*WPREPA*is*too                CGL031 234440
      *                                                                                       CGL031
     C********** PCFA      SUB  SACF      WACF                                         CGL031 234440
      *                                                                                       CGL031
      ***Nominal*Decimal*Places*retrieved*-*Now*use*CCY*to*get*CCY*DP**                CGL031 234440
      *                                                                                       CGL031
     C**********           MOVE NMCY      WCURR                                        CGL031 234440
     C**********           EXSR TG10                                                   CGL031 234440
     C********** BGPFMG    IFNE 'Y'                                                    CGL031 233709
     C********** BGN4ST    ANDNE'Y'                                                    CGL031 233709
     C**********           Z-ADDCSNV      ZNOML                                        CGL031 234440
     C**********           ELSE                                                        CGL031 233709
     C**********           Z-ADDCDNV      ZNOML                                        CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           Z-ADDWACF      ZPRC                                         CGL031 234440
     C********** SPBS      IFEQ 'P'                                                    CGL031 234440
     C**********           MULT 100       ZPRC                                         CGL031 234440
     C**********           ENDIF                                                       CGL031 234440
     C**********           EXSR ZCNSD                                                  CGL031 234440
     C**********           Z-ADDZCONS     PAMD                                         CGL031 234440
      *                                                                                       CGL031
     C**********           ENDIF                                                       CGL031 234440
      *                                                                                       CGL031
     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233567
     C**********           Z-ADDAFPV      WCSAV                                        CGL031 233567
     C**********           ELSE                                                        CGL031 233567
     C**********           Z-ADDCSAV      WCSAV                                        CGL031 233567
     C**********           ENDIF                                                       CGL031 233567
      *                                                                                       CGL031
      ** If no record found, no tax is calculated                                             CGL031
      ** Or if Issue Price is 100, (i.e. not dicsount or premium),                            234440
      ** no tax is calculated.                                                                234440
     C                     MOVE 'Y'       WTXBLE  1        Amount is taxable                  236137
     C           WNOTAX    IFEQ 'Y'                        Begin Taxable                      236137
     C           ISSP      OREQ 100                                                           236137
     C                     MOVE 'N'       WTXBLE                                              236137
      *                                                                                       236137
     C                     ELSE                                                               236137
      *                                                                                       236137
      ** If record was found and De Minimis Rule is applicable, determine if                  236137
      ** amortized discount is taxable.                                                       236137
     C           EWDMAP    IFEQ 'Y'                        Begin EWDMAP                       236137
     C           ISSP      ANDLT100                                                           236137
      *                                                                                       236137
     C           100       SUB  ISSP      WWAMT  158       Amortized Discount                 236137
      *                                                                                       236137
     C           WWAMT     IFLE EWTTDP                                                        236137
     C           MATY      SUB  ISSD      WWDAYS  83                                          236137
     C                     DIV  365       WWDAYS    H                                         236137
      *                                                                                       236137
     C           WWDAYS    IFGT *ZEROS                                                        236137
     C                     DIV  WWDAYS    WWAMT                                               236137
      *                                                                                       236137
     C           WWAMT     IFLE EWYRDP                                                        236137
     C                     MOVE 'N'       WTXBLE           Amount is not taxable              236137
      *                                                                                       236137
     C                     ENDIF                                                              236137
      *                                                                                       236137
     C                     ENDIF                                                              236137
      *                                                                                       236137
     C                     ENDIF                                                              236137
      *                                                                                       236137
     C                     ENDIF                           End EWDMAP                         236137
      *                                                                                       236137
     C                     ENDIF                           End Taxable                        236137
      *                                                                                       CGL031
      ** Calculate Tax Amount for the Coupon and Output Information on SDCSINPD               CGL031
      *                                                                                       CGL031
     C***********WNOTAX****IFEQ*' '************************************                CGL031 236137
     C***********ISSP******ANDNE100************************************                234440 236137
     C           WTXBLE    IFEQ 'Y'                                                           236137
      *                                                                                       CGL031
      ***If*PAMD*minus*(WCSAV*multiply*by*WACF)*is*negative*or*zero*nothing must be    CGL031 234440
      ***calculated*or*output*in*SDCSINPD.*****************************                CGL031 234440
      *                                                                                       CGL031
     C********** WCSAV     MULT WACF      WVALU  269                                   CGL031 234440
     C********** PAMD      SUB  WVALU     WNEGA  269                                   CGL031 234440
      *                                                                                       234440
      ** Get Fiscal Price at Event Date                                                       234440
      *                                                                                       CGL031
      ** Get redemption price                                                                 234440
     C                     Z-ADD0         SDRP                                                234440
     C                     Z-ADDMATY      SDED                                                234440
     C                     MOVE 'RC'      SDET                                                234440
      *                                                                                       234440
      ** Check file for either 'RC' type or 'RP' type in key field                            234440
      *                                                                                       234440
     C                     EXSR SECEDI                                                        234440
     C           *IN78     IFEQ '1'                                                           234440
     C                     MOVE 'RP'      SDET                                                234440
     C                     EXSR SECEDI                                                        234440
     C                     END                                                                234440
     C           *IN78     IFEQ '1'                                                           234440
      *                                                                                       234440
      ** If neither RC nor RP use 100 if price basis is P, else 1 (U)                         234440
      ** Or if RP/RC record found AND price is zero and S01509 is                             234440
      ** active, use 100 if price basis is P, else 1                                          234440
      *                                                                                       234440
     C           *IN78     OREQ '0'                                                           234440
     C           SDRP      ANDEQ0                                                             234440
     C           S01509    ANDEQ'Y'                                                           234440
      *                                                                                       234440
     C           SPBS      IFEQ 'P'                                                           234440
     C                     Z-ADD100       SDRP                                                234440
     C                     END                                                                234440
     C           PROT      IFEQ '1'                                                           234440
     C           SPBS      ANDEQ'U'                                                           234440
     C                     Z-ADD1         SDRP                                                234440
     C                     ENDIF                                                              234440
     C                     END                                                                234440
      *                                                                                       234440
      ** If Country of Tax is not Switzerland, use straight line basis                        234440
      *                                                                                       234440
     C           EWCTRT    IFNE 'CH'                                                          234440
     C                     CALL 'ZAINTPL2'                                                    234440
     C                     PARM           ISSD    50                                          234440
     C                     PARM           SAED    50                                          234440
     C                     PARM           MATY    50                                          234440
     C                     PARM           ISSP   158                                          234440
     C                     PARM           SDRP                                                234440
     C                     PARM           WFSPR  158                                          234440
      *                                                                                       234440
      ***If*Country*of*Tax*is*Switzerland,*use*analytical*interpolation                234440 236137
      ** Else, use Actuarial Interpolation.                                                   236137
      *                                                                                       234440
     C                     ELSE                                                               234440
     C                     CALL 'ZAACTUAR'                                                    234440
     C                     PARM           WRTCD  10                                           234440
     C                     PARM           ISSD                                                234440
     C                     PARM           ISSP                                                234440
     C                     PARM           MATY                                                234440
     C                     PARM           SDRP                                                234440
     C                     PARM           DYBS                                                234440
     C                     PARM           DVBS                                                234440
     C                     PARM           CDDS                                                234440
     C                     PARM           CRDS                                                234440
     C                     PARM           LCPN                                              BUG11164
     C                     PARM           SAED                                                234440
     C                     PARM           WFSPR                                               234440
     C                     ENDIF                                                              234440
      *                                                                                       234440
      ** Get Average Fiscal Price of Position                                                 234440
      *                                                                                       234440
     C********** SAED      SUB  1         WDATE   50                                   234440 234552
     C                     Z-ADDSAED      WDATE   50                                          234552
      *                                                                                       234440
     C           WPORTP    IFEQ 'Y'                                                           234440
     C           BGPFMG    ANDEQ'Y'                                                           234440
     C           WPORTP    OREQ 'Y'                                                           234440
     C           BGN4ST    ANDEQ'Y'                                                           234440
     C**********           Z-ADDCDNV      ZNOML                                        234440 234440
      *                                                                                       234440
      ** Access Customer Position                                                             234440
      *                                                                                       234440
     C**********           Z-ADDCDCN      CDCNZN                                       236816 CSD027
     C                     MOVELCDCN      CDCNZN                                              CSD027
     C                     CALL WPGM                                                          234440
     C                     PARM           WRTCD  10                                           234440
     C                     PARM           CDPA                                                234440
     C**********           PARM           CDCN                                         234440 236816
     C                     PARM           CDCNZN                                              236816
     C                     PARM           CDSN                                                234440
     C                     PARM           PTFR                                                234440
     C                     PARM           CDMK                                                234440
     C                     PARM           WDATE                                               234440
     C                     PARM           ETCPOS                                              234440
     C                     ELSE                                                               234440
     C**********           Z-ADDCSNV      ZNOML                                        234440 234440
     C                     CALL WPGM                                                          234440
     C                     PARM           WRTCD  10                                           234440
     C                     PARM           CSBA                                                234440
     C                     PARM           CSCN                                                236815
     C                     PARM           CSSC                                                234440
     C**********           PARM           CSCN                                         234440 236815
     C                     PARM *BLANKS   WPTFR   4                                           234440
     C                     PARM 'S'       WMKT    1                                           234440
     C                     PARM           WDATE                                               234440
     C                     PARM           ETCPOS                                              234440
     C                     END                                                                234440
      *                                                                                       234440
     C                     Z-ADDAVFP      WAVFP  158                                          234440
      *                                                                                       234440
     C********** WCSAV     DIV  ZNOML     WAVFP  158H                                         234440
      *                                                                                       234440
      **If*price*basis*'P',*multiply*by*100*to*fetch*true*price********                234440 234440
      *                                                                                       234440
     C********** SPBS      IFEQ 'P'                                                    234440 234440
     C**********           MULT 100       WAVFP                                        234440 234440
     C**********           END                                                         234440 234440
      *                                                                                       234440
      **reformat*average*fiscal*price*for*currency*decimal*places,*as*it               234440 234440
      ***was*calculated*from*AP*Numerator*to*a*straight*15/8*price*****                234440 234440
      *                                                                                       234440
     C********** 5         ADD  CDP       DC      10                                   234440 234440
     C**********           SUB  NMDP      DC                                           234440 234440
     C********** WAVFP     DIV  POWER8,DC WAVFP                                        234440 234440
      *                                                                                       234440
      ** Taxable amount is the difference between Fiscal Price and average                    234440
      ** Fiscal price x Payment Amount (amount due PAMD)                                      234440
      *                                                                                       234440
     C           WFSPR     SUB  WAVFP     WFISC  158                                          234440
      *                                                                                       234440
     C           SPBS      IFEQ 'P'                                                           234440
     C                     DIV  100       WFISC     H                                         234440
     C                     END                                                                234440
     C           PAMD      MULT WFISC     WFSCA  150                                          234440
      *                                                                                       234440
      ** Now do comparison with profit on mortgage repayment, if country                      234440
      ** of tax is not Switzerland, and take the lower figure as the                          234440
      ** the taxable amount                                                                   234440
      *                                                                                       234440
      ** bit about CH is added and removed by this change control                             234440
      ** it is left in the code in case the situation changes again.                          234440
     C********** EWCTRT    IFNE 'CH'                                                          234440
      *                                                                                       234440
     C********** CSPV      DIV  ZNOML     WAVPR  158H                                         234440
      *                                                                                       234440
      **If*price*basis*'P',*multiply*by*100*to*fetch*true*price********                       234440
      *                                                                                       234440
     C********** SPBS      IFEQ 'P'                                                           234440
     C**********           MULT 100       WAVPR                                               234440
     C**********           END                                                                234440
      *                                                                                       234440
      **reformat*average*fiscal*price*for*currency*decimal*places,*as*it                      234440
      ***was*calculated*from*AP*Numerator*to*a*straight*15/8*price****q                       234440
      *                                                                                       234440
     C********** 5         ADD  CDP       DC      10                                          234440
     C**********           SUB  NMDP      DC                                                  234440
     C********** WAVPR     DIV  POWER8,DC WAVPR                                               234440
      *                                                                                       234440
      ** If average price is greater than 100 then there is no profit and so                  234440
      ** not tax (mortage repayments deemed to be at price 100)                               234440
     C           WAVPR     IFGT 100                                                           234440
     C                     Z-ADD0         WNEGA  150                                          234440
     C                     ELSE                                                               234440
     C           100       SUB  LAVP      WAVPR  158                                          234440
      *                                                                                       234440
     C           SPBS      IFEQ 'P'                                                           234440
     C                     DIV  100       WAVPR     H                                         234440
     C                     END                                                                234440
      *                                                                                       234440
     C           PAMD      MULT WAVPR     WPRFA  150                                          234440
     C           WPRFA     IFLT WFSCA                                                         234440
     C                     Z-ADDWPRFA     WNEGA                                               234440
     C                     ELSE                                                               234440
     C                     Z-ADDWFSCA     WNEGA                                               234440
     C                     ENDIF                                                              234440
     C                     ENDIF                                                              234440
      *                                                                                       234440
      ** If Switzerland then just take "fiscal" amount                                        234440
      *                                                                                       234440
     C**********           ELSE                                                               234440
     C**********           Z-ADDWFSCA     WNEGA                                               234440
     C**********           ENDIF                                                              234440
      *                                                                                       234440
     C           WNEGA     IFGT 0                                                             CGL031
      *                                                                                       CGL031
     C                     EXSR MPTXCL                                                        CGL031
      *                                                                                       CGL031
      ***Output*Tax*Account*Keys***************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           EXSR W04                                                    CGL031 233709
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  MPTXCL - Subroutine to calculate tax amount for the Mortgage *                       CGL031
      *           Repayment and to Output Information on SDCSINPD     *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           MPTXCL    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialise work variables                                                            CGL031
      *                                                                                       CGL031
     C***********          Z-ADD0         WTTXSR                                       CGL031 233709
     C***********          Z-ADD0         WTTXSS                                       CGL031 233709
     C***********          Z-ADD0         WTTXSC                                       CGL031 233709
     C***********          Z-ADD0         WTTXSB                                       CGL031 233709
     C***********          Z-ADD0         WTNINT                                       CGL031 233709
     C***********          Z-ADD0         WTNINS                                       CGL031 233709
     C***********          Z-ADD0         WTNINC                                       CGL031 233709
     C***********          Z-ADD0         WTNINB                                       CGL031 233709
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
     C                     MOVE ' '       WTXPI                                               CGL031
     C                     MOVE ' '       WTXJA                                               CGL031
      *                                                                                       CGL031
     C                     MOVE YCSCN     @@CUST                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLPI'                                                    CGL031
      ** Input                                                                                CGL031
     C                     PARM 'S'       @@MODI                                              CGL031
     C                     PARM SASN      @@TRRF                                              CGL031
     C                     PARM YCSBA     @@BRCA                                              CGL031
     C                     PARM           @@CUST                                              CGL031
     C                     PARM *ZERO     @@STRD                                              CGL031
     C                     PARM *ZERO     @@ENDD                                              CGL031
     C                     PARM WNEGA     @@TOTI                                              CGL031
     C                     PARM WTRAB     @@TAXR                                              CGL031
     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
     C                     PARM NMCY      @@OCCY                                              233568
     C                     PARM *BLANKS   PINTH                                               CER048
      ** Output                                                                               CGL031
     C                     PARM           @@IAED                                              CGL031
     C                     PARM           @@TAXA                                              CGL031
     C                     PARM           @@TOTO                                              CGL031
     C                     PARM           @@TXCY                                              CGL031
     C                     PARM           @@CTAX                                              CGL031
     C                     PARM           @@TXBS                                              CGL031
     C                     PARM           @@WTAC                                              CGL031
     C                     PARM           @@COLC                                              CGL031
     C                     PARM           @@STAT                                              CGL031
     C                     PARM           @@TRTE                                              CGL031
     C                     PARM           @@TXR1                                              CGL031
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY                                               CGL031
     C                     PARM           @@FILE                                              CGL031
     C                     PARM           @@RTRN                                              CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
      ** If return code = Error.                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHEQ 'ERROR'                                                       CGL031
     C                     MOVE @@FILE    DBFILE                                              CGL031
     C                     MOVE @@KEY     DBKEY                                               CGL031
     C                     Z-ADD67        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
      *                                                                                       CGL031
      ** If return code = Private Individual                                                  CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHNE 'JOINT'                                                       CGL031
      *                                                                                       CGL031
     C           @@TOTO    IFNE *ZERO                                                         CGL031
     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
     C           @@STAT    OREQ 'DISCL'                                                       CGL031
     C           @@STAT    OREQ 'SELF'                                                        CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WTXPI                                               CGL031
     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
     C                     MOVE S1CTTA    KCSIS                                               236815
     C                     MOVE @@CTAX    KCTRT                                               CGL031
      *                                                                                       CGL031
     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
     C           *IN61     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
     C           TCTXCM    WHEQ 1                                                             CGL031
     C           SWHTFD    OREQ 'N'                                                           236815
     C********** S1RASO    OREQ 0                                                      236815 234813
     C           UTXRSR    OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
     C           TCTXCM    WHEQ 2                                                             CGL031
     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236815
     C                     MULT @@TAXR    @@TAXA                                              236815
     C                     DIV  100       @@TAXA    H                                         236815
     C           @@TAXA    IFLT 0                                                             236815
     C                     Z-ADD0         @@TAXA                                              236815
     C                     ENDIF                                                              236815
     C           TCTXCM    WHEQ 3                                                             CGL031
     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C                     SUB  WTAXA     @@TAXA                                              236815
     C           @@TAXA    IFLT 0                                                             236815
     C                     Z-ADD0         @@TAXA                                              236815
     C                     ENDIF                                                              236815
     C           TCTXCM    WHEQ 4                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Write record to SDCSINPD                                                             CGL031
      *                                                                                       CGL031
     C                     EXSR CSINSR                                                        CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If return code = Joint Account                                                       CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHEQ 'JOINT'                                                       CGL031
     C                     MOVE YCSCN     KJANO                                               CGL031
      *                                                                                       CGL031
     C           KJANO     SETLLSDJACCLB                                                      CGL031
     C           KJANO     READESDJACCLB                 60                                   CGL031
      *                                                                                       CGL031
     C           *IN60     DOWEQ*OFF                                                          CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLJA'                                                    CGL031
      ** Input                                                                                CGL031
     C                     PARM 'S'       @@MODI                                              CGL031
     C                     PARM SASN      @@TRRF                                              CGL031
     C                     PARM YCSBA     @@BRCA                                              CGL031
     C                     PARM JCJANO    @@JANO                                              CGL031
     C                     PARM JCCUST    @@CUST                                              CGL031
     C                     PARM JCNAHO    @@NARF                                              CGL031
     C                     PARM JCINVP    @@INVP                                              CGL031
     C                     PARM *ZERO     @@STRD                                              CGL031
     C                     PARM *ZERO     @@ENDD                                              CGL031
     C                     PARM WNEGA     @@TOTI                                              CGL031
     C                     PARM WTRAB     @@TAXR                                              CGL031
     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
     C                     PARM NMCY      @@OCCY                                              233568
     C                     PARM *BLANKS   PINTH                                               CER048
      ** Output                                                                               CGL031
     C                     PARM           @@IAED                                              CGL031
     C                     PARM           @@TAXA                                              CGL031
     C                     PARM           @@TOTO                                              CGL031
     C                     PARM           @@TXCY                                              CGL031
     C                     PARM           @@CTAX                                              CGL031
     C                     PARM           @@TXBS                                              CGL031
     C                     PARM           @@WTAC                                              CGL031
     C                     PARM           @@COLC                                              CGL031
     C                     PARM           @@STAT                                              CGL031
     C                     PARM           @@TRTE                                              CGL031
     C                     PARM           @@TXR1                                              CGL031
     C                     PARM           @@JAMG                                              CGL031
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY                                               CGL031
     C                     PARM           @@FILE                                              CGL031
     C                     PARM           @@RTRN                                              CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
      ** If return code = Error.                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'ERROR'                                                       CGL031
     C                     MOVE @@FILE    DBFILE                                              CGL031
     C                     MOVE @@KEY     DBKEY                                               CGL031
     C                     Z-ADD68        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFNE *ZERO                                                         CGL031
     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
     C           @@STAT    OREQ 'DISCL'                                                       CGL031
     C           @@STAT    OREQ 'SELF '                                                       CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WTXJA                                               CGL031
     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
     C                     MOVE S1CTTA    KCSIS                                               236815
     C                     MOVE @@CTAX    KCTRT                                               CGL031
      *                                                                                       CGL031
     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
     C           *IN61     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
     C           TCTXCM    WHEQ 1                                                             CGL031
     C           SWHTFD    OREQ 'N'                                                           236815
     C********** S1RASO    OREQ 0                                                      236815 234813
     C           UTXRSR    OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
     C           TCTXCM    WHEQ 2                                                             CGL031
     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236815
     C                     MULT @@TAXR    @@TAXA                                              236815
     C                     DIV  100       @@TAXA    H                                         236815
     C           @@TAXA    IFLT 0                                                             236815
     C                     Z-ADD0         @@TAXA                                              236815
     C                     ENDIF                                                              236815
     C           TCTXCM    WHEQ 3                                                             CGL031
     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C                     SUB  WTAXA     @@TAXA                                              236815
     C           @@TAXA    IFLT 0                                                             236815
     C                     Z-ADD0         @@TAXA                                              236815
     C                     ENDIF                                                              236815
     C           TCTXCM    WHEQ 4                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Write record to SDCSINPD                                                             CGL031
      *                                                                                       CGL031
     C                     EXSR CSINSR                                                        CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'NOTAX'                                                       CGL031
     C           @@RTRN    OREQ 'TAXAB'                                                       CGL031
     C           KJANO     READESDJACCLB                 60                                   CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If @@RTRN = Last, end loop                                                           CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'LAST'                                                        CGL031
     C                     MOVE *ON       *IN60                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C           ENDMPT    ENDSR                                                              CGL031
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  MATURE - Subroutine to produce Maturity Position Settlements.*
      *                                                               *
      *****************************************************************
      *
     C           MATURE    BEGSR                           ** MATURE **
      *                                                                   E21573
      ***  A separate Coupon Event is now produced at Maturity and this   E21573
      ***  should be used to generate Position Settlement for Interest.   E21573
      *                                                                   E21573
     C***USE*LAST*COUPON*DATE*FROM*THE*SECURITY*ACTION************ E15549 E21573
     C***********                                                  E15549 E21573
     C***********          Z-ADDSALCCP    LCPN                     E15549 E21573
     C***********                                                         E21573
     C***CALCULATE*INTEREST*DUE*VIA*P/ZACCRc*FOR*SECURITY**************   E21573
     C***FROM*DATE*IS*LAST*COUPON*/*TO*DATE*IS*EVENT*DATE.*************   E21573
     C***GET*NOMINAL*CCY*DEC*PLACES*FROM*TABTG10*FIRST*(CDP)***********   E21573
     C***********                                                         E21573
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE NMCY      WCURR   3                       S01486
     C                     EXSR TG10                                      S01486
     C                     Z-ADDCDP       ZCDPF                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C***********          MOVE NMCY      WCURR   3                       E21573
     C***********          EXSR TG10                                      E21573
     C***********                                                         E21573
     C***WHEN*PARM*ZAB*IS*'A'*,*INTEREST*IS*CALCULATED*AFTER*CHANGES***   E21573
     C***********                                                         E21573
     C***********          UNLCKLDA                                       E21573
     C***********          MOVE 'A'       ZAB                             E21573
     C***********          CALL 'ZACCRC'                                  E21573
     C***********          PARM           LCPN                            E21573
     C***********          PARM           SAED                            E21573
     C***********          PARM           CSBR                            E21573
     C***********          PARM           CSCN                            E21573
     C***********          PARM           CSSC                            E21573
     C***********          PARM           CDP                             E21573
     C***********          PARM           ZINTDU 150                      E21573
     C***********          PARM           ZAB     1                       E21573
     C**********           PARM           WU8     1
     C*
     C***OBTAIN*PRICE*AT*MATURITY*-*CHECK*LF/SECED*FOR*REDEMPTION*PRICE   E20016
     C** OBTAIN PRICE AT MATURITY - CHECK LF/SEDEV FOR REDEMPTION PRICE   E20016
     C*
     C                     Z-ADD0         SDRP
     C                     Z-ADDMATY      SDED
     C                     MOVE 'RC'      SDET
     C*
     C** CHECK FILE FOR EITHER 'RC' TYPE OR 'RP' TYPE IN KEY FIELD
     C*
     C                     EXSR SECEDI
     C           *IN78     IFEQ '1'
     C                     MOVE 'RP'      SDET
     C                     EXSR SECEDI
     C                     END
     C           *IN78     IFEQ '1'
     C*
     C** IF NEITHER RC NOR RP USE 100 IF PRICE BASIS IS P,ELSE 1 (U)
     C** Or if RP/RC record found AND price is zero and S01509 is         S01509
     C** active, use 100 if price basis is P, else 1                      S01509
     C*
     C           *IN78     OREQ '0'                                       S01509
     C           SDRP      ANDEQ0                                         S01509
     C           S01509    ANDEQ'Y'                                       S01509
     C*                                                                   S01509
     C           SPBS      IFEQ 'P'
     C                     Z-ADD100       SDRP
     C                     END
     C***********SPBS      IFEQ 'U'                                       103011
     C***********          Z-ADD1         SDRP                            103011
     C***********          END                                            103011
     C           PROT      IFEQ '1'                                       192467
     C           SPBS      ANDEQ'U'                                       192467
     C                     Z-ADD1         SDRP                            192467
     C                     ENDIF                                          192467
     C                     END
     C*                                                                   S01486
     C** SET NOMINAL VALUE TO FIGURE FROM PF/PMCPOSPD                     S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   S01486
     C           WPORTP    IFEQ 'Y'                                       S01486
     C***********          Z-ADDQANOML    WWCSNV 150               S01486 189942
     C                     Z-ADDCDNV      WWCSNV 150                      189942
     C                     ELSE                                           S01486
     C                     Z-ADDCSNV      WWCSNV 150                      S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C*
     C**  CALCULATE NOMINAL MATURING AT CUST. AS
     C**  NOMINAL VALUE DATE BASIS TIMES PRICE AT MATURITY
     C*
     C***********          Z-ADDSDRP      WRK08   88                      E23169
     C***********          Z-ADDSDRP      WRK150 150                      E23169
     C***********CSNV      MULT WRK08     WRK156 156                      E23169
     C***********WRK156    DIV  1         WNOMAT 130H                     E20151
     C**IF*78*IS*ON,*NO*PRICE*ON*SEC*EVENT*FILE*SO*CCY*FLD*'CDP'*IS*0**   E20151
     C***********                                                         E23169
     C***********CDP       SUB  NMDP      DC      10                      E23169
     C***78******          Z-SUBNMDP      DC                              E20151
     C***********DC        ADD  5         DC                              E23169
     C***********                                                  E20151 E23169
     C***Adjust*for percentage pricing.                            E20151 E23169
     C***********SPBS      IFEQ 'P'                                E20151 E23169
     C***********          SUB  2         DC                       E20151 E23169
     C***********          END                                     E20151 E23169
     C***********                                                  E20151 E23169
     C***********DC        IFLT 5                                         E23169
     C***********WNOMAT    MULT POWER8,DC WRK151 151                      E23169
     C***********WRK151    DIV  1         WNOMAT    H                     E23169
     C***********          ELSE                                           E23169
     C***********WNOMAT    MULT POWER8,DC WNOMAT                          E23169
     C***********          END                                            E23169
     C*                                                                   E23169
     C*NOMINAL DECIMAL PLACES RETRIEVED - NOW USE CCY  TO GET CCY  DP     E23169
     C*                                                                   E23169
     C                     MOVE NMCY      WCURR   3                       E23169
     C                     EXSR TG10                                      E23169
     C*                                                                   E23169
     C** Use ZCNSD subroutin to calculate Amount                          E23169
     C*                                                                   E23169
     C                     Z-ADDSDRP      ZPRC                            E23169
     C           BGPFMG    IFNE 'Y'                                       S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     Z-ADDCSNV      ZNOML                           E23169
     C                     ELSE                                           S01486
     C                     Z-ADDWWCSNV    ZNOML                           S01486
     C                     END                                            S01486
     C                     EXSR ZCNSD                                     E23169
     C                     Z-ADDZCONS     WNOMAT 150                      E23169
     C*
     C** If S01509 is active and redemption currency is not blank and     S01509
     C** is different from the nominal currency, convert maturity         S01509
     C** amount to redemption currency                                    S01509
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C           *IN78     ANDEQ'0'                                       S01509
     C           SDCX      ANDNE*BLANKS                                   S01509
     C           SDCX      ANDNENMCY                                      S01509
     C                     MOVE NMCY      WCURR   3                       S01509
     C                     EXSR TG10                                      S01509
     C                     Z-ADDZCDP      ZCDPI                           S01509
     C                     MOVE SDCX      WCURR   3                       S01509
     C                     EXSR TG10                                      S01509
     C                     Z-ADDZCDP      ZCDPO                           S01509
     C                     MOVE NMCY      ZCCYI                           S01509
     C                     MOVE SDCX      ZCCYO                           S01509
     C                     Z-ADDWNOMAT    ZAMTCI                          S01509
     C                     Z-ADDSDCE      ZEXCH                           S01509
     C                     MOVE SDMD      ZMD                             S01509
     C                     EXSR ZCONV                                     S01509
     C                     Z-ADDZAMTCO    WNOMAT                          S01509
     C                     END                                            S01509
     C*                                                                   S01446
     C** For Courtage Enhancement, if Autocharge option is 'Y' and        S01446
     C** charge currency is not blank, update fields                      S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           BVACOP    ANDEQ'Y'                                       S01446
     C           BVCHRC    ANDNE*BLANKS                                   S01446
     C*                                                                   S01446
     C** Get M/D indicator and spot rate of input ccy from SDCURRPD       S01446
     C*                                                                   S01446
     C                     Z-ADD27        WDBAS1                          S01446
     C                     EXSR #LCURR                                    S01446
     C                     Z-ADDA6SPRT    ZRATE2                          S01446
     C                     MOVE A6MDIN    ZMDI2                           S01446
     C                     Z-ADDTXSPOT    ZRATE1                          S01446
     C                     MOVE TXMDI     ZMDI1                           S01446
     C                     EXSR ZXRATE                                    S01446
     C                     MOVE ZRATEX    TRATEX                          S01446
     C                     MOVE ZMDIX     TMDIX                           S01446
     C                     END                                            S01446
     C*
     C***AMOUNT*DUE*IS*NOMINAL*MATURING**AT*CUST.**+*INTEREST             E21138
     C** Amount due is nominal maturing at Customer (interest is separate)E21138
     C*
     C***********WNOMAT    ADD  ZINTDU    WRK130 130                      E21138
     C*
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C** MATURITY SETTLEMENT WILL BE PAID IN VALUE CURRENCY. HENCE IF     S01486
     C** NOMINAL CURRENCY DIFFERENT TO VALUE CURRENCY CONVERT AMMOUNT     S01486
     C                     Z-ADDWNOMAT    WNOMA1 150                      S01486
     C                     END                                            S01486
     C*
     C** IF POSITION SETTLEMENT REQUIRED WRITE POSN SETLL.IN SUBR W02
     C*
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WPORTP    IFEQ 'Y'                                       S01486
     C           WPPOSN    OREQ 'N'                                       S01486
     C           PSRI      IFEQ 'Y'                                       S01486
     C*                                                                   S01486
     C* WRITE POSITION SETTLEMENT RECORD SUBR W02                         S01486
     C*                                                                   S01486
     C                     Z-ADDWNOMAT    PAMD                            S01486
     C                     MOVE 'MT'      PEVT                            S01486
     C*********************Z-ADDCSNV      PNMP                     S01486 093827
     C                     Z-ADDWWCSNV    PNMP                            093827
     C           PAMD      IFLT 0                                         S01486
     C                     Z-SUBPAMD      PAMD                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C           WNOMAT    IFLE 0                                         S01486
     C                     MOVE 'R'       PPRE                            S01486
     C                     ELSE                                           S01486
     C                     MOVE 'P'       PPRE                            S01486
     C                     END                                            S01486
      *                                                                                       233709
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
     C*                                                                   S01486
      ** If CGL031 is on and security is taxable and classification is D or S,                233709
      ** perform the tax calulation.                                                          233709
      *                                                                                       233709
     C           CGL031    IFEQ 'Y'                                                           233709
     C           SETX      ANDEQ'Y'                                                           233709
     C********** CSNV      ANDGT*ZERO                                                  233709 234406
      *                                                                                       233709
     C********** C1DI      IFEQ 'D'                                                    CGL031 234440
     C********** C1DI      OREQ 'S'                                                    CGL031 234440
     C                     EXSR MATTAX                                                        233709
     C**********           ENDIF                                                       CGL031 234440
     C                     ENDIF                                                              233709
      *                                                                                       233709
     C/COPY WNCPYSRC,SE2400C036
     C                     EXSR W02                                       S01486
     C*                                                                   S01486
     C/COPY WNCPYSRC,SE2400C037
     C                     END                                            S01486
     C*                                                                   S01486
     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01                     S01486
     C*                                                                   S01486
     C           AKRI      IFEQ 'Y'                                       S01486
     C                     MOVE 'M'       WACEVC                          S01486
     C                     Z-ADDWNOMAT    WRK130 130                      S01486
     C           WRK130    IFGT 0                                         S01486
     C           NPAC      OREQ 'N'                                       S01486
     C                     MOVE ' '       WACNEG                          S01486
     C                     ELSE                                           S01486
     C                     MOVE 'N'       WACNEG                          S01486
     C                     END                                            S01486
     C                     MOVE 'CV'      WACAMC                          S01486
     C                     Z-ADDWRK130    EVAM                            S01486
     C           WRK130    IFLT 0                                         S01486
     C           NPAC      ANDEQ'Y'                                       S01486
     C                     Z-SUBEVAM      EVAM                            S01486
     C                     END                                            S01486
      *                                                                                       CGL031
     C                     Z-ADDEVAM      MATAMT 150                                          CGL031
     C*                                                                   S01486
     C* CHECK PORTFOLIO POSITION FLAG                                     S01486
     C                     EXSR W01                                       S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C*  WRITE MATURED SECURITY POSITION EXTRACT FILE                     S01486
     C*                                                                   S01486
     C           WPORTP    IFNE 'Y'                                       S01486
     C                     EXSR W03                                       S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C*
     C           PSRI      IFEQ 'Y'
     C*
     C* WRITE POSITION SETTLEMENT RECORD SUBR W02
     C*
     C***********          Z-ADDWRK130    PAMD                            E21138
     C                     Z-ADDWNOMAT    PAMD                            E21138
     C**********           MOVE 'MA'      PEVT                            E14716
     C                     MOVE 'MT'      PEVT                            E14716
     C                     Z-ADDCSNV      PNMP
     C           PAMD      IFLT 0
     C                     Z-SUBPAMD      PAMD
     C                     END
     C*
     C***********WRK130    IFLE 0                                         E21138
     C           WNOMAT    IFLE 0                                         E21138
     C**********           MOVE 'P'       PPRE                            E14704
     C                     MOVE 'R'       PPRE                            E14704
     C                     ELSE
     C**********           MOVE 'R'       PPRE                            E14704
     C                     MOVE 'P'       PPRE                            E14704
     C                     END
      *                                                                                       233709
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
     C*
      ** If CGL031 is on and security is taxable and classification is D or S,                233709
      ** perform the tax calulation.                                                          233709
      *                                                                                       233709
     C           CGL031    IFEQ 'Y'                                                           233709
     C           SETX      ANDEQ'Y'                                                           233709
     C********** CSNV      ANDGT*ZERO                                                  233709 234406
      *                                                                                       233709
     C********** C1DI      IFEQ 'D'                                                    233709 234440
     C********** C1DI      OREQ 'S'                                                    233709 234440
     C                     EXSR MATTAX                                                        233709
     C**********           ENDIF                                                       233709 234440
     C                     ENDIF                                                              233709
      *                                                                                       233709
     C/COPY WNCPYSRC,SE2400C042
     C                     EXSR W02
     C/COPY WNCPYSRC,SE2400C043
     C*
     C                     END
     C*
     C** IF ACCOUNT KEY REQUIRED WRITE A/C KEY IN W01
     C*
     C           AKRI      IFEQ 'Y'
     C                     MOVE 'M'       WACEVC
     C***********          Z-ADDWNOMAT    WRK130                   E21138 E23169
     C                     Z-ADDWNOMAT    WRK130 130                      E23169
     C           WRK130    IFGT 0
     C           NPAC      OREQ 'N'
     C                     MOVE ' '       WACNEG
     C                     ELSE
     C                     MOVE 'N'       WACNEG
     C                     END
     C                     MOVE 'CV'      WACAMC
     C                     Z-ADDWRK130    EVAM
     C           WRK130    IFLT 0
     C           NPAC      ANDEQ'Y'
     C                     Z-SUBEVAM      EVAM
     C                     END
      *                                                                                       CGL031
     C                     Z-ADDEVAM      MATAMT                                              CGL031
     C*
     C                     EXSR W01
     C/COPY WNCPYSRC,SE2400C015
     C*
     C**********           END                                            E14703
     C*
     C*  WRITE MATURED SECURITY POSITION EXTRACT FILE
     C*
     C                     EXSR W03
     C*                                                                   E14703
     C                     END                                            E14703
     C                     END                                            S01486
     C*
      ***If*CGL031*is*on*and*security*is*taxable*and*classification*is*D or S          CGL031 233709
      ***and*if*BGPFMG*or*BGN4ST*=*Y,*perform*the*tax*calulation.******                CGL031 233709
      *****************************************************************                CGL031 233709
     C***********CGL031    IFEQ 'Y'                                                    CGL031 233709
     C***********SETX      ANDEQ'Y'                                                    CGL031 233709
     C***********SAED      ANDLTBJDNWD                                                 CGL031 233709
     C***********CSNV      ANDGT*ZERO                                                  CGL031 233709
     C***********C1DI      IFEQ 'D'                                                    CGL031 233709
     C***********C1DI      OREQ 'S'                                                    CGL031 233709
     C***********BGPFMG    IFEQ 'Y'                                                    CGL031 233709
     C***********BGN4ST    OREQ 'Y'                                                    CGL031 233709
     C***********          EXSR MATTAX                                                 CGL031 233709
     C***********          ENDIF                                                       CGL031 233709
     C***********          ENDIF                                                       CGL031 233709
     C***********          ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C           ENDMAT    ENDSR                           ** ENDMAT **
      *
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  MATTAX - Subroutine to calculate tax for descretionary and   *                       CGL031
      *           safe custody customers.                             *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           MATTAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Check if record needs to be taxed.                                                   CGL031
      *                                                                                       CGL031
     C                     EXSR CHKTAX                                                        CGL031
      *                                                                                       CGL031
      ***A*separate*Coupon*Event*is*now*produced*at*Maturity*and*this**                CGL031 234440
      ***should*be*used*to*generate*Position*Settlement*for*Interest.**                CGL031 234440
      *                                                                                       CGL031
     C**********           MOVE NMCY      WCURR                                        CGL031 234440
     C**********           EXSR TG10                                                   CGL031 234440
     C**********           Z-ADDCDP       ZCDPF                                        CGL031 234440
      *                                                                                       CGL031
      ***Obtain*Price*at*Maturity*-*Check*LF/SEDEV*for*Redemption*Price                CGL031 234440
      *                                                                                       CGL031
     C**********           Z-ADD0         SDRP                                         CGL031 234440
     C**********           Z-ADDMATY      SDED                                         CGL031 234440
     C**********           MOVE 'RC'      SDET                                         CGL031 234440
      *                                                                                       CGL031
      ***Check*file*for*either*'RC'*Type*or*'RP'*Type*in*Key*field*****                CGL031 234440
      *                                                                                       CGL031
     C**********           EXSR SECEDI                                                 CGL031 234440
     C********** *IN78     IFEQ '1'                                                    CGL031 234440
     C**********           MOVE 'RP'      SDET                                         CGL031 234440
     C**********           EXSR SECEDI                                                 CGL031 234440
     C**********           ENDIF                                                       CGL031 234440
      *                                                                                       CGL031
     C********** *IN78     IFEQ '1'                                                    CGL031 234440
      *                                                                                       CGL031
      ***If*neither*RC*nor*RP*use*100*if*PRICE*BASIS*is*P,*else*1*(U)**                CGL031 234440
      ***Or*if*RP/RC*record*found*and*price*is*zero*and*S01509*is******                CGL031 234440
      ***active,*use*100*if*price*basis*is*P,*else*1*******************                CGL031 234440
      *                                                                                       CGL031
     C********** *IN78     OREQ '0'                                                    CGL031 234440
     C********** SDRP      ANDEQ0                                                      CGL031 234440
     C********** S01509    ANDEQ'Y'                                                    CGL031 234440
      *                                                                                       CGL031
     C********** SPBS      IFEQ 'P'                                                    CGL031 234440
     C**********           Z-ADD100       SDRP                                         CGL031 234440
     C**********           ENDIF                                                       CGL031 234440
     C********** PROT      IFEQ '1'                                                    CGL031 233709
     C********** SPBS      ANDEQ'U'                                                    CGL031 233709
     C**********           Z-ADD1         SDRP                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *                                                                                       CGL031
      ***Set*Nominal*Value*to*figure*from*PF/PMCPOSPD******************                CGL031 234440
      *                                                                                       CGL031
     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233709
     C**********           Z-ADDCDNV      WWCSNV                                       CGL031 233709
     C**********           Z-ADDAFPV      WWCSAV 150                                   CGL031 233567
     C**********           ELSE                                                        CGL031 233709
     C**********           Z-ADDCSNV      WWCSNV                                       CGL031 234440
     C**********           Z-ADDCSAV      WWCSAV                                       CGL031 235243
     C**********           Z-ADDAFPV      WWCSAV                                       235243 233567
     C**********           Z-ADDCSAV      WWCSAV 150                                   233567 233709
     C**********           ENDIF                                                       CGL031 233709
      *                                                                                       CGL031
      ***Nominal*Decimal*Places*retrieved*-*now*use*CCY*to*get*CCY*DP**                CGL031 234440
      *                                                                                       CGL031
     C**********           MOVE NMCY      WCURR                                        CGL031 234440
     C**********           EXSR TG10                                                   CGL031 234440
      *                                                                                       CGL031
      ***Use*ZCNSD*subroutine*to*calculate*Amount*****************                     CGL031 234440
      *                                                                                       CGL031
     C**********           Z-ADDSDRP      ZPRC                                         CGL031 234440
     C**********           Z-ADDWWCSNV    ZNOML                                        CGL031 234440
     C**********           EXSR ZCNSD                                                  CGL031 234440
     C**********           Z-ADDZCONS     WNOMAT                                       CGL031 234440
      *                                                                                       CGL031
      ***Use*ZCNSD*subroutine*to*calculate*Amount*for*CSAV*and*AFPV****                CGL031 233709
      ***Use*ZCNSD*subroutine*to*calculate*Amount*for*AFPV*************                CGL031 234440
      *                                                                                       CGL031
     C**********           Z-ADDSDRP      ZPRC                                         CGL031 233709
     C**********           Z-ADDWWCSAV    ZNOML                                        CGL031 233709
     C**********           EXSR ZCNSD                                                  CGL031 233709
     C**********           Z-ADDZCONS     WCSAV  150                                   CGL031 233709
      *                                                                                       CGL031
      ***If*S01509*is*active*and*redemption*currency*is*not*blank*and**                CGL031 234440
      ***is*different*from*the*nominal*currency,*convert*maturity******                CGL031 234440
      ***amount*to*redemption*currency*********************************                CGL031 234440
      *                                                                                       CGL031
     C********** S01509    IFEQ 'Y'                                                    CGL031 234440
     C********** *IN78     ANDEQ'0'                                                    CGL031 234440
     C********** SDCX      ANDNE*BLANKS                                                CGL031 234440
     C********** SDCX      ANDNENMCY                                                   CGL031 234440
     C**********           MOVE NMCY      WCURR                                        CGL031 234440
     C**********           EXSR TG10                                                   CGL031 234440
     C**********           Z-ADDZCDP      ZCDPI                                        CGL031 234440
     C**********           MOVE SDCX      WCURR                                        CGL031 234440
     C**********           EXSR TG10                                                   CGL031 234440
     C**********           Z-ADDZCDP      ZCDPO                                        CGL031 234440
     C**********           MOVE NMCY      ZCCYI                                        CGL031 234440
     C**********           MOVE SDCX      ZCCYO                                        CGL031 234440
     C**********           Z-ADDWNOMAT    ZAMTCI                                       CGL031 234440
     C**********           Z-ADDSDCE      ZEXCH                                        CGL031 234440
     C**********           MOVE SDMD      ZMD                                          CGL031 234440
     C**********           EXSR ZCONV                                                  CGL031 234440
     C**********           Z-ADDZAMTCO    WNOMAT                                       CGL031 234440
     C**********           ENDIF                                                       CGL031 234440
      *                                                                                       CGL031
      * Take on pgms for new countries of tax should ensure there is                   CGL031 234440
      * always an average fiscal price, so no need to check this.                      CGL031 234440
      ***Calculate*fiscal*price*numerator*at*value*date*when*needed****                CGL031 234440
      *                                                                                       233709
     C********** CSAV      IFEQ *ZERO                                                  CGL031 234440
     C********** RUND      ANDGEEWEDT1                                                 CGL031 234440
      *                                                                                       233709
     C********** CSDA      IFGT EWEDT1                                                 CGL031 234440
     C**********           Z-ADDCSDA      WBRKD   50                                   CGL031 234440
     C**********           ELSE                                                        CGL031 234440
     C**********           Z-ADDEWEDT1    WBRKD                                        233709 234440
     C**********           ENDIF                                                       233709 234440
      *                                                                                       233709
     C**********           CALL 'ZAINTPL2'                                             233709 234440
     C**********           PARM           ISSD                                         233709 234440
     C**********           PARM           WBRKD                                        233709 234440
     C**********           PARM           MATY                                         233709 234440
     C**********           PARM           ISSP                                         233709 234440
     C**********           PARM           SDRP                                         233709 234440
     C**********           PARM           WFSPR  158                                   233709 234440
      *                                                                                       233709
      ***Use*ZCNSD*subroutine*to*calculate*Amount*for*CSAV*************                233709 234440
      *                                                                                       233709
     C**********           Z-ADDWFSPR     ZPRC                                         233709 234440
     C**********           Z-ADDWWCSNV    ZNOML                                        233709 234440
     C**********           EXSR ZCNSD                                                  233709 234440
     C**********           Z-ADDZCONS     CSAV                                         233709 234440
     C**********           ENDIF                                                       233709 234440
     C                     MOVE 'Y'       WTXBLE           Amount is taxable                  236137
     C           WNOTAX    IFEQ 'Y'                        Begin Taxable                      236137
     C           ISSP      OREQ 100                                                           236137
     C                     MOVE 'N'       WTXBLE                                              236137
      *                                                                                       236137
     C                     ELSE                                                               236137
      *                                                                                       236137
      ** If record was found and De Minimis Rule is applicable, determine if                  236137
      ** amortized discount is taxable.                                                       236137
     C           EWDMAP    IFEQ 'Y'                        Begin EWDMAP                       236137
      *                                                                                       236137
     C           100       SUB  ISSP      WWAMT            Amortized Discount                 236137
      *                                                                                       236137
     C           WWAMT     IFLE EWTTDP                                                        236137
     C           MATY      SUB  ISSD      WWDAYS                                              236137
     C                     DIV  365       WWDAYS    H                                         236137
      *                                                                                       236137
     C           WWDAYS    IFNE *ZEROS                                                        236137
     C                     DIV  WWDAYS    WWAMT                                               236137
      *                                                                                       236137
     C           WWAMT     IFLE EWYRDP                                                        236137
     C                     MOVE 'N'       WTXBLE           Amount is not taxable              236137
      *                                                                                       236137
     C                     ENDIF                                                              236137
      *                                                                                       236137
     C                     ENDIF                                                              236137
      *                                                                                       236137
     C                     ENDIF                                                              236137
      *                                                                                       236137
     C                     ENDIF                           End EWDMAP                         236137
      *                                                                                       236137
     C                     ENDIF                           End Taxable                        236137
      *                                                                                       234440
      ** Calculate Tax Amount for the Maturity                                                234440
      *                                                                                       234440
     C***********WNOTAX****IFEQ*' '************************************                234440 236137
     C***********ISSP******ANDNE100************************************                234440 236137
     C           WTXBLE    IFEQ 'Y'                                                           236137
      *                                                                                       234440
      ** Get Average Fiscal Price of Position                                                 234440
      *                                                                                       234440
     C           WPORTP    IFEQ 'Y'                                                           234440
     C           BGPFMG    ANDEQ'Y'                                                           234440
     C           WPORTP    OREQ 'Y'                                                           234440
     C           BGN4ST    ANDEQ'Y'                                                           234440
      *                                                                                       234440
      ** Access Customer Position                                                             234440
      *                                                                                       234440
     C**********           Z-ADDCDCN      CDCNZN                                       236816 CSD027
     C                     MOVELCDCN      CDCNZN                                              CSD027
     C                     CALL WPGM                                                          234440
     C                     PARM           WRTCD  10                                           234440
     C                     PARM           CDPA                                                234440
     C**********           PARM           CDCN                                         234440 236816
     C                     PARM           CDCNZN                                              236816
     C                     PARM           CDSN                                                234440
     C                     PARM           PTFR                                                234440
     C                     PARM           CDMK                                                234440
     C                     PARM           SAED                                                234440
     C                     PARM           ETCPOS                                              234440
     C                     ELSE                                                               234440
     C                     CALL WPGM                                                          234440
     C                     PARM           WRTCD  10                                           234440
     C                     PARM           CSBA                                                234440
     C**********           PARM           CSSC                                         234440 236815
     C                     PARM           CSCN                                                234440
     C                     PARM           CSSC                                                236815
     C                     PARM *BLANKS   WPTFR   4                                           234440
     C                     PARM 'S'       WMKT    1                                           234440
     C                     PARM           SAED                                                234440
     C                     PARM           ETCPOS                                              234440
     C                     END                                                                234440
      *                                                                                       234440
      *                                                                                       233709
      ** If S01509 is active and value currency is not blank and                              CGL031
      ** is different from the nominal currency, convert average fiscal                       CGL031
      ** price numerator at value date to value currency                                      CGL031
      *                                                                                       CGL031
     C           S01509    IFEQ 'Y'                                                           CGL031
     C           VLCY      ANDNE*BLANKS                                                       CGL031
     C           VLCY      ANDNENMCY                                                          CGL031
     C                     MOVE NMCY      WCURR                                               CGL031
     C                     EXSR #LCURR                                                        CGL031
     C                     Z-ADDA6NBDP    ZCDPI                                               CGL031
     C                     Z-ADDA6SPRT    ZRATE1                                              CGL031
     C                     MOVE A6MDIN    ZMDI1                                               CGL031
     C                     MOVE VLCY      WCURR                                               CGL031
     C                     EXSR #LCURR                                                        CGL031
     C                     Z-ADDA6NBDP    ZCDPO                                               CGL031
     C                     Z-ADDA6SPRT    ZRATE2                                              CGL031
     C                     MOVE A6MDIN    ZMDI2                                               CGL031
     C                     MOVE NMCY      ZCCYI                                               CGL031
     C                     MOVE VLCY      ZCCYO                                               CGL031
      *                                                                                       CGL031
     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233567
     C**********           Z-ADDAFPV      ZAMTCI                                       CGL031 233567
     C**********           ELSE                                                        CGL031 233567
     C                     Z-ADDCSAV      ZAMTCI                                              CGL031
     C**********           ENDIF                                                       CGL031 233567
      *                                                                                       CGL031
     C                     EXSR ZXRATE                                                        CGL031
     C                     Z-ADDZRATEX    ZEXCH                                               CGL031
     C                     MOVE ZMDIX     ZMD                                                 CGL031
     C                     EXSR ZCONV                                                         CGL031
     C***********          Z-ADDZAMTCO    WCSAV                                        CGL031 233709
     C                     Z-ADDZAMTCO    WCSAV  150                                          233709
     C                     ELSE                                                               234440
     C                     Z-ADDCSAV      WCSAV                                               234440
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Amount due is nominal maturing at Customer (interest is separate)                    CGL031
      *                                                                                       CGL031
      ** Maturity settlement will be paid in value currency. Hence if                         CGL031
      ** Nominal Currency different to Value Currency convert amount                          CGL031
      *                                                                                       CGL031
     C                     Z-ADDWNOMAT    WNOMA1                                              CGL031
      *                                                                                       CGL031
      ** If no record found, no tax is calculated                                             CGL031
      *                                                                                       CGL031
      ** Calculate Tax Amount for the Maturity or Early Redemption                            CGL031
      ** and to Output Information on SDCSINPD                                                CGL031
      *                                                                                       CGL031
     C********** WNOTAX    IFEQ ' '                                                    CGL031 234440
      *                                                                                       CGL031
      ** Compute the difference between WNOMAT and WCSAV.                                     CGL031
      ** If WNOMAT - WCSAV = negative or 0 nothing must be calculated or output               CGL031
      ** in SDCSINPD.                                                                         CGL031
      *                                                                                       CGL031
     C           WNOMA1    SUB  WCSAV     WRESLT 150                                          CGL031
      *                                                                                       CGL031
     C           WRESLT    IFGT 0                                                             CGL031
      *                                                                                       234440
      ** Tax amount is based upon the lesser of the discount accrued                          234440
      ** and the profit from the maturity, so calculate this, if country                      234440
      *  of tax is not Switzerland.                                                           234440
      *                                                                                       234440
      ** bit about CH is added and removed by this change control                             234440
      ** it is left in the code in case the situation changes again.                          234440
     C********** EWCTRT    IFNE 'CH'                                                          234440
      *                                                                                       234440
      ** N.B. TAKE PRICE FROM NEW CUSTOMER/PORTFOLIO FILE                                     234440
      ** - NOT AVAILABLE YET SO USED AVERAG PRICE FROM CPOSN                                  234440
      *                                                                                       234440
      ** convert average price numerator to value currency if necessary                       234440
      *                                                                                       234440
     C********** S01509    IFEQ 'Y'                                                    234440 236815
     C********** VLCY      ANDNE*BLANKS                                                234440 236815
     C********** VLCY      ANDNENMCY                                                   234440 236815
     C**********           Z-ADDCSPV      ZAMTCI                                       234440 236815
     C**********           Z-ADDAPNC      ZAMTCI                                       234440 236815
     C**********           EXSR ZCONV                                                  234440 236815
     C********** WNOMA1    SUB  ZAMTCO    WAVPA  150                                   234440 236815
     C**********           ENDIF                                                       234440 236815
     C********** WAVPA     IFLT WRESLT                                                 234440 236815
     C**********           Z-ADDWAVPA     WRESLT                                       234440 236815
     C**********           ENDIF                                                       234440 236815
     C**********           ENDIF                                                              234440
     C           WRESLT    IFGT 0                                                             234440
     C                     EXSR MATXCL                                                        CGL031
      *                                                                                       CGL031
      ***Output*Tax*Account*Keys***************************************                CGL031 233709
      **********                                                                       CGL031 233709
     C**********           EXSR W04                                                    CGL031 233709
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              234440
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  MATXCL - Subroutine to calculate tax amount for the Maturity *                       CGL031
      *           or Early Redemption and to Output Information on    *                       CGL031
      *           SDCSINPD                                            *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           MATXCL    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialise work variables                                                            CGL031
      *                                                                                       CGL031
     C**********           Z-ADD0         WTTXSR                                       CGL031 233709
     C**********           Z-ADD0         WTTXSS                                       CGL031 233709
     C**********           Z-ADD0         WTTXSC                                       CGL031 233709
     C**********           Z-ADD0         WTTXSB                                       CGL031 233709
     C**********           Z-ADD0         WTNINT                                       CGL031 233709
     C**********           Z-ADD0         WTNINS                                       CGL031 233709
     C**********           Z-ADD0         WTNINC                                       CGL031 233709
     C**********           Z-ADD0         WTNINB                                       CGL031 233709
      *                                                                                       233709
     C           ISSP      IFGE 100                                                           233709
     C           SPBS      OREQ 'U'                                                           233709
     C                     Z-ADD*ZERO     @@TAXA                                              233709
     C                     GOTO ENDMTX                                                        233709
     C                     ENDIF                                                              233709
      *                                                                                       233709
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
     C                     MOVE ' '       WTXPI   1                                           CGL031
     C                     MOVE ' '       WTXJA   1                                           CGL031
      *                                                                                       CGL031
     C                     MOVE YCSCN     @@CUST                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLPI'                                                    CGL031
      ** Input                                                                                CGL031
     C                     PARM 'S'       @@MODI                                              CGL031
     C                     PARM SASN      @@TRRF                                              CGL031
     C                     PARM YCSBA     @@BRCA                                              CGL031
     C                     PARM           @@CUST                                              CGL031
     C                     PARM *ZERO     @@STRD                                              CGL031
     C                     PARM *ZERO     @@ENDD                                              CGL031
     C                     PARM WRESLT    @@TOTI                                              CGL031
     C                     PARM WTRAB     @@TAXR                                              CGL031
     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
     C                     PARM NMCY      @@OCCY                                              233568
     C                     PARM *BLANKS   PINTH                                               CER048
      ** Output                                                                               CGL031
     C                     PARM           @@IAED                                              CGL031
     C                     PARM           @@TAXA                                              CGL031
     C                     PARM           @@TOTO                                              CGL031
     C                     PARM           @@TXCY                                              CGL031
     C                     PARM           @@CTAX                                              CGL031
     C                     PARM           @@TXBS                                              CGL031
     C                     PARM           @@WTAC                                              CGL031
     C                     PARM           @@COLC                                              CGL031
     C                     PARM           @@STAT                                              CGL031
     C                     PARM           @@TRTE                                              CGL031
     C                     PARM           @@TXR1                                              CGL031
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY                                               CGL031
     C                     PARM           @@FILE                                              CGL031
     C                     PARM           @@RTRN                                              CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
      ** If return code = Error.                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHEQ 'ERROR'                                                       CGL031
     C                     MOVE @@FILE    DBFILE                                              CGL031
     C                     MOVE @@KEY     DBKEY                                               CGL031
     C                     Z-ADD63        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
      *                                                                                       CGL031
      ** If return code = Private Individual                                                  CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHNE 'JOINT'                                                       CGL031
      *                                                                                       CGL031
     C           @@TOTO    IFNE *ZERO                                                         CGL031
     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
     C           @@STAT    OREQ 'DISCL'                                                       CGL031
     C           @@STAT    OREQ 'SELF'                                                        CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WTXPI                                               CGL031
     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
     C                     MOVE S1CTTA    KCSIS                                               236815
     C                     MOVE @@CTAX    KCTRT                                               CGL031
      *                                                                                       CGL031
     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
     C           *IN61     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
     C           TCTXCM    WHEQ 1                                                             CGL031
     C           SWHTFD    OREQ 'N'                                                           236815
     C********** S1RASO    OREQ 0                                                      236815 234813
     C           UTXRSR    OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
     C           TCTXCM    WHEQ 2                                                             CGL031
     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236815
     C                     MULT @@TAXR    @@TAXA                                              236815
     C                     DIV  100       @@TAXA    H                                         236815
     C           @@TAXA    IFLT 0                                                             236815
     C                     Z-ADD0         @@TAXA                                              236815
     C                     ENDIF                                                              236815
     C           TCTXCM    WHEQ 3                                                             CGL031
     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C                     SUB  WTAXA     @@TAXA                                              236815
     C           @@TAXA    IFLT 0                                                             236815
     C                     Z-ADD0         @@TAXA                                              236815
     C                     ENDIF                                                              236815
     C           TCTXCM    WHEQ 4                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Write record to SDCSINPD                                                             CGL031
      *                                                                                       CGL031
     C                     EXSR CSINSR                                                        CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If return code = Private Individual                                                  CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHEQ 'JOINT'                                                       CGL031
     C                     MOVE YCSCN     KJANO                                               CGL031
      *                                                                                       CGL031
     C           KJANO     SETLLSDJACCLB                                                      CGL031
     C           KJANO     READESDJACCLB                 60                                   CGL031
      *                                                                                       CGL031
     C           *IN60     DOWEQ*OFF                                                          CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLJA'                                                    CGL031
      ** Input                                                                                CGL031
     C                     PARM 'S'       @@MODI                                              CGL031
     C                     PARM SASN      @@TRRF                                              CGL031
     C                     PARM YCSBA     @@BRCA                                              CGL031
     C                     PARM JCJANO    @@JANO                                              CGL031
     C                     PARM JCCUST    @@CUST                                              CGL031
     C                     PARM JCNAHO    @@NARF                                              CGL031
     C                     PARM JCINVP    @@INVP                                              CGL031
     C                     PARM *ZERO     @@STRD                                              CGL031
     C                     PARM *ZERO     @@ENDD                                              CGL031
     C                     PARM WRESLT    @@TOTI                                              CGL031
     C                     PARM WTRAB     @@TAXR                                              CGL031
     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
     C                     PARM NMCY      @@OCCY                                              233568
     C                     PARM *BLANKS   PINTH                                               CER048
      ** Output                                                                               CGL031
     C                     PARM           @@IAED                                              CGL031
     C                     PARM           @@TAXA                                              CGL031
     C                     PARM           @@TOTO                                              CGL031
     C                     PARM           @@TXCY                                              CGL031
     C                     PARM           @@CTAX                                              CGL031
     C                     PARM           @@TXBS                                              CGL031
     C                     PARM           @@WTAC                                              CGL031
     C                     PARM           @@COLC                                              CGL031
     C                     PARM           @@STAT                                              CGL031
     C                     PARM           @@TRTE                                              CGL031
     C                     PARM           @@TXR1                                              CGL031
     C                     PARM           @@JAMG                                              CGL031
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY                                               CGL031
     C                     PARM           @@FILE                                              CGL031
     C                     PARM           @@RTRN                                              CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
      ** If return code = Error.                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'ERROR'                                                       CGL031
     C                     MOVE @@FILE    DBFILE                                              CGL031
     C                     MOVE @@KEY     DBKEY                                               CGL031
     C                     Z-ADD65        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           @@TOTO    IFNE *ZERO                                                         CGL031
     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
     C           @@STAT    OREQ 'DISCL'                                                       CGL031
     C           @@STAT    OREQ 'SELF '                                                       CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WTXJA                                               CGL031
     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
     C                     MOVE S1CTTA    KCSIS                                               236815
     C                     MOVE @@CTAX    KCTRT                                               CGL031
      *                                                                                       CGL031
     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
     C           *IN61     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
     C           TCTXCM    WHEQ 1                                                             CGL031
     C           SWHTFD    OREQ 'N'                                                           236815
     C********** S1RASO    OREQ 0                                                      236815 234813
     C           UTXRSR    OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
     C           TCTXCM    WHEQ 2                                                             CGL031
     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236815
     C                     MULT @@TAXR    @@TAXA                                              236815
     C                     DIV  100       @@TAXA    H                                         236815
     C           @@TAXA    IFLT 0                                                             236815
     C                     Z-ADD0         @@TAXA                                              236815
     C                     ENDIF                                                              236815
     C           TCTXCM    WHEQ 3                                                             CGL031
     C**********           Z-ADD@@TAXA    @@TAXA                                       CGL031 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C                     SUB  WTAXA     @@TAXA                                              236815
     C           @@TAXA    IFLT 0                                                             236815
     C                     Z-ADD0         @@TAXA                                              236815
     C                     ENDIF                                                              236815
     C           TCTXCM    WHEQ 4                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Write record to SDCSINPD                                                             CGL031
      *                                                                                       CGL031
     C                     EXSR CSINSR                                                        CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'NOTAX'                                                       CGL031
     C           @@RTRN    OREQ 'TAXAB'                                                       CGL031
     C           KJANO     READESDJACCLB                 60                                   CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If @@RTRN = Last, end loop                                                           CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'LAST'                                                        CGL031
     C                     MOVE *ON       *IN60                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C           ENDMTX    ENDSR                                                              CGL031
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  W01    - Subroutine to Write an Account Key.                 *
      *                                                               *
      *****************************************************************
      *
     C           W01       BEGSR                           **   W01  **
     C*
     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
     C*
     C           EVAM      CABEQ0         ENDW01
     C*
     C* COUNT RECORDS WRITTEN AND USE STD HASH SUBROUTINE
     C*
     C                     ADD  1         W01CNT  50
     C*
     C**  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
     C*   ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
     C*
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDEVAM      ZZAMT
     C                     EXSR ZHASH
     C*
     C* BUILD OUTPUT RECORD
     C*
     C                     MOVE SITP      WACITY
     C                     MOVE ' '       WACTRT
     C                     MOVE *BLANKS   WARCTR                                              CGL031
     C*
     C** ACCESS CLINT FOR DISCRT IND FOR PORTFOLIO FLAG IN KEY
     C*
     C************         Z-ADDCSCN      WCLNTK                          074380
     C**********           Z-ADDCSCN      WCLNTK                                       111923 CSD027
     C                     MOVE CSCN      WCLNTK                                              CSD027
     C*
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WPORTP    IFEQ 'Y'                                       S01486
     C***********          Z-ADDQACNUM    WCLNTK                   S01486 189942
     C**********           Z-ADDCDCN      WCLNTK                                       189942 CSD027
     C                     MOVE CDCN      WCLNTK                                              CSD027
     C                     ELSE                                           074380
     C                     MOVE CSCN      WCLNTK                          074380
     C                     END                                            074380
     C*                                                                   081336
     C** OBTAIN BRANCH CODE OF CUSTOMER FROM CLINTCB                      081336
     C                     MOVE 'A'       WLIT1                           081336
     C                     EXSR CLNTIN                                    081336
     C                     MOVE '1'       WLIT1                           081336
     C                     MOVE BRCB      CSBA                            081336
     C***********          END                                      S01486074380
     C                     END                                            S01486
     C                     EXSR CLNTIN
     C           C1DI      IFEQ 'M'
     C                     MOVE *BLANKS   WACPFI
     C                     ELSE
     C                     MOVE C1DI      WACPFI
     C                     END
     C*
     C                     MOVE '  '      WACBKC
     C                     MOVE '  '      WACTST
     C                     MOVE '  '      WACPSB
     C                     MOVE '  '      WACCCC
     C***********          MOVE 'S'       WACMKT                          131379
     C                     MOVE MKTI      WACMKT                          131379
     C           CIAK      IFEQ 'Y'
     C           SCVI      ANDEQ'Y'                                       E14522
     C                     MOVE SCVI      WACCON
     C                     ELSE
     C                     MOVE ' '       WACCON
     C                     END
     C           WACAMC    IFEQ 'FP'                                      E16085
     C           WACAMC    OREQ 'FR'                                      E16085
     C           WACAMC    OREQ 'CP'                                      E16085
     C           WACAMC    OREQ 'CR'                                      E16085
     C                     MOVE *BLANKS   WACBKC                          E16085
     C                     END                                            E16085
     C                     MOVE WACKEY    ACKY
     C                     MOVE 'D'       RECI
     C*                                                                   S01509
     C** If S01509 is active, event currency could be equal to value ccy, S01509
     C** redemption ccy or nominal ccy depending on the event type        S01509
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C                     SELEC                                          S01509
     C           SAAT      WHEQ 'DV'                                      S01509
     C           SAAT      OREQ 'CP'                                      S01509
     C                     MOVE VLCY      EVCY                            S01509
     C           SAAT      WHEQ 'MA'                                      S01509
     C           *IN78     ANDEQ'0'                                       S01509
     C           SDCX      ANDNE*BLANKS                                   S01509
     C                     MOVE SDCX      EVCY                            S01509
     C                     OTHER                                          S01509
     C                     MOVE NMCY      EVCY                            S01509
     C                     ENDSL                                          S01509
     C*                                                                   S01509
     C                     ELSE                                           S01509
     C                     MOVE NMCY      EVCY
     C                     ENDIF                                          S01509
     C*                                                                   S01509
     C***        AUMO      IFEQ 'Y'                                 103361074380
     C***        PPRE      ANDEQ'R'                                 103361074380
     C           PPRE      IFEQ 'R'                                       074380
     C           SRSM      ANDEQ04                                        103361
     C***        AUMO      OREQ 'Y'                                 103361074380
     C***        PPRE      ANDEQ'P'                                 103361074380
     C           PPRE      OREQ 'P'                                       074380
     C           SPSM      ANDEQ04                                        103361
     C                     ELSE                                           103361
     C                     MOVE *BLANK    STLA
     C                     END                                            103361
     C*                                                                   103361
     C           WSRECI    IFEQ 'R'
     C                     MOVE '1'       RVRS
     C                     ELSE
     C                     MOVE '0'       RVRS
     C                     END
     C                     MOVE CSSC      SESH
     C           BGPFMG    IFEQ 'Y'                                                         AR877365
     C           BGN4ST    OREQ 'Y'                                                         AR877365
     C                     MOVE CDSN      SESH                                              AR877365
     C                     ENDIF                                                            AR877365
     C                     Z-ADD0         TRFR
     C**********           MOVELCSCN      CSTN                            102708
     C                     MOVELWCLNTK    CSTN                            102708
     C***********          MOVE CSBR      BRCH                            S01117
     C                     MOVE CSBA      BRHA                            S01117
     C           BGPFMG    IFEQ 'Y'                                                         AR877365
     C           BGN4ST    OREQ 'Y'                                                         AR877365
     C                     MOVE CDPA      BRHA                                              AR877365
     C                     ENDIF                                                            AR877365
     C**********           Z-ADD01        ASQN                            E18803
     C                     Z-ADD00        ASQN                            E18803
     C                     Z-ADDSAED      EVDT
     C                     Z-ADD0         KNCA
     C                     Z-ADD0         KBCA
     C***********          Z-ADD0         KCUST                           E19975
     C*                                                                   103361
     C***        AUMO      IFEQ 'Y'                                 103361074380
     C***        PPRE      ANDEQ'R'                                 103361074380
     C           PPRE      IFEQ 'R'                                       074380
     C           SRSM      ANDEQ04                                        103361
     C***        AUMO      OREQ 'Y'                                 103361074380
     C***        PPRE      ANDEQ'P'                                 103361074380
     C           PPRE      OREQ 'P'                                       074380
     C           SPSM      ANDEQ04                                        103361
     C                     ELSE                                           103361
     C                     Z-ADD0         STLT
     C                     END                                            103361
     C*                                                                   103361
     C***********          MOVE '   '     KCCY                            E15549
     C                     MOVE NMCY      KCCY                            E15549
     C*                                                                   S01117
     C* Output profit centre from related customer position               S01117
     C*                                                                   S01117
     C**    If Analytical Accounting is installed and customer            CAC002
     C**    position profit centre is blank, set the profit centre to     CAC002
     C**    SE ICD default profit centre.                                 CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           PCCU      ANDEQ*BLANKS                                   CAC002
     C                     MOVE BVSEPC    PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE PCCU      PRFC                            S01117
     C                     ENDIF                                          CAC002
     C*                                                                   S01486
     C** SET UP PORTFOLIO REFERENCE TO BE OUTPUT                          S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE PTFR      SSPTFR  4                       S01486
     C           WPORTP    IFNE 'Y'                                       S01486
     C                     MOVE *BLANKS   PTFR                            S01486
     C                     END                                            S01486
     C                     END                                            S01486
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
      *                                                                                       CGL020
     C           STLA      IFEQ *BLANKS                                                       CGL020
     C                     MOVE *BLANKS   F1RACT                                              CGL020
     C                     MOVE *BLANKS   F1RCTY                                              CGL020
     C                     MOVE *BLANKS   F1RBNK                                              CGL020
     C                     MOVE *BLANKS   F1RCDE                                              CGL020
     C                     MOVE *BLANKS   F1PACT                                              CGL020
     C                     MOVE *BLANKS   F1PCTY                                              CGL020
     C                     MOVE *BLANKS   F1PBNK                                              CGL020
     C                     MOVE *BLANKS   F1PCDE                                              CGL020
     C                     MOVE *BLANKS   F1DACT                                              CGL020
     C                     MOVE *BLANKS   F1DCTY                                              CGL020
     C                     MOVE *BLANKS   F1DBNK                                              CGL020
     C                     Z-ADD*ZEROS    F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE WWRACT    F1RACT                                              CGL020
     C                     MOVE WWRCTY    F1RCTY                                              CGL020
     C                     MOVE WWRBNK    F1RBNK                                              CGL020
     C                     MOVE WWRCDE    F1RCDE                                              CGL020
     C                     MOVE WWPACT    F1PACT                                              CGL020
     C                     MOVE WWPCTY    F1PCTY                                              CGL020
     C                     MOVE WWPBNK    F1PBNK                                              CGL020
     C                     MOVE WWPCDE    F1PCDE                                              CGL020
     C                     MOVE WWDACT    F1DACT                                              CGL020
     C                     MOVE WWDCTY    F1DCTY                                              CGL020
     C                     MOVE WWDBNK    F1DBNK                                              CGL020
     C                     Z-ADDWWSDAT    F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   F1TICK                                              CGL020
     C                     MOVE *BLANKS   F1EXCH                                              CGL020
     C                     Z-ADD*ZEROS    F1NOML                                              CGL020
     C                     ENDIF                                                              CGL020
     C*
     C* WRITE GENERATED ACCOUNT KEY RECORD
     C*
     C                     WRITESEKEYDF
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE SSPTFR    PTFR                            S01486
     C                     END                                            S01486
     C*
     C           ENDW01    ENDSR                           ** ENDW01 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  W02    - Subroutine to Write a Position Settlement.          *
      *                                                               *
      *****************************************************************
      *
     C           W02       BEGSR                           **   W02  **
     C/COPY WNCPYSRC,SE2400C056
     C*
     C** DO NOT OUPUT RECORDS IF AMOUNT DUE IS ZERO
     C*
     C********** PAMD      CABEQ0         ENDW02                          S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PAMD      IFEQ 0                                         S01486
     C           PEVT      ANDNE'MT'                                      S01486
     C                     GOTO ENDW02                                    S01486
     C                     END                                            S01486
     C                     ELSE                                           S01486
     C           PAMD      IFEQ 0                                         S01486
     C                     GOTO ENDW02                                    S01486
     C                     END                                            S01486
     C                     END                                            S01486
      *                                                                                       260331
     C           WSRECI    IFEQ 'R'                                                           260331
     C           PPRE      IFEQ 'R'                                                           260331
     C                     MOVEL'P'       PPRE                                                260331
     C                     ELSE                                                               260331
     C           PPRE      IFEQ 'P'                                                           260331
     C                     MOVEL'R'       PPRE                                                260331
     C                     ENDIF                                                              260331
     C                     ENDIF                                                              260331
     C                     ENDIF                                                              260331
      *                                                                                       260331
     C/COPY WNCPYSRC,SE2400C057
     C*
     C* COUNT RECORDS WRITTEN
     C*
     C***********          ADD  1         W02CNT  50                      046500
     C*
     C                     MOVE 'D'       RECI
     C***********          MOVE 'S'       PMAR                            162208
     C                     MOVE MKTI      PMAR                            162208
     C***********          MOVE CSBR      PBCH                            S01117
     C***********          MOVE CSBA      PBCH                      S01117E33032
     C                     MOVE CSBA      PBCA                            E33032
     C                     MOVE CSSC      PSSH
     C                     MOVELCSCN      PCPY             ??10A/6N
     C*                                                                   CSE023
     C** Set up of field CTYP moved to before call to SE2310 to           187805
     C** avoid corruption when CLINTCB is read.                           187805
     C***********          MOVE 'C'       CTYP                     CSE023 187805
     C                     Z-ADD0         BAUS                            CSE023
     C                     Z-ADD0         MAMT                            CSE023
     C                     Z-ADD0         DAMT                            CSE023
     C                     Z-ADD0         PSEQ                            CSE023
     C                     Z-ADD0         SABC                            CSE023
     C           WPORTP    IFEQ 'Y'                                       081336
     C           BGPFMG    ANDEQ'Y'                                       081336
     C           WPORTP    OREQ 'Y'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C***********          MOVE QATDSS    PSSH                     081336 189942
     C***********          MOVE QACNUM    PCPY                     081336 189942
     C***********          Z-ADDQACNUM    WCLNTK                   S01486 189942
     C                     MOVE CDSN      PSSH                            189942
     C                     MOVE CDCN      PCPY                            189942
     C**********           Z-ADDCDCN      WCLNTK                                       189942 CSD027
     C                     MOVE CDCN      WCLNTK                                              CSD027
     C***********                                                  081336 189942
     C***OBTAIN*BRANCH CODE OF CUSTOMER FROM CLINTCB               081336 189942
     C***********          MOVE 'A'       WLIT1                    081336 189942
     C***********          EXSR CLNTIN                             081336 189942
     C***********          MOVE BRCB      PBCA                     081336 189942
     C*                                                                   189942
     C** SETUP BRANCH CODE FROM CDEPPD                                    189942
     C                     MOVE CDPA      PBCA                            189942
     C                     END                                            081336
     C*                                                                   S01512
     C** If S01512 is active, the payment value date for dividends must   S01512
     C** be the value date entered in the diary                           S01512
     C*                                                                   S01512
     C           SAAT      IFEQ 'MP'
     C           SAAT      OREQ 'DV'
     C           S01512    ANDNE'Y'                                       088423
     C                     Z-ADDSAOD      PDUD
     C                     ELSE
     C                     Z-ADDSAED      PDUD
     C                     END
     C/COPY WNCPYSRC,SE2400C016
     C*                                                                   S01512
     C** Value date - initially defaulted to PDUD.                        S01512
     C** If S01512 is active, value date should be the date of the next   S01512
     C** working day after value date in value currency.  For dividends   S01512
     C** payment value date must be the value date entered in the diary   S01512
     C*                                                                   S01512
     C***********S01512    IFEQ 'Y'                                 S01512105035
     C***********SAAT      IFEQ 'DV'                                088423105035
     C***********SAOD      SUB  1         ZDAYNO                    088423105035
     C***********          ELSE                                     088423105035
     C***********PDUD      SUB  1         ZDAYNO                    S01512105035
     C***********          ENDIF                                    088423105035
     C***********          Z-ADD1         ZNRDYS                    S01512105035
     C***********          MOVE PNCY      ZCCY                      S01512105035
     C***********          EXSR ZFWDT                               S01512105035
     C***********          Z-ADDZDYNBR    PSVL                      S01512105035
     C***********          ELSE                                     S01512105035
     C***********SAAT      IFEQ 'DV'                                088423105035
     C***********          Z-ADDSAOD      PSVL                      088423105035
     C***********          ELSE                                     088423105035
     C************         Z-ADDPDUD      PSVL                      S01512105035
     C************         ENDIF                                    088423105035
     C************         END                                      S01512105035
     C*                                                                   S01512
     C           APNS      IFEQ 'Y'
     C                     MOVE 'Y'       PAUI
     C                     MOVE 'Y'       PSMI                            S01401
     C                     ELSE
     C                     MOVE ' '       PAUI
     C                     END
     C           BGPFMG    IFEQ 'Y'                                       081336
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           SAAT      IFEQ 'PP'                                      081336
     C           SAAT      OREQ 'MP'                                      081336
     C           SAAT      OREQ 'MA'                                      081336
     C                     MOVE NMCY      PNCY                            081336
     C                     ELSE                                           081336
     C                     MOVE VLCY      PNCY                            081336
     C                     END                                            081336
     C                     ELSE                                           081336
     C                     MOVE NMCY      PNCY
     C                     END                                            081336
     C*                                                                   S01509
     C** If S01509 is active, position currency could be equal to value   S01509
     C** ccy, redemption ccy or nominal ccy depending on the event type   S01509
     C*                                                                   S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C                     SELEC                                          S01509
     C           SAAT      WHEQ 'DV'                                      S01509
     C           SAAT      OREQ 'CP'                                      S01509
     C                     MOVE VLCY      PNCY                            S01509
     C           SAAT      WHEQ 'MA'                                      S01509
     C           *IN78     ANDEQ'0'                                       S01509
     C           SDCX      ANDNE*BLANKS                                   S01509
     C                     MOVE SDCX      PNCY                            S01509
     C                     OTHER                                          S01509
     C                     MOVE NMCY      PNCY                            S01509
     C                     ENDSL                                          S01509
     C*                                                                   S01509
     C                     ELSE                                           S01509
     C                     MOVE NMCY      PNCY
     C                     ENDIF                                          S01509
     C**
     C** Value date - initially defaulted to PDUD.                        105035
     C** If S01512 is active, value date should be the date of the next   105035
     C** working day after value date in value currency.  For dividends   105035
     C** payment value date must be the value date entered in the diary   105035
     C*                                                                   105035
     C           S01512    IFEQ 'Y'                                       105035
     C           SAAT      IFEQ 'DV'                                      105035
     C           SAOD      SUB  1         ZDAYNO                          105035
     C                     ELSE                                           105035
     C           PDUD      SUB  1         ZDAYNO                          105035
     C                     ENDIF                                          105035
     C                     Z-ADD1         ZNRDYS                          105035
     C                     MOVE PNCY      ZCCY                            105035
     C                     EXSR ZFWDT                                     105035
     C                     Z-ADDZDYNBR    PSVL                            105035
     C                     ELSE                                           105035
     C           SAAT      IFEQ 'DV'                                      105035
     C                     Z-ADDSAOD      PSVL                            105035
     C                     ELSE                                           105035
     C                     Z-ADDPDUD      PSVL                            105035
     C                     ENDIF                                          105035
     C                     END                                            105035
     C*                                                                   S01509
     C**********           MOVE DMKB      PBCD                            E14718
     C                     MOVE DPFB      PBCD                            E14718
     C                     MOVE '0'       PYCUSD  1
      *                                                                   E23169
      ** Payment currency and settlement exchange rate are held on        E23169
      ** SECTYD for straight, dual- and multi-currency securities.        E23169
      ** Exchange rate=1 for straight securities.                         E23169
     C** If S01509 is active, settle = pos currency, exchange rate is     S01509
     C** 1 with mult/div indicator as 'M'                                 S01509
      *                                                                   E23169
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE PNCY      PSCU                            S01509
     C                     Z-ADD1         PSXR                            S01509
     C                     MOVE 'M'       PMDI                            S01509
     C                     ELSE                                           S01509
     C                     MOVE SPYC      PSCU                            E23169
     C                     Z-ADDSEXR      PSXR                            E23169
     C                     MOVE SMDI      PMDI                            E23169
     C                     END                                            S01509
      *                                                                   E23169
     C***********VLCY      IFNE '   '                                     E23169
     C*********************MOVE VLCY      PSCU                            E23169
     C*********************ELSE                                           E23169
     C***********SPYC      IFNE '   '                                     E23169
     C*                                                                   E23169
     C***IF*PAYMENT*CURRENCY*USED*SET*FLAG*PYCUSD*TO*1*-*CHECK*BELOW***** E23169
     C*                                                                   E23169
     C*********************MOVE '1'       PYCUSD                          E23169
     C*********************MOVE SPYC      PSCU                            E23169
     C*********************ELSE                                           E23169
     C*********************MOVE NMCY      PSCU                            E23169
     C*********************END                                            E23169
     C*********************END                                            E23169
     C*                                                                   E23169
     C***CALCULATE*SETTLEMENT*EXCHANGE*RATE*-*CHECK*FLAG*PYCUSD********** E23169
     C*                                                                   E23169
     C***********PYCUSD    IFEQ '1'                                       E23169
     C*********************Z-ADDSEXR      PSXR                            E23169
     C*********************MOVE SMDI      PMDI                            E23169
     C*********************ELSE                                           E23169
     C*                                                                   E23169
     C**GET*SPOT*RATE*FOR*EACH*OF*SETT.*CCY*AND*NOM*CCY*FROM*TABTG10*     E23169
     C**THEN*CALCULATE*CROSS*RATE*USING*ZXRATE*************************** E23169
     C*                                                                   E23169
     C*********************MOVE PSCU      WCURR                           E23169
     C*********************EXSR TG10                                      E23169
     C*********************Z-ADDSPOT      ZRATE1 138                      E23169
     C*********************MOVE MDIN      ZMDI1   1                       E23169
     C*********************MOVE PNCY      WCURR                           E23169
     C*********************EXSR TG10                                      E23169
     C*********************Z-ADDSPOT      ZRATE2 138                      E23169
     C*********************MOVE MDIN      ZMDI2   1                       E23169
     C*********************EXSR ZXRATE                                    E23169
     C*********************Z-ADDZRATEX    PSXR                            E23169
     C*                                                                   E23169
     C***MULTIPLY/DIVIDE*IND*ON*TABTG10*IS*0=DIV*1=MULT****************** E23169
     C*                                                                   E23169
     C***********ZMDIX     IFEQ '0'                                       E23169
     C*********************MOVEL'D'       PMDI                            E23169
     C*********************ELSE                                           E23169
     C*********************MOVEL'M'       PMDI                            E23169
     C*********************END                                            E23169
     C*********************END                                            E23169
     C/COPY WNCPYSRC,SE2400C017
     C*
     C** BASIC CURR EXCHANGE RATE IS SPOT RATE FOR SETTLEMENT CURRCY
     C*
     C                     MOVE PSCU      WCURR
     C                     EXSR TG10
     C                     Z-ADDSPOT      PBRX
     C/COPY WNCPYSRC,SE2400C018
     C*
     C** ACCESS STANDARD SETTLEMENT INSTRUCTIONS FILE
     C*
     C***********          MOVE PBCH      SBRH                            S01117
     C***********          MOVE PBCH      SBRA                      S01117E33032
     C                     MOVE PBCA      SBRA                            E33032
     C                     MOVELPCPY      CSTM
     C                     MOVE PSCU      CYSI
     C                     MOVE SITP      ITSI
     C                     MOVE *BLANK    PSEA
     C                     MOVE *BLANK    PSEB
     C                     MOVE *BLANK    PCPN
     C                     MOVE *BLANK    PFAC
     C                     MOVE *BLANK    PSPI
     C                     MOVE *ZEROS    PSMT                            048612
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVEL*BLANKS   WBKCD                                               CSE028
     C                     MOVELPTFR      WPTFR                                               CSE028
     C                     MOVELCSTM      WCUST2  6                                           CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP   1                                           CSE028
     C**********           PARM           SBRA                                         CSE028 CSE034
     C                     PARM SBRA      PSBRA   3                                           CSE034
     C                     PARM           WCUST2                                              CSE028
     C                     PARM           WBKCD                                               CSE028
     C**********           PARM           CYSI                                         CSE028 CSE034
     C                     PARM CYSI      PCYSI   3                                           CSE034
     C                     PARM SMCC      PMKTC   2                                           CSE034
     C**********           PARM           ITSI                                         CSE028 CSE034
     C                     PARM ITSI      PITSI   3                                           CSE034
     C                     PARM           WPTFR                                               CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD   5                                           CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     MOVE '0'       *IN77                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN77                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVEL*BLANKS   WBKCD                                               CSE028
     C                     MOVEL*BLANKS   WPTFR                                               CSE028
      *                                                                                       CSE028
     C                     MOVE PCPY      WCLNTK                          E16085
     C           CLINTK    CHAINCLINT                99                   E16085
     C           *IN99     IFEQ '0'                                       E16085
     C           C1DI      ANDNE'M'                                       E16085
     C                     MOVE *BLANK    ITSI                            E16085
     C                     END                                            E16085
     C/COPY WNCPYSRC,SE2400C038
     C           STDSKY    CHAINSTDSED               77
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE2400C055
     C           *IN77     IFNE '1'
     C           RECI      ANDNE'*'
      *                                                                   147514
     C                     MOVE *OFF      *IN88                           147514
      *                                                                   CEU005
      * CEU005 active and Settlement Ccy used on STDSED.                  CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           SCCY      ANDNE*BLANKS                                   CEU005
      *                                                                   CEU005
      * Access currencies file for EURO rate, EURO M/D indicator and      CEU005
      * Transition Date for 'In' Ccy.                                     CEU005
      * Settlement Currency is 'IN' ccy.                                  CEU005
      *                                                                   CEU005
     C           PSCU      IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM           @RTCD   7                       CEU005
     C                     PARM '*KEY   ' @OPTN   7                       CEU005
     C                     PARM SCCY      @AJCD   3                       CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
      * Database error                                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     Z-ADD44        DBASE            ************** CEU005
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 44* CEU005
     C                     MOVELSCCY      DBKEY            ************** CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CEU005
      * Due currency is 'IN' ccy.                                         CEU005
      *                                                                   CEU005
     C                     ELSE                                           CEU005
     C           SCCY      IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM           @RTCD   7                       CEU005
     C                     PARM '*KEY   ' @OPTN   7                       CEU005
     C                     PARM PSCU      @AJCD   3                       CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
      * Database error                                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     Z-ADD45        DBASE             ************* CEU005
     C                     MOVEL'SDCURRPD'DBFILE            * DB ERROR 45*CEU005
     C                     MOVELPSCU      DBKEY             **************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CEU005
      * Value date is later than Transition Start Date.                   CEU005
     C           PSVL      IFGE A6TPSD                                    CEU005
     C           A6INCY    ANDEQ'Y'                                       143690
     C                     Z-ADDA6EUER    PSXR                            CEU005
      *                                                                   CEU005
      **Settlement*ccy*is*Euro*currency,*reverse*M/D*indicator.    CEU005 143690
     C** Nominal ccy is Euro currency, reverse M/D indicator.             143690
     C***********SCCY      IFEQ BKEURO                             CEU005 143690
     C           PSCU      IFEQ BKEURO                                    143690
     C           A6EUMD    IFEQ 'M'                                       CEU005
     C                     MOVE 'D'       PMDI                            CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'M'       PMDI                            CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CEU005
      **Settlement*ccy*not*Euro*ccy,*use*Euro*M/D*indicator.       CEU005 143690
     C** Settlement ccy is Euro ccy, use Euro M/D indicator.              143690
     C                     ELSE                                           CEU005
     C                     MOVE A6EUMD    PMDI                            CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CEU005
      * Use standard settlement ccy for position settlement ccy           CEU005
     C                     MOVE SCCY      PSCU                            CEU005
      *                                                                   194195
     C                     MOVE PSCU      WCURR                           194195
     C                     EXSR TG10                                      194195
     C                     Z-ADDSPOT      PBRX                            194195
      * Chain STDSED again.                                               CEU005
     C                     MOVE SCCY      CYSI                            CEU005
     C***********STDSKY    CHAINSTDSED               78            CEU005 147514
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP   1                                           CSE028
     C**********           PARM           SBRA                                         CSE028 CSE034
     C                     PARM SBRA      PSBRA                                               CSE034
     C                     PARM           WCUST2                                              CSE028
     C                     PARM           WBKCD                                               CSE028
     C**********           PARM           CYSI                                         CSE028 CSE034
     C                     PARM CYSI      PCYSI                                               CSE034
     C                     PARM SMCC      PMKTC                                               CSE034
     C**********           PARM           ITSI                                         CSE028 CSE034
     C                     PARM ITSI      PITSI                                               CSE034
     C                     PARM           WPTFR                                               CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD                                               CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     MOVE '0'       *IN88                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN88                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           STDSKY    CHAINSTDSED               88                   147514
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE2400C064
     C*****                ENDIF                                   CEU005 147869
     C*****                ENDIF                                   CEU005 147869
     C                     ENDIF                                          175400
     C                     ENDIF                                          175400
      *                                                                   CEU005
      * If no record found ensure fields from last chain not loaded       CEU005
      * to output fields.                                                 CEU005
     C************IN78     IFEQ '1'                                CEU005 147514
     C           *IN88     IFEQ *ON                                       147514
     C           CEU005    ANDEQ'Y'                                       175400
     C                     MOVE *BLANKS   PSMT                            CEU005
     C                     MOVE *BLANKS   PSEA                            CEU005
     C                     MOVE *BLANKS   PSEB                            CEU005
     C                     MOVE *BLANKS   PCPN                            CEU005
     C                     MOVE *BLANKS   PFAC                            CEU005
     C                     MOVE *BLANKS   PSPI                            CEU005
     C                     MOVE *BLANKS   STLA                            CEU005
     C                     Z-ADD0         STLT                            CEU005
     C                     MOVE *BLANKS   PRCNUM                          CEU005
     C                     MOVE *BLANKS   PRACOD                          CEU005
     C                     MOVE *BLANKS   PRACSQ                          CEU005
     C                     MOVE *BLANKS   PPFC                            CEU005
     C***********          ENDIF                                    147869175400
     C***********          ENDIF                                    147869175400
     C                     ELSE                                           CEU005
     C*
     C** USE RECEIVE FIELDS IF PAY/RECEIVE IND IS SET TO P
     C*
     C           PPRE      IFEQ 'P'
     C                     MOVE SPSM      PSMT
     C                     MOVE SPAT      PSEA
     C***********          MOVE SPBR      PSEB                            S01117
     C                     MOVE SPBA      PSEB                            S01117
     C                     MOVE SPCB      PCPN
     C                     MOVE SPFA      PFAC
     C                     MOVE SPSI      PSPI
      *                                                                   103361
     C                     MOVE SPAT      STLA                            103361
     C                     Z-ADDSPSM      STLT                            103361
      *                                                                   103361
      ** If settlement method is '04' and settlement account is blank,    103361
      ** retrieve prime account number                                    103361
      *                                                                   103361
     C           STLT      IFEQ 04                                        103361
     C           STLA      ANDEQ*BLANKS                                   103361
      *                                                                   103361
      * Retrieve prime account                                            103361
      *                                                                   103361
     C                     MOVE CSTM      PRCNUM                          103361
     C                     MOVE BMACCD    PRACOD                          103361
     C                     MOVE '01'      PRACSQ                          103361
      *                                                                   136297
      ** Check if account exists else use suspense account                136297
      *                                                                   136297
     C                     MOVE PRCNUM    KYCNUM                          136297
     C                     MOVE PSCU      KYCCY                           136297
     C                     MOVE PRACOD    KYACOD                          136297
     C                     MOVE PRACSQ    KYACSQ                          136297
     C                     MOVE PSEB      KYBRCA                          136297
     C           KEYACC    CHAINACCOUNTF             20                   136297
     C           *IN20     IFEQ '1'                                       136297
     C           RECI      OREQ '*'                                       136297
     C           1         CHAINTABTB20              21                   136297
     C           *IN21     IFEQ '0'                                       136297
     C                     MOVE COMS      PRACOD                          136297
     C                     ENDIF                                          136297
     C           PSEB      CHAINSDBRCHL0             22                   136297
     C           *IN22     IFEQ '0'                                       136297
     C                     MOVE A8BICN    PRCNUM                          136297
     C                     ENDIF                                          136297
     C                     ENDIF                                          136297
      *                                                                   103361
     C                     MOVE PRACCT    STLA                            103361
     C                     MOVE PRACCT    PSEA                            103361
     C                     END                                            103361
      *                                                                   103361
     C                     ELSE
     C*
     C** USE PAY FIELDS IF PAY/RECEIVE IND IS SET TO R
     C*
     C           PPRE      IFEQ 'R'
     C                     MOVE SRSM      PSMT
     C                     MOVE SRAC      PSEA
     C***********          MOVE SRBR      PSEB                            S01117
     C                     MOVE SRAB      PSEB                            S01117
     C                     MOVE SRCB      PCPN
     C                     MOVE *BLANK    PFAC
     C                     MOVE *BLANK    PSPI
      *                                                                   103361
     C                     MOVE SRAC      STLA                            103361
     C                     Z-ADDSRSM      STLT                            103361
      *                                                                   103361
      ** If settlement method is '04' and settlement account is blank,    103361
      ** retrieve prime account number                                    103361
      *                                                                   103361
     C           STLT      IFEQ 04                                        103361
     C           STLA      ANDEQ*BLANKS                                   103361
      *                                                                   103361
      * Retrieve prime account                                            103361
      *                                                                   103361
     C                     MOVE CSTM      PRCNUM                          103361
     C                     MOVE BMACCD    PRACOD                          103361
     C                     MOVE '01'      PRACSQ                          103361
      *                                                                   136297
      ** Check if account exists else use suspense account                136297
      *                                                                   136297
     C                     MOVE PRCNUM    KYCNUM                          136297
     C                     MOVE PSCU      KYCCY                           136297
     C                     MOVE PRACOD    KYACOD                          136297
     C                     MOVE PRACSQ    KYACSQ                          136297
     C                     MOVE PSEB      KYBRCA                          136297
     C           KEYACC    CHAINACCOUNTF             20                   136297
     C           *IN20     IFEQ '1'                                       136297
     C           RECI      OREQ '*'                                       136297
     C           1         CHAINTABTB20              21                   136297
     C           *IN21     IFEQ '0'                                       136297
     C                     MOVE COMS      PRACOD                          136297
     C                     ENDIF                                          136297
     C           PSEB      CHAINSDBRCHL0             22                   136297
     C           *IN22     IFEQ '0'                                       136297
     C                     MOVE A8BICN    PRCNUM                          136297
     C                     ENDIF                                          136297
     C                     ENDIF                                          136297
      *                                                                   103361
     C                     MOVE PRACCT    STLA                            103361
     C                     MOVE PRACCT    PSEA                            103361
     C                     END                                            103361
      *                                                                   103361
     C                     END
     C                     END
     C                     END                                            CEU005
     C*                                                                                     AR877352
     C           S01496    IFEQ 'Y'                                                         AR877352
     C           BVACOP    ANDEQ'Y'                                                         AR877352
     C                     MOVELPCPY      @CUST                                             AR877352
     C                     CALL 'AOSECSR0'                                                  AR877352
     C                     PARM *BLANKS   @RTCD                                             AR877352
     C                     PARM '*KEY   ' @OPTN                                             AR877352
     C                     PARM           @CUST                                             AR877352
     C           SECSPD    PARM SECSPD    DSSDY                                             AR877352
      *                                                                                     AR877352
     C           @RTCD     IFNE *BLANKS                                                     AR877352
     C           *LOCK     IN   LDA                                                         AR877352
     C                     MOVEL'SDSECSL0'DBFILE                                            AR877352
     C                     MOVEL@CUST     DBKEY                                             AR877352
     C                     Z-ADD46        DBASE                                             AR877352
     C                     SETON                       U7U8                                 AR877352
     C                     EXSR *PSSR                                                       AR877352
     C                     GOTO EAUDIT                                                      AR877352
     C                     ENDIF                                                            AR877352
     C                     ENDIF                                                            AR877352
      *                                                                   093817
      * OTHERWISE CHECK FOR ACCOUNT IN CUSTOMER CURRENCY                  093817
     C                     ELSE                                           093817
     C**********           Z-ADDPCPY      WCLNTK                                       093817 CSD027
     C                     MOVE PCPY      WCLNTK                                              CSD027
     C                     MOVE '1'       WLIT1                           093817
     C                     EXSR CLNTIN                                    093817
      * PERFORM P07 TO SET UP SETTLEMENT DETAILS                          093817
     C                     EXSR P07                                       093817
      *                                                                   093817
     C/COPY WNCPYSRC,SE2400C039
     C                     END
     C*                                                                   084669
     C           PSEB      IFEQ *BLANKS                                   084669
     C                     MOVE PBCA      PSEB                            084669
     C                     END                                            084669
     C/COPY WNCPYSRC,SE2400C065
     C*                                                                   S01117
     C* Output profit centre from related customer position               S01117
     C*                                                                   S01117
     C**    If Analytical Accounting is installed and customer            CAC002
     C**    position profit centre is blank, set the profit centre to     CAC002
     C**    SE ICD default profit centre.                                 CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           PCCU      ANDEQ*BLANKS                                   CAC002
     C                     MOVE BVSEPC    PPFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE PCCU      PPFC                            S01117
     C                     ENDIF                                          CAC002
     C*
     C                     Z-ADDRUND      PDTG
      *                                                                                       CGL020
      ** If Settlement Account is not blank                                                   CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C           PSEA      ANDNE*BLANKS                                                       CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   PINTG                                               CGL020
     C                     MOVE *BLANKS   PINTGA                                              CGL020
     C                     MOVE *BLANKS   PINST                                               CGL020
     C                     MOVE *BLANKS   PINSTA                                              CGL020
     C                     MOVE *BLANKS   PBENM                                               CGL020
     C                     MOVE *BLANKS   PBENMA                                              CGL020
      *                                                                                       CGL020
     C                     CALL ZAAMLP                                                        CGL020
     C                     PARM           PINTG  10                                           CGL020
     C                     PARM           PINTGA 35                                           CGL020
     C                     PARM           PINST  10                                           CGL020
     C                     PARM           PINSTA 35                                           CGL020
     C                     PARM           PBENM  10                                           CGL020
     C                     PARM           PBENMA 35                                           CGL020
     C                     PARM           PDEBT  10                                           CSW210
     C                     PARM           PDEBTA 35                                           CSW210
     C                     PARM           PCPY                                                CGL020
     C                     PARM           PFAC                                                CGL020
     C                     PARM           PSEA                                                CGL020
     C                     PARM           PSEB                                                CGL020
     C                     PARM           PSCU                                                CGL020
     C                     PARM           WWRACT 20                                           CGL020
     C                     PARM           WWRCTY  2                                           CGL020
     C                     PARM           WWRBNK 20                                           CGL020
     C                     PARM           WWRCDE 11                                           CGL020
     C                     PARM           WWPACT 20                                           CGL020
     C                     PARM           WWPCTY  2                                           CGL020
     C                     PARM           WWPBNK 20                                           CGL020
     C                     PARM           WWPCDE 11                                           CGL020
     C                     PARM           WWDACT 35                                           CGL020
     C                     PARM           WWDCTY  2                                           CGL020
     C                     PARM           WWDBNK 20                                           CGL020
      *                                                                                       CGL020
     C                     MOVE PDUD      WWSDAT  50                                          CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
     C*
      *** If S01447 installed, and settlement type = Dividend or Coupon   S01447
      *** and a security WHT record  for the security exists, and         S01447
      *** settlement is a payment, calculate tax amounts.                 S01447
      *                                                                   S01447
     C           S01447    IFEQ 'N'                                       S01447
     C           *IN80     OREQ '1'                                       S01447
     C           PPRE      OREQ 'R'                                       S01447
     C           SAAT      ORNE 'DV'                                      S01447
     C           SAAT      ANDNE'CP'                                      S01447
     C/COPY WNCPYSRC,SE2400C035
     C                     CLEARTASO                                      S01447
     C                     CLEARTASR                                      S01447
     C                     CLEARTAUS                                      S01447
     C                     ELSE                                           S01447
     C/COPY WNCPYSRC,SE2400C062
     C                     EXSR CALCTX                                    S01447
     C/COPY WNCPYSRC,SE2400C063
     C                     END                                            S01447
      *                                                                   S01447
     C* ZEROISE NUMERIC FIELDS WITH NO SPECIFIED VALUE
     C*
     C                     Z-ADD0         PCHA
     C/COPY WNCPYSRC,SE2400C019
     C                     Z-ADD0         PCAM
     C/COPY WNCPYSRC,SE2400C020
     C                     MOVE *BLANKS   PCHC                            S01519
     C                     MOVE *BLANKS   PCCD                            S01519
     C                     Z-ADD0         PSAT
     C***********          Z-ADD0         LCD                             066777
     C                     Z-ADDRUND      LCD                             066777
     C                     Z-ADD0         TNLU
     C***********          MOVE ' '       CHTP                            E18221
     C                     MOVE 'I'       CHTP                            E18221
     C/COPY WNCPYSRC,SE2400C021
     C                     MOVE 'D'       RECI                            103017
     C*                                                                   S01519
     C** If S01519 is active AND autocharge option is Y, calculate        S01519
     C** the default charge/commission amount and settlement amount       S01519
     C*                                                                   S01519
     C           S01519    IFEQ 'Y'                                       S01519
     C           BVACOP    ANDEQ'Y'                                       S01519
     C                     EXSR P04                                       S01519
     C           WSRECI    IFEQ 'R'                                                           260331
     C                     Z-SUBPCHA      PCHA                                                260331
     C                     Z-SUBPCAM      PCAM                                                260331
     C                     ENDIF                                                              260331
     C***********          EXSR P06                                S01519 094229
     C                     END                                            S01519
     C           CER049    IFEQ 'Y'                                                         AR853119
     C                     EXSR SRPOST                                                      AR853119
     C                     ENDIF                                                            AR853119
     C/COPY WNCPYSRC,SE2400C026
     C                     EXSR P06                                       094229
     C/COPY WNCPYSRC,SE2400C027
     C*
     C* WRITE POSITION SETTLMENT RECORD
     C*
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C/COPY WNCPYSRC,SE2400C024
     C                     Z-ADDTNLU      PTNLU   50                      S01486
     C                     EXSR ZTNLU1                                    S01486
     C                     MOVELNATN      TNLU                            S01486
     C                     MOVE 'I'       CHTP                            S01486
     C*                                                                   S01486
     C** IF MATURITY POSITION SETTLEMENT FOR ZERO AMOUNT DUE FOR          S01486
     C** PORTFOLIO WITH PERFORMANCE SET ALL AMOUNT FIELDS TO ZERO         S01486
     C           PEVT      IFEQ 'MT'                       B1             S01486
     C           PAMD      ANDEQ0                                         S01486
     C*                                                                   S01486
     C           WPORTP    IFEQ 'Y'                        B2             S01486
     C***********QAPTFR    ANDNE'9997'                             S01486 189942
     C           PTFR      ANDNE'9997'                                    189942
     C           PNPSDT    ANDLTRUND                                      S01486
     C                     MOVE *BLANKS   PCHC                            S01486
     C                     MOVE *BLANKS   PCCD                            S01486
     C                     Z-ADD0         PCHA                            S01486
     C                     Z-ADD0         PCAM                            S01486
     C/COPY WNCPYSRC,SE2400C028
     C                     Z-ADD0         PSAT                            S01486
     C                     Z-ADD0         TASO                            S01486
     C                     Z-ADD0         TASR                            S01486
     C                     Z-ADD0         TAUS                            S01486
     C                     Z-ADD0         P3STAF                                            AR853119
     C                     Z-ADD0         T2TATC                                            AR853119
     C*                                                                   S01486
     C** ....OTHERWISE DO NOT OUTPUT POSITION SETTLEMENT RECORED          S01486
     C                     ELSE                            X2             S01486
     C                     GOTO ENDW02                                    S01486
     C                     END                             E2             S01486
     C                     END                             E1             S01486
     C                     END                                            S01486
      *                                                                   046500
     C                     Z-ADD0         FXMP                            CAC002
     C                     Z-ADD0         FXMR                            CAC002
     C                     Z-ADD0         MAMT                            CAC002
      *                                                                                      251950A
     C           PSEB      IFEQ *BLANKS                                                      251950A
     C                     MOVE PBCA      PSEB                                               251950A
     C                     END                                                               251950A
     C/COPY WNCPYSRC,SE2400C066
     C*                                                                   CAC002
      ** If CSE023 is not installed or if CSE023 is installed and         CSE023
      ** the events is not for Coupon, Dividend or Maturity then          CSE023
      ** use the normal processing.                                       CSE023
      *                                                                   CSE023
     C                     MOVE 'C'       CTYP                            187805
      *                                                                   187805
     C           CSE023    IFEQ 'N'                                       CSE023
      *                                                                   CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           PEVT      ANDNE'CP'                                      CSE023
     C           PEVT      ANDNE'MT'                                      CSE023
     C           PEVT      ANDNE'DV'                                      CSE023
     C*                                                                   CSE023
     C           CRTT      OREQ *BLANKS                                   CSE023
      *                                                                   CSE023
     C*                                                                   CAC002
     C                     ADD  1         W02CNT  50                      046500
     C                     WRITEPOSETDF
     C                     EXSR PSAUDT                                                      AR324886
      *                                                                                     AR853119
     C           CER049    IFEQ 'Y'                                                         AR853119
     C                     WRITEPOSETDD3                                                    AR853119
     C           P3TAX     IFEQ 'Y'                                                        AR864714B
     C                     WRITE@STMDP0                                                     AR853119
     C                     ENDIF                                                           AR864714B
     C                     ENDIF                                                            AR853119
      *                                                                   CSE023
     C                     ELSE                                           CSE023
      *                                                                   CSE023
      ** If Treaty Withholding Tax is installed, then set up fields       CSE023
      ** for SE2310.                                                      CSE023
      *                                                                   CSE023
      ** For Coupon Event, @DIVDT is the Last Coupon Date.                CSE023
      ** For Dividend Event, @DIVDT is equal to the dividend date.        CSE023
      *                                                                   CSE023
     C                     Z-ADD0         @DIVDT                          CSE023
     C                     MOVE ' '       @TVBAS                          CSE023
      *                                                                   CSE023
     C           PEVT      IFEQ 'CP'                                      CSE023
     C                     Z-ADDSALCCP    @DIVDT                          CSE023
     C                     END                                            CSE023
      *                                                                   CSE023
     C           PEVT      IFEQ 'DV'                                      CSE023
      *                                                                   CSE023
      ** If S01510 is active AND event type = DV, use ex-dividend date    CSE023
      *                                                                   CSE023
     C           S01510    IFEQ 'Y'                                       CSE023
     C           SAEXD     ADD  1         @DIVDT                          CSE023
     C                     ELSE                                           CSE023
     C                     Z-ADDSAED      @DIVDT                          CSE023
     C                     END                                            CSE023
      *                                                                   CSE023
      ** If CSE008 is ON then use value date position for dividend.       CSE023
      *                                                                   CSE023
     C           CSE008    IFEQ 'Y'                                       CSE023
     C                     MOVE 'V'       @TVBAS                          CSE023
     C                     ELSE                                           CSE023
     C                     MOVE 'T'       @TVBAS                          CSE023
     C                     END                                            CSE023
     C                     END                                            CSE023
      *                                                                   CSE023
     C                     CALL 'SE2310'                                  CSE023
     C                     PARM           PPOSET                          CSE023
     C                     PARM           @TVBAS  1                       CSE023
     C                     PARM           @DIVDT  50                      CSE023
     C                     PARM           @NREC   30                      CSE023
     C                     PARM           @ERR    1                       CSE023
      *                                                                   CSE023
     C           @ERR      IFEQ 'N'                                       CSE023
     C                     ADD  @NREC     W02CNT                          CSE023
     C                     ELSE                                           CSE023
     C           *LOCK     IN   LDA                                       187183
     C                     MOVE 'SE2310'  DBFILE           ***************CSE023
     C                     MOVEL'*CALL'   DBKEY            * DB ERROR 48 *CSE023
     C                     Z-ADD48        DBASE            ***************CSE023
     C                     SETON                     U7U8                 CSE023
     C                     EXSR *PSSR                                     CSE023
     C                     MOVE '1'       *INLR                           CSE023
     C                     END                                            CSE023
     C                     END                                            CSE023
      *                                                                   S01408
     C/COPY WNCPYSRC,SE2400CCP1                                           S01408
      *                                                                   S01408
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     Z-ADDPTNLU     TNLU                            S01486
     C                     END                                            S01486
     C*
     C           ENDW02    ENDSR                           ** ENDW02 **
      *
      *****************************************************************
     C/EJECT                                                              S01519
     C*****************************************************************   S01519
     C*                                                               *   S01519
     C*  P04   - SUBROUTINE TO CALCULATE CHARGE/COMMISSION AMOUNTS    *   S01519
     C*                                                               *   S01519
     C*****************************************************************   S01519
     C*                                                                   S01519
     C           P04       BEGSR                                          S01519
     C*                                                                   S01519
     C                     MOVE *ZEROS    PCHA                            S01519
     C/COPY WNCPYSRC,SE2400C045
     C                     MOVE *ZEROS    PCAM                            S01519
     C                     MOVE CSCN      DCCUST                          S01519
     C*                                                                   S01519
     C** Only access file if PEVT is coupon, dividend, or maturity.       S01519
     C*                                                                   S01519
     C           PEVT      IFEQ 'CP'                                      S01519
     C           PEVT      OREQ 'DV'                                      S01519
     C           PEVT      OREQ 'MT'                                      S01519
      *                                                                   S01408
     C/COPY WNCPYSRC,SE2400CCP2                                           S01408
      *                                                                   S01408
     C*                                                                   S01519
     C** Set up key for chaining to default charges table (SEDFTCL2).     S01519
      ** If *IN40 is On, chain SEDFRGL0 instead.                          CSE026
     C*                                                                   S01519
     C           *IN40     IFEQ *ON                                       CSE026
     C                     MOVELBFPSCG    DCCLGR                          CSE026
     C                     ELSE                                           CSE026
     C                     MOVE C1DI      DCCLAS                          S01519
     C                     ENDIF                                          CSE026
      *                                                                   CSE026
     C                     MOVE SITP      DCINVT                          S01519
     C                     MOVE CSCN      DCCUST                          S01519
     C*                                                                   S01519
     C           *IN40     IFEQ *ON                                       CSE026
     C           DFTKYG    CHAINSEDFGRL0             70                   CSE026
     C                     ELSE                                           CSE026
     C           DFTKY1    CHAINSEDFTCL2             70                   S01519
     C                     ENDIF                                          CSE026
     C*                                                                   S01519
     C           *IN70     IFEQ '0'                                       S01519
     C                     EXSR P05                                       S01519
     C                     ELSE                                           S01519
     C*                                                                   S01519
     C**********           MOVE *ZEROS    DCCUST                                       S01519 CSD027
     C                     MOVE *BLANKS   DCCUST                                              CSD027
     C           *IN40     IFEQ *ON                                       CSE026
     C           DFTKYG    CHAINSEDFGRL0             70                   CSE026
     C                     ELSE                                           CSE026
     C           DFTKY1    CHAINSEDFTCL2             70                   S01519
     C                     ENDIF                                          CSE026
     C*                                                                   S01519
     C           *IN70     IFEQ '0'                                       S01519
     C                     EXSR P05                                       S01519
     C                     ELSE                                           S01519
     C*                                                                   S01519
     C                     MOVE *BLANKS   DCINVT                          S01519
     C           *IN40     IFEQ *ON                                       CSE026
     C           DFTKYG    CHAINSEDFGRL0             70                   CSE026
     C                     ELSE                                           CSE026
     C           DFTKY1    CHAINSEDFTCL2             70                   S01519
     C                     ENDIF                                          CSE026
      *                                                                   CSE026
     C           *IN70     IFEQ '0'                                       S01519
     C                     EXSR P05                                       S01519
     C                     ELSE                                           S01519
     C*                                                                   S01519
     C** If no records found zeroise default charge/commission            S01519
     C** amount fields.                                                   S01519
     C*                                                                   S01519
     C                     MOVE *ZEROS    PCHA                            S01519
     C                     MOVE *ZEROS    PCAM                            S01519
     C/COPY WNCPYSRC,SE2400C029
     C                     END                                            S01519
     C*                                                                   S01519
     C                     END                                            S01519
     C                     END                                            S01519
      *                                                                   S01408
     C/COPY WNCPYSRC,SE2400CCP3                                           S01408
      *                                                                   S01408
     C                     END                                            S01519
     C*                                                                   S01519
     C                     ENDSR                           ** P04    **   S01519
     C*                                                                   S01519
     C*****************************************************************   S01519
     C*                                                                   S01519
     C/EJECT                                                              S01519
     C/COPY WNCPYSRC,SE2400C030
     C*****************************************************************   S01519
     C*                                                               *   S01519
     C*  P05   - SUBROUTINE TO CALCULATE DEFAULT AMOUNTS              *   S01519
     C*                                                               *   S01519
     C*****************************************************************   S01519
     C*                                                                   S01519
     C           P05       BEGSR                                          S01519
     C/COPY WNCPYSRC,SE2400C046
     C*                                                                   S01519
     C                     SELEC                                          S01519
     C*                                                                   S01519
     C** Event type if equal to coupon.                                   S01519
     C*                                                                   S01519
     C           PEVT      WHEQ 'CP'                                      S01519
     C*                                                                   S01519
     C** Update commissions amount.                                       S01519
     C*                                                                   S01519
     C           DCCPCM    IFEQ *BLANKS                                   S01519
     C                     Z-ADD*ZEROS    PCAM                            S01519
     C                     ELSE                                           S01519
     C                     MOVE DCCPCM    @CAM                            S01519
     C                     EXSR CALAMT                                    S01519
     C                     Z-ADDZCHGA     PCAM                            S01519
     C                     END                                            S01519
     C                     MOVE DCCPCM    PCCD                            S01519
     C*                                                                   S01519
     C** Update charge amount.                                            S01519
     C*                                                                   S01519
     C           DCCPCC    IFEQ *BLANKS                                   S01519
     C                     Z-ADD*ZEROS    PCHA                            S01519
     C                     ELSE                                           S01519
     C                     MOVE DCCPCC    @CAM                            S01519
     C                     EXSR CALAMT                                    S01519
     C                     Z-ADDZCHGA     PCHA                            S01519
     C                     END                                            S01519
     C                     MOVE DCCPCC    PCHC                            S01519
     C/COPY WNCPYSRC,SE2400C047
     C*                                                                   S01519
     C** Event type if equal to dividend                                  S01519
     C*                                                                   S01519
     C           PEVT      WHEQ 'DV'                                      S01519
     C*                                                                   S01519
     C** Update commissions amount.                                       S01519
     C*                                                                   S01519
     C           DCDVCM    IFEQ *BLANKS                                   S01519
     C                     Z-ADD*ZEROS    PCAM                            S01519
     C                     ELSE                                           S01519
     C                     MOVE DCDVCM    @CAM                            S01519
     C                     EXSR CALAMT                                    S01519
     C                     Z-ADDZCHGA     PCAM                            S01519
     C                     END                                            S01519
     C                     MOVE DCDVCM    PCCD                            S01519
     C*                                                                   S01519
     C** Update charge amount.                                            S01519
     C*                                                                   S01519
     C           DCDVCC    IFEQ *BLANKS                                   S01519
     C                     Z-ADD*ZEROS    PCHA                            S01519
     C                     ELSE                                           S01519
     C                     MOVE DCDVCC    @CAM                            S01519
     C                     EXSR CALAMT                                    S01519
     C                     Z-ADDZCHGA     PCHA                            S01519
     C                     END                                            S01519
     C                     MOVE DCDVCC    PCHC                            S01519
     C/COPY WNCPYSRC,SE2400C048
     C*                                                                   S01519
     C** Event type if equal to maturity.                                 S01519
     C*                                                                   S01519
     C           PEVT      WHEQ 'MT'                                      S01519
     C*                                                                   S01519
     C** Update commissions amount.                                       S01519
     C*                                                                   S01519
     C           DCMTCM    IFEQ *BLANKS                                   S01519
     C                     Z-ADD*ZEROS    PCAM                            S01519
     C                     ELSE                                           S01519
     C                     MOVE DCMTCM    @CAM                            S01519
     C                     EXSR CALAMT                                    S01519
     C                     Z-ADDZCHGA     PCAM                            S01519
     C                     END                                            S01519
     C                     MOVE DCMTCM    PCCD                            S01519
     C*                                                                   S01519
     C** Update charge amount.                                            S01519
     C*                                                                   S01519
     C           DCMTCC    IFEQ *BLANKS                                   S01519
     C                     Z-ADD*ZEROS    PCHA                            S01519
     C                     ELSE                                           S01519
     C                     MOVE DCMTCC    @CAM                            S01519
     C                     EXSR CALAMT                                    S01519
     C                     Z-ADDZCHGA     PCHA                            S01519
     C                     END                                            S01519
     C                     MOVE DCMTCC    PCHC                            S01519
     C/COPY WNCPYSRC,SE2400C049
     C*                                                                   S01519
     C                     ENDSL                                          S01519
     C*                                                                   S01519
     C                     ENDSR                           ** P05    **   S01519
     C*                                                                   S01519
     C*****************************************************************   S01519
     C/EJECT                                                              S01519
     C*****************************************************************   S01519
     C*                                                               *   S01519
     C*  P06   - SUBROUTINE TO CALCULATE SETTLEMENT AMOUNTS           *   S01519
     C*                                                               *   S01519
     C*****************************************************************   S01519
     C*                                                                   S01519
     C           P06       BEGSR                                          S01519
     C***********                                                  S01519 087178
     C***Initialise*calculation*workfield.*************************S01519 087178
     C***********                                                  S01519 087178
     C***********          Z-ADD*ZEROS    WKCALC 140               S01519 087178
     C***********                                                  S01519 087178
     C***********C1DI      IFEQ 'S'                                S01519 087178
     C***********PPRE      ANDEQ'R'                                S01519 087178
     C***********C1DI      OREQ 'D'                                S01519 087178
     C***********PPRE      ANDEQ'R'                                S01519 087178
     C***********PPRE      OREQ 'P'                                S01519 087178
     C***********C1DI      ANDNE'D'                                S01519 087178
     C***********C1DI      ANDNE'S'                                S01519 087178
     C***********                                                  S01519 087178
     C***Calculate*and*update*settlement*amount.*******************S01519 087178
     C***********                                                  S01519 087178
     C***********PAMD      ADD  PCHA      WKCALC                   S01519 087178
     C***********WKCALC    ADD  PCAM      WKCALC                   S01519 087178
     C***********          Z-ADDWKCALC    PSAT                     S01519 087178
     C***********                                                  S01519 087178
     C***********          ELSE                                    S01519 087178
     C***********                                                  S01519 087178
     C***********C1DI      IFEQ 'S'                                S01519 087178
     C***********PPRE      ANDEQ'P'                                S01519 087178
     C***********C1DI      OREQ 'D'                                S01519 087178
     C***********PPRE      ANDEQ'P'                                S01519 087178
     C***********PPRE      OREQ 'R'                                S01519 087178
     C***********C1DI      ANDNE'D'                                S01519 087178
     C***********C1DI      ANDNE'S'                                S01519 087178
     C***********                                                  S01519 087178
     C***Calculate*and*update*settlement*amount.*******************S01519 087178
     C***********                                                  S01519 087178
     C***********PAMD      SUB  PCHA      WKCALC                   S01519 087178
     C***********WKCALC    SUB  PCAM      WKCALC                   S01519 087178
     C***********          Z-ADDWKCALC    PSAT                     S01519 087178
     C***********                                                  S01519 087178
     C***********          ELSE                                    S01519 087178
     C***********          Z-ADDPAMD      PSAT                     S01519 087178
     C***********          END                                     S01519 087178
     C***********                                                  S01519 087178
     C***********          END                                     S01519 087178
     C*                                                                   087178
     C** Set up parameter for call to SEZ010                              087178
     C*                                                                   087178
     C                     MOVELC1DI      P@CLAS                          087178
     C                     MOVELPPRE      P@PPRE                          087178
     C                     Z-ADDPAMD      P@PAMD                          087178
     C                     Z-ADDPCHA      P@PCHA                          087178
     C                     Z-ADDPCAM      P@PCAM                          087178
     C                     Z-ADDTASO      P@TASO                          087178
     C                     Z-ADDTAUS      P@TAUS                          087178
     C                     Z-ADDPSXR      P@PSXR                          087178
      ***Override*coupon*rate                                                   AR1001183 AR1001183A
     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
     C**********           Z-ADDWPSXR     P@PSXR                                AR1001183 AR1001183A
     C*********            ENDIF                                                AR1001183 AR1001183A
     C*********            MOVE 'N'       WRCHG                                 AR1001183 AR1001183A
     C                     MOVELPMDI      P@PMDI                          087178
     C                     MOVELPNCY      P@PNCY                          087178
     C                     MOVELPSCU      P@PSCU                          087178
     C                     MOVELWSTAXA    P@STAM                                            AR853119
     C/COPY WNCPYSRC,SE2400C031
     C*                                                                   CAC002
     C                     MOVE 'TS'      P@TDTP                          CAC002
     C                     Z-ADD0         P@FXMR                          CAC002
     C                     Z-ADD0         P@MAMT                          CAC002
     C*                                                                   087178
     C** Call SEZ010 to calculate the settlement amount in settle ccy     087178
     C*                                                                   087178
     C                     CALL 'SEZ010'                                  087178
     C                     PARM *BLANKS   P@RCDE  7                       087178
     C                     PARM           P@DATA                          087178
     C           P@RCDE    IFEQ *BLANKS                                   087178
     C                     Z-ADDP@PSAT    PSAT                            087178
     C                     ELSE                                           087178
     C                     EXSR *PSSR                                     087178
     C                     EXSR AUDIT                                     087178
     C                     MOVE '1'       *INLR                           087178
     C                     ENDIF                                          087178
     C*                                                                   S01519
     C                     ENDSR                           ** P06    **   S01519
     C*                                                                   S01519
     C*****************************************************************   S01519
     C/EJECT                                                              S01519
      *****************************************************************   S01486
      *                                                               *   S01486
      *  P07  DETERMINE SETTLEMENT INFORMATION                        *   S01486
      *                                                               *   S01486
      *****************************************************************   S01486
      *                                                                   S01486
     C           P07       BEGSR                                          S01486
     C                     MOVE 'N'       WWPMCS  1                       192099
     C*                                                                   S01486
     C** IF POSITION SETTLEMENT FOR A PORTFOLIO POSITION OBTAIN           S01486
     C** PORTFOLIO CURRENCY AND CUSTOMER CURRENCY                         S01486
     C           WPORTP    IFEQ 'Y'                        B1             S01486
     C           PTFR      ANDNE*BLANKS                                   189942
     C                     MOVE *BLANKS   WZACOD 100                      219688
     C*                                                                   S01486
     C** IF POSITION SETTLEMENT FOR A DEFINED PORTFOLIO OBTAIN PORTFOLIO  S01486
     C** CURRENCY                                                         S01486
     C***********QAPTFR    IFNE '9997'                     B2      S01486 189942
     C***********          MOVE QACNUM    WWCNU1                   S01486 189942
     C***********          MOVE QAPTFR    WWPTF1                   S01486 189942
     C           PTFR      IFNE '9997'                     B2             189942
     C                     MOVE CDCN      WWCNU1                          189942
     C                     MOVE PTFR      WWPTF1                          189942
     C*                                                                   S01486
     C***********PMPORT    CHAINPMPORTPD             79            S01486 081383
     C************IN79     IFEQ '1'                        B3      S01486 081383
     C           PMPORT    CHAINPMPORTPD             83                   081383
     C           *IN83     IFEQ '1'                        B3             081383
     C           *LOCK     IN   LDA                                       081239
     C************         MOVEL'MPORT'   DBFILE           *********S01486081239
     C                     MOVEL'PMPORTPD'DBFILE           ***************081239
     C***********          MOVELQACNUM    DBKEY            ** DB ERS01486 189942
     C***********          MOVE QAPTFR    DBKEY            ********S01486 189942
     C                     MOVELCDCN      DBKEY            ** DB ERROR 04 189942
     C                     MOVE PTFR      DBKEY            ***************189942
     C                     Z-ADD40        DBASE                           S01486
     C                     SETON                       U7U8               081239
     C                     GOTO EAUDIT                                    S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C                     END                             E2             S01486
     C*                                                                   S01486
     C** ACCESS PORTFOLIO CUSTOMER DETAILS                                S01486
     C***********          MOVE QACNUM    WWCNUA  6                S01486 189942
     C                     MOVE CDCN      WWCNUA  6                       189942
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     MOVELWWCNUA    WWCLIN 10                       S01486
     C                     CALL 'AOPLCSR0'                                S01486
     C                     PARM *BLANKS   @RTCD                           S01486
     C                     PARM '*KEY   ' @OPTN                           S01486
     C                     PARM WWCLIN    WWKY10 10                       S01486
     C           SDPLCS    PARM SDPLCS    DSSDY                           S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           BGN4ST    IFNE 'Y'                                       192099
     C           *LOCK     IN   LDA                                       S01486
     C************         MOVEL'DPLCS'   DBFILE           *********S01486081239
     C                     MOVEL'SDPLCSPD'DBFILE           ***************081239
     C                     MOVELWWCNUA    DBKEY            ** DB ERROR 04 S01486
     C                     Z-ADD41        DBASE            ***************S01486
     C                     SETON                       U7U8               S01486
     C                     EXSR *PSSR                                     S01486
     C                     GOTO EAUDIT                                    S01486
     C                     ENDIF                                          192099
     C                     ELSE                                           192099
     C                     MOVE 'Y'       WWPMCS                          192099
     C                     END                             E2             S01486
     C                     ENDIF                                          CPB001
     C***********          MOVE QACNUM    WWCNUA  6                133844 189942
     C                     MOVE CDCN      WWCNUA  6                       189942
     C*                                                                   133844
     C                     MOVELWWCNUA    @CUST  10                       133844
     C                     CALL 'AOSECSR0'                                133844
     C                     PARM *BLANKS   @RTCD                           133844
     C                     PARM '*KEY   ' @OPTN                           133844
     C                     PARM           @CUST                           133844
     C           SECSPD    PARM SECSPD    DSSDY                           133844
      *                                                                   133844
     C           @RTCD     IFNE *BLANKS                    *B3            133844
     C           *LOCK     IN   LDA                                       133844
     C                     MOVEL'SDSECSL0'DBFILE           ***************133844
     C                     MOVEL@CUST     DBKEY            ** DBERROR 044 133844
     C                     Z-ADD44        DBASE            ***************133844
     C                     SETON                       U7U8               133844
     C                     EXSR *PSSR                                     133844
     C                     GOTO EAUDIT                                    133844
     C                     END                                            133844
      *                                                                   219688
     C                     MOVE BFACCD    WZACOD                          219688
      *                                                                   219688
     C*                                                                   S01486
     C** ... OTHERWISE POSITION SETTLEMENT FOR A NON-PORTFOLIO CUSTOMER   S01486
     C** HENCE ACCES SDSECSL0 FOR SECURITY CUSTOMER BASE CURRENCY         S01486
     C                     ELSE                            X1             S01486
     C*                                                                   S01486
     C                     MOVE CSCN      WWCNUA  6                       S01486
     C*                                                                   S01486
      *                                                                   S01486
     C                     MOVELWWCNUA    @CUST  10                       S01486
     C                     CALL 'AOSECSR0'                                S01486
     C                     PARM *BLANKS   @RTCD                           S01486
     C                     PARM '*KEY   ' @OPTN                           S01486
     C                     PARM           @CUST                           S01486
     C           SECSPD    PARM SECSPD    DSSDY                           S01486
      *                                                                   S01486
     C           @RTCD     IFNE *BLANKS                    *B3            S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL'SDSECSL0'DBFILE           ***************S01486
     C                     MOVEL@CUST     DBKEY            ** DBERROR 010 S01486
     C                     Z-ADD42        DBASE            ***************S01486
     C                     SETON                       U7U8               S01486
     C                     EXSR *PSSR                                     S01486
     C                     GOTO EAUDIT                                    S01486
     C                     END                                            S01486
     C                     END                             E1             S01486
     C*                                                                   S01486
     C** USE FIRST ACCOUNT IN FOUND FOR CUSTOMER / PORTFOLIO AS           S01486
     C** APPROPRIATE IN VALUE, PORTFOLIO OR CUSTOMER CURRENCY VIA P08     S01486
     C           WPORTP    IFEQ 'Y'                        B1             S01486
     C           PTFR      ANDNE*BLANKS                                   189942
     C***********          Z-ADDQACNUM    WZCNUM  60               S01486 189942
     C***********          MOVE QAPTFR    WZPTFR  4                S01486 189942
     C**********           Z-ADDCDCN      WZCNUM  60                                   189942 CSD027
     C                     MOVE CDCN      WZCNUM  6                                           CSD027
     C                     MOVE PTFR      WZPTFR  4                       189942
     C                     MOVE PNCY      WWCCY1  3                       S01486
     C           WWPMCS    IFEQ 'Y'                                       192099
     C                     MOVE QBCSBY    WWCCY3  3                       S01486
     C                     ELSE                                           192099
     C                     MOVE PNCY      WWCCY3                          192099
     C                     ENDIF                                          192099
     C*                                                                   S01486
     C***********QAPTFR    IFNE '9997'                     B2      S01486 189942
     C           PTFR      IFNE '9997'                     B2             189942
     C                     MOVE PNPTCY    WWCCY2  3                       S01486
     C                     ELSE                            X2             S01486
     C           WWPMCS    IFEQ 'Y'                                       192099
     C                     MOVE QBCSBY    WWCCY2  3                       S01486
     C                     ELSE                                           192099
     C                     MOVE PNPTCY    WWCCY2                          192099
     C                     ENDIF                                          192099
     C                     END                             E2             S01486
     C*                                                                   S01486
     C                     ELSE                            X1             S01486
     C**********           Z-ADDCSCN      WZCNUM  60                                   S01486 CSD027
     C                     MOVE CSCN      WZCNUM  6                                           CSD027
     C                     MOVE *BLANKS   WZPTFR  4                       S01486
     C                     MOVE PNCY      WWCCY1  3                       S01486
     C                     MOVE BFPCYC    WWCCY2  3                       S01486
     C                     MOVE BFPCYC    WWCCY3  3                       S01486
     C                     END                             E1             S01486
     C*                                                                   S01486
     C** CHECK WHETHER ACCOUNT EXISTS IN VALUE CURRENCY                   S01486
     C***IF*THE*CUSTOMER*IS*A*PORTFOLIO*CUSTOMER****               S01486 101317
     C***********WPORTP    IFEQ 'Y'                        B1      S01486 101317
     C           BGPFMG    IFEQ 'Y'                        B1             111922
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE WWCCY1    WZCCY   3                       S01486
     C                     EXSR P08                                       S01486
     C*                                                                   097890
     C** If no account in security currency, do NOT post to account       097890
     C** in customer currency or portfolio currency with sett. method     097890
     C** '05' - post to suspense account with sett. method '00' instead   097890
     C*                                                                   S01486
     C***IF*NO*ACCOUNT*FOUND*SEARCH*FOR*ACCOUNT*IN*PORTFOLIO*CCY   S01486 097890
     C***********WZFOND    IFEQ 'N'                        B2      S01486 097890
     C***********          MOVE WWCCY2    WZCCY   3                S01486 097890
     C***********          EXSR P08                                S01486 097890
     C***********          END                             E2      S01486 097890
     C*                                                                   S01486
     C***IF*NO*ACCOUNT*FOUND*SEARCH*FOR*ACCOUNT*IN*CUSTOMER*CCY    S01486 097890
     C***********WZFOND    IFEQ 'N'                        B2      S01486 097890
     C***********          MOVE WWCCY3    WZCCY   3                S01486 097890
     C***********          EXSR P08                                S01486 097890
     C***********          END                             E2      S01486 097890
     C***********          END                             E1      S01486 101317
     C                     ENDIF                           E1             111922
     C*                                                                   S01486
     C** IF A SETTLEMENT ACCOUNT HAS BEEN FOUND OUTPUT SETTLEMENT         S01486
     C** DETAILS                                                          S01486
     C           WZFOND    IFEQ 'Y'                        B1             S01486
     C                     MOVE WZCCY     PSCU                            S01486
     C*                                                                   S01486
     C                     MOVE '05'      PSMT                            S01486
     C                     MOVE WZSETA    PSEA                            S01486
     C                     MOVE WZBRCD    PSEB                            S01486
     C                     ELSE                            X1             S01486
     C                     MOVE PNCY      PSCU                            S01486
     C                     MOVE *BLANKS   PSEA                            S01486
     C                     MOVE *BLANKS   PSMT                            S01486
     C                     MOVE *BLANKS   PSEB                            S01486
     C                     END                             E1             S01486
     C*                                                                   S01486
     C*  BASE CURR EXCHANGE RATE IS SPOT RATE FOR SETTLEMENT CURRCY       S01486
     C*                                                                   S01486
     C           TPBRY     TAG                                            SA9108
     C*  PBRX IS NOW EXCHANGE RATE BETWEEN VALUE AND BASE                 S01486
     C                     MOVE PSCU      WCURR                           S01486
     C                     EXSR TG10                                      S01486
     C                     Z-ADDSPOT      PBRX                            S01486
     C                     Z-ADD1         ZAMTF                           S01486
     C                     MOVE PNCY      ZCCYF                           S01486
     C                     MOVE PSCU      ZCCYT                           S01486
     C                     Z-ADDSPOT      PBRX                            S01486
     C*                                                                   S01486
     C                     ENDSR                                          S01486
     C********************************************************************S01486
      /EJECT                                                              S01486
      *****************************************************************   S01486
      *                                                               *   S01486
      *  P08  DETERMINE SETTLEMENT ACCOUNT                            *   S01486
      *                                                               *   S01486
      *****************************************************************   S01486
      *                                                                   S01486
     C           P08       BEGSR                                          S01486
     C*                                                                   S01486
     C                     MOVE 'N'       WZFOND  1                       S01486
     C                     Z-ADD0         WZACSQ                          S01486
     C*                                                                   S01486
     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
     C           ACCNTL    SETLLPMACCNL1                                  219688
     C                     READ PMACCNL1                 83               219688
     C           *IN83     IFEQ '0'                                       219688
     C           CNUM      ANDEQWZCNUM                                    219688
     C           CCY       ANDEQWZCCY                                     219688
     C           ACOD      ANDEQWZACOD                                    219688
     C           L1PTFR    ANDEQWZPTFR                                    219688
     C                     MOVE 'Y'       WZFOND                          219688
     C                     MOVELBRCA      WZBRCD                          219688
     C                     MOVELCNUM      WRK16                           219688
     C                     MOVE ACOD      WRK16                           219688
     C                     MOVELWRK16     WZSETA                          219688
     C                     MOVE ACSQ      WZSETA                          219688
     C                     ELSE                                           219688
     C*                                                                   219688
     C** READ FIRST RECORD FOR ACCOUNT                                    S01486
     C           ACCNTP    SETLLPMACCNL0                                  S01486
     C***********          READ PMACCNL0                 79        S01486 081383
     C                     READ PMACCNL0                 83        S01486 081383
     C*                                                                   S01486
     C** IF DETAILS READ FOR SAME CUSTOMER CURRENCY AND PORTFOLIO         S01486
     C** SET UP OUTPUT DETAILS                                            S01486
     C************IN79     IFEQ '0'                                S01486 081383
     C           *IN83     IFEQ '0'                                       081383
     C           CNUM      ANDEQWZCNUM                                    S01486
     C           CCY       ANDEQWZCCY                                     S01486
     C           RNPTFR    ANDEQWZPTFR                                    S01486
     C                     MOVE 'Y'       WZFOND                          S01486
     C***********          MOVELBRCA      WZBRCD  30                S01486081239
     C                     MOVELBRCA      WZBRCD  3                       081239
     C**********           MOVELCNUM      WRK10  10                                    S01486 CGL029
     C**********           MOVE ACOD      WRK10                                        S01486 CGL029
     C**********           MOVELWRK10     WZSETA 12                                    S01486 CGL029
     C**********           MOVE ACSQ      WZSETA                                       S01486 CGL029
     C                     MOVELCNUM      WRK16  16                                           CGL029
     C                     MOVE ACOD      WRK16                                               CGL029
     C                     MOVELWRK16     WZSETA 18                                           CGL029
     C                     MOVE ACSQ      WZSETA                                              CGL029
     C                     ELSE                                                               219566
     C** ELSE IF system value 'UseDefaultSettAccnt' is 'Y' then                               219566
     C           DEF001    IFEQ 'Y'                                                           219566
     C**                                                                                      219566
     C**      RETRIEVE AN ACCOUNT FROM THIS CLIENT                                            219566
     C                     MOVE *BLANKS   WZPTFR                                              219566
     C           ACCNTP    SETLLPMACCNL0                                                      219566
     C                     READ PMACCNL0                 83                                   219566
     C*                                                                                       219566
     C** IF DETAILS READ FOR SAME CUSTOMER,CURRENCY                                           219566
     C** SET UP OUTPUT DETAILS                                                                219566
     C           *IN83     IFEQ '0'                                                           219566
     C           CNUM      ANDEQWZCNUM                                                        219566
     C           CCY       ANDEQWZCCY                                                         219566
     C                     MOVE 'Y'       WZFOND                                              219566
     C                     MOVELBRCA      WZBRCD                                              219566
     C                     MOVELCNUM      WRK16                                               219566
     C                     MOVE ACOD      WRK16                                               219566
     C                     MOVELWRK16     WZSETA                                              219566
     C                     MOVE ACSQ      WZSETA                                              219566
     C                     END                                                                219566
      *                                                                                       219566
     C                     END                             Endif DEF001=Y                     219566
      *                                                                                       219566
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            219688
     C*                                                                   219688
     C/COPY WNCPYSRC,HUT103_003                                                               HUT103
     C                     ENDSR                                          S01486
     C********************************************************************S01486
      /EJECT                                                              S01447
     C*****************************************************************   S01519
     C*                                                               *   S01519
     C*  CALAMT  SUB ROUTINE TO DETERMINE IF AMOUNTS NEED TO BE       *   S01519
     C*          DEFAULTED FOR CHARGES                                *   S01519
     C*                                                               *   S01519
     C*****************************************************************   S01519
     C*                                                                   S01519
     C           CALAMT    BEGSR                                          S01519
     C*                                                                   S01519
     C** Charges to be displayed in nominal currency whether the          S01519
     C** security is single, dual or multi currency (ref amend to FS)     S01519
     C*                                                                   S01519
     C                     MOVE PNCY      @CCY    3                       S01519
     C           @CCOD     CHAINSECGT                21                   S01519
     C*                                                                   S01519
     C** If no live record found, field defaults to blank                 S01519
     C*                                                                   S01519
     C           *IN21     IFEQ '1'                                       S01519
     C           RECI      ORNE 'D'                                       S01519
     C                     Z-ADD*ZEROS    ZCHGA                           S01519
     C                     END                                            S01519
     C*                                                                   S01519
     C           *IN21     IFEQ '0'                                       S01519
     C           RECI      ANDEQ'D'                                       S01519
     C*                                                                   S01519
     C** If trade type is purchase and levy on sale or trade type is      S01519
     C** sale and levy on purchase field is blank, otherwise calculate    S01519
     C** amount                                                           S01519
     C*                                                                   S01519
     C           LPSI      IFEQ 'S'                                       S01519
     C           LPSI      OREQ 'P'                                       S01519
     C                     Z-ADD*ZEROS    ZCHGA                           S01519
     C                     ELSE                                           S01519
     C                     EXSR CALAM2                                    S01519
     C                     END                                            S01519
     C*                                                                   S01519
     C                     END                                            S01519
     C*                                                                   S01519
     C                     ENDSR                                          S01519
     C*                                                                   S01519
     C*****************************************************************   S01519
     C/EJECT                                                              S01519
     C*****************************************************************   S01519
     C*                                                               *   S01519
     C*  CALAM2  SUB ROUTINE TO CALCULATE CHARGE AMOUNTS              *   S01519
     C*                                                               *   S01519
     C*****************************************************************   S01519
     C*                                                                   S01519
     C           CALAM2    BEGSR                                          S01519
     C*                                                                   S01519
     C** Charge details                                                   S01519
     C*                                                                   S01519
     C                     MOVE CHGB      ZCHGB                           S01519
     C                     MOVE THRI      ZTHRI                           S01519
     C                     Z-ADDMNCH      ZMNCH                           S01519
     C                     Z-ADDMXCH      ZMXCH                           S01519
     C*                                                                   S01519
     C** Set up array for upper range limits                              S01519
     C*                                                                   S01519
     C                     Z-ADDSTU1      ZRA,1                           S01519
     C                     Z-ADDSTU2      ZRA,2                           S01519
     C                     Z-ADDSTU3      ZRA,3                           S01519
     C                     Z-ADDSTU4      ZRA,4                           S01519
     C                     Z-ADDSTU5      ZRA,5                           S01519
     C                     Z-ADDSTU6      ZRA,6                           S01519
     C                     Z-ADDSTU7      ZRA,7                           S01519
     C                     Z-ADDSTU8      ZRA,8                           S01519
     C                     Z-ADDSTU9      ZRA,9                           S01519
     C                     Z-ADDST10      ZRA,10                          S01519
     C                     Z-ADDST11      ZRA,11                          S01519
     C                     Z-ADDST12      ZRA,12                          S01519
     C                     Z-ADDST13      ZRA,13                          S01519
     C                     Z-ADDST14      ZRA,14                          S01519
     C*                                                                   S01519
     C** Set up array for percentage levels                               S01519
     C*                                                                   S01519
     C                     Z-ADDPL01      ZPC,1                           S01519
     C                     Z-ADDPL02      ZPC,2                           S01519
     C                     Z-ADDPL03      ZPC,3                           S01519
     C                     Z-ADDPL04      ZPC,4                           S01519
     C                     Z-ADDPL05      ZPC,5                           S01519
     C                     Z-ADDPL06      ZPC,6                           S01519
     C                     Z-ADDPL07      ZPC,7                           S01519
     C                     Z-ADDPL08      ZPC,8                           S01519
     C                     Z-ADDPL09      ZPC,9                           S01519
     C                     Z-ADDPL10      ZPC,10                          S01519
     C                     Z-ADDPL11      ZPC,11                          S01519
     C                     Z-ADDPL12      ZPC,12                          S01519
     C                     Z-ADDPL13      ZPC,13                          S01519
     C                     Z-ADDPL14      ZPC,14                          S01519
     C                     Z-ADDPL15      ZPC,15                          S01519
     C*                                                                   S01519
     C** Set up array for flat charges                                    S01519
     C*                                                                   S01519
     C                     Z-ADDFC01      ZCG,1                           S01519
     C                     Z-ADDFC02      ZCG,2                           S01519
     C                     Z-ADDFC03      ZCG,3                           S01519
     C                     Z-ADDFC04      ZCG,4                           S01519
     C                     Z-ADDFC05      ZCG,5                           S01519
     C                     Z-ADDFC06      ZCG,6                           S01519
     C                     Z-ADDFC07      ZCG,7                           S01519
     C                     Z-ADDFC08      ZCG,8                           S01519
     C                     Z-ADDFC09      ZCG,9                           S01519
     C                     Z-ADDFC10      ZCG,10                          S01519
     C                     Z-ADDFC11      ZCG,11                          S01519
     C                     Z-ADDFC12      ZCG,12                          S01519
     C                     Z-ADDFC13      ZCG,13                          S01519
     C                     Z-ADDFC14      ZCG,14                          S01519
     C                     Z-ADDFC15      ZCG,15                          S01519
     C*                                                                   S01519
     C** Get nominal currency dec. places from TABTG10                    S01519
     C*                                                                   S01519
     C                     MOVE PNCY      WCURR                           S01519
     C                     EXSR TG10                                      S01519
     C                     MOVE CDP       ZDECS                           S01519
     C                     MOVE CDP       ZCDP                            S01519
     C*                                                                   S01519
     C** Nominal decimal places                                           S01519
     C*                                                                   S01519
     C                     Z-ADDNMDP      ZNMDP                           S01519
     C*                                                                   S01519
     C** Use SR/ZAVPR to calculate the price                              S01519
     C*                                                                   S01519
     C                     MOVE PNMP      ZNOML                           S01519
     C                     Z-ADDPAMD      ZAPNC                           S01519
     C                     EXSR ZAVPR                                     S01519
     C                     Z-ADDZPRC      ZPRICE                          S01519
     C*                                                                   S01519
     C                     Z-ADD1         ZTCFC                           S01519
     C                     MOVE PROT      ZPROT                           S01519
     C                     MOVE SPBS      ZSPBS                           S01519
     C*                                                                   S01446
     C** For courtage enhancements, convert charge to value currency      S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C*                                                                   S01446
     C** Purchase interest and total consideration                        S01446
     C*                                                                   S01446
     C                     Z-ADD*ZEROS    ZTPI                            S01446
     C                     Z-ADD*ZEROS    ZTCON                           S01446
     C*                                                                   S01446
     C           BVCHRC    IFNE *BLANKS                                   S01446
     C                     MOVE BVCHRC    ZCCYI                           S01446
     C                     MOVE PNCY      ZCCYO                           S01446
     C                     MOVE TRATEX    ZEXCH                           S01446
     C                     MOVE TMDIX     ZMD                             S01446
     C                     MOVE TXCDP     ZCDPI                           S01446
     C                     MOVE ZDECS     ZCDPO                           S01446
     C*                                                                   S01446
     C                     ELSE                                           S01446
     C                     MOVE *BLANKS   ZCCYI                           S01446
     C                     MOVE *BLANKS   ZCCYO                           S01446
     C                     MOVE *BLANKS   ZEXCH                           S01446
     C                     MOVE *BLANKS   ZMD                             S01446
     C                     MOVE *BLANKS   ZCDPI                           S01446
     C                     MOVE *BLANKS   ZCDPO                           S01446
     C                     END                                            S01446
     C                     END                                            S01446
     C*                                                                   S01446
     C** Total nominal                                                    S01446
     C*                                                                   S01446
     C                     Z-ADD*ZEROS    ZTNOM  150                      S01446
     C/COPY WNCPYSRC,SE2400C050
     C*                                                                   S01446
     C                     EXSR ZCCAL1                                    S01519
     C/COPY WNCPYSRC,SE2400C051
     C*                                                                   S01519
     C                     ENDSR                                          S01519
     C*                                                                   S01519
     C*****************************************************************   S01519
      /EJECT                                                              S01447
      *****************************************************************   S01447
      *                                                               *   S01447
      *  CALCTX - Subroutine to calculate tax amounts for dividends   *   S01447
      *           and Coupons                                         *   S01447
      *                                                               *   S01447
      *  CALLED FROM: W02                                             *   S01447
      *  CALLS:       NONE                                            *   S01447
      *                                                               *   S01447
      *****************************************************************   S01447
      *                                                                   S01447
     C           CALCTX    BEGSR                                          S01447
      *                                                                   S01447
      *** Initialise work tax rate and amount fields                      S01447
      *                                                                   S01447
     C                     CLEARUTXRSR                                    S01447
     C                     CLEARUTXRRF                                    S01447
     C                     CLEARUTXRUS                                    S01447
     C                     CLEARUDLOR                                     S01447
      *                                                                   S01447
      *** If tax band at source is zero, then take rate from security     S01447
      *** WHT file; Otherwise access SEcountry tax rate file to           S01447
      *** get tax rate at source                                          S01447
      *                                                                   S01447
     C           S1TABD    IFEQ *ZERO                      *B1            S01447
     C                     Z-ADDS1RASO    UTXRSR                          S01447
     C                     ELSE                            *X1            S01447
      *                                                                   S01447
     C                     MOVELS1CTTA    UKEY    3                       S01447
     C                     MOVE S1TABD    UKEY                            S01447
      *                                                                   S01447
     C                     CALL 'AOSCTXR0'                                S01447
     C                     PARM *BLANKS   @RTCD                           S01447
     C                     PARM '*KEY   ' @OPTN                           S01447
     C                     PARM S1CTTA    @CTTA   2                       S01447
     C                     PARM S1TABD    @TABD   10                      S01447
     C           SECNTR    PARM SECNTR    DSSDY                           S01447
     C*                                                                   S01447
     C           @RTCD     IFNE *BLANKS                    *B2            S01447
     C           TXRECI    ORNE 'D'                                       S01447
     C           *LOCK     IN   LDA                                       S01447
     C                     MOVEL'SECNTRL0'DBFILE           ***************S01447
     C                     MOVELUKEY      DBKEY            ** DBERROR 018 S01447
     C                     Z-ADD18        DBASE            ***************S01447
     C                     SETON                       U7U8               S01447
     C                     EXSR *PSSR                                     S01447
     C                     GOTO EAUDIT                                    S01447
     C                     ELSE                            *X2            S01447
     C                     Z-ADDTXRASO    UTXRSR                          S01447
     C                     END                             *E2            S01447
     C                     END                             *E1            S01447
      *                                                                   S01447
      *** If tax band by user is not zero, then access country to         S01447
      *** branch tax rate file to get tax rate by user                    S01447
      *** Otherwise set to zero.                                          S01447
      *                                                                   S01447
     C           S1TABU    IFNE *ZERO                      *B1            S01447
     C                     MOVE CSBA      @BRCA   3                                         AR877365
     C           BGPFMG    IFEQ 'Y'                                                         AR877365
     C           BGN4ST    OREQ 'Y'                                                         AR877365
     C                     MOVE CDPA      @BRCA                                             AR877365
     C                     ENDIF                                                            AR877365
     C/COPY WNCPYSRC,SE2400C058
     C                     CALL 'AOCBTXR0'                                S01447
     C                     PARM *BLANKS   @RTCD                           S01447
     C                     PARM '*KEY   ' @OPTN                           S01447
     C**********           PARM CSBA      @BRCA   3                                  S01447 AR877365
     C                     PARM           @BRCA                                             AR877365
     C                     PARM S1CTTA    @CTTA                           S01447
     C                     PARM S1TABU    @TABU   10                      S01447
     C           SECBTX    PARM SECBTX    DSFDY                           S01447
     C/COPY WNCPYSRC,SE2400C059
     C*                                                                   S01447
     C           @RTCD     IFEQ *BLANKS                    *B2            S01447
     C           TBRECI    ANDEQ'D'                                       S01447
     C                     Z-ADDTBRASR    UTXRRF                          S01447
     C                     Z-ADDTBRAUS    UTXRUS                          S01447
     C                     MOVE TBDLOR    UDLOR                           S01447
     C                     END                             *E2            S01447
     C                     END                             *E1            S01447
      *                                                                   S01447
      *** calculate amount deducted at source                             S01447
      *                                                                   S01447
     C           UTXRSR    DIV  100       URATE   54                      S01447
     C           PAMD      MULT URATE     TASO      H                     S01447
      *                                                                   S01447
      *** calculate amount deducted refundable                            S01447
      *                                                                   S01447
     C           UTXRRF    DIV  100       URATE                           S01447
     C           PAMD      MULT URATE     TASR      H                     S01447
      *                                                                   S01447
      *** calculate amount deducted by user                               S01447
      *                                                                   S01447
     C                     CLEARTAUS                                      S01447
      *                                                                   S01447
     C           UTXRUS    IFGT *ZERO                      *B1            S01447
      *                                                                   S01447
     C           UDLOR     IFEQ 'N'                        *B2            S01447
     C                     MOVE PCPY      WCUST                           S01447
     C           CLKYCB    CHAINCLINT                54                   S01447
     C           *IN54     IFEQ '1'                        *B3            S01447
     C           RECI      OREQ '*'                                       S01447
     C           *LOCK     IN   LDA                                       S01447
     C                     MOVEL'CLINTCB 'DBFILE           ***************S01447
     C                     MOVELPCPY      DBKEY            ** DBERROR 021 S01447
     C                     Z-ADD21        DBASE            ***************S01447
     C                     SETON                       U7U8               S01447
     C                     EXSR *PSSR                                     S01447
     C                     GOTO EAUDIT                                    S01447
     C                     END                             *E3            S01447
     C                     END                             *E2            S01447
      *                                                                   S01447
     C           UDLOR     IFEQ 'Y'                        *B2            S01447
     C           UDLOR     OREQ 'N'                                       S01447
     C           CLOC      ANDNEUBRLOC                                    S01447
      *                                                                   S01447
     C           UTXRUS    DIV  100       URATE                           S01447
     C/COPY WNCPYSRC,SE2400C060
     C           PAMD      MULT URATE     TAUS      H                     S01447
     C/COPY WNCPYSRC,SE2400C061
     C                     END                             *E2            S01447
      *                                                                   S01447
     C                     END                             *E1            S01447
      *                                                                   S01447
     C                     ENDSR                                          S01447
      *                                                                   S01447
      *****************************************************************   S01447
      /EJECT
      *****************************************************************
      *                                                               *
      *  W03    - Subroutine to Write Matured Security Positions      *
      *           Extract record.                                     *
      *                                                               *
      *****************************************************************
      *
     C           W03       BEGSR                           ** W03    **
     C*                                                                   S01486
     C***FS***** BGPFMG    IFEQ 'Y'                                S01486
     C** COUPON AND MATURITY EVENTS SEPARATE THEREFORE NEED TO PERFS01486
     C** SR/COUPON TO CALCULATE COUPON AMOUNT                      S01486
     C***FS*************** Z-ADDCSNT      WCUMCP                   S01486
     C***FS*************** Z-ADDSAED      ZECD                     S01486
     C***FS*************** EXSR ZLCD                               S01486
     C***FS*************** Z-ADDZZLCD     SALCCP                   S01486
     C***FS*************** MOVE 'Y'       W03FLG  1                S01486
     C***FS*************** EXSR COUPON                             S01486
     C***FS*************** MOVE 'N'       W03FLG  1                S01486
     C***FS*************** Z-ADDZINTDU    CPNA                     S01486
     C********** SAAT      IFEQ 'MA'                                      S01486
     C******************** MOVE 'C'       RECI                            S01486
     C******************** ELSE                                           S01486
     C******************** MOVE 'P'       RECI                            S01486
     C******************** END                                            S01486
     C******************** ADD  1         WMATUR  50                      S01486
     C******************** MOVE CSBA      BHBA                            S01486
     C******************** MOVE CSSC      BHSC                            S01486
     C******************** MOVE '  '      BHBK                            S01486
     C********** SAAT      IFEQ 'MA'                                      S01486
     C******************** Z-ADDWNOMA1    TCTR                            S01486
     C******************** Z-ADD*ZEROS    CPNA                            S01486
     C******************** ELSE                                           S01486
     C******************** Z-ADD*ZEROS    TCTR                            S01486
     C******************** Z-ADDZINTDU    CPNA                            S01486
     C******************** END                                            S01486
     C******************** ELSE                                           S01486
     C*
     C** WRITE MATURED SECURITY EXTRACT FILE FOR EACH MATURED SECURITY
     C*
     C           SAAT      IFEQ 'MA'                                      E37289
     C                     MOVE 'C'       RECI
     C                     ELSE                                           E37289
     C                     MOVE 'P'       RECI                            E37289
     C                     END                                            E37289
     C                     ADD  1         WMATUR  50
     C***********          MOVE CSBR      BHBR                            S01117
     C                     MOVE CSBA      BHBA                            S01117
     C                     MOVE CSSC      BHSC
     C                     MOVE '  '      BHBK
     C           SAAT      IFEQ 'MA'                                      E37289
     C                     Z-ADDWNOMAT    TCTR
     C                     Z-ADD*ZEROS    CPNA                            E37289
     C                     ELSE                                           E37289
     C                     Z-ADD*ZEROS    TCTR                            E37289
     C                     Z-ADDZINTDU    CPNA
     C                     END                                            E37289
     C***FS*************** END                                            S01486
      *
      ***  Implicit Moves (i.e. same names on output) as follows:
      ***  CSCN, SDRP, CSNT, CSNV.
      *
     C                     WRITEMATEXDF
     C*
     C           ENDW03    ENDSR                           ** ENDW03 **
      *
      *****************************************************************                CGL031 233709
      /EJECT                                                                           CGL031 233709
      *****************************************************************                CGL031 233709
      *****************************************************************                CGL031 233709
      ***W04****-*Subroutine*to*Output*Tax*Account*Key*&*Amount*Key****                CGL031 233709
      *****************************************************************                CGL031 233709
      *****************************************************************                CGL031 233709
      **********                                                                       CGL031 233709
     C********** W04       BEGSR                                                       CGL031 233709
      **********                                                                       CGL031 233709
      ***Tax*Account*Key*Generation************************************                CGL031 233709
      ***Initialise*fields*********************************************                CGL031 233709
      **********                                                                       CGL031 233709
     C**********           MOVEL'E'       WACEVC                                       CGL031 233709
     C**********           MOVELWCOLC     WARCTR                                       CGL031 233709
     C**********           MOVEL'ET'      WACAMC                                       CGL031 233709
     C**********           Z-ADDWTTXSC    EVAM                                         CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVELTSTXCY    EVCY                                         CGL031 233709
     C**********           MOVELTSOCCY    KCCY                                         CGL031 233709
      *****************************************************************                CGL031 233709
     C********** TSTXCY    IFNE TSOCCY                                                 CGL031 233709
     C**********           Z-ADDWTTXSS    KNCA                                         CGL031 233709
     C**********           Z-ADDWTTXSB    KBCA                                         CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           Z-ADD0         KNCA                                         CGL031 233709
     C**********           Z-ADD0         KBCA                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Do*not*output*records*if*Amount*Due*is*zero*******************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** EVAM      IFEQ *ZERO                                                  CGL031 233709
     C**********           MOVEL*BLANK    WARCTR                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** EVAM      CABEQ0         ENDW04                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Count*records*written*and*use*STD*HASH*Subroutine*************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           ADD  1         W01CNT  50                                   CGL031 233709
      **********                                                                       CGL031 233709
      ***Execute*HASH*TOTALLING*Subroutine*once*(Z=1)*for*First********                CGL031 233709
      ***Array*Elements*(IND,S*DEC,S)*SO*S=1*,Accumulating*ZZAMT(15/3)*                CGL031 233709
      **********                                                                       CGL031 233709
     C**********           Z-ADD1         Z                                            CGL031 233709
     C**********           Z-ADD1         S                                            CGL031 233709
     C**********           Z-ADDEVAM      ZZAMT                                        CGL031 233709
     C**********           EXSR ZHASH                                                  CGL031 233709
      *****************************************************************                CGL031 233709
      ***Build*output*record*******************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVE SITP      WACITY                                       CGL031 233709
     C**********           MOVE ' '       WACTRT                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Access*CLINT*for*DISCRT*IND*for*Portfolio*Flag*in*Key*********                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233709
     C**********           Z-ADDCDCN      WCLNTK                                       CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE CSCN      WCLNTK                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Obtain*Branch*Code*of*Customer*from*CLINTCB*******************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVE 'A'       WLIT1                                        CGL031 233709
     C**********           EXSR CLNTIN                                                 CGL031 233709
     C**********           MOVE '1'       WLIT1                                        CGL031 233709
     C**********           MOVE BRCB      CSBA                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           EXSR CLNTIN                                                 CGL031 233709
     C********** C1DI      IFEQ 'M'                                                    CGL031 233709
     C**********           MOVE *BLANKS   WACPFI                                       CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE C1DI      WACPFI                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVE '  '      WACBKC                                       CGL031 233709
     C**********           MOVE '  '      WACTST                                       CGL031 233709
     C**********           MOVE '  '      WACPSB                                       CGL031 233709
     C**********           MOVE '  '      WACCCC                                       CGL031 233709
     C**********           MOVE MKTI      WACMKT                                       CGL031 233709
     C********** CIAK      IFEQ 'Y'                                                    CGL031 233709
     C********** SCVI      ANDEQ'Y'                                                    CGL031 233709
     C**********           MOVE SCVI      WACCON                                       CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE ' '       WACCON                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C********** WACAMC    IFEQ 'FP'                                                   CGL031 233709
     C********** WACAMC    OREQ 'FR'                                                   CGL031 233709
     C********** WACAMC    OREQ 'CP'                                                   CGL031 233709
     C********** WACAMC    OREQ 'CR'                                                   CGL031 233709
     C**********           MOVE *BLANKS   WACBKC                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           MOVE WACKEY    ACKY                                         CGL031 233709
     C**********           MOVE 'D'       RECI                                         CGL031 233709
      *****************************************************************                CGL031 233709
     C********** PPRE      IFEQ 'R'                                                    CGL031 233709
     C********** SRSM      ANDEQ04                                                     CGL031 233709
     C********** PPRE      OREQ 'P'                                                    CGL031 233709
     C********** SPSM      ANDEQ04                                                     CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE *BLANK    STLA                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** WSRECI    IFEQ 'R'                                                    CGL031 233709
     C**********           MOVE '1'       RVRS                                         CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE '0'       RVRS                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVE SASN      SESH                                         CGL031 233709
     C**********           Z-ADD0         TRFR                                         CGL031 233709
     C**********           MOVELWCLNTK    CSTN                                         CGL031 233709
     C**********           MOVE CSBA      BRHA                                         CGL031 233709
     C**********           Z-ADD00        ASQN                                         CGL031 233709
     C**********           Z-ADDSAED      EVDT                                         CGL031 233709
      *****************************************************************                CGL031 233709
     C********** PPRE      IFEQ 'R'                                                    CGL031 233709
     C********** SRSM      ANDEQ04                                                     CGL031 233709
     C********** PPRE      OREQ 'P'                                                    CGL031 233709
     C********** SPSM      ANDEQ04                                                     CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           Z-ADD0         STLT                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Output*profit*centre*from*related*customer*position***********                CGL031 233709
      *****************************************************************                CGL031 233709
      ******If*Analytical*Accounting*is*installed*and*customer*********                CGL031 233709
      ******position*profit*centre*is*blank,*set*the*profit*centre*to**                CGL031 233709
      ******SE*ICD*default*profit*centre.******************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 233709
     C********** PCCU      ANDEQ*BLANKS                                                CGL031 233709
     C**********           MOVE BVSEPC    PRFC                                         CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE PCCU      PRFC                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Set*Up*Portfolio*Reference*to*be*Output***********************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
     C**********           MOVE PTFR      SSPTFR  4                                    CGL031 233709
     C********** WPORTP    IFNE 'Y'                                                    CGL031 233709
     C**********           MOVE *BLANKS   PTFR                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Write*Generated*Account*Key*Record****************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           WRITESEKEYDF                                                CGL031 233709
     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
     C**********           MOVE SSPTFR    PTFR                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Net*Interest*Amount*Account*Key*Generation********************                CGL031 233709
      ***Initialise*fields*********************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           CLEARSEKEYDF                                                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVEL*BLANK    WARCTR                                       CGL031 233709
     C**********           MOVEL'NI'      WACAMC                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Dividend*Process**********************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** TSETYP    IFEQ 'DV'                                                   CGL031 233709
     C**********           Z-ADDWDIVDU    EVAM                                         CGL031 233709
     C**********                                                                       CGL031 233709
     C***Reverse*sign*of*output*file*if*split*neg*accrual*is*Y*and*****                CGL031 233709
     C***cum-coupon*value*is*less*than*zero****************************                CGL031 233709
     C**********                                                                       CGL031 233709
     C********** WCUMCP    IFLT 0                                                      CGL031 233709
     C********** SNAC      ANDEQ'Y'                                                    CGL031 233709
     C**********           Z-SUBEVAM      EVAM                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Coupon*Process************************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** TSETYP    IFEQ 'CP'                                                   CGL031 233709
     C**********           Z-ADDZINTDU    EVAM                                         CGL031 233709
     C**********                                                                       CGL031 233709
     C***Reverse*sign*of*output*file*if*split*neg*accrual*is*Y*and*****                CGL031 233709
     C***coupon*value*is*less*than*zero********************************                CGL031 233709
     C**********                                                                       CGL031 233709
     C********** ZINTDU    IFLT 0                                                      CGL031 233709
     C********** SNAC      ANDEQ'Y'                                                    CGL031 233709
     C**********           Z-SUBEVAM      EVAM                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Mortgage*Back*Payment*Process*********************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** TSETYP    IFEQ 'MP'                                                   CGL031 233709
     C**********           Z-ADDPAMD      EVAM                                         CGL031 233709
     C**********                                                                       CGL031 233709
     C***Reverse*sign*of*output*file*if*negative*position*is*Y*and*****                CGL031 233709
     C***payment*value*is*less*than*zero*******************************                CGL031 233709
     C**********                                                                       CGL031 233709
     C********** PAMD      IFLT 0                                                      CGL031 233709
     C********** NPAC      ANDEQ'Y'                                                    CGL031 233709
     C**********           Z-SUBEVAM      EVAM                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Maturity*Process**********************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** TSETYP    IFEQ 'MT'                                                   CGL031 233709
     C**********           Z-ADDMATAMT    EVAM                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** EVAM      SUB  WTTXSS    EVAM                                         CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVELTSOCCY    EVCY                                         CGL031 233709
     C**********           MOVELTSOCCY    KCCY                                         CGL031 233709
      *****************************************************************                CGL031 233709
      ***Do*not*output*records*if*Amount*Due*is*zero*******************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** EVAM      IFEQ *ZERO                                                  CGL031 233709
     C**********           MOVEL*BLANK    WARCTR                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** EVAM      CABEQ0         ENDW04                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Count*records*written*and*use*STD*HASH*Subroutine*************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           ADD  1         W01CNT  50                                   CGL031 233709
      *****************************************************************                CGL031 233709
      ***Execute*HASH*TOTALLING*Subroutine*once*(Z=1)*for*First********                CGL031 233709
      ***Array*Elements*(IND,S*DEC,S)*SO*S=1*,Accumulating*ZZAMT(15/3)*                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           Z-ADD1         Z                                            CGL031 233709
     C**********           Z-ADD1         S                                            CGL031 233709
     C**********           Z-ADDEVAM      ZZAMT                                        CGL031 233709
     C**********           EXSR ZHASH                                                  CGL031 233709
      *****************************************************************                CGL031 233709
      ***Build*output*record*******************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVE SITP      WACITY                                       CGL031 233709
     C**********           MOVE ' '       WACTRT                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Access*CLINT*for*DISCRT*IND*for*Portfolio*Flag*in*Key*********                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
     C********** WPORTP    IFEQ 'Y'                                                    CGL031 233709
     C**********           Z-ADDCDCN      WCLNTK                                       CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE CSCN      WCLNTK                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Obtain*Branch*Code*of*Customer*from*CLINTCB*******************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVE 'A'       WLIT1                                        CGL031 233709
     C**********           EXSR CLNTIN                                                 CGL031 233709
     C**********           MOVE '1'       WLIT1                                        CGL031 233709
     C**********           MOVE BRCB      CSBA                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           EXSR CLNTIN                                                 CGL031 233709
     C********** C1DI      IFEQ 'M'                                                    CGL031 233709
     C**********           MOVE *BLANKS   WACPFI                                       CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE C1DI      WACPFI                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVE '  '      WACBKC                                       CGL031 233709
     C**********           MOVE '  '      WACTST                                       CGL031 233709
     C**********           MOVE '  '      WACPSB                                       CGL031 233709
     C**********           MOVE '  '      WACCCC                                       CGL031 233709
     C**********           MOVE MKTI      WACMKT                                       CGL031 233709
     C********** CIAK      IFEQ 'Y'                                                    CGL031 233709
     C********** SCVI      ANDEQ'Y'                                                    CGL031 233709
     C**********           MOVE SCVI      WACCON                                       CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE ' '       WACCON                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C********** WACAMC    IFEQ 'FP'                                                   CGL031 233709
     C********** WACAMC    OREQ 'FR'                                                   CGL031 233709
     C********** WACAMC    OREQ 'CP'                                                   CGL031 233709
     C********** WACAMC    OREQ 'CR'                                                   CGL031 233709
     C**********           MOVE *BLANKS   WACBKC                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           MOVE WACKEY    ACKY                                         CGL031 233709
     C**********           MOVE 'D'       RECI                                         CGL031 233709
      *****************************************************************                CGL031 233709
     C********** PPRE      IFEQ 'R'                                                    CGL031 233709
     C********** SRSM      ANDEQ04                                                     CGL031 233709
     C********** PPRE      OREQ 'P'                                                    CGL031 233709
     C********** SPSM      ANDEQ04                                                     CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE *BLANK    STLA                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** WSRECI    IFEQ 'R'                                                    CGL031 233709
     C**********           MOVE '1'       RVRS                                         CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE '0'       RVRS                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVE SASN      SESH                                         CGL031 233709
     C**********           Z-ADD0         TRFR                                         CGL031 233709
     C**********           MOVELWCLNTK    CSTN                                         CGL031 233709
     C**********           MOVE CSBA      BRHA                                         CGL031 233709
     C**********           Z-ADD00        ASQN                                         CGL031 233709
     C**********           Z-ADDSAED      EVDT                                         CGL031 233709
     C**********           Z-ADD0         KNCA                                         CGL031 233709
     C**********           Z-ADD0         KBCA                                         CGL031 233709
      *****************************************************************                CGL031 233709
     C********** PPRE      IFEQ 'R'                                                    CGL031 233709
     C********** SRSM      ANDEQ04                                                     CGL031 233709
     C********** PPRE      OREQ 'P'                                                    CGL031 233709
     C********** SPSM      ANDEQ04                                                     CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           Z-ADD0         STLT                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Output*profit*centre*from*related*customer*position***********                CGL031 233709
      *****************************************************************                CGL031 233709
      ******If*Analytical*Accounting*is*installed*and*customer*********                CGL031 233709
      ******position*profit*centre*is*blank,*set*the*profit*centre*to**                CGL031 233709
      ******SE*ICD*default*profit*centre.******************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** BGN0ST    IFEQ 'Y'                                                    CGL031 233709
     C********** PCCU      ANDEQ*BLANKS                                                CGL031 233709
     C**********           MOVE BVSEPC    PRFC                                         CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVE PCCU      PRFC                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Set*Up*Portfolio*Reference*to*be*Output***********************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
     C**********           MOVE PTFR      SSPTFR  4                                    CGL031 233709
     C********** WPORTP    IFNE 'Y'                                                    CGL031 233709
     C**********           MOVE *BLANKS   PTFR                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Write*Generated*Account*Key*Record****************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           WRITESEKEYDF                                                CGL031 233709
     C********** BGPFMG    IFEQ 'Y'                                                    CGL031 233709
     C********** BGN4ST    OREQ 'Y'                                                    CGL031 233709
     C**********           MOVE SSPTFR    PTFR                                         CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** ENDW04    ENDSR                                                       CGL031 233709
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  CHKTAX - Subroutine to check if record is existing in        *                       CGL031
      *           SDCTTXPD for taxing.                                *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           CHKTAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Retrieve Branch Location Code                                                        CGL031
      *                                                                                       CGL031
     C**********           CALL 'AOBRCHR0'                                             CGL031 CGL035
     C                     CALL 'AOBRCHR1'                                                    CGL035
     C                     PARM *BLANKS   P@RTCD                                              CGL031
     C                     PARM '*KEY   ' P@OPTN                                              CGL031
     C                     PARM YCSBA     P@BRCD  3                                           CGL031
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        CGL031 CGL035
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL035
      *                                                                                       CGL031
      ** Database Error                                                                       CGL031
      *                                                                                       CGL031
     C           P@RTCD    IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDBRCHL1'DBFILE                                              CGL031
     C                     MOVELYCSBA     DBKEY                                               CGL031
     C                     Z-ADD53        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
     C                     ELSE                                                               CGL031
     C                     MOVELA8LCCD    P@LCCD  3                                           CGL031
      *                                                                                       CGL031
      ** Retrieve Country of Tax                                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'AOLOCNR0'                                                    CGL031
     C                     PARM *BLANKS   P@RTCD                                              CGL031
     C                     PARM '*KEY   ' P@OPTN                                              CGL031
     C                     PARM           P@LCCD                                              CGL031
     C           SDLOCN    PARM SDLOCN    DSFDY                                               CGL031
      *                                                                                       CGL031
      ** Database Error                                                                       CGL031
      *                                                                                       CGL031
     C           P@RTCD    IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDLOCNL1'DBFILE                                              CGL031
     C                     MOVELA8LCCD    DBKEY                                               CGL031
     C                     Z-ADD54        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE DVCNCD    WCTAX   2                                           CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Retrieve Country of Residence                                                        CGL031
      *                                                                                       CGL031
     C                     MOVELYCSCN     P@CSCN 10                                           CGL031
      *                                                                                       CGL031
     C**********           CALL 'AOCUSTR0'                                             CGL031 233792
     C                     CALL 'AOCUSTR1'                                                    233792
     C                     PARM *BLANKS   P@RTCD                                              CGL031
     C                     PARM '*KEY   ' P@OPTN                                              CGL031
     C                     PARM           P@CSCN                                              CGL031
     C                     PARM *BLANKS   P@KYST  7                                           CGL031
     C********** SDCUST    PARM SDCUST    DSSDY                                        CGL031 233792
     C           SDCUST    PARM SDCUST    DSLDY                                               233792
      *                                                                                       233792
      ** Check if customer is closed or deleted                                               233792
      *                                                                                       233792
     C           BBDTDL    IFNE *ZEROS                                                        233792
     C           BBCLST    OREQ 'Y'                                                           233792
     C                     MOVE 'Y'       WNOTAX                                              233792
     C                     GOTO ENCHKT                                                        233792
     C                     ENDIF                                                              233792
      *                                                                                       CGL031
      ** Database Error                                                                       CGL031
      *                                                                                       CGL031
     C           P@RTCD    IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDCUSTL1'DBFILE                                              CGL031
     C                     MOVELYCSCN     DBKEY                                               CGL031
     C                     Z-ADD55        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE BBCOLC    WCOLC   2                                           CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Retrieve Tax Basket                                                                  CGL031
      *                                                                                       CGL031
     C                     CALL 'AOCTTXR0'                                                    CGL031
     C                     PARM *BLANKS   P@RTCD                                              CGL031
     C                     PARM '*KEY   ' P@OPTN                                              CGL031
     C                     PARM WCTAX     P@CTRT  2                                           CGL031
     C                     PARM WCOLC     P@CTRR  2                                           CGL031
     C           SDCTTX    PARM SDCTTX    DSFDY                                               CGL031
      *                                                                                       CGL031
      ** If no record found, accessed with a country of tax and                               CGL031
      ** a blank country of residence.                                                        CGL031
      *                                                                                       CGL031
     C********** P@RTCD    IFEQ 'NRF    '                                              CGL031 234577
     C           P@RTCD    IFEQ '*NRF   '                                                     234577
     C                     CALL 'AOCTTXR0'                                                    CGL031
     C                     PARM *BLANKS   P@RTCD                                              CGL031
     C                     PARM '*KEY   ' P@OPTN                                              CGL031
     C                     PARM WCTAX     P@CTRT                                              CGL031
     C                     PARM *BLANKS   P@CTRR                                              CGL031
     C           SDCTTX    PARM SDCTTX    DSFDY                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ***Database*Error****************                                                CGL031 234440
      *                                                                                       CGL031
      * No tax should be calculated if effective date is in the future                        234440
      *                                                                                       234440
     C           P@RTCD    IFNE *BLANKS                                                       CGL031
     C           EWEDT1    ORGT SAED                                                          234440
     C                     MOVE 'Y'       WNOTAX                                              234440
     C********** *LOCK     IN   LDA                                                    CGL031 234440
     C**********           MOVEL'SDCTTXL1'DBFILE                                       CGL031 234440
     C**********           MOVELWCTAX     DBKEY                                        CGL031 234440
     C**********           Z-ADD56        DBASE                                        CGL031 234440
     C**********           MOVE *ON       *INU7                                        CGL031 234440
     C**********           MOVE *ON       *INU8                                        CGL031 234440
     C**********           EXSR *PSSR                                                  CGL031 234440
     C**********           GOTO EAUDIT                                                 CGL031 234440
     C**********           ENDIF                                                       CGL031 234440
     C**********           ENDIF                                                       CGL031 234440
     C                     ELSE                                                               234440
      *                                                                                       CGL031
     C                     MOVE EWTXBS    WTAXBS  2                                           CGL031
      *                                                                                       CGL031
      ** Retrieve Tax Rate Applicable for Band                                                CGL031
      *                                                                                       CGL031
     C********** SAAT      IFEQ 'CP'                                                   233863 234440
     C                     Z-ADDSAED      P@DATE  50                                          233863
     C**********           ELSE                                                        233863 234440
     C**********           Z-ADDBJRDNB    P@DATE                                       233863 234440
     C**********           ENDIF                                                       233863 234440
      *                                                                                       233863
     C                     CALL 'AOTXBSR0'                                                    CGL031
     C                     PARM *BLANKS   P@RTCD                                              CGL031
     C                     PARM '*KEY   ' P@OPTN                                              CGL031
     C                     PARM WCTAX     P@CTTT  2                                           CGL031
     C                     PARM WTAXBS    P@TXBS  2                                           CGL031
     C***********          PARM BJRDNB    P@DATE  50                                   CGL031 233863
     C                     PARM           P@DATE                                              233863
     C                     PARM           P@NARR 15                                           CGL031
     C                     PARM           P@RATE  64                                          CGL031
      *                                                                                       CGL031
     C           P@RTCD    IFEQ *BLANKS                                                       CGL031
     C                     MOVE ' '       WNOTAX  1                                           CGL031
     C                     Z-ADDP@RATE    WTRAB   64                                          CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
      ** If no record found, no tax is calculated.                                            CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WNOTAX                                              CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              234440
      *                                                                                       CGL031
     C**********           ENDSR                                                       CGL031 233792
     C           ENCHKT    ENDSR                                                              233792
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  CPNTAX - Subroutine to calculate tax for descretionary and   *                       CGL031
      *           safe custody customers.                             *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           CPNTAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Check if record needs to be taxed.                                                   CGL031
      *                                                                                       CGL031
     C                     EXSR CHKTAX                                                        CGL031
      *                                                                                       CGL031
      ** Accrued Coupon must be calculated from the last coupon date upto                     CGL031
      ** event control date unless the last coupon date is before the effective               CGL031
      ** date from SDCTTXL1 and the transition type from SDCTTXL1 is equal to 1,              CGL031
      ** in which case the accrued coupon is calculated from the effective date               CGL031
      ** to the event control date.                                                           CGL031
      *                                                                                       CGL031
      ***Set*ZFMDAT*to*the*greater*value*between*SALCCP*and*Effective*Date             CGL031 234440
      *                                                                                       CGL031
     C           WNOTAX    IFEQ ' '                                                           CGL031
      *                                                                                       CGL031
     C**********           Z-ADDSALCCP    WFRDAT                                       CGL031 234440
     C                     Z-ADDSALCCP    WFRDAT  50                                          234440
     C********** EWTRT1    IFEQ '1'                                                    CGL031 234440
     C********** EWEDT1    ANDGTSALCCP                                                 CGL031 234440
     C**********           Z-ADDEWEDT1    WFRDAT  50                                   CGL031 234440
     C**********           ENDIF                                                       CGL031 234440
      *                                                                                       CGL031
      *                                                                                       CGL031
      ** Calculate Interest due via P/ZACCRC for Security                                     CGL031
      ** From Date is Last Coupon / To Date is Event Date.                                    CGL031
      ** Get Nominal CCY Dec Places from TABTG10 FIRST (CDP)                                  CGL031
      *                                                                                       CGL031
     C                     MOVE NMCY      WCURR                                               CGL031
     C                     EXSR TG10                                                          CGL031
      *                                                                                       CGL031
      ** Save_No_of_Decimal_Places.                                                           CGL031
      *                                                                                       CGL031
     C           BGPFMG    IFEQ 'Y'                                                           CGL031
     C           BGN4ST    OREQ 'Y'                                                           CGL031
     C                     Z-ADDCDP       WWCDP                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** When Parm ZAB is 'A' , Interest is Calculated After Changes                          CGL031
      *                                                                                       CGL031
     C********** SAED      SUB  1         WDATE   50                                   234440 234552
     C                     Z-ADDSAED      WDATE   50                                          234552
      *                                                                                       CGL031
      ** If Settlements Based on Portfolio Positions use Standard PM                          CGL031
      ** Subroutines to Calculate Accrual Amount                                              CGL031
     C           WPORTP    IFEQ 'Y'                                                           CGL031
     C           BGPFMG    ANDEQ'Y'                                                           CGL031
     C           WPORTP    OREQ 'Y'                                                           CGL031
     C           BGN4ST    ANDEQ'Y'                                                           CGL031
      *                                                                                       CGL031
      ** If the Processing Type from LF/INVTP is not Equal to 6 IE.                           CGL031
      ** This is not a SCHULDSCHEIN Security                                                  CGL031
      *                                                                                       CGL031
     C           PROT      IFNE '6'                                                           CGL031
     C                     Z-ADDWCUMCP    ZAMTP                                               CGL031
     C                     Z-ADDWFRDAT    ZFMDAT                                              CGL031
     C                     Z-ADDSAED      ZTODAT                                              CGL031
     C                     Z-ADDSAED      NCD                                                 CGL031
     C                     MOVELCDSN      ZSSNM                                               CGL031
     C                     Z-ADDWWCDP     A6NBDP                                              CGL031
      *                                                                                       CGL031
      ** Calculate the Accrued Interest from the Last Coupon Date to                          CGL031
      ** the Event Control Date as per Standard Subroutine ZAINSH                             CGL031
      *                                                                                       CGL031
     C                     EXSR ZAINSH                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If the Processing Type from LF/INVTP is Equal to 6 IE.                               CGL031
      ** This is a SCHULDSCHEIN Security                                                      CGL031
      *                                                                                       CGL031
     C           PROT      IFEQ '6'                                                           CGL031
     C                     Z-ADDWFRDAT    ZFMDAT                                              CGL031
     C                     Z-ADDSAED      ZTODAT                                              CGL031
     C                     Z-ADDSAED      NCD                                                 CGL031
     C                     MOVE CDPA      ZCDPA                                               CGL031
     C**********           Z-ADDCDCN      XCUST   60                                   CGL031 CSD027
     C                     MOVE CDCN      XCUST   6                                           CSD027
     C                     MOVELPTFR      ZPTRF                                               CGL031
     C                     MOVELCDSN      ZSSNM                                               CGL031
     C**********           Z-ADDCDPT      ZCDDP                                        CGL031 CSD027
     C                     MOVELCDPT      ZCDDP                                               CSD027
     C                     MOVELCDMK      ZCDMK                                               CGL031
     C                     Z-ADDWWCDP     A6NBDP                                              CGL031
      *                                                                                       CGL031
      ** Calculate the Accrued Interest from the Last Coupon Date                             CGL031
      ** to the Event Control Date as per Standard Subroutine ZAISCH                          CGL031
      *                                                                                       CGL031
     C                     EXSR ZAISCH                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDZTOAI     ZINTDU                                              CGL031
      *                                                                                       234440
      ** Get Purchased interest on position by accessing ETCPOSND                             234440
      *                                                                                       234440
     C**********           Z-ADDCDCN      CDCNZN                                       236816 CSD027
     C                     MOVELCDCN      CDCNZN                                              CSD027
     C                     CALL WPGM                                                          234440
     C                     PARM           WRTCD  10                                           234440
     C                     PARM           CDPA                                                234440
     C*********************PARM           CDCN                                         234440 236816
     C                     PARM           CDCNZN                                              236816
     C                     PARM           CDSN                                                234440
     C                     PARM           PTFR                                                234440
     C                     PARM           CDMK                                                234440
     C                     PARM           WDATE                                               234440
     C                     PARM           ETCPOS                                              234440
      *                                                                                       CGL031
      ** When Parm ZAB is 'A' , Interest is Calculated After Changes                          CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'A'       ZAB                                                 CGL031
     C                     CALL 'ZACCRC'                                                      CGL031
     C                     PARM           WFRDAT                                              CGL031
     C                     PARM           SAED                                                CGL031
     C                     PARM           CSBA                                                CGL031
     C                     PARM           ZCUST                                               CGL031
     C                     PARM           CSSC                                                CGL031
     C                     PARM           CDP                                                 CGL031
     C                     PARM           ZINTDU                                              CGL031
     C                     PARM           ZAB                                                 CGL031
      **********                                                                AR1001183 AR1001183A
     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
     C********** WRCHG     ANDEQ'Y'                                             AR1001183 AR1001183A
     C********** FRATE     IFLE 0                                               AR1001183 AR1001183A
      ***The*following*fields*set*PAMD*to*any*value(ie zero)                    AR1001183 AR1001183A
     C**********           Z-ADD0         ZINTDU                                AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      *                                                                                       CGL031
      **  U7 and U8 off if no Database Error during ZACCR Processing                          CGL031
      **  but DBPGM nedds to reset                                                            CGL031
      *                                                                                       CGL031
     C           *INU7     IFEQ '0'                                                           CGL031
     C           *INU8     ANDEQ'0'                                                           CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVE *BLANKS   DBPGM                                               CGL031
     C                     MOVEL'SE2400'  DBPGM                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       234440
      ** Get Purchased interest on position by accessing ETCPOSND                             234440
      *                                                                                       234440
     C                     CALL WPGM                                                          234440
     C                     PARM           WRTCD  10                                           234440
     C                     PARM           CSBA                                                234440
     C**********           PARM           CSSC                                         234440 236815
     C                     PARM           CSCN                                                234440
     C                     PARM           CSSC                                                236815
     C                     PARM *BLANKS   WPTFR   4                                           234440
     C                     PARM 'S'       WMKT    1                                           234440
     C                     PARM           WDATE                                               234440
     C                     PARM           ETCPOS                                              234440
     C                     ENDIF                                                              CGL031
      *                                                                                       234440
      ** If Purchased interest is from a date prior to last coupon date                       234440
      *  then zero-ize it.                                                                    234440
      *                                                                                       234440
     C           CSDA      IFLT SALCCP                                                        234440
     C                     Z-ADD0         CSPI                                                234440
     C                     ENDIF                                                              234440
      *                                                                                       234440
      ** Calculate pro rate of purchased interest in case nominal on                          236480
      ** ETCPOSND (CSNV) not equal nominal of coupon (PNMP)                                   236480
     C           PNMP      IFNE CSNV                                                          236480
     C           CSNV      IFNE 0                                                             236480
     C           PNMP      DIV  CSNV      WORK   249H                                         236480
     C           CSPI      MULT WORK      CSPI      H                                         236480
     C                     ELSE                                                               236480
     C                     Z-ADD0         CSPI                                                236480
     C                     ENDIF                                                              236480
     C                     ENDIF                                                              236480
      *                                                                                       236480
      ** Taxable amount is amount due minus purchased interest                                234440
      *                                                                                       234440
     C           ZINTDU    SUB  CSPI      ZINTDU                                              234440
      *                                                                                       236137
      ** If Amortized premium has to be deducted from taxable amount,                         236137
      ** it must be calculated as follows:                                                    236137
      *                                                                                       236137
     C           EWPADD    IFEQ 'Y'                        Begin Premium to Deduct            236137
     C           ISSP      ANDGT100                                                           236137
      *                                                                                       236137
      ** Calculate the amortized premium amount from last position to                         236137
      ** maturity date of Security.                                                           236137
      *                                                                                       236137
     C           LAVP      SUB  100       WWPAMT 308                                          236137
     C                     MULT CSNV      WWPAMT                                              236137
     C           MATY      SUB  CSDA      WWDAYS                                              236137
     C                     DIV  WWDAYS    WWPAMT                                              236137
      *                                                                                       236137
      ** Final calculation must take in account taxable period between                        236137
      ** latter from the last coupon date and the taxation effective date,                    236137
      ** and the event control date.                                                          236137
      *                                                                                       236137
     C           SALCCP    IFGT EWEDT1                                                        236137
     C           SAED      SUB  SALCCP    WWDAYS                                              236137
      *                                                                                       236137
     C                     ELSE                                                               236137
     C           SAED      SUB  EWEDT1    WWDAYS                                              236137
      *                                                                                       236137
     C                     ENDIF                                                              236137
     C                     MULT WWDAYS    WWPAMT                                              236137
      *                                                                                       236137
      ** If amortized premium amount is less than 0, set it to 0.                             236137
      *                                                                                       236137
     C           WWPAMT    IFLT 0                                                             236137
     C                     Z-ADD0         WWPAMT                                              236137
      *                                                                                       236137
     C                     ENDIF                                                              236137
      *                                                                                       236137
      ** Taxable amount is amount due minus amortized premium amount.                         236137
      *                                                                                       236137
     C                     SUB  WWPAMT    ZINTDU                                              236137
     C           ZINTDU    IFLT 0                                                             236137
     C                     Z-ADD0         ZINTDU                                              236137
      *                                                                                       236137
     C                     ENDIF                                                              236137
      *                                                                                       236137
     C                     ENDIF                           End Premium to Deduct              236137
      *                                                                                       CGL031
      ** If S01509 is active, and value currency is different from                            CGL031
      ** nominal currency, convert coupon amount to value currency                            CGL031
      *                                                                                       CGL031
     C           S01509    IFEQ 'Y'                                                           CGL031
     C           NMCY      ANDNEVLCY                                                          CGL031
     C                     MOVE NMCY      WCURR                                               CGL031
     C                     EXSR TG10                                                          CGL031
     C                     Z-ADDZCDP      ZCDPI                                               CGL031
     C                     MOVE VLCY      WCURR                                               CGL031
     C                     EXSR TG10                                                          CGL031
     C                     Z-ADDZCDP      ZCDPO                                               CGL031
     C                     MOVE NMCY      ZCCYI                                               CGL031
     C                     MOVE VLCY      ZCCYO                                               CGL031
     C                     Z-ADDZINTDU    ZAMTCI                                              CGL031
      *                                                                                       CGL031
      ** Exchange rate and Mult/Div Ind can be from SECEO if 'XR' event                       CGL031
      ** found, else from SECTYD                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE SAAT      WSAAT                                               CGL031
     C                     MOVE 'XR'      SAAT                                                CGL031
     C           SEDKEY    SETLLSEDEVDO                                                       CGL031
     C                     READ SEDEVDO                  81                                   CGL031
     C           *IN81     IFEQ '0'                                                           CGL031
     C           SDSN      ANDEQSASN                                                          CGL031
     C           SDET      ANDEQ'XR'                                                          CGL031
     C                     Z-ADDSDCE      ZEXCH                                               CGL031
     C                     MOVE SDMD      ZMD                                                 CGL031
     C                     ELSE                                                               CGL031
     C                     Z-ADDSEXR      ZEXCH                                               CGL031
     C                     MOVE SMDI      ZMD                                                 CGL031
     C                     ENDIF                                                              CGL031
     C                     MOVE WSAAT     SAAT                                                CGL031
     C                     EXSR ZCONV                                                         CGL031
     C                     Z-ADDZAMTCO    ZINTDU                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If no record found, no tax is calculated                                             CGL031
      *                                                                                       CGL031
      ** Calculate Tax Amount for the Coupon and Output Information on SDCSINPD               CGL031
      *                                                                                       CGL031
     C           WNOTAX    IFEQ ' '                                                           CGL031
     C                     EXSR CPTXCL                                                        CGL031
      *                                                                                       CGL031
      ***Output*Tax*Account*Keys***************************************                CGL031 233709
      ***********                                                                      CGL031 233709
     C***********          EXSR W04                                                    CGL031 233709
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              234440
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      *  CPTXCL - Subroutine to calculate tax amount for the Coupon   *                       CGL031
      *           and to Output Information on SDCSINPD               *                       CGL031
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           CPTXCL    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialise work variables                                                            CGL031
      *                                                                                       CGL031
     C**********           Z-ADD0         WTTXSR 150                                   CGL031 233709
     C**********           Z-ADD0         WTTXSS 150                                   CGL031 233709
     C**********           Z-ADD0         WTTXSC 150                                   CGL031 233709
     C**********           Z-ADD0         WTTXSB 150                                   CGL031 233709
     C**********           Z-ADD0         WTNINT 150                                   CGL031 233709
     C**********           Z-ADD0         WTNINS 150                                   CGL031 233709
     C**********           Z-ADD0         WTNINC 150                                   CGL031 233709
     C**********           Z-ADD0         WTNINB 150                                   CGL031 233709
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
     C                     MOVE ' '       WTXPI   1                                           CGL031
     C                     MOVE ' '       WTXJA   1                                           CGL031
      *                                                                                       CGL031
     C                     MOVE YCSCN     @@CUST                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLPI'                                                    CGL031
      ** Input                                                                                CGL031
     C                     PARM 'S'       @@MODI  1                                           CGL031
     C**********           PARM SASN      @@TRRF 18                                    CGL031 CGL035
     C                     PARM SASN      @@TRRF 24                                           CGL035
     C                     PARM YCSBA     @@BRCA  3                                           CGL031
     C                     PARM           @@CUST  6                                           CGL031
     C                     PARM *ZERO     @@STRD  50                                          CGL031
     C                     PARM *ZERO     @@ENDD  50                                          CGL031
     C                     PARM ZINTDU    @@TOTI 150                                          CGL031
     C                     PARM WTRAB     @@TAXR  64                                          CGL031
     C**********           PARM EVCY      @@OCCY  3                                    CGL031 233568
     C                     PARM NMCY      @@OCCY  3                                           233568
     C                     PARM *BLANKS   PINTH                                               CER048
      ** Output                                                                               CGL031
     C                     PARM           @@IAED 150                                          CGL031
     C                     PARM           @@TAXA 150                                          CGL031
     C                     PARM           @@TOTO 150                                          CGL031
     C                     PARM           @@TXCY  3                                           CGL031
     C                     PARM           @@CTAX  2                                           CGL031
     C                     PARM           @@TXBS  2                                           CGL031
     C**********           PARM           @@WTAC  40                                   CGL031 CGL035
     C                     PARM           @@WTAC 100                                          CGL035
     C                     PARM           @@COLC  2                                           CGL031
     C                     PARM           @@STAT  5                                           CGL031
     C                     PARM           @@TRTE  1                                           CGL031
     C                     PARM           @@TXR1  64                                          CGL031
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY  10                                           CGL031
     C                     PARM           @@FILE 10                                           CGL031
     C                     PARM           @@RTRN  7                                           CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
      ** If return code = Error.                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHEQ 'ERROR'                                                       CGL031
     C                     MOVE @@FILE    DBFILE                                              CGL031
     C                     MOVE @@KEY     DBKEY                                               CGL031
     C                     Z-ADD57        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
      *                                                                                       CGL031
      ** If return code = Private Individual                                                  CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHNE 'JOINT'                                                       CGL031
      *                                                                                       CGL031
     C           @@TOTO    IFNE *ZERO                                                         CGL031
     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
     C           @@STAT    OREQ 'DISCL'                                                       CGL031
     C           @@STAT    OREQ 'SELF'                                                        CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WTXPI                                               CGL031
     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
     C                     MOVE S1CTTA    KCSIS                                               236815
     C                     MOVE @@CTAX    KCTRT                                               CGL031
      *                                                                                       CGL031
     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
     C           *IN61     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
     C           TCTXCM    WHEQ 1                                                             CGL031
     C********** *IN80     OREQ *ON                                                    CGL031 236815
     C           SWHTFD    OREQ 'N'                                                           236815
     C********** S1RASO    OREQ 0                                                      CGL031 234813
     C           UTXRSR    OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 2                                                             CGL031
     C********** URATE     MULT @@TOTI    WTAXA  150                                   CGL031 236696
     C********** @@TOTI    SUB  WTAXA     @@TAXA                                       CGL031 236696
     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               236815
     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236696
     C                     MULT @@TAXR    @@TAXA                                              CGL031
     C                     DIV  100       @@TAXA    H                                         CGL031
     C           @@TAXA    IFLT 0                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 3                                                             CGL031
     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C                     DIV  100       WTAXA                                               236815
     C                     SUB  WTAXA     @@TAXA                                              CGL031
     C           @@TAXA    IFLT 0                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 4                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Write record to SDCSINPD                                                             CGL031
      *                                                                                       CGL031
     C                     EXSR CSINSR                                                        CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If return code = Joint Account                                                       CGL031
      *                                                                                       CGL031
     C           @@RTRN    WHEQ 'JOINT'                                                       CGL031
     C                     MOVE YCSCN     KJANO                                               CGL031
      *                                                                                       CGL031
     C           KJANO     SETLLSDJACCLB                                                      CGL031
     C           KJANO     READESDJACCLB                 60                                   CGL031
      *                                                                                       CGL031
     C           *IN60     DOWEQ*OFF                                                          CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLJA'                                                    CGL031
      ** Input                                                                                CGL031
     C                     PARM 'S'       @@MODI                                              CGL031
     C                     PARM SASN      @@TRRF                                              CGL031
     C                     PARM YCSBA     @@BRCA                                              CGL031
     C                     PARM JCJANO    @@JANO  6                                           CGL031
     C                     PARM JCCUST    @@CUST                                              CGL031
     C                     PARM JCNAHO    @@NARF 10                                           CGL031
     C                     PARM JCINVP    @@INVP 10                                           CGL031
     C                     PARM *ZERO     @@STRD                                              CGL031
     C                     PARM *ZERO     @@ENDD                                              CGL031
     C                     PARM ZINTDU    @@TOTI                                              CGL031
     C                     PARM WTRAB     @@TAXR                                              CGL031
     C**********           PARM EVCY      @@OCCY                                       CGL031 233568
     C                     PARM NMCY      @@OCCY                                              233568
     C                     PARM *BLANKS   PINTH                                               CER048
      ** Output                                                                               CGL031
     C                     PARM           @@IAED                                              CGL031
     C                     PARM           @@TAXA                                              CGL031
     C                     PARM           @@TOTO                                              CGL031
     C                     PARM           @@TXCY                                              CGL031
     C                     PARM           @@CTAX                                              CGL031
     C                     PARM           @@TXBS                                              CGL031
     C                     PARM           @@WTAC                                              CGL031
     C                     PARM           @@COLC                                              CGL031
     C                     PARM           @@STAT                                              CGL031
     C                     PARM           @@TRTE                                              CGL031
     C                     PARM           @@TXR1                                              CGL031
     C                     PARM           @@JAMG                                              CGL031
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY                                               CGL031
     C                     PARM           @@FILE                                              CGL031
     C                     PARM           @@RTRN                                              CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
      ** If return code = Error.                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'ERROR'                                                       CGL031
     C                     MOVE @@FILE    DBFILE                                              CGL031
     C                     MOVE @@KEY     DBKEY                                               CGL031
     C                     Z-ADD58        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     GOTO EAUDIT                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           @@TOTO    IFNE *ZERO                                                         CGL031
     C           @@STAT    IFEQ 'TAXAB'                                                       CGL031
     C           @@STAT    OREQ 'DISCL'                                                       CGL031
     C           @@STAT    OREQ 'SELF '                                                       CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WTXJA                                               CGL031
     C**********           MOVE WCTAX     KCSIS                                        CGL031 236815
     C                     MOVE S1CTTA    KCSIS                                               236815
     C                     MOVE @@CTAX    KCTRT                                               CGL031
      *                                                                                       CGL031
     C           KTXCM     CHAINSDTXCML1             61                                       CGL031
     C           *IN61     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
     C           TCTXCM    WHEQ 1                                                             CGL031
     C********** *IN80     OREQ *ON                                                    CGL031 236815
     C           SWHTFD    OREQ 'N'                                                           236815
     C********** S1RASO    OREQ 0                                                      CGL031 234813
     C           UTXRSR    OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 2                                                             CGL031
     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
     C********** @@TOTI    SUB  WTAXA     @@TAXA                                       CGL031 236696
     C********** URATE     MULT @@TOTO    WTAXA  150                                   236696 236815
     C********** S1RASO    MULT @@TOTO    WTAXA  150                                   236815 234813
     C           UTXRSR    MULT @@TOTO    WTAXA  150                                          234813
     C                     DIV  100       WTAXA                                               236815
     C           @@TOTO    SUB  WTAXA     @@TAXA                                              236696
     C                     MULT @@TAXR    @@TAXA                                              CGL031
     C                     DIV  100       @@TAXA    H                                         CGL031
     C           @@TAXA    IFLT 0                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 3                                                             CGL031
     C********** URATE     MULT @@TOTI    WTAXA                                        CGL031 236696
     C********** URATE     MULT @@TOTO    WTAXA                                        236696 236815
     C********** S1RASO    MULT @@TOTO    WTAXA                                        236815 234813
     C                     DIV  100       WTAXA                                               236815
     C                     SUB  WTAXA     @@TAXA                                              CGL031
     C           @@TAXA    IFLT 0                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TCTXCM    WHEQ 4                                                             CGL031
     C                     Z-ADD0         @@TAXA                                              CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Write record to SDCSINPD                                                             CGL031
      *                                                                                       CGL031
     C                     EXSR CSINSR                                                        CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'NOTAX'                                                       CGL031
     C           @@RTRN    OREQ 'TAXAB'                                                       CGL031
     C           KJANO     READESDJACCLB                 60                                   CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If @@RTRN = Last, end loop                                                           CGL031
      *                                                                                       CGL031
     C           @@RTRN    IFEQ 'LAST'                                                        CGL031
     C                     MOVE *ON       *IN60                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C           ENDCPT    ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *                                                               *                       CGL031
      ***CSINSR*-*Subroutine*to*Output*Information*on*PF/SDCSINPD******                CGL031 233709
      *  CSINSR - Subroutine to Calculate Tax Amounts for PF/POSETD   *                       233709
      *                                                               *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           CSINSR    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C**********           Z-ADDBJRDNB    TSRDNB                                       CGL031 233709
     C**********           Z-ADDSAED      TSEDAT                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Get*Tax*Year*from*Tax*Calculation*Date************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           Z-ADDTSEDAT    ZDAYNO                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           CALL 'ZDATE2'                                               CGL031 233709
     C**********           PARM           ZDAYNO  50                                   CGL031 233709
     C**********           PARM           BJDFIN                                       CGL031 233709
     C**********           PARM           ZDATE   60                                   CGL031 233709
     C**********           PARM           ZADATE  7                                    CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVE ZDATE     TSTAXY                                       CGL031 233709
     C**********           MOVEL'20'      TSTAXY                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** BJDFIN    IFEQ 'D'                                                    CGL031 233709
     C**********           MOVELZDATE     WDATE1  4                                    CGL031 233709
     C**********           MOVE WDATE1    TSTAXM                                       CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           MOVELZDATE     TSTAXM                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVEL@@CTAX    TSCTRT                                       CGL031 233709
     C**********           MOVEL@@BRCA    TSBRCA                                       CGL031 233709
     C**********           MOVEL@@CUST    TSCUST                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** WTXJA     IFEQ 'Y'                                                    CGL031 233709
     C**********           MOVEL@@JANO    TSJOIN                                       CGL031 233709
     C**********           MOVEL@@NARF    TSNAHO                                       CGL031 233709
     C**********           MOVEL@@INVP    TSINVP                                       CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           Z-ADD*ZERO     TSJOIN                                       CGL031 233709
     C**********           MOVE *BLANKS   TSNAHO                                       CGL031 233709
     C**********           MOVE *BLANKS   TSINVP                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *                                                                                       CGL031
      ** Get Customer Status                                                                  CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
     C           @@STAT    WHEQ 'DISCL'                                                       CGL031
     C**********           MOVEL'D'       TSSTAT                                       CGL031 233709
     C                     MOVEL'D'       TSSTAT  1                                           233709
     C           @@STAT    WHEQ 'SELF'                                                        CGL031
     C                     MOVEL'S'       TSSTAT                                              CGL031
     C           @@STAT    WHEQ 'TAXAB'                                                       CGL031
     C                     MOVEL'T'       TSSTAT                                              CGL031
     C                     ENDSL                                                              CGL031
      *****************************************************************                CGL031 233709
      **Get*Details*either*from*SDACUSPD*or*SDNAHOPD*******************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           SELEC                                                       CGL031 233709
     C********** @@CUST    WHNE *BLANK                                                 CGL031 233709
     C********** @@CUST    CHAINSDACUSL1             60                                CGL031 233709
     C********** *IN60     IFEQ *OFF                                                   CGL031 233709
     C**********           MOVELE5CNA1    TSFAMN                                       CGL031 233709
     C**********           MOVELE5CNA1    TSFIRN                                       CGL031 232543
     C**********           MOVELE5CNA2    TSFIRN                                       232543 233709
     C********** E5CNA3    CAT  E5CNA4:1  TSSTRT                                       CGL031 233709
     C**********           MOVELE5ZIPC    TSZIPC                                       CGL031 233709
     C**********           MOVELE5CITY    TSCITY                                       CGL031 233709
     C**********           MOVELE5TINO    TSRTIN                                       CGL031 233709
     C**********           MOVELE5DBTH    TSDBTH                                       CGL031 233709
     C**********           MOVELE5BTHT    TSTBTH                                       CGL031 233709
     C**********           MOVELE5BTHC    TSCBTH                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** @@NARF    WHNE *BLANK                                                 CGL031 233709
     C********** @@NARF    CHAINSDNAHOL1             60                                CGL031 233709
     C********** *IN60     IFEQ *OFF                                                   CGL031 233709
     C**********           MOVELNHIDE1    TSFAMN                                       CGL031 233709
     C**********           MOVELNHIDE2    TSFIRN                                       CGL031 233709
     C********** NHIDE3    CAT  NHIDE4:1  TSSTRT                                       CGL031 233709
     C**********           MOVELNHZIPC    TSZIPC                                       CGL031 233709
     C**********           MOVELNHCITY    TSCITY                                       CGL031 233709
     C**********           MOVELNHTINO    TSRTIN                                       CGL031 233709
     C**********           MOVELNHDBTH    TSDBTH                                       CGL031 233709
     C**********           MOVELNHBTHT    TSTBTH                                       CGL031 233709
     C**********           MOVELNHBTHC    TSCBTH                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           ENDSL                                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Get*Interest*Payment*Date*************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           Z-ADDSAED      @@DAYN  50                                   CGL031 233709
     C**********           EXSR ZDATE9                                                 CGL031 233709
     C**********           MOVE @@VDT     TSIPDT                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVEL@@COLC    TSRCTR                                       CGL031 233709
     C**********           MOVEL@@TXBS    TSTXBS                                       CGL031 233709
     C**********           MOVEL@@WTAC    TSWTAC                                       CGL031 233709
     C**********           MOVEL@@OCCY    TSOCCY                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C                     MOVEL@@OCCY    TSOCCY  3                                           233709
     C                     Z-ADD@@DAYN    @@DAYN  50                                          233709
      *                                                                                       233709
      ** Get Original Spot Rate                                                               CGL031
      *                                                                                       CGL031
     C                     MOVELTSOCCY    WCURR                                               CGL031
     C                     Z-ADD29        WDBAS1                                              CGL031
     C                     EXSR #LCURR                                                        CGL031
     C           A6MDIN    IFEQ 'D'                                                           CGL031
     C                     MOVELA6SPRT    TSOCSR                                              CGL031
     C                     ELSE                                                               CGL031
     C********** 1         DIV  A6SPRT    TSOCSR    H                                  CGL031 233709
     C           1         DIV  A6SPRT    TSOCSR 138H                                         233709
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C**********           MOVEL'D'       TSOCMD                                       CGL031 233709
     C**********           MOVELA6NBDP    TSOCDP                                       CGL031 233709
     C**********           MOVELTSOCCY    TSSCCY                                       CGL031 233709
     C**********           MOVELTSOCSR    TSSCSR                                       CGL031 233709
     C**********           MOVELTSOCMD    TSSCMD                                       CGL031 233709
     C**********           MOVELTSOCDP    TSSCDP                                       CGL031 233709
     C**********           MOVEL@@TXCY    TSTXCY                                       CGL031 233709
     C**********           MOVEL@@TXCY    TSTCSR                                       CGL031 232543
     C                     MOVEL'D'       TSOCMD  1                                           233709
     C                     MOVELA6NBDP    TSOCDP  10                                          233709
     C                     MOVELTSOCCY    TSSCCY  3                                           233709
     C                     MOVELTSOCSR    TSSCSR 138                                          233709
     C                     MOVELTSOCMD    TSSCMD  1                                           233709
     C                     MOVELTSOCDP    TSSCDP  10                                          233709
     C                     MOVEL@@TXCY    TSTXCY  3                                           233709
      *                                                                                       CGL031
      ** Get Currency Spot Rate                                                               CGL031
      *                                                                                       CGL031
     C                     MOVELTSTXCY    WCURR                                               CGL031
     C                     EXSR #LCURR                                                        CGL031
     C           A6MDIN    IFEQ 'D'                                                           CGL031
     C**********           MOVELA6SPRT    TSTCSR                                       CGL031 233709
     C                     MOVELA6SPRT    TSTCSR 138                                          233709
     C                     ELSE                                                               CGL031
     C           1         DIV  A6SPRT    TSTCSR    H                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C**********           MOVEL'D'       TSTCMD                                       CGL031 233709
     C**********           MOVELA6NBDP    TSTCDP                                       CGL031 233709
     C                     MOVEL'D'       TSTCMD  1                                           233709
     C                     MOVELA6NBDP    TSTCDP  10                                          233709
      *                                                                                       CGL031
      ** Get Orig/Settlement Currency Exchange Rate                                           CGL031
      ** Get Orig/Settlement Cross Rate                                                       CGL031
      *                                                                                       CGL031
     C                     Z-ADDTSOCSR    ZRATE1                                              CGL031
     C                     MOVE TSOCMD    ZMDI1                                               CGL031
     C                     Z-ADDTSSCSR    ZRATE2                                              CGL031
     C                     MOVE TSSCMD    ZMDI2                                               CGL031
     C                     EXSR ZXRATE                                                        CGL031
     C**********           Z-ADDZRATEX    TSXROS                                       CGL031 233709
     C**********           MOVE ZMDIX     TSOSMD                                       CGL031 233709
     C                     Z-ADDZRATEX    TSXROS 138                                          233709
     C                     MOVE ZMDIX     TSOSMD  1                                           233709
      *                                                                                       CGL031
      ** Get Settlement/Tax Currency Exchange Rate                                            CGL031
      *                                                                                       CGL031
     C                     Z-ADDTSSCSR    ZRATE1                                              CGL031
     C                     MOVE TSSCMD    ZMDI1                                               CGL031
     C                     Z-ADDTSTCSR    ZRATE2                                              CGL031
     C                     MOVE TSTCMD    ZMDI2                                               CGL031
     C                     EXSR ZXRATE                                                        CGL031
     C**********           Z-ADDZRATEX    TSXRST                                       CGL031 233709
     C**********           MOVE ZMDIX     TSSTMD                                       CGL031 233709
     C                     Z-ADDZRATEX    TSXRST 138                                          233709
     C                     MOVE ZMDIX     TSSTMD  1                                           233709
      *                                                                                       CGL031
     C**********           MOVEL'S'       TSMODI                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVEL*BLANKS   TSINST                                       CGL031 233709
     C**********           SELEC                                                       CGL031 233709
     C********** SAAT      WHEQ 'CP'                                                   CGL031 233709
     C**********           MOVEL'CP'      TSETYP                                       CGL031 233709
     C********** SESN      CAT  WINST1    TSINST                                       CGL031 233709
     C********** SAAT      WHEQ 'DV'                                                   CGL031 233709
     C**********           MOVEL'DV'      TSETYP                                       CGL031 233709
     C********** SESN      CAT  WINST2    TSINST                                       CGL031 233709
     C********** SAAT      WHEQ 'MA'                                                   CGL031 233709
     C**********           MOVEL'MT'      TSETYP                                       CGL031 233709
     C********** SESN      CAT  WINST3    TSINST                                       CGL031 233709
     C********** SAAT      WHEQ 'MP'                                                   CGL031 233709
     C**********           MOVEL'MP'      TSETYP                                       CGL031 233709
     C********** SESN      CAT  WINST4    TSINST                                       CGL031 233709
     C**********           ENDSL                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           Z-ADD*ZERO     TSDLLN                                       CGL031 233709
     C**********           Z-ADD*ZERO     TSACOD                                       CGL031 233709
     C**********           Z-ADD*ZERO     TSACSQ                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVELSESN      TSSESN                                       CGL031 233709
     C**********           MOVELSRPN      TSSRPN                                       CGL031 233709
     C**********           MOVELISNO      TSISIN                                       CGL031 233709
     C**********           Z-ADDCSPV      TSPAMT                                       CGL031 233709
     C**********           Z-ADD@@TOTO    TSGINT                                       CGL031 233709
      *                                                                                       CGL031
      ** The following fields are calculated when the customer status = T only.               CGL031
      *                                                                                       CGL031
     C**********           Z-ADD*ZERO     TSTXRT                                       CGL031 233709
     C**********           Z-ADD*ZERO     TSTXSR                                       CGL031 233709
     C                     Z-ADD*ZERO     TSTXSR 150                                          233709
     C           TSSTAT    IFEQ 'T'                                                           CGL031
     C**********           Z-ADD@@TAXR    TSTXRT                                       CGL031 233709
     C                     Z-ADD@@TAXA    TSTXSR                                              CGL031
     C**********           ENDIF                                                       CGL031 233709
      *                                                                                       CGL031
     C********** TSGINT    SUB  TSTXSR    TSNINT                                       CGL031 233709
      *                                                                                       CGL031
     C           TSOCCY    IFEQ TSSCCY                                                        CGL031
     C**********           Z-ADDTSPAMT    TSPAMS                                       CGL031 233709
     C**********           Z-ADD@@TOTO    TSGINS                                       CGL031 233709
     C**********           Z-ADD@@TAXA    TSTXSS                                       CGL031 233709
     C                     Z-ADD@@TAXA    TSTXSS 150                                          233709
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
     C**********           Z-ADDTSPAMT    ZAMTF                                        CGL031 233709
     C**********           Z-ADDTSXROS    ZCRSRT                                       CGL031 233709
     C**********           MOVE TSOSMD    ZCRSMD                                       CGL031 233709
     C**********           Z-ADDTSOCDP    ZCDPF                                        CGL031 233709
     C**********           Z-ADDTSSCDP    ZCDPT                                        CGL031 233709
     C**********           EXSR ZCCYXR                                                 CGL031 233709
     C**********           Z-ADDZAMTT     TSPAMS                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           Z-ADD@@TOTO    ZAMTF                                        CGL031 233709
     C**********           Z-ADDTSXROS    ZCRSRT                                       CGL031 233709
     C**********           MOVE TSOSMD    ZCRSMD                                       CGL031 233709
     C**********           Z-ADDTSOCDP    ZCDPF                                        CGL031 233709
     C**********           Z-ADDTSSCDP    ZCDPT                                        CGL031 233709
     C**********           EXSR ZCCYXR                                                 CGL031 233709
     C**********           Z-ADDZAMTT     TSGINS                                       CGL031 233709
      *                                                                                       CGL031
     C                     Z-ADD@@TAXA    ZAMTF                                               CGL031
     C                     Z-ADDTSXROS    ZCRSRT                                              CGL031
     C                     MOVE TSOSMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
     C**********           Z-ADDTSSCDP    ZCDPT                                        CGL031 CSD027
     C                     MOVELTSSCDP    ZCDPT                                               CSD027
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSTXSS                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C********** TSGINS    SUB  TSTXSS    TSNINS                                       CGL031 233709
      *                                                                                       CGL031
     C           TSSCCY    IFEQ TSTXCY                                                        CGL031
     C**********           Z-ADDTSPAMS    TSPAMC                                       CGL031 233709
     C**********           Z-ADDTSGINS    TSGINC                                       CGL031 233709
     C**********           Z-ADDTSTXSS    TSTXSC                                       CGL031 233709
     C                     Z-ADDTSTXSS    TSTXSC 150                                          233709
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
     C**********           Z-ADDTSPAMS    ZAMTF                                        CGL031 233709
     C**********           Z-ADDTSXRST    ZCRSRT                                       CGL031 233709
     C**********           MOVE TSSTMD    ZCRSMD                                       CGL031 233709
     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
     C**********           Z-ADDTSTCDP    ZCDPT                                        CGL031 233709
     C**********           EXSR ZCCYXR                                                 CGL031 233709
     C**********           Z-ADDZAMTT     TSPAMC                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           Z-ADDTSGINS    ZAMTF                                        CGL031 233709
     C**********           Z-ADDTSXRST    ZCRSRT                                       CGL031 233709
     C**********           MOVE TSSTMD    ZCRSMD                                       CGL031 233709
     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
     C**********           Z-ADDTSTCDP    ZCDPT                                        CGL031 233709
     C**********           EXSR ZCCYXR                                                 CGL031 233709
     C**********           Z-ADDZAMTT     TSGINC                                       CGL031 233709
      *                                                                                       CGL031
     C                     Z-ADDTSTXSS    ZAMTF                                               CGL031
     C                     Z-ADDTSXRST    ZCRSRT                                              CGL031
     C                     MOVE TSSTMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
     C**********           Z-ADDTSTCDP    ZCDPT                                        CGL031 CSD027
     C                     MOVELTSTCDP    ZCDPT                                               CSD027
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSTXSC                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C********** TSGINC    SUB  TSTXSC    TSNINC                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** TSSCCY    IFEQ BJCYCD                                                 CGL031 233709
     C**********           Z-ADDTSPAMS    TSPAMB                                       CGL031 233709
     C**********           Z-ADDTSGINS    TSGINB                                       CGL031 233709
     C**********           Z-ADDTSTXSS    TSTXSB                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           ELSE                                                        CGL031 233709
     C**********           Z-ADDTSPAMS    ZAMTF                                        CGL031 233709
     C**********           Z-ADDTSSCSR    ZCRSRT                                       CGL031 233709
     C**********           MOVE TSSCMD    ZCRSMD                                       CGL031 233709
     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
      *****************************************************************                CGL031 233709
      ***Get*Bsse*Currency*Decimal*Places******************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           MOVELBJCYCD    WCURR                                        CGL031 233709
     C**********           EXSR #LCURR                                                 CGL031 233709
     C**********           Z-ADDA6NBDP    ZCDPI                                        CGL031 233709
     C**********           Z-ADDZCDPI     ZCDPT                                        CGL031 233709
     C**********           EXSR ZCCYXR                                                 CGL031 233709
     C**********           Z-ADDZAMTT     TSPAMB                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           Z-ADDTSGINS    ZAMTF                                        CGL031 233709
     C**********           Z-ADDTSSCSR    ZCRSRT                                       CGL031 233709
     C**********           MOVE TSSCMD    ZCRSMD                                       CGL031 233709
     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
     C**********           Z-ADDZCDPI     ZCDPT                                        CGL031 233709
     C**********           EXSR ZCCYXR                                                 CGL031 233709
     C**********           Z-ADDZAMTT     TSGINB                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           Z-ADDTSTXSS    ZAMTF                                        CGL031 233709
     C**********           Z-ADDTSSCSR    ZCRSRT                                       CGL031 233709
     C**********           MOVE TSSCMD    ZCRSMD                                       CGL031 233709
     C**********           Z-ADDTSSCDP    ZCDPF                                        CGL031 233709
     C**********           Z-ADDZCDPI     ZCDPT                                        CGL031 233709
     C**********           EXSR ZCCYXR                                                 CGL031 233709
     C**********           Z-ADDZAMTT     TSTXSB                                       CGL031 233709
     C**********           ENDIF                                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C********** TSGINB    SUB  TSTXSB    TSNINB                                       CGL031 233709
     C**********           MOVE 'N'       TSINPR                                       CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           Z-ADD*ZERO     TSTNLU                                       CGL031 233709
      *****************************************************************                CGL031 233709
      ***Write*record*to*SDCSINPD**************************************                CGL031 233709
      *****************************************************************                CGL031 233709
     C**********           WRITESDCSIND0                                               CGL031 233709
      *****************************************************************                CGL031 233709
      ***Accumulate*relevant*amounts*for*net*total*********************                CGL031 233709
      *****************************************************************                CGL031 233709
     C********** TSSTAT    IFEQ 'T'                                                    CGL031 233709
     C**********           ADDQ TSTXSR    WTTXSR                                       CGL031 233709
     C**********           ADD  TSTXSR    WTTXSS                                       CGL031 233709
     C**********           ADD  TSTXSC    WTTXSC                                       CGL031 233709
     C**********           ADD  TSTXSB    WTTXSB                                       CGL031 233709
     C**********           ADD  TSNINT    WTNINT                                       CGL031 233709
     C**********           ADD  TSNINS    WTNINS                                       CGL031 233709
     C**********           ADD  TSNINC    WTNINC                                       CGL031 233709
     C**********           ADD  TSNINB    WTNINB                                       CGL031 233709
     C                     ADD  TSTXSR    TXNM                                                233709
     C                     ADD  TSTXSS    TXST                                                233709
     C                     ADD  TSTXSC    TAXA                                                233709
     C                     MOVE TSTXCY    TXCY                                                233709
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  SECPPC - Subroutine to get customer position profit centre   *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           SECPPC    BEGSR                           ** SECPPC **   S01117
     C*                                                                   S01117
     C** Chain for customer position profit centre record                 S01117
     C*                                                                   S01117
     C           KSEPCC    CHAINSEPCCDF              79            S01117 081336
     C           *IN79     IFNE '1'                                S01117 081336
     C           RECI      COMP '*'                      79        S01117 081336
     C                     END                                     S01117 081336
     C************IN79     IFEQ '1'                         S01117 081336 182952
     C************LOCK     IN   LDA                                S01117 182952
     C***********          MOVEL'SEPCCD'  DBFILE    ***************S01117 182952
     C***********          MOVELKSEPCR    DBKEY     * DB ERROR 17 *S01117 182952
     C***********          Z-ADD17        DBASE     ***************S01117 182952
     C***********          SETON                     U7U8          S01117 182952
     C***********          DUMP                                    S01117 182952
     C***********          GOTO EAUDIT                             S01117 182952
     C***********          END                                     S01117 182952
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
      /EJECT
      *****************************************************************
      *                                                               *
      *  SECTIN - Subroutine to get Security record.                  *
      *                                                               *
      *****************************************************************
      *
     C           SECTIN    BEGSR                           ** SECTIN **
     C*
     C** CHAIN FOR SECURITY RECORD AND DATA BASE ERROR
     C*
     C***********SECTKY    CHAINSECTY                79                   081383
     C************IN79     IFNE '1'                                       081383
     C***********RECI      COMP '*'                      79               081383
     C***********          END                                            081383
     C************IN79     IFEQ '1'                                       081383
     C           SECTKY    CHAINSECTY                82                   081383
     C           *IN82     IFNE '1'                                       081383
     C***********RECI      COMP '*'                      82        081383 033988
     C           RECIS     COMP '*'                      82               033988
     C                     END                                            081383
     C           *IN82     IFEQ '1'                                       081383
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SECTY'   DBFILE           ***************
     C                     MOVELSASN      DBKEY            * DB ERROR 04 *
     C                     Z-ADD4         DBASE            ***************
     C                     SETON                     U7U8                 S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C                     ELSE                                           E37289
     C                     MOVE RECI      SCRECI  1                       E37289
     C                     END
      *                                                                   S01447
      *** Access security WHT details file                                S01447
      *                                                                   S01447
     C                     MOVE *BLANKS   S1CTTA                          236815
     C           SECTKY    CHAINSESWHTL0             80                   S01447
     C   80                MOVEL'N'       SWHTFD  1                       236815
     C  N80                MOVEL'Y'       SWHTFD  1                       236815
      *
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  INVTIN - Subroutine to get Investment Type record.           *
      *                                                               *
      *****************************************************************
      *
     C           INVTIN    BEGSR                           ** INVTIN **
     C*
     C** CHAIN FOR INVESTMENT TYPE RECORD AND DATA BASE ERROR
     C*
     C***********INVTKY    CHAININVTP                79                   081383
     C************IN79     IFNE '1'                                       081383
     C***********RECI      COMP '*'                      79               081383
     C***********          END                                            081383
     C************IN79     IFEQ '1'                                       081383
     C           INVTKY    CHAININVTP                82                   081383
     C           *IN82     IFNE '1'                                       081383
     C********** RECI      COMP '*'                      82                          081383 BUG11104
     C           RECII     COMP '*'                      82                                 BUG11104
     C                     END                                            081383
     C           *IN82     IFEQ '1'                                       081383
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'INVTP'   DBFILE           ***************
     C                     MOVELINVKEY    DBKEY            * DB ERROR 05 *
     C                     Z-ADD5         DBASE            ***************
     C                     SETON                     U7U8                 S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C                     END
      **********                                                                AR1001183 AR1001183A
      ***Get*next*coupon*rate                                                   AR1001183 AR1001183A
     C**********           MOVE 'N'       WRCHG   1                             AR1001183 AR1001183A
     C********** CRE073    IFEQ 'Y'                                             AR1001183 AR1001183A
     C********** PROT      ANDEQ'3'                                             AR1001183 AR1001183A
     C********** PROT      OREQ '8'                                             AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** SDET      IFEQ 'MP'                                            AR1001183 AR1001183A
     C********** SDET      OREQ 'DV'                                            AR1001183 AR1001183A
     C********** S01512    ANDNE'Y'                                             AR1001183 AR1001183A
     C**********           Z-ADDSAOD      WDAT    50                            AR1001183 AR1001183A
     C**********           ELSE                                                 AR1001183 AR1001183A
     C**********           Z-ADDSAED      WDAT                                  AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           EXSR GETNCR                                          AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      *
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SECEDI - Subroutine to get Security Diary Event record.      *
      *                                                               *
      *****************************************************************
      *
     C           SECEDI    BEGSR                           ** SECEDI **
     C*
     C** CHAIN FOR SECURITY EVENT RECORD AND DATA BASE ERROR
     C*
     C***STORE*NOM*CCY*FROM*SECTYD*AS*SEDEVDF*HAS*NMCY*FIELD*TOO*******   E20086
     C***********                                                         E20086
     C***********          MOVE NMCY      WNMCY   3                       E20086
     C           SECDKY    CHAINSEDEVDF              7877
     C           *IN78     IFNE '1'
     C           RECI      COMP '*'                      78
     C                     END
     C           *IN77     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'SECED'   DBFILE           ***************E20016
     C                     MOVEL'SEDEV'   DBFILE           ***************E20016
     C                     MOVELSASN      DBKEY            * DB ERROR 06 *
     C                     Z-ADD6         DBASE            ***************
     C                     SETON                     U7U8                 S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C                     END
     C************         MOVE WNMCY     NMCY                            E20086
      *
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  TG10   - Subroutine to get Security Currency Decimal Places  *
      *           from TABTG10.                                       *
      *                                                               *
      *****************************************************************
      *
     C           TG10      BEGSR                           ** TG10   **
     C*
     C** CHAIN FOR CURRENCY RECORD IN TABLE TABTG10
     C** FIELD WCURR CONTAINS THE CURRENCY WHEN THIS SUBROUTINE EXECUTED
     C*
     C* IF WCURR IS EQUAL TO WLSTCY (LAST CCY TO ACCESS TABTG10) IGNORE
     C*
     C           WCURR     CABEQWLSTCY    ENDT10
     C                     MOVE WCURR     WLSTCY  3
     C*
     C                     MOVEL'20      'ZTABKY 12
     C                     MOVE '1'       WRK4    4
     C                     MOVELWCURR     WRK4
     C                     MOVE WRK4      ZTABKY
     C**
     C           ZTABKY    CHAINTABTG10F             99
     C*
     C* ERROR IF NO RECORD FOUND OR IF IT IS DELETED
     C*
     C           *IN99     IFEQ '1'
     C                     SETON                     U7U8
     C                     ELSE
     C           RECI      IFEQ '*'
     C                     SETON                     U7U8
     C                     END
     C                     END
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 07 *
     C                     Z-ADD7         DBASE            ***************
     C                     SETON                     U7U8                 S01117
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C                     END
     C*                                                                   S01117
     C**  Set up new output parameter for use in SR.ZCNSD                 S01117
     C*                                                                   S01117
     C                     Z-ADDCDP       ZCDP                            S01117
     C*
     C           ENDT10    ENDSR                           ** ENDT10 **
      *
      *****************************************************************
      /EJECT                                                              S01446
     C*****************************************************************   S01446
     C*                                                               *   S01446
     C*  #LCURR - Subroutine to get currency details from SDCURRPD    *   S01446
     C*                                                               *   S01446
     C*****************************************************************   S01446
     C*                                                                   S01446
     C           #LCURR    BEGSR                                          S01446
     C*                                                                   S01446
     C                     CALL 'AOCURRR0'                                S01446
     C                     PARM *BLANKS   @RTCD   7                       S01446
     C                     PARM '*KEY   ' @OPTN   7                       S01446
     C                     PARM WCURR     @AJCD   3                       S01446
     C           SDCURR    PARM SDCURR    DSSDY                           S01446
     C*                                                                   S01446
     C           @RTCD     IFNE *BLANKS                                   S01446
     C                     SETON                     U7U899               S01446
     C           *LOCK     IN   LDA                                       S01446
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01446
     C                     MOVELWCURR     DBKEY            * DB ERROR    *S01446
     C                     Z-ADDWDBAS1    DBASE            ***************S01446
     C                     DUMP                                           S01446
     C                     GOTO EAUDIT                                    S01446
     C                     END                                            S01446
     C*                                                                   S01446
     C                     ENDSR                                          S01446
      *****************************************************************   S01446
      /EJECT                                                                                AR853119
      *****************************************************************                     AR853119
      *                                                               *                     AR853119
      * SRPOST - Create Position Settlement extension                 *                     AR853119
      *                                                               *                     AR853119
      *****************************************************************                     AR853119
     C           SRPOST    BEGSR                                                            AR853119
      *                                                                                     AR853119
     C                     MOVE *BLANK    WSTAX   1                                         AR853119
     C                     MOVE *BLANK    WZTAX   1                                         AR853119
     C                     MOVE *ZERO     WSTAXA                                            AR875302
     C                     Z-ADD0         P3STAF                                            AR853119
     C                     MOVE 'N'       P3TAX                                             AR853119
     C                     MOVELBJRDNB    P3CDTE                                            AR853119
     C                     MOVELPBCA      P3PBCA                                            AR853119
     C                     MOVELPSSH      P3PSSH                                            AR853119
     C                     MOVELPCPY      P3PCPY                                            AR853119
     C                     MOVELPDUD      P3PDUD                                            AR853119
     C                     MOVELPEVT      P3PEVT                                            AR853119
      *                                                                                     AR853119
     C                     CALL 'AOBRCHR2'                                                  AR853119
     C                     PARM *BLANKS   @RTCD                                             AR853119
     C                     PARM '*KEY   ' @OPTN                                             AR853119
     C                     PARM PBCA      @DSNB   3                                         AR853119
     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR853119
     C           @RTCD     IFEQ *BLANKS                                                     AR853119
     C                     MOVE BXTAX     WSTAX                                             AR853119
     C                     ENDIF                                                            AR853119
      *                                                                                     AR853119
     C           PCPY      CHAINSDCUSQL0             99                                     AR853119
     C           *IN99     IFEQ '0'                                                         AR853119
     C                     MOVE CQTAX     WZTAX                                             AR853119
     C                     ENDIF                                                            AR853119
      *                                                                                     AR853119
      ** Calculate Stamp tax                                                                AR853119
      *                                                                                     AR853119
     C           WSTAX     IFEQ 'Y'                                                         AR853119
     C           WZTAX     ANDEQ'Y'                                                         AR853119
     C                     CALL 'SD008141'                                                  AR853119
     C                     PARM BJRDNB    U#DATE  50                                        AR853119
     C                     PARM 'POSSET  'U#ORGN 10                                         AR853119
     C                     PARM           ##TYPE  4                                         AR853119
     C                     PARM           U#CTAX 138                                        AR853119
     C                     PARM           U#MTAX 138                                        AR853119
     C                     PARM           U#CCCY  3                                         AR853119
     C                     PARM           U#MCCY  3                                         AR853119
     C                     PARM           U#CSCC  2                                         AR853119
     C                     PARM           U#MSCC  2                                         AR853119
     C                     PARM           U#TXTY  1                                         AR853119
     C                     PARM           SDSTPD                                            AR853119
      *                                                                                     AR853119
      ** If there is a default for the Module use this tax rate and ccy                     AR853119
      ** otherwise use the ICD Control defaults.                                            AR853119
      *                                                                                     AR853119
     C           U#MTAX    IFNE *ZEROS                                                      AR853119
     C                     Z-ADDU#MTAX    U#TAXR 138                                        AR853119
     C                     MOVE U#MCCY    U#SCCY  3                                         AR853119
     C                     ELSE                                                             AR853119
     C                     MOVE U#CCCY    U#SCCY                                            AR853119
     C                     Z-ADDU#CTAX    U#TAXR                                            AR853119
     C                     ENDIF                                                            AR853119
      *                                                                                     AR853119
     C                     MOVELPCHA      WSTAXA 130                                        AR853119
     C                     ADD  PCAM      WSTAXA                                            AR853119
     C                     MULT U#TAXR    WSTAXA    H                                       AR853119
     C                     MOVE WSTAXA    P3STAF                                            AR853119
     C                     MOVE 'Y'       P3TAX                                             AR853119
     C                     EXSR SRSTMD                                                      AR853119
     C                     ENDIF                                                            AR853119
      *                                                                                     AR853119
     C                     ENDSR                                                            AR853119
      *****************************************************************                     AR853119
      /EJECT                                                                                AR853119
      *****************************************************************                     AR853119
      * Subroutine  :  SRSTMD                                         *                     AR853119
      * Function    :  This subroutine will write/update records in   *                     AR853119
      *                Stamp Tax Historic/Details (SDSTMDPD)          *                     AR853119
      *****************************************************************                     AR853119
      *                                                                                     AR853119
     C           SRSTMD    BEGSR                                                            AR853119
      *                                                                                     AR853119
     C                     MOVE PBCA      T2PBRC                                            AR853119
     C                     MOVE PSSH      T2PSSH                                            AR853119
     C                     MOVE PCPY      T2PCPY                                            AR853119
     C                     MOVE PDUD      T2PDUD                                            AR853119
     C                     MOVE PEVT      T2PEVT                                            AR853119
     C                     MOVEL'POSSET'  T2KEY                                             AR853119
     C                     MOVE 'T'       T2RCTP                                            AR853119
     C                     MOVE U#SCCY    T2SCCY                                            AR853119
     C                     MOVE PSCU      T2ECCY                                            AR853119
     C                     MOVE 'Y'       T2TCAL                                            AR853119
     C                     MOVE U#TAXR    T2TXRT                                            AR853119
     C                     Z-ADDWSTAXA    T2TATC                                            AR853119
     C                     MOVE 'Y'       T2STFF                                            AR853119
     C                     MOVE 'I'       T2TYLC                                            AR853119
     C           PCHA      ADD  PCAM      T2GROS                                           AR864714B
      *                                                                                     AR853119
     C                     ENDSR                                                            AR853119
      *****************************************************************                     AR853119
      /EJECT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to update the Audit Files and Output the *
      *           Control Report.                                     *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR                           ** AUDIT **
     C*
     C** COMPARE COUNT OF ACTIONS TO AUDIT FILE ACTIONS
     C*
     C                     READ SECACA                   79
     C*
     C* DATA BASE ERROR
     C*
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SECACA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 08 *
     C                     Z-ADD8         DBASE            ***************
     C                     SETON                       U7U8
     C                     DUMP                                           S01117
     C                     ELSE
     C                     Z-ADDNORE      SANORE  50
     C                     END
     C*
     C           *INU8     IFNE '1'
     C           NORE      IFNE WCSECT
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *IN29
     C                     END
     C                     END
     C*
     C** IF U8 NOT ON UPDATE GEN A/C KEYS AUDIT AND POSN.SETT.AUDIT FILES
     C*
     C           *INU8     IFNE '1'
     C                     Z-ADDW01CNT    NORE
     C                     Z-ADDINT,1     HRWN
     C                     Z-ADDDEC,1     HRDC
     C                     WRITESEKEYAF
     C                     Z-ADDW02CNT    NORE
     C                     WRITEPOSETAF
     C                     END
     C*
     C** WRITE MATURED SECURITIES EXTRACT AUDIT RECORD WITH
     C*  NUMBER OF RECORDS WRITTEN
     C*
     C           *INU8     IFNE '1'
     C                     READ MATEXA                   78
     C           *IN78     IFEQ '1'
     C           RECI      ORNE 'C'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'MATEXA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 09 *
     C                     Z-ADD9         DBASE            ***************
     C                     SETON                       U7U8
     C                     DUMP                                           S01117
     C                     ELSE
     C                     ADD  WMATUR    NORE
     C                     UPDATMATEXAF
     C                     END
     C                     END
     C*
     C* OUTPUT CONTROL REPORT
     C*
     C                     WRITEHEADAU
     C           *INU7     IFEQ '1'
     C                     WRITEERROR
     C                     ELSE
     C***********WCSECT    IFEQ 0                                         E29170
     C***********          WRITENONE                                      E29170
     C***********          ELSE                                           E29170
     C                     Z-ADDINT,1     WHASHT
     C                     Z-ADDDEC,1     WHASHD
     C                     WRITECONTROL
     C*
     C***********          END                                            E29170
     C                     END
     C***********                                                         E29170
     C***********          WRITETRAILAU                                   E29170
     C*                                                                   S01117
     C** Update LDA                                                       S01117
     C*                                                                   S01117
     C           *INU7     IFEQ '1'                                       S01117
     C           *INU8     ANDEQ'1'                                       S01117
     C                     OUT  LDA                                       S01117
     C                     END                                            S01117
     C*                                                                   S01486
     C**  If Portfolio Management is on, close PM files                   S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     CLOSEPMPORTPD                                  S01486
     C***********          CLOSEPMFPSNLL                           S01486 189942
     C***********          CLOSEPMCPSSLL                           S01486 189942
     C***********          CLOSEPMAPOSLL                           S01486 189942
     C                     CLOSEPMACCNL0                                  S01486
     C                     CLOSEPMACCNL1                                  219688
     C**********           CLOSESECET                                               S01486 BUG11104A
     C                     CLOSESEEVNT                                    S01486
     C                     END                                            S01486
     C                     CLOSESECET                                                      BUG11104A
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CLNTIN - Subroutine to get CLINTSE Client record.            *
      *                                                               *
      *****************************************************************
      *
     C           CLNTIN    BEGSR                           ** CLNTIN **
     C*
     C           CLINTK    CHAINCLINT                76
     C           *IN76     IFNE '1'
     C           RECI      COMP '*'                      76
     C                     END
     C           *IN76     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'CLINT'   DBFILE           ***************
     C                     MOVELWCLNTK    DBKEY            * DB ERROR 10 *
     C                     SETON                     U7U8  ***************
     C                     Z-ADD10        DBASE
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C                     END
     C*
     C                     ENDSR
      *
     C*****************************************************************
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  POSDSR - Subroutine for Error Handling of PF/POSETD.         *
      *                                                               *
      *****************************************************************
      *
     C           POSDSR    BEGSR                            ** POSDSR **
     C*
     C                     MOVE PCPY      PCPYK                           CSE023
     C                     MOVE PBCA      PBCAK                           CSE023
     C                     MOVE PSSH      PSSHK                           CSE023
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'POSETD'  DBFILE           ***************
     C                     MOVELPOSDDB    DBKEY            * DB ERROR 11 *
     C                     Z-ADD011       DBASE            ***************
     C                     MOVE STSPSD    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SEKDSR - Subroutine for Error Handling of LF/SEKEYD.         *
      *                                                               *
      *****************************************************************
      *
     C           SEKDSR    BEGSR                            **SEKDSR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SEKEYD'  DBFILE           ***************
     C                     MOVELACKY      DBKEY            * DB ERROR 12 *
     C                     Z-ADD012       DBASE            ***************
     C                     MOVE STSSKD    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  POSASR - Subroutine for Error Handling of PF/POSETA.         *
      *                                                               *
      *****************************************************************
      *
     C           POSASR    BEGSR                              **POSASR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'POSETA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 13 *
     C                     Z-ADD13        DBASE            ***************
     C                     MOVE STSPSA    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  MATDSR - Subroutine for Error Handling of PF/MATEXD.         *
      *                                                               *
      *****************************************************************
      *
     C           MATDSR    BEGSR                              **MATDSR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'MATEXD'  DBFILE           ***************
     C                     MOVEL'NONE'    DBKEY            * DB ERROR 14 *
     C                     Z-ADD14        DBASE            ***************
     C                     MOVE STSMTD    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  MATASR - Subroutine for Error Handling of PF/MATEXA.         *
      *                                                               *
      *****************************************************************
      *
     C           MATASR    BEGSR                              **MATASR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'MATEXA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 15 *
     C                     Z-ADD15        DBASE            ***************
     C                     MOVE STSMTD    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  SEKASR - Subroutine for Error Handling of PF/SEKEYA.         *
      *                                                               *
      *****************************************************************
      *
     C           SEKASR    BEGSR                             **SEKASR**
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SEKEYA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 16 *
     C                     Z-ADD16        DBASE            ***************
     C                     MOVE STSSKA    DBSTAT
     C                     MOVE '1'       *IN87
     C                     SETON                     99U7U8
     C                     DUMP                                           S01117
     C                     GOTO EAUDIT
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  FIRST  - Subroutine to access ICD Information.               *
      *                                                               *
      *****************************************************************
      *
     C           FIRST     BEGSR                           ** FIRST **
     C*
     C************NAMVAR   DEFN           LDA                             S01117
     C                     MOVE '1'       WLIT1
     C                     MOVE 'A'       WRTYP                           S01447
     C*
     C* ACCESS ICD    TABTB10
     C*
     C                     EXSR ZSYSTM
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 01 *
     C                     Z-ADD1         DBASE            ***************
     C                     DUMP                                           S01117
     C                     ELSE
     C*
     C* ACCESS ICD2   TABTB11
     C*
     C                     EXSR ZICD2
     C           *INU7     IFEQ '1'
     C                     MOVE '1'       *IN99
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELTABKEY    DBKEY            * DB ERROR 02 *
     C                     Z-ADD2         DBASE            ***************
     C                     DUMP                                           S01117
     C                     ELSE
      *                                                                   103361
      **Retrieve*account*code                                      103361 114458
      *                                                                   103361
     C**********           CALL 'AORETLR0'                         103361 114458
     C**********           PARM *BLANKS   @RTCD   7                103361 114458
     C**********           PARM '*FIRST'  @OPTN   7                103361 114458
     C********** SDRETL    PARM SDRETL    DSFDY                    103361 114458
     C********** @RTCD     IFNE *BLANKS                            103361 114458
     C********** *LOCK     IN   LDA                                103361 114458
     C**********           MOVEL*BLANK    DBKEY            ********103361*114458
     C**********           Z-ADD43        DBASE            * DB ERR103361*114458
     C**********           MOVEL'SDRETLL1'DBFILE           ********103361*114458
     C**********           SETON                       U7U8        103361 114458
     C**********           EXSR *PSSR                              103361 114458
     C**********           END                                     103361 114458
     C*
     C* ACCESS ICDSE  TABTB36
     C*
     C                     EXSR ZICDSE
     C           *INU7     IFEQ '1'
     C                     MOVE '1'       *IN99
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 03 *
     C                     Z-ADD3         DBASE            ***************
     C                     DUMP                                           S01117
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE2400C022
     C*                                                                   S01486
     C**  Get module details using access object                          S01486
     C*                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM '*MSG   ' @RTCD                           S01486
     C                     PARM '*FIRST ' @OPTN                           S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
     C*                                                                   S01486
     C**  Check if error occurred                                         S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL'SDMMODPD'DBFILE           ***************S01486
     C                     Z-ADD23        DBASE            * DB ERROR 22 *S01486
     C                     SETON                       U7U8***************S01486
     C                     OUT  LDA                                       081239
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C*                                                                   063199
     C** Access SDGELRPD for profit centres used flag                     063199
     C*                                                                   063199
     C**********           CALL 'AOGELRR0'                                             063199 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       063199
     C                     PARM '*FIRST ' @OPTN   7                       063199
     C********** SDGELR    PARM SDGELR    DSFDY                                        063199 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   063199
     C           @RTCD     IFNE *BLANKS                                   063199
     C           *LOCK     IN   LDA                                       063199
     C                     MOVEL'SDGELRPD'DBFILE           ***************063199
     C                     Z-ADD22        DBASE            * DB ERROR 22 *063199
     C                     SETON                       U7U8***************063199
     C                     EXSR *PSSR                                     063199
     C                     END                                            063199
     C*                                                                   S01486
     C* CHECK IF PORTFOLIO MANAGEMENT IS INSTALLED                        S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   S01486
     C* READ PM INSTALLATION AND CONTROL DATA                             S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM '*MSG'    @RTCD                           S01486
     C                     PARM '*FIRST ' @OPTN                           S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL'SDPORTPD'DBFILE           ***************S01486
     C                     Z-ADD24        DBASE            * DB ERROR 24 *S01486
     C                     SETON                       U7U8***************S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C**  Open Portfolio Management files                                 S01486
     C*                                                                   S01486
     C                     OPEN PMPORTPD                                  S01486
     C***********          OPEN PMFPSNLL                           S01486 189942
     C***********          OPEN PMCPSSLL                           S01486 189942
     C***********          OPEN PMAPOSLL                           S01486 189942
     C                     OPEN PMACCNL0                                  S01486
     C                     OPEN PMACCNL1                                  219688
     C**********           OPEN SECET                                               S01486 BUG11104A
     C                     OPEN SEEVNT                                    S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C                     OPEN SECET                                                      BUG11104A
     C*
      *                                                                   114458
      * Retrieve account code                                             114458
      *                                                                   114458
     C           BGRTBN    IFEQ 'Y'                                       114458
     C                     CALL 'AORETLR0'                                114458
     C                     PARM *BLANKS   @RTCD   7                       114458
     C                     PARM '*FIRST'  @OPTN   7                       114458
     C           SDRETL    PARM SDRETL    DSFDY                           114458
     C           @RTCD     IFNE *BLANKS                                   114458
     C           *LOCK     IN   LDA                                       114458
     C                     MOVEL*BLANK    DBKEY            ***************114458
     C                     Z-ADD43        DBASE            * DB ERROR 43 *114458
     C                     MOVEL'SDRETLL1'DBFILE           ***************114458
     C                     SETON                       U7U8               114458
     C                     EXSR *PSSR                                     114458
     C                     END                                            114458
     C                     END                                            114458
     C*                                                                   S01519
     C** Access Securities Trading file for the Autocharge option         S01519
     C*                                                                   S01519
     C                     CALL 'AOSTRDR0'                                S01519
     C                     PARM *BLANKS   @RTCD   7                       S01519
     C                     PARM '*FIRST ' @OPTN   7                       S01519
     C********** SDSTRD    PARM SDSTRD    DSFDY                                        S01519 CGL031
     C           SDSTRD    PARM SDSTRD    DSSDY                                               CGL031
     C*                                                                   S01519
     C           @RTCD     IFNE *BLANKS                                   S01519
     C                     SETON                     U7U899               S01519
     C           *LOCK     IN   LDA                                       S01519
     C                     MOVE 'SDSTRDPD'DBFILE           ***************S01519
     C                     MOVEL'*FIRST'  DBKEY            * DB ERROR 23 *S01519
     C                     Z-ADD23        DBASE            ***************S01519
     C                     EXSR *PSSR                                     S01519
     C                     END                                            S01519
     C*                                                                   S01446
     C** If Autocharge option is set to 'Y', check if Customer            S01446
     C** Commission (Courtage) is installed                               S01446
     C*                                                                   S01446
     C           BVACOP    IFEQ 'Y'                                       S01446
     C                     MOVE 'N'       S01446                          S01446
     C                     CALL 'AOSARDR0'                                S01446
     C                     PARM *BLANKS   @RTCD                           S01446
     C                     PARM '*VERIFY' @OPTN                           S01446
     C                     PARM 'S01446'  @SARD   6                       S01446
     C*                                                                   S01446
     C           @RTCD     IFEQ *BLANK                                    S01446
     C                     MOVE 'Y'       S01446  1                       S01446
     C*                                                                   S01446
     C** If it is and charge ccy is defined, get the spot rate            S01446
     C** and save multiply/divide indicator and number of dec places      S01446
     C** from SDCURRPD                                                    S01446
     C*                                                                   S01446
     C           BVCHRC    IFNE *BLANKS                                   S01446
     C                     MOVE BVCHRC    WCURR                           S01446
     C                     Z-ADD24        WDBAS1                          S01446
     C                     EXSR #LCURR                                    S01446
     C                     Z-ADDA6SPRT    TXSPOT 138                      S01446
     C                     MOVE A6MDIN    TXMDI   1                       S01446
     C                     MOVE A6NBDP    TXCDP   10                      S01446
     C                     END                                            S01446
     C                     END                                            S01446
     C                     END                                            S01446
      *                                                                   CSE026
      ** Check if Posn Settlement Default Charges by Customer Grp is On.  CSE026
      *                                                                   CSE026
     C                     CALL 'AOSARDR0'                                CSE026
     C                     PARM *BLANKS   @RTCD                           CSE026
     C                     PARM '*VERIFY' @OPTN                           CSE026
     C                     PARM 'S01496'  @SARD                           CSE026
     C           SCSARD    PARM SCSARD    DSSDY                           CSE026
      *                                                                   CSE026
     C           @RTCD     IFEQ *BLANKS                                   CSE026
     C                     MOVE 'Y'       S01496  1                       CSE026
     C                     ELSE                                           CSE026
      *                                                                   CSE026
      ** Error if return code other than '*NRF'                           CSE026
      *                                                                   CSE026
     C           @RTCD     IFNE '*NRF'                                    CSE026
     C           *LOCK     IN   LDA                                       CSE026
     C                     Z-ADD52        DBASE                           CSE026
     C                     MOVE 'SCSARDPD'DBFILE                          CSE026
     C                     MOVEL'*VERIFY' DBKEY                           CSE026
     C                     MOVE *ON       *INU7                           CSE026
     C                     MOVE *ON       *INU8                           CSE026
     C                     EXSR *PSSR                                     CSE026
     C                     ELSE                                           CSE026
     C                     MOVE 'N'       S01496                          CSE026
     C                     ENDIF                                          CSE026
      *                                                                   CSE026
     C                     ENDIF                                          CSE026
      *                                                                   CSE026
      ** If S01496 is On & Autocharge flag on Securities Trading ICD is   CSE026
      ** 'Y', set on Indicator 40.                                        CSE026
      *                                                                   CSE026
     C           S01496    IFEQ 'Y'                                       CSE026
     C           BVACOP    ANDEQ'Y'                                       CSE026
     C                     MOVE *ON       *IN40                           CSE026
     C                     OPEN SEDFGRL0                                  CSE026
     C                     ELSE                                           CSE026
     C                     MOVE *OFF      *IN40                           CSE026
     C                     ENDIF                                          CSE026
     C*
      *** Check Withholding tax is installed                              S01447
      *                                                                   S01447
     C                     CALL 'AOSARDR0'                                S01447
     C                     PARM *BLANKS   @RTCD                           S01447
     C                     PARM '*VERIFY' @OPTN                           S01447
     C                     PARM 'S01447'  @SARD   6                       S01447
      *                                                                   S01447
     C           @RTCD     IFEQ *BLANK                                    S01447
     C                     MOVE 'Y'       S01447  1                       S01447
     C                     ELSE                                           S01447
     C                     MOVE 'N'       S01447                          S01447
     C                     END                                            S01447
     C*                                                                   S01509
     C** Check if Value currency is installed                             S01509
     C*                                                                   S01509
     C                     CALL 'AOSARDR0'                                S01509
     C                     PARM *BLANKS   @RTCD                           S01509
     C                     PARM '*VERIFY' @OPTN                           S01509
     C                     PARM 'S01509'  @SARD   6                       S01509
     C*                                                                   S01509
     C           @RTCD     IFEQ *BLANK                                    S01509
     C                     MOVE 'Y'       S01509  1                       S01509
     C                     ELSE                                           S01509
     C                     MOVE 'N'       S01509                          S01509
     C                     END                                            S01509
     C*                                                                   S01510
     C** Check if Dividend Payments is installed                          S01510
     C*                                                                   S01510
     C                     CALL 'AOSARDR0'                                S01510
     C                     PARM *BLANKS   @RTCD                           S01510
     C                     PARM '*VERIFY' @OPTN                           S01510
     C                     PARM 'S01510'  @SARD   6                       S01510
     C*                                                                   S01510
     C           @RTCD     IFEQ *BLANK                                    S01510
     C                     MOVE 'Y'       S01510  1                       S01510
     C                     ELSE                                           S01510
     C                     MOVE 'N'       S01510                          S01510
     C                     END                                            S01510
     C*                                                                   S01512
     C** Check if Position Settlements is installed                       S01512
     C*                                                                   S01512
     C                     CALL 'AOSARDR0'                                S01512
     C                     PARM *BLANKS   @RTCD                           S01512
     C                     PARM '*VERIFY' @OPTN                           S01512
     C                     PARM 'S01512'  @SARD   6                       S01512
     C*                                                                   S01512
     C           @RTCD     IFEQ *BLANK                                    S01512
     C                     MOVE 'Y'       S01512  1                       S01512
     C                     ELSE                                           S01512
     C                     MOVE 'N'       S01512                          S01512
     C                     END                                            S01512
     C*                                                                   S01519
     C** Check if Position Settlements Automatic Charges is installed     S01519
     C*                                                                   S01519
     C                     CALL 'AOSARDR0'                                S01519
     C                     PARM *BLANKS   @RTCD                           S01519
     C                     PARM '*VERIFY' @OPTN                           S01519
     C                     PARM 'S01519'  @SARD   6                       S01519
     C*                                                                   S01519
     C           @RTCD     IFEQ *BLANK                                    S01519
     C                     MOVE 'Y'       S01519  1                       S01519
     C                     ELSE                                           S01519
     C                     MOVE 'N'       S01519                          S01519
     C                     END                                            S01519
     C*                                                                   CEU005
     C** Check if EMU Settlement Ccy Conversion is installed              CEU005
     C*                                                                   CEU005
     C                     CALL 'AOSARDR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*VERIFY' @OPTN                           CEU005
     C                     PARM 'CEU005'  @SARD   6                       CEU005
     C*                                                                   CEU005
     C           @RTCD     IFEQ *BLANK                                    CEU005
     C                     MOVE 'Y'       CEU005  1                       CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'N'       CEU005                          CEU005
     C                     END                                            CEU005
      *                                                                   CSE023
      ** Check if CSE023 - Treaty withholding Tax is switched ON          CSE023
      *                                                                   CSE023
     C                     CALL 'AOSARDR0'                                CSE023
     C                     PARM *BLANKS   @RTCD                           CSE023
     C                     PARM '*VERIFY' @OPTN                           CSE023
     C                     PARM 'CSE023'  @SARD   6                       CSE023
      *                                                                   CSE023
     C           @RTCD     IFEQ *BLANK                                    CSE023
     C                     MOVE 'Y'       CSE023  1                       CSE023
     C                     ELSE                                           CSE023
     C                     MOVE 'N'       CSE023                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                                       CSE028
      ** Check if CSE028 - MT5xx Standing Settlements Instructions is                         CSE028
      **   is switched on.                                                                    CSE028
      *                                                                                       CSE028
     C                     CALL 'AOSARDR0'                                                    CSE028
     C                     PARM *BLANKS   @RTCD                                               CSE028
     C                     PARM '*VERIFY' @OPTN                                               CSE028
     C                     PARM 'CSE028'  @SARD                                               CSE028
      *                                                                                       CSE028
     C           @RTCD     IFEQ *BLANK                                                        CSE028
     C                     MOVE 'Y'       CSE028  1                                           CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'N'       CSE028                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
      *                                                                                       CGL020
      ** Determine if Midas Compliance Watch is installed                                     CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM '       ' @RTCD                                               CGL020
     C                     PARM '*VERIFY' @OPTN                                               CGL020
     C                     PARM 'CGL020'  @SARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           @RTCD     IFNE *BLANK                                                        CGL020
     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     Z-ADD25        DBASE                                               CGL020
     C                     MOVEL@SARD     DBKEY                                               CGL020
     C                     OUT  LDA                                                           CGL020
     C                     MOVE *ON       *INU7                                               CGL020
     C                     MOVE *ON       *INU8                                               CGL020
     C                     MOVE *ON       *INLR                                               CGL020
     C                     EXSR *PSSR                                                         CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL031
      ** Check if CGL031 - Taxation of Savings Income                                         CGL031
      **   is switched on.                                                                    CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   P@RTCD  7                                           CGL031
     C                     PARM '*VERIFY' P@OPTN  7                                           CGL031
     C                     PARM 'CGL031'  P@SARD  6                                           CGL031
      *                                                                                       CGL031
     C           P@RTCD    IFEQ *BLANK                                                        CGL031
     C                     MOVE 'Y'       CGL031  1                                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'N'       CGL031                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                     AR853119
      ** Check if CER049 - Stamp Tax is switch on                                           AR853119
      *                                                                                     AR853119
     C                     CALL 'AOSARDR0'                                                  AR853119
     C                     PARM *BLANKS   P@RTCD                                            AR853119
     C                     PARM '*VERIFY' P@OPTN                                            AR853119
     C                     PARM 'CER049'  P@SARD                                            AR853119
      *                                                                                     AR853119
     C           P@RTCD    IFEQ *BLANK                                                      AR853119
     C                     MOVE 'Y'       CER049  1                                         AR853119
     C                     ELSE                                                             AR853119
     C                     MOVE 'N'       CER049                                            AR853119
     C                     ENDIF                                                            AR853119
      **********                                                                AR1001183 AR1001183A
      ***Check*if*CRE073*is*switched*on                                         AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           CALL 'AOSARDR0'                                      AR1001183 AR1001183A
     C**********           PARM           @RTCD                                 AR1001183 AR1001183A
     C**********           PARM '*VERIFY' @OPTN                                 AR1001183 AR1001183A
     C**********           PARM 'CRE073'  @SARD                                 AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***Process*database*error                                                 AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** @RTCD     IFEQ *BLANKS                                         AR1001183 AR1001183A
     C**********           MOVE 'Y'       CRE073  1                             AR1001183 AR1001183A
     C**********           ELSE                                                 AR1001183 AR1001183A
     C**********           MOVE 'N'       CRE073                                AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      *                                                                                       CGL031
      ** Access Bank Details                                                                  CGL031
      *                                                                                       CGL031
     C                     CALL 'AOBANKR0'                                                    CGL031
     C                     PARM *BLANKS   P@RTCD                                              CGL031
     C                     PARM '*FIRST ' P@OPTN                                              CGL031
     C           SDBANK    PARM SDBANK    DSFDY                                               CGL031
      *                                                                                       CGL031
     C           P@RTCD    IFNE *BLANK                                                        CGL031
     C                     MOVE 'SDBANKPD'DBFILE                                              CGL031
     C                     MOVE '*FIRST ' DBKEY                                               CGL031
     C                     Z-ADD64        DBASE                                               CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       219566
      **  Access SDSAVLPD for Default settlement account to portfolio 001 indicator (Y/N)     219566
     C                     CALL 'AOSVALR0'                                                    219566
     C                     PARM *BLANKS   RTNCDE  7                                           219566
     C                     PARM           SVALK1 20                                           219566
     C                     PARM           SVAL1 200                                           219566
     C                     PARM           SVALK2 20                                           219566
     C                     PARM           SVAL2 200                                           219566
     C                     PARM           SVALK3 20                                           219566
     C                     PARM           SVAL3 200                                           219566
     C                     PARM           SVALK4 20                                           219566
     C                     PARM           SVAL4 200                                           219566
     C                     PARM           SVALK5 20                                           219566
     C                     PARM           SVAL5 200                                           219566
     C                     PARM           SVALK6 20                                           219566
     C                     PARM           SVAL6 200                                           219566
     C                     PARM           SVALK7 20                                           219566
     C                     PARM           SVAL7 200                                           219566
     C                     PARM           SVALK8 20                                           219566
     C                     PARM           SVAL8 200                                           219566
     C                     PARM           SVALK9 20                                           219566
     C                     PARM           SVAL9 200                                           219566
     C                     PARM           SVALK0 20                                           219566
     C                     PARM           SVAL10200                                           219566
      *                                                                                       219566
     C           RTNCDE    IFNE *BLANKS                                                       219566
     C           *LOCK     IN   LDA                                                           219566
     C                     MOVE SVALK1    DBKEY            * DB ERROR 47 *                    219566
     C                     Z-ADD47        DBASE                                               219566
     C                     MOVE 'SDSVALPD'DBFILE                                              219566
     C                     MOVEL'SE2400'  DBPGM                                               219566
     C                     OUT  LDA                                                           219566
     C                     SETON                     U7U8LR                                   219566
     C                     EXSR *PSSR                                                         219566
     C                     ENDIF                                                              219566
      *                                                                                       219566
      ** Access SAR details file to check CSE110 feature if installed.                        CSE110
      *                                                                                       CSE110
     C                     MOVE 'N'       CSE110  1                                           CSE110
     C                     CALL 'AOSARDR0'                                                    CSE110
     C                     PARM *BLANKS   @RTCD                                               CSE110
     C                     PARM '*VERIFY' @OPTN                                               CSE110
     C                     PARM 'CSE110'  @SARD                                               CSE110
     C           SCSARD    PARM SCSARD    DSFDY                                               CSE110
      *                                                                                       CSE110
     C                     SELEC                                                              CSE110
     C           @RTCD     WHEQ *BLANK                                                        CSE110
     C                     MOVE *ON       *IN71                                               CSE110
     C                     MOVE 'Y'       CSE110                                              CSE110
     C           @RTCD     WHEQ '*NRF'                                                        CSE110
     C                     MOVE *OFF      *IN71                                               CSE110
     C                     MOVE 'N'       CSE110                                              CSE110
     C                     OTHER                                                              CSE110
     C           *LOCK     IN   LDA                                                           CSE110
     C                     MOVEL'SCSARDPD'DBFILE            *************                     CSE110
     C                     MOVEL'028'     DBASE             *DBERROR 028*                     CSE110
     C                     MOVEL@OPTN     DBKEY             *************                     CSE110
     C                     SETON                     U7U8LR                                   CSE110
     C                     OUT  LDA                                                           CSE110
     C                     EXSR *PSSR                                                         CSE110
     C                     ENDSL                                                              CSE110
      *                                                                   S01447
      ***  Define like field definitions                                  S01447
      *                                                                   S01447
      *                                                                   S01408
     C/COPY WNCPYSRC,SE2400CCP4                                           S01408
      *                                                                   S01408
     C           *LIKE     DEFN CLOC      UBRLOC           brch ctry      S01447
     C           *LIKE     DEFN S1RASO    UTXRSR           src tax rate   S01447
     C           *LIKE     DEFN TBRASR    UTXRRF           ref tax rate   S01447
     C           *LIKE     DEFN TBRAUS    UTXRUS           usr tax rate   S01447
     C           *LIKE     DEFN TBDLOR    UDLOR            ded.tax local  S01447
     C* Set up the pgm name                                                                   234440
     C*                                                                                       234440
     C                     MOVEL'SEETCPRT'WPGM    9                                           234440
     C                     MOVE 'V'       WPGM                                                234440
     C*                                                                                       234440
     C*                                                                   S01447
     C                     ENDSR
      *****************************************************************                    AR1001183
      ***/SPACE*3                                                               AR1001183 AR1001183A
      *****************************************************************                    AR1001183
      *****************************************************************         AR1001183 AR1001183A
      ***GETNCR*-*Subroutien*to*get*next*coupon*rate*******************         AR1001183 AR1001183A
      *****************************************************************         AR1001183 AR1001183A
      *****************************************************************         AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** GETNCR    BEGSR                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           Z-ADDBASC      UBASC                                 AR1001183 AR1001183A
     C**********           Z-ADDBASS      UBASS                                 AR1001183 AR1001183A
     C**********           MOVE SPRI      USPRI                                 AR1001183 AR1001183A
     C**********           MOVELCNSP      UCNSP                                 AR1001183 AR1001183A
     C**********           MOVELCNSG      UCNSG                                 AR1001183 AR1001183A
     C**********           MOVELRDMT      URDMT                                 AR1001183 AR1001183A
     C**********           MOVELRDFD      URDFD                                 AR1001183 AR1001183A
      ***Initialize*work*fields                                                 AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           MOVEL*BLANKS   WAD                                   AR1001183 AR1001183A
     C**********           MOVEL*BLANKS   WBR                                   AR1001183 AR1001183A
     C**********           MOVEL*BLANKS   WBS                                   AR1001183 AR1001183A
     C**********           MOVEL*BLANKS   WSI                                   AR1001183 AR1001183A
     C**********           MOVEL*BLANKS   WRM                                   AR1001183 AR1001183A
     C**********           MOVEL*BLANKS   WRF                                   AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***LOAD*APPLICABLE*DATE*INTO*ARRAY                                        AR1001183 AR1001183A
     C**********           Z-ADDAD01      WAD,1                                 AR1001183 AR1001183A
     C**********           Z-ADDAD02      WAD,2                                 AR1001183 AR1001183A
     C**********           Z-ADDAD03      WAD,3                                 AR1001183 AR1001183A
     C**********           Z-ADDAD04      WAD,4                                 AR1001183 AR1001183A
     C**********           Z-ADDAD05      WAD,5                                 AR1001183 AR1001183A
     C**********           Z-ADDAD06      WAD,6                                 AR1001183 AR1001183A
     C**********           Z-ADDAD07      WAD,7                                 AR1001183 AR1001183A
     C**********           Z-ADDAD08      WAD,8                                 AR1001183 AR1001183A
     C**********           Z-ADDAD09      WAD,9                                 AR1001183 AR1001183A
     C**********           Z-ADDAD10      WAD,10                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***LOAD*BASE*RATE*INTO*ARRAY                                              AR1001183 AR1001183A
     C**********           Z-ADDBR01      WBR,1                                 AR1001183 AR1001183A
     C**********           Z-ADDBR02      WBR,2                                 AR1001183 AR1001183A
     C**********           Z-ADDBR03      WBR,3                                 AR1001183 AR1001183A
     C**********           Z-ADDBR04      WBR,4                                 AR1001183 AR1001183A
     C**********           Z-ADDBR05      WBR,5                                 AR1001183 AR1001183A
     C**********           Z-ADDBR06      WBR,6                                 AR1001183 AR1001183A
     C**********           Z-ADDBR07      WBR,7                                 AR1001183 AR1001183A
     C**********           Z-ADDBR08      WBR,8                                 AR1001183 AR1001183A
     C**********           Z-ADDBR09      WBR,9                                 AR1001183 AR1001183A
     C**********           Z-ADDBR10      WBR,10                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           Z-ADDCNP01     WBS,1                                 AR1001183 AR1001183A
     C**********           Z-ADDCNP02     WBS,2                                 AR1001183 AR1001183A
     C**********           Z-ADDCNP03     WBS,3                                 AR1001183 AR1001183A
     C**********           Z-ADDCNP04     WBS,4                                 AR1001183 AR1001183A
     C**********           Z-ADDCNP05     WBS,5                                 AR1001183 AR1001183A
     C**********           Z-ADDCNP06     WBS,6                                 AR1001183 AR1001183A
     C**********           Z-ADDCNP07     WBS,7                                 AR1001183 AR1001183A
     C**********           Z-ADDCNP08     WBS,8                                 AR1001183 AR1001183A
     C**********           Z-ADDCNP09     WBS,9                                 AR1001183 AR1001183A
     C**********           Z-ADDCNP10     WBS,10                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***LOAD*CONTRACTUAL*SPREAD*INDICATOR*INTO*ARRAY                           AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           MOVEACNG01     WSI,1                                 AR1001183 AR1001183A
     C**********           MOVEACNG02     WSI,2                                 AR1001183 AR1001183A
     C**********           MOVEACNG03     WSI,3                                 AR1001183 AR1001183A
     C**********           MOVEACNG04     WSI,4                                 AR1001183 AR1001183A
     C**********           MOVEACNG05     WSI,5                                 AR1001183 AR1001183A
     C**********           MOVEACNG06     WSI,6                                 AR1001183 AR1001183A
     C**********           MOVEACNG07     WSI,7                                 AR1001183 AR1001183A
     C**********           MOVEACNG08     WSI,8                                 AR1001183 AR1001183A
     C**********           MOVEACNG09     WSI,9                                 AR1001183 AR1001183A
     C**********           MOVEACNG10     WSI,10                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***LOAD*ROUNDING*METHOD*INTO*ARRAY                                        AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           MOVELRDM01     WRM,1                                 AR1001183 AR1001183A
     C**********           MOVELRDM02     WRM,2                                 AR1001183 AR1001183A
     C**********           MOVELRDM03     WRM,3                                 AR1001183 AR1001183A
     C**********           MOVELRDM04     WRM,4                                 AR1001183 AR1001183A
     C**********           MOVELRDM05     WRM,5                                 AR1001183 AR1001183A
     C**********           MOVELRDM06     WRM,6                                 AR1001183 AR1001183A
     C**********           MOVELRDM07     WRM,7                                 AR1001183 AR1001183A
     C**********           MOVELRDM08     WRM,8                                 AR1001183 AR1001183A
     C**********           MOVELRDM09     WRM,9                                 AR1001183 AR1001183A
     C**********           MOVELRDM10     WRM,10                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***LOAD*ROUNDING*FRACTION/DECIMAL*INTO*ARRAY                              AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           MOVELRDF01     WRF,1                                 AR1001183 AR1001183A
     C**********           MOVELRDF02     WRF,2                                 AR1001183 AR1001183A
     C**********           MOVELRDF03     WRF,3                                 AR1001183 AR1001183A
     C**********           MOVELRDF04     WRF,4                                 AR1001183 AR1001183A
     C**********           MOVELRDF05     WRF,5                                 AR1001183 AR1001183A
     C**********           MOVELRDF06     WRF,6                                 AR1001183 AR1001183A
     C**********           MOVELRDF07     WRF,7                                 AR1001183 AR1001183A
     C**********           MOVELRDF08     WRF,8                                 AR1001183 AR1001183A
     C**********           MOVELRDF09     WRF,9                                 AR1001183 AR1001183A
     C**********           MOVELRDF10     WRF,10                                AR1001183 AR1001183A
      ***CHECK*IF*THE*NEXT*COUPON*DATE*IS*GREATER*OR*EQUAL*TO*ANY*OF            AR1001183 AR1001183A
      ***THE*ADDITIONAL*COUPON*DATES.*IF*IT*IS*THAN*USE*THE*BASE*RATE           AR1001183 AR1001183A
      ***INFORMATION*SUPPLIED.                                                  AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           MOVE 'N'       WAPP    1                             AR1001183 AR1001183A
     C**********           Z-ADD10        X       20                            AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** X         DOWGT0                                               AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** WAD,X     IFNE *ZERO                                           AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***CONVERT*DATE*TO*DAY*NUMBER                                             AR1001183 AR1001183A
     C**********           Z-ADDWAD,X     ZDATE                                 AR1001183 AR1001183A
     C**********           EXSR ZDATE1                                          AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** WDAT      IFGE ZDAYNO                                          AR1001183 AR1001183A
     C**********           MOVE 'Y'       WAPP                                  AR1001183 AR1001183A
     C**********           LEAVE                                                AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
     C**********           SUB  1         X                                     AR1001183 AR1001183A
     C**********           ENDDO                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***USE*RATE*FROM*ADDITIONAL*COUPON*DATE*INFORMATION                       AR1001183 AR1001183A
     C********** WAPP      IFEQ 'Y'                                             AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***SET*NEW*BASE*RATE                                                      AR1001183 AR1001183A
     C********** WBR,X     IFNE *ZERO                                           AR1001183 AR1001183A
     C**********           Z-ADDWBR,X     UBASC                                 AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***SET*NEW*SPREAD*RATE                                                    AR1001183 AR1001183A
     C********** WBS,X     IFNE *ZERO                                           AR1001183 AR1001183A
     C**********           Z-ADDWBS,X     UBASS                                 AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***SET*NEW*SPREAD*INDICATOR                                               AR1001183 AR1001183A
     C**********           MOVEAWSI,X     USPRI                                 AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ** SET ROUNDING METHOD                                                    AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           MOVELWRM,X     URDMT                                 AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***SET*ROUNDING*FRACTION/DECIMAL                                          AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           MOVELWRF,X     URDFD                                 AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** UBASC     IFGT 0                                               AR1001183 AR1001183A
     C********** UBASS     ORGT 0                                               AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***OBTAIN*BASE*RATE*INFO*FROM*SDBSRTPD                                    AR1001183 AR1001183A
     C**********           MOVE UBASC     PBSRC   2                             AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           CALL 'AOBSRTR0'                                      AR1001183 AR1001183A
     C**********           PARM *BLANKS   @RTCD                                 AR1001183 AR1001183A
     C**********           PARM '*KEY   ' @OPTN                                 AR1001183 AR1001183A
     C**********           PARM VLCY      PCCY    3                             AR1001183 AR1001183A
     C**********           PARM           PBSRC                                 AR1001183 AR1001183A
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** @RTCD     IFNE *BLANKS                                         AR1001183 AR1001183A
     C**********           MOVELVLCY      WKEY2   5                             AR1001183 AR1001183A
     C**********           MOVE UBASC     WKEY2                                 AR1001183 AR1001183A
     C**********           Z-ADD69        DBASE                                 AR1001183 AR1001183A
     C**********           MOVEL'SDBSRTPD'DBFILE                                AR1001183 AR1001183A
     C**********           MOVELWKEY2     DBKEY                                 AR1001183 AR1001183A
     C**********           EXSR *PSSR                                           AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***USE*NEW*BASE*RATE*IF*APPROPRIATE,*OTHERWISE*USE*CURRENT*RATE           AR1001183 AR1001183A
     C********** BAVDNR    IFLE WDAT                                            AR1001183 AR1001183A
     C**********           Z-ADDBANBRT    USDNC  117                            AR1001183 AR1001183A
     C**********           ELSE                                                 AR1001183 AR1001183A
     C**********           Z-ADDBACBSR    USDNC                                 AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           CALL SPRDSR                                          AR1001183 AR1001183A
     C**********           PARM *BLANKS   PRTCD                                 AR1001183 AR1001183A
     C**********           PARM           BANBRT                                AR1001183 AR1001183A
     C**********           PARM           UBASS                                 AR1001183 AR1001183A
     C**********           PARM           USPRI                                 AR1001183 AR1001183A
     C**********           PARM           URDMT                                 AR1001183 AR1001183A
     C**********           PARM           URDFD                                 AR1001183 AR1001183A
     C**********           PARM *ZERO     NSPRD  117                            AR1001183 AR1001183A
     C**********           PARM *ZERO     FRATE  117                            AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** PRTCD     IFNE *BLANK                                          AR1001183 AR1001183A
     C********** *LOCK     IN   LDA                                             AR1001183 AR1001183A
     C**********           Z-ADD70        DBASE                                 AR1001183 AR1001183A
     C**********           MOVELSPRDSR    DBPGM                                 AR1001183 AR1001183A
     C**********           MOVELBANBRT    DBKEY                                 AR1001183 AR1001183A
     C**********           OUT  LDA                                             AR1001183 AR1001183A
     C**********           EXSR *PSSR                                           AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           Z-ADDFRATE     WPSXR  138                            AR1001183 AR1001183A
     C**********           MOVE 'Y'       WRCHG                                 AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
      ***Override*value*of*PSXR*if*final*rate*<=*zero                           AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********** FRATE     IFLE 0                                               AR1001183 AR1001183A
     C**********           Z-ADD0         WPSXR                                 AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           ENDIF                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C**********           ENDSR                                                AR1001183 AR1001183A
      **********                                                                AR1001183 AR1001183A
     C********************************************************************                  AR324886
     C/EJECT                                                                                AR324886
     C********************************************************************                  AR324886
     C           PSAUDT    BEGSR                                                            AR324886
      *                                                                                     AR324886
     C                     MOVE RECI      PARECI                                            AR324886
     C                     MOVE PBCA      PAPBCA                                            AR324886
     C                     MOVE PSSH      PAPSSH                                            AR324886
     C                     MOVE PCPY      PAPCPY                                            AR324886
     C                     MOVE PDUD      PAPDUD                                            AR324886
     C                     MOVE PEVT      PAPEVT                                            AR324886
     C                     MOVE PTFR      PAPTFR                                            AR324886
     C                     MOVE TNLU      PATNLU                                            AR324886
     C                     MOVE TXBS      PATXBS                                            AR324886
     C                     MOVE BNFO      PABNFO                                            AR324886
     C                     MOVE EXCD      PAEXCD                                            AR324886
     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
     C                     MOVE LCD       PALCD                                             AR324886
     C                     MOVE CHTP      PALCTP                                            AR324886
     C                     WRITEPSAUTDF                                                     AR324886
      *                                                                                     AR324886
     C                     ENDSR                                                            AR324886
      *****************************************************************
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C*****************************************************************
      /EJECT                                                              S01512
     C*                                                                   S01486
     C********************************************************************S01486
     C**  ZTNLU1     :       TO LOCK THE TRANSACTION NUMBER DATA AREA,    S01486
     C**                     ACCESS THE NEXT AVAILABLE TRANSACTION NUMBER,S01486
     C**                     THEN UPDATE AND RELEASE THE DATA AREA.       S01486
     C********************************************************************S01486
     C           ZTNLU1    BEGSR                            ** ZTNLU1 BSR*S01486
     C*                                                                   S01486
     C           *NAMVAR   DEFN MNATN     DNATN                           S01486
     C           *LOCK     IN   DNATN                                     S01486
     C                     MOVE FNATN     NATN    50                      S01486
     C                     MOVE FNATN     ZZWK05  50                      S01486
     C                     ADD  1         ZZWK05                          S01486
     C                     MOVE ZZWK05    FNATN                           S01486
     C                     OUT  DNATN                                     S01486
     C*                                                                   S01486
     C                     ENDSR                            ** ZTNLU1 ESR*S01486
     C********************************************************************S01486
     C/COPY WNCPYSRC,SE2400C023
      /EJECT                                                              064754
     C/COPY ZSRSRC,ZNCDZ3                                                 064754
      /EJECT
     C/COPY ZSRSRC,ZACCH                                                  S01512
      /EJECT                                                              S01519
     C/COPY ZSRSRC,ZAVPRZ1                                                S01519
      /EJECT                                                              S01519
     C/COPY ZSRSRC,ZCCAL1Z2                                               S01519
      /EJECT                                                              S01519
     C/COPY ZSRSRC,ZCCAL2Z1                                               S01519
      /EJECT
     C/COPY ZSRSRC,ZCNSDZ1                                                E22638
      /EJECT                                                              S01512
     C/COPY ZSRSRC,ZCONVZ1                                                S01509
      /EJECT                                                              S01512
     C/COPY ZSRSRC,ZFWDT                                                  S01512
     C/EJECT                                                              E22638
     C/COPY ZSRSRC,ZCCYGBZ1                                               S01486
     C/COPY ZSRSRC,ZCCYCN                                                 S01486
     C/COPY ZSRSRC,ZCCYXR                                                 S01486
     C/COPY ZSRSRC,ZAINSH                                                 S01486
     C*****************************************************************   S01486
     C*                                                               *   S01486
     C*  ZAISCH - CALCULATE SE ACCRUED INTEREST - SCHULDSCHEIN        *   S01486
     C*                                                               *   S01486
     C*  PURPOSE : TO CALCULATE SE ACCRUED INTEREST FOR               *   S01486
     C*            SCHULDSCHEIN SECURITIES                            *   S01486
     C*                                                               *   S01486
     C*  FILE USED                                                    *   S01486
     C*       LF/SEEVNT: SECURITY EVENTS FILE OVERRIDEN IN CALLING PGM*   S01486
     C*       FIELDS TO BE RENAMED IN I SPECS:                        *   S01486
     C*         SNDT (SNDEVD) TO SDED                                 *   S01486
     C*         SNET (SNDEVD) TO SDET                                 *   S01486
     C*       LF/PMAPOSLL:ALL PORTFOLIO POSITIONS                     *   S01486
     C*                                                               *   S01486
     C*  FILES NEEDED (THESE FILES AND DATA AREA MUST HAVE BEEN       *   S01486
     C*                ACCESSED BEFORE THIS SUBROUTINE IS EXECUTED)   *   S01486
     C*       LF/SECTY: SECURITIES                                    *   S01486
     C*       LF/INVTP: INVESTMENT TYPES                              *   S01486
     C*       LF/SDCURRL0: CURRENCIES, FOR NOMINAL CURRENCY D.P.      *   S01486
     C*       DTAARA/PMSTAT: FOR EVENT CONTROL DATE                   *   S01486
     C*                                                               *   S01486
     C*  SUBROUTINES NEEDED                                           *   S01486
     C*       ZNCD MUST HAVE BEEN CALLED BEFORE CALLING THIS SUBR.    *   S01486
     C*                                                               *   S01486
     C*  INPUT  FIELDS                                                *   S01486
     C*       ZFMDAT  5 0     FROM DATE                               *   S01486
     C*       ZTODAT  5 0     TO DATE                                 *   S01486
     C*       XCUST   6 0     CUSTOMER                                *   S01486
     C*       ZPTRF   4       PORTFOLIO REFERENCE                     *   S01486
     C*       ZSSNM  10       SECURITY SHORTNAME                      *   S01486
     C********ZTVBS   1       TRADE/VALUE BASIS                *   S01486 189942
     C*                                                               *   S01486
     C*  OUTPUT  FIELDS                                               *   S01486
     C*       ZTOAI  15 0     TOTAL ACCRUED INTEREST                  *   S01486
     C*       ZTOND   5 0     TOTAL NUMBER OF INTEREST DAYS           *   S01486
     C*                                                               *   S01486
     C*  WORK FIELDS:                                                 *   S01486
     C*                                                               *   S01486
     C*  CALLS:  ZRATE, ZACCR                                         *   S01486
     C*****************************************************************   S01486
     C           ZAISCH    BEGSR                           *** ZAISCH *** S01486
     C*                                                                   S01486
     C** DEFINE FIELDS                                                    S01486
     C                     Z-ADDZFMDAT    ZFMDAT  50                      S01486
     C                     Z-ADDZTODAT    ZTODAT  50                      S01486
     C                     MOVE ZCDPA     ZCDPA   3                       189942
     C**********           Z-ADDXCUST     XCUST   60                                   S01486 CSD027
     C                     MOVE XCUST     XCUST   6                                           CSD027
     C                     MOVE ZPTRF     ZPTRF   4                       S01486
     C                     MOVE ZSSNM     ZSSNM  10                       S01486
     C***********          MOVE ZTVBS     ZTVBS   1                S01486 189942
     C**********           Z-ADDZCDDP     ZCDDP   60                                   189942 CSD027
     C                     MOVE ZCDDP     ZCDDP   6                                           CSD027
     C                     MOVE ZCDMK     ZCDMK   1                       189942
     C*                                                                   S01486
     C** SET THE TOTAL ACCRUED INTEREST ZTOAI AND TOTAL NUMBER OF         S01486
     C** INTEREST DAYS ZTOND EQUAL TO ZERO                                S01486
     C                     Z-ADD0         ZTOAI  150                      S01486
     C                     Z-ADD0         ZTOND   50                      S01486
     C                     Z-ADD0         ZSINP  150                      S01486
     C*                                                                   S01486
     C           KSEE1     KLIST                                          S01486
     C                     KFLD           ZSSNM                           S01486
     C                     KFLD           ZFMDAT                          S01486
     C                     KFLD           ZTYP                            S01486
     C*                                                                   S01486
     C***SET*GREATER*THAN LIMITS ON LF/PMAPOSLL WITH A KEY OF CUSTOS01486 189942
     C***ZCUST,*PORTFOLIO*ZPTRF,*SECURITY*ZSSNM*AND*TRADE/VALUE*DATS01486 189942
     C***XCUST,*PORTFOLIO*ZPTRF,*SECURITY ZSSNM AND TRADE/VALUE DATS01486 189942
     C***BASIS*ZTVBS*AND*A*DATE EQUAL TO THE FROM DATE ZFMDAT      S01486 189942
     C***********KPMA1     KLIST                                   S01486 189942
     C***********          KFLD           XCUST                    S01486 189942
     C***********          KFLD           ZPTRF                    S01486 189942
     C***********          KFLD           ZSSNM                    S01486 189942
     C***********          KFLD           ZTVBS                    S01486 189942
     C***********          KFLD           ZFMDAT                   S01486 189942
     C***********KPMA1     SETGTPMAPOSLL                           S01486 189942
     C***********                                                  S01486 189942
     C***READ*PREVIOUS*FROM LF/PMAPOSLL                            S01486 189942
     C***********          READPPMAPOSLL                 91        S01486 189942
     C*                                                                   189942
     C           KPMA1     KLIST                                          189942
     C                     KFLD           ZCDPA                           189942
     C                     KFLD           XCUST                           189942
     C                     KFLD           ZPTRF                           189942
     C                     KFLD           ZSSNM                           189942
     C                     KFLD           ZCDDP                           189942
     C                     KFLD           ZCDMK                           189942
     C                     KFLD           ZFMDAT                          189942
     C*                                                                   189942
     C           KPMA1     SETGTSECDEPL5                                  189942
     C*                                                                   189942
     C** READ PREVIOUS FROM LF/SECDEPL5                                   189942
     C                     READPSECDEPL5                 91               189942
     C*                                                                   S01486
     C** IF THE CUSTOMER, PORTFOLIO, SECURITY AND TRADE/VALUE DATE        S01486
     C***BASIS*ON*LF/PMAPOSLL ARE THE SAME AS IN THE KEY ABOVE     S01486 189942
     C***********XCUST     IFEQ QACNUM                             S01486 189942
     C***********ZPTRF     ANDEQQAPTFR                             S01486 189942
     C***********ZSSNM     ANDEQQATDSS                             S01486 189942
     C***********ZTVBS     ANDEQQATVDA                             S01486 189942
     C** BASIS ON LF/SECDEPL5 ARE THE SAME AS IN THE KEY ABOVE            189942
     C           ZCDPA     IFEQ CDPA                                      189942
     C           XCUST     ANDEQCDCN                                      189942
     C           ZPTRF     ANDEQPTFR                                      189942
     C           ZPTRF     ANDEQPTFR                                      189942
     C           ZSSNM     ANDEQCDSN                                      189942
     C           ZCDDP     ANDEQCDPT                                      189942
     C           ZCDMK     ANDEQCDMK                                      189942
     C*                                                                   S01486
     C** SUBTRACT THE EX-COUPON NOMINAL FROM THE NOMINAL (BOTH FROM       S01486
     C***LF/PMAPOSLL)*AND*PUT THE RESULT IN PRINCIPAL AMOUNT ZAMT  S01486 189942
     C** LF/SECDEPL5) AND PUT THE RESULT IN PRINCIPAL AMOUNT ZAMT         189942
     C***********QANOML    SUB  QACSEX    ZAMT                     S01486 189942
     C********** CDNV      SUB  CSEX      ZAMT                                       189942 AR877365
     C           CDNV      SUB  CECN      ZAMT                                              AR877365
     C                     ELSE                                           S01486
     C*                                                                   S01486
     C** IF THEY ARE DIFFERENT OR EOF IS REACHED, SET THE PRINCIPAL       S01486
     C** AMOUNT ZAMT EQUAL TO ZERO                                        S01486
     C                     Z-ADD0         ZAMT                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** SET THE FOLLOWING FIELDS FOR STANDARD SUBROUTINE ZRATE           S01486
     C** SET ZPPCP EQUAL TO CPDP FROM LF/SECTY                            S01486
     C                     Z-ADDCPDP      ZPPCP                           S01486
     C** SET ZSFPP EQUAL TO SFPP FROM LF/SECTY                            S01486
     C                     Z-ADDSFPP      ZSFPP                           S01486
     C** SET ZSINP EQUAL TO SINP FROM LF/SECTY                            S01486
     C                     Z-ADDSINP      ZSINP                           S01486
     C** SET ZPPDI EQUAL TO PPDI FROM LF/SECTY                            S01486
     C                     MOVE PPDI      ZPPDI                           S01486
     C** SET ZCPNR EQUAL TO CPNR FROM LF/SECTY                            S01486
     C                     Z-ADDCPNR      ZCPNR                           S01486
     C** SET ZCFCT EQUAL TO CFCT FROM LF/SECTY                            S01486
     C                     Z-ADDCFCT      ZCFCT                           S01486
     C** SET ZPROT EQUAL TO PROT FROM LF/INVTP                            S01486
     C                     MOVE PROT      ZPROT                           S01486
     C*                                                                   S01486
     C** SET THE FOLLOWING FIELDS FOR STANDARD SUBROUTINE ZACCR           S01486
     C                     Z-ADDA6NBDP    ZCDP                            S01486
     C*                                                                   S01486
     C** ACCESS LF/SEEVNT USING A KEY OF SECURITY ZSSNM, FROM DATE        S01486
     C** ZFMDAT AND EVENT TYPE EQUAL TO 'CP'                              S01486
     C                     MOVEL'CP'      ZTYP    2                       S01486
     C           KSEE1     CHAINSEEVNT               91                   S01486
     C           *IN91     IFEQ '0'                                       S01486
     C*                                                                   S01486
     C** IF A LAST COUPON DATE EVENT IS READ ABOVE, (NOTE THAT ZFMDAT     S01486
     C** WILL BE A COUPON DATE) THEN SET THE FIELDS USED BY ZRATE         S01486
     C** AS FOLLOWS:                                                      S01486
     C** SET ZCPNR EQUAL TO SNCR FROM LF/SEEVNT                           S01486
     C                     Z-ADDSNCR      ZCPNR                           S01486
     C** SET ZCFCT EQUAL TO SNCF FROM LF/SEEVNT                           S01486
     C                     Z-ADDSNCF      ZCFCT                           S01486
     C** SET ZPPCP EQUAL TO SNCP FROM LF/SEEVNT                           S01486
     C                     Z-ADDSNCP      ZPPCP                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** SET START OF INTEREST PERIOD DATE ZSDATE EQUAL TO THE FROM       S01486
     C** DATE ZFMDAT                                                      S01486
     C                     Z-ADDZFMDAT    ZSDATE                          S01486
     C*                                                                   S01486
     C** SET GREATER THAN LIMITS ON LF/SEEVNT USING A KEY OF SECURITY     S01486
     C** ZSSNM, FROM DATE ZFMDAT AND EVENT TYPE EQUAL TO 'CP'             S01486
     C           KSEE1     SETGTSEEVNT                                    S01486
     C*                                                                   S01486
     C** READ EQUAL FROM LF/SEEVNT WITH A KEY EQUAL TO THE SECURITY       S01486
     C** SHORTNAME ZSSNM                                                  S01486
     C           ZSSNM     READESEEVNT                   91               S01486
     C*                                                                   S01486
     C** READ UNTIL THE EVENT HAS AN EVENT TYPE SDET EQUAL TO 'PP' 'MP' OR 'IR'
     C*                                                                   S01486
     C           *IN91     DOWEQ'0'                                       S01486
     C           SDET      ANDNE'PP'                                      S01486
     C           SDET      ANDNE'MP'                                      S01486
     C           SDET      ANDNE'IR'                                      S01486
     C           ZSSNM     READESEEVNT                   91               S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** SET GREATER THAN LIMITS ON LF/PMAPOSLL WITH A KEY OF CUSTOMER    S01486
     C***ZCUST,*PORTFOLIO*ZPTRF,*SECURITY*ZSSNM*AND*TRADE/VALUE*DATE      S01486
     C** XCUST, PORTFOLIO ZPTRF, SECURITY ZSSNM AND TRADE/VALUE DATE      S01486
     C** BASIS ZTVBS AND A DATE EQUAL TO THE FROM DATE ZFMDAT             S01486
     C***********KPMA1     SETGTPMAPOSLL                           S01486 189942
     C           KPMA1     SETGTSECDEPL5                                  189942
     C*                                                                   S01486
     C***READ*EQUAL*FROM*LF/PMAPOSLL*WITH*THE*CUSTOMER*ZCUST,*PORTFOLIO   S01486
     C***READ*EQUAL*FROM LF/PMAPOSLL WITH THE CUSTOMER XCUST, PORT S01486 189942
     C** READ EQUAL FROM LF/SECDEPL5 WITH THE CUSTOMER XCUST, PORTFOLIO   189942
     C** ZPTRF, SECURITY ZSSNM AND TRADE/VALUE DATE BASIS ZTVBS           S01486
     C***********KPMA2     KLIST                                   S01486 189942
     C***********          KFLD           XCUST                    S01486 189942
     C***********          KFLD           ZPTRF                    S01486 189942
     C***********          KFLD           ZSSNM                    S01486 189942
     C***********          KFLD           ZTVBS                    S01486 189942
     C***********KPMA2     READEPMAPOSLL                 92        S01486 189942
     C           KPMA2     KLIST                                          189942
     C                     KFLD           ZCDPA                           189942
     C                     KFLD           XCUST                           189942
     C                     KFLD           ZPTRF                           189942
     C                     KFLD           ZSSNM                           189942
     C                     KFLD           ZCDDP                           189942
     C                     KFLD           ZCDMK                           189942
     C           KPMA2     READESECDEPL5                 92               189942
     C*                                                                   S01486
     C** DO WHILE NOT END OF FILE (IE. SAME SECURITY) ON LF/SEEVNT        S01486
     C** AND NOT END OF FILE (IE. SAME CUSTOMER, PORTFOLIO, SECURITY,     S01486
     C** TRADE/VALUE BASIS) ON LF/PMAPOSLL                                S01486
     C           *IN91     DOWEQ'0'                                       S01486
     C           *IN92     OREQ '0'                                       S01486
     C*                                                                   S01486
     C** IF NOT END OF FILE ON LF/SEEVNT                                  S01486
     C           *IN91     IFEQ '0'                                       S01486
     C*                                                                   S01486
     C** IF NOT END OF FILE ON LF/PMAPOSLL AND THE EVENT DATE SDED        S01486
     C** FROM LF/SEEVNT IS LESS THAN OR EQUAL TO THE POSITION DATE        S01486
     C** FROM LF/PMAPOSLL OR END OF FILE ON LF/PMAPOSLL                   S01486
     C           *IN92     IFEQ '0'                                       S01486
     C***********SDED      ANDLEQAPDAT                             S01486 189942
     C           SDED      ANDLEDDTE                                      189942
     C           SDED      ANDLTZTODAT                                    S01486
     C           *IN92     OREQ '1'                                       S01486
     C           SDED      ANDLTZTODAT                                    S01486
     C*                                                                   S01486
     C** SET THE END OF INTEREST PERIOD DATE ZEDATE EQUAL TO THE EVENT    S01486
     C** DATE SDED FROM LF/SEEVNT                                         S01486
     C                     Z-ADDSDED      ZEDATE                          S01486
     C*                                                                   S01486
     C** EXECUTE STANDARD SUBROUTINE ZRATE TO GET THE EFFECTIVE           S01486
     C** INTEREST RATE FOR THE PERIOD                                     S01486
     C                     EXSR ZRATE                                     S01486
     C*                                                                   S01486
     C** EXECUTE STANDARD SUBROUTINE ZACCR TO CALCULATE THE INTEREST      S01486
     C** FOR THE PERIOD                                                   S01486
     C                     EXSR ZACCR                                     S01486
     C/COPY WNCPYSRC,SE2400C052
     C*                                                                   S01486
     C** ADD THE ACCRUED INTEREST ZACCRD FROM ZACCR TO THE TOTAL          S01486
     C** ACCRUED INTEREST ZTOAI                                           S01486
     C                     ADD  ZACCRD    ZTOAI                           S01486
     C*                                                                   S01486
     C** ADD THE NUMBER OF DAYS ZDDAYS FROM ZACCR TO THE TOTAL NUMBER     S01486
     C** OF INTEREST DAYS ZTOND                                           S01486
     C                     ADD  ZDDAYS    ZTOND                           S01486
     C*                                                                   S01486
     C** SET THE START OF INTEREST PERIOD DATE ZSDATE EQUAL TO THE        S01486
     C** EVENT DATE SDED FROM LF/SEEVNT                                   S01486
     C                     Z-ADDSDED      ZSDATE                          S01486
     C*                                                                   S01486
     C** SET THE FOLLOWING FIELDS USED BY ZRATE AS FOLLOWS:               S01486
     C** SET ZCPNR EQUAL TO SDNC FROM LF/SEEVNT                           S01486
     C** SET ZCFCT EQUAL TO SDCP FROM LF/SEEVNT                           S01486
     C** SET ZPPCP EQUAL TO SDTP FROM LF/SEEVNT                           S01486
     C                     Z-ADDSDNC      ZCPNR                           S01486
     C                     Z-ADDSDCP      ZCFCT                           S01486
     C                     MOVE SDTP      ZPPCP                           S01486
     C*                                                                   S01486
     C** READ EQUAL FROM LF/SEEVNT WITH THE SECURITY SHORTNAME ZSSNM      S01486
     C           ZSSNM     READESEEVNT                   91               S01486
     C*                                                                   S01486
     C** READ UNTIL THE EVENT HAS AN EVENT TYPE SDET EQUAL TO 'PP' 'MP' OR 'IR'
     C*                                                                   S01486
     C           *IN91     DOWEQ'0'                                       S01486
     C           SDET      ANDNE'PP'                                      S01486
     C           SDET      ANDNE'MP'                                      S01486
     C           SDET      ANDNE'IR'                                      S01486
     C           ZSSNM     READESEEVNT                   91               S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** ELSE, IF EVENT DATE SDED FROM LF/SEEVNT IS GREATER THAN OR       S01486
     C** EQUAL TO TO DATE PARAMETER, TREAT AS END OF FILE ON LF/SEEVNT    S01486
     C                     ELSE                                           S01486
     C           SDED      IFGE ZTODAT                                    S01486
     C                     MOVE '1'       *IN91                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C***IF*NOT*END*OF*FILE ON LF/PMAPOSLL                         S01486 189942
     C** IF NOT END OF FILE ON LF/SECDEPL5                                189942
     C           *IN92     IFEQ '0'                                       S01486
     C*                                                                   S01486
     C** IF NOT END OF FILE ON LF/SEEVNT AND THE POSITION DATE FROM       S01486
     C***LF/PMAPOSLL*IS*LESS THAN THE EVENT DATE SDED FROM         S01486 189942
     C** LF/SECDEPL5 IS LESS THAN THE EVENT DATE SDED FROM                189942
     C** LF/SEEVNT OR END OF FILE ON LF/SEEVNT                            S01486
     C           *IN91     IFEQ '0'                                       S01486
     C***********QAPDAT    ANDLTSDED                               S01486 189942
     C***********QAPDAT    ANDLTZTODAT                             S01486 189942
     C           DDTE      ANDLTSDED                                      189942
     C           DDTE      ANDLTZTODAT                                    189942
     C           *IN91     OREQ '1'                                       S01486
     C***********QAPDAT    ANDLTZTODAT                             S01486 189942
     C           DDTE      ANDLTZTODAT                                    189942
     C*                                                                   S01486
     C** SET THE END OF INTEREST PERIOD DATE ZEDATE EQUAL TO THE          S01486
     C***POSITION*DATE*QAPDAT*FROM LF/PMAPOSLL                     S01486 189942
     C** POSITION DATE DDTE FROM LF/SECDEPL5                              189942
     C***********          Z-ADDQAPDAT    ZEDATE                   S01486 189942
     C                     Z-ADDDDTE      ZEDATE                          189942
     C*                                                                   S01486
     C** EXECUTE STANDARD SUBROUTINE ZRATE TO GET THE EFFECTIVE           S01486
     C** INTEREST RATE FOR THE PERIOD                                     S01486
     C                     EXSR ZRATE                                     S01486
     C*                                                                   S01486
     C** EXECUTE STANDARD SUBROUTINE ZACCR TO CALCULATE THE INTEREST      S01486
     C** FOR THE PERIOD                                                   S01486
     C                     EXSR ZACCR                                     S01486
     C/COPY WNCPYSRC,SE2400C053
     C*                                                                   S01486
     C** ADD THE ACCRUED INTEREST ZACCRD FROM ZACCR TO THE TOTAL          S01486
     C** ACCRUED INTEREST ZTOAI                                           S01486
     C                     ADD  ZACCRD    ZTOAI                           S01486
     C*                                                                   S01486
     C** ADD THE NUMBER OF DAYS ZDDAYS FROM ZACCR TO THE TOTAL NUMBER     S01486
     C** OF INTEREST DAYS ZTOND                                           S01486
     C                     ADD  ZDDAYS    ZTOND                           S01486
     C*                                                                   S01486
     C** SET THE START OF INTEREST PERIOD DATE ZSDATE EQUAL TO THE        S01486
     C***POSITION*DATE*QAPDAT FROM LF/PMAPOSLL                     S01486 189942
     C***********          Z-ADDQAPDAT    ZSDATE                   S01486 189942
     C** POSITION DATE DDTE   FROM LF/SECDEPL5                            189942
     C                     Z-ADDDDTE      ZSDATE                          189942
     C*                                                                   S01486
     C** SUBTRACT THE EX-COUPON NOMINAL FROM THE NOMINAL (BOTH FROM       S01486
     C***LF/PMAPOSLL)*AND*PUT THE RESULT IN PRINCIPAL AMOUNT ZAMT  S01486 189942
     C***********QANOML    SUB  QACSEX    ZAMT                     S01486 189942
     C** LF/SECDEPL5) AND PUT THE RESULT IN PRINCIPAL AMOUNT ZAMT         189942
     C********** CDNV      SUB  CSEX      ZAMT                                       189942 AR877365
     C           CDNV      SUB  CECN      ZAMT                                              AR877365
     C*                                                                   S01486
     C***READ*EQUAL*FROM*LF/PMAPOSLL*WITH*THE*CUSTOMER*ZCUST,*PORTFOLIO   S01486
     C***READ*EQUAL*FROM*LF/PMAPOSLL WITH THE CUSTOMER XCUST, PORT S01486 189942
     C** READ EQUAL FROM LF/SECDEPL5 WITH THE CUSTOMER XCUST, PORTFOLIO   189942
     C** ZPTRF, SECURITY ZSSNM AND TRADE/VALUE BASIS ZTVBS                S01486
     C***********KPMA2     READEPMAPOSLL                 92        S01486 189942
     C           KPMA2     READESECDEPL5                 92               189942
     C*                                                                   S01486
     C***ELSE,*IF*POSITION*DATE QAPDAT FROM LF/PMAPOSLL IS GREATER S01486 189942
     C** ELSE, IF POSITION DATE DDTE FROM LF/SECDEPL5 IS GREATER THAN     189942
     C** OR EQUAL TO TO DATE PARAMETER, TREAT AS END OF FILE ON           S01486
     C***LF/PMAPOSLL*******                                        S01486 189942
     C** LF/SECDEPL5                                                      189942
     C                     ELSE                                           S01486
     C***********QAPDAT    IFGE ZTODAT                             S01486 189942
     C           DDTE      IFGE ZTODAT                                    189942
     C                     MOVE '1'       *IN92                           S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** SET THE END OF INTEREST PERIOD DATE ZEDATE EQUAL TO THE TO       S01486
     C** DATE ZTODAT                                                      S01486
     C                     Z-ADDZTODAT    ZEDATE                          S01486
     C*                                                                   S01486
     C** EXECUTE STANDARD SUBROUTINE ZRATE TO GET THE EFFECTIVE           S01486
     C** INTEREST RATE FOR THE PERIOD                                     S01486
     C                     EXSR ZRATE                                     S01486
     C*                                                                   S01486
     C** EXECUTE STANDARD SUBROUTINE ZACCR TO CALCULATE THE INTEREST      S01486
     C** FOR THE PERIOD                                                   S01486
     C                     EXSR ZACCR                                     S01486
     C/COPY WNCPYSRC,SE2400C054
     C*                                                                   S01486
     C** ADD THE ACCRUED INTEREST ZACCRD FROM ZACCR TO THE TOTAL          S01486
     C** ACCRUED INTEREST ZTOAI                                           S01486
     C                     ADD  ZACCRD    ZTOAI                           S01486
     C*                                                                   S01486
     C** ADD THE NUMBER OF DAYS ZDDAYS FROM ZACCR TO THE TOTAL NUMBER     S01486
     C** OF INTEREST DAYS ZTOND                                           S01486
     C                     ADD  ZDDAYS    ZTOND                           S01486
     C*                                                                   S01486
     C           EAISCH    ENDSR                                          S01486
     C*****************************************************************   S01486
     C/COPY ZSRSRC,ZACCRZ1                                                S01486
     C/COPY ZSRSRC,ZRATEZ1                                                S01486
     C/COPY ZSRSRC,ZDYYRZ3                                                S01486
     C/COPY ZSRSRC,ZDAYSZ2                                                S01486
     C/COPY ZSRSRC,ZDATE1Z2                                               S01486
     C/COPY ZSRSRC,ZDATE2Z2                                               S01486
     C/COPY ZSRSRC,ZLCDZ1                                                 S01486
      /EJECT                                                              S01509
     C/COPY ZSRSRC,ZHASHZ3
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZICDSEZ1
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT
     C* *XRATEsubroutine now redundant                                    E23169
     C**********/COPY ZSRSRC,ZXRATEZ1                                     E23169
     C/COPY ZSRSRC,ZXRATEZ1                                               S01446
     C/COPY ZSRSRC,ZDATE9Z3                                                                   CGL031
     C/COPY WNCPYSRC,SE2400C025
      /EJECT
      ***
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  POWER - Array of powers for currency conversion
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)                      S01486
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                      S01486
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                        S01486
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES                                            S01486
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN                        CGL031
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                           CGL031
00000000310005900090001200015100181002120024300273003040033400365
**  CPY@
(c) Finastra International Limited 2001
