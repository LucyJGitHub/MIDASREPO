     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Gen entries and missing a/c key report')      *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE2450 - ENTRY GENERATION & MISSING ACCOUNT KEYS REPORT      *
     F*                                                               *
     F*  Function: To convert the Securities Trading Account Keys     *
     F*   (COB)    into the Midas Account Key structure.  If a        *
     F*            generated Account Key is found not to exist on     *
     F*            the Account Keys file it is reported.              *
     F*                                                               *
     F*  Called by: SEC0610 - Generate Accounting Entries - Accruals  *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD049636           Date 13Mar18               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 215959             Date 21Mar16               *
      *                 AR1056730          Date 15Nov12               *
      *                 CER049             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 248685             Date 29Jun07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 243764             Date 10Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12817           Date 07Dec06               *
      *                 234004             Date 23Oct06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG8292R           Date 30Aug05               *
      *                 BUG8292            Date 26Aug05               *
      *                 CGL031             Date 05Jul04               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 229342             Date 28Nov03               *
      *                 209743             Date 18Sep02               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CPK016             Date 04Sep03               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 199019             Date 11Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CPB002             Date 12Aug99               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 149569             Date 09Jun00               *
     F*                 179804             Date 05Jun00               *
     F*                 179645             Date 05Jun00               *
     F*                 078550             Date 20Apr00               *
     F*                 133649             Date 19Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CPB001             Date 12Aug99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 153890             Date 21Jan99               *
      *                 109024             Date 28Feb98               *
      *                 111337             Date 23Feb98               *
     F*                 CAC002             Date 15Sep96               *
     F*                 085280             Date 28Aug96               *
     F*                 102927             Date 08May96               *  *
     F*                 102909             Date 07May96               *
     F*                 077018             DATE 03MAY96               *
     F*                 051969             DATE 01MAY96               *
     F*                 099390             DATE 18APR96               *
     F*                 093919             DATE 18APR96               *
     F*                 089765             DATE 24OCT95               *
     F*                 087870             DATE 17MAY95               *
     F*                 086125             DATE 16MAR95               *
     F*                 S01522             DATE 25JAN95               *
     F*                 073681             DATE 25JUL94               *
     F*                 S01486             DATE 18NOV94               *
     F*                 053103             DATE 18NOV94               *
     F*                 046386             DATE 18NOV94               *
     F*                 057668             DATE 25APR94               *
     F*                 066305             DATE 04FEB94               *
     F*                 S01447             DATE 24NOV93               *
     F*                 S01455             DATE 05NOV93               *
     F*                 054106             DATE 26NOV93               *
     F*                 052254             DATE 26NOV93               *
     F*                 E44743             DATE 09MAR93               *
     F*                 S10736             DATE 03SEP92               *
     F*                 E38662             DATE 22APR92               *
     F*                 E37996             DATE 06APR92               *
     F*                 E37493             DATE 02APR92               *
     F*                 E37528             DATE 30MAR92               *
     F*                 E37193             DATE 19MAR92               *
     F*                 E36938             DATE 11MAR92               *
     F*                 E34692             DATE 17JAN92               *
     F*                 E34388             DATE 13JAN92               *
     F*                 E33011             DATE 06NOV91               *
     F*                 E33004             DATE 06NOV91               *
     F*                 E29170             DATE 14OCT91               *
     F*                 E29034             DATE 01OCT91               *
     F*                 E03831             DATE 29AUG91               *
     F*                 E24453             DATE 30AUG91               *
     F*                 S01117             DATE 18JUL91               *
     F*                 S01269             DATE 31JUL90               *
     F*                 E23097             DATE 13SEP90               *
     F*                 E22959             DATE 08AUG90               *
     F*                 S01182             DATE 27JAN89               *
     F*                 E21238             DATE 26FEB90               *
     F*                 E21237             DATE 26FEB90               *
     F*                 E19489             DATE 14NOV89               *
     F*                 E19905             DATE 18OCT89               *
     F*                 E19828             DATE 17OCT89               *
     F*                 E18803             DATE 17AUG89               *
     F*                 E18666             DATE 14JUN89               *
     F*                 E17026             DATE 20FEB89               *
     F*                 E16845             DATE 20FEB89               *
     F*                 E14952             DATE 20FEB89               *
     F*                 S01176             DATE 10NOV88               *
     F*                 E14537             DATE 08SEP88               *
     F*                 E14710             DATE 08SEP88               *
     F*                 E13817             DATE 20JUN88               *
     F*                 E13486             DATE 02JUN88               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD049636 - New Narrative codes in 1-50 interval              *
      *  MD046248 - Finastra Rebranding                               *
      *  215959 - Truncation error on event amount in SE2450P3.       *
      *           Recompiled due to changes in PF/SEKEYD.             *
      *         - Applied for MD-37439.                               *
      *  AR1056730 - SEC0610 failed, SE2450 still access TABTB20      *
      *              and use TAC4/5 but only the last 4 positions     *
     F*  CER049 - Stamp Tax                                           *
     F*  248685 - Recompiled due to changes in SE2450P3.              *
     F*  243764 - RCF on SE2450P3.                                    *
     F*           One branch per SE2450P3.                            *
      *  BUG12817 - Move depot number to customer number if customer  *
      *             number is blank. Applied fix 148951.              *
     F*  234004 - Narrative 01 not appropriate for ET keys.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
     F*  BUG8292R-No values were returned from AOACODR0.  Change      *
     F*           option to *KEY                                      *
     F*  BUG8292- Use correct field names from SDACODPD datastructure *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  229342 - ACCESS  AOCUSTR1 INSTEAD OF AOCUSTR0                *
      *  209743 - Generate the posting with transaction type          *
      *           92051 for coupon, 92052 for dividend, 92053 for     *
      *           maturity to allow Tof performance split.            *
      *           Only if PB is on.                                   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CPK016 - Release 5 packaging.  Clash of field names.         *
      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
      *           Information.                                        *
      *  199019 - Posting to suspense instead of nostro. Check for    *
      *           sett method 1, 2, 7, 8, and 12 sett. account is in  *
      *           nostro, ccy/nostro or nostro account format.        *
     F*  CPB002 - Meridian DBA Middleware Replication Customization.  *
     F*  149569 - Applied fix 126134. Suspense balancing entries      *
     F*           are picking up narratives from previous posting.    *
     F*  179804 - Wrong A/C key and event currency used in SR PRTALL  *
     F*  179645 - Apply fix 132302.  Missing account key report       *
     F*           contain incorrect profit centre.                    *
     F*  078550 - Report SE2450P1 should be produced even if there is *
     F*           no missing account keys.                            *
     F*  133649 - Retail Account Number was being set up incorrectly. *
     F*  CPB001 - 'Private Banking' Module                            *
      *  CGL007 - Account Postings Enquiry                            *
     F*  153890 - The seton of LR is actually in the comment          *
     F*           column. Move the indicators 2 chars to the left.    *
     F*         - Change duplicate DBERR 51 to 52.                    *
     F*  109024 - Applied 86732; keep value of field LSEVCY to edit   *
     F*           total by CURRENCY/INVESTMENT TYPE/EVENT TYPE/BOOK   *
     F*           in SE2450P2 otherwise wrong number of decimal places*
     F*           can be used when change of currency.                *
     F*           + Error in printing the Generated Entries for AI    *
     F*           keys if Accrual Summary Ind. is 'Y'.  The entries   *
     F*           are printed after the next Account Key has been     *
     F*           printed making it appear that the entries are for   *
     F*           the next Account Key rather than for the AI key.    *
     F*         - Problem with Decimal Point Editing when first       *
     F*           Account Key is read.  XEVCY is not yet intialised   *
     F*           with EVCY before calling ZSEDIT.  Initialise XEVCY  *
     F*           properly.                                           *
     F*         - Wrong currency used in posting entries of summa-    *
     F*           rised accrual entries.                              *
     F*         - Included the Missing Ind. in the SE2450P3 Printer   *
     F*           File to make the Printer File Information more      *
     F*           useful.                                             *
     F*  111337 - INVESTMENT TYPE ON AC KEY MAY BE BLANK IF 'INCLUDED *
     F*           IN ACCOUNT KEY' IS 'N'                              *
     F*  CAC002 - Profit Centre Accounting Development - Phase 2      *
     F*           The profit centre of any posting to a retail/nostro *
     F*           account will be changed to the profit centre of     *
     F*           that account.  For interbranch and suspense postings*
     F*           the Primary Funding Centre defined in the PCA ICD   *
     F*           will be used as the profit centre.                  *
     F*  085280 - REVERSAL still not posting correctly after 079689.  *
     F*  102927 - Associated Customer should be blank on balancing    *
     F*           entries.                                            *
     F*  102909 - Cross currency entries : the postings from 1 to 4   *
     F*           are not made for trade date and value date.         *
     F*  077018 - Wrong associated customer on imbalance posting      *
     F*  051969 - FOR MULTI-CURRENCY SECURITY DV/CP PAYMENTS KCCY IS  *
     F*           VALUE CCY NOT NOMINAL CCY. ACCESS SECTYD FOR NOM CCY*
     F*  099390 - SE Narratives for narrative code 44 not correct.    *
     F*  093919 - Output a message when no missing account keys       *
     F*  089765 - DBASE error did not switched on U7 and U8.  Also    *
     F*           do not call AOCUSTR0 and AONARRR0 if Customer No.   *
     F*           has been set to zeroes.                             *
     F*  087870   Corrections to user defined posting narratives.     *
     F*  086125 - Add new parameter to AOPNARR0                       *
     F*  S01522 - Call to AOPNARR0 if switchable feature installed    *
     F*           and UDC present                                     *
     F*  073681 - NO CUSTOMER ACCOUNTING DONE FOR POSITION SETTLEMENT *
     F*           USING SETTLEMENT METHOD 04                          *
     F*  S01486 - Incorporation of PM Enhancements (S01313)           *
     F*  053103 - Store Event Date in OTRF (pos. 7-11) & Transaction  *
     F*           Type in OTTP (pos. 9-10).                           *
     F*  046386 - Allow Cross Portfolio Settlements                   *
     F*  057668 - Accrual summary should not be in wrong branch.      *
     F*  066305 - Correct LDA Dbase error processing.                 *
     F*  S01447 - SE Withholding Tax enhancement.                     *
     F*  S01455 - 'FF' ACCOUNT KEY enhancements.                      *
     F*           Recompiled due to changes in PF/TABTB80.            *
     F*  054106 - Wrong Customer accounts are being used for inter-   *
     F*           branch entries.                                     *
     F*           For posting to settlement branch, it shall use      *
     F*           customer no. for booking branch.                    *
     F*           For posting to booking branch, it shall use customer*
     F*           no. for settlement branch.                          *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  E44743 - Reversal accrual interest is not being done when    *
     F*           accrual summary is used.                            *
     F*  S10736 - MANAGEMENT ACCOUNTING                               *
     F*  E38662 - P2 prints END OF REPORT with no headings.           *
     F*  E37996 - P1 prints END OF REORT with no headings.            *
     F*  E37493 - Recompiled over changed printer file.               *
     F*  E37528 - Program recompiled for minor change to Audit Report.*
     F*  E37193 - Wrong account type written to GESTPD.               *
     F*  E36938 - Blank branch codes are sometimes written to GESTPD. *
     F*  E34692 - As new pgm SE2455 now blanks out investment type    *
     F*           and book on the a/c key if necessary do not try to  *
     F*           access investment types file here.                  *
     F*  E34388 - Header for P2 was being printed twice.              *
     F*  E33011 - Program uses settlement branch off file, SEBR, not  *
     F*           settlement branch worked out in program, KBRCA.     *
     F*  E33004 - Tries to open SE2450P2 when it is already open.     *
     F*  E29170 - Report Control Facility changes.                    *
     F*  E29034 - No parameter list.                                  *
     F*  E03831 - Summarised Accrual Posting should have blank        *
     F*           associated customer.                                *
     F*  E24453 - Summarised Accrual Events report fails to produce   *
     F*           a total for the last investment type. Program also  *
     F*           puts the wrong narrative on the last accrual record *
     F*  S01117 - Multibranching (Release 10.0)                       *
     F*  S01269 - Trade authorisation: Recompiled for change to       *
     F*           file TABSE                                          *
     F*  E23097 - Program amended due to change of narrative code from*
     F*           2N to 2A on TABLETP.                                *
     F*  E22959 - Program should use customer no. of trade instead of *
     F*           customer number of settlement account when setting  *
     F*           up narrative for narr code 48.                      *
     F*  S01182 - Maintain Account Posting fields on Generated        *
     F*           Entries File PF/GESTPD for MIS.                     *
     F*  E21238 - Duplicate Entries to spot Trade & equivalent A/c's. *
     F*  E21237 - Output '*' in narrative if Reversal.                *
     F*  E19489 - Recreate over changed display file.                 *
     F*  E19905 - Daily Journal OUT OF BALANCE due to incorrect       *
     F*           CCY LOKUP for BALCCY OCUR statements                *
     F*  E19828 - CONDITION BASE CCT TRADE & EQUIVALENT POSTINGS      *
     F*           ON THE PRESENCE OF TACC FOR BASE CCY ON TABTG10     *
     F*  E18803 - OUTPUT A/C SEQUENCE AS '01' FOR BASE CURRENCY       *
     F*           ENTRIES OVER BRANCH INTERNAL ACCOUNTS.              *
     F*  E18666 - OVERFLOW ERROR.                                     *
     F*  E17026 - ENTRIES WERE BEING PASSED OVER BLOCKED RETAIL A/CS  *
     F*  E16845 - SEPARATE REVERSALS FOR ACCRUAL KEY SUMMARY PROCESSIN*
     F*  E14952 - SPOT TRADE ENTRIES FOR POSITION SETTLEMENTS         *
     F*           NEED SIGN REVERSED.                                 *
     F*  S01176 - ST 3.1.                                             *
     F*  E14537 - Narrative on Accrual Key Summary posting (s)        *
     F*  E14710 - Value date cross currency entries should be passed  *
     F*           against the spot trade equivalent account code,     *
     F*           not the forward equivalent.                         *
     F*  E13817 - Do not edit FV amounts with nom decimal places.     *
     F*           Do not fetch report name if client is '0'.          *
     F*  E13486 - Data structure overlapping                          *
     F*                                                               *
     F*****************************************************************
      *
     FSEKEYAU IF  E           K        DISK
     FSDSTAXL1IF  E                    DISK                                                   CGL031
     F***TABTG30 IT  F      40           EDISK                                                CGL029
     FTABTG30 IT  F      50           EDISK                                                   CGL029
     F***TABSE   IF  E           K        DISK                                              MD049636
     FTABSE2  IF  E           K        DISK                                                 MD049636
     F* ICD 1     TABTB10F                          KIGNORE
     F**ICD*2*****TABTB11F                          KIGNORE               S01117
     F            TABTB11F                          KIGNORE               S01117
     F*           TABTB36F                          KIGNORE
     F*           TABTB40F                          KIGNORE
     F*           TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F*********** TABLETJF                          KIGNORE               S01117
     F*           TABLETLF                          KIGNORE
     F************TABLETRF                          KIGNORE               S01117
     F            TABLETRF                          KIGNORE               S01117
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETKF                          KIGNORE
     F*           TABLETPF                          KIGNORE
     F            TABLETAF                          KIGNORE
     F            TABTE20F                          KIGNORE
     FTABICD  IF  E           K        DISK
     F            TABLETAF                          KIGNORE
     F            TABTB10F                          KIGNORE
     F            TABTB11F                          KIGNORE
     F            TABTB30F                          KIGNORE
     F            TABTB35F                          KIGNORE
     F            TABTB36F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F            TABTB50F                          KIGNORE
     F            TABTB55F                          KIGNORE
     F** TB20     TABTB20F                          KIGNORE
     F** TE10     TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET5F                          KIGNORE
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     F            CLINTSEF                          KIGNORE
     FACNUM   IF  E           K        DISK                           U1
     F            ACCNTABF                          KRENAMEACNUMABF
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FBOOKD   IF  E           K        DISK                               S01176
     FINVTP   IF  E           K        DISK                               S01176
     FSEKEY   IF  E           K        DISK
     FSEACKD  IF  E           K        DISK
     F***TY   IF  E           K        DISK                               E13817
     FSECTY   IF  E           K        DISK                               051969
      *                                                                                     BUG12817
     FTRADS   IF  E           K        DISK                                                 BUG12817
      *                                                                   CPB002
     FSECOATL1IF  E           K        DISK                               CPB002
      **  SE Corporate Action Type                                        CPB002
      *                                                                   CPB002
     F/COPY WNCPYSRC,SEH00032
     FGEST    O   E           K        DISK                      A
     F            APOSTHHF                          KRENAMEGESTHHF
     F            APOSTPDF                          KRENAMEGESTPDF
     F            APOSTZZF                          KRENAMEGESTZZF
     FSE2450P2O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL2         E29170
     F***SE2450P1O***E                    PRINTER                         E29170
     FSE2450P1O   E                    PRINTER                        UC  E29170
     F                                              KINFDS SPOOL1         E29170
     F***SE2450P3O   E                    PRINTER                  109024 243764
     FSE2450P3O   E                    PRINTER                        UC  243764
     F                                              KINFDS SPOOL3         243764
     FSE2450AUO   E                    PRINTER
     F                                              KINFDS SPOOLU         E29170
     F/COPY WNCPYSRC,SE2450F001
     F*
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   35  - PRINTER FILE P2 IS OPEN                               *   E34388
     F*   36  - PRINTER FILE P1 IS OPEN                               *   E34388
     F*   37  - MULTIBRANCHING ON                                     *   E29170
     F*   55  - BLOCK ALL DEBIT INDICATOR                             *   E17026
     F*   56  - BLOCK ALL CREDIT INDICATOR                            *   E17026
     F*   62  - TABLE/ARRAY SEARCH SUCCESSFUL                         *
     F*   78  - FILE ACCESS NOT FOUND/UNSUCCESSFUL                    *
     F*   79  - FILE ACCESS NOT FOUND/UNSUCCESSFUL                    *
     F*   80  - SET ON WHEN AT LEAST ONE RECORD READ FROM PF/SEKEYA,  *
     F*         OTHERWISE DB ERROR                                    *
     F*                                                               *
     F*   98  - ON = MMDDYY DATE FORMAT                               *
     F* 90-99 - MIDAS STANDARD SUBROUTINE USE                         *
     F*                                                               *
     F*   U1  - RETAIL PRESENT (S/ACNUM)                              *
     F*   U4  - MISSING A/C KEY(S)                                    *
     F*NU7+U8 - FILE CONTROLS OUT OF BALANCE                          *
     F* U7+U8 - DATABASE ERROR                                        *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  ACCNTI - GET ACCOUNT INFORMATION RECORD LF/ACCNT             *
     F*  ACDCHN - CHAIN TABLE FOR ACCOUNT CODES/TYPES                 *
     F*  AUDIT  - WRITE AUDIT CONTROL DETAILS PRINT REPORT            *
     F*  BLD01  - BUILD UP TO 6 LF/GEST RECORD PER TRANSACTION        *
     F*  BAL01  - CHECK BALANCES CR/DR FOR BRCH/CCY AND POST SUSPENSE *
     F*  CLTCHN - CHAIN CLINT FOR DETAILS FOR NARRATIVES              *
     F*  G10CHN - CHAIN TO TABTG20 FOR CCY TRADE EQUIVALENT ACCNT CODE*
     F*  INIT  - INITIALISE AREAS,GET ALL ICD RECORDS (10,11,20,36,40)*
     F*  MA01  - CHECK IF MASTER ACCOUNT KEY RECORD EXISTS,PRINT MIS'G*
     F*  MULTIB - MULTIBRANCH RECORDS-POST TO LF/GEST                 *
     F*                                                               *
     F*  NARRAT - BUILD NARRATIVE DESCRIPTIONS                        *
     F*  PRF1P  - BUILD POSTING REFERENCE TYPE 1 FIELDS               *
     F*  PRF2P  - BUILD POSTING REFERENCE TYPE 2 FIELDS               *
     F*  PRF3P  - BUILD POSTING REFERENCE TYPE 3 FIELDS               *
     F*  PRF4P  - BUILD POSTING REFERENCE TYPE 4 FIELDS               *
     F*  PRF5P  - BUILD POSTING REFERENCE TYPE 5 FIELDS               *
     F*  PRFALL - CONSTRUCT COMMON FIELDS TO OUTPUT RECORD /F/GEST    *
     F*  PRFAL1 - CONSTRUCT COMMON FIELDS TO OUTPUT RECORD /F/GEST    *
     F*  PRTA   - PRINT SUMMARY ACCRUAL TRANSACTIONS                  *
     F*  PRTA1  - SUMMARY ACCRUALS SUB TOTALS PRINT                   *
     F*  PRTM   - PRINT MISSING ACCOUNT KEYS                          *
     F*  TABCHN - CHAIN FOR VARIOUS TABLE FILE DETAILS                *
     F*  TRADES - CONSTRUCT TRADE EQUIVALENT POSTINGS                 *
     F*  RCFP1  - SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF      *   E29170
     F*  RCFAU  - SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF      *   E29170
     F*  SRPNAR - Determine the posting narrative                     *   S01522
     F*                                                               *
     F*  ZDATE2 - STANDARD CONVERSION TO DD/MMM/YY FORMAT             *
     F*  ZHASH  - STANDARD HASH TOTALLING ROUTINE                     *
     F*  ZSEDIT - STANDARD EDITING ROUTINE                            *
     F*  ZSYSTM - ACCES TABTB10                                       *
     F*  *PSSR  - Exception error routine                             *   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     F/COPY WNCPYSRC,SE2450F002
     E                    CPY@    1   1 80
     E**********          AC          6  4 0             ACCOUNT CODES                        CGL029
     E                    AC          6 10 0                                                  CGL029
     E                    PRF         6  1 0             A/C POST REFS
     E                    NC          6  2               A/C NARRATIVE    E23097
     E********************NC**********6**2*0*************A/C NARRATIVE    E23097
     E                    AKY        10  1               ACCOUNT KEY
     E                    SET        12  1               SETTLEMENT DETAIL
     E                    NAR        30  1               NARRATIVE
     E*
     E****TABTG30         CCYA    1 250  3   CCYDT  37                                        CGL029
     E**********          ACDS      500  4 0 ATY     1   ACODS,ATYPS                          CGL029
     E    TABTG30         CCYA    1 250  3   CCYDT  47                                        CGL029
     E                    ACDS      500 10 0 ATY     1                                        CGL029
     E                    ASC       500  2               ACSCS            S10736
     E**********          GC        250  3   GCA     4 0 CCY,F/TR ACC                         CGL029
     E**********          GSP       250  4 0             CCY,SPOT EQUIV                E14710 CGL029
     E                    GC        250  3   GCA    10 0                                      CGL029
     E                    GSP       250 10 0                                                  CGL029
     E                    GX        250  3               CCY'S IN BALCC
     E*
     E                    INT         2 15 0             ZHASH INTEGERS
     E                    DEC         2  3 0             ZHASH DECIMALS
     E*
     E********************MESS    1   1 18                                E14537
     E                    MESS    1   2 30                                E14537
     E/COPY WNCPYSRC,SE2450E001
     E*
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY WNCPYSRC,SE2450E002
      /EJECT
     I/COPY WNCPYSRC,SE2450I001
     ISEKEYDF                                                             E29170
     I***********   PRFC                            SPRFC          E29170 S10736
     I              PTFR                            WWPTFR                S01486
     I              PRFC                            WWPRFC                CAC002
     ITABTE10F    08
     I              ATYP                            ATYPTE
     ITABLETLF    10
     I              ACOD                            ACODTL
     I              ACSQ                            ACSQTL
     I              CNUM                            CNUMTL
     I              BRCA                            BRCATL                S01117
     ITABLETPF    11
     I              NARD                            NARDTP
     I***********TABLETRF    12                                           S01117
     I***********   NSACS                           SACS                  S01117
     I***********   NBACB                           BACB                  S01117
     I***********   NBACH                           BACH                  S01117
     ICLINTCBF    13
     I*
     I*    S/CLINT FILE
     I*
     I***********   BRCD                            BRCDCB                S01117
     I              BRCB                            BRCBCB                S01117
     I              CNUM                            CNUMCB
     IACNUMABF    14
     I*
     I*    S/ACNUM FILE
     I*
     I              ACNO                            ACNOAN
     I              ACOD                            ACODAN
     I              ACSQ                            ACSQAN
     I              ATYP                            ATYPAN
     I              CCY                             CCYAN
     I              CNUM                            CNUMAN
     I              BRCA                            BRCAAN                S01117
     IACCNTABF    15
     I*
     I*    S/ACCNT FILE
     I*
     I              ACNO                            ACNOAC
     I              ACOD                            ACODAC
     I              ACSQ                            ACSQAC
     I              ATYP                            ATYPAC
     I***********   BRCD                            BRCDAC                S01117
     I              BRCA                            BRCAAC                S01117
     I              CCY                             CCYAC
     I              CNUM                            CNUMAC
     I              RRNM                            RRNMAC
     I              PRFC                            PRFCAC                S10736
     IBOOKDDF                                                             S01176
     I*                                                                   S01176
     I*    BOOK DETAILS                                                   S01176
     I*                                                                   S01176
     I              INAK                            INAKB                 S01176
     IINVTPDF                                                             S01176
     I*                                                                   S01176
     I*    INVESTMENT TYPES DETAILS                                       S01176
     I*                                                                   S01176
     I              INAK                            INAKI                 S01176
     I              SFLG                            INSFLG                                    CPK016
     I/COPY WNCPYSRC,SE2450I004
     I*                                                                   S01117
     ISCSARD    E DSSCSARDPD                                              S01522
     I* SAR File Details Accessed via access program AOSARDR0             S01522
     I*                                                                   S01522
     ICGPNAR    E DSCGPNARPD                                              S01522
     I* UDC Multi Language Narrative Data Structure                       S01522
     I*                                                                   S01522
     I##PRM1      DS                                                      086125
      **  Data Structure for Customer and Branch                          086125
      *                                                                   086125
     I                                        1   6 A#CUST                086125
     I                                        7   9 A#BRCA                086125
      *                                                                   086125
     I/COPY WNCPYSRC,SE2450I003
     ISDCUST    E DSSDCUSTPD                                              S01522
     I**  Customer Details                                                S01522
     I*                                                                   S01522
     ISDGELR    E DSSDGELRPD                                              S01117
     I              QQACCD                          QQACC1                                    CGL029
     I** General Ledger ICD                                               S01117
     I*                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
     I* Bank Details                                                      S01117
     I*                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I              QQDFAC                          QQDFA1                                    CGL029
     I** Branch Details                                                   S01117
     I*                                                                   S01117
     I@MMOD     E DSSDMMODPD                                              S01486
     I** Dummy record format for access to Modules File                   S01486
     I*                                                                   CAC002
     ISDPCAC    E DSSDPCACPD                                              CAC002
     I**  PCA I.C.Details                                                 CAC002
     I*                                                                   CAC002
     ISDPRFC    E DSSDPRFCPD                                              CAC002
     I**  Profit Centre Details                                           CAC002
     I*                                                                   S01486
     ISDACOD    E DSSDACODPD                                                                  CGL029
     I              QQACCD                          QQACC2                                    CGL029
     I              QQFNIC                          QQFNI1                                    CGL029
     I              QQFNAA                          QQFNA1                                    CGL029
      ** Account Code Details                                                                 CGL029
      *                                                                                       CGL029
     IDSFDY     E DSDSFDY                                                 S01117
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     I*                                                                   S01522
     IDSSDY     E DSDSSDY                                                 S01522
     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01522
      *                                                                                       229342
     IDSLDY     E DSDSLDY                                                                     229342
     I*                                                                   S01522
     IRUNDAT      DS                                                      S01117
     I** Data area RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*
     I*
     I* ACCOUNT KEY READ FROM SEKEY (GENERATED ACCNT KEYS)
     I/COPY ZSRSRC,ZHASHZ2
     I*
     IWACKEY      DS
     I*
     I* D/S TO BREAK DOWN ACCOUNT KEY ON SEKEY TO COMPONENT PARTS
     I*
     I                                        1   3 WACITY
     I                                        4   4 WACEVC
     I                                        5   5 WACTRT
     I                                        6   6 WACPFI
     I                                        7   8 WACBKC
     I                                        9  10 WACTST
     I                                        9  10 WACPSB
     I                                       11  12 WACCCC
     I                                       13  13 WACMKT
     I                                       14  14 WACCON
     I                                       15  15 WACNEG
     I                                       19  20 WACAMC
     I                                        1  20 WACKY
     I*
     I            DS
     I*
     I*   POSTING REFERENCES DATA STRUCTURE
     I*
     I                                        1   10PRF1
     I                                        2   20PRF2
     I                                        3   30PRF3
     I                                        4   40PRF4
     I                                        5   50PRF5
     I                                        6   60PRF6
     I                                        1   60PRF
     I                                        1   60PRF006
     I*
     I            DS
     I*
     I*   ACCOUNT CODES DATA STRUCTURE
     I*
     I**********                              1   40ACD1                                      CGL029
     I**********                              5   80ACD2                                      CGL029
     I**********                              9  120ACD3                                      CGL029
     I**********                             13  160ACD4                                      CGL029
     I**********                             17  200ACD5                                      CGL029
     I**********                             21  240ACD6                                      CGL029
     I**********                              1  24 AC                                        CGL029
     I                                        1  100ACD1                                      CGL029
     I                                       11  200ACD2                                      CGL029
     I                                       21  300ACD3                                      CGL029
     I                                       31  400ACD4                                      CGL029
     I                                       41  500ACD5                                      CGL029
     I                                       51  600ACD6                                      CGL029
     I                                        1  60 AC                                        CGL029
     I*
     I*
     I*   NARRATIVE CODES DATA STRUCTURE
     I*
     I            DS                                                      E23097
     I                                        1   2 NCDA1                 E23097
     I                                        3   4 NCDA2                 E23097
     I                                        5   6 NCDA3                 E23097
     I                                        7   8 NCDA4                 E23097
     I                                        9  10 NCDA5                 E23097
     I                                       11  12 NCDA6                 E23097
     I                                        1  12 NC                    E23097
     I****************************************1   20NCD1                  E23097
     I****************************************3   40NCD2                  E23097
     I****************************************5   60NCD3                  E23097
     I****************************************7   80NCD4                  E23097
     I****************************************9  100NCD5                  E23097
     I****************************************1  120NCD6                  E23097
     I****************************************1  12 NC                    E23097
     I*
     I            DS
     I*
     I*   ACCESS TABSE TABLES KEY
     I*
     I                                        1   20TABL
     I                                        1  12 TABKEY
     I                                        8  10 TABC
     I                                       11  120TABR
     I*
     ITHISKY      DS
     I*
     I*   THIS GENERATED ACCOUNT RECORD KEY
     I*
     I***********                             1   30THBRCH                S01117
     I                                        1   3 THBRHA                S01117
     I                                        4   6 THEVCY
     I                                        7   9 THINVT                S01176
     I                                       13  14 THBKCD                S01176
     I                                        7  26 THACKY
     I                                       27  27 THRVRS                E16845
     I*
     ILASTKY      DS
     I*
     I*   LAST GENERATED ACCOUNT RECORD KEY
     I*
     I***********                             1   30LSBRCH                S01117
     I                                        1   3 LSBRHA                S01117
     I                                        4   6 LSEVCY
     I                                        7   9 LSINVT                S01176
     I                                       13  14 LSBKCD                S01176
     I                                        7  26 LSACKY
     I                                       27  27 LSRVRS                E16845
     INCCY        DS                                                      S01176
     I*                                                                   S01176
     I*   DS TO STORE NOMINAL CURRENCY AS LAST NOMINAL CURRENCY           S01176
     I*                                                                   S01176
     I                                        1   3 LSKCCY                S01176
     I*                                                                   S01176
     ISEKKY       DS                                                      S01176
     I*                                                                   S01176
     I*   A/C KEY USED TO ACCESS SEACKD - SEKKY is defined as 20 char     S01176
     I*   later on                                                        S01176
     I*                                                                   S01176
     I                                        1   3 SEKINV                S01176
     I                                        7   8 SEKBK                 S01176
     I                                        9  20 SEKREM                S01176
     I*
     ICLIDS       DS
     I*
     I*   S/CLINT KEY DATA STRUCTURE.
     I*
     I**********                              1   60CNUMC                                     CSD027
     I                                        1   6 CNUMC                                     CSD027
     I                                        7   7 RCDT
     I*
     IACCDS       DS
     I*
     I*   S/ACCNT KEY DATA STRUCTURE.
     I*
     I**********                              1   60CNUM                                      CSD027
     I                                        1   6 CNUM                                      CSD027
     I                                        7   9 CCY
     I**********                             10  130ACOD                                      CGL029
     I**********                             14  150ACSQ                                      CGL029
     I                                       10  190ACOD                                      CGL029
     I                                       20  210ACSQ                                      CGL029
     I*
     I            DS
     I*
     I*    Currency details from array CCYDT
     I*
     I**********                              1  37 CCYDET                                    CGL029
     I                                        1  47 CCYDET                                    CGL029
     I                                        1   10XDECP
     I**********                             32  350XTACC                                     CGL029
     I                                       38  470XTACC                                     CGL029
     I*                                                                   S01176
     IIVTP        DS                                                      S01176
     I*                                                                   S01176
     I*   LF/INVTP KEY DATA STRUCTURE (for use in DBKEY)                  S01176
     I*                                                                   S01176
     I                                        1   3 CCYI                  S01176
     I                                        4   6 INVT                  S01176
     I*
     IBALCCY      DS                        250
     I*
     I*    Debit and credit total per branch/currency, imbalance amount
     I*
     I                                        1  150CRTOT
     I                                       16  300DRTOT
     I                                       31  33 OCCY
     I*
     I            DS
     I*    General purpose array index
     I                                        1   30X
     I                                        4  130WN10
     I*
     I*    Index of first account code in array ACD (loaded from back
     I*    to front)
     I*
     I***********                             4   60Y                     E13486
     I                                       14  160Y                     E13486
     I*
     I*   ZSEDIT DATA STRUCTURE
     I*
     I/COPY ZSRSRC,ZSEDITZ2
     I*
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     ILDA         DS                            256                       S01117
     I*                                                                   S01117
     I*       LOCAL DATA AREA                                             S01117
     I*                                                                   S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I***********LDA        UDS                            256            S01117
     I***********                                                         S01117
     I********LOCAL*DATA*AREA***************                              S01117
     I***********                                                         S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I*                                                                   E29170
     ISPOOL1      DS                                                      E29170
     I*                                                                   E29170
     I**  DS FOR P1 SPOOL FILE NAME                                       E29170
     I*                                                                   E29170
     I                                       83  92 SFILE1                E29170
     I                                    B 123 1240SFNUM1                E29170
     I*                                                                   E29170
     ISPOOL2      DS                                                      E29170
     I*                                                                   E29170
     I**  DS FOR P2 SPOOL FILE NAME                                       E29170
     I*                                                                   E29170
     I                                       83  92 SFILE2                E29170
     I                                    B 123 1240SFNUM2                E29170
     I**                                                                  E29170
     ISPOOLU      DS                                                      E29170
     I                                       83  92 SFILEU                E29170
     I                                    B 123 1240SFNUMU                E29170
     IUTAX        DS                                                      E29170
     I I            'TAX DEDUCTED BY USER'    1  20 TAXNAR                  9170
      *                                                                                       CGL029
     ISHCLR       DS                                                                          CGL029
     I**********                              1   60SHCNUM                             CGL029 CSD027
     I                                        1   6 SHCNUM                                    CSD027
     I                                        7   9 SHCCY                                     CGL029
     I                                       10  210SHACS                                     CGL029
      *                                                                   243764
     ISPOOL3      DS                                                      243764
     I*                                                                   243764
     I**  DS FOR P3 SPOOL FILE NAME                                       243764
     I*                                                                   243764
     I                                       83  92 SFILE3                243764
     I                                    B 123 1240SFNUM3                243764
      *                                                                   243764
     I/COPY WNCPYSRC,SE2450I002
     C/EJECT
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
     C*                                                                   E29034
     C           *ENTRY    PLIST                                          E29034
     C                     PARM           SEQ     5                       E29034
     C*
     C*    KEY LIST FOR S/CLINT
     C*
     C           CLIKY     KLIST
     C**********           KFLD           CNUMC   60                                          CSD027
     C                     KFLD           CNUMC   6                                           CSD027
     C                     KFLD           RCDT    1
     C*
     C*    KEY LIST FOR LF/ACCNT
     C*
     C           ACCNTK    KLIST
     C**********           KFLD           CNUM    60                                          CSD027
     C                     KFLD           CNUM    6                                           CSD027
     C                     KFLD           CCY     3
     C**********           KFLD           ACOD    40                                          CGL029
     C                     KFLD           ACOD   100                                          CGL029
     C                     KFLD           ACSQ    20
     C                     KFLD           KBRCA   3                       S01117
     C*
     C*    KEY LIST FOR LF/ACNUM
     C*
     C           ACNUMK    KLIST
     C                     KFLD           ACNO
     C*
     C*    KEY LIST FOR LF/INVTP                                          S01176
     C*                                                                   S01176
     C           INVTPK    KLIST                                          S01176
     C                     KFLD           CCYI    3                       S01176
     C                     KFLD           INVT    3                       S01176
     C/COPY WNCPYSRC,SE2450C091
      *
      *================================================================
      *
      *  M A I N   P R O C E S S I N G
      *
      *  CALLS - INIT BLD01 MA01 PRTA PRTA1 BAL01 AUDIT
      *
      *================================================================
      *
      *     INITIAL PROCESSING
      *
     C                     EXSR INIT
     C*
     C*     READ GENERATED ACCOUNT KEYS LF/SEKEY
     C*
     C           READIN    TAG
     C*
     C                     READ SEKEY                    79
     C*                                                                   078550
     C** If end of file reached and no missing account keys was           078550
     C** encountered (U4 is off), must still output SE2450P1              078550
     C*                                                                   078550
     C           *IN79     IFEQ '1'                                       078550
     C           *IN36     IFEQ '1'                                       078550
     C           DETL1     IFEQ 'N'                                       078550
     C                     WRITEHEADP1                                    078550
     C                     Z-ADD8         LCNT1                           078550
     C                     WRITENODETL                                    078550
     C                     WRITETRAILP1                                   078550
     C                     CLOSESE2450P1                                  078550
     C                     END                                            078550
     C                     ELSE                                           078550
     C                     OPEN SE2450P1                                  078550
     C                     Z-ADD8         LCNT1                           078550
     C                     Z-ADD0         PAGE                            078550
     C                     SETON                     36                   078550
     C                     EXSR RCFP1                                     078550
     C                     WRITEHEADP1                                    078550
     C                     Z-ADD8         LCNT1                           078550
     C                     WRITENODETL                                    078550
     C                     WRITETRAILP1                                   078550
     C                     END                                            078550
     C                     END                                            078550
     C*                                                                   078550
     C           *IN79     CABEQ'1'       EAUDIT
     C           RECI      CABEQ'*'       READIN
     C*                                                                   109024
     C**  Initialise XEVCY here to get the correct Currency Decimal       109024
     C**  Place when printing the Account Key.                            109024
     C*                                                                   109024
     C                     MOVE EVCY      XEVCY                           109024
     C/COPY WNCPYSRC,SE2450C044
     C*
     C*  KEEP COUNT OF RECORDS  READ FROM LF/SEKEY
     C*
     C                     ADD  1         W01CNT  50
     C           EVAM      CABEQ0         READIN
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDEVAM      ZZAMT
     C                     EXSR ZHASH
     C*
     C*  STORE THIS BR/CCY/ACC KEY
     C*
     C***********          Z-ADDBRCH      THBRCH                          S01117
     C                     MOVE BRHA      THBRHA                          S01117
     C                     MOVE ACKY      THACKY
     C                     MOVE EVCY      THEVCY
     C                     MOVE RVRS      THRVRS                          E16845
     C*
     C*  IF ACCRUAL SUMMARIES REQUIRED, CHECK FOR LAST KEY BEING AN
     C*  ACCRUAL IF A CHANGE OF KEY READ IN.
     C*
     C***********AKSI      IFEQ 'Y'                                       S01117
     C           BKAKSI    IFEQ 'Y'                                       S01117
     C           THISKY    ANDNELASTKY
     C           LASTAC    ANDEQ'Y'
     C           WMISS     ANDNE'Y'
     C                     MOVE 'Y'       ACCRLK                          E14537
     C                     MOVE LSEVCY    XEVCY                           109024
     C/COPY WNCPYSRC,SE2450C045
     C                     EXSR BLD01
     C                     MOVE 'N'       ACCRLK  1                       E14537
     C*
     C* PRINT SUB TOTAL OF ACCRUALS FOR THIS SUMMARY
     C*
     C                     EXSR PRTA1
     C                     END
     C*                                                                   109024
     C**  Print Account Key                                               109024
     C*                                                                   109024
     C                     EXSR PRTALL                                    109024
     C/COPY WNCPYSRC,SE2450C046
     C*
     C* IF CHANGE OF BRANCH, PROCESS POSSIBLE CURRENCY IMBALANCES
     C*
     C***********THBRCH    IFNE LSBRCH                                    S01117
     C           THBRHA    IFNE LSBRHA                                    S01117
     C*                                                                   E29170
     C** IF CHANGE IN BRANCH THEN CLOSE AND OPEN P1 PRINTER FILE          E29170
     C*                                                                   E29170
     C***********DETL1     IFNE 'N'                                E37996 078550
     C           *IN36     IFEQ '1'                                       E29170
     C           DETL1     IFEQ 'N'                                       078550
     C                     MOVE BRHA      TBRHA   3                       078550
     C                     MOVE LSBRHA    BRHA                            078550
     C                     WRITEHEADP1                                    078550
     C                     WRITENODETL                                    078550
     C                     MOVE TBRHA     BRHA                            078550
     C                     END                                            078550
     C                     WRITETRAILP1                                   E29170
     C                     CLOSESE2450P1                                  E29170
     C                     END                                            E29170
     C                     OPEN SE2450P1                                  E29170
     C                     Z-ADD8         LCNT1                           E29170
     C                     Z-ADD0         PAGE                            E29170
     C                     SETON                     36                   E29170
     C*                                                                   E38662
     C** RCF Processing for Detail Printer File.                          E38662
     C*                                                                   E38662
     C                     EXSR RCFP1                                     E38662
     C***********          END                                     E37996 078550
     C                     MOVEL'N'       DETL1   1                       E34388
     C***********                                                  E29170 E38662
     C***RCF*Processing*for*Detail*Printer*File******************* E29170 E38662
     C***********                                                  E29170 E38662
     C***********          EXSR RCFP1                              E29170 E38662
     C*                                                                   E29170
     C** IF CHANGE IN BRANCH THEN CLOSE AND OPEN P2 PRINTER FILE          E29170
     C*                                                                   E29170
     C           BKAKSI    IFEQ 'Y'                                       E29170
     C           DETL2     IFNE 'N'                                       E38662
     C           *IN35     IFEQ '1'                                       E29170
     C                     WRITETRAILP2                                   E29170
     C                     CLOSESE2450P2                                  E29170
     C                     END                                            E29170
     C                     OPEN SE2450P2                                  E29170
     C                     Z-ADD10        LCNT2                           E29170
     C                     Z-ADD0         PAGE                            E29170
     C                     SETON                     35                   E29170
     C*                                                                   E38662
     C** RCF Processing for Detail Printer File.                          E38662
     C*                                                                   E38662
     C                     EXSR RCFP2                                     E38662
     C                     END                                            E38662
     C                     MOVEL'N'       DETL2   1                       E34388
     C***********                                                  E29170 E38662
     C***RCF*Processing*for*Detail*Printer*File******************* E29170 E38662
     C***********                                                  E29170 E38662
     C***********          EXSR RCFP2                              E29170 E38662
     C                     END                                            E29170
     C*                                                                   E29170
     C                     EXSR BAL01
     C                     MOVEA*BLANKS   GX
     C*
     C* NEW SUMMARY ACCRUAL REPORT PAGE ON CHG OF BRANCH
     C*
     C                     Z-ADD68        LCNT2
     C*
     C**ON*CHANGE*OF*BRANCH*SET*UP*NEW*BRANCH*DETAILS*************        S01117
     C**GET*BICN/BACB*ETC*FROM*TABLETR*-*SUBR*TABCHN*AND*SAVE*****        S01117
     C***********                                                         S01117
     C***********          MOVE BLK012    ZTABKY                          S01117
     C***********          MOVEL'10'      ZTABKY                          S01117
     C***********          MOVE THBRCH    ZTABKY                          S01117
     C***********          EXSR TABCHN
     C*                                                                   S01117
     C** Obtain New Branch details                                        S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM THBRHA    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *INLR                           S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
     C                     MOVEL@DSNB     DBKEY            ** DB ERROR 11 S01117
     C                     Z-ADD11        DBASE            ***************S01117
     C                     MOVEL@OPTN     DBOPTN  7                       S01117
     C                     SETON                       U7U8               S01117
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C***********          Z-ADDBICN      XBICN   60                      S01117
     C**********           MOVELA8BICN    XBICN   60                                   S01117 CSD027
     C                     MOVELA8BICN    XBICN   6                                           CSD027
     C                     MOVELA8BICN    @@BKCS                          S01117
     C                     MOVELA8DTAC    @@BKAT                          S01117
     C                     MOVELA8DFAC    @@BKAF                          S01117
     C                     MOVELA8BRCD    @@BKBR                          S01117
     C***********          Z-ADDSACS      XSACS   20                      S01117
     C***********          Z-ADDBACB      XBACB   40                      S01117
     C***********          Z-ADDBACH      XBACH   40                      S01117
     C***********          MOVELBRNM      WPBRCH                          S01117
     C                     MOVELA8BRNM    WPBRCH                          S01117
     C***********          WRITEHEADP1                              E29170E34388
     C***********BKAKSI    IFEQ 'Y'                                 E29170E34388
     C***********          WRITEHEADP2                              E29170E34388
     C***********          END                                      E29170E34388
     C/COPY WNCPYSRC,SE2450C092
     C                     END
     C*
     C* ON CHANGE OF CURRENCY SET UP CURRENCY FOR THIS BRANCH IN NEXT
     C* OCCURRANCE OF BALCCY DATA STRUCTURE
     C*
     C***********THBRCH    IFNE LSBRCH                                    S01117
     C           THBRHA    IFNE LSBRHA                                    S01117
     C           THEVCY    ORNE LSEVCY
     C                     Z-ADD1         N
     C           THEVCY    LOKUPGX,N                     62
     C           *IN62     IFEQ '0'
     C*                                                                   E13817
     C********** LOOP1     TAG                              **LOOP1 **    E13817
     C***********                                                         E13817
     C**********           ADD  1         Q       30                      E13817
     C********** Q         OCUR BALCCY                 79                 E13817
     C********** *IN79     IFNE '1'                                       E13817
     C********** OCCY      CABNE'   '     LOOP1                           E13817
     C**********           END                                            E13817
     C                     Z-ADD1         Q                               E13817
     C           '   '     LOKUPGX,Q                     33               E13817
     C           Q         OCUR BALCCY                 79                 E13817
     C  N79                MOVE THEVCY    OCCY
     C                     MOVE THEVCY    GX,Q
     C                     Z-ADD0         DRTOT
     C                     Z-ADD0         CRTOT
     C                     ELSE
     C**********           Z-ADDN         Q                               E13817
     C                     Z-ADDN         Q       30                      E13817
     C           Q         OCUR BALCCY                 79
     C                     END
     C                     END
     C*                                                                   051969
     C** IF ACCOUNT KEY IS FOR POSITION SETTLEMENT KCCY MAY BE VALUE CCY  051969
     C** NOT NOMINAL CCY. HENCE ACCESS SECTY FOR NOMINAL CCY AND USE IN   051969
     C** CHAIN TO PF/INVTP                                                051969
     C                     MOVE 'N'       WWPOSS  1                       051969
     C                     MOVELACKY      W1WRK5  5                       051969
     C                     MOVE W1WRK5    W1WRK2  2                       051969
     C                     MOVE W1WRK2    WYCTRT  1                       051969
     C                     MOVELW1WRK2    WYCEVC  1                       051969
     C           WYCTRT    IFEQ *BLANK                     B1             051969
     C           WYCEVC    IFEQ 'C'                        B2             051969
     C           WYCEVC    OREQ 'H'                                       051969
     C           WYCEVC    OREQ 'S'                                       051969
     C*                                                                   051969
     C                     MOVE 'Y'       WWPOSS  1                       051969
     C*                                                                   051969
     C           SESH      CHAINSECTY                79                   051969
     C*                                                                   051969
     C           *IN79     IFEQ '1'                        B3             051969
     C                     SETON                     U7U8                 051969
     C                     MOVE 'SECTY'   DBFILE           ***************051969
     C                     MOVELSESH      DBKEY            * DB ERROR 89 *051969
     C                     Z-ADD89        DBASE            ***************051969
     C                     GOTO DBERR                                     051969
     C                     END                             E3             051969
     C*                                                                   051969
     C                     MOVE NMCY      WXCCY   3                       051969
     C                     END                             E2             051969
     C                     END                             E1             051969
     C*                                                                   S01176
     C* On change of NOMINAL CURRENCY and INVESTMENT TYPE, chain to       S01176
     C* Investment Types file.  If 'include in A/c key' is 'N' replace    S01176
     C* investment type from SEKEY with blanks before chain to SEACK      S01176
     C*       KEY = CURRENCY + INVESTMENT TYPE (from SEKEY)               S01176
     C*                                                                   S01176
     C                     MOVE THACKY    SEKKY                           S01176
      *                                                                                       CER049
      ** If Account Key is for Stamp Tax do not try to access                                 CER049
      ** Investment Type and Book Code.                                                       CER049
      *                                                                                       CER049
     C                     MOVELACKY      ACKY18  8                                           CER049
     C           ACKY18    IFNE 'STAMPTAX'                                                    CER049
     C*                                                                   S01176
     C           THINVT    IFNE *BLANKS                                   E34692
     C           WWPOSS    ANDEQ'N'                                       051969
     C           WXCCY     ORNE WSCCY                                     051969
     C           WWPOSS    ANDEQ'Y'                                       051969
     C           THINVT    ANDNE*BLANKS                                   111337
     C           KCCY      IFNE LSKCCY                                    S01176
     C***********THINVT    ANDNELSINVT                                    S01176
     C           THINVT    ORNE LSINVT                                    S01176
     C*                                                                   051969
     C           WWPOSS    IFEQ 'N'                                       051969
     C                     MOVE KCCY      CCYI                            S01176
     C                     ELSE                                           051969
     C                     MOVE WXCCY     CCYI                            051969
     C                     END                                            051969
     C*                                                                   051969
     C                     MOVE THINVT    INVT                            S01176
     C           INVTPK    CHAININVTPDF              79                   S01176
     C*                                                                   S01176
     C           *IN79     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C*                                                                   S01176
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8                 S01176
     C                     MOVE 'INVTP'   DBFILE           ***************S01176
     C                     MOVELIVTP      DBKEY            * DB ERROR 09 *S01176
     C                     Z-ADD09        DBASE            ***************S01176
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR                                     S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     MOVE WXCCY     WSCCY   3                       051969
     C*                                                                   051969
     C           INAKI     IFEQ 'N'                                       S01176
     C                     MOVE *BLANKS   SEKINV                          S01176
     C                     END                                            S01176
     C                     END                                            E34692
     C*                                                                   S01176
     C* On change of Book Code, chain to Book Code Details file. If       S01176
     C* 'include in A/c key' is 'N' replace book code from SEKEY from     S01176
     C* with blanks before chaining to SEACK.                             S01176
     C*       KEY = BOOK CODE (from SEKEY)                                S01176
     C*                                                                   S01176
     C           THBKCD    IFNE *BLANK                                    S01176
     C*                                                                   S01176
     C           THBKCD    IFNE LSBKCD                                    S01176
     C           THBKCD    CHAINBOOKDDF              79                   S01176
     C*                                                                   S01176
     C           *IN79     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C*                                                                   S01176
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8                 S01176
     C                     MOVE 'BOOKD'   DBFILE           ***************S01176
     C                     MOVELTHBKCD    DBKEY            * DB ERROR 10 *S01176
     C                     Z-ADD10        DBASE            ***************S01176
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR                                     S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           INAKB     IFEQ 'N'                                       S01173
     C                     MOVE *BLANKS   SEKBK                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C* Rewrite ACKY in case investment type or book code has been        S01176
     C* set to blanks                                                     S01176
     C*                                                                   S01176
     C                     MOVE SEKKY     ACKY                            S01176
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
     C*
     C*   ZEROISE ACCUMULATOR OF AMOUNTS FOR ANY CHANGE OF KEY
     C*
     C           THISKY    IFNE LASTKY
     C                     Z-ADD0         WAEVAM
     C                     Z-ADD0         WAKBCA
     C                     Z-ADD0         WAKNCA
     C                     END
     C*
     C* MAKE LAST KEY EQUAL TO THIS KEY
     C*
     C                     MOVE THISKY    LASTKY
     C**********           MOVE KCCY      LSKCCY                   S01176 051969
     C                     MOVE CCYI      LSKCCY                          051969
     C*
     C* ... AND MOVE INPUT FIELDS TO X- FIELDS FROM WHICH TO GENERATE
     C*     OUTPUT FIELDS ETC. (SINCE WITH SUMMARY ACCRUALS PROCESSING
     C*     WAITS TILL A CHANGE OF INPUT KEY BEFORE PROCESSING LAST)
     C*
     C                     MOVE ACKY      XACKY
     C                     MOVE TRFR      XTRFR
     C                     MOVE CSTN      XCSTN
     C***********          MOVE BRCH      XBRCH                           S01117
     C                     MOVE BRHA      XBRHA                           S01117
     C                     MOVE ASQN      XASQN
     C                     MOVE EVDT      XEVDT
     C                     Z-ADDEVAM      XEVAM
     C                     MOVE EVCY      XEVCY
     C                     MOVE STLT      XSTLT
     C                     MOVE STLA      XSTLA
     C                     MOVE RVRS      XRVRS
     C                     MOVE ISSR      XISSR
     C                     MOVE KCUST     XKCUST
     C                     MOVE KNCA      XKNCA
     C                     MOVE KCCY      XKCCY
     C                     MOVE KBCA      XKBCA
     C                     MOVE SESH      XSESH
     C/COPY WNCPYSRC,SE2450C085
     C           BGPFMG    IFEQ 'Y'                                       053103
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE PEV1      XPEV1                           053103
     C                     END                                            053103
     C/COPY WNCPYSRC,SE2450C077
     C*
     C* CHECK IF MASTER ACCOUNT KEY EXISTS FOR THIS ACC.KEY
     C*
     C                     EXSR MA01
     C           WMISS     CABEQ'Y'       READIN
     C*
     C*  IF ACCRUAL SUMMARIES REQUIRED, CHECK FOR THIS KEY BEING AN
     C*  ACCRUAL AND ACCUMULATE VALUES IF IT IS AN ACCRUAL.
     C*
     C                     MOVE XACKY     WACKY
     C***********AKSI      IFEQ 'Y'                                       S01117
     C           BKAKSI    IFEQ 'Y'                                       S01117
     C           WACEVC    IFEQ 'A'
     C           WACAMC    IFEQ 'DA'
     C           WACAMC    OREQ 'PA'
     C           WACAMC    OREQ 'AI'
     C/COPY WNCPYSRC,SE2450C052
     C           XRVRS     IFEQ '0'
     C                     ADD  XEVAM     WAEVAM 130
     C                     ADD  XKBCA     WAKBCA 130
     C                     ADD  XKNCA     WAKNCA 130
     C                     MOVE *BLANKS   ##REVI                          S01522
     C                     ELSE
     C                     SUB  XEVAM     WAEVAM 130
     C                     SUB  XKBCA     WAKBCA 130
     C                     SUB  XKNCA     WAKNCA 130
     C                     MOVE '*'       PNAR                            E21237
     C                     MOVE '*'       ##REVI                          S01522
     C                     END
     C                     MOVE 'Y'       LASTAC  1
     C                     EXSR PRTA
     C/COPY WNCPYSRC,SE2450C027
     C                     GOTO READIN
     C/COPY WNCPYSRC,SE2450C028
     C                     END
     C                     END
     C                     END
     C*
     C** PROCESS NONE-ACCRUAL (+ ACCRUAL NOT REQUIRED) GEN'TD ACC.KEYS
     C*
     C                     MOVE 'N'       LASTAC  1
     C                     Z-ADDXEVAM     WAEVAM
     C                     Z-ADDXKBCA     WAKBCA
     C                     Z-ADDXKNCA     WAKNCA
     C*
     C* DUE TO TRADES SUBR UPSETTING OCCURRENCE OF BALCCY ENSURE HERE
     C* THAT IF CURRENT CCY IS IN GX ARRAY, BALLCCY IS AT SAME OCCUR
     C*
     C                     Z-ADD1         N
     C           XEVCY     LOKUPGX,N                     62
     C           *IN62     IFEQ '1'
     C                     Z-ADDN         Q
     C           Q         OCUR BALCCY                 79
     C                     END
     C*
     C                     EXSR BLD01
     C/COPY WNCPYSRC,SE2450C029
     C*
     C                     GOTO READIN
     C*
     C           EAUDIT    TAG                              ** EAUDIT**
     C/COPY WNCPYSRC,SE2450C030
     C*
     C*  IF ACCRUAL SUMMARIES REQUIRED, CHECK FOR LAST KEY BEING AN
     C*  ACCRUAL AT END OF GENERATED ACCOUNT KEYS FILE
     C*
     C***********AKSI      IFEQ 'Y'                                       S01117
     C           BKAKSI    IFEQ 'Y'                                       S01117
     C           LASTAC    ANDEQ'Y'
     C           WMISS     ANDNE'Y'
     C*                                                                   E24453
     C** Print total for last investment type and set up flag for         E24453
     C** the accrual narrative                                            E24453
     C*                                                                   E24453
     C                     EXSR PRTA1                                     E24453
     C                     MOVE 'Y'       ACCRLK                          E24453
     C                     EXSR BLD01
     C                     END
     C*
     C* EXECUTE BAL01 TO WRITE ANY IMBALANCES TO SUSPENSE ACCOUNT
     C*
     C                     EXSR BAL01
     C*
     C           DBERR     TAG                              ** DBERR **
     C*
     C                     EXSR AUDIT
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *                                                               *
     C                     SETON                     LR
      *                                                               *
      *================================================================
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* BLD01    - BUILD OUTPUT ACCOUNT KEYS AND WRITE RECORDS.       *
     C*                                                               *
     C*****************************************************************
     C*
     C           BLD01     BEGSR                           ** BLD01  **
     C*
     C*  POST ACCOUNTS DEPENDING ON VALUES IN POSTING REFERENCE FIELDS
     C*
     C           PRF006    CABEQ0         ENDBL1
     C*
     C           1         DO   6         I       10
     C*
     C**  BUILD NARRATIVE DESCRIPTION FOR EACH NONE ZERO REFERENCE
     C*
     C           PRF,I     CASNE0         NARRAT
     C                     END
     C*
     C**  BUILD OUTPUT GEST RECORD FOR EACH TYPE
     C*
     C           PRF,I     CASEQ01        PRF1P
     C           PRF,I     CASEQ02        PRF2P
     C           PRF,I     CASEQ03        PRF3P
     C           PRF,I     CASEQ04        PRF4P
     C           PRF,I     CASEQ05        PRF5P
     C                     END
     C*
     C**  IF SYSTEM IS MULTIBRANCHING
     C**      AND POSTING IS NOT GOING TO SUSPENSE
     C**      AND BRANCH CODE OF ACCOUNT IS DIFFERENT TO BR. OF SEC
     C**   THEN
     C**                                                                  S01117
     C**      If interbranch accounting is via the Main Branch            S01117
     C**         then execute SR.MULTMB to generate multibranch postings  S01117
     C**      Else                                                        S01117
     C**      EXECUTE SUBR MULTIB TO GENERATE MULTIBRANCH POSTINGS
     C**      End                                                         S01117
     C**                                                                  S01117
     C**   END
     C**  ( *IN78 = 0 MEANS A/C EXISTS )
     C**
     C           PRF,I     IFNE 0
     C           MBIN      ANDEQ'Y'
     C           PSTSUS    ANDNE'Y'
     C           *IN78     ANDEQ'0'
     C***********XBRCH     ANDNEBRCDAC                                    S01117
     C           XBRHA     ANDNEBRCAAC                                    S01117
     C*                                                                   S01117
     C**  Interbranch postings between booking and settlement branches    S01117
     C*                                                                   S01117
     C           BKIEMB    IFEQ 'N'                                       S01117
     C           BKMABR    OREQ XBRHA                                     S01117
     C***********BKMABR    OREQ SEBR                                S01117E33011
     C           BKMABR    OREQ KBRCA                                     E33011
     C                     EXSR MULTIB
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**  Interbranch postings via Main Branch                            S01117
     C*                                                                   S01117
     C                     EXSR MULTMB                                    S01117
     C                     END                                            S01117
     C*
     C                     END
     C*
     C                     MOVEL*BLANK    PSTSUS  1
     C*
     C                     END
     C*
     C**  CREATE ADDITIONAL TRADE POSTINGS IF REQUIRED
     C*
     C           WACEVC    IFEQ 'T'
     C           WACAMC    ANDEQ'CV'
     C/COPY WNCPYSRC,SE2450C001
     C           WACEVC    OREQ 'V'
     C           WACAMC    ANDEQ'CV'
     C           WACEVC    OREQ 'S'
     C           WACTRT    ANDEQ' '
     C           WACAMC    ANDEQ'SA'
     C           CGL031    OREQ 'Y'                                                           CGL031
     C           WACEVC    ANDEQ'E'                                                           CGL031
     C           WACAMC    ANDEQ'ET'                                                          CGL031
     C/COPY WNCPYSRC,SE2450C101
     C*
     C**  EVENT CURRENCY MUST BE DIFFERENT TO NOMINAL CURRENCY
     C*
     C           XEVCY     IFNE XKCCY
     C                     EXSR TRADES
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE2450C009
      *                                                                   S01447
      *** If Withholding Tax installed, event type is a coupon(C) or      S01447
      *** dividend (H), and event ccy is not equal to nominal ccy,        S01447
      *** post to trades.                                                 S01447
      *                                                                   S01447
     C           S01447    IFEQ 'Y'                                       S01447
     C/COPY WNCPYSRC,SE2450C076
     C           WACEVC    IFEQ 'C'                                       S01447
     C           WACAMC    ANDEQ'WD'                                      S01447
     C           WACEVC    OREQ 'H'                                       S01447
     C           WACAMC    ANDEQ'WD'                                      S01447
      *                                                                   S01447
     C           XEVCY     IFNE XKCCY                                     S01447
     C                     EXSR TRADES                                    S01447
     C                     END                                            S01447
     C                     END                                            S01447
     C                     END                                            S01447
     C*
     C           ENDBL1    ENDSR                            **ENDBL1**
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* MA01     - CHECK IF MATCHING ACCOUNT KEY EXISTS ON PF/SEACKD  *
     C*                                                               *
     C*****************************************************************
     C*
     C           MA01      BEGSR                           ** MA01   **
     C*
     C*  CHAIN TO SEACKD FILE WITH ACCOUNT KEY FROM GENERATED A/K FILE
     C*
     C***********THACKY    CHAINSEACKD               79                   S01176
     C           SEKKY     CHAINSEACKD               79                   S01176
     C           *IN79     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVE 'Y'       WMISS   1
     C                     MOVE WWPRFC    PRFC                            179645
     C                     EXSR PRTM
     C                     ELSE
     C                     MOVE 'N'       WMISS
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*    ACDCHN SR. - TO CHAIN FOR ACCOUNT CODE FROM TABSE TABTE10  *
     C*        CALLS  - TABCHN                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           ACDCHN    BEGSR                           *** ACDCHN ***
     C*
     C                     Z-ADDY         X
     C           ACOD      LOKUPACDS,X                   62
     C           *IN62     IFEQ '1'                         B001
     C                     MOVELATY,X     ATYPTE
     C                     MOVELASC,X     ACCS                            S10736
     C                     ELSE                             X001
     C**********           MOVE BLK012    ZTABKY                                              CGL029
     C**********           MOVEL'30'      ZTABKY                                              CGL029
     C**********           MOVELACOD      WRK005  5                                           CGL029
     C**********           MOVE '1'       WRK005                                              CGL029
     C**********           MOVE WRK005    ZTABKY                                              CGL029
     C********** ZTABKY    CHAINTABICD               79                                       CGL029
     C********** *IN79     IFEQ '1'                                                           CGL029
     C********** RECI      OREQ '*'                                                           CGL029
     C********** *LOCK     IN   LDA                                                    S01117 CGL029
     C**********           SETON                     U7U8                                     CGL029
     C**********           MOVE 'TABLE'   DBFILE           ***************                    CGL029
     C**********           MOVELZTABKY    DBKEY            * DB ERROR 02 *                    CGL029
     C**********           Z-ADD02        DBASE            ***************                    CGL029
     C**********           OUT  LDA                                                    S01117 CGL029
     C**********           DUMP                                                        S01117 CGL029
     C**********           GOTO DBERR                                                         CGL029
     C**********           END                                                                CGL029
      *                                                                                       CGL029
     C                     MOVE ACOD      PACCD                                               CGL029
      *                                                                                       CGL029
     C                     CALL 'AOACODR0'                                                    CGL029
     C**********           PARM *BLANKS   PRTCD   7                                  CGL029 BUG8292R
     C**********           PARM '*VERIFY' POPTN   7                                  CGL029 BUG8292R
     C                     PARM '*MSG'    PRTCD   7                                         BUG8292R
     C                     PARM '*KEY'    POPTN   7                                         BUG8292R
     C                     PARM           PACCD  10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *                                                                                       CGL029
     C           PRTCD     IFNE *BLANKS                                                       CGL029
     C           *LOCK     IN   LDA                                                           CGL029
     C                     MOVE 'SDACODPD'DBFILE                                              CGL029
     C                     MOVE PACCD     DBKEY                                               CGL029
     C                     Z-ADD2         DBASE                                               CGL029
     C                     OUT  LDA                                                           CGL029
     C                     MOVE *ON       *INU7                                               CGL029
     C                     MOVE *ON       *INU8                                               CGL029
     C                     DUMP                                                               CGL029
     C                     GOTO DBERR                                                         CGL029
     C                     ENDIF                                                              CGL029
      *                                                                                       CGL029
      ** Setup original fields with values returned from AOACODR0                            BUG8292
      *                                                                                      BUG8292
     C                     MOVE A5ACCD    ACOD                                               BUG8292
     C                     MOVE A5ACTY    ATYPTE                                             BUG8292
     C                     MOVE A5ACSC    ACCS                                               BUG8292
      *                                                                                      BUG8292
     C           Y         IFGT 1                           B002
     C                     SUB  1         Y
     C                     Z-ADDACOD      ACDS,Y
     C                     MOVE ATYPTE    ATY,Y
     C                     MOVELACCS      ASC,Y                           S10736
     C                     END                              E002
     C                     END                              E001
     C*
     C                     MOVE ATYPTE    ATYP
     C                     MOVE ACCS      ACSC                            S10736
     C           ATYP      IFEQ 'R'
     C                     Z-ADD1         RIND
     C                     Z-ADD92050     TRAT
     C** If PB is on                                                                          209743
     C           BGN4ST    IFEQ 'Y'                                                           209743
     C** Coupon                                                                               209743
     C           XPEV1     IFEQ 'CP'                                                          209743
     C                     Z-ADD92051     TRAT                                                209743
     C                     END                                                                209743
     C** Dividend                                                                             209743
     C           XPEV1     IFEQ 'DV'                                                          209743
     C                     Z-ADD92052     TRAT                                                209743
     C                     END                                                                209743
     C** Maturity                                                                             209743
     C           XPEV1     IFEQ 'MT'                                                          209743
     C                     Z-ADD92053     TRAT                                                209743
     C                     END                                                                209743
     C                     END                                                                209743
     C*                                                                                       209743
     C*                    MOVE ACNOAN    ACNO                            133649
     C           ACCNTK    CHAINACCNT                79                   133649
     C           *IN79     IFEQ '0'                                       133649
     C                     MOVE ACNOAC    ACNO                            133649
     C                     END                                            133649
     C/COPY WNCPYSRC,SE2450C087
     C                     ELSE
     C                     Z-ADD0         RIND
     C                     Z-ADD0         TRAT
     C                     Z-ADD0         ACNO
     C                     END
     C/COPY WNCPYSRC,SE2450C094
     C*
     C           ACDC99    ENDSR                           *** ACDC99 ***
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*    G10CHN SR. - TO CHAIN FOR FORWARD TRADE EQUIVALENT TABTG10 *
     C*                                                               *
     C*****************************************************************
     C*
     C           G10CHN    BEGSR                           *** G10CHN ***
     C*
     C                     Z-ADDR         T       30
     C           GCCY      LOKUPGC,T                     62
     C           *IN62     IFEQ '1'                         B001
     C**********           Z-ADDGCA,T     WFTAC   40                                          CGL029
     C**********           Z-ADDGSP,T     WSPAC   40                                   E14710 CGL029
     C                     Z-ADDGCA,T     WFTAC  100                                          CGL029
     C                     Z-ADDGSP,T     WSPAC  100                                          CGL029
     C                     ELSE                             X001
     C                     MOVE BLK012    ZTABKY
     C                     MOVEL'20'      ZTABKY
     C                     MOVELGCCY      WRK004  4
     C                     MOVE '1'       WRK004
     C                     MOVE WRK004    ZTABKY
     C                     EXSR TABCHN
     C           R         IFGT 1                           B002
     C                     SUB  1         R
     C                     MOVE GCCY      GC,R
     C                     Z-ADDTEQV      GCA,R
     C                     Z-ADDTEQV      WFTAC
     C                     Z-ADDTACC      GSP,R                           E14710
     C                     Z-ADDTACC      WSPAC                           E14710
     C                     END                              E002
     C                     END                              E001
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  TABCHN - CHAINS TO SECURITIES TRADING TABLE FILE             *
     C*                                                               *
     C*****************************************************************
     C*
     C           TABCHN    BEGSR                           *** TABCHN ***
     C*
     C********** ZTABKY    CHAINTABSE                79                                     MD049636
     C           ZTABKY    CHAINTABSE2               79                                     MD049636
     C           *IN79     IFEQ '1'
     C           RECI      OREQ '*'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 03 *
     C                     Z-ADD03        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR
     C                     END
     C*
     C           TABT99    ENDSR                           *** TABT99 ***
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRF1P - CREATE OUTPUT LF/GEST RECORD FOR POSTING REFERENCE 1  *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRF1P     BEGSR                           ** PRF1P  **
     C*
     C*  POSTING REFERENCE 1
     C*
     C*  CUSTOMER IS BRANCH INTERNAL CUSTOMER NUMBER OF A/C KEY BRANCH
     C*
     C**********           Z-ADDXBICN     CNUM                                                CSD027
     C                     MOVE XBICN     CNUM                                                CSD027
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C*
     C*  ACOUNT CODE
     C                     MOVE AC,I      ACOD
     C*
     C*  SEQUENCE NUMBER    - LF/SEKEY
     C*
     C**********           Z-ADDXASQN     ACSQ                            E18803
     C**********                                                          E18803
     C********** ACSQ      IFEQ *ZERO                                     E18803
     C********** MBIN      IFEQ 'Y'                                       E18803
     C**********           Z-ADDXSACS     ACSQ                            E18803
     C**********           ELSE                                           E18803
     C                     Z-ADD01        ACSQ
     C**********           END                                            E18803
     C**********           END                                            E18803
     C/COPY WNCPYSRC,SE2450C024
     C*                                                                   S01117
     C*  Branch code is A/c Key Booking Branch                            S01117
     C           ACCRLK    IFEQ 'Y'                                       057668
     C                     MOVE LSBRHA    KBRCA                           057668
     C                     ELSE                                           057668
     C                     MOVE BRHA      KBRCA                           S01117
     C                     END                                            057668
     C*
     C*  GENERATE REMAINING FIELDS AND WRITE LF/GEST RECORD IN PRFALL
      *                                                                   S01522
      **  Set up fields for Posting Narrative                             S01522
     C                     MOVE CNUM      ##CUST                          S01522
     C                     MOVE CCY       ##CCY                           S01522
     C                     MOVE ACOD      ##ACCD                          S01522
     C                     MOVE ACSQ      ##ACSQ                          S01522
     C                     MOVE KBRCA     ##BRCA                          S01522
     C                     MOVE XSESH     ##SECN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C******************** MOVE XTRFR     ##TRNO                    S01522087870
     C                     MOVELXTRFR     ##TRNO                          087870
     C/COPY WNCPYSRC,SE2450C078
     C*
     C                     EXSR PRFALL
     C*
     C           ENDPR1    ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRF2P - CREATE OUTPUT LF/GEST RECORD FOR POSTING REFERENCE 2  *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRF2P     BEGSR                           ** PRF2P  **
     C*
     C*  POSTING REFERENCE 2
     C*
     C*  SETTLEMENT TYPE IS 01,02,07,08 OR 12
     C*
     C           XSTLT     IFEQ 01
     C           XSTLT     OREQ 02
     C           XSTLT     OREQ 07
     C           XSTLT     OREQ 08
     C           XSTLT     OREQ 12
     C*
     C* GET CUSTOMER,ACCOUNT AND SEQUENCE NO FROM TABLETL VIA NOSTRO
     C*
     C                     MOVE BLK012    ZTABKY
     C                     MOVEL'70'      ZTABKY
     C                     MOVELXSTLA     XNOS6A  6                                           199019
     C                     MOVE XNOS6A    XNOS1A  1                                           199019
     C           XNOS1A    IFNE *BLANK                                                        199019
     C                     MOVE XSTLA     W2      2                                           199019
     C                     ELSE                                                               199019
     C                     MOVELXSTLA     XNOS5A  5                                           199019
     C                     MOVELXNOS5A    XNOS3A  3                                           199019
     C                     MOVE XNOS3A    XNOS1B  1                                           199019
     C           XNOS1B    IFNE *BLANK                                                        199019
     C                     MOVE XNOS5A    W2                                                  199019
     C                     ELSE                                                               199019
     C                     MOVELXNOS5A    W2                                                  199019
     C                     ENDIF                                                              199019
     C                     ENDIF                                                              199019
     C                     MOVELXEVCY     W5      5
     C**********           MOVELXSTLA     W2      2                                           199019
     C                     MOVE W2        W5
     C                     MOVE W5        ZTABKY
     C*
     C********** ZTABKY    CHAINTABSE                79                                     MD049636
     C           ZTABKY    CHAINTABSE2               79                                     MD049636
     C*
     C* POST ENTRY TO SUSPENSE IF NOSTRO IS MISSING
     C*
     C           *IN79     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       PSTSUS
     C**********           MOVE *BLANKS   SHBACC 15                                           CGL029
     C**********           MOVEL'000000'  SHBACC                                              CGL029
     C**********           MOVE '000000'  SHBACC                                              CGL029
     C                     MOVE SHCLR     SHBACC 21                                           CGL029
     C                     ELSE
     C**********           Z-ADDCNUMTL    CNUM                                                CSD027
     C                     MOVE CNUMTL    CNUM                                                CSD027
     C                     Z-ADDACODTL    ACOD
     C                     Z-ADDACSQTL    ACSQ
     C*                                                                   S01117
     C*  Branch code is Nostro Branch Code                                S01117
     C                     MOVE BRCATL    KBRCA                           S01117
     C                     END
     C*
     C*  CURRENCY CODE
     C*
     C                     MOVE XEVCY     CCY
     C*
     C* END OF SETTLEMENTS WITH VALUES 01,02,07,08 OR 12.
     C*
     C                     END
     C*
     C*  SETTLEMENT TYPE IS 03
     C*
     C           XSTLT     IFEQ 03
     C*
     C*  CUSTOMER IS BRANCH INTERNAL CUSTOMER NUMBER OF A/C KEY BRANCH
     C*
     C**********           Z-ADDXBICN     CNUM                                                CSD027
     C                     MOVE XBICN     CNUM                                                CSD027
     C*
     C*  CURRENCY CODE
     C*
     C                     MOVE XEVCY     CCY
     C*
     C*  ACCOUNT CODE FROM TABTB40 ICD
     C*
     C                     Z-ADDCSAC      ACOD
     C*
     C*  ACCOUNT SEQUENCE NUMBER - 01
     C*
     C********** MBIN      IFEQ 'Y'                                       E18803
     C**********           Z-ADDXSACS     ACSQ                            E18803
     C**********           ELSE                                           E18803
     C                     Z-ADD01        ACSQ
     C**********           END                                            E18803
     C*                                                                   S01117
     C*  Branch code is A/c Key Booking Branch                            S01117
     C                     MOVE BRHA      KBRCA                           S01117
     C*
     C* END OF SETTLEMENTS WITH VALUE 03
     C*
     C                     END
     C*
     C*  SETTLEMENT TYPE IS 04
     C*
     C           XSTLT     IFEQ 04
     C*
     C* GET CUSTOMER FROM SEKEY GENERATED KEYS FILE
     C*
     C**********           Z-ADDXCSTN     CNUM                                                CSD027
     C                     MOVE XCSTN     CNUM                                                CSD027
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C*
     C*  ACCOUNT CODE FROM TABTB20 ICD  PRIME CURRENT A/C CODE
     C*
     C                     Z-ADDCADC      ACOD
     C*
     C*  ACCOUNT SEQUENCE NUMBER - 01
     C*
     C           MBIN      IFEQ 'Y'
     C*                                                                   S01117
     C* Obtain account sequence from first account for the customer/      S01117
     C* currency/account code combination                                 S01117
     C*                                                                   S01117
     C                     Z-ADD0         ACSQ                            S01117
     C           ACCNTK    SETLLACCNT                                     S01117
     C                     READ ACCNT                    78               S01117
     C*                                                                   S01117
     C** If end of file or account is for different customer/currency/    S01117
     C** account code combination then Database Error                     S01117
     C           *IN78     IFEQ '1'                                       S01117
     C           XCSTN     ORNE CNUM                                      S01117
     C           CADC      ORNE ACOD                                      S01117
     C           XEVCY     ORNE CCY                                       S01117
     C*                                                                   S01117
     C                     MOVE '1'       *INLR                           S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'ACCNT'   DBFILE           ***************S01117
     C                     MOVELACCDS     DBKEY            ** DB ERROR 16 S01117
     C                     Z-ADD16        DBASE            ***************S01117
     C                     SETON                       U7U8               S01117
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C***********          Z-ADDXSACS     ACSQ                            S01117
     C                     Z-ADDACSQAC    ACSQ                            073681
     C                     ELSE
     C                     Z-ADD01        ACSQ
     C                     END
     C*                                                                   S01117
     C*  Branch code is A/c Key Booking Branch                            S01117
     C                     MOVE BRHA      KBRCA                           S01117
     C*
     C* END OF SETTLEMENTS WITH VALUE 04
     C*
     C                     END
     C*
     C*  SETTLEMENT TYPE IS 05 OR 15
     C*
     C           XSTLT     IFEQ 05
     C           XSTLT     OREQ 15
     C*
     C* GET CUSTOMER FROM SETTLEMENT ACCOUNT FIELD ON TRANSACTION FILE
     C*
     C                     MOVELXSTLA     CNUM
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C*
     C* GET ACCOUNT FROM SETTLEMENT ACCOUNT FIELD ON TRANSACTION FILE
     C*
     C**********           MOVE XSTLA     W6      6                                           CGL029
     C**********           MOVELW6        ACOD                                                CGL029
     C                     MOVE XSTLA     W12    12                                           CGL029
     C                     MOVELW12       ACOD                                                CGL029
     C*
     C* GET SEQUENCE FROM SETTLEMENT ACCOUNT FIELD ON TRANSACTION FILE
     C*
     C                     MOVE XSTLA     ACSQ
     C*                                                                   S01117
     C*  Branch code is A/c Key Settlement Branch                         S01117
     C                     MOVE SEBR      KBRCA                           S01117
     C*
     C* END OF SETTLEMENTS WITH VALUE 05 AND 15
     C*
     C                     END
     C*
     C*  SETTLEMENT TYPE IS 14
     C*
     C           XSTLT     IFEQ 14
     C*
     C* GET CUSTOMER/ACCOUNT/SEQUENCE FROM ACNUM FILE
     C*
     C                     MOVELXSTLA     WN10
     C                     Z-ADDWN10      ACNO
     C           ACNUMK    CHAINACNUM                79
     C*
     C* POST ENTRY TO SUSPENSE IF ACCOUNT IS MISSING OR NOT OPEN
     C*
     C           *IN79     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     MOVEL'Y'       PSTSUS
     C**********           MOVE *BLANKS   SHBACC 15                                           CGL029
     C**********           MOVEL'000000'  SHBACC                                              CGL029
     C**********           MOVE '000000'  SHBACC                                              CGL029
     C                     MOVE SHCLR     SHBACC 21                                           CGL029
     C                     ELSE
     C                     MOVE CNUMAN    CNUM
     C                     MOVE ACODAN    ACOD
     C                     MOVE ACSQAN    ACSQ
     C                     END
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C*                                                                   S01117
     C*  Branch code is A/c Branch                                        S01117
     C                     MOVE BRCAAN    KBRCA                           S01117
     C*
     C* END OF SETTLEMENTS WITH VALUE 14
     C*
     C                     END
     C*
     C*  POSTING REF IS 02 AS PER THIS SUBROUTINE
     C*  BUT OUTPUT IS TO SUSPENSE ACCOUNT
     C*
     C*
     C           XSTLT     IFEQ 00
     C           XSTLT     OREQ 06
     C*
     C*  CUSTOMER IS BRANCH INTERNAL CUSTOMER NUMBER OF A/C KEY BRANCH
     C*
     C**********           Z-ADDXBICN     CNUM                                                CSD027
     C                     MOVE XBICN     CNUM                                                CSD027
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C*
     C*  ACCOUNT CODE
     C                     MOVE COMS      ACOD
     C*
     C*  SEQUENCE NUMBER
     C*
     C********** MBIN      IFEQ 'Y'                                       E18803
     C**********           Z-ADDXSACS     ACSQ                            E18803
     C**********           ELSE                                           E18803
     C                     Z-ADD01        ACSQ
     C**********           END                                            E18803
     C*                                                                   S01117
     C*  Branch code is A/c Key Booking Branch                            S01117
     C                     MOVE BRHA      KBRCA                           S01117
     C*
     C* END OF SUSPENSE ACCOUNT OUPUT FOR POSTING REF 2
     C*
     C                     END
     C*
     C*  GENERATE REMAINING FIELDS AND WRITE LF/GEST RECORD IN PRFALL
      *                                                                   S01522
      **  Set up fields for Posting Narrative                             S01522
     C                     MOVE CNUM      ##CUST                          S01522
     C                     MOVE CCY       ##CCY                           S01522
     C                     MOVE ACOD      ##ACCD                          S01522
     C                     MOVE ACSQ      ##ACSQ                          S01522
     C                     MOVE KBRCA     ##BRCA                          S01522
     C                     MOVE XSESH     ##SECN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C******************** MOVE XTRFR     ##TRNO                    S01522087870
     C                     MOVELXTRFR     ##TRNO                          087870
     C/COPY WNCPYSRC,SE2450C079
      *                                                                   S01522
     C           PSTSUS    IFEQ 'Y'                                       S01522
     C                     MOVE *ZEROS    ##ACCD                          S01522
     C                     MOVE *ZEROS    ##ACSQ                          S01522
     C**********           MOVE *ZEROS    ##CUST                                       S01522 CSD027
     C                     MOVE *BLANKS   ##CUST                                              CSD027
     C                     ENDIF                                          S01522
     C*
     C                     EXSR PRFALL
     C*
     C           ENDPR2    ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRF3P - CREATE OUTPUT LF/GEST RECORD FOR POSTING REFERENCE 3  *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRF3P     BEGSR                           ** PRF3P  **
     C*
     C*  POSTING REFERENCE 3
     C*
     C* GET CUSTOMER FROM LF/SEKEY
     C*
     C**********           Z-ADDXCSTN     CNUM                                                CSD027
     C                     MOVE XCSTN     CNUM                                                CSD027
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C*
     C*  ACCOUNT CODE
     C                     MOVE AC,I      ACOD
     C*
     C*  SEQUENCE NUMBER    - LF/SEKEY
     C*
     C                     Z-ADDXASQN     ACSQ
     C*
     C           ACSQ      IFEQ *ZERO
     C***********MBIN      IFEQ 'Y'                                       S01117
     C***********          Z-ADDXSACS     ACSQ                            S01117
     C***********          ELSE                                           S01117
     C                     Z-ADD01        ACSQ
     C***********          END                                            S01117
     C                     END
     C*                                                                   S01117
     C*  Branch code is A/c Key Booking Branch                            S01117
     C           ACCRLK    IFEQ 'Y'                                       057668
     C                     MOVE LSBRHA    KBRCA                           057668
     C                     ELSE                                           057668
     C                     MOVE BRHA      KBRCA                           S01117
     C                     END                                            057668
     C*
     C*  GENERATE REMAINING FIELDS AND WRITE LF/GEST RECORD IN PRFALL
      *                                                                   S01522
      **  Set up fields for Posting Narrative                             S01522
     C                     MOVE CNUM      ##CUST                          S01522
     C                     MOVE CCY       ##CCY                           S01522
     C                     MOVE ACOD      ##ACCD                          S01522
     C                     MOVE ACSQ      ##ACSQ                          S01522
     C                     MOVE KBRCA     ##BRCA                          S01522
     C                     MOVE XSESH     ##SECN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C******************** MOVE XTRFR     ##TRNO                    S01522087870
     C                     MOVELXTRFR     ##TRNO                          087870
     C/COPY WNCPYSRC,SE2450C080
     C*
     C                     EXSR PRFALL
     C*
     C           ENDPR3    ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRF4P - CREATE OUTPUT LF/GEST RECORD FOR POSTING REFERENCE 4  *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRF4P     BEGSR                           ** PRF4P  **
     C*
     C*  POSTING REFERENCE 4
     C*
     C* GET CUSTOMER FROM LF/SEKEY ISSUER FIELD
     C*
     C**********           Z-ADDXISSR     CNUM                                                CSD027
     C                     MOVE XISSR     CNUM                                                CSD027
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C*
     C*  ACCOUNT CODE
     C                     MOVE AC,I      ACOD
     C*
     C*  SEQUENCE NUMBER    - LF/SEKEY
     C*
     C                     Z-ADDXASQN     ACSQ
     C*
     C           ACSQ      IFEQ *ZERO
     C***********MBIN      IFEQ 'Y'                                       S01117
     C***********          Z-ADDXSACS     ACSQ                            S01117
     C***********          ELSE                                           S01117
     C                     Z-ADD01        ACSQ
     C***********          END                                            S01117
     C                     END
     C*                                                                   S01117
     C*  Branch code is A/c Key Booking Branch                            S01117
     C           ACCRLK    IFEQ 'Y'                                       057668
     C                     MOVE LSBRHA    KBRCA                           057668
     C                     ELSE                                           057668
     C                     MOVE BRHA      KBRCA                           S01117
     C                     END                                            057668
     C*
     C*  GENERATE REMAINING FIELDS AND WRITE LF/GEST RECORD IN PRFALL
      *                                                                   S01522
      **  Set up fields for Posting Narrative                             S01522
     C                     MOVE CNUM      ##CUST                          S01522
     C                     MOVE CCY       ##CCY                           S01522
     C                     MOVE ACOD      ##ACCD                          S01522
     C                     MOVE ACSQ      ##ACSQ                          S01522
     C                     MOVE KBRCA     ##BRCA                          S01522
     C                     MOVE XSESH     ##SECN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C******************** MOVE XTRFR     ##TRNO                    S01522087870
     C                     MOVELXTRFR     ##TRNO                          087870
     C/COPY WNCPYSRC,SE2450C083
     C*
     C                     EXSR PRFALL
     C*
     C           ENDPR4    ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRF5P - CREATE OUTPUT LF/GEST RECORD FOR POSTING REFERENCE 5  *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRF5P     BEGSR                           ** PRF5P  **
     C*
     C*  POSTING REFERENCE 5
     C*
     C* GET CUSTOMER FROM LF/SEKEY
     C*
     C           XKCUST    IFEQ *BLANKS                                                     BUG12817
     C*                                                                                     BUG12817
     C                     MOVELTRFR      REFN    6                                         BUG12817
     C           REFN      CHAINTRADS                97                                     BUG12817
     C*                                                                                     BUG12817
     C           *IN97     IFEQ *OFF                                                        BUG12817
     C*                                                                                     BUG12817
     C           TDTP      IFEQ 'TP'                                                        BUG12817
     C                     MOVE DELT      XKCUST                                            BUG12817
     C                     ELSE                                                             BUG12817
     C                     MOVE DELF      XKCUST                                            BUG12817
     C                     ENDIF                                                            BUG12817
     C*                                                                                     BUG12817
     C                     ENDIF                                                            BUG12817
     C*                                                                                     BUG12817
     C                     ENDIF                                                            BUG12817
     C*                                                                                     BUG12817
     C**********           Z-ADDXKCUST    CNUM                                                CSD027
     C                     MOVE XKCUST    CNUM                                                CSD027
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C*
     C*  ACCOUNT CODE
     C                     MOVE AC,I      ACOD
     C*
     C*  SEQUENCE NUMBER    - LF/SEKEY UNLESS MULTI BRANCH IS ON
     C*
     C                     Z-ADDXASQN     ACSQ
     C*
     C           ACSQ      IFEQ *ZERO
     C***********MBIN      IFEQ 'Y'                                       S01117
     C***********          Z-ADDXSACS     ACSQ                            S01117
     C***********          ELSE                                           S01117
     C                     Z-ADD01        ACSQ
     C***********          END                                            S01117
     C                     END
     C*                                                                   S01117
     C*  Branch code is A/c Key Booking Branch                            S01117
     C           ACCRLK    IFEQ 'Y'                                       057668
     C                     MOVE LSBRHA    KBRCA                           057668
     C                     ELSE                                           057668
     C                     MOVE BRHA      KBRCA                           S01117
     C                     END                                            057668
     C*
     C*  GENERATE REMAINING FIELDS AND WRITE LF/GEST RECORD IN PRFALL
      *                                                                   S01522
      **  Set up fields for Posting Narrative                             S01522
     C                     MOVE CNUM      ##CUST                          S01522
     C                     MOVE CCY       ##CCY                           S01522
     C                     MOVE ACOD      ##ACCD                          S01522
     C                     MOVE ACSQ      ##ACSQ                          S01522
     C                     MOVE KBRCA     ##BRCA                          S01522
     C                     MOVE XSESH     ##SECN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C******************** MOVE XTRFR     ##TRNO                    S01522087870
     C                     MOVELXTRFR     ##TRNO                          087870
     C/COPY WNCPYSRC,SE2450C081
     C*
     C                     EXSR PRFALL
     C*
     C           ENDPR5    ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRFALL   - CREATE OUTPUT LF/GEST RECORD FOR REMAINING FIELDS  *
     C*            COMMON TO ALL POSTING REFERENCE TYPES              *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRFALL    BEGSR                           ** PRFALL **
     C/COPY WNCPYSRC,SEH00224
      *                                                                                       CGL020
     C                     MOVE *BLANKS   ACKEY                                               CGL020
     C                     MOVE *BLANKS   FEEFLG                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
     C                     MOVE *BLANKS   TICKER                                              CGL020
     C                     MOVE *BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD0         NOMINL                                              CGL020
     C*
     C*  GENERATE VALUES  INTO ALL REMAINING FIELDS AND WRITE RECORD
     C*
     C*  IF , SO FAR , POSTING IS NOT DUE FOR SUSPENSE
     C*      ACCESS ACCOUNT
     C*
     C           PSTSUS    IFNE 'Y'
     C*
     C                     EXSR ACCNTI
     C*
     C***IF*ACCOUNT*EXISTS*USE*BRANCH*FROM*LF/ACCNT,*ELSE*FROM*LF/SEKEY***E33011
     C***********                                                         E33011
     C************IN78     IFEQ '0'                                       E33011
     C***********          MOVE BRCDAC    BRCD                            S01117
     C***********          MOVE BRCAAC    BRCA                      S01117E33011
     C***********          ELSE                                           E33011
     C***********          MOVE XBRCH     BRCD                            S01117
     C***********          MOVE XBRHA     BRCA                      S01117E33011
     C***********          END                                            E33011
     C                     MOVE KBRCA     BRCA                            E36938
     C*
     C*  ACCOUNT TYPE AND RETAIL INDICATOR DETERMINED IN ACDCHN
     C*
     C                     EXSR ACDCHN
     C*                                                                   CAC002
     C** If Analytical Accounting is installed, use the account profit    CAC002
     C** centre for any posting to a retail or nostro account.            CAC002
     C*                                                                   CAC002
     C                     MOVE WWPRFC    PRFC                            CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           ATYP      IFEQ 'R'                                       CAC002
     C           ATYP      OREQ 'N'                                       CAC002
     C                     MOVE PRFCAC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C** If Analytical Accounting is installed, determine if profit       CAC002
     C** centre can hold an FX position in posting to the spot trade      CAC002
     C** account.                                                         CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           ACOD      ANDEQSPAC                                      CAC002
     C                     CALL 'AOPRFCR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM WWPRFC    WPRFC                           CAC002
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD51        DBASE            ************   CAC002
     C                     MOVEL'*KEY   ' DBOPTN           * DBERR 51 *   CAC002
     C                     MOVELWWPRFC    DBKEY            ************   CAC002
     C                     MOVEL'SDPRFCPD'DBFILE                          CAC002
     C                     OUT  LDA                                       CAC002
     C**********           SETON                       U7U8LR       CAC002153890
     C                     SETON                     U7U8LR               153890
     C                     DUMP                                           CAC002
     C                     EXSR AUDIT                                     CAC002
     C                     RETRN                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C           DSFPPC    IFNE *BLANKS                                   CAC002
     C                     MOVE DSFPPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*
     C*  POST ENTRY TO SUSPENSE IF:
     C*  1.ACCOUNT TYPE IS RETAIL BUT ACCOUNT DOES NOT EXIST
     C*  2.SYSTEM IS NOT MULTIBRANCHING AND BRANCH ON A/C
     C*    IS NOT = TO BRANCH ON A/C KEY
     C*  3.SYSTEM IS MULTIBRANCHING POSTING REFERENCE IS 2 SETTLEMENT
     C*    TYPE IS 03 AND BRANCH ON A/C IS NOT = TO BRANCH ON A/C KEY
     C*  4.CUSTOMER CODE IS ABSENT
     C*   ( *IN78 = 0 MEANS A/C EXISTS )
     C*
     C           ATYP      IFEQ 'R'
     C           *IN78     ANDEQ'1'
     C*
     C           MBIN      ORNE 'Y'
     C           *IN78     ANDEQ'0'
     C***********BRCDAC    ANDNEXBRCH                                     S01117
     C           BRCAAC    ANDNEXBRHA                                     S01117
     C*
     C           MBIN      OREQ 'Y'
     C           PRF,I     ANDEQ2
     C           XSTLT     ANDEQ03
     C           *IN78     ANDEQ'0'
     C***********BRCDAC    ANDNEXBRCH                                     S01117
     C           BRCAAC    ANDNEXBRHA                                     S01117
     C*
     C********** CNUM      OREQ *ZERO                                                         CSD027
     C           CNUM      OREQ *BLANKS                                                       CSD027
     C                     MOVEL'Y'       PSTSUS
     C                     MOVELACCDS     SHBACC
     C                     END
     C*
     C                     END
     C*
     C*  IF POSTING IS DUE FOR SUSPENSE
     C*
     C           PSTSUS    IFEQ 'Y'
     C/COPY WNCPYSRC,SE2450C095
     C***********          MOVE XBRCH     BRCD                            S01117
     C                     MOVE XBRHA     BRCA                            S01117
     C**********           Z-ADDXBICN     CNUM                                                CSD027
     C                     MOVE XBICN     CNUM                                                CSD027
     C                     Z-ADDCOMS      ACOD
     C********** MBIN      IFEQ 'Y'                                       E18803
     C**********           Z-ADDXSACS     ACSQ                            E18803
     C**********           ELSE                                           E18803
     C                     Z-ADD01        ACSQ
     C/COPY WNCPYSRC,SE2450C096
     C**********           END                                            E18803
     C                     MOVE ATYPSU    ATYP
     C                     MOVE ACSCSU    ACSC                            S10736
     C                     MOVE RINDSU    RIND
     C/COPY WNCPYSRC,SE2450C097
     C*                                                                   CAC002
     C** If Analytical Accounting is installed, use the Primary Funding   CAC002
     C** profit centre for posting to suspense account.                   CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE WWPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*
     C*  COMPUTER SUSPENSE SHOULD BE NON RETAIL
     C*
     C                     Z-ADD*ZERO     TRAT
     C                     Z-ADD*ZERO     ACNO
     C*
     C*  DETERMINE NARRATIVE
     C*
     C                     MOVE 'Y'       SUSPEN
     C                     EXSR NARRAT
     C                     MOVE 'N'       SUSPEN  1
     C                     END
     C*
     C*  POSTING DATE IS RUN DATE
     C*
     C                     Z-ADDRUND      PSTD
     C*
     C*  VALUE DATE
     C                     Z-ADDXEVDT     VALD
     C*
     C** NARRATIVE    - IS ALREADY SET UP ABOVE FOR SUSPENSE, IN BLD01
     C*                 FOR NON-SUSPENSE.
     C*
     C** POSTING AMOUNT
     C                     Z-ADDWAEVAM    PSTA
     C*
     C** ASSOCIATED CUSTOMER                                              S01182
     C*                                                                   S01182
     C** This is blank if producing an accrual summary key                E03831
     C           ACCRLK    IFEQ 'Y'                                       E03831
     C**********           Z-ADD*ZEROS    ASOC                                         E03831 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     MOVE *BLANK    PRFC                            S10736
     C                     ELSE                                           E03831
     C                     MOVELCSTN      ASOC                            S01182
     C                     END                                            E03831
     C*                                                                   053103
     C**  For Position Settlements, store Event Date in OTRF.             053103
     C*                                                                   053103
     C           BGPFMG    IFEQ 'Y'                                       053103
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   053103
     C           WACEVC    IFEQ 'P'                                       053103
     C           WACEVC    OREQ 'C'                                       053103
     C           WACEVC    OREQ 'M'                                       053103
     C           WACEVC    OREQ 'H'                                       053103
     C           WACEVC    OREQ 'R'                                       053103
     C                     MOVE XEVDT     WW11   11                       053103
     C                     MOVELWW11      OTRF                            053103
     C                     END                                            053103
     C*                                                                   053103
     C                     END                                            053103
     C*                                                                   S01182
     C** ORIGINAL TRANSACTION REFERENCE                                   S01182
     C*                                                                   S01182
     C                     MOVELTRFR      OTRF                            S01182
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           CGL007    IFEQ 'Y'                                       CGL007
     C           WACEVC    IFEQ 'P'                                       CGL007
     C           WACEVC    OREQ 'C'                                       CGL007
     C           WACEVC    OREQ 'M'                                       CGL007
     C           WACEVC    OREQ 'H'                                       CGL007
     C           WACEVC    OREQ 'R'                                       CGL007
     C                     MOVELXPEV1     OTRF                            CGL007
     C                     ENDIF                                          CGL007
     C                     ENDIF                                          CGL007
     C/COPY WNCPYSRC,SE2450C050
     C                     MOVE WWPTFR    OTRF                            S01486
     C                     END                                            S01486
     C*                                                                   S01182
     C** BOOK CODE                                                        S01182
     C                     MOVE WACBKC    BOKC                            S01182
     C*                                                                   S01182
     C** ORIGINAL TRANSACTION TYPE                                        S01182
     C*                                                                   S01182
     C                     MOVELWACITY    OTTP                            S01182
     C           BGPFMG    IFEQ 'Y'                                       046386
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           CGL020    OREQ 'Y'                                                           CGL020
     C                     MOVE *BLANKS   WTRTY2                          046386
     C                     END                                            046386
     C*                                                                   S01486
     C**  For Trades, move Transaction Type to OTTP (used in PM1500).     S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           CGL020    OREQ 'Y'                                                           CGL020
     C           WACEVC    IFEQ 'T'                                       S01486
     C           WACEVC    OREQ 'V'                                       S01486
     C           WACEVC    OREQ 'S'                                       S01486
     C           TRFR      ANDNE0                                         053103
     C*                                                                   S01486
     C           WACTRT    IFEQ 'P'                                       S01486
     C                     MOVE 'TP'      WTRTYP                          S01486
     C                     MOVE 'TP'      WTRTY2  2                       046386
     C                     END                                            S01486
     C*                                                                   S01486
     C           WACTRT    IFEQ 'S'                                       S01486
     C                     MOVE 'TS'      WTRTYP                          S01486
     C                     MOVE 'TS'      WTRTY2                          046386
     C                     END                                            S01486
     C*                                                                   053103
     C                     ELSE                                           053103
     C**********           MOVE XPEV1     WTRTY2                                       053103 CGL020
     C                     MOVE PEV1      WTRTY2                                              CGL020
     C                     END                                            S01486
     C                     MOVE WTRTY2    OTTP                            046386
     C           CGL007    IFEQ 'Y'                                       CGL007
     C**********           MOVE PEV1      OTTP                                         CGL007 CGL020
     C                     ENDIF                                          CGL007
     C                     END                                            S01486
     C*                                                                   S01182
     C** ORIGINAL TRANSACTION SUB-TYPE                                    S01182
     C*                                                                   S01182
     C                     MOVELSESH      OTST                            S01182
     C*                                                                   S01182
     C*  DEBIT CREDIT INDICATOR
     C*
     C*  IF POSITION 1 2 OR 3 SET DRCR TO 1 ELSE 0, STORE OPPOSITE-WDRCR
     C*
     C           I         IFGT 3
     C                     Z-ADD1         DRCR
     C                     Z-ADD0         WDRCR   10
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     Z-ADD1         WDRCR
     C                     END
     C*
     C*  IF REVERSAL INDICATOR IS ON REVERSE BY MOVING IN WDRCR
     C** If this is a reversal for an Accrual Summary Entry, do not       E44743
     C** reverse the DEB/CRED indicator as the amount is already been     E44743
     C** reversed by the summary function of this program.                E44743
     C** Condition need also take into account of reversal for coupon     085280
     C** accrual interest key.                                            085280
     C*
     C           XRVRS     IFEQ '1'
     C***********          Z-ADDWDRCR     DRCR                            E44743
     C                     MOVE '*'       PNAR                            E21237
     C                     MOVE '*'       ##REVI                          S01522
     C*                                                                   E44743
     C           BKAKSI    IFEQ 'Y'                                       E44743
     C           WACEVC    ANDNE'A'                                       E44743
     C           WACAMC    ANDNE'DA'                                      E44743
     C           WACAMC    ANDNE'PA'                                      E44743
     C           WACAMC    ANDNE'AI'                                      E44743
     C/COPY WNCPYSRC,SE2450C053
     C           BKAKSI    ORNE 'Y'                                       E44743
     C           BKAKSI    OREQ 'Y'                                       085280
     C           WACEVC    ANDNE'A'                                       085280
     C           WACAMC    ANDEQ'AI'                                      085280
     C/COPY WNCPYSRC,SE2450C069
     C                     Z-ADDWDRCR     DRCR                            E44743
     C                     END                                            E44743
     C*                                                                   E44743
     C** INITIALISE FIELDS FOR MANAGEMENT ACCOUNTING                      S10736
     C                     Z-ADD1         VOIN                            S10736
     C                     ELSE                                           S10736
     C                     Z-ADD0         VOIN                            S10736
     C                     MOVE *BLANKS   ##REVI                          S01522
     C                     END
     C                     Z-ADD235959    PTIM                            S10736
     C*
     C*  IF CREDIT (>3) AND AMOUNT NEGATIVE, REVERSE DEB/CRED IND
     C*
     C           I         IFGT 3
     C           WAEVAM    ANDLT0
     C           DRCR      IFEQ 0
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C                     Z-SUBPSTA      PSTA
     C                     END
     C*
     C*  IF DEBIT  (<4) AND AMOUNT NEGATIVE, REVERSE DEB/CRED IND
     C*
     C           I         IFLT 4
     C           WAEVAM    ANDLT0
     C           DRCR      IFEQ 1
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
     C                     Z-SUBPSTA      PSTA
     C                     END
     C*                                                                   E17026
     C** IF THE RETAIL ACCOUNT, NO ACCOUNTING ENTRY WILL BE GENERATED     E17026
     C** IF BLOCK ALL DEBIT INDICATOR ON AND DEBIT ENTRY, OR              E17026
     C** IF BLOCK ALL CREDIT INDICATOR ON AND CREDIT ENTRY                E17026
     C*                                                                   E17026
     C           RIND      IFEQ 1                                         E17026
     C*                                                                   E17026
     C                     EXSR ACCNTI                                    E17026
     C*                                                                   E17026
     C           *IN55     IFEQ '1'                                       E17026
     C           DRCR      ANDEQ0                                         E17026
     C           *IN56     OREQ '1'                                       E17026
     C           DRCR      ANDEQ1                                         E17026
     C                     GOTO SKPPRF                                    E17026
     C                     END                                            E17026
     C*                                                                   E17026
     C                     END                                            E17026
      *                                                                   CGL007
     C           CGL007    IFEQ 'Y'                                       CGL007
     C                     MOVE *BLANK    TRST                            CGL007
     C                     SELEC                                          CGL007
     C           WACEVC    WHEQ 'P'                                       CGL007
     C           WACEVC    OREQ 'C'                                       CGL007
     C           WACEVC    OREQ 'M'                                       CGL007
     C           WACEVC    OREQ 'H'                                       CGL007
     C           WACEVC    OREQ 'R'                                       CGL007
     C                     MOVE 'PS'      TRST                            CGL007
     C           WACEVC    WHEQ 'T'                                       CGL007
     C           WACEVC    OREQ 'V'                                       CGL007
     C           WACEVC    OREQ 'S'                                       CGL007
     C           TRFR      ANDNE0                                         CGL007
     C           WACTRT    IFEQ 'P'                                       CGL007
     C           WACTRT    OREQ 'S'                                       CGL007
     C                     MOVE 'SE'      TRST                            CGL007
     C                     ENDIF                                          CGL007
     C           WACEVC    WHEQ 'L'                                       CGL007
     C                     MOVE 'DM'      TRST                            CGL007
     C                     ENDSL                                          CGL007
     C                     ENDIF                                          CGL007
     C/COPY WNCPYSRC,SE2450C002
     C*
     C*  WRITE MIDAS ACCOUNT CODES FILE LF/GEST
     C*
     C                     MOVE 'P'       RECI
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,SE2450C031
     C*
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB002
     C/COPY WNCPYSRC,SEH00225
     C*                                                                   CPB002
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVELACKY      ACKEY                                               CGL020
     C                     MOVE F1FFLG    FEEFLG                                              CGL020
     C                     MOVE F1FPCT    FEEPCT                                              CGL020
     C                     MOVE F1FVAL    FEEVAL                                              CGL020
      *                                                                                       CGL020
     C           ATYP      IFEQ 'R'                                                           CGL020
     C           ATYP      OREQ 'N'                                                           CGL020
     C                     MOVELF1RACT    RORACT                                              CGL020
     C                     MOVELF1RCTY    RORCTY                                              CGL020
     C                     MOVELF1RBNK    RORBNK                                              CGL020
     C                     MOVELF1RCDE    RORCDE                                              CGL020
     C                     MOVELF1PACT    PORACT                                              CGL020
     C                     MOVELF1PCTY    PORCTY                                              CGL020
     C                     MOVELF1PBNK    PORBNK                                              CGL020
     C                     MOVELF1PCDE    PORCDE                                              CGL020
     C                     MOVELF1DACT    DSTACT                                              CGL020
     C                     MOVELF1DCTY    DSTCTY                                              CGL020
     C                     MOVELF1DBNK    DSTBNK                                              CGL020
     C                     Z-ADDF1SDAT    SETDAT                                              CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE *BLANKS   RORACT                                              CGL020
     C                     MOVE *BLANKS   RORCTY                                              CGL020
     C                     MOVE *BLANKS   RORBNK                                              CGL020
     C                     MOVE *BLANKS   RORCDE                                              CGL020
     C                     MOVE *BLANKS   PORACT                                              CGL020
     C                     MOVE *BLANKS   PORCTY                                              CGL020
     C                     MOVE *BLANKS   PORBNK                                              CGL020
     C                     MOVE *BLANKS   PORCDE                                              CGL020
     C                     MOVE *BLANKS   DSTACT                                              CGL020
     C                     MOVE *BLANKS   DSTCTY                                              CGL020
     C                     MOVE *BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD0         SETDAT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVELF1TICK    TICKER                                              CGL020
     C                     MOVELF1EXCH    EXCHNG                                              CGL020
     C                     MOVELF1NOML    NOMINL                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     WRITEGESTPDF
     C/COPY WNCPYSRC,SE2450C054
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C013
     C*
     C*  KEEP COUNT OF RECORDS WRITTEN TO LF/GEST AND HASH TOTAL
     C*
     C                     ADD  1         W02CNT  50
     C*
     C**  EXECUTE HASH TOTALLING SUBROUTINE (Z=1) FOR SECOND
     C*   ARRAY ELEMENTS (INT,S DEC,S) SO S=2 ,ACCUMULATING ZZAMT(15/3)
     C*
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
     C           PSTA      DIV  1000      ZZAMT
     C                     EXSR ZHASH
     C*
     C*  STORE AMOUNT POSTED PER CURRENCY IN BALCCY DATA STRUCTURE
     C*
     C           DRCR      IFEQ 0
     C                     ADD  PSTA      DRTOT
     C                     ELSE
     C                     ADD  PSTA      CRTOT
     C                     END
     C*                                                                   E17026
     C           SKPPRF    TAG                                            E17026
     C*                                                                   E17026
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*    NARRAT SR. - TO SET UP THE NARRATIVE FIELD                 *
     C*                 CALLED FROM - BLD01                           *
     C*                 CALLS       - TABCHN, CLTCHN                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           NARRAT    BEGSR                           *** NARRAT ***
      *
     C           CGL031    IFEQ 'Y'                                                           234004
     C           WACAMC    ANDEQ'ET'                                                          234004
     C           NC,I      ANDEQ'01'                                                          234004
     C           TRFR      ANDNE*ZEROS                                                        234004
     C                     MOVEL'44'      NC,I                                                234004
     C                     ENDIF                                                              234004
     C*
     C           SUSPEN    CABEQ'Y'       NARR09
     C*                                                                   E14537
     C           ACCRLK    CABEQ'Y'       NARR11                          E14537
     C*
     C*    ACCESS S/TABLE, TP FOR NARRATIVE FOR NON-SUSPENSE POSTING
     C*
     C                     MOVE BLK012    ZTABKY
     C                     MOVEL'90'      ZTABKY
     C                     MOVE NC,I      ZTABKY
     C                     EXSR TABCHN
     C*
     C                     MOVEABLK030    NAR
     C                     MOVEANARDTP    NAR
     C*                                                                   S01522
     C                     MOVE *ZEROS    ##MGID                          S01522
     C                     MOVE NC,I      ##WK4   4                       S01522
     C                     MOVEL##WK4     ##MGID                          S01522
     C                     MOVEL'GB'      ##MGID                          S01522
     C/COPY WNCPYSRC,SE2450C074
     C*
     C           NC,I      CABNE'01'      NARR01                          E23097
     C***********NC,I******CABNE01        NARR01                          E23097
     C*
     C*    NARRATIVE CODE 01 - USE SECURITY S/NAME & COUNTERPARTY REPORT
     C*                        NAME
     C*
     C                     MOVEAXSESH     NAR,1
     C********** XCSTN     IFNE *ZEROS                                                 E13817 CSD027
     C           XCSTN     IFNE *BLANKS                                                       CSD027
     C                     EXSR CLTCHN
     C                     ELSE                                           E13817
     C                     MOVE *BLANKS   CRNM                            E13817
     C                     END                                            E13817
     C                     MOVEACRNM      NAR,11
     C                     GOTO NARR99
     C*
     C           NARR01    TAG                             *** NARR01 ***
     C*
     C           NC,I      CABNE'33'      NARR02                          E23097
     C***********NC,I******CABNE33        NARR02                          E23097
     C*
     C*    NARRATIVE CODE 33 - USE SECURITY S/NAME
     C*
     C                     MOVEAXSESH     NAR,19
     C                     GOTO NARR99
     C*
     C           NARR02    TAG                             *** NARR02 ***
     C*
     C           NC,I      CABNE'44'      NARR03                       E23097
     C***********NC,I******CABNE44********NARR03                       E23097
     C*
     C*    NARRATIVE CODE 44 - USE SECURITY S/NAME & TRADE REFERENCE
     C*
     C                     MOVEABLK030    NAR                             099390
     C                     MOVEAXSESH     NAR,1
     C                     MOVE XTRFR     CHAR06  6
     C                     MOVEACHAR06    NAR,14
     C                     GOTO NARR99
     C*
     C           NARR03    TAG                             *** NARR03 ***
     C*
     C           NC,I      CABNE'45'      NARR04                          E23097
     C***********NC,I******CABNE45********NARR04                          E23097
     C*
     C*    NARRATIVE CODE 45 - USE SECURITY S/NAME
     C*
     C                     MOVEAXSESH     NAR,13
     C                     GOTO NARR99
     C*
     C           NARR04    TAG                             *** NARR04 ***
     C*
     C           NC,I      CABNE'46'      NARR05                          E23097
     C***********NC,I******CABNE46********NARR05                          E23097
     C*
     C*    NARRATIVE CODE 46 - USE SECURITY S/NAME
     C*
     C                     MOVEAXSESH     NAR,11
     C                     GOTO NARR99
     C*
     C           NARR05    TAG                             *** NARR05 ***
     C*
     C           NC,I      CABNE'47'      NARR06                          E23097
     C***********NC,I******CABNE47********NARR06                          E23097
     C*
     C*    NARRATIVE CODE 47 - USE TRADE REFERENCE & SECURITY S/NAME
     C*
     C                     MOVE XTRFR     CHAR06
     C                     MOVEACHAR06    NAR,1
     C                     MOVEAXSESH     NAR,21
     C/COPY WNCPYSRC,SE2450C100
     C                     GOTO NARR99
     C*
     C           NARR06    TAG                             *** NARR06 ***
     C*
     C           NC,I      CABNE'48'      NARR07                          E23097
     C***********NC,I******CABNE48********NARR07                          E23097
     C*
     C*    NARRATIVE CODE 48 - USE TRADE REFERENCE & CUSTOMER NO.
     C* NOTE - USE CUSTOMER OF TRADE, NOT CUSTOMER OF SETTLEMENT ACCOUNT  E22959
     C*
     C                     MOVE XTRFR     CHAR06
     C                     MOVEACHAR06    NAR,1
     C*********************MOVE*CNUM      CHAR06                          E22959
     C                     MOVE XCSTN     CHAR06                          E22959
     C                     MOVEACHAR06    NAR,22
     C                     GOTO NARR99
     C*
     C           NARR07    TAG                             *** NARR07 ***
     C           NC,I      CABNE'49'      NARR08                          E23097
     C***********NC,I******CABNE49********NARR08                          E23097
     C*
     C*    NARRATIVE CODE 49 - USE TRADE REFERENCE & SECURITY S/NAME
     C*
     C                     MOVE XTRFR     CHAR06
     C                     MOVEACHAR06    NAR,1
     C                     MOVEAXSESH     NAR,20
     C                     GOTO NARR99
     C*
     C           NARR08    TAG                             *** NARR08 ***
     C           NC,I      CABNE'50'      NARR99                          E23097
     C***********NC,I******CABNE50********NARR99                          E23097
     C*
     C*    NARRATIVE CODE 50 - USE SECURITY S/NAME
     C*
     C                     MOVEAXSESH     NAR,17
     C                     GOTO NARR99
     C/COPY WNCPYSRC,SE2450C075
     C*
     C           NARR09    TAG                             *** NARR09 ***
     C*
     C*    NARRATIVE FOR SUSPENSE POSTING
     C*
     C                     MOVEABLK030    NAR
     C*
     C*    DETERMINE EVENT TYPE
     C*
     C           WACEVC    IFEQ 'T'
     C/COPY WNCPYSRC,SE2450C003
     C           WACEVC    OREQ 'V'
     C           WACEVC    OREQ 'S'
     C*
     C*     EVENT TYPE 'TRADE'
     C*
     C**********           MOVEA'SUS '    NAR,1                                               CGL029
     C**********           MOVEASHBACC    NAR,5                                               CGL029
     C**********           MOVE XTRFR     CHAR06                                              CGL029
     C**********           MOVEACHAR06    NAR,21                                              CGL029
     C**********           MOVEA' '       NAR,27                                              CGL029
     C                     MOVEA'SUS'     NAR,1                                               CGL029
     C                     MOVEASHBACC    NAR,4                                               CGL029
     C                     MOVE XTRFR     CHAR06                                              CGL029
     C                     MOVEACHAR06    NAR,25                                              CGL029
      *                                                                                       CGL029
     C           WACEVC    IFEQ 'T'
     C/COPY WNCPYSRC,SE2450C004
     C                     MOVEA'TRD'     NAR,28
     C                     MOVEL'TRD'     ##FFIN                          S01522
     C                     END
     C           WACEVC    IFEQ 'V'
     C                     MOVEA'VAL'     NAR,28
     C                     MOVEL'VAL'     ##FFIN                          S01522
     C                     END
     C           WACEVC    IFEQ 'S'
     C                     MOVEA'SET'     NAR,28
     C                     MOVEL'SET'     ##FFIN                          S01522
     C                     END
     C                     MOVE 'GB00032' ##MGID                          S01522
     C                     GOTO NARR99
     C                     END
     C*
     C           NARR10    TAG                             *** NARR10 ***
     C*
     C*     EVENT TYPE 'SECURITY'
     C*
     C                     MOVEA'SUS'     NAR,1
     C                     MOVEASHBACC    NAR,4
     C                     MOVEAXSESH     NAR,19
     C                     MOVEA' '       NAR,29
     C                     MOVEAWACEVC    NAR,30
     C                     MOVELWACEVC    ##FFIN                          S01522
     C                     MOVE 'GB00031' ##MGID                          S01522
     C                     GOTO NARR99                                    E14537
     C*                                                                   E14537
     C           NARR11    TAG                             *** NARR11 *** E14537
     C*                                                                   E14537
     C*     ACCRUAL KEY SUMMARY NARRATIVE                                 E14537
     C*                                                                   E14537
     C                     MOVEAMESS,2    NAR                             E14537
     C                     MOVE 'GB00020' ##MGID                          S01522
     C*                                                                   E14537
     C           NARR99    TAG                             *** NARR99 ***
     C/COPY WNCPYSRC,SE2450C012
     C*
     C                     MOVEANAR       PNAR
     C/COPY WNCPYSRC,SE2450C093
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C********************************************************************109024
     C*                                                                   109024
     C* PRTALL   - PRINT DETAIL FOR GEN.ACC.KEY WITH GEN. ENTRIES     R   109024
     C*                                                                   109024
     C           PRTALL    BEGSR                           ** PRTALL **   109024
     C*          *****                                                    109024
     C*                                                                   243764
     C           THBRHA    IFNE LSBRHA                                    243764
     C*                                                                   243764
     C** IF CHANGE IN BRANCH THEN CLOSE AND OPEN P3 PRINTER FILE          243764
     C*                                                                   243764
     C           *IN34     IFEQ '1'                                       243764
     C                     WRITETRAILP3                                   243764
     C                     CLOSESE2450P3                                  243764
     C                     END                                            243764
     C                     OPEN SE2450P3                                  243764
     C                     Z-ADD8         LCNT3                           243764
     C                     Z-ADD0         PAGE                            243764
     C                     SETON                     34                   243764
     C*                                                                   243764
     C** RCF Processing for Detail Printer File.                          243764
     C*                                                                   243764
     C                     EXSR RCFP3                                     243764
      *                                                                   243764
     C                     CALL 'AOBRCHR0'                                243764
     C                     PARM '*MSG   ' @RTCD   7                       243764
     C                     PARM '*KEY   ' @OPTN   7                       243764
     C                     PARM THBRHA    @DSNB   3                       243764
     C           SDBRCH    PARM SDBRCH    DSFDY                           243764
     C*                                                                   243764
     C           @RTCD     IFNE *BLANKS                                   243764
     C                     MOVE '1'       *INLR                           243764
     C           *LOCK     IN   LDA                                       243764
     C                     MOVEL'SDBRCHPD'DBFILE           ***************243764
     C                     MOVEL@DSNB     DBKEY            ** DB ERROR 99 243764
     C                     Z-ADD99        DBASE            ***************243764
     C                     MOVEL@OPTN     DBOPTN  7                       243764
     C                     SETON                       U7U8               243764
     C                     OUT  LDA                                       243764
     C                     DUMP                                           243764
     C                     GOTO DBERR                                     243764
     C                     END                                            243764
     C*                                                                   243764
     C                     MOVELA8BRNM    WPBRCH                          243764
     C                     WRITEHEADP3                                    243764
      *                                                                   243764
     C                     END                                            243764
     C*                                                                   109024
     C*  PRINT DETAIL - CHECK FOR OVERFLOW FIRST                          109024
     C*                                                                   109024
     C           LCNT3     IFGT 56                                        109024
     C                     WRITEHEADP3                                    109024
     C                     Z-ADD8         LCNT3   30                      109024
     C                     END                                            109024
     C                     Z-ADDEVDT      ZDAYNO                          109024
     C                     EXSR ZDATE2                                    109024
     C                     MOVE ZADATE    YEVDT                           109024
     C***                                                                 109024
     C*** TRADE TYPE FROM 5TH BYTE OF SETTLEMENT ACCOUNT XSTLA LF/SEKEY   109024
     C***                                                                 109024
     C***********          MOVE XACKY     WACKY                     109024179804
     C                     MOVE ACKY      WACKY                           179804
     C                     MOVE '  '      WTRTYP                          109024
     C           WACEVC    IFEQ 'T'                                       109024
     C           WACEVC    OREQ 'V'                                       109024
     C           WACEVC    OREQ 'S'                                       109024
     C***        W1        IFEQ 'P'                                       109024
     C           WACTRT    IFEQ 'P'                                       109024
     C                     MOVE 'TP'      WTRTYP                          109024
     C                     ELSE                                           109024
     C           WACTRT    IFEQ 'S'                                       109024
     C                     MOVE 'TS'      WTRTYP                          109024
     C                     END                                            109024
     C                     END                                            109024
     C                     END                                            109024
     C*                                                                   109024
     C**  EDIT NOMINAL USING ZSEDIT                                       109024
     C*                                                                   109024
     C                     Z-ADDEVAM      ZFLD15                          109024
     C*                                                                   109024
     C                     Z-ADD1         A       30                      109024
     C***********XEVCY     LOKUPCCYA,A                   62         109024179804
     C           EVCY      LOKUPCCYA,A                   62               179804
     C           *IN62     IFEQ '1'                                       109024
     C                     MOVE CCYDT,A   CCYDET                          109024
     C                     Z-ADDXDECP     ZDECS                           109024
     C                     ELSE                                           109024
     C                     Z-ADD0         ZDECS                           109024
     C                     END                                            109024
     C*                                                                   109024
     C                     MOVE 'J'       ZECODE                          109024
     C                     EXSR ZSEDIT                                    109024
     C                     MOVE ZOUT21    EDEVAM                          109024
     C*                                                                   109024
     C                     Z-ADDTRFR      WTRREF                          109024
     C*                                                                   109024
     C**  Check if Account Key is missing or not                          109024
     C*                                                                   109024
     C           ACKY      CHAINSEACKD               79                   109024
     C           *IN79     IFEQ '1'                                       109024
     C           RECI      ORNE 'D'                                       109024
     C                     MOVE 'Y'       SMISS                           109024
     C                     ELSE                                           109024
     C                     MOVE 'N'       SMISS                           109024
     C                     END                                            109024
     C*                                                                   109024
     C                     WRITEDETLP23                                   109024
     C                     ADD  3         LCNT3                           109024
     C/COPY WNCPYSRC,SE2450C098
     C                     ENDSR                                          109024
     C********************************************************************109024
      /EJECT                                                              109024
     C********************************************************************109024
     C*                                                                   109024
     C* PRTALL   - PRINT DETAIL  GEN. ENTRIES                             109024
     C*                                                                   109024
     C           PRTALD    BEGSR                           ** PRTALD **   109024
     C*          *****                                                    109024
     C/COPY WNCPYSRC,SE2450C070
     C*                                                                   109024
     C*  PRINT DETAIL - CHECK FOR OVERFLOW FIRST                          109024
     C*                                                                   109024
     C           LCNT3     IFGT 56                                        109024
     C                     WRITEHEADP3                                    109024
     C                     Z-ADD8         LCNT3   30                      109024
     C                     END                                            109024
     C                     Z-ADDPSTD      ZDAYNO                          109024
     C                     EXSR ZDATE2                                    109024
     C                     MOVE ZADATE    PPSTD                           109024
     C                     Z-ADDVALD      ZDAYNO                          109024
     C                     EXSR ZDATE2                                    109024
     C                     MOVE ZADATE    PVALD                           109024
      *                                                                   109024
     C           DRCR      IFEQ 1                                         109024
     C                     MOVE 'CR'      PDRCR                           109024
     C                     ELSE                                           109024
     C                     MOVE 'DR'      PDRCR                           109024
     C                     END                                            109024
     C*                                                                   109024
     C**  EDIT NOMINAL USING ZSEDIT                                       109024
     C********R FACE VALUE KEY - EDIT WITH NOMINAL DEC PLACES             109024
     C*                                                                   109024
     C                     Z-ADDPSTA      ZFLD15                          109024
     C*                                                                   109024
     C                     Z-ADD1         A       30                      109024
     C           CCY       LOKUPCCYA,A                   62               109024
     C           *IN62     IFEQ '1'                                       109024
     C                     MOVE CCYDT,A   CCYDET                          109024
     C                     Z-ADDXDECP     ZDECS                           109024
     C                     ELSE                                           109024
     C                     Z-ADD0         ZDECS                           109024
     C                     END                                            109024
     C*                                                                   109024
     C                     MOVE 'J'       ZECODE                          109024
     C                     EXSR ZSEDIT                                    109024
     C                     MOVE ZOUT21    PPSTA                           109024
     C*                                                                   109024
     C*                                                                   109024
     C                     WRITEDETLP33                                   109024
     C                     ADD  1         LCNT3                           109024
     C/COPY WNCPYSRC,SE2450C099
     C                     ENDSR                                          109024
     C********************************************************************109024
      /EJECT                                                              109024
     C*****************************************************************
     C*                                                               *
     C* PRTM - PRINT DETAIL FOR GEN.ACC.KEY WITH NO MATCHING MASTER   *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRTM      BEGSR                           ** PRTM   **
     C*
     C*  PRINT DETAIL - CHECK FOR OVERFLOW FIRST
     C*
     C           LCNT1     IFGT 50
     C           DETL1     OREQ 'N'                                       E34388
     C                     WRITEHEADP1
     C                     Z-ADD8         LCNT1   30
     C                     MOVEL'Y'       DETL1                           E34388
     C                     END
     C                     Z-ADDXEVDT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WEVDT
     C**********           MOVE XSTLA     W8      8                       E13817
     C**********           MOVELW8        W1      1                       E13817
     C***                                                                 E13817
     C*** TRADE TYPE FROM 5TH BYTE OF SETTLEMENT ACCOUNT XSTLA LF/SEKEY   E13817
     C***                                                                 E13817
     C                     MOVE XACKY     WACKY
     C                     MOVE '  '      WTRTYP
     C           BGPFMG    IFEQ 'Y'                                       046386
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE '  '      WTRTY2                          046386
     C                     END                                            046386
     C           WACEVC    IFEQ 'T'
     C/COPY WNCPYSRC,SE2450C005
     C           WACEVC    OREQ 'V'
     C           WACEVC    OREQ 'S'
     C********** W1        IFEQ 'P'                                       E13817
     C           WACTRT    IFEQ 'P'                                       E13817
     C                     MOVE 'TP'      WTRTYP
     C           BGPFMG    IFEQ 'Y'                                       046386
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE 'TP'      WTRTY2                          046386
     C                     END                                            046386
     C                     ELSE
     C********** W1        IFEQ 'S'                                       E13817
     C           WACTRT    IFEQ 'S'                                       E13817
     C                     MOVE 'TS'      WTRTYP
     C           BGPFMG    IFEQ 'Y'                                       046386
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE 'TS'      WTRTY2                          046386
     C                     END                                            046386
     C                     END
     C                     END
     C                     END
     C*
     C**  EDIT NOMINAL USING ZSEDIT
     C********R*FACE*VALUE*KEY*-*EDIT*WITH*NOMINAL*DEC*PLACES*****        E13817
     C*
     C                     Z-ADDEVAM      ZFLD15
     C*
     C********** WACAMC    IFNE 'FV'                                      E13817
     C*
     C                     Z-ADD1         A       30
     C           XEVCY     LOKUPCCYA,A                   62
     C           *IN62     IFEQ '1'
     C                     MOVE CCYDT,A   CCYDET
     C                     Z-ADDXDECP     ZDECS
     C                     ELSE
     C                     Z-ADD0         ZDECS
     C                     END
     C*
     C**********           ELSE                                           E13817
     C***********                                                         E13817
     C********** SESH      CHAINSECTY                62                   E13817
     C********** *IN62     IFEQ '0'                                       E13817
     C**********           Z-ADDNMDP      ZDECS                           E13817
     C**********           ELSE                                           E13817
     C**********           Z-ADD0         ZDECS                           E13817
     C**********           END                                            E13817
     C***********                                                         E13817
     C**********           END                                            E13817
     C*
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    EDEVAM
     C*
     C                     Z-ADDTRFR      WTRREF
     C*
     C                     WRITEDETLP1
     C                     ADD  1         LCNT1
     C*
     C* SET EXTERNAL SWITCH U4 ON FOR MISSING ACCOUNT KEY
     C*
     C                     MOVE '1'       *INU4
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRTA     - PRINT DETAIL FOR SUMMARY ACCRUALS                  *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRTA      BEGSR                           ** PRTA   **
     C*
     C*  PRINT DETAIL - CHECK FOR OVERFLOW FIRST
     C*
     C***********LCNT2     IFGT 58                                        E18666
     C           LCNT2     IFGT 54                                        E18666
     C           DETL2     OREQ 'N'                                       E34388
     C                     WRITEHEADP2
     C***********          Z-ADD8         LCNT2   30                      E18666
     C                     Z-ADD10        LCNT2   30                      E18666
     C                     MOVEL'Y'       DETL2                           E34388
     C                     END
     C*
     C**  EDIT NOMINAL USING ZSEDIT
     C*
     C                     Z-ADDEVAM      ZFLD15
     C                     Z-ADD1         A       30
     C           XEVCY     LOKUPCCYA,A                   62
     C           *IN62     IFEQ '1'
     C                     MOVE CCYDT,A   CCYDET
     C                     Z-ADDXDECP     ZDECS
     C                     ELSE
     C                     Z-ADD0         ZDECS
     C                     END
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    EDEVAM
     C                     WRITEDETLP2
     C                     ADD  2         LCNT2
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRTA1    - PRINT SUMMARY SUB TOTAL FOR ACCRUALS               *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRTA1     BEGSR                           ** PRTA1  **
     C           DETL2     IFEQ 'Y'                                       E34388
     C*
     C*  PRINT DETAIL - CHECK FOR OVERFLOW FIRST
     C*
     C           LCNT2     IFGT 58
     C                     WRITEHEADP2
     C                     Z-ADD8         LCNT2   30
     C                     END
     C*
     C**  EDIT NOMINAL USING ZSEDIT
     C*
     C                     Z-ADDWAEVAM    ZFLD15
     C                     Z-ADD1         A       30
     C           XEVCY     LOKUPCCYA,A                   62
     C           *IN62     IFEQ '1'
     C                     MOVE CCYDT,A   CCYDET
     C                     Z-ADDXDECP     ZDECS
     C                     ELSE
     C                     Z-ADD0         ZDECS
     C                     END
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WDEVAM
     C                     WRITEDETLP3
     C                     WRITEDETLP4
     C                     WRITEDETLP3
     C                     ADD  4         LCNT2
     C*
     C                     END                                            E34388
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* MULTIB   - GENERATE POSTINGS ACROSS BRANCHES FOR MULTIBRANCH  *
     C*                                                               *
     C*****************************************************************
     C*
     C           MULTIB    BEGSR                           ** MULTIB **
     C/COPY WNCPYSRC,SEH00226
     C*
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVELACKY      ACKEY                                               CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   FEEFLG                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   RORACT                                              CGL020
     C                     MOVE *BLANKS   RORCTY                                              CGL020
     C                     MOVE *BLANKS   RORBNK                                              CGL020
     C                     MOVE *BLANKS   RORCDE                                              CGL020
     C                     MOVE *BLANKS   PORACT                                              CGL020
     C                     MOVE *BLANKS   PORCTY                                              CGL020
     C                     MOVE *BLANKS   PORBNK                                              CGL020
     C                     MOVE *BLANKS   PORCDE                                              CGL020
     C                     MOVE *BLANKS   DSTACT                                              CGL020
     C                     MOVE *BLANKS   DSTCTY                                              CGL020
     C                     MOVE *BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD0         SETDAT                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   TICKER                                              CGL020
     C                     MOVE *BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD0         NOMINL                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C****BRANCH*INTERNAL HEAD OFFICE ACCOUNT                             S01117
     C***********                                                         S01117
     C***BRANCH*CODE - FROM LF/ACCNT IS BRCDAC                            S01117
     C***********                                                         S01117
     C***********          MOVE BRCDAC    BRCD                            S01117
     C***********          MOVE BRCAAC    BRCA                            S01117
     C***********                                                         S01117
     C**CUSTOMER*NUMBER FROM BRANCH OF ACCOUNT KEY TO TABLE -  TR         S01117
     C***********                                                         S01117
     C***********          MOVE BLK012    ZTABKY                          S01117
     C***********          MOVEL'10'      ZTABKY                          S01117
     C***********          MOVE BRCDAC    ZTABKY                          S01117
     C***********          MOVE BRCAAC    ZTABKY                          S01117
     C***********          EXSR TABCHN                                    S01117
     C*                                                                   S01117
     C** Interbranch accounting in this instance is:-                     ##1117
     C** Dr/cr booking branch account in settlement branch; and           S01117
     C** cr/dr settlement branch account in booking branch.               S01117
     C*                Posting 1             Posting 2                    S01117
     C*  Branch        Settlement            Booking                      S01117
     C*  Customer      Booking Brch          Settlement Brch              S01117
     C*  Currency      Event Currency        Event Currency               S01117
     C*  A/c Code (Cr) Sett Brch Due From    Book Brch Due To             S01117
     C*  A/c Code (Dr) Sett Brch Due To      Book Brch Due From           S01117
     C*  A/c Sequence  01                    01                           S01117
     C*  Dr/cr    (Dr) Cr  (1)               Dr  (0)                      S01117
     C*  Dr/cr    (Cr) Dr  (0)               Cr  (1)                      S01117
     C*                                                                   S01117
     C** Obtain Settlement Branch details                                 S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG'    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C***********          PARM SEBR      @DSNB   3                 S01117E33011
     C                     PARM KBRCA     @DSNB   3                       E33011
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *INLR                           S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
     C                     MOVEL@DSNB     DBKEY            ** DB ERROR 13 S01117
     C                     Z-ADD13        DBASE            ***************S01117
     C                     MOVEL@OPTN     DBOPTN  7                       S01117
     C                     SETON                       U7U8               S01117
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C***********          Z-ADDBICN      CNUM                            S01117
     C***********          MOVE SEBR      BRCA                      S01117E33011
     C                     MOVE KBRCA     BRCA                            E33011
     C***********          MOVELA8BICN    CNUM                     S01117 054106
     C                     MOVEL@@BKCS    CNUM                            054106
     C                     MOVELA8BICN    @@SECS                          S01117
     C                     MOVELA8DTAC    @@SEAT                          S01117
     C                     MOVELA8DFAC    @@SEAF                          S01117
     C*                                                                   S01117
     C**  Produce Settlement branch to Booking branch posting             S01117
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C**************                                                      S01117
     C***ACCOUNT*CODE FROM BRANCH OF SECURITY                             S01117
     C**************                                                      S01117
     C**************       MOVE XBACH     ACOD                            S01117
     C*
     C***ACOUNT*TYPE*AND*RETAIL*INDICATOR*DETERMINED*IN*ACDCHN********    E37193
     C***********                                                         E37193
     C***********          EXSR ACDCHN                                    E37193
     C*
     C*  SEQUENCE NUMBER
     C*
     C**********           Z-ADDSACS      ACSQ                            E18803
     C                     Z-ADD01        ACSQ                            E18803
     C*
     C*  GENERATE REMAINING FIELDS IN PRFAL1
     C*
     C                     EXSR PRFAL1
     C*
     C* REVERSE DEBIT CREDIT INDICATOR
     C*
     C           DRCR      IFEQ 0
     C                     MOVEL@@SEAT    ACOD                            S01117
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     MOVEL@@SEAF    ACOD                            S01117
     C                     Z-ADD0         DRCR
     C                     END
     C*                                                                   E37193
     C*  ACCOUNT TYPE AND RETAIL INDICATOR DETERMINED IN ACDCHN           E37193
     C*                                                                   E37193
     C                     EXSR ACDCHN                                    E37193
     C*
     C* WRITE GENERATED MIDAS ACCOUNT KEYS FILE LF/GEST
     C*
     C                     MOVE 'P'       RECI
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   CAC002
     C** If Analytical Accounting is installed, use the Primary Funding   CAC002
     C** profit centre for inter-branch entry posting.                    CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE WWPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C/COPY WNCPYSRC,SE2450C032
     C*
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB002
     C*                                                                   CPB002
     C                     WRITEGESTPDF
     C/COPY WNCPYSRC,SE2450C055
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C014
     C*
     C*  KEEP COUNT OF RECORDS WRITTEN TO LF/GEST AND HASH TOTAL
     C*
     C                     ADD  1         W02CNT  50
     C*
     C**  EXECUTE HASH TOTALLING SUBROUTINE (Z=2) FOR SECOND
     C*   ARRAY ELEMENTS (INT,S DEC,S) SO S=2 ,ACCUMULATING ZZAMT(15/3)
     C*
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
     C           PSTA      DIV  1000      ZZAMT
     C                     EXSR ZHASH
     C*
     C*  STORE AMOUNT POSTED PER CURRENCY IN BALCCY DATA STRUCTURE
     C*
     C           DRCR      IFEQ 0
     C                     ADD  PSTA      DRTOT
     C                     ELSE
     C                     ADD  PSTA      CRTOT
     C                     END
     C/COPY WNCPYSRC,SE2450C033
     C*                                                                   S01117
     C**  Produce Booking branch to Settlement branch posting             S01117
     C*
     C*
     C*  BRANCH IS A/C KEY BRANCH
     C*
     C***********          MOVE XBRCH     BRCD                            S01117
     C                     MOVE XBRHA     BRCA                            S01117
     C*
     C*  CUSTOMER IS BRANCH INTERNAL CUSTOMER NUMBER OF A/C KEY BRANCH
     C*  Bookin Branch                                                    S01117
     C*
     C***********          Z-ADDXBICN     CNUM                            S01117
     C***********          MOVEL@@BKCS    CNUM                     S01117 054106
     C                     MOVEL@@SECS    CNUM                            054106
     C*                                                                   102927
     C*  CLEAR ASSOCIATED CLIENT                                          102927
     C**********           Z-ADD0         ASOC                                         102927 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C*
     C*  CURRENCY CODE
     C                     MOVE XEVCY     CCY
     C************                                                        S01117
     C***ACCOUNT*CODE                                                     S01117
     C************         MOVE XBACB     ACOD                            S01117
     C*
     C***ACCOUNT*TYPE*AND*RETAIL*INDICATOR*DETERMINED*IN*ACDCHN***********E37193
     C***********                                                         E37193
     C***********          EXSR ACDCHN                                    E37193
     C*
     C*  SEQUENCE NUMBER
     C*
     C**********           Z-ADDXSACS     ACSQ                            E18803
     C                     Z-ADD01        ACSQ                            E18803
     C*
     C*  GENERATE REMAINING FIELDS AND WRITE LF/GEST RECORD IN PRFALL
     C*
     C                     EXSR PRFAL1
     C*                                                                   S01117
     C** Determine if Due to/Due from account code                        S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     MOVEL@@BKAT    ACOD                            S01117
     C                     ELSE                                           S01117
     C                     MOVEL@@BKAF    ACOD                            S01117
     C                     END                                            S01117
     C*                                                                   E37193
     C*  ACCOUNT TYPE AND RETAIL INDICATOR DETERMINED IN ACDCHN           E37193
     C*                                                                   E37193
     C                     EXSR ACDCHN                                    E37193
     C*
     C* WRITE GENERATED MIDAS ACCOUNT KEYS FILE LF/GEST
     C*
     C                     MOVE 'P'       RECI
     C*
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,SE2450C034
     C*                                                                   S01522
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB002
     C*                                                                   CPB002
     C                     WRITEGESTPDF
     C/COPY WNCPYSRC,SE2450C056
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C015
     C*
     C*  KEEP COUNT OF RECORDS WRITTEN TO LF/GEST AND HASH TOTAL
     C*
     C                     ADD  1         W02CNT  50
     C*
     C**  EXECUTE HASH TOTALLING SUBROUTINE (Z=1) FOR SECOND
     C*   ARRAY ELEMENTS (INT,S DEC,S) SO S=2, ACCUMULATING ZZAMT(15/3)
     C*
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
     C           PSTA      DIV  1000      ZZAMT
     C                     EXSR ZHASH
     C*
     C*  STORE AMOUNT POSTED PER CURRENCY IN BALCCY DATA STRUCTURE
     C*
     C           DRCR      IFEQ 0
     C                     ADD  PSTA      DRTOT
     C                     ELSE
     C                     ADD  PSTA      CRTOT
     C                     END
     C/COPY WNCPYSRC,SE2450C035
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* MULTMB    - Generate Interbranch postings where interbranch   *
     C*             accounting is through a main branch               *
     C* Called By - SR.BLD01 Build output account entries             *
     C* Calls     - SR.                                               *
     C*                                                               *
     C*****************************************************************
     C*
     C           MULTMB    BEGSR                           ** MULTMB **
     C/COPY WNCPYSRC,SEH00227
     C*
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVELACKY      ACKEY                                               CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   FEEFLG                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   RORACT                                              CGL020
     C                     MOVE *BLANKS   RORCTY                                              CGL020
     C                     MOVE *BLANKS   RORBNK                                              CGL020
     C                     MOVE *BLANKS   RORCDE                                              CGL020
     C                     MOVE *BLANKS   PORACT                                              CGL020
     C                     MOVE *BLANKS   PORCTY                                              CGL020
     C                     MOVE *BLANKS   PORBNK                                              CGL020
     C                     MOVE *BLANKS   PORCDE                                              CGL020
     C                     MOVE *BLANKS   DSTACT                                              CGL020
     C                     MOVE *BLANKS   DSTCTY                                              CGL020
     C                     MOVE *BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD0         SETDAT                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   TICKER                                              CGL020
     C                     MOVE *BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD0         NOMINL                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   S01117
     C** Interbranch accounting is through a main branch and interbranch  ##1117
     C** postings generated are:-                                         ##1117
     C** dr/cr booking branch account in main branch;                     S01117
     C** cr/dr main branch account in booking brnahc;                     S01117
     C** dr/cr main branch account in settlement branch;                  S01117
     C** cr/dr settlement branch account in main branch.                  S01117
     C*                Posting 1   Posting 2   Posting 2   Posting 4      S01117
     C*  Branch        Sett        Main        Main        Book           S01117
     C*  Customer      Main Brch   Sett Brch   Book Brch   Main Brch      S01117
     C*  Currency      Event Currency          Event Currency             S01117
     C*  A/c Code (Cr) Sett Due Fr Main Due To Main Due Fr Book Due To    S01117
     C*  A/c Code (Dr) Sett Due To Main Due Fr Main Due To Book Due Fr    S01117
     C*  A/c Sequence  01          01          01          01             S01117
     C*  Dr/cr    (Dr) Cr (1)      Dr (0)      Cr (1)      Dr (0)         S01117
     C*  Dr/cr    (Cr) Dr (0)      Cr (1)      Dr (0)      Cr (1)         S01117
     C*                                                                   S01117
     C** Obtain Settlement Branch details                                 S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG'    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C***********          PARM SEBR      @DSNB   3                 S01117E33011
     C                     PARM KBRCA     @DSNB   3                       E33011
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *INLR                           S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
     C                     MOVEL@DSNB     DBKEY            ** DB ERROR 14 S01117
     C                     Z-ADD14        DBASE            ***************S01117
     C                     MOVEL@OPTN     DBOPTN  7                       S01117
     C                     SETON                       U7U8               S01117
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C***********          MOVE SEBR      BRCA                      S01117E33011
     C                     MOVE KBRCA     BRCA                            E33011
     C                     MOVELA8BICN    @@SECS                          S01117
     C                     MOVELA8DTAC    @@SEAT                          S01117
     C                     MOVELA8DFAC    @@SEAF                          S01117
     C*                                                                   S01117
     C*   POSTING 1 of 4                                                  S01117
     C*                                                                   S01117
     C**  Produce Main branch account in Settlement branch                S01117
     C*                                                                   S01117
     C*  Customer                                                         S01117
     C                     MOVEL@@MNCS    CNUM                            S01117
     C*                                                                   S01117
     C*  Currency                                                         S01117
     C                     MOVE XEVCY     CCY                             S01117
     C*                                                                   S01117
     C***Account*type*and*Retail*indicatore*determined*in*SR.ACDCHN*S01117E37193
     C***********                                                  S01117 E37193
     C***********          EXSR ACDCHN                             S01117 E37193
     C*                                                                   S01117
     C*  Sequence                                                         S01117
     C                     Z-ADD01        ACSQ                            S01117
     C*                                                                   S01117
     C*  Generate remaining fields in SR.PRFAL1                           S01117
     C*                                                                   S01117
     C                     EXSR PRFAL1                                    S01117
     C*                                                                   S01117
     C*  Account code and reverse drcr indicator                          S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 0                                         S01117
     C*  Debit                                                            S01117
     C                     Z-ADD1         DRCR                            S01117
     C                     MOVEL@@SEAT    ACOD                            S01117
     C                     ELSE                                           S01117
     C*  Credit                                                           S01117
     C                     Z-ADD0         DRCR                            S01117
     C                     MOVEL@@SEAF    ACOD                            S01117
     C                     END                                            S01117
     C*                                                                   E37193
     C*  Account type and Retail indicators determined in SR.ACDCHN       E37193
     C*                                                                   E37193
     C                     EXSR ACDCHN                                    E37193
     C*                                                                   S01117
     C* Write generated account posting to LF/GEST                        S01117
     C*                                                                   S01117
     C                     MOVE 'P'       RECI                            S01117
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   CAC002
     C** If Analytical Accounting is installed, use the Primary Funding   CAC002
     C** profit centre for multi-branch entry posting.                    CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE WWPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C/COPY WNCPYSRC,SE2450C036
     C*                                                                   S01117
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB002
     C*                                                                   CPB002
     C                     WRITEGESTPDF                                   S01117
     C/COPY WNCPYSRC,SE2450C057
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C016
     C*                                                                   S01117
     C*  Increment File control and Hash Total                            S01117
     C*                                                                   S01117
     C                     ADD  1         W02CNT  50                      S01117
     C*                                                                   S01117
     C                     Z-ADD1         Z                               S01117
     C                     Z-ADD2         S                               S01117
     C           PSTA      DIV  1000      ZZAMT                           S01117
     C                     EXSR ZHASH                                     S01117
     C*                                                                   S01117
     C*  STORE AMOUNT POSTED PER CURRENCY IN BALCCY DATA STRUCTURE        S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 0                                         S01117
     C                     ADD  PSTA      DRTOT                           S01117
     C                     ELSE                                           S01117
     C                     ADD  PSTA      CRTOT                           S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE2450C037
     C*                                                                   S01117
     C*   POSTING 2 of 4                                                  S01117
     C*                                                                   S01117
     C**  Produce Settlement branch account in Main branch                S01117
     C*                                                                   S01117
     C*  Main branch                                                      S01117
     C                     MOVE BKMABR    BRCA                            S01117
     C*                                                                   S01117
     C*  Customer                                                         S01117
     C*                                                                   S01117
     C                     MOVEL@@SECS    CNUM                            S01117
     C*                                                                   S01117
     C*  Currency                                                         S01117
     C                     MOVE XEVCY     CCY
     C*                                                                   S01117
     C*  Account type and Retail indicatore determined in SR.ACDCHN       S01117
     C*                                                                   S01117
     C                     EXSR ACDCHN                                    S01117
     C*                                                                   S01117
     C*  Sequence                                                         S01117
     C                     Z-ADD01        ACSQ                            S01117
     C*                                                                   S01117
     C*  Generate remaining fields in SR.PRFAL1                           S01117
     C*                                                                   S01117
     C                     EXSR PRFAL1                                    S01117
     C*                                                                   S01117
     C*  Account code                                                     S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 0                                         S01117
     C*  Debit                                                            S01117
     C                     MOVEL@@MNAF    ACOD                            S01117
     C                     ELSE                                           S01117
     C*  Credit                                                           S01117
     C                     MOVEL@@MNAT    ACOD                            S01117
     C                     END                                            S01117
     C*                                                                   E37193
     C*  Account type and Retail indicators determined in SR.ACDCHN       E37193
     C*                                                                   E37193
     C                     EXSR ACDCHN                                    E37193
     C*                                                                   S01117
     C* Write generated account posting to LF/GEST                        S01117
     C*                                                                   S01117
     C                     MOVE 'P'       RECI                            S01117
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,SE2450C038
     C*                                                                   S01117
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB002
     C*                                                                   CPB002
     C                     WRITEGESTPDF                                   S01117
     C/COPY WNCPYSRC,SE2450C058
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C017
     C*                                                                   S01117
     C*  Increment File control and Hash Total                            S01117
     C*                                                                   S01117
     C                     ADD  1         W02CNT  50                      S01117
     C*                                                                   S01117
     C                     Z-ADD1         Z                               S01117
     C                     Z-ADD2         S                               S01117
     C           PSTA      DIV  1000      ZZAMT                           S01117
     C                     EXSR ZHASH                                     S01117
     C*                                                                   S01117
     C*  STORE AMOUNT POSTED PER CURRENCY IN BALCCY DATA STRUCTURE        S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 0                                         S01117
     C                     ADD  PSTA      DRTOT                           S01117
     C                     ELSE                                           S01117
     C                     ADD  PSTA      CRTOT                           S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE2450C039
     C*                                                                   S01117
     C*   POSTING 3 of 4                                                  S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C**  Produce Booking branch account in Main branch                   S01117
     C*                                                                   S01117
     C*  Main branch                                                      S01117
     C                     MOVE BKMABR    BRCA                            S01117
     C*                                                                   S01117
     C*  Customer                                                         S01117
     C*                                                                   S01117
     C                     MOVEL@@BKCS    CNUM                            S01117
     C*                                                                   S01117
     C*  Currency                                                         S01117
     C                     MOVE XEVCY     CCY
     C*                                                                   S01117
     C*  Account type and Retail indicatore determined in SR.ACDCHN       S01117
     C*                                                                   S01117
     C                     EXSR ACDCHN                                    S01117
     C*                                                                   S01117
     C*  Sequence                                                         S01117
     C                     Z-ADD01        ACSQ                            S01117
     C*                                                                   S01117
     C*  Generate remaining fields in SR.PRFAL1                           S01117
     C*                                                                   S01117
     C                     EXSR PRFAL1                                    S01117
     C*                                                                   S01117
     C*  Account code                                                     S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 0                                         S01117
     C*  Debit                                                            S01117
     C                     Z-ADD1         DRCR                            S01117
     C                     MOVEL@@MNAT    ACOD                            S01117
     C                     ELSE                                           S01117
     C*  Credit                                                           S01117
     C                     Z-ADD0         DRCR                            S01117
     C                     MOVEL@@MNAF    ACOD                            S01117
     C                     END                                            S01117
     C*                                                                   E37193
     C*  Account type and Retail indicators determined in SR.ACDCHN       E37193
     C*                                                                   E37193
     C                     EXSR ACDCHN                                    E37193
     C*                                                                   S01117
     C* Write generated account posting to LF/GEST                        S01117
     C*                                                                   S01117
     C                     MOVE 'P'       RECI                            S01117
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,SE2450C040
     C*                                                                   S01117
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB002
     C*                                                                   CPB002
     C                     WRITEGESTPDF                                   S01117
     C/COPY WNCPYSRC,SE2450C059
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C018
     C*                                                                   S01117
     C*  Increment File control and Hash Total                            S01117
     C*                                                                   S01117
     C                     ADD  1         W02CNT  50                      S01117
     C*                                                                   S01117
     C                     Z-ADD1         Z                               S01117
     C                     Z-ADD2         S                               S01117
     C           PSTA      DIV  1000      ZZAMT                           S01117
     C                     EXSR ZHASH                                     S01117
     C*                                                                   S01117
     C*  STORE AMOUNT POSTED PER CURRENCY IN BALCCY DATA STRUCTURE        S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 0                                         S01117
     C                     ADD  PSTA      DRTOT                           S01117
     C                     ELSE                                           S01117
     C                     ADD  PSTA      CRTOT                           S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE2450C041
     C*   POSTING 4 of 4                                                  S01117
     C*                                                                   S01117
     C**  Produce Main branch account in Booking branch                   S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C*  Booking branch                                                   S01117
     C                     MOVE @@BKBR    BRCA                            S01117
     C*                                                                   S01117
     C*  Customer                                                         S01117
     C                     MOVEL@@MNCS    CNUM                            S01117
     C*                                                                   S01117
     C*  Currency                                                         S01117
     C                     MOVE XEVCY     CCY                             S01117
     C*                                                                   S01117
     C*  Account type and Retail indicatore determined in SR.ACDCHN       S01117
     C*                                                                   S01117
     C                     EXSR ACDCHN                                    S01117
     C*                                                                   S01117
     C*  Sequence                                                         S01117
     C                     Z-ADD01        ACSQ                            S01117
     C*                                                                   S01117
     C*  Generate remaining fields in SR.PRFAL1                           S01117
     C*                                                                   S01117
     C                     EXSR PRFAL1                                    S01117
     C*                                                                   S01117
     C*  Account code and reverse drcr indicator                          S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 0                                         S01117
     C*  Debit                                                            S01117
     C                     MOVEL@@BKAF    ACOD                            S01117
     C                     ELSE                                           S01117
     C*  Credit                                                           S01117
     C                     MOVEL@@BKAT    ACOD                            S01117
     C                     END                                            S01117
     C*                                                                   E37193
     C*  Account type and Retail indicators determined in SR.ACDCHN       E37193
     C*                                                                   E37193
     C                     EXSR ACDCHN                                    E37193
     C*                                                                   S01117
     C* Write generated account posting to LF/GEST                        S01117
     C*                                                                   S01117
     C                     MOVE 'P'       RECI                            S01117
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,SE2450C042
     C*                                                                   S01117
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB002
     C*                                                                   CPB002
     C                     WRITEGESTPDF                                   S01117
     C/COPY WNCPYSRC,SE2450C060
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C019
     C*                                                                   S01117
     C*  Increment File control and Hash Total                            S01117
     C*                                                                   S01117
     C                     ADD  1         W02CNT  50                      S01117
     C*                                                                   S01117
     C                     Z-ADD1         Z                               S01117
     C                     Z-ADD2         S                               S01117
     C           PSTA      DIV  1000      ZZAMT                           S01117
     C                     EXSR ZHASH                                     S01117
     C*                                                                   S01117
     C*  STORE AMOUNT POSTED PER CURRENCY IN BALCCY DATA STRUCTURE        S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 0                                         S01117
     C                     ADD  PSTA      DRTOT                           S01117
     C                     ELSE                                           S01117
     C                     ADD  PSTA      CRTOT                           S01117
     C                     END                                            S01117
     C/COPY WNCPYSRC,SE2450C043
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* PRFAL1   - CREATE OUTPUT LF/GEST RECORD FOR REMAINING FIELDS  *
     C*            COMMON TO ALL POSTING REFERENCE TYPES              *
     C*                                                               *
     C*            CALLED FROM MULTIB ONLY  - THIS ROUTINE IS AS PER  *
     C*              PRFALL BUT WITHOUT THE WRITE TO LF/GEST AS MULTIB*
     C*              DOES THIS AFTER REVERSING THE DR/CR INDICATOR    *
     C*                                                               *
     C*****************************************************************
     C*
     C           PRFAL1    BEGSR                           ** PRFAL1 **
     C*
     C*  GENERATE VALUES INTO ALL REMAINING FIELDS
     C*
     C*  POSTING DATE IS RUN DATE
     C*
     C                     Z-ADDRUND      PSTD
     C*
     C*  VALUE DATE
     C*
     C                     Z-ADDXEVDT     VALD
     C*
     C** NARRATIVE - IS SET UP IN BLD01
     C*
     C** POSTING AMOUNT
     C*
     C                     Z-ADDWAEVAM    PSTA
     C*                                                                   S01182
     C** ASSOCIATED CUSTOMER                                              S01182
     C*                                                                   S01182
     C** This is blank if producing an accrual summary key                E03831
     C           ACCRLK    IFEQ 'Y'                                       E03831
     C**********           Z-ADD*ZEROS    ASOC                                         E03831 CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     ELSE                                           E03831
     C                     MOVELCSTN      ASOC                            S01182
     C                     END                                            E03831
     C*                                                                   053103
     C**  For Position Settlements, store Event Date in OTRF.             053103
     C*                                                                   053103
     C           BGPFMG    IFEQ 'Y'                                       053103
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   053103
     C           WACEVC    IFEQ 'P'                        B1             053103
     C           WACEVC    OREQ 'C'                                       053103
     C           WACEVC    OREQ 'M'                                       053103
     C           WACEVC    OREQ 'H'                                       053103
     C           WACEVC    OREQ 'R'                                       053103
     C                     MOVE XEVDT     WW11   11                       053103
     C                     MOVELWW11      OTRF                            053103
     C                     END                             E1             053103
     C*                                                                   053103
     C                     END                                            053103
     C*                                                                   S01182
     C** ORIGINAL TRANSACTION REFERENCE                                   S01182
     C*                                                                   S01182
     C                     MOVELTRFR      OTRF                            S01182
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           CGL007    IFEQ 'Y'                                       CGL007
     C           WACEVC    IFEQ 'P'                                       CGL007
     C           WACEVC    OREQ 'C'                                       CGL007
     C           WACEVC    OREQ 'M'                                       CGL007
     C           WACEVC    OREQ 'H'                                       CGL007
     C           WACEVC    OREQ 'R'                                       CGL007
     C                     MOVELXPEV1     OTRF                            CGL007
     C                     ENDIF                                          CGL007
     C                     ENDIF                                          CGL007
     C/COPY WNCPYSRC,SE2450C051
     C                     MOVE WWPTFR    OTRF                            S01486
     C                     END                                            S01486
     C*                                                                   S01182
     C** BOOK CODE                                                        S01182
     C                     MOVE WACBKC    BOKC                            S01182
     C*                                                                   S01182
     C** ORIGINAL TRANSACTION TYPE                                        S01182
     C*                                                                   S01182
     C                     MOVELWACITY    OTTP                            S01182
     C           BGPFMG    IFEQ 'Y'                                       046386
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE *BLANKS   WTRTY2                          046386
     C                     END                                            046386
     C*                                                                   S01486
     C**  For Trades, move Transaction Type to OTTP (used in PM1500).     S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WACEVC    IFEQ 'T'                                       S01486
     C           WACEVC    OREQ 'V'                                       S01486
     C           WACEVC    OREQ 'S'                                       S01486
     C*                                                                   S01486
     C           WACTRT    IFEQ 'P'                                       S01486
     C                     MOVE 'TP'      WTRTYP                          S01486
     C                     MOVE 'TP'      WTRTY2                          046386
     C                     END                                            S01486
     C*                                                                   S01486
     C           WACTRT    IFEQ 'S'                                       S01486
     C                     MOVE 'TS'      WTRTYP                          S01486
     C                     MOVE 'TS'      WTRTY2                          046386
     C                     END                                            S01486
     C*                                                                   053103
     C                     ELSE                                           053103
     C                     MOVE XPEV1     WTRTY2                          053103
     C                     END                                            S01486
     C                     MOVE WTRTY2    OTTP                            046386
     C           CGL007    IFEQ 'Y'                                       CGL007
     C                     MOVE PEV1      OTTP                            CGL007
     C                     ENDIF                                          CGL007
     C                     END                                            S01486
     C*                                                                   S01182
     C** ORIGINAL TRANSACTION SUB-TYPE                                    S01182
     C*                                                                   S01182
     C                     MOVELSESH      OTST                            S01182
     C*
     C*  DEBIT CREDIT INDICATOR
     C*
     C*  IF POSITION 1 2 OR 3 SET DRCR TO 1 ELSE 0,STORE OPPOSITE-WDRCR
     C*
     C           I         IFGT 3
     C                     Z-ADD1         DRCR
     C                     Z-ADD0         WDRCR   10
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     Z-ADD1         WDRCR
     C                     END
     C*
     C*  IF REVERSAL INDICATOR IS ON REVERSE BY MOVING IN WDRCR
     C*
     C           XRVRS     IFEQ '1'
     C                     MOVE WDRCR     DRCR
     C                     MOVE '*'       PNAR                            E21237
     C                     MOVE '*'       ##REVI  1                       S01522
     C*
     C** INITIALISE FIELDS FOR MANAGEMENT ACCOUNTING                      S10736
     C*
     C                     Z-ADD1         VOIN                            S10736
     C                     ELSE                                           S10736
     C                     Z-ADD0         VOIN                            S10736
     C                     MOVE *BLANK    ##REVI                          S01522
     C                     END
     C                     Z-ADD235959    PTIM                            S10736
     C*
     C*  IF CREDIT (>3) AND AMOUNT NEGATIVE, REVERSE DEB/CRED IND
     C*
     C           I         IFGT 3
     C           WAEVAM    ANDLT0
     C           DRCR      IFEQ 0
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C                     Z-SUBPSTA      PSTA
     C                     END
     C*
     C*  IF DEBIT  (<4) AND AMOUNT NEGATIVE, REVERSE DEB/CRED IND
     C*
     C           I         IFLT 4
     C           WAEVAM    ANDLT0
     C           DRCR      IFEQ 1
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
     C                     Z-SUBPSTA      PSTA
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*    BAL01  SR. - TO GENERATE BALANCING ENTRIES TO SUSPENSE     *
     C*           ACCOUNT FOR BRANCH/CUURENCY DEBIT/CREDIT INEQUALITY *
     C*                                                               *
     C*****************************************************************
     C*
     C           BAL01     BEGSR                           *** BAL01  ***
     C/COPY WNCPYSRC,SEH00228
     C*
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVELACKY      ACKEY                                               CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   FEEFLG                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   RORACT                                              CGL020
     C                     MOVE *BLANKS   RORCTY                                              CGL020
     C                     MOVE *BLANKS   RORBNK                                              CGL020
     C                     MOVE *BLANKS   RORCDE                                              CGL020
     C                     MOVE *BLANKS   PORACT                                              CGL020
     C                     MOVE *BLANKS   PORCTY                                              CGL020
     C                     MOVE *BLANKS   PORBNK                                              CGL020
     C                     MOVE *BLANKS   PORCDE                                              CGL020
     C                     MOVE *BLANKS   DSTACT                                              CGL020
     C                     MOVE *BLANKS   DSTCTY                                              CGL020
     C                     MOVE *BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD0         SETDAT                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   TICKER                                              CGL020
     C                     MOVE *BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD0         NOMINL                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           1         DO   250       Q
     C           Q         OCUR BALCCY                 79
     C           OCCY      IFEQ '   '
     C                     Z-ADD250       Q
     C                     ELSE
     C           CRTOT     IFNE DRTOT
     C*
     C* GENERATE EXTRA ENTRIES TO SUSPENSE ACCOUNT
     C*
     C                     MOVE *BLANKS   NAR
     C**********           MOVEAMESS      NAR                             E14537
     C                     MOVEAMESS,1    NAR                             E14537
     C                     MOVEL*BLANK    CHAR06
     C***********          MOVELXBRCH     CHAR06                          S01117
     C                     MOVELXBRHA     CHAR06                          S01117
     C                     MOVEACHAR06    NAR,20
     C                     MOVELOCCY      CHAR06
     C                     MOVEACHAR06    NAR,24
     C                     MOVEANAR       PNAR
     C*
     C*  BRANCH IS A/C KEY BRANCH
     C*
     C***********          MOVE XBRCH     BRCD                            S01117
     C                     MOVE XBRHA     BRCA                            S01117
     C*
     C*  CUSTOMER IS BRANCH INTERNAL CUSTOMER NUMBER OF A/C KEY BRANCH
     C*
     C**********           Z-ADDXBICN     CNUM                                                CSD027
     C                     MOVE XBICN     CNUM                                                CSD027
     C*
     C*  CURRENCY CODE
     C                     MOVE OCCY      CCY
     C*
     C*  ACCOUNT CODE
     C                     MOVE COMS      ACOD
     C*                                                                   CAC002
     C** If Analytical Accounting is installed, use the Primary Funding   CAC002
     C** profit centre for balancing entry posting.                       CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE FTPRFP    PRFC                            CAC002
     C                     ELSE                                           CAC002
     C                     MOVE WWPRFC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*
     C*  ACOUNT TYPE AND RETAIL INDICATOR DETERMINED IN ACDCHN
     C*
     C                     EXSR ACDCHN
     C*
     C*  SEQUENCE NUMBER
     C*
     C********** MBIN      IFEQ 'Y'                                       E18803
     C**********           Z-ADDXSACS     ACSQ                            E18803
     C**********           ELSE                                           E18803
     C                     Z-ADD01        ACSQ
     C**********           END                                            E18803
     C*
     C                     EXSR PRFAL1
     C*
     C*  SET ASSOCIATED CUSTOMER TO BRANCH INTERNAL CUSTOMER              077018
     C**********           Z-ADDXBICN     ASOC                                         077018 CSD027
     C                     MOVE XBICN     ASOC                                                CSD027
     C*                                                                   077018
     C* OUTPUT AMOUNT/VALUE IS DIFFERENCE REVERSED
     C*
     C           CRTOT     IFGT DRTOT
     C           CRTOT     SUB  DRTOT     PSTA
     C                     Z-ADD0         DRCR
     C                     ELSE
     C           DRTOT     SUB  CRTOT     PSTA
     C                     Z-ADD1         DRCR
     C                     END
     C*
     C** IF THE RETAIL ACCOUNT, NO ACCOUNTING ENTRY WILL BE GENERATED IF  E17026
     C** BLOCK ALL DEBIT INDICATOR ON AND DEBIT ENTRY, OR IF              E17026
     C** BLOCK ALL CREDIT INDICATOR ON AND CREDIT ENTRY                   E17026
     C*                                                                   E17026
     C           RIND      IFEQ 1                                         E17026
     C*                                                                   E17026
     C                     EXSR ACCNTI                                    E17026
     C*                                                                   E17026
     C           *IN55     IFEQ '1'                                       E17026
     C           DRCR      ANDEQ0                                         E17026
     C           *IN56     OREQ '1'                                       E17026
     C           DRCR      ANDEQ1                                         E17026
     C                     GOTO SKPBPO                                    E17026
     C                     END                                            E17026
     C*                                                                   E17026
     C                     END                                            E17026
     C*
     C* WRITE GENERATED MIDAS ACCOUNT KEYS FILE LF/GEST
     C*
     C                     MOVE 'P'       RECI
      *                                                                   S01522
      **  Set up fields for Posting Narrative                             S01522
     C**********           MOVE *ZEROS    ##CUST                                       S01522 CSD027
     C                     MOVE *BLANKS   ##CUST                                              CSD027
     C                     MOVE OCCY      ##CCY                           S01522
     C                     MOVE *ZEROS    ##ACCD                          S01522
     C                     MOVE *ZEROS    ##ACSQ                          S01522
     C                     MOVE XBRHA     ##BRCA                          S01522
     C                     MOVE *BLANKS   ##SECN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C                     MOVE *BLANKS   ##TRNO                          S01522
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     MOVE 'GB00010' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*
     C/COPY WNCPYSRC,SE2450C048
     C*                                                                   CPB002
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB002
     C*                                                                   CPB002
     C                     WRITEGESTPDF
     C/COPY WNCPYSRC,SE2450C061
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C020
     C*
     C*  KEEP COUNT OF RECORDS WRITTEN TO LF/GEST AND HASH TOTAL
     C*
     C                     ADD  1         W02CNT  50
     C*
     C*   EXECUTE HASH TOTALLING SUBROUTINE (Z=1) FOR SECOND
     C*   ARRAY ELEMENTS (INT,S DEC,S) SO S=2 ,ACCUMULATING ZZAMT(15/3)
     C*
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
     C           PSTA      DIV  1000      ZZAMT
     C                     EXSR ZHASH
     C*                                                                   E17026
     C           SKPBPO    TAG                                            E17026
     C*                                                                   E17026
     C                     END
     C                     END
     C*
     C* AFTER ACTIONING CLEAR DOWN THIS BRANCH/CCY DATA, WHETHER
     C* UNEQUAL OR NOT
     C*
     C                     Z-ADD0         CRTOT
     C                     Z-ADD0         DRTOT
     C                     MOVE '   '     OCCY
     C                     END
     C*
     C                     Z-ADD0         Q
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* ACCNTI   - GET ACCOUNT RECORD                                 *
     C*                                                               *
     C*****************************************************************
     C*
     C           ACCNTI    BEGSR                           ** ACCNTI **
     C*
     C*  ACCESS ACCOUNT MASTER FILE
     C*
     C           ACCNTK    CHAINACCNT                78
     C           *IN78     IFEQ '0'
     C           RECI      ANDNE'D'
     C           *IN78     OREQ '0'
     C           ACST      ANDNE*BLANK
     C                     MOVE '1'       *IN78
     C                     END
     C*                                                                   E17026
     C** IF THE ACCOUNT RECORD IS FOUND,                                  E17026
     C** TEST BIT TO SET THE BLOCK DR IND. AND BLOCK CR INDICATOR.        E17026
     C*                                                                   E17026
     C           *IN78     IFEQ '0'                                       E17026
     C                     TESTB'2'       RETB           55               E17026
     C                     TESTB'3'       RETB           56               E17026
     C                     ELSE                                           E17026
     C                     SETOF                     5556                 E17026
     C                     END                                            E17026
     C*                                                                   E17026
     C/COPY WNCPYSRC,SE2450C049
     C           ENDACC    ENDSR                           ** ENDACC **
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  CLTCHN SR. - TO CHAIN TO S/CLINT USING CO/PARTY FROM S/STKEY *
     C*               CALLED FROM - NARRAT                            *
     C*                                                               *
     C*****************************************************************
     C*
     C           CLTCHN    BEGSR                           *** CLTCHN ***
     C*
     C                     MOVE XCSTN     CNUMC
     C                     MOVE 'A'       RCDT
     C*
     C           CLIKY     CHAINCLINT                89
     C           *IN89     IFNE '1'
     C           RECI      ANDEQ'*'
     C                     MOVE '1'       *IN89
     C                     END
     C*
     C           *IN89     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8
     C                     MOVE 'CLINT'   DBFILE           ***************
     C                     MOVELCLIDS     DBKEY            * DB ERROR 05 *
     C                     Z-ADD05        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR
     C                     END
     C*
     C           CLTT99    ENDSR                           *** CLTT99 ***
     C*
3155 C*****************************************************************
      /EJECT
3155 C*****************************************************************
     C*                                                               *
     C*    TRADES - POSTINGS TO TRADES AND TRADE EQUIVALENT ACCOUNTS  *
     C*                                                               *
3155 C*****************************************************************
     C*
     C           TRADES    BEGSR                           *** TRADES ***
     C/COPY WNCPYSRC,SEH00229
     C*
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     MOVELACKY      ACKEY                                               CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   FEEFLG                                              CGL020
     C                     Z-ADD0         FEEPCT                                              CGL020
     C                     Z-ADD0         FEEVAL                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   RORACT                                              CGL020
     C                     MOVE *BLANKS   RORCTY                                              CGL020
     C                     MOVE *BLANKS   RORBNK                                              CGL020
     C                     MOVE *BLANKS   RORCDE                                              CGL020
     C                     MOVE *BLANKS   PORACT                                              CGL020
     C                     MOVE *BLANKS   PORCTY                                              CGL020
     C                     MOVE *BLANKS   PORBNK                                              CGL020
     C                     MOVE *BLANKS   PORCDE                                              CGL020
     C                     MOVE *BLANKS   DSTACT                                              CGL020
     C                     MOVE *BLANKS   DSTCTY                                              CGL020
     C                     MOVE *BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD0         SETDAT                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   TICKER                                              CGL020
     C                     MOVE *BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD0         NOMINL                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE '0'       GEN14   1
     C                     MOVE '0'       GEN58   1
     C                     MOVE '0'       WREV    1
     C           WACEVC    IFEQ 'T'
     C           WACAMC    ANDEQ'CV'
     C           CCYE      ANDEQ'B'
     C/COPY WNCPYSRC,SE2450C006
     C                     MOVE '1'       GEN14   1
     C/COPY WNCPYSRC,SE2450C065
     C                     ELSE
     C           WACEVC    IFEQ 'V'
     C           WACAMC    ANDEQ'CV'
     C           CCYE      IFEQ 'B'
     C                     MOVE '1'       WREV    1
     C/COPY WNCPYSRC,SE2450C068
     C                     MOVE '1'       GEN14   1
     C                     MOVE '1'       GEN58   1                       E14952
     C**********           END                                            E14952
     C                     ELSE                                           E14952
     C           CCYE      IFEQ 'V'                                       E14952
     C/COPY WNCPYSRC,SE2450C066
     C                     MOVE '1'       GEN58   1
     C/COPY WNCPYSRC,SE2450C067
     C                     END                                            E14952
     C                     END                                            E14952
     C                     ELSE
     C           WACEVC    IFEQ 'S'
     C           WACTRT    ANDEQ' '
     C           WACAMC    ANDEQ'SA'
     C/COPY WNCPYSRC,SE2450C102
     C                     MOVE '1'       GEN58   1
     C                     END
     C                     END
     C                     END
      *                                                                   S01447
     C           S01447    IFEQ 'Y'                                       S01447
     C           WACEVC    IFEQ 'C'                                       S01447
     C           WACAMC    ANDEQ'WD'                                      S01447
     C           WACEVC    OREQ 'H'                                       S01447
     C           WACAMC    ANDEQ'WD'                                      S01447
     C                     MOVE '1'       GEN58                           S01447
     C                     END                                            S01447
     C                     END                                            S01447
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C           WACEVC    ANDEQ'E'                                                           CGL031
     C                     MOVE '1'       GEN58                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                   S01447
     C/COPY WNCPYSRC,SE2450C011
     C*
     C*  IF GEN14 AND GEN58 BOTH ZERO SKIP TO END OF SUBR
     C*
     C           GEN14     IFEQ '0'
     C           GEN58     CABEQ'0'       ENDTRD
     C                     END
     C*
     C*  BRANCH IS A/C KEY BRANCH
     C*
     C***********          Z-ADDXBRCH     BRCD                            S01117
     C                     MOVE XBRHA     BRCA                            S01117
     C*
     C*  CUSTOMER IS BRANCH INTERNAL CUSTOMER NUMBER OF A/C KEY BRANCH
     C*
     C**********           Z-ADDXBICN     CNUM                                                CSD027
     C                     MOVE XBICN     CNUM                                                CSD027
     C*
     C* CURRENCY CODE
     C*
     C                     MOVE XEVCY     CCY
     C*
     C* ACCOUNT SEQUENCE NUMBER
     C*
     C********** MBIN      IFEQ 'Y'                                       E18803
     C**********           Z-ADDXSACS     ACSQ                            E18803
     C**********           ELSE                                           E18803
     C                     Z-ADD01        ACSQ
     C**********           END                                            E18803
     C*
     C* RETAIL ACCOUNT NUMBER
     C*
     C                     MOVE *BLANKS   ACNO
     C*
     C* POSTING DATE IS RUN DATE
     C*
     C                     Z-ADDRUND      PSTD
     C*
     C**VALUE DATE IS RUN DATE******                                      102909
     C*********                                                           102909
     C*********            Z-ADDRUND      VALD                            102909
     C* VALUE DATE IS EVENT DATE                                          102909
     C*                                                                   102909
     C                     Z-ADDXEVDT     VALD                            102909
     C*
     C* NARRATIVE - TRADE RELATED AND POSITION SETTLEMENT RELATED
     C*
     C                     MOVEABLK030    NAR,1
     C           WACEVC    IFEQ 'T'
     C/COPY WNCPYSRC,SE2450C007
     C           WACEVC    OREQ 'V'
     C/COPY WNCPYSRC,SE2450C025
     C*
     C*    NARRATIVE TRADE - USE SECURITY S/NAME & TRADE REFERNECE
     C*
     C                     MOVEAXSESH     NAR,1
     C                     MOVE XTRFR     CHAR06  6
     C                     MOVEACHAR06    NAR,14
     C                     MOVE 'GB44000' ##MGID                          S01522
     C/COPY WNCPYSRC,SE2450C073
     C                     ELSE
     C*
     C*    NARRATIVE SETTL - USE 'POSN.SETTLEMENT RE '  + SEC SHORT NM
     C*
     C***********          MOVEL'MENT RE 'W20    20                       S01447
     C***********          MOVEL'POSN.SET'W11    11                       S01447
     C***********          MOVE 'TLE'     W11                             S01447
     C***********          MOVELW11       W20                             S01447
     C*                                                                   S01447
     C           WACAMC    IFNE 'WD'                                      S01447
     C/COPY WNCPYSRC,SE2450C088
     C*                                                                   S01447
     C**   (OVERPRINTING CORRECTED                                        S01447
     C*                                                                   S01447
     C                     MOVE 'ENT RE  'W20    20                       S01447
     C                     MOVEL'POSN.SET'W12    12                       S01447
     C                     MOVE 'TLEM'    W12                             S01447
     C                     MOVELW12       W20                             S01447
     C                     MOVEAW20       NAR,1
     C                     MOVE XTRFR     CHAR06  6
     C                     MOVEACHAR06    NAR,22
     C                     MOVE 'GB00430' ##MGID                          S01522
     C*                                                                   S01447
     C**  OUTPUT WHT TAX NARRATIVE                                        S01447
     C*                                                                   S01447
     C                     ELSE                                           S01447
     C                     MOVEATAXNAR    NAR,1                           S01447
     C                     MOVE 'GB00440' ##MGID                          S01522
     C                     END                                            S01447
     C*                                                                   S01447
     C                     END
     C                     MOVEANAR       PNAR
     C*
     C* DEBIT CREDIT INDICATOR
     C*
     C*     TRADE TYPE  DETERMINES DEBIT CREDIT INDICATOR INITIALLY
     C*
     C**********           MOVELXSTLA     W5      5                       E13817
     C                     MOVELXACKY     W5      5                       E13817
     C                     MOVELXACKY     W6      6                       E14952
     C                     MOVE XACKY     W22     2                       E14952
     C                     MOVE W5        W1      1
     C                     MOVE W6        W1X     1                       E14952
     C***********W1        IFEQ 'P'                                       E14952
     C           W1        IFEQ 'S'                                       E14952
     C           W22       OREQ 'SA'                                      E14952
     C           W1X       ANDEQ'X'                                       E14952
     C/COPY WNCPYSRC,SE2450C103
     C                     Z-ADD1         DCINT   10
     C                     Z-ADD0         DCINF   10
     C                     ELSE
     C                     Z-ADD0         DCINT
     C                     Z-ADD1         DCINF
     C                     END
     C/COPY WNCPYSRC,SE2450C026
     C*
     C*  GENERATE POSTINGS 1 TO 4 AS PER TABLE 4 OF ELEMENT
     C*
     C           GEN14     IFEQ '1'
     C*
     C           1         DO   4         W       10
     C*
     C* ACCOUNT CODE DIFFERS FOR EACH POSTING NUMBER
     C*
     C           W         IFEQ 1
     C                     Z-ADDFTAC      ACOD
     C                     Z-ADDWAEVAM    PSTA
     C                     Z-ADDDCINT     DRCR
     C                     END
     C           W         IFEQ 2
     C*
     C** FORWARD TRADE A/C EQUIVALENT
     C*
     C                     MOVE XEVCY     GCCY    3
     C                     EXSR G10CHN
     C                     Z-ADDWFTAC     ACOD
     C                     Z-ADDXKBCA     PSTA
     C                     Z-ADDDCINF     DRCR
     C***********          MOVE BCCY      CCY                             S01117
     C                     MOVE BJCYCD    CCY                             S01117
     C                     END
     C           W         IFEQ 3
     C*
     C** FORWARD TRADE A/C EQUIVALENT
     C*
     C                     MOVE XKCCY     GCCY    3
     C                     EXSR G10CHN
     C                     Z-ADDWFTAC     ACOD
     C                     Z-ADDXKBCA     PSTA
     C                     Z-ADDDCINT     DRCR
     C***********          MOVE BCCY      CCY                             S01117
     C                     MOVE BJCYCD    CCY                             S01117
     C                     END
     C           W         IFEQ 4
     C                     Z-ADDFTAC      ACOD
     C                     Z-ADDXKNCA     PSTA               01
     C                     Z-ADDDCINF     DRCR
     C                     MOVE XKCCY     CCY
     C                     END
     C*
     C* TOTALS OF CREDITS/DEBITS PER BRANCH/CURRENCY ARE MAINTAINED
     C* IN MULT/OCCUR D/S BALCCY. THIS EVENT CURRENCY MAY BE IN SAY $
     C* BUT SOME POSTINGS IN TRADES SUBR (SEE TABLE 4 OF SPEC) ARE TO
     C* OTHER CURRENCIES. THIS CODE ESTABLISHES THE OCCURRENCE OF THE
     C* DATA/STRUCTURE IN WHICH TO STORE THE DEBIT/CREDIT POSTING.
     C*
     C                     Z-ADD0         WSUB    10
     C***********W         IFEQ 2                                         E19905
     C***********BCCY      ANDNEXEVCY                                     E19905
     C***********                                                         E19905
     C***********W         OREQ 3                                         E19905
     C***********BCCY      ANDNEXEVCY                                     E19905
     C***********                                                         E19905
     C***********W         OREQ 4                                         E19905
     C***********WKCCY     ANDNEXEVCY                                     E19905
     C*                                                                   E19905
     C*  CHECK WHETHER CCY = OCCY FROM PREVIOUS OCUR ON BALCCY            E19905
     C*                                                                   E19905
     C           OCCY      IFNE CCY                                       E19905
     C*
     C                     Z-ADDQ         WSUB
     C                     Z-ADD1         N       30
     C           CCY       LOKUPGX,N                     62
     C           *IN62     IFEQ '0'
     C**                              NOT FOUND
     C********** Q         ADD  1         N                               E13817
     C           '   '     LOKUPGX,N                     33               E13817
     C                     END
     C           N         OCUR BALCCY                 79
     C           *IN62     IFEQ '0'
     C                     MOVE CCY       OCCY
     C                     MOVE CCY       GX,N
     C                     Z-ADD0         CRTOT
     C                     Z-ADD0         DRTOT
     C                     Z-ADDN         Q
     C                     Z-ADD0         WSUB
     C                     END
     C                     END
     C*
     C** DEBIT CREDIT INDICATOR DRCR
     C*
     C           PSTA      IFLT 0
     C                     Z-SUBPSTA      PSTA
     C           DRCR      IFEQ 0
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C                     END
     C*
     C*  IF REVERSAL INDICATOR IS 1 REVERSE DEBIT CREDIT INDICATOR
     C*
     C           XRVRS     IFEQ '1'
     C           DRCR      IFEQ 0
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C                     MOVE '*'       PNAR                            E21237
     C                     MOVE '*'       ##REVI                          S01522
     C                     ELSE                                           S01522
     C                     MOVE *BLANKS   ##REVI                          S01522
     C                     END
     C*
     C*  IF REVERSAL INDICATOR WREV IS 1 REVERSE DEBIT CREDIT INDICATOR
     C*
     C           WREV      IFEQ '1'
     C           DRCR      IFEQ 0
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C                     END
     C*
     C*   WRITE RECORD IF AMOUNT IS NON-ZERO
     C*
     C           PSTA      IFNE 0
     C           ACOD      ANDNE0
     C*
     C*  ACCOUNT TYPE AND RETAIL INDICATOR DETERMINED IN ACDCHN
     C*
     C                     EXSR ACDCHN
     C*
     C** IF THE RETAIL ACCOUNT, NO ACCOUNTING ENTRY WILL BE               E17026
     C** GENERATED IF BLOCK ALL DEBIT INDICATOR ON AND DEBIT ENTRY,       E17026
     C** OR IF BLOCK ALL CREDIT INDICATOR ON AND CREDIT ENTRY             E17026
     C*                                                                   E17026
     C           RIND      IFEQ 1                                         E17026
     C*                                                                   E17026
     C                     EXSR ACCNTI                                    E17026
     C*                                                                   E17026
     C           *IN55     IFEQ '1'                                       E17026
     C           DRCR      ANDEQ0                                         E17026
     C           *IN56     OREQ '1'                                       E17026
     C           DRCR      ANDEQ1                                         E17026
     C                     GOTO SKPTP1                                    E17026
     C                     END                                            E17026
     C*                                                                   E17026
     C                     END                                            E17026
     C*                                                                   E17026
     C                     MOVE 'P'       RECI
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
      *                                                                   S01522
      **  Set up fields for Posting Narrative                             S01522
     C                     MOVE CNUM      ##CUST                          S01522
     C                     MOVE CCY       ##CCY                           S01522
     C                     MOVE ACOD      ##ACCD                          S01522
     C                     MOVE ACSQ      ##ACSQ                          S01522
     C                     MOVE BRCA      ##BRCA                          S01522
     C                     MOVE XSESH     ##SECN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C******************** MOVE XTRFR     ##TRNO                    S01522087870
     C                     MOVELXTRFR     ##TRNO                          087870
     C/COPY WNCPYSRC,SE2450C082
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   CAC002
     C** If Analytical Accounting is installed, determine if profit       CAC002
     C** centre can hold an FX position in posting to the spot trade      CAC002
     C** and spot trade equivalent account.                               CAC002
     C*                                                                   CAC002
     C                     MOVE WWPRFC    PRFC                            CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     CALL 'AOPRFCR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM WWPRFC    WPRFC   4                       CAC002
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD50        DBASE            ************   CAC002
     C                     MOVEL'*KEY   ' DBOPTN           * DBERR 50 *   CAC002
     C                     MOVELWWPRFC    DBKEY            ************   CAC002
     C                     MOVEL'SDPRFCPD'DBFILE                          CAC002
     C                     OUT  LDA                                       CAC002
     C**********           SETON                       U7U8LR             CAC002
     C                     SETON                     U7U8LR         CAC002153890
     C                     DUMP                                           CAC002
     C                     EXSR AUDIT                                     CAC002
     C                     RETRN                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C           DSFPPC    IFNE *BLANKS                                   CAC002
     C                     MOVE DSFPPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*
     C/COPY WNCPYSRC,SE2450C071
     C*                                                                   CPB002
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB001
     C*                                                                   CPB002
     C                     WRITEGESTPDF
     C/COPY WNCPYSRC,SE2450C062
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C021
     C*
     C*  KEEP COUNT OF RECORDS WRITTEN TO LF/GEST AND HASH TOTAL
     C*
     C                     ADD  1         W02CNT  50
     C*
     C**  EXECUTE HASH TOTALLING SUBROUTINE (Z=1) FOR SECOND
     C**  ARRAY ELEMENTS (INT,S DEC,S) SO S=2 ,ACCUMULATING ZZAMT(15/3)
     C*
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
     C           PSTA      DIV  1000      ZZAMT
     C                     EXSR ZHASH
     C*
     C*  STORE AMOUNT POSTED PER CURRENCY IN BALCCY DATA STRUCTURE
     C*
     C           DRCR      IFEQ 0
     C                     ADD  PSTA      DRTOT
     C                     ELSE
     C                     ADD  PSTA      CRTOT
     C                     END
     C*                                                                   E17026
     C           SKPTP1    TAG                                            E17026
     C*                                                                   E17026
     C                     END
     C*
     C*  RESTORE OCCURRENCE OF DATA STRUCTURE IF ALTERED FOR PREF 2,3,4
     C*
     C           WSUB      IFGT 0
     C                     Z-ADDWSUB      Q
     C           Q         OCUR BALCCY                 79
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE2450C089
     C*
     C*  GENERATE POSTINGS 5 TO 8 AS PER TABLE 4 OF ELEMENT
     C*
     C           GEN58     IFEQ '1'
     C*
     C           5         DO   8         W       10
     C*                                                                   E19828
     C*  THIS FIELD GOVERNS THE OUTPUT OF SPOT TRADE AND TRADE EQUIV      E19828
     C*  FOR BASE CCY                                                     E19828
     C*                                                                   E19828
     C                     Z-ADD0         ACOD                            E19828
     C*
     C* ACCOUNT CODE DIFFERS FOR EACH POSTING NUMBER
     C*
     C           W         IFEQ 5
     C***********XEVCY     ANDNEBCCY                               E19828 S01117
     C           XEVCY     ANDNEBJCYCD                                    S01117
     C***********BASERQ    OREQ 'Y'                                E19828 E21238
     C           W         OREQ 5                                         E21238
     C           BASERQ    ANDEQ'Y'                                       E21238
     C                     Z-ADDSPAC      ACOD
     C                     Z-ADDWAEVAM    PSTA
     C                     Z-ADDDCINT     DRCR
     C                     MOVE XEVCY     CCY
     C                     END
     C           W         IFEQ 6
     C***********XEVCY     ANDNEBCCY                               E19828 S01117
     C           XEVCY     ANDNEBJCYCD                                    S01117
     C***********BASERQ    OREQ 'Y'                                E19828 E21238
     C           W         OREQ 6                                         E21238
     C           BASERQ    ANDEQ'Y'                                       E21238
     C*
     C***FORWARD*TRADE*A/C EQUIVALENT***                                  E14710
     C** SPOT TRADE A/C EQUIVALENT                                        E14710
     C*
     C                     MOVE XEVCY     GCCY    3
     C                     EXSR G10CHN
     C**********           Z-ADDWFTAC     ACOD                            E14710
     C                     Z-ADDWSPAC     ACOD                            E14710
     C                     Z-ADDXKBCA     PSTA
     C                     Z-ADDDCINF     DRCR
     C***********          MOVE BCCY      CCY                             S01117
     C                     MOVE BJCYCD    CCY                             S01117
     C                     END
     C           W         IFEQ 7
     C***********XKCCY     ANDNEBCCY                               E19828 S01117
     C           XKCCY     ANDNEBJCYCD                                    S01117
     C***********BASERQ    OREQ 'Y'                                E19828 E21238
     C           W         OREQ 7                                         E21238
     C           BASERQ    ANDEQ'Y'                                       E21238
     C*
     C***FORWARD*TRADE*A/C*EQUIVALENT***                                  E14710
     C** SPOT TRADE A/C EQUIVALENT                                        E14710
     C*
     C                     MOVE XKCCY     GCCY    3
     C                     EXSR G10CHN
     C***********          Z-ADDWFTAC     ACOD                            E14710
     C                     Z-ADDWSPAC     ACOD                            E14710
     C                     Z-ADDXKBCA     PSTA
     C                     Z-ADDDCINT     DRCR
     C***********          MOVE BCCY      CCY                             S01117
     C                     MOVE BJCYCD    CCY                             S01117
     C                     END
     C           W         IFEQ 8
     C***********XKCCY     ANDNEBCCY                               E19828 S01117
     C           XKCCY     ANDNEBJCYCD                                    S01117
     C***********BASERQ    OREQ 'Y'                                E19828 E21238
     C           W         OREQ 8                                         E21238
     C           BASERQ    ANDEQ'Y'                                       E21238
     C                     Z-ADDSPAC      ACOD
     C                     Z-ADDXKNCA     PSTA               01
     C                     Z-ADDDCINF     DRCR
     C                     MOVE XKCCY     CCY
     C                     END
     C*
     C* TOTALS OF CREDITS/DEBITS PER BRANCH/CURRENCY ARE MAINTAINED
     C* IN MULT/OCCUR D/S BALCCY. THIS EVENT CURRENCY MAY BE IN SAY $
     C* BUT SOME POSTINGS IN TRADES SUBR (SEE TABLE 4 OF SPEC) ARE TO
     C* OTHER CURRENCIES. THIS CODE ESTABLISHES THE OCCURENCE OF THE
     C* DATA/STRUCTURE IN WHICH TO STORE THE DEBIT/CREDIT POSTING.
     C*
     C                     MOVE '0'       WSUB
     C*                                                                   E19828
     C*  CONDITIONAL END OF LOOP IF ENTRY NOT REQUIRED.                   E19828
     C*                                                                   E19828
     C           ACOD      CABEQ0         SKPTP2                          E19828
     C***********W         IFEQ 5                                  E19828 E19905
     C***********WKCCY     ANDNEXEVCY                              E19828 E19905
     C***********                                                  E19828 E19905
     C***********W         IFEQ 6                                         E19828
     C***********W         OREQ 6                                  E19828 E19905
     C***********BCCY      ANDNEXEVCY                                     E19905
     C***********                                                         E19905
     C***********W         OREQ 7                                         E19905
     C***********BCCY      ANDNEXEVCY                                     E19905
     C***********                                                         E19905
     C***********W         OREQ 8                                         E19905
     C***********XKCCY     ANDNEXEVCY                                     E19905
     C*                                                                   E19905
     C*  CHECK WHETHER CCY = OCCY FROM PREVIOUS OCUR ON BALCCY            E19905
     C*                                                                   E19905
     C           OCCY      IFNE CCY                                       E19905
     C*
     C                     Z-ADDQ         WSUB
     C                     Z-ADD1         N       30
     C           CCY       LOKUPGX,N                     62
     C           *IN62     IFEQ '0'
     C**                              NOT FOUND
     C********** Q         ADD  1         N                               E13817
     C           '   '     LOKUPGX,N                     33               E13817
     C                     END
     C           N         OCUR BALCCY                 79
     C           *IN62     IFEQ '0'
     C                     MOVE CCY       OCCY
     C                     MOVE CCY       GX,N
     C                     Z-ADD0         CRTOT
     C                     Z-ADD0         DRTOT
     C                     Z-ADDN         Q
     C                     Z-ADD0         WSUB
     C                     END
     C                     END
     C*
     C** DEBIT CREDIT INDICATOR DRCR
     C*
     C           PSTA      IFLT 0
     C                     Z-SUBPSTA      PSTA
     C           DRCR      IFEQ 0
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C                     END
     C*
     C*  IF REVERSAL INDICATOR IS 1 REVERSE DEBIT CREDIT INDICATOR
     C*
     C           XRVRS     IFEQ '1'
     C           DRCR      IFEQ 0
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C                     MOVE '*'       PNAR                            E21237
     C                     MOVE '*'       ##REVI                          S01522
     C                     ELSE                                           S01522
     C                     MOVE *BLANKS   ##REVI                          S01522
     C                     END
     C*
     C*   WRITE RECORD IF AMOUNT IS NON-ZERO
     C*
     C           PSTA      IFNE 0
     C           ACOD      ANDNE0
     C*
     C*  ACCOUNT TYPE AND RETAIL INDICATOR DETERMINED IN ACDCHN
     C*
     C                     EXSR ACDCHN
     C*
     C** IF THE RETAIL ACCOUNT, NO ACCOUNTING ENTRY WILL BE               E17026
     C** GENERATED IF BLOCK ALL DEBIT INDICATOR ON AND DEBIT ENTRY,       E17026
     C** OR IF BLOCK ALL CREDIT INDICATOR ON AND CREDIT ENTRY             E17026
     C*                                                                   E17026
     C           RIND      IFEQ 1                                         E17026
     C*                                                                   E17026
     C                     EXSR ACCNTI                                    E17026
     C*                                                                   E17026
     C           *IN55     IFEQ '1'                                       E17026
     C           DRCR      ANDEQ0                                         E17026
     C           *IN56     OREQ '1'                                       E17026
     C           DRCR      ANDEQ1                                         E17026
     C                     GOTO SKPTP2                                    E17026
     C                     END                                            E17026
     C*                                                                   E17026
     C                     END                                            E17026
     C*                                                                   E17026
     C                     MOVE 'P'       RECI
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   CAC002
     C** If Analytical Accounting is installed, determine if profit       CAC002
     C** centre can hold an FX position in posting to the spot trade      CAC002
     C** and spot trade equivalent account.                               CAC002
     C*                                                                   CAC002
     C                     MOVE WWPRFC    PRFC                            CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     CALL 'AOPRFCR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM WWPRFC    WPRFC                           CAC002
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C**********           Z-ADD51        DBASE         ************CAC002153890
     C**********           MOVEL'*KEY   ' DBOPTN        **DBERR*51**CAC002153890
     C                     Z-ADD52        DBASE            ************   153890
     C                     MOVEL'*KEY   ' DBOPTN           * DBERR 52 *   153890
     C                     MOVELWWPRFC    DBKEY            ************   CAC002
     C                     MOVEL'SDPRFCPD'DBFILE                          CAC002
     C                     OUT  LDA                                       CAC002
     C**********           SETON                       U7U8LR       CAC002153890
     C                     SETON                     U7U8LR               153890
     C                     DUMP                                           CAC002
     C                     EXSR AUDIT                                     CAC002
     C                     RETRN                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C           DSFPPC    IFNE *BLANKS                                   CAC002
     C                     MOVE DSFPPC    PRFC                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*
     C/COPY WNCPYSRC,SE2450C072
     C*                                                                   CPB002
     C* Setup Transaction Type if PB Module is On                         CPB002
     C*                                                                   CPB002
     C                     EXSR #TRTYP                                    CPB002
     C*                                                                   CPB002
     C                     WRITEGESTPDF
     C/COPY WNCPYSRC,SE2450C063
     C                     EXSR PRTALD                                    109024
     C/COPY WNCPYSRC,SE2450C022
     C*
     C*  KEEP COUNT OF RECORDS WRITTEN TO LF/GEST AND HASH TOTAL
     C*
     C                     ADD  1         W02CNT  50
     C*
     C**  EXECUTE HASH TOTALLING SUBROUTINE (Z=1) FOR SECOND
     C**  ARRAY ELEMENTS (INT,S DEC,S) SO S=2 ,ACCUMULATING ZZAMT(15/3)
     C*
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
     C           PSTA      DIV  1000      ZZAMT
     C                     EXSR ZHASH
     C*
     C*  STORE AMOUNT POSTED PER CURRENCY IN BALCCY DATA STRUCTURE
     C*
     C           DRCR      IFEQ 0
     C                     ADD  PSTA      DRTOT
     C                     ELSE
     C                     ADD  PSTA      CRTOT
     C                     END
     C*                                                                   E17026
     C           SKPTP2    TAG                                            E17026
     C*                                                                   E17026
     C                     END
     C*
     C*  RESTORE OCCURRENCE OF DATA STRUCTURE IF ALTERED FOR PREF 2,3,4
     C*
     C           WSUB      IFGT 0
     C                     Z-ADDWSUB      Q
     C           Q         OCUR BALCCY                 79
     C                     END
     C*
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE2450C090
     C*
     C           ENDTRD    ENDSR                           *** ENDTRD ***
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*    INIT SR. - TO DO THE INITIAL PROCESSING                    *
     C*               CALLED FROM - MAIN                              *
     C*               CALLS       - ZSYSTM,                           *
     C*                                                               *
     C*****************************************************************
     C*
     C           INIT      BEGSR                           ***  INIT  ***
     C*
     C** Define and initialise the Local Data Area                        S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBPGM                           066305
     C**********           MOVE 'SE2450  'DBPGM                           066305
     C                     MOVEL'SE2450  'DBPGM                           066305
     C                     OUT  LDA                                       S01117
     C*                                                                   S01117
     C** Define and initialise the System Run Data Dtaara                 S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           RUNDAT                          S01117
     C                     IN   RUNDAT                                    S01117
     C*                                                                   E29170
     C**  TEST FOR MULTIBRANCHING                                         E29170
     C*                                                                   E29170
     C           MBIN      IFEQ 'Y'                                       E29170
     C                     SETON                     37                   E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C** RCF Processing for Audit File                                    E29170
     C*                                                                   E29170
     C                     EXSR RCFAU                                     E29170
     C*
     C                     MOVE *BLANKS   BLK012 12
     C                     MOVE *BLANKS   BLK030 30
     C*
     C                     Z-ADD0         PRF
     C                     Z-ADD0         AC
     C                     MOVE BLK012    NC                              E23097
     C*********************Z-ADD0*********NC                              E23097
     C                     Z-ADD0         TABL
     C                     Z-ADD0         TABR
     C***********          Z-ADD0         THBRCH                          S01117
     C                     MOVE *BLANKS   THBRHA                          S01117
     C***********          Z-ADD0         LSBRCH                          S01117
     C                     MOVE *BLANKS   LSBRHA                          S01117
     C**********           Z-ADD0         CNUMC                                               CSD027
     C**********           Z-ADD0         CNUM                                                CSD027
     C                     MOVE *BLANKS   CNUMC                                               CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     Z-ADD0         ACOD
     C                     Z-ADD0         ACSQ
     C                     Z-ADD0         XDECP
     C                     Z-ADD0         XTACC
     C                     Z-ADD0         WN10
     C*
     C* DUE TO SUMMARY ACCRUALS, THESE X- FLDS STORE THE /F/SEKEY INPUT
     C* TRANSACTION RECORD AND ARE USED FOR GENERATING OUTPUT FIELDS
     C*
     C           *LIKE     DEFN ACKY      XACKY
     C           *LIKE     DEFN TRFR      XTRFR
     C           *LIKE     DEFN CSTN      XCSTN
     C************LIKE     DEFN BRCH      XBRCH                           S01117
     C           *LIKE     DEFN BRHA      XBRHA                           S01117
     C           *LIKE     DEFN ASQN      XASQN
     C           *LIKE     DEFN EVDT      XEVDT
     C           *LIKE     DEFN EVAM      XEVAM
     C           *LIKE     DEFN EVCY      XEVCY
     C           *LIKE     DEFN STLT      XSTLT
     C           *LIKE     DEFN STLA      XSTLA
     C           *LIKE     DEFN RVRS      XRVRS
     C           *LIKE     DEFN ISSR      XISSR
     C           *LIKE     DEFN KCUST     XKCUST
     C           *LIKE     DEFN KNCA      XKNCA
     C           *LIKE     DEFN KCCY      XKCCY
     C           *LIKE     DEFN KBCA      XKBCA
     C           *LIKE     DEFN SESH      XSESH
     C           *LIKE     DEFN PEV1      XPEV1                           053103
     C/COPY WNCPYSRC,SE2450C084
     C           *LIKE     DEFN A8BRCD    @@BKBR                          S01117
     C*                                                                   S01117
     C           *LIKE     DEFN A8BICN    @@BKCS                          S01117
     C           *LIKE     DEFN A8DTAC    @@BKAT                          S01117
     C           *LIKE     DEFN A8DFAC    @@BKAF                          S01117
     C*                                                                   S01117
     C           *LIKE     DEFN A8BICN    @@MNCS                          S01117
     C           *LIKE     DEFN A8DTAC    @@MNAT                          S01117
     C           *LIKE     DEFN A8DFAC    @@MNAF                          S01117
     C*                                                                   S01117
     C           *LIKE     DEFN A8BICN    @@SECS                          S01117
     C           *LIKE     DEFN A8DTAC    @@SEAT                          S01117
     C           *LIKE     DEFN A8DFAC    @@SEAF                          S01117
     C*
     C                     Z-ADD500       Y
     C                     Z-ADD250       R       30
     C*
     C*  LINE COUNTS FOR PRINT FILES P1 AND P2
     C*
     C                     Z-ADD99        LCNT1
     C                     Z-ADD99        LCNT2
     C                     Z-ADD99        LCNT3                           109024
     C/COPY WNCPYSRC,SE2450C047
     C*
     C*   GET I.C.D.R. 1, DATABASE ERROR IF NOT FOUND
     C*
     C                     EXSR ZSYSTM
     C           *IN99     IFEQ '1'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 06 *
     C                     Z-ADD06        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR
     C                     END
     C*********************                                               S01117
     C*****ACCESS*I.C.D.*RECORD 11  TABTB11                               S01117
     C*********************                                               S01117
     C***********          MOVE BLK012    ZTABKY                          S01117
     C***********          MOVEL'01'      ZTABKY                          S01117
     C***********          MOVE '11'      ZTABKY                          S01117
     C***********          EXSR TABCHN                                    S01117
     C***********AKSI      IFEQ 'Y'                                       S01117
     C***********          OPEN SE2450P2               79                 S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C**  ACCESS BANK DETAILS FOR BASE CURRENCY FOR ACCOUNTING            S01117
     C*                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG'    @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C*                                                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8                 S01117
     C                     MOVE 'SDBANKPD'DBFILE           ***************S01117
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 12 *S01117
     C                     Z-ADD12        DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR                                     S01117
     C                     END                                            S01117
      *                                                                   S01117
     C**  ACCESS GENERAL LEDGER DETAILS FOR 'PROFIT CENTRE AMENDABLE' &   S01117
     C**  'ORIGINATING BRANCH VALIDATION REQUIRED' FLAGS                  S01117
     C*                                                                   S01117
     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG'    @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C*                                                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8                 S01117
     C                     MOVE 'SDGELRPD'DBFILE           ***************S01117
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 12 *S01117
     C                     Z-ADD12        DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR                                     S01117
     C                     END                                            S01117
     C***********BKAKSI    IFEQ 'Y'                                 S01117E33004
     C***********          OPEN SE2450P2               79           S01117E33004
     C***********          END                                      S01117E33004
     C*                                                                   S01117
     C** Obtain Main branch details, but only if interbranch accounting     1117
     C** is through the main branch.                                      S01117
     C*                                                                   S01117
     C           BKIEMB    IFEQ 'Y'                                       S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG'    @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BKMABR    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       *INLR                           S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
     C                     MOVEL@DSNB     DBKEY            ** DB ERROR 15 S01117
     C                     Z-ADD15        DBASE            ***************S01117
     C                     MOVEL@OPTN     DBOPTN  7                       S01117
     C                     SETON                       U7U8               S01117
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVELA8BICN    @@MNCS                          S01117
     C                     MOVELA8DTAC    @@MNAT                          S01117
     C                     MOVELA8DFAC    @@MNAF                          S01117
     C                     END                                            S01117
     C*
     C*    ACCESS I.C.D. RECORD 5
     C*
     C                     MOVE BLK012    ZTABKY
     C                     MOVEL'01'      ZTABKY
     C                     MOVE '40'      ZTABKY
     C                     EXSR TABCHN
     C*
     C*    ACCESS I.C.D. RECORD 36
     C*
     C                     MOVE BLK012    ZTABKY
     C                     MOVEL'01'      ZTABKY
     C                     MOVE '36'      ZTABKY
     C                     EXSR TABCHN
     C*
     C*    ACCESS I.C.D. RECORD 20
     C*
     C                     MOVE BLK012    ZTABKY
     C                     MOVEL'01'      ZTABKY
     C                     MOVE '20'      ZTABKY
     C           ZTABKY    CHAINTABICD               79
     C           *IN79     IFEQ '1'
     C           RECI      OREQ '*'
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8
     C                     MOVE 'TABLE'   DBFILE           ***************
     C                     MOVELZTABKY    DBKEY            * DB ERROR 07 *
     C                     Z-ADD07        DBASE            ***************
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     GOTO DBERR
     C                     END
     C                     Z-ADDTAC4      ##TAC4 100                                       AR1056730
     C                     Z-ADDTAC5      ##TAC5 100                                       AR1056730
     C*                                                                   E19828
     C*  SET INDICATOR TO DETERMINE IF BASE CCY TRADE/TRADE EQUIVALENT    E19828
     C*  ENTRIES ARE REQUIRED FOR CROSS CCY SETTLEMENTS                   E19828
     C*  DETERMINED BY ENTRY AGAINST BASE CCY ON CURRENCIES FILE          E19828
     C*                                                                   E19828
     C                     MOVE BLK012    ZTABKY                          E19828
     C                     MOVEL'20'      ZTABKY                          E19828
     C***********          MOVELBCCY      WRK004                   E19828 S01117
     C                     MOVELBJCYCD    WRK004                          S01117
     C                     MOVE '1'       WRK004                          E19828
     C                     MOVE WRK004    ZTABKY                          E19828
     C                     EXSR TABCHN                                    E19828
     C           TACC      IFNE 0                                         E19828
     C                     MOVE 'Y'       BASERQ  1                       E19828
     C                     END                                            E19828
     C*
     C*    GET COMPUTER SUSPENSE ACCOUNT ACCOUNT TYPE
     C*
     C                     Z-ADDCOMS      ACOD
     C                     EXSR ACDCHN
     C                     MOVE ATYP      ATYPSU  1
     C                     MOVE ACSC      ACSCSU  2                       S10736
     C                     Z-ADDRIND      RINDSU  10
     C*
     C*    SET CONSTANT FIELDS FOR OUTPUT TO S/GEST
     C*
     C**********           Z-ADD0         ASOC                                                CSD027
     C                     MOVE *BLANKS   ASOC                                                CSD027
     C                     Z-ADD0         CHQN
     C                     MOVE '  GE-ST' SPOS
     C                     Z-ADD0         REJC
     C                     MOVE '   '     DPMT
     C                     Z-ADD0         RRNM
     C                     BITOF'01234567'PRIN
     C                     MOVE 'S'       GETP
     C                     Z-ADD0         ACUM
     C                     Z-ADD0         SDLB                            S01182
     C                     Z-ADD0         SDCB                            S01182
     C                     Z-ADD0         VOIN                            S10736
     C                     Z-ADD235959    PTIM                            S10736
     C/COPY WNCPYSRC,SE2450C008
      *                                                                   S01447
     C                     CALL 'AOSARDR0'                                S01447
     C                     PARM *BLANKS   @RTCD                           S01447
     C                     PARM '*VERIFY' @OPTN                           S01447
     C                     PARM 'S01447'  @SARD   6                       S01447
      *                                                                   S01447
     C           @RTCD     IFEQ *BLANK                                    S01447
     C                     MOVE 'Y'       S01447  1                       S01447
     C                     ELSE                                           S01447
     C                     MOVE 'N'       S01447                          S01447
     C                     END                                            S01447
     C*                                                                   S01486
     C**  Access SDMMODPD for Portfolio Management Indicator.             S01486
     C*                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM '        '@RTCD   7                       S01486
     C                     PARM '*FIRST  '@OPTN   7                       S01486
     C           @MMOD     PARM @MMOD     DSFDY                           S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C           BGTYLC    OREQ 'D'                                       S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     Z-ADD17        DBASE            ***************S01486
     C                     MOVE 'SDMMODPD'DBFILE           * DB ERROR 17 *S01486
     C                     MOVEL*BLANKS   DBKEY            ***************S01486
     C                     OUT  LDA                                       S01486
     C                     SETON                     U7U8                 S01486
     C                     DUMP                                           S01486
     C                     GOTO DBERR                                     S01486
     C                     END                                            S01486
      *                                                                   S01522
      **  Call SAR prog for switchable feature                            S01522
     C                     MOVE 'N'       SEPNAR  1                       S01522
     C           BGN1ST    IFEQ 'Y'                        B1             S01522
     C*                                                                   S01522
     C                     CALL 'AOSARDR0'                  1             S01522
     C                     PARM '       ' @RTCD             1             S01522
     C                     PARM '*VERIFY' @OPTN             1             S01522
     C                     PARM 'SEPNAR'  @SARD   6         1             S01522
     C           SCSARD    PARM SCSARD    DSFDY             1             S01522
     C*                                                                   S01522
     C           @RTCD     IFNE *BLANK                     B2             S01522
     C           @RTCD     ANDNE'*NRF   '                   2             S01522
     C           *LOCK     IN   LDA                         2             S01522
     C                     SETON                     U7U8   2             S01522
     C                     MOVEL'SCSARDPD'DBFILE            ************* S01522
     C                     Z-ADD87        DBASE             *DBERROR 87 * S01522
     C                     MOVEL@SARD     DBKEY             ************* S01522
     C                     OUT  LDA                         2             S01522
     C                     DUMP                             2             S01522
     C                     GOTO DBERR                       2             S01522
     C                     ENDIF                           E2             S01522
     C*                                                                   S01522
     C           @RTCD     IFEQ *BLANK                     B2             S01522
     C                     MOVE 'Y'       SEPNAR            2             S01522
     C                     ENDIF                           E2             S01522
     C                     ENDIF                           E1             S01522
     C*                                                                   CAC002
     C** If Analytical Accounting is installed, retrieve the Primary      CAC002
     C** Funding Profit Centre.                                           CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     CALL 'AOPCACR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDPCAC    PARM SDPCAC    DSFDY                           CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C           *LOCK     IN   LDA                                       CAC002
     C                     Z-ADD49        DBASE            ************   CAC002
     C                     MOVEL'*FIRST ' DBOPTN           * DBERR 49 *   CAC002
     C                     MOVEL'*FIRST ' DBKEY            ************   CAC002
     C                     MOVEL'SDPCACPD'DBFILE                          CAC002
     C                     OUT  LDA                                       CAC002
     C**********           SETON                       U7U8LR             CAC002
     C                     SETON                     U7U8LR         CAC002153890
     C                     DUMP                                           CAC002
     C                     EXSR AUDIT                                     CAC002
     C                     RETRN                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CGL007
      **  Determine if feature CGL007 is installed.                       CGL007
      *                                                                   CGL007
     C                     MOVE 'N'       CGL007  1                       CGL007
     C                     CALL 'AOSARDR0'                                CGL007
     C                     PARM '       ' @RTCD                           CGL007
     C                     PARM '*KEY   ' @OPTN                           CGL007
     C                     PARM 'CGL007'  @SARD                           CGL007
     C           SCSARD    PARM SCSARD    DSFDY                           CGL007
      *                                                                   CGL007
     C           @RTCD     IFEQ *BLANKS                                   CGL007
     C                     MOVE 'Y'       CGL007                          CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
      **  Determine if feature CGL020 is installed.                                           CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM '       ' @RTCD                                               CGL020
     C                     PARM '*VERIFY' @OPTN                                               CGL020
     C                     PARM 'CGL020'  @SARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           @RTCD     IFNE *BLANKS                                                       CGL020
     C           @RTCD     ANDNE'*NRF'                                                        CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     SETON                     U7U8                                     CGL020
     C                     MOVEL'SCSARDPD'DBFILE            *************                     CGL020
     C                     Z-ADD87        DBASE             *DBERROR 87 *                     CGL020
     C                     MOVEL@SARD     DBKEY             *************                     CGL020
     C                     OUT  LDA                                                           CGL020
     C                     DUMP                                                               CGL020
     C                     GOTO DBERR                                                         CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL031
      ** Access SC Switchable features of SCSARDPD if CGL031 is installed                     CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD   7                                           CGL031
     C                     PARM '*VERIFY' POPTN   7                                           CGL031
     C                     PARM 'CGL031'  PSARD   6                                           CGL031
     C           SCSARD    PARM SCSARD    DSSDY                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           PRTCD     ANDNE'*NRF'                                                        CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL031
     C                     Z-ADD40        DBASE                                               CGL031
     C                     MOVELPSARD     DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     MOVE *ON       *INLR                                               CGL031
     C                     DUMP                                                               CGL031
     C                     RETRN                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           PRTCD     IFEQ *BLANKS                                                       CGL031
     C                     MOVE 'Y'       CGL031  1                                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'N'       CGL031                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C**  Access Tax DETAILS For European WTAX Transaction Type                               CGL031
      *                                                                                       CGL031
     C           CGL031    IFEQ 'Y'                                                           CGL031
     C                     READ SDSTAXL1                 80                                   CGL031
      *                                                                                       CGL031
     C           *IN80     IFEQ *ON                                                           CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDSTAXPD'DBFILE                                              CGL031
     C                     MOVEL'*VERIFY' DBKEY                                               CGL031
     C                     Z-ADD41        DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     MOVE *ON       *INU7                                               CGL031
     C                     MOVE *ON       *INU8                                               CGL031
     C                     MOVE *ON       *INLR                                               CGL031
     C                     RETRN                                                              CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE TXTXTT    WTRAT   50                                          CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C/COPY WNCPYSRC,SE2450C010
     C*                                                                   S01182
     C                     ENDSR                                       **
     C*                                                                   S01182
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  AUDIT  - Subroutine to update Audit Files and produce the    *
     C*           Control Report.                                     *
     C*                                                               *
     C*****************************************************************
     C*
     C           AUDIT     BEGSR                           ** AUDIT **
     C*
     C** COMPARE COUNT OF ACTIONS TO AUDIT FILE ACTIONS
     C*
     C                     MOVEA'00'      *IN,79
     C           *IN79     DOWEQ'0'
     C                     READ SEKEYAU                  79
     C           *IN79     IFEQ '0'
     C                     ADD  NORE      SANORE  50
     C                     ADD  HRWN      SHRWN
     C                     ADD  HRDC      SHRDC
     C                     MOVE '1'       *IN80
     C                     END
     C*
     C* DATA BASE ERROR
     C*
     C           *INU7     IFNE '1'
     C           *IN79     IFEQ '1'
     C           *IN80     ANDEQ'0'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SEKEYA'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            * DB ERROR 08 *
     C                     Z-ADD8         DBASE            ***************
     C                     SETON                       U7U8
     C                     OUT  LDA                                       S01117
     C                     DUMP                                           S01117
     C                     END
     C                     END
     C                     END
     C*
     C                     Z-ADDINT,1     WHASHT
     C                     Z-ADDDEC,1     WHASHD
     C           *INU8     IFNE '1'
     C           SANORE    IFNE W01CNT
     C           SHRWN     ORNE WHASHT
     C           SHRDC     ORNE WHASHD
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *IN29
     C                     END
     C                     END
     C*
     C* OUTPUT CONTROL REPORT
     C*
     C                     WRITEHEADAU
     C           *INU7     IFEQ '1'
     C                     WRITEERROR
     C                     ELSE
     C           W01CNT    IFEQ 0
     C                     WRITENONE
     C                     ELSE
     C                     Z-ADDINT,2     WGHAST
     C                     Z-ADDDEC,2     WGHASD
     C                     WRITECONTROL
     C*
     C                     END
     C           *INU4     IFEQ '0'                                       093919
     C                     WRITENOMISS                                    093919
     C                     END                                            093919
     C                     END
     C*
     C***********          WRITETRAILAU                                   E29170
     C***********AKSI      IFEQ 'Y'                                       S01117
     C           BKAKSI    IFEQ 'Y'                                       S01117
     C           DETL2     ANDEQ'Y'                                       E34388
     C           LCNT2     IFGT 64
     C***********          Z-ADD0         BRCH                            S01117
     C                     MOVE *BLANKS   BRHA                            S01117
     C                     WRITEHEADP2
     C                     END
     C                     WRITETRAILP2
     C                     END
     C           DETL1     IFEQ 'Y'                                       E34388
     C           LCNT1     IFGT 64
     C                     WRITEHEADP1
     C                     END
     C                     WRITETRAILP1
     C                     END                                            E34388
     C*
     C** OUTPUT S/GEST HEADER
     C*
     C                     MOVEL'H'       RECI
     C*
     C                     WRITEGESTHHF
     C*
     C** OUTPUT S/GEST TRAILER
     C*
     C                     MOVEL'T'       RECI
     C*
     C*  ADD 2 TO COUNT OF RECORDS WRITTEN FOR HEADER & TRAILER
     C*
     C           W02CNT    ADD  2         NORE1
     C*
     C                     Z-ADDINT,2     HRWN
     C                     Z-ADDDEC,2     HRDC
     C*
     C                     WRITEGESTZZF
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
      *****************************************************************   S01117
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
     C*                                                                   E29170
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUM1    ZSNUM1  60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ     5                       E29170
     C                     PARM BRHA      SENTY   3                       E29170
     C                     PARM           SFILE1                          E29170
     C                     PARM           ZSNUM1                          E29170
     C                     PARM           ZSERR   1                       E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFP2 -- SUBROUTINE TO REGISTER P2 PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFP2     BEGSR                            ** RCFP2 **   E29170
     C*                                                                   E29170
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUM2    ZSNUM2  60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM BRHA      SENTY                           E29170
     C                     PARM           SFILE2                          E29170
     C                     PARM           ZSNUM2                          E29170
     C                     PARM           ZSERR                           E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFAU     BEGSR                            ** RCFAU **   E29170
     C*                                                                   E29170
     C**      ENSURE AUDIT SPOOL FILE RECORDED BY RCF                     E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM *BLANKS   SENTY                           E29170
     C                     PARM           SFILEU                          E29170
     C                     PARM           ZSNUMU                          E29170
     C                     PARM *BLANK    ZSERR                           E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C*****************************************************************   E29170
     C/EJECT
     C********************************************************************S01522
     C**  Subroutine SRPNAR determines the required narratives.         **S01522
     C********************************************************************S01522
     C           SRPNAR    BEGSR                           * S R P N A R *S01522
     C*                                                                   S01522
     C* Define the data structure parameter:                              S01522
     C*                                                                   S01522
     C           *LIKE     DEFN CGPNAR    ##PNAR                          S01522
     C           *LIKE     DEFN MNCUST    ##CUST                          S01522
     C           *LIKE     DEFN MNCYCD    ##CCY                           S01522
     C           *LIKE     DEFN MNACCD    ##ACCD                          S01522
     C           *LIKE     DEFN MNACSQ    ##ACSQ                          S01522
     C           *LIKE     DEFN MNBRCA    ##BRCA                          S01522
     C           *LIKE     DEFN MNTRNO    ##TRNO                          S01522
     C           *LIKE     DEFN MNSECN    ##SECN                          S01522
     C           *LIKE     DEFN MNFFIN    ##FFIN                          S01522
     C*                                                                   S01522
     C                     CLEARCGPNAR                                    S01522
     C                     CLEAR##PRM1                                    086125
     C*                                                                   S01522
     C* If the facility is switched off or unavailable,                   S01522
     C*  or UDC is not installed, exit this subroutine:                   S01522
     C*                                                                   S01522
     C           SEPNAR    IFNE 'Y'                                       S01522
     C                     GOTO EXPNAR                                    S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C* Determine the customer's name:                                    S01522
     C*                                                                   S01522
     C********** ##CUST    IFNE *ZEROS                                                 089765 CSD027
     C           ##CUST    IFNE *BLANKS                                                       CSD027
     C                     MOVEL##CUST    ##KEY     P                     S01522
     C*                                                                   S01522
     C***********          CALL 'AOCUSTR0'                                             S01522 229342
     C                     CALL 'AOCUSTR1'                                                    229342
     C                     PARM           ##RTN   7                       S01522
     C                     PARM '*KEY   ' ##OPT   7                       S01522
     C                     PARM           ##KEY  10                       S01522
     C                     PARM           ##STS   7                       S01522
     C***********SDCUST    PARM SDCUST    DSSDY                                        S01522 229342
     C           SDCUST    PARM SDCUST    DSLDY                                               229342
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C           BBCLST    ANDNE'Y'                                                           229342
     C                     MOVEL'SDCUSTPD'DBFILE             *************S01522
     C                     MOVEL'101'     DBASE              * DBERR 101 *S01522
     C                     MOVEL##KEY     DBKEY              *************S01522
     C                     EXSR *PSSR                                     S01522
     C                     EXSR *PSSR                                     S01522
     C                     SETON                     U7U8                 089765
     C                     ENDIF                                          S01522
     C*...................................................................S01522
     C/EJECT                                                              S01522
     C*...................................................................S01522
     C* Determine the value for the narrative using AOPNARR0:             S01522
     C*                                                                   S01522
     C/COPY WNCPYSRC,SE2450C064
     C                     MOVE 'SE'      MNMODI                          S01522
     C                     MOVE ##CUST    MNCUST                          S01522
     C                     MOVE ##CCY     MNCYCD                          S01522
     C                     MOVE ##ACCD    MNACCD                          S01522
     C                     MOVE ##ACSQ    MNACSQ                          S01522
     C                     MOVE ##BRCA    MNBRCA                          S01522
     C                     MOVE BOKC      MNBOKC                          S01522
     C                     MOVE BBCRNM    MNCRNM                          S01522
     C                     MOVELPNAR      MNNARR    P                     S01522
     C                     MOVE ASOC      MNASOC                          S01522
     C                     MOVE ACNO      MNRACN                          S01522
     C                     MOVE ##TRNO    MNTRNO                          S01522
     C                     MOVE ##SECN    MNSECN                          S01522
     C                     MOVE ##FFIN    MNFFIN                          S01522
     C/COPY WNCPYSRC,SE2450C086
     C*                                                                   S01522
     C                     CALL 'AOPNARR0'                                S01522
     C                     PARM           ##RTN                           S01522
     C                     PARM           ##MGID  7                       S01522
     C                     PARM           ##PRM1                          086125
     C           CGPNAR    PARM CGPNAR    ##PNAR                          S01522
     C                     PARM           ##NARR 50                       S01522
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C           BBCLST    ANDNE'Y'                                                           229342
     C                     MOVEL'CGPNARPD'DBFILE             *************S01522
     C                     MOVEL'102'     DBASE              * DBERR 102 *S01522
     C                     MOVELMNCUST    DBKEY              *************S01522
     C                     EXSR *PSSR                                     S01522
     C                     SETON                     U7U8                 089765
     C                     GOTO DBERR                                     089765
     C                     ENDIF                                          S01522
     C           BBCLST    IFNE 'Y'                                                           229342
     C                     MOVEL##NARR    PNAR      P                     149569
     C                     END                                                                229342
     C*                                                                   089765
     C                     END                                            089765
     C*                                                                   S01522
     C***********          MOVEL##NARR    PNAR      P              S01522 149569
     C*                                                                   S01522
     C           ##REVI    IFEQ '*'                                       S01522
     C                     MOVE ##REVI    PNAR                            S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C           EXPNAR    TAG                             < EXPNAR       S01522
     C*                                                                   S01522
     C                     ENDSR                                          S01522
     C********************************************************************S01522
     C**  Subroutine #TRTYP Setup Transaction Type if PB module is On   **CPB002
     C********************************************************************CPB002
     C           #TRTYP    BEGSR                                          CPB002
     C*                                                                   CPB002
     C* If Private Banking is On                                          CPB002
     C*                                                                   CPB002
     C           BGN4ST    IFEQ 'Y'                                       CPB002
     C           2         SUBSTACKY:9    WKSTYP  2                       CPB002
     C           WKSTYP    CHAINSECOATL1             71                   CPB002
     C           MMPTYP    IFEQ 'CC'                                      CPB002
     C           *IN71     ANDEQ*OFF                                      CPB002
     C                     Z-ADD98000     TRAT                            CPB002
     C                     ENDIF                                          CPB002
      *                                                                   CPB002
     C           2         SUBSTACKY:19   WKCAMC  2                       CPB002
     C           WKCAMC    IFEQ 'WR'                                      CPB002
     C                     Z-ADD98101     TRAT                            CPB002
     C                     ENDIF                                          CPB002
     C           WKCAMC    IFEQ 'WD'                                      CPB002
     C                     Z-ADD98102     TRAT                            CPB002
     C                     ENDIF                                          CPB002
     C           WKCAMC    IFEQ 'BW'                                      CPB002
     C                     Z-ADD98103     TRAT                            CPB002
     C                     ENDIF                                          CPB002
      *                                                                                       CGL031
     C           WKCAMC    IFEQ 'ET'                                                          CGL031
     C           CGL031    ANDEQ'Y'                                                           CGL031
     C                     Z-ADDWTRAT     TRAT                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                   CPB002
     C                     ENDIF                                          CPB002
      *                                                                   CPB002
     C                     ENDSR                                          CPB002
     C********************************************************************CPB002
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZHASHZ3
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT
      ***
     C/COPY WNCPYSRC,SE2450C023
     C********************************************************************243764
     C*                                                                   243764
     C*  RCFP3 -- SUBROUTINE TO REGISTER P3 PRINTER FILE VIA RCF          243764
     C*                                                                   243764
     C********************************************************************243764
     C*                                                                   243764
     C           RCFP3     BEGSR                            ** RCFP3 **   243764
     C*                                                                   243764
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    243764
     C*                                                                   243764
     C                     Z-ADDSFNUM3    ZSNUM3  60                      243764
     C**                                                                  243764
     C                     CALL 'ZSFILE'                                  243764
     C                     PARM           SEQ     5                       243764
     C                     PARM BRHA      SENTY   3                       243764
     C                     PARM           SFILE3                          243764
     C                     PARM           ZSNUM3                          243764
     C                     PARM           ZSERR   1                       243764
     C*                                                                   243764
     C           ZSERR     IFEQ 'Y'                                       243764
     C*                                                                   243764
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       243764
     C*                                                                   243764
     C                     SETON                     U7U8LR               243764
     C                     RETRN                                          243764
     C                     END                                            243764
     C*                                                                   243764
     C                     ENDSR                                          243764
     C*                                                                   243764
     C********************************************************************243764
     C/EJECT                                                              243764
      *  FIN 243764************************                               243764
**  CPY@
(c) Finastra International Limited 2001
** MESS
CURRENCY IMBALANCE
SEC TRADING ACCRUAL SUMMARY                                               E14537
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
