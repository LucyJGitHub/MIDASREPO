     H                                                                    SE2505
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Set End of Previous Month')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module
     F*                                                               *
     F*  SE2505 - SET DATE OF LAST WORKING DAY OF LAST MONTH          *
     F*                                                               *
     F*  Function: To set the date of the last working day in the     *
     F*  (I/C INT) previous month                                     *
     F*                                                               *
     F*  Called by: SDC01 - Input Cycle Initiation                    *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. S01502             Date 08Jul94               *
      *                 052254             Date 10Jan94               *
     F*                 S01117             DATE 07JUN91               *
     F*                 E24423             DATE 23JAN91               *
     F*                 S01186             DATE 02/12/88              *
     F*                 S01169             DATE 14/07/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
     F*  S01502 - BLI Telekurs Processing.  Recompiled due to change  *
     F*           in length of SESTAT, 133 long.                      *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01117 - Multi-branching                                     *
     F*  E24423 - THE UPDATING OF MONTH DATES ON SESTAT SHOULD DEPEND *
     F*           ON THE RUN DATE AS THIS WILL BE MORE RELIABLE AND   *
     F*           WILL WORK WHEN THE RUN DATE IS ADVANCED BEYOND THE  *
     F*           NEXT WORKING DAY AND WHEN SYSTEM IS RUN ON HOLIDAYS *
     F*  S01186 - SECURITIES TRADING 3.1 (3.1 INCORPORATION FIX)      *   S01186
     F*           (SESTAT DEFINED WITH INCORRECT LENGTH)              *   S01186
     F*  S01169 - SECURITIES TRADING 3.1 (BAER INCORPORATION)         *   S01169
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*                                                                   E24423
     FTABTB10 IF  E                    DISK                               E24423
     F*                                                                   E24423
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*U7-U8 DATABASE ERROR                                           *
     F*                                                               *
     F*****************************************************************
      /SPACE 3
     F*****************************************************************
     F*                                                               *
     F*  I N D E X   T O   S U B R O U T I N E S                      *
     F*                                                               *
     F*   ZDATE2  -SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.       *
     F*   *PSSR   -  Error handling                                   *   S01117
     F*                                                               *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZDATE2Z1
     E                    CPY@    1   1 80
      /EJECT
     I*
     IJNSTAT     UDS                            200
     I*
     I**   JOURNALING DATA AREA
     I*
     I                                    P 103 1050PRUN
     I*
     I*SESTAT*****UDS                             60                      S01169
     I*SESTAT*****UDS                             63                S01169S01186
     I***SESTAT*****UDS                            128              S01186S01502
     ISESTAT     UDS                            133                       S01502
     I*
     I**   SECURITIES TRADING MODULE DATA AREA
     I*
     I                                        8  120EOPM
     I                                       13  19 EOMM
     I                                       21  21 EOM
     I                                       56  600EOPT
     I*
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I*LDA******* UDS                            256                      S01117
     ILDA         DS                            256                       S01117
     I*
     I**   LOCAL DATA AREA
     I*
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     C/EJECT
     C*                                                                   S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBLOT                           S01117
     C                     MOVEL'SE2505'  DBPGM                           S01117
     C                     OUT  LDA                                       S01117
     C*                                                                   E24423
     C*  ACCESS ICD1                                                      E24423
     C*                                                                   E24423
     C                     READ TABTB10F                 99               E24423
     C           *IN99     IFEQ '1'                                       E24423
     C           RECI      ORNE 'D'                                       E24423
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE           ***************E24423
     C                     MOVE 'ICD1'    DBKEY            * DB ERROR 01 *E24423
     C                     Z-ADD1         DBASE            ***************E24423
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C*                                                                   E24423
     C                     ELSE                                           E24423
     C*
     C*****CHECK*IF*AT*END*OF*MONTH*AND*UPDATE*DATES**********************E24423
     C*
     C***********EOM       IFEQ 'Y'                                       E24423
     C*                                                                   E24423
     C*   CHECK RUN DATE AND UPDATE DATES ON SESTAT                       E24423
     C*                                                                   E24423
     C           RUND      IFGT EOPT                                      E24423
     C*                                                                   E24423
     C                     SETOF                     98
     C*
     C**   RESET DATE OF LAST WORKING DAY OF PREVIOUS MONTH.
     C*
     C***********          Z-ADDPRUN      EOPM                            E24423
     C                     Z-ADDRUND      ZDAYNO                          E24423
     C                     EXSR ZDATE2                                    E24423
     C                     MOVE ZMNM,ZMTH SAVMTH  3                       E24423
     C*                                                                   E24423
     C           ZMNM,ZMTH DOUNESAVMTH                                    E24423
     C                     SUB  1         ZDAYNO                          E24423
     C                     EXSR ZDATE2                                    E24423
     C                     END                                            E24423
     C*                                                                   E24423
     C                     Z-ADDZDAYNO    EOPM                            E24423
     C*
     C* Reset End of Month dates for this month
     C*
     C***********EOPT      ADD  32        ZDAYNO                          E24423
     C           RUND      ADD  31        ZDAYNO                          E24423
     C                     EXSR ZDATE2
     C***********          MOVE ZMNM,ZMTH SAVMTH  3                       E24423
     C*
     C***********ZMNM,ZMTH DOUNESAVMTH                                    E24423
     C           ZMNM,ZMTH DOUEQSAVMTH                                    E24423
     C                     SUB  1         ZDAYNO
     C                     EXSR ZDATE2
     C                     END
     C*
     C                     Z-ADDZDAYNO    EOPT
     C                     MOVE ZADATE    EOMM
     C*
     C                     END
     C*                                                                   E24423
     C                     END                                            E24423
     C*
     C**   SET ON LAST RECORD INDICATOR AND RETURN
     C*
     C                     SETON                     LR
     C*
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
1648 C*****************************************************************
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
1648  ***
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Finastra International Limited 2001
