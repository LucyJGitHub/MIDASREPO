     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Review trades for bulk input')                *
/*OVRF*: OVRDBF FILE(TRADSDZ1) TOFILE(TRADSDY1) SHARE(*NO)          : *   S01401
/*OVRF*: OVRDBF FILE(TRADSDZ2) TOFILE(TRADSDY2) SHARE(*NO)          : *   S01401
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE3002 - REVIEW TRADES FOR BULK TRADE INPUT                  *
     F*                                                               *
     F*  Function: To allow review and amendment of defaults generated*
     F*   (I/C)    for trades entered via Bulk Input which have been  *
     F*            passed as a parameter.                             *
     F*                                                               *
     F*  Called by: SE3000 - Bulk Input                               *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. AR1075401          Date 01Jun20               *
      *  Prev Amend No. 248698             Date 01Jun20               *            
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 09Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 AR884341           Date 22Dec11               *
      *                 AR881600           Date 20Dec11               *
      *                 AR871625           Date 12Dec11               *
      *                 AR636394A          Date 09Sep10               *
      *                 AR636394           Date 06Sep10               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 CSD079             Date 05Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 17May06               *
      *                 CSE075             Date 17Nov05               *
      *                 CER001             Date 25Apr05               *
      *                 234967             Date 21Jul05               *
      *                 235547             Date 09Aug05               *
      *                 235546             Date 27Jul05               *
      *                 234871             Date 29Jul05               *
      *                 234635             Date 04Jul05               *
      *                 234552             Date 29Jun05               *
      *                 234440             Date 29Jun05               *
      *                 233607             Date 19May05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 229857             Date 07Oct04               *
      *                 227267             Date 10Jun04               *
      *                 226570             Date 27Jun04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 BUG2626            Date 26May04               *
      *                 CGL014             Date 20Oct03               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2573            Date 17May04               *
      *                 CRE020             Date 20Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 211407             Date 07Jan03               *
      *                 194370             Date 12Jul01               *
      *                 208241             Date 21Aug02               *
      *                 207543             Date 17Jul02               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 CSE039             Date 12Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 191807             Date 15Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 204833             Date 03May02               *
      *                 CSE034             Date 18Apr02               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      *                 198420             Date 22Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      *                 191878             Date 26Apr01               *
      *                 CSE022             Date 29Mar01               *
      *                 CSE016             Date 10Jan01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 165966             Date 31Jan01               *
      *                 189392             Date 26Jan00               *
      *                 187727             Date 15Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 12Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 179732             Date 15Jun00               *
      *                 088864             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE006             Date 02Jun99               *
      *                 171456             Date 12Nov99               *
      *                 CPB001             Date 13Sep99               *
      *                 156949             Date 24Nov99               *
      *                 145464             Date 23Oct98               *
      *                 CGL011             Date 20Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 01Dec98               *
      *                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
     F*                 149982             DATE 18DEC98               *
     F*                 149517             DATE 01DEC98               *
     F*                 143690             Date 05Oct98               *
     F*                 135566             Date 21May98               *
     F*                 CEU017             Date 03Mar98               *
     F*                 CSE007             Date 06Jan98               *
     F*                 CEU005             DATE 03FEB98               *
     F*                 102952             DATE 24FEB98               *
     F*                 CSE005             DATE 04FEB97               *
     F*                 112563             DATE 21APR97               *
     F*                 CAC002             Date 15Sep96               *
     F*                 S01408             Date 12Aug96               *
     F*                 084704             Date 12Aug96               *
     F*                 083039             Date 12Aug96               *
     F*                 079845             Date 12Aug96               *
     F*                 059110             Date 12Aug96               *
     F*                 088047             DATE 26JUN96               *
     F*                 104032             DATE 04JUN96               *
     F*                 102736             DATE 02APR96               *
     F*                 CSW003             DATE 09FEB96               *
     F*                 100228             DATE 31MAY96               *
     F*                 066690             DATE 13MAY96               *
     F*                 067584             DATE 02MAy96               *
     F*                 064939             DATE 02MAY96               *
     F*                 S01408             DATE 26APR96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 099649             DATE 17APR96               *
     F*                 100239             DATE 22FEB96               *
     F*                 099817             DATE 16FEB96               *
     F*                 093376             DATE 12OCT95               *
     F*                 087651             DATE 25OCT95               *
     F*                 092961             DATE 03OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 093524             DATE 25SEP95               *
     F*                 S01408             DATE 17AUG95               *
     F*                 086491             DATE 15JUN95               *
     F*                 085546             DATE 13JUN95               *
     F*                 084735             DATE 23MAY95               *
     F*                 086385             DATE 18APR95               *
     F*                 085862             DATE 16MAR95               *
     F*                 081959             DATE 23JAN95               *
     F*                 081441             DATE 17JAN95               *
     F*                 081490             DATE 13JAN95               *
     F*                 S01408             DATE 08MAR95               *
     F*                 081382             DATE 23DEC94               *
     F*                 080681             DATE 22DEC94               *
     F*                 S01496             DATE 01NOV94               *
     F*                 S01486             DATE 31OCT94               *
     F*                 S01509             DATE 29NOV94               *
     F*                 S01510             DATE 29NOV94               *
     F*                 074086             DATE 12OCT94               *
     F*                 069175             DATE 12OCT94               *
     F*                 064575             DATE 15AUG94               *
     F*                 068476             DATE 29JUN94               *
     F*                 067630             DATE 29JUN94               *
     F*                 067629             DATE 28JUN94               *
     F*                 067531             DATE 23JUN94               *
     F*                 067525             DATE 20JUN94               *
     F*                 S01408             DATE 17MAY94               *
     F*                 065301             DATE 06MAY94               *
     F*                 S01446             DATE 21FEB94               *
     F*                 S01448             DATE 21FEB94               *
     F*                 066814             DATE 10FEB94               *
     F*                 066097             DATE 25JAN94               *
     F*                 065894             DATE 19JAN94               *
     F*                 050727             DATE 12JAN94               *
     F*                 050725             DATE 11JAN94               *
     F*                 065546             DATE 11JAN94               *
     F*                 065543             DATE 11JAN94               *
     F*                 065537             DATE 11JAN94               *
     F*                 065524             DATE 11JAN94               *
     F*                 065429             DATE 07JAN94               *
     F*                 065422             DATE 07JAN94               *
     F*                 052254             DATE 06JAN94               *
     F*                 065303             DATE 05JAN94               *
     F*                 065302             DATE 05JAN94               *
     F*                 065295             DATE 05JAN94               *
     F*                 065028             DATE 23DEC93               *
     F*                 065024             DATE 23DEC93               *
     F*                 065019             DATE 23DEC93               *
     F*                 065016             DATE 23DEC93               *
     F*                 065009             DATE 23DEC93               *
     F*                 065008             DATE 23DEC93               *
     F*                 065006             DATE 23DEC93               *
     F*                 065005             DATE 23DEC93               *
     F*                 065004             DATE 23DEC93               *
     F*                 065002             DATE 23DEC93               *
     F*                 064999             DATE 23DEC93               *
     F*                 064997             DATE 23DEC93               *
     F*                 043802             DATE 22DEC93               *
     F*                 032429             DATE 22DEC93               *
     F*                 030834             DATE 21DEC93               *
     F*                 029335             DATE 21DEC93               *
     F*                 028348             DATE 21DEC93               *
     F*                 028336             DATE 21DEC93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 047922             DATE 01FEB93               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E43208             DATE 01SEP92               *
     F*                 E37020             DATE 11MAR92               *
     F*                 E31953             DATE 11MAR92               *
     F*                 E36795             DATE 11MAR92               *
     F*                 E36794             DATE 11MAR92               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 E24724             DATE 18APR91               *
     F*                 S01117             DATE 30JAN91               *
     F*                 S01195             DATE 30JAN91               *
     F*                 S01220             DATE 07AUG90               *
     F*                 S01269             DATE 11JUL90               *
     F*                 S01271             DATE 19JUN90               *
     F*                 E23593             DATE 10SEP90               *
     F*                 E23204             DATE 08AUG90               *
     F*                 E21718             DATE 01MAY90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21313             DATE 06MAR90               *
     F*                 E21257             DATE 27FEB90               *
     F*                 E21115             DATE 13FEB90               *
     F*                 E21050             DATE 10FEB90               *
     F*                 E21051             DATE 10FEB90               *
     F*                 E21052             DATE 10FEB90               *
     F*                 E21053             DATE 10FEB90               *
     F*                 E21054             DATE 10FEB90               *
     F*                 E21055             DATE 10FEB90               *
     F*                 E21056             DATE 10FEB90               *
     F*                 E21057             DATE 10FEB90               *
     F*                 E21058             DATE 10FEB90               *
     F*                 E21059             DATE 10FEB90               *
     F*                 E21060             DATE 10FEB90               *
     F*                 E21061             DATE 10FEB90               *
     F*                 E19945             DATE 10FEB90               *
     F*                 E20380             DATE 08DEC89               *
     F*                 E20196             DATE 02NOV89               *
     F*                 E14496             DATE 02NOV89               *
     F*                 S01199             DATE 03AUG89               *
     F*                 S01190             DATE 11/07/89              *
     F*                 E17830             DATE 27/06/89              *
     F*                 E16772             DATE 19/06/89              *
     F*                 E18010             DATE 24/05/89              *
     F*                 E17876             DATE 11/04/89              *
     F*                 E17704             DATE 31/03/89              *
     F*                 E17303             DATE 31/03/89              *
     F*                 E16843             DATE 09/02/89              *
     F*                 E16808             DATE 09/02/89              *
     F*                 S01175             DATE 07/11/88              *
     F*                 S01176             DATE 14/08/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  AR1075401 - Increase length field @PNOPO in SE6710/SE7570.   *
      *              (Child: AR1075402)                               *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *            
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  AR884341 - Additional stamp tax liable flag validation       *
      *  AR881600 - Wrong stamp tax liable validation                 *
      *  AR871625 - New Stamp Tax fields are missing in Bulk Input    *
      *  AR636394A - Clearance Type field was not populated in BULK   *
      *              input when Security's currency is JPY            *
      *  AR636394 - Pay Code field was not populated in BULK input    *
      *  CSW210 - SWIFT 2010 Changes (Recompile)                      *
      *  CSD079 - Enhanced Customer Maintenance API (Recompile)       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
      *           (Recompile)                                         *
      *  CER001 - Lux Upgrade to MidasPlus                            *
      *  234967 - Default of fiscal price is not done and unable to   *
      *           insert one due to error code 801.  Set the correct  *
      *           parameter of customer details for call to module    *
      *           SEVSEFSPR2.  Complete this part of fix 234440.      *
      *  235547 - Defaulting incorrect first time into program        *
      *  235546 - EU Tax backvaluations                               *
      *  234871 - No EU tax is being computed for mutual funds.  Pass *
      *           the correct trade price for mutual funds with trade *
      *           basis 'P'.                                          *
      *  234635 - Blocking check should be warning on first screen    *
      *  234552 - Add blocking check for backvaluations               *
      *  234440 - Use new file ETCPOSND for average price, average    *
      *           fiscal price, purchased interest etc                *
      *         - Change Control 1 Part 4 - For Switzerland only,     *
      *           bonds at at a discount will have their fiscal price *
      *           calculated on a yield curve, and funds will not     *
      *           take into account the profit on a sale when deciding*
      *           the tax amount - THE LATTER PART HAS BEEN INSERTED  *
      *           AND THEN REMOVED AGAIN                              *
      *           Add the EU Tax amount field to the screen           *
      *  233607 - Fiscal Price doesn't appear on SE Trade screen      *
      *           of Bulk Input                                       *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  227267 - POSITION BLOCKED ALTHOUGH NO BLOCK FOR ALLOCATION   *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  BUG2626 - Webfacing changes. Recompile due to changes in     *
      *            SE3002DF.  Protect 'Profit Centre' field when it   *
      *            is not displayed.                                  *
      *  CGL014 - Collaterals Processing                              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2573 - Ensure that the Market centre field will be de-    *
      *            faulted correctly.                                 *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  208241 - Recompiled over changed /CPY ZSDESCZ3.              *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompile over changed ZYLDZ2.                      *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2               *
      *  CSE039 - Automatic Settlement of Trades - Default Auto-Sett. *
      *           Ind from Custodian                                  *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  191807 - Base currency conversion error in bulk input.       *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  204833 - Correct display of SSI.                             *
      *  CSE034 - Standard Settlement Instruction improvements        *
     F*  CSE031 - Coupon Fixing for Floating Rate Notes.              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  180707 - No Position Settlements generated. Recompile over   *
     F*           changes in /COPY ZNCDZ3.                            *
      *  198420 - Function key pressed (F3, F12) should be passed     *
      *           back to the controlling program.                    *
      *  CSE028 - Standing Settlement Instructions Enhancement        *
     F*  191878 - Set up clerance type flag automatically.            *
      *  CSE022 - Depository Definition Enhancement                   *
      *  CSE016 - Extended Security Descriptions                      *
     F*  165966 - F12 return to previous screen                       *
      *  189392 - Withholding tax not shown on Enquiry screen         *
      *  187727 - WHTX amount should be shown in nominal ccy          *
      *  CSE023 - Treaty Withholding Tax                              *
     F*  179732 - Addition of Account officer value and correction    *
     F*           of the parameters passed to AOPRFMR0.               *
     F*  088864 - Recompile over amended /COPY ZPCINTZ1               *
     F*  CSE006 - Repurchase Agreements (REPOs) enhancement           *
     F*  171456 - Do not allow settlement method of '00' on complete  *
     F*           trades.                                             *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  156949 - Correct calculation of Exchange Rate Settl->Portf.  *
     F*           as the @PSPXR has been changed from 13,8 to 13,0.   *
     F*           And apply 149422(from SE0050) to take VLCY instead  *
     F*           of SETC for the calculation of SPXR.                *
     F*  145464 - Set portfolio reference by default                  *
      *  CGL011 - Collateral Processing for Midas                     *
      *  CAC005 - PCA-SE Enhancement.                                 *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  149982 - EXCHANGE RATE IS NOT EXACTLY THE SAME WITH THAT IN  *
     F*           THE EURO EXCHANGE RATE. USE THE EURO EXCHANGE RATE  *
     F*           FROM SDCURRPD IF THE SETTLEMENT CCY IS EUR AND IN   *
     F*           CCY OR NOMINAL CCY IS EUR AND IN CCY                *
     F*  149517 - OLD SECURITIES ARE NOT BLOCKED AFTER REDENOMINATION *
     F*  143690 - Incorrect Mult/Div Ind. was being used when EURO    *
     F*           CCY was involved. Fix is to reverse the M/D ind. if *
     F*           Nominal CCY is equal to the EURO CCY.               *
     F*  135566 - Exchange Rate and Mult/Div Ind field protected      *
     F*           even if neither nominal nor settlement currencies   *
     F*           is Euro currency.                                   *
     F*  CSE007 - Corporate Actions                                   *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*  CEU005 - EMU SE Settlement Ccy Conversion.                   *
     F*  102952 - If S01496 is on then check only if issuer is defined*
     F*           like a customer and not like a security client.     *
     F*           (THIS FIX COMPLETES CORRECTION 92394 IN SE0050)     *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD/ZACCR).   *
     F*  112563 - Header and footer changes required for GUI          *
     F*           Multilanguage support.                              *
     F*  CAC002 - Profit Centre Accounting Development Phase 2:       *
     F*           If Analytical Accounting is installed, replace      *
     F*           Profit Centre field with 2 new fields 'Book Profit  *
     F*           Centre' and 'Transaction Profit Centre'.  A new     *
     F*           'Margin' field will also be added.                  *
     F*  S01408 - Core hook SE3002CP18 added                          *
     F*  S01408 - Core hook SE3002CP17 added                          *
     F*  S01408 - Core hook SE3002CP16 added                          *
     F*  S01408 - Core hook SE3002CP15 added                          *
     F*  S01408 - Core hook SE3002CP14 added                          *
     F*  S01408 - Core hook SE3002CP13 added                          *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  079845 - Ex-date default not working for bulk input.         *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  104032 - Pass Value date to default Settlement request to N  *
     F*           if backvalued for MT5xx                             *
     F*  102736 - Close CUBRD to prevent pgm message                  *
     F*  CSW003 - MT5xx Message Generation - Phase 2                  *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  067584 - Initialise nominal amount work field for each       *
     F*           transaction                                         *
     F*  064939 - Allow settlement on retail account which is opened  *
     F*           on value date (Compare to 057928 in SE0050)         *
     F*  S01408 - Core hook SE3002CP12 added                          *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  099649 - If day adjustment on the trade is the same as on   **
     F*           the security, do not treat as an interest          **
     F*           discrepancy. Recompile over amended subroutine      *
     F*           ZPCINTZ1.                                           *
     F*  100239 - Bulk Trades changed to Trades Format.               *
     F*  099817 - Settlement Method 14 does not accept a Retail       *
     F*           account number                                      *
     F*  093376 - Settl. 15 for TS does not work (error code 236)     *
     F*  087651 - Set up branch code correctly for settlement type 15 *
     F*           (through a counterparty's designated account)       *
     F*         - If 'Pay From/To' Branch is blank, use booking       *
     F*           branch to determine settlement details.             *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*           and over ZSETAC which was amended by 085862 (wrong  *
     F*           Settlement Branch Code Calculation)                 *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  093524 - For processing type '8', the current factor must be *
     F*           taken into consideration for the calculation of the *
     F*           countervalue                                        *
     F*  S01408 - Core hook SE3002CCP5 added                          *
     F*           Core hook SE3002CCP6 added                          *
     F*           Core hook SE3002CCP7 added                          *
     F*           Core hook SE3002CCP8 added                          *
     F*           Core hook SE3002CCP9 added                          *
     F*           Core hook SE3002CP10 added                          *
     F*           Core hook SE3002CP11 added                          *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  085546 - The default for capacity should always be 0.        *
     F*  084735 - Recompile over changed file SE50DT.                 *
     F*  086385 - 081490 fix not complete                             *
     F*  085862 - ZSETAC SHOULD USE BRANCH                            *
     F*  081959 - Use BGPFMG instead of INU4 for Port. Man.           *
     F*  081441 - ZSETO is returned blank from subroutine ZSETAC.     *
     F*  081490 - PB SE Enhancement Early Redemption missing (S10978) *
     F*         -                Plausibility Checks missing (S10981) *
     F*  S01408 - Core hook SE3002IIPG added                          *
     F*           Core hook SE3002CCPG added                          *
     F*           Core hook SE3002CCP1 added                          *
     F*           Core hook SE3002CCP2 added                          *
     F*           Core hook SE3002CCP3 added                          *
     F*           Core hook SE3002CCP4 added                          *
     F*  081382 - In case of an agency trade when program is recalled *
     F*           the program does not verify if PM is on.            *
     F*  080681 - Database error on SDCURRPD with portfolio           *
     F*           currency as key.                                    *
     F*  S01496 - Jyske Enhancements upgrade to Release 10            *
     F*  S01486 - Private Banking upgrade to Release 10               *
     F*  S01509 - Value Currency to be currency of Issuer of Payments *
     F*  S01510 - Dividend Payments Based on Ex-Date                  *
     F*  074086 - For error code 373 cursor was positioning on        *
     F*           PAY FROM/BRANCH field causing the help document to  *
     F*           start along way from the explanation of 373 which   *
     F*           is for the DELIVER TO/FROM fields.                  *
     F*  069175 - Broker_Code & Commission are not carried across     *
     F*           to the Client's side of an Agency Trade.            *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  068476 - W10/W09 Should act only as a warning error.         *
     F*  067630 - Add warning error 'W09' and 'W10' same as in SE0050 *
     F*  067629 - Change Msg. '500' to '373' so that it is the same   *
     F*           SE0050.                                             *
     F*  067531 - Program should allow user to change seq. number     *
     F*           for A/c with settlement method '15'.                *
     F*  067525 - Incorrect validation of 'Delivery to for A/C of'    *
     F*           field if short name was used.                       *
     F*  S01408 - Core hook SE3002FFPG added                          *
     F*           Core hook SE3002CLDS added                          *
     F*           Core hook SE3002CLD1 added                          *
     F*           Core hook SE3002CLD2 added                          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  S01448 - Bulk Input Enhancements:                            *
     F*           1) Trade and Value dates on second side of an       *
     F*              agency trade should default to those from the    *
     F*              first side.                                      *
     F*           2) Allow Agency Cross trades if permitted according *
     F*              to 'Allow Agency Trades Between Portfolio        *
     F*              Clients' ICD flag = 'Y'.  This changes rules on  *
     F*              defaulting and brokerage calculation.            *
     F*           3) Improve defaulting of Pay Code.                  *
     F*  S01446 - Customer Commissions (Courtage) enhancement:        *
     F*           Use Purchased Interest in SR/ZCCAL1 for new charge  *
     F*           method 'I'                                          *
     F*           Get details of single charge currency (from SE ICD) *
     F*           for conversion of charge amount to nominal currency *
     F*  066814 - Actual/Difference Indicator should not be allowed   *
     F*           to remain blank if Days Adjustment is not zero.     *
     F*  066097 - Settlement branch should not have to be Booking     *
     F*           Branch for Settlement method 15.                    *
     F*  065894 - Shortname in pay field is written to TRADSD         *
     F*  050727 - Do not force input of Settlement Branch,            *
     F*           unless actually required                            *
     F*  050725 - Protect Pay To/From Branch if Purchase/Sale         *
     F*  065546 - For a/c of fields are right-adjusted on file        *
     F*  065543 - Incorrect status shown on Review                    *
     F*  065537 - Should be able to leave profit centre blank.        *
     F*  065524 - If the security has different nominal ccy to the    *
     F*           payment ccy, the exchange rate defaults to that off *
     F*           the security.                                       *
     F*  065429 - Settlement method 15 is posting to suspense         *
     F*  065422 - Overridden Purchased Interest not shown on Review   *
     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
     F*  065303 - Capacity of '0' should be allowed. Capacity 2/3     *
     F*           prohibited for purchases and 5/6 for sales.         *
     F*           This incorporates E22981 from SE0050.               *
     F*           (Originally incorrectly annotated as 063503)        *
     F*  065302 - Incorrect validation on Days Adjustment             *
     F*  065295 - Defaults not picked up for AutoSettle & Settle Meth.*
     F*  065028 - If Deliver From = CEDEL C/Party must be Participant.*
     F*  065024 - Accrued indicator not reset after Value date amended*
     F*  065019 - Wrong ex-dividend default (incl. E21504 from SE0050)*
     F*  065016 - Wrong value date if formula is based on working days*
     F*  065009 - Should display countervalue if autocharges active.  *
     F*  065008 - Use screen Market Centre to determine charge default*
     F*  065006 - Problem when amending Broker Commission amount      *
     F*  065005 - Problem during validation & initialisation between  *
     F*           Clearance Type and Deliver From & To                *
     F*           See fix E14709 in SE0050                            *
     F*  065004 - Test for error ' 500' must not be executed if       *
     F*           the counterparty's classification is 'S' or 'D'     *
     F*           (see fix E20011 in SE0050)                          *
     F*  065002 - Charge Codes/Amounts not appear                     *
     F*           if Action Code is Enquiry and Autocharge Yes        *
     F*  064999 - Old Charge Codes fields not set up properly         *
     F*  064997 - Purchased Interest problem                          *
     F*         - The fix E20821 of SE0050 must be in SE3002:         *
     F*           If Accrual Indicator has been changed to 'F', show  *
     F*           the Interest Amount to be 0.                        *
     F*  043802 - Portfolio Customers should not be allowed for entry *
     F*           in Deliver To and Deliver From fields.              *
     F*  032429 - Trade date incorrectly validated when value date    *
     F*           changed.                                            *
     F*  030834 - Remove error code 334 and 315 sent for setl.meth.04 *
     F*           Pay Code 1, Clearance Type 3 and Pay To not         *
     F*           equal to Deliver From                               *
     F*  029335 - Only Grey Markets and incomplete trades can have    *
     F*           a clearance type of Zero.                           *
     F*  028348 - Incorrect validation of 'DELIVER FROM' and 'DELIVER *
     F*           TO' fields when clearance type is 5.                *
     F*  028336 - When shortname is used in pay to/from fields it must*
     F*           be converted to cust. no. when TRADSD is updated to *
     F*           avoid DB errors in trade confirmations.             *
     F*  S01401 - The generation of MT5xx SWIFT Messages if the       *
     F*           option is available.                                *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           SR. ZYLD)                                           *
     F*         - /COPY subroutines ZACCZZ1 and ZCNSDZ1 added (called *
     F*           from SR. ZYLD and ZCALCD)                           *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  047922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           - Recompiled due to changes to files and SR/ZYLD.   *
     F*  E43208 - Field AIBD changed to ISMA. ('Association of        *
     F*           International Bond Dealers' changed their name to   *
     F*           'International Securities Market Association').     *
     F*  E37020 - Investment type should not be used in the chaining  *
     F*           to STDSED to default the Settlement Currency        *
     F*  E31953 - Incorrect validation of Deliver From and Deliver    *
     F*           To when Clearance Type is 0                         *
     F*  E36795 - Cross rate needs to be calculated when defaulting   *
     F*           exchange rate                                       *
     F*  E36794 - Settlement mthd 01 was not accepting a valid nostro *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  E24724 - F/3 from 2nd screen does not exit program           *
     F*  S01117 - Release 10 Multibranching etc                       *
     F*  S01195 - New Holiday Processing                              *
     F*  S01220 - STRATEGIC RISK MANAGEMENT                           *
     F*           Recompiled over changed PF/SECTYD, PF/SEDEVD        *
     F*  S01269 - Trade Authorisation                                 *
     F*  S01271 - Recompiled for Pay/Receive in Input Cycle changes   *
     F*           to TRADSD and/or DPTMVD                             *
     F*  E23593 - Redundant code removed.                             *
     F*  E23204 - Recompiled over changed SR/ZPCINTZ1                 *
     F*  E21718 - Recompiled over changed SR/ZPCINT                   *
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21313 - Default Account Code and Sequence No. in addition to*
     F*           Customer Number in Pay To/From fields on Settlement *
     F*           Method '15'.                                        *
     F*  E21257 - Error when reviewing a trade for the second time.   *
     F*           for C/P Customer changes it to a Depot Customer     *
     F*           shortname                                           *
     F*  E21115 - Prevent Reallowance on Yield based trades           *
     F*  E21050 - Program did not display calculated purchased interes*
     F*           and calculated interest incorrectly. Incorporation  *
     F*           of new standard subroutine ZPCINTZ1 which also      *
     F*           handles days adjustment. Program needs to use SECEO *
     F*           in place of SECED. These comprise the Interest and  *
     F*           coupon calculation amendments applied to SE0050     *
     F*           under Error Fix E20085.                             *
     F*  E21051 - Program crashes if too many fields are in error.    *
     F*           because the error array is too small.               *
     F*  E21052 - Program crashes if you take Cmd 9 to review the     *
     F*           market part of an Agency trade from SE3000. DB      *
     F*           Error 05 in SECTY.                                  *
     F*  E21053 - Program crashes because it is possible to leave     *
     F*           settlement currency blank. Program accepts blank    *
     F*           or invalid settlement currency.                     *
     F*  E21054 - Program displayed both error fields even when the   *
     F*           first field was not full.                           *
     F*  E21055 - Coupon rate and current factor should be as at      *
     F*           value date.                                         *
     F*  E21056 - Event control date should be value date.            *
     F*  E21057 - Calculation of cross rate not performed. Program    *
     F*           zeros exchange rate when settlement currency is not *
     F*           equal to Nominal currency or payment currency.      *
     F*  E21058 - An error on the AIBD/IPMA field causes Market       *
     F*           indicator field to be highlighted incorrectly       *
     F*  E21059 - Settlement to any account must check to see that the*
     F*           account was opened before the value date of the     *
     F*           Trade.                                              *
     F*  E21060 - An entry in the for account of field should be      *
     F*           allowed on a trade purchase with settlement method  *
     F*           01 07 or 08.                                        *
     F*  E21061 - Program should not allow Auto Settle on Grey market *
     F*           trades.                                             *
     F*  E21062 - Actual/Difference indicator error didn't highlight  *
     F*           the field because of incorrect conditioning in      *
     F*           the diplay file. Recompile over changed SE3002DF.   *
     F*  E19945 - Account sequence should not default to 01 in all    *
     F*           cases.                                              *
     F*  E20380 - ZYLDZ1 ABD ZYLDZ2 CHANGED. ZLCDZ1 NOW NEEDED.       *
     F*  E20196 - ZACCRZ1 REDEFINED ZWMLT FIELD TO 150.               *
     F*  E14496 - CALCULATE ACCRUED INTEREST FOR DIVISOR BASIS 5      *
     F*  S01199 - HELP SYSTEM                                         *
     F*  S01190 - EUCLID FIX/ENHANCEMENTS                             *
     F*  E17830 - WHEN VALIDATION SETTLEMENT METHOD '04', A/C SEQUENCE*
     F*           SHOULD REFER TO BRANCH OF PAY FIELDS IF IN A        *
     F*           MULTIBRANCH ENVIRONMENT ELSE SHOULD DEFAULT TO 1    *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  E18010 - COMMAND KEYS CHANGED                                *
     F*  E17876 - REMOVE E17704, CAUSES SE2100 LOOP IN ALL TEST SYS'S.*
     F*  E17704 - RECOMPILE PROGRAM OVER CHANGED ZNCDZ3 SR            *
     F*  E17303 - RECOMPILE PROGRAM OVER CHANGED ZDYYRZ3 ZYLDZ1 ZYLDZ2*
     F*  E16843 - CHECK FOR BLOCKED RETAIL ACCOUNT.                   *
     F*  E16808 - ACCOUNT SEQUENCE DEFAULTS TO 00 AND NOT 01 AS IN    *
     F*           SPECIFICATION.                                      *
     F*  S01175 - EUCLID INCORPORATION                                *
     F*  S01176 - SECURITIES TRADING 3.1                              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     FSE3002DFCF  E                    WORKSTN                        UC
     FSECTY   IF  E           K        DISK
     F*TABSE***IF**E           K        DISK                              S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*TABTB20*IF**E                    DISK                           U1 S01117
     F*CLINT***IF**E           K        DISK                              S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     FINVTP   IF  E           K        DISK
     F*BOOKD***IF**E           K        DISK                              S01117
     FSEMKC   IF  E           K        DISK
     FSECGT   IF  E           K        DISK
     F***CUBRD***IF**E           K        DISK                            S01496
     FCUBRD   IF  E           K        DISK                           UC  S01496
     FSECUBRL0IF  E           K        DISK                           UC  S01496
     F            CUBRDDF                           KRENAMECUBRDSE        S01496
     F*CUBRC***IF  E           K        DISK                              S01176
     F**********  CUBRDDF                           KRENAMECUBRCF         S01176
     FSTDSED  IF  E           K        DISK
     FTRADS   IF  E           K        DISK
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMF
     F*SNAME***IF**E           K        DISK                              S01117
     F*********** CLINTCBF                          KRENAMESNAMEF         S01117
     FSEDEV   IF  E           K        DISK                               E21050
     F**SECED***IF**E****       K        DISK                             E21050
     FSECEO   IF  E           K        DISK                               E21050
     F            SEDEVDF                           KRENAMESEDEVDO        E21050
     F************SNDEVDF                           KIGNORE        E21050 E39495
     F            SNDEVDF                           KRENAMESNDEVDO        E39495
     FSEPCBD  IF  E           K        DISK                               S01117
     FSEPCCD  IF  E           K        DISK                               S01117
     FTRADSDZ1IF  E           K        DISK                               S01401
     FTRADSDZ2IF  E           K        DISK                               S01401
     FFDDIV   IF  E           K        DISK                               065019
     F            SEDEVDF                           KRENAMESEDEVD2        065019
     FPMPORTPDIF  E           K        DISK                           UC  S01486
     FPMPORTLLIF  E           K        DISK                           UC  066690
     F            PMPORTP0                          KRENAMEPMPORTYY       066690
     FPMHSEXPDIF  E           K        DISK                           UC  S01486
     FSDWHTTL5IF  E           K        DISK                               CSE023
     F            SDWHTTD0                          KRENAME@WHTTL5        CSE023
     FSDTXBSL1IF  E           K        DISK                               CSE023
     F            SDTXBSD0                          KRENAME@TXBSL1        CSE023
     FSDWTCSL1IF  E           K        DISK                               CSE023
     F            SDWTCSD0                          KRENAME@WTCSL1        CSE023
      *                                                                                       CAS006
     FSEDEVL9 IF  E           K        DISK         KINFSR *PSSR                              CAS006
     F            SEDEVDF                           KRENAMESEDEVD3                            CAS006
      *                                                                                     AR871625
     FTRADSQL0IF  E           K        DISK         KINFSR *PSSR                            AR871625
      *                                                                                     AR881600
     FSDCUSQL0IF  E           K        DISK         KINFSR *PSSR                            AR881600
     F*                                                                   S01408
     F** Core hook for externalisation.                                   S01408
     F/COPY WNCPYSRC,SE3002FFPG                                           S01408
     F*                                                                   S01408
     F*                                                                   S01176
      /EJECT
     F*****************************************************************   S01176
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01 - CHAIN or READ failure                                  *
     F*   02 - Protect Pay From Branch                                *   050725
     F*   03 - Protect Pay To Branch                                  *   050725
     F*   04 - Customer/Broker defaults found                         *
     F*   05 - Redisplay screen 2 - default amount generated          *
     F*   06 - Redisplay screen 1 - purch. int. has been recalculated *
     F*   07 - A validation error has occurred                        *   E21054
     F*   08 - Validation error on 'In Ccy in field 72'               *   CEU005
     F*   09 - Called from Buy-Sell Backs Maintenance                 *   CSE006
     F****10*-*Screen*2*is*being*displayed*****************************                       CAS006
     F*   11 - A validation error has occurred                        *
     F*   12 - Redisplay screen 1 from screen 2                       *
     F*   13 - Do not reset screen 2                                  *
     F*   14 - A Validation error has occurred in Charge Code/Amounts *   S01176
     F*   15 - Display 'In Ccy in field 72' field                     *   CEU005
     F*   16 - Account blocked for debits                             *   E16843
     F*   17 - Account blocked for credits                            *   E16843
     F*   18 - Multibranching environment                             *   S01117
     F*   19 - Originating Branch not used                            *   S01117
     F****20******HELP*requested*************                         *   S01199
     F****20*-*HELP*label*referencing*for*sale/purchase****************                S01199 233607
     F*   20 - CGL031 (Taxation of Savings Income) is enabled         *                       233607
     F*   21 - Validation error on Originating Branch                 *   S01117
     F*   22 - Validation error on Profit Centre                      *   S01117
     F*   23 - Validation error on FX Rate                            *   S01486
     F*   24 - Validation error on Mult/Div Indicator                 *   S01486
     F*   25 - Prevents the multiple display of an error code         *   S01175
     F*   26 - Profit Centre not used                                 *   S01117
     F*   27 - Protect Profit Centre                                  *   S01117
     F*   28 - Validation error on Portfolio Reference                *   S01486
     F*   29 - Portfolio Management is present                        *   S01486
     F*                                                               *   CAC002
     F*   30 - Analytical Accounting module is installed              *   CAC002
     F*   31 - Validation error on Book Profit Centre                 *   CAC002
     F*   32 - Validation error on Transaction Profit Centre          *   CAC002
     F*   33 - Protect exchange rate and M/D indicator                *   CEU005
     F*   34 - Validation error on Margin Points                      *   CAC002
     F*   35 - Indicator for TESTN                                    *
     F*   36 - Protect Book Profit Centre                             *   CAC002
     F*   37 - Protect Transaction Profit Centre                      *   CAC002
     F*   38 - Display Transaction Profit Centre                      *   CAC002
     F*   39 - Display Margin Points and Margin Amount                *   CAC002
     F*                                                               *   CAC002
     F*   40 - Protect screen fields for enquiry                      *
     F*   41 - Protect non-display charge codes/amounts (Autocharging)*
     F****42***Processing*type*is*1,3,5,6*or*8*and*trade*basis=*P*or*Y*   S01176
     F*   42 - The Processing Type is 1, 3, 5, 6, 8 or 9              *   S01176
     F*           and the Trade Basis = P or Y                        *   S01176
     F*   43 - Display price (trade basis is Y)                       *
     F*   44 - Display ex-dividend (processing type is 4 or 7)        *
     F*   45 - Display current factor (processing type is 8)          *
     F*   45 - Display EU Tax                                         *                       234440
     F*   46 - Display incomplete indicator on screen 2               *
     F*   47 - Protect settlement currency on screen 1                *
     F*   48 - Protect customer comm. code and amount (market client) *
     F*                                                               *
     F*                SCREEN 1              SCREEN 2                 *
     F****49***                     ********C/H*Indicator********    *   S01176
     F*   49 -                              For a/c of (del. from)   *   S01176
     F*   50 -                              Incomplete Ind.          *   S01176
     F*   51 - ERROR - Incomplete ind.      Exch. rate               *
     F*   52 - ERROR - Value date           M/D ind.                 *
     F****53*-*ERROR*-*Branch*code**********Base*curr.*rate***********   S01117
     F*   53 - ERROR -                      Base curr. rate          *   S01117
     F*   54 - ERROR - Book                 Sett. meth.              *
     F*   55 - ERROR - Clearance type       Pay from                 *
     F*   56 - ERROR - Settlement curr.     Pay from branch          *
     F*   57 - ERROR - Reallowance/sign     Pay to                   *
     F*   58 - ERROR - Market centre        Pay to branch            *
     F*   59 - ERROR - Capacity             For a/c of (1)           *
     F*   60 - ERROR - Price                A/c seq.                 *
     F*   61 - ERROR - Trade date           Deliver from             *
     F*   62 - ERROR - Trade subtype        Deliver to               *
     F*   63 - ERROR - Market ind.          For a/c of (2)           *
     F*   64 - ERROR - AIDB/IPPA            Clearance type           *
     F****65***ERROR*-*Accrued*ind.*********C/H*ind.                 *   S01176
     F****66***ERROR*-*Days*adj./sign*******Priority*code            *   S01176
     F****67***ERROR*-*Act./diff.*ind.******Pay*code                 *   S01176
     F****68***ERROR*-*Int.*amount/sign*****Broker*comm.*code        *   S01176
     F****69***ERROR*-*Coupon*rate**********Broker*comm.*amount      *   S01176
     F****70***ERROR*-*Ex*dividend**********Local*transfer*code      *   S01176
     F****71********************************Local*transfer*amount    *   S01176
     F****72********************************Customer*comm.*code      *   S01176
     F****73********************************Customer*comm.*amount    *   S01176
     F****74********************************PMT*code                 *   S01176
     F****75********************************PMT*amount               *   S01176
     F****76********************************Charge*1*code            *   S01176
     F****77********************************Charge*1*amount          *   S01176
     F****78********************************Charge*2*code            *   S01176
     F****79********************************Charge*2*amount          *   S01176
     F****80********************************Charge*3*code            *   S01176
     F****81********************************Charge*3*amount          *   S01176
     F****82********************************Other*charges*code       *   S01176
     F****83********************************Other*charges*amount     *   S01176
     F****84********************************Local*tax*code           *   S01176
     F****85********************************Local*tax*amount         *   S01176
     F****86********************************VAT*amount               *   S01176
     F****87********************************Incomplete*ind.          *   S01176
     F*   65 - ERROR - Accrued ind.         Priority Code            *   S01176
     F*   66 - ERROR - Days adj./sign       Pay Code                 *   S01176
     F*   67 - ERROR - Act./diff. ind.      Auto-Settle Indicator    *   S01176
     F*   68 - ERROR - Int. amount/sign     Broker Commission Code   *   S01176
     F*   69 - ERROR - Coupon rate          Broker Commission Amount *   S01176
     F*   70 - ERROR - Ex dividend          Customer Commission Code *   S01176
     F****71*-******************************Customer*Commission*Amoun*                S01176 233607
     F*   71 - ERROR - Fiscal Price         Customer Commission Amoun*                       233607
     F*   72 -                              Charge 1 Code            *   S01176
     F*   73 -                              Charge 1 Amount          *   S01176
     F*   74 -                              Charge 2 Code            *   S01176
     F*   75 -                              Charge 2 Amount          *   S01176
     F*   76 -                              Charge 3 Code            *   S01176
     F*   77 -                              Charge 3 Amount          *   S01176
     F*   78 -                              Charge 4 Code            *   S01176
     F*   79 -                              Charge 4 Amount          *   S01176
     F*   80 -                              Charge 5 Code            *   S01176
     F*   81 -                              Charge 5 Amount          *   S01176
     F*   82 -                              Charge 6 Code            *   S01176
     F*   83 -                              Charge 6 Amount          *   S01176
     F*   84 -                              Charge 7 Code            *   S01176
     F*   85 -                              Charge 7 Amount          *   S01176
     F*   86 -                              Tax Amount               *   S01176
     F*   87 -                              Broker Comm. Rebate      *   S01176
     F*   88 -                              Customer Comm. Rebate    *   S01176
     F*   89 -                              Tax Rebate               *   S01176
     F*                                                               *
     F*90-99 - Used in validation/conversion routines (Z s/r's)       *
     F*                                                               *
     F*   U1 - Retail module in system                                *
     F*   U7 - Data base error                                        *
     F*   U8 - Data base error                                        *
     F*                                                               *
     F*****************************************************************   S01176
      /EJECT
     F*****************************************************************   S01176
     F*                                                               *
     F*  I N D E X   T O   S U B R O U T I N E S                      *
     F*                                                               *
     F*   AOBANK  Call access object - Bank details                   *   S01117
     F*   AOBOOK  Call access object - Book details                   *   S01117
     F*   AOBRCH  Call access object - Branches                       *   S01117
     F*   AOCNST  Call access object - Counterparty Nostros           *   S01117
     F*   AOCURR  Call access object - Currencies                     *   S01117
     F*   AOCUST  Call access object - Customers                      *   S01117
     F*   AODLST  Call access object - Trade Sub-Types                *   S01117
     F*   AOGELR  Call access object - General Ledger ICD             *   S01117
     F*   AONOST  Call access object - Nostros                        *   S01117
     F*   AOPCAC  Call access object - Profit Centre Accounting       *   CAC002
     F*   AOPRFC  Call access object - Profit Centres                 *   S01117
     F*   AOPRFM  Call access object - Profit Centre default          *   S01117
     F*   AORETL  Call access object - Retail ICD                     *   S01117
     F*   AOSECS  Call access object - Securities Trading Customers   *   S01117
     F*   AOSTRD  Call access object - Securities Trading ICD         *   S01117
     F*   AOTRAD  Call access object - Trading ICD                    *   S01117
     F*   SRNQDP  Get normally-quoted decimal places                  *   CAC002
     F*   SRSSEC - Save Security details.                             *                       233607
     F*   SRSINV - Save Investment Type details.                      *                       233607
     F*   SRVFSP - Validate Fiscal Price.                             *                       233607
     F*   SUB001 - Terminate process, setting on LR                   *
     F*   SUB002 - Main processing controller for action I or E       *
     F*   SUB003 - Error trap for invalid action code                 *
     F*   SUB100 - Program initialization - not first time through    *
     F*   SUB101 - Program initialization - first time through        *
     F*   SUB102 - Set up screen fields for screen 1                  *
     F*   SUB103 - Control display/validation of screens              *
     F*   SUB104 - Set up screen fields for screen 2                  *
     F*   SUB201 - Validate screen 1                                  *
     F*   SUB203 - Validate screen 2                                  *
     F*   SUB300 - Common defaults for screen 1 - part 1              *
     F*   SUB301 - Defaults for unrelated trade on screen 1           *
     F*   SUB302 - Defaults for related trade on screen 1             *
     F*   SUB303 - Defaults for screen 2                              *
     F*   SUB304 - Common defaults for screen 1 - part 2              *
     F****SUB400***Determine*next*coupon*date                         *   E21050
     F****SUB401***Calculate*interest                                 *   E21050
     F****SUB402***Calculate*interest*accrued*adjustment              *   E21050
     F*   SUB403 - Determine default charge/commission codes          *
     F*   SUB404 - Determine default charge/commission amounts        *
     F*   SUB405 - Determine Charge/Commission Tax Amounts            *   S01176
     F*   SUB500 - Validate charge/commission code                    *
     F*   SUB501 - Validate charge/commission amount                  *
     F*   SUB502 - Determine default charge/commission amount         *
     F*   SUB503 - Validate Tax and Rebate Amounts                    *   S01176
     F****SUB503***Calculate*charge/commission*amount                 *   S01176
     F****SUB504***Calculate*tiered*charge/commission*amount          *   S01176
     F****SUB505***Determine*default*VAT*amount                       *   S01176
     F****SUB506***Calculate*VAT*amount                               *   S01176
     F****SUB507***Calculate*VAT*amount                               *   S01176
     F****SUB999*-*Error*handling**************************************   S01117
     F****XDATE3*-*Calculate*number*of*working*days*in*any*currency****   S01195
     F*   SUB508  Calculate and format countervalue for screen output     065009
     F*   SUB509  Recalculate Ex-Dividend Indicator default.              065019
     F*   ZACCH  - Access a holiday for a ccy & (optionally) location *   S01195
     F*   ZACCR  - Calculate interest accrued between two dates       *
     F*   ZACCZ  - Calculate accrued interest between two dates       *   E39495
     F*   ZALIGN - Validate and right align numeric fields            *
     F*   ZASIGN - Validate and right align signed numeric fields     *
     F*   ZCALCD - Calculate long term CD price from input yield      *   E39495
     F*   ZBKDT  - Calculate the nth working day back from a given    *   S01195
     F*            start date for a currency and (optional) location  *   S01195
     F*   ZCCAL1 - Calculate Charege/Commission Amounts               *   S01176
     F*   ZCCAL2 - Calculate Charege/Commission Tiered Amounts        *   S01176
     F*   ZCCYCN - Convert an amount in one ccy to another using spot *   S01486
     F*            rates for the 2 ccys                               *   S01486
     F*   ZCCYXR - Convert an amount in one ccy to another using an   *   S01486
     F*            exchange rate between the 2 ccys                   *   S01486
     F*   ZCNSD  - Calculate consideration                            *   E39495
     F*   ZCHKH  - Determine if a given date is a holiday in a        *   S01195
     F*            particular currency and (optional) location        *   S01195
     F*   ZDATE1 - Validate dates and convert to day numbers          *
     F*   ZDATE2 - Validate day numbers and convert to dates          *
     F****ZDATE5*-*Determine*if*day*number*is*a*holiday****************   S01195
     F*   ZDAYS  - Determine number of days between two dates         *
     F*   ZDYYR  - Determine number of days in interest year          *
     F*   ZEDIT  - Format numeric fields for output                   *
     F*   ZFWDT   Calculate a number of Working days forward in a ccy *   065016
     F*           and (optional) location                             *   065016
     F****ZICD2**-*Access*ICD2*****************************************   S01117
     F****ZICDSE*-*Access*ICD*for*SE*(TABTB36)*************************   S01117
     F*   ZNCD   - Determine next coupon date                         *
     F*   ZNDD    Determine next dividend date                        *   065019
     F*   ZPRC1  - Output price as %age price                         *
     F*   ZRATE  - Calculate effective rate                           *
     F*   ZSEDIT - Format signed numeric fields for output            *
     F****ZSYSTM*-*Access*ICD1*****************************************   S01117
     F*   ZTCAL1 - Calculate Tax on Charges/Commissions               *   S01176
     F*   ZTCAL2 - Calculate Tax on Charges/Commissions (Tiered)      *   S01176
     F*   ZXRATE - Obtain cross exchange rate between two currencies  *
     F*   ZYLDI  - Output yield as %age rate                          *
     F*   ZYLD   - Calculate yields or prices                         *
     F*   ZFWDT  - Calculate a number of Working days forward in a    *   065016
     F*            ccy and (optional) location                        *   065016
     F*   ZNDD   - Determine next dividend date                       *   065019
     F*   ZCOTR  - Calculate the Countervalue of the Trade            *   065009
     F*   *PSSR  - Error handling                                     *   S01117
     F*                                                               *   S01176
      *****************************************************************   S01176
      /EJECT
      *
     E                    APF        16  1               VALID PAY FROM
     E                    CPY@    1   1 80
     E***********         @TX     1   5 80               Text strings     S01269
     E/COPY WNCPYSRC,SE3002E002
     E***********         @TX     1   7 80               Text stringS01269CSE006
     E**********          @TX     1   8 80               Text strings                  CSE006 CAS006
     E                    @TX     1  10 80               Text strings                         CAS006
     E/COPY WNCPYSRC,SE3002E003
     E***********         @EA        40  4               Error codes      E21051
     E                    @EA       100  4               Error codes      E21051
     E***********         @RA        10 15 0                              S01176
     E***********         @PC        10  7 4                              S01176
     E***********         @CG        10 15 0                              S01176
     E                    @RA        15 15 0             Charge Range U.L.S01176
     E                    @PC        15  7 4             Percentage LevelsS01176
     E                    @CG        15 15 0             Flat Charges     S01176
     E                    @TRA       15 15 0             Tax Charge Array S01176
     E                    @TPC       15  7 4             Tax Charge Array S01176
     E                    @TCG       15 15 0             Tax Charge Array S01176
     E                    @CTR       21  1               For field editing065009
     E                    @FNXA      40 10                                                    233607
     E                    @MIXA      40  7                                                    233607
     E                    @MDXA      40 45                                                    233607
     E                    @WFNXA     40 10                                                    233607
     E                    @WMIXA     40  7                                                    233607
     E                    @WMDXA     40 45                                                    233607
      *
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDAYSZ1
     E*/COPY*ZSRSRC,ZDATE5Z1********                                      S01195
     E*/COPY*ZSRSRC,ZDATE6Z1********                                      S01195
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZASIGNZ1
     E/COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZCCAL1Z1                                               S01176
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E/COPY ZSRSRC,ZPOWERZ1                                               065009
     E                    AP      1  10 10 0                              CAC002
     E** Array - Powers of Ten.                                           CAC002
     E/COPY WNCPYSRC,SE3002E001
      *                                                                                       CER001
      ** Override & delete override file for window agency commissions                        CER001
     E                    OVR     1   4 40                                                    CER001
     E/COPY ZSRSRC,ZSDESCZ1                                               CSE016
      /EJECT
     I*
     ISECTYDF
     I*
     I*  Rename nominal currency field
     I              NMCY                            NMCYA
     I*                                                                   S01176
     ICUBRDDF                                                             S01176
     I*                                                                   S01176
     I*  Rename fields on PF/CUBRDD so that they dont                     S01176
     I*  clash with names on PF/CLINTSE and PF/SECTYD                     S01176
     I              C1DI                            C1DIA                 S01176
     I              SITP                            SITPA                 S01176
     I              TBCC                            DBCC                  S01176
     I              TCCC                            DCCC                  S01176
     ICUBRDSE                                                             S01496
     I*                                                                   S01496
     I** Rename fields                                                    S01496
     I*                                                                   S01496
     I              C1DI                            C1DIA                 S01496
     I              SITP                            SITPA                 S01496
     I              CLGR                            CLGRA                 S01496
     I              TBCC                            DBCC                  S01496
     I              TCCC                            DCCC                  S01496
     I*ACNUMF*******                                               081490 099817
     I**************CNUM                            ZRCNUM         081490 099817
     I**************CCY                             ZRCCY          081490 099817
     I**************ACOD                            ZRACOD         081490 099817
     I**************ACSQ                            ZRACSQ         081490 099817
     I**************PTFR                            ZRPTFR         081490 099817
     I**************BRCA                            ZRBRCA         081490 099817
      *                                                                                       CAS006
     ISEDEVD3                                                                                 CAS006
      ** Rename fields                                                                        CAS006
     I              RECI                            WERECI                                    CAS006
     I              SDSN                            WESDSN                                    CAS006
     I              SDED                            WESDED                                    CAS006
     I              SDET                            WESDET                                    CAS006
     I              SDNV                            WESDNV                                    CAS006
     I              SDVA                            WESDVA                                    CAS006
     I              SRPT                            WESRPT                                    CAS006
     I              SDTR                            WESDTR                                    CAS006
     I              SRMI                            WESRMI                                    CAS006
     I              SDPD                            WESDPD                                    CAS006
     I              SDNC                            WESDNC                                    CAS006
     I              SDPP                            WESDPP                                    CAS006
     I              SDPC                            WESDPC                                    CAS006
     I              SDTA                            WESDTA                                    CAS006
     I              SDTP                            WESDTP                                    CAS006
     I              SDRP                            WESDRP                                    CAS006
     I              SDCV                            WESDCV                                    CAS006
     I              SDCX                            WESDCX                                    CAS006
     I              SDCE                            WESDCE                                    CAS006
     I              SDMD                            WESDMD                                    CAS006
     I              NMCY                            WENMCY                                    CAS006
     I              SDAD                            WESDAD                                    CAS006
     I              SDDT                            WESDDT                                    CAS006
     I              RCIC                            WERCIC                                    CAS006
     I              LCD                             WELCD                                     CAS006
     I              CHTP                            WECHTP                                    CAS006
     I              TNLU                            WETNLU                                    CAS006
     I              SDCP                            WESDCP                                    CAS006
     I              SDXD                            WESDXD                                    CAS006
     I              FRNT                            WEFRNT                                    CAS006
     I              REPA                            WEREPA                                    CAS006
     I              SCRS                            WESCRS                                    CAS006
     I              SLQP                            WESLQP                                    CAS006
     I              SDNN                            WESDNN                                    CAS006
     I              SETX                            WESETX                                    234440
     ISEDEVD2                                                                                 234440
     I              SETX                            WESETX                                    234440
     ISEDEVDF                                                                                 234440
     I              SETX                            WESETX                                    234440
     ISEDEVDO                                                                                 234440
     I              SETX                            WESETX                                    234440
      *                                                                                       CAS006
     I            DS
      *
      * Data structure for compilation - Copyright insertion
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
     ILDA         DS                            256
      *
      *  Error reporting data structure
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I                                      134 183 @DBALL                S01117
     I                                      134 141 @DBFIL                S01117
     I                                      142 170 @DBKEY                S01117
     I                                      171 180 @DBPGM                S01117
     I                                      181 1830@DBASE                S01117
     I***********                           134 138 @DBFIL                S01117
     I***********                           139 167 @DBKEY                S01117
     I***********                           168 175 @DBPGM                S01117
     I***********                           176 1770@DBASE                S01117
     I***********                           134 177 @DBALL                S01117
     I*                                                                   S01117
     I** Data area RUNDAT                                                 S01117
     I*                                                                   S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*                                                                   S01117
     I/COPY WNCPYSRC,SE3002I001
     ISCSARD    E DSSCSARDPD                                              S01486
     I              LCD                             LCDA                  S01486
     I** Switchable Features details                                      S01486
     ISDBANK    E DSSDBANKPD                                              S01117
     I** Bank details                                                     S01117
     ISDBOOK    E DSSDBOOKPD                                              S01117
     I** Book details                                                     S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I** Branch details                                                   S01117
     ISDCNST    E DSSDCNSTPD                                              S01117
     I** Counterparty nostros                                             S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I** Currency details                                                 S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I              QQDFAC                          QQDFA1                                    CGL029
     I** Customer details                                                 S01117
     ISDDLST    E DSSDDLSTPD                                              S01117
     I** Trade Sub-Types                                                  S01117
     ISDGELR    E DSSDGELRPD                                              S01117
     I** General ledger details                                           S01117
     ISDMMOD    E DSSDMMODPD                                              S01486
     I** Midas Modules details                                            S01486
     ISDNOST    E DSSDNOSTPD                                              S01117
     I              QQACCD                          QQACC1                                    CGL029
     I** Nostro details                                                   S01117
     ISDPCAC    E DSSDPCACPD                                              CAC002
     I** Profit Centre Accounting ICD                                     CAC002
     ISDPLCS    E DSSDPLCSPD                                              S01486
     I** Portfolio Management Customer details                            S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I** Portfolio Management ICD details                                 S01486
     ISDPRFC    E DSSDPRFCPD                                              S01117
     I** Profit Centre details                                            S01117
     ISDRETL    E DSSDRETLPD                                              S01117
     I              QQACCD                          QQACC2                                    CGL029
     I** Retail ICD                                                       S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I              QQACCD                          QQACC3                                    CGL029
     I** Security Customer details                                        S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I** Securities Trading ICD                                           S01117
     ISDTRAD    E DSSDTRADPD                                              S01117
     I              QQACCD                          QQACC4                                    CGL029
     I** Trading ICD                                                      S01117
     IDSFDY     E DSDSFDY                                                 S01117
     I**  Short DS for access programs                                    S01117
     IDSLDY     E DSDSLDY                                                 CPB001
     I**  Very Long DS for access programs                                CPB001
      *
     I*********** DS                                                      S01195
      *
     I****Data*structure*for*array*used*in*ZDATE5*************************S01195
     I***********                             1  75 HCCY                  S01195
     I***********                             1  75 XCCY                  S01195
      *
     I@PSDS      SDS
      *
      *  Program status data structure
     I                                      244 253 @SJOB
     I                                      254 263 USRID                 S01117
      ***Data*structure*to*hold*trade*details******
     I*@PARMT***** DS                            464                      S01176
     I*@PARMT      DS                                              S01176 S01175
     I*************                           1   1 @PRECI                S01175
     I*************                           2   7 @PTDRF                S01175
     I*************                           8   8 @PTINC                S01175
     I*************                           9  18 @PTDSS                S01175
     I*************                          19  240@PTCNR                S01175
     I*************                          25  26 @PTDTP                S01175
     I*************                       P  27  320@PNOML                S01175
     I*************                          33  35 @PTNMC                S01175
     I*************                       P  36  360@PTNMD                S01175
     I*************                       P  37  448@PTPDY                S01175
     I*************                       P  45  470@PTDVD                S01175
     I*************                          48  500@PTDBR                S01175
     I*************                          51  52 @PTDBK                S01175
     I*************                       P  53  550@PTDDT                S01175
     I*************                          56  57 @PTSUB                S01175
     I*************                          58  63 @PLKRF                S01175
     I*************                          64  64 @PTDMI                S01175
     I*************                          65  99 @PTDNR                S01175
     I*************                         100 102 @PTDID                S01175
     I*************                         103 103 @PAIIP                S01175
     I*************                         104 105 @PTMKC                S01175
     I*************                         106 1060@PTCAP                S01175
     I*************                       P 107 1118@PTCFC                S01175
     I*************                         112 112 @PACIN                S01175
     I*************                       P 113 1140@PDADJ                S01175
     I*************                         115 115 @PADIN                S01175
     I*************                       P 116 1220@PITRA                S01175
     I*************                       P 123 1290@PTINA                S01175
     I*************                       P 130 1357@PTDCR                S01175
     I*************                       P 136 1438@PPRIC                S01175
     I*************                         144 144 @PEXDV                S01175
     I*************                       P 145 1495@PRALL                S01175
     I*************                         150 152 @PSETC                S01175
     I*************                       P 153 1598@PTDER                S01175
     I*************                         160 160 @PTMDI                S01175
     I*************                       P 161 1678@PTBCR                S01175
     I*************                         168 1690@PSMTH                S01175
     I*************                         170 181 @PPYFM                S01175
     I*************                         182 1840@PPYFB                S01175
     I*************                         185 196 @PPAYT                S01175
     I*************                         197 1990@PPYTB                S01175
     I*************                         200 207 @PTDFA                S01175
     I*************                         208 2090@PASNM                S01175
     I*************                         210 210 @PCLTY                S01175
     I*************                         211 2160@PDELT                S01175
     I*************                         217 224 @PDTFA                S01175
     I*************                         225 225 @PCLRH                S01175
     I*************                         226 2310@PDELF                S01175
     I*************                         232 266 @PTDSI                S01175
     I*************                         267 267 @PPRYC                S01175
     I*************                         268 268 @PPCOD                S01175
     I*************                         269 270 @PTBCC                S01175
     I*************                       P 271 2770@PTBCA                S01175
     I*************                         278 279 @PTCCC                S01175
     I*************                       P 280 2860@PTCCA                S01175
     I*************                         287 288 @PTCC1                S01175
     I*************                       P 289 2950@PTCA1                S01175
     I*************                         296 297 @PTCC2                S01175
     I*************                       P 298 3040@PTCA2                S01175
     I*************                         305 306 @PTCC3                S01175
     I*************                       P 307 3130@PTCA3                S01175
     I*************                         314 315 @PTCC4         S01176 S01175
     I*************                       P 316 3220@PTCA4         S01176 S01175
     I*************                         323 324 @PTCC5         S01176 S01175
     I*************                       P 325 3310@PTCA5         S01176 S01175
     I*************                         332 333 @PTCC6         S01176 S01175
     I*************                       P 334 3400@PTCA6         S01176 S01175
     I*************                         341 342 @PTCC7         S01176 S01175
     I*************                       P 343 3490@PTCA7         S01176 S01175
     I*************                       P 350 3560@PTAXA         S01176 S01175
     I*************                       P 357 3630@PBCMR         S01176 S01175
     I*************                       P 364 3700@PCCMR         S01176 S01175
     I*************                       P 371 3770@PTXRB         S01176 S01175
     I*************                         378 383 @PBLKR         S01176 S01175
     I*************                         384 389 @PRTRF         S01176 S01175
     I*************                         390 390 @PATRD         S01176 S01175
     I*************                         391 391 @PBCON         S01176 S01175
     I*************                         392 3970@PTIME         S01176 S01175
     I*************                         398 398 @PAUTS         S01176 S01175
     I*************                         314 315 @PTLTC         S01176 S01175
     I*************                       P 316 3220@PTLTA         S01176 S01175
     I*************                         323 324 @PTOCC         S01176 S01175
     I*************                       P 325 3310@PTOCA         S01176 S01175
     I*************                         332 332 @PTACI         S01176 S01175
     I*************                         333 333 @PTMSI         S01176 S01175
     I*************                       P 335 3400@PTOSN         S01176 S01175
     I*************                       P 341 3460@PTNSN         S01176 S01175
     I*************                       P 347 3520@PTNSP         S01176 S01175
     I*************                       P 353 3600@PTOSV         S01176 S01175
     I*************                       P 361 3680@PTVSN         S01176 S01175
     I*************                       P 369 3760@PTVSP         S01176 S01175
     I*************                       P 377 3840@PTDSN         S01176 S01175
     I*************                       P 385 3920@PTDSP         S01176 S01175
     I*************                       P 393 3950@PTDFS         S01176 S01175
     I*************                       P 396 3970@PTSSQ         S01176 S01175
     I*************                       P 398 4050@PTCSR         S01176 S01175
     I*************                       P 406 4130@PTCTR         S01176 S01175
     I*************                       P 414 4160@PTDMC         S01176 S01175
     I*************                       P 417 4190@PTOED         S01176 S01175
     I*************                       P 420 4220@PLCD          S01176 S01175
     I*************                         423 423 @PCHTP         S01176 S01175
     I*************                       P 424 4260@PTNLU         S01176 S01175
     I*************                         399 399 @PTACI         S01176 S01175
     I*************                         400 400 @PTMSI         S01176 S01175
     I*************                         401 401 @PTCFR         S01176 S01175
     I*************                       P 402 4070@PTOSN         S01176 S01175
     I*************                       P 408 4130@PTNSN         S01176 S01175
     I*************                       P 414 4190@PTNSP         S01176 S01175
     I*************                       P 420 4270@PTOSV         S01176 S01175
     I*************                       P 428 4350@PTVSN         S01176 S01175
     I*************                       P 436 4430@PTVSP         S01176 S01175
     I*************                       P 444 4510@PTDSN         S01176 S01175
     I*************                       P 452 4590@PTDSP         S01176 S01175
     I*************                       P 460 4620@PTDFS         S01176 S01175
     I*************                       P 463 4640@PTSSQ         S01176 S01175
     I*************                       P 465 4720@PTCSR         S01176 S01175
     I*************                       P 473 4800@PTCTR         S01176 S01175
     I*************                       P 481 4830@PTDMC         S01176 S01175
     I*************                       P 484 4860@PTOED         S01176 S01175
     I*************                       P 487 4890@PLCD          S01176 S01175
     I*************                         490 490 @PCHTP         S01176 S01175
     I*************                       P 491 4930@PTNLU         S01176 S01175
     I*************                         427 428 @PTTCC         S01176 S01175
     I*************                       P 429 4350@PLTCA         S01176 S01175
     I*************                         436 437 @PTPCC         S01176 S01175
     I*************                       P 438 4440@PTPCA         S01176 S01175
     I*************                       P 445 4510@PTVCA         S01176 S01175
     I*************                         452 457 @PBLKR         S01176 S01175
     I*************                         458 463 @PRTRF         S01176 S01175
     I*************                         464 464 @PATRD         S01176 S01175
      *                                                                   S01175
     I@PARMT      DS                                                      S01175
      *                                                                   S01175
      *  Data structure to hold trade details                             S01175
     I                                        1   1 @PRECI                S01175
     I                                        2   7 @PTDRF                S01175
     I                                        8   8 @PTINC                S01175
     I                                        9  18 @PTDSS                S01175
     I**********                             19  240@PTCNR                            S01175 CSD027A
     I                                       19  24 @PTCNR                                   CSD027A
     I                                       25  26 @PTDTP                S01175
     I                                    P  27  320@PNOML                S01175
     I                                       33  35 @PTNMC                S01175
     I                                    P  36  360@PTNMD                S01175
     I                                    P  37  448@PTPDY                S01175
     I                                    P  45  470@PTDVD                S01175
     I***********                            48  500@PTDBR         S01175 S01117
     I***********                            51  52 @PTDBK         S01175 S01117
     I***********                         P  53  550@PTDDT         S01175 S01117
     I***********                            56  57 @PTSUB         S01175 S01117
     I***********                            58  63 @PLKRF         S01175 S01117
     I***********                            64  64 @PTDMI         S01175 S01117
     I***********                            65  99 @PTDNR         S01175 S01117
     I***********                           100 102 @PTDID         S01175 S01117
     I***********                           103 103 @PAIIP         S01175 S01117
     I***********                           104 105 @PTMKC         S01175 S01117
     I***********                           106 1060@PTCAP         S01175 S01117
     I***********                         P 107 1118@PTCFC         S01175 S01117
     I***********                           112 112 @PACIN         S01175 S01117
     I***********                         P 113 1140@PDADJ         S01175 S01117
     I***********                           115 115 @PADIN         S01175 S01117
     I***********                         P 116 1220@PITRA         S01175 S01117
     I***********                         P 123 1290@PTINA         S01175 S01117
     I***********                         P 130 1357@PTDCR         S01175 S01117
     I***********                         P 136 1438@PPRIC         S01175 S01117
     I***********                           144 144 @PEXDV         S01175 S01117
     I***********                         P 145 1495@PRALL         S01175 S01117
     I***********                           150 152 @PSETC         S01175 S01117
     I***********                         P 153 1598@PTDER         S01175 S01117
     I***********                           160 160 @PTMDI         S01175 S01117
     I***********                         P 161 1678@PTBCR         S01175 S01117
     I***********                           168 1690@PSMTH         S01175 S01117
     I***********                           170 181 @PPYFM         S01175 S01117
     I***********                           182 1840@PPYFB         S01175 S01117
     I***********                           185 196 @PPAYT         S01175 S01117
     I***********                           197 1990@PPYTB         S01175 S01117
     I***********                           200 207 @PTDFA         S01175 S01117
     I***********                           208 2090@PASNM         S01175 S01117
     I***********                           210 210 @PCLTY         S01175 S01117
     I***********                           211 2160@PDELT         S01175 S01117
     I***********                           217 224 @PDTFA         S01175 S01117
     I***********                           225 2300@PDELF         S01175 S01117
     I***********                           231 238 @PDFFA         S01175 S01117
     I***********                           239 273 @PTDSI         S01175 S01117
     I***********                           274 274 @PPRYC         S01175 S01117
     I***********                           275 275 @PPCOD         S01175 S01117
     I***********                           276 277 @PTBCC         S01175 S01117
     I***********                         P 278 2840@PTBCA         S01175 S01117
     I***********                           285 286 @PTCCC         S01175 S01117
     I***********                         P 287 2930@PTCCA         S01175 S01117
     I***********                           294 295 @PTCC1         S01175 S01117
     I***********                         P 296 3020@PTCA1         S01175 S01117
     I***********                           303 304 @PTCC2         S01175 S01117
     I***********                         P 305 3110@PTCA2         S01175 S01117
     I***********                           312 313 @PTCC3         S01175 S01117
     I***********                         P 314 3200@PTCA3         S01175 S01117
     I***********                           321 322 @PTCC4         S01175 S01117
     I***********                         P 323 3290@PTCA4         S01175 S01117
     I***********                           330 331 @PTCC5         S01175 S01117
     I***********                         P 332 3380@PTCA5         S01175 S01117
     I***********                           339 340 @PTCC6         S01175 S01117
     I***********                         P 341 3470@PTCA6         S01175 S01117
     I***********                           348 349 @PTCC7         S01175 S01117
     I***********                         P 350 3560@PTCA7         S01175 S01117
     I***********                         P 357 3630@PTAXA         S01175 S01117
     I***********                         P 364 3700@PBCMR         S01175 S01117
     I***********                         P 371 3770@PCCMR         S01175 S01117
     I***********                         P 378 3840@PTXRB         S01175 S01117
     I***********                           385 390 @PBLKR         S01175 S01117
     I***********                           391 396 @PRTRF         S01175 S01117
     I***********                           397 397 @PATRD         S01175 S01117
     I***********                           398 398 @PBCON         S01175 S01117
     I***********                           399 4040@PTIME         S01175 S01117
     I***********                           405 405 @PAUTS         S01175 S01117
     I***********                           406 406 @PTACI         S01175 S01117
     I***********                           407 407 @PTMSI         S01175 S01117
     I***********                           408 408 @PTCFR         S01175 S01117
     I***********                         P 409 4140@PTOSN         S01175 S01117
     I***********                         P 415 4200@PTNSN         S01175 S01117
     I***********                         P 421 4260@PTNSP         S01175 S01117
     I***********                         P 427 4340@PTOSV         S01175 S01117
     I***********                         P 435 4420@PTVSN         S01175 S01117
     I***********                         P 443 4500@PTVSP         S01175 S01117
     I***********                         P 451 4580@PTDSN         S01175 S01117
     I***********                         P 459 4660@PTDSP         S01175 S01117
     I***********                         P 467 4690@PTDFS         S01175 S01117
     I***********                         P 470 4710@PTSSQ         S01175 S01117
     I***********                         P 472 4790@PTCSR         S01175 S01117
     I***********                         P 480 4870@PTCTR         S01175 S01117
     I***********                         P 488 4900@PTDMC         S01175 S01117
     I***********                         P 491 4930@PTOED         S01175 S01117
     I***********                         P 494 4960@PLCD          S01175 S01117
     I***********                           497 497 @PCHTP         S01175 S01117
     I***********                         P 498 5000@PTNLU         S01175 S01117
     I                                       48  50 @PTDBA                S01117
     I                                       51  53 @PORBR                S01117
     I                                       54  55 @PTDBK                S01117
     I                                    P  56  580@PTDDT                S01117
     I                                       59  60 @PTSUB                S01117
     I                                       61  66 @PLKRF                S01117
     I                                       67  67 @PTDMI                S01117
     I                                       68 102 @PTDNR                S01117
     I                                      103 105 @PTDID                S01117
     I                                      106 106 @PAIIP                S01117
     I                                      107 108 @PTMKC                S01117
     I                                      109 1090@PTCAP                S01117
     I**********                          P 110 1148@PTCFC         S01117 052254
     I                                      110 114 @ZZ005                052254
     I                                      115 115 @PACIN                S01117
     I                                    P 116 1170@PDADJ                S01117
     I                                      118 118 @PADIN                S01117
     I                                    P 119 1250@PITRA                S01117
     I                                    P 126 1320@PTINA                S01117
     I                                    P 133 1387@PTDCR                S01117
     I                                    P 139 1468@PPRIC                S01117
     I                                      147 147 @PEXDV                S01117
     I                                    P 148 1525@PRALL                S01117
     I                                      153 155 @PSETC                S01117
     I                                    P 156 1628@PTDER                S01117
     I                                      163 163 @PTMDI                S01117
     I                                    P 164 1708@PTBCR                S01117
     I                                      171 1720@PSMTH                S01117
     I**********                            173 184 @PPYFM                             S01117 CGL029
     I                                      173 184 QQPYFM                                    CGL029
     I                                      185 187 @PPYFA                S01117
     I**********                            188 199 @PPAYT                             S01117 CGL029
     I                                      188 199 QQPAYT                                    CGL029
     I                                      200 202 @PPYTA                S01117
     I                                      203 210 @PTDFA                S01117
     I                                      211 2120@PASNM                S01117
     I                                      213 213 @PCLTY                S01117
     I**********                            214 2190@PDELT                            S01117 CSD027A
     I                                      214 219 @PDELT                                   CSD027A
     I                                      220 227 @PDTFA                S01117
     I**********                            228 2330@PDELF                            S01117 CSD027A
     I                                      228 233 @PDELF                                   CSD027A
     I                                      234 241 @PDFFA                S01117
     I                                      242 276 @PTDSI                S01117
     I                                      277 277 @PPRYC                S01117
     I                                      278 278 @PPCOD                S01117
     I                                      279 280 @PTBCC                S01117
     I                                    P 281 2870@PTBCA                S01117
     I                                      288 289 @PTCCC                S01117
     I                                    P 290 2960@PTCCA                S01117
     I                                      297 298 @PTCC1                S01117
     I                                    P 299 3050@PTCA1                S01117
     I                                      306 307 @PTCC2                S01117
     I                                    P 308 3140@PTCA2                S01117
     I                                      315 316 @PTCC3                S01117
     I                                    P 317 3230@PTCA3                S01117
     I                                      324 325 @PTCC4                S01117
     I                                    P 326 3320@PTCA4                S01117
     I                                      333 334 @PTCC5                S01117
     I                                    P 335 3410@PTCA5                S01117
     I                                      342 343 @PTCC6                S01117
     I                                    P 344 3500@PTCA6                S01117
     I                                      351 352 @PTCC7                S01117
     I                                    P 353 3590@PTCA7                S01117
     I                                    P 360 3660@PTAXA                S01117
     I                                    P 367 3730@PBCMR                S01117
     I                                    P 374 3800@PCCMR                S01117
     I                                    P 381 3870@PTXRB                S01117
     I                                      388 393 @PBLKR                S01117
     I                                      394 399 @PRTRF                S01117
     I                                      400 400 @PATRD                S01117
     I                                      401 401 @PBCON                S01117
     I                                      402 4070@PTIME                S01117
     I                                      408 408 @PAUTS                S01117
     I                                      409 409 @PTACI                S01117
     I                                      410 410 @PTMSI                S01117
     I                                      411 411 @PTCFR                S01117
     I                                    P 412 4170@PTOSN                S01117
     I                                    P 418 4230@PTNSN                S01117
     I                                    P 424 4290@PTNSP                S01117
     I                                    P 430 4370@PTOSV                S01117
     I                                    P 438 4450@PTVSN                S01117
     I                                    P 446 4530@PTVSP                S01117
     I                                    P 454 4610@PTDSN                S01117
     I                                    P 462 4690@PTDSP                S01117
     I                                    P 470 4720@PTDFS                S01117
     I                                    P 473 4740@PTSSQ                S01117
     I                                    P 475 4820@PTCSR                S01117
     I                                    P 483 4900@PTCTR                S01117
     I                                    P 491 4930@PTDMC                S01117
     I                                    P 494 4960@PTOED                S01117
     I                                      497 500 @PPRFC                S01117
     I                                      501 501 @PPRPC                S01117
     I                                    P 502 5040@PLCD                 S01117
     I                                      505 505 @PCHTP                S01117
     I                                    P 506 5080@PTNLU                S01117
     I                                    P 509 5100@PLSWS                S01117
     I                                    P 511 5169@PTCFC                052254
     I************                          518 521 @PPTFR         S01486 100239
     I************                        P 522 5280@PSPXR         S01486 100239
     I************                          529 529 @PSPMD         S01486 100239
     I                                      517 520 @PPTFR                100239
     I                                    P 521 5270@PSPXR                100239
     I                                      528 528 @PSPMD                100239
     I                                      529 532 @PBPRC                CAC002
     I                                      533 536 @PTPRC                CAC002
     I                                    P 537 5402@PFXMP                CAC002
     I                                    P 541 5478@PFXMR                CAC002
     I                                    P 548 5540@PMAMT                CAC002
     I                                      555 557 @PICCY                CEU005
     I                                    P 634 6400@PWHTX                187727
     I                                      641 641 @PBWDI                187727
     I                                    P 642 6498@PCRSK                                    CAS006
     I                                    P 650 6578@PLQPR                                    CAS006
     I                                    P 658 6640@PTINN                                    CAS006
     I                                    P 665 6710@PITRN                                    CAS006
     I                                    P 672 6798@PPRCN                                    CAS006
     I                                      680 697 @PPYFM                                    CGL029
     I                                      698 715 @PPAYT                                    CGL029
     I                                    P 716 7238@PFSPR                                    233607
     I                                    P 724 7318@PFSPP                                    233607
     I                                    P 732 7380@PEUTX                                    233607
     I                                    P 739 7450@PEUTS                                    233607
      *                                                                                     AR871625
     I@PRMT2      DS                                                                        AR871625
     I                                        1   1 @PTLIA                                  AR871625
     I                                    P   2   80@PTAMT                                  AR871625
     I                                    P   9  150@PCAMT                                  AR871625
      *
      *  Externally defined data structure to transfer bulk details       E14496
     I@TRADS    E DSTRADSD                                                E14496
      ** Security Details Data Structure                                                      233607
     I@SECTY    E DSSECTYD                                                                    233607
     I              RECI                            RECIA                                     233607
     I              NMCY                            NMCYA                                     233607
     I              ZZ005                           ZZ005A                                    233607
     I              CHTP                            CHTPA                                     233607
     I              TNLU                            TNLUA                                     233607
     I              REPI                            REPIA                                     233607
     I              REPA                            REPAA                                     233607
     I              LCD                             LCDTA                                     233607
     I              FRNT                            FRNTA                                     233607
     I              TMST                            TMSTA                                     233607
     I              CD01                            CD01A                                     233607
     I              CD02                            CD02A                                     233607
     I              CD03                            CD03A                                     233607
     I              CD04                            CD04A                                     233607
     I              CD05                            CD05A                                     233607
     I              CD06                            CD06A                                     233607
     I              CD07                            CD07A                                     233607
     I              CD08                            CD08A                                     233607
     I              CD09                            CD09A                                     233607
     I              CD10                            CD10A                                     233607
     I              CD11                            CD11A                                     233607
     I              CD12                            CD12A                                     233607
     I              CR01                            CR01A                                     233607
     I              CR02                            CR02A                                     233607
     I              CR03                            CR03A                                     233607
     I              CR04                            CR04A                                     233607
     I              CR05                            CR05A                                     233607
     I              CR06                            CR06A                                     233607
     I              CR07                            CR07A                                     233607
     I              CR08                            CR08A                                     233607
     I              CR09                            CR09A                                     233607
     I              CR10                            CR10A                                     233607
     I              CR11                            CR11A                                     233607
     I              CR12                            CR12A                                     233607
     I              SEZONE                          SEZONA                                    233607
      ** Investment Proportion Data Structure                                                 233607
     I@INVTP    E DSINVTPD                                                                    233607
     I              RECI                            RECIB                                     233607
     I              LCD                             LCDTB                                     233607
     I              CHTP                            CHTPB                                     233607
     I              TNLU                            TNLUB                                     233607
     I              NDEC                            NDECB                                     233607
      ** Customer (Counterparty) Details Data Structure                                       233607
     I@PCUST      DS                                                                          233607
     I                                        1   6 CUSTN                                     233607
     I                                       16  16 CUSTC                                     233607
     I                                       48  49 CUSTL                                     233607
      ** Data structures to hold Security & Investment Type details.                          233607
     I@PSECT      DS                            899                                           233607
     I@PINVT      DS                            122                                           233607
     I            DS
      *
      *  Data structure to strip last character from ZSEDIT output
     I                                        1  21 ZOUT21
     I                                        1  20 ZOUT20
     I@DSACT      DS
      *
      *  Data structure to manipulate account key
     I**********                              1   60CNUM                                     CSD027A
     I                                        1   6 CNUM                                     CSD027A
     I                                        7   9 CCY
     I**********                             10  130ACOD                                      CGL029
     I**********                             14  150ACSQ                                      CGL029
     I**********                             16  18 BRCA                               S01117 CGL029
     I                                       10  190ACOD                                      CGL029
     I                                       20  210ACSQ                                      CGL029
     I                                       22  24 BRCA                                      CGL029
      *                                                                   S01176
     I            DS
      *                                                                   S01176
      *  Data structure to fill upper range limit array
     I***********                         P   1  80 @RA                   S01176
     I                                    P   1 120 @RA                   S01176
     I                                    P   1   80STU1
     I                                    P   9  160STU2
     I                                    P  17  240STU3
     I                                    P  25  320STU4
     I                                    P  33  400STU5
     I                                    P  41  480STU6
     I                                    P  49  560STU7
     I                                    P  57  640STU8
     I                                    P  65  720STU9
     I                                    P  73  800ST10                  S01176
     I                                    P  81  880ST11                  S01176
     I                                    P  89  960ST12                  S01176
     I                                    P  97 1040ST13                  S01176
     I                                    P 105 1120ST14                  S01176
     I                                    P 113 1200@DUMMY                S01176
      *                                                                   S01176
     I            DS
      *                                                                   S01176
      *  Data structure to fill percentage array
     I***********                         P   1  40 @PC                   S01176
     I                                    P   1  60 @PC                   S01176
     I                                    P   1   44PL01
     I                                    P   5   84PL02
     I                                    P   9  124PL03
     I                                    P  13  164PL04
     I                                    P  17  204PL05
     I                                    P  21  244PL06
     I                                    P  25  284PL07
     I                                    P  29  324PL08
     I                                    P  33  364PL09
     I                                    P  37  404PL10
     I                                    P  41  444PL11                  S01176
     I                                    P  45  484PL12                  S01176
     I                                    P  49  524PL13                  S01176
     I                                    P  53  564PL14                  S01176
     I                                    P  57  604PL15                  S01176
      *                                                                   S01176
     I            DS
      *                                                                   S01176
      *  Data structure to fill flat charge array
     I***********                         P   1  80 @CG                   S01176
     I                                    P   1 120 @CG                   S01176
     I                                    P   1   80FC01
     I                                    P   9  160FC02
     I                                    P  17  240FC03
     I                                    P  25  320FC04
     I                                    P  33  400FC05
     I                                    P  41  480FC06
     I                                    P  49  560FC07
     I                                    P  57  640FC08
     I                                    P  65  720FC09
     I                                    P  73  800FC10
     I                                    P  81  880FC11                  S01176
     I                                    P  89  960FC12                  S01176
     I                                    P  97 1040FC13                  S01176
     I                                    P 105 1120FC14                  S01176
     I                                    P 113 1200FC15                  S01176
      *                                                                   S01176
     I            DS                                                      S01176
      *                                                                   S01176
      ***  Data structure for flags to indicate if charge amounts         S01176
      ***  have been overridden.                                          S01176
     I                                        1   1 @OVBC                 S01176
     I                                        2   2 @OVCC                 S01176
     I                                        3   3 @OVC1                 S01176
     I                                        4   4 @OVC2                 S01176
     I                                        5   5 @OVC3                 S01176
     I                                        6   6 @OVC4                 S01176
     I                                        7   7 @OVC5                 S01176
     I                                        8   8 @OVC6                 S01176
     I                                        9   9 @OVC7                 S01176
     I                                       10  10 @OVTX                 S01176
     I                                       11  11 @OVBCR                S01176
     I                                       12  12 @OVCCR                S01176
     I                                       13  13 @OVTXR                S01176
      *                                                                   S01176
     I@TXDS       DS                                                      S01176
      *                                                                   S01176
      ***  Data structure for storing Tax Charge fields (obtained from    S01176
      ***  LF/SECGT using the Tax Code from the Counterparty).            S01176
      ***  (Used for moving fields into standard subroutine)              S01176
     I                                        1   1 @TCHGB                S01176
     I                                        2   2 @TTHRI                S01176
     I                                    P   3 122 @TRA                  S01176
     I                                    P 123 182 @TPC                  S01176
     I                                    P 183 302 @TCG                  S01176
     I                                    P 303 3100@TMNCH                S01176
     I                                    P 311 3180@TMXCH                S01176
     I                                      319 319 @TTXAP                S01176
     I                                      320 320 @TREBA                S01176
      *                                                                   S01176
     I@ZCHDS      DS                                                      S01176
      *                                                                   S01176
      ***  Data structure for the charge fields from LF/SECGT             S01176
      ***  that are used in standard subroutines.                         S01176
     I                                        1   1 ZCHGB                 S01176
     I                                        2   2 ZTHRI                 S01176
     I                                    P   3 122 ZRA                   S01176
     I                                    P 123 182 ZPC                   S01176
     I                                    P 183 302 ZCG                   S01176
     I                                    P 303 3100ZMNCH                 S01176
     I                                    P 311 3180ZMXCH                 S01176
     I@CUSDT      DS                                                                          234552
      ** Customer (Counterparty) Details                                                      234552
     I                                        1   6 WCUSNU                                    234552
     I                                        7  10 WCUSAC                                    234552
     I                                       11  13 WCUSCU                                    234552
     I                                       14  150WCUSSQ                                    234552
     I                                       16  16 WCUSCL                                    234552
     I                                       17  22 WCUSD1                                    234552
     I                                       23  28 WCUSD2                                    234552
     I                                       29  30 WCUSP1                                    234552
     I                                       31  32 WCUSP2                                    234552
     I                                       33  34 WCUSTA                                    234552
     I                                       35  35 WCUSAU                                    234552
     I                                       36  37 WCUSTD                                    234552
     I                                       38  38 WLPCUS                                    234552
     I                                       39  41 WCUSBY                                    234552
     I                                       42  420WCUSDP                                    234552
     I                                       43  46 WCUSPO                                    234552
     I                                       47  47 WPBCUS                                    234552
     I                                       48  49 WCUSCO                                    234552
      *                                                                   S01176
     I****Data*structure*for*redefining*nominal*field*as*alphanumeric*****S01176
     I*********** DS                                                      S01176
     I***********                             1  110@WKNOM                S01176
     I***********                             1  11 @WANOM                S01176
      *
     I*@KTG10******DS                             12                      S01117
      *
      ***Data*structure*used*as*key*to*TABTG10*************************** S01117
     I***********                             9  11 @KCCY                 S01117
      *
     I*@KTG20******DS                             12                      S01117
      *
      ***Data*structure*used*as*key*to*TABTG20****************************S01117
     I***********                             9  11 @KCCY3                S01117
      *
     I*@KTBTL******DS                             12                      S01117
      *
      ***Data*structure*used*as*key*to*TABLETL****************************S01117
     I***********                             8  10 @KCCY2                S01117
     I***********                            11  12 @KNN                  S01117
      *
     I*@KTBT2******DS                             12                      S01117
      *
      ***Data*structure*used*as*key*to*TABLET2****************************S01117
     I***********                             5  12 @KTB2                 S01117
      ***Fields*used*in*ZRATE***data*structure                            E21050
     I************DS                                                      E21050
     I************                            1   1 ZPROT                 E21050
     I************                            3  170ZSFPP                 E21050
     I************                           18  320ZSINP                 E21050
      **From*INVTPD                                                       E21050
     I************                            1   1 PROT                  E21050
      **From*SECTYD                                                       E21050
     I************                            3  170SFPP                  E21050
     I************                           18  320SINP                  E21050
      *                                                                   S01401
     IPDATA     E DSSE50DT                                                S01401
      ** Data structure to pass parameters to SE1805 for MT5xxs           S01401
      *                                                                   S01401
     ITRADX1    E DSTRADSDX1                                              S01401
      ** Data structure to pass extension file details to SE1805          S01401
     ITRADX2    E DSTRADSDX2                                              S01401
      ** Data structure to pass settlement details to SE1806              S01401
      *                                                                   S01401
      ** DS for customer/book standard settlement instruction                                 CSE028
      **  to be passed to SESSIR0                                                             CSE028
      *                                                                                       CSE028
     IPCBSTD    E DSSTDSED                    2                                               CSE028
     I              RECI                            WRECI                                     CSE028
     I              LCD                             WLCD                                      CSE028
     I              CHTP                            WCHTP                                     CSE028
     I              TNLU                            WTNLU                                     CSE028
      *                                                                                       CSE028
      ** Data structure for standard additional settlement details                            CSE028
      ** for customer/book to be passed to SESSIR0                                            CSE028
      *                                                                                       CSE028
     IPCBSAD    E DSSTDADSED                  8                                               CSE028
      *                                                                                       CSE028
     ISDBRCE    E DSSDBRCHEXPD                                                              AR871625
      *                                                                                     AR871625
     ISDSTPD    E DSSDSTPDPD                                                                AR871625
     I***ZWACC*******DS                                             081490081441
     I************DS                            256                081441 099817
     I************                            1   60ZWCNUM         081490 099817
     I************                            7   9 ZWCCY          081490 099817
     I************                           10  130ZWACOD         081490 099817
     I************                           14  150ZWACSQ         081490 099817
     I************                           16  18 ZWBRCA         081490 099817
     I************                            1  18 ZKACCN         081490 099817
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZYLDZ1                                                 S01176
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
     I*                                                                   S01408
     I/COPY WNCPYSRC,SE3002IIPG                                           S01408
     I*                                                                   S01408
     IDATA        DS                           1024                                           CER001
     I                                        1   6 PETDRF                                    CER001
     I                                        7   8 UTDBK                                     CER001
     I                                        9  14 UVTCNR                                    CER001
     I                                       15  190#1TDVD                                    CER001
     I                                       20  240#1TDDT                                    CER001
     I                                       25  290#1ISSD                                    CER001
     I                                       30  340#1MATY                                    CER001
     I/COPY ZSRSRC,ZSDESCZ2                                               CSE016
      *                                                                   S01176
     I              'SEVSEFSPR2'          C         SEVFSP                                    233607
     I              'SEVTRADTAX'          C         SEVTAX                                    234440
     I              'SEVTAXDATE'          C         SEVDAT                                    234552
      *                                                                                       233607
     C/EJECT
     C********************************************************************S01176
     C*                                                                  *S01176
     C*    M A I N   P R O C E S S I N G                                 *S01176
     C*                                                                  *S01176
     C*    Calls : SUB001                                                *S01176
     C*            SUB002 (3 times)                                      *S01176
     C*            SUB003                                                *S01176
     C*                                                                  *S01176
     C********************************************************************S01176
     C*
     C* Subtract existing charges and nominal if this is the market
     C* side of an agency trade
     C           @ACODE    IFNE 'T'
     C           @ACODE    ANDNE'E'
     C           @PATRD    IFEQ 'M'
     C                     SUB  @PTBCA    @CUMMC
     C***********          SUB  @PLTCA    @CUMMC                          S01176
     C***********          SUB  @PTPCA    @CUMMC                          S01176
     C*********************SUB  @PTCA1    @CUMMC                   S01176 069175
     C*********************SUB  @PTCA2    @CUMMC                   S01176 069175
     C                     END
     C                     END
      *                                                                   S01176
      ***  Store fields for standard subroutine                           S01176
     C                     Z-ADD@PNOML    ZNOML                           S01176
     C                     Z-ADD@PTCFC    ZTCFC                           S01176
     C*                                                                   S01176
     C** IF THE TRADE BASIS IS YIELD OR DISCOUNT, THEN THE PRICE FIELD    S01176
     C** IS USED IN CALCULATIONS, ELSE THE P/D/Y FIELD IS USED            S01176
     C           STBS      IFEQ 'Y'                                       S01176
     C           STBS      OREQ 'D'                                       S01176
     C                     Z-ADD@PPRIC    ZPRICE                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTPDY    ZPRICE                          S01176
     C                     END                                            S01176
     C/COPY WNCPYSRC,SE3002C035
      *                                                                   S01401
      **  Access Switchable features file for MT5xx processing -          S01401
      *                                                                   S01401
     C                     MOVE 'N'       S01401                          S01401
     C                     CALL 'AOSARDR0'                                S01401
     C                     PARM '       ' @RTCD                           S01401
     C                     PARM '*VERIFY' @OPTN                           S01401
     C                     PARM 'S01401'  @SARD   6                       S01401
      *                                                                   S01401
     C           @RTCD     IFEQ *BLANK                                    S01401
     C                     MOVE 'Y'       S01401  1                       S01401
     C           @ACODE    IFEQ 'I'                                       S01401
     C           TRDRF     ANDNE*BLANK                                    S01401
     C                     EXSR SETUP                                     S01401
     C                     ELSE                                           S01401
     C                     MOVEL*BLANKS   TRADX1                          S01401
     C                     MOVEL*BLANKS   TRADX2                          S01401
     C                     ENDIF                                          S01401
     C                     ENDIF                                          S01401
      *                                                                   S01446
      **  Access Switchable features file for Customer Commission         S01446
      **  and Bulk Input Enhancements                                     S01446
      *                                                                   S01446
     C                     MOVE 'N'       S01446                          S01446
     C                     CALL 'AOSARDR0'                                S01446
     C                     PARM '       ' @RTCD                           S01446
     C                     PARM '*VERIFY' @OPTN                           S01446
     C                     PARM 'S01446'  @SARD                           S01446
      *                                                                   S01446
     C           @RTCD     IFEQ *BLANK                                    S01446
     C                     MOVE 'Y'       S01446  1                       S01446
     C                     END                                            S01448
      *                                                                   S01448
     C                     MOVE 'N'       S01448                          S01448
     C                     CALL 'AOSARDR0'                                S01448
     C                     PARM '       ' @RTCD                           S01448
     C                     PARM '*VERIFY' @OPTN                           S01448
     C                     PARM 'S01448'  @SARD                           S01448
      *                                                                   S01448
     C           @RTCD     IFEQ *BLANK                                    S01448
     C                     MOVE 'Y'       S01448  1                       S01448
     C                     END                                            S01448
      *                                                                   S01509
     C**  Access SAR details file to see if S01509 is installed           S01509
      *                                                                   S01509
     C                     CALL 'AOSARDR0'                                S01509
     C                     PARM '       ' @RTCD                           S01509
     C                     PARM '*VERIFY' @OPTN                           S01509
     C                     PARM 'S01509'  @SARD                           S01509
      *                                                                   S01509
     C           @RTCD     IFEQ *BLANK                                    S01509
     C                     MOVE 'Y'       S01509  1                       S01509
     C                     ELSE                                           S01509
     C                     MOVE 'N'       S01509                          S01509
     C                     END                                            S01509
      *                                                                   S01510
     C**  Access SAR details file to see if S01510 is installed           S01510
      *                                                                   S01510
     C                     CALL 'AOSARDR0'                                S01510
     C                     PARM '       ' @RTCD                           S01510
     C                     PARM '*VERIFY' @OPTN                           S01510
     C                     PARM 'S01510'  @SARD                           S01510
      *                                                                   S01510
     C           @RTCD     IFEQ *BLANK                                    S01510
     C                     MOVE 'Y'       S01510  1                       S01510
     C                     ELSE                                           S01510
     C                     MOVE 'N'       S01510                          S01510
     C                     END                                            S01510
     C*                                                                   CEU005
     C**  Access SAR details file to see if CEU005 SAR is installed.      CEU005
     C*                                                                   CEU005
     C                     CALL 'AOSARDR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*VERIFY' @OPTN                           CEU005
     C                     PARM 'CEU005'  @SARD                           CEU005
     C*                                                                   CEU005
     C           @RTCD     IFEQ *BLANK                                    CEU005
     C                     MOVE 'Y'       CEU005  1                       CEU005
     C                     MOVE *ON       *IN15                           CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'N'       CEU005                          CEU005
     C                     MOVE *OFF      *IN15                           CEU005
     C                     ENDIF                                          CEU005
      *                                                                                       CSE035
      ** Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  @SARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                                       CSE035
     C           *LIKE     DEFN RUND      ECDPRV                                              CSE035
     C           *LIKE     DEFN NCD       NCDPRV                                              CSE035
      *
      ** Access Switchable Features file and check if CSE039 is                               CSE039
      ** installed                                                                            CSE039
      *                                                                                       CSE039
     C                     CALL 'AOSARDR0'                                                    CSE039
     C                     PARM *BLANKS   @RTCD                                               CSE039
     C                     PARM '*VERIFY' @OPTN                                               CSE039
     C                     PARM 'CSE039'  @SARD                                               CSE039
      *                                                                                       CSE039
     C           @RTCD     IFEQ *BLANK                                                        CSE039
     C                     MOVE 'Y'       CSE039                                              CSE039
     C                     ELSE                                                               CSE039
     C                     MOVE 'N'       CSE039  1                                           CSE039
     C                     ENDIF                                                              CSE039
      *
      *                                                                                       CAS006
      ** Determine if CAS006 (Hedge Accounting Phase B) is installed                          CAS006
      *                                                                                       CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   @RTCD                                               CAS006
     C                     PARM '*VERIFY' @OPTN                                               CAS006
     C                     PARM 'CAS006'  @SARD                                               CAS006
      *                                                                                       CAS006
     C           @RTCD     IFEQ *BLANK                                                        CAS006
     C                     MOVE 'Y'       CAS006  1                                           CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'N'       CAS006                                              CAS006
     C                     ENDIF                                                              CAS006
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CP14                                           S01408
     C*                                                                   S01408
      *                                                                   S01448
     C**   Access MIDAS MODULES Details                                   081382
     C*                                                                   081382
     C                     CALL 'AOMMODR0'                                081382
     C                     PARM '*DBERR ' @RTCD   7                       081382
     C                     PARM '*FIRST ' @OPTN   7                       081382
     C           SDMMOD    PARM SDMMOD    DSFDY                           081382
     C*                                                                   081382
      ** Switch on U1 if Retail Module is ON                                                  CRE020
      *                                                                                       CRE020
     C           BGRTBN    IFEQ 'Y'                                                           CRE020
     C                     MOVE *ON       *INU1                                               CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           BGPFMG    IFEQ 'Y'                                       081382
     C*                                                                   081382
     C                     MOVE @PTCNR    @PTCN2  6                       081382
     C                     MOVEL@PTCNR    @PLKY                           081382
     C                     CALL 'AOPLCSR0'                                081382
     C                     PARM *BLANKS   @RTCD                           081382
     C                     PARM '*KEY   ' @OPTN                           081382
     C                     PARM           @PLKY  10                       081382
     C           SDPLCS    PARM SDPLCS    DSFDY                           081382
     C*                                                                   081382
     C           @RTCD     IFEQ *BLANKS                                   081382
     C                     MOVEL'Y'       WLPCUS  1                       081382
     C                     ELSE                                           081382
     C                     MOVE 'N'       WLPCUS                          081382
     C                     END                                            081382
     C                     END                                            081382
     C*                                                                   CPB001
     C                     MOVE 'N'       WPBCUS                          CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE @PTCNR    @PTCN2  6                       CPB001
     C                     MOVEL@PTCNR    @PLKY                           CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD                           CPB001
     C                     PARM '*KEY   ' @OPTN                           CPB001
     C                     PARM           @PLKY  10                       CPB001
     C                     PARM           WKEY7   7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   CPB001
     C           @RTCD     IFEQ *BLANKS                                   CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVEL'Y'       WPBCUS  1                       CPB001
     C                     MOVE *ON       *IN09                           CPB001
     C                     OPEN PMPORTPD                                  CPB001
     C                     OPEN PMPORTLL                                  CPB001
     C                     ELSE                                           CPB001
     C                     MOVE 'N'       WPBCUS                          CPB001
     C                     END                                            CPB001
     C                     END                                            CPB001
     C*                                                                   081382
     C** Check whether Portfolio Management is switched on                081382
     C*                                                                   081382
     C           BGPFMG    IFEQ 'Y'                                       081382
     C           WLPCUS    ANDEQ'Y'                                       081382
     C                     SETON                     29                   081382
     C*                                                                   081382
     C** Open necessary files                                             081382
     C*                                                                   081382
     C**********           OPEN PMPORTPD                           081382 CPB001
     C                     OPEN PMHSEXPD                                  081382
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C           WPBCUS    ORNE 'Y'                                       CPB001
     C                     OPEN PMPORTPD                                  CPB001
     C                     OPEN PMPORTLL                                  CPB001
     C                     ENDIF                                          CPB001
     C*                                                                   081382
     C**   Access PORTFOLIO MANAGEMENT ICD Details                        081382
     C*                                                                   081382
     C                     CALL 'AOPORTR0'                                081382
     C                     PARM '*DBERR ' @RTCD   7                       081382
     C                     PARM '*FIRST ' @OPTN   7                       081382
     C           SDPORT    PARM SDPORT    DSFDY                           081382
     C                     END                                            081382
     C*                                                                   081382
     C**   Access Switchable Features Details                             081382
     C*                                                                   081382
     C                     CALL 'AOSARDR0'                                081382
     C                     PARM *BLANKS   @RTCD   7                       081382
     C                     PARM '*VERIFY' @OPTN   7                       081382
     C                     PARM 'S01496'  @SKEY   6                       081382
     C           SCSARD    PARM SCSARD    DSFDY                           081382
     C*                                                                   081382
     C** Check whether Jyske SE Enhancements is switched on               081382
     C*                                                                   081382
     C           @RTCD     IFEQ *BLANKS                                   081382
     C                     MOVEL'Y'       S01496  1                       081382
     C                     OPEN SECUBRL0                                  081382
     C                     ELSE                                           081382
     C                     OPEN CUBRD                                     081382
     C                     END                                            081382
      *                                                                   CSE007
      ***  Access Switchable features file for Corporate Actions.         CSE007
      *                                                                   CSE007
     C                     MOVE 'N'       CSE007  1                       CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM '       ' @RTCD                           CSE007
     C                     PARM '*VERIFY' @OPTN                           CSE007
     C                     PARM 'CSE007'  @SARD                           CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANKS                                   CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       CSE007                          CSE007
     C                     ELSE                                           CSE007
      *                                                                   CSE007
      ***  Setup work field to call SE6710, SE6712 and SE6714.            CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6710  1                       CSE007
     C                     MOVE 'Y'       SE6712  1                       CSE007
     C                     MOVE 'Y'       SE6714  1                       CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CEU017
      ***  Access Switchable features file for Securities Redenomination  CEU017
      *                                                                   CEU017
     C                     MOVE 'N'       CEU017  1                       CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM '       ' @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  @SARD                           CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANKS                                   CEU017
      *                                                                   CEU017
      ***  If Securities Redenomination feature is installed.             CEU017
      *                                                                   CEU017
     C                     MOVE 'Y'       CEU017                          CEU017
     C                     ELSE                                           CEU017
      *                                                                   CEU017
      ***  Setup work field to call SE6710, SE6712 and SE6714.            CEU017
      *                                                                   CEU017
     C                     MOVE 'Y'       SE6710  1                       CEU017
     C                     MOVE 'Y'       SE6712  1                       CEU017
     C                     MOVE 'Y'       SE6714  1                       CEU017
     C                     ENDIF                                          CEU017
      *                                                                   CAC002
      **  Seton ind. 30 if Analytical Accounting module is installed      CAC002
      **  and access PCA ICD                                              CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE *ON       *IN30                           CAC002
     C                     EXSR AOPCAC                                    CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *OFF      *IN30                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC005
      ***  Check if CAC005 - PCA-SE Enhancement is on.                    CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   @RTCD                           CAC005
     C                     PARM '*VERIFY' @OPTN                           CAC005
     C                     PARM 'CAC005'  @SARD                           CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
      *                                                                   CSE006
      * Reset @SBRCD field to *Blank if program is called from            CSE006
      * SEBYSLSIN.                                                        CSE006
     C           P@BYSL    IFEQ 'Y'                                       CSE006
     C                     MOVE *BLANKS   @SBRCD                          CSE006
     C                     ENDIF                                          CSE006
      *                                                                   CGL011
      ** Access Switchable Features file to check if CGL011               CGL011
      ** is installed.                                                    CGL011
      *                                                                   CGL011
     C                     MOVE 'N'       @PCOLF  1                       CGL011
      *                                                                   CGL011
     C                     CALL 'AOSARDR0'                                CGL011
     C                     PARM *BLANKS   @RTCD                           CGL011
     C                     PARM '*VERIFY' @OPTN                           CGL011
     C                     PARM 'CGL011'  @SARD                           CGL011
     C           SCSARD    PARM SCSARD    DSFDY                           CGL011
      *                                                                   CGL011
     C           @RTCD     IFNE *BLANKS                                   CGL011
     C           @RTCD     ANDNE'*NRF   '                                 CGL011
     C                     Z-ADD20        @DBASE                          CGL011
     C                     MOVEL'SCSARDPD'@DBFIL                          CGL011
     C                     MOVEL'CGL011'  @DBKEY                          CGL011
     C                     EXSR *PSSR                                     CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CGL011
     C           @RTCD     IFEQ *BLANKS                                   CGL011
     C                     MOVE 'Y'       @PCOLF                          CGL011
     C                     ENDIF                                          CGL011
      *                                                                   CSE023
      ** Access Switchable Features file and check if CSE023 is           CSE023
      ** installed                                                        CSE023
      *                                                                   CSE023
     C                     CALL 'AOSARDR0'                                CSE023
     C                     PARM *BLANKS   @RTCD                           CSE023
     C                     PARM '*VERIFY' @OPTN                           CSE023
     C                     PARM 'CSE023'  @SARD                           CSE023
      *                                                                   CSE023
     C           @RTCD     IFEQ *BLANK                                    CSE023
     C                     MOVE 'Y'       CSE023                          CSE023
     C                     ELSE                                           CSE023
     C                     MOVE 'N'       CSE023  1                       CSE023
     C                     ENDIF                                          CSE023
      *                                                                                       CSE028
      ** Access Switchable Features file and check if CSE028 is                               CSE028
      ** installed                                                                            CSE028
      *                                                                                       CSE028
     C                     CALL 'AOSARDR0'                                                    CSE028
     C                     PARM *BLANKS   @RTCD                                               CSE028
     C                     PARM '*VERIFY' @OPTN                                               CSE028
     C                     PARM 'CSE028'  @SARD                                               CSE028
      *                                                                                       CSE028
     C           @RTCD     IFEQ *BLANK                                                        CSE028
     C                     MOVE 'Y'       CSE028                                              CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'N'       CSE028  1                                           CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CGL014
      ** Check if enhancement CGL014 (Collaterals Processing) is on                           CGL014
      *                                                                                       CGL014
     C                     CALL 'AOSARDR0'                                                    CGL014
     C                     PARM *BLANKS   @RTCD                                               CGL014
     C                     PARM '*VERIFY' @OPTN                                               CGL014
     C                     PARM 'CGL014'  @SARD                                               CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ *BLANKS                                                       CGL014
     C                     MOVE 'Y'       CGL014  1                                           CGL014
     C                     ELSE                                                               CGL014
     C                     MOVE 'N'       CGL014                                              CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
      ** Check if enhancement ULX004 is installed                                             CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   @RTCD                                               CER001
     C                     PARM '*VERIFY' @OPTN                                               CER001
     C                     PARM 'ULX004'  @SARD                                               CER001
      *                                                                                       CER001
     C                     SELEC                                                              CER001
     C           @RTCD     WHEQ *BLANKS                                                       CER001
     C                     MOVE 'Y'       ULX004  1                                           CER001
     C           @RTCD     WHEQ '*NRF   '                                                     CER001
     C                     MOVE 'N'       ULX004                                              CER001
     C                     OTHER                                                              CER001
     C                     Z-ADD48        @DBASE                                              CER001
     C                     MOVEL'SCSARDPD'@DBFIL                                              CER001
     C                     MOVEL'ULX004'  @DBKEY                                              CER001
     C                     EXSR *PSSR                                                         CER001
     C                     ENDSL                                                              CER001
      *                                                                                       233607
      ** Check if CGL031 (Taxation of Savings Income) is enabled.                             233607
      *                                                                                       233607
     C                     CALL 'AOSARDR0'                                                    233607
     C                     PARM *BLANKS   PRTCD                                               233607
     C                     PARM '*VERIFY' POPTN                                               233607
     C                     PARM 'CGL031'  PSARD   6                                           233607
     C           SCSARD    PARM SCSARD    DSFDY                                               233607
      *                                                                                       233607
     C                     MOVE 'N'       CGL031  1                                           233607
     C                     MOVE *OFF      *IN20                                               233607
      *                                                                                       233607
     C           PRTCD     IFEQ *BLANKS                                                       233607
     C                     MOVE 'Y'       CGL031                                              233607
     C                     MOVE *ON       *IN20                                               233607
     C                     ELSE                                                               233607
      *                                                                                       233607
     C           PRTCD     IFNE '*NRF   '                                                     233607
     C           *LOCK     IN   LDA                                                           233607
     C                     MOVEL'SCSARDPD'@DBFIL                                              233607
     C                     MOVEL'CGL031'  @DBKEY                                              233607
     C                     Z-ADD101       @DBASE                                              233607
     C                     OUT  LDA                                                           233607
     C                     EXSR *PSSR                                                         233607
     C                     ENDIF                                                              233607
      *                                                                                       233607
     C                     ENDIF                                                              233607
      *                                                                                     AR871625
      ** Check if CER049 (Stamp Tax) is enabled                                             AR871625
      *                                                                                     AR871625
     C                     CALL 'AOSARDR0'                                                  AR871625
     C                     PARM *BLANKS   PRTCD                                             AR871625
     C                     PARM '*VERIFY' POPTN                                             AR871625
     C                     PARM 'CER049'  PSARD                                             AR871625
     C           SCSARD    PARM SCSARD    DSFDY                                             AR871625
      *                                                                                     AR871625
     C                     MOVE 'N'       CER049  1                                         AR871625
      *                                                                                     AR871625
     C           PRTCD     IFEQ *BLANKS                                                     AR871625
     C                     MOVE 'Y'       CER049                                            AR871625
     C                     MOVE '1'       WK10X   1                                         AR871625
     C                     ELSE                                                             AR871625
      *                                                                                     AR871625
     C                     MOVE '0'       WK10X                                             AR871625
     C           PRTCD     IFNE '*NRF   '                                                   AR871625
     C           *LOCK     IN   LDA                                                         AR871625
     C                     MOVEL'SCSARDPD'@DBFIL                                            AR871625
     C                     MOVEL'CER049'  @DBKEY                                            AR871625
     C                     Z-ADD102       @DBASE                                            AR871625
     C                     OUT  LDA                                                         AR871625
     C                     EXSR *PSSR                                                       AR871625
     C                     ENDIF                                                            AR871625
      *                                                                                     AR871625
     C                     ENDIF                                                            AR871625
     C*
      * Process according to action code received
     C           @ACODE    CASEQ'T'       SUB001
     C           @ACODE    CASEQ'I'       SUB002
     C           @ACODE    CASEQ'E'       SUB002
     C           @ACODE    CASEQ'N'       SUB002
     C                     CAS            SUB003
     C                     END
      *
      * Accumulate charges and nominal if this is the market side
      * of an agency trade (and Cmd/3 or Cmd/5 NOT used to exit)
     C           @SAVA     IFNE 'E'
     C           @PATRD    IFEQ 'M'
      *
     C***********@ACODE    IFNE '1'                                       E18010
     C           @ACODE    IFNE '3'                                       E18010
     C           @ACODE    ANDNE'5'
      *
     C                     ADD  @PTBCA    @CUMMC
     C***********          ADD  @PLTCA    @CUMMC                          S01176
     C***********          ADD  @PTPCA    @CUMMC                          S01176
     C*********************ADD  @PTCA1    @CUMMC                   S01176 069175
     C*********************ADD  @PTCA2    @CUMMC                   S01176 069175
      *
      * If Cmd/3 or Cmd/5 used to exit, reset parameters from stored
      * values
     C                     ELSE
     C**********           Z-ADD@OCMMC    @CUMMC
     C***********          ADD  @OTBCA    @CUMMC                          S01176
     C***********          ADD  @OLTCA    @CUMMC                          S01176
     C***********          ADD  @OTPCA    @CUMMC                          S01176
     C                     ADD  @OTBCN    @CUMMC                          S01176
     C*********************ADD  @OTCN1    @CUMMC                   S01176 069175
     C*********************ADD  @OTCN2    @CUMMC                   S01176 069175
      *
     C                     END
      *
     C                     END
     C                     END
      *
      * Close screen file if opened
     C           @ACODE    IFNE 'N'
     C                     CLOSESE3002DF
     C                     END
     C**                                                                  081382
     C           S01496    IFEQ 'Y'                                       081382
     C                     CLOSESECUBRL0                                  081382
     C                     ELSE                                           102736
     C                     CLOSECUBRD                                     102736
     C                     END                                            081382
     C**                                                                  081382
     C           BGPFMG    IFEQ 'Y'                                       081382
     C           WLPCUS    ANDEQ'Y'                                       081382
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WPBCUS    ANDEQ'Y'                                       CPB001
     C                     CLOSEPMPORTPD                                  081382
     C***********          CLOSEPMHSEXPD                           081382 CPB001
     C                     CLOSEPMPORTLL                                  066690
     C                     END                                            081382
      *                                                                   CPB001
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C           WLPCUS    ANDEQ'Y'                                       CPB001
     C                     CLOSEPMHSEXPD                                  CPB001
     C                     ENDIF                                          CPB001
      *
      * Terminate program without setting on LR
     C                     RETRN
      *                                                                   S01176
      /EJECT
      *****************************************************************
      *  PLIST's, KLIST's, DEFN's etc....                             *
      *****************************************************************
      *
     C           *ENTRY    PLIST
     C                     PARM           @PARMT
     C                     PARM           @PRMT2                                            AR871625
     C           @SAVA     PARM           @ACODE  1
     C           @OCMMC    PARM           @CUMMC 150
     C                     PARM           @CUMMN 150
      *                                                                   S01401
      **  Extra parameter used to receive trade reference. Details from   S01401
      **  TRADSDX1 & TRADSDX2 will be used in SE1805 & SE1806 respect -   S01401
      **  ively to set up default value when action code is 'I' insert.   S01401
     C                     PARM           TRDRF   6                       S01401
     C                     PARM           @BKRF   6                       S01401
      *                                                                   S01448
      *  Extra parameter for Bulk Enhancements to indicate a cross        S01448
      *  agency trade                                                     S01448
     C                     PARM           @CAGT   1                       S01448
      * New parameter - Called from Buy-Sell Maintenance flag             CSE006
     C                     PARM           P@BYSL  1                       CSE006
      * New parameter - Set up clearance type flag.                                           191878
     C                     PARM           CLRTYP  1                                           191878
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CP13                                           S01408
     C*                                                                   S01408
      *
     C           *NAMVAR   DEFN           LDA
     C           *LIKE     DEFN @ACODE    @SAVA
     C           *LIKE     DEFN @DBALL    @DBSAV
     C************LIKE     DEFN @PTBCA    @OTBCA                          S01176
     C************LIKE     DEFN @PLTCA    @OLTCA                          S01176
     C************LIKE     DEFN @PTPCA    @OTPCA                          S01176
     C           *LIKE     DEFN @PTBCA    @OTBCN                          S01176
     C           *LIKE     DEFN @PTCA1    @OTCN1                          S01176
     C           *LIKE     DEFN @PTCA2    @OTCN2                          S01176
     C           *LIKE     DEFN @CUMMC    @OCMMC
     C           *LIKE     DEFN @CUMMN    @OCMMN
     C           *LIKE     DEFN @STBCA    @OTBCA                          S01176
     C           *LIKE     DEFN @STCCA    @OTCCA                          S01176
     C           *LIKE     DEFN @STCA1    @OTCA1                          S01176
     C           *LIKE     DEFN @STCA2    @OTCA2                          S01176
     C           *LIKE     DEFN @STCA3    @OTCA3                          S01176
     C           *LIKE     DEFN @STCA4    @OTCA4                          S01176
     C           *LIKE     DEFN @STCA5    @OTCA5                          S01176
     C           *LIKE     DEFN @STCA6    @OTCA6                          S01176
     C           *LIKE     DEFN @STCA7    @OTCA7                          S01176
     C           *LIKE     DEFN @STAXA    @OTAXA                          S01176
     C           *LIKE     DEFN @SBCMR    @OBCMR                          S01176
     C           *LIKE     DEFN @SCCMR    @OCCMR                          S01176
     C           *LIKE     DEFN @STXRB    @OTXRB                          S01176
     C           *LIKE     DEFN @PTDSN    WPADJ                           E21050
     C           *LIKE     DEFN RUND      @WPDAT                          E21050
     C           *LIKE     DEFN RUND      ECD
     C************LIKE     DEFN TVCA      WTVCA                           S01176
     C************LIKE     DEFN LTCA      WLTCA                           S01176
     C************LIKE     DEFN TPCA      WTPCA                           S01176
     C************LIKE     DEFN TOCA      WTOCA                           S01176
     C************LIKE     DEFN TLTA      WTLTA                           S01176
     C           *LIKE     DEFN TBCA      WTBCA
     C           *LIKE     DEFN TCCA      WTCCA
     C           *LIKE     DEFN TCA1      WTCA1
     C           *LIKE     DEFN TCA2      WTCA2
     C           *LIKE     DEFN TCA3      WTCA3
     C           *LIKE     DEFN TCA4      WTCA4                           S01176
     C           *LIKE     DEFN TCA5      WTCA5                           S01176
     C           *LIKE     DEFN TCA6      WTCA6                           S01176
     C           *LIKE     DEFN TCA7      WTCA7                           S01176
     C           *LIKE     DEFN TAXA      WTAXA                           S01176
     C           *LIKE     DEFN BCMR      WBCMR                           S01176
     C           *LIKE     DEFN CCMR      WCCMR                           S01176
     C           *LIKE     DEFN TXRB      WTXRB                           S01176
     C************LIKE     DEFN PN01      @WPN01                          S01175
     C************LIKE     DEFN PN02      @WPN02                          S01175
     C           *LIKE     DEFN BFPNP1    @WPN01                          S01175
     C           *LIKE     DEFN BFPNP2    @WPN02                          S01175
     C           *LIKE     DEFN @STDVD    @DSCVD                          S01176
     C           *LIKE     DEFN @PTDVD    C@TDVD                                              235547
     C           *LIKE     DEFN A6SPRT    USPRT                           S01446
     C           *LIKE     DEFN A6MDIN    UMDIN                           S01446
     C           *LIKE     DEFN A6NBDP    UNBDP                           S01446
     C           *LIKE     DEFN A6NQDP    ZNQDP1                          CAC002
     C           *LIKE     DEFN A6NQDP    ZNQDP2                          CAC002
     C           *LIKE     DEFN A6NQDP    ZNQDPX                          CAC002
     C           *LIKE     DEFN A6SPRT    UCHXRT                          S01446
     C           *LIKE     DEFN A6MDIN    UCHXMD                          S01446
     C           *LIKE     DEFN @DBASE    DBASE                           081490
     C           *LIKE     DEFN @DBKEY    DBKEY                           081490
     C           *LIKE     DEFN @DBFIL    DBFILE                          081490
      *                                                                   S01176
      * Key list for LF/INVTP
     C           @KEY1     KLIST
     C                     KFLD           NMCYA
     C                     KFLD           SITP
      *
      * Key list for LF/ACCNT
     C           @KEY2     KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCA
      *
      **Key*list*for*LF/CLINT**********************************************
     C***********@KEY3     KLIST
     C***********          KFLD           CNUM
     C***********          KFLD           RCDT
      *
      * Key list for PF/STDSED
     C           @KEY4     KLIST
     C***********          KFLD           @PTDBR                          S01117
     C                     KFLD           @PTDBA                          S01117
     C                     KFLD           @PTCNR
     C                     KFLD           SIBK                                                CSE028
     C                     KFLD           VLCY
     C***********          KFLD           SITP                            E37020
      *
      * Key list for PF/STDSED                                            S01509
     C           @KEY4S    KLIST                                          S01509
     C                     KFLD           @PTDBA                          S01509
     C                     KFLD           @PTCNR                          S01509
     C                     KFLD           SIBK                                                CSE028
     C                     KFLD           NMCYA                           S01509
      *                                                                   S01509
      * Key list for PF/STDSED
     C           @KEY5     KLIST
     C***********          KFLD           @PTDBR                          S01117
     C                     KFLD           @PTDBA                          S01117
     C                     KFLD           @PTCNR
     C                     KFLD           SIBK                                                CSE028
     C                     KFLD           @PSETC
      *
      * Key list for PF/STDSED
     C           @KEY6     KLIST
     C***********          KFLD           @PTDBR                          S01117
     C                     KFLD           @PTDBA                          S01117
     C                     KFLD           @PTCNR
     C                     KFLD           SIBK                                                CSE028
     C                     KFLD           @PSETC
     C                     KFLD           SITP
     C*                                                                   S01496
     C** KLIST for LF/SECUBRL0                                            S01496
     C*                                                                   S01496
     C           @KEY9A    KLIST                                          S01496
     C                     KFLD           @KCLGR  2                       S01496
     C                     KFLD           @KSITP  3                       S01496
     C                     KFLD           @KMRKT  2                       S01496
     C**********           KFLD           @KCNUM  60                                  S01496 CSD027A
     C                     KFLD           @KCNUM  6                                          CSD027A
      *
      * Key list for LF/SECGT
     C           @KEY7     KLIST
     C                     KFLD           @XCCY   3
     C                     KFLD           @XCODE  2
      *
      * Key list for LF/SECEO format SEDEVDO                              E21050
     C           @KEY8     KLIST                                          E21050
     C                     KFLD           SDSN                            E21050
     C                     KFLD           SDET                            E21050
     C                     KFLD           SDED                            E21050
      **Key*list*for*LF/SECED**format*SNDEVDF************                 E21050
     C***********@KEY8     KLIST                                          E21050
     C***********          KFLD           SNSN                            E21050
     C***********          KFLD           SNDT                            E21050
     C***********          KFLD           SNET                            E21050
      *
      * KLIST for LF/CUBRD
     C           @KEY9     KLIST
     C                     KFLD           @KC1DI  1
     C                     KFLD           @KSITP  3
     C                     KFLD           @KMRKT  2
     C**********           KFLD           @KCNUM  60                                         CSD027A
     C                     KFLD           @KCNUM  6                                          CSD027A
      **Key*list*for*LF/SECED**format*SEDEVDF************                 E21050
     C***********@KEY11    KLIST                                          E21050
     C***********          KFLD           SDSN                            E21050
     C***********          KFLD           SDED                            E21050
     C***********          KFLD           SDET                            E21050
     C*                                                                   S01117
     C* Define key list for file SEPCBD                                   S01117
     C*                                                                   S01117
     C           KLSPCB    KLIST                                          S01117
     C                     KFLD           BOKC                            S01117
     C                     KFLD           KBRC    3                       S01117
     C                     KFLD           KSSN   10                       S01117
     C                     KFLD           MKTI                            S01117
     C*                                                                   S01117
     C* Define key list for file SEPCCD                                   S01117
     C*                                                                   S01117
     C           KLSPCC    KLIST                                          S01117
     C**********           KFLD           KCNUM   60                                  S01117 CSD027A
     C                     KFLD           KCNUM   6                                          CSD027A
     C                     KFLD           KBRCA   3                       S01117
     C                     KFLD           KSESN  10                       S01117
      *                                                                   S01486
     C           PORTKY    KLIST                                          S01486
     C                     KFLD           @PTCNR                          S01486
     C                     KFLD           SPTFR                           S01486
     C*                                                                   S01486
     C           HSEXKY    KLIST                                          S01486
     C                     KFLD           HSEXCY  3                       S01486
     C                     KFLD           @PTDDT                          S01486
      *                                                                   CSE023
      ** KLIST for SDTXBSL0 file                                          CSE023
      *                                                                   CSE023
     C           KTXBS     KLIST                                          CSE023
     C                     KFLD           KCRTT   2                       CSE023
     C                     KFLD           KTAXB   2                       CSE023
     C                     KFLD           KEFDT   50                      CSE023
      *                                                                   CSE023
      ** KLIST for SDWHTTL5 file                                          CSE023
      *                                                                   CSE023
     C           KWHTT     KLIST                                          CSE023
     C                     KFLD           KCRTT   2                       CSE023
     C                     KFLD           KINVT   3                       CSE023
      *                                                                   CSE023
      ** KLIST for SDWTCSL0 file                                          CSE023
      *                                                                   CSE023
     C           KWTCS     KLIST                                          CSE023
     C                     KFLD           KCNO    6                       CSE023
     C                     KFLD           KCRTT   2                       CSE023
     C***********                                                  081490 099817
     C***********ZWACCN    KLIST                                   081490 099817
     C***********          KFLD           ZWCNUM                   081490 099817
     C***********          KFLD           ZWCCY                    081490 099817
     C***********          KFLD           ZWACOD                   081490 099817
     C***********          KFLD           ZWACSQ                   081490 099817
     C***********          KFLD           ZWBRCA                   081490 099817
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *  SUB001 - Terminate program, close files                      *
      *****************************************************************
      *
     C           SUB001    BEGSR
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR                           SUB001 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /SPACE 3
      *****************************************************************
      *  SUB002 - Main processing for action code I or E              *
      *****************************************************************
      *
     C           SUB002    BEGSR
      *                                                                                       191878
      ** Bring in Clearance type in from calling programs.                                    191878
      *                                                                                       191878
     C                     MOVE CLRTYP    @PCLTY                                              191878
     C                     MOVE CLRTYP    @SCLTY                                              191878
     C                     MOVE CLRTYP    @OCLTY                                              191878
      *
      * Open screen file if action is not 'N' (no display)
     C           @ACODE    IFNE 'N'
     C                     OPEN SE3002DF
     C                     END
      *
      * Initialize program. If recall flag has been set then this is a
      * recall of a program that did not set on LR, so just reset
      * fields, else perform full initialization.
     C           @RECAL    CASEQ'Y'       SUB100
     C                     CAS            SUB101
     C                     END
     C*                                                                   E14496
     C* If enquiry, fetch ALL trade details                               E14496
     C           @ACODE    IFEQ 'E'                                       E14496
     C           @PTDRF    CHAINTRADSDF              33                   E14496
     C           *IN33     IFEQ '0'                                       E21052
     C                     MOVEL@TRADS    @PARMT                          E14496
     C                     END                                            E21052
     C                     END                                            E14496
      *
      * Fill screen 1
     C                     EXSR SUB102
      *
     C           *IN12     DOUEQ'0'
     C           *INKC     OREQ '1'                                       E24724
     C/COPY WNCPYSRC,SE3002C001
      *                                                                                       CER001
      ** Tag for Window Processing                                                            CER001
     C           FIRST     TAG                                                                CER001
      *                                                                                       CAS006
     C           WFSCR3    IFNE 'Y'                                                           CAS006
      *
      * Display/validate screen
     C**********           SETOF                     10                                       CAS006
     C                     MOVE '1'       WSCRN   1                                           CAS006
     C                     EXSR SUB103
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
      ** If Cmd/12 has been pressed on screen 2 (CAS006) to redisplay                         CAS006
      ** screen 1 (*IN12 on) and then Cmd/12 or 9 pressed on screen 1                         CAS006
      ** to bypass screen 2 (CAS006) then recheck screen 2 for errors                         CAS006
      ** before exiting program. Setof Cmd/12 and 9 if errors.                                CAS006
      *                                                                                       CAS006
     C           @ACODE    IFEQ 'I'                                                           CAS006
     C           *IN12     ANDEQ'1'                                                           CAS006
     C           *INKL     IFEQ '1'                                                           CAS006
     C           *INKI     OREQ '1'                                                           CAS006
      *                                                                                       CAS006
      ** Reset error fields and indicators before validation                                  CAS006
      *                                                                                       CAS006
     C                     MOVEA*BLANKS   @EA                                                 CAS006
     C                     Z-ADD1         E                                                   CAS006
      *                                                                                       CAS006
     C                     MOVE '0'       WK10                                                CAS006
     C                     MOVE '0'       WK16                                                CAS006
     C                     MOVE '0'       WK17                                                CAS006
     C                     MOVE '0'       *IN11                                               CAS006
      *                                                                                       CAS006
     C                     EXSR SUB202                                                        CAS006
      *                                                                                       CAS006
     C                     MOVEA@EA,1     @SERR1                                              CAS006
      *                                                                                       CAS006
     C********** @EA,20    IFNE *BLANKS                                                CAS006 234440
     C**********           MOVE *ON       *IN07                                        CAS006 234440
     C**********           MOVEA@EA,20    @SERR2                                       CAS006 234440
     C**********           ENDIF                                                       CAS006 234440
      *                                                                                       CAS006
     C           *IN11     IFEQ '1'                                                           CAS006
     C                     MOVE *OFF      *INKL                                               CAS006
     C                     MOVE *OFF      *INKI                                               CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'Y'       WRVSC3  1                                           CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *
      * Set up screen 2 defaults if action is I
     C           @ACODE    IFNE 'D'
     C           @ACODE    ANDNE'E'                                       E14496
     C           @PRECI    ANDNE'D'
     C************INKA     ANDEQ'0'                                       E18010
     C           *INKC     ANDEQ'0'                                       E18010
     C           *INKE     ANDEQ'0'
     C           *IN12     ANDEQ'0'
     C                     EXSR SUB303
     C                     END
      *
      * If Cmd/12 has been pressed on screen 2 to redisplay screen 1
      * (*IN12 on) and then Cmd/12 or 9 pressed on screen 1 to bypass
      * screen 2, then recheck screen 2 for errors before
      * exiting program. Setof Cmd/12 and 9 if errors.
     C           @ACODE    IFEQ 'I'
     C           *IN12     ANDEQ'1'
     C           CAS006    ANDNE'Y'                                                           CAS006
     C           CAS006    OREQ 'Y'                                                           CAS006
     C           WBSCR3    ANDEQ'Y'                                                           CAS006
     C           WRVSC3    ANDEQ'Y'                                                           CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           WBSCR3    ANDEQ'Y'                                                           CAS006
     C           WRVSC3    ANDEQ'Y'                                                           CAS006
     C                     MOVE *BLANK    WBSCR3                                              CAS006
     C                     MOVE *BLANK    WRVSC3                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C************INKB     IFEQ '1'                                       E18010
     C************INKG     OREQ '1'                                       E18010
     C           *INKL     IFEQ '1'                                       E18010
     C           *INKI     OREQ '1'                                       E18010
      *
      * Reset error fields and indicators (11 and 50-89) before validation
     C                     MOVEA*BLANKS   @EA
     C                     Z-ADD1         E
     C***********          SETOF                     515253               S01176
     C***********          SETOF                     545556               S01176
     C***********          SETOF                     575859               S01176
     C***********          SETOF                     606162               S01176
     C***********          SETOF                     636465               S01176
     C***********          SETOF                     666768               S01176
     C***********          SETOF                     697071               S01176
     C***********          SETOF                     727374               S01176
     C***********          SETOF                     757677               S01176
     C***********          SETOF                     787980               S01176
     C***********          SETOF                     818283               S01176
     C***********          SETOF                     848586               S01176
     C***********          SETOF                     87  11               S01176
     C                     SETOF                     111449               S01176
     C                     SETOF                     2122                 S01117
     C                     SETOF                     232428               S01486
     C                     SETOF                     313234               CAC002
     C           CEU005    IFEQ 'Y'                                       CEU005
     C                     MOVE *IN33     WKIN33  1                       CEU005
     C                     SETOF                     0833                 CEU005
     C                     ENDIF                                          CEU005
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     MOVE *IN43     WKIN43  1                                           233607
     C                     MOVE *OFF      *IN43                                               233607
     C                     ENDIF                                                              233607
     C                     MOVEA'00000000'*IN,50                          S01176
     C                     MOVEA'00000000'*IN,58                          S01176
     C                     MOVEA'00000000'*IN,66                          S01176
     C                     MOVEA'00000000'*IN,74                          S01176
     C                     MOVEA'00000000'*IN,82                          S01176
      *
     C                     EXSR SUB203                     Validate scr 2
      *
     C                     MOVEA@EA,1     @SERR1
     C********** @EA,20    IFNE *BLANKS                                                E21054 234440
     C**********           SETON                     07                                E21054 234440
     C**********           MOVEA@EA,20    @SERR2                                              234440
     C**********           END                                                         E21054 234440
     C*
     C           *IN11     IFEQ '1'
     C*********************SETOF                     KBKG                 E18010
     C                     SETOF                     KLKI                 E18010
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     MOVE 'Y'       WJSCR3  1                                           CAS006
     C                     ENDIF                                                              CAS006
     C                     END
     C                     END
     C                     END
      *
     C                     SETOF                     12
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** If NOT (Cmd/3,Cmd/12,Cmd/5,Cmd/9) then continue with                                 CAS006
      ** with screen 2 (CAS006)                                                               CAS006
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C           WJSCR3    ANDNE'Y'                                                           CAS006
      *                                                                                       CAS006
     C           *INKC     IFEQ '0'                                                           CAS006
     C           *INKL     ANDEQ'0'                                                           CAS006
     C           *INKE     ANDEQ'0'                                                           CAS006
     C           *INKI     ANDEQ'0'                                                           CAS006
     C           *INKC     OREQ '0'                                                           CAS006
     C           *INKL     ANDEQ'1'                                                           CAS006
     C           WFSCR3    ANDEQ'Y'                                                           CAS006
     C           *INKE     ANDEQ'0'                                                           CAS006
     C           *INKI     ANDEQ'0'                                                           CAS006
     C                     MOVE '2'       WSCRN                                               CAS006
     C                     MOVE *BLANK    WFSCR3                                              CAS006
     C                     EXSR SUB103                                                        CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** If Cmd/12 has been pressed on screen 2 to redisplay                                  CAS006
      ** screen 2 (CAS006) (*IN12 on) and then command 9                                      CAS006
      ** pressed on screen 2 (CAS006) to bypass screen 2,                                     CAS006
      ** then recheck screen 2 for errors before exiting program.                             CAS006
      ** Setof Cmd/12 and 9 if errors.                                                        CAS006
      *                                                                                       CAS006
     C           @ACODE    IFEQ 'I'                                                           CAS006
     C           *IN12     ANDEQ'1'                                                           CAS006
     C           *INKI     IFEQ '1'                                                           CAS006
     C           WBSCR3    ANDEQ'Y'                                                           CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANK    WBSCR3                                              CAS006
      *                                                                                       CAS006
      ** Reset error fields and indicators (11 and 50-89) before validation                   CAS006
      *                                                                                       CAS006
     C                     MOVEA*BLANKS   @EA                                                 CAS006
     C                     Z-ADD1         E                                                   CAS006
      *                                                                                       CAS006
     C                     MOVEA'0000'    *IN,21                                              CAS006
     C                     MOVE *OFF      *IN11                                               CAS006
     C                     MOVE *OFF      *IN14                                               CAS006
     C                     MOVE *OFF      *IN49                                               CAS006
     C                     MOVE *OFF      *IN28                                               CAS006
     C                     MOVE *OFF      *IN31                                               CAS006
     C                     MOVE *OFF      *IN32                                               CAS006
     C                     MOVE *OFF      *IN34                                               CAS006
      *                                                                                       CAS006
     C           CEU005    IFEQ 'Y'                                                           CAS006
     C                     MOVE *IN33     WKIN33  1                                           CAS006
     C                     SETOF                     0833                                     CAS006
     C                     ENDIF                                                              CAS006
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     MOVE *IN43     WKIN43  1                                           233607
     C                     MOVE *OFF      *IN43                                               233607
     C                     ENDIF                                                              233607
      *                                                                                       CAS006
     C                     MOVEA'00000000'*IN,50                                              CAS006
     C                     MOVEA'00000000'*IN,58                                              CAS006
     C                     MOVEA'00000000'*IN,66                                              CAS006
     C                     MOVEA'00000000'*IN,74                                              CAS006
     C                     MOVEA'00000000'*IN,82                                              CAS006
      *                                                                                       CAS006
     C                     EXSR SUB203                                                        CAS006
      *                                                                                       CAS006
     C                     MOVEA@EA,1     @SERR1                                              CAS006
     C********** @EA,20    IFNE *BLANKS                                                CAS006 234440
     C**********           MOVE *ON       *IN07                                        CAS006 234440
     C**********           MOVEA@EA,20    @SERR2                                       CAS006 234440
     C**********           ENDIF                                                       CAS006 234440
      *                                                                                       CAS006
     C           *IN11     IFEQ '1'                                                           CAS006
     C                     MOVE *OFF      *INKL                                               CAS006
     C                     MOVE *OFF      *INKI                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     MOVE *OFF      *IN12                                               CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *
      * If NOT (Cmd/3,Cmd/12,Cmd/5,Cmd/9) then continue with screen 2
     C************INKA     IFEQ '0'                                       E18010
     C************INKB     ANDEQ'0'                                       E18010
     C************INKG     ANDEQ'0'                                       E18010
     C           *INKC     IFEQ '0'                                       E18010
     C           *INKL     ANDEQ'0'                                       E18010
     C           *INKE     ANDEQ'0'
     C           *INKI     ANDEQ'0'                                       E18010
     C/COPY WNCPYSRC,SE3002C002
      *                                                                                       CER001
     C           ULX004    IFEQ 'Y'                                                           CER001
      *                                                                                       CER001
      ** Override file                                                                        CER001
     C           @ACODE    IFNE 'N'                                                           CER001
      *                                                                                       CER001
     C           1         DO   2         I                                                   CER001
     C                     MOVEAOVR,I     CMD    38                                           CER001
     C                     CALL 'QCMDEXC'                                                     CER001
     C                     PARM           CMD                                                 CER001
     C                     PARM 38        WLEN   155                                          CER001
     C                     ENDDO                                                              CER001
      *                                                                                       CER001
      ** Call window processing if required                                                   CER001
     C                     MOVE *BLANKS   RTRN                                                CER001
     C                     MOVE @ACODE    ACTION                                              CER001
      *                                                                                       CER001
     C                     EXSR SRLUX                                                         CER001
      *                                                                                       CER001
      ** Return to previous screen if window not terminated normally                          CER001
     C           RTRN      IFNE *BLANKS                                                       CER001
      *                                                                                       CER001
     C           ACTION    IFNE 'E'                                                           CER001
     C                     ROLBK                                                              CER001
     C                     ENDIF                                                              CER001
      ** F3=Exit                                                                              CER001
     C                     SELEC                                                              CER001
     C           RTRN      WHEQ 'Y2U9999'                                                     CER001
     C                     MOVE *ON       *INKC                                               CER001
     C                     LEAVE                                                              CER001
      ** F12=Previous                                                                         CER001
     C           RTRN      WHEQ 'USR0790'                                                     CER001
     C                     MOVE *ON       *IN12                                               CER001
     C                     MOVE *ON       *INKL                                               CER001
     C                     GOTO FIRST                                                         CER001
      *                                                                                       CER001
     C                     ENDSL                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
      ** Delete override                                                                      CER001
     C           3         DO   4         I                                                   CER001
     C                     MOVEAOVR,I     CMD1   21                                           CER001
     C                     CALL 'QCMDEXC'                                                     CER001
     C                     PARM           CMD1                                                CER001
     C                     PARM 21        WLEN   155                                          CER001
     C                     ENDDO                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *
      * Fill screen 2
     C  N13                EXSR SUB104
      *                                                                   CAC002
      **  Always display countervalue if Analytical Acctg is installed    CAC002
      *                                                                   065009
     C           *IN13     IFEQ '1'                                       065009
     C           BVACOP    ANDEQ'Y'                                       065009
     C           *IN13     OREQ '1'                                       CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C                     EXSR SUB508                                    065009
     C                     END                                            065009
     C           WMT500    DOUEQ'0'                                       165966
     C                     MOVE '0'       WMT500  1                       165966
     C                     MOVE '0'       *IN12                                               CAS006
      *
      * Display/validate screen
     C/COPY WNCPYSRC,SE3002C071
     C**********           SETON                     10                                       CAS006
     C                     MOVE *BLANK    WJSCR3                                              CAS006
     C                     MOVE '3'       WSCRN                                               CAS006
     C                     EXSR SUB103
     C/COPY WNCPYSRC,SE3002C072
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C                     EXSR MT500                                     S01401
     C                     ENDIF                                          S01401
      *
     C                     END
     C                     END
     C                     END                                            165966
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CP18                                           S01408
     C*                                                                   S01408
     C           CEU005    IFEQ 'Y'                                       CEU005
     C                     MOVE WKIN33    *IN33                           CEU005
     C                     ENDIF                                          CEU005
      *                                                                                       233607
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     MOVE WKIN43    *IN43                                               233607
     C                     ENDIF                                                              233607
      *
      * Set action code parameter to number of key used to exit
      * (enter = blanks) (2 used for F12)
     C                     MOVEL*BLANKS   @ACODE
     C***KA*************** MOVEL'1'       @ACODE
     C***KB*************** MOVEL'2'       @ACODE
     C***KC*****           MOVEL'3'       @ACODE                                              198420
     C           *INKC     IFEQ '1'                                                           198420
     C           PCMD      OREQ '03'                                                          198420
     C                     MOVEL'3'       @ACODE                                              198420
     C                     ENDIF                                                              198420
     C***KL*****           MOVEL'2'       @ACODE                                              198420
     C           *INKL     IFEQ '1'                                                           198420
     C           PCMD      OREQ '12'                                                          198420
     C                     MOVEL'2'       @ACODE                                              198420
     C                     ENDIF                                                              198420
     C   KE                MOVEL'5'       @ACODE
     C***KG*************** MOVEL'7'       @ACODE
     C   KI                MOVEL'9'       @ACODE
      *
     C                     ENDSR                           SUB002 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *  SUB003 - Error trap for invalid action code                  *
      *****************************************************************
      *
     C           SUB003    BEGSR
      *
     C                     Z-ADD1         @DBASE           ***************
     C                     MOVEL'CODE'    @DBFIL           * DB ERROR 01 *
     C                     MOVEL@ACODE    @DBKEY           ***************
     C***********          EXSR SUB999                                    S01117
     C                     EXSR *PSSR                                     S01117
      *
     C                     ENDSR                           SUB003 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /SPACE 3
      *****************************************************************
      *  SUB100 - Initialization - not first call of program          *
      *****************************************************************
      *
     C           SUB100    BEGSR
      *
      * Reset fields and indicators
     C                     MOVEA*ZEROS    *IN
     C                     MOVEA*BLANKS   @EA
     C                     MOVEL*BLANKS   @SERR1
     C                     MOVEL*BLANKS   @SERR2
     C                     MOVE *BLANKS   PSTLIA                                            AR871625
     C                     MOVE *BLANKS   @STLIA                                            AR871625
      *                                                                   081382
     C           BGPFMG    IFEQ 'Y'                                       081382
     C           WLPCUS    ANDEQ'Y'                                       081382
     C                     MOVE '1'       *IN29                           081382
     C                     END                                            081382
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           WPBCUS    ANDEQ'Y'                                       CPB001
     C                     MOVE '1'       *IN09                           CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CAC002
      **  Seton ind. 30 if Analytical Accounting module is installed      CAC002
      **  and display Trans. Profit Centre if portfolio customer          CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE *ON       *IN30                           CAC002
     C           @WC1DI    IFEQ 'S'                                       CAC002
     C           @WC1DI    OREQ 'D'                                       CAC002
     C                     MOVE *ON       *IN38                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *OFF      *IN30                           CAC002
     C                     ENDIF                                          CAC002
     C**                                                                  S01117
     C**   Check System Date Format, DDMMYY or MMDDYY.                    S01117
     C**                                                                  S01117
     C           DATF      COMP 'M'                      98               S01117
     C**                                                                  S01117
     C**   Check Multibranching indicator for screen etc                  S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     18                   S01117
     C                     ELSE                                           S01117
     C                     SETON                     19                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   Display Originating Branch if used                             S01117
     C*                                                                   S01117
     C           BKOBRU    IFNE 'Y'                                       S01117
     C                     SETON                     19                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   Display Profit Centre if used                                  S01117
     C*                                                                   S01117
     C           BKPRCU    IFNE 'Y'                                       S01117
     C                     SETON                     2627                 S01117
     C                     END                                            S01117
     C*                                                                   CEU005
     C**   Display 'In' Ccy in field 72 if CEU005 switched on.            CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C                     SETON                     15                   CEU005
     C                     END                                            CEU005
      *                                                                                       233607
      ** Display Fiscal Price & EU Tax fields if CGL031 is enabled.                           233607
      *                                                                                       233607
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     MOVE *ON       *IN20                                               233607
     C                     ENDIF                                                              233607
      *                                                                   S01496
     C                     MOVE 'Y'       WWFRST                          S01496
      *
     C                     ENDSR                           SUB100 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /SPACE 3
      *****************************************************************
      *  SUB101 - Initialization - first call of program              *
      *****************************************************************
      *
     C           SUB101    BEGSR
      *
      * Set recall flag
     C                     MOVEL'Y'       @RECAL  1
      *
      * Set code for ZSEDIT
     C                     MOVEL'L'       ZECODE
      *
      **Set*up*table*file*keys******************************************* S01117
     C***********          MOVEL'20      '@KTG10                          S01117
     C***********          MOVE '       1'@KTG10                          S01117
      *
     C***********          MOVEL'20      '@KTG20                          S01117
     C***********          MOVE '       2'@KTG20                          S01117
      *
     C***********          MOVEL*BLANKS   @KTBTR 12                       S01117
     C***********          MOVEL'10'      @KTBTR                          S01117
      *
     C***********          MOVEL*BLANKS   @KTBT5 12                       S01117
     C***********          MOVEL'42'      @KTBT5                          S01117
      *
     C***********          MOVEL'01      '@KTB40 12                       S01117
     C***********          MOVE '      40'@KTB40                          S01117
      *
     C***********          MOVEL*BLANKS   @KTBTL                          S01117
     C***********          MOVEL'70'      @KTBTL                          S01117
      *
     C***********          MOVEL*BLANKS   @KTBT2                          S01117
     C***********          MOVEL'71'      @KTBT2                          S01117
      *
      **Get*ICD1*************************************************         S01117
     C***********          EXSR ZSYSTM                                    S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          Z-ADD2         @DBASE           ***************S01117
     C***********          MOVEL'ICD1'    @DBFIL           * DB ERROR 02 *S01117
     C***********          MOVELZTABKY    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C**   Read in RUNDAT                                                 S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C**   Check System Date Format, DDMMYY or MMDDYY.                    S01117
     C**                                                                  S01117
     C           DATF      COMP 'M'                      98               S01117
     C**                                                                  S01117
     C**   Check Multibranching indicator for screen etc                  S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     18                   S01117
     C                     ELSE                                           S01117
     C                     SETON                     19                   S01117
     C                     END                                            S01117
      *
      * Set run date for screen
     C                     MOVELRUNA      @SRUNA
     C                     MOVE 'Y'       WWFRST  1                       S01496
      *
      **Get*ICD2**************************************************        S01117
     C***********          EXSR ZICD2                                     S01117
     C************INU7     IFEQ '1'                                       S01117
     C***********          Z-ADD3         @DBASE           ***************S01117
     C***********          MOVEL'ICD2'    @DBFIL           * DB ERROR 03 *S01117
     C***********          MOVELZTABKY    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
      *
      **Get*SE*ICD*****************************************               S01117
     C***********          EXSR ZICDSE                                    S01117
     C************INU7     IFEQ '1'                                       S01117
     C***********          Z-ADD4         @DBASE           ***************S01117
     C***********          MOVEL'ICDSE'   @DBFIL           * DB ERROR 04 *S01117
     C***********          MOVELZTABKY    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C**   Access Bank Details                                            S01117
     C*                                                                   S01117
     C                     EXSR AOBANK                                    S01117
     C*                                                                   S01117
     C**   Access General Ledger details                                  S01117
     C*                                                                   S01117
     C                     EXSR AOGELR                                    S01117
     C*                                                                   S01117
     C**   Display Originating Branch if used                             S01117
     C*                                                                   S01117
     C           BKOBRU    IFNE 'Y'                                       S01117
     C                     SETON                     19                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   Display Profit Centre if used                                  S01117
     C*                                                                   S01117
     C           BKPRCU    IFNE 'Y'                                       S01117
     C                     SETON                     2627                 S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   Access Securities Trading ICD                                  S01117
     C*                                                                   S01117
     C                     EXSR AOSTRD                                    S01117
     C*                                                                   S01446
     C**  If Customer Commissions feature on and autocharges is on        S01446
     C**  get details of single charge currency if not blank (on          S01446
     C**  SE ICD record)                                                  S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           BVACOP    ANDEQ'Y'                                       S01446
     C           BVCHRC    ANDNE*BLANK                                    S01446
     C                     MOVE '*DBERR ' @RTCD                           S01446
     C                     MOVE BVCHRC    @AJCD                           S01446
     C                     EXSR AOCURR                                    S01446
     C*                                                                   S01446
     C** Set up spot rate, multiply/divide indicator and number of        S01446
     C** decimal places                                                   S01446
     C*                                                                   S01446
     C                     MOVE A6SPRT    USPRT                           S01446
     C                     MOVE A6MDIN    UMDIN                           S01446
     C                     MOVE A6NBDP    UNBDP                           S01446
     C                     END                                            S01446
     C*
     C***If*Retail*Module*present,*access*ICD*TABTB20*********************S01117
     C*  If Retail Module present, access Retail ICD SDRETLPD             S01117
     C           *INU1     IFEQ '1'
     C                     EXSR AORETL                                    S01117
     C***********1         CHAINTABTB20              01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          MOVE '30'      @DBASE            ************  S01117
     C***********          MOVEL'TABLE'   @DBFIL            * DATABASE *  S01117
     C***********          MOVEL'TABTB20' @DBKEY            * ERROR 30 *  S01117
     C***********          SETON                     U7U8   ************  S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C                     END
     C***********                                                  S01486 081382
     C*****Access MIDAS MODULES Details                            S01486 081382
     C***********                                                  S01486 081382
     C***********          CALL 'AOMMODR0'                         S01486 081382
     C***********          PARM '*DBERR ' @RTCD   7                S01486 081382
     C***********          PARM '*FIRST ' @OPTN   7                S01486 081382
     C***********SDMMOD    PARM SDMMOD    DSFDY                    S01486 081382
     C***********                                                  S01486 081382
     C***Check*whether Portfolio Management is switched on         S01486 081382
     C***********                                                  S01486 081382
     C***********BGPFMG    IFEQ 'Y'                                S01486 081382
     C***********          SETON                     29            S01486 081382
     C***********                                                  S01486 081382
     C***Open*necessary files                                      S01486 081382
     C***********                                                  S01486 081382
     C***********          OPEN PMPORTPD                           S01486 081382
     C***********          OPEN PMHSEXPD                           S01486 081382
     C***********                                                  S01486 081382
     C*****Access PORTFOLIO MANAGEMENT ICD Details                 S01486 081382
     C***********                                                  S01486 081382
     C***********          CALL 'AOPORTR0'                         S01486 081382
     C***********          PARM '*DBERR ' @RTCD   7                S01486 081382
     C***********          PARM '*FIRST ' @OPTN   7                S01486 081382
     C***********SDPORT    PARM SDPORT    DSFDY                    S01486 081382
     C***********          END                                     S01486 081382
     C***********                                                  S01496 081382
     C*****Access Switchable Features Details                      S01496 081382
     C***********                                                  S01496 081382
     C***********          CALL 'AOSARDR0'                         S01496 081382
     C***********          PARM *BLANKS   @RTCD   7                S01496 081382
     C***********          PARM '*VERIFY' @OPTN   7                S01496 081382
     C***********          PARM 'S01496'  @SKEY   6                S01496 081382
     C***********SCSARD    PARM SCSARD    DSFDY                    S01496 081382
     C***********                                                  S01496 081382
     C***Check*whether Jyske SE Enhancements is switched on        S01496 081382
     C***********                                                  S01496 081382
     C***********@RTCD     IFEQ *BLANKS                            S01496 081382
     C***********          MOVEL'Y'       S01496  1                S01496 081382
     C***********          OPEN SECUBRL0                           S01496 081382
     C***********          ELSE                                    S01496 081382
     C***********          OPEN CUBRD                              S01496 081382
     C***********          END                                     S01496 081382
     C*
     C/COPY WNCPYSRC,SE3002C036
      *
     C                     ENDSR                           SUB101 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *  SUB102 - Fill screen 1 for display                           *
      *****************************************************************
      *
     C           SUB102    BEGSR
      *
      * Get security via shortname (if name has changed since last call)
     C           @PTDSS    IFNE @OTDSS
      *
     C           @PTDSS    CHAINSECTYDF              01
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C                     Z-ADD5         @DBASE           ***************
     C                     MOVEL'SECTY'   @DBFIL           * DB ERROR 05 *
     C                     MOVEL@PTDSS    @DBKEY           ***************
     C***********          EXSR SUB999                                    S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
      *                                                                                       233607
      ** Save Security details if CGL031 is enabled.                                          233607
      *                                                                                       233607
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     EXSR SRSSEC                                                        233607
     C                     ENDIF                                                              233607
      *                                                                   S01176
      ***  Store fields for charge calculations                           S01176
     C                     MOVELNMCYA     @XCCY
     C                     Z-ADDNMDP      ZNMDP                           S01176
     C                     MOVE SPBS      ZSPBS                           S01176
     C                     MOVELSMCC      @PTMKC                                             BUG2573
     C           *LIKE     DEFN VLCY      VLCYA                           S01175
     C                     MOVE VLCY      VLCYA                           S01175
      *
      *    Get Processing type
     C           @KEY1     CHAININVTPDF              01
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C                     Z-ADD6         @DBASE           ***************
     C                     MOVEL'INVTP'   @DBFIL           * DB ERROR 06 *
     C                     MOVELNMCYA     @WK6    6        ***************
     C                     MOVE SITP      @WK6
     C                     MOVEL@WK6      @DBKEY
     C***********          EXSR SUB999                                    S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
      *                                                                                       233607
      ** Save Investment Type details if CGL031 is enabled.                                   233607
      *                                                                                       233607
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     EXSR SRSINV                                                        233607
     C                     ENDIF                                                              233607
     C*
     C* Get nominal currency decimal places for security
     C                     MOVELNMCYA     @AJCD
     C                     MOVE '*DBERR ' @RTCD
     C                     EXSR AOCURR
     C***********@KTG10    CHAINTABTG10F             01
     C************IN01     IFEQ '1'
     C***********RECI      ORNE 'D'
     C***********          Z-ADD20        @DBASE           ***************
     C***********          MOVEL'TABLE'   @DBFIL           * DB ERROR 20 *
     C***********          MOVEL@KTG10    @DBKEY           ***************
     C***********          EXSR SUB999
     C***********          END
      *                                                                   S01176
      ***  Store fields for later calculations                            S01176
     C***********          Z-ADDCDP       @NCDP   10                      S01117
     C***********          Z-ADDCDP       ZDECS                    S01176 S01117
     C***********          Z-ADDCDP       @CDP    10               S01176 S01117
     C************LIKE     DEFN CCYS      @CCYS                    S01175 S01117
     C***********          MOVE CCYS      @CCYS                    S01175 S01117
     C                     Z-ADDA6NBDP    @NCDP   10                      S01117
     C                     MOVE A6NQDP    ZNQDP1                          CAC002
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     Z-ADDA6NBDP    @CDP    10                      S01117
     C           *LIKE     DEFN A6SWCY    @CCYS                           S01117
     C                     MOVE A6SWCY    @CCYS                           S01117
      *
     C                     MOVEL@PTDSS    @OTDSS 10
     C*                                                                   S01446
     C* If Autocharges is on, switchable feature S01446 is on and the     S01446
     C* Charges Currency on SE ICD is not blank then calculate the        S01446
     C* cross rate and M/D indicator for use when converting Charge       S01446
     C* currency to nominal currency                                      S01446
     C*                                                                   S01446
     C           BVACOP    IFEQ 'Y'                                       S01446
     C           S01446    ANDEQ'Y'                                       S01446
     C           BVCHRC    ANDNE*BLANK                                    S01446
     C                     Z-ADDUSPRT     ZRATE1                          S01446
     C                     MOVE UMDIN     ZMDI1                           S01446
     C                     Z-ADDA6SPRT    ZRATE2                          S01446
     C                     MOVE A6MDIN    ZMDI2                           S01446
     C                     EXSR ZXRATE                                    S01446
     C                     Z-ADDZRATEX    UCHXRT                          S01446
     C                     MOVE ZMDIX     UCHXMD                          S01446
     C                     END                                            S01446
     C                     END
      *
      **Get*associated*customer*details*(if*customer*has*changed)         E21257
     C***********@PTCNR    IFNE @OTCNR                                    E21257
      *                                                                   E21257
      * Get associated customer details                                   E21257
     C***********@PTCNR    CHAINCLINTCBF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD7         @DBASE           ***************S01117
     C***********          MOVEL'CLINT'   @DBFIL           * DB ERROR 07 *S01117
     C***********          MOVEL@PTCNR    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C/COPY WNCPYSRC,SE3002C058
     C                     MOVE *BLANKS   @WCSNM                          S01117
     C                     MOVEL@PTCNR    @WCSNM                          S01117
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
      *
      * Get associated customer details
     C***********@PTCNR    CHAINCLINTSEF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD8         @DBASE           ***************S01117
     C***********          MOVEL'CLINT'   @DBFIL           * DB ERROR 08 *S01117
     C***********          MOVEL@PTCNR    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C                     MOVEL@PTCNR    @WCUST                          S01117
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     EXSR AOSECS                                    S01117
      *                                                                   CSE022
      ** BFDRF1 needs to be updated by the 1st 6 characters of BFNDR1.    CSE022
      ** BFDRF2 needs to be updated by the 1st 6 characters of BFNDR2.    CSE022
      *                                                                   CSE022
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C                     MOVELBFNDR2    BFDRF2                          CSE022
      *                                                                   S01176
     C**********           Z-ADD@PTCNR    @OTCNR  60                                         CSD027A
     C                     MOVE @PTCNR    @OTCNR  6                                          CSD027A
     C***********          Z-ADDC1AC      @WC1AC  40                      S01117
     C***********          MOVELC1DI      @WC1DI  1                       S01117
     C***********          Z-ADDC1SQ      @WC1SQ  20                      S01117
     C***********          MOVELTVCC      @VATCD  2                       S01176
     C***********          MOVE TAXC      @TAXC   2                S01176 S01117
     C***********          MOVELC101      @WC101  6                       S01117
     C***********          MOVELC102      @WC102  6                       S01117
     C***********          MOVE AUTS      @AUTS   1                S01176 S01117
     C***********          MOVE PN01      @WPN01                   S01190 S01117
     C***********          MOVE PN02      @WPN02                   S01190 S01117
     C**********           MOVE BFACCD    @WC1AC  4                                    S01117 CGL029
     C                     MOVE BFACCD    @WC1AC 10                                           CGL029
     C                     MOVELBFCLAS    @WC1DI  1                       S01117
     C                     Z-ADDBFACSN    @WC1SQ  20                      S01117
     C                     MOVE BFTCD     @TAXC   2                       S01117
     C                     MOVELBFDRF1    @WC101  6                       S01117
     C                     MOVELBFDRF2    @WC102  6                       S01117
     C                     MOVE BFASIN    @AUTS   1                       S01117
     C                     MOVE BFPNP1    @WPN01                          S01117
     C                     MOVE BFPNP2    @WPN02                          S01117
     C                     MOVELBFTDCG    @WTDCG  1                       S01496
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE3002CLDS                                           S01408
     C*                                                                   S01408
      *                                                                   S01176
      ***  Chain to LF/SECGT for counterparty's standard tax details      S01176
     C                     MOVE @TAXC     @XCODE                          S01176
     C           @KEY7     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   @TAXC                           S01176
     C                     ELSE                                           S01176
     C                     MOVE CHGB      @TCHGB                          S01176
     C                     MOVE THRI      @TTHRI                          S01176
     C                     Z-ADD@RA       @TRA                            S01176
     C                     Z-ADD@PC       @TPC                            S01176
     C                     Z-ADD@CG       @TCG                            S01176
     C                     Z-ADDMNCH      @TMNCH                          S01176
     C                     Z-ADDMXCH      @TMXCH                          S01176
     C                     MOVE TXAP      @TTXAP                          S01176
     C                     MOVE REBA      @TREBA                          S01176
     C                     END                                            S01176
      *
     C***********          END                                            E21257
      *
      * Protect fields if enquiry
     C           @ACODE    IFEQ 'E'
      *                                                                   065002
      * Ensure charge amounts appear in enquiry mode                      065002
      *                                                                   065002
     C***********          SETON                     404147               065002
     C                     SETON                     40  47               065002
     C                     END
      *
      * Protect customer commission fields if this is a market client
     C                     SETOF                     48
     C           @WC1DI    IFEQ 'M'
     C                     SETON                     48
     C                     END
      *
     C                     SETOF                     43
     C           STBS      IFEQ 'Y'
     C           STBS      OREQ 'D'
     C                     SETON                     43
     C                     END
      *
     C                     SETOF                     44
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     SETON                     44
     C                     END
      *
     C                     SETOF                     45
     C           PROT      IFEQ '8'
     C                     SETON                     45
     C                     END
      *
     C                     SETOF                     42
     C           PROT      IFEQ '1'
     C           PROT      OREQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C           STBS      IFEQ 'Y'
     C           STBS      OREQ 'P'
     C                     SETON                     42
     C                     END
     C                     END
      *                                                                   CSE006
      * Protect fields sent from Buy-Sell Backs Maintenance               CSE006
     C           P@BYSL    IFEQ 'Y'                                       CSE006
     C                     MOVE *ON       *IN09                           CSE006
     C                     ENDIF                                          CSE006
      *
      * Set up screen defaults if action is I
     C           @ACODE    IFEQ 'I'
     C           @ACODE    OREQ 'N'
      *
      * Protect settlement currency unless multicurrency or client is
      * safe custody or discretionary
     C                     SETON                     47
     C           MLTI      IFEQ 'Y'
     C           @WC1DI    OREQ 'S'
     C           @WC1DI    OREQ 'D'
     C                     SETOF                     47
     C                     END
      * Also do not protect this field if counterparty is a               CEU005
      * market client and the nominal Ccy is tha same as EURO.            CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           @WC1DI    ANDEQ'M'                                       CEU005
     C           NMCYA     ANDEQBKEURO                                    CEU005
     C                     SETOF                     47                   CEU005
     C                     END                                            CEU005
      *
      * Only calculate defaults if trade is being reviewed for
      * for the 1st time
     C           @PRECI    IFEQ *BLANKS
     C                     EXSR SUB300
     C           @PRTRF    IFEQ *BLANKS
     C                     EXSR SUB301
     C                     ELSE
     C                     EXSR SUB302
     C                     END
     C                     EXSR SUB304
     C                     END
     C                     END
      *
      * Set up fixed fields
     C                     MOVEL@ACODE    @SACTN
     C                     MOVEL@PTDRF    @STDRF
      *
     C**********           MOVE CLRTYP    @PCLTY                                       191878 204833
     C**********           MOVE CLRTYP    @SCLTY                                       191878 204833
      * Status literal (for enquiry only)
     C                     MOVEL*BLANKS   @SLTRL
     C                     MOVEL*BLANKS   @SLTRT                          S01269
     C           @ACODE    IFEQ 'E'
     C***********@PRECI    IFEQ '*'                                       S01269
     C***********@PRECI    IFEQ 'R'                                S01269 065543
     C           @PRECI    IFEQ '*'                                       065543
     C           @PRECI    OREQ 'R'                                       065543
     C           @PRECI    OREQ 'C'
     C                     MOVEL@TX,1     @SLTRL
     C                     END
     C           @PRECI    IFEQ 'S'
     C           @PTDFS    OREQ RUND                                      065543
     C           @PRECI    OREQ 'D'                                       065543
     C           @PAUTS    ANDEQ'Y'                                       065543
     C           @PTDVD    ANDLERUND                                      065543
     C           @PTINC    ANDEQ'C'                                       065543
     C           @PRECI    OREQ 'A'                                       065543
     C           @PAUTS    ANDEQ'Y'                                       065543
     C           @PTDVD    ANDLERUND                                      065543
     C           @PTINC    ANDEQ'C'                                       065543
     C                     MOVEL@TX,2     @SLTRL
     C                     END
     C***********@PRECI    IFEQ 'D'                                S01269 065543
     C***********@PRECI    OREQ 'A'                                S01269 065543
     C***********          MOVEL@TX,6     @SLTRT                   S01269 065543
     C***********          END                                     S01269 065543
     C           @PRECI    IFEQ 'L'                                       S01269
     C           @PRECI    OREQ 'P'                                       S01269
     C           @PRECI    OREQ 'R'                                       S01269
     C                     MOVEL@TX,7     @SLTRT                          S01269
     C                     ELSE                                           065543
     C           BVAUTH    IFNE '00'                                      065543
     C                     MOVEL@TX,6     @SLTRT                          065543
     C                     END                                            065543
     C                     END                                            S01269
     C                     END
      *
     C                     MOVEL@PBLKR    @SBLKR
     C                     MOVEL@PTDSS    @SSESN
     C                     MOVELSRPN      @SSRPN
     C***********          MOVELCSNM      @SCNNM                          S01117
     C***********          MOVELCRNM      @SCRNM                          S01117
     C                     MOVELBBCSSN    @SCNNM                          S01117
     C                     MOVELBBCRNM    @SCRNM                          S01117
     C                     MOVE BBCUST    WCUST1  6                                         AR881600
      *
     C***********CSNM      IFEQ *BLANK                                    S01117
     C***********          MOVELCNUM      @SCNNM                          S01117
     C           BBCSSN    IFEQ *BLANK                                    S01117
     C                     MOVELBBCUST    @SCNNM                          S01117
     C                     END
     C/COPY WNCPYSRC,SE3002C054
      *
      *  Incomplete indicator
     C                     MOVE @PTINC    @SINCS
     C                     MOVE @PTINC    @OINCS  1
      *
      *  Trade type
     C                     MOVE @PTDTP    @STDTP
      *
      *  Nominal
     C                     MOVE *BLANKS   ZFIELD                          067584
     C                     MOVE @PNOML    ZFIELD
     C                     Z-ADD@PTNMD    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    @SNOML
      *
      *  Price/Discount/Yield
     C                     Z-ADD0         ZFLD15
     C                     MOVE @PTPDY    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @STPDY
      *
      *  Value date
     C           @PTDVD    IFEQ 0
     C                     MOVEL*BLANKS   @STDVD
     C                     MOVEL*BLANKS   @DSCVD                          S01176
     C                     MOVEL*BLANKS   @OTDVD
     C                     ELSE
     C                     Z-ADD@PTDVD    ZDAYNO
     C*                                                                   E21056
     C*    Update Event Control Date with Value Date                      E21056
     C                     Z-ADD@PTDVD    ECD                             E21056
     C*                                                                   E21056
     C                     EXSR ZDATE2
     C                     MOVELZDATE     @STDVD
     C                     MOVELZDATE     @DSCVD                          S01176
     C                     MOVELZDATE     @OTDVD  6
     C                     END
     C*                                                                                       235547
     C*    Save Current Value Date                                                            235547
     C                     Z-ADD@PTDVD    C@TDVD                                              235547
      *
      ***Branch*code************************************                  S01117
     C***********@PTDBR    IFEQ 0                                         S01117
     C***********          MOVEL*BLANKS   @SBRCD                          S01117
     C***********          MOVEL*BLANKS   @OBRCD                          S01117
     C***********          ELSE                                           S01117
     C***********          MOVEL@PTDBR    @SBRCD                          S01117
     C***********          MOVEL@PTDBR    @OBRCD  3                       S01117
     C***********          END                                            S01117
      *                                                                   S01117
      *  Booking Branch                                                   S01117
     C                     MOVEL@PTDBA    @SBRCD                          S01117
     C                     MOVEL@PTDBA    @OBRCD  3                       S01117
      *
      *  Book
     C                     MOVEL@PTDBK    @SBPBK
     C                     MOVEL@PTDBK    @OBPBK  2
      *                                                                   CAC005
      ** If CAC005 is on, retrieve user book from AOBKPCR0.               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD   7                       CAC005
     C                     PARM '*USER  ' POPTN   7                       CAC005
     C           PMBKCD    PARM *BLANKS   PMBKCD  2                       CAC005
     C           PMPRFC    PARM *BLANKS   PMPRFC  4                       CAC005
     C                     PARM @PTDBK    PMPSBK  2                       CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPMBKCD    @SBPBK                          CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *
      *  Clearance type
     C                     MOVEL@PCLTY    @SCLTY
     C                     MOVEL@PCLTY    @OCLTY  1
      *
      *  Settlement currency
     C                     MOVEL@PSETC    @SSETC
     C                     MOVEL@PSETC    @OSETC  3
      *
      *  Reallowance
     C                     Z-ADD0         ZFLD15
     C                     MOVE @PRALL    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @SRALL
      *
      *  Market centre
     C                     MOVEL@PTMKC    @SMRKT
     C                     MOVEL@PTMKC    @OMRKT  2
      *
      *  Trade date
     C           @PTDDT    IFEQ 0
     C                     MOVEL*BLANKS   @STDDT
     C                     MOVEL*BLANKS   @OTDDT  6
     C                     ELSE
     C                     Z-ADD@PTDDT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     @STDDT
     C                     MOVELZDATE     @OTDDT
     C                     END
      *
      *  Trade sub-type
     C                     MOVEL@PTSUB    @STSUB
     C                     MOVEL@PTSUB    @OTSUB  2
      *
      *  Market indicator
     C                     MOVEL@PTDMI    @STDMI
     C                     MOVEL@PTDMI    @OTDMI  1
      *
      ***AIBD/IPPA*****************************************************   E43208
      *  ISMA/IPMA                                                        E43208
     C                     MOVEL@PAIIP    @SAIIP
     C                     MOVEL@PAIIP    @OAIIP  1
      *
      *  Capacity
     C                     MOVEL@PTCAP    @SCPCY
     C                     MOVEL@PTCAP    @OCPCY  1
      *
      *  Trader I.D.
     C                     MOVEL@PTDID    @STDID
      *
      *  Link reference
     C                     MOVEL@PLKRF    @SLKRF
      *
      *  Narrative
     C                     MOVEL@PTDNR    @STDNR
      *
      *  Price
     C           *IN43     IFEQ '1'
     C                     Z-ADD0         ZFLD15
     C                     MOVE @PPRIC    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @SPRIC
     C                     END
      *                                                                                       233607
     C           CGL031    IFEQ 'Y'                                                           233607
     C           @PFSPR    ANDNE*ZERO                                                         233607
      *                                                                                       233607
      ** Fiscal Price                                                                         233607
      *                                                                                       233607
     C                     Z-ADD*ZERO     ZFLD15                                              233607
     C                     MOVE @PFSPR    ZFLD15                                              233607
     C                     Z-ADD8         ZDECS                                               233607
     C                     EXSR ZSEDIT                                                        233607
     C                     MOVE ZOUT20    @SFSPR                                              233607
     C                     ELSE                                                               233607
     C                     MOVE *BLANKS   @SFSPR                                              233607
     C                     ENDIF                                                              233607
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
      ** Credit Risk Spread                                                                   CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE @PCRSK    ZFLD15                                              CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SCRSK                                               CAS006
      *                                                                                       CAS006
      ** Liquidity Premium                                                                    CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE @PLQPR    ZFLD15                                              CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SLQPR                                               CAS006
      *                                                                                       CAS006
      ** Net Treasury Price                                                                   CAS006
      *                                                                                       CAS006
     C                     Z-ADD@PTPDY    WPPRCN 158                                          CAS006
     C                     ADD  @PCRSK    WPPRCN                                              CAS006
     C                     ADD  @PLQPR    WPPRCN                                              CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE WPPRCN    ZFLD15                                              CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SNTCP                                               CAS006
      *                                                                                       CAS006
      ** Net Treasury Coupon Rate                                                             CAS006
      *                                                                                       CAS006
     C                     Z-ADD@PTDVD    WSDED   50                                          CAS006
     C                     MOVE @PTDSS    WSDSN  10                                           CAS006
     C                     Z-ADD*ZERO     WNTCR  117                                          CAS006
     C                     Z-ADD*ZERO     WXSDED  50                                          CAS006
      *                                                                                       CAS006
     C           WSDSN     SETLLSEDEVL9                                                       CAS006
     C           WSDSN     READESEDEVL9                  10                                   CAS006
      *                                                                                       CAS006
     C           *IN10     DOWEQ*OFF                                                          CAS006
     C           WESDED    ANDLEWSDED                                                         CAS006
      *                                                                                       CAS006
     C           WESDET    IFEQ 'IR'                                                          CAS006
      *                                                                                       CAS006
     C           WESDED    IFEQ WSDED                                                         CAS006
     C                     Z-ADDWESDNN    WNTCR                                               CAS006
     C                     LEAVE                                                              CAS006
     C                     ELSE                                                               CAS006
     C           WESDED    IFGT WXSDED                                                        CAS006
     C                     Z-ADDWESDED    WXSDED                                              CAS006
     C                     Z-ADDWESDNN    WNTCR                                               CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           WSDSN     READESEDEVL9                  10                                   CAS006
     C                     ENDDO                                                              CAS006
      *                                                                                       CAS006
     C           WNTCR     IFEQ *ZERO                                                         CAS006
     C                     Z-ADDCPNN      WNTCR                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE WNTCR     ZFLD15                                              CAS006
     C                     Z-ADD7         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT20    SNTCR                                               CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                     AR871625
     C           CER049    IFEQ 'Y'                                                         AR871625
     C                     MOVE '0'       WK16X                                             AR884341
      *                                                                                     AR871625
     C           @SACTN    IFEQ 'E'                                                         AR871625
     C           @STDRF    CHAINTRADSQL0             01                                     AR871625
     C           *IN01     IFEQ '1'                                                         AR871625
     C                     Z-ADD103       @DBASE                                            AR871625
     C                     MOVEL'TRADSQL0'@DBFIL                                            AR871625
     C                     MOVEL@STDRF    @DBKEY                                            AR871625
     C                     EXSR *PSSR                                                       AR871625
     C                     ENDIF                                                            AR871625
     C                     MOVE *BLANKS   @STLIA                                            AR871625
     C                     MOVE *BLANKS   ZFIELD                                            AR871625
     C                     MOVE *ZERO     @STAMT                                            AR871625
     C                     MOVE TQTAX     @STLIA                                            AR871625
     C                     MOVE TQSTAF    ZFIELD                                            AR871625
     C                     Z-ADD2         ZADEC                                             AR871625
     C                     EXSR ZEDIT                                                       AR871625
     C                     MOVE ZFIELD    @STAMT                                            AR871625
     C                     MOVE ZFIELD    @STCA7                                            AR871625
     C                     MOVE '1'       WK17X   1                                         AR871625
      *                                                                                     AR871625
     C                     ELSE                                                             AR871625
      *                                                                                     AR871625
     C                     MOVE '0'       WK17X                                             AR871625
     C                     MOVE *BLANKS   @STAMT                                            AR871625
     C                     CALL 'AOBRCHR2'                                                  AR871625
     C                     PARM *BLANKS   @RTCD                                             AR871625
     C                     PARM '*KEY   ' @OPTN                                             AR871625
     C                     PARM @SBRCD    @DSNB   3                                         AR871625
     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR871625
     C           @RTCD     IFEQ *BLANKS                                                     AR871625
     C                     MOVE BXTAX     WSTAXI  1                                         AR871625
     C                     ENDIF                                                            AR871625
      *                                                                                     AR871625
     C**********           CALL 'AOCUSTR0'                                         AR871625 AR881600
     C**********           PARM *BLANKS   @RTCD                                    AR871625 AR881600
     C**********           PARM '*KEY   ' @OPTN                                    AR871625 AR881600
     C**********           PARM @SCNNM    @KEY1X 10                                AR871625 AR881600
     C**********           PARM *BLANKS   @KYST   7                                AR871625 AR881600
     C********** SDCUST    PARM SDCUST    DSSDY                                    AR871625 AR881600
     C********** @RTCD     IFEQ *BLANKS                                            AR871625 AR881600
     C**********           CALL 'AOBRCHR2'                                         AR871625 AR881600
     C**********           PARM *BLANKS   @RTCD                                    AR871625 AR881600
     C**********           PARM '*KEY   ' @OPTN                                    AR871625 AR881600
     C**********           PARM BBBRCD    @DSNB                                    AR871625 AR881600
     C********** SDBRCE    PARM SDBRCE    DSSDY                                    AR871625 AR881600
     C********** @RTCD     IFEQ *BLANKS                                            AR871625 AR881600
     C**********           MOVE BXTAX     WCTAX                                    AR871625 AR881600
     C**********           ENDIF                                                   AR871625 AR881600
     C**********           ENDIF                                                   AR871625 AR881600
     C           WCUST1    CHAINSDCUSQL0             01                                     AR881600
     C           *IN01     IFEQ *OFF                                                        AR881600
     C           CQTAX     IFEQ 'Y'                                                         AR881600
     C                     MOVE 'Y'       WCTAX                                             AR881600
     C                     ELSE                                                             AR881600
     C                     MOVE 'N'       WCTAX                                             AR881600
     C                     ENDIF                                                            AR881600
      *                                                                                     AR881600
     C                     ELSE                                                             AR881600
     C                     MOVE 'N'       WCTAX                                             AR881600
     C                     ENDIF                                                            AR881600
      *                                                                                     AR871625
      ** Default Stamp Tax Liable                                                           AR871625
      *                                                                                     AR871625
     C           WSTAXI    IFEQ 'Y'                                                         AR871625
     C           WCTAX     ANDEQ'Y'                                                         AR871625
     C           @STLIA    ANDEQ*BLANK                                                      AR871625
     C                     MOVE 'Y'       @STLIA                                            AR871625
     C                     ELSE                                                             AR871625
     C                     MOVE 'N'       @STLIA                                            AR871625
     C                     ENDIF                                                            AR871625
     C                     MOVE @STLIA    PSTLIA  1                                         AR871625
      *                                                                                     AR871625
     C                     ENDIF                                                            AR871625
     C                     ENDIF                                                            AR871625
      *                                                                                     AR871625
      *
      *  Ex dividend
     C                     MOVEL@PEXDV    @SEXDV
     C                     MOVEL@PEXDV    @OEXDV  1
      *
      *  Current factor
     C           *IN45     IFEQ '1'
     C                     MOVE @PTDSS    SDSN                            E21055
     C                     MOVE 'MP'      SDET                            E21055
     C                     Z-ADD@PTDVD    SDED                            E21055
     C           @KEY8     SETLLSEDEVDO                                   E21055
     C                     READ SEDEVDO                  01               E21055
     C           *IN01     IFEQ '0'                                       E21055
     C           SDSN      ANDEQ@PTDSS                                    E21055
     C           SDET      ANDEQ'MP'                                      E21055
     C                     Z-ADDSDCP      @PTCFC                          E21055
     C*                                                                   093524
     C                     Z-ADDSDCP      CFCT                            093524
     C*                                                                   093524
     C                     END                                            E21055
     C                     Z-ADD0         ZFLD15
     C                     MOVE @PTCFC    ZFLD15
     C**********           Z-ADD8         ZDECS                           052254
     C                     Z-ADD9         ZDECS                           052254
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @SCRFC
     C                     END
      *
     C           *IN42     IFEQ '1'
      *
      *  Accrued indicator
     C                     MOVEL@PACIN    @SACIN
     C                     MOVEL@PACIN    @OACIN  1
      *
      *  Days adjustment
     C                     Z-ADD@PDADJ    ZFLD15
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @SDADJ
     C                     Z-ADD@PDADJ    @ODADJ  30
      *
      *  Actual Difference indicator
     C                     MOVEL@PADIN    @SACTD
     C                     MOVEL@PADIN    @OACTD  1
      *                                                                   066814
     C           @PDADJ    IFNE *ZEROS                                    066814
     C           @SACTD    ANDEQ*BLANKS                                   066814
     C                     MOVE 'D'       @SACTD                          066814
     C                     END                                            066814
      *
      *  Coupon rate
     C***********          Z-ADD0         ZFLD15
     C***********          MOVE @PTDCR    ZFLD15
     C                     MOVE *BLANKS   ZFLD15                          E21055
     C                     MOVE @PTDSS    SDSN                            E21055
     C                     MOVE 'IR'      SDET                            E21055
     C                     Z-ADD@PTDVD    SDED                            E21055
     C           @KEY8     SETLLSEDEVDO                                   E21055
     C                     READ SEDEVDO                  01               E21055
     C           *IN01     IFEQ '0'                                       E21055
     C           SDSN      ANDEQSESN                                      E21055
     C           SDET      ANDEQ'IR'                                      E21055
     C                     Z-ADDSDNC      @PTDCR                          E21055
     C                     MOVE SDNC      ZFLD15                          E21055
     C                     ELSE                                           E21055
     C                     Z-ADDCPNR      @PTDCR                          E21055
     C                     MOVE CPNR      ZFLD15                          E21055
     C                     END                                            E21055
     C                     Z-ADD7         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @SCPNR
     C                     Z-ADD@PTDCR    @OTDCR 117
      *
      *  Interest amount
     C*********************EXSR SUB401                             S01176 E21050
     C***********          Z-ADD@NCDP     CDP                      E21050 S01117
     C                     Z-ADD@NCDP     ZCDP                            S01117
     C                     Z-ADD@PNOML    NOML                            E21050
     C                     MOVE @PACIN    ZACIN                           E21050
     C                     Z-ADD@PDADJ    ZDADJ                           E21050
     C                     MOVE @PADIN    ZADIN                           E21050
     C                     Z-ADD@PTDCR    TDCR                            E21050
     C*                                                                   E21050
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCP5                                           S01408
     C*                                                                   S01408
     C                     EXSR ZPCINT                                    E21050
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCP6                                           S01408
     C*                                                                   S01408
     C*                                                                   E21050
     C* Ensure that interest amount is zero if accrual indicator flat     064997
     C*                                                                   064997
     C           @ACODE    IFEQ 'I'                                       065422
     C           @PRECI    ANDEQ*BLANKS                                   065422
     C/COPY WNCPYSRC,SE3002C024
     C           @PACIN    IFEQ 'F'                                       064997
     C                     Z-ADD0         @PITRA                          064997
     C                     ELSE                                           064997
      *                                                                   CSE006
      *  (Do not calculate if called from Buy-Sell Backs Input)           CSE006
     C           P@BYSL    IFNE 'Y'                                       CSE006
     C                     MOVE ZITRA     @PITRA                          E21050
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     END                                            064997
     C                     END                                            065422
     C                     Z-ADD0         ZFLD15
     C                     MOVE @PITRA    ZFLD15
     C                     Z-ADD@NCDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @SITRA
     C                     MOVE ZOUT21    @OITRA 15
     C/COPY WNCPYSRC,SE3002C025
     C*
     C* SAVE CALCULATED INTEREST AMOUNT TO DETERMINE INT. ADJUSTMEMT
     C* LATER ON
     C**********           Z-ADD@PITRA    ORGIT  130                      064997
     C                     Z-ADDZITRA     ORGIT  130                      064997
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
      ** Interest Amount Using N-T-R                                                          CAS006
      *                                                                                       CAS006
     C                     Z-ADD@NCDP     ZCDP                                                CAS006
     C                     Z-ADD@PNOML    NOML                                                CAS006
     C                     MOVE @PACIN    ZACIN                                               CAS006
     C                     Z-ADD@PDADJ    ZDADJ                                               CAS006
     C                     MOVE @PADIN    ZADIN                                               CAS006
     C                     Z-ADDWNTCR     TDCR                                                CAS006
      *                                                                                       CAS006
     C                     EXSR ZPCINT                                                        CAS006
      *                                                                                       CAS006
     C           @ACODE    IFEQ 'I'                                                           CAS006
     C           @PRECI    ANDEQ*BLANKS                                                       CAS006
     C           @PACIN    IFEQ 'F'                                                           CAS006
     C                     Z-ADD0         @PITRN                                              CAS006
     C                     ELSE                                                               CAS006
     C           P@BYSL    IFNE 'Y'                                                           CAS006
     C                     MOVE ZITRA     @PITRN                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE @PITRN    ZFLD15                                              CAS006
     C                     Z-ADD@NCDP     ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SITRN                                               CAS006
      *                                                                                       CAS006
      ** Save calculated interest amount for interest adjustment                              CAS006
      *                                                                                       CAS006
     C                     Z-ADDZITRA     WOITRN 130                                          CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C/COPY WNCPYSRC,SE3002C026
      *
     C                     END
      *                                                                   CAC002
      **  If Analytical Accounting is installed...                        CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
      **  Book Profit Centre                                              CAC002
      *                                                                   CAC002
      **  Get default from current book position profit centre            CAC002
      **  only if CAC005 is off.                                          CAC005
      *                                                                   CAC002
     C           CAC005    IFEQ 'N'                                       CAC005
      *                                                                   CAC005
     C                     MOVEL@PTDBK    BOKC                            CAC002
     C                     MOVEL@PTDBA    KBRC                            CAC002
     C                     MOVEL@PTDSS    KSSN                            CAC002
     C                     MOVEL@PTDMI    MKTI                            CAC002
     C           KLSPCB    CHAINSEPCBD               01                   CAC002
     C           *IN01     IFEQ '0'                                       CAC002
     C                     MOVE PCBK      WBPRC   4                       CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *BLANKS   WBPRC                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If current book position profit centre record exist & profit    CAC002
      **  centres are different, use the default & send a warning code    CAC002
      *                                                                   CAC002
     C           WBPRC     IFNE *BLANKS                                   CAC002
     C                     MOVE *ON       *IN36                           CAC002
     C           @PBPRC    IFNE WBPRC                                     CAC002
     C                     SETON                     1131                 CAC002
     C                     MOVE WBPRC     @PBPRC                          CAC002
     C                     MOVE ' W25'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC002
     C                     MOVE @PBPRC    SBPRC                           CAC002
      *                                                                   CAC002
      **  Transaction Profit Centre                                       CAC002
      *                                                                   CAC002
      **  If portfolio customer, get default from current customer        CAC002
      **  position profit centre record                                   CAC002
      *                                                                   CAC002
     C           @WC1DI    IFEQ 'S'                                       CAC002
     C           @WC1DI    OREQ 'D'                                       CAC002
      *                                                                   CAC002
     C                     MOVE *ON       *IN38                           CAC002
     C                     MOVE @PTDBA    KBRCA                           CAC002
     C                     MOVE @PTDSS    KSESN                           CAC002
     C                     MOVE @PTCNR    KCNUM                           CAC002
     C           KLSPCC    CHAINSEPCCD               01                   CAC002
     C           *IN01     IFEQ '0'                                       CAC002
     C                     MOVE PCCU      WTPRC   4                       CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *BLANKS   WTPRC                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If current cust position profit centre record exist & profit    CAC002
      **  centres are different, use the default & send a warning code    CAC002
      *                                                                   CAC002
     C           WTPRC     IFNE *BLANKS                                   CAC002
     C                     MOVE *ON       *IN37                           CAC002
     C           @PTPRC    IFNE WTPRC                                     CAC002
     C                     SETON                     1132                 CAC002
     C                     MOVE WTPRC     @PTPRC                          CAC002
     C                     MOVE ' W25'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     MOVE @PTPRC    STPRC                           CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
     C                     MOVE @PBPRC    @PTPRC                          CAC002
     C                     MOVE *OFF      *IN38                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *
     C                     ENDSR                           SUB102 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *  SUB103 - Display/validate screens                            *
      *****************************************************************
      *
     C           SUB103    BEGSR
      *
      * Action code 'N', no display required (just set up defaults)
     C           @ACODE    CABEQ'N'       END103
      *
     C                     SETOF                     05
     C           S01496    IFEQ 'Y'                                       081490
     C                     MOVEA'000'     *IN,22                          081490
     C                     MOVEA'00000000'*IN,50                          081490
     C                     MOVEA'00000000'*IN,58                          081490
     C                     MOVEA'00000000'*IN,66                          081490
     C                     MOVEA'00000000'*IN,74                          081490
     C                     MOVEA'00000000'*IN,82                          081490
     C                     ENDIF                                          081490
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     MOVE '0'       WK10                                                CAS006
     C                     MOVE '0'       WK16                                                CAS006
     C                     MOVE '0'       WK17                                                CAS006
     C                     ENDIF                                                              CAS006
      *
      * Repeat until no validation errors
     C           *IN11     DOUEQ'0'
     C           *IN05     ANDEQ'0'
      *
      * Check if re-calculated purch interest needs displaying (scr. 1)
     C           *IN06     ANDEQ'0'
      *
     C                     SETOF                     05                   S01176
      *                                                                   S01199
      ***Set*indicator*for*cursor*sensitive*help*text*referencing******                S01199 233607
     C********** @STDTP    COMP 'TS'                     20                            S01199 233607
      *
      * Display screen
     C********** *IN10     IFEQ '0'                                                           CAS006
     C           WSCRN     IFEQ '1'                                                           CAS006
     C           @ACODE    IFEQ 'I'
     C           P@BYSL    IFEQ 'N'                                       CSE006
     C                     MOVEL@TX,3     @SCMKT
     C                     ELSE
     C                     MOVEL@TX,8     @SCMKT                          CSE006
     C                     ENDIF                                          CSE006
     C*                                                                   CSE006
     C                     ELSE                                           CSE006
     C                     MOVEL@TX,5     @SCMKT
     C                     END
     C/COPY WNCPYSRC,SE3002C037
      *                                                                   CSE016
      ** Format security report description                               CSE016
      *                                                                   CSE016
     C                     MOVE *BLANKS   @SRNME                          CSE016
      *                                                                   CSE016
     C           SRPN      IFNE *BLANKS                                   CSE016
      *                                                                   CSE016
     C                     MOVE BVRIDF    ZRSFD                           CSE016
     C                     MOVELSRPN      ZSRPN                           CSE016
     C                     EXSR ZSDESC                                    CSE016
     C                     MOVELZRNME     @SRNME                          CSE016
      *                                                                   CSE016
     C                     ENDIF                                          CSE016
      *                                                                   CSE016
     C                     WRITESE3002F1
     C/COPY WNCPYSRC,SE3002C038
     C                     SETOF                     06
     C** If first time for this transaction set save fields to blank      S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C*                                                                   CAC002
     C           WWFRST    IFEQ 'Y'                                       S01496
     C                     MOVE 'N'       WWFRST                          S01496
     C           S01496    IFEQ 'Y'                                       CAC002
     C                     MOVE *BLANKS   WSTDVD  6                       S01496
     C                     MOVE *BLANKS   WSTDDT  6                       S01496
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE *BLANKS   WSBPRC  4                       CAC002
     C                     MOVE *BLANKS   WSTPRC  4                       CAC002
     C                     ENDIF                                          CAC002
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C** OTHERWISE SAVE SCREEN FIELDS                                     S01496
     C           S01496    IFEQ 'Y'                                       CAC002
     C                     MOVE @STDVD    WSTDVD                          S01496
     C                     MOVE @STDDT    WSTDDT                          S01496
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE SBPRC     WSBPRC                          CAC002
     C                     MOVE STPRC     WSTPRC                          CAC002
     C                     ENDIF                                          CAC002
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   CAC002
     C**  display second screen                                           CAC002
     C**********           ELSE                                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           WSCRN     IFEQ '2'                                                           CAS006
      *                                                                                       CAS006
     C           @ACODE    IFEQ 'I'                                                           CAS006
     C           P@BYSL    IFEQ 'N'                                                           CAS006
     C                     MOVEL@TX,9     @SCMKT                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVEL@TX,8     @SCMKT                                              CAS006
     C                     ENDIF                                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVEL@TX,5     @SCMKT                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     MOVE *IN10     WIN10   1                                           CAS006
     C                     MOVE *IN16     WIN16   1                                           CAS006
     C                     MOVE *IN17     WIN17   1                                           CAS006
     C                     MOVE WK10      *IN10                                               CAS006
     C                     MOVE WK16      *IN16                                               CAS006
     C                     MOVE WK17      *IN17                                               CAS006
      *                                                                                       CAS006
     C                     WRITESE3002FA                                                      CAS006
      *                                                                                       CAS006
     C                     MOVE WIN10     *IN10                                               CAS006
     C                     MOVE WIN16     *IN16                                               CAS006
     C                     MOVE WIN17     *IN17                                               CAS006
     C                     MOVE *OFF      *IN06                                               CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           WSCRN     IFEQ '3'                                                           CAS006
      *                                                                                       CAS006
     C           @ACODE    IFEQ 'I'
     C           P@BYSL    IFEQ 'N'                                       CSE006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     MOVEL@TX,10    @SCMKT                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVEL@TX,4     @SCMKT
     C                     ENDIF                                                              CAS006
     C                     ELSE
     C                     MOVEL@TX,8     @SCMKT                          CSE006
     C                     ENDIF                                          CSE006
     C*                                                                   CSE006
     C                     ELSE                                           CSE006
     C                     MOVEL@TX,5     @SCMKT
     C                     END
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C                     MOVE *IN36     WIN36   1                       CSE023
     C                     MOVE *ON       *IN36                           CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     MOVE *IN10     WIN10X  1                                         AR871625
     C                     MOVE *IN16     WIN16X  1                                         AR871625
     C                     MOVE *IN17     WIN17X  1                                         AR871625
     C                     MOVE WK10X     *IN10                                             AR871625
     C                     MOVE WK16X     *IN16                                             AR871625
     C                     MOVE WK17X     *IN17                                             AR871625
     C                     WRITESE3002F2
     C                     MOVE WIN10X    *IN10                                             AR871625
     C                     MOVE WIN16X    *IN16                                             AR871625
     C                     MOVE WIN17X    *IN17                                             AR871625
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C                     MOVE WIN36     *IN36                           CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C** If first time for this transaction set save fields to blank      S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C*                                                                   CAC002
     C           WWFRST    IFEQ 'Y'                                       S01496
     C                     MOVE 'N'       WWFRST                          S01496
     C           S01496    IFEQ 'Y'                                       CAC002
     C                     MOVE *BLANKS   WSTDER 14                       S01496
     C                     MOVE *BLANKS   WSBRTE 14                       S01496
     C                     MOVE *BLANKS   WSPTFR  4                       S01496
     C**********           MOVE *BLANKS   WSPYFM 12                                    S01496 CGL029
     C**********           MOVE *BLANKS   WSPAYT 12                                    S01496 CGL029
     C                     MOVE *BLANKS   WSPYFM 18                                           CGL029
     C                     MOVE *BLANKS   WSPAYT 18                                           CGL029
     C                     MOVE *BLANKS   WSSMTH  2                       S01496
     C                     MOVE *BLANKS   WSSMDI  1                       081490
     C                     MOVE *BLANKS   WSPYFB  3                       081490
     C                     MOVE *BLANKS   WSPYTB  3                       081490
     C                     MOVE *BLANKS   WSTFA1 10                       081490
     C                     MOVE *BLANKS   WSASNM  2                       081490
     C                     MOVE *BLANKS   WSDELF 10                       081490
     C                     MOVE *BLANKS   WSDELT 10                       081490
     C                     MOVE *BLANKS   WSDFFA 10                       081490
     C                     MOVE *BLANKS   WSTFA2 10                       081490
     C                     MOVE *BLANKS   WSCLTY  1                       081490
     C                     MOVE *BLANKS   WSPRYC  1                       081490
     C                     MOVE *BLANKS   WSPCOD  1                       081490
     C                     MOVE *BLANKS   WSAUTS  1                       081490
     C                     MOVE *BLANKS   WSTBCC  2                       081490
     C                     MOVE *BLANKS   WSTBCA 15                       081490
     C                     MOVE *BLANKS   WSTCCC  2                       081490
     C                     MOVE *BLANKS   WSTCCA 15                       081490
     C                     MOVE *BLANKS   WSTAXA 15                       081490
     C                     MOVE *BLANKS   WSBCMR 15                       081490
     C                     MOVE *BLANKS   WSCCMR 15                       081490
     C                     MOVE *BLANKS   WSTXRB 15                       081490
     C                     MOVE *BLANKS   WSSPXR 14                       081490
     C                     MOVE *BLANKS   WSSPMD  1                       081490
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE *BLANKS   WSTDER 14                       CAC002
     C                     MOVE *BLANKS   WSSPMD  1                       CAC002
     C                     MOVE *BLANKS   WSFXMP  8                       CAC002
     C                     ENDIF                                          CAC002
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C** OTHERWISE SAVE SCREEN FIELDS                                     S01496
     C           S01496    IFEQ 'Y'                                       CAC002
     C                     MOVE @STDER    WSTDER                          S01496
     C                     MOVE @SBRTE    WSBRTE                          S01496
     C                     MOVE SPTFR     WSPTFR                          S01496
     C                     MOVE @SPYFM    WSPYFM                          S01496
     C                     MOVE @SPAYT    WSPAYT                          S01496
     C                     MOVE @SSMTH    WSSMTH                          S01496
     C                     MOVE @SSMDI    WSSMDI                          081490
     C                     MOVE @SPYFB    WSPYFB                          081490
     C                     MOVE @SPYTB    WSPYTB                          081490
     C                     MOVE @STFA1    WSTFA1                          081490
     C                     MOVE @SASNM    WSASNM                          081490
     C                     MOVE @SDELF    WSDELF                          081490
     C                     MOVE @SDELT    WSDELT                          081490
     C                     MOVE @SDFFA    WSDFFA                          081490
     C                     MOVE @STFA2    WSTFA2                          081490
     C                     MOVE @SCLTY    WSCLTY                          081490
     C                     MOVE @SPRYC    WSPRYC                          081490
     C                     MOVE @SPCOD    WSPCOD                          081490
     C                     MOVE @SAUTS    WSAUTS                          081490
     C                     MOVE @STBCC    WSTBCC                          081490
     C                     MOVE @STBCA    WSTBCA                          081490
     C                     MOVE @STCCC    WSTCCC                          081490
     C                     MOVE @STCCA    WSTCCA                          081490
     C                     MOVE @STAXA    WSTAXA                          081490
     C                     MOVE @SBCMR    WSBCMR                          081490
     C                     MOVE @SCCMR    WSCCMR                          081490
     C                     MOVE @STXRB    WSTXRB                          081490
     C                     MOVE SSPXR     WSSPXR                          081490
     C                     MOVE SSPMD     WSSPMD                          081490
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE @STDER    WSTDER                          CAC002
     C                     MOVE SSPMD     WSSPMD                          CAC002
     C                     MOVE SFXMP     WSFXMP                          CAC002
     C                     ENDIF                                          CAC002
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END
     C/COPY WNCPYSRC,SE3002C021
      *
     C*********  *IN20     DOUEQ'0'                                       S01199
     C********** *IN10     IFEQ '0'                                                           CAS006
     C           WSCRN     IFEQ '1'                                                           CAS006
     C                     READ SE3002F1                 01
     C           RDSPLY    DOUEQ'N'                                       S01117
     C                     MOVE 'N'       RDSPLY  1                       S01117
     C                     EXSR D1QRY                                     S01117
     C           RDSPLY    IFEQ 'Y'                                       S01117
     C/COPY WNCPYSRC,SE3002C039
      *                                                                   CSE016
      ** Format security report description                               CSE016
      *                                                                   CSE016
     C                     MOVE *BLANKS   @SRNME                          CSE016
      *                                                                   CSE016
     C           SRPN      IFNE *BLANKS                                   CSE016
      *                                                                   CSE016
     C                     MOVE BVRIDF    ZRSFD                           CSE016
     C                     MOVELSRPN      ZSRPN                           CSE016
     C                     EXSR ZSDESC                                    CSE016
     C                     MOVELZRNME     @SRNME                          CSE016
      *                                                                   CSE016
     C                     ENDIF                                          CSE016
      *                                                                   CSE016
     C                     EXFMTSE3002F1                                  S01117
     C/COPY WNCPYSRC,SE3002C040
     C                     END                                            S01117
     C                     END                                            S01117
     C**********           ELSE                                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           WSCRN     IFEQ '2'                                                           CAS006
      *                                                                                       CAS006
     C                     MOVE *IN10     WIN10   1                                           CAS006
     C                     MOVE *IN16     WIN16   1                                           CAS006
     C                     MOVE *IN17     WIN17   1                                           CAS006
     C                     MOVE WK10      *IN10                                               CAS006
     C                     MOVE WK16      *IN16                                               CAS006
     C                     MOVE WK17      *IN17                                               CAS006
      *                                                                                       CAS006
     C                     EXFMTSE3002FA                                                      CAS006
      *                                                                                       CAS006
     C                     MOVE WIN10     *IN10                                               CAS006
     C                     MOVE WIN16     *IN16                                               CAS006
     C                     MOVE WIN17     *IN17                                               CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           WSCRN     IFEQ '3'                                                           CAS006
      *                                                                                       CAS006
     C                     READ SE3002F2                 01
     C           RDSPLY    DOUEQ'N'                                       S01117
     C                     MOVE 'N'       RDSPLY  1                       S01117
     C                     EXSR D2QRY                                     S01117
     C           RDSPLY    IFEQ 'Y'                                       S01117
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C                     MOVE *IN36     WIN36                           CSE023
     C                     MOVE *ON       *IN36                           CSE023
     C                     ENDIF                                          CSE023
     C                     MOVE *IN10     WIN10X  1                                         AR871625
     C                     MOVE *IN16     WIN16X  1                                         AR871625
     C                     MOVE *IN17     WIN17X  1                                         AR871625
     C                     MOVE WK10X     *IN10                                             AR871625
     C                     MOVE WK16X     *IN16                                             AR871625
     C                     MOVE WK17X     *IN17                                             AR871625
      *                                                                   CSE023
     C                     EXFMTSE3002F2                                  S01117
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C                     MOVE WIN36     WIN36                           CSE023
     C                     ENDIF                                          CSE023
     C                     MOVE WIN10X    *IN10                                             AR871625
     C                     MOVE WIN16X    *IN16                                             AR871625
     C                     MOVE WIN17X    *IN17                                             AR871625
      *                                                                   CSE023
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END
     C*********  *IN20     IFEQ '1'                                       S01199
     C*********            CALL 'MHELP'                01                 S01199
     C*********            PARM 'SE3002  '@ERPGM  8                       S01199
     C*********            PARM           @EA                             S01199
     C*********  *IN01     IFEQ '1'                                       S01199
     C*********            Z-ADD9         @DBASE           ***************S01199
     C*********            MOVEL*BLANKS   @DBFIL           * DB ERROR 09 *S01199
     C*********            MOVEL'MHELP'   @DBKEY           ***************S01199
     C*********            EXSR SUB999                                    S01199
     C*********            END                                            S01199
     C*********            END                                            S01199
     C*********            END                                            S01199
      *
     C***********          SETOF                     11                   S01176
     C***********          SETOF                     11  14        S01176 E21054
     C                     SETOF                     110714               E21054
      *
      * Validate if not CMD/3 or CMD/5 and action = I
     C************INKA     IFEQ '0'                                       E18010
     C           *INKC     IFEQ '0'                                       E18010
     C           *INKE     ANDEQ'0'
     C           @ACODE    ANDEQ'I'
      *
      * Reset error fields and indicators (50-89) before display
     C                     MOVEA*BLANKS   @EA
     C                     Z-ADD1         E       30
     C***********          SETOF                     515253               S01176
     C***********          SETOF                     545556               S01176
     C***********          SETOF                     575859               S01176
     C***********          SETOF                     606162               S01176
     C***********          SETOF                     636465               S01176
     C***********          SETOF                     666768               S01176
     C***********          SETOF                     697071               S01176
     C***********          SETOF                     727374               S01176
     C***********          SETOF                     757677               S01176
     C***********          SETOF                     787980               S01176
     C***********          SETOF                     818283               S01176
     C***********          SETOF                     848586               S01176
     C***********          SETOF                     87                   S01176
     C                     SETOF                     49                   S01176
     C                     SETOF                     2122                 S01117
     C                     SETOF                     232428               081490
     C                     SETOF                     313234               CAC002
     C                     MOVEA'00000000'*IN,50                          S01176
     C                     MOVEA'00000000'*IN,58                          S01176
     C                     MOVEA'00000000'*IN,66                          S01176
     C                     MOVEA'00000000'*IN,74                          S01176
     C                     MOVEA'00000000'*IN,82                          S01176
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     MOVE '0'       WK10                                                CAS006
     C                     MOVE '0'       WK16                                                CAS006
     C                     MOVE '0'       WK17                                                CAS006
     C                     ENDIF                                                              CAS006
      *
      * If *IN10 off, then validate screen 1 (SUB201)
      * Else if *IN10 on:
      *      If *INKB (Cmd/12) off, then validate screen 2 (SUB203)
      *      Else set on *IN12 to redisplay screen 1
     C********** *IN10     IFEQ '0'                                                           CAS006
     C           WSCRN     IFEQ '1'                                                           CAS006
     C                     EXSR SUB201
     C**********           ELSE                                                               CAS006
     C                     ENDIF                                                              CAS006
     C           WSCRN     IFEQ '2'                                                           CAS006
     C           *INKL     IFEQ '0'                                                           CAS006
     C                     EXSR SUB202                                                        CAS006
     C           *INKI     IFEQ '1'                                                           CAS006
     C           WBSCR3    ANDEQ'Y'                                                           CAS006
     C                     MOVE *ON       *IN12                                               CAS006
     C                     ENDIF                                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE *ON       *IN12                                               CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
     C************INKB     IFEQ '0'                                       E18010
     C           WSCRN     IFEQ '3'                                                           CAS006
     C           *INKL     IFEQ '0'                                       E18010
     C                     EXSR SUB203
     C                     ELSE
     C                     SETON                       12
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     MOVE 'Y'       WFSCR3  1                                           CAS006
     C                     MOVE 'Y'       WBSCR3  1                                           CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     END
     C                     END
      *                                                                   S01496
     C** Check whether all errors are warning errors                      S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C                     Z-ADD1         WI      30                      S01496
     C                     MOVE 'N'       WWRLER  1                       S01496
     C           WI        DOUEQ100                        B1             S01496
     C           @EA,WI    OREQ '    '                                    S01496
     C           WWRLER    OREQ 'Y'                                       S01496
     C                     MOVEL@EA,WI    WWORK2  2                       S01496
     C                     MOVE WWORK2    WWORK1  1                       S01496
     C                     MOVEL@EA,WI    WWORK3  1                                           234635
     C*                                                                   S01496
     C           WWORK1    IFNE 'W'                        B2             S01496
     C           WWORK1    ANDNE' '                                       S01496
     C           WWORK3    ANDNE'W'                                                           234635
     C                     MOVE 'Y'       WWRLER                          S01496
     C                     END                             E2             S01496
     C           WWORK3    IFEQ 'W'                                                           234635
     C           WDONE     IFEQ 'Y'                                                           234635
     C                     ADD  21        WI                                                  234635
     C                     ENDIF                                                              234635
     C                     MOVE 'Y'       WDONE                                               234635
     C                     ENDIF                                                              234635
     C*                                                                   S01496
     C                     ADD  1         WI                              S01496
     C                     END                             E1             S01496
     C*                                                                   S01496
     C** If all errors are warning errors and no change in date entered   S01496
     C** accept input                                                     S01496
     C*                                                                   S01496
     C           WWRLER    IFEQ 'N'                                       S01496
     C*                                                                   S01496
     C** Check first screen                                               S01496
     C*                                                                   S01496
     C********** *IN10     IFEQ '0'                                                    S01496 CAS006
     C           WSCRN     IFEQ '1'                                                           CAS006
     C*                                                                   S01496
     C**********           MOVE 'Y'       ACTDVD  1                 S01496081490
     C**********           MOVE 'Y'       ACTDDT  1                 S01496081490
     C********** *IN52     IFEQ '1'                                 S01496081490
     C********** @STDVD    ANDNEWSTDVD                              S01496081490
     C**********           MOVE 'N'       ACTDVD                    S01496081490
     C**********           END                                      S01496081490
     C**********                                                    S01496081490
     C********** *IN61     IFEQ '1'                                 S01496081490
     C********** @STDDT    ANDNEWSTDDT                              S01496081490
     C**********           MOVE 'N'       ACTDDT                    S01496081490
     C**********           END                                      S01496081490
     C*                                                                   S01496
     C** If no change in details accept error                             S01496
     C*                                                                   S01496
     C********** ACTDVD    IFEQ 'Y'                                 S01496081490
     C********** ACTDDT    ANDEQ'Y'                                 S01496081490
     C           @STDVD    IFEQ WSTDVD                                    081490
     C           @STDDT    ANDEQWSTDDT                                    081490
     C*                                                                   CAC002
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C           SBPRC     ANDEQWSBPRC                                    CAC002
     C           STPRC     ANDEQWSTPRC                                    CAC002
     C                     MOVE '0'       *IN11                           S01496
     C                     MOVEA*BLANKS   @EA                             S01496
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C           CGL031    IFEQ 'Y'                                                           234635
     C           WWORK3    ANDEQ'W'                                                           234635
     C                     MOVE *BLANKS   WDONE   1                                           234635
     C                     SETOF                     1152                                     234635
     C                     ENDIF                                                              234635
     C                     END                                            S01496
     C*                                                                   S01496
     C** Otherwise check second screen                                    S01496
     C*                                                                   S01496
     C**********           ELSE                                                        S01496 CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C**********           MOVE 'Y'       ACTDER  1                 S01496081490
     C**********           MOVE 'Y'       ACBRTE  1                 S01496081490
     C**********           MOVE 'Y'       ACPTFR  1                 S01496081490
     C**********           MOVE 'Y'       ACPYFM  1                 S01496081490
     C**********           MOVE 'Y'       ACPAYT  1                 S01496081490
     C**********           MOVE 'Y'       ACSMTH  1                 S01496081490
     C********** *IN51     IFEQ '1'                                 S01496081490
     C********** @STDER    ANDNEWSTDER                              S01496081490
     C**********           MOVE 'N'       ACTDER                    S01496081490
     C**********           END                                      S01496081490
     C**********                                                    S01496081490
     C********** *IN53     IFEQ '1'                                 S01496081490
     C********** @SBRTE    ANDNEWSBRTE                              S01496081490
     C**********           MOVE 'N'       ACBRTE                    S01496081490
     C**********           END                                      S01496081490
     C**********                                                    S01496081490
     C********** *IN22     IFEQ '1'                                 S01496081490
     C********** SPTFR     ANDNEWSPTFR                              S01496081490
     C**********           MOVE 'N'       ACPTFR                    S01496081490
     C**********           END                                      S01496081490
     C**********                                                    S01496081490
     C********** *IN55     IFEQ '1'                                 S01496081490
     C********** @SPYFM    ANDNEWSPYFM                              S01496081490
     C********** *IN55     OREQ '1'                                 S01496081490
     C********** SPTFR     ANDNEWSPTFR                              S01496081490
     C**********           MOVE 'N'       ACPYFM                    S01496081490
     C**********           END                                      S01496081490
     C**********                                                    S01496081490
     C********** *IN57     IFEQ '1'                                 S01496081490
     C********** @SPAYT    ANDNEWSPAYT                              S01496081490
     C********** *IN57     OREQ '1'                                 S01496081490
     C********** SPTFR     ANDNEWSPTFR                              S01496081490
     C**********           MOVE 'N'       ACPAYT                    S01496081490
     C**********           END                                      S01496081490
     C**********                                                    S01496081490
     C********** *IN54     IFEQ '1'                                 S01496081490
     C********** @SSMTH    ANDNEWSSMTH                              S01496081490
     C**********           MOVE 'N'       ACSMTH                    S01496081490
     C**********           END                                      S01496081490
      *                                                                                       CAS006
      ** Check third screen                                                                   CAS006
      *                                                                                       CAS006
     C           WSCRN     IFEQ '3'                                                           CAS006
     C*                                                                   S01496
     C** If no change in details accept error                             S01496
     C*                                                                   S01496
     C           @STDER    IFEQ WSTDER                                    081490
     C           @SSMDI    ANDEQWSSMDI                                    081490
     C           @SBRTE    ANDEQWSBRTE                                    081490
     C           @SSMTH    ANDEQWSSMTH                                    081490
     C           @SPYFM    ANDEQWSPYFM                                    081490
     C           @SPYFB    ANDEQWSPYFB                                    081490
     C           @SPAYT    ANDEQWSPAYT                                    081490
     C           @SPYTB    ANDEQWSPYTB                                    081490
     C           @STFA1    ANDEQWSTFA1                                    081490
     C           @SASNM    ANDEQWSASNM                                    081490
     C           @SDELF    ANDEQWSDELF                                    081490
     C           @SDELT    ANDEQWSDELT                                    081490
     C           @SDFFA    ANDEQWSDFFA                                    081490
     C           @STFA2    ANDEQWSTFA2                                    081490
     C           @SCLTY    ANDEQWSCLTY                                    081490
     C           @SPRYC    ANDEQWSPRYC                                    081490
     C           @SPCOD    ANDEQWSPCOD                                    081490
     C           @SAUTS    ANDEQWSAUTS                                    081490
     C           @STBCC    ANDEQWSTBCC                                    081490
     C           @STBCA    ANDEQWSTBCA                                    081490
     C           @STCCC    ANDEQWSTCCC                                    081490
     C           @STCCA    ANDEQWSTCCA                                    081490
     C           @STAXA    ANDEQWSTAXA                                    081490
     C           @SBCMR    ANDEQWSBCMR                                    081490
     C           @SCCMR    ANDEQWSCCMR                                    081490
     C           @STXRB    ANDEQWSTXRB                                    081490
     C           SPTFR     ANDEQWSPTFR                                    081490
     C           SSPXR     ANDEQWSSPXR                                    081490
     C           SSPMD     ANDEQWSSPMD                                    081490
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C           SFXMP     ANDEQWSFXMP                                    CAC002
     C           @STDER    ANDEQWSTDER                                    CAC002
     C           SSPMD     ANDEQWSSPMD                                    CAC002
     C*                                                                   CAC002
     C********** ACTDER    IFEQ 'Y'                                 S01496081490
     C********** ACBRTE    ANDEQ'Y'                                 S01496081490
     C********** ACPTFR    ANDEQ'Y'                                 S01496081490
     C********** ACPYFM    ANDEQ'Y'                                 S01496081490
     C********** ACPAYT    ANDEQ'Y'                                 S01496081490
     C********** ACSMTH    ANDEQ'Y'                                 S01496081490
     C                     MOVE '0'       *IN11                           S01496
     C                     MOVEA*BLANKS   @EA                             S01496
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C                     END                                            S01496
     C/COPY WNCPYSRC,SE3002C022
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
      *
     C                     MOVEA@EA,1     @SERR1
     C********** @EA,20    IFNE *BLANKS                                                E21054 234440
     C**********           SETON                     07                                E21054 234440
     C**********           MOVEA@EA,20    @SERR2                                              234440
     C**********           END                                                         E21054 234440
     C                     END
      *
     C                     END
      *
     C           END103    ENDSR                           SUB103 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *  SUB104 - Set up screen 2 for display                         *
      *****************************************************************
      *
     C           SUB104    BEGSR
      *
     C                     SETON                     13
      *                                                                   050725
      * If Purchase protect Pay To Branch, if sale protect Pay From Branch050725
     C           @STDTP    IFEQ 'TP'                                      050725
     C                     SETON                     03                   050725
      *                                                                   CEU005
      ** CEU005 active                                                    CEU005
      ** Trade type = TS and settlement currency not Euro currency        CEU005
      ** do not display 'IN' ccy in field 72.                             CEU005
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           @PSETC    ANDNEBKEURO                                    CEU005
     C                     MOVE *OFF      *IN15                           CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CEU005
     C                     ELSE                                           050725
     C                     SETON                     02                   050725
      *                                                                   CEU005
      ** CEU005 active                                                    CEU005
      ** Trade type = TS and settlement currency not Euro currency        CEU005
      ** do not display 'IN' ccy in field 72.                             CEU005
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           @STDTP    IFEQ 'TS'                                      CEU005
     C           @PSETC    ORNE BKEURO                                    CEU005
     C                     MOVE *OFF      *IN15                           CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C                     END                                            050725
      *                                                                   CEU005
      ** CEU005 active                                                    CEU005
      ** Set up screen field for ICCY.                                    CEU005
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           ICCY      ANDNE*BLANKS                                   CEU005
     C                     MOVE ICCY      @SICCY                          CEU005
     C           *LIKE     DEFN ICCY      OLDCCY                          CEU005
     C                     MOVE @SICCY    OLDCCY                          CEU005
     C                     ENDIF                                          CEU005
      *
      ** CGL031 active                                                                        234440
      ** Trade type = TP, counterparty is 'S' or 'D' then display                             234440
      ** EU Tax field                                                                         234440
      *                                                                                       234440
     C           CGL031    IFEQ 'Y'                                                           234440
     C           @STDTP    ANDEQ'TP'                                                          234440
     C           @WC1DI    IFEQ 'S'                                                           234440
     C           @WC1DI    OREQ 'D'                                                           234440
     C                     MOVE *ON       *IN45                                               234440
     C                     ENDIF                                                              234440
     C                     ENDIF                                                              234440
      * If action is insert, and incomplete indicator is C, and exchange
      * rate is zero, then if client is safe custody or discretionary or
      * security is multicurrency and settlement currency has changed,
      * then set indicator to I and display on screen 2.
     C                     SETOF                     46
      *
     C           @ACODE    IFEQ 'I'
     C           @PTINC    ANDEQ'C'
     C           @PTDER    ANDEQ0
      *
     C           @WC1DI    IFEQ 'S'
     C           @WC1DI    OREQ 'D'
     C                     SETON                     46
     C                     END
      *
     C           MLTI      IFEQ 'Y'
     C           @SSETC    ANDNE@OSETC
     C                     SETON                     46
     C                     END
      *
     C           *IN46     IFEQ '1'
     C                     MOVEL'I'       @PTINC
     C                     MOVEL@PTINC    @SINCS
     C                     END
      *
     C                     END
      *
      *  Exchange Rate
     C                     Z-ADD0         ZFLD15
      *                                                                   CAC002
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C           @SSETC    OREQ NMCYA                                     CAC002
     C                     MOVE @PTDER    ZFLD15
     C                     ELSE                                           CAC002
     C           @PTDTP    IFEQ 'TP'                                      CAC002
     C           @PTMDI    ANDEQ'M'                                       CAC002
     C           @PTDTP    OREQ 'TS'                                      CAC002
     C           @PTMDI    ANDEQ'D'                                       CAC002
     C           @PTDER    ADD  @PFXMR    WATDER 138                      CAC002
     C                     ELSE                                           CAC002
     C           @PTDER    SUB  @PFXMR    WATDER                          CAC002
     C                     ENDIF                                          CAC002
     C                     MOVE WATDER    ZFLD15                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C/COPY WNCPYSRC,SE3002C060
     C                     MOVE ZOUT20    @STDER
     C/COPY WNCPYSRC,SE3002C061
     C                     Z-ADD@PTDER    @OTDER 138
     C                     MOVEL*BLANKS   @SAVER 14
      *
      *  M/D indicator
     C                     MOVE @PTMDI    @SSMDI
     C                     MOVEL@SSMDI    @OSMDI  1
      *
      *  AUTO-SETTLE INDICATOR                                            S01176
     C** If no value specified on previous cycle, use customer default.   065295
     C           @PAUTS    IFNE *BLANK                                    065295
     C                     MOVE @PAUTS    @SAUTS                          S01176
     C                     ELSE                                           065295
     C           CSE039    IFNE 'Y'                                                           CSE039
     C                     MOVE @AUTS     @SAUTS                          065295
     C                     ELSE                                                               CSE039
      * but if CSE039 is on take from SSI for custodian if market customer                    CSE039
     C           @WC1DI    IFEQ 'M'                                                           CSE039
      *                                                                                       CSE039
     C           @STDTP    IFEQ 'TP'                                                          CSE039
     C                     MOVEL@PDELT    PCUST                                               CSE039
     C                     ELSE                                                               CSE039
     C                     MOVEL@PDELF    PCUST                                               CSE039
     C                     ENDIF                                                              CSE039
      *                                                                                       CSE039
     C           PCUST     IFNE *BLANKS                                                       CSE039
     C                     CALL 'SESSIR0'                                                     CSE039
     C                     PARM 'D'       POTYP   1                                           CSE039
     C                     PARM           @PTDBA                                              CSE039
     C                     PARM           PCUST   6                                           CSE039
     C                     PARM SIBK      PSIBK   2                                           CSE039
     C                     PARM           NMCYA                                               CSE039
     C                     PARM SMCC      PMRKT   2                                           CSE039
     C                     PARM           SITP                                                CSE039
     C                     PARM           PTFR                                                CSE039
     C                     PARM           PCBSTD                                              CSE039
     C                     PARM           PCBSAD                                              CSE039
     C                     PARM *BLANKS   PRTCD                                               CSE039
      *                                                                                       CSE039
     C           PRTCD     IFNE '*NCRF'                                                       CSE039
     C           PRTCD     ANDNE'*NRF '                                                       CSE039
     C           2         OCUR PCBSTD                                                        CSE039
     C                     MOVE SASI      @SAUTS                                              CSE039
     C                     ELSE                                                               CSE039
      *                                                                                       CSE039
      * if not found default from Custodian's Client record                                   CSE039
     C                     MOVE PCUST     @WCUST                                              CSE039
     C                     MOVE *BLANKS   @RTCD                                               CSE039
     C                     EXSR AOSECS                                                        CSE039
     C           @RTCD     IFEQ *BLANKS                                                       CSE039
     C                     MOVE BFASIN    @SAUTS                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     ELSE                                                               CSE039
      *                                                                                       CSE039
      * if Safe Custody or Discretionary, Default from SSI previously                         CSE039
      * accessed                                                                              CSE039
     C           SETFLG    IFEQ 'Y'                                                           CSE039
     C                     MOVE SASI      @SAUTS                                              CSE039
     C                     ELSE                                                               CSE039
      *                                                                                       CSE039
      * else Customer's record                                                                CSE039
     C                     MOVE @AUTS     @SAUTS                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     END                                            065295
      *
      *  Base currency rate
     C                     Z-ADD0         ZFLD15
     C                     MOVE @PTBCR    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @SBRTE
     C                     Z-ADD@PTBCR    @OTBCR 138
     C                     MOVEL*BLANKS   @SAVBS 14
      *
      *  Settlement method
     C                     MOVEL@PSMTH    @SSMTH
     C***********          MOVEL@SSMTH    @OSMTH  2                       S01195
      *
      *  Pay from
     C                     MOVEL@PPYFM    @SPYFM
     C***********          MOVEL@SPYFM    @OPYFM 12                       S01195
      *
      *  Pay from branch
     C***********@PPYFB    IFNE 0                                         S01117
     C***********          MOVEL@PPYFB    @SPYFB                          S01117
     C           @PPYFA    IFNE *BLANKS                                   S01117
     C                     MOVEL@PPYFA    @SPYFB                          S01117
     C                     ELSE
     C                     MOVEL*BLANKS   @SPYFB
     C                     END
     C***********          MOVEL@SPYFB    @OPYFB  3                       S01117
     C                     MOVEL@SPYFB    @OPYFB  3                       S01117
      *
      *  Pay to
     C                     MOVEL@PPAYT    @SPAYT
     C***********          MOVEL@SPAYT    @OPAYT 12                       S01195
      *
      *  Pay to branch
     C***********@PPYTB    IFNE 0                                         S01117
     C***********          MOVEL@PPYTB    @SPYTB                          S01117
     C           @PPYTA    IFNE *BLANKS                                   S01117
     C                     MOVEL@PPYTA    @SPYTB                          S01117
     C                     ELSE
     C                     MOVEL*BLANKS   @SPYTB
     C                     END
     C                     MOVEL@SPYTB    @OPYTB  3
      *
      *  For a/c of
      *  If the field contains a counterparty nostro (1st char is alpha)
      *  then display that, else field contains a customer number. Display
      *  short name if possible, else display customer number.
     C                     MOVEL*BLANKS   @STFA1
     C                     MOVEL@PTDFA    @WK1
     C           @WK1      IFLT '0'
     C           @WK1      ORGT '9'
     C                     MOVEL@PTDFA    @STFA1
     C                     ELSE
     C***********          MOVEL@PTDFA    CNUM                            S01117
     C***********CNUM      CHAINCLINTCBF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********CSNM      OREQ *BLANKS                                   S01117
     C                     MOVE *BLANKS   @WCSNM                          S01117
     C                     MOVEL@PTDFA    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BBCSSN    OREQ *BLANKS                                   S01117
     C                     MOVEL@PTDFA    @STFA1
     C                     ELSE
     C***********          MOVELCSNM      @STFA1                          S01117
     C                     MOVELBBCSSN    @STFA1                          S01117
     C                     END
     C                     END
     C                     MOVEL@STFA1    @OTFA1 10
      *
      *  A/c sequence
     C           @PASNM    IFNE 0
     C                     MOVEL@PASNM    @SASNM
     C                     ELSE
     C***                  MOVEL*BLANKS   @SASNM                          E16808
     C***********          MOVEL'01'      @SASNM                   E16808 E19945
     C                     MOVEL*BLANKS   @SASNM                          E19945
     C                     END
     C                     MOVEL@SASNM    @OASNM  2
      *
      *  Clearance type
     C                     MOVEL@PCLTY    @SCLTY
     C                     MOVEL@SCLTY    @OCLTY
      *
      *  Special instructions
     C                     MOVEL@PTDSI    @STDSI
      *
      *  Priority code
     C                     MOVEL@PPRYC    @SPRYC
     C                     MOVEL@SPRYC    @OPRYC  1
      *
      ***C/H*indicator**********                                          S01175
     C***********          MOVEL@PCLRH    @SCLRH                          S01175
     C***********          MOVEL@SCLRH    @OCLRH  1                       S01175
      *
      *  Pay code
     C                     MOVEL@PPCOD    @SPCOD
     C                     MOVEL@SPCOD    @OPCOD  1
      *
      *  Deliver from
      *  Attempt to display customer short name. If customer not
      *  found, or name is blank, then display customer number.
     C                     MOVEL*BLANKS   @SDELF
     C********** @PDELF    IFNE 0                                                            CSD027A
     C           @PDELF    IFNE *BLANKS                                                      CSD027A
     C***********@PDELF    CHAINCLINTCBF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********CSNM      OREQ *BLANKS                                   S01117
     C                     MOVE *BLANKS   @WCSNM                          S01117
     C                     MOVEL@PDELF    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BBCSSN    OREQ *BLANKS                                   S01117
     C                     MOVEL@PDELF    @SDELF
     C                     ELSE
     C***********          MOVELCSNM      @SDELF                          S01117
     C                     MOVELBBCSSN    @SDELF                          S01117
     C                     END
     C                     END
     C                     MOVEL@SDELF    @ODELF 10
      *
      *  Deliver to
      *  Attempt to display customer short name. If customer not
      *  found, or name is blank, then display customer number.
     C                     MOVEL*BLANKS   @SDELT
     C********** @PDELT    IFNE 0                                                            CSD027A
     C***********@PDELT    CHAINCLINTCBF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********CSNM      OREQ *BLANKS                                   S01117
     C           @PDELT    IFNE *BLANKS                                                      CSD027A
     C                     MOVE *BLANKS   @WCSNM                          S01117
     C                     MOVEL@PDELT    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BBCSSN    OREQ *BLANKS                                   S01117
     C                     MOVEL@PDELT    @SDELT
     C                     ELSE
     C***********          MOVELCSNM      @SDELT                          S01117
     C                     MOVELBBCSSN    @SDELT                          S01117
     C                     END
     C                     END
     C                     MOVEL@SDELT    @ODELT 10
      *
      *  For a/c of
      *  If the field contains a counterparty nostro (1st char is alpha)
      *  then display that, else field contains a customer number.
      *  Display short name if possible, else display customer number.
     C                     MOVEL*BLANKS   @STFA2
     C                     MOVEL@PDTFA    @WK1
     C           @WK1      IFLT '0'
     C           @WK1      ORGT '9'
     C                     MOVEL@PDTFA    @STFA2
     C                     ELSE
     C***********          MOVEL@PDTFA    CNUM                            S01117
     C***********CNUM      CHAINCLINTCBF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********CSNM      OREQ *BLANKS                                   S01117
     C                     MOVE *BLANKS   @WCSNM                          S01117
     C                     MOVEL@PDTFA    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BBCSSN    OREQ *BLANKS                                   S01117
     C                     MOVEL@PDTFA    @STFA2
     C                     ELSE
     C***********          MOVELCSNM      @STFA2                          S01117
     C                     MOVELBBCSSN    @STFA2                          S01117
     C                     END
     C                     END
     C                     MOVEL@STFA2    @OTFA2 10
      *                                                                   S01175
      *  For a/c of (Deliver from)                                        S01175
     C                     MOVEL@PDFFA    @SDFFA                          S01175
     C                     MOVEL@SDFFA    @ODFFA 10                       S01175
     C*
     C***********          Z-ADD@PTVCA    WTVCA                           S01176
     C***********          Z-ADD@PTPCA    WTPCA                           S01176
     C***********          Z-ADD@PLTCA    WLTCA                           S01176
     C                     Z-ADD@PTBCA    WTBCA
     C                     Z-ADD@PTCCA    WTCCA
     C                     Z-ADD@PTCA1    WTCA1
     C                     Z-ADD@PTCA2    WTCA2
     C                     Z-ADD@PTCA3    WTCA3
     C***********          Z-ADD@PTOCA    WTOCA                           S01176
     C***********          Z-ADD@PTLTA    WTLTA                           S01176
     C                     Z-ADD@PTCA4    WTCA4                           S01176
     C                     Z-ADD@PTCA5    WTCA5                           S01176
     C                     Z-ADD@PTCA6    WTCA6                           S01176
     C                     Z-ADD@PTCA7    WTCA7                           S01176
     C                     Z-ADD@PTAXA    WTAXA                           S01176
     C                     Z-ADD@PBCMR    WBCMR                           S01176
     C                     Z-ADD@PCCMR    WCCMR                           S01176
     C                     Z-ADD@PTXRB    WTXRB                           S01176
     C*
     C*  Reverse charges signs if necessary - for enquiries only
     C           @ACODE    IFEQ 'E'
     C*
     C           @WC1DI    IFEQ 'M'
     C           @PTDTP    ANDEQ'TS'
     C           @WC1DI    OREQ 'S'
     C           @PTDTP    ANDEQ'TP'
     C           @WC1DI    OREQ 'D'
     C           @PTDTP    ANDEQ'TP'
     C***********          Z-SUB@PTVCA    WTVCA                           S01176
     C***********          Z-SUB@PTPCA    WTPCA                           S01176
     C***********          Z-SUB@PLTCA    WLTCA                           S01176
     C                     Z-SUB@PTBCA    WTBCA
     C                     Z-SUB@PTCCA    WTCCA
     C                     Z-SUB@PTCA1    WTCA1
     C                     Z-SUB@PTCA2    WTCA2
     C                     Z-SUB@PTCA3    WTCA3
     C***********          Z-SUB@PTOCA    WTOCA                           S01176
     C***********          Z-SUB@PTLTA    WTLTA                           S01176
     C                     Z-SUB@PTCA4    WTCA4                           S01176
     C                     Z-SUB@PTCA5    WTCA5                           S01176
     C                     Z-SUB@PTCA6    WTCA6                           S01176
     C                     Z-SUB@PTCA7    WTCA7                           S01176
     C                     Z-SUB@PTAXA    WTAXA                           S01176
     C                     Z-SUB@PBCMR    WBCMR                           S01176
     C                     Z-SUB@PCCMR    WCCMR                           S01176
     C                     Z-SUB@PTXRB    WTXRB                           S01176
     C                     END
     C                     END
      ***********                                                         S01176
      ***Local*transfer*code**********************************************S01176
     C***********          MOVEL@PTTCC    @STTCC                          S01176
     C***********          MOVEL@STTCC    @OTTCC  2                       S01176
      ***********                                                         S01176
      ***Local*transfer*amount********************************************S01176
     C***********          Z-ADD0         ZFLD15                          S01176
     C***********          MOVE WLTCA     ZFLD15                          S01176
     C***********          Z-ADD@NCDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @STTCA                          S01176
      ***********                                                         S01176
      ***PMT*Charge*code**************************************************S01176
     C***********          MOVEL@PTPCC    @STPCC                          S01176
     C***********          MOVEL@STPCC    @OTPCC  2                       S01176
      ***********                                                         S01176
      ***PMT*charge*amount************************************************S01176
     C***********          Z-ADD0         ZFLD15                          S01176
     C***********          MOVE WTPCA     ZFLD15                          S01176
     C***********          Z-ADD@NCDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @STPCA                          S01176
      ***********                                                         S01176
      ***VAT*charge*amount************************************************S01176
     C***********          Z-ADD0         ZFLD15                          S01176
     C***********          MOVE WTVCA     ZFLD15                          S01176
     C***********          Z-ADD@NCDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @STVCA                          S01176
      *                                                                   S01176
      ** Reset all screen fields                                          S01176
      *                                                                   S01176
     C                     MOVE *BLANK    @STBCA                          S01176
     C                     MOVE *BLANK    @STCCA                          S01176
     C                     MOVE *BLANK    @STCA1                          S01176
     C                     MOVE *BLANK    @STCA2                          S01176
     C                     MOVE *BLANK    @STCA3                          S01176
     C                     MOVE *BLANK    @STCA4                          S01176
     C                     MOVE *BLANK    @STCA5                          S01176
     C                     MOVE *BLANK    @STCA6                          S01176
     C                     MOVE *BLANK    @STCA7                          S01176
     C                     MOVE *BLANK    @STAXA                          S01176
     C                     MOVE *BLANK    @OTBCA                          S01176
     C                     MOVE *BLANK    @OTCCA                          S01176
     C                     MOVE *BLANK    @OTCA1                          S01176
     C                     MOVE *BLANK    @OTCA2                          S01176
     C                     MOVE *BLANK    @OTCA3                          S01176
     C                     MOVE *BLANK    @OTCA4                          S01176
     C                     MOVE *BLANK    @OTCA5                          S01176
     C                     MOVE *BLANK    @OTCA6                          S01176
     C                     MOVE *BLANK    @OTCA7                          S01176
     C                     MOVE *BLANK    @OTAXA                          S01176
      *
      *  Broker commission code
     C                     MOVEL@PTBCC    @STBCC
     C                     MOVEL@STBCC    @OTBCC  2
      *
      *  Broker commission amount
     C           @PTBCC    IFNE *BLANKS                                   S01176
     C                     Z-ADD0         ZFLD15
     C                     MOVE WTBCA     ZFLD15
     C                     Z-ADD@NCDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @STBCA
     C                     MOVE ZOUT21    @OTBCA                          S01176
     C                     END                                            S01176
      *
      *  Customer commission code
     C                     MOVEL@PTCCC    @STCCC
     C***********          MOVEL@STCCC    @OTCCC  2                       S01176
      *                                                                   064999
      *  Correct set up of charge codes                                   064999
      *                                                                   064999
     C                     MOVEL@STCCC    @OTCCC  2                       064999
      *
      *  Customer commission amount
     C           @PTCCC    IFNE *BLANKS                                   S01176
     C                     Z-ADD0         ZFLD15
     C                     MOVE WTCCA     ZFLD15
     C                     Z-ADD@NCDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @STCCA
     C                     MOVE ZOUT21    @OTCCA                          S01176
     C                     END                                            S01176
      *
      *  Charges 1 code
     C                     MOVEL@PTCC1    @STCC1
     C***********          MOVEL@STCC1    @OTCC1  2                       S01176
      *                                                                   064999
      *  Correct set up of charge codes                                   064999
      *                                                                   064999
     C                     MOVEL@STCC1    @OTCC1  2                       064999
      *
      *  Charges 1 amount
     C           @PTCC1    IFNE *BLANKS                                   S01176
     C                     Z-ADD0         ZFLD15
     C                     MOVE WTCA1     ZFLD15
     C                     Z-ADD@NCDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @STCA1
     C                     MOVE ZOUT21    @OTCA1                          S01176
     C                     END                                            S01176
      *
      *  Charges 2 code
     C                     MOVEL@PTCC2    @STCC2
     C***********          MOVEL@STCC2    @OTCC2  2                       S01176
      *                                                                   064999
      *  Correct set up of charge codes                                   064999
      *                                                                   064999
     C                     MOVEL@STCC2    @OTCC2  2                       064999
      *
      *  Charges 2 amount
     C           @PTCC2    IFNE *BLANKS                                   S01176
     C                     Z-ADD0         ZFLD15
     C                     MOVE WTCA2     ZFLD15
     C                     Z-ADD@NCDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @STCA2
     C                     MOVE ZOUT21    @OTCA2                          S01176
     C                     END                                            S01176
      *
      *  Charges 3 code
     C                     MOVEL@PTCC3    @STCC3
     C***********          MOVEL@STCC3    @OTCC3  2                       S01176
      *                                                                   064999
      *  Correct set up of charge codes                                   064999
      *                                                                   064999
     C                     MOVEL@STCC3    @OTCC3  2                       064999
      *
      *  Charges 3 amount
     C           @PTCC3    IFNE *BLANKS                                   S01176
     C                     Z-ADD0         ZFLD15
     C                     MOVE WTCA3     ZFLD15
     C                     Z-ADD@NCDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @STCA3
     C                     MOVE ZOUT21    @OTCA3                          S01176
     C                     END                                            S01176
      ***********                                                         S01176
      ***Charges*other*code***********************************************S01176
     C***********          MOVEL@PTOCC    @STOCC                          S01176
     C***********          MOVEL@STOCC    @OTOCC  2                       S01176
      ***********                                                         S01176
      ***Charges*other*amount*********************************************S01176
     C***********          Z-ADD0         ZFLD15                          S01176
     C***********          MOVE WTOCA     ZFLD15                          S01176
     C***********          Z-ADD@NCDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @STOCA                          S01176
      ***********                                                         S01176
      ***Local*tax*code***************************************************S01176
     C***********          MOVEL@PTLTC    @STLTC                          S01176
     C***********          MOVEL@STLTC    @OTLTC  2                       S01176
      ***********                                                         S01176
      ***Local*tax*amount*************************************************S01176
     C***********          Z-ADD0         ZFLD15                          S01176
     C***********          MOVE WTLTA     ZFLD15                          S01176
     C***********          Z-ADD@NCDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @STLTA                          S01176
      *                                                                   S01176
      ***  Charge Code 4                                                  S01176
     C                     MOVE @PTCC4    @STCC4                          S01176
      *                                                                   064999
      *  Correct set up of charge codes                                   064999
      *                                                                   064999
     C                     MOVEL@STCC4    @OTCC4  2                       064999
      *                                                                   S01176
      ***  Charge Amount 4                                                S01176
     C           @PTCC4    IFNE *BLANKS                                   S01176
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE WTCA4     ZFLD15                          S01176
     C                     Z-ADD@NCDP     ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @STCA4                          S01176
     C                     MOVE ZOUT21    @OTCA4                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Charge Code 5                                                  S01176
     C                     MOVE @PTCC5    @STCC5                          S01176
      *                                                                   064999
      *  Correct set up of charge codes                                   064999
      *                                                                   064999
     C                     MOVEL@STCC5    @OTCC5  2                       064999
      *                                                                   S01176
      ***  Charge Amount 5                                                S01176
     C           @PTCC5    IFNE *BLANKS                                   S01176
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE WTCA5     ZFLD15                          S01176
     C                     Z-ADD@NCDP     ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @STCA5                          S01176
     C                     MOVE ZOUT21    @OTCA5                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Charge Code 6                                                  S01176
     C                     MOVE @PTCC6    @STCC6                          S01176
      *                                                                   064999
      *  Correct set up of charge codes                                   064999
      *                                                                   064999
     C                     MOVEL@STCC6    @OTCC6  2                       064999
      *                                                                   S01176
      ***  Charge Amount 6                                                S01176
     C           @PTCC6    IFNE *BLANKS                                   S01176
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE WTCA6     ZFLD15                          S01176
     C                     Z-ADD@NCDP     ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @STCA6                          S01176
     C                     MOVE ZOUT21    @OTCA6                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Charge Code 7                                                  S01176
     C                     MOVE @PTCC7    @STCC7                          S01176
      *                                                                   064999
      *  Correct set up of charge codes                                   064999
      *                                                                   064999
     C                     MOVEL@STCC7    @OTCC7  2                       064999
      *                                                                   S01176
      ***  Charge Amount 7                                                S01176
     C           @PTCC7    IFNE *BLANKS                                   S01176
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE WTCA7     ZFLD15                          S01176
     C                     Z-ADD@NCDP     ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @STCA7                          S01176
     C                     MOVE ZOUT21    @OTCA7                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Tax Amount                                                     S01176
     C           WTAXA     IFNE 0                                         S01176
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE WTAXA     ZFLD15                          S01176
     C                     Z-ADD@NCDP     ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @STAXA                          S01176
     C                     MOVE ZOUT21    @OTAXA                          S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   @STAXA                          S01176
     C                     MOVE *BLANKS   @OTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Broker Commission Rebate                                       S01176
     C           WBCMR     IFNE 0                                         S01176
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE WBCMR     ZFLD15                          S01176
     C                     Z-ADD@NCDP     ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @SBCMR                          S01176
     C                     MOVE ZOUT21    @OBCMR                          S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   @SBCMR                          S01176
     C                     MOVE *BLANKS   @OBCMR                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Customer Commission Rebate                                     S01176
     C           WCCMR     IFNE 0                                         S01176
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE WCCMR     ZFLD15                          S01176
     C                     Z-ADD@NCDP     ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @SCCMR                          S01176
     C                     MOVE ZOUT21    @OCCMR                          S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   @SCCMR                          S01176
     C                     MOVE *BLANKS   @OCCMR                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Tax Rebate                                                     S01176
     C           WTXRB     IFNE 0                                         S01176
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE WTXRB     ZFLD15                          S01176
     C                     Z-ADD@NCDP     ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @STXRB                          S01176
     C                     MOVE ZOUT21    @OTXRB                          S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   @STXRB                          S01176
     C                     MOVE *BLANKS   @OTXRB                          S01176
     C                     END                                            S01176
      *
      *  Protect non-display fields if Autocharging is not present
     C***********AUMO      IFNE 'Y'                                       S01117
     C           BVACOP    IFNE 'Y'                                       S01117
     C                     SETON                     41
     C** Otherwise format countervalue for screen output.                 065009
     C                     ELSE                                           065009
     C                     EXSR SUB508                                    065009
     C                     END
      *                                                                   CAC002
      **  If Autocharging not present but Analytical Acctg is installed,  CAC002
      **  format countervalue for screen output.                          CAC002
      *                                                                   CAC002
     C           BVACOP    IFNE 'Y'                                       CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C                     EXSR SUB508                                    CAC002
     C                     ENDIF                                          CAC002
      *
      * Originating Branch
      *
     C                     MOVEL@PORBR    @SORBR
      *
      * Profit Centre
      *
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C                     MOVEL@PPRFC    @SPRFC
     C                     ENDIF                                          CAC002
     C** Portfolio Reference                                              S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   145464
     C*  Set portfolio reference if portfolio customer                    145464
     C           WLPCUS    IFEQ 'Y'                                       145464
     C           WPBCUS    OREQ 'Y'                                       CPB001
     C           @PTCNR    SETLLPMPORTLL                                  145464
     C           @PTCNR    READEPMPORTLL                 01               145464
     C           *IN01     IFEQ '0'                                       145464
     C                     MOVE PNPTFR    SPTFR                           145464
     C                     MOVE PNPTFR    @PPTFR                          145464
     C                     ELSE                                           145464
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVE '9997'    @PPTFR                          145464
     C                     ENDIF                                          CPB001
     C                     END                                            145464
     C                     END                                            145464
     C*                                                                   S01486
     C           @PPTFR    IFEQ '9997'                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCR997    SPTFR                           S01486
     C                     ELSE                                           S01486
     C                     MOVE @PPTFR    SPTFR                           S01486
     C                     END                                            S01486
     C                     MOVE *ALL'@'   @SAVPR  4        DUMMY VAL SAVEDS01486
     C*                                                                   S01486
     C** FX Rate                                                          S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C           @PSPXR    IFNE *ZEROS                                    S01486
     C                     MOVE *BLANKS   ZFLD15                          S01486
     C                     MOVE @PSPXR    ZFLD15                          S01486
     C                     Z-ADD8         ZDECS                           S01486
     C                     MOVE *BLANK    ZECODE                          S01486
     C                     EXSR ZSEDIT                                    S01486
     C                     MOVE ZOUT21    SSPXR                           S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANKS   SSPXR                           S01486
     C                     END                                            S01486
     C                     MOVE *ALL'@'   @SAVXR 14        DUMMY VAL SAVEDS01486
     C*                                                                   S01486
     C** Multiply/Divide Indicator                                        S01486
     C*                                                                   S01486
     C                     MOVE @PSPMD    SSPMD                           S01486
     C                     MOVE '@'       @SAVMD  1        DUMMY VAL SAVEDS01486
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C                     END                                            S01486
      *                                                                   CAC002
      **  If Analytical Accounting is installed and nominal currency      CAC002
      **  is different from settlement currency, display Margin Points    CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           NMCYA     ANDNE@SSETC                                    CAC002
     C                     MOVE *ON       *IN39                           CAC002
     C                     MOVE *BLANKS   SFXMP                           CAC002
     C                     MOVE *BLANKS   SMAMT                           CAC002
      *                                                                   CAC002
      **  Format FX Margin Points and Amount                              CAC002
      *                                                                   CAC002
     C                     MOVE *BLANKS   ZFIELD                          CAC002
     C                     MOVE @PFXMP    ZFIELD                          CAC002
     C                     Z-ADD2         ZADEC                           CAC002
     C                     EXSR ZEDIT                                     CAC002
     C                     MOVE ZFIELD    SFXMP                           CAC002
      *                                                                   CAC002
      ** find currency decimal places of settlment ccy                    CAC002
     C           @SCDP     IFEQ 0                                         CAC002
     C                     MOVE @SSETC    @AJCD                           CAC002
     C                     MOVE '*DBERR ' @RTCD                           CAC002
     C                     EXSR AOCURR                                    CAC002
     C                     Z-ADDA6NBDP    @SCDP                           CAC002
     C                     END                                            CAC002
      *                                                                   CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE @PMAMT    ZFLD15                          CAC002
     C                     Z-ADD@SCDP     ZDECS                           CAC002
     C                     MOVE 'J'       ZECODE                          CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE ZOUT20    SMAMT                           CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *OFF      *IN39                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   189392
      ** Set up Withholding Tax field if withholding tax not equal 0      189392
      *                                                                   189392
     C           @PWHTX    IFNE 0                                         189392
     C                     MOVE *BLANKS   ZFLD15                          189392
     C                     MOVE @PWHTX    ZFLD15                          189392
     C                     Z-ADD@NCDP     ZDECS                           189392
     C                     MOVE 'J'       ZECODE                          189392
     C                     EXSR ZSEDIT                                    189392
     C                     MOVE ZOUT21    @SWHTX                          189392
     C                     ENDIF                                          189392
      *                                                                                       234440
      ** Set up EU Tax amouont                                                                234440
      *                                                                                       234440
     C           CGL031    IFEQ 'Y'                                                           234440
     C           @PTDTP    ANDEQ'TP'                                                          234440
     C           @WC1DI    IFEQ 'S'                                                           234440
     C           @WC1DI    OREQ 'D'                                                           234440
     C                     MOVE *BLANKS   ZFLD15                                              234440
     C                     MOVE @PEUTX    ZFLD15                                              234440
     C                     Z-ADD@NCDP     ZDECS                                               234440
     C                     MOVE 'J'       ZECODE                                              234440
     C                     EXSR ZSEDIT                                                        234440
     C                     MOVE ZOUT21    @SEUTX                                              234440
     C                     ELSE                                                               234440
     C                     MOVE *BLANKS   @SEUTX                                              234440
     C                     Z-ADD0         @PEUTX                                              234440
     C                     ENDIF                                                              234440
     C                     ELSE                                                               234440
     C                     MOVE *BLANKS   @SEUTX                                              234440
     C                     Z-ADD0         @PEUTX                                              234440
     C                     ENDIF                                                              234440
      *
     C                     ENDSR                           SUB104 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *  SUB201 - Validate screen 1                                   *
      *****************************************************************
      *
     C           SUB201    BEGSR
      *
      * Incomplete indicator
      *    .. if amended, must be I or C
     C           @SINCS    IFNE @OINCS
      *
     C           @SINCS    IFNE 'I'
     C           @SINCS    ANDNE'C'
     C                     SETON                     11  51
     C                     MOVEL' 108'    @EA,E
     C                     ADD  1         E
     C                     ELSE
      *
      *    .. cannot be C if value on PF/SECTYD is I
     C           @SINCS    IFEQ 'C'
     C           INCS      ANDEQ'I'
     C                     SETON                     11  51
     C                     MOVEL' 109'    @EA,E
     C                     ADD  1         E
     C                     END
     C                     END
     C                     END
      *
     C**   .. cannot be 'C', if Issuer of Security not entered            081490
     C*                                                                   081490
     C           S01496    IFEQ 'Y'                                       081490
     C           @SINCS    IFEQ 'C'                                       081490
     C                     MOVE ISSR      WWISSR  6                       081490
     C***********          CALL 'AOSECSR0'                          081490102952
     C***********          PARM           @RTCD   7                 081490102952
     C***********          PARM '*KEY   ' @OPTN   7                 081490102952
     C***********          PARM WWISSR    @SCKY   6                 081490102952
     C***********SDSECS    PARM SDSECS    DSSDY                     081490102952
     C***********@RTCD     IFNE *BLANKS                             081490102952
     C           WWISSR    IFEQ *BLANKS                                   102952
     C                     MOVEL' 126'    @EA,E                           081490
     C                     SETON                     11  51               081490
     C                     ADD  1         E                               081490
     C                     END                                            081490
     C                     END                                            081490
     C                     END                                            081490
      *                                                                   081490
     C                     MOVEL@SINCS    @PTINC
      *                                                                   CSE023
      ** If CSE023 is installed, check if will need to compute for        CSE023
      ** the withholding tax                                              CSE023
      *                                                                   CSE023
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           BFCLAS    ANDEQ'S'                                       CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           BFCLAS    ANDEQ'D'                                       CSE023
     C                     MOVE *BLANKS   WCTAX   1                       CSE023
     C                     MOVE *BLANKS   @SWHTX                          CSE023
     C                     Z-ADD0         @PWHTX                          187727
     C                     MOVE *BLANKS   @PBWDI                          187727
      *                                                                   CSE023
      ** If country of tax treaty is not blank, chaind to SDWTCSL0        CSE023
      ** to obtain backup withholding applicable field                    CSE023
      *                                                                   CSE023
     C           CRTT      IFNE *BLANKS                                   CSE023
     C                     MOVE CRTT      KCRTT                           CSE023
     C                     MOVE @PTCNR    KCNO                            CSE023
     C           KWTCS     CHAIN@WTCSL1              71                   CSE023
      *                                                                   CSE023
      ** If backup withholding is 'Y' or record not found, issue          CSE023
      ** warning message                                                  CSE023
      *                                                                   CSE023
     C           *IN71     IFEQ *ON                                       CSE023
     C           WHBCWA    OREQ 'Y'                                       CSE023
      *                                                                   CSE023
      ** For Trade Purchase (TP)                                          CSE023
      *                                                                   CSE023
     C           @PTDTP    IFEQ 'TP'                                      CSE023
     C                     MOVE 'Y'       WCTAX                           CSE023
     C                     MOVE ' W31'    @EA,E                           CSE023
     C                     ADD  1         E                               CSE023
     C                     MOVE *ON       *IN11                           CSE023
      *                                                                   CSE023
      ** Chain to SDWHTTL5 to get the tax rate                            CSE023
      *                                                                   CSE023
     C                     MOVE SITP      KINVT                           CSE023
     C           KWHTT     CHAIN@WHTTL5              71                   CSE023
     C           *IN71     IFEQ *ON                                       CSE023
     C                     MOVE *BLANKS   KINVT                           CSE023
     C           KWHTT     CHAIN@WHTTL5              71                   CSE023
     C           *IN71     IFEQ *ON                                       CSE023
     C                     MOVELKCRTT     WKEY1   5                       CSE023
     C                     MOVE KINVT     WKEY1                           CSE023
     C                     Z-ADD46        @DBASE                          CSE023
     C                     MOVEL'SDWHTTPD'@DBFIL                          CSE023
     C                     MOVELWKEY1     @DBKEY                          CSE023
     C                     EXSR *PSSR                                     CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ELSE                                           CSE023
      *                                                                   CSE023
      ** For Trade Sale                                                   CSE023
      *                                                                   CSE023
     C                     MOVE ' W32'    @EA,E                           CSE023
     C                     ADD  1         E                               CSE023
     C                     MOVE *ON       *IN11                           CSE023
      *                                                                   CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
      ** For TS, if country of tax treaty doew not exist on SDWTCSL0      CSE023
      ** or documentation received field is 'N', issue warning message    CSE023
      *                                                                   CSE023
     C           *IN71     IFEQ *ON                                       CSE023
     C           @PTDTP    ANDEQ'TS'                                      CSE023
     C           @PTDTP    OREQ 'TS'                                      CSE023
     C           WHDCRC    ANDEQ'N'                                       CSE023
     C                     MOVE ' W33'    @EA,E                           CSE023
     C                     ADD  1         E                               CSE023
     C                     MOVE *ON       *IN11                           CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *
      * Value Date
      * ...check for numeric field
     C                     MOVEL@STDVD    @WK7N   70
     C                     MOVEL@WK7N     @WK6A   6
     C           @STDVD    IFNE @WK6A
     C           @STDVD    ANDNE*BLANKS
     C                     SETON                     99
     C                     ELSE
      *
     C                     MOVE @STDVD    ZDATE
     C                     EXSR ZDATE1
     C                     END
      *
     C           *IN99     IFEQ '0'
     C                     Z-ADDZDAYNO    @PTDVD
     C                     ELSE
     C                     Z-ADDZDAYNO    @PTDVD
     C                     END
      *
      *    .. if amended, must be a valid date
     C           @STDVD    IFNE @OTDVD
     C           *IN99     IFEQ '1'
     C                     MOVE ' 116'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  52
     C                     ELSE
      *
      *    .. if amended must not be after maturity date or before
      *                                issue date of the security
     C           MATY      IFNE *ZEROS
     C           @PTDVD    ANDGTMATY
     C           @PTDVD    ORLT ISSD
     C                     MOVE ' 117'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  52
     C                     END
      *
      *    .. if amended and less than run date, must fall within back
      *                                     value period on TABTB36
     C***********RUND      SUB  BKVP      @WBKVP  50                      S01117
     C           RUND      SUB  BVBVP     @WBKVP  50                      S01117
     C           @PTDVD    IFLT RUND
     C           @PTDVD    ANDLT@WBKVP
     C                     MOVE ' 118'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  52
     C                     ELSE
      *
      *    .. if amended and security is partly paid, must be later
      *                              than the most recent call date
     C           PPDI      IFEQ 'Y'
     C           @PTDVD    ANDLESLCA
     C                     MOVE ' 118'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  52
     C                     END
     C                     END
      *
      *    .. if amended and Clearance Type '1' or '2', must not be
      *                              holiday in Euroclear currency
     C           @STDVD    IFNE @WTDVD
     C                     MOVE @STDVD    @WTDVD  6
     C           @SCLTY    IFEQ '1'
     C           @SCLTY    OREQ '2'
     C           CLTY      OREQ '1'
     C           @SCLTY    ANDNE'0'
     C           @SCLTY    ANDNE'3'
     C           @SCLTY    ANDNE'4'
     C           @SCLTY    ANDNE'5'
     C           CLTY      OREQ '2'
     C           @SCLTY    ANDNE'0'
     C           @SCLTY    ANDNE'3'
     C           @SCLTY    ANDNE'4'
     C           @SCLTY    ANDNE'5'
     C                     Z-ADD@PTDVD    ZDAYNO
     C***********          MOVE ECYC      ZCCY                            S01117
     C                     MOVE BVEUCY    ZCCY                            S01117
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C***********          EXSR ZDATE5                                    S01195
     C************IN99     IFEQ '1'                                       S01195
     C                     MOVE ' W02'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  52
     C                     END
     C                     END
      *
      *    .. if amended and Clearance Type '3' or '4', must not be
      *                                 holiday in Cedel currency
     C           @SCLTY    IFEQ '3'
     C           @SCLTY    OREQ '4'
     C           CLTY      OREQ '3'
     C           @SCLTY    ANDNE'0'
     C           @SCLTY    ANDNE'1'
     C           @SCLTY    ANDNE'2'
     C           @SCLTY    ANDNE'5'
     C           CLTY      OREQ '4'
     C           @SCLTY    ANDNE'0'
     C           @SCLTY    ANDNE'1'
     C           @SCLTY    ANDNE'2'
     C           @SCLTY    ANDNE'5'
     C                     Z-ADD@PTDVD    ZDAYNO
     C***********          MOVE CCYC      ZCCY                            S01117
     C                     MOVE BVCCCY    ZCCY                            S01117
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C***********          EXSR ZDATE5                                    S01195
     C************IN99     IFEQ '1'                                       S01195
     C                     MOVE ' W03'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  52
     C                     END
     C                     END
      *
      *    .. if amended and Clearance Type '2','4' or '5', must not
      *                           be holiday in settlement currency
     C           @SCLTY    IFEQ '2'
     C           @SCLTY    OREQ '4'
     C           @SCLTY    OREQ '5'
     C           CLTY      OREQ '2'
     C           @SCLTY    ANDNE'0'
     C           @SCLTY    ANDNE'1'
     C           @SCLTY    ANDNE'3'
     C           CLTY      OREQ '4'
     C           @SCLTY    ANDNE'0'
     C           @SCLTY    ANDNE'1'
     C           @SCLTY    ANDNE'3'
     C           CLTY      OREQ '5'
     C           @SCLTY    ANDNE'0'
     C           @SCLTY    ANDNE'1'
     C           @SCLTY    ANDNE'3'
     C                     Z-ADD@PTDVD    ZDAYNO
     C           @SSETC    IFNE *BLANKS
     C                     MOVE @SSETC    ZCCY
     C                     ELSE
     C***********          MOVE C1SC      ZCCY                            S01117
     C                     MOVE BFCYCD    ZCCY                            S01117
     C                     END
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C***********          EXSR ZDATE5                                    S01195
     C************IN99     IFEQ '1'                                       S01195
     C                     MOVE ' W04'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  52
     C                     END
     C                     END
      *
      **   .. if amended must not be a holiday in value currency
      **      if S01509 on, must not be holiday in nominal currency       S01509
      *                                                                   S01509
     C                     Z-ADD@PTDVD    ZDAYNO
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE NMCYA     ZCCY                            S01509
     C                     ELSE                                           S01509
     C                     MOVE VLCY      ZCCY
     C                     END                                            S01509
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C***********          EXSR ZDATE5                                    S01195
     C************IN99     IFEQ '1'                                       S01195
     C                     MOVE ' W05'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  52
     C                     ELSE
      *
      *****..*if*amended*must*not*be*a*holiday*in*payment*currency***     065524
     C***********          Z-ADD@PTDVD    ZDAYNO                          065524
     C***********          MOVE SPYC      ZCCY                            065524
     C***********          MOVE *BLANKS   ZLOC                     S01195 065524
     C***********          EXSR ZCHKH                              S01195 065524
     C***********ZIND      IFEQ 'H'                                S01195 065524
     C***********          EXSR ZDATE5                                    S01195
     C************IN99     IFEQ '1'                                       S01195
     C***********          MOVE ' W05'    @EA,E                           065524
     C***********          ADD  1         E                               065524
     C***********          SETON                     11  52               065524
     C***********          END                                            065524
     C                     END
     C                     END
     C                     END
     C                     END
     C*                                                                   E21056
     C*    Update Event Control Date with Value Date                      E21056
     C                     Z-ADD@PTDVD    ECD                             E21056
      *                                                                   E21056
      *    Refresh value date Coupon rate if valid value date             E21055
     C           *IN52     IFEQ '0'                                       E21055
     C                     MOVE *BLANKS   ZFLD15                          E21055
     C                     MOVE @PTDSS    SDSN                            E21055
     C                     MOVE 'IR'      SDET                            E21055
     C                     Z-ADD@PTDVD    SDED                            E21055
     C           @KEY8     SETLLSEDEVDO                                   E21055
     C                     READ SEDEVDO                  01               E21055
     C           *IN01     IFEQ '0'                                       E21055
     C           SDSN      ANDEQSESN                                      E21055
     C           SDET      ANDEQ'IR'                                      E21055
     C                     Z-ADDSDNC      @PTDCR                          E21055
     C                     MOVE SDNC      ZFLD15                          E21055
     C                     ELSE                                           E21055
     C                     Z-ADDCPNR      @PTDCR                          E21055
     C                     MOVE CPNR      ZFLD15                          E21055
     C                     END                                            E21055
     C                     Z-ADD7         ZDECS                           E21055
     C                     EXSR ZSEDIT                                    E21055
     C                     MOVE ZOUT20    @SCPNR                          E21055
     C                     END                                            E21055
      *
      **Branch*Code*************************************                  S01117
      ***********                                                         S01117
      *****..*if*amended,*must*reference*an*active*record*on*TABLETR******S01117
     C***********@SBRCD    IFNE @OBRCD                                    S01117
     C***********          MOVE @SBRCD    @KTBTR                          S01117
     C***********@KTBTR    CHAINTABLETRF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          MOVE ' 119'    @EA,E                           S01117
     C***********          ADD  1         E                               S01117
     C***********          SETON                     11  53               S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
      ***********                                                         S01117
     C***********          MOVEL@SBRCD    @PTDBR                          S01117
     C*                                                                   081490
     C           S01496    IFEQ 'Y'                                       081490
     C           CSE007    OREQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
     C           @WC1DI    IFEQ 'S'                                       081490
     C           @WC1DI    OREQ 'D'                                       081490
     C           CEU017    OREQ 'Y'                                       149517
     C*                                                                   081490
     C                     MOVE RUND      @PRDNB  5                       081490
     C                     MOVE @PTDBA    @PBRCD  3                       081490
     C                     MOVE @PTCNR    @PCNUM  6                       081490
     C                     MOVE 'Y'       @POBPO  1                       081490
     C           @PTDTP    IFEQ 'TP'                                      081490
     C                     MOVE 'P'       @PBLTY  1                       081490
     C                     ELSE                                           081490
     C                     MOVE 'S'       @PBLTY  1                       081490
     C                     ENDIF                                          081490
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      ***  or if Securities Redenomination feature is installed.          CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Search if there is Corporate Actions General Block for         CSE007
      ***  Security.                                                      CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6712                          CSE007
     C                     CALL 'SE7572'                                  CSE007
     C                     PARM           @PBRCD                          CSE007
     C                     PARM           @PTDSS                          CSE007
     C                     PARM           @PTCNR                          227267
     C                     PARM           @PPGB   1                       CSE007
     C                     PARM           @PSGB   1                       CSE007
      *                                                                   CSE007
      ***  If block found, send error message and setup work field to     CSE007
      ***  not call SE6712.                                               CSE007
      *                                                                   CSE007
     C           @PPGB     IFEQ 'Y'                                       CSE007
     C           @PTDTP    ANDEQ'TP'                                      CSE007
     C           @PSGB     OREQ 'Y'                                       CSE007
     C           @PTDTP    ANDEQ'TS'                                      CSE007
     C                     MOVE ' CO1'    @EA,E                           CSE007
     C                     ADD  1         E                               CSE007
     C                     SETON                     11                   CSE007
     C                     MOVE 'N'       SE6712                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is switched OFF or Corporate      CSE007
      ***  Actions General Block for Security not found.                  CSE007
      *                                                                   CSE007
     C           SE6712    IFEQ 'Y'                                       CSE007
     C*                                                                   081490
     C*    .. search if there is General Block for Security               081490
     C                     CALL 'SE6712'                                  081490
     C                     PARM           @PBRCD                          081490
     C                     PARM           @PTDSS                          081490
     C                     PARM           @PPGB   1                       081490
     C                     PARM           @PSGB   1                       081490
     C*                                                                   081490
     C           @PPGB     IFEQ 'Y'                                       081490
     C           @PTDTP    ANDEQ'TP'                                      081490
     C           @PSGB     OREQ 'Y'                                       081490
     C           @PTDTP    ANDEQ'TS'                                      081490
     C                     MOVE ' WR1'    @EA,E                           081490
     C                     ADD  1         E                               081490
     C                     SETON                     11                   081490
     C                     ENDIF                                          081490
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   081490
     C**  If PM not installed or Customer non portfolio (not found)       081490
     C                     CALL 'AOPLCSR0'                                081490
     C                     PARM *BLANKS   @RTCD                           081490
     C                     PARM '*KEY   ' @OPTN                           081490
     C                     PARM @PCNUM    @PLKY  10                       081490
     C           SDPLCS    PARM SDPLCS    DSFDY                           081490
     C************INU4     IFEQ '0'                                 081490081959
     C           BGPFMG    IFEQ 'N'                                       081959
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           @RTCD     ORNE *BLANKS                                   081490
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C           BBPRBA    ANDNE'Y'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C           @RTCD     ORNE *BLANKS                                   CPB001
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           BGPFMG    ORNE 'Y'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C           BBPRBA    ANDNE'Y'                                       CPB001
     C                     MOVE *BLANKS   @PPTFR  4                       081490
     C                     EXSR WBLOCK                                    081490
     C                     ENDIF                                          081490
     C*                                                                   081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
      *
      * Book
      *
      *****..*if*amended,*must*reference*an*active*record*on*BOOKDD*******S01117
     C***********@SBPBK    CHAINBOOKDDF              01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     EXSR AOBOOK                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
      *    .. if amended, must reference an active record on BOOKDD       S01117
     C                     MOVE ' 120'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  54
     C                     END
      *
     C                     MOVEL@SBPBK    @PTDBK
      *
      * Clearance type
      *
      *    .. if amended, must be in the range 0 - 5
     C           @SCLTY    IFNE @OCLTY
     C           @SCLTY    IFLT '0'
     C           @SCLTY    ORGT '5'
     C                     MOVE ' 121'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
     C                     END
     C                     END
      *
     C                     MOVEL@SCLTY    @PCLTY
      *
      * Settlement currency
      *
      *****..*if amended,*must*reference*an*active*record*on*TABTG10******S01117
      *    .. if amended, must reference an active record on SDCURRPD     S01117
     C           @SSETC    IFNE @OSETC
     C/COPY WNCPYSRC,SE3002C004
     C***********@SSETC    ANDNE*BLANKS                                   S01176
     C                     MOVEL@SSETC    @AJCD
     C***********@KTG10    CHAINTABTG10F             01
     C************IN01     IFEQ '1'
     C***********RECI      OREQ '*'
     C                     MOVE *BLANKS   @RTCD
     C                     EXSR AOCURR
     C           @RTCD     IFNE *BLANKS
     C                     MOVE ' 200'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  56
     C                     ELSE                                           S01176
     C                     MOVE @SSETC    @PSETC                          S01176
     C                     MOVEL@SSETC    @OSETC                          E21053
     C                     Z-ADDA6NBDP    @SCDP   10                      065009
     C                     END
     C***********          Z-ADDSPOT      @PTBCR                   S01176 S01117
     C***********          Z-ADDSPOT      @OTBCR                   S01176 S01117
     C                     Z-ADDA6SPRT    @PTBCR                          S01117
     C                     Z-ADDA6SPRT    @OTBCR                          S01117
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE @PTBCR    ZFLD15                          S01176
     C                     Z-ADD8         ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT20    @SBRTE                          S01176
     C*                                                                   CEU005
     C* EMU Settlement Ccy Conversion present -                           CEU005
     C* Settlement currency must be equal to nominal or Euro currency     CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           @PSETC    ANDNE*BLANKS                                   CEU005
     C           @PSETC    ANDNEBKEURO                                    CEU005
     C           @PSETC    ANDNENMCYA                                     CEU005
     C           MLTI      IFNE 'Y'                                       CEU005
     C           @WC1DI    ANDEQ'M'                                       CEU005
     C                     MOVE ' 225'    @EA,E                           CEU005
     C                     ADD  1         E                               CEU005
     C                     SETON                     11  56               CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C*                                                                   S01176
     C*    Initialize exchange rate and multipy/divide indicator          S01176
     C                     Z-ADD0         @PTDER                          S01176
     C                     MOVE *BLANKS   @PTMDI                          S01176
     C*                                                                   S01176
      * Determine new exchange rate                                       S01176
      **Exchange*rate*defaults*to*value*on*trade*details*if*settlement*176065524
      **currency*equals*payment*currency***********************    S01176 065524
     C***********@PSETC    IFEQ SPYC                       B002    S01176 065524
     C***********          Z-ADDSEXR      @PTDER                   S01176 065524
     C***********SMDI      IFEQ '0'                        B003    S01176 065524
     C***********SMDI      OREQ 'D'                                S01176 065524
     C***********          MOVEL'D'       @PTMDI                   S01176 065524
     C***********          ELSE                            X003    S01176 065524
     C***********          MOVEL'M'       @PTMDI                   S01176 065524
     C***********          END                             E003    S01176 065524
     C***********          END                             E002    S01176 065524
      *                                                                   S01176
      * Exchange rate defaults to 1 if settlement currency is nominal     S01176
      * currency                                                          S01176
     C           @PSETC    IFEQ @PTNMC                     B002           S01176
     C                     Z-ADD1         @PTDER                          S01176
     C                     MOVEL'M'       @PTMDI                          S01176
     C                     END                             E002           S01176
     C*                                                                   E21057
     C*    .. Settlement currency is not = Nominal currency               E21057
     C*       or payment currency - Calculate cross rate                  E21057
     C           @PSETC    IFNE *BLANKS                                   E21057
     C           @PSETC    ANDNE@PTNMC                                    E21057
     C***********@PSETC    ANDNESPYC                               E21057 065524
     C*                                                                                       191807
     C* CEU005 active, determine which currency is euro currency and                          191807
     C* which is 'IN' currency. Use appropriate Euro rate and M/D                             191807
     C* indicator.                                                                            191807
     C*                                                                                       191807
     C           CEU005    IFEQ 'Y'                                                           191807
     C           @PSETC    IFEQ BKEURO                                                        191807
     C                     MOVE @PTNMC    @AJCD                                               191807
     C                     MOVE '*DBERR ' @RTCD                                               191807
     C                     EXSR AOCURR                                                        191807
     C           A6INCY    IFEQ 'Y'                                                           191807
     C                     MOVE *BLANKS   ZFLD15                                              191807
     C                     MOVE A6EUER    ZFLD15                                              191807
     C                     Z-ADDA6EUER    @PTDER                                              191807
     C                     Z-ADD8         ZDECS                                               191807
     C                     MOVE *BLANK    ZECODE                                              191807
     C                     EXSR ZSEDIT                                                        191807
     C                     MOVE ZOUT21    @STDER                                              191807
     C                     MOVELA6EUMD    @PTMDI                                              191807
     C                     GOTO TAG01                                                         191807
     C                     ENDIF                                                              191807
     C                     ELSE                                                               191807
     C           NMCYA     IFEQ BKEURO                                                        191807
     C                     MOVE @PSETC    @AJCD                                               191807
     C                     MOVE '*DBERR ' @RTCD                                               191807
     C                     EXSR AOCURR                                                        191807
     C           A6INCY    IFEQ 'Y'                                                           191807
     C                     MOVE *BLANKS   ZFLD15                                              191807
     C                     MOVE A6EUER    ZFLD15                                              191807
     C                     Z-ADDA6EUER    @PTDER                                              191807
     C                     Z-ADD8         ZDECS                                               191807
     C                     MOVE *BLANK    ZECODE                                              191807
     C                     EXSR ZSEDIT                                                        191807
     C                     MOVE ZOUT21    @STDER                                              191807
     C           A6EUMD    IFEQ 'M'                                                           191807
     C                     MOVEL'D'       @PTMDI                                              191807
     C                     ELSE                                                               191807
     C                     MOVEL'M'       @PTMDI                                              191807
     C                     ENDIF                                                              191807
     C                     GOTO TAG01                                                         191807
     C                     ENDIF                                                              191807
     C                     ENDIF                                                              191807
     C                     ENDIF                                                              191807
     C                     ENDIF                                                              191807
     C                     MOVE @PTNMC    @AJCD                           S01117
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C                     Z-ADDA6SPRT    ZRATE1                          S01117
     C                     MOVE A6MDIN    ZMDI1                           S01117
     C***********          MOVE @PTNMC    @KCCY                    E21057 S01117
     C***********@KTG10    CHAINTABTG10F             01            E21057 S01117
     C***********          Z-ADDSPOT      ZRATE1                   E21057 S01117
     C***********MDIN      IFEQ 0                                  E21057 S01117
     C***********          MOVE 'D'       ZMDI1                    E21057 S01117
     C***********          ELSE                                    E21057 S01117
     C***********          MOVE 'M'       ZMDI1                    E21057 S01117
     C***********          END                                     E21057 S01117
     C                     MOVE @PSETC    @AJCD                           S01117
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C                     Z-ADDA6SPRT    ZRATE2                          S01117
     C                     MOVE A6MDIN    ZMDI2                           S01117
     C***********@KTG10    CHAINTABTG10F             01            E21057 S01117
     C***********          Z-ADDSPOT      ZRATE2                   E21057 S01117
     C***********MDIN      IFEQ 0                                  E21057 S01117
     C***********          MOVE 'D'       ZMDI2                    E21057 S01117
     C***********          ELSE                                    E21057 S01117
     C***********          MOVE 'M'       ZMDI2                    E21057 S01117
     C***********          END                                     E21057 S01117
     C/COPY WNCPYSRC,SE3002C005
     C                     EXSR ZXRATE                                    E21057
     C/COPY WNCPYSRC,SE3002C006
     C*
     C           @PSETC    IFEQ BKEURO                                    149982
     C           A6INCY    ANDEQ'Y'                                       149982
     C           @PTDVD    ANDGEA6TPSD                                    149982
     C           NMCYA     OREQ BKEURO                                    149982
     C           A6INCY    ANDEQ'Y'                                       149982
     C           @PTDVD    ANDGEA6TPSD                                    149982
     C                     Z-ADDA6EUER    @PTDER                          149982
     C                     ELSE                                           149982
     C                     Z-ADDZRATEX    @PTDER                          E21057
     C                     END                                            149982
     C                     MOVE ZMDIX     @PTMDI                          E21057
     C                     END                                            E21057
     C           TAG01     TAG                                                                191807
     C/COPY WNCPYSRC,SE3002C062
      *                                                                   S01176
      * If action is insert, and incomplete indicator is C, and           S01176
      * exchange rate is zero, then if client is safe custody or          S01176
      * discretionary or security is multicurrency and settlement         S01176
      * currency has changed, the set indicator to I and display          S01176
      * display on screen 2.                                              S01176
     C                     SETOF                     46                   S01176
      *                                                                   S01176
     C           @ACODE    IFEQ 'I'                        B002           S01176
     C           @PTINC    ANDEQ'C'                                       S01176
     C           @PTDER    ANDEQ0                                         S01176
      *                                                                   S01176
     C           @WC1DI    IFEQ 'S'                        B003           S01176
     C           @WC1DI    OREQ 'D'                                       S01176
     C                     SETON                     46                   S01176
     C                     END                             E003           S01176
      *                                                                   S01176
     C           MLTI      IFEQ 'Y'                        B003           S01176
     C           @SSETC    ANDNE@OSETC                                    S01176
     C                     SETON                     46                   S01176
     C                     END                             E003           S01176
      *                                                                   S01176
     C           *IN46     IFEQ '1'                        B003           S01176
     C                     MOVEL'I'       @PTINC                          S01176
     C                     MOVEL@PTINC    @SINCS                          S01176
     C                     END                             E003           S01176
      *                                                                   S01176
     C                     END                             E002           S01176
      *                                                                   S01176
      *  Format Exchange Rate                                             S01176
     C                     Z-ADD0         ZFLD15                          S01176
     C                     MOVE @PTDER    ZFLD15                          S01176
     C                     Z-ADD8         ZDECS                           S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT20    @STDER                          S01176
     C/COPY WNCPYSRC,SE3002C063
     C                     Z-ADD@PTDER    @OTDER 138                      S01176
     C                     MOVEL*BLANKS   @SAVER 14                       S01176
      *                                                                   S01176
      *  Format M/D indicator                                             S01176
     C                     MOVE @PTMDI    @SSMDI                          S01176
     C                     MOVEL@SSMDI    @OSMDI  1                       S01176
      *                                                                   S01176
     C                     END
      *
     C*********************MOVEL@SSETC    @PSETC                          E21053
     C*********************MOVEL@SSETC    @OSETC                   S01176 E21053
      *
      * Reallowance
     C           @SRALL    IFNE *BLANKS                                   E21115
     C           STBS      IFEQ 'Y'                                       E21115
     C                     MOVE ' 218'    @EA,E                           E21115
     C                     ADD  1         E                               E21115
     C                     SETON                     11  57               E21115
     C                     END                                            E21115
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVEL@SRALL    ZFLD17
     C                     Z-ADD4         ZSDIG
     C                     Z-ADD5         ZSDEC
     C                     EXSR ZASIGN
      *
      *    .. if entered, must be a valid amount
     C           *IN99     IFEQ '0'
     C                     MOVE ZOUT15    @PRALL
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUB@PRALL    @PRALL
     C                     END
     C                     Z-ADD0         ZFLD15
     C                     MOVE @PRALL    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @SRALL
     C                     ELSE
     C                     MOVE ' 201'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  57
     C                     END
     C                     END                                            E21115
      *
      * Market centre
      *
      *    .. if entered, must be a valid code
     C           @SMRKT    IFNE @OMRKT
     C           @SMRKT    ANDNE*BLANKS
     C           @SMRKT    CHAINSEMKCDF              01
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C                     MOVE ' 202'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  58
     C                     END
     C/COPY WNCPYSRC,SE3002C020
     C                     END
      *
     C                     MOVEL@SMRKT    @PTMKC
      *
      * Capacity
      *****..*if*entered,*must*be*in*the*range*1*-*7************          065303
     C*    .. if entered, must be in the range 0 - 6                      065303
     C/COPY WNCPYSRC,SE3002C056
     C           @SCPCY    IFNE @OCPCY
     C           @SCPCY    ANDNE*BLANKS
     C***********@SCPCY    IFLT '1'                                       065303
     C           @SCPCY    IFLT '0'                                       065303
     C           @SCPCY    ORGT '6'
     C                     MOVE ' 203'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  59
     C                     ELSE
     C           @PATRD    IFNE *BLANKS
     C           @SCPCY    ANDNE'3'
     C           @SCPCY    ANDNE'6'
     C           @SCPCY    ANDNE'0'                                       085546
     C                     MOVE ' 203'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  59
     C                     END
     C                     END
     C                     END
     C*                                                                   065303
     C*  Check Capacity against Trade Type                                065303
     C*                                                                   065303
     C           @PTDTP    IFEQ 'TP'                                      065303
     C           @SCPCY    ANDEQ'2'                                       065303
     C           @PTDTP    OREQ 'TP'                                      065303
     C           @SCPCY    ANDEQ'3'                                       065303
     C           @PTDTP    OREQ 'TS'                                      065303
     C           @SCPCY    ANDEQ'5'                                       065303
     C           @PTDTP    OREQ 'TS'                                      065303
     C           @SCPCY    ANDEQ'6'                                       065303
     C                     MOVE ' 222'    @EA,E                           065303
     C                     ADD  1         E                               065303
     C                     SETON                     11  59               065303
     C                     END                                            065303
     C/COPY WNCPYSRC,SE3002C057
      *
     C                     MOVEL@SCPCY    @PTCAP
      *
      * Price
     C           *IN43     IFEQ '1'
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE @SPRIC    ZFIELD
     C                     Z-ADD7         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C  N99                MOVE ZFIELD    @PPRIC                          S01176
     C*                                                                   S01176
     C*  If value date has changed then recalculate and redisplay         S01176
     C*      the price overwriting any manual amendments to it            S01176
     C           @STDVD    IFNE @DSCVD                                    S01176
     C                     EXSR ZNCD                                      S01176
     C                     Z-ADD@PTPDY    ZPRCIN                          S01176
     C                     Z-ADD@PTDVD    ZFDATE                          S01176
     C*                                                                   E39495
     C           @SACIN    IFEQ 'X'                                       E39495
     C                     MOVE 'X'       SCUMEX                          E39495
     C                     ELSE                                           E39495
     C                     MOVE 'C'       SCUMEX                          E39495
     C                     END                                            E39495
     C*                                                                   E39495
     C/COPY WNCPYSRC,SE3002C052
     C                     EXSR ZPRCI                                     S01176
      *                                                                                       CSE035
      ** ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE3002C029
     C                     MOVE ZPRCOT    @PPRIC                          S01176
     C                     SETOF                     99                   S01176
     C*                                                                   S01176
      *  Set on indicator to redisplay the 1st screen                     S01176
     C                     SETON                     06                   S01176
     C                     MOVE @STDVD    @DSCVD                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           *IN99     IFEQ '0'
     C*********************MOVE ZFIELD    @PPRIC                          S01176
     C                     Z-ADD0         ZFLD15
     C                     MOVE @PPRIC    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @SPRIC
     C                     ELSE
     C                     MOVE ' 204'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  60
     C                     END
     C                     END
      *                                                                   S01176
      ***  If the Trade Basis is Yield or Discount,                       S01176
      ***  then the Price field is used in calculations, else the         S01176
      ***  Price/Dsicount/Yield is used                                   S01176
      *                                                                   S01176
     C           *IN43     IFEQ '1'                                       S01176
     C                     Z-ADD@PPRIC    ZPRICE                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTPDY    ZPRICE                          S01176
     C                     END                                            S01176
      *
      **Ex*dividend***                                                    065019
     C************IN44     IFEQ '1'                                       065019
     C***********@SEXDV    ANDNE@OEXDV                                    065019
     C***********@SEXDV    ANDNE'C'                                       065019
     C***********@SEXDV    ANDNE'X'                                       065019
     C***********          MOVE ' 205'    @EA,E                           065019
     C***********          ADD  1         E                               065019
     C***********          SETON                     11  70               065019
     C***********          END                                            065019
     C***********          MOVEL@SEXDV    @PEXDV                          065019
      *
     C                     MOVEL@STDID    @PTDID
      *
      * Trade date
      *
      *    .. must be a numeric field
     C                     MOVEL@STDDT    @WK7N
     C                     MOVEL@WK7N     @WK6A
     C           @STDDT    IFNE @WK6A
     C           @STDDT    ANDNE*BLANKS
     C                     SETON                     99
     C                     ELSE
      *
      *    .. if amended, must be a valid date
     C                     MOVE @STDDT    ZDATE
     C                     EXSR ZDATE1
     C                     END
     C           *IN99     IFEQ '0'
     C                     Z-ADDZDAYNO    @PTDDT
     C                     ELSE
     C                     Z-ADD0         @PTDDT
     C                     END
      *
     C           @STDDT    IFNE @OTDDT
     C           *IN99     IFEQ '1'
     C                     MOVE ' 209'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     ELSE
      *
      *    .. if amended, must not be greater than run date
     C           @PTDDT    IFGT RUND
     C                     MOVE ' 206'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
      *
      *    .. if amended, must not be greater than value date
     C           @PTDDT    IFGT @PTDVD
     C                     MOVE ' 207'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
      *
      *    .. if amended, must not be earlier than back value period
     C***********RUND      SUB  BKVP      @WBKVP                          S01117
     C           RUND      SUB  BVBVP     @WBKVP                          S01117
     C           @PTDDT    IFLT @WBKVP
     C                     MOVE ' 208'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
      *
      *    .. if amended, must not be a holiday in local currency
     C********** @STDDT    IFNE @WTDDT
     C                     MOVE @STDDT    @WTDDT  6
     C                     Z-ADD@PTDDT    ZDAYNO
     C***********          MOVE LOCY      ZCCY                            S01117
     C                     MOVE BJLCCY    ZCCY                            S01117
     C                     MOVE A8LCCD    ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C***********          EXSR ZDATE5                                    S01195
     C************IN99     IFEQ '1'                                       S01195
     C                     MOVE ' W08'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
     C***********          END
     C                     END
     C                     END
     C*
     C*
     C*    ..  if Value Date changed check whether Trade Date
     C*                                 to be changed
     C*
     C           @STDVD    IFNE @OTDVD
     C********** RUND      IFLE @PTDVD                                    032429
     C**********           Z-ADDRUND      ZDAYNO                          032429
     C**********           ELSE                                           032429
     C**********           Z-ADD@PTDVD    ZDAYNO                          032429
     C**********           END                                            032429
     C**********           EXSR ZDATE2                                    032429
     C**********           MOVELZDATE     @STDDT                          032429
     C**********           Z-ADDZDAYNO    @PTDDT                          032429
     C           @PTDVD    ANDLT@PTDDT                                    032429
     C           *IN61     ANDEQ'0'                                       032429
     C                     MOVEL@STDVD    @STDDT                          032429
     C                     Z-ADD@PTDVD    @PTDDT                          032429
     C                     MOVEL@STDDT    @OTDDT                          032429
     C                     END
      *                                                                   065019
      * Ex dividend                                                       065019
     C           *IN44     IFEQ '1'                                       065019
      * If trade date amended, and ExD indicator not amended, recalculate.065019
     C           @SEXDV    IFEQ @OEXDV                                    065019
     C           @STDDT    IFNE @OTDDT                                    065019
     C                     EXSR SUB509                                    065019
     C                     MOVEL@PEXDV    @SEXDV                          065019
     C                     END                                            065019
      * Otherwise, if indicator has been amended, must be 'C' or 'X'.     065019
     C                     ELSE                                           065019
     C           @SEXDV    IFNE 'C'                                       065019
     C           @SEXDV    ANDNE'X'                                       065019
     C                     MOVE ' 205'    @EA,E                           065019
     C                     ADD  1         E                               065019
     C                     SETON                     11  70               065019
     C                     END                                            065019
     C                     END                                            065019
     C                     END                                            065019
     C                     MOVEL@SEXDV    @PEXDV                          065019
      *                                                                                       233607
      ** Fiscal Price                                                                         233607
      *                                                                                       233607
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     EXSR SRVFSP                                                        233607
     C                     ENDIF                                                              233607
      *
      * Trade sub-type
      *
      *****..*if*amended,*must*be*a*valid*code*on*TABLET5*****************S01117
      *    .. if amended, must be a valid code on SDDLSTPD                S01117
     C           @STSUB    IFNE @OTSUB
     C***********          MOVE @STSUB    @KTBT5                          S01117
     C***********@KTBT5    CHAINTABLET5F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     EXSR AODLST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 210'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  62
     C                     END
     C                     END
      *
     C                     MOVEL@STSUB    @PTSUB
     C                     MOVEL@SLKRF    @PLKRF
      *
      * Market indicator
      *
      *    .. if amended, may be changed from 'G' to 'P' or 'S'
     C           @STDMI    IFNE @OTDMI
     C           @OTDMI    IFEQ 'G'
     C           @STDMI    ANDNE'P'
     C           @STDMI    ANDNE'S'
     C                     MOVE ' 211'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  63
     C                     END
      *
      *    .. if amended, may be changed from 'P' to 'S'
     C           @OTDMI    IFEQ 'P'
     C           @STDMI    ANDNE'S'
     C           @OTDMI    OREQ 'S'
     C                     MOVE ' 211'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  63
     C                     END
     C                     END
      *
     C                     MOVEL@STDMI    @PTDMI
      *
      **AIBD/IPMA******************************************************   E43208
      * ISMA/IPMA                                                         E43208
      *
      *    .. if amended, must be 'Y' or 'N'
     C           @SAIIP    IFNE @OAIIP
     C           @SAIIP    ANDNE'Y'
     C           @SAIIP    ANDNE'N'
     C                     MOVE ' 212'    @EA,E
     C                     ADD  1         E
     C***********          SETON                     11  63               E21058
     C                     SETON                     11  64               E21058
     C                     END
      *
     C                     MOVEL@SAIIP    @PAIIP
     C                     MOVEL@STDNR    @PTDNR
     C/COPY WNCPYSRC,SE3002C055
      *
      ***  If the processing type is 1, 3, 5, 6, 8 or 9                   S01176
      ***  and the Trade Basis is 'P' or 'Y'                              S01176
      *
     C           *IN42     IFEQ '1'
     C/COPY WNCPYSRC,SE3002C030
      *                                                                                       CSE035
      * Accrued indicator                                                                     CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
      *    .. if amended, must be 'C' 'F' or 'X'                                              CSE035
     C           @SACIN    IFNE @OACIN                                                        CSE035
     C           @SACIN    ANDNE'C'                                                           CSE035
     C           @SACIN    ANDNE'F'                                                           CSE035
     C           @SACIN    ANDNE'X'                                                           CSE035
     C           @SACIN    ANDNE'N'                                                           CSE035
     C           @SACIN    ANDNE'D'                                                           CSE035
     C                     MOVE ' 213'    @EA,E                                               CSE035
     C                     ADD  1         E                                                   CSE035
     C                     SETON                     11  65                                   CSE035
      *                                                                                       CSE035
      * Reset if value date changed                                                           CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C                     Z-ADDECD       SECD    50                                          CSE035
     C                     Z-ADDNCDD5     SNCDD5  50                                          CSE035
     C                     Z-ADDLCDD5     SLCDD5  50                                          CSE035
     C                     Z-ADD@PTDVD    ECD                                                 CSE035
      *                                                                                       CSE035
      ** Call ZLCD + ZNCD to determine next and last coupon dates                             CSE035
      *                                                                                       CSE035
     C                     Z-ADDNCD       @NCD    50                                          CSE035
     C                     EXSR ZNCD                                                          CSE035
     C                     Z-ADDNCD       NCDD5   50                                          CSE035
     C                     Z-ADD@NCD      NCD                                                 CSE035
     C                     Z-ADDZZLCD     @LCD    50                                          CSE035
     C           NCDD5     SUB  1         ZECD                                                CSE035
     C                     EXSR ZLCD                                                          CSE035
     C                     Z-ADDZZLCD     LCDD5   50                                          CSE035
     C                     Z-ADD@LCD      ZZLCD                                               CSE035
     C*                                                                                       CSE035
      *                                                                                       CSE035
      ** If TDVD is less than the FCPN, get the Last Coupon from the                          CSE035
      ** coupon array.                                                                        CSE035
      *                                                                                       CSE035
     C           TDVD      IFLT FCPN                                                          CSE035
     C                     EXSR ZLCD1                                                         CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     Z-ADDSECD      ECD                                                 CSE035
     C           @PTDVD    IFLT FCPN                                                          CSE035
     C           PROT      ANDEQ'1'                                                           CSE035
     C           ITLD      IFGE ZZLCD1                                                        CSE035
     C           NCDD5     IFNE FCPN                                                          CSE035
     C                     MOVE 'D'       @SACIN                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
      ** If Initial date coincides with the regular coupon date, it                           CSE035
      ** should be CUM.                                                                       CSE035
      *                                                                                       CSE035
     C           ITLD      IFEQ ZZLCD1                                                        CSE035
     C           NCDD5     ANDEQFCPN                                                          CSE035
     C                     MOVE 'C'       @SACIN                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
      ** If not, it should be 'NX'.                                                           CSE035
      *                                                                                       CSE035
     C                     MOVE 'N'       @SACIN                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'D'       @SACIN                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           @STDVD    IFNE @OTDVD                                                        CSE035
     C                     MOVEL'C'       @SACIN                                              CSE035
     C                     EXSR ZNCD                                                          CSE035
     C           @PTDVD    IFEQ NCD                                                           CSE035
     C                     MOVEL'F'       @SACIN                                              CSE035
     C                     ELSE                                                               CSE035
     C                     MOVELEDFT      ZNRDYS                                              CSE035
     C           ZNRDYS    IFNE 0                                                             CSE035
     C                     MOVE EDFT      @WEDFT                                              CSE035
     C           @WEDFT    IFEQ 'W'                                                           CSE035
     C                     Z-ADDNCD       ZDAYNO                                              CSE035
     C                     MOVE NMCYA     ZCCY                                                CSE035
     C                     MOVE *BLANKS   ZLOC                                                CSE035
     C                     EXSR ZBKDT                                                         CSE035
     C                     ELSE                                                               CSE035
     C           NCD       SUB  ZNRDYS    ZDYNBR                                              CSE035
     C                     ENDIF                                                              CSE035
     C           @PTDVD    IFLT NCD                                                           CSE035
     C           @PTDVD    ANDGEZDYNBR                                                        CSE035
     C           NCD       ANDNEMATY                                                          CSE035
     C                     MOVEL'X'       @SACIN                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     Z-ADDSNCDD5    NCDD5                                               CSE035
     C                     Z-ADDSLCDD5    LCDD5                                               CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'N'                                                           CSE035
      *                                                                                       CSE035
      *
      * Accrued indicator
      *
      *    .. if amended, must be 'C' 'F' or 'X'
     C           @SACIN    IFNE @OACIN
     C           @SACIN    ANDNE'C'
     C           @SACIN    ANDNE'F'
     C           @SACIN    ANDNE'X'
     C                     MOVE ' 213'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  65
      *
      * Reset if value date changed
      * (but only if indicator has not been set by user on this cycle)    065024
     C                     ELSE
     C           @STDVD    IFNE @OTDVD
     C           @SACIN    ANDEQ@OACIN                                    065024
     C***********          MOVEL'C'       @PACIN                          064997
     C                     MOVEL'C'       @SACIN                          064997
     C/COPY WNCPYSRC,SE3002C016
     C                     EXSR ZNCD
     C           @PTDVD    IFEQ NCD
     C/COPY WNCPYSRC,SE3002C017
     C***********          MOVEL'F'       @PACIN                          064997
     C                     MOVEL'F'       @SACIN                          064997
     C                     ELSE
     C                     MOVELEDFT      ZNRDYS
     C           ZNRDYS    IFNE 0
     C                     MOVE EDFT      @WEDFT
     C           @WEDFT    IFEQ 'W'
     C                     Z-ADDNCD       ZDAYNO
     C                     MOVE NMCYA     ZCCY
     C                     MOVE *BLANKS   ZLOC                            S01195
     C***********          EXSR XDATE3                                    S01195
     C                     EXSR ZBKDT                                     S01195
     C                     ELSE
     C           NCD       SUB  ZNRDYS    ZDYNBR
     C                     END
     C           @PTDVD    IFLT NCD
     C           @PTDVD    ANDGEZDYNBR
     C***********          MOVEL'X'       @PACIN                          064997
     C                     MOVEL'X'       @SACIN                          064997
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE3002C031
      *
     C                     MOVEL@SACIN    @PACIN
      *
      * Days adjustment
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVEL@SDADJ    ZFLD17
     C                     Z-ADD3         ZSDIG
     C                     Z-ADD0         ZSDEC
     C                     EXSR ZASIGN
      *
     C           *IN99     IFEQ '0'
     C                     MOVE ZOUT15    @PDADJ
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUB@PDADJ    @PDADJ
     C                     END
     C                     Z-ADD@PDADJ    ZFLD15
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @SDADJ
     C                     ELSE
     C                     MOVE ' 214'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  66
     C                     END
      *
      * Actual/Difference indicator
      *
      *  This must always be 'A' or 'D' if days adj. is non-zero or       066814
      *  otherwise blank.                                                 066814
      * ***..*if*amended*must*be*'A'*or*'D'*(if*days*adj.*is*non-zero)*** 066814
     C*********  @SACTD    IFNE @OACTD                                    066814
     C*********  @SACTD    ANDNE'A'                                       066814
     C*********  @SACTD    ANDNE'D'                                       066814
     C*********  @PDADJ    ANDNE0                                         066814
     C*********  @SACTD    ORNE 'A'                                065302 066814
     C*********  @SACTD    ANDNE'D'                                065302 066814
     C*********  @SACTD    ANDNE' '                                065302 066814
     C           @PDADJ    IFEQ *ZERO                                     066814
     C           @SACTD    ANDNE*BLANKS                                   066814
     C           @PDADJ    ORNE *ZERO                                     066814
     C           @SACTD    ANDNE'D'                                       066814
     C           @SACTD    ANDNE'A'                                       066814
     C                     MOVE ' 215'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  67
     C                     END
      *
     C                     MOVEL@SACTD    @PADIN
      *
      * Coupon rate
     C                     MOVE *BLANKS   ZFLD15                          E21055
     C                     MOVE @PTDSS    SDSN                            E21055
     C                     MOVE 'IR'      SDET                            E21055
     C                     Z-ADD@PTDVD    SDED                            E21055
     C           @KEY8     SETLLSEDEVDO                                   E21055
     C                     READ SEDEVDO                  01               E21055
     C           *IN01     IFEQ '0'                                       E21055
     C           SDSN      ANDEQSESN                                      E21055
     C           SDET      ANDEQ'IR'                                      E21055
     C                     Z-ADDSDNC      @PTDCR                          E21055
     C                     MOVE SDNC      ZFLD15                          E21055
     C                     ELSE                                           E21055
     C                     Z-ADDCPNR      @PTDCR                          E21055
     C                     MOVE CPNR      ZFLD15                          E21055
     C                     END                                            E21055
     C                     Z-ADD7         ZDECS                           E21055
     C                     EXSR ZSEDIT                                    E21055
     C                     MOVE ZOUT20    @SCPNR                          E21055
     C*
     C**********           MOVE *BLANKS   ZFIELD                          S01176
     C**********           MOVE @SCPNR    ZFIELD                          S01176
     C**********           Z-ADD4         ZADIG                           S01176
     C**********           Z-ADD7         ZADEC                           S01176
     C**********           EXSR ZALIGN                                    S01176
     C********** *IN99     IFEQ '0'                                       S01176
     C**********           MOVE ZFIELD    @PTDCR                          S01176
     C**********           Z-ADD0         ZFLD15                          S01176
     C**********           MOVE @PTDCR    ZFLD15                          S01176
     C**********           Z-ADD7         ZDECS                           S01176
     C**********           EXSR ZSEDIT                                    S01176
     C**********           MOVE ZOUT20    @SCPNR                          S01176
     C**********           ELSE                                           S01176
     C**********           MOVE ' 219'    @EA,E                           S01176
     C**********           ADD  1         E                               S01176
     C**********           SETON                     11  69               S01176
     C**********           END                                            S01176
\     *                                                                   S01176
      * Interest amount
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVEL@SITRA    ZFLD17
     C           13        SUB  @NCDP     ZSDIG
     C                     Z-ADD@NCDP     ZSDEC
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '0'
     C                     MOVE ZOUT15    @PITRA
     C           ZFSIGN    IFEQ '-'
     C                     Z-SUB@PITRA    @PITRA
     C                     END
      *
     C*
     C*    .. if any interest calculation details have been amended,
     C*       and there are no errors, re-calculate interest & set
     C*       indicator for redisplay
     C*
     C           @PDADJ    IFNE @ODADJ
     C           @PACIN    ORNE @OACIN
     C           @PADIN    ORNE @OACTD
     C           @PTDCR    ORNE @OTDCR
     C           @STDVD    ORNE @OTDVD
      *
     C*
     C*     . if any interest details changed, Interest amount cannot
     C*                                      be entered manually
     C           @SITRA    IFNE @OITRA
     C           @SITRA    ANDNE*BLANKS
     C                     MOVEL@OITRA    @SITRA
     C                     MOVEL' 217'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  68
     C                     END
      *
      *
     C           *IN52     IFEQ '0'
     C           *IN65     ANDEQ'0'
     C           *IN66     ANDEQ'0'
     C           *IN67     ANDEQ'0'
     C           *IN68     ANDEQ'0'
     C           *IN69     ANDEQ'0'
      *
     C*********************EXSR SUB401                                    E21050
     C***********          Z-ADD@NCDP     CDP                      E21050 S01117
     C                     Z-ADD@NCDP     ZCDP                            S01117
     C                     Z-ADD@PNOML    NOML                            E21050
     C                     MOVE @PACIN    ZACIN                           E21050
     C                     MOVE @PDADJ    ZDADJ                           E21050
     C                     MOVE @PADIN    ZADIN                           E21050
     C                     Z-ADD@PTDCR    TDCR                            E21050
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCP7                                           S01408
     C*                                                                   S01408
     C                     EXSR ZPCINT                                    E21050
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCP8                                           S01408
     C*                                                                   S01408
     C                     MOVE ZITRA     @PITRA                          E21050
     C*
      *   Seton indicator to cause re-output of first screen
      *   to display the new calculated purchase interest
     C                     SETON                     06
      *
     C/COPY WNCPYSRC,SE3002C027
     C                     MOVE @PITRA    ORGIT
     C/COPY WNCPYSRC,SE3002C028
     C*                                                                   064997
     C*  Zeroise interest amount if accrual indicator is 'F'              064997
     C*                                                                   064997
     C           @PACIN    IFNE @OACIN                                    064997
     C           @PACIN    ANDEQ'F'                                       064997
     C                     Z-ADD0         @PITRA                          064997
     C                     END                                            064997
     C*
     C                     Z-ADD@PITRA    ZFLD15
     C                     Z-ADD@NCDP     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @SITRA
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
     C                     Z-ADD@NCDP     ZCDP                                                CAS006
     C                     Z-ADD@PNOML    NOML                                                CAS006
     C                     MOVE @PACIN    ZACIN                                               CAS006
     C                     MOVE @PDADJ    ZDADJ                                               CAS006
     C                     MOVE @PADIN    ZADIN                                               CAS006
     C                     Z-ADDWNTCR     TDCR                                                CAS006
      *                                                                                       CAS006
     C                     EXSR ZPCINT                                                        CAS006
      *                                                                                       CAS006
     C                     Z-ADDZITRA     @PITRN                                              CAS006
     C                     Z-ADDZITRA     WOITRN                                              CAS006
      *                                                                                       CAS006
      ** Zeroise interest amount if accrual indicator is 'F'                                  CAS006
      *                                                                                       CAS006
     C           @PACIN    IFNE @OACIN                                                        CAS006
     C           @PACIN    ANDEQ'F'                                                           CAS006
     C                     Z-ADD0         @PITRN                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE @PITRN    ZFLD15                                              CAS006
     C                     Z-ADD@NCDP     ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SITRN                                               CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
     C*
     C                     MOVE @SITRA    @OITRA
     C                     Z-ADD@PDADJ    @ODADJ
     C                     MOVE @PACIN    @OACIN
     C                     Z-ADD@PTDCR    @OTDCR
     C                     MOVE @STDVD    @OTDVD
     C                     MOVE @PADIN    @OACTD
      *
     C                     END
     C                     END
      *
     C*
     C* Set up interest Adjustment
     C           @PDADJ    IFNE 0
     C                     Z-ADDWPADJ     @PTINA
     C                     ELSE
     C           @PITRA    SUB  ORGIT     @PTINA
     C                     END
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
     C           @PDADJ    IFNE 0                                                             CAS006
     C                     Z-ADDWPADJ     @PTINN                                              CAS006
     C                     ELSE                                                               CAS006
     C           @PITRN    SUB  WOITRN    @PTINN                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
     C*
     C                     ELSE
     C                     MOVE ' 216'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  68
     C                     END
      *
     C                     END
      *                                                                   CAC002
      **  If Analytical Accounting is installed...                        CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
      **  Book Profit Centre                                              CAC002
      *                                                                   CAC005
      ** Validate Book profit centre only if CAC005 is off.               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'N'                                       CAC005
      *                                                                   CAC002
      **  If book and market indicator valid, get default from            CAC002
      **  current book position profit centre record                      CAC002
      *                                                                   CAC002
     C           *IN54     IFEQ '0'                                       CAC002
     C           *IN63     ANDEQ'0'                                       CAC002
      *                                                                   CAC002
     C                     MOVEL@PTDBK    BOKC                            CAC002
     C                     MOVEL@PTDBA    KBRC                            CAC002
     C                     MOVEL@PTDSS    KSSN                            CAC002
     C                     MOVEL@PTDMI    MKTI                            CAC002
     C           KLSPCB    CHAINSEPCBD               01                   CAC002
     C           *IN01     IFEQ '0'                                       CAC002
     C                     MOVE PCBK      WBPRC   4                       CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *BLANKS   WBPRC                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If current book position profit centre record exist & profit    CAC002
      **  centres are different, use the default & send a warning code    CAC002
      *                                                                   CAC002
     C           WBPRC     IFNE *BLANKS                                   CAC002
      *                                                                   CAC002
     C           SBPRC     IFNE WBPRC                                     CAC002
     C                     SETON                     113136               CAC002
     C                     MOVE WBPRC     SBPRC                           CAC002
     C                     MOVE ' W25'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Else, book position profit centre record does not exist         CAC002
     C                     ELSE                                           CAC002
      *                                                                   CAC002
     C           *IN36     IFEQ '1'                                       CAC002
      *                                                                   CAC002
      **  Book position profit centre has been previously defaulted       CAC002
      **  but corresponding book position record does not exist anymore   CAC002
      *                                                                   CAC002
     C                     SETOF                     36                   CAC002
     C                     SETON                     1131                 CAC002
     C                     MOVE ' W25'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
      *                                                                   CAC002
      **  Book Profit Centre is required                                  CAC002
     C           SBPRC     IFEQ *BLANK                                    CAC002
     C                     SETON                     1131                 CAC002
     C                     MOVEL' 620'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
      *                                                                   CAC002
      **  Else, it must be a valid profit centre                          CAC002
     C                     ELSE                                           CAC002
     C                     MOVE SBPRC     @SPRFC                          CAC002
     C                     EXSR AOPRFC                                    CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C                     MOVE ' 621'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
     C                     SETON                     1131                 CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C           *IN54     ANDEQ'0'                                       CAC005
      *                                                                   CAC005
     C           SBPRC     IFEQ *BLANKS                                   CAC005
     C                     MOVE *ON       *IN11                           CAC005
     C                     MOVE *ON       *IN31                           CAC005
     C                     MOVE ' 620'    @EA,E                           CAC005
     C                     ADD  1         E                               CAC005
     C                     ELSE                                           CAC005
     C                     MOVE SBPRC     @SPRFC                          CAC005
     C                     EXSR AOPRFC                                    CAC005
     C           @RTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE ' 621'    @EA,E                           CAC005
     C                     ADD  1         E                               CAC005
     C                     MOVE *ON       *IN11                           CAC005
     C                     MOVE *ON       *IN31                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           *IN31     IFEQ *OFF                                      CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD                           CAC005
     C                     PARM '*PSEUDO' POPTN                           CAC005
     C                     PARM @SBPBK    PMBKCD                          CAC005
     C                     PARM SBPRC     PMPRFC                          CAC005
     C           PMPSBK    PARM *BLANKS   PMPSBK                          CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE *ON       *IN11                           CAC005
     C                     MOVE *ON       *IN31                           CAC005
     C                     MOVEL' 617'    @EA,E                           CAC005
     C                     ADD  1         E                               CAC005
     C                     ELSE                                           CAC005
     C                     MOVELPMPSBK    @PTDBK                          CAC005
     C                     MOVELSBPRC     @PBPRC                          CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC002
      **  Transaction Profit Centre                                       CAC002
      *                                                                   CAC002
      **  If portfolio customer, get default from current customer        CAC002
      **  position profit centre record                                   CAC002
      *                                                                   CAC002
     C           @WC1DI    IFEQ 'S'                                       CAC002
     C           @WC1DI    OREQ 'D'                                       CAC002
      *                                                                   CAC002
      **  Validate Transaction Profit Centre if it is displayed and       CAC002
      **  not protected                                                   CAC002
      *                                                                   CAC002
     C                     MOVE @PTDBA    KBRCA                           CAC002
     C                     MOVE @PTDSS    KSESN                           CAC002
     C                     MOVE @PTCNR    KCNUM                           CAC002
     C           KLSPCC    CHAINSEPCCD               01                   CAC002
     C           *IN01     IFEQ '0'                                       CAC002
     C                     MOVE PCCU      WTPRC   4                       CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *BLANKS   WTPRC                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If current cust position profit centre record exist & profit    CAC002
      **  centres are different, use the default & send a warning code    CAC002
      *                                                                   CAC002
     C           WTPRC     IFNE *BLANKS                                   CAC002
      *                                                                   CAC002
     C           STPRC     IFNE WTPRC                                     CAC002
     C                     SETON                     113237               CAC002
     C                     MOVE WTPRC     STPRC                           CAC002
     C                     MOVE ' W25'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Else, current cust. position profit centre does not exist       CAC002
     C                     ELSE                                           CAC002
      *                                                                   CAC002
     C           *IN37     IFEQ '1'                                       CAC002
      *                                                                   CAC002
      **  Trans. profit centre has been previously defaulted but          CAC002
      **  corresponding cust position record does not exist anymore       CAC002
      *                                                                   CAC002
     C                     SETOF                     37                   CAC002
     C                     SETON                     1132                 CAC002
     C                     MOVE ' W25'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
      *                                                                   CAC002
     C                     ELSE                                           CAC002
      *                                                                   CAC002
      **  Transaction profit centre is required                           CAC002
     C           STPRC     IFEQ *BLANKS                                   CAC002
     C                     MOVE ' 622'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
     C                     SETON                     1132                 CAC002
      *                                                                   CAC002
      **  Transaction profit centre must be a valid profit centre         CAC002
     C                     ELSE                                           CAC002
     C                     MOVE STPRC     @SPRFC                          CAC002
     C                     EXSR AOPRFC                                    CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C                     MOVE ' 623'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
     C                     SETON                     1132                 CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Trade is not being done with a portfolio customer so trans.     CAC002
      **  profit centre is defaulted to book profit centre                CAC002
     C                     ELSE                                           CAC002
     C                     MOVE SBPRC     STPRC                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If both entries valid, send values back to SE3000               CAC002
      *                                                                   CAC002
     C           *IN31     IFEQ *OFF                                      CAC002
     C           *IN32     ANDEQ*OFF                                      CAC002
     C                     MOVE SBPRC     @PBPRC                          CAC002
     C                     MOVE STPRC     @PTPRC                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                                       234552
      ** Validate whether account is blocked due to EU Tax by calling                         234552
      ** SEVTAXDATE                                                                           234552
      *                                                                                       234552
     C           CGL031    IFEQ 'Y'                                                           234552
     C           E         ANDEQ1                                                             234635
     C                     MOVEL'*NK '    WPTFR                                               234552
     C                     MOVEL'Y'       WDFLT                                               234552
     C                     CALL SEVDAT                                                        234552
      *                                                                                       234552
      * INPUTS                                                                                234552
      *                                                                                       234552
      ** Return Code                                                                          234552
     C                     PARM *BLANKS   PRETC                                               234552
     C                     PARM           WDFLT   1                                           234552
     C                     PARM 'I'       WACTN   1                                           234552
     C                     PARM           @PTDBA                                              234552
     C                     PARM           @PTCNR                                              234552
     C                     PARM           @PTDSS                                              234552
     C                     PARM           WPTFR   4                                           234552
     C                     PARM           @PTDMI                                              234552
     C                     PARM 'T'       WTYPE   1                                           234552
     C                     PARM           @PTDRF                                              234552
     C                     PARM           @PTDVD                                              234552
     C                     PARM '@STDVD'  WFIELD 10                                           234552
     C                     PARM           @SECTY                                              234552
     C                     PARM           @CUSDT                                              234552
      *                                                                                       234552
      * OUTPUTS                                                                               234552
      *                                                                                       234552
      * Error fields/message IDs/message data (arrays) from/to caller                         234552
     C                     PARM           @FNXA                                               234552
     C                     PARM           @MIXA                                               234552
     C                     PARM           @MDXA                                               234552
      ** Warning Fields/Message IDs/Message Data (arrays) From/To Caller                      234552
     C                     PARM           @WFNXA                                              234552
     C                     PARM           @WMIXA                                              234552
     C                     PARM           @WMDXA                                              234552
      *                                                                                       234552
      ** Value Date - OK                                                                      234552
     C                     PARM           WVDTOK  1                                           234552
     C           WVDTOK    IFEQ 'N'                                                           234552
     C                     SETON                     1152                                     234552
     C                     MOVEA@WMIXA,1  ZAMSID                                              234552
     C                     MOVEA@WMDXA,1  ZAMSDA    P                                         234552
     C                     CALL 'FCRVMGC'                                                     234552
     C                     PARM *BLANKS   W0RTN   7                                           234552
     C                     PARM           ZAMSID  7                                           234552
     C                     PARM 'SEUSRMSG'ZAMSGF 10                                           234552
     C                     PARM           ZAMSDA132                                           234552
     C                     PARM           ZAMSTX132                                           234552
      *                                                                                       234552
 B2  C           W0RTN     IFEQ *BLANKS                                                       234552
     C                     MOVEAZAMSTX    @EA,1                                               234552
     C                     MOVEA@EA,1     @SERR1                                              234552
     C                     MOVEA@EA,20    @SERR2                                              234552
     C                     SETON                     07                                       234552
 X2  C                     ELSE                                                               234552
     C           ZAMSID    CAT  '- ??':1  @SERR1    P                                         234552
 E2  C                     ENDIF                                                              234552
     C                     ENDIF                                                              234552
     C                     ENDIF                                                              234552
     C/COPY WNCPYSRC,SE3002C009
      *
     C                     ENDSR                           SUB201 ends
      *                                                                   S01176
      *****************************************************************   S01176
      *  SUB202 - Validate screen 2 introduced by CAS006              *                       CAS006
      *****************************************************************                       CAS006
      *                                                                                       CAS006
     C           SUB202    BEGSR                                                              CAS006
      *                                                                                       CAS006
     C                     MOVE 'SPDRT'   WPGM   10                                           CAS006
     C                     MOVEL'SEVPC'   WPGM                                                CAS006
      *                                                                                       CAS006
      ** Validate Credit Risk Spread                                                          CAS006
      *                                                                                       CAS006
     C                     CALL WPGM                                                          CAS006
     C                     PARM *BLANKS   PRTCD                                               CAS006
     C                     PARM 'SCRSK'   PFLDN  10                                           CAS006
     C                     PARM           SCRSK                                               CAS006
     C                     PARM *BLANKS   PFNXA  10                                           CAS006
     C                     PARM *BLANKS   PMSGI   7                                           CAS006
     C                     PARM *BLANKS   PMSGD  45                                           CAS006
     C                     PARM *ZERO     PVSPR  158                                          CAS006
     C                     PARM *BLANKS   PSROK   1                                           CAS006
      *                                                                                       CAS006
     C           PSROK     IFNE 'Y'                                                           CAS006
     C                     MOVE ' 701'    @EA,E                                               CAS006
     C                     ADD  1         E                                                   CAS006
     C                     MOVE '1'       *IN11                                               CAS006
     C                     MOVE '1'       WK16    1                                           CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADDPVSPR     @PCRSK                                              CAS006
      *                                                                                       CAS006
      ** Validate Liquidity Premium                                                           CAS006
      *                                                                                       CAS006
     C                     CALL WPGM                                                          CAS006
     C                     PARM *BLANKS   PRTCD                                               CAS006
     C                     PARM 'SLQPR'   PFLDN                                               CAS006
     C                     PARM           SLQPR                                               CAS006
     C                     PARM *BLANKS   PFNXA                                               CAS006
     C                     PARM *BLANKS   PMSGI                                               CAS006
     C                     PARM *BLANKS   PMSGD                                               CAS006
     C                     PARM *ZERO     PVSPR                                               CAS006
     C                     PARM *BLANKS   PSROK                                               CAS006
      *                                                                                       CAS006
     C           PSROK     IFNE 'Y'                                                           CAS006
     C                     MOVE ' 702'    @EA,E                                               CAS006
     C                     ADD  1         E                                                   CAS006
     C                     MOVE '1'       *IN11                                               CAS006
     C                     MOVE '1'       WK17    1                                           CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADDPVSPR     @PLQPR                                              CAS006
      *                                                                                       CAS006
      ** Validate Net Treasury Price                                                          CAS006
      *                                                                                       CAS006
     C           WK16      IFEQ '0'                                                           CAS006
     C           WK17      ANDEQ'0'                                                           CAS006
      *                                                                                       CAS006
     C                     MOVE SNTCP     WSNTCP 17                                           CAS006
     C                     Z-ADD@PTPDY    WNTCP  158                                          CAS006
     C                     ADD  @PCRSK    WNTCP                                               CAS006
     C                     ADD  @PLQPR    WNTCP                                               CAS006
      *                                                                                       CAS006
     C           WNTCP     IFLE 0                                                             CAS006
      *                                                                                       CAS006
     C                     MOVE ' 703'    @EA,E                                               CAS006
     C                     ADD  1         E                                                   CAS006
     C                     MOVE '1'       *IN11                                               CAS006
     C                     MOVE '1'       WK16                                                CAS006
     C                     MOVE '1'       WK17                                                CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE WNTCP     ZFLD15                                              CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SNTCP                                               CAS006
      *                                                                                       CAS006
     C                     ELSE                                                               CAS006
      *                                                                                       CAS006
      ** If yield or discount basis, convert to price percentage.                             CAS006
      *                                                                                       CAS006
     C           SPBS      IFEQ 'D'                                                           CAS006
     C           SPBS      OREQ 'Y'                                                           CAS006
     C                     Z-ADDWNTCP     ZPRCIN                                              CAS006
     C                     Z-ADD@PTDVD    ZFDATE                                              CAS006
     C           @SACIN    IFEQ 'X'                                                           CAS006
     C                     MOVE 'X'       SCUMEX                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'C'       SCUMEX                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     EXSR ZPRCI                                                         CAS006
     C                     Z-ADDZPRCOT    @PPRCN                                              CAS006
      *                                                                                       CAS006
     C                     ELSE                                                               CAS006
     C                     Z-ADDWNTCP     @PPRCN                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE @PPRCN    ZFLD15                                              CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SNTCP                                               CAS006
      *                                                                                       CAS006
     C           WSNTCP    IFNE SNTCP                                                         CAS006
     C           *INKI     ANDEQ'0'                                                           CAS006
     C           *INKL     ANDEQ'0'                                                           CAS006
     C                     MOVE *ON       *IN06                                               CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE *OFF      *IN06                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
      ** For interest bearing securities                                                      CAS006
      *                                                                                       CAS006
     C           *IN42     IFEQ *ON                                                           CAS006
      *                                                                                       CAS006
      ** Validate Interest Amount using N-T-R                                                 CAS006
      *                                                                                       CAS006
     C                     MOVE *BLANKS   ZFLD17                                              CAS006
     C                     MOVELSITRN     ZFLD17                                              CAS006
     C           13        SUB  @NCDP     ZSDIG                                               CAS006
     C                     Z-ADD@NCDP     ZSDEC                                               CAS006
      *                                                                                       CAS006
     C                     EXSR ZASIGN                                                        CAS006
      *                                                                                       CAS006
     C           *IN99     IFEQ '0'                                                           CAS006
      *                                                                                       CAS006
     C                     MOVE ZOUT15    @PITRN                                              CAS006
      *                                                                                       CAS006
     C           ZFSIGN    IFEQ '-'                                                           CAS006
     C                     Z-SUB@PITRN    @PITRN                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE @PITRN    ZFLD15                                              CAS006
     C                     Z-ADD@NCDP     ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT21    SITRN                                               CAS006
      *                                                                                       CAS006
     C                     ELSE                                                               CAS006
      *                                                                                       CAS006
     C                     MOVE ' 704'    @EA,E                                               CAS006
     C                     ADD  1         E                                                   CAS006
     C                     MOVE '1'       *IN11                                               CAS006
     C                     MOVE '1'       WK10    1                                           CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDSR                                                              CAS006
      *****************************************************************                       CAS006
      /EJECT
      *****************************************************************
      *  SUB203 - Validate screen 2                                   *
      *****************************************************************
     C           SUB203    BEGSR
      *
     C                     SETOF                     05
     C*                                                                   050727
     C* Initialize default branches                                       050727
     C*                                                                   050727
     C                     MOVEL*BLANK    @@PYFB  3                       050727
     C                     MOVEL*BLANK    @@PYTB  3                       050727
      *
      * Get nominal currency details
     C                     MOVELNMCYA     @AJCD
     C***********@KTG10    CHAINTABTG10F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD11        @DBASE           ***************S01117
     C***********          MOVEL'TABSE'   @DBFIL           * DB ERROR 11 *S01117
     C***********          MOVEL@KTG10    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C***********          Z-ADDSPOT      ZRATE1 138                      S01117
     C***********MDIN      IFEQ 0                                         S01117
     C***********          MOVE 'D'       ZMDI1   1                       S01117
     C***********          ELSE                                           S01117
     C***********          MOVE 'M'       ZMDI1                           S01117
     C***********          END                                            S01117
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C                     Z-ADDA6SPRT    ZRATE1 138                      S01117
     C                     MOVE A6MDIN    ZMDI1   1                       S01117
     C                     MOVE A6NQDP    ZNQDP1                          CAC002
      *
      * Get settlement currency details
     C                     MOVE @PSETC    @AJCD
     C***********@KTG10    CHAINTABTG10F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD12        @DBASE           ***************S01117
     C***********          MOVEL'TABSE'   @DBFIL           * DB ERROR 12 *S01117
     C***********          MOVEL@KTG10    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C***********          Z-ADDSPOT      ZRATE2 138                      S01117
     C***********MDIN      IFEQ 0                                         S01117
     C***********          MOVE 'D'       ZMDI2   1                       S01117
     C***********          ELSE                                           S01117
     C***********          MOVE 'M'       ZMDI2                           S01117
     C***********          END                                            S01117
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C                     Z-ADDA6SPRT    ZRATE2 138                      S01117
     C                     MOVE A6MDIN    ZMDI2   1                       S01117
     C                     MOVE A6NQDP    ZNQDP2                          CAC002
      *
      * Exchange rate
      *
      *    .. must be a valid amount
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVEL@STDER    ZFLD17
     C                     Z-ADD5         ZSDIG
     C                     Z-ADD8         ZSDEC
     C                     EXSR ZASIGN
     C/COPY WNCPYSRC,SE3002C064
     C           *IN99     IFEQ '1'
     C           ZFSIGN    OREQ '-'
     C/COPY WNCPYSRC,SE3002C065
     C                     MOVE ' 300'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  51
     C                     MOVEL*BLANKS   @SAVER
     C                     ELSE
     C                     MOVE ZOUT15    @PTDER
     C                     MOVE ZOUT15    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @STDER
      *
      * Mandatory if customer is safe custody or discretionary, or
      * security is multi-currency and settlement currency has changed
     C           @PTDER    IFNE @OTDER
     C           @PTDER    IFEQ 0
     C           @WC1DI    IFEQ 'S'
     C           @WC1DI    OREQ 'D'
     C           MLTI      OREQ 'Y'
     C           @PSETC    ANDNE@OSETC
     C                     MOVEL' 300'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  51
     C                     MOVEL*BLANKS   @SAVER
     C                     END
     C                     ELSE
      *
      *    .. must be within 10% of spot rate between nominal/
      *                                       settlement currencies
      *
     C           @STDER    IFNE @SAVER
     C                     MOVE @STDER    @SAVER
     C                     EXSR ZXRATE
      *
     C           @SSMDI    IFNE ZMDIX
     C           @PTDER    ANDNE*ZEROS
     C           1         DIV  @PTDER    @WTDER 138H
     C                     ELSE
     C                     Z-ADD@PTDER    @WTDER
     C                     END
      *
     C           ZRATEX    DIV  10        @APWK1 158H
     C           ZRATEX    ADD  @APWK1    @APWK2 158
     C           @WTDER    IFGT @APWK2
     C                     MOVE ' W06'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  51
     C                     ELSE
      *
     C           ZRATEX    SUB  @APWK1    @APWK2
     C           @WTDER    IFLT @APWK2
     C                     MOVE ' W06'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  51
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
      *
      *  Multiply/Divide factor must be M or D if changed
     C           @SSMDI    IFNE 'M'
     C           @SSMDI    ANDNE'D'
     C           @SSMDI    IFNE @OSMDI
     C           @PTDER    ORNE @OTDER
     C                     MOVE ' 301'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  52
     C                     END
     C                     END
     C                     MOVEL@SSMDI    @PTMDI
      *
      * Incomplete indicator must be I or C
     C           *IN46     IFEQ '1'
      *
     C           @SINCS    IFNE 'I'
     C           @SINCS    ANDNE'C'
     C***********          SETON                     11  87               S01176
     C                     SETON                     11  50               S01176
     C                     MOVEL' 108'    @EA,E
     C                     ADD  1         E
     C                     ELSE
      *
      *    .. cannot be C if exchange rate invalid, or if exchange rate
      *    is zero and customer is safe custody or discretionary or
      *    security is multicurrency and settlemnt currency has changed
     C           @SINCS    IFEQ 'C'
      *
     C           *IN51     IFEQ '1'
     C           *IN52     OREQ '1'
     C***********          SETON                     87                   S01176
     C                     SETON                     50                   S01176
     C                     END
      *
     C           @PTDER    IFEQ 0
      *
     C           @WC1DI    IFEQ 'S'
     C           @WC1DI    OREQ 'D'
     C***********          SETON                     87                   S01176
     C                     SETON                     50                   S01176
     C                     END
      *
     C           MLTI      IFEQ 'Y'
     C           @SSETC    ANDNE@OSETC
     C***********          SETON                     87                   S01176
     C                     SETON                     50                   S01176
     C                     END
      *
     C                     END
      *
     C           *IN87     IFEQ '1'
     C                     SETON                     11
     C                     MOVEL' 109'    @EA,E
     C                     ADD  1         E
     C                     END
     C                     END
     C                     END
      *
     C                     MOVEL@SINCS    @PTINC
     C                     END
      *
      * Base currency rate
      *
      *    .. must be a valid amount
     C                     MOVE *BLANKS   ZFLD17
     C                     MOVEL@SBRTE    ZFLD17
     C                     Z-ADD5         ZSDIG
     C                     Z-ADD8         ZSDEC
     C                     EXSR ZASIGN
     C           *IN99     IFEQ '1'
     C           ZFSIGN    OREQ '-'
     C                     MOVE ' 303'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  53
     C                     MOVEL*BLANKS   @SAVBS
     C                     ELSE
     C                     MOVE ZOUT15    @PTBCR
     C                     MOVE ZOUT15    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @SBRTE
     C           @PTBCR    IFNE @OTBCR
      *
      * Mandatory if settlement currency is not base currency
     C           @PTBCR    IFEQ 0
     C***********@PSETC    ANDNEBCCY                                      S01117
     C           @PSETC    ANDNEBJCYCD                                    S01117
     C                     MOVEL' 302'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  53
     C                     MOVEL*BLANKS   @SAVBS
     C                     ELSE
      *
      *   .. if entered, must be within 10% of spot rate
     C           @SBRTE    IFNE @SAVBS
     C                     MOVE @SBRTE    @SAVBS
     C***********SPOT      DIV  10        @APWK1    H                     S01117
     C***********SPOT      ADD  @APWK1    @APWK2                          S01117
     C           A6SPRT    DIV  10        @APWK1    H                     S01117
     C           A6SPRT    ADD  @APWK1    @APWK2                          S01117
     C           @PTBCR    IFGT @APWK2
     C                     MOVE ' W07'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  53
     C                     ELSE
      *
     C***********SPOT      SUB  @APWK1    @APWK2                          S01117
     C           A6SPRT    SUB  @APWK1    @APWK2                          S01117
     C           @PTBCR    IFLT @APWK2
     C                     MOVE ' W07'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  53
     C                     END
     C                     END
     C                     END
      *
     C                     END
     C                     END
      *
     C                     END
     C*
     C* The following validation not performed for Book Transfers ..
     C*
     C           @WC1DI    IFNE 'I'
     C***********@PTCNR    ORNE BICN                                      S01117
      *
      * Settlement method
      *
      *    .. if Market Ind. is 'G', must be blank or '00'
     C           @PTDMI    IFEQ 'G'
     C           @SSMTH    IFNE *BLANKS
     C           @SSMTH    ANDNE'00'
     C                     MOVE ' 304'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  54
     C                     END
      *
      *    .. if Market Ind. not 'G', must be a valid MIDAS
      *                                       settlement method
     C                     ELSE
     C           @SSMTH    IFLT '00'
     C           @SSMTH    OREQ '09'
     C           @SSMTH    OREQ '10'
     C           @SSMTH    OREQ '11'
     C           @SSMTH    OREQ '13'
     C           @SSMTH    ORGT '15'
     C                     MOVE ' 304'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  54
     C                     END
     C                     END
     C*                                                                   171456
     C           S01496    IFEQ 'Y'                                       171456
      *                                                                   171456
      **  If '00' and not incomplete                                      171456
      *                                                                   171456
     C           @SSMTH    IFEQ '00'                                      171456
     C           @SINCS    ANDNE'I'                                       171456
     C                     MOVE ' 304'    @EA,E                           171456
     C                     ADD  1         E                               171456
     C                     SETON                     11  54               171456
     C                     END                                            171456
     C                     END                                            171456
      *
      *    .. if '04' or '14' the Retail Module must be present
     C           @SSMTH    IFEQ '04'
     C           @SSMTH    OREQ '14'
     C           *INU1     IFNE '1'
     C                     MOVE ' 305'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  54
     C                     END
     C                     END
      *
      *    .. if '07' settlement currency must equal US dollar
      *                                             currency code
     C           @SSMTH    IFEQ '07'
     C***********@KTB40    CHAINTABTB40F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD13        @DBASE           ***************S01117
     C***********          MOVEL'TABLE'   @DBFIL           * DB ERROR 13 *S01117
     C***********          MOVEL@KTB40    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C***********@PSETC    IFNE USCY                                      S01117
     C                     EXSR AOTRAD                                    S01117
     C           @SSETC    IFNE BLUSCY                                    S01117
     C                     MOVE ' 306'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  54
     C                     END
     C                     END
      *
      *    .. if '03' or '06' Clearance Type must be '5'
     C           @SCLTY    IFNE '5'
     C           @SSMTH    IFEQ '03'
     C           @SSMTH    OREQ '06'
     C                     MOVE ' 307'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  54
     C                     END
     C                     END
      *                                                                   S01496
     C** If customer is a Portfolio Customer settlement method must be    S01496
     C** one of 04, 05, 14 or 15                                          S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C***********          MOVEL@PTCNR    @PLKY                     S01496086385
     C***********          CALL 'AOPLCSR0'                          S01496086385
     C***********          PARM *BLANKS   @RTCD                     S01496086385
     C***********          PARM '*KEY   ' @OPTN                     S01496086385
     C***********          PARM           @PLKY  10                 S01496086385
     C***********SDPLCS    PARM SDPLCS    DSFDY                     S01496086385
     C***********                                                   S01496086385
     C***If*not*on*file*and*an*entry*has*been*made*then*error*******S01496086385
     C***********                                                   S01496086385
     C***********          MOVEL@PTCNR    @PLKY                     S01496081490
     C***********          CALL 'AOPLCSR0'                          S01496081490
     C***********          PARM *BLANKS   @RTCD                     S01496081490
     C***********          PARM '*KEY   ' @OPTN                     S01496081490
     C***********          PARM           @PLKY  10                 S01496081490
     C***********SDPLCS    PARM SDPLCS    DSFDY                     S01496081490
     C***********                                                   S01496081490
     C***If*not*on*file*and*an*entry*has*been*made*then*error*******S01496081490
     C***********                                                   S01496081490
     C***********@RTCD     IFNE *BLANKS                             S01496081490
     C***********@SSMTH    IFNE '04'                                S01496081490
     C***********@SSMTH    ANDNE'05'                                S01496081490
     C***********@SSMTH    ANDNE'14'                                S01496081490
     C***********@SSMTH    ANDNE'15'                                S01496081490
     C***********          MOVE ' W16'    @EA,E                     S01496081490
     C***********          ADD  1         E                         S01496081490
     C***********          SETON                     11  54         S01496081490
     C***********          END                                      S01496081490
     C***********          END                                      S01496081490
     C************         END                                      S01496081490
     C*    .. if settlement method not '00', then for customers           081490
     C*    .. of bank only settl. method 04,05,14,15 allowed              081490
     C*                                                                   081490
     C                     MOVE 'N'       WCHECK  1                       081490
     C           @SSMTH    IFNE '00'                                      081490
     C*                                                                   081490
     C           @WC1DI    IFEQ 'S'                                       081490
     C           @WC1DI    OREQ 'D'                                       081490
     C           @SSMTH    IFEQ '04'                                      081490
     C           @SSMTH    OREQ '05'                                      081490
     C           @SSMTH    OREQ '14'                                      081490
     C           @SSMTH    OREQ '15'                                      081490
     C*    .. only for those customer and settl. methods will be          081490
     C*    .. checked, if the same cust. (W12) and portfolio (W13)        081490
     C*    .. at the counterparty and at the settlement account           081490
     C                     MOVE 'Y'       WCHECK                          081490
     C                     ELSE                                           081490
     C                     MOVE ' W14'    @EA,E                           081490
     C                     ADD  1         E                               081490
     C                     SETON                     11  54               081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
     C*                                                                   081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
      *
      *    .. if '04' must reference an active ACCNT record
     C           @SSMTH    IFEQ '04'
     C**********           Z-ADD@PTCNR    CNUM                                               CSD027A
     C                     MOVE @PTCNR    CNUM                                               CSD027A
     C                     MOVEL@PSETC    CCY
     C***********          Z-ADDCADC      ACOD                            S01117
     C                     MOVE BMACCD    ACOD                            S01117
     C                     Z-ADD1         ACSQ                            S01117
     C                     MOVE @PTDBA    BRCA                            S01117
     C*                                                                   E17830
     C********access*TABLETR*for*a/c*seq*(IF*MULTIBRANCHING)********E17830S01117
     C*                                                                   E17830
     C***********MBIN      IFEQ 'Y'                                E17830 S01117
     C***********@STDTP    IFEQ 'TP'                               E17830 S01117
     C***********          MOVE @SPYFB    @KTBTR                   E17830 S01117
     C***********          ELSE                                    E17830 S01117
     C***********          MOVE @SPYTB    @KTBTR                   E17830 S01117
     C***********          END                                     E17830 S01117
     C***********@KTBTR    CHAINTABLETRF             01            E17830 S01117
     C***********          Z-ADDNSACS     ACSQ                     E17830 S01117
     C***********          ELSE                                    E17830 S01117
     C***********          Z-ADD1         ACSQ                            S01117
     C***********          END                                     E17830 S01117
     C**N01******@KEY2     CHAINACCNTABF             01                   S01117
     C           @KEY2     CHAINACCNTABF             01                   S01117
     C**********           Z-ADDCNUM      WSCNUM  60                S01496081490
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C***********DACO      ORGE @PTDVD                             E21059 064939
     C           DACO      ORGT @PTDVD                                    064939
     C***********DACO      ORGT @PTDVD                                    E21059
     C           ACST      OREQ 'C'
     C                     MOVE ' 308'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  54
      *                                                                   E16843
      *    .. else check account is not blocked                           E16843
      *                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'2'       RETB           16               E16843
     C                     TESTB'3'       RETB           17               E16843
     C           @STDTP    IFEQ 'TP'                                      E16843
     C           *IN16     ANDEQ'1'                                       E16843
     C           @STDTP    OREQ 'TS'                                      E16843
     C           *IN17     ANDEQ'1'                                       E16843
     C                     MOVE ' 308'    @EA,E                           E16843
     C                     ADD  1         E                               E16843
     C                     SETON                     11  54               E16843
     C                     END                                            E16843
      *                                                                   E16843
     C                     END
     C**********           Z-ADDCNUM      @WPYFM                                      099817 CSD027A
     C                     MOVE CNUM      @WPYFM                                             CSD027A
     C                     END
     C*                                                                   S01195
     C*   if not a nostro settlement, must not be a holiday in local      S01195
     C*     currency/system location                                      S01195
     C*                                                                   S01195
     C           @SSMTH    IFNE '01'                                      S01195
     C           @SSMTH    ANDNE'02'                                      S01195
     C           @SSMTH    ANDNE'07'                                      S01195
     C           @SSMTH    ANDNE'08'                                      S01195
     C           @SSMTH    ANDNE'12'                                      S01195
     C           @SSMTH    ANDNE@OSMTH                                    S01195
     C                     MOVE BJSLCD    ZLOC                            S01195
     C                     Z-ADD@PTDVD    ZDAYNO                          S01195
     C                     MOVE BJLCCY    ZCCY                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W16'    @EA,E                           S01195
     C                     ADD  1         E                               S01195
     C                     SETON                     11  54               S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C                     MOVEL@SSMTH    @OSMTH  2                       S01195
     C                     MOVEL@SSMTH    @PSMTH
      *
      * Pay from (Purchases)
     C           @STDTP    IFEQ 'TP'
      *
      *    .. entry only allowed for certain Settlement Methods
     C           @SPYFM    IFNE *BLANKS
     C           @SSMTH    ANDNE'01'
     C           @SSMTH    ANDNE'02'
     C           @SSMTH    ANDNE'03'
     C           @SSMTH    ANDNE'05'
     C           @SSMTH    ANDNE'07'
     C           @SSMTH    ANDNE'08'
     C           @SSMTH    ANDNE'12'
     C           @SSMTH    ANDNE'14'
     C           @SSMTH    ANDNE'15'
     C                     MOVE ' 309'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
     C                     END
      *
      *    .. if Settlement Method '01' '07' '08' or '12' must
      ****************reference*an*active*Nostro*on*TABLETL***************S01117
      *               reference an active Nostro on SDNOSTPD              S01117
     C*           and Pay From branch must match branch of Nostro         S01117
      *
     C           @SSMTH    IFEQ '01'
     C           @SSMTH    OREQ '02'
     C           @SSMTH    OREQ '07'
     C           @SSMTH    OREQ '08'
     C           @SSMTH    OREQ '12'
     C**********           MOVE @SPYFM    WFL10  10                                           CGL029
     C                     MOVE @SPYFM    WFL16  16                                           CGL029
     C***********          MOVEL@SPYFM    @KNN                            S01117
     C***********@KNN      IFEQ *BLANKS                                   S01117
     C***********          MOVE '00'      @KNN                            S01117
     C***********          END                                            S01117
     C***********          MOVEL@SSETC    @KCCY2                          S01117
     C***********@KTBTL    CHAINTABLETLF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     MOVE @SSETC    P@CYCD                          S01117
     C                     MOVEL@SPYFM    P@NONB                          S01117
     C                     EXSR AONOST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C********** WFL10     ORNE *BLANKS                                                       CGL029
     C           WFL16     ORNE *BLANKS                                                       CGL029
     C                     MOVE ' 310'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
     C*                                                                   S01195
     C*   Find nostro location code for holiday validation                S01195
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C           @SPYFM    IFNE @OPYFM                                    S01195
     C                     MOVE '*DBERR ' @RTCD                           S01195
     C                     MOVE A7BRCD    @DSNB                           S01195
     C                     EXSR AOBRCH                                    S01195
     C                     MOVE A8LCCD    ZLOC                            S01195
     C*                                                                   S01195
     C*    .. if Clearance Type '1' or '2', must not be holiday in        S01195
     C*                                        Euroclear currency         S01195
     C*                                                                   S01195
     C           @SCLTY    IFEQ '1'                                       S01195
     C           @SCLTY    OREQ '2'                                       S01195
     C                     Z-ADD@PTDVD    ZDAYNO                          S01195
     C                     MOVE BVEUCY    ZCCY                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W11'    @EA,E                           S01195
     C                     ADD  1         E                               S01195
     C                     SETON                     1155                 S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C*    .. if Clearance Type '3' or '4', must not be holiday in        S01195
     C*                                            Cedel currency         S01195
     C           @SCLTY    IFEQ '3'                                       S01195
     C           @SCLTY    OREQ '4'                                       S01195
     C                     Z-ADD@PTDVD    ZDAYNO                          S01195
     C                     MOVE BVCCCY    ZCCY                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W12'    @EA,E                           S01195
     C                     ADD  1         E                               S01195
     C                     SETON                     1155                 S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C*    .. if Clearance Type '2','4' or '5', must not be holiday in    S01195
     C*                                         settlement currency       S01195
     C           @SCLTY    IFEQ '2'                                       S01195
     C           @SCLTY    OREQ '4'                                       S01195
     C           @SCLTY    OREQ '5'                                       S01195
     C           @SSETC    IFNE *BLANKS                                   S01195
     C                     Z-ADD@PTDVD    ZDAYNO                          S01195
     C                     MOVE @SSETC    ZCCY                            S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C           BFCYCD    IFNE *BLANKS                                   S01195
     C                     MOVE BFCYCD    ZCCY                            S01195
     C                     ELSE                                           S01195
     C                     MOVE NMCYA     ZCCY                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W13'    @EA,E                           S01195
     C                     ADD  1         E                               S01195
     C                     SETON                     1155                 S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C*    .. must not be a holiday in value currency                     S01195
     C**   .. If S01509 on, must not be a holiday in nominal currency     S01509
     C*                                                                   S01195
     C                     Z-ADD@PTDVD    ZDAYNO                          S01195
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE NMCYA     ZCCY                            S01509
     C                     ELSE                                           S01509
     C                     MOVE VLCY      ZCCY                            S01195
     C                     END                                            S01509
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W14'    @EA,E                           S01195
     C                     ADD  1         E                               S01195
     C                     SETON                     1155                 S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C*****..*must*not*be*a*holiday*in*payment*currency**************     S01195
     C***********                                                  S01195 065524
     C***********          Z-ADD@PTDVD    ZDAYNO                   S01195 065524
     C***********          MOVE SPYC      ZCCY                     S01195 065524
     C***********          EXSR ZCHKH                              S01195 065524
     C***********ZIND      IFEQ 'H'                                S01195 065524
     C***********          MOVE ' W15'    @EA,E                    S01195 065524
     C***********          ADD  1         E                        S01195 065524
     C***********          SETON                     1155          S01195 065524
     C***********          END                                     S01195 065524
     C                     END                                            S01195
     C                     END                                            S01195
     C                     END
     C***********          Z-ADDCNUM      @WPYFM                          S01117
     C                     MOVE A7CUST    @WPYFM                          S01117
     C                     END
      *
      *    .. if Settlement Method '05' must reference an active
      *           ACCNT record for Pay From Branch
     C           @SSMTH    IFEQ '05'
     C                     TESTN          @SPYFM     35
     C           *IN35     IFEQ '1'
     C***********          MOVE @SPYFM    @DSACT                          S01117
     C**********           MOVE @SPYFM    WFLD6   6                                    S01117 CGL029
     C                     MOVEL@SPYFM    CNUM
     C                     MOVEL@SSETC    CCY
     C**********           MOVELWFLD6     ACOD                                         S01117 CGL029
     C**********           MOVE WFLD6     ACSQ                                         S01117 CGL029
     C                     MOVE @SPYFM    WFLD12 12                                           CGL029
     C                     MOVELWFLD12    ACOD                                                CGL029
     C                     MOVE WFLD12    ACSQ                                                CGL029
     C***********          MOVE @SPYFB    @WPYFB  30                      S01117
     C                     MOVE @SPYFB    BRCA                            S01117
     C           @KEY2     CHAINACCNTABF             01
     C**********           Z-ADDCNUM      WSCNUM  60                S01496081490
     C                     END
     C           *IN35     IFEQ '0'
     C           *IN01     OREQ '1'
     C           RECI      OREQ '*'
     C***********BRCD      ORNE @WPYFB                                    S01117
     C***********DACO      ORGE @PTDVD                             E21059 064939
     C           DACO      ORGT @PTDVD                                    064939
     C***********DACO      ORGT @PTDVD                                    E21059
     C           ACST      OREQ 'C'
     C                     MOVE ' 311'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
      *                                                                   E16843
      *    .. else check account is not blocked                           E16843
      *                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'2'       RETB           16               E16843
     C           @STDTP    IFEQ 'TP'                                      E16843
     C           *IN16     ANDEQ'1'                                       E16843
     C                     MOVE ' 311'    @EA,E                           E16843
     C                     ADD  1         E                               E16843
     C                     SETON                     11  55               E16843
     C                     END                                            E16843
      *                                                                   E16843
     C                     END
     C**********           Z-ADDCNUM      @WPYFM                                      099817 CSD027A
     C                     MOVE CNUM      @WPYFM                                             CSD027A
     C                     END
      *
      *    .. if Settlement Method '14' must reference an active
      *                                            account on ACNUM
     C           @SSMTH    IFEQ '14'
     C***********          MOVE @SPYFB    @WPYFB                          S01117
     C                     MOVEL@SPYFM    @WPF10 10
     C                     TESTN          @WPF10     35
     C           *IN35     IFEQ '1'
     C                     MOVEL@SPYFM    @KEY10 100
     C           @KEY10    CHAINACNUMF               01
     C**********           Z-ADDCNUM      WSCNUM  60                S01496081490
     C           *IN01     IFEQ '0'
     C           RECI      ANDNE'*'
     C           @KEY2     CHAINACCNTABF             01
     C**********           Z-ADDCNUM      WSCNUM  60                S01496081490
     C                     END
     C                     END
      *
     C           *IN35     IFEQ '0'
     C           *IN01     OREQ '1'
     C           RECI      OREQ '*'
     C***********DACO      ORGE @PTDVD                             E21059 064939
     C           DACO      ORGT @PTDVD                                    064939
     C***********DACO      ORGT @PTDVD                                    E21059
     C           ACST      OREQ 'C'
     C           CCY       ORNE @SSETC
     C***********BRCD      ORNE @WPYFB                                    S01117
     C           BRCA      ORNE @SPYFB                                    S01117
     C           @SPYFB    ANDNE*BLANK                                    050727
     C                     MOVE ' 312'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
      *                                                                   E16843
      *    .. else check account is not blocked                           E16843
      *                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'2'       RETB           16               E16843
     C           @STDTP    IFEQ 'TP'                                      E16843
     C           *IN16     ANDEQ'1'                                       E16843
     C                     MOVE ' 312'    @EA,E                           E16843
     C                     ADD  1         E                               E16843
     C                     SETON                     11  55               E16843
     C                     END                                            E16843
      *                                                                   E16843
     C                     END
     C**********           Z-ADDCNUM      @WPYFM                                      099817 CSD027A
     C                     MOVE CNUM      @WPYFM                                             CSD027A
     C                     END
      *
      *   .. if Settlement Method is '03' may contain a Trade Ref.
      *                                                    Number
      *
     C           @SSMTH    IFEQ '03'
     C           @SPYFM    ANDNE*BLANKS
     C*
     C                     MOVEA*BLANKS   APF
     C                     MOVEA@SPYFM    APF
     C                     SETOF                         99
     C*
     C*           Find first non blank character
     C                     Z-ADD1         Z       20
     C           Z         DOWLE13
     C           APF,Z     ANDEQ' '
     C                     ADD  1         Z
     C                     END
     C*
     C*           Ensure each character is numeric
     C                     Z-ADD0         Y       20
     C           Z         DOWLE13
     C           APF,Z     ANDNE*BLANK
     C           *IN99     ANDNE'1'
     C*
     C           APF,Z     COMP '0'                    99
     C  N99      APF,Z     COMP '9'                  99
     C  N99                ADD  1         Z
     C  N99                ADD  1         Y
     C*
     C                     END
     C*
     C*           Ensure than number is 6 digits
     C  N99      Y         COMP 6                    9999
     C*
     C           *IN99     IFEQ '1'
     C                     MOVE ' 313'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
     C                     END
     C                     END
      *
      ********if*Settlement*Method*'15'*may*reference*an*active*****      E16843
      *    .. if Settlement Method '15' must reference an active          E16843
      *                                         account on ACCNT
     C           @SSMTH    IFEQ '15'
     C           @SPYFM    ANDNE*BLANKS
     C                     TESTN          @SPYFM     35                   067531
     C           *IN35     IFEQ '1'                                       067531
     C**********           MOVE @SPYFM    WFLD6   6                                    067531 CGL029
     C                     MOVEL@SPYFM    CNUM                            067531
     C**********           MOVELWFLD6     ACOD                                         067531 CGL029
     C**********           MOVE WFLD6     ACSQ                                         067531 CGL029
     C                     MOVE @SPYFM    WFLD12                                              CGL029
     C                     MOVELWFLD12    ACOD                                                CGL029
     C                     MOVE WFLD12    ACSQ                                                CGL029
     C                     ELSE                                           067531
     C                     Z-ADD0         ACOD                            067531
     C                     Z-ADD0         ACSQ                            067531
     C                     END                                            067531
     C***********          MOVE @SPYFB    @WPYFB                          S01117
     C**********           MOVEL@SPYFM    @WCSNM 10                                           CGL029
     C                     MOVEL@SPYFM    @WCSNM 16                                           CGL029
     C***********@WCSNM    CHAINSNAMEF               01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
      *
     C                     MOVEL@SPYFM    @WCUST  6                       028336
     C                     TESTN          @WCUST     35                   028336
     C************IN35     IFEQ '1'
     C***********          MOVEL@SPYFM    CNUM
     C***********          ELSE
     C***********          Z-ADD0         CNUM
     C***********          END
     C           *IN35     IFEQ '0'                                       S01117
     C                     MOVE *BLANKS   @WCUST                          S01117
     C                     END                                            S01117
     C                     ELSE                                           065429
     C                     MOVE *BLANKS   @SPYFM                          065429
     C                     MOVELBBCUST    @SPYFM                          065429
     C                     MOVELBBCUST    @WCUST                          065429
     C                     END
     C***********          MOVE '1'       RCDT                            S01117
     C***********@KEY3     CHAINCLINTSEF             01                   S01117
      *
     C************IN01     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          Z-ADDCNUM      @WPYFM  60                      S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 314'    @EA,E                           065429
     C                     ADD  1         E                               065429
     C                     SETON                     11  55               065429
     C                     ELSE                                           065429
     C*                                                                   065429
     C* Set up a/c for output                                             065429
     C           ACOD      IFEQ 0                                         067531
     C           ACSQ      ANDEQ0                                         067531
     C                     MOVELBFCUST    @WCSNM                          065429
     C           BFACCD    IFNE *BLANKS                                   065429
     C                     MOVE BFACCD    @WCSNM                          065429
     C                     ELSE                                           065429
     C**********           MOVE '0000'    @WCSNM                                       065429 CGL029
     C                     MOVE *ZEROS    WZACCD 10                                           CGL029
     C                     MOVE WZACCD    @WCSNM                                              CGL029
     C                     END                                            065429
     C                     MOVEL@WCSNM    @SPYFM                          065429
     C                     MOVE BFACSN    @SPYFM                          065429
     C                     MOVELBFCUST    CNUM                            S01117
     C**********           MOVELBFCUST    @WPYFM  60                                  S01117 CSD027A
     C                     MOVELBFCUST    @WPYFM  6                                          CSD027A
     C                     MOVELBFACCD    ACOD                            S01117
     C                     Z-ADDBFACSN    ACSQ                            S01117
     C                     END                                            067531
     C                     MOVEL@SSETC    CCY
     C***********          MOVE @SPYFB    BRCA                     S01117 065429
     C           @SPYFB    IFNE *BLANKS                                   087651
     C                     MOVE @SPYFB    BRCA                            087651
     C                     ELSE                                           087651
     C                     MOVE @SBRCD    BRCA                            065429
     C                     END                                            087651
     C***********          MOVELC1AC      ACOD                            S01117
     C***********          Z-ADDC1SQ      ACSQ                            S01117
     C           @KEY2     CHAINACCNTABF             01
     C***********          END                                            065429
      *
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C***********DACO      ORGE @PTDVD                             E21059 064939
     C           DACO      ORGT @PTDVD                                    064939
     C***********DACO      ORGT @PTDVD                                    E21059
     C           ACST      OREQ 'C'
     C***********BRCD      ORNE @WPYFB                                    S01117
     C                     MOVE ' 314'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
      *                                                                   E16843
      *    .. else check account is not blocked                           E16843
      *                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'2'       RETB           16               E16843
     C           @STDTP    IFEQ 'TP'                                      E16843
     C           *IN16     ANDEQ'1'                                       E16843
     C                     MOVE ' 314'    @EA,E                           E16843
     C                     ADD  1         E                               E16843
     C                     SETON                     11  55               E16843
     C                     END                                            E16843
      *                                                                   E16843
     C**********           Z-ADDCNUM      @WPYFM                                      099817 CSD027A
     C                     MOVE CNUM      @WPYFM                                             CSD027A
     C                     END
     C                     END                                            065429
     C                     END
      *                                                                   065429
      *  Pay From may not be blank with settlement method 15              065429
      *                                                                   065429
     C           @SSMTH    IFEQ '15'                                      065429
     C           @SPYFM    ANDEQ*BLANKS                                   065429
     C                     MOVE ' 376'    @EA,E                           065429
     C                     ADD  1         E                               065429
     C                     SETON                     11  55               065429
     C                     END                                            065429
      *                                                                   065429
     C** If settlement method is 04/05/14/15 and counterparty was         081490
     C** entered, settlement a/c customer must be the same                081490
     C*                                                                   081490
     C           S01496    IFEQ 'Y'                                       081490
     C           WCHECK    IFEQ 'Y'                                       081490
     C************         MOVE @SSMTH    ZMETH   20               081490 099817
     C************         Z-ADD@PTCNR    ZCNUM   60               081490 099817
     C************         MOVE @SPYFM    ZSETI  12                081490 099817
     C************         MOVE @SPYFB    BRCA    3                081490 099817
     C************         MOVE @SPYFB    ZBRCA                    085862 099817
     C************         MOVE @SSETC    ZCCY    3                081490 099817
     C************         MOVE MBIN      BJMBDI  1                081490 099817
     C************         MOVE *BLANKS   DBFILE                   081490 099817
     C************         EXSR ZSETAC                             081490 099817
     C************                                                 081490 099817
     C***CHECK*FOR DATABASE ERROR IN  ZSETAC                       081490 099817
     C************                                                 081490 099817
     C***********DBFILE    IFNE *BLANKS                            081490 099817
     C************         MOVELDBFILE    @DBFIL                   081490 099817
     C************         MOVELDBKEY     @DBKEY                   081490 099817
     C************         MOVELDBASE     @DBASE                   081490 099817
     C************         EXSR *PSSR                              081490 099817
     C************         END                                     081490 099817
     C************                                                 081490 099817
     C************LOCK     IN   LDA                                081490 099817
     C************         MOVEL@PTCNR    WWCSNM  6                081490 099817
     C************         MOVELZSETO     WWCUST  6                081490 099817
     C************                                                 081490 099817
     C***********WWCSNM    IFNE WWCUST                             081490 099817
     C           @WPYFM    IFNE @PTCNR                                    099817
     C                     MOVE ' W12'    @EA,E                           081490
     C                     ADD  1         E                               081490
     C                     SETON                     11  55               081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
     C*                                                                   081490
     C**********           MOVEL@SPYFM    @OPYFM 12                                    S01117 CGL029
     C                     MOVEL@SPYFM    @OPYFM 18                                           CGL029
      *                                                                   E16843
     C* IF PAY FROM NOT IN ERROR MOVE VALUE TO PARAMETER
     C           *IN55     IFEQ '0'
     C                     MOVEL@SPYFM    @PPYFM
     C                     END
     C*                                                                   S01117
     C* Pay from branch                                                   S01117
     C* Determine default                                                 050727
     C*                                                                   050727
     C           @SSMTH    IFEQ '01'                                      050727
     C           @SSMTH    OREQ '02'                                      050727
     C           @SSMTH    OREQ '07'                                      050727
     C           @SSMTH    OREQ '08'                                      050727
     C           @SSMTH    OREQ '12'                                      050727
     C                     MOVELA7BRCD    @@PYFB                          050727
     C                     ELSE                                           050727
     C           @SSMTH    IFEQ '14'                                      050727
     C           @SSMTH    OREQ '15'                                      087651
     C                     MOVELBRCA      @@PYFB                          050727
     C                     ELSE                                           050727
     C           @SSMTH    IFNE '05'                                      050727
     C                     MOVEL@PTDBA    @@PYFB                          050727
     C                     END                                            050727
     C                     END                                            050727
     C                     END                                            050727
     C*                                                                   S01117
     C*                                                                   S01117
     C*    .. for Settlement Method 01, 02, 07, 08 and 12,                S01117
     C*       Pay From branch must equal branch of the Nostro             S01117
     C*                                                                   S01117
     C           @SSMTH    IFEQ '01'                                      S01117
     C           @SSMTH    OREQ '02'                                      S01117
     C           @SSMTH    OREQ '07'                                      S01117
     C           @SSMTH    OREQ '08'                                      S01117
     C           @SSMTH    OREQ '12'                                      S01117
     C           @SPYFB    IFNE A7BRCD                                    S01117
     C           @SPYFB    ANDNE*BLANK                                    050727
     C           @STDTP    ANDEQ'TP'                                      S01117
     C                     MOVE ' 325'    @EA,E                           S01117
     C                     ADD  1         E                               S01117
     C                     SETON                     1156                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   050727
     C*    .. for Settlement Method 14                                    050727
     C*       Pay From branch must equal branch of the account            050727
     C*                                                                   050727
     C           @SSMTH    IFEQ '14'                                      050727
     C           @SSMTH    OREQ '15'                                      087651
     C           @SPYFB    IFNE BRCA                                      050727
     C           @SPYFB    ANDNE*BLANK                                    050727
     C           @STDTP    ANDEQ'TP'                                      050727
     C                     MOVE ' 325'    @EA,E                           050727
     C                     ADD  1         E                               050727
     C                     SETON                     1156                 050727
     C                     END                                            050727
     C                     END                                            050727
     C*                                                                   S01117
     C*    .. for Settlement Method other than 01, 02, 05, 07, 08, 12 &   S01117
     C********14,*Pay*From*branch*must*equal*Trade*Booking*branch**S01117 066097
     C*  14 & 15, Pay From branch must equal Trade Booking branch         066097
     C*                                                                   S01117
     C           @SPYFB    IFNE @SBRCD                                    S01117
     C           @SPYFB    ANDNE*BLANK                                    050727
     C           @STDTP    ANDEQ'TP'                                      050727
     C           @SSMTH    ANDNE'01'                                      S01117
     C           @SSMTH    ANDNE'02'                                      S01117
     C           @SSMTH    ANDNE'05'                                      S01117
     C           @SSMTH    ANDNE'07'                                      S01117
     C           @SSMTH    ANDNE'08'                                      S01117
     C           @SSMTH    ANDNE'12'                                      S01117
     C           @SSMTH    ANDNE'14'                                      S01117
     C           @SSMTH    ANDNE'15'                                      066097
     C                     MOVE ' 327'    @EA,E                           S01117
     C                     ADD  1         E                               S01117
     C                     SETON                     1156                 S01117
     C                     END                                            S01117
      *
      **Pay*from*branch*if*entered*must*be*an*active*code*on*TABLETR**    S01117
      * Pay from branch if entered must be an active code on SDBRCHPD     S01117
     C           @SPYFB    IFNE *BLANKS
     C***********          MOVE @SPYFB    @KTBTR                          S01117
     C***********@KTBTR    CHAINTABLETRF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     MOVE @SPYFB    @DSNB                           S01117
     C                     EXSR AOBRCH                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 322'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  56
     C                     END
     C                     END
     C***********          MOVEL@SPYFB    @PPYFB                          S01117
     C                     MOVEL@SPYFB    @PPYFA                          S01117
     C           @PPYFA    IFEQ *BLANK                                    050727
     C                     MOVEL@@PYFB    @PPYFA                          050727
     C                     END                                            050727
      *
      * Pay To (Purchases)
     C           @STDTP    IFEQ 'TP'
      *
      *    .. if entered, must be a valid Client, Shortname or Nostro
     C                     MOVE *BLANKS   @@CUST  6                       065894
     C           @SPAYT    IFNE *BLANKS
     C***********          MOVEL@SPAYT    @WCUST                          S01117
     C***********          TESTN          @WCUST     35                   S01117
     C************IN35     IFEQ '1'                                       S01117
     C***********          MOVEL@SPAYT    CNUM                            S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADD0         CNUM                            S01117
     C***********          END                                            S01117
      *
     C***********          MOVE 'A'       RCDT                            S01117
     C***********@KEY3     CHAINCLINTCBF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          MOVEL@SPAYT    @WCSNM                          S01117
      *
     C***********@WCSNM    CHAINSNAMEF               01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
      *
     C***********          MOVEL@SPAYT    @KTB2                           S01117
     C***********@KTBT2    CHAINTABLET2F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C           @SSMTH    IFEQ '01'                                      S01117
     C           @SSMTH    OREQ '07'                                      S01117
     C           @SSMTH    OREQ '08'                                      S01117
     C                     MOVEL@SPAYT    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL@SPAYT    @CPNC                           S01117
     C                     EXSR AOCNST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 323'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  57
     C                     END
     C                     ELSE                                           065894
     C                     MOVE BBCUST    @@CUST                          065894
     C                     END
     C                     END
      *
      *    .. entry only allowed if Settlement Methods '01' '07' '08'
     C           @SSMTH    IFNE '01'
     C           @SSMTH    ANDNE'07'
     C           @SSMTH    ANDNE'08'
     C                     MOVE ' 324'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  57
     C                     END
     C                     END
     C                     END
      *
     C* IF PAY TO IS VALID MOVE VALUE TO PARAMETER
     C           *IN57     IFEQ '0'
     C           @@CUST    IFNE *BLANKS                                   065894
     C                     MOVEL@@CUST    @PPAYT                          065894
     C                     ELSE                                           065894
     C                     MOVEL@SPAYT    @PPAYT
     C                     END                                            065894
     C                     END
      *
     C                     ELSE
      *
      * Pay to (Sales)
     C           @STDTP    IFEQ 'TS'
      *
      *    .. entry only allowed for certain Settlement Methods
     C           @SPAYT    IFNE *BLANKS
     C           @SSMTH    ANDNE'01'
     C           @SSMTH    ANDNE'02'
     C           @SSMTH    ANDNE'05'
     C           @SSMTH    ANDNE'07'
     C           @SSMTH    ANDNE'08'
     C           @SSMTH    ANDNE'12'
     C           @SSMTH    ANDNE'14'
     C           @SSMTH    ANDNE'15'
     C                     MOVE ' 329'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  57
     C                     END
      *
      *    .. for certain Settlement Methods must reference an active
      *                                Nostro for settlement currency
     C           @SSMTH    IFEQ '01'
     C           @SSMTH    OREQ '02'
     C           @SSMTH    OREQ '07'
     C           @SSMTH    OREQ '08'
     C           @SSMTH    OREQ '12'
     C**********           MOVE @SPAYT    WFL10                                               CGL029
     C                     MOVE @SPAYT    WFL16                                               CGL029
     C***********          MOVEL@SPAYT    @KNN                            S01117
     C***********@KNN      IFEQ *BLANKS                                   S01117
     C***********          MOVE '00'      @KNN                            S01117
     C***********          END                                            S01117
     C***********          MOVEL@SSETC    @KCCY2                          S01117
     C***********@KTBTL    CHAINTABLETLF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     MOVEL@SSETC    P@CYCD                          S01117
     C                     MOVEL@SPAYT    P@NONB                          S01117
     C                     EXSR AONOST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C********** WFL10     ORNE *BLANKS                                                       CGL029
     C           WFL16     ORNE *BLANKS                                                       CGL029
     C                     MOVE ' 330'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  57
     C*                                                                   S01195
     C*   Find nostro location code for holiday validation                S01195
     C*                                                                   S01195
     C                     ELSE                                           S01195
     C                     MOVELA7CUST    @WPAYT                          E36794
     C           @SPAYT    IFNE @OPAYT                                    S01195
     C                     MOVE '*DBERR ' @RTCD                           S01195
     C                     MOVE A7BRCD    @DSNB                           S01195
     C                     EXSR AOBRCH                                    S01195
     C                     MOVE A8LCCD    ZLOC                            S01195
     C*                                                                   S01195
     C*    .. if Clearance Type '1' or '2', must not be holiday in        S01195
     C*                                        Euroclear currency         S01195
     C*                                                                   S01195
     C           @SCLTY    IFEQ '1'                                       S01195
     C           @SCLTY    OREQ '2'                                       S01195
     C                     Z-ADD@PTDVD    ZDAYNO                          S01195
     C                     MOVE BVEUCY    ZCCY                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W17'    @EA,E                           S01195
     C                     ADD  1         E                               S01195
     C                     SETON                     1157                 S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C*    .. if Clearance Type '3' or '4', must not be holiday in        S01195
     C*                                            Cedel currency         S01195
     C           @SCLTY    IFEQ '3'                                       S01195
     C           @SCLTY    OREQ '4'                                       S01195
     C                     Z-ADD@PTDVD    ZDAYNO                          S01195
     C                     MOVE BVCCCY    ZCCY                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W18'    @EA,E                           S01195
     C                     ADD  1         E                               S01195
     C                     SETON                     1157                 S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C*    .. if Clearance Type '2','4' or '5', must not be holiday in    S01195
     C*                                         settlement currency       S01195
     C           @SCLTY    IFEQ '2'                                       S01195
     C           @SCLTY    OREQ '4'                                       S01195
     C           @SCLTY    OREQ '5'                                       S01195
     C           @SSETC    IFNE *BLANKS                                   S01195
     C                     Z-ADD@PTDVD    ZDAYNO                          S01195
     C                     MOVE @SSETC    ZCCY                            S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C           BFCYCD    IFNE *BLANKS                                   S01195
     C                     MOVE BFCYCD    ZCCY                            S01195
     C                     ELSE                                           S01195
     C                     MOVE NMCYA     ZCCY                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C                     END                                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W19'    @EA,E                           S01195
     C                     ADD  1         E                               S01195
     C                     SETON                     1157                 S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C*    .. must not be a holiday in value currency                     S01195
     C**   .. If S01509 on, must not be a holiday in nominal currency     S01509
     C*                                                                   S01195
     C                     Z-ADD@PTDVD    ZDAYNO                          S01195
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE NMCYA     ZCCY                            S01509
     C                     ELSE                                           S01509
     C                     MOVE VLCY      ZCCY                            S01195
     C                     END                                            S01509
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     MOVE ' W20'    @EA,E                           S01195
     C                     ADD  1         E                               S01195
     C                     SETON                     1157                 S01195
     C                     ELSE                                           S01195
     C*                                                                   S01195
     C*****..*must*not*be*a*holiday*in*payment*currency************S01195 065524
     C***********                                                  S01195 065524
     C***********          Z-ADD@PTDVD    ZDAYNO                   S01195 065524
     C***********          MOVE SPYC      ZCCY                     S01195 065524
     C***********          EXSR ZCHKH                              S01195 065524
     C***********ZIND      IFEQ 'H'                                S01195 065524
     C***********          MOVE ' W21'    @EA,E                    S01195 065524
     C***********          ADD  1         E                        S01195 065524
     C***********          SETON                     1157          S01195 065524
     C***********          END                                     S01195 065524
     C                     END                                            S01195
     C                     END                                            S01195
     C                     END
     C                     END
      *
      *    .. if Settlement Method '05' must reference an active
      *             account on ACCNT for Pay To Branch
     C           @SSMTH    IFEQ '05'
     C                     TESTN          @SPAYT     35
     C           *IN35     IFEQ '1'
     C***********          MOVE @SPAYT    @DSACT                          S01117
     C**********           MOVE @SPAYT    WFLD6                                        S01117 CGL029
     C                     MOVEL@SPAYT    CNUM
     C**********           MOVELWFLD6     ACOD                                         S01117 CGL029
     C**********           MOVE WFLD6     ACSQ                                         S01117 CGL029
     C                     MOVE @SPAYT    WFLD12                                              CGL029
     C                     MOVELWFLD12    ACOD                                                CGL029
     C                     MOVE WFLD12    ACSQ                                                CGL029
     C                     MOVEL@SSETC    CCY
     C***********          MOVE @SPYTB    @WPYTB  30                      S01117
     C                     MOVE @SPYTB    BRCA                            S01117
     C           @KEY2     CHAINACCNTABF             01
     C***********          Z-ADDCNUM      WSCNUM                    S01496081490
     C                     END
     C           *IN35     IFEQ '0'
     C           *IN01     OREQ '1'
     C           RECI      OREQ '*'
     C***********BRCD      ORNE @WPYTB                                    S01117
     C***********DACO      ORGT @PTDVD                                    E21059
     C***********DACO      ORGE @PTDVD                             E21059 064939
     C           DACO      ORGT @PTDVD                                    064939
     C           ACST      OREQ 'C'
     C                     MOVE ' 331'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  57
      *                                                                   E16843
      *    .. else check account is not blocked                           E16843
      *                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'3'       RETB           17               E16843
     C           @STDTP    IFEQ 'TS'                                      E16843
     C           *IN17     ANDEQ'1'                                       E16843
     C                     MOVE ' 331'    @EA,E                           E16843
     C                     ADD  1         E                               E16843
     C                     SETON                     11  57               E16843
     C                     END                                            E16843
      *                                                                   E16843
     C                     END
     C**********           Z-ADDCNUM      @WPAYT                                             CSD027A
     C                     MOVE CNUM      @WPAYT                                             CSD027A
     C                     END
      *
      *    .. if Settlement Method '14' must reference an active
      *                       account on ACNUM
     C           @SSMTH    IFEQ '14'
     C***********          MOVE @SPYTB    @WPYTB                          S01117
     C                     MOVEL@SPAYT    @WPT10 10
     C                     TESTN          @WPT10     35
     C           *IN35     IFEQ '1'
     C                     MOVEL@SPAYT    @KEY10
     C           @KEY10    CHAINACNUMF               01
     C***********          Z-ADDCNUM      WSCNUM                    S01496081490
     C           *IN01     IFEQ '0'
     C           RECI      ANDNE'*'
     C           @KEY2     CHAINACCNTABF             01
     C***********          Z-ADDCNUM      WSCNUM                    S01496081490
     C                     END
     C                     END
      *
     C           *IN35     IFEQ '0'
     C           *IN01     OREQ '1'
     C           RECI      OREQ '*'
     C***********DACO      ORGE @PTDVD                             E21059 064939
     C           DACO      ORGT @PTDVD                                    064939
     C***********DACO      ORGT @PTDVD                                    E21059
     C           ACST      OREQ 'C'
     C           CCY       ORNE @SSETC
     C***********BRCD      ORNE @WPYTB                                    S01117
     C           BRCA      ORNE @SPYTB                                    S01117
     C           @SPYTB    ANDNE*BLANK                                    050727
     C                     MOVE ' 332'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  57
      *                                                                   E16843
      *    .. else check account is not blocked                           E16843
      *                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'3'       RETB           17               E16843
     C           @STDTP    IFEQ 'TS'                                      E16843
     C           *IN17     ANDEQ'1'                                       E16843
     C                     MOVE ' 332'    @EA,E                           E16843
     C                     ADD  1         E                               E16843
     C                     SETON                     11  57               E16843
     C                     END                                            E16843
      *                                                                   E16843
     C                     END
     C**********           Z-ADDCNUM      @WPAYT                                             CSD027A
     C                     MOVE CNUM      @WPAYT                                             CSD027A
      *                                                                                       CGL014
      ** Check if balance remaining due to all debits posted across                           CGL014
      ** retail accounts is sufficient to cover the blocked amount                            CGL014
      *                                                                                       CGL014
     C           *IN57     IFEQ *OFF                                                          CGL014
     C           CGL014    ANDEQ'Y'                                                           CGL014
     C           COLF      ANDEQ'Y'                                                           CGL014
     C                     MOVE CNUM      PACNUM                                              CGL014
     C                     MOVE ACOD      PAACOD                                              CGL014
     C                     MOVE ACSQ      PAACSQ                                              CGL014
      *                                                                                       CGL014
     C                     CALL 'GL006000'                                                    CGL014
     C                     PARM ZCTRVL    PTAMNT 150                                          CGL014
     C                     PARM NMCY      PTCCY   3                                           CGL014
     C                     PARM BRCA      PABRCA  3                                           CGL014
     C                     PARM           PACNUM  6                                           CGL014
     C                     PARM CCY       PACCY   3                                           CGL014
     C                     PARM           PAACOD 10                                           CGL014
     C                     PARM           PAACSQ  2                                           CGL014
     C                     PARM ACNO      PAACNO 100                                          CGL014
     C                     PARM *BLANKS   PRTCD                                               CGL014
      *                                                                                       CGL014
      ** Error:  Available balance is not sufficient                                          CGL014
      ** to cover blocked amount                                                              CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ '*BLKERR'                                                     CGL014
     C                     MOVE ' 426'    @EA,E                                               CGL014
     C                     ADD  1         E                                                   CGL014
     C                     MOVE *ON       *IN62                                               CGL014
     C                     MOVE *ON       *IN11                                               CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
      ** Warning:  Balance is greater than blocked amount but less                            CGL014
      ** than minimum balance; minimum balance will be exceeded                               CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ '*WARN  '                                                     CGL014
     C                     MOVE ' W34'    @EA,E                                               CGL014
     C                     ADD  1         E                                                   CGL014
     C                     MOVE *ON       *IN62                                               CGL014
     C                     MOVE *ON       *IN11                                               CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
     C                     END
      *
      *    .. if Settlement Method '15' may reference an active
      *                                account on ACCNT
     C           @SSMTH    IFEQ '15'
     C           @SPAYT    ANDNE*BLANKS
     C                     TESTN          @SPAYT     35                   067531
     C           *IN35     IFEQ '1'                                       067531
     C**********           MOVE @SPAYT    WFLD6                                        067531 CGL029
     C                     MOVEL@SPAYT    CNUM                            067531
     C**********           MOVELWFLD6     ACOD                                         067531 CGL029
     C**********           MOVE WFLD6     ACSQ                                         067531 CGL029
     C                     MOVE @SPAYT    WFLD12                                              CGL029
     C                     MOVELWFLD12    ACOD                                                CGL029
     C                     MOVE WFLD12    ACSQ                                                CGL029
     C                     ELSE                                           067531
     C                     Z-ADD0         ACOD                            067531
     C                     Z-ADD0         ACSQ                            067531
     C                     END                                            067531
     C***********          MOVE @SPYTB    @WPYTB                          S01117
     C                     MOVEL@SPAYT    @WCSNM
     C***********@WCSNM    CHAINSNAMEF               01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
      *
     C                     MOVEL@SPAYT    @WCUST
     C                     TESTN          @WCUST     35
     C************IN35     IFEQ '1'                                       S01117
     C***********          MOVEL@SPAYT    CNUM                            S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADD0         CNUM                            S01117
     C***********          END                                            S01117
     C           *IN35     IFEQ '0'                                       S01117
     C                     MOVE *BLANKS   @WCUST                          S01117
     C                     END                                            S01117
     C                     ELSE                                           065429
     C                     MOVE *BLANKS   @SPAYT                          065429
     C                     MOVELBBCUST    @SPAYT                          065429
     C                     MOVELBBCUST    @WCUST                          065429
     C                     END
     C***********          MOVE '1'       RCDT                            S01117
     C***********@KEY3     CHAINCLINTSEF             01                   S01117
      *
     C************IN01     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          Z-ADDCNUM      @WPAYT  60                      S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 333'    @EA,E                           065429
     C                     ADD  1         E                               065429
     C                     SETON                     11  57               065429
     C                     ELSE                                           065429
     C*                                                                   065429
     C* Set up a/c for output                                             065429
     C           ACOD      IFEQ 0                                         067531
     C           ACSQ      ANDEQ0                                         067531
     C                     MOVELBFCUST    @WCSNM                          065429
     C           BFACCD    IFNE *BLANKS                                   065429
     C                     MOVE BFACCD    @WCSNM                          065429
     C                     ELSE                                           065429
     C**********           MOVE '0000'    @WCSNM                                       065429 CGL029
     C                     MOVE *ZEROS    WZACCD                                              CGL029
     C                     MOVE WZACCD    @WCSNM                                              CGL029
     C                     END                                            065429
     C                     MOVEL@WCSNM    @SPAYT                          065429
     C                     MOVE BFACSN    @SPAYT                          065429
     C*                                                                   065429
     C**********           MOVELBFCUST    @WPAYT  60                                  S01117 CSD027A
     C                     MOVELBFCUST    @WPAYT  6                                          CSD027A
     C                     MOVELBFCUST    CNUM                            S01117
     C                     MOVELBFACCD    ACOD                            S01117
     C                     Z-ADDBFACSN    ACSQ                            S01117
     C                     END                                            067531
     C***********          MOVE @SPAYT    BRCA                     S01117 065429
     C           @SPYTB    IFNE *BLANKS                                   087651
     C                     MOVE @SPYTB    BRCA                            087651
     C                     ELSE                                           087651
     C                     MOVE @SBRCD    BRCA                            065429
     C                     END                                            087651
     C                     MOVEL@SSETC    CCY
     C***********          MOVELC1AC      ACOD                            S01117
     C***********          Z-ADDC1SQ      ACSQ                            S01117
     C           @KEY2     CHAINACCNTABF             01
     C***********          Z-ADDCNUM      WSCNUM                    S01496081490
     C***********          END                                            065429
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C***********DACO      ORGE @PTDVD                             E21059 064939
     C           DACO      ORGT @PTDVD                                    064939
     C***********DACO      ORGT @PTDVD                                    E21059
     C           ACST      OREQ 'C'
     C***********BRCD      ORNE @WPYTB                                    S01117
     C                     MOVE ' 333'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  57
      *                                                                   E16843
      *    .. else check account is not blocked                           E16843
      *                                                                   E16843
     C                     ELSE                                           E16843
     C                     TESTB'3'       RETB           17               E16843
     C           @STDTP    IFEQ 'TS'                                      E16843
     C           *IN17     ANDEQ'1'                                       E16843
     C                     MOVE ' 333'    @EA,E                           E16843
     C                     ADD  1         E                               E16843
     C                     SETON                     11  57               E16843
     C                     END                                            E16843
      *                                                                   E16843
     C                     END
     C**********           Z-ADDCNUM      @WPAYT                                             CSD027A
     C                     MOVE CNUM      @WPAYT                                             CSD027A
     C                     END
     C                     END                                            065429
      *
     C                     END
      *                                                                   065429
      *  Pay From may not be blank with settlement method 15              065429
      *                                                                   065429
     C           @SSMTH    IFEQ '15'                                      065429
     C           @SPAYT    ANDEQ*BLANKS                                   065429
     C                     MOVE ' 377'    @EA,E                           065429
     C                     ADD  1         E                               065429
     C                     SETON                     11  55               065429
     C                     END                                            065429
      *                                                                   065429
     C** If settlement method is 04/05/14/15 and counterparty was         081490
     C** entered, settlement a/c customer must be the same                081490
     C*                                                                   081490
     C           S01496    IFEQ 'Y'                                       081490
     C           WCHECK    IFEQ 'Y'                                       081490
     C************         MOVE @SSMTH    ZMETH   20               081490 099817
     C************         Z-ADD@PTCNR    ZCNUM   60               081490 099817
     C***********          MOVE @SPYFM    ZSETI  12                 081490093376
     C***********          MOVE @SPYFB    BRCA    3                 081490093376
     C***********          MOVE @SPYFB    ZBRCA                     085862093376
     C************         MOVE @SPAYT    ZSETI  12                093376 099817
     C************         MOVE @SPYTB    BRCA    3                093376 099817
     C************         MOVE @SPYTB    ZBRCA                    093376 099817
     C************         MOVE @SSETC    ZCCY    3                081490 099817
     C************         MOVE MBIN      BJMBDI  1                081490 099817
     C************         MOVE *BLANKS   DBFILE                   081490 099817
     C************         EXSR ZSETAC                             081490 099817
     C************                                                 081490 099817
     C***CHECK*FOR DATABASE ERROR IN ZSETAC                        081490 099817
     C************                                                 081490 099817
     C***********DBFILE    IFNE *BLANKS                            081490 099817
     C************         MOVELDBFILE    @DBFIL                   081490 099817
     C************         MOVELDBKEY     @DBKEY                   081490 099817
     C************         MOVELDBASE     @DBASE                   081490 099817
     C************         EXSR *PSSR                              081490 099817
     C************         END                                     081490 099817
     C************                                                 081490 099817
     C************LOCK     IN   LDA                                081490 099817
     C************         MOVEL@PTCNR    WWCSNM                   081490 099817
     C************         MOVELZSETO     WWCUST                   081490 099817
     C************                                                 081490 099817
     C***********WWCSNM    IFNE WWCUST                             081490 099817
     C           @WPAYT    IFNE @PTCNR                                    099817
     C                     MOVE ' W12'    @EA,E                           081490
     C                     ADD  1         E                               081490
     C                     SETON                     11  55               081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
     C*                                                                   081490
     C**********           MOVEL@SPAYT    @OPAYT 12                                    S01117 CGL029
     C                     MOVEL@SPAYT    @OPAYT 18                                           CGL029
     C                     MOVEL@SPAYT    @PPAYT
      *
      * Pay From (Sales)
      *
      *    .. entry only allowed for Settlement Methods '01' '07' '08'
     C                     MOVE *BLANKS   @@CUST                          065894
     C           @SPYFM    IFNE *BLANKS
     C           @SSMTH    IFNE '01'
     C           @SSMTH    ANDNE'07'
     C           @SSMTH    ANDNE'08'
     C                     MOVE ' 316'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
     C***********          END                                            S01117
     C                     ELSE                                           S01117
      *
      *    .. if entered, must be a valid Customer, Shortname or
      *                             counterparty Nostro
     C***********          MOVEL@SPYFM    @WCUST                          S01117
     C***********          TESTN          @WCUST     35                   S01117
     C************IN35     IFEQ '1'                                       S01117
     C***********          MOVEL@SPYFM    CNUM                            S01117
     C***********          MOVE 'A'       RCDT                            S01117
     C***********@KEY3     CHAINCLINTCBF             01                   S01117
     C***********          END                                            S01117
     C************IN35     IFEQ '0'                                       S01117
     C************IN01     OREQ '1'                                       S01117
     C************IN01     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C***********          MOVEL@SPYFM    @WCSNM                          S01117
      ***********                                                         S01117
     C***********@WCSNM    CHAINSNAMEF               01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
      ***********                                                         S01117
     C***********          MOVE @SPYFM    @KTB2                           S01117
     C***********@KTBT2    CHAINTABLET2F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     MOVEL@SPYFM    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL@SPYFM    @CPNC                           S01117
     C                     EXSR AOCNST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 317'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
     C                     END
     C                     ELSE                                           065894
     C                     MOVE BBCUST    @@CUST                          065894
     C                     END
     C                     END
     C                     END
      *
     C           @@CUST    IFNE *BLANKS                                   065894
     C                     MOVEL@@CUST    @PPYFM                          065894
     C                     ELSE                                           065894
     C                     MOVEL@SPYFM    @PPYFM
     C                     END                                            065894
     C                     END
     C*                                                                   S01117
     C* Pay to branch                                                     S01117
     C* Determine default                                                 050727
     C*                                                                   050727
     C           @SSMTH    IFEQ '01'                                      050727
     C           @SSMTH    OREQ '02'                                      050727
     C           @SSMTH    OREQ '07'                                      050727
     C           @SSMTH    OREQ '08'                                      050727
     C           @SSMTH    OREQ '12'                                      050727
     C                     MOVELA7BRCD    @@PYTB                          050727
     C                     ELSE                                           050727
     C           @SSMTH    IFEQ '14'                                      050727
     C           @SSMTH    OREQ '15'                                      087651
     C                     MOVELBRCA      @@PYTB                          050727
     C                     ELSE                                           050727
     C           @SSMTH    IFNE '05'                                      050727
     C                     MOVEL@PTDBA    @@PYTB                          050727
     C                     END                                            050727
     C                     END                                            050727
     C                     END                                            050727
     C*                                                                   S01117
     C*                                                                   S01117
     C*    .. for Settlement Method 01, 02, 07, 08 and 12,                S01117
     C*       Pay To branch must equal branch of the Nostro               S01117
     C*                                                                   S01117
     C           @SSMTH    IFEQ '01'                                      S01117
     C           @SSMTH    OREQ '02'                                      S01117
     C           @SSMTH    OREQ '07'                                      S01117
     C           @SSMTH    OREQ '08'                                      S01117
     C           @SSMTH    OREQ '12'                                      S01117
     C           @SPYTB    IFNE A7BRCD                                    S01117
     C           @SPYTB    ANDNE*BLANK                                    050727
     C           @STDTP    ANDEQ'TS'                                      S01117
     C                     MOVE ' 326'    @EA,E                           S01117
     C                     ADD  1         E                               S01117
     C                     SETON                     5811                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   050727
     C*    .. for Settlement Method 14                                    050727
     C*       Pay To branch must equal branch of the account              050727
     C*                                                                   050727
     C           @SSMTH    IFEQ '14'                                      050727
     C           @SSMTH    OREQ '15'                                      087651
     C           @SPYTB    IFNE BRCA                                      050727
     C           @SPYTB    ANDNE*BLANK                                    050727
     C           @STDTP    ANDEQ'TS'                                      050727
     C                     MOVE ' 326'    @EA,E                           050727
     C                     ADD  1         E                               050727
     C                     SETON                     5811                 050727
     C                     END                                            050727
     C                     END                                            050727
     C*                                                                   S01117
     C*    .. for Settlement Method other than 01, 02, 05, 07, 08, 12 &   S01117
     C********14,*Pay*To*branch*must*equal*Trade*Booking*branch**  S01117 066097
     C*  14 & 15, Pay To branch must equal Trade Booking branch           066097
     C*                                                                   S01117
     C           @SPYTB    IFNE @SBRCD                                    S01117
     C           @SPYTB    ANDNE*BLANK                                    050727
     C           @STDTP    ANDEQ'TS'                                      050727
     C           @SSMTH    ANDNE'01'                                      S01117
     C           @SSMTH    ANDNE'02'                                      S01117
     C           @SSMTH    ANDNE'05'                                      S01117
     C           @SSMTH    ANDNE'07'                                      S01117
     C           @SSMTH    ANDNE'08'                                      S01117
     C           @SSMTH    ANDNE'12'                                      S01117
     C           @SSMTH    ANDNE'14'                                      S01117
     C           @SSMTH    ANDNE'15'                                      066097
     C                     MOVE ' 328'    @EA,E                           S01117
     C                     ADD  1         E                               S01117
     C                     SETON                     5811                 S01117
     C                     END                                            S01117
      *
      **Pay*To*branch*if*entered*must*be*active*code*on*TABLETR*******    S01117
      * Pay to branch if entered must be active code on SDNOSTPD          S01117
     C           @SPYTB    IFNE *BLANKS
     C***********          MOVE @SPYTB    @KTBTR                          S01117
     C***********@KTBTR    CHAINTABLETRF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     MOVE @SPYTB    @DSNB                           S01117
     C                     EXSR AOBRCH                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 321'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  58
     C                     END
     C                     END
     C***********          MOVEL@SPYTB    @PPYTB                          S01117
     C                     MOVEL@SPYTB    @PPYTA                          S01117
     C           @PPYTA    IFEQ *BLANK                                    050727
     C                     MOVEL@@PYTB    @PPYTA                          050727
     C                     END                                            050727
      *
      * For a/c of 1
      *
      ********entry*only*allowed*for*Trade*sale**&*Settlement*Methods     E21060
      **************************************'01'*'07'*or*'08'             E21060
     C* .. entry only allowed for Trade purchase & Settlement Methods     E21060
     C*                                     '01' '07' or '08'             E21060
     C*
     C           @STFA1    IFNE *BLANKS
     C***********@STDTP    IFNE 'TS'                                      E21060
     C***********@STDTP    OREQ 'TS'                                      E21060
     C           @STDTP    IFNE 'TP'                                      E21060
     C           @STDTP    OREQ 'TP'                                      E21060
     C           @SSMTH    ANDNE'01'
     C           @SSMTH    ANDNE'07'
     C           @SSMTH    ANDNE'08'
     C                     MOVE ' 335'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  59
     C                     END
      *
      *    .. if entered, must be a valid Customer, Shortname or
      *                             counterparty Nostro
     C***********          MOVEL@STFA1    @WCUST                          S01117
     C***********          TESTN          @WCUST     35                   S01117
     C************IN35     IFEQ '1'                                       S01117
     C***********          MOVEL@STFA1    CNUM                            S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADD0         CNUM                            S01117
     C***********          END                                            S01117
     C***********          MOVE 'A'       RCDT                            S01117
     C***********@KEY3     CHAINCLINTCBF             01                   S01117
     C************IN01     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          MOVELCNUM      @PTDFA                          S01117
      ***********                                                         S01117
     C***********          ELSE                                           S01117
     C***********          MOVEL@STFA1    @WCSNM                          S01117
     C***********@WCSNM    CHAINSNAMEF               01                   S01117
     C************IN01     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          MOVELCNUM      @PTDFA                          S01117
      ***********                                                         S01117
     C***********          ELSE                                           S01117
     C***********          MOVEL@STFA1    @KTB2                           S01117
     C***********@KTBT2    CHAINTABLET2F             01                   S01117
     C************IN01     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C                     MOVEL*BLANKS   @WCSNM                          S01117
     C                     MOVEL@STFA1    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVELBBCUST    @PTDFA                          S01117
     C                     ELSE                                           S01117
     C                     MOVEL@STFA1    @CPNC                           S01117
     C                     EXSR AOCNST                                    S01117
     C           @RTCD     IFEQ *BLANKS                                   S01117
     C                     MOVEL@STFA1    @PTDFA
      *
     C                     ELSE
     C                     MOVE ' 336'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  59
     C                     END
     C                     END
     C***********          END                                            S01117
     C                     END
      *
      * A/c sequence
      *
     C*****..*if*entered,*must*be*in*the*range*for*Pay*To*Branch**********S01117
     C*    .. if entered, must be numeric                                 S01117
     C           @SASNM    IFNE *BLANKS
     C                     TESTN          @SASNM     35
     C************IN35     IFEQ '1'
     C***********          MOVE @SPYTB    @KTBTR
     C***********@KTBTR    CHAINTABLETRF             01
     C***********          MOVE @SASNM    @WKNM   20
     C***********          END
      *
     C           *IN35     IFEQ '0'
     C************IN01     OREQ '1'                                       S01117
     C************IN01     OREQ '0'                                       S01117
     C***********RECI      ANDEQ'*'                                       S01117
     C************IN01     OREQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********@WKNM     ANDLTNSACS                                     S01117
     C************IN01     OREQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********@WKNM     ANDGTNEACS                                     S01117
     C                     MOVE ' 337'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  60
     C                     END
     C                     MOVEL@SASNM    @PASNM
     C                     END
      *
      * Deliver from
      *
     C           @PTINC    IFEQ 'C'
     C           @PTDMI    ANDNE'G'
     C           @WC1DI    IFEQ 'S'
     C           @WC1DI    OREQ 'D'
     C           @WC1DI    OREQ 'M'
     C           @PTDTP    ANDEQ'TS'
     C           @SDELF    IFEQ *BLANKS
     C           @SCLTY    ANDNE'0'                                       E31953
     C                     MOVEL' 338'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
     C                     END
     C                     END
      *
     C           @SDELF    IFNE *BLANKS
      *
     C                     MOVEL@SDELF    @WK1    1
     C           @WK1      IFLT '0'
     C           @WK1      ORGT '9'
     C                     MOVEL@SDELF    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE *BLANKS   @WCUST                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BBCUST    @WCUST                          S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C                     MOVEL@SDELF    @WCUST                          S01117
     C                     END                                            S01117
     C***********@SDELF    CHAINSNAMEF               01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD0         CNUM                            S01117
     C***********          END                                            S01117
     C***********          ELSE                                           S01117
     C***********          MOVEL@SDELF    CNUM                            S01117
     C***********          END                                            S01117
      ***********                                                         S01117
     C***********          MOVE '1'       RCDT                            S01117
     C***********@KEY3     CHAINCLINTSEF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BFCLAS    OREQ 'S'                                       043802
     C           BFCLAS    OREQ 'D'                                       043802
     C                     MOVE ' 338'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
     C***********          MOVE C1DI      @FC1DI  1                       S01117
     C***********          Z-ADDCNUM      @WDELF                          S01117
     C***********          Z-ADDCNUM      @PDELF                          S01117
     C                     MOVE BFCLAS    @FC1DI  1                       S01117
     C                     MOVE BFCUST    @WDELF                          S01117
     C                     MOVE BFCUST    @PDELF                          S01117
     C                     ELSE
     C                     MOVE *BLANK    @FC1DI
     C**********           Z-ADD0         @WDELF  60                                         CSD027A
     C                     MOVE *BLANKS   @WDELF  6                                          CSD027A
     C                     END
     C/COPY WNCPYSRC,SE3002C023
      *
      ****..**Check*combinations*of*clearance*type/discretionary*ind.*****S01176
      *   ..  Check combinations of clearance type/classification.        S01176
      *
     C           @SCLTY    IFEQ '0'
     C           @SDELF    ANDNE*BLANKS
     C                     MOVE ' 339'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
      *
     C           @SCLTY    IFEQ '1'
     C           @FC1DI    ANDNE'E'
     C                     MOVE ' 339'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
      *
     C           @SCLTY    IFEQ '2'
     C           @STDTP    IFEQ 'TS'
     C           @FC1DI    ANDNE'E'
     C                     MOVE ' 339'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
     C                     END
      *                                                                   S01175
     C           @SCLTY    IFEQ '2'                                       S01175
     C           @STDTP    IFEQ 'TP'                                      S01175
     C           @FC1DI    ANDEQ'E'                                       S01175
     C                     MOVE ' 339'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     11  61               S01175
     C                     END                                            S01175
     C                     END                                            S01175
      *
     C           @SCLTY    IFEQ '3'
     C           @FC1DI    ANDNE'C'
     C                     MOVE ' 339'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
      *
     C           @SCLTY    IFEQ '4'
     C           @STDTP    IFEQ 'TS'
     C           @FC1DI    ANDNE'C'
     C                     MOVE ' 339'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
     C                     END
      *
     C           @SCLTY    IFEQ '5'
     C           @STDTP    ANDEQ'TS'                                      028348
     C           @FC1DI    IFEQ 'E'
     C           @FC1DI    OREQ 'C'
     C                     MOVE ' 339'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  61
     C                     END
     C                     END
     C*                                                                   067630
     C** Warning error if depot is not on investment type for security    067630
     C** or there is no security reference code for the depot             067630
     C*                                                                   067630
     C           @STDTP    IFEQ 'TS'                                      067630
     C*                                                                   067630
     C           @FC1DI    IFEQ 'E'                                       067630
     C           @FC1DI    OREQ 'C'                                       067630
     C********** @FC1DI    OREQ 'K'                                067630 CSE022
     C           @FC1DI    OREQ 'X'                                       067630
     C           @KEY1     CHAININVTPDF              44                   067630
     C           *IN44     IFEQ '1'                                       067630
     C           RECI      OREQ '*'                                       067630
     C                     Z-ADD26        @DBASE            ************  067630
     C                     MOVEL'INVTP'   @DBFIL            * DATABASE *  067630
     C                     MOVELNMCYA     @DBKEY            * ERROR 26 *  067630
     C                     MOVE SITP      @DBKEY            ************  067630
     C                     EXSR *PSSR                                     067630
     C                     ELSE                                           067630
     C           @PDELF    IFEQ SDC1                                      067630
     C           DASR      ANDNE*BLANKS                                   067630
     C           @PDELF    OREQ SDC2                                      067630
     C           DCSR      ANDNE*BLANKS                                   067630
     C           @PDELF    OREQ SDC3                                      067630
     C           DDSR      ANDNE*BLANKS                                   067630
     C           @SCLTY    OREQ '5'                                       067630
     C                     ELSE                                           067630
     C           @PDELF    IFNE SPDELF                                    068476
     C                     MOVE @PDELF    SPDELF                          068476
     C           *LIKE     DEFN @PDELF    SPDELF                          068476
     C                     MOVE ' W09'    @EA,E                           067630
     C                     ADD  1         E                               067630
     C                     MOVE '1'       *IN61                           067630
     C                     MOVE '1'       *IN11                           067630
     C                     END                                            068476
     C                     END                                            067630
     C                     END                                            067630
     C                     END                                            067630
     C                     END                                            067630
      *
      *****If Pay Code*is*'1'*&*Clearance*Type*1*-*4,*Pay*To*(Sales)      030834
      *****must*refer*to*same*customer*as*Deliver*From                    030834
      *    If Pay Code is '1' or '5' Clearance Type 1 - 4, Pay To         030834
      *    (Sales) must refer to same customer as Deliver From            030834
      *    if settlement is not '00' or '04'                              030834
     C           @STDTP    IFEQ 'TS'
     C           @SPCOD    IFEQ '1'
     C           @SPCOD    OREQ '5'                                       030834
     C***********@SCLTY    ANDGE'1'                                       030834
     C           @SCLTY    IFGE '1'                                       030834
     C           @SCLTY    ANDLE'4'
     C           @WPAYT    ANDNE@WDELF
     C           @SSMTH    ANDNE'00'                                      030834
     C           @SSMTH    ANDNE'04'                                      030834
     C                     MOVE ' 334'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  57
     C                     END
     C                     END
     C                     END                                            030834
      *
      * Deliver to
      *
     C           @PTINC    IFEQ 'C'
     C           @PTDMI    ANDNE'G'
     C           @WC1DI    IFEQ 'S'
     C           @WC1DI    OREQ 'D'
     C           @WC1DI    OREQ 'M'
     C           @PTDTP    ANDEQ'TP'
     C           @SDELT    IFEQ *BLANKS
     C           @SCLTY    ANDNE'0'                                       E31953
     C                     MOVEL' 340'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  62
     C                     END
     C                     END
     C                     END
     C*
      * Deliver to if entered, must be a valid Customer or Shortname
     C                     MOVE *BLANK    @TC1DI
     C**********           Z-ADD0         @WDELT  60                                         CSD027A
     C                     MOVE *BLANKS   @WDELT  6                                          CSD027A
     C*
     C           @SDELT    IFNE *BLANKS
     C*
     C                     MOVEL@SDELT    @WK1
     C           @WK1      IFLT '0'
     C           @WK1      ORGT '9'
     C                     MOVEL@SDELT    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE *BLANKS   @WCUST                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BBCUST    @WCUST                          S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C                     MOVEL@SDELT    @WCUST                          S01117
     C                     END                                            S01117
     C***********@SDELT    CHAINSNAMEF               01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD0         CNUM                            S01117
     C***********          END                                            S01117
     C***********          ELSE                                           S01117
     C***********          MOVEL@SDELT    CNUM                            S01117
     C***********          END                                            S01117
      ***********                                                         S01117
     C***********          MOVE '1'       RCDT                            S01117
     C***********@KEY3     CHAINCLINTSEF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           BFCLAS    OREQ 'S'                                       043802
     C           BFCLAS    OREQ 'D'                                       043802
     C                     MOVE ' 340'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  62
     C                     END
     C***********          MOVE C1DI      @TC1DI  1                       S01117
     C***********          Z-ADDCNUM      @WDELT                          S01117
     C***********          Z-ADDCNUM      @PDELT                          S01117
     C                     MOVE BFCLAS    @TC1DI  1                       S01117
     C                     MOVE BFCUST    @WDELT                          S01117
     C                     MOVE BFCUST    @PDELT                          S01117
     C*
     C                     ELSE
     C                     MOVE *BLANKS   @TC1DI
     C**********           Z-ADD0         @WDELT                                             CSD027A
     C**********           Z-ADD0         @PDELT                                             CSD027A
     C                     MOVE *BLANKS   @WDELT                                             CSD027A
     C                     MOVE *BLANKS   @PDELT                                             CSD027A
     C                     END
      *
      ****..**Check*combinations*of*clearance*type/discretionary*ind.*****S01176
      *   ..  Check combinations of clearance type/classification.        S01176
      *
     C           @SCLTY    IFEQ '0'
     C           @SDELT    ANDNE*BLANKS
     C                     MOVE ' 341'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  62
     C                     END
      *
     C           @SCLTY    IFEQ '1'
     C           @TC1DI    ANDNE'E'
     C                     MOVE ' 341'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  62
     C                     END
      *
     C           @SCLTY    IFEQ '2'
     C           @STDTP    IFEQ 'TP'
     C           @TC1DI    ANDNE'E'
     C                     MOVE ' 341'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  62
     C                     END
     C                     END
      *
     C           @SCLTY    IFEQ '3'
     C           @TC1DI    ANDNE'C'
     C                     MOVE ' 341'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  62
     C                     END
      *
     C           @SCLTY    IFEQ '4'
     C           @STDTP    IFEQ 'TP'
     C           @TC1DI    ANDNE'C'
     C                     MOVE ' 341'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  62
     C                     END
     C                     END
      *
     C           @SCLTY    IFEQ '5'
     C           @STDTP    ANDEQ'TP'                                      028348
     C           @TC1DI    IFEQ 'E'
     C           @TC1DI    OREQ 'C'
     C                     MOVE ' 341'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  62
     C                     END
     C                     END
     C*                                                                   067630
     C** Warning error if depot is not on investment type for security    067630
     C** or there is no security reference code for the depot             067630
     C*                                                                   067630
     C           @STDTP    IFEQ 'TP'                                      067630
     C*                                                                   067630
     C           @TC1DI    IFEQ 'E'                                       067630
     C           @TC1DI    OREQ 'C'                                       067630
     C********** @TC1DI    OREQ 'K'                                067630 CSE022
     C           @TC1DI    OREQ 'X'                                       067630
     C           @KEY1     CHAININVTPDF              44                   067630
     C           *IN44     IFEQ '1'                                       067630
     C           RECI      OREQ '*'                                       067630
     C                     Z-ADD27        @DBASE            ************  067630
     C                     MOVEL'INVTP'   @DBFIL            * DATABASE *  067630
     C                     MOVELNMCYA     @DBKEY            * ERROR 27 *  067630
     C                     MOVE SITP      @DBKEY            ************  067630
     C                     EXSR *PSSR                                     067630
     C                     ELSE                                           067630
     C           @PDELT    IFEQ SDC1                                      067630
     C           DASR      ANDNE*BLANKS                                   067630
     C           @PDELT    OREQ SDC2                                      067630
     C           DCSR      ANDNE*BLANKS                                   067630
     C           @PDELT    OREQ SDC3                                      067630
     C           DDSR      ANDNE*BLANKS                                   067630
     C           @SCLTY    OREQ '5'                                       067630
     C                     ELSE                                           067630
     C           @PDELT    IFNE SPDELT                                    068476
     C                     MOVE @PDELT    SPDELT                          068476
     C           *LIKE     DEFN @PDELT    SPDELT                          068476
     C                     MOVE ' W10'    @EA,E                           067630
     C                     ADD  1         E                               067630
     C                     MOVE '1'       *IN62                           067630
     C                     MOVE '1'       *IN11                           067630
     C                     END                                            068476
     C                     END                                            067630
     C                     END                                            067630
     C                     END                                            067630
     C                     END                                            067630
     C*                                                                   S01190
     C* if receiving from outside Euroclear/Cedel to Euroclear Pay To     S01190
     C* is mandatory                                                      S01190
     C*                                                                   S01190
     C           @STDTP    IFEQ 'TP'                                      S01190
     C           @TC1DI    ANDEQ'E'                                       S01190
     C           @FC1DI    ANDNE'E'                                       S01190
     C           @FC1DI    ANDNE'C'                                       S01190
     C*                                                                   S01190
     C           @SPAYT    IFEQ *BLANKS                                   S01190
     C                     MOVE ' 506'    @EA,E                           S01190
     C                     ADD  1         E                               S01190
     C                     SETON                     5711                 S01190
     C                     END                                            S01190
     C                     END                                            S01190
      *
      *****If*Pay*Code*is*'1'*&*Clearance*Type*1*-*4,*Pay*From*(Purch)    030834
      *******must*refer*to*same*customer*as*Deliver*To                    030834
      *    If Pay Code is '1' or '5' & Clearance Type 1 - 4, Pay From     030834
      *    (Purch) must refer to same customer as Deliver To              030834
      *    if settlement is not '00' or '04'                              030834
     C           @STDTP    IFEQ 'TP'
     C           @SPCOD    IFEQ '1'
     C           @SPCOD    OREQ '5'                                       030834
     C***********@SCLTY    ANDGE'1'                                       030834
     C           @SCLTY    IFGE '1'                                       030834
     C           @SCLTY    ANDLE'4'
     C           @WPYFM    ANDNE@WDELT
     C           @SSMTH    ANDNE'00'                                      030834
     C           @SSMTH    ANDNE'04'                                      030834
     C                     MOVE ' 315'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  55
     C                     END
     C                     END
     C                     END                                            030834
     C*                                                                   S01175
     C** EUCLID CHANGES                                                   S01175
     C** Ensure that portfolio clients are not contacted via Euclid       065006
     C*                                                                   S01175
     C           @SDFFA    IFEQ *BLANKS                                   S01175
     C           @WC1DI    ANDNE'S'                                       065006
     C           @WC1DI    ANDNE'D'                                       065006
     C           @STDTP    ANDEQ'TP'                                      S01175
     C*                                                                   S01175
     C** Ind 25 used to prevent multiple occurrence of the same error     S01175
     C** code                                                             S01175
     C*                                                                   S01175
     C                     MOVE '0'       *IN25                           S01175
     C*                                                                   S01175
     C** Error 500 corresponds to error 373 in SE0050                     S01175
     C*                                                                   S01175
     C** Validation of Deliver From and Deliver To fields                 S01175
     C*                                                                   S01175
     C           @TC1DI    IFEQ 'E'                                       S01175
     C           @FC1DI    ANDEQ'E'                                       S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           *IN25     IFNE '1'                                       S01175
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           @WPN01    ANDNE'NP'                                      S01175
     C           @TC1DI    IFEQ 'E'                                       S01175
     C           @FC1DI    ANDNE'C'                                       S01190
     C           *IN25     IFNE '1'                                       S01175
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '5'                                       S01175
     C           @FC1DI    IFEQ 'C'                                       S01175
     C           @WPN02    ANDNE'P '                                      S01175
     C           @FC1DI    OREQ 'E'                                       S01175
     C           @WPN01    ANDNE'P '                                      S01175
     C           *IN25     IFNE '1'                                       S01175
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C*  065028 - If Deliver From is Cedel the counterparty must be       065028
     C*  a participant there.                                             065028
     C*                                                                   065028
     C           @WPN02    IFNE 'P '                                      S01175
     C*********  @TC1DI    IFEQ 'C'                                 S01175065028
     C           @FC1DI    IFEQ 'C'                                       065028
     C           *IN25     IFNE '1'                                       S01175
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           @FC1DI    IFEQ 'E'                                       S01175
     C           @TC1DI    ANDEQ'C'                                       S01175
     C           *IN25     IFNE '1'                                       S01175
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** Ensure that portfolio clients are not contacted via Euclid       065004
     C*                                                                   065004
     C           @STFA2    IFEQ *BLANKS                                   S01175
     C           @WC1DI    ANDNE'S'                                       065004
     C           @WC1DI    ANDNE'D'                                       065004
     C           @STDTP    ANDEQ'TS'                                      S01175
     C*                                                                   S01175
     C** Ind 25 used to prevent multiple occurrence of the same error     S01175
     C** code                                                             S01175
     C*                                                                   S01175
     C                     MOVE '0'       *IN25                           S01175
     C*                                                                   S01175
     C           @TC1DI    IFEQ 'E'                                       S01175
     C           @FC1DI    ANDEQ'E'                                       S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           *IN25     IFNE '1'                                       S01176
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           @WPN01    ANDNE'NP'                                      S01175
     C           @FC1DI    IFEQ 'E'                                       S01175
     C           @TC1DI    ANDNE'C'                                       S01190
     C           *IN25     IFNE '1'                                       S01176
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C*                                                                   S01175
     C           @WPN02    IFNE 'P '                                      S01175
     C           @TC1DI    IFEQ 'C'                                       S01175
     C           *IN25     IFNE '1'                                       S01176
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           @TC1DI    IFEQ 'E'                                       S01175
     C           @FC1DI    ANDEQ'C'                                       S01175
     C           *IN25     IFNE '1'                                       S01176
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '5'                                       S01175
     C           @TC1DI    IFEQ 'C'                                       S01175
     C           @WPN02    ANDNE'P '                                      S01175
     C           @TC1DI    OREQ 'E'                                       S01175
     C           @WPN01    ANDNE'P '                                      S01175
     C           *IN25     IFNE '1'                                       S01176
     C                     MOVE '1'       *IN25                           S01175
     C***********          MOVE ' 500'    @EA,E                    S01175 067629
     C                     MOVE ' 373'    @EA,E                           067629
     C                     ADD  1         E                               S01175
     C                     SETON                     11                   S01175
     C*********************SETON                     556162        S01175 074086
     C                     SETON                     6162                 074086
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
      * Validate the swift currency code of the value currrency           S01175
      * if one is defn. on the security record else validate              S01175
      * the swift code of the nominal currency.                           S01175
      * If S01509 on, use the swift code of the nominal currency.         S01509
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE @CCYS     VCCYS                           S01509
     C                     ELSE                                           S01509
     C           VLCYA     IFNE *BLANK                                    S01175
     C*                                                                   S01175
     C                     MOVE VLCYA     @AJCD                           S01175
     C***********@KTG10    CHAINTABTG10F             01                   S01175
     C************IN01     IFEQ '1'                                       S01175
     C***********RECI      OREQ '*'                                       S01175
     C***********          Z-ADD31        @DBASE           ***************S01175
     C***********          MOVEL'TABSE'   @DBFIL           * DB ERROR 31 *S01175
     C***********          MOVEL@KTG10    @DBKEY           ***************S01175
     C***********          EXSR SUB999                                    S01175
     C***********          END                                            S01175
     C************LIKE     DEFN CCYS      VCCYS                           S01175
     C***********          MOVE CCYS      VCCYS                           S01175
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C           *LIKE     DEFN A6SWCY    VCCYS                           S01117
     C                     MOVE A6SWCY    VCCYS                           S01117
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C                     MOVE @CCYS     VCCYS                           S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C                     END                                            S01509
     C*                                                                   S01175
     C***Error*501*corresponds*to*error*375*in*SE0050**************S01175 CSE022
     C**********                                                   S01175 CSE022
     C********** @TC1DI    IFEQ 'K'                                S01175 CSE022
     C********** VCCYS     IFNE 'DEM'                              S01175 CSE022
     C**********           MOVE ' 501'    @EA,E                    S01175 CSE022
     C**********           ADD  1         E                        S01175 CSE022
     C**********           SETON                     1162          S01175 CSE022
     C**********           END                                     S01175 CSE022
     C**********           END                                     S01175 CSE022
     C**********                                                   S01175 CSE022
     C***Error*502*corresponds*to*error*374*in*SE0050**************S01175 CSE022
     C**********                                                   S01175 CSE022
     C********** @FC1DI    IFEQ 'K'                                S01175 CSE022
     C********** VCCYS     IFNE 'DEM'                              S01175 CSE022
     C**********           MOVE ' 502'    @EA,E                    S01175 CSE022
     C**********           ADD  1         E                        S01175 CSE022
     C**********           SETON                     1161          S01175 CSE022
     C**********           END                                     S01175 CSE022
     C**********           END                                     S01175 CSE022
      *
      * For a/c of, if entered, must be a valid Customer or Shortname
     C           @STFA2    IFNE *BLANKS
     C                     MOVEL@STFA2    @WCUST
     C                     TESTN          @WCUST     35
     C************IN35     IFEQ '1'                                       S01117
     C***********          MOVEL@STFA2    CNUM                            S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADD0         CNUM                            S01117
     C***********          END
      ***********
     C***********          MOVE 'A'       RCDT
     C***********@KEY3     CHAINCLINTCBF             01
     C************IN01     IFEQ '0'
     C***********RECI      ANDNE'*'
     C***********          MOVELCNUM      DTFA
      ***********
     C***********          ELSE
     C***********          MOVEL@STFA2    @WCSNM                          S01117
     C***********@WCSNM    CHAINSNAMEF               01                   S01117
     C************IN01     IFEQ '0'                                       S01117
     C***********RECI      ANDNE'*'                                       S01117
     C***********          MOVELCNUM      @PDTFA                          S01117
      *
     C***********          ELSE                                           S01117
     C           *IN35     IFEQ '0'                                       S01117
     C                     MOVEL@STFA2    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '999999'  @WCUST                          067525
     C                     ELSE                                           067525
     C                     MOVE BBCUST    @WCUST                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 342'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  63
     C                     ELSE                                           S01117
     C***********          MOVE BFCUST    @PDTFA                   S01117 065546
     C                     MOVELBFCUST    @PDTFA                          065546
     C                     END                                            S01175
     C                     END                                            S01175
     C***********          MOVE '1'       RCDT                     S01175 S01117
     C***********@KEY3     CHAINCLINTSEF             01            S01175 S01117
     C************IN01     IFEQ '0'                                S01175 S01117
     C***********RECI      ANDNE'*'                                S01175 S01117
     C***********          MOVELCNUM      @PDTFA                   S01175 S01117
     C***********                                                  S01175 S01117
     C***********          ELSE                                    S01175 S01117
     C***********          MOVE ' 342'    @EA,E                    S01175 S01117
     C***********          ADD  1         E                        S01175 S01117
     C***********          SETON                     11  63        S01175 S01117
     C***********          END                                            S01117
     C***********          END                                            S01117
     C***********          END                                            S01175
     C***********          MOVEL@STFA2    @PTDFA                          S01175
      *
     C                     MOVEL@STDSI    @PTDSI
     C*                                                                   S01175
     C** Error 503 corresponds  to error 371 in SE0050                    S01175
     C*                                                                   S01175
     C** Ind 25 used to prevent multiple occurence of the same error      S01175
     C** code                                                             S01175
     C*                                                                   S01175
     C                     MOVE '0'       *IN25                           S01175
     C*                                                                   S01175
     C           @STDTP    IFEQ 'TP'                                      S01175
     C           @STFA2    ANDNE*BLANKS                                   S01175
     C                     MOVE ' 503'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     116325               S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @STDTP    IFEQ 'TS'                                      S01175
     C           @STFA2    ANDNE*BLANKS                                   S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '0'                                       S01175
     C           @STFA2    ANDNE*BLANKS                                   S01175
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 503'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     116325               S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '1'                                       S01175
     C           @WPN01    ANDNE'P '                                      S01175
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 503'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     116325               S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '2'                                       S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           @WPN01    ANDNE'NP'                                      S01175
     C           @TC1DI    ANDNE'C'                                       S01190
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 503'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     116325               S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '3'                                       S01175
     C           @WPN02    ANDNE'P '                                      S01175
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 503'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     116325               S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '4'                                       S01175
     C           @TC1DI    ANDEQ'E'                                       S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 503'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     116325               S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '5'                                       S01175
     C           @TC1DI    IFEQ 'C'                                       S01175
     C           @WPN02    ANDNE'P '                                      S01175
     C           @TC1DI    OREQ 'E'                                       S01175
     C           @WPN01    ANDNE'P '                                      S01175
     C           *IN25     IFNE '1'                                       S01175
     C                     MOVE ' 503'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     116325               S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** Error 504 corresponds  to error 370 in SE0050                    S01175
     C*                                                                   S01175
     C*                                                                   S01175
     C** FOR A/C OF DELIVER FROM                                          S01175
     C*                                                                   S01175
     C*    .. if entered, must be a valid Customer or Short               S01175
     C*                                                                   S01175
     C           @SDFFA    IFNE *BLANKS                                   S01175
     C                     MOVEL@SDFFA    @WCUST                          S01175
     C                     TESTN          @WCUST     35                   S01175
     C************IN35     IFEQ '1'                                S01175 S01117
     C***********          MOVEL@SDFFA    CNUM                     S01175 S01117
     C***********          ELSE                                    S01175 S01117
     C***********          Z-ADD*ZEROS    CNUM                     S01175 S01117
     C***********          MOVEL@SDFFA    @WCSNM                   S01175 S01117
     C***********@WCSNM    CHAINSNAMEF               44            S01175 S01117
     C************IN44     IFEQ '0'                                S01175 S01117
     C***********RECI      ANDNE'*'                                S01175 S01117
     C***********          MOVELCNUM      @PDFFA                   S01175 S01117
     C***********                                                  S01175 S01117
     C***********          ELSE                                    S01175 S01117
     C***********          MOVE ' 504'    @EA,E                    S01175 S01117
     C***********          ADD  1         E                        S01175 S01117
     C***********          SETON                     11  49        S01175 S01117
     C***********          END                                     S01175 S01117
     C***********          END                                     S01175 S01117
     C***********          MOVE '1'       RCDT                     S01175 S01117
     C***********@KEY3     CHAINCLINTSEF             44            S01175 S01117
     C************IN44     IFEQ '0'                                S01175 S01117
     C***********RECI      ANDNE'*'                                S01175 S01117
     C***********          MOVELCNUM      @PDFFA                   S01175 S01117
     C***********                                                  S01175 S01117
     C***********          ELSE                                    S01175 S01117
     C           *IN35     IFEQ '0'                                       S01117
     C                     MOVEL@SDFFA    @WCSNM                          S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE BBCUST    @WCUST                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 504'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     11  49               S01175
     C                     ELSE                                           S01117
     C***********          MOVE BFCUST    @PDFFA                   S01117 065546
     C                     MOVELBFCUST    @PDFFA                          065546
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C** Error 505 corresponds  to error 372 in SE0050                    S01175
     C*                                                                   S01175
     C** Ind 25 used to prevent multiple occurence of the same error      S01175
     C** code                                                             S01175
     C*                                                                   S01175
     C                     MOVE '0'       *IN25                           S01175
     C*                                                                   S01175
     C           @STDTP    IFEQ 'TS'                                      S01175
     C           @SDFFA    ANDNE*BLANKS                                   S01175
     C                     MOVE ' 505'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     114925               S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @STDTP    IFEQ 'TP'                                      S01175
     C           @SDFFA    ANDNE*BLANKS                                   S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '0'                                       S01175
     C           @SDFFA    ANDNE*BLANKS                                   S01175
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 505'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     114925               S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '1'                                       S01175
     C           @WPN01    ANDNE'P '                                      S01175
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 505'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     114925               S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '2'                                       S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           @WPN01    ANDNE'NP'                                      S01175
     C           @FC1DI    ANDNE'C'                                       S01190
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 505'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     114925               S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '3'                                       S01175
     C           @WPN02    ANDNE'P '                                      S01175
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 505'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     114925               S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '4'                                       S01175
     C           @FC1DI    ANDEQ'E'                                       S01175
     C           @WPN01    IFNE 'P '                                      S01175
     C           *IN25     ANDNE'1'                                       S01175
     C                     MOVE ' 505'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     114925               S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @SCLTY    IFEQ '5'                                       S01175
     C           @FC1DI    IFEQ 'C'                                       S01175
     C           @WPN02    ANDNE'P '                                      S01175
     C           @FC1DI    OREQ 'E'                                       S01175
     C           @WPN01    ANDNE'P '                                      S01175
     C           *IN25     IFNE '1'                                       S01175
     C                     MOVE ' 505'    @EA,E                           S01175
     C                     ADD  1         E                               S01175
     C                     SETON                     114925               S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END
      *
      * Clearance type must be in the range 0 - 5
     C           @SCLTY    IFLT '0'
     C           @SCLTY    ORGT '5'
     C                     MOVE ' 343'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  64
     C                     END
      *
      *    .. if Market indicator is 'G', must be '0'
     C           @STDMI    IFEQ 'G'
     C           @SCLTY    ANDNE'0'
     C                     MOVE ' 343'    @EA,E
     C                     ADD  1         E
     C                     SETON                     11  64
     C                     END
     C                     MOVEL@SCLTY    @PCLTY
     C*                                                                   029335
     C*    .. if it is not a Gray Market trade, Clearance type must       029335
     C*       not be '0' for a complete trade                             029335
     C*                                                                   029335
     C           @STDMI    IFNE '0'                                       029335
     C           @SINCS    ANDEQ'C'                                       029335
     C           @SCLTY    ANDEQ'0'                                       029335
     C                     MOVE ' 355'    @EA,E                           029335
     C                     ADD  1         E                               029335
     C                     SETON                     11  64               029335
     C                     END                                            029335
      *
      **C/H*indicator, if entered, must be 'C' or 'K'                     S01175
     C***********@SCLRH    IFNE *BLANK                                    S01175
     C***********@SCLRH    ANDNE'C'                                       S01175
     C***********@SCLRH    ANDNE'K'                                       S01175
     C***********          MOVE ' 344'    @EA,E                           S01175
     C***********          ADD  1         E                               S01175
     C***********          SETON                     11  65        S01176 S01175
     C***********          SETON                     11  49        S01176 S01175
     C***********          END                                            S01175
     C***********          MOVEL@SCLRH    @PCLRH                          S01175
      *
      * Priority code
      *
      *********mandatory*if*Deliver*To*or*Deliver*From*is*Euroclear****   S01190
      *    Mandatory if Trade is Sale and Del. From' is Euroclear         S01190
     C           @SPRYC    IFEQ *BLANKS
     C***********@FC1DI    IFEQ 'E'                                       S01190
     C***********@TC1DI    OREQ 'E'                                       S01190
     C           @STDTP    IFEQ 'TS'                                      S01190
     C           @FC1DI    ANDEQ'E'                                       S01190
     C                     MOVE ' 345'    @EA,E
     C                     ADD  1         E
     C***********          SETON                     11  66               S01176
     C                     SETON                     11  65               S01176
     C                     END
     C                     END
      *
      ********if*entered**must*be*'R'*'P'*or*'W'********
      *    .. if entered, must be 'R' 'P' 'W' or 'L'                      S01190
     C           @SPRYC    IFNE *BLANKS
     C           @SPRYC    ANDNE'R'
     C           @SPRYC    ANDNE'P'
     C           @SPRYC    ANDNE'W'
     C           @SPRYC    ANDNE'L'                                       S01190
     C                     MOVE ' 346'    @EA,E
     C                     ADD  1         E
     C***********          SETON                     11  66               S01176
     C                     SETON                     11  65               S01176
     C                     END
     C                     MOVEL@SPRYC    @OPRYC
     C                     MOVEL@SPRYC    @PPRYC
      *
      * Pay code
      *
      ********must*be*in*the*range*0*-*4                                  S01448
      *    .. must be in the range 0 - 5                                  S01448
     C           @SPCOD    IFLT '0'
     C*******    @SPCOD    ORGT '4'                                       S01448
     C           @SPCOD    ORGT '5'                                       S01448
     C                     MOVE ' 347'    @EA,E
     C                     ADD  1         E
     C***********          SETON                     11  67               S01176
     C                     SETON                     11  66               S01176
     C                     END
     C                     MOVEL@SPCOD    @OPCOD
     C                     MOVEL@SPCOD    @PPCOD
     C*
     C                     END
      *
     C           13        SUB  @NCDP     ZSDIG
     C                     Z-ADD@NCDP     ZSDEC
     C                     Z-ADD@NCDP     ZDECS
      *                                                                   S01176
      ***  Auto-Settle Indicator                                          S01176
      ***                                                                 S01176
      ***  .. must be 'Y' or'N'                                           S01176
      *                                                                   S01176
     C           @SAUTS    IFNE *BLANKS                                   S01176
      *                                                                   S01176
     C           @SAUTS    IFNE 'Y'                                       S01176
     C           @SAUTS    ANDNE'N'                                       S01176
     C           CSE039    ANDNE'Y'                                                           CSE039
     C           @SAUTS    ORNE 'Y'                                                           CSE039
     C           @SAUTS    ANDNE'N'                                                           CSE039
     C           @SAUTS    ANDNE'A'                                                           CSE039
     C           CSE039    ANDEQ'Y'                                                           CSE039
     C           @SAUTS    OREQ 'Y'                                       E21061
     C           @STDMI    ANDEQ'G'                                       E21061
     C                     MOVE ' 348'    @EA,E                           S01176
     C                     ADD  1         E                               S01176
     C                     SETON                     11  67               S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ELSE                                           S01176
     C           CSE039    IFNE 'Y'                                                           CSE039
     C           @WC1DI    ORNE 'M'                                                           CSE039
     C                     MOVE @AUTS     @SAUTS                          S01176
     C                     ELSE                                                               CSE039
      *                                                                                       CSE039
      * If CSE039 is on and it is a market counterparty, attempt to def                       CSE039
      * default from SSI for Custodian, or failing this, client record.                       CSE039
      *                                                                                       CSE039
     C           @STDTP    IFEQ 'TP'                                                          CSE039
     C                     MOVEL@PDELT    PCUST                                               CSE039
     C                     ELSE                                                               CSE039
     C                     MOVEL@PDELF    PCUST                                               CSE039
     C                     ENDIF                                                              CSE039
      *                                                                                       CSE039
     C           PCUST     IFNE *BLANKS                                                       CSE039
     C                     CALL 'SESSIR0'                                                     CSE039
     C                     PARM 'D'       POTYP   1                                           CSE039
     C                     PARM           @PTDBA                                              CSE039
     C                     PARM           PCUST   6                                           CSE039
     C                     PARM SIBK      PSIBK   2                                           CSE039
     C                     PARM           NMCYA                                               CSE039
     C                     PARM SMCC      PMRKT   2                                           CSE039
     C                     PARM           SITP                                                CSE039
     C                     PARM           PTFR                                                CSE039
     C                     PARM           PCBSTD                                              CSE039
     C                     PARM           PCBSAD                                              CSE039
     C                     PARM *BLANKS   PRTCD                                               CSE039
      *                                                                                       CSE039
     C           PRTCD     IFNE '*NCRF'                                                       CSE039
     C           PRTCD     ANDNE'*NRF '                                                       CSE039
     C           2         OCUR PCBSTD                                                        CSE039
     C                     MOVE SASI      @SAUTS                                              CSE039
     C                     ELSE                                                               CSE039
      *                                                                                       CSE039
      * if not found default from Custodian's Client record                                   CSE039
     C                     MOVE PCUST     @WCUST                                              CSE039
     C                     MOVE *BLANKS   @RTCD                                               CSE039
     C                     EXSR AOSECS                                                        CSE039
     C           @RTCD     IFEQ *BLANKS                                                       CSE039
     C                     MOVE BFASIN    @SAUTS                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     ENDIF                                                              CSE039
     C                     END                                            S01176
      *                                                                   S01176
     C                     MOVE @SAUTS    @PAUTS                          S01176
      *                                                                   S01176
      ***********                                                         S01176
      **Local*transfer*duty*code******************************************S01176
     C***********          MOVEL@STTCC    @XCODE                          S01176
     C***********          MOVEL@OTTCC    @OCODE  2                       S01176
     C***********          MOVEL' 380'    @XERR1  4                       S01176
     C***********          MOVEL' 381'    @XERR2  4                       S01176
     C***********          Z-ADD70        @I      30                      S01176
     C***********          MOVEL@STTCA    @XAMT  15                       S01176
     C***********          EXSR SUB500                                    S01176
     C***********          MOVEL@STTCC    @PTTCC                          S01176
     C***********          MOVEL@VL       @LTVL   1                       S01176
      ***********                                                         S01176
      **Local*transfer*amount*********************************************S01176
     C***********          MOVEL' 382'    @XERR1                          S01176
     C***********          Z-ADD71        @J      30                      S01176
     C***********          EXSR SUB501                                    S01176
     C***********          MOVE @XAMT     @STTCA                          S01176
     C***********          Z-ADD@XAMTN    @PLTCA                          S01176
      ***********                                                         S01176
      **PMT*charge*code***************************************************S01176
     C***********          MOVEL@STPCC    @XCODE                          S01176
     C***********          MOVEL@OTPCC    @OCODE                          S01176
     C***********          MOVEL' 383'    @XERR1                          S01176
     C***********          MOVEL' 384'    @XERR2                          S01176
     C***********          Z-ADD74        @I                              S01176
     C***********          MOVEL@STPCA    @XAMT                           S01176
     C***********          EXSR SUB500                                    S01176
     C***********          MOVEL@STPCC    @PTPCC                          S01176
     C***********          MOVEL@VL       @PMVL   1                       S01176
      ***********                                                         S01176
      **PMT*Charge*amount*************************************************S01176
     C***********          MOVEL' 385'    @XERR1                          S01176
     C***********          Z-ADD75        @J                              S01176
     C***********          EXSR SUB501                                    S01176
     C***********          MOVE @XAMT     @STPCA                          S01176
     C***********          Z-ADD@XAMTN    @PTPCA                          S01176
      *                                                                   S01176
      ***  Check for Charge Amount Overrides                              S01176
      *                                                                   S01176
     C           @STBCA    IFNE @OTBCA                                    S01176
     C                     MOVE 'Y'       @OVBC                           S01176
     C                     END                                            S01176
     C           @STCCA    IFNE @OTCCA                                    S01176
     C                     MOVE 'Y'       @OVCC                           S01176
     C                     END                                            S01176
     C           @STCA1    IFNE @OTCA1                                    S01176
     C                     MOVE 'Y'       @OVC1                           S01176
     C                     END                                            S01176
     C           @STCA2    IFNE @OTCA2                                    S01176
     C                     MOVE 'Y'       @OVC2                           S01176
     C                     END                                            S01176
     C           @STCA3    IFNE @OTCA3                                    S01176
     C                     MOVE 'Y'       @OVC3                           S01176
     C                     END                                            S01176
     C           @STCA4    IFNE @OTCA4                                    S01176
     C                     MOVE 'Y'       @OVC4                           S01176
     C                     END                                            S01176
     C           @STCA5    IFNE @OTCA5                                    S01176
     C                     MOVE 'Y'       @OVC5                           S01176
     C                     END                                            S01176
     C           @STCA6    IFNE @OTCA6                                    S01176
     C                     MOVE 'Y'       @OVC6                           S01176
     C                     END                                            S01176
     C           @STCA7    IFNE @OTCA7                                    S01176
     C                     MOVE 'Y'       @OVC7                           S01176
     C                     END                                            S01176
     C           @STAXA    IFNE @OTAXA                                    S01176
     C                     MOVE 'Y'       @OVTX                           S01176
     C                     END                                            S01176
     C           @SBCMR    IFNE @OBCMR                                    S01176
     C                     MOVE 'Y'       @OVBCR                          S01176
     C                     END                                            S01176
     C           @SCCMR    IFNE @OCCMR                                    S01176
     C                     MOVE 'Y'       @OVCCR                          S01176
     C                     END                                            S01176
     C           @STXRB    IFNE @OTXRB                                    S01176
     C                     MOVE 'Y'       @OVTXR                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Check for Charge Amount Overrides                              S01176
      *                                                                   S01176
      * Broker commission code
      *                                                                   S01176
     C***********          MOVEL@STBCC    @XCODE                          S01176
     C***********          MOVEL@OTBCC    @OCODE                          S01176
     C***********          MOVEL' 387'    @XERR1                          S01176
     C***********          MOVEL' 388'    @XERR2                          S01176
     C***********          Z-ADD68        @I                              S01176
     C***********          MOVEL@STBCA    @XAMT                           S01176
     C                     MOVE @STBCC    @XCODE  2                       S01176
     C                     MOVE @STBCA    @XAMT  15                       S01176
     C                     MOVE @OVBC     @OV     1                       S01176
     C                     MOVE ' 370'    @XERR1  4                       S01176
     C                     MOVE ' 371'    @XERR2  4                       S01176
     C                     Z-ADD68        @I      20                      S01176
     C                     EXSR SUB500
     C                     MOVEL@STBCC    @PTBCC
     C***********          MOVEL@VL       @BKVL   1                       S01176
     C                     MOVE TXAP      @TXBC   1                       S01176
     C                     MOVE REBA      @RBBC   1                       S01176
      *
      * Broker commission amount
      *                                                                   S01176
     C***********@PATRD    IFNE 'C'                                S01176 065006
     C***********          MOVEL' 389'    @XERR1                          S01176
     C                     MOVE ' 372'    @XERR3  4                       S01176
     C                     MOVE ' 373'    @XERR4  4                       S01176
     C***********          Z-ADD69        @J                              S01176
     C                     Z-ADD69        @J      20                      S01176
     C*                                                                   S01176
     C                     MOVE @OTBCC    @@CODE  2                       S01176
     C                     Z-ADD@PTBCA    @XAMTN                          S01176
     C                     EXSR SUB501
     C                     MOVE @XAMT     @STBCA
     C                     Z-ADD@XAMTN    @PTBCA
     C                     MOVE @OV       @OVBC                           S01176
     C***********          END                                     S01176 065006
      *
     C           @PATRD    IFEQ 'C'
     C           @STBCA    ANDEQ*BLANKS
     C           @STBCC    ANDNE*BLANKS                                   S01176
     C           *IN68     ANDEQ'0'                                       S01176
     C           @CUMMC    MULT @PNOML    @PTBCA
     C                     DIV  @CUMMN    @PTBCA    H
     C                     Z-ADD@PTBCA    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @STBCA
     C***********          MOVEL'Y'       @BKVL                           S01176
     C                     MOVE 'Y'       @TXBC                           S01176
     C                     MOVE 'Y'       @RBBC                           S01176
     C                     END
     C/COPY WNCPYSRC,SE3002C010
      *
      * Customer commission code
      *    .. prohibited if client is not safe custody or discretionary
     C           @STCCC    IFNE *BLANKS
     C***********@STCCC    ANDNE@OTCCC                                    S01176
     C           @WC1DI    IFNE 'S'
     C           @WC1DI    ANDNE'D'
     C***********          MOVE ' 351'    @EA,E                           S01176
     C                     MOVE ' 374'    @EA,E                           S01176
     C                     ADD  1         E
     C***********          SETON                     11  72               S01176
     C                     SETON                     111470               S01176
     C                     END
     C                     END
      *
      ***  If the Customer Commission Code is found to be invalid         S01176
      ***  above (ie, prohibited), noi further validation should          S01176
      ***  take place                                                     S01176
      *                                                                   S01176
     C           *IN70     IFEQ '0'                                       S01176
      *                                                                   S01176
     C                     MOVEL@STCCC    @XCODE
     C                     MOVEL@STCCA    @XAMT
     C                     MOVE @OVCC     @OV                             S01176
     C***********          MOVEL' 391'    @XERR2                          S01176
     C                     MOVE ' 375'    @XERR1                          S01176
     C                     MOVE ' 376'    @XERR2                          S01176
     C************IN72     IFEQ '0'                                       S01176
     C***********          MOVEL@OTCCC    @OCODE                          S01176
     C***********          MOVEL' 390'    @XERR1                          S01176
     C***********          Z-ADD72        @I                              S01176
     C                     Z-ADD70        @I                              S01176
     C                     EXSR SUB500
     C***********          END                                            S01176
     C                     MOVEL@STCCC    @PTCCC
     C***********          MOVEL@VL       @CCVL   1                       S01176
     C                     MOVE TXAP      @TXCC   1                       S01176
     C                     MOVE REBA      @RBCC   1                       S01176
      *
      * Customer commission amount
      *                                                                   S01176
     C***********          MOVEL' 392'    @XERR1                          S01176
     C                     MOVE ' 377'    @XERR3                          S01176
     C                     MOVE ' 378'    @XERR4                          S01176
     C***********          Z-ADD73        @J                              S01176
     C                     Z-ADD71        @J                              S01176
     C                     MOVE @OTCCC    @@CODE                          S01176
     C                     Z-ADD@PTCCA    @XAMTN                          S01176
     C                     EXSR SUB501
     C                     MOVE @XAMT     @STCCA
     C                     Z-ADD@XAMTN    @PTCCA
     C                     MOVE @OV       @OVCC                           S01176
      *                                                                   S01176
     C                     END                                            S01176
     C/COPY WNCPYSRC,SE3002C011
      *
      * Charge code 1
      *                                                                   S01176
     C                     MOVEL@STCC1    @XCODE
     C                     MOVE @STCA1    @XAMT                           S01176
     C                     MOVE @OVC1     @OV                             S01176
     C***********          MOVEL@OTCC1    @OCODE                          S01176
     C***********          MOVEL' 393'    @XERR1                          S01176
     C***********          MOVEL' 391'    @XERR2                          S01176
     C                     MOVE ' 379'    @XERR1                          S01176
     C                     MOVE ' 380'    @XERR2                          S01176
     C***********          Z-ADD76        @I                              S01176
     C                     Z-ADD72        @I                              S01176
     C***********          MOVEL@STCA1    @XAMT                           S01176
     C                     EXSR SUB500
     C                     MOVEL@STCC1    @PTCC1
     C***********          MOVEL@VL       @C1VL   1                       S01176
     C                     MOVE TXAP      @TXC1   1                       S01176
     C                     MOVE REBA      @REC1   1                       S01176
      *
      * Charge amount 1
      *                                                                   S01176
     C***********          MOVEL' 392'    @XERR1                          S01176
     C                     MOVE ' 381'    @XERR3                          S01176
     C                     MOVE ' 382'    @XERR4                          S01176
     C***********          Z-ADD77        @J                              S01176
     C                     Z-ADD73        @J                              S01176
     C                     MOVE @OTCC1    @@CODE                          S01176
     C                     Z-ADD@PTCA1    @XAMTN                          S01176
     C                     EXSR SUB501
     C                     MOVE @XAMT     @STCA1
     C                     Z-ADD@XAMTN    @PTCA1
     C                     MOVE @OV       @OVC1                           S01176
     C/COPY WNCPYSRC,SE3002C012
      *
      * Charge code 2
      *                                                                   S01176
     C                     MOVEL@STCC2    @XCODE
     C                     MOVE @STCA2    @XAMT                           S01176
     C                     MOVE @OVC2     @OV                             S01176
     C***********          MOVEL@OTCC2    @OCODE                          S01176
     C***********          MOVEL' 393'    @XERR1                          S01176
     C***********          MOVEL' 394'    @XERR2                          S01176
     C                     MOVE ' 383'    @XERR1                          S01176
     C                     MOVE ' 384'    @XERR2                          S01176
     C***********          Z-ADD78        @I                              S01176
     C                     Z-ADD74        @I                              S01176
     C***********          MOVEL@STCA2    @XAMT                           S01176
     C                     EXSR SUB500
     C                     MOVEL@STCC2    @PTCC2
     C***********          MOVEL@VL       @C2VL   1                       S01176
     C                     MOVE TXAP      @TXC2   1                       S01176
     C                     MOVE REBA      @REC2   1                       S01176
      *
      * Charge amount 2
      *                                                                   S01176
     C***********          MOVEL' 395'    @XERR1                          S01176
     C                     MOVE ' 385'    @XERR3                          S01176
     C                     MOVE ' 386'    @XERR4                          S01176
     C***********          Z-ADD79        @J                              S01176
     C                     Z-ADD75        @J                              S01176
     C                     MOVE @OTCC2    @@CODE                          S01176
     C                     Z-ADD@PTCA2    @XAMTN                          S01176
     C                     EXSR SUB501
     C                     MOVE @XAMT     @STCA2
     C                     Z-ADD@XAMTN    @PTCA2
     C                     MOVE @OV       @OVC2                           S01176
     C/COPY WNCPYSRC,SE3002C013
      *
      * Charge code 3
      *                                                                   S01176
     C                     MOVEL@STCC3    @XCODE
     C                     MOVE @STCA3    @XAMT                           S01176
     C                     MOVE @OVC3     @OV                             S01176
     C***********          MOVEL@OTCC3    @OCODE                          S01176
     C***********          MOVEL' 396'    @XERR1                          S01176
     C***********          MOVEL' 397'    @XERR2                          S01176
     C                     MOVE ' 387'    @XERR1                          S01176
     C                     MOVE ' 388'    @XERR2                          S01176
     C***********          Z-ADD80        @I                              S01176
     C                     Z-ADD76        @I                              S01176
     C***********          MOVEL@STCA3    @XAMT                           S01176
     C                     EXSR SUB500
     C                     MOVEL@STCC3    @PTCC3
     C***********          MOVEL@VL       @C3VL   1                       S01176
     C                     MOVE TXAP      @TXC3   1                       S01176
     C                     MOVE REBA      @REC3   1                       S01176
      *
      * Charge amount 3
      *                                                                   S01176
     C***********          MOVEL' 398'    @XERR1                          S01176
     C                     MOVE ' 389'    @XERR3                          S01176
     C                     MOVE ' 390'    @XERR4                          S01176
     C***********          Z-ADD81        @J                              S01176
     C                     Z-ADD77        @J                              S01176
     C                     MOVE @OTCC3    @@CODE                          S01176
     C                     Z-ADD@PTCA3    @XAMTN                          S01176
     C                     EXSR SUB501
     C                     MOVE @XAMT     @STCA3
     C                     Z-ADD@XAMTN    @PTCA3
     C                     MOVE @OV       @OVC3                           S01176
     C/COPY WNCPYSRC,SE3002C014
      *                                                                   S01176
      ***  Charge Code 4                                                  S01176
      *                                                                   S01176
     C                     MOVE @STCC4    @XCODE                          S01176
     C                     MOVE @STCA4    @XAMT                           S01176
     C                     MOVE @OVC4     @OV                             S01176
     C                     MOVE ' 391'    @XERR1                          S01176
     C                     MOVE ' 392'    @XERR2                          S01176
     C                     Z-ADD78        @I                              S01176
     C                     EXSR SUB500                                    S01176
     C                     MOVE @STCC4    @PTCC4                          S01176
     C                     MOVE TXAP      @TXC4   1                       S01176
     C                     MOVE REBA      @REC4   1                       S01176
      *                                                                   S01176
      ***  Charge Amount 4                                                S01176
      *                                                                   S01176
     C                     MOVE ' 393'    @XERR3                          S01176
     C                     MOVE ' 394'    @XERR4                          S01176
     C                     Z-ADD79        @J                              S01176
     C                     MOVE @OTCC4    @@CODE                          S01176
     C                     Z-ADD@PTCA4    @XAMTN                          S01176
     C                     EXSR SUB501                                    S01176
     C                     MOVE @XAMT     @STCA4                          S01176
     C                     Z-ADD@XAMTN    @PTCA4                          S01176
     C                     MOVE @OV       @OVC4                           S01176
     C/COPY WNCPYSRC,SE3002C015
      *                                                                   S01176
      ***  Charge Code 5                                                  S01176
      *                                                                   S01176
     C                     MOVE @STCC5    @XCODE                          S01176
     C                     MOVE @STCA5    @XAMT                           S01176
     C                     MOVE @OVC5     @OV                             S01176
     C                     MOVE ' 395'    @XERR1                          S01176
     C                     MOVE ' 396'    @XERR2                          S01176
     C                     Z-ADD80        @I                              S01176
     C                     EXSR SUB500                                    S01176
     C                     MOVE @STCC5    @PTCC5                          S01176
     C                     MOVE TXAP      @TXC5   1                       S01176
     C                     MOVE REBA      @REC5   1                       S01176
      *                                                                   S01176
      ***  Charge Amount 5                                                S01176
      *                                                                   S01176
     C                     MOVE ' 397'    @XERR3                          S01176
     C                     MOVE ' 398'    @XERR4                          S01176
     C                     Z-ADD81        @J                              S01176
     C                     MOVE @OTCC5    @@CODE                          S01176
     C                     Z-ADD@PTCA5    @XAMTN                          S01176
     C                     EXSR SUB501                                    S01176
     C                     MOVE @XAMT     @STCA5                          S01176
     C                     Z-ADD@XAMTN    @PTCA5                          S01176
     C                     MOVE @OV       @OVC5                           S01176
      *                                                                                     AR884341
     C           CER049    IFEQ 'Y'                                                         AR884341
     C           BVACOP    ANDEQ'N'                                                         AR884341
     C                     MOVE '0'       WK16X                                             AR884341
     C                     MOVE *BLANKS   @STAMT                                            AR884341
     C           @STLIA    IFNE 'N'                                                         AR884341
     C           @STLIA    ANDNE'Y'                                                         AR884341
     C                     MOVE ' 425'    @EA,E                                             AR884341
     C                     ADD  1         E                                                 AR884341
     C                     MOVE '1'       WK16X                                             AR884341
     C                     MOVE *ON       *IN11                                             AR884341
     C                     ENDIF                                                            AR884341
      *                                                                                     AR884341
     C           PSTLIA    IFEQ 'N'                                                         AR884341
     C           @STLIA    ANDEQ'Y'                                                         AR884341
      *                                                                                     AR884341
     C           WSTAXI    IFNE 'Y'                                                         AR884341
     C                     MOVE ' 426'    @EA,E                                             AR884341
     C                     ADD  1         E                                                 AR884341
     C                     MOVE '1'       WK16X                                             AR884341
     C                     MOVE *ON       *IN11                                             AR884341
     C                     ENDIF                                                            AR884341
     C           WCTAX     IFNE 'Y'                                                         AR884341
     C                     MOVE ' 427'    @EA,E                                             AR884341
     C                     ADD  1         E                                                 AR884341
     C                     MOVE '1'       WK16X                                             AR884341
     C                     MOVE *ON       *IN11                                             AR884341
     C                     ENDIF                                                            AR884341
     C                     ENDIF                                                            AR884341
      *                                                                                     AR884341
     C           @STLIA    IFEQ 'Y'                                                         AR884341
     C           PSTLIA    ANDEQ'Y'                                                         AR884341
     C                     Z-ADD@PTCA1    @PTCAF                                            AR884341
     C           @PTCA2    ADD  @PTCAF    @PTCAF                                            AR884341
     C           @PTCA3    ADD  @PTCAF    @PTCAF                                            AR884341
     C           @PTCA4    ADD  @PTCAF    @PTCAF                                            AR884341
     C           @PTCA5    ADD  @PTCAF    @PTCAF                                            AR884341
     C                     Z-ADD@PTCAF    @PCAMT                                            AR884341
      *                                                                                     AR884341
     C           @PTCAF    IFNE *ZERO                                                       AR884341
      *                                                                                     AR884341
     C                     CALL 'SD008141'                                                  AR884341
     C                     PARM @PTDVD    U#DATE                                            AR884341
     C                     PARM 'SECURITY'U#ORGN                                            AR884341
     C                     PARM           ##TYPE                                            AR884341
     C                     PARM           U#CTAX                                            AR884341
     C                     PARM           U#MTAX                                            AR884341
     C                     PARM           U#CCCY                                            AR884341
     C                     PARM           U#MCCY                                            AR884341
     C                     PARM           U#CSCC                                            AR884341
     C                     PARM           U#MSCC                                            AR884341
     C                     PARM           U#TXTY                                            AR884341
     C                     PARM           SDSTPD                                            AR884341
      *                                                                                     AR884341
      ** If there is a default for the Module use this tax rate and ccy                     AR884341
      ** otherwise use the ICD Control defaults.                                            AR884341
      *                                                                                     AR884341
     C           U#MTAX    IFNE *ZEROS                                                      AR884341
     C                     Z-ADDU#MTAX    U#TAXR                                            AR884341
     C                     MOVE U#MCCY    WCCY                                              AR884341
     C                     MOVE U#MSCC    @STCC7                                            AR884341
     C                     ELSE                                                             AR884341
     C                     Z-ADDU#CTAX    U#TAXR                                            AR884341
     C                     MOVE U#CCCY    WCCY                                              AR884341
     C                     MOVE U#CSCC    @STCC7                                            AR884341
     C                     ENDIF                                                            AR884341
      *                                                                                     AR884341
     C                     MOVE @PTCAF    WSTAX                                             AR884341
     C           @SSETC    IFNE WCCY                                                        AR884341
      *                                                                                     AR884341
      ** Access stamp tax currency for decimal places                                       AR884341
      *                                                                                     AR884341
     C                     MOVE WCCY      @AJCD                                             AR884341
     C                     EXSR AOCURR                                                      AR884341
     C                     MOVE A6NBDP    NDP                                               AR884341
     C                     MOVELA6SPRT    ZRATE1                                            AR884341
     C                     MOVELA6MDIN    ZMDI1                                             AR884341
      *                                                                                     AR884341
      ** Access event currency for decimal places                                           AR884341
      *                                                                                     AR884341
     C                     MOVE @SSETC    @AJCD                                             AR884341
     C                     EXSR AOCURR                                                      AR884341
     C                     MOVELA6SPRT    ZRATE2                                            AR884341
     C                     MOVELA6MDIN    ZMDI2                                             AR884341
      *                                                                                     AR884341
      ** Get exchange rate                                                                  AR884341
      *                                                                                     AR884341
     C                     EXSR RTZXRT                                                      AR884341
      *                                                                                     AR884341
     C                     Z-ADDZRATEX    ZEXCH                                             AR884341
     C                     MOVE ZMDI1     ZMD                                               AR884341
     C                     Z-ADD@PTCAF    ZAMTCI                                            AR884341
     C                     Z-ADDA6NBDP    ZCDPI                                             AR884341
     C                     Z-ADDNDP       ZCDPO                                             AR884341
     C                     CALL 'ZCONVZ1'                                                   AR884341
     C                     PARM           ZAMTCI                                            AR884341
     C                     PARM           ZEXCH                                             AR884341
     C                     PARM           ZMD                                               AR884341
     C                     PARM           ZCCYI                                             AR884341
     C                     PARM           ZCCYO                                             AR884341
     C                     PARM           ZCDPI                                             AR884341
     C                     PARM           ZCDPO                                             AR884341
     C                     PARM           ZAMTCO                                            AR884341
     C                     Z-ADDZAMTCO    WSTAX                                             AR884341
     C                     ENDIF                                                            AR884341
      *                                                                                     AR884341
     C           WSTAX     MULT U#TAXR    WSSTAX                                            AR884341
     C                     Z-ADDWSSTAX    @PTAMT                                            AR884341
     C                     Z-ADDWSSTAX    @PTCA7                                            AR884341
     C                     MOVE *BLANKS   @STAMT                                            AR884341
     C                     MOVE WSSTAX    ZFIELD                                            AR884341
     C                     Z-ADD2         ZADEC                                             AR884341
     C                     EXSR ZEDIT                                                       AR884341
     C                     MOVE ZFIELD    @STAMT                                            AR884341
     C                     MOVE ZFIELD    @STCA7                                            AR884341
     C                     ENDIF                                                            AR884341
     C                     ELSE                                                             AR884341
     C                     MOVE *BLANKS   @STAMT                                            AR884341
     C                     MOVE *BLANKS   @STCA7                                            AR884341
     C                     MOVE *BLANKS   @STCC7                                            AR884341
     C                     ENDIF                                                            AR884341
     C                     MOVE @STLIA    @PTLIA                                            AR884341
     C                     ENDIF                                                            AR884341
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCP2                                           S01408
     C*                                                                   S01408
      *                                                                   S01176
      ***  Only validate the following if Autocharges is on               S01176
      *                                                                   S01176
     C***********AUMO      IFEQ 'Y'                                S01176 S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
      *                                                                   S01176
      ***  Charge Code 6                                                  S01176
      *                                                                   S01176
     C                     MOVE @STCC6    @XCODE                          S01176
     C                     MOVE @STCA6    @XAMT                           S01176
     C                     MOVE @OVC6     @OV                             S01176
     C                     MOVE ' 399'    @XERR1                          S01176
     C                     MOVE ' 400'    @XERR2                          S01176
     C                     Z-ADD82        @I                              S01176
     C                     EXSR SUB500                                    S01176
     C                     MOVE @STCC6    @PTCC6                          S01176
     C                     MOVE TXAP      @TXC6   1                       S01176
     C                     MOVE REBA      @REC6   1                       S01176
      *                                                                   S01176
      ***  Charge Amount 6                                                S01176
      *                                                                   S01176
     C                     MOVE ' 401'    @XERR3                          S01176
     C                     MOVE ' 402'    @XERR4                          S01176
     C                     Z-ADD83        @J                              S01176
     C                     MOVE @OTCC6    @@CODE                          S01176
     C                     Z-ADD@PTCA6    @XAMTN                          S01176
     C                     EXSR SUB501                                    S01176
     C                     MOVE @XAMT     @STCA6                          S01176
     C                     Z-ADD@XAMTN    @PTCA6                          S01176
     C                     MOVE @OV       @OVC6                           S01176
      *                                                                   S01176
      ***  Charge Code 7                                                  S01176
      *                                                                   S01176
     C                     MOVE @STCC7    @XCODE                          S01176
     C                     MOVE @STCA7    @XAMT                           S01176
     C                     MOVE @OVC7     @OV                             S01176
     C                     MOVE ' 403'    @XERR1                          S01176
     C                     MOVE ' 404'    @XERR2                          S01176
     C                     Z-ADD84        @I                              S01176
     C                     EXSR SUB500                                    S01176
     C                     MOVE @STCC7    @PTCC7                          S01176
     C                     MOVE TXAP      @TXC7   1                       S01176
     C                     MOVE REBA      @REC7   1                       S01176
      *                                                                   S01176
      ***  Charge Amount 7                                                S01176
      *                                                                   S01176
     C                     MOVE ' 405'    @XERR3                          S01176
     C                     MOVE ' 406'    @XERR4                          S01176
     C                     Z-ADD85        @J                              S01176
     C                     MOVE @OTCC7    @@CODE                          S01176
     C                     Z-ADD@PTCA7    @XAMTN                          S01176
     C                     EXSR SUB501                                    S01176
     C                     MOVE @XAMT     @STCA7                          S01176
     C                     Z-ADD@XAMTN    @PTCA7                          S01176
     C                     MOVE @OV       @OVC7                           S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCP3                                           S01408
     C*                                                                   S01408
      *                                                                                     AR871625
     C           CER049    IFEQ 'Y'                                                         AR871625
     C                     MOVE '0'       WK16X                                             AR871625
     C                     MOVE *BLANKS   @STAMT                                            AR871625
     C           @STLIA    IFNE 'N'                                                         AR871625
     C           @STLIA    ANDNE'Y'                                                         AR871625
     C                     MOVE ' 425'    @EA,E                                             AR871625
     C                     ADD  1         E                                                 AR871625
     C                     MOVE '1'       WK16X   1                                         AR871625
     C                     MOVE *ON       *IN11                                             AR884341
     C                     ENDIF                                                            AR871625
      *                                                                                     AR871625
     C           PSTLIA    IFEQ 'N'                                                         AR871625
     C           @STLIA    ANDEQ'Y'                                                         AR871625
      *                                                                                     AR871625
     C           WSTAXI    IFNE 'Y'                                                         AR871625
     C                     MOVE ' 426'    @EA,E                                             AR871625
     C                     ADD  1         E                                                 AR871625
     C                     MOVE '1'       WK16X   1                                         AR871625
     C                     MOVE *ON       *IN11                                             AR884341
     C                     ENDIF                                                            AR871625
     C           WCTAX     IFNE 'Y'                                                         AR871625
     C                     MOVE ' 427'    @EA,E                                             AR871625
     C                     ADD  1         E                                                 AR871625
     C                     MOVE '1'       WK16X   1                                         AR871625
     C                     MOVE *ON       *IN11                                             AR884341
     C                     ENDIF                                                            AR871625
     C                     ENDIF                                                            AR871625
      *                                                                                     AR871625
     C           @STLIA    IFEQ 'Y'                                                         AR871625
     C           PSTLIA    ANDEQ'Y'                                                         AR871625
     C                     Z-ADD@PTCA1    @PTCAF 150                                        AR871625
     C           @PTCA2    ADD  @PTCAF    @PTCAF                                            AR871625
     C           @PTCA3    ADD  @PTCAF    @PTCAF                                            AR871625
     C           @PTCA4    ADD  @PTCAF    @PTCAF                                            AR871625
     C           @PTCA5    ADD  @PTCAF    @PTCAF                                            AR871625
     C           @PTCA6    ADD  @PTCAF    @PTCAF                                            AR871625
     C                     Z-ADD@PTCAF    @PCAMT                                            AR871625
      *                                                                                     AR871625
     C           @PTCAF    IFNE *ZERO                                                       AR871625
      *                                                                                     AR871625
     C                     CALL 'SD008141'                                                  AR871625
     C                     PARM @PTDVD    U#DATE  50                                        AR871625
     C                     PARM 'SECURITY'U#ORGN 10                                         AR871625
     C                     PARM           ##TYPE  4                                         AR871625
     C                     PARM           U#CTAX 138                                        AR871625
     C                     PARM           U#MTAX 138                                        AR871625
     C                     PARM           U#CCCY  3                                         AR871625
     C                     PARM           U#MCCY  3                                         AR871625
     C                     PARM           U#CSCC  2                                         AR871625
     C                     PARM           U#MSCC  2                                         AR871625
     C                     PARM           U#TXTY  1                                         AR871625
     C                     PARM           SDSTPD                                            AR871625
      *                                                                                     AR871625
      ** If there is a default for the Module use this tax rate and ccy                     AR871625
      ** otherwise use the ICD Control defaults.                                            AR871625
      *                                                                                     AR871625
     C           U#MTAX    IFNE *ZEROS                                                      AR871625
     C                     Z-ADDU#MTAX    U#TAXR 138                                        AR871625
     C                     MOVE U#MCCY    WCCY    3                                         AR871625
     C                     MOVE U#MSCC    @STCC7                                            AR871625
     C                     ELSE                                                             AR871625
     C                     Z-ADDU#CTAX    U#TAXR                                            AR871625
     C                     MOVE U#CCCY    WCCY                                              AR871625
     C                     MOVE U#CSCC    @STCC7                                            AR871625
     C                     ENDIF                                                            AR871625
      *                                                                                     AR871625
     C                     MOVE @PTCAF    WSTAX  150                                        AR871625
     C           @SSETC    IFNE WCCY                                                        AR871625
      *                                                                                     AR871625
      ** Access stamp tax currency for decimal places                                       AR871625
      *                                                                                     AR871625
     C                     MOVE WCCY      @AJCD                                             AR871625
     C                     EXSR AOCURR                                                      AR871625
     C                     MOVE A6NBDP    NDP     10                                        AR871625
     C                     MOVELA6SPRT    ZRATE1 138                                        AR871625
     C                     MOVELA6MDIN    ZMDI1   1                                         AR871625
      *                                                                                     AR871625
      ** Access event currency for decimal places                                           AR871625
      *                                                                                     AR871625
     C                     MOVE @SSETC    @AJCD                                             AR871625
     C                     EXSR AOCURR                                                      AR871625
     C                     MOVELA6SPRT    ZRATE2 138                                        AR871625
     C                     MOVELA6MDIN    ZMDI2   1                                         AR871625
      *                                                                                     AR871625
      ** Get exchange rate                                                                  AR871625
      *                                                                                     AR871625
     C                     EXSR RTZXRT                                                      AR871625
      *                                                                                     AR871625
     C                     Z-ADDZRATEX    ZEXCH                                             AR871625
     C                     MOVE ZMDI1     ZMD                                               AR871625
     C                     Z-ADD@PTCAF    ZAMTCI                                            AR871625
     C                     Z-ADDA6NBDP    ZCDPI                                             AR871625
     C                     Z-ADDNDP       ZCDPO                                             AR871625
     C                     CALL 'ZCONVZ1'                                                   AR871625
     C                     PARM           ZAMTCI 150                                        AR871625
     C                     PARM           ZEXCH  138                                        AR871625
     C                     PARM           ZMD     1                                         AR871625
     C                     PARM           ZCCYI   3                                         AR871625
     C                     PARM           ZCCYO   3                                         AR871625
     C                     PARM           ZCDPI   10                                        AR871625
     C                     PARM           ZCDPO   10                                        AR871625
     C                     PARM           ZAMTCO 150                                        AR871625
     C                     Z-ADDZAMTCO    WSTAX                                             AR871625
     C                     ENDIF                                                            AR871625
      *                                                                                     AR871625
     C           WSTAX     MULT U#TAXR    WSSTAX 150                                        AR871625
     C                     Z-ADDWSSTAX    @PTAMT                                            AR871625
     C                     Z-ADDWSSTAX    @PTCA7                                            AR871625
     C                     MOVE *BLANKS   @STAMT                                            AR871625
     C                     MOVE WSSTAX    ZFIELD                                            AR871625
     C                     Z-ADD2         ZADEC                                             AR871625
     C                     EXSR ZEDIT                                                       AR871625
     C                     MOVE ZFIELD    @STAMT                                            AR871625
     C                     MOVE ZFIELD    @STCA7                                            AR871625
     C                     ENDIF                                                            AR871625
     C                     ELSE                                                             AR871625
     C                     MOVE *BLANKS   @STAMT                                            AR871625
     C                     MOVE *BLANKS   @STCA7                                            AR871625
     C                     MOVE *BLANKS   @STCC7                                            AR871625
     C                     ENDIF                                                            AR871625
     C                     MOVE @STLIA    @PTLIA                                            AR871625
     C                     ENDIF                                                            AR871625
      *                                                                   S01176
      ***  Broker Commission Rebate Amount                                S01176
      *                                                                   S01176
     C           @SBCMR    IFNE *BLANKS                                   S01176
     C                     MOVE @OVBCR    @OV                             S01176
     C                     MOVE @STBCC    @XCODE                          S01176
     C                     MOVE @SBCMR    @XAMT                           S01176
     C                     MOVE ' 409'    @XERR1                          S01176
     C                     MOVE ' 410'    @XERR2                          S01176
     C                     Z-ADD87        @I                              S01176
     C                     EXSR SUB503                                    S01176
     C                     MOVE @XAMT     @SBCMR                          S01176
     C                     Z-ADD@XAMTN    @PBCMR                          S01176
     C                     MOVE @OV       @OVBCR                          S01176
     C                     ELSE                                           S01176
     C                     MOVE 'N'       @OVBCR                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  If the Broker Commission and Amount are both present and       S01176
      ***  valid and if the Rebate is applicable and Commission Rebate    S01176
      ***  Percentage is not zero, then if the Broker Commission Rebate   S01176
      ***  is blank or it has not been overridden, recalculate it.        S01176
      *                                                                   S01176
     C           @STBCC    IFNE *BLANKS                                   S01176
     C           *IN68     ANDEQ'0'                                       S01176
     C           @STBCA    ANDNE*BLANKS                                   S01176
     C           *IN69     ANDEQ'0'                                       S01176
     C           @RBBC     ANDEQ'Y'                                       S01176
     C           @CMRP     ANDNE0                                         S01176
      *                                                                   S01176
     C           @SBCMR    IFEQ *BLANKS                                   S01176
     C           @OVBCR    ORNE 'Y'                                       S01176
     C           @PTBCA    MULT @CMRP     @PBCMR                          S01176
     C                     DIV  100       @PBCMR    H                     S01176
     C                     Z-SUB@PBCMR    @PBCMR                          S01176
      *                                                                   S01176
     C                     Z-ADD@PBCMR    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @SBCMR                          S01176
     C           @SBCMR    IFNE @OBCMR
     C                     SETON                     05                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C           @STBCC    IFNE *BLANKS                                   S01176
     C           @STBCA    ANDNE*BLANKS                                   S01176
     C           *IN68     ANDEQ'0'                                       S01176
     C           *IN69     ANDEQ'0'                                       S01176
     C           @RBBC     ANDNE'Y'                                       S01176
     C           @SBCMR    ANDNE*BLANKS                                   S01176
     C           @STBCC    ANDEQ@OTBCC                                    S01176
     C                     MOVE @XERR1    @EA,E                           S01176
     C                     ADD  1         E                               S01176
     C                     MOVE '1'       *IN87                           S01176
     C                     SETON                     11  14               S01176
     C                     ELSE                                           S01176
     C                     Z-ADD0         @PBCMR                          S01176
     C                     MOVE *BLANKS   @SBCMR                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Customer Commission Rebate Amount                              S01176
      *                                                                   S01176
     C           @SCCMR    IFNE *BLANKS                                   S01176
     C                     MOVE @OVCCR    @OV                             S01176
     C                     MOVE @STCCC    @XCODE                          S01176
     C                     MOVE @SCCMR    @XAMT                           S01176
     C                     MOVE ' 411'    @XERR1                          S01176
     C                     MOVE ' 412'    @XERR2                          S01176
     C                     Z-ADD88        @I                              S01176
     C                     EXSR SUB503                                    S01176
     C                     MOVE @XAMT     @SCCMR                          S01176
     C                     Z-ADD@XAMTN    @PCCMR                          S01176
     C                     MOVE @OV       @OVCCR                          S01176
     C                     ELSE                                           S01176
     C                     MOVE 'N'       @OVCCR                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  If the Customer Commission and Amount are both present and     S01176
      ***  valid and if the Rebate is applicable and Commission Rebate    S01176
      ***  Percentage is not 0, then if the Customer Commission Rebate    S01176
      ***  is blank or it has not been overridden, recalculate it.        S01176
      *                                                                   S01176
     C           @STCCC    IFNE *BLANKS                                   S01176
     C           *IN70     ANDEQ'0'                                       S01176
     C           @STCCA    ANDNE*BLANKS                                   S01176
     C           *IN71     ANDEQ'0'                                       S01176
     C           @RBCC     ANDEQ'Y'                                       S01176
     C           @CMRP     ANDNE0                                         S01176
      *                                                                   S01176
     C           @SCCMR    IFEQ *BLANKS                                   S01176
     C           @OVCCR    ORNE 'Y'                                       S01176
     C           @PTCCA    MULT @CMRP     @PCCMR                          S01176
     C                     DIV  100       @PCCMR    H                     S01176
     C                     Z-SUB@PCCMR    @PCCMR                          S01176
      *                                                                   S01176
     C                     Z-ADD@PCCMR    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @SCCMR                          S01176
     C           @SCCMR    IFNE @OCCMR
     C                     SETON                     05                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C*                                                                   S01176
     C           @STCCC    IFNE *BLANKS                                   S01176
     C           @STCCA    ANDNE*BLANKS                                   S01176
     C           *IN70     ANDEQ'0'                                       S01176
     C           *IN71     ANDEQ'0'                                       S01176
     C           @RBBC     ANDNE'Y'                                       S01176
     C           @SCCMR    ANDNE*BLANKS                                   S01176
     C           @STCCC    ANDEQ@OTCCC                                    S01176
     C                     MOVE @XERR1    @EA,E                           S01176
     C                     ADD  1         E                               S01176
     C                     MOVE '1'       *IN88                           S01176
     C                     SETON                     11  14               S01176
     C                     ELSE                                           S01176
     C                     Z-ADD0         @PCCMR                          S01176
     C                     MOVE *BLANKS   @SCCMR                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
      *                                                                   S01176
      ***  TAX Amount                                                     S01176
      *                                                                   S01176
     C                     MOVE @OVTX     @OV                             S01176
     C                     MOVE @TAXC     @XCODE                          S01176
     C                     MOVE @STAXA    @XAMT                           S01176
     C                     MOVE ' 407'    @XERR1                          S01176
     C                     MOVE ' 408'    @XERR2                          S01176
     C                     Z-ADD86        @I                              S01176
     C                     EXSR SUB503                                    S01176
     C                     Z-ADD@XAMTN    @PTAXA                          S01176
     C                     MOVE @XAMT     @STAXA                          S01176
     C                     MOVE @OV       @OVTX                           S01176
      *                                                                   S01176
      ***  TAX Rebate Amount                                              S01176
     C                     MOVE @OVTXR    @OV                             S01176
     C                     MOVE @TAXC     @XCODE                          S01176
     C                     MOVE @STXRB    @XAMT                           S01176
     C                     MOVE ' 413'    @XERR1                          S01176
     C                     MOVE ' 414'    @XERR2                          S01176
     C                     Z-ADD89        @I                              S01176
     C                     EXSR SUB503                                    S01176
     C                     MOVE @XAMT     @STXRB                          S01176
     C                     Z-ADD@XAMTN    @PTXRB                          S01176
     C                     MOVE @OV       @OVTXR                          S01176
      *                                                                   S01176
      ***  Calculate the Tax Amounts if there have been no errors         S01176
      ***  in the Charges validation.                                     S01176
      *                                                                   S01176
     C           *IN14     IFEQ '0'                                       S01176
     C                     EXSR SUB405                                    S01176
      *                                                                   S01176
     C           @PTAXA    IFNE 0                                         S01176
     C                     Z-ADD@PTAXA    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @STAXA                          S01176
     C                     ELSE                                           S01176
     C           @OVTX     IFEQ 'N'                                       S01176
     C                     MOVE *BLANKS   @STAXA                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           @STAXA    IFNE @OTAXA                                    S01176
     C                     SETON                     05                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C*                                                                   S01176
     C           @PTXRB    IFNE 0                                         S01176
     C                     Z-ADD@PTXRB    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @STXRB                          S01176
     C                     ELSE                                           S01176
     C           @OVTXR    IFEQ 'N'                                       S01176
     C                     MOVE *BLANKS   @STXRB                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           @STXRB    IFNE @OTXRB                                    S01176
     C                     SETON                     05                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C** STORE THE PRESENT SCREEN 2 FIELDS FROM BROKER CODE ONWARDS       S01176
     C*                                                                   S01176
     C                     EXSR SUB504                                    S01176
     C*                                                                   S01176
     C**   IF action 'I' & Originating Branch is input and                S01117
     C**      Originating Branch/User Validation = 'Y',                   S01117
     C**   check user's authority to the Originating Branch.              S01117
     C*                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C           @SORBR    IFEQ *BLANKS                                   S01117
     C                     MOVE @SBRCD    @SORBR                          S01117
     C                     ELSE                                           S01117
     C                     MOVE @SORBR    @DSNB                           S01117
     C                     EXSR AOBRCH                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 354'    @EA,E                           S01117
     C                     ADD  1         E                               S01117
     C                     SETON                     2111                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                                       S01117
     C                     Z-ADD*ZERO     @ERR                            S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM @SORBR    @ZOBRX  3                       S01117
     C                     PARM           @ERR    10                      S01117
     C*                                                                   S01117
     C           @ERR      IFEQ 1                                         S01117
     C                     MOVE ' 605'    @EA,E                           S01117
     C                     ADD  1         E                               S01117
     C                     SETON                     2111                 S01117
     C                     ELSE                                           S01117
     C           @ERR      IFEQ 2                                         S01117
     C                     MOVE ' 606'    @EA,E                           S01117
     C                     ADD  1         E                               S01117
     C                     SETON                     2111                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C                     MOVE @SORBR    @PORBR                          S01117
     C*                                                                   S01117
     C**   Validate Profit Centre if it is not protected                  S01117
     C**   and only if Analytical Accounting module is not installed      CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C*                                                                   S01117
     C           *IN27     IFNE '1'                                       S01117
     C           @SPRFC    ANDNE*BLANKS                                   065537
     C                     EXSR AOPRFC                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE ' 356'    @EA,E                           S01117
     C                     ADD  1         E                               S01117
     C                     SETON                     2211                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     MOVE @SPRFC    @PPRFC                          S01117
     C*                                                                   CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *BLANKS   @PPRFC                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   S01486
     C** Validate Portfolio Reference                                     S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           WLPCUS    ANDEQ'Y'                                       081382
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WPBCUS    ANDEQ'Y'                                       CPB001
     C*                                                                   S01486
     C                     SETOF                     232428               S01486
     C***********                                                  S01486 081382
     C***Validate*the customer as a Portfolio Customer if a ReferenS01486 081382
     C***is*entered                                                S01486 081382
     C***********                                                  S01486 081382
     C***********          MOVE @PTCNR    @PTCN2  6                S01486 081382
     C***********          MOVEL@PTCNR    @PLKY                    S01486 081382
     C***********          CALL 'AOPLCSR0'                         S01486 081382
     C***********          PARM *BLANKS   @RTCD                    S01486 081382
     C***********          PARM '*KEY   ' @OPTN                    S01486 081382
     C***********          PARM           @PLKY  10                S01486 081382
     C***********SDPLCS    PARM SDPLCS    DSFDY                    S01486 081382
     C***********                                                  S01486 081382
     C***If*not*on file and an entry has been made then error      S01486 081382
     C***********                                                  S01486 081382
     C***********@RTCD     IFNE *BLANKS                            S01486 081382
     C***********SPTFR     ANDNE*BLANKS                            S01486 081382
     C***********          MOVE ' 425'    @EA,E                    S01486 081382
     C***********          ADD  1         E                        S01486 081382
     C***********          MOVE '1'       *IN11                    S01486 081382
     C***********          MOVE '1'       *IN28                    S01486 081382
     C***********          ELSE                            X2      S01486 081382
     C***********                                                  S01486 081382
     C***If*not*a Portfolio Customer or Portfolio Reference is blanS01486 081382
     C***leave*section                                             S01486 081382
     C***********                                                  S01486 081382
     C***********@RTCD     IFNE *BLANKS                    B3      S01486 081382
     C***********          MOVE 'N'       WLPCUS  1                080681 081382
     C***********          GOTO VPREND                             S01486 081382
     C***********          ELSE                                    080681 081382
     C***********                                                  080681 081382
     C****Else,*it is a portfolio customer                         080681 081382
     C***********          MOVE 'Y'       WLPCUS                   080681 081382
     C***********          END                             E3      S01486 081382
     C***********                                                  S01486 081382
     C** Validate Portfolio Reference                                     S01486
     C*                                                                   S01486
     C** For now, leave portfolio reference blank so user must enter one. 066690
     C*                                                                   066690
     C           SPTFR     IFEQ *BLANKS                    B3             066690
     C*                                                                   066690
     C** or check if customer has a defined portfolio reference           066690
     C*                                                                   066690
     C           @PTCNR    SETLLPMPORTLL                                  066690
     C           @PTCNR    READEPMPORTLL                 01               066690
     C           *IN01     IFEQ '0'                                       066690
     C                     MOVE PNPTFR    SPTFR                           066690
     C                     END                                            066690
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVE FCR997    SPTFR                           145464
     C                     ENDIF                                          CPB001
     C                     MOVE QBCSBY    PNPTCY                          066690
     C                     Z-ADDQBBYDP    PNPCDP                          066690
     C                     ENDIF                                          CPB001
     C                     MOVE '0'       *IN01                           066690
      *                                                                   066690
     C                     ELSE                            X3             066690
      *                                                                   066690
     C           PORTKY    CHAINPMPORTPD             01                   S01486
     C           *IN01     IFEQ '0'                                       S01486
     C           PNRECI    ANDNE'D'                                       S01486
     C                     SETON                     01                   S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** Reference not on file or not a live recird, check on PM ICD      S01486
     C** to see if it refers to the '9997' reference                      S01486
     C*                                                                   S01486
     C           *IN01     IFEQ '1'                        B4             S01486
     C*                                                                   S01486
     C** Validate '9997' Portfolio Reference                              S01486
     C*                                                                   S01486
     C           SPTFR     IFNE FCR997                     B5             S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE ' 506'    @EA,E                           CPB001
     C                     ELSE                                           CPB001
     C                     MOVE ' 424'    @EA,E                           S01486
     C                     ENDIF                                          CPB001
     C                     ADD  1         E                               S01486
     C                     MOVE '1'       *IN11                           S01486
     C                     MOVE '1'       *IN28                           S01486
     C                     ELSE                                           S01486
     C                     MOVE QBCSBY    PNPTCY                          S01486
     C                     Z-ADDQBBYDP    PNPCDP                          S01486
     C                     MOVE '0'       *IN01                           S01486
     C                     END                             E5             S01486
     C*                                                                   S01486
     C** Portfolio is found, but is flagged for closure                   S01486
     C*                                                                   S01486
     C                     ELSE                            X4             S01486
     C           PNDPCL    IFGT 0                          B5             S01486
     C           SPTFR     ANDNE@SAVPR                                    S01486
     C                     MOVE SPTFR     @SAVPR                          S01486
     C                     MOVE ' W09'    @EA,E                           S01486
     C                     ADD  1         E                               S01486
     C                     MOVE '1'       *IN11                           S01486
     C                     MOVE '1'       *IN28                           S01486
     C                     END                             E5             S01486
     C*                                                                   081490
     C**   PORTFOLIO IS FOUND, BUT NOT THE SAME AS FOR SETTL.             081490
     C*                                                                   081490
     C           S01496    IFEQ 'Y'                        B5             081490
     C           WCHECK    IFEQ 'Y'                        B6             081490
     C***********SPTFR     ANDNEZPTFR                      B6      081490 099817
     C           SPTFR     ANDNEPTFR                       B6             099817
     C                     MOVE ' W13'    @EA,E                           081490
     C                     ADD  1         E                               081490
     C                     MOVE '1'       *IN11                           081490
     C                     MOVE '1'       *IN22                           081490
     C                     ENDIF                           E6             081490
     C                     ENDIF                           E5             081490
     C                     END                             E4             S01486
     C                     END                             E3             066690
     C************         END                             E2      S01486 081382
     C*                                                                   S01486
     C** Set up Portfolio Reference for output to file                    S01486
     C*                                                                   S01486
     C           SPTFR     IFEQ FCR997                                    S01486
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE '9997'    @PPTFR                          S01486
     C                     ELSE                                           S01486
     C                     MOVE SPTFR     @PPTFR                          S01486
     C                     END                                            S01486
     C*                                                                   081490
     C**   IF CUSTOMER IS A PORTFOLIO CUSTOMER ,CHECK BLOCKS              081490
     C*                                                                   081490
     C           S01496    IFEQ 'Y'                                       081490
     C           SPTFR     ANDNE*BLANKS                                   081490
     C           @WC1DI    IFEQ 'S'                                       081490
     C           @WC1DI    OREQ 'D'                                       081490
     C                     EXSR WBLOCK                                    081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
     C***********                                                   S01486081490
     C***For*settlement*method*04,*05,*14,*15*check*that*customer*&*S01486081490
     C***portfolio*on*account*are*same*as*on*trade******************S01486081490
     C***********                                                   S01486081490
     C***********S01496    IFEQ 'Y'                                 S01486081490
     C***********@SSMTH    IFEQ '04'                       B2       S01486081490
     C***********@SSMTH    OREQ '05'                                S01486081490
     C***********@SSMTH    OREQ '14'                                S01486081490
     C***********@SSMTH    OREQ '15'                                S01486081490
     C***********                                                   S01486081490
     C***Check*Trade*Customer*same*as*customer*on*settlement*accountS01486081490
     C***********                                                   S01486081490
     C************IN55     IFEQ '0'                        B3       S01486081490
     C***********@STDTP    ANDEQ'TP'                                S01486081490
     C***********                                                   S01486081490
     C***********@PTCNR    IFNE WSCNUM                     B4       S01486081490
     C***********          MOVE ' W12'    @EA,E                     S01486081490
     C***********          ADD  1         E                         S01486081490
     C***********          SETON                     5511           S01486081490
     C***********          END                             E4       S01486081490
     C***********                                                   S01486081490
     C***Check*portfolio*of*trade*same*as*portfolio*of*account******S01486081490
     C***********                                                   S01486081490
     C***********@PTCNR    IFNE WSCNUM                     B4       S01486081490
     C***********@PPTFR    ORNE PTFR                                S01486081490
     C***********BGPFMG    ANDEQ'Y'                                 S01486081490
     C***********          MOVE ' W14'    @EA,E                     S01486081490
     C***********          ADD  1         E                         S01486081490
     C***********          SETON                     5511           S01486081490
     C***********          END                             E4       S01486081490
     C***********          END                             E3       S01486081490
     C***********                                                   S01486081490
     C***Check*Trade*Customer*same*as*Customer*on*settlement*accountS01486081490
     C***********                                                   S01486081490
     C************IN57     IFEQ '0'                        B3       S01486081490
     C***********@STDTP    ANDEQ'TS'                                S01486081490
     C***********                                                   S01486081490
     C***********@PTCNR    IFNE WSCNUM                     B4       S01486081490
     C***********          MOVE ' W13'    @EA,E                     S01486081490
     C***********          ADD  1         E                         S01486081490
     C***********          SETON                     5711           S01486081490
     C***********          END                             E4       S01486081490
     C***********                                                   S01486081490
     C***Check*Portfolio*of*trade*same*as*Portfolio*of*account******S01486081490
     C***********                                                   S01486081490
     C***********@PTCNR    IFNE WSCNUM                     B4       S01486081490
     C***********@PPTFR    ORNE PTFR                                S01486081490
     C***********BGPFMG    ANDEQ'Y'                                 S01486081490
     C***********          MOVE ' W15'    @EA,E                     S01486081490
     C***********          ADD  1         E                         S01486081490
     C***********          SETON                     5711           S01486081490
     C***********          END                             E4       S01486081490
     C***********          END                             E3       S01486081490
     C***********          END                             E2       S01486081490
     C***********          END                             E2       S01496081490
     C*                                                                   S01496
     C           VPREND    TAG                             * VPREND TAG * S01486
     C*                                                                   S01486
     C** Obtain FX Rate for Trade Date between Settlement Currency        S01486
     C** and Base Currency for accounting                                 S01486
     C** except if Trade Date is equal to the Run Date.                   S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     MOVE *BLANKS   SSPXR                           S01486
     C                     MOVE *BLANKS   SSPMD                           S01486
     C                     Z-ADD0         @PSPXR                          S01486
     C                     MOVE *BLANKS   @PSPMD                          S01486
     C*                                                                   S01486
     C           *IN28     IFEQ '0'                        B2             S01486
     C           *IN01     ANDEQ'0'                                       S01486
     C           WLPCUS    ANDEQ'Y'                                       080681
     C*                                                                   S01486
     C           @PTDDT    IFNE RUND                       B3             S01486
     C**********           MOVE @PSETC    HSEXCY  3                 S01486156949
     C                     MOVE VLCY      HSEXCY  3                       156949
     C           HSEXKY    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 01               S01486
     C*                                                                   S01486
     C           *IN01     IFEQ '1'                        B4             S01486
     C********** @PSETC    ORNE Q8CCY                               S01486156949
     C           VLCY      ORNE Q8CCY                                     156949
     C*                                                                   S01486
     C           HSEXKY    SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 01               S01486
     C                     END                             E4             S01486
     C                     ELSE                            X3             S01486
     C                     SETON                         01               S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C           *IN01     IFEQ '1'                        B3             S01486
     C********** @PSETC    ORNE Q8CCY                               S01486156949
     C           VLCY      ORNE Q8CCY                                     156949
     C*                                                                   S01486
     C**********           MOVEL@PSETC    @AJCD                     S01486156949
     C                     MOVELVLCY      @AJCD                           156949
     C                     MOVEL*BLANKS   @RTCD                           S01486
     C                     EXSR AOCURR                                    S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANKS                    B4             S01486
     C                     SETON                     U7U8                 S01486
     C                     MOVE '35'      @DBASE            ************  S01486
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  S01486
     C**********           MOVEL@PSETC    @DBKEY       *ERROR 35 *  S01486156949
     C                     MOVELVLCY      @DBKEY            * ERROR 35 *  156949
     C                     EXSR *PSSR                                     S01486
     C                     END                             E4             S01486
     C                     Z-ADDA6SPRT    Q8SPOT                          S01486
     C                     MOVE A6MDIN    Q8MDV1                          S01486
     C                     Z-ADDA6NBDP    Q8CDP                           S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C***Set*up*SR/ZCCYCN*with*'FROM'*details*for*Settlement*Curren S01486156949
     C** Set up SR/ZCCYCN with 'FROM' details for Value Currency          156949
     C*                                                                   S01486
     C                     Z-ADDQ8SPOT    ZRATEF                          S01486
     C                     MOVE Q8MDV1    ZMDINF                          S01486
     C                     Z-ADDQ8CDP     ZCDPF                           S01486
     C**********           MOVE @PSETC    ZCCYF                     S01486156949
     C                     MOVE VLCY      ZCCYF                           156949
     C*                                                                   S01486
     C** Obtain FX Rate for Trade Date between Portfolio Currency         S01486
     C** and Base Currency for accounting                                 S01486
     C** except if Trade Date is equal to the Run Date.                   S01486
     C*                                                                   S01486
     C           @PTDDT    IFNE RUND                       B3             S01486
     C                     MOVE PNPTCY    HSEXCY                          S01486
     C           HSEXKY    SETGTPMHSEXPD                                  S01486
     C                     READPPMHSEXPD                 01               S01486
     C*                                                                   S01486
     C           *IN01     IFEQ '1'                        B3             S01486
     C           PNPTCY    ORNE Q8CCY                                     S01486
     C*                                                                   S01486
     C           HSEXKY    SETLLPMHSEXPD                                  S01486
     C                     READ PMHSEXPD                 01               S01486
     C                     END                             E4             S01486
     C                     ELSE                            X3             S01486
     C                     SETON                         01               S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C           *IN01     IFEQ '1'                        B4             S01486
     C           PNPTCY    ORNE Q8CCY                                     S01486
     C*                                                                   S01486
     C                     MOVELPNPTCY    @AJCD                           S01486
     C                     MOVEL*BLANKS   @RTCD                           S01486
     C                     EXSR AOCURR                                    S01486
     C*                                                                   S01486
     C           @RTCD     IFNE *BLANKS                    B4             S01486
     C                     SETON                     U7U8                 S01486
     C                     MOVE '36'      @DBASE            ************  S01486
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  S01486
     C                     MOVELPNPTCY    @DBKEY            * ERROR 36 *  S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                             E4             S01486
     C*                                                                   S01486
     C                     Z-ADDA6SPRT    Q8SPOT                          S01486
     C                     MOVE A6MDIN    Q8MDV1                          S01486
     C                     Z-ADDA6NBDP    Q8CDP                           S01486
     C                     END                             E3             S01486
     C*                                                                   S01486
     C** Set up SR/ZCCYCN with 'TO' details for Portfolio Currency        S01486
     C*                                                                   S01486
     C                     Z-ADDQ8SPOT    ZRATET                          S01486
     C                     MOVE Q8MDV1    ZMDINT                          S01486
     C                     Z-ADDQ8CDP     ZCDPT                           S01486
     C                     MOVE PNPTCY    ZCCYT                           S01486
     C*                                                                   S01486
     C** Calculate cross rate between Settlement Currency and             S01486
     C** Portfolio Currency using standard subroutine SR/ZCCYCN           S01486
     C*                                                                   S01486
     C/COPY WNCPYSRC,SE3002C007
     C                     Z-ADD0         ZAMTF                           S01486
     C                     EXSR ZCCYCN                                    S01486
     C/COPY WNCPYSRC,SE3002C008
     C*                                                                   S01486
     C                     MOVE *BLANKS   ZFIELD                          S01486
     C                     MOVE ZCRSRT    ZFIELD                          S01486
     C                     Z-ADD8         ZADEC                           S01486
     C                     EXSR ZEDIT                                     S01486
     C                     MOVE ZFIELD    SSPXR                           S01486
     C                     MOVE ZCRSRT    ZFIELD                          156949
     C                     Z-ADD0         ZADEC                           156949
     C                     EXSR ZEDIT                                     156949
     C***********          MOVE SSPXR     @PSPXR                   S01486 156949
     C                     MOVE ZFIELD    @PSPXR                          156949
     C                     MOVE ZCRSMD    SSPMD                           S01486
     C                     MOVE ZCRSMD    @PSPMD                          156949
     C*                                                                   S01486
     C                     END                             E2             S01486
     C                     ENDIF                                          CPB001
     C*                                                                   S01486
     C                     END                             E1             S01486
     C*                                                                   065009
     C* If autocharges active and amounts amended, set redisplay indicator065009
     C* or, if Analytical Accounting module is installed                  CAC002
     C*                                                                   065009
     C           *IN41     IFEQ '0'                                       065009
     C           BGN0ST    OREQ 'Y'                                       CAC002
     C                     MOVE @STCTR    @OTCTR 21                       065009
     C                     EXSR SUB508                                    065009
     C           @STCTR    IFNE @OTCTR                                    065009
     C                     MOVE '1'       *IN05                           065009
     C                     END                                            065009
     C                     END                                            065009
     C*                                                                   CEU005
     C** Validate new field 'IN Ccy in Field 72'.                         CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           @SICCY    ANDNEOLDCCY                                    CEU005
     C           @SICCY    ANDNE*BLANKS                                   CEU005
     C                     MOVEL@SICCY    @AJCD                           CEU005
     C                     MOVEL*BLANKS   @RTCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C*                                                                   CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C           @RTCD     ANDNE'*NRF   '                                 CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '37'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVEL@SICCY    @DBKEY            * ERROR 37 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     SELEC                                          CEU005
     C           @RTCD     WHEQ '*NRF   '                                 CEU005
     C                     MOVE *ON       *IN11                           CEU005
     C                     MOVE *ON       *IN08                           CEU005
     C                     MOVE ' 360'    @EA,E                           CEU005
     C                     ADD  1         E                               CEU005
     C           A6INCY    WHNE 'Y'                                       CEU005
     C                     MOVE *ON       *IN11                           CEU005
     C                     MOVE *ON       *IN08                           CEU005
     C                     MOVE ' 361'    @EA,E                           CEU005
     C                     ADD  1         E                               CEU005
     C           @SICCY    WHNE NMCY                                      CEU005
     C           NMCY      IFNE BKEURO                                    CEU005
     C                     MOVE *ON       *IN11                           CEU005
     C                     MOVE *ON       *IN08                           CEU005
     C                     MOVE ' 362'    @EA,E                           CEU005
     C                     ADD  1         E                               CEU005
     C                     ELSE                                           CEU005
     C                     MOVE @SICCY    @PICCY                          CEU005
     C                     ENDIF                                          CEU005
     C           @SSMTH    WHNE '01'                                      CEU005
     C           @SSMTH    ANDNE'08'                                      CEU005
     C                     MOVE *ON       *IN11                           CEU005
     C                     MOVE *ON       *IN08                           CEU005
     C                     MOVE ' 363'    @EA,E                           CEU005
     C                     ADD  1         E                               CEU005
     C                     OTHER                                          CEU005
     C                     MOVE @SICCY    @PICCY                          CEU005
     C                     ENDSL                                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
      *                                                                                       234552
      ** Validate whether account is blocked due to EU Tax by calling                         234552
      ** SEVTAXDATE                                                                           234552
      *                                                                                       234552
     C           CGL031    IFEQ 'Y'                                                           234552
     C                     CALL SEVDAT                                                        234552
      *                                                                                       234552
      * INPUTS                                                                                234552
      *                                                                                       234552
      ** Return Code                                                                          234552
     C                     PARM *BLANKS   @RTCD                                               234552
     C******************   PARM *BLANKS   WDFLT                                        234552 235546
     C                     PARM 'Y'       WDFLT                                               235546
     C                     PARM 'I'       WACTN   1                                           234552
     C                     PARM           @PTDBA                                              234552
     C                     PARM           @PTCNR                                              234552
     C                     PARM           @PTDSS                                              234552
     C                     PARM           @PPTFR                                              234552
     C                     PARM           @PTDMI                                              234552
     C                     PARM 'T'       WTYPE   1                                           234552
     C                     PARM           @PTDRF                                              234552
     C                     PARM           @PTDVD                                              234552
     C                     PARM '@SPTFR'  WFIELD 10                                           234552
     C                     PARM           @SECTY                                              234552
     C                     PARM           @CUSDT                                              234552
      *                                                                                       234552
      * OUTPUTS                                                                               234552
      *                                                                                       234552
      * Error fields/message IDs/message data (arrays) from/to caller                         234552
     C                     PARM           @FNXA                                               234552
     C                     PARM           @MIXA                                               234552
     C                     PARM           @MDXA                                               234552
      ** Warning Fields/Message IDs/Message Data (arrays) From/To Caller                      234552
     C                     PARM           @WFNXA                                              234552
     C                     PARM           @WMIXA                                              234552
     C                     PARM           @WMDXA                                              234552
      *                                                                                       234552
      ** Value Date - OK                                                                      234552
     C                     PARM           WVDTOK  1                                           234552
     C           WVDTOK    IFEQ 'N'                                                           234552
     C                     SETON                     1152                                     234552
     C*****************    MOVEA@MIXA,1   ZAMSID                                       234552 235546
     C*****************    MOVEA@MDXA,1   ZAMSDA    P                                  234552 235546
     C                     MOVEA@WMIXA,1  ZAMSID                                              235546
     C                     MOVEA@WMDXA,1  ZAMSDA    P                                         235546
     C                     CALL 'FCRVMGC'                                                     234552
     C                     PARM *BLANKS   W0RTN   7                                           234552
     C                     PARM           ZAMSID  7                                           234552
     C                     PARM 'SEUSRMSG'ZAMSGF 10                                           234552
     C                     PARM           ZAMSDA132                                           234552
     C                     PARM           ZAMSTX132                                           234552
      *                                                                                       234552
 B2  C           W0RTN     IFEQ *BLANKS                                                       234552
     C                     MOVEAZAMSTX    @EA,1                                               234552
     C                     MOVEA@EA,1     @SERR1                                              234552
 X2  C                     ELSE                                                               234552
     C           ZAMSID    CAT  '- ??':1  @SERR1    P                                         234552
 E2  C                     ENDIF                                                              234552
     C                     ENDIF                                                              234552
     C                     ENDIF                                                              234552
     C*                                                                   CEU005
      *                                                                   S01176
     C                     ENDSR                           SUB203 ends    S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCP4                                           S01408
     C*                                                                   S01408
      *                                                                   S01176
      ********************************************************************S01176
      /EJECT                                                              S01401
      *****************************************************************   S01401
      *                                                               *   S01401
      *  MT500  Produce SWIFT Messages, MT5xxs                        *   S01401
      *                                                               *   S01401
      *  OUTPUT : PERR - Error code: 'N' = No error                   *   S01401
      *                              'U' = extension file not Updated *   S01401
      *           PCMD - Retrn code :'03'= Exit to Menu               *   S01401
      *                              '05'= Refresh Screen (Enq. only) *   S01401
      *                              '12'= Previous Screen (no update)*   S01401
      *                                                               *   S01401
      *****************************************************************   S01401
      *                                                                   S01401
     C           MT500     BEGSR                                          S01401
      *                                                                   S01401
     C           @ACODE    IFNE 'N'                                       S01401
     C*                                                                   S01401
     C                     MOVE *BLANK    WWCWIN  1                       S01401
     C*                                                                   S01401
     C** WHEN IN 'ENQUIRY' MODE, EXTENDED PROGRAM IS ONLY CALLED          S01401
     C** WHEN 'ENTER' IS PRESSED                                          S01401
     C           @ACODE    IFEQ 'E'                                       S01401
     C           *INKI     ANDEQ'1'                                       S01401
     C                     MOVE 'N'       WWCWIN                          S01401
     C                     ENDIF                                          S01401
     C*                                                                   S01401
     C           *INKC     IFEQ '0'                                       S01401
     C           *INKE     ANDEQ'0'                                       S01401
     C           *INKL     ANDEQ'0'                                       S01401
     C           WWCWIN    ANDNE'N'                                       S01401
     C*                                                                   S01401
     C**   If Action is Amend and Incomplete Indicator 'C',               S01401
     C**   Change Action Code to Enquiry                                  S01401
     C           @ACODE    IFEQ 'A'                                       S01401
     C           @PTINC    ANDEQ'C'                                       S01401
     C                     MOVE 'E'       PACTN                           S01401
     C                     ELSE                                           S01401
     C                     MOVE @ACODE    PACTN                           S01401
     C                     ENDIF                                          S01401
     C*                                                                   S01401
     C*                                                                   S01401
     C           PACTN     IFEQ 'C'                                       S01401
     C                     MOVE 'A'       PACTN                           S01401
     C                     ENDIF                                          S01401
     C*                                                                   S01401
     C**   Move Trade Ref. into DATA (as specified in SE0050DTA)          S01401
     C                     MOVE @STDRF    PTDRF                           S01401
     C                     MOVE @PTCNR    PTCNR                           S01401
     C                     MOVE @SSESN    PSESN                           S01401
     C                     MOVE @STDTP    PTDTP                           S01401
     C                     MOVE ZNOML     PNOML                           S01401
     C                     MOVE @STDMI    PTDMI                           S01401
     C                     MOVEL@PDELT    PDELT                           S01401
     C                     MOVE *BLANKS   PTDSI                           S01401
     C                     MOVEL@STDSI    PTDSI                           S01401
     C                     MOVE @PTNMC    PTNMC                           S01401
     C                     MOVE @SBRCD    PTDBR                           S01401
     C                     MOVE @PDELF    PDELF                           S01401
     C                     MOVE BVDR2     PDC02                           S01401
     C                     MOVE @NCDP     PNOMD                           S01401
     C                     MOVE @SCLTY    PCLTY                           S01401
     C                     MOVE @SPCOD    PPCOD                           S01401
     C                     MOVE @SSMTH    PSMTH                           S01401
     C                     MOVE @WC101    PC101                           S01401
     C                     MOVE @WC102    PC102                           S01401
     C                     MOVE @SAIIP    PAIIP                           S01401
     C                     MOVE PROT      PPROT                           S01401
     C                     MOVE @SINCS    PINCS                           S01401
     C                     MOVE *BLANKS   PTRTT                           S01401
     C                     MOVEL@SBLKR    PBLKR                           S01401
     C                     MOVE @SPRYC    PPRYC                           CSW003
     C                     MOVE @PTDVD    PTDVD                           104032
     C/COPY WNCPYSRC,SE3002C049
     C*                                                                   S01401
     C           PACTN     IFEQ 'I'                                       S01401
     C                     MOVE 'B'       PACTN                           S01401
     C                     ENDIF                                          S01401
     C*                                                                   S01401
     C**********           CALL 'SE1805'                                  S01401              CSE028
     C                     CALL 'SE001805'                                                    CSE028
     C                     PARM '00'      PCMD    2                       S01401
     C                     PARM 'N'       PERR    1                       S01401
     C                     PARM           PDATA                           S01401
      *                                                                   S01401
      **  Extra parameter needed to pass details from TRADSDX1 & TRADSD   S01401
      **  TRADSDX2 to SE1805 & SE1806 for reference trade.                S01401
     C                     PARM           TRADX1                          S01401
     C                     PARM           TRADX2                          S01401
      *                                                                   S01401
      ** If Extension File not updated in SE1805 then prepare message     S01401
      *                                                                   S01401
     C           PERR      IFEQ 'U'                                       S01401
     C                     MOVE ' 610'    @EA,E                           S01401
     C                     ADD  1         E                               S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
      ** If no errors on return SE1805 then prepare message               S01401
      *                                                                   S01401
     C***********PERR      IFNE 'N'                                S01401 165966
     C***********PERR      ANDNE'U'                                S01401 165966
     C           PERR      IFEQ 'N'                                       165966
      *                                                                   S01401
      ** If F3 for End (Exit to menu) taken indicate to SE3002            S01401
      ** that program should be exited.                                   S01401
      *                                                                   S01401
     C           PCMD      IFEQ '03'                                      S01401
     C                     MOVE *ON       *IN01                           S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
      ** If F5 for Refresh (display initial screen) taken                 S01401
      ** indicate to SE3002 that initial screen should be re-displayed.   S01401
      *                                                                   S01401
     C           PCMD      IFEQ '05'                                      S01401
     C                     MOVE *ON       *IN05                           S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
      ** If F12 for Previous Screen (no update) taken previous screen     S01401
      ** should be re-displayed.                                          S01401
      *                                                                   S01401
     C           PCMD      IFEQ '12'                                      S01401
     C                     MOVE *ON       *IN12                           S01401
     C                     MOVE '1'       WMT500                          165966
     C                     ELSE                                           165966
     C                     MOVE '0'       WMT500                          165966
     C                     ENDIF                                          S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
     C                     ENDIF                                          S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
     C                     ENDSR                                          S01401
      *                                                                   S01401
      *****************************************************************   S01401
      /EJECT                                                              S01401
      *****************************************************************   S01401
      *                                                               *   S01401
      *  SETUP  Produce SWIFT Messages, MT5xxs                        *   S01401
      *                                                               *   S01401
      *****************************************************************   S01401
      *                                                                   S01401
     C           SETUP     BEGSR                                          S01401
      *                                                                   S01401
     C**   If Action is Insert and record already exists on               S01401
     C**   extension file (LF/TRADSDZ1) for the trade,                    S01401
     C**   change Action Code to 'B'.                                     S01401
     C           @ACODE    IFEQ 'I'                                       S01401
     C           TRDRF     CHAINTRADSDZ1             26                   S01401
     C           *IN26     IFEQ '1'                                       S01401
     C                     Z-ADD2         @DBASE           ***************S01401
     C                     MOVEL'TRADSXD1'@DBFIL           * DB ERROR 02 *S01401
     C                     MOVELTRDRF     @DBKEY           ***************S01401
     C                     EXSR *PSSR                                     S01401
     C                     ELSE                                           S01401
     C                     MOVEL@BKRF     T1TDRF                          S01401
     C                     ENDIF                                          S01401
     C           TRDRF     CHAINTRADSDZ2             26                   S01401
     C           *IN26     IFEQ '1'                                       S01401
     C                     MOVE *BLANKS   TRADX2                          S01401
     C                     ENDIF                                          S01401
     C                     MOVEL@BKRF     T2TDRF                          S01401
      *                                                                   S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
     C                     ENDSR                                          S01401
      *****************************************************************   S01401
      /EJECT                                                              S01401
      *                                                                   S01176
      *     FROM HERE TO THE START OF SUB300 IS COMMENTED OUT             S01176
      *                                                                   S01176
      ********************************************************************S01176
      *                                                                   S01176
      **Other*charges*code************************************************S01176
     C***********          MOVEL@STOCC    @XCODE                          S01176
     C***********          MOVEL@OTOCC    @OCODE                          S01176
     C***********          MOVEL' 402'    @XERR1                          S01176
     C***********          MOVEL' 403'    @XERR2                          S01176
     C***********          Z-ADD82        @I                              S01176
     C***********          MOVEL@STOCA    @XAMT                           S01176
     C***********          EXSR SUB500                                    S01176
     C***********          MOVEL@STOCC    @PTOCC                          S01176
     C***********          MOVEL@VL       @COVL   1                       S01176
      ***********                                                         S01176
      **Charge*amount*other***********************************************S01176
     C***********          MOVEL' 404'    @XERR1                          S01176
     C***********          Z-ADD83        @J                              S01176
     C***********          EXSR SUB501                                    S01176
     C***********          MOVE @XAMT     @STOCA                          S01176
     C***********          Z-ADD@XAMTN    @PTOCA                          S01176
      ***********                                                         S01176
      **Local*tax*code****************************************************S01176
     C***********          MOVEL@STLTC    @XCODE                          S01176
     C***********          MOVEL@OTLTC    @OCODE                          S01176
     C***********          MOVEL' 399'    @XERR1                          S01176
     C***********          MOVEL' 400'    @XERR2                          S01176
     C***********          Z-ADD84        @I                              S01176
     C***********          MOVEL@STLTA    @XAMT                           S01176
     C***********          EXSR SUB500                                    S01176
     C***********          MOVEL@STLTC    @PTLTC                          S01176
     C***********          MOVEL@VL       @TXVL   1                       S01176
      ***********                                                         S01176
      **Local*tax*amount**************************************************S01176
     C***********          MOVEL' 401'    @XERR1                          S01176
     C***********          Z-ADD85        @J                              S01176
     C***********          EXSR SUB501                                    S01176
     C***********          MOVE @XAMT     @STLTA                          S01176
     C***********          Z-ADD@XAMTN    @PTLTA                          S01176
      ***********                                                         S01176
      **VAT*amount********************************************************S01176
     C***********          MOVEL*BLANKS   ZFLD17                          S01176
     C***********          MOVEL@STVCA    ZFLD17                          S01176
     C***********          EXSR ZASIGN                                    S01176
      ***********                                                         S01176
     C************IN99     IFEQ '1'                                       S01176
     C***********          MOVEL' 386'    @EA,E                           S01176
     C***********          ADD  1         E                               S01176
     C***********          SETON                     11  86               S01176
     C***********          MOVEL*HIVAL    @WTVCA 15                       S01176
     C***********          MOVEL*HIVAL    @WCVAT 150                      S01176
      ***********                                                         S01176
     C***********          ELSE                                           S01176
     C***********          MOVE ZOUT15    @PTVCA                          S01176
     C***********ZFSIGN    IFEQ '-'                                       S01176
     C***********          Z-SUB@PTVCA    @PTVCA                          S01176
     C***********          END                                            S01176
      ***********                                                         S01176
     C***********          EXSR SUB505                                    S01176
     C***********@STVCA    IFEQ *BLANKS                                   S01176
     C***********          Z-ADD@CVAT     @PTVCA                          S01176
     C***********          MOVEL*HIVAL    @WTVCA                          S01176
     C***********          MOVEL*HIVAL    @WCVAT                          S01176
     C***********          SETON                     05                   S01176
     C***********          END                                            S01176
      ***********                                                         S01176
     C***********          Z-ADD@PTVCA    ZFLD15                          S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @STVCA                          S01176
      ***********                                                         S01176
     C***********@PTVCA    IFNE @CVAT                                     S01176
     C***********@STVCA    IFNE @WTVCA                                    S01176
     C***********@WCVAT    ORNE @CVAT                                     S01176
     C***********          MOVEL@STVCA    @WTVCA                          S01176
     C***********          Z-ADD@CVAT     @WCVAT                          S01176
     C***********          MOVEL' W09'    @EA,E                           S01176
     C***********          ADD  1         E                               S01176
     C***********          SETON                     11  86               S01176
     C***********          END                                            S01176
     C***********          END                                            S01176
      ***********                                                         S01176
     C***********          END                                            S01176
      *
      *                                                                   S01176
      ********************************************************************S01176
      /EJECT
     C*****************************************************************   081490
     C*                                                               *   081490
     C*  WBLOCK - Subroutine to check blocks in validation            *   081490
     C*                                                               *   081490
     C*****************************************************************   081490
     C*                                                                   081490
     C           WBLOCK    BEGSR                                          081490
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      ***  or if Securities Redenomination feature is installed.          CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Search if there is Corporate Actiuons General Block for        CSE007
      ***  Customer.                                                      CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6714                          CSE007
     C                     CALL 'SE7574'                                  CSE007
     C                     PARM           @PBRCD  3                       CSE007
     C                     PARM           @PCNUM  6                       CSE007
     C                     PARM           @PPTFR  4                       CSE007
     C                     PARM           @PPGB   1                       CSE007
     C                     PARM           @PSGB   1                       CSE007
      *                                                                   CSE007
      ***  If block found, send error message and setup work field to     CSE007
      ***  not call SE6714.                                               CSE007
      *                                                                   CSE007
     C           @PPGB     IFEQ 'Y'                                       CSE007
     C           @PTDTP    ANDEQ'TP'                                      CSE007
     C           @PSGB     OREQ 'Y'                                       CSE007
     C           @PTDTP    ANDEQ'TS'                                      CSE007
      *                                                                   CSE007
     C           @PPTFR    IFEQ *BLANKS                                   CSE007
     C                     MOVE ' CO2'    @EA,E                           CSE007
     C                     SETON                     11                   CSE007
     C                     ELSE                                           CSE007
     C                     MOVE ' CO6'    @EA,E                           CSE007
     C                     SETON                     11  22               CSE007
     C                     ENDIF                                          CSE007
     C                     MOVE 'N'       SE6714                          CSE007
     C                     ADD  1         E                               CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is switched OFF or Corporate      CSE007
      ***  Actions General Block for Customer not found.                  CSE007
      *                                                                   CSE007
     C           SE6714    IFEQ 'Y'                                       CSE007
     C*                                                                   081490
     C**   .... search if there is General Block for Customer             081490
     C*                                                                   081490
     C                     CALL 'SE6714'                                  081490
     C                     PARM           @PBRCD  3                       081490
     C                     PARM           @PCNUM  6                       081490
     C                     PARM           @PPTFR  4                       081490
     C                     PARM           @PPGB   1                       081490
     C                     PARM           @PSGB   1                       081490
     C*                                                                   081490
     C           @PPGB     IFEQ 'Y'                                       081490
     C           @PTDTP    ANDEQ'TP'                                      081490
     C           @PSGB     OREQ 'Y'                                       081490
     C           @PTDTP    ANDEQ'TS'                                      081490
     C*                                                                   081490
     C           @PPTFR    IFEQ *BLANKS                                   081490
     C                     MOVE ' WR2'    @EA,E                           081490
     C                     SETON                     11                   081490
     C                     ELSE                                           081490
     C                     MOVE ' WR6'    @EA,E                           081490
     C                     SETON                     11  22               081490
     C                     ENDIF                                          081490
     C                     ADD  1         E                               081490
     C*                                                                   081490
     C                     ENDIF                                          081490
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is installed.                     CSE007
      ***  or if Securities Redenomination feature is installed.          CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Search if there is Corporate Actions Specific Block for        CSE007
      ***  Customer and Security.                                         CSE007
      *                                                                   CSE007
     C                     MOVE 'Y'       SE6710                          CSE007
     C                     CALL 'SE7570'                                  CSE007
     C                     PARM           @PRDNB                          CSE007
     C                     PARM           @POBPO                          CSE007
     C                     PARM           @PBRCD                          CSE007
     C                     PARM           @PTDSS                          CSE007
     C                     PARM           @PCNUM                          CSE007
     C                     PARM           @PPTFR                          CSE007
     C                     PARM           @PBLTY                          CSE007
     C                     PARM           @PNOBL 13                       CSE007
     C**********           PARM           @PNOPO 13                                 CSE007 AR1075401
     C                     PARM           @PNOPO 15                                        AR1075401
      *                                                                   CSE007
     C                     MOVE @PNOBL    WWNOBL 130                      CSE007
     C**********           MOVE @PNOPO    WWNOPO 130                                CSE007 AR1075401
     C                     MOVE @PNOPO    WWNOPO 150                                       AR1075401
      *                                                                   CSE007
      ***  If block found, send error message and setup work field to     CSE007
      ***  not call SE6710.                                               CSE007
      *                                                                   CSE007
     C           WWNOBL    IFEQ *HIVAL                                    CSE007
     C           @PPTFR    IFEQ *BLANKS                                   CSE007
     C                     MOVE ' CO3'    @EA,E                           CSE007
     C                     SETON                     11                   CSE007
     C                     ELSE                                           CSE007
     C                     MOVE ' CO7'    @EA,E                           CSE007
     C                     SETON                     11  22               CSE007
     C                     ENDIF                                          CSE007
     C                     ADD  1         E                               CSE007
     C                     MOVE 'N'       SE6710                          CSE007
     C                     ELSE                                           CSE007
      *                                                                   CSE007
     C           WWNOBL    IFNE *ZEROS                                    CSE007
     C           @PTDTP    IFEQ 'TP'                                      CSE007
     C           WWNOPO    SUB  NOML      WWFONO 130                      CSE007
     C           WWFONO    IFLT WWNOBL                                    CSE007
     C           @PPTFR    IFEQ *BLANKS                                   CSE007
     C                     MOVE ' CO4'    @EA,E                           CSE007
     C                     SETON                     11                   CSE007
     C                     ELSE                                           CSE007
     C                     MOVE ' CO8'    @EA,E                           CSE007
     C                     SETON                     11  22               CSE007
     C                     ENDIF                                          CSE007
     C                     ADD  1         E                               CSE007
     C                     MOVE 'N'       SE6710                          CSE007
     C                     ENDIF                                          CSE007
     C                     ELSE                                           CSE007
      *                                                                   CSE007
     C           WWNOPO    ADD  NOML      WWFONO                          CSE007
     C           WWFONO    IFGT WWNOBL                                    CSE007
     C           @PPTFR    IFEQ *BLANKS                                   CSE007
     C                     MOVE ' CO4'    @EA,E                           CSE007
     C                     SETON                     11                   CSE007
     C                     ELSE                                           CSE007
     C                     MOVE ' CO8'    @EA,E                           CSE007
     C                     SETON                     11  22               CSE007
     C                     ENDIF                                          CSE007
     C                     ADD  1         E                               CSE007
     C                     MOVE 'N'       SE6710                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  If Corporate Actions feature is switched OFF or Corporate      CSE007
      ***  Actions Specific Block for Customer and Security not found.    CSE007
      *                                                                   CSE007
     C           SE6710    IFEQ 'Y'                                       CSE007
     C*                                                                   081490
     C**   ... search if there is Specific Block for Customer and Secty   081490
     C*                                                                   081490
     C                     CALL 'SE6710'                                  081490
     C                     PARM           @PRDNB                          081490
     C                     PARM           @POBPO                          081490
     C                     PARM           @PBRCD                          081490
     C                     PARM           @PTDSS                          081490
     C                     PARM           @PCNUM                          081490
     C                     PARM           @PPTFR                          081490
     C                     PARM           @PBLTY                          081490
     C                     PARM           @PNOBL 13                       081490
     C**********           PARM           @PNOPO 13                                 081490 AR1075401
     C                     PARM           @PNOPO 15                                        AR1075401
     C                     PARM           @PCOLF                          CGL011
     C                     PARM *BLANKS   @PCOLA 15                       CGL011
     C*                                                                   081490
     C                     MOVE @PNOBL    WWNOBL 130                      081490
     C**********           MOVE @PNOPO    WWNOPO 130                                081490 AR1075401
     C                     MOVE @PNOPO    WWNOPO 150                                       AR1075401
      *                                                                   CGL011
     C           @PCOLF    IFEQ 'Y'                                       CGL011
     C           @PTDTP    ANDEQ'TP'                                      CGL011
     C           @PCOLA    ANDNE*ZEROS                                    CGL011
     C                     MOVE @PCOLA    WWCOLL 150                      CGL011
     C           WWNOPO    SUB  @PNOML    WCOLLA 150                      CGL011
     C           WCOLLA    IFLT WWCOLL                                    CGL011
     C                     MOVE *ON       *IN11                           CGL011
     C                     MOVE ' W30'    @EA,E                           CGL011
     C                     ADD  1         E                               CGL011
     C                     ENDIF                                          CGL011
     C                     ENDIF                                          CGL011
     C*                                                                   081490
     C           WWNOBL    IFEQ *HIVAL                                    081490
     C           @PPTFR    IFEQ *BLANKS                                   081490
     C                     MOVE ' WR3'    @EA,E                           081490
     C                     SETON                     11                   081490
     C                     ELSE                                           081490
     C                     MOVE ' WR7'    @EA,E                           081490
     C                     SETON                     11  22               081490
     C                     ENDIF                                          081490
     C                     ADD  1         E                               081490
     C                     ELSE                                           081490
     C*                                                                   081490
     C           WWNOBL    IFNE *ZEROS                                    081490
     C           @PTDTP    IFEQ 'TP'                                      081490
     C           WWNOPO    SUB  NOML      WWFONO 130                      081490
     C           WWFONO    IFLT WWNOBL                                    081490
     C           @PPTFR    IFEQ *BLANKS                                   081490
     C                     MOVE ' WR4'    @EA,E                           081490
     C                     SETON                     11                   081490
     C                     ELSE                                           081490
     C                     MOVE ' WR8'    @EA,E                           081490
     C                     SETON                     11  22               081490
     C                     ENDIF                                          081490
     C                     ADD  1         E                               081490
     C                     ENDIF                                          081490
     C                     ELSE                                           081490
     C*                                                                   081490
     C           WWNOPO    ADD  NOML      WWFONO                          081490
     C           WWFONO    IFGT WWNOBL                                    081490
     C           @PPTFR    IFEQ *BLANKS                                   081490
     C                     MOVE ' WR4'    @EA,E                           081490
     C                     SETON                     11                   081490
     C                     ELSE                                           081490
     C                     MOVE ' WR8'    @EA,E                           081490
     C                     SETON                     11  22               081490
     C                     ENDIF                                          081490
     C*                                                                   081490
     C                     ADD  1         E                               081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
     C                     ENDIF                                          081490
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*                                                                   081490
     C           WBEND     ENDSR                                          081490
     C*                                                                   081490
     C/EJECT                                                              081490
      *******************************************************************
      *  SUB300 - Common defaults for screen 1                          *
      *******************************************************************
      *
     C           SUB300    BEGSR
      *
      * Incomplete indicator
     C           @PTINC    IFEQ *BLANKS
     C                     MOVELINCS      @PTINC
     C                     END
      *
      * Book ID : If not set up already, then if this is an agency trade
      *           it should be set to default agency book from ICD. If not
      ************an*agency*trade,*then*if*discretionary*ind.*is*M*use****S01176
      *           an agency trade, then if classification is M, use       S01176
      *           default market book else use default portfolio book.
      *                                                                   S01176
     C           @PTDBK    IFEQ *BLANKS
     C           @PATRD    IFNE *BLANKS
     C***********          MOVELATBK      @PTDBK                          S01117
     C                     MOVELBVATBK    @PTDBK                          S01117
     C                     ELSE
     C***********C1DI      IFEQ 'M'                                       S01117
     C***********          MOVELDMKB      @PTDBK                          S01117
     C           BFCLAS    IFEQ 'M'                                       S01117
     C                     MOVELBVDMBC    @PTDBK                          S01117
     C                     ELSE
     C***********          MOVELDPFB      @PTDBK                          S01117
     C                     MOVELBVDPBC    @PTDBK                          S01117
     C                     END
     C                     END
     C                     END
      *
      * Market centre: defaults to market centre for investment type
     C           @PTMKC    IFEQ *BLANKS
     C                     MOVELDMKT      @PTMKC
     C                     END
      *
      **Trade*sub-type:*default*value*on*ICD*according*to*discretionary***S01176
      ******************indicator*****************************************S01176
      *****Trade*Sub-Type:*Default*value*on*PF/TABTB36*according   S01176 S01117
      ***  Trade Sub-Type: Default value on SDSTRDPD   according          S01117
      ***                  to classification.                             S01176
      *                                                                   S01176
     C           @PTSUB    IFEQ *BLANKS
     C***********C1DI      IFEQ 'M'                                       S01117
     C***********          MOVELDMKS      @PTSUB                          S01117
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE3002CLD1                                           S01408
     C*                                                                   S01408
     C           BFCLAS    IFEQ 'M'                                       S01117
     C                     MOVELBVDMKS    @PTSUB                          S01117
     C                     ELSE
     C***********          MOVELDPFS      @PTSUB                          S01117
     C                     MOVELBVDPFS    @PTSUB                          S01117
     C                     END
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE3002CLD2                                           S01408
     C*                                                                   S01408
     C                     END
      *
      * Market indicator: defaults to market ind for security
     C           @PTDMI    IFEQ *BLANKS
     C                     MOVELMKTI      @PTDMI
     C                     END
     C/COPY WNCPYSRC,SE3002C059
      *
      **AIBD/IPMA:*defaults*to*Y***************************************   E43208
      * ISMA/IPMA: defaults to Y                                          E43208
      *                                                                   E43208
     C           @PAIIP    IFEQ *BLANKS
     C                     MOVEL'Y'       @PAIIP
     C                     END
      *
      * Current factor: from security details if processing type is 8
     C           @PTCFC    IFEQ 0
     C           PROT      ANDEQ'8'
     C           *IN45     ANDEQ'1'
     C                     Z-ADDCFCT      @PTCFC
     C                     END
      *
      * Settlement currency: If customer is safe custody or discretionary,
      *          then try 1. Value currency from standard settlements
      *                   2. Settlement currency from client SE details
      *                   3. Value currency from security details
      *                   4. Nominal currency from security details
      *       If multicurrency, then try payment currency then nominal
      *       If not multicurrency, try value currency then nominal
     C           @PSETC    IFEQ *BLANKS
     C***********C1DI      IFEQ 'S'                                       S01117
     C***********C1DI      OREQ 'D'                                       S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C           S01509    IFEQ 'Y'                                       S01509
     C/COPY WNCPYSRC,SE3002C041
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE '0'       *IN01                                               CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP   1                                           CSE028
     C                     PARM           @PTDBA                                              CSE028
     C                     PARM           @PTCNR                                              CSE028
     C**********           PARM           SIBK                                         CSE028 CSE034
     C                     PARM SIBK      PSIBK   2                                           CSE034
     C                     PARM           NMCYA                                               CSE028
     C                     PARM SMCC      PMRKT   2                                           CSE034
     C                     PARM           SITP                                                CSE028
     C                     PARM           PTFR                                                CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD                                               CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN01                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           @KEY4S    CHAINSTDSED               01                   S01509
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE3002C042
     C                     ELSE                                           S01509
     C/COPY WNCPYSRC,SE3002C043
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE '0'       *IN01                                               CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP                                               CSE028
     C                     PARM           @PTDBA                                              CSE028
     C                     PARM           @PTCNR                                              CSE028
     C**********           PARM           SIBK                                         CSE028 CSE034
     C                     PARM SIBK      PSIBK                                               CSE034
     C                     PARM           VLCY                                                CSE028
     C                     PARM SMCC      PMRKT                                               CSE034
     C                     PARM           SITP                                                CSE028
     C                     PARM           PTFR                                                CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD                                               CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN01                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           @KEY4     CHAINSTDSED               01
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
     C/COPY WNCPYSRC,SE3002C044
     C                     END                                            S01509
      *                                                                   CEU005
      ** CEU005 active and settlement currency not blank.                 CEU005
      ** Obtain EURO rate, EURO M/D ind. and transition start date for    CEU005
      ** 'IN' currency.                                                   CEU005
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           SCCY      ANDNE*BLANK                                    CEU005
     C           *IN01     ANDEQ'0'                                       CEU005
      *                                                                   CEU005
     C           NMCYA     IFEQ BKEURO                                    CEU005
     C                     MOVE *BLANK    @RTCD                           CEU005
     C                     MOVEL'*DBERR'  @RTCD                           CEU005
     C                     MOVE SCCY      @AJCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '39'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVELSCCY      @DBKEY            * ERROR 39 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C                     ELSE                                           CEU005
     C           SCCY      IFEQ BKEURO                                    CEU005
     C                     MOVE *BLANK    @RTCD                           CEU005
     C                     MOVEL'*DBERR'  @RTCD                           CEU005
     C                     MOVE NMCYA     @AJCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '40'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVELNMCYA     @DBKEY            * ERROR 40 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C                     END                                            CEU005
     C                     END                                            CEU005
     C*                                                                   CEU005
     C           @PTDVD    IFEQ 0                                         CEU005
     C                     MOVELVDFT      @WVDFT  20                      CEU005
     C                     MOVE VDFT      @WVDFW  1                       CEU005
     C*                                                                   CEU005
     C*    If the Default number of days is 'Working Days', then call     CEU005
     C*    ZFWDT to calculate the Default Value Date, else default is     CEU005
     C*    actual days, so add the number of days to the Run Date.        CEU005
     C*                                                                   CEU005
     C           @WVDFW    IFEQ 'W'                                       CEU005
     C                     Z-ADDRUND      ZDAYNO                          CEU005
     C                     Z-ADD@WVDFT    ZNRDYS                          CEU005
     C                     MOVE NMCYA     ZCCY                            CEU005
     C                     MOVE *BLANK    ZLOC                            CEU005
     C                     EXSR ZFWDT                                     CEU005
     C                     Z-ADDZDYNBR    @PTDVD                          CEU005
     C                     ELSE                                           CEU005
     C           RUND      ADD  @WVDFT    @PTDVD                          CEU005
     C                     END                                            CEU005
     C                     END                                            CEU005
      *                                                                   CEU005
      * Value date later than Transition start date, use settlement       CEU005
      * currency from PF/STDSED.                                          CEU005
      *                                                                   CEU005
     C           @PTDVD    IFGE A6TPSD                                    CEU005
     C                     MOVELSCCY      @PSETC                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'N'                                       CEU005
     C           SCCY      OREQ *BLANKS                                   CEU005
     C           *IN01     IFEQ '0'
     C           RECI      ANDEQ'D'
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELNMCYA     @PSETC                          S01509
     C                     ELSE                                           S01509
     C                     MOVELVLCY      @PSETC
     C                     END                                            S01509
     C                     ELSE
     C***********C1SC      IFNE *BLANKS                                   S01117
     C***********          MOVELC1SC      @PSETC                          S01117
     C           BFCYCD    IFNE *BLANKS                                   S01117
     C                     MOVELBFCYCD    @PSETC                          S01117
     C                     ELSE
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELNMCYA     @PSETC                          S01509
     C                     ELSE                                           S01509
     C           VLCY      IFNE *BLANKS
     C                     MOVELVLCY      @PSETC
     C                     ELSE
     C                     MOVELNMCYA     @PSETC
     C                     END
     C                     END                                            S01509
     C                     END
     C                     END
     C                     ENDIF                                          CEU005
     C                     ELSE
     C           CEU005    IFEQ 'N'                                       CEU005
     C           @PSETC    OREQ *BLANKS                                   CEU005
     C           MLTI      IFEQ 'Y'
     C***********SPYC      IFNE *BLANKS                                   065524
     C***********          MOVELSPYC      @PSETC                          065524
     C***********          ELSE                                           065524
     C                     MOVELNMCYA     @PSETC
     C***********          END                                            065524
     C                     END
     C           MLTI      IFEQ 'N'
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELNMCYA     @PSETC                          S01509
     C                     ELSE                                           S01509
     C           VLCY      IFNE *BLANKS
     C                     MOVELVLCY      @PSETC
     C                     ELSE
     C                     MOVELNMCYA     @PSETC
     C                     END
     C                     END                                            S01509
     C                     END
     C                     END
     C                     END
      *                                                                   CEU005
     C                     END                                            CEU005
      *
      * Capacity indicator:
      ** Capacity indicator should now be defaulted to 0, always.         085546
     C                     Z-ADD0         @PTCAP                          085546
      *                                                                   CAC002
      **  If Analytical Accounting is installed...                        CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     MOVE *OFF      *IN36                           CAC002
     C                     MOVE *BLANKS   SBPRC                           CAC002
     C                     MOVE *BLANKS   STPRC                           CAC002
      *                                                                   CAC005
      ** Default Book Profit Centre only if CAC005 is off.                CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'N'                                       CAC005
      *                                                                   CAC002
      **  Default Book Profit Centre from current book position profit    CAC002
      **  centre record if found and protect on screen                    CAC002
      *                                                                   CAC002
     C                     MOVEL@PTDBK    BOKC                            CAC002
     C                     MOVEL@PTDBA    KBRC                            CAC002
     C                     MOVEL@PTDSS    KSSN                            CAC002
     C                     MOVEL@PTDMI    MKTI                            CAC002
     C           KLSPCB    CHAINSEPCBD               01                   CAC002
     C           *IN01     IFEQ '0'                                       CAC002
     C                     MOVE PCBK      @PBPRC                          CAC002
     C                     MOVE *ON       *IN36                           CAC002
      *                                                                   CAC002
      **  Else default from matrix and allow amendment                    CAC002
     C                     ELSE                                           CAC002
     C           BKPCDU    IFEQ 'Y'                                       CAC002
     C                     MOVEL@PTDTP    @TRTY                           CAC002
     C                     MOVE @PTCNR    @CUST                           CAC002
     C                     EXSR AOPRFM                                    CAC002
     C           #RTCD     IFEQ '0'                                       CAC002
     C                     MOVE @PRFC     @PBPRC                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC005
     C                     ELSE                                           CAC005
     C                     MOVE *OFF      *IN36                           CAC005
     C                     MOVE @PBPRC    SBPRC                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC002
      **  Default Trans. Profit Centre from current customer position     CAC002
      **  profit centre record if found (for portfolio customers)         CAC002
      **  and protect on screen                                           CAC002
      *                                                                   CAC002
     C           BFCLAS    IFEQ 'S'                                       CAC002
     C           BFCLAS    OREQ 'D'                                       CAC002
      *                                                                   CAC002
     C                     MOVE *OFF      *IN37                           CAC002
     C                     MOVE *ON       *IN38                           CAC002
     C                     MOVE @PTCNR    KCNUM                           CAC002
     C                     MOVE @PTDBA    KBRCA                           CAC002
     C                     MOVE @PTDSS    KSESN                           CAC002
     C           KLSPCC    CHAINSEPCCD               01                   CAC002
     C           *IN01     IFEQ '0'                                       CAC002
     C                     MOVE PCCU      @PTPRC                          CAC002
     C                     MOVE *ON       *IN37                           CAC002
     C                     ELSE                                           CAC002
     C           BKPCDU    IFEQ 'Y'                                       CAC002
     C                     MOVEL@PTDTP    @TRTY                           CAC002
     C                     MOVE @PTCNR    @CUST                           CAC002
     C                     EXSR AOPRFM                                    CAC002
     C           #RTCD     IFEQ '0'                                       CAC002
     C                     MOVE @PRFC     @PTPRC                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Else default Transaction Profit Centre to Book Profit Centre    CAC002
      **  and do not display (not a portfolio customer)                   CAC002
     C                     ELSE                                           CAC002
     C                     MOVE SBPRC     @PTPRC                          CAC002
     C                     MOVE *OFF      *IN38                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      ***********                                                         085546
      **********************If*not*an*agency*trade*=*5****************   085546
      ********Purchase******If*client*agency*trade*=*4****************   085546
      **********************If*market*agency*trade*=*6****************   085546
      ***********                                                         085546
      ***********************If*not*an*agency*trade*=*2****************   085546
      ********Sale**********If*client*agency*trade*=*1****************   085546
      **********************If*market*agency*trade*=*3****************   085546
     C***********@PTCAP    IFEQ 0                                         085546
     C***********@PTDTP    IFEQ 'TP'                                      085546
     C***********@PATRD    IFEQ 'C'                                       085546
     C***********          Z-ADD4         @PTCAP                          085546
     C***********          ELSE                                           085546
     C***********@PATRD    IFEQ 'M'                                       085546
     C***********          Z-ADD6         @PTCAP                          085546
     C***********          ELSE                                           085546
     C***********          Z-ADD5         @PTCAP                          085546
     C***********          END                                            085546
     C***********          END                                            085546
     C***********          ELSE                                           085546
     C***********@PATRD    IFEQ 'C'                                       085546
     C***********          Z-ADD1         @PTCAP                          085546
     C***********          ELSE                                           085546
     C***********@PATRD    IFEQ 'M'                                       085546
     C***********          Z-ADD3         @PTCAP                          085546
     C***********          ELSE                                           085546
     C***********          Z-ADD2         @PTCAP                          085546
     C***********          END                                            085546
     C***********          END                                            085546
     C***********          END                                            085546
     C***********          END                                            085546
     C***********                                                  S01448 085546
     C***If*Bulk*Input*Enhancements*feature*is*on*the*switchable***S01448 085546
     C***features*file*then*overwrite*set*up*of*capacity*indicator*S01448 085546
     C***********                                                  S01448 085546
     C**********************If*not*an*agency*trade*=*5************S01448 085546
     C**********************Else**********************************S01448 085546
     C********Purchase******If*portfolio*client****=*4************S01448 085546
     C**********************Else**********************************S01448 085546
     C**********************Set to*****************=*6************S01448 085546
     C***********                                                  S01448 085546
     C**********************If*not*an*agency*trade*=*2************S01448 085546
     C**********************Else**********************************S01448 085546
     C********Sale**********If*portfolio*client****=*1************S01448 085546
     C**********************Else**********************************S01448 085546
     C**********************set*to*****************=*3************S01448 085546
     C***********                                                  S01448 085546
     C***********S01448    IFEQ 'Y'                                S01448 085546
     C***********                                                  S01448 085546
     C***********@PTDTP    IFEQ 'TP'                               S01448 085546
     C***********@PATRD    IFEQ *BLANK                             S01448 085546
     C***********          Z-ADD5         @PTCAP                   S01448 085546
     C***********          ELSE                                    S01448 085546
     C***********BFCLAS    IFEQ 'S'                                S01448 085546
     C***********BFCLAS    OREQ 'D'                                S01448 085546
     C***********          Z-ADD4         @PTCAP                   S01448 085546
     C***********          ELSE                                    S01448 085546
     C***********          Z-ADD6         @PTCAP                   S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
     C***********@PTDTP    IFEQ 'TS'                               S01448 085546
     C***********@PATRD    IFEQ *BLANK                             S01448 085546
     C***********          Z-ADD2         @PTCAP                   S01448 085546
     C***********          ELSE                                    S01448 085546
     C***********BFCLAS    IFEQ 'S'                                S01448 085546
     C***********BFCLAS    OREQ 'D'                                S01448 085546
     C***********          Z-ADD1         @PTCAP                   S01448 085546
     C***********          ELSE                                    S01448 085546
     C***********          Z-ADD3         @PTCAP                   S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
      *
     C                     ENDSR                           SUB300 ends
      *                                                                   S01176
      ********************************************************************S01176
      /EJECT
      *******************************************************************
      *  SUB301 - Screen 1 defaults for unrelated trades                *
      *******************************************************************
     C           SUB301    BEGSR
      *
      * Value date: Add run date to value date default, then check date
      * as below and add 1 until valid date found.
      *    1. If date is issue date, use that
      *    2. If maturity date is non-zero, and date > maturity, use
      *       maturity date
      *    3. If clearance type = 1 or 2, date must not be holiday in
      *       Euroclear currency
      *    4. If clearance type = 3 or 4, date must not be holiday in
      *       Cedel currency
      *    5. If clearance type is 2,4 or 5, date must not be holiday
      *       in the settlement currency
      *    6. Date must not be a holiday in the value/payment currency
     C           @PTDVD    IFEQ 0
     C                     MOVELVDFT      @WVDFT  20
     C                     MOVE VDFT      @WVDFW  1                       065016
     C*                                                                   065016
     C*    If the Default number of days is 'Working Days', then call     065016
     C*    ZFWDT to calculate the Default Value Date, else default is     065016
     C*    actual days, so add the number of days to the Run Date.        065016
     C*                                                                   065016
     C           @WVDFW    IFEQ 'W'                                       065016
     C                     Z-ADDRUND      ZDAYNO                          065016
     C                     Z-ADD@WVDFT    ZNRDYS                          065016
     C                     MOVE NMCYA     ZCCY                            065016
     C                     MOVE *BLANK    ZLOC                            065016
     C                     EXSR ZFWDT                                     065016
     C                     Z-ADDZDYNBR    @PTDVD                          065016
     C                     ELSE                                           065016
     C           RUND      ADD  @WVDFT    @PTDVD
     C                     END                                            065016
     C           *IN99     DOUEQ'0'
     C                     SETOF                     99
     C           @PTDVD    IFLT ISSD
     C                     Z-ADDISSD      @PTDVD
     C                     ELSE
     C           MATY      IFGT 0
     C           @PTDVD    ANDGTMATY
     C                     Z-ADDMATY      @PTDVD
     C                     ELSE
     C           PPDI      IFEQ 'Y'
     C           @PTDVD    ANDLESLCA
     C                     ADD  1         @PTDVD
     C                     SETON                     99
     C                     END
     C           *IN99     IFEQ '0'
     C           @PCLTY    ANDEQ'1'
     C           @PCLTY    OREQ '2'
     C                     Z-ADD@PTDVD    ZDAYNO
     C***********          MOVELECYC      ZCCY                            S01117
     C***********          EXSR ZDATE5                                    S01195
     C                     MOVE BVEUCY    ZCCY                            S01117
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     SETON                     99                   S01195
     C                     END                                            S01195
     C   99                ADD  1         @PTDVD
     C                     END
     C           *IN99     IFEQ '0'
     C           @PCLTY    ANDEQ'3'
     C           @PCLTY    OREQ '4'
     C                     Z-ADD@PTDVD    ZDAYNO
     C***********          MOVELCCYC      ZCCY                            S01117
     C                     MOVE BVCCCY    ZCCY                            S01117
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     SETON                     99                   S01195
     C                     END                                            S01195
     C***********          EXSR ZDATE5                                    S01195
     C   99                ADD  1         @PTDVD
     C                     END
     C           *IN99     IFEQ '0'
     C           @PCLTY    ANDEQ'2'
     C           @PCLTY    OREQ '4'
     C           @PCLTY    OREQ '5'
     C                     Z-ADD@PTDVD    ZDAYNO
     C***********          MOVELC1SC      ZCCY                            S01117
     C                     MOVE BFCYCD    ZCCY                            S01117
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     SETON                     99                   S01195
     C                     END                                            S01195
     C***********          EXSR ZDATE5                                    S01195
     C   99                ADD  1         @PTDVD
     C                     END
     C           *IN99     IFEQ '0'
     C                     Z-ADD@PTDVD    ZDAYNO
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELNMCYA     ZCCY                            S01509
     C                     ELSE                                           S01509
     C                     MOVELVLCY      ZCCY
     C                     END                                            S01509
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     SETON                     99                   S01195
     C                     END                                            S01195
     C***********          EXSR ZDATE5                                    S01195
     C   99                ADD  1         @PTDVD
     C                     END
     C************IN99     IFEQ '0'                                       065524
     C***********          Z-ADD@PTDVD    ZDAYNO                          065524
     C***********          MOVELSPYC      ZCCY                            065524
     C***********          MOVE *BLANKS   ZLOC                     S01195 065524
     C***********          EXSR ZCHKH                              S01195 065524
     C***********ZIND      IFEQ 'H'                                S01195 065524
     C***********          SETON                     99            S01195 065524
     C***********          END                                     S01195 065524
     C***********          EXSR ZDATE5                                    S01195
     C***99******          ADD  1         @PTDVD                          065524
     C***********          END                                            065524
     C                     END
     C                     END
     C                     END
     C                     END
      *
      **Branch*code:*defaults*to*value*ICD**************************      S01117
     C***********@PTDBR    IFEQ 0                                         S01117
     C***********          Z-ADDDSTB      @PTDBR                          S01117
     C***********          END                                            S01117
      *
      * Trade date: defaults to earlier of run and value dates
     C           @PTDDT    IFEQ 0
     C           RUND      IFLT @PTDVD
     C                     Z-ADDRUND      @PTDDT
     C                     ELSE
     C                     Z-ADD@PTDVD    @PTDDT
     C                     END
     C                     END
      *
      ***  If the processing type is 1, 3, 5, 6, 8 or 9                   S01176
      ***  and the Trade Basis is 'P' or 'Y'                              S01176
      *
     C           *IN42     IFEQ '1'
      *
      * Accrued indicator: If value date equals next coupon date (via
      *                    ZNCD) = F
      *                    If value date less than next coupon date,
      *                    and greater than or equal to ex date = X
      *                    Else = C
      *
     C/COPY WNCPYSRC,SE3002C032
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C                     Z-ADDECD       SECD    50                                          CSE035
     C                     Z-ADDNCDD5     SNCDD5  50                                          CSE035
     C                     Z-ADDLCDD5     SLCDD5  50                                          CSE035
     C                     Z-ADD@PTDVD    ECD                                                 CSE035
      *                                                                                       CSE035
      ** Call ZLCD + ZNCD to determine next and last coupon dates                             CSE035
      *                                                                                       CSE035
     C                     Z-ADDNCD       @NCD    50                                          CSE035
     C                     EXSR ZNCD                                                          CSE035
     C                     Z-ADDNCD       NCDD5   50                                          CSE035
     C                     Z-ADD@NCD      NCD                                                 CSE035
     C                     Z-ADDZZLCD     @LCD    50                                          CSE035
     C           NCDD5     SUB  1         ZECD                                                CSE035
     C                     EXSR ZLCD                                                          CSE035
     C                     Z-ADDZZLCD     LCDD5   50                                          CSE035
     C                     Z-ADD@LCD      ZZLCD                                               CSE035
      *                                                                                       CSE035
      *                                                                                       CSE035
      ** If TDVD is less than the FCPN, get the Last Coupon from the                          CSE035
      ** coupon array.                                                                        CSE035
      *                                                                                       CSE035
     C           TDVD      IFLT FCPN                                                          CSE035
     C                     EXSR ZLCD1                                                         CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     Z-ADDSECD      ECD                                                 CSE035
     C           @PTDVD    IFLT FCPN                                                          CSE035
     C           PROT      ANDEQ'1'                                                           CSE035
     C           ITLD      IFGE ZZLCD1                                                        CSE035
     C           NCDD5     IFNE FCPN                                                          CSE035
     C                     MOVE 'D'       @PACIN                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
      ** If Initial date coincides with the regular coupon date, it                           CSE035
      ** should be CUM.                                                                       CSE035
      *                                                                                       CSE035
     C           ITLD      IFEQ ZZLCD1                                                        CSE035
     C           NCDD5     ANDEQFCPN                                                          CSE035
     C                     MOVE 'C'       @PACIN                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
      ** If not, it should be 'NX'.                                                           CSE035
      *                                                                                       CSE035
     C                     MOVE 'N'       @PACIN                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'D'       @PACIN                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           @PACIN    IFEQ *BLANKS                                                       CSE035
     C                     MOVEL'C'       @PACIN                                              CSE035
     C                     EXSR ZNCD                                                          CSE035
     C           @PTDVD    IFEQ NCD                                                           CSE035
     C                     MOVEL'F'       @PACIN                                              CSE035
     C                     ELSE                                                               CSE035
     C                     MOVELEDFT      ZNRDYS                                              CSE035
     C           ZNRDYS    IFNE 0                                                             CSE035
     C                     MOVE EDFT      @WEDFT  1                                           CSE035
     C           @WEDFT    IFEQ 'W'                                                           CSE035
     C                     Z-ADDNCD       ZDAYNO                                              CSE035
     C                     MOVE NMCYA     ZCCY                                                CSE035
     C                     MOVE *BLANKS   ZLOC                                                CSE035
     C                     EXSR ZBKDT                                                         CSE035
     C                     ELSE                                                               CSE035
     C           NCD       SUB  ZNRDYS    ZDYNBR                                              CSE035
     C                     ENDIF                                                              CSE035
     C           @PTDVD    IFLT NCD                                                           CSE035
     C           @PTDVD    ANDGEZDYNBR                                                        CSE035
     C           NCD       ANDNEMATY                                                          CSE035
     C                     MOVEL'X'       @PACIN                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     Z-ADDSNCDD5    NCDD5                                               CSE035
     C                     Z-ADDSLCDD5    LCDD5                                               CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'N'                                                           CSE035
      *                                                                                       CSE035
     C           @PACIN    IFEQ *BLANKS
     C                     MOVEL'C'       @PACIN
     C/COPY WNCPYSRC,SE3002C018
     C                     EXSR ZNCD
     C           @PTDVD    IFEQ NCD
     C/COPY WNCPYSRC,SE3002C019
     C                     MOVEL'F'       @PACIN
     C                     ELSE
     C                     MOVELEDFT      ZNRDYS
     C           ZNRDYS    IFNE 0
     C                     MOVE EDFT      @WEDFT  1
     C           @WEDFT    IFEQ 'W'
     C                     Z-ADDNCD       ZDAYNO
     C                     MOVE NMCYA     ZCCY
     C                     MOVE *BLANKS   ZLOC                            S01195
     C***********          EXSR XDATE3                                    S01195
     C                     EXSR ZBKDT                                     S01195
     C                     ELSE
     C           NCD       SUB  ZNRDYS    ZDYNBR
     C                     END
     C           @PTDVD    IFLT NCD
     C           @PTDVD    ANDGEZDYNBR
     C                     MOVEL'X'       @PACIN
     C                     END
     C                     END
     C                     END
     C                     END
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE3002C033
      *
      * Days adjustment: default from security details
     C           @PDADJ    IFEQ 0
     C                     Z-ADDIADJ      @PDADJ
     C                     END
      *
      * Actual/difference indicator: If days adj. not zero = D
     C           @PADIN    IFEQ *BLANKS
     C           @PDADJ    ANDNE0
     C                     MOVEL'D'       @PADIN
     C                     END
      *
      * Interest amount
     C           @PITRA    IFEQ 0
     C*********************EXSR SUB401                                    E21050
     C                     Z-ADD@PNOML    NOML                            E21050
     C                     MOVE @PACIN    ZACIN                           E21050
     C                     MOVE @PDADJ    ZDADJ                           E21050
     C                     MOVE @PADIN    ZADIN                           E21050
     C                     Z-ADD@PTDCR    TDCR                            E21050
     C                     Z-ADD@NCDP     ZCDP                            S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCP9                                           S01408
     C*                                                                   S01408
     C                     EXSR ZPCINT                                    E21050
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CP10                                           S01408
     C*                                                                   S01408
     C*                                                                   E21050
     C                     END
      *
      * Coupon rate: default from security details
     C           @PTDCR    IFEQ 0
     C                     Z-ADDCPNR      @PTDCR
     C                     END
      *
     C                     END
      *                                                                                       234440
      ** Fiscal Price                                                                         234440
      *                                                                                       234440
     C           CGL031    IFEQ 'Y'                                                           234440
     C                     EXSR SRVFSP                                                        234440
     C                     ENDIF                                                              234440
      *
     C                     ENDSR                           SUB301 ends
      *                                                                   S01176
      ********************************************************************S01176
      /EJECT
      *******************************************************************
      *  SUB302 - Screen 1 defaults for related trades                  *
      *******************************************************************
     C           SUB302    BEGSR
      *
      * Get related trade details
     C           @PRTRF    CHAINTRADSDF              01
     C           *IN01     IFEQ '1'
     C                     Z-ADD14        @DBASE           ***************
     C                     MOVEL'TRADS'   @DBFIL           * DB ERROR 14 *
     C                     MOVEL@PRTRF    @DBKEY           ***************
     C***********          EXSR SUB999                                    S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
      *
      * Value date defaults to value on related trade
     C           @PTDVD    IFEQ 0
     C                     Z-ADDTDVD      @PTDVD
     C                     END
      *
      * Branch code defaults to value on related trade
     C***********@PTDBR    IFEQ 0                                         S01117
     C***********          Z-ADDTDBR      @PTDBR                          S01117
     C           @PTDBA    IFEQ *BLANKS                                   S01117
     C                     MOVE TDBA      @PTDBA                          S01117
     C                     END
      *
      * Trade date defaults to value on related trade
     C           @PTDDT    IFEQ 0
     C                     Z-ADDTDDT      @PTDDT
     C                     END
      *
      * The following defaults are only applied if processing type is
      **1,3,5,6*or*8*and*trade*basis*is*P*or*Y.***************************S01176
      * 1, 3, 5, 6, 8 or 9 and Trade Basis is P or Y.                     S01176
      *                                                                   S01176
     C           *IN42     IFEQ '1'
      *
      * Accrued indicator
     C           @PACIN    IFEQ *BLANKS
     C                     MOVELACIN      @PACIN
     C                     END
      *
      * Days adjustment
     C           @PDADJ    IFEQ 0
     C                     Z-ADDDADJ      @PDADJ
     C                     END
      *
      * Actual difference
     C           @PADIN    IFEQ *BLANKS
     C                     MOVELADIN      @PADIN
     C                     END
      *
      * Interest amount
     C           @PITRA    IFEQ 0
     C                     Z-ADDITRA      @PITRA
     C                     Z-ADDTINA      @PTINA
     C                     END
      *
      * Coupon rate
     C           @PTDCR    IFEQ 0
     C                     Z-ADDTDCR      @PTDCR
     C                     END
      *
     C                     END
      *
     C                     ENDSR                           SUB302 ends
      *                                                                   S01176
      ********************************************************************S01176
      /EJECT
      *******************************************************************
      *  SUB303 - Screen 2 defaults                                     *
      *******************************************************************
     C           SUB303    BEGSR
      *
     C           @PTDER    IFEQ 0
      *
      * Exchange rate defaults to value on trade details if settlement
      **currency*equals*payment*currency*******************               065524
     C***********@PSETC    IFEQ SPYC                                      065524
     C***********          Z-ADDSEXR      @PTDER                          065524
     C***********SMDI      IFEQ '0'                                       065524
     C***********SMDI      OREQ 'D'                                       065524
     C***********          MOVEL'D'       @PTMDI                          065524
     C***********          ELSE                                           065524
     C***********          MOVEL'M'       @PTMDI                          065524
     C***********          END                                            065524
     C***********          END                                            065524
      *
      * Exchange rate defaults to 1 if settlement currency is nominal
      * currency
     C           @PSETC    IFEQ @PTNMC
     C                     Z-ADD1         @PTDER
     C                     MOVEL'M'       @PTMDI
     C                     END
     C*                                                                   E36795
     C**   .. Settlement currency is not = Nominal currency               E36795
     C*       or payment currency - Calculate cross rate                  E36795
     C           @PSETC    IFNE *BLANKS                                   E36795
     C           @PSETC    ANDNE@PTNMC                                    E36795
     C***********@PSETC    ANDNESPYC                               E36795 065524
      *                                                                   CEU005
      * CEU005 active, determine which currency is EURO currency and      CEU005
      * which is 'IN' currency. Use appropriate Euro rate and M/D         CEU005
      * indicator.                                                        CEU005
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
      *                                                                   135566
      ** Check if Settlement Ccy (@PSETC) is the Euro Ccy,                135566
     C           @PSETC    IFEQ BKEURO                                    CEU005
      *                                                                   135566
      ** ...If so, check if the Nominal Ccy (@PTNMC) is an 'In' Ccy       135566
      **           and value date (@PTDVD) is equal to or greater         135566
      **           than the EMU Transition Period (A6TPSD),               135566
      *                                                                   135566
     C                     MOVE @PTNMC    @AJCD                           CEU005
     C                     MOVE *BLANKS   @RTCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '41'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVELNMCYA     @DBKEY            * ERROR 41 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           @PTDVD    ANDGEA6TPSD                                    CEU005
      *                                                                   135566
      ** ..... If so, default Exchange Rate (@PTDER) to                   135566
      **              EMU Exchange Rate (A6EUER)                          135566
      *                                                                   135566
     C                     Z-ADDA6EUER    @PTDER                          CEU005
      *                                                                   CEU005
     C                     MOVELA6EUMD    @PTMDI                          143690
     C***********A6MDIN    IFEQ 'M'                                CEU005 143690
     C***********          MOVEL'D'       @PTMDI                   CEU005 143690
     C***********          ELSE                                    CEU005 143690
     C***********          MOVEL'M'       @PTMDI                   CEU005 143690
     C***********          ENDIF                                   CEU005 143690
      *                                                                   135566
      ** Set On *IN33 to protect the Exchange Rate                        135566
      ** and Mult/Div Ind fields                                          135566
     C                     MOVE '1'       *IN33                           135566
      *                                                                   135566
     C                     ENDIF                                          CEU005
      *                                                                   135566
      ** Otherwise, check if the Nominal Ccy (@PTNMC) is the Euro Ccy,    135566
      *                                                                   CEU005
     C                     ELSE                                           CEU005
     C           @PTNMC    IFEQ BKEURO                                    CEU005
      *                                                                   135566
      ** ...If so, check if the Settlement Ccy (@PTNMC) is an 'In' Ccy    135566
      **           and value date (@PTDVD) is equal to or greater         135566
      **            than the EMU Transition Period (A6TPSD),              135566
      *                                                                   135566
     C                     MOVE @PSETC    @AJCD                           CEU005
     C                     MOVE *BLANKS   @RTCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '42'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVEL@PSETC    @DBKEY            * ERROR 42 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
      *                                                                   135566
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           @PTDVD    ANDGEA6TPSD                                    CEU005
      *                                                                   135566
      ** ..... If so, default Exchange Rate (@PTDER) to                   135566
      **              EMU Exchange Rate (A6EUER)                          135566
      *                                                                   135566
     C                     Z-ADDA6EUER    @PTDER                          CEU005
     C***********          MOVELA6MDIN    @PTMDI                   CEU005 143690
     C           A6EUMD    IFEQ 'M'                                       143690
     C                     MOVEL'D'       @PTMDI                          143690
     C                     ELSE                                           143690
     C                     MOVEL'M'       @PTMDI                          143690
     C                     ENDIF                                          143690
      *                                                                   135566
      ** Set On *IN33 to protect the Exchange Rate                        135566
      ** and Mult/Div Ind fields                                          135566
      *                                                                   135566
     C                     MOVE '1'       *IN33                           135566
      *                                                                   135566
     C                     ENDIF                                          CEU005
      *                                                                   135566
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
      **********                                                   CEU005 CEU005
      **Protect*Exchange*rate*and*M/D*indicator*fields.*           CEU005 135566
      **********                                                   CEU005 135566
     C**********           SETON                     33            CEU005 135566
     C**********           ELSE                                    CEU005 135566
      *                                                                   135566
     C                     ENDIF                                          135566
      *                                                                   CEU005
      ** Perform the original defaulting only if *IN33 is OFF             135566
     C           *IN33     IFEQ *OFF                                      135566
      *                                                                   135566
     C                     MOVE @PTNMC    @AJCD                           E36795
     C                     MOVE '*DBERR ' @RTCD                           E36795
     C                     EXSR AOCURR                                    E36795
     C                     Z-ADDA6SPRT    ZRATE1                          E36795
     C                     MOVE A6MDIN    ZMDI1                           E36795
     C                     MOVE @PSETC    @AJCD                           E36795
     C                     MOVE '*DBERR ' @RTCD                           E36795
     C                     EXSR AOCURR                                    E36795
     C                     Z-ADDA6SPRT    ZRATE2                          E36795
     C                     MOVE A6MDIN    ZMDI2                           E36795
     C/COPY WNCPYSRC,SE3002C050
     C                     EXSR ZXRATE                                    E36795
     C/COPY WNCPYSRC,SE3002C051
     C                     Z-ADDZRATEX    @PTDER                          E36795
     C                     MOVE ZMDIX     @PTMDI                          E36795
      ***********                                                  CEU005 135566
      **Ensure*Exchange*rate*and*M/D*indicator*fields*are*input*capCEU005 135566
      ***********                                                  CEU005 135566
     C***********          SETOF                     33            CEU005 135566
     C                     ENDIF                                          CEU005
      *                                                                   135566
     C                     END                                            E36795
     C/COPY WNCPYSRC,SE3002C066
      *
     C                     END
      *
      * Base currency rate defaults to spot rate from currency table
     C           @PTBCR    IFEQ 0
     C***********          MOVEL@PSETC    @KCCY
     C***********@KTG10    CHAINTABTG10F             01
     C************IN01     IFEQ '1'
     C***********RECI      ORNE 'D'
     C***********          Z-ADD15        @DBASE           ***************
     C***********          MOVEL'TABLE'   @DBFIL           * DB ERROR 15 *
     C***********          MOVEL@KTG10    @DBKEY           ***************
     C***********          EXSR SUB999
     C***********          END
     C***********          Z-ADDSPOT      @PTBCR
     C                     MOVE '*DBERR ' @RTCD
     C                     MOVE @PSETC    @AJCD
     C                     EXSR AOCURR
     C                     MOVE A6SPRT    @PTBCR
     C                     END
      *
      * The following defaults are applied for primary and secondary trades
      * only
     C           @PTDMI    IFEQ 'P'
     C           @PTDMI    OREQ 'S'
     C*
     C* Initialize settlement inst. record found flag
     C                     MOVE *BLANKS   SETFLG  1
     C*
      *
      * If customer is safe custody or discretionary, get standard
      * settlement details with a partial key, else use full key
     C           @WC1DI    IFEQ 'D'
     C           @WC1DI    OREQ 'S'
     C                     MOVE 'N'       SSVAR   1                                         AR636394
     C/COPY WNCPYSRC,SE3002C045
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE '0'       *IN01                                               CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP                                               CSE028
     C                     PARM           @PTDBA                                              CSE028
     C                     PARM           @PTCNR                                              CSE028
     C**********           PARM           SIBK                                         CSE028 CSE034
     C                     PARM SIBK      PSIBK                                               CSE034
     C                     PARM           @PSETC                                              CSE028
     C                     PARM SMCC      PMRKT                                               CSE034
     C                     PARM           SITP                                                CSE028
     C                     PARM           PTFR                                                CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD                                               CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN01                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           @KEY5     CHAINSTDSEDF              01
     C                     MOVE 'Y'       SSVAR                                             AR636394
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE3002C046
     C                     ELSE
     C/COPY WNCPYSRC,SE3002C067
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE '0'       *IN01                                               CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP                                               CSE028
     C                     PARM           @PTDBA                                              CSE028
     C                     PARM           @PTCNR                                              CSE028
     C**********           PARM           SIBK                                         CSE028 CSE034
     C                     PARM SIBK      PSIBK                                               CSE034
     C                     PARM           @PSETC                                              CSE028
     C                     PARM SMCC      PMRKT                                               CSE034
     C                     PARM           SITP                                                CSE028
     C                     PARM           PTFR                                                CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD                                               CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN01                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           @KEY6     CHAINSTDSEDF              01
     C                     MOVE 'Y'       SSVAR                                             AR636394
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE3002C068
     C                     END
      *
      * Settlement default record found
     C           *IN01     IFEQ '0'
     C           SSVAR     IFEQ 'N'                                                         AR636394
     C           SSVAR     OREQ 'Y'                                                         AR636394
     C           RECI      ANDEQ'D'
     C*
     C                     MOVE 'Y'       SETFLG
      *
      * Set up defaults for purchase trade
     C           @PTDTP    IFEQ 'TP'
      *
      * Settlement method: default to pay settlement method
     C           @PSMTH    IFEQ 0
     C***********@PTINC    IFEQ 'I'                                       065295
     C***********          Z-ADD0         @PSMTH                          065295
     C***********          ELSE                                           065295
     C                     Z-ADDSPSM      @PSMTH
     C***********          END                                            065295
     C                     END
      *
      * Pay from: default to pay a/c
     C           @PPYFM    IFEQ *BLANKS
     C                     MOVELSPAT      @PPYFM
     C                     END
      *
      * Pay from branch: default to pay branch
     C***********@PPYFB    IFEQ 0                                         S01117
     C***********          Z-ADDSPBR      @PPYFB                          S01117
     C           @PPYFA    IFEQ *BLANKS                                   S01117
     C                     MOVE SPBA      @PPYFA                          S01117
     C                     END
      *
      * Pay to: default to counterparty bank
     C           @PPAYT    IFEQ *BLANKS
     C                     MOVELSPCB      @PPAYT
     C                     END
      *
      * Pay to branch: default to pay branch
     C***********@PPYTB    IFEQ 0                                         S01117
     C***********          Z-ADDSPBR      @PPYTB                          S01117
     C           @PPYTA    IFEQ *BLANKS                                   S01117
     C                     MOVE SPBA      @PPYTA                          S01117
     C                     END
      *
      * For a/c of: default to for a/c of
     C           @PTDFA    IFEQ *BLANKS
     C                     MOVELSPFA      @PTDFA
     C                     END
      *
      * Special instructions: default to special instructions
     C           @PTDSI    IFEQ *BLANKS
     C                     MOVELSPSI      @PTDSI
     C                     END
      *
      **C/H*ind:*default*to*C/H*ind******************                     S01175
     C***********@PCLRH    IFEQ *BLANKS                                   S01175
     C***********          MOVELSCLH      @PCLRH                          S01175
     C***********          END                                            S01175
      *
      * Pay code: default to pay code purchase
     C           @PPCOD    IFEQ *BLANKS
     C                     MOVELSPCP      @PPCOD
     C                     END
      *
      * Deliver from: default to deliver from theirs
     C********** @PDELF    IFEQ 0
     C**********           Z-ADDSDFT      @PDELF
     C**********           END
      *
      * Deliver to: default to deliver to ours
     C********** @PDELT    IFEQ 0
     C**********           Z-ADDSDTO      @PDELT
     C**********           END
      *
      * Set up defaults for sale trade
     C                     ELSE
      *
      * Settlement method: default to receive settlement method
     C           @PSMTH    IFEQ 0
     C***********@PTINC    IFEQ 'I'                                       065295
     C***********          Z-ADD0         @PSMTH                          065295
     C***********          ELSE                                           065295
     C                     Z-ADDSRSM      @PSMTH
     C***********          END                                            065295
     C                     END
      *
      * Pay from: default to counterparty bank
     C           @PPYFM    IFEQ *BLANKS
     C                     MOVELSRCB      @PPYFM
     C                     END
      *
      * Pay from branch: default to receive branch
     C***********@PPYFB    IFEQ 0                                         S01117
     C***********          Z-ADDSRBR      @PPYFB                          S01117
     C           @PPYFA    IFEQ *BLANKS                                   S01117
     C                     MOVE SRAB      @PPYFA                          S01117
     C                     END
      *
      * Pay to: default to receive a/c
     C           @PPAYT    IFEQ *BLANKS
     C                     MOVELSRAC      @PPAYT
     C                     END
      *
      * Pay to branch: default to receive branch
     C***********@PPYTB    IFEQ 0                                         S01117
     C***********          Z-ADDSRBR      @PPYTB                          S01117
     C           @PPYTA    IFEQ *BLANKS                                   S01117
     C                     MOVE SRAB      @PPYTA                          S01117
     C                     END
      *
      * Special instructions: default to special instructions
     C           @PTDSI    IFEQ *BLANKS
     C                     MOVELSPSI      @PTDSI
     C                     END
      *
      **C/H*ind:*default*to*C/H*ind***************                        S01175
     C***********@PCLRH    IFEQ *BLANKS                                   S01175
     C***********          MOVELSCLH      @PCLRH                          S01175
     C***********          END                                            S01175
      *
      * Pay code: default to pay code sale
     C           @PPCOD    IFEQ *BLANKS
     C                     MOVELSPCS      @PPCOD
     C                     END
      *
      *
      * For a/c of
     C           @PDTFA    IFEQ *BLANKS
     C                     MOVELSFAT      @PDTFA
     C                     END
      *
     C                     END
     C                     ENDIF                                                            AR636394
     C                     END
      *
      * Apply natural defaults
      *
      * Settlement method: If customer is not safe custody or
      * discretionary, default to 1, else default to 15 if settlement
      * a/c present on client security details.
     C           @PSMTH    IFEQ 0
     C           @PTINC    ANDNE'I'
     C           @WC1DI    IFNE 'S'
     C           @WC1DI    ANDNE'D'
     C                     Z-ADD1         @PSMTH
     C                     ELSE
     C***********@WC1AC    IFNE 0                                         S01117
     C           @WC1AC    IFNE *BLANKS                                   S01117
     C                     Z-ADD15        @PSMTH
     C                     END
     C                     END
     C                     END
      *
      * Pay code: if customer is safe custody or discretionary, default
      * to 3, else default to 1
     C           @PPCOD    IFEQ *BLANKS
     C           @WC1DI    IFEQ 'D'
     C           @WC1DI    OREQ 'S'
     C                     MOVEL'3'       @PPCOD
     C                     ELSE
     C                     MOVEL'1'       @PPCOD
     C                     END
     C                     END
      *
      *     Purchases.....
     C           @PTDTP    IFEQ 'TP'
      *
      *  Pay To :
     C           @PPAYT    IFEQ *BLANKS
     C           @PSMTH    ANDEQ1
     C                     MOVEL@PTCNR    @PPAYT
     C                     END
     C*
      *
      * Pay from:
      * For purchase, and some settlement method, pay code and clearance
      * type combinations, get details from standing data
     C           @PPYFM    IFEQ *BLANKS
      *
     C           @PSMTH    IFEQ 1
     C           @PPCOD    IFEQ '1'
     C           @PPCOD    OREQ '5'
     C           @PCLTY    IFEQ '1'
     C           @PCLTY    OREQ '2'
     C           @PCLTY    OREQ '3'
     C           @PCLTY    OREQ '4'
     C***********          MOVEL@PSETC    @KCCY3                          S01117
     C***********@KTG20    CHAINTABTG20F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD16        @DBASE           ***************S01117
     C***********          MOVEL'TABLE'   @DBFIL           * DB ERROR 16 *S01117
     C***********          MOVEL@KTG20    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     MOVE @PSETC    @AJCD                           S01117
     C                     EXSR AOCURR                                    S01117
      *
      * Use Euroclear or Cedel codes as appropriate
     C           @PCLTY    IFEQ '1'
     C           @PCLTY    OREQ '2'
     C***********          MOVELEUDN      @PPYFM                          S01117
     C                     MOVELA6ECDN    @PPYFM                          S01117
     C                     ELSE
     C***********          MOVELCEDN      @PPYFM                          S01117
     C                     MOVELA6CDFN    @PPYFM                          S01117
     C                     END
      *
      * Reset pay from branch
     C           @PPYFM    IFNE *BLANKS
      *
     C***********          MOVEL@PPYFM    @KNN                            S01117
     C***********          MOVEL@PSETC    @KCCY2                          S01117
     C***********@KTBTL    CHAINTABLETLF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD17        @DBASE           ***************S01117
     C***********          MOVEL'TABLE'   @DBFIL           * DB ERROR 17 *S01117
     C***********          MOVEL@KTBTL    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
      *
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     MOVE @PSETC    P@CYCD                          S01117
     C                     MOVEL@PPYFM    P@NONB                          S01117
     C                     EXSR AONOST                                    S01117
     C*                                                                   S01117
     C                     MOVELA7ACCD    ACOD                            S01117
     C                     MOVELA7BRCD    BRCA                            S01117
     C                     MOVELA7CUST    CNUM                            S01117
     C                     MOVELA7ACSN    ACSQ                            S01117
     C                     MOVEL@PSETC    CCY
     C           @KEY2     CHAINACCNTABF             01
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD18        @DBASE           ***************
     C                     MOVEL'ACCNT'   @DBFIL           * DB ERROR 18 *
     C                     MOVEL@DSACT    @DBKEY           ***************
     C                     OUT  LDA                                       S01117
     C***********          EXSR SUB999                                    S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
      *
     C***********          MOVELBRCD      @PPYFB                          S01117
     C                     MOVELA7BRCD    @PPYFA                          S01117
      *
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
      *
      * If still blank, use customer number
     C           @PPYFM    IFEQ *BLANKS
     C***********@WC1AC    IFNE 0                                         S01117
     C           @WC1AC    IFNE *BLANKS                                   S01117
     C           @PSMTH    ANDEQ15
     C                     MOVEL@PTCNR    @PPYFM
     C**********           MOVEL@WC1AC    WOUT06  6                                    E21313 CGL029
     C**********           MOVE @WC1SQ    WOUT06                                       E21313 CGL029
     C**********           MOVE WOUT06    @PPYFM                                       E21313 CGL029
     C                     MOVEL@WC1AC    WOUT12 12                                           CGL029
     C                     MOVE @WC1SQ    WOUT12                                              CGL029
     C                     MOVE WOUT12    @PPYFM                                              CGL029
     C           @PPYFA    IFEQ *BLANKS                                   087651
     C                     MOVE @PTDBA    @PPYFA                          087651
     C                     END                                            087651
     C                     END
     C                     END
      *
      **If*branch*is*still*not*set,*use*trade*branch**********************050727
     C***********@PPYFB    IFEQ 0                                         S01117
     C***********          Z-ADD@PTDBR    @PPYFB                          S01117
     C***********@PPYFA    IFEQ *BLANKS                            S01117 050727
     C***********          MOVE @PTDBA    @PPYFA                   S01117 050727
     C***********          END                                            050727
     C*
     C***********@PPYTB    IFEQ 0                                         S01117
     C***********          Z-ADD@PTDBR    @PPYTB                          S01117
     C***********@PPYTA    IFEQ *BLANKS                            S01117 050727
     C***********          MOVE @PTDBA    @PPYTA                   S01117 050727
     C***********          END                                            050727
     C*
     C                     END
      *
     C           @PTDTP    IFEQ 'TS'
      *
      *  Pay From:
     C           @PPYFM    IFEQ *BLANKS
     C           @PSMTH    ANDEQ1
     C                     MOVEL@PTCNR    @PPYFM
     C                     END
     C*
      * Pay to:
      *
      * For sales, and some settlement method, pay code and clearance
      * type combinations, get details from standing data
     C           @PPAYT    IFEQ *BLANKS
      *
     C           @PSMTH    IFEQ 1
     C           @PPCOD    IFEQ '1'
     C           @PPCOD    OREQ '5'
     C           @PCLTY    IFEQ '1'
     C           @PCLTY    OREQ '2'
     C           @PCLTY    OREQ '3'
     C           @PCLTY    OREQ '4'
     C***********          MOVEL@PSETC    @KCCY3                          S01117
     C***********@KTG20    CHAINTABTG20F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD19        @DBASE           ***************S01117
     C***********          MOVEL'TABSE'   @DBFIL           * DB ERROR 19 *S01117
     C***********          MOVEL@KTG20    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     MOVE @PSETC    @AJCD                           S01117
     C                     EXSR AOCURR                                    S01117
      *
      * Use Euroclear or Cedel codes as appropriate
     C           @PCLTY    IFEQ '1'
     C           @PCLTY    OREQ '2'
     C***********          MOVELEUDN      @PPAYT                          S01117
     C                     MOVELA6ECDN    @PPAYT                          S01117
     C                     ELSE
     C***********          MOVELCEDN      @PPAYT                          S01117
     C                     MOVELA6CDFN    @PPAYT                          S01117
     C                     END
      *
      * Reset Pay to branch
     C           @PPAYT    IFNE *BLANKS
     C*
     C***********          MOVEL@PPAYT    @KNN
     C***********          MOVEL@PSETC    @KCCY3
     C***********@KTBTL    CHAINTABLETLF             01
     C************IN01     IFEQ '1'
     C***********RECI      OREQ '*'
     C***********          Z-ADD20        @DBASE           ***************
     C***********          MOVEL'TABSE'   @DBFIL           * DB ERROR 20 *
     C***********          MOVEL@KTBTL    @DBKEY           ***************
     C***********          EXSR SUB999
     C***********          END
      *
     C                     MOVE '*DBERR ' @RTCD                           S01117
     C                     MOVE @PSETC    P@CYCD                          S01117
     C                     MOVEL@PPAYT    P@NONB                          S01117
     C                     EXSR AONOST                                    S01117
     C*                                                                   S01117
     C                     MOVELA7ACCD    ACOD                            S01117
     C                     MOVELA7BRCD    BRCA                            S01117
     C                     MOVELA7CUST    CNUM                            S01117
     C                     MOVELA7ACSN    ACSQ                            S01117
     C                     MOVEL@PSETC    CCY
     C           @KEY2     CHAINACCNTABF             01
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD21        @DBASE           ***************
     C                     MOVEL'ACCNT'   @DBFIL           * DB ERROR 21 *
     C                     MOVEL@DSACT    @DBKEY           ***************
     C                     OUT  LDA                                       S01117
     C***********          EXSR SUB999                                    S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
      *
     C***********          MOVELBRCD      @PPYTB                          S01117
     C                     MOVELA7BRCD    @PPYTA                          S01117
      *
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
      *   Pay To
      * If still blank, use customer number
     C           @PPAYT    IFEQ *BLANKS
     C***********@WC1AC    IFNE 0                                         S01117
     C           @WC1AC    IFNE *BLANKS                                   S01117
     C           @PSMTH    ANDEQ15
     C                     MOVEL@PTCNR    @PPAYT
     C**********           MOVEL@WC1AC    WOUT06  6                                    E21313 CGL029
     C**********           MOVE @WC1SQ    WOUT06                                       E21313 CGL029
     C**********           MOVE WOUT06    @PPAYT                                       E21313 CGL029
     C                     MOVEL@WC1AC    WOUT12                                              CGL029
     C                     MOVE @WC1SQ    WOUT12                                              CGL029
     C                     MOVE WOUT12    @PPAYT                                              CGL029
     C           @PPYTA    IFEQ *BLANKS                                   087651
     C                     MOVE @PTDBA    @PPYTA                          087651
     C                     END                                            087651
     C                     END
     C                     END
      *
      **If*branch*is*still*not*set,*use*trade*branch*****************     050727
     C***********@PPYTB    IFEQ 0                                         S01117
     C***********          Z-ADD@PTDBR    @PPYTB                          S01117
     C***********@PPYTA    IFEQ *BLANKS                            S01117 050727
     C***********          MOVE @PTDBA    @PPYTA                   S01117 050727
     C***********          END                                            050727
     C*
     C***********@PPYFB    IFEQ 0                                         S01117
     C***********          Z-ADD@PTDBR    @PPYFB                          S01117
     C***********@PPYFA    IFEQ *BLANKS                            S01117 050727
     C***********          MOVE @PTDBA    @PPYFA                   S01117 050727
     C***********          END                                            050727
     C*
     C                     END
      *
      *
      *
     C           @PTDTP    IFEQ 'TP'
     C*
     C*  Deliver from
     C           SETFLG    IFNE 'Y'
     C           SETFLG    OREQ 'Y'
     C           SDFT      ANDEQ*ZEROS
     C***********
     C***********@PCLTY    IFEQ '1'
     C***********          MOVELDC01      @PDELF
     C***********
     C***********          ELSE
     C***********@PCLTY    IFEQ '2'
     C***********@PCLRH    IFEQ 'C'
     C***********          MOVELDC02      @PDELF
     C***********          ELSE
     C***********@PCLRH    IFEQ 'K'
     C***********          MOVELDC03      @PDELF
     C***********          END
     C***********          END
     C***********
     C***********          ELSE
     C***********@PCLTY    IFEQ '3'
     C***********          MOVELDC02      @PDELF
     C***********          END
     C***********          END
     C***********          END
     C***********
     C***********          ELSE
     C***********SDFT      IFNE *ZEROS
     C***********          MOVELSDFT      @PDELF
     C***********          END
     C***********          END
     C           @PCLTY    IFEQ '1'                                       S01175
     C***********@PCLTY    OREQ '2'                                 S01175065005
     C*                                                                   S01175
     C           @WC1DI    IFEQ 'S'                                       S01175
     C           @WC1DI    OREQ 'D'                                       S01175
     C*                                                                   S01175
     C           @WC101    IFNE *BLANKS                                   S01175
     C                     MOVEL@WC101    @PDELF                          S01175
     C                     ELSE                                           S01175
     C***********          MOVEL@PPYTB    @PDELF                   S01175 S01117
     C***********          MOVEL@PPYTA    @PDELF                    S01117065005
     C***********          MOVE @PPYTA    @DSNB                    065005 050727
     C           @SPYFB    IFNE *BLANKS                                   050727
     C                     MOVE @SPYFB    @DSNB                           050727
     C                     ELSE                                           050727
     C           @@PYFB    IFNE *BLANKS                                   050727
     C                     MOVE @@PYFB    @DSNB                           050727
     C                     ELSE                                           050727
     C                     MOVE @SBRCD    @DSNB                           050727
     C                     END                                            050727
     C                     END                                            050727
     C                     MOVE '*DBERR ' @RTCD                           065005
     C                     EXSR AOBRCH                                    065005
     C                     MOVE A8BICN    @WCUST                          065005
     C                     MOVE '*DBERR ' @RTCD                           065005
     C                     EXSR AOSECS                                    065005
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C           BFDRF1    IFNE *BLANKS                                   065005
     C                     MOVELBFDRF1    @PDELF                          065005
     C                     MOVELBFPNP1    @WPN01                          065005
     C                     ELSE                                           065005
     C                     MOVELBVDR1     @PDELF                          065005
     C                     END                                            065005
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C***********          MOVELDC01      @PDELF                   S01175 S01117
     C                     MOVELBVDR1     @PDELF                          S01117
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @PCLTY    IFEQ '3'                                       S01175
     C***********@PCLTY    OREQ '4'                                S01175 065005
     C*                                                                   S01175
     C           @WC1DI    IFEQ 'S'                                       S01175
     C           @WC1DI    OREQ 'D'                                       S01175
     C*                                                                   S01175
     C           @WC102    IFNE *BLANKS                                   S01175
     C                     MOVEL@WC102    @PDELF                          S01175
     C                     ELSE                                           S01175
     C***********          MOVEL@PPYTB    @PDELF                   S01175 S01117
     C***********          MOVEL@PPYTA    @PDELF                   S01117 065005
     C***********
     C           @SPYFB    IFNE *BLANKS                                   050727
     C                     MOVE @SPYFB    @DSNB                           050727
     C                     ELSE                                           050727
     C           @@PYFB    IFNE *BLANKS                                   050727
     C                     MOVE @@PYFB    @DSNB                           050727
     C                     ELSE                                           050727
     C                     MOVE @SBRCD    @DSNB                           050727
     C                     END                                            050727
     C                     END                                            050727
     C                     MOVE '*DBERR ' @RTCD                           065005
     C                     EXSR AOBRCH                                    065005
     C                     MOVE A8BICN    @WCUST                          065005
     C                     MOVE '*DBERR ' @RTCD                           065005
     C                     EXSR AOSECS                                    065005
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C           BFDRF2    IFNE *BLANKS                                   065005
     C                     MOVELBFDRF2    @PDELF                          065005
     C                     MOVELBFPNP2    @WPN02                          065005
     C                     ELSE                                           065005
     C                     MOVELBVDR2     @PDELF                          065005
     C                     END                                            065005
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C***********          MOVELDC02      @PDELF                   S01175 S01117
     C                     MOVELBVDR2     @PDELF                          S01117
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C           SDFT      IFNE *ZEROS                                    S01175
     C                     MOVELSDFT      @PDELF                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*
     C*  Deliver to
     C           SETFLG    IFNE 'Y'
     C           SETFLG    OREQ 'Y'
     C           SDTO      ANDEQ*ZEROS
     C*
     C           @PCLTY    IFEQ '1'
     C           @PCLTY    OREQ '2'
     C***********          MOVELDC01      @PDELT                          S01117
     C                     MOVELBVDR1     @PDELT                          S01117
     C*
     C                     ELSE
     C           @PCLTY    IFEQ '3'
     C           @PCLTY    OREQ '4'
     C***********          MOVELDC02      @PDELT                          S01117
     C                     MOVELBVDR2     @PDELT                          S01117
     C                     END
     C                     END
     C*
     C                     ELSE
     C           SDTO      IFNE *ZEROS
     C                     MOVELSDTO      @PDELT
     C                     END
     C                     END
     C                     END
     C*
      *
     C           @PTDTP    IFEQ 'TS'
     C*
     C*  DELIVER FROM /TO FOR SALES
     C*
     C*  Deliver from
     C           SETFLG    IFNE 'Y'
     C           SETFLG    OREQ 'Y'
     C           SDFO      ANDEQ*ZEROS
     C*
     C           @PCLTY    IFEQ '1'
     C           @PCLTY    OREQ '2'
     C***********          MOVELDC01      @PDELF                          S01117
     C                     MOVELBVDR1     @PDELF                          S01117
     C*
     C                     ELSE
     C           @PCLTY    IFEQ '3'
     C           @PCLTY    OREQ '4'
     C***********          MOVELDC02      @PDELF                          S01117
     C                     MOVELBVDR2     @PDELF                          S01117
     C                     END
     C*
     C                     END
     C*
     C                     ELSE
     C           SDFO      IFNE *ZEROS
     C                     MOVELSDFO      @PDELF
     C                     END
     C                     END
     C*
     C*  Deliver to
     C           SETFLG    IFNE 'Y'
     C           SETFLG    OREQ 'Y'
     C           SDTT      ANDEQ*ZEROS
     C*
     C           @PCLTY    IFEQ '1'
     C***********          MOVELDC01      @PDELT                          S01117
     C                     MOVELBVDR1     @PDELT                          S01117
     C*
     C***********          ELSE
     C***********@PCLTY    IFEQ '2'
     C***********@PCLRH    IFEQ 'C'
     C***********          MOVELDC02      @PDELT
     C***********          ELSE
     C***********@PCLRH    IFEQ 'K'
     C***********          MOVELDC03      @PDELT
     C***********          END
     C***********          END
     C***********
     C***********          ELSE
     C***********@PCLTY    IFEQ '3'
     C*                                                                   S01175
     C           @WC1DI    IFEQ 'S'                                       S01175
     C           @WC1DI    OREQ 'D'                                       S01175
     C*                                                                   S01175
     C           @WC101    IFNE *BLANKS                                   S01175
     C                     MOVEL@WC101    @PDELT                          S01175
     C                     ELSE                                           S01175
     C***********          MOVEL@PPYFB    @PDELT                   S01175 S01117
     C***********          MOVEL@PPYFA    @PDELT                          065005
     C***********          MOVE @PPYTA    @DSNB                    065005 050727
     C           @SPYTB    IFNE *BLANKS                                   050727
     C                     MOVE @SPYTB    @DSNB                           050727
     C                     ELSE                                           050727
     C           @@PYTB    IFNE *BLANKS                                   050727
     C                     MOVE @@PYTB    @DSNB                           050727
     C                     ELSE                                           050727
     C                     MOVE @SBRCD    @DSNB                           050727
     C                     END                                            050727
     C                     END                                            050727
     C                     MOVE '*DBERR ' @RTCD                           065005
     C                     EXSR AOBRCH                                    065005
     C                     MOVE A8BICN    @WCUST                          065005
     C                     MOVE '*DBERR ' @RTCD                           065005
     C                     EXSR AOSECS                                    065005
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C           BFDRF1    IFNE *BLANKS                                   065005
     C                     MOVELBFDRF1    @PDELT                          065005
     C                     MOVELBFPNP1    @WPN01                          065005
     C                     ELSE                                           065005
     C                     MOVELBVDR1     @PDELT                          065005
     C                     END                                            065005
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C***********          MOVELDC01      @PDELT                   S01175 S01117
     C                     MOVELBVDR1     @PDELT                          S01117
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C***********@PCLTY    IFEQ '2'                                S01175 065005
     C***********@PCLTY    OREQ '3'                                S01175 065005
     C           @PCLTY    IFEQ '3'                                       065005
     C*                                                                   S01175
     C           @WC1DI    IFEQ 'S'                                       S01175
     C           @WC1DI    OREQ 'D'                                       S01175
     C*                                                                   S01175
     C           @WC102    IFNE *BLANKS                                   S01175
     C                     MOVEL@WC102    @PDELT                          S01175
     C                     ELSE                                           S01175
     C***********          MOVEL@PPYFB    @PDELT                   S01175 S01117
     C***********          MOVEL@PPYFA    @PDELT                    S01117065005
     C           @SPYTB    IFNE *BLANKS                                   050727
     C                     MOVE @SPYTB    @DSNB                           050727
     C                     ELSE                                           050727
     C           @@PYTB    IFNE *BLANKS                                   050727
     C                     MOVE @@PYTB    @DSNB                           050727
     C                     ELSE                                           050727
     C                     MOVE @SBRCD    @DSNB                           050727
     C                     END                                            050727
     C                     END                                            050727
     C                     MOVE '*DBERR ' @RTCD                           065005
     C                     EXSR AOBRCH                                    065005
     C                     MOVE A8BICN    @WCUST                          065005
     C                     MOVE '*DBERR ' @RTCD                           065005
     C                     EXSR AOSECS                                    065005
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C           BFDRF2    IFNE *BLANKS                                   065005
     C                     MOVELBFDRF2    @PDELT                          065005
     C                     MOVELBFPNP2    @WPN02                          065005
     C                     ELSE                                           065005
     C                     MOVELBVDR2     @PDELT                          065005
     C                     END                                            065005
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C***********          MOVELDC02      @PDELT                          S01117
     C                     MOVELBVDR2     @PDELT                          S01117
     C***********          END                                            S01175
     C                     END
     C                     END
     C*
     C                     ELSE
     C           SDTT      IFNE *ZEROS
     C                     MOVELSDTT      @PDELT
     C                     END
     C                     END
     C*
     C                     END
      *
      * Priority code: default to R
     C           @PPRYC    IFEQ *BLANKS
     C                     MOVEL'R'       @PPRYC
     C                     END
      *
     C                     ELSE
      *
     C* SET UP PAY CODE FOR GREY MARKET TRADES
      *
      * Pay code: if customer is safe custody or discretionary, default
      * to 3, else default to 1
     C           @PPCOD    IFEQ *BLANKS
     C           @WC1DI    IFEQ 'D'
     C           @WC1DI    OREQ 'S'
     C                     MOVEL'3'       @PPCOD
     C                     ELSE
     C                     MOVEL'1'       @PPCOD
     C                     END
     C                     END
     C                     END
     C*
     C****Set*up*default*commission*and*charges*(if*not*already*set*up)***S01176
      *                                                                   S01176
      ***  If Autocharges yes, determine the defaults for Charge /        S01176
      ***  Commission Codes and Rebate % (if not already set up)          S01176
      *                                                                   S01176
     C           @PRECI    IFEQ *BLANKS
      *                                                                   S01176
     C***********AUMO      IFEQ 'Y'                                S01176 S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
     C                     EXSR SUB403
      *                                                                   S01176
      ***  ELSE, for a Client Agency Trade, Default the Broker            S01176
      *****Commission*Code*to*that*held*on*PF/TABTB36*and********* S01176 S01117
      ***  Commission Code to that held on SDSTRDPD   and                 S01117
      ***   check it against LF/SECGT. S0                                 S01176
     C                     ELSE                                           S01176
      *                                                                   S01176
      * Only default broker code if not a cross agency trade i.e. a       S01448
      * trade between two portfolio clients.                              S01448
      *                                                                   S01448
     C           S01448    IFEQ 'Y'                                       S01448
     C           @CAGT     ANDNE'Y'                                       S01448
     C           S01448    ORNE 'Y'                                       S01448
      *                                                                   S01176
     C           @PATRD    IFEQ 'C'                                       S01176
     C***********          MOVE DEBC      @PTBCC                   S01176 S01117
     C                     MOVE BVDBCD    @PTBCC                          S01117
      *                                                                   S01176
     C                     MOVE @PTBCC    @XCODE                          S01176
     C           @KEY7     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   @PTBCC                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01448
     C                     END                                            S01176
      *                                                                   S01176
      ***  Determine the Charge/Commission/Rebate Amounts                 S01176
      *                                                                   S01176
     C                     EXSR SUB404
      *                                                                   S01176
      ***  Calculate the Tax Amounts                                      S01176
      *                                                                   S01176
     C                     EXSR SUB405                                    S01176
      *                                                                   S01176
      ***  If Market Agency Trade, save the calculated defaults.
      *                                                                   S01176
     C           @PATRD    IFEQ 'M'
     C***********          Z-ADD@PTBCA    @OTBCA                          S01176
     C***********          Z-ADD@PLTCA    @OLTCA                          S01176
     C***********          Z-ADD@PTPCA    @OTPCA                          S01176
     C                     Z-ADD@PTBCA    @OTBCN                          S01176
     C                     Z-ADD@PTCA1    @OTCN1                          S01176
     C                     Z-ADD@PTCA2    @OTCN2                          S01176
     C                     END
     C*
     C                     END
     C*                                                                   S01117
     C*  Originating Branch:  Defaults to Booking Branch                  S01117
     C*                                                                   S01117
     C                     MOVE @PTDBA    @PORBR                          S01117
     C*                                                                   S01117
     C*  Profit Centre                                                    S01117
     C*                                                                   S01117
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C*                                                                   CAC002
     C*   If Profit Centre used                                           S01117
     C*                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C*   If Book position/profit centres are to be reconciled            S01117
     C*                                                                   S01117
     C           BVTBRC    IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C*  Default from current book position profit centre record          S01117
     C*  if found & protect on screen                                     S01117
     C*                                                                   S01117
     C                     MOVEL@PTDBK    BOKC                            S01117
     C                     MOVEL@PTDBA    KBRC                            S01117
     C                     MOVEL@PTDSS    KSSN                            S01117
     C                     MOVEL@PTDMI    MKTI                            S01117
     C           KLSPCB    CHAINSEPCBD               01                   S01117
     C           *IN01     IFEQ '0'                                       S01117
     C                     MOVE PCBK      @PPRFC                          S01117
     C                     SETON                     27                   S01117
     C*                                                                   S01117
     C*  Else default from matrix and allow amendment                     S01117
     C                     ELSE                                           S01117
     C           BKPCDU    IFEQ 'Y'                                       S01117
     C                     MOVEL@PTDTP    @TRTY                           S01117
     C                     MOVE @PTCNR    @CUST                           S01117
     C                     EXSR AOPRFM                                    S01117
     C           #RTCD     IFEQ '0'                                       S01117
     C                     MOVE @PRFC     @PPRFC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C*  Customer Position Profit Centre defaulting                       S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C*  Default from current customer position profit centre             S01117
     C*  if found but do not protect on screen                            S01117
     C*                                                                   S01117
     C                     MOVE @PTDBA    KBRCA                           S01117
     C                     MOVE @PTDSS    KSESN                           S01117
     C                     MOVE @PTCNR    KCNUM                           S01117
     C           KLSPCC    CHAINSEPCCD               01                   S01117
     C           *IN01     IFEQ '0'                                       S01117
     C                     MOVE PCCU      @PPRFC                          S01117
     C                     ELSE                                           S01117
     C           BKPCDU    IFEQ 'Y'                                       S01117
     C                     MOVEL@PTDTP    @TRTY                           S01117
     C                     MOVE @PTCNR    @CUST                           S01117
     C                     EXSR AOPRFM                                    S01117
     C           #RTCD     IFEQ '0'                                       S01117
     C                     MOVE @PRFC     @PPRFC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *
      *  ***** THIS BIT IS NOT CORE *****
      *
      **If*not*grey*market*and*clearance*type*is*0*then*depot*details**   E23593
      **will*not*be*available*at*this*stage*so*change*to*something*****   E23593
      **that*is*valid.*************************************************   E23593
     C***********@PTDMI    IFNE 'G'                                       E23593
     C***********@PCLTY    ANDEQ'0'                                       E23593
     C*********************MOVE '5'       @PCLTY                          E23593
     C*********************Z-ADD@PTCNR    @PDELF                          E23593
     C*********************Z-ADD@PTCNR    @PDELT                          E23593
     C*********************END                                            E23593
      *
      * For market trades where settlement method of 01 has been
      * defaulted but a corresponding nostro has not been found
      * change settlement method to 00 and blank out pay to and
      * and pay from details.
     C           @PSMTH    IFEQ 1
     C           @PTDTP    IFEQ 'TP'
     C           @PPYFM    IFEQ *BLANK
     C                     Z-ADD0         @PSMTH
     C***********          MOVE *BLANK    @PPYFB                          S01117
     C                     MOVE *BLANK    @PPAYT
     C***********          MOVE *BLANK    @PPYTB                          S01117
     C                     END
     C                     ELSE
     C           @PPAYT    IFEQ *BLANK
     C                     Z-ADD0         @PSMTH
     C***********          MOVE *BLANK    @PPYFB                          S01117
     C                     MOVE *BLANK    @PPYFM
     C***********          MOVE *BLANK    @PPYTB                          S01117
     C                     END
     C                     END
     C                     END
      *                                                                   CEU005
      ** If trade type is Purchase and parameter field blank              CEU005
      ** and ERII is 'Y' and nominal currency is an 'IN' currency         CEU005
      ** and default settlement method is 01 or 08 then move              CEU005
      ** NMCYA into SCCY.                                                 CEU005
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           @STDTP    IFEQ 'TP'                                      CEU005
     C           @PICCY    ANDEQ*BLANKS                                   CEU005
     C           ERII      ANDEQ'Y'                                       CEU005
     C                     MOVE NMCYA     @AJCD                           CEU005
     C                     MOVE *BLANKS   @RTCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '43'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVELNMCYA     @DBKEY            * ERROR 43 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           @PTDVD    ANDGEA6TPSD                                    CEU005
     C           @PSMTH    ANDEQ1                                         CEU005
     C           A6INCY    OREQ 'Y'                                       CEU005
     C           @PTDVD    ANDGEA6TPSD                                    CEU005
     C           @PSMTH    ANDEQ8                                         CEU005
     C                     MOVELNMCYA     @PICCY                          CEU005
     C                     MOVELNMCYA     @SICCY                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CPB001
      * Portfolio Reference: default to the first portfolio               CPB001
      * available portfolio reference                                     CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           WPBCUS    ANDEQ'Y'                                       CPB001
     C           BGPFMG    OREQ 'Y'                                       CPB001
     C           WLPCUS    ANDEQ'Y'                                       CPB001
     C           @PPTFR    IFEQ *BLANKS                                   CPB001
     C           @PTCNR    SETLLPMPORTLL                                  CPB001
     C           @PTCNR    READEPMPORTLL                 01               CPB001
     C           *IN01     IFEQ '0'                                       CPB001
     C                     MOVE PNPTFR    @PPTFR                          CPB001
     C                     END                                            CPB001
     C                     END                                            CPB001
     C                     ENDIF                                          CPB001
     C*
     C*   Set record ID
     C                     MOVEL'D'       @PRECI
     C*                                                                   CAC002
     C                     MOVE *BLANKS   SFXMP                           CAC002
     C                     MOVE *BLANKS   SMAMT                           CAC002
      *                                                                                       234871
     C           @PPRIC    IFEQ 0                                                             234871
     C           PROT      ANDEQ'7'                                                           234871
     C           *IN43     IFEQ '0'                                                           234871
     C                     Z-ADD@PTPDY    @PPRIC                                              234871
     C                     ENDIF                                                              234871
     C                     ENDIF                                                              234871
     C*                                                                                       234440
     C*   Set EU Tax Amount by calling SEVTRADTAX                                             234440
     C           CGL031    IFEQ 'Y'                                                           234440
     C           @PTDTP    ANDEQ'TP'                                                          234440
     C           @WC1DI    IFEQ 'S'                                                           234440
     C           @WC1DI    OREQ 'D'                                                           234440
     C                     CALL SEVTAX                                                        234440
      * INPUTS                                                                                234440
      * Response Mode                                                                         234440
     C                     PARM           PRETC                                               234440
      * Valid Trade Details                                                                   234440
     C                     PARM           @PARMT                                              234440
      * Security Details                                                                      234440
     C                     PARM           @SECTY                                              234440
      * Process Flag                                                                          234440
     C                     PARM 'E'       @WFLG   1                                           234440
      * OUTPUTS                                                                               234440
      * EU Tax Screen Format                                                                  234440
      * EU Tax in Nominal Currency File Format                                                234440
      * EU Tax in Settlement Currency File Format                                             234440
     C                     PARM           @SEUTX                                              234440
     C                     PARM           @PEUTX                                              234440
     C                     PARM           @PEUTS                                              234440
     C                     ENDIF                                                              234440
     C                     ENDIF                                                              234440
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CP12                                           S01408
     C*                                                                   S01408
      *
     C                     ENDSR                           SUB303 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *  SUB304 - Screen 1 defaults (part 2)                          *
      *****************************************************************
     C           SUB304    BEGSR
      *
      * Clearance type: Use clearance type from standard settlements
     C                     MOVE 'N'       SSVAR                                            AR636394A
     C           @PCLTY    IFEQ *BLANKS
     C           @WC1DI    IFEQ 'M'
     C/COPY WNCPYSRC,SE3002C069
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE '0'       *IN01                                               CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP                                               CSE028
     C                     PARM           @PTDBA                                              CSE028
     C                     PARM           @PTCNR                                              CSE028
     C**********           PARM           SIBK                                         CSE028 CSE034
     C                     PARM SIBK      PSIBK                                               CSE034
     C                     PARM           @PSETC                                              CSE028
     C                     PARM SMCC      PMRKT                                               CSE034
     C                     PARM           SITP                                                CSE028
     C                     PARM           PTFR                                                CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD                                               CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN01                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           @KEY6     CHAINSTDSEDF              01
     C                     MOVE 'Y'       SSVAR                                            AR636394A
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE3002C070
     C                     ELSE
     C/COPY WNCPYSRC,SE3002C047
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE '0'       *IN01                                               CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP                                               CSE028
     C                     PARM           @PTDBA                                              CSE028
     C                     PARM           @PTCNR                                              CSE028
     C**********           PARM           SIBK                                         CSE028 CSE034
     C                     PARM SIBK      PSIBK                                               CSE034
     C                     PARM           @PSETC                                              CSE028
     C                     PARM SMCC      PMRKT                                               CSE034
     C                     PARM           SITP                                                CSE028
     C                     PARM           PTFR                                                CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD                                               CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN01                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           @KEY5     CHAINSTDSEDF              01
     C                     MOVE 'Y'       SSVAR                                            AR636394A
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE3002C048
     C                     END
      *                                                                   CEU005
      ** CEU005 active and settlement currency not blank.                 CEU005
      ** Obtain EURO rate, EURO M/D ind. and transition start date for    CEU005
      ** 'IN' currency.                                                   CEU005
      *                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           SCCY      ANDNE*BLANKS                                   CEU005
     C           *IN01     ANDEQ'0'                                       CEU005
     C           @WC1DI    ANDEQ'M'                                       CEU005
      *                                                                   CEU005
     C           NMCYA     IFEQ BKEURO                                    CEU005
     C                     MOVE *BLANKS   @RTCD                           CEU005
     C                     MOVEL*BLANKS   @RTCD                           CEU005
     C                     MOVE SCCY      @AJCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '44'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVELSCCY      @DBKEY            * ERROR 44 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C                     ELSE                                           CEU005
     C           SCCY      IFEQ BKEURO                                    CEU005
     C                     MOVE *BLANKS   @RTCD                           CEU005
     C                     MOVEL'*DBERR'  @RTCD                           CEU005
     C                     MOVE NMCYA     @AJCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '45'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVELNMCYA     @DBKEY            * ERROR 45 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C                     END                                            CEU005
     C                     END                                            CEU005
      *                                                                   CEU005
      * Value date later than Transition start date, use settlement       CEU005
      * currency from PF/STDSED.                                          CEU005
      *                                                                   CEU005
     C           @PTDVD    IFGE A6TPSD                                    CEU005
     C                     MOVELSCCY      @PSETC                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     END                                            CEU005
      *                                                                   CEU005
     C           CEU005    IFEQ 'N'                                       CEU005
     C           SCCY      OREQ *BLANKS                                   CEU005
     C           *IN01     IFEQ '0'
     C           SSVAR     IFEQ 'N'                                                        AR636394A
     C           SSVAR     OREQ 'Y'                                                        AR636394A
     C           RECI      ANDEQ'D'
     C           @PTDTP    IFEQ 'TS'
     C                     MOVELSCLS      @PCLTY
     C                     ELSE
     C                     MOVELSCLP      @PCLTY
     C                     END
     C*
     C                     ELSE
     C                     MOVEL'0'       @PCLTY
     C                     END
     C                     ENDIF                                          CEU005
     C                     ENDIF                                                           AR636394A
     C                     END
      *
      * Price: default calculated by ZPRCI
     C           @PPRIC    IFEQ 0
     C           *IN43     ANDEQ'1'
     C                     Z-ADD@PTPDY    ZPRCIN
     C                     Z-ADD@PTDVD    ZFDATE
     C                     MOVE 'C'       SCUMEX                          E39495
     C/COPY WNCPYSRC,SE3002C053
     C                     EXSR ZPRCI
      *                                                                                       CSE035
      *  ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE3002C034
     C                     Z-ADDZPRCOT    @PPRIC
     C                     END
      *
      * Ex dividend: If processing type is 4 or 7
      *              If next dividend date is zero = C
      *              Else calculate ex date using default. If value date
      *               is less than next dividend date and greater or
      *               equal to ex date = X
      *              Else = C
     C           @PEXDV    IFEQ *BLANKS
     C           *IN44     ANDEQ'1'
     C*                                                                   065019
     C*  Incorrect ex-dividend default. Use new subroutine to             065019
     C*  perform calculation.                                             065019
     C*                                                                   065019
     C                     EXSR SUB509                                    065019
     C***********NDVD      IFEQ 0                                         065019
     C***********          MOVEL'C'       @PEXDV                          065019
     C***********          ELSE                                           065019
     C***********          MOVELEDFT      ZNRDYS                          065019
     C***********          MOVE EDFT      @WEDFT  1                       065019
     C***********@WEDFT    IFEQ 'W'                                       065019
     C***********          Z-ADDNDVD      ZDAYNO                          065019
     C***********          MOVE NMCYA     ZCCY                            065019
     C***********          MOVE *BLANKS   ZLOC                      S01195065019
     C***********          EXSR XDATE3                              S01195065019
     C***********          EXSR ZBKDT                               S01195065019
     C***********          ELSE                                           065019
     C***********NDVD      SUB  ZNRDYS    ZDYNBR                          065019
     C***********          END                                            065019
     C***********@PTDVD    IFLT NDVD                                      065019
     C***********@PTDVD    ANDGEZDYNBR                                    065019
     C***********          MOVEL'X'       @PEXDV                          065019
     C***********          ELSE                                           065019
     C***********          MOVEL'C'       @PEXDV                          065019
     C***********          END                                            065019
     C***********          END                                            065019
     C                     END
      *
     C                     ENDSR                           SUB304 ends
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *                                                               *
      *    SUBROUTINE- SUB400                                         *
      *    Determine next coupon date for purchase interest calcs     *
      *                                                               *
      *   INPUT - CD Array - Coupon dates - SECTYD security file      *
      *           CR Array - Rate/Payt inds - SECTYD security file    *
      *           FCPN - First coupon date - SECTYD security file     *
      *           MATY - Maturity date - SECTYD security file         *
      *           ECD - Event control date - ZEVCD process            *
      *           *IN98 - Date format - from TABTB10 record via ZSYSTM*
      *                                                               *
      *   OUTPUT - NCD (5,0) - Next coupon date                       *
      *                                                               *
      *   CALLS  - ZDATE1                                             *
      *            ZDATE2                                             *
      *                                                               *
      *****************************************************************
     C***********SUB400    BEGSR                                          079845
      *                                                                   079845
      * Call ZDATE2 to obtain MMDD for start date of interest             079845
     C***********          Z-ADD@WPDAT    ZDAYNO                          079845
     C***********          EXSR ZDATE2                                    079845
     C***********          MOVELZDATE     ZZPDD4  40                      079845
     C************IN98     IFEQ '0'                                       079845
     C***********          MOVELZZPDD4    ZZWRKD                          079845
     C***********          MOVE ZZPDD4    ZZWRKM                          079845
     C***********          Z-ADDZZWRKD    ZZPDD4                          079845
     C***********          MOVELZZWRKM    ZZPDD4                          079845
     C***********          END                                            079845
      *                                                                   079845
      * If date format is DDMMYY turn round array of coupon dates to MMDD 079845
     C************IN98     IFEQ '0'                                       079845
     C***********          DO   12        X       20                      079845
     C***********          MOVE CD,X      ZZWRKM  20                      079845
     C***********          MOVELCD,X      ZZWRKD  20                      079845
     C***********          Z-ADDZZWRKD    CD,X                            079845
     C***********          MOVELZZWRKM    CD,X                            079845
     C***********          END                                            079845
     C***********          END                                            079845
      *                                                                   079845
      * Get year for ECD                                                  079845
     C***********          MOVE ZDATE     ZECDYR  20                      079845
      *                                                                   079845
      * Find next coupon date from arrays -                               079845
      *  If RATE/PAYT inds all blank NCD = maturity date                  079845
     C***********          Z-ADDMATY      NCD     50                      079845
     C***********CRDS      IFNE *BLANKS                                   079845
      *                                                                   079845
      *  If RATE/PAYT inds not all blank -                                079845
      *    search for next highest coupon > start date of interest        079845
     C***********          MOVE '0'       ZFOUND  1                       079845
     C***********          DO   12        X                               079845
     C***********CR,X      IFEQ 'P'                                       079845
     C***********CR,X      OREQ 'C'                                       079845
     C***********ZZPDD4    IFLT CD,X                                      079845
     C***********          MOVE '1'       ZFOUND                          079845
     C***********          GOTO CNCD00                                    079845
     C***********          END                                            079845
     C***********          END                                            079845
     C***********          END                                            079845
      *                                                                   079845
      *      Found - Add ECD'S YY to form date                            079845
     C***********CNCD00    TAG                             CNCD00 TAG     079845
     C***********ZFOUND    IFEQ '1'                                       079845
     C***********          Z-ADDZECDYR    ZDATE                           079845
     C***********          MOVELCD,X      ZDATE                           079845
      *                                                                   079845
      *      Not found - use first coupon                                 079845
      *                  add next year's YY to form date                  079845
     C***********          ELSE                                           079845
     C***********          DO   12        X                               079845
     C***********CR,X      IFEQ 'P'                                       079845
     C***********CR,X      OREQ 'C'                                       079845
     C***********          Z-ADDZECDYR    ZDATE                           079845
     C***********          ADD  1         ZDATE                           079845
     C***********          MOVELCD,X      ZDATE                           079845
     C***********          MOVE '1'       ZFOUND                          079845
     C***********          GOTO CNCD01                                    079845
     C***********          END                                            079845
     C***********          END                                            079845
     C***********          END                                            079845
     C***********CNCD01    TAG                             CNCD01 TAG     079845
      *                                                                   079845
      * Convert date to day no using ZDATE1                               079845
      * (not done if no RATE/PAYT ind is P or C)                          079845
      * If DDMMYY format turn round to MMDDYY                             079845
     C***********ZFOUND    IFEQ '1'                                       079845
     C************IN98     IFEQ '0'                                       079845
     C***********          MOVELZDATE     ZZWRK   40                      079845
     C***********          MOVE ZZWRK     ZZWRKM                          079845
     C***********          MOVELZZWRK     ZZWRKD                          079845
     C***********          Z-ADDZZWRKD    ZZWRK                           079845
     C***********          MOVELZZWRKM    ZZWRK                           079845
     C***********          MOVELZZWRK     ZDATE                           079845
     C***********          END                                            079845
     C***********          EXSR ZDATE1                                    079845
     C***********          Z-ADDZDAYNO    NCD                             079845
     C***********          END                                            079845
      *                                                                   079845
      * If NCD > maturity date , reset NCD = maturity date                079845
     C***********NCD       IFGT MATY                                      079845
     C***********          Z-ADDMATY      NCD                             079845
     C***********          END                                            079845
     C***********          END                                            079845
      *                                                                   079845
      * If NCD < 1st coupon date , reset NCD = 1st coupon date            079845
     C***********NCD       IFLT FCPN                                      079845
     C***********          Z-ADDFCPN      NCD                             079845
     C***********          END                                            079845
      *                                                                   079845
      * If date format is DDMMYY turn back array of coupon dates to DDMM  079845
     C************IN98     IFEQ '0'                                       079845
     C***********          DO   12        X       20                      079845
     C***********          MOVELCD,X      ZZWRKM  20                      079845
     C***********          MOVE CD,X      ZZWRKD  20                      079845
     C***********          Z-ADDZZWRKM    CD,X                            079845
     C***********          MOVELZZWRKD    CD,X                            079845
     C***********          END                                            079845
     C***********          END                                            079845
      *                                                                   079845
     C***********          ENDSR                           SUB400 ends    079845
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************
      *  SUB401 - Calculate interest                                  *
      *                                                            S01176 E21050
      *    THIS SUBROUTINE HAS BEEN REPLACED BY ZPCINTZ1           S01176 E21050
      *                                                            S01176 E21050
      *****************************************************************
      *****************************************************************
      *  SUB402 Sub routine to calculate the interest accrued         *
      *         adjustment on a Trade                                 *
      *                                                            S01176 E21050
      *    THIS SUBROUTINE HAS BEEN REPLACED BY ZPCINTZ1           S01176 E21050
      *                                                            S01176 E21050
      *****************************************************************
      /EJECT
     C*****************************************************************   S01176
     C*  SUB403 - Determine Default Charge/Commission Codes           *   S01176
     C*           and Rebate Percentage                               *   S01176
     C*                                                               *   S01176
     C*    THIS SUBROUTINE HAS BEEN REWRITTEN                         *   S01176
     C*                                                               *   S01176
     C*****************************************************************   S01176
     C***********SUB403    BEGSR                                          S01176
     C***********          ENDSR                           SUB403 ends    S01176
     C***********                                                         S01176
     C*****************************************************************   S01176
     C/EJECT                                                              S01176
     C*****************************************************************   S01176
     C*  SUB404 - Calculate charges and commissions                   *   S01176
     C*                                                               *   S01176
     C*    THIS SUBROUTINE HAS BEEN REWRITTEN                         *   S01176
     C*                                                               *   S01176
     C*****************************************************************   S01176
     C***********SUB404    BEGSR                                          S01176
     C***********          ENDSR                           SUB404 ends    S01176
     C***********                                                         S01176
     C*****************************************************************   S01176
     C/EJECT                                                              S01176
      *****************************************************************   S01176
      **                                                              *   S01176
      *    SUB403 - Determine Default Charge/Commission Codes         *   S01176
      *             and Rebate Percentage                             *   S01176
      *                                                               *   S01176
      *    Called By : SUB303                                         *   S01176
      *    Calls     : NONE                                           *   S01176
      *                                                               *   S01176
      *    Condition of entry : Autocharges set on                    *   S01176
      **                                                              *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           SUB403    BEGSR                           *** SUB403  ***S01176
      *                                                                   S01176
      * Set up key fields                                                 S01176
      *                                                                   S01176
     C                     MOVEL@WC1DI    @KC1DI                          S01176
     C                     MOVE BFTDCG    @KCLGR                          S01496
     C                     MOVELSITP      @KSITP                          S01176
     C                     MOVELSMCC      @KMRKT                          S01176
     C**********           Z-ADD@PTCNR    @KCNUM                                      S01176 CSD027A
     C                     MOVE @PTCNR    @KCNUM                                             CSD027A
     C*                                                                   065008
     C** Use Market Centre entered on screen if not blank                 065008
     C*                                                                   065008
     C           @PTMKC    IFNE *BLANKS                                   065008
     C           @PTMKC    ANDNESMCC                                      065008
     C                     MOVEL@PTMKC    @KMRKT                          065008
     C                     END                                            065008
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CP15                                           S01408
     C*                                                                   S01408
      *                                                                   S01176
      * Access customer/broker defaults file                              S01176
      *                                                                   S01176
     C           S01496    IFNE 'Y'                                       S01496
     C           BVACOP    ORNE 'Y'                                       S01496
     C           @KEY9     CHAINCUBRD                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
      *                                                                   S01176
      ***  Record not found on LF/CUBRD, chain to LF/CUBRD                S01176
      ***  again with a Customer Number of zero.                          S01176
      *                                                                   S01176
     C**********           Z-ADD0         @KCNUM                                      S01176 CSD027A
     C                     MOVE *BLANKS   @KCNUM                                             CSD027A
     C           @KEY9     CHAINCUBRD                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
      *                                                                   S01176
      ***  Record not found, chain to LF/CUBRD                            S01176
      ***  again with a blank market centre                               S01176
      *                                                                   S01176
     C                     MOVEL*BLANKS   @KMRKT                          S01176
     C           @KEY9     CHAINCUBRD                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
      *                                                                   S01176
      * If record not found, chain to LF/CUBRD                            S01176
      * again with a blank investment type                                S01176
      *                                                                   S01176
     C                     MOVEL*BLANKS   @KSITP                          S01176
     C           @KEY9     CHAINCUBRD                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
      *                                                                   S01176
      * If no defaults then blank out the default codes                   S01176
      *                                                                   S01176
     C                     MOVE *BLANK    DBCC                            S01176
     C                     MOVE *BLANK    DCCC                            S01176
     C                     MOVE *BLANK    DCC1                            S01176
     C                     MOVE *BLANK    DCC2                            S01176
     C                     Z-ADD*ZERO     CMRP                            S01176
      *                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     ELSE                                           S01496
     C           @KEY9A    CHAINSECUBRL0             01                   S01496
     C           *IN01     IFEQ '0'                                       S01496
     C           RECI      ANDEQ'D'                                       S01496
     C                     SETON                     04                   S01496
     C*                                                                   S01496
     C***  ELSE, Record not found on LF/SECUBRL0, chain to LF/SECUBRL0    S01496
     C***  again with only first three priorities.                        S01496
     C                     ELSE                                           S01496
     C                     MOVELBVPCSD    PCSD    10                      S01496
     C                     MOVELBVPIDF    PIDF    10                      S01496
     C                     MOVELBVPMDF    PMDF    10                      S01496
     C                     MOVELBVPOCD    POCD    10                      S01496
     C*                                                                   S01496
     C                     EXSR SUB4A                                     S01496
     C           @KEY9A    CHAINSECUBRL0             01                   S01496
     C           *IN01     IFEQ '0'                                       S01496
     C           RECI      ANDEQ'D'                                       S01496
     C                     SETON                     04                   S01496
     C*                                                                   S01496
     C***  ELSE, If record not found, chain to LF/SECUBRL0 again with     S01496
     C***  only the first two priorities.                                 S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C                     EXSR SUB4A                                     S01496
     C           @KEY9A    CHAINSECUBRL0             01                   S01496
     C           *IN01     IFEQ '0'                                       S01496
     C           RECI      ANDEQ'D'                                       S01496
     C                     SETON                     04                   S01496
     C*                                                                   S01496
     C***  If record not found, chain to LF/SECUBRL0 again with           S01496
     C***  only first priority                                            S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C                     EXSR SUB4A                                     S01496
     C           @KEY9A    CHAINSECUBRL0             01                   S01496
     C           *IN01     IFEQ '0'                                       S01496
     C           RECI      ANDEQ'D'                                       S01496
     C                     SETON                     04                   S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CP16                                           S01408
     C*                                                                   S01408
      *                                                                   S01176
      * Update work field containing commission rebate %                  S01176
      *                                                                   S01176
     C           *LIKE     DEFN CMRP      @CMRP                           S01176
     C                     Z-ADDCMRP      @CMRP                           S01176
      *                                                                   S01176
      * If broker code is blank, and this is a client agency trade        S01176
      * then use default from ICD                                         S01176
      *                                                                   S01176
      * If switchable feature Bulk Input Enhancements is on               S01448
      * only default code if not a cross agency trade.                    S01448
      *                                                                   S01448
     C           S01448    IFEQ 'Y'                                       S01448
     C           @CAGT     ANDNE'Y'                                       S01448
     C           S01448    ORNE 'Y'                                       S01448
      *                                                                   S01448
     C           DBCC      IFEQ *BLANKS                                   S01176
     C           @PATRD    ANDEQ'C'                                       S01176
     C***********          MOVELDEBC      DBCC                            S01176
     C                     MOVELBVDBCD    DBCC                            S01176
     C                     END                                            S01176
     C                     END                                            S01448
      *                                                                   S01176
      * Check defaults assigned. If they do not exist on LF/SECGT,        S01176
      * then blank them out                                               S01176
      *                                                                   S01176
     C           DBCC      IFNE *BLANKS                                   S01176
     C                     MOVELDBCC      @XCODE                          S01176
     C           @KEY7     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVEL*BLANKS   DBCC                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
     C           DCCC      IFNE *BLANKS                                   S01176
     C                     MOVELDCCC      @XCODE                          S01176
     C           @KEY7     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVEL*BLANKS   DCCC                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
     C           DCC1      IFNE *BLANKS                                   S01176
     C                     MOVE DCC1      @XCODE                          S01176
     C           @KEY7     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   DCC1                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
     C           DCC2      IFNE *BLANKS                                   S01176
     C                     MOVE DCC2      @XCODE                          S01176
     C           @KEY7     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   DCC2                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
      * If client is a market client, blank out customer                  S01176
      *  commission code                                                  S01176
      *                                                                   S01176
     C           *IN48     IFEQ '1'                                       S01176
     C                     MOVEL*BLANK    DCCC                            S01176
     C                     END                                            S01176
      *...                                                                069175
      * If Client_Agency_Trade and "DBCC" Equals Blanks Then              069175
      * then default to "@PTBCC" Broker_code.                             069175
      * so as to Calculate the Broker Commission Amount in SUB404.....    069175
     C           @PATRD    IFEQ 'C'                                       069175
     C           DBCC      ANDEQ*BLANKS                                   069175
     C                     MOVEL@PTBCC    DBCC                            069175
     C                     ENDIF                                          069175
      *...                                                                069175
      *                                                                   S01176
     C                     ENDSR                           SUB403 ends    S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      **                                                              *   S01176
      *    SUB404 - Determine Default Charge/Commission Amounts       *   S01176
      *                                                               *   S01176
      *    Called By : SUB303                                         *   S01176
      *    Calls     : SUB502 (4 times)                               *   S01176
      **                                                              *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           SUB404    BEGSR                           *** SUB404  ***S01176
      *                                                                   S01176
      ***  Calculate the Broker Commission Amount                         S01176
      *                                                                   S01176
     C           DBCC      IFNE *BLANKS                                   S01176
      *                                                                   S01176
     C                     MOVELDBCC      @PTBCC                          S01176
      *                                                                   S01176
      ***  If the Trade is not a Client Agency Trade                      S01176
      *                                                                   S01176
     C           @PATRD    IFNE 'C'                                       S01176
     C           @CAGT     OREQ 'Y'                                       S01448
     C                     MOVE DBCC      @XCODE                          S01176
     C                     EXSR SUB502                                    S01176
     C                     Z-ADDZCHGA     @PTBCA                          S01176
     C                     MOVE TXAP      @TXBC                           S01176
     C                     MOVE REBA      @RBBC                           S01176
      *                                                                   S01176
      ***  ELSE The Trade is a Client Agency Trade                        S01176
      ***  and therefore Broker Commission + Charges 1 and 2 from 1st     S01448
      ***  side should be shared amongst trades on second instead of      S01448
      ***  calculating brokerage (assuming that the default broker code   S01448
      ***  is valid).                                                     S01448
      *                                                                   S01176
     C                     ELSE                                           S01176
      *                                                                   S01176
      ***  Check that the code is on LF/SECGT                             S01176
      *                                                                   S01176
     C                     MOVE DBCC      @XCODE                          S01176
     C           @KEY7     CHAINSECGT                01                   S01176
      *                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C           @CUMMC    MULT @PNOML    @PTBCA                          S01176
     C                     DIV  @CUMMN    @PTBCA    H                     S01176
     C                     MOVE TXAP      @TXBC                           S01176
     C                     MOVE REBA      @RBBC                           S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   @PTBCC                          S01176
     C                     Z-ADD0         @PTBCA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Customer Commission Amount                       S01176
      *                                                                   S01176
     C                     MOVELDCCC      @PTCCC
     C           @PTCCC    IFNE *BLANKS                                   S01176
     C                     MOVE @PTCCC    @XCODE                          S01176
     C                     EXSR SUB502                                    S01176
     C                     Z-ADDZCHGA     @PTCCA                          S01176
     C                     MOVE TXAP      @TXCC                           S01176
     C                     MOVE REBA      @RBCC                           S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Amount for Charge Code 1                         S01176
      *                                                                   S01176
     C                     MOVELDCC1      @PTCC1
     C           @PTCC1    IFNE *BLANKS                                   S01176
     C                     MOVE @PTCC1    @XCODE                          S01176
     C                     EXSR SUB502                                    S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCPG                                           S01408
     C*                                                                   S01408
     C                     Z-ADDZCHGA     @PTCA1                          S01176
     C                     MOVE TXAP      @TXC1                           S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Amount for Charge Code 2                         S01176
      *                                                                   S01176
     C                     MOVELDCC2      @PTCC2
     C           @PTCC2    IFNE *BLANKS                                   S01176
     C                     MOVE @PTCC2    @XCODE                          S01176
     C                     EXSR SUB502                                    S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CCP1                                           S01408
     C*                                                                   S01408
     C                     Z-ADDZCHGA     @PTCA2                          S01176
     C                     MOVE TXAP      @TXC2                           S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Broker Commission Rebate                         S01176
      *                                                                   S01176
     C           @PTBCC    IFNE *BLANKS                                   S01176
     C           @RBBC     ANDEQ'Y'                                       S01176
     C           @CMRP     ANDNE0                                         S01176
     C           @PTBCA    MULT @CMRP     @PBCMR                          S01176
     C                     DIV  100       @PBCMR    H                     S01176
     C                     Z-SUB@PBCMR    @PBCMR                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Customer Commission Rebate                       S01176
      *                                                                   S01176
     C           @PTCCC    IFNE *BLANKS                                   S01176
     C           @RBCC     ANDEQ'Y'                                       S01176
     C           @CMRP     ANDNE0                                         S01176
     C           @PTCCA    MULT @CMRP     @PCCMR                          S01176
     C                     DIV  100       @PCCMR    H                     S01176
     C                     Z-SUB@PCCMR    @PCCMR                          S01176
     C                     END                                            S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CP17                                           S01408
     C*                                                                   S01408
      *                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      **                                                              *   S01176
      *    SUB405 - Determine Charge/Commission Tax Amounts           *   S01176
      *                                                               *   S01176
      *    Called By : SUB303                                         *   S01176
      *    Calls     : ZTCAL1 (22 times)                              *   S01176
      **                                                              *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           SUB405    BEGSR                           *** SUB405  ***S01176
     C*                                                                   S01176
     C** RESET CHARGE CURRENCY DECIMAL PLACES                             S01176
     C*                                                                   S01176
     C                     Z-ADD@CDP      ZDECS                           S01176
      *                                                                   S01446
      *  Set up fields required for the new call to ZCONV which has       S01446
      *  been added to ZTCAL1. Set to zero if the SE ICD Charge           S01446
      *  Currency is blank.                                               S01446
      *  Processing conditioned on Customer Commission switchable         S01446
      *  feature (S01446).                                                S01446
      *                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           BVCHRC    ANDNE*BLANK                                    S01446
     C                     MOVE BVCHRC    ZCCYI                           S01446
     C                     MOVE NMCYA     ZCCYO                           S01446
     C                     MOVE UCHXRT    ZEXCH                           S01446
     C                     MOVE UCHXMD    ZMD                             S01446
     C                     MOVE UNBDP     ZCDPI                           S01446
     C                     MOVE @NCDP     ZCDPO                           S01446
     C                     ELSE                                           S01446
     C                     MOVE *BLANK    ZCCYI                           S01446
     C                     MOVE *BLANK    ZCCYO                           S01446
     C                     MOVE *ZERO     ZEXCH                           S01446
     C                     MOVE *BLANK    ZMD                             S01446
     C                     MOVE *BLANK    ZCDPI                           S01446
     C                     MOVE *BLANK    ZCDPO                           S01446
     C                     END                                            S01446
      *                                                                   S01176
      ***  Don't calculate the Tax Amount if it has been overridden       S01176
      *                                                                   S01176
     C           @OVTX     IFNE 'Y'                                       S01176
     C           @OVTX     OREQ 'Y'                                       S01176
     C           @STAXA    ANDEQ*BLANKS                                   S01176
     C                     MOVE 'N'       @OVTX                           S01176
      *                                                                   S01176
      ***  Initialise the Tax Amount to zero.                             S01176
      *                                                                   S01176
     C                     Z-ADD0         @PTAXA                          S01176
      *                                                                   S01176
      ***  Don't calculate the Tax Amount if Tax details                  S01176
      ***  are not available for the Counterparty.                        S01176
      *                                                                   S01176
     C           @TAXC     IFNE *BLANKS                                   S01176
      *                                                                   S01176
      ***  Calculate the Tax due on the Broker Commission Amount          S01176
      *                                                                   S01176
     C           @PTBCC    IFNE *BLANKS                                   S01176
     C           @TXBC     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PTBCA    IFLT 0                                         S01176
     C                     Z-SUB@PTBCA    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTAXA                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTBCA    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Tax due on the Customer Commission Amount        S01176
      *                                                                   S01176
     C           @PTCCC    IFNE *BLANKS                                   S01176
     C           @TXCC     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PTCCA    IFLT 0                                         S01176
     C                     Z-SUB@PTCCA    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTAXA                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTCCA    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Tax due on Charge Code 1                         S01176
      *                                                                   S01176
     C           @PTCC1    IFNE *BLANKS                                   S01176
     C           @TXC1     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PTCA1    IFLT 0                                         S01176
     C                     Z-SUB@PTCA1    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTAXA                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTCA1    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Tax due on Charge Code 2                         S01176
      *                                                                   S01176
     C           @PTCC2    IFNE *BLANKS                                   S01176
     C           @TXC2     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PTCA2    IFLT 0                                         S01176
     C                     Z-SUB@PTCA2    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTAXA                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTCA2    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Tax due on Charge Code 3                         S01176
      *                                                                   S01176
     C           @PTCC3    IFNE *BLANKS                                   S01176
     C           @TXC3     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PTCA3    IFLT 0                                         S01176
     C                     Z-SUB@PTCA3    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTAXA                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTCA3    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Tax due on Charge Code 4                         S01176
      *                                                                   S01176
     C           @PTCC4    IFNE *BLANKS                                   S01176
     C           @TXC4     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PTCA4    IFLT 0                                         S01176
     C                     Z-SUB@PTCA4    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTAXA                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTCA4    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Tax due on Charge Code 5                         S01176
      *                                                                   S01176
     C           @PTCC5    IFNE *BLANKS                                   S01176
     C           @TXC5     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PTCA5    IFLT 0                                         S01176
     C                     Z-SUB@PTCA5    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTAXA                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTCA5    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Tax due on Charge Code 6                         S01176
      *                                                                   S01176
     C           @PTCC6    IFNE *BLANKS                                   S01176
     C           @TXC6     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PTCA6    IFLT 0                                         S01176
     C                     Z-SUB@PTCA6    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTAXA                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTCA6    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Tax due on Charge Code 7                         S01176
      *                                                                   S01176
     C           @PTCC7    IFNE *BLANKS                                   S01176
     C           @TXC7     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PTCA7    IFLT 0                                         S01176
     C                     Z-SUB@PTCA7    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTAXA                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PTCA7    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTAXA                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     MOVE @PTAXA    @STAXA                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Don't calculate the Tax Rebate if it has been overridden       S01176
      *                                                                   S01176
     C           @OVTXR    IFNE 'Y'                                       S01176
     C           @OVTXR    OREQ 'Y'                                       S01176
     C           @STXRB    ANDEQ*BLANKS                                   S01176
     C                     MOVE 'N'       @OVTXR                          S01176
      *                                                                   S01176
      ***  Initialise the Tax Rebate Amount to zero.                      S01176
      *                                                                   S01176
     C                     Z-ADD0         @PTXRB                          S01176
      *                                                                   S01176
      ***  Don't calculate the Tax Rebate Amount if Tax details           S01176
      ***  are not available for the Counterparty.                        S01176
      *                                                                   S01176
     C           @TAXC     IFNE *BLANKS                                   S01176
      *                                                                   S01176
      ***  Calculate the Tax Rebate due with Broker Commission Rebate     S01176
      *                                                                   S01176
     C           @PTBCC    IFNE *BLANKS                                   S01176
     C           @RBBC     ANDEQ'Y'                                       S01176
     C           @TXBC     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PBCMR    IFLT 0                                         S01176
     C                     Z-SUB@PBCMR    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTXRB                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PBCMR    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTXRB                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Calculate the Tax Rebate due with Cust. Commission Rebate      S01176
      *                                                                   S01176
     C           @PTCCC    IFNE *BLANKS                                   S01176
     C           @RBCC     ANDEQ'Y'                                       S01176
     C           @TXCC     ANDEQ'Y'                                       S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
      *                                                                   S01176
     C           @PCCMR    IFLT 0                                         S01176
     C                     Z-SUB@PCCMR    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     SUB  ZTAXA     @PTXRB                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@PCCMR    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     ADD  ZTAXA     @PTXRB                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     MOVE @PTAXA    @STAXA                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01496
     C*****************************************************************   S01496
     C*    SUB4A - Determine Highest priority for customer charges    *   S01496
     C*                                                               *   S01496
     C*    Called By : SUB403                                         *   S01496
     C*    Calls     : NONE                                           *   S01496
     C*                                                               *   S01496
     C*    Condition of entry : Autocharges set on                    *   S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C           SUB4A     BEGSR                           *** SUB4A   ***S01496
     C*                                                                   S01496
     C                     MOVEL'N'       CHANGE  1                       S01496
     C           PCSD      IFGT PIDF                                      S01496
     C           PCSD      ANDGTPMDF                                      S01496
     C           PCSD      ANDGTPOCD                                      S01496
     C                     MOVE *BLANKS   @KCLGR                          S01496
     C                     Z-ADD0         PCSD                            S01496
     C                     MOVEL'Y'       CHANGE  1                       S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           PIDF      IFGT PCSD                                      S01496
     C           PIDF      ANDGTPMDF                                      S01496
     C           PIDF      ANDGTPOCD                                      S01496
     C                     MOVE *BLANKS   @KSITP                          S01496
     C                     Z-ADD0         PIDF                            S01496
     C                     MOVEL'Y'       CHANGE  1                       S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           PMDF      IFGT PIDF                                      S01496
     C           PMDF      ANDGTPCSD                                      S01496
     C           PMDF      ANDGTPOCD                                      S01496
     C                     MOVE *BLANKS   @KMRKT                          S01496
     C                     Z-ADD0         PMDF                            S01496
     C                     MOVEL'Y'       CHANGE  1                       S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           POCD      IFGT PCSD                                      S01496
     C           POCD      ANDGTPMDF                                      S01496
     C           POCD      ANDGTPIDF                                      S01496
     C                     MOVE *BLANKS   @KCNUM                          S01496
     C                     Z-ADD0         POCD                            S01496
     C                     MOVEL'Y'       CHANGE  1                       S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           CHANGE    IFNE 'Y'                                       S01496
     C*                                                                   S01496
     C           PCSD      IFEQ PIDF                                      S01496
     C           PCSD      OREQ PMDF                                      S01496
     C           PCSD      OREQ POCD                                      S01496
     C*                                                                   S01496
     C           PCSD      IFEQ PIDF                                      S01496
     C                     MOVE *BLANKS   @KSITP                          S01496
     C                     Z-ADD0         PIDF                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PCSD      IFEQ PMDF                                      S01496
     C                     MOVE *BLANKS   @KMRKT                          S01496
     C                     Z-ADD0         PMDF                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PCSD      IFEQ POCD                                      S01496
     C                     MOVE *BLANKS   @KCNUM                          S01496
     C                     Z-ADD0         POCD                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     MOVE *BLANKS   @KCLGR                          S01496
     C                     Z-ADD0         PCSD                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PIDF      IFEQ PMDF                                      S01496
     C           PIDF      OREQ POCD                                      S01496
     C*                                                                   S01496
     C           PIDF      IFEQ PMDF                                      S01496
     C                     MOVE *BLANKS   @KMRKT                          S01496
     C                     Z-ADD0         PMDF                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PIDF      IFEQ POCD                                      S01496
     C                     MOVE *BLANKS   @KCNUM                          S01496
     C                     Z-ADD0         POCD                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     MOVE *BLANKS   @KSITP                          S01496
     C                     Z-ADD0         PIDF                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PMDF      IFEQ POCD                                      S01496
     C                     MOVE *BLANKS   @KCNUM                          S01496
     C                     Z-ADD0         POCD                            S01496
     C                     MOVE *BLANKS   @KMRKT                          S01496
     C                     Z-ADD0         PMDF                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
      /EJECT
      *****************************************************************
      **                                                              *   S01176
      *    SUB500 - Validate Charge/Commission Code                   *   S01176
      *                                                               *   S01176
      *    Receives  : @XCODE - The Charge Code                       *   S01176
      *                @XAMT  - The Charge Amount                     *   S01176
      *                @OV    - Charge Amount Override Indicator      *   S01176
      *                @XERR1 - Code not valid on LF/SECGT            *   S01176
      *                @XERR2 - Code blank, but Amount entered        *   S01176
      *                @I     - Indicator referring to the Chrge Code *   S01176
      *                                                               *   S01176
      *    Called By : SUB203                                         *   S01176
      **                                                              *   S01176
      *****************************************************************
      *                                                                   S01176
     C           SUB500    BEGSR                           *** SUB500  ***S01176
      *
     C***********          MOVEL'N'       @VL                             S01176
      *                                                                   S01176
      ***  If Code is not blank, then check that it is on LF/SECGT        S01176
      *                                                                   S01176
     C           @XCODE    IFNE *BLANKS
      *                                                                   S01176
     C           @KEY7     CHAINSECGT                01
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C***********@XCODE    IFNE @OCODE                                    S01176
     C                     MOVE @XERR1    @EA,E
     C                     ADD  1         E
     C                     MOVEL'1'       *IN,@I
     C***********          SETON                     11                   S01176
     C                     SETON                     11  14               S01176
     C                     END
      *                                                                   S01176
      ***  ELSE Code is blank, therefore Amount should be blank.          S01176
      ***  If it has been overridden, then it is an error, else           S01176
      ***  just blank out the field.                                      S01176
     C                     ELSE
      *                                                                   S01176
     C           @XAMT     IFNE *BLANKS                                   S01176
      *                                                                   S01176
     C***********@OV       IFEQ 'Y'                                       S01176
     C                     MOVE @XERR2    @EA,E                           S01176
     C                     ADD  1         E                               S01176
     C                     MOVE '1'       *IN,@I                          S01176
     C                     SETON                     11  14               S01176
     C***********          MOVELVATI      @VL     1                       S01176
     C***********          ELSE                                           S01176
     C***********          MOVE *BLANKS   @XAMT                           S01176
     C***********          END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      **                                                              *   S01176
      *  SUB501 - Validate Charge/Commission Amount                   *   S01176
      *                                                               *   S01176
      *  Receives  : @XCODE - The Charge Code                         *   S01176
      *              @XAMT  - The Charge Amount                       *   S01176
      *              @OV    - Charge Amount Override Indicator        *   S01176
      *              @XERR3 - Amount blank, but Code entered          *   S01176
      *                        (Only if Autocharges not present)      *   S01176
      *              @XERR4 - Not valid signed amount (Can be zero)   *   S01176
      *              @J     - Indicator referring to the Charge Amount*   S01176
      *                                                               *   S01176
      *  Called By : SUB203                                           *   S01176
      *  Calls     : ZASIGN                                           *   S01176
      *              SUB502                                           *   S01176
      *              ZSEDIT                                           *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           SUB501    BEGSR                           *** SUB501  ***S01176
     C*                                                                   S01176
     C** IF AUTOCHARGES OFF CHECK CODE/AMT EITHER BOTH ENTERED OR         S01176
     C** NEITHER ENTERED AND AMOUNT ENTERED IS VALID NUMERIC              S01176
     C*                                                                   S01176
     C***********AUMO      IFNE 'Y'                                S01176 S01117
     C           BVACOP    IFNE 'Y'                                       S01117
     C*                                                                   S01176
     C           @XAMT     IFEQ *BLANK                                    S01176
     C           @XCODE    ANDNE*BLANK                                    S01176
     C           @XAMT     ORNE *BLANK                                    S01176
     C           @XCODE    ANDEQ*BLANK                                    S01176
     C*                                                                   S01176
     C                     MOVE @XERR3    @EA,E                           S01176
     C                     ADD  1         E                               S01176
     C                     MOVE '1'       *IN,@J                          S01176
     C                     SETON                     11  14               S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     MOVEL*BLANKS   ZFLD17                          S01176
     C                     MOVEL@XAMT     ZFLD17                          S01176
     C                     EXSR ZASIGN                                    S01176
      *                                                                   S01176
     C           *IN99     IFEQ '1'                                       S01176
     C                     MOVE @XERR4    @EA,E                           S01176
     C                     ADD  1         E                               S01176
     C                     MOVEL'1'       *IN,@J                          S01176
     C                     SETON                     11  14               S01176
      *                                                                   S01176
     C                     ELSE                                           S01176
     C                     MOVE ZOUT15    @XAMTN                          S01176
     C           ZFSIGN    IFEQ '-'                                       S01176
     C                     Z-SUB@XAMTN    @XAMTN                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Format amount for display                                      S01176
      *                                                                   S01176
     C                     Z-ADD@XAMTN    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @XAMT                           S01176
      *                                                                   S01176
     C           @XAMTN    IFEQ 0                                         S01176
     C           @OV       ANDNE'Y'                                       S01176
     C                     MOVE *BLANKS   @XAMT                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C** IF CODE/AMT HAS BEEN BLANKED OUT - THIS ENSURES THAT             S01176
     C**    BLANKS ARE OUTPUT ON SCREEN RATHER THAN ZEROES                S01176
     C*                                                                   S01176
     C           @OV       IFEQ 'Y'                                       S01176
     C           @XAMTN    ANDEQ0                                         S01176
     C           @XCODE    ANDEQ*BLANKS                                   S01176
     C           *IN,@I    ANDEQ'0'                                       S01176
     C                     MOVE *BLANKS   @XAMT                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C** AUTO CHARGES IS ON                                               S01176
     C*                                                                   S01176
      * Check amount is valid, if it has been overridden                  S01176
      *                                                                   S01176
     C           @XAMT     IFNE *BLANKS                                   S01176
     C           @OV       ANDEQ'Y'                                       S01176
      *                                                                   S01176
     C                     MOVEL*BLANKS   ZFLD17                          S01176
     C                     MOVEL@XAMT     ZFLD17                          S01176
     C                     EXSR ZASIGN                                    S01176
      *                                                                   S01176
     C           *IN99     IFEQ '1'                                       S01176
     C                     MOVE @XERR4    @EA,E                           S01176
     C                     ADD  1         E                               S01176
     C                     MOVEL'1'       *IN,@J                          S01176
     C                     SETON                     11  14               S01176
      *                                                                   S01176
     C                     ELSE                                           S01176
     C                     MOVE ZOUT15    @XAMTN                          S01176
     C           ZFSIGN    IFEQ '-'                                       S01176
     C                     Z-SUB@XAMTN    @XAMTN                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Format amount for display                                      S01176
      *                                                                   S01176
     C                     Z-ADD@XAMTN    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @XAMT                           S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ELSE                                           S01176
      *                                                                   S01176
     C*                                                                   S01176
     C** IF BOTH THE CODE AND THE AMOUNT HAVE BEEN BLANKED OUT            S01176
     C** SEND BLANKS TO THE SCREEN AND RE-DISPLAY                         S01176
     C*                                                                   S01176
     C           @XCODE    IFEQ *BLANKS                                   S01176
     C           @XAMT     ANDEQ*BLANKS                                   S01176
     C           @OV       ANDEQ'Y'                                       S01176
     C                     MOVE 'N'       @OV                             S01176
     C                     MOVE *BLANKS   @XAMT                           S01176
     C                     Z-ADD0         @XAMTN                          S01176
     C                     SETON                     05                   S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
      *                                                                   S01176
      ***  If the Charge Code is valid AND ALTERED                        S01176
      ***  OR IF THE Amount HAS BEEN BLANKED OUT                          S01176
      ***  - RECALCULATE THE AMOUNT                                       S01176
      *                                                                   S01176
     C           *IN,@I    IFEQ '0'                                       S01176
     C           @XCODE    ANDNE@@CODE                                    S01176
     C           @XAMT     OREQ *BLANKS                                   S01176
     C           @OV       ANDEQ'Y'                                       S01176
     C                     MOVE 'N'       @OV                             S01176
     C                     EXSR SUB502                                    S01176
     C                     SETON                     05                   S01176
      *                                                                   S01176
      * Format amount for display                                         S01176
      *                                                                   S01176
     C           ZCHGA     IFEQ 0                                         S01176
     C                     MOVE *BLANKS   @XAMT                           S01176
     C                     Z-ADD0         @XAMTN                          S01176
     C                     ELSE                                           S01176
     C                     Z-ADDZCHGA     @XAMTN                          S01176
     C                     Z-ADDZCHGA     ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @XAMT                           S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      *    SUB502 - Determine default charge/commission               *   S01176
      *                                                               *   S01176
      *    Called By : SUB404                                         *   S01176
      *                SUB501                                         *   S01176
      *    Calls     : ZCCAL1 (2 times)                               *   S01176
      *                                                               *   S01176
      *    Receives  : @XCODE                                         *   S01176
      *                                                               *   S01176
      *    Returns   : @XAMTN                                         *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           SUB502    BEGSR                           *** SUB502  ***S01176
      *                                                                   S01176
     C                     Z-ADD0         @XAMTN 150                      S01176
     C                     Z-ADD0         ZCHGA                           S01176
     C***********          MOVEL'N'       @VL                             S01176
      *                                                                   S01176
      * If Autocharge Option indicator is 'Y'                             S01176
      * do autocharge calculation                                         S01176
      *                                                                   S01176
     C***********AUMO      IFEQ 'Y'                                S01176 S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
      *                                                                   S01176
     C           @KEY7     CHAINSECGT                01                   S01176
      *                                                                   S01176
      * If record found, calculate amount if trade type matches           S01176
      * levied on indicator                                               S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
      *                                                                   S01176
     C           @PTDTP    IFEQ 'TP'                                      S01176
      *                                                                   S01176
     C           LPSI      IFEQ 'P'                                       S01176
     C           LPSI      OREQ *BLANKS                                   S01176
     C                     MOVE CHGB      ZCHGB                           S01176
     C                     MOVE THRI      ZTHRI                           S01176
     C                     Z-ADD@RA       ZRA                             S01176
     C                     Z-ADD@PC       ZPC                             S01176
     C                     Z-ADD@CG       ZCG                             S01176
     C                     Z-ADDMNCH      ZMNCH                           S01176
     C                     Z-ADDMXCH      ZMXCH                           S01176
     C                     Z-ADD@CDP      ZDECS                           S01176
     C***********          EXSR SUB503                                    S01176
      *                                                                   S01446
      *  Set purchased interest parameter for ZCCAL1                      S01446
      *  Set up fields required for the new call to ZCONV which has       S01446
      *  been added to ZCCAL1. Set to zero if the SE ICD Charge           S01446
      *  Currency is blank.                                               S01446
      *  Processing conditioned on Customer Commission switchable         S01446
      *  feature (S01446).                                                S01446
      *                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C                     Z-ADD@PITRA    ZTPI                            S01446
     C           BVCHRC    IFNE *BLANK                                    S01446
     C                     MOVE BVCHRC    ZCCYI                           S01446
     C                     MOVE NMCYA     ZCCYO                           S01446
     C                     MOVE UCHXRT    ZEXCH                           S01446
     C                     MOVE UCHXMD    ZMD                             S01446
     C                     MOVE UNBDP     ZCDPI                           S01446
     C                     MOVE @NCDP     ZCDPO                           S01446
     C                     ELSE                                           S01446
     C                     MOVE *BLANK    ZCCYI                           S01446
     C                     MOVE *BLANK    ZCCYO                           S01446
     C                     MOVE *ZERO     ZEXCH                           S01446
     C                     MOVE *BLANK    ZMD                             S01446
     C                     MOVE *BLANK    ZCDPI                           S01446
     C                     MOVE *BLANK    ZCDPO                           S01446
     C                     END                                            S01446
     C                     END                                            S01446
      *                                                                   S01446
     C                     EXSR ZCCAL1                                    S01176
     C***********          MOVELVATI      @VL                             S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ELSE                                           S01176
      *                                                                   S01176
     C           LPSI      IFEQ 'S'                                       S01176
     C           LPSI      OREQ *BLANKS                                   S01176
     C                     MOVE CHGB      ZCHGB                           S01176
     C                     MOVE THRI      ZTHRI                           S01176
     C                     Z-ADD@RA       ZRA                             S01176
     C                     Z-ADD@PC       ZPC                             S01176
     C                     Z-ADD@CG       ZCG                             S01176
     C                     Z-ADDMNCH      ZMNCH                           S01176
     C                     Z-ADDMXCH      ZMXCH                           S01176
     C                     Z-ADD@CDP      ZDECS                           S01176
     C***********          EXSR SUB503                                    S01176
      *                                                                   S01446
      *  Set purchased interest parameter for ZCCAL1                      S01446
      *  Set up fields required for the new call to ZCONV which has       S01446
      *  been added to ZCCAL1. Set to zero if the SE ICD Charge           S01446
      *  Currency is blank.                                               S01446
      *  Processing conditioned on Customer Commission switchable         S01446
      *  feature (S01446).                                                S01446
      *                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C                     Z-ADD@PITRA    ZTPI                            S01446
     C           BVCHRC    IFNE *BLANK                                    S01446
     C                     MOVE BVCHRC    ZCCYI                           S01446
     C                     MOVE NMCYA     ZCCYO                           S01446
     C                     MOVE UCHXRT    ZEXCH                           S01446
     C                     MOVE UCHXMD    ZMD                             S01446
     C                     MOVE UNBDP     ZCDPI                           S01446
     C                     MOVE @NCDP     ZCDPO                           S01446
     C                     ELSE                                           S01446
     C                     MOVE *BLANK    ZCCYI                           S01446
     C                     MOVE *BLANK    ZCCYO                           S01446
     C                     MOVE *ZERO     ZEXCH                           S01446
     C                     MOVE *BLANK    ZMD                             S01446
     C                     MOVE *BLANK    ZCDPI                           S01446
     C                     MOVE *BLANK    ZCDPO                           S01446
     C                     END                                            S01446
     C                     END                                            S01446
      *                                                                   S01446
     C                     EXSR ZCCAL1                                    S01176
     C***********          MOVELVATI      @VL                             S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      **                                                              *   S01176
      *  SUB503 - Validate Tax and Rebate Amounts                     *   S01176
      *                                                               *   S01176
      *  Receives  : @XCODE - For Taxes = Counterparty Tax Code       *   S01176
      *                       For Rebates = Commission Code (BC or CC)*   S01176
      *              @XAMT  - The Charge Amount                       *   S01176
      *              @OV    - Charge Amount Override Indicator        *   S01176
      *              @XERR1 - Amount entered, but Code blank          *   S01176
      *              @XERR2 - Not valid signed amount (Can be zero)   *   S01176
      *              @I     - Indicator referring to the Charge Amount*   S01176
      *                                                               *   S01176
      *  Called By : SUB203                                           *   S01176
      *  Calls     : ZASIGN                                           *   S01176
      *              ZSEDIT                                           *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           SUB503    BEGSR                           *** SUB503  ***S01176
      *                                                                   S01176
      ***  If Code is blank, check that the Amount is blank.              S01176
      ***  If it has been overridden, then it is an error, else           S01176
      ***  just blank out the field                                       S01176
      *                                                                   S01176
     C           @XCODE    IFEQ *BLANKS                                   S01176
     C           @XAMT     ANDNE*BLANKS                                   S01176
      *                                                                   S01176
     C           @OV       IFEQ 'Y'                                       S01176
     C                     MOVE @XERR1    @EA,E                           S01176
     C                     ADD  1         E                               S01176
     C                     MOVE '1'       *IN,@I                          S01176
     C                     SETON                     11  14               S01176
     C                     ELSE                                           S01176
     C                     MOVE *BLANKS   @XAMT                           S01176
     C                     Z-ADD0         @XAMTN                          S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  If Amount has been overridden, check that it is valid          S01176
      *                                                                   S01176
     C           @XAMT     IFNE *BLANKS                                   S01176
     C           @OV       ANDEQ'Y'                                       S01176
      *                                                                   S01176
     C                     MOVE *BLANKS   ZFLD17                          S01176
     C                     MOVEL@XAMT     ZFLD17                          S01176
     C                     EXSR ZASIGN                                    S01176
      *                                                                   S01176
     C           *IN99     IFEQ '1'                                       S01176
     C                     MOVE @XERR2    @EA,E                           S01176
     C                     ADD  1         E                               S01176
     C                     MOVE '1'       *IN,@I                          S01176
     C                     SETON                     11  14               S01176
      *                                                                   S01176
      ***  ELSE, Amount is valid                                          S01176
     C                     ELSE                                           S01176
      *                                                                   S01176
     C                     MOVE ZOUT15    @XAMTN                          S01176
     C           ZFSIGN    IFEQ '-'                                       S01176
     C                     Z-SUB@XAMTN    @XAMTN                          S01176
     C                     END                                            S01176
      *                                                                   S01176
      ***  Format amount for display                                      S01176
      *                                                                   S01176
     C                     Z-ADD@XAMTN    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @XAMT                           S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     END                                            S01176
      *                                                                   S01176
     C                     ENDSR                                          S01176
      *                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      *                                                               *   S01176
      *  SUB504 - STORE SCREEN 2 FIELDS - BROKER CODE ONWARDS         *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
      *                                                                   S01176
     C           SUB504    BEGSR                                          S01176
     C*                                                                   S01176
     C                     MOVE @STBCA    @OTBCA                          S01176
     C                     MOVE @STCCA    @OTCCA                          S01176
     C                     MOVE @STBCC    @OTBCC                          S01176
     C                     MOVE @STCCC    @OTCCC  2                       S01176
     C                     MOVE @STCA1    @OTCA1                          S01176
     C                     MOVE @STCA2    @OTCA2                          S01176
     C                     MOVE @STCA3    @OTCA3                          S01176
     C                     MOVE @STCA4    @OTCA4                          S01176
     C                     MOVE @STCA5    @OTCA5                          S01176
     C                     MOVE @STCA6    @OTCA6                          S01176
     C                     MOVE @STCA7    @OTCA7                          S01176
     C                     MOVE @STCC1    @OTCC1  2                       S01176
     C                     MOVE @STCC2    @OTCC2  2                       S01176
     C                     MOVE @STCC3    @OTCC3  2                       S01176
     C                     MOVE @STCC4    @OTCC4  2                       S01176
     C                     MOVE @STCC5    @OTCC5  2                       S01176
     C                     MOVE @STCC6    @OTCC6  2                       S01176
     C                     MOVE @STCC7    @OTCC7  2                       S01176
     C                     MOVE @STAXA    @OTAXA                          S01176
     C                     MOVE @SBCMR    @OBCMR                          S01176
     C                     MOVE @SCCMR    @OCCMR                          S01176
     C                     MOVE @STXRB    @OTXRB                          S01176
     C                     ENDSR                                          S01176
     C*                                                                   S01176
      *****************************************************************   S01176
      /EJECT                                                              S01176
      *****************************************************************   S01176
      *  SUB503 - Calculate charge amounts                            *   S01176
      *                                                               *   S01176
      *    THIS SUBROUTINE HAS BEEN REPLACED BY SUBROUTINE ZCCAL1.    *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
     C***********SUB503    BEGSR                                          S01176
     C***********          ENDSR                           SUB503 ends    S01176
      *****************************************************************   S01176
      /SPACE 3                                                            S01176
      *****************************************************************   S01176
      *  SUB504 - Calculate tiered charge amounts                     *   S01176
      *                                                               *   S01176
      *    THIS SUBROUTINE HAS BEEN REPLACED BY SUBROUTINE ZCCAL2.    *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
     C***********SUB504    BEGSR                                          S01176
     C***********END504    ENDSR                           SUB504 ends    S01176
      *****************************************************************   S01176
      /SPACE 3                                                            S01176
      *****************************************************************   S01176
      *  SUB505 - Determine VAT charges                               *   S01176
      *                                                               *   S01176
      *    THIS SUBROUTINE HAS BEEN DELETED BECAUSE IT IS OBSOLETE.   *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
     C***********SUB505    BEGSR                                          S01176
     C***********          ENDSR                           SUB505 ends    S01176
      *****************************************************************   S01176
      /SPACE 3                                                            S01176
      *****************************************************************   S01176
      *  SUB506 - Calculate VAT charge amounts                        *   S01176
      *                                                               *   S01176
      *    THIS SUBROUTINE HAS BEEN DELETED BECAUSE IT IS OBSOLETE.   *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
     C***********SUB506    BEGSR                                          S01176
     C***********          ENDSR                           SUB506 ends    S01176
      *****************************************************************   S01176
      /SPACE 3                                                            S01176
      *****************************************************************   S01176
      *  SUB507 - Calculate tiered VAT amounts                        *   S01176
      *                                                               *   S01176
      *    THIS SUBROUTINE HAS BEEN DELETED BECAUSE IT IS OBSOLETE.   *   S01176
      *                                                               *   S01176
      *****************************************************************   S01176
     C***********SUB507    BEGSR                                          S01176
     C***********END507    ENDSR                           SUB507 ends    S01176
      *****************************************************************   S01176
      /EJECT
      *****************************************************************   065009
      *                                                               *   065009
      *  SUB508 - Calculate and format countervalue for screen output.*   065009
      *                                                               *   065009
      *****************************************************************   065009
      *                                                                   065009
     C           SUB508    BEGSR                                          065009
     C*                                                                   065009
     C** Calculate countervalue via standard subroutine ZCOTR.            065009
     C                     MOVE @WC1DI    BFCLAS                          065009
     C                     MOVE NMCYA     NMCY                            065009
     C                     Z-ADD@PNOML    NOML                            065009
     C                     Z-ADD@PITRA    ITRA                            065009
     C                     Z-ADD@PRALL    ZWRALL                          065009
     C                     MOVE @PTDTP    TDTP                            065009
     C           *IN43     IFEQ '1'                                       065009
     C                     Z-ADD@PPRIC    PRIC                            065009
     C                     ELSE                                           065009
     C                     Z-ADD@PTPDY    PRIC                            065009
     C                     END                                            065009
     C** Set up charge fields for ZCOTR.  Note: No need to change signs   065009
     C** back after calling ZCOTR, since TRADSD is not updated in SE3002. 065009
     C*                                                                   065009
     C*  Sign of commissions/charges depends on type of client and trade. 065009
     C           @ACODE    IFNE 'E'                                       065009
     C           @WC1DI    IFEQ 'M'                                       065009
     C           @STDTP    ANDEQ'TS'                                      065009
     C           @WC1DI    OREQ 'S'                                       065009
     C           @STDTP    ANDEQ'TP'                                      065009
     C           @WC1DI    OREQ 'D'                                       065009
     C           @STDTP    ANDEQ'TP'                                      065009
     C                     Z-SUB@PTBCA    TBCA                            065009
     C                     Z-SUB@PTCCA    TCCA                            065009
     C                     Z-SUB@PTCA1    TCA1                            065009
     C                     Z-SUB@PTCA2    TCA2                            065009
     C                     Z-SUB@PTCA3    TCA3                            065009
     C                     Z-SUB@PTCA4    TCA4                            065009
     C                     Z-SUB@PTCA5    TCA5                            065009
     C                     Z-SUB@PTCA6    TCA6                            065009
     C                     Z-SUB@PTCA7    TCA7                            065009
     C                     Z-SUB@PTAXA    TAXA                            065009
     C                     ELSE                                           065009
     C                     Z-ADD@PTBCA    TBCA                            065009
     C                     Z-ADD@PTCCA    TCCA                            065009
     C                     Z-ADD@PTCA1    TCA1                            065009
     C                     Z-ADD@PTCA2    TCA2                            065009
     C                     Z-ADD@PTCA3    TCA3                            065009
     C                     Z-ADD@PTCA4    TCA4                            065009
     C                     Z-ADD@PTCA5    TCA5                            065009
     C                     Z-ADD@PTCA6    TCA6                            065009
     C                     Z-ADD@PTCA7    TCA7                            065009
     C                     Z-ADD@PTAXA    TAXA                            065009
     C                     END                                            065009
     C** Calculate countervalue via standard SR/ZCOTR                     065009
     C                     Z-ADD@NCDP     ZCDP                            065009
     C                     EXSR ZCOTR                                     065009
      *                                                                   CAC002
      **  Margin points                                                   CAC002
      *                                                                   CAC002
     C                     Z-ADD0         @PFXMP                          CAC002
     C                     Z-ADD0         @PFXMR                          CAC002
     C                     Z-ADD0         @PMAMT                          CAC002
     C                     MOVE *BLANKS   SMAMT                           CAC002
     C                     MOVE *OFF      *IN34                           CAC002
      *                                                                   CAC002
      **  It should be 7 long with 2 decimals                             CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           NMCYA     ANDNE@SSETC                                    CAC002
     C           SFXMP     ANDNE*BLANKS                                   CAC002
      *                                                                   CAC002
     C                     MOVE *BLANKS   ZFIELD                          CAC002
     C                     MOVELSFXMP     ZFIELD                          CAC002
     C                     Z-ADD5         ZADIG                           CAC002
     C                     Z-ADD2         ZADEC                           CAC002
     C                     EXSR ZALIGN                                    CAC002
     C           *IN99     IFEQ '1'                                       CAC002
     C                     SETON                     1134                 CAC002
     C                     MOVEL' 624'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
     C                     ELSE                                           CAC002
     C                     MOVE ZFIELD    @PFXMP                          CAC002
     C                     EXSR ZEDIT                                     CAC002
     C                     MOVE ZFIELD    SFXMP                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  If FX Margin points is valid, check if equivalent exchange      CAC002
      **  rate is within the defined tolerance                            CAC002
      *                                                                   CAC002
     C           *IN34     IFEQ *OFF                                      CAC002
      *                                                                   CAC002
      **  Get Normally-Quoted Decimal Places                              CAC002
      *                                                                   CAC002
     C                     EXSR SRNQDP                                    CAC002
     C           ZNQDPX    ADD  1         ZA      10                      CAC002
      *                                                                   CAC002
      **  Compute the maximum margin points allowed                       CAC002
      **  Maximum Marg Pts = Xccy rate * Tolerance * 10**Quoted DP        CAC002
      *                                                                   CAC002
     C           FTTMRT    DIV  100       W1      32                      CAC002
     C           W1        MULT @PTDER    W2     138H                     CAC002
     C           W2        MULT AP,ZA     WMAXPT  72H                     CAC002
      *                                                                   CAC002
      **  If the entered margin points is greater than the maximum        CAC002
      **  allowed, display warning error code                             CAC002
      *                                                                   CAC002
     C           @PFXMP    IFGT WMAXPT                                    CAC002
     C                     MOVE ' W26'    @EA,E                           CAC002
     C                     ADD  1         E                               CAC002
     C                     SETON                     1134                 CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Calculate Margin rate and amount                                CAC002
      *                                                                   CAC002
     C           @PFXMP    DIV  AP,ZA     @PFXMR    H                     CAC002
      *                                                                   CAC002
     C           @STDTP    IFEQ 'TP'                                      CAC002
     C           @SSMDI    ANDEQ'M'                                       CAC002
     C           @STDTP    OREQ 'TS'                                      CAC002
     C           @SSMDI    ANDEQ'D'                                       CAC002
     C                     SUB  @PFXMR    @PTDER                          CAC002
     C                     ELSE                                           CAC002
     C                     ADD  @PFXMR    @PTDER                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     Z-ADDZCTRVL    ZAMTCI                          CAC002
     C                     MOVE @SSMDI    ZMD                             CAC002
     C                     MOVE NMCYA     ZCCYI                           CAC002
     C                     MOVE @SSETC    ZCCYO                           CAC002
     C                     MOVE @NCDP     ZCDPI                           CAC002
     C                     MOVE @SCDP     ZCDPO                           CAC002
      *                                                                   CAC002
     C                     Z-ADD@PTDER    ZEXCH                           CAC002
     C                     EXSR ZCONV                                     CAC002
     C                     Z-ADDZAMTCO    WCTRV1 150                      CAC002
      *                                                                   CAC002
     C           @STDTP    IFEQ 'TP'                                      CAC002
     C           @SSMDI    ANDEQ'M'                                       CAC002
     C           @STDTP    OREQ 'TS'                                      CAC002
     C           @SSMDI    ANDEQ'D'                                       CAC002
     C           @PTDER    ADD  @PFXMR    ZEXCH                           CAC002
     C                     ELSE                                           CAC002
     C           @PTDER    SUB  @PFXMR    ZEXCH                           CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     EXSR ZCONV                                     CAC002
     C                     Z-ADDZAMTCO    WCTRV2 150                      CAC002
      *                                                                   CAC002
     C           @STDTP    IFEQ 'TP'                                      CAC002
     C           WCTRV2    SUB  WCTRV1    @PMAMT                          CAC002
     C                     ELSE                                           CAC002
     C           WCTRV1    SUB  WCTRV2    @PMAMT                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **  Format Margin Amount                                            CAC002
      *                                                                   CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE @PMAMT    ZFLD15                          CAC002
     C                     Z-ADD@SCDP     ZDECS                           CAC002
     C                     MOVE 'J'       ZECODE                          CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE ZOUT20    SMAMT                           CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      ** If CSE023 is on, calculate withholding tax in Nominal CCY        187727
      *                                                                   187727
     C           CSE023    IFEQ 'Y'                                       187727
     C           WCTAX     ANDEQ'Y'                                       187727
      *                                                                   187727
     C                     MOVE WTDRBW    KTAXB                           187727
     C                     Z-ADD@PTDVD    KEFDT                           187727
     C           KTXBS     SETGT@TXBSL1                                   187727
     C                     READP@TXBSL1                  44               187727
      *                                                                   187727
     C           KCRTT     IFEQ TBCRTT                                    187727
     C           KTAXB     ANDEQTBTXBS                                    187727
      *                                                                   187727
     C           ZCTRVL    MULT TBTRAB    WTAX   150H                     187727
     C           WTAX      DIV  100       WTAX                            187727
     C           ZCTRVL    SUB  WTAX      ZCTRVL                          187727
     C                     Z-ADDWTAX      WHTX                            187727
     C                     Z-ADDWHTX      @PWHTX                          187727
     C                     MOVE 'Y'       @PBWDI                          187727
      *                                                                   187727
      ** Format Withholding Tax for Display                               187727
      *                                                                   187727
     C                     MOVE *BLANKS   ZFLD15                          187727
     C                     MOVE WHTX      ZFLD15                          187727
     C                     Z-ADD@NCDP     ZDECS                           187727
     C                     MOVE 'J'       ZECODE                          187727
     C                     EXSR ZSEDIT                                    187727
     C                     MOVE ZOUT21    @SWHTX                          187727
      *                                                                   187727
     C                     ELSE                                           187727
      *                                                                   187727
     C                     MOVELKCRTT     WKEY3   4                       187727
     C                     MOVE KTAXB     WKEY3                           187727
     C                     Z-ADD47        @DBASE                          187727
     C                     MOVEL'SDTXBSPD'@DBFIL                          187727
     C                     MOVELWKEY3     @DBKEY                          187727
     C                     EXSR *PSSR                                     187727
      *                                                                   187727
     C                     ENDIF                                          187727
     C                     ENDIF                                          187727
      *                                                                                       234440
      ** Subtract  EU Tax from countervalue                                                   234440
      *                                                                                       234440
     C                     SUB  @PEUTX    ZCTRVL                                              234440
      *                                                                   187727
     C** Convert to settlement currency, if necessary.                    065009
     C           @SSETC    IFEQ NMCYA                                     065009
     C                     MOVE ZCTRVL    ZFLD15                          065009
     C                     Z-ADD@NCDP     ZDECS                           065009
     C                     ELSE                                           065009
      ** find currency decimal places of settlment ccy if not already done065009
     C           @SCDP     IFEQ 0                                         065009
     C                     MOVE @SSETC    @AJCD                           065009
     C                     MOVE '*DBERR ' @RTCD                           065009
     C                     EXSR AOCURR                                    065009
     C                     Z-ADDA6NBDP    @SCDP                           065009
     C                     END                                            065009
     C                     Z-ADDZCTRVL    ZAMTCI                          065009
     C                     Z-ADD@PTDER    ZEXCH                           065009
     C                     MOVE @SSMDI    ZMD                             065009
     C                     MOVE NMCYA     ZCCYI                           065009
     C                     Z-ADD@NCDP     ZCDPI                           065009
     C                     MOVE @SSETC    ZCCYO                           065009
     C                     Z-ADD@SCDP     ZCDPO                           065009
     C                     EXSR ZCONV                                     065009
     C                     MOVE ZAMTCO    ZFLD15                          065009
     C                     Z-ADD@SCDP     ZDECS                           065009
     C                     END                                            065009
     C                     ELSE                                           065009
      ** find currency decimal places of settlment ccy                    065009
     C                     MOVEL@SSETC    @AJCD                           065009
     C                     MOVE '*DBERR ' @RTCD                           065009
     C                     EXSR AOCURR                                    065009
     C                     Z-ADDA6NBDP    ZDECS                           065009
     C                     Z-ADD@PTOSV    ZCTRVL                          065009
     C                     ADD  @PTVSN    ZCTRVL                          065009
     C                     ADD  @PTVSP    ZCTRVL                          065009
     C                     ADD  @PTDSN    ZCTRVL                          065009
     C                     ADD  @PTDSP    ZCTRVL                          065009
     C                     MOVE ZCTRVL    ZFLD15                          065009
     C                     END                                            065009
      *                                                                   CSE023
      ** Calculation of WHTX is being moved before Countervalue being     187727
      ** conversed into settlement ccy:                                   187727
      *                                                                   187727
      ***If*CSE023*is*on,*calculate*withholding*tax                CSE023 187727
      ***********                                                  CSE023 187727
     C***********CSE023    IFEQ 'Y'                                CSE023 187727
     C***********WCTAX     ANDEQ'Y'                                CSE023 187727
      ***********                                                  CSE023 187727
     C***********          MOVE ZFLD15    ZCTRVL                   CSE023 187727
     C***********          MOVE WTDRBW    KTAXB                    CSE023 187727
     C***********          Z-ADD@PTDVD    KEFDT                    CSE023 187727
     C***********KTXBS     SETGT@TXBSL1                            CSE023 187727
     C***********          READP@TXBSL1                  44        CSE023 187727
      ***********                                                  CSE023 187727
     C***********KCRTT     IFEQ TBCRTT                             CSE023 187727
     C***********KTAXB     ANDEQTBTXBS                             CSE023 187727
      ***********                                                  CSE023 187727
     C***********ZCTRVL    MULT TBTRAB    WTAX   150H              CSE023 187727
     C***********WTAX      DIV  100       WTAX                     CSE023 187727
     C***********ZCTRVL    SUB  WTAX      ZCTRVL                   CSE023 187727
     C***********          Z-ADDWTAX      WHTX                     CSE023 187727
      ***********                                                  CSE023 187727
      ***Format*Withholding*Tax*for*Display                        CSE023 187727
      ***********                                                  CSE023 187727
     C***********          MOVE *BLANKS   ZFLD15                   CSE023 187727
     C***********          MOVE WHTX      ZFLD15                   CSE023 187727
     C***********          MOVE 'J'       ZECODE                   CSE023 187727
     C***********          EXSR ZSEDIT                             CSE023 187727
     C***********          MOVE ZOUT21    @SWHTX                   CSE023 187727
      ***********                                                  CSE023 187727
     C***********          MOVE *BLANKS   ZFLD15                   CSE023 187727
     C***********          MOVE ZCTRVL    ZFLD15                   CSE023 187727
      ***********                                                  CSE023 187727
     C***********          ELSE                                    CSE023 187727
      ***********                                                  CSE023 187727
     C***********          MOVELKCRTT     WKEY3   4                CSE023 187727
     C***********          MOVE KTAXB     WKEY3                    CSE023 187727
     C***********          Z-ADD47        @DBASE                   CSE023 187727
     C***********          MOVEL'SDTXBSPD'@DBFIL                   CSE023 187727
     C***********          MOVELWKEY3     @DBKEY                   CSE023 187727
     C***********          EXSR *PSSR                              CSE023 187727
      ***********                                                  CSE023 187727
     C***********          ENDIF                                   CSE023 187727
     C***********          ENDIF                                   CSE023 187727
     C** Format for output.                                               065009
     C                     MOVE 'J'       ZECODE                          065009
     C                     EXSR ZSEDIT                                    065009
     C                     MOVE ZOUT21    @STCTR                          065009
     C                     MOVE 'L'       ZECODE                          065009
     C*                                                                   065009
     C                     ENDSR                           SUB508 Ends    065009
      *                                                                   065009
      *****************************************************************   065009
      /EJECT                                                              065019
      *****************************************************************   065019
      *                                                               *   065019
      *  SUB509 - Determine Ex-Dividend Indicator default.            *   065019
      *                                                               *   065019
      *****************************************************************   065019
      *                                                                   065019
     C           SUB509    BEGSR                                          065019
     C*                                                                   065019
     C                     MOVEL'C'       @PEXDV                          065019
     C*                                                                   065019
     C* Must access diary events via ZNDD, then use ex-date from diary.   065019
     C                     Z-ADD@PTDDT    ECD                             065019
     C                     EXSR ZNDD                                      065019
     C*                                                                   065019
     C           NDD       IFNE *ZEROS                                    065019
     C                     Z-ADD0         ZDYNBR                          065019
     C*                                                                   S01510
     C           S01510    IFEQ 'Y'                                       S01510
     C* If diary event found, use ex-date from it.                        S01510
     C           *IN99     IFEQ '0'                                       S01510
     C           SDSN      ANDEQSESN                                      S01510
     C                     Z-ADDSDXD      ZDYNBR                          S01510
     C                     ELSE                                           S01510
     C* Calculate ex-date using default days from security.               S01510
     C                     MOVELEDFT      ZNRDYS                          S01510
     C           ZNRDYS    IFNE *ZEROS                                    S01510
     C                     MOVE EDFT      @WEDFT  1                       S01510
     C           @WEDFT    IFEQ 'W'                                       S01510
     C                     Z-ADDNDD       ZDAYNO                          S01510
     C                     MOVE VLCY      ZCCY                            S01510
     C                     MOVE *BLANKS   ZLOC                            S01510
     C                     EXSR ZBKDT                                     S01510
     C                     ELSE                                           S01510
     C           NDD       SUB  ZNRDYS    ZDYNBR                          S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C*                                                                   S01510
     C                     ELSE                                           S01510
     C* Calculate ex-date using default days from security.               065019
     C                     MOVELEDFT      ZNRDYS                          065019
     C           ZNRDYS    IFNE *ZEROS                                    065019
     C                     MOVE EDFT      @WEDFT  1                       065019
     C           @WEDFT    IFEQ 'W'                                       065019
     C                     Z-ADDNDD       ZDAYNO                          065019
     C                     MOVE NMCYA     ZCCY                            065019
     C                     MOVE *BLANKS   ZLOC                            065019
     C                     EXSR ZBKDT                                     065019
     C                     ELSE                                           065019
     C           NDD       SUB  ZNRDYS    ZDYNBR                          065019
     C                     END                                            065019
     C                     END                                            065019
     C                     END                                            S01510
     C*                                                                   S01510
     C* Note: Swiss dividends are based on TRADE DATE positions.          065019
     C           @PTDDT    IFLT NDD                                       065019
     C           @PTDDT    ANDGEZDYNBR                                    065019
     C           ZDYNBR    ANDNE0                                         065019
     C                     MOVEL'X'       @PEXDV                          065019
     C                     END                                            065019
      *                                                                   065019
     C                     END                                            065019
      *                                                                   065019
     C                     ENDSR                           SUB509 Ends    065019
      *                                                                   065019
      *****************************************************************   065019
      /EJECT                                                              065019
     C***/COPY*ZSRSRC,ZSETAC****                                   081490 099817
     C/EJECT                                                              081490
      *****************************************************************
      ***SUB999*-*Error*handling***************************************   S01117
      *  *PSSR  - Error handling                                      *   S01117
      *****************************************************************
     C***********SUB999    BEGSR                                          S01117
     C           *PSSR     BEGSR                                          S01117
      *
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP
     C           @DBASE    IFNE 0                                         S01117
     C                     MOVEL@DBALL    @DBSAV
     C           *LOCK     IN   LDA
     C                     MOVEL@DBSAV    @DBALL
     C                     MOVEL'SE3002'  @DBPGM
     C                     OUT  LDA
     C                     SETON                     U7U8LR
     C                     MOVEL'*'       @ACODE
     C                     END                                            S01117
     C                     END                                            S01117
     C                     RETRN
      *
     C***********          ENDSR                           SUB999 ends    S01117
     C                     ENDSR                                          S01117
      *
      *****************************************************************
     C*                                                                   S01117
     C* D1QRY  - Subroutine to process input of ? on 1ST screen           S01117
     C*                                                                   S01117
     C           D1QRY     BEGSR                           ** D1QRY  **   S01117
     C*                                                                   S01117
     C*  Book Code                                                        S01117
     C                     MOVEL@SBPBK    @QRY    1                       S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVE @SBPBK    @AJCD                           S01117
     C                     EXSR AOBOOK                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SBPBK                          S01117
     C                     ELSE                                           S01117
     C                     MOVE BDBKCD    @SBPBK                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  Settlement currency                                              S01117
     C                     MOVEL@SSETC    @QRY    1                       S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVE @SSETC    @AJCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SSETC                          S01117
     C                     ELSE                                           S01117
     C                     MOVE A6CYCD    @SSETC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  Trade Sub-Type                                                   S01117
     C                     MOVEL@STSUB    @QRY                            S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     EXSR AODLST                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @STSUB                          S01117
     C                     ELSE                                           S01117
     C                     MOVE ASDSTC    @STSUB                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
      *                                                                   CAC002
      **  Analytical Accounting module is installed...                    CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC002
      **  Book Profit Centre                                              CAC002
     C                     MOVELSBPRC     @QRY                            CAC002
     C           @QRY      IFEQ '?'                                       CAC002
     C                     MOVE 'Y'       RDSPLY                          CAC002
     C                     MOVELSBPRC     @SPRFC                          CAC002
     C                     EXSR AOPRFC                                    CAC002
     C           @RTCD     IFEQ '*NOSEL '                                 CAC002
     C                     MOVE *BLANKS   SBPRC                           CAC002
     C                     ELSE                                           CAC002
     C                     MOVE DSPCCD    SBPRC                           CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
      **   Transaction Profit Centre                                      CAC002
     C                     MOVELSTPRC     @QRY                            CAC002
     C           @QRY      IFEQ '?'                                       CAC002
     C                     MOVE 'Y'       RDSPLY                          CAC002
     C                     MOVELSTPRC     @SPRFC                          CAC002
     C                     EXSR AOPRFC                                    CAC002
     C           @RTCD     IFEQ '*NOSEL '                                 CAC002
     C                     MOVE *BLANKS   STPRC                           CAC002
     C                     ELSE                                           CAC002
     C                     MOVE DSPCCD    STPRC                           CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* D2QRY  - Subroutine to process input of ? on 2ND screen           S01117
     C*                                                                   S01117
     C           D2QRY     BEGSR                           ** D2QRY  **   S01117
     C*                                                                   S01117
     C*  Originating Branch                                               S01117
     C                     MOVEL@SORBR    @QRY    1                       S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVE @SORBR    @DSNB                           S01117
     C                     EXSR AOBRCH                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SORBR                          S01117
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    @SORBR                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  Profit Centre                                                    S01117
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C                     MOVEL@SPRFC    @QRY                            S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     EXSR AOPRFC                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SPRFC                          S01117
     C                     ELSE                                           S01117
     C                     MOVE DSPCCD    @SPRFC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     ENDIF                                          CAC002
     C*  Pay From                                                         S01117
     C                     MOVEL@SPYFM    @QRY    1                       S01117
     C           @QRY      IFEQ '?'                                       S01117
     C*                                                                   S01117
     C           @STDTP    IFEQ 'TP'                                      S01117
     C           @SSMTH    IFEQ '01'                                      S01117
     C           @SSMTH    OREQ '02'                                      S01117
     C           @SSMTH    OREQ '07'                                      S01117
     C           @SSMTH    OREQ '08'                                      S01117
     C           @SSMTH    OREQ '12'                                      S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@SPYFM    P@NONB                          S01117
     C                     MOVEL@SSETC    P@CYCD                          S01117
     C                     EXSR AONOST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE *BLANKS   @SPYFM                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SPYFM                          S01117
     C                     MOVELA7NONB    @SPYFM                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C           @SSMTH    IFEQ '15'                                      S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@SPYFM    @WCSNM                          S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SPYFM                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SPYFM                          S01117
     C                     MOVELBBCUST    @SPYFM                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @STDTP    IFEQ 'TS'                                      S01117
     C           @SSMTH    IFEQ '01'                                      S01117
     C           @SSMTH    OREQ '07'                                      S01117
     C           @SSMTH    OREQ '08'                                      S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@SPYFM    @WCSNM                          S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SPYFM                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SPYFM                          S01117
     C                     MOVELBBCUST    @SPYFM                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*  Pay From Branch                                                  S01117
     C                     MOVEL@SPYFB    @QRY    1                       S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVE @SPYFB    @DSNB                           S01117
     C                     EXSR AOBRCH                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SPYFB                          S01117
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    @SPYFB                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*  Pay To                                                           S01117
     C                     MOVEL@SPAYT    @QRY    1                       S01117
     C           @QRY      IFEQ '?'                                       S01117
     C*                                                                   S01117
     C           @STDTP    IFEQ 'TS'                                      S01117
     C           @SSMTH    IFEQ '01'                                      S01117
     C           @SSMTH    OREQ '02'                                      S01117
     C           @SSMTH    OREQ '07'                                      S01117
     C           @SSMTH    OREQ '08'                                      S01117
     C           @SSMTH    OREQ '12'                                      S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@SPAYT    P@NONB                          S01117
     C                     MOVEL@SSETC    P@CYCD                          S01117
     C                     EXSR AONOST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE *BLANKS   @SPAYT                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SPAYT                          S01117
     C                     MOVELA7NONB    @SPAYT                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C           @SSMTH    IFEQ '15'                                      S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@SPAYT    @WCSNM                          S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SPAYT                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SPAYT                          S01117
     C                     MOVELBBCUST    @SPAYT                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           @STDTP    IFEQ 'TP'                                      S01117
     C           @SSMTH    IFEQ '01'                                      S01117
     C           @SSMTH    OREQ '07'                                      S01117
     C           @SSMTH    OREQ '08'                                      S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@SPAYT    @WCSNM                          S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SPAYT                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SPAYT                          S01117
     C                     MOVELBBCUST    @SPAYT                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*  Pay To Branch                                                    S01117
     C                     MOVEL@SPYTB    @QRY    1                       S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVE @SPYTB    @DSNB                           S01117
     C                     EXSR AOBRCH                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SPYTB                          S01117
     C                     ELSE                                           S01117
     C                     MOVE A8BRCD    @SPYTB                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  Pay For A/C Of                                                   S01117
     C                     MOVEL@STFA1    @QRY    1                       S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@STFA1    @WCSNM                          S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @STFA1                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @STFA1                          S01117
     C                     MOVELBBCUST    @STFA1                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  Deliver From                                                     S01117
     C                     MOVEL@SDELF    @QRY                            S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@SDELF    @WCUST                          S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SDELF                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SDELF                          S01117
     C                     MOVELBFCUST    @SDELF                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  Deliver To                                                       S01117
     C                     MOVEL@SDELT    @QRY                            S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@SDELT    @WCUST                          S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SDELT                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SDELT                          S01117
     C                     MOVELBFCUST    @SDELT                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  Deliver From - For A/C Of                                        S01117
     C                     MOVEL@SDFFA    @QRY                            S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@SDFFA    @WCUST                          S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @SDFFA                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @SDFFA                          S01117
     C                     MOVELBFCUST    @SDFFA                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  Deliver To - For A/C Of                                          S01117
     C                     MOVEL@STFA2    @QRY                            S01117
     C           @QRY      IFEQ '?'                                       S01117
     C                     MOVE 'Y'       RDSPLY                          S01117
     C                     MOVEL@STFA2    @WCUST                          S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE *BLANKS   @STFA2                          S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   @STFA2                          S01117
     C                     MOVELBFCUST    @STFA2                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*  IN Currency in field 72.                                         CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C                     MOVEL@SICCY    @QRY                            CEU005
     C           @QRY      IFEQ '?'                                       CEU005
     C                     MOVE 'Y'       RDSPLY                          CEU005
     C                     MOVEL@SICCY    @AJCD                           CEU005
     C                     MOVE *BLANKS   @RTCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
      *                                                                   CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C           @RTCD     ANDNE'*NOSEL '                  ***************CEU005
     C                     MOVEL'SDCURRPD'DBFILE           *             *CEU005
     C                     MOVEL'038'     DBASE            * DBERROR 038 *CEU005
     C                     MOVEL@SICCY    DBKEY            *             *CEU005
     C                     EXSR *PSSR                      ***************CEU005
     C                     ELSE                                           CEU005
     C           @RTCD     IFEQ '*NOSEL '                                 CEU005
     C                     MOVE *BLANKS   @SICCY                          CEU005
     C                     ELSE                                           CEU005
     C                     MOVE *BLANKS   @SICCY                          CEU005
     C                     MOVELA6CYCD    @SICCY                          CEU005
     C                     END                                            CEU005
     C                     END                                            CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
     C*                                                                   S01117
     C* AOBANK - Subroutine to call access object : Bank details          S01117
     C*                                                                   S01117
     C           AOBANK    BEGSR                           ** AOBANK **   S01117
     C*                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOBOOK - Subroutine to call access object : Book details          S01117
     C*                                                                   S01117
     C           AOBOOK    BEGSR                           ** AOBOOK **   S01117
     C*                                                                   S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @SBPBK                          S01117
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOBRCH - Subroutine to call access object : Branch details        S01117
     C*                                                                   S01117
     C           AOBRCH    BEGSR                           ** AOBRCH **   S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOCNST - Subroutine to call access object : Counterparty Nostros  S01117
     C*                                                                   S01117
     C           AOCNST    BEGSR                           ** AOCNST **   S01117
     C*                                                                   S01117
     C                     CALL 'AOCNSTR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @CPNC   8                       S01117
     C           SDCNST    PARM SDCNST    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOCURR - Subroutine to call access object : Currency details      S01117
     C*                                                                   S01117
     C           AOCURR    BEGSR                           ** AOCURR **   S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOCUST - Subroutine to call access object : Customer details      S01117
     C*                                                                   S01117
     C           AOCUST    BEGSR                           ** AOCUST **   S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   PCSNM  10                                           CGL029
     C                     MOVEL@WCSNM    PCSNM                                               CGL029
      *                                                                                       CGL029
     C**********           CALL 'AOCUSTR0'                         S01117 CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C**********           PARM           @WCSNM                                       S01117 CGL029
     C                     PARM           PCSNM                                               CGL029
     C                     PARM           @KYST   7                       S01117
     C********** SDCUST    PARM SDCUST    DSSDY                    S01117 CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AODLST - Subroutine to call access object : Trade sub-types       S01117
     C*                                                                   S01117
     C           AODLST    BEGSR                           ** AODLST **   S01117
     C*                                                                   S01117
     C                     CALL 'AODLSTR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM @STSUB    @DSNB   3                       S01117
     C           SDDLST    PARM SDDLST    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOGELR - Subroutine to call access object : General Ledger        S01117
     C*                                                                   S01117
     C           AOGELR    BEGSR                           ** AOGELR **   S01117
     C*                                                                   S01117
     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AONOST - SUBROUTINE TO CALL ACCESS OBJECT : NOSTRO DETAILS        S01117
     C*                                                                   S01117
     C           AONOST    BEGSR                           ** AONOST **   S01117
     C*                                                                   S01117
     C                     CALL 'AONOSTR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM *BLANKS   P@CUST  6          Customer No  S01117
     C                     PARM           P@CYCD  3          Currency     S01117
     C**********           PARM *BLANKS   P@ACCD  4          A/c Code                  S01117 CGL029
     C                     PARM *BLANKS   P@ACCD 10                                           CGL029
     C                     PARM *BLANKS   P@ACSN  2          A/c Seq      S01117
     C                     PARM           P@NONB  2          Nostro No    S01117
     C                     PARM *BLANKS   P@BRCD  3          Branch Code  S01117
     C                     PARM *BLANKS   P@CSSN 10          Cust ShortN  S01117
     C                     PARM *BLANKS   P@PNOI  1          Prime Nost InS01117
     C           SDNOST    PARM SDNOST    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C/EJECT                                                              CAC002
     C*****************************************************************   CAC002
     C*                                                               *   CAC002
     C*  Subroutine  :  AOPCAC                                        *   CAC002
     C*  Function    :  Access Profit Centre Accounting ICD           *   CAC002
     C*                                                               *   CAC002
     C*  Called by   :  Main Processing                               *   CAC002
     C*  Calls       :  AOPCACR0 - PCA ICD Access Object              *   CAC002
     C*                                                               *   CAC002
     C*****************************************************************   CAC002
     C*                                                                   CAC002
     C           AOPCAC    BEGSR                           ** AOPCAC **   CAC002
     C*                                                                   CAC002
     C                     CALL 'AOPCACR0'                                CAC002
     C                     PARM '*DBERR ' @RTCD                           CAC002
     C                     PARM '*FIRST ' @OPTN                           CAC002
     C           SDPCAC    PARM SDPCAC    DSFDY                           CAC002
     C*                                                                   CAC002
     C           AOPCA9    ENDSR                           ** AOPCA9 **   CAC002
     C*                                                                   CAC002
     C*****************************************************************   CAC002
     C/EJECT                                                              CAC002
     C*****************************************************************   CAC002
     C*                                                                   S01117
     C* AOPRFC - SUBROUTINE TO CALL ACCESS OBJECT : PROFIT CENTRE         S01117
     C*                                                                   S01117
     C           AOPRFC    BEGSR                           ** AOPRFC **   S01117
     C*                                                                   S01117
     C                     CALL 'AOPRFCR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM @SPRFC    @PCCD   4                       S01117
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOPRFM - SUBROUTINE TO CALL ACCESS OBJECT : DEFAULT PROFIT CENTRE S01117
     C*                                                                   S01117
     C           AOPRFM    BEGSR                           ** AOPRFM **   S01117
     C*                                                                   S01117
     C*  To get the Account officer for the customer to pass to the       179732
     C*  Access Object.                                                   179732
     C                     MOVEL@CUST     @PLKY                           179732
     C                     CALL 'AOCUSTR1'                                179732
     C                     PARM *BLANKS   @RTCD                           179732
     C                     PARM '*KEY   ' @OPTN                           179732
     C                     PARM           @PLKY  10                       179732
     C                     PARM           WKEY7   7                       179732
     C           SDCUST    PARM SDCUST    DSLDY                           179732
     C*                                                                   179732
     C                     MOVELBBACOC    @ACOC                           179732
      *                                                                   179732
     C******************** CALL 'AOPRFMR0'                         S01117 179732
     C******************** PARM *BLANKS   #RTCD   1                S01117 179732
     C******************** PARM @SBPBK    @BKCD   2                S01117 179732
     C******************** PARM           @TRTY   5                S01117 179732
     C******************** PARM @STSUB    @SBTY   2                S01117 179732
     C******************** PARM @SBRCD    @BRCD   3                S01117 179732
     C******************** PARM *BLANKS   @DPCD   3                S01117 179732
     C******************** PARM USRID     @USID  10                S01117 179732
     C******************** PARM *BLANKS   @ACOC   2                S01117 179732
     C******************** PARM           @CUST   6                S01117 179732
     C******************** PARM           @PRFC   4                S01117 179732
     C*                                                            S01117 179732
     C                     CALL 'AOPRFMR0'                                179732
     C                     PARM *BLANKS   #RTCD   1                       179732
     C                     PARM @PTDBK    @BKCD   2                       179732
     C                     PARM           @TRTY   5                       179732
     C                     PARM @PTSUB    @SBTY   2                       179732
     C                     PARM @PTDBA    @BRCD   3                       179732
     C                     PARM *BLANKS   @DPCD   3                       179732
     C                     PARM USRID     @USID  10                       179732
     C                     PARM           @ACOC   2                       179732
     C                     PARM           @CUST   6                       179732
     C                     PARM           @PRFC   4                       179732
     C*                                                                   179732
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AORETL - Subroutine to call access object : Retail ICD            S01117
     C*                                                                   S01117
     C           AORETL    BEGSR                           ** AORETL **   S01117
     C*                                                                   S01117
     C                     CALL 'AORETLR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDRETL    PARM SDRETL    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOSECS - Subroutine to call access object : Security customers    S01117
     C*                                                                   S01117
     C           AOSECS    BEGSR                           ** AOSECS **   S01117
     C*                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM @WCUST    @SCKY   6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOSTRD - Subroutine to call access object : Securities Trading    S01117
     C*                                                                   S01117
     C           AOSTRD    BEGSR                           ** AOSTRD **   S01117
     C*                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOTRAD - Subroutine to call access object : Trading ICD           S01117
     C*                                                                   S01117
     C           AOTRAD    BEGSR                           ** AOTRAD **   S01117
     C*                                                                   S01117
     C                     CALL 'AOTRADR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C/EJECT                                                              CAC002
      *****************************************************************   CAC002
      *                                                               *   CAC002
      *  Subroutine  :  SRNQDP                                        *   CAC002
      *  Function    :  Get Normally-Quoted Decimal Places            *   CAC002
      *                                                               *   CAC002
      *  Called by   :  SUB203 - Validate Screen 2                    *   CAC002
      *  Calls       :  -                                             *   CAC002
      *                                                               *   CAC002
      *****************************************************************   CAC002
      *                                                                   CAC002
     C           SRNQDP    BEGSR                           ** SRNQDP **   CAC002
      *                                                                   CAC002
      ** --------------------------------------------------------------   CAC002
      **  If either the nominal or settlement currency is the base        CAC002
      **  currency obtain the number of normally-quoted decimal places    CAC002
      **  for the other currency. Otherwise:                              CAC002
      **      A)  If ZNQDP1 =  ZNQDP2 =  5       :   ZNQDPX = 5           CAC002
      **      B)  If ZNQDP1 =  ZNQDP2 <> 5  or                            CAC002
      **             ZNQDP1 <> ZNQDP2                                     CAC002
      **             1)  If Rate >= 100          :   ZNQDPX = 2           CAC002
      **             2)  If 100 > Rate >= 20     :   ZNQDPX = 3           CAC002
      **             3)  If 20  > Rate >= 1      :   ZNQDPX = 4           CAC002
      **             4)  If 1   > Rate           :   ZNQDPX = 5           CAC002
      **---------------------------------------------------------------   CAC002
      *                                                                   CAC002
     C                     SELEC                                          CAC002
      *                                                                   CAC002
     C           NMCYA     WHEQ BJCYCD                                    CAC002
     C                     Z-ADDZNQDP2    ZNQDPX                          CAC002
      *                                                                   CAC002
     C           @SSETC    WHEQ BJCYCD                                    CAC002
     C                     Z-ADDZNQDP1    ZNQDPX                          CAC002
      *                                                                   CAC002
     C           ZNQDP1    WHEQ ZNQDP2                                    CAC002
     C           ZNQDP1    ANDEQ5                                         CAC002
     C                     Z-ADD5         ZNQDPX                          CAC002
      *                                                                   CAC002
     C           @PTDER    WHEQ 100                                       CAC002
     C                     Z-ADD2         ZNQDPX                          CAC002
      *                                                                   CAC002
     C           @PTDER    WHLT 100                                       CAC002
     C           @PTDER    ANDGE20                                        CAC002
     C                     Z-ADD3         ZNQDPX                          CAC002
      *                                                                   CAC002
     C           @PTDER    WHLT 20                                        CAC002
     C           @PTDER    ANDGE1                                         CAC002
     C                     Z-ADD4         ZNQDPX                          CAC002
      *                                                                   CAC002
     C           @PTDER    WHLT 1                                         CAC002
     C                     Z-ADD5         ZNQDPX                          CAC002
      *                                                                   CAC002
     C                     ENDSL                                          CAC002
      *                                                                   CAC002
     C           SRNQD9    ENDSR                           ** SRNQD9 **   CAC002
      *                                                                   CAC002
      *****************************************************************   CAC002
      /EJECT                                                                                  233607
      *****************************************************************                       233607
      *                                                               *                       233607
      *  SRSSEC - Save Security details.                              *                       233607
      *                                                               *                       233607
      *****************************************************************                       233607
     C           SRSSEC    BEGSR                                                              233607
      *                                                                                       233607
     C                     MOVE RECI      RECIA                                               233607
     C                     MOVE CHTP      CHTPA                                               233607
     C                     MOVE LCD       LCDTA                                               233607
     C                     MOVE TNLU      TNLUA                                               233607
     C                     MOVE REPI      REPIA                                               233607
     C                     MOVE REPA      REPAA                                               233607
     C                     MOVE FRNT      FRNTA                                               233607
     C                     MOVE TMST      TMSTA                                               233607
     C                     MOVE CD01      CD01A                                               233607
     C                     MOVE CD02      CD02A                                               233607
     C                     MOVE CD03      CD03A                                               233607
     C                     MOVE CD04      CD04A                                               233607
     C                     MOVE CD05      CD05A                                               233607
     C                     MOVE CD06      CD06A                                               233607
     C                     MOVE CD07      CD07A                                               233607
     C                     MOVE CD08      CD08A                                               233607
     C                     MOVE CD09      CD09A                                               233607
     C                     MOVE CD10      CD10A                                               233607
     C                     MOVE CD11      CD11A                                               233607
     C                     MOVE CD12      CD12A                                               233607
     C                     MOVE CR01      CR01A                                               233607
     C                     MOVE CR02      CR02A                                               233607
     C                     MOVE CR03      CR03A                                               233607
     C                     MOVE CR04      CR04A                                               233607
     C                     MOVE CR05      CR05A                                               233607
     C                     MOVE CR06      CR06A                                               233607
     C                     MOVE CR07      CR07A                                               233607
     C                     MOVE CR08      CR08A                                               233607
     C                     MOVE CR09      CR09A                                               233607
     C                     MOVE CR10      CR10A                                               233607
     C                     MOVE CR11      CR11A                                               233607
     C                     MOVE CR12      CR12A                                               233607
      *                                                                                       233607
     C                     MOVEL@SECTY    @PSECT                                              233607
      *                                                                                       233607
     C                     ENDSR                                                              233607
      *****************************************************************                       233607
      /EJECT                                                                                  233607
      *****************************************************************                       233607
      *                                                               *                       233607
      *  SRSINV - Save Investment Type details.                       *                       233607
      *                                                               *                       233607
      *****************************************************************                       233607
     C           SRSINV    BEGSR                                                              233607
      *                                                                                       233607
     C                     MOVE RECI      RECIB                                               233607
     C                     MOVE LCD       LCDTB                                               233607
     C                     MOVE CHTP      CHTPB                                               233607
     C                     MOVE TNLU      TNLUB                                               233607
      *                                                                                       233607
     C                     MOVEL@INVTP    @PINVT                                              233607
      *                                                                                       233607
     C                     ENDSR                                                              233607
      *****************************************************************                       233607
      /EJECT                                                                                  233607
      *****************************************************************                       233607
      *                                                               *                       233607
      *  SRVFSP - Validate Fiscal Price.                              *                       233607
      *                                                               *                       233607
      *****************************************************************                       233607
     C           SRVFSP    BEGSR                                                              233607
      *                                                                                       233607
      ** Clear error and warning arrays.                                                      233607
      *                                                                                       233607
     C                     CLEAR@FNXA                                                         233607
     C                     CLEAR@MIXA                                                         233607
     C                     CLEAR@MDXA                                                         233607
     C                     CLEAR@WFNXA                                                        233607
     C                     CLEAR@WMIXA                                                        233607
     C                     CLEAR@WMDXA                                                        233607
      *                                                                                       233607
      ** Set customer classification.                                                         233607
      *                                                                                       233607
     C*********            MOVE @WC1DI    CUSTC                                        233607 234440
     C                     MOVE @WC1DI    WCUSCL                                              234440
      *                                                                                       233607
      ** Save input Fiscal Price.                                                             233607
      *                                                                                       233607
     C                     MOVE @SFSPR    WSFSPR 16                                           233607
      *                                                                                       233607
      ** Validate Fiscal Price via SEVSEFSPR2.                                                233607
      *                                                                                       233607
     C                     CALL SEVFSP                                                        233607
      *                                                                                       233607
      ** INPUTS                                                                               233607
      *                                                                                       233607
      ** Return Code                                                                          233607
     C                     PARM *BLANKS   PRETC  10                                           233607
      ** Default & Validate (Y or N)                                                          233607
     C                     PARM 'Y'       PDFLT   1                                           233607
     C                     PARM 'Y'       PVLDT   1                                           233607
      ** Fiscal Price                                                                         233607
     C                     PARM           @SFSPR                                              233607
      ** Trade Date                                                                           233607
     C************         PARM           @PTDDT                                       233607 234440
     C                     PARM           @PTDVD                                              234440
      ** Security Details                                                                     233607
     C                     PARM           @PSECT                                              233607
      ** Investment Type Details                                                              233607
     C                     PARM           @PINVT                                              233607
      ** Customer (Counterparty) Details                                                      233607
     C**********           PARM           @PCUST                                       233607 234967
     C                     PARM           @CUSDT                                              234967
      ** Date Format Indicator                                                                233607
     C                     PARM           BJDFIN                                              233607
      ** Branch                                                                               233607
     C                     PARM           @PTDBA                                              233607
      ** Current File Trade Date                                                              235547
     C                     PARM           C@TDVD                                              235547
      *                                                                                       233607
      ** OUTPUTS                                                                              233607
      *                                                                                       233607
      ** Error Fields/Message IDs/Message Data (arrays) From/To Caller                        233607
     C                     PARM           @FNXA                                               233607
     C                     PARM           @MIXA                                               233607
     C                     PARM           @MDXA                                               233607
      ** Warning Fields/Message IDs/Message Data (arrays) From/To Caller                      233607
     C                     PARM           @WFNXA                                              233607
     C                     PARM           @WMIXA                                              233607
     C                     PARM           @WMDXA                                              233607
      ** Price OK Indicator (1A)                                                              233607
      ** Price (15P 8)                                                                        233607
     C                     PARM 'Y'       DDFPOK  1                                           233607
     C                     PARM *ZERO     @PFSPR                                              233607
     C                     PARM *ZERO     @PFSPP                                              233607
      *                                                                                       233607
      ** Set error code if error is encountered upon validation.                              233607
      *                                                                                       233607
     C           DDFPOK    IFEQ 'Y'                                                           233607
      *                                                                                       233607
     C           @PFSPR    IFNE *ZERO                                                         233607
     C                     Z-ADD*ZERO     ZFLD15                                              233607
     C                     MOVE @PFSPR    ZFLD15                                              233607
     C                     Z-ADD8         ZDECS                                               233607
     C                     EXSR ZSEDIT                                                        233607
     C                     MOVE ZOUT20    @SFSPR                                              233607
     C                     ELSE                                                               233607
     C                     MOVE *BLANKS   @SFSPR                                              233607
     C                     ENDIF                                                              233607
      *                                                                                       233607
     C                     ELSE                                                               233607
      *                                                                                       233607
     C           @MIXA,1   IFNE *BLANKS                                                       234635
     C                     MOVE *ON       *IN11                                               233607
     C                     MOVE *ON       *IN71                                               233607
     C                     Z-ADD1         J       20                                          233607
     C                     MOVE WSFSPR    @SFSPR                                              233607
      *                                                                                       233607
     C           @MIXA,J   DOWNE*BLANKS                                                       233607
      *                                                                                       233607
     C                     SELEC                                                              233607
      *                                                                                       233607
      ** Field must be blank for non-discretionary and non-safe custody customers.            233607
      *                                                                                       233607
     C           @MIXA,J   WHEQ 'SEA0912'                                                     233607
     C                     MOVE ' 801'    @EA,E                                               233607
     C                     ADD  1         E                                                   233607
      *                                                                                       233607
      ** Fiscal Price can only be entered for Bonds and Funds only.                           233607
      *                                                                                       233607
     C           @MIXA,J   WHEQ 'SEA0911'                                                     233607
     C                     MOVE ' 802'    @EA,E                                               233607
     C                     ADD  1         E                                                   233607
      *                                                                                       233607
      ** The Price entry is not a valid amount.                                               233607
      *                                                                                       233607
     C           @MIXA,J   WHEQ 'MMA0354'                                                     233607
     C                     MOVE ' 803'    @EA,E                                               233607
     C                     ADD  1         E                                                   233607
      *                                                                                       233607
      ** Entered Fiscal Price should not be zero.                                             233607
      *                                                                                       233607
     C           @MIXA,J   WHEQ 'SEA0914'                                                     233607
     C                     MOVE ' 804'    @EA,E                                               233607
     C                     ADD  1         E                                                   233607
     C                     ENDSL                                                              233607
      *                                                                                       233607
     C                     ADD  1         J                                                   233607
     C                     ENDDO                                                              233607
      *                                                                                       233607
     C                     ENDIF                                                              234635
     C                     ENDIF                                                              233607
      *                                                                                       233607
     C                     ENDSR                                                              233607
      *****************************************************************                       233607
      /EJECT                                                                                  233607
      *****************************************************************                       233607
     C/COPY WNCPYSRC,SE3002C003
      *****************************************************************                       CER001
      *  SRLUX  - Call the Bulk Trade Input Lux Screen                *                       CER001
      *****************************************************************                       CER001
     C           SRLUX     BEGSR                                                              CER001
      *                                                                                       CER001
      ** Fill DATA for Called Program                                                         CER001
      ** 1. Trade: Trade Reference                                                            CER001
     C                     MOVEL@PTDRF    PETDRF                                              CER001
      *                                                                                       CER001
      ** 2. Trade: Trade Type                                                                 CER001
     C                     MOVEL@PTDTP    UTDBK                                               CER001
      *                                                                                       CER001
      ** 3. Trade: Counterparty Customer Number                                               CER001
     C                     MOVE @PTCNR    UVTCNR                                              CER001
      *                                                                                       CER001
      ** 4. Trade: Trade Value Date                                                           CER001
     C                     Z-ADD@PTDVD    #1TDVD                                              CER001
      *                                                                                       CER001
      ** 5. Trade: Trade Date                                                                 CER001
     C                     Z-ADD@PTDDT    #1TDDT                                              CER001
      *                                                                                       CER001
      ** 6. Security: Security Issued Date                                                    CER001
     C                     Z-ADDISSD      #1ISSD                                              CER001
      *                                                                                       CER001
      ** 7. Security: Security Maturity Date                                                  CER001
     C                     Z-ADDMATY      #1MATY                                              CER001
      *                                                                                       CER001
     C                     CALL 'SE3006'                                                      CER001
     C                     PARM           ACTION  1                                           CER001
     C                     PARM           DATA                                                CER001
     C                     PARM *BLANK    RTRN    7                                           CER001
      *                                                                                       CER001
     C                     ENDSR                                                              CER001
      *****************************************************************                       CER001
      */EJECT*****************                                     S01176 S01195
     C*/COPY*ZSRSRC,XDATE3Z1********                               S01176 S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZACCRZ1
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZASIGNZ2
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZCCAL1Z2                                               S01176
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZCCAL2Z1                                               S01176
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZCCYCN                                                 S01486
      /EJECT                                                              S01486
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2
      */EJECT*******************                                   S01176 S01195
     C*/COPY*ZSRSRC,ZDATE6Z2****                                   S01176 S01195
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZDYYRZ3                                                S01176
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZEDITZ2                                                S01176
      */EJECT*******************                                          S01117
     C*/COPY*ZSRSRC,ZICD2Z1*****                                          S01117
      */EJECT*******************                                          S01117
     C*/COPY*ZSRSRC,ZICDSEZ1****                                          S01117
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT
     C/COPY ZSRSRC,ZLCD1Z1                                                                    CSE035
      /EJECT                                                                                  CSE035
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT                                                              E21050
     C/COPY ZSRSRC,ZPCINTZ1                                               E21050
      /EJECT
     C/COPY ZSRSRC,ZPRCIZ1
      /EJECT
     C/COPY ZSRSRC,ZRATEZ1
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      */EJECT******************                                           S01117
     C*/COPY*ZSRSRC,ZSYSTMZ1***                                           S01117
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZTCAL1Z1                                               S01176
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZTCAL2Z1                                               S01176
      /EJECT
     C/COPY ZSRSRC,ZXRATEZ1
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZYLDIZ1                                                S01176
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZYLDZ2                                                 S01176
      /EJECT
     C/COPY ZSRSRC,ZCALCD                                                 E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZACCZZ1                                                E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZCNSDZ1                                                E39495
     C/EJECT                                                              E39495
     C/COPY ZSRSRC,ZFWDT                                                  065016
     C/EJECT                                                              065016
     C/COPY ZSRSRC,ZNDDZ1                                                 065019
     C/EJECT                                                              065019
     C/COPY ZSRSRC,ZCOTRZ1                                                065009
     C/EJECT                                                              065009
     C/COPY ZSRSRC,ZCONVZ1                                                065009
     C/EJECT                                                              065009
      /EJECT                                                                                AR871625
     C/COPY ZSRSRC,RTZXRTC1                                                                 AR871625
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3002CP11                                           S01408
     C/COPY ZSRSRC,ZSDESCZ3                                               CSE016
     C*                                                                   S01408
      ***
      * /112563/ Change
      * @TX,3  Cmd3-End, Cmd12, Cmd5 and Cmd9 removed.
      * @TX,4  Cmd3-End, Cmd12, Cmd5 and Cmd9 removed.
      * @TX,5  Cmd3-End, Cmd5 and Cmd9 removed.
** CPY@
(c) Finastra International Limited 2001
**  @TX - Large text strings
Cancelled
Settled
F3=Exit  F12=Bypass screen  F5=Initial screen  F9=Bypass other trades
F3=Exit  F12=Screen 1  F5=Initial screen  F9=Bypass other trades
F3=Exit  F5=Initial screen  F9=Bypass other trades
Authorised                                                                065543
Not Authorised                                                            065543
F3=Exit  F12=Bypass screen                                                CSE006
F3=Exit  F12=Screen 1  F5=Initial screen F9=Bypass other trades                               CAS006
F3=Exit  F12=Previous Screen  F5=Initial screen  F9=Bypass other trades                       CAS006
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** AP - Array of powers of 10.
0000000001
0000000010
0000000100
0000001000
0000010000
0000100000
0001000000
0010000000
0100000000
1000000000
** OVR                                                                                        CER001
OVRDBF FILE(SETRX1PD) TOFILE(SEBLX1PD)                                                        CER001
OVRDBF FILE(SETRX1L0) TOFILE(SEBLX1L0)                                                        CER001
DLTOVR FILE(SETRX1PD)                                                                         CER001
DLTOVR FILE(SETRX1L0)                                                                         CER001
