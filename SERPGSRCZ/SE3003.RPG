     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Bulk transactions batch update')              *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE3003 - BULK TRADES BATCH UPDATE                            *
     F*                                                               *
     F*  Function: To generate defaults and update the trades in batch*
     F*   (I/C)    mode for transactions entered by bulk input.       *
     F*                                                               *
     F*  Called by: SE3000 - Bulk Trade Input.                        *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. 248698             Date 01Jun20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 09Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 AR871625           Date 12Dec11               *
      *                 AR632291           Date 24Aug10               *
      *                 AR630707           Date 23Aug10               *
      *                 AR597791           Date 13Aug10               *
      *                 AR596783           Date 11Aug10               *
      *                 AR584890           Date 28Jul10               *
      *                 CSW210             Date 04May10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 CSD079             Date 05Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG10273           Date 02Feb06               *
      *                 CSE075             Date 17Nov05               *
      *                 190455             Date 21Jul05               *
      *                 CER001             Date 25Apr05               *
      *                 CGL035             Date 01Mar05               *
      *                 236125             Date 22Sep05               *
      *                 235546 (reopen)    Date 26Aug05               *
      *                 235547             Date 09Aug05               *
      *                 235546             Date 27Jul05               *
      *                 234691             Date 05Jul05               *
      *                 234552             Date 29Jun05               *
      *                 234440             Date 29Jun05               *
      *                 233607             Date 19May05               *
      *                 CSE065             Date 08Nov04               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2606            Date 14May04               *
      *                 TDA035             Date 02Apr04               *
      *                 CRE020             Date 20Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 CSE045             Date 11Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 CSE039             Date 12Apr02               *
      *                 194370             Date 12Jul01               *
      *                 211407             Date 07Jan03               *
      *                 207543             Date 17Jul02               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 213066             Date 09Dec02               *
      *                 CSD015             Date 14Oct02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE034             Date 24Apr02               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      *                 202958             Date 13Feb02               *
      *                 201192             Date 17Dec01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      *                 CSE022             Date 29Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 187727             Date 15Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *  Prev Amend No. CSE023             Date 12Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 179732             Date 16Jun00               *
      *                 088864             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE006             Date 06Sep99               *
     F*                 CPB001             Date 13Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 01Dec98               *
      *                 130862             Date 18Oct98               *
      *                 151945             Date 06Jan99               *
      *                 143690             Date 05Oct98               *
      *                 CAP003             Date 30Jul98               *
      *                 136759             Date 02Jun98               *
      *                 CSW098             Date 17Apr98               *
      *                 CEU005             Date 03Feb98               *
      *                 CSE005             DATE 04FEB97               *
     F*                 CAC003             Date 25Feb97               *
     F*                 CAC002             Date 15Sep96               *
     F*                 S01408             Date 19Aug96               *
     F*                 076604             Date 12Aug96               *
     F*                 084704             Date 12Aug96               *
     F*                 083039             Date 12Aug96               *
     F*                 059110             Date 12Aug96               *
     F*                 088047             Date 26Jun96               *
     F*                 102775             Date 03Apr96               *
     F*                 CSW003             DATE 09FEB96               *
     F*                 100228             DATE 31MAY96               *
     F*                 103478             DATE 21MAY96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 099649             DATE 17APR96               *
     F*                 S01408             DATE 23FEB96               *
     F*                 S01408             DATE 10JAN96               c
     F*                 092961             DATE 04OCT95               *
     F*                 091254             DATE 20OCT95               *
     F*                 S01408             DATE 17AUG95               *
     F*                 086491             DATE 15JUN95               *
     F*                 085546             DATE 13JUN95               *
     F*                 082738             DATE 12MAR95               *
     F*                 S01408             DATE 08MAR95               *
     F*                 080050             DATE 26JAN95               *
     F*                 083547             DATE 20FEB95               *
     F*                 S01408             DATE 17JAN95               *
     F*                 S01496             DATE 01NOV94               *
     F*                 S01486             DATE 01NOV94               *
     F*                 S01509             DATE 29NOV94               *
     F*                 S01510             DATE 29NOV94               *
     F*                 S01511             DATE 29NOV94               *
     F*                 068692             DATE 12OCT94               *
     F*                 069596             DATE 18APR94               *
     F*                 S01408             DATE 19AUG94               *
     F*                 064575             DATE 15AUG94               *
     F*                 S01408             DATE 17MAY94               *
     F*                 065301             DATE 06MAY94               *
     F*                 S01446             DATE 21FEB93               *
     F*                 S01448             DATE 21FEB93               *
     F*                 065774             DATE 17JAN94               *
     F*                 055420             DATE 13JAN94               *
     F*                 052254             DATE 13JAN94               *
     F*                 065663             DATE 13JAN94               *
     F*                 057181             DATE 12JAN94               *
     F*                 054259             DATE 12JAN94               *
     F*                 065524             DATE 11JAN94               *
     F*                 065377             DATE 06JAN94               *
     F*                 065355             DATE 06JAN94               *
     F*                 056846             DATE 04JAN93               *
     F*                 041069             DATE 04JAN93               *
     F*                 063863             DATE 25NOV93               *
     F*                 063506             DATE 18NOV93               *
     F*                 S01401             DATE 16JUN93               *
     F*                 E39495             DATE 17FEB93               *
     F*                 047922             DATE 01FEB93               *
     F*                 S01397             DATE 16SEP92               *
     F*                 E43208             DATE 01SEP92               *
     F*                 E36791             DATE 10MAR92               *
     F*                 E36792             DATE 09MAR92               *
     F*                 E27934             DATE 22OCT91               *
     F*                 E27092             DATE 04SEP91               *
     F*                 E24725             DATE 19APR91               *
     F*                 E24559             DATE 15MAR91               *
     F*                 S01117             DATE 25FEB91               *
     F*                 S01195             DATE 25FEB91               *
     F*                 E28749             DATE 14AUG90               *
     F*                 S01220             DATE 07AUG90               *
     F*                 E28748             DATE 14JUL90               *
     F*                 S01269             DATE 11JUL90               *
     F*                 S01271             DATE 20JUN90               *
     F*                 E23363             DATE 16AUG90               *
     F*                 E21668             DATE 01MAY90               *
     F*                 E21616             DATE 03APR90               *
     F*                 E21604             DATE 02APR90               *
     F*                 E21354             DATE 08MAR90               *
     F*                 E21063             DATE 10FEB90               *
     F*                 E21064             DATE 10FEB90               *
     F*                 E21065             DATE 10FEB90               *
     F*                 E20380             DATE 08DEC89               *
     F*                 E20196             DATE 02NOV89               *
     F*                 S01154             DATE 16/08/89              *
     F*                 E18356             DATE 29/06/89              *
     F*                 E16772             DATE 19/06/89              *
     F*                 E17739             DATE 11/05/89              *
     F*                 E17704             DATE 31/03/89              *
     F*                 E17303             DATE 31/03/89              *
     F*                 E17228             DATE 03/03/89              *
     F*                 E16843             DATE 09/02/89              *
     F*                 E16827             DATE 09/02/89              *
     F*                 E16813             DATE 09/02/89              *
     F*                 E16799             DATE 09/02/89              *
     F*                 S01175             DATE 07/11/88              *
     F*                 S01176             DATE 21/08/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *     
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  AR871625 - New Stamp Tax fields are missing in Bulk Input    *
      *  AR632291 - BULK MT515-518 messages are not generated when    *
      *             Deliver To and Deliver From are not the same      *
      *  AR630707 - BULK - Extended Settlement appear twice even if   *
      *             Deliver From and Deliver To values are the same   *
      *  AR597791 - Message information details inputted in BULK      *
      *             were not saved                                    *
      *  AR596783 - Various errors encountered in BULK                *
      *  AR584890 - No MT generated in BULK/BYSL                      *
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  CSD079 - Enhanced Customer Maintenance API (Recompile)       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10273 - Trades not reflected as cancelled after delete.   *
      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
      *           (Recompile)                                         *
      *  BUG7991- Pay From and Pay To Account being blanked out.      *
      *  190455 - If bulk is deleted and trades are incomplete,       *
      *           then trades does not need to be authorised.         *
      *  CER001 - Lux Upgrade to MidasPlus                            *
      *  CGL035 - EUSD Upgrade to Midasplus                           *
      *  236125 - No need to call backvaluation programs if trade     *
      *           does not exist for an action code Delete            *
      *  235546 - overwrite of data from SE006680                     *
      *  235547 - Defaulting incorrect first time into program        *
      *  235546 - EU Tax backvaluations                               *
      *  234691 - Program looping in ZACCR                            *
      *  234552 - Add blocking check for backvaluations               *
      *  234440 - Use new file ETCPOSND for average price, average    *
      *           fiscal price, purchased interest etc                *
      *         - Change Control 1 Part 4 - For Switzerland only,     *
      *           bonds at at a discount will have their fiscal price *
      *           calculated on a yield curve, and funds will not     *
      *           take into account the profit on a sale when deciding*
      *           the tax amount - THE LATTER PART HAS BEEN INSERTED  *
      *           AND THEN REMOVED AGAIN                              *
      *           Add the EU Tax amount field to the screen           *
      *           Default Fiscal Price if review option not taken     *
      *  233607 - Fiscal Price doesn't appear on SE Trade screen      *
      *           of Bulk Input                                       *
      *  CSE065 - Const. Yield Amort. on Mortgage backed assets       *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2606 - Extension and Extended Settlements for Bulk Trades *
      *            and SE Trades must have the same format. Moreover, *
      *            make sure that no decimal data errors occur during *
      *            trade updates.                                     *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSE045 - API for Extended Settlement for Trade Input and     *
      *           Depot Movement.  Field name clash.                  *
      *  CAS006 - Hedge Accounting Phase B                            *
      *  CSE039 - Automatic settlement of trades - Write to Movement  *
      *         - Status file                                         *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  207543 - CEU018 NOT WORKING ON A PRICE BASIS, MISSING A PART *
      *           OF AUS047. CHECK FOR CEU017, RECOMPILE OVER ZYLDZ2. *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2/ZYCEZ1
      *  213066 - Trades from BULKTD not all moved to TRADSD due to   *
      *           fix 201192.Change use of indicator from *IN05 to 03.*
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE034 - Standard Settlement Instruction improvements        *
     F*  CSE031 - Coupon Fixing for Floating Rate Notes.              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  180707 - No Position Settlements generated. Recompile over   *
     F*           changes in /COPY ZNCDZ3.                            *
      *  202958 - Problem on insert, changes not being commited for   *
      *           Buy-Sell entries.                                   *
      *  201192 - Buy-sell back give db error when going to ext.      *
      *           settlement screen.                                  *
      *  CSE028 - Standing Settlement Instructions Enhancement.       *
      *  CSE022 - Depository Definition Enhancement                   *
      *  187727 - Incorrect WHTX amount                               *
      *  CSE023 - Treaty Withholding Tax                              *
     F*  179732 - Addition of Account officer value to AOPRFMR0 call. *
     F*  088864 - Recompile over amended /COPY ZPCINTZ1               *
     F*  CSE006 - Repurchase Agreements (Repos) Enhancement.          *
     F*  CPB001 - 'Private Banking' Module                            *
      *  CAC005 - PCA-SE Enhancement.                                 *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  143690 - Incorrect Mult/Div Ind. was being used when EURO    *
     F*           CCY was involved. Fix is to reverse the M/D ind. if *
     F*           Nominal CCY is equal to the EURO CCY.               *
      *  CAP003 - Conversion of Midas inputs to modular API structure *
      *           Phase 2.  Program recompiled over changed files.    *
     F*  136759 - Default T1CONG to 'N'                               *
     F*  CSW098 - SWIFT 98 Changes. New field: Standard Override      *
     F*           Instructions.                                       *
     F*  CEU005 - EMU SE Settlement Ccy Conversion.                   *
     F*  CSE005 - Effect of holidays on FRN Coupon Dates              *
     F*           (recompilation due to change to ZNCD/ZLCD)          *
     F*  CAC003 - Profit Centre Accounting Development Phase 3.       *
     F*  CAC002 - Profit Centre Accounting Development Phase 2:       *
     F*           If Analytical Accounting is installed, replace      *
     F*           Profit Centre field with 2 new fields 'Book Profit  *
     F*           Centre' and 'Transaction Profit Centre'.  A new     *
     F*           'Margin' field will also be added.                  *
     F*  S01408 - Core hook SE3003CP19 added                          *
     F*         - Core hook SE3003CP18 added                          *
     F*         - Core hook SE3003CP17 added                          *
     F*         - Core hook SE3003CP16 added                          *
     F*         - Core hook SE3003CP15 added                          *
     F*         - Core hook SE3003CP14 added                          *
     F*         - Core hook SE3003CP13 added                          *
     F*  076604 - Check if extension record found before updating to  *
     F*           prevent 'Update without read/chain' error           *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  102775 - For SM 15 from STDSED, fill in a/c code and seq     *
     F*           to avoid db error in AOOUTRU0                       *
     F*  CSW003 - MT5xx Message Generation - Phase 2                  *
     F*  100228 - RECOMPILE OVER CHANGED ZDYYRZ3, ZLCDZ1 & ZNCDZ3.    *
     F*  103478 - Change Bulk to Trades format (Recompile)            *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  099649 - If day adjustment on the trade is the same as on    *
     F*           the security, do not treat as an interest           *
     F*           discrepancy. Recompile over amended subroutine      *
     F*           ZPCINTZ1.                                           *
     F*  S01408 - Core hook SE3003CP12 added                          *
     F*  S01408 - Core hook SE3003CP10 added                          *
     F*           Core hook SE3003CP11 added                          *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091254 - RECOMPILE OVER CHANGED ZLCDZ1 & ZNCDZ3              *
     F*  S01408 - Core hook SE3003CCP7 added                          *
     F*           Core hook SE3003CCP8 added                          *
     F*           Core hook SE3003CCP9 added                          *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  085546 - The default for capacity should always be 0.        *
     F*  082738 - Rewrite of projected account movements.             *
     F*  S01408 - Core hook SE3003IIPG added                          *
     F*           Core hook SE3003CCPG added                          *
     F*           Core hook SE3003CCP3 added                          *
     F*           Core hook SE3003CCP4 added                          *
     F*           Core hook SE3003CCP5 added                          *
     F*           Core hook SE3003CCP6 added                          *
     F*  080050 - Narrative code on RSACMTPD changed to alphanumeric  *
     F*  083547 - Recompiled over MUSERDD                             *
     F*  S01408 - Addition of core hook SE3003CCPG                    *
     F*           Addition of core hook SE3003CBD1                    *
     F*           Addition of core hook SE3003CBD2                    *
     F*  S01496 - Jyske Enhancements upgrade to Release 10            *
     F*  S01486 - Private Banking upgrade to Release 10               *
     F*  S01509 - Value Currency to be currency of Issuer of Payments *
     F*  S01510 - Dividend Payments Based on Ex-Date                  *
     F*  S01511 - Market Migration                                    *
     F*  068692 - Program aborts if trade not entered in review mode. *
     F*           New files (for BJB) - TRADSDY1 and 2 (S01401) ,     *
     F*           need to be set up using defaults if records not     *
     F*           found.                                              *
     F*           Data base error 33 removed - if extension file      *
     F*           BULKDSDX1 not found values are initialized.         *
     F*           ZALIGN removed as unused (E specs kept for ZEDIT).  *
     F*  069596 - MT592 not being generated for trade cancellation.   *
     F*  S01408 - Core hook SE3003CLD1 added                          *
     F*           Core hook SE3003CLD2 added                          *
     F*           Core hook SE3003CCP1 added                          *
     F*  064575 - Recompiled over amended ZYLDZ2 subroutine.          *
     F*  S01408 - Core hook SE3003FFPG added                          *
     F*  065301 - Recompiled over changed copy source ZACCR subr.     *
     F*           with ZAMT increased to 15,0.                        *
     F*  S01446 - Customer Commissions (Courtage) enhancement:        *
     F*           Use Purchased Interest in SR/ZCCAL1 for new charge  *
     F*           method 'I'                                          *
     F*           Get details of single charge currency (from SE ICD) *
     F*           for conversion of charge amount to nominal currency *
     F*  S01448 - Bulk Input Enhancements:                            *
     F*           1) Agency trade client can now be a discretionary   *
     F*              customer (if 'Allow Trades between Portfolio     *
     F*              Clients on both sides' is on). Therefore         *
     F*              discretionary ind. must be checked as well as    *
     F*              agency trade value = M.                          *
     F*           2) Change update of PRONO and OLPOS.                *
     F*           3) Improve defaulting of Pay Code.                  *
     F*  065774 - Update of BKPOSD was incorrect for a deletion       *
     F*  055420 - Recompiled over the changed version of ZCOTRZ1.     *
     F*  052254 - CURRENT FACTOR amended from 9,8 to 10,9             *
     F*  065663 - Std settlement instructions are not always picked up*
     F*  057181 - When output a new BKPOSD, it should update LPCD     *
     F*           with TDVD. So that if backvalued trade is done to   *
     F*           that date, it will generate backvalued action.      *
     F*  054259 - SANP and SANS should not be multiplied by the       *
     F*           current factor for PROT = 8.                        *
     F*  065524 - If the security has different nominal ccy to the    *
     F*           payment ccy, the exchange rate defaults to that off *
     F*           the security.                                       *
     F*  065377 - Avoid dump when deleting a bulk trade               *
     F*  065355 - Update MEMOS in settlement currency                 *
     F*  056846 - Ignore deleted settlement record (RECI=*) when      *
     F*           updating SETLED.                                    *
     F*  041069 - Only allow Grey Market trades to have Clearance     *
     F*           Type '0' And be complete                            *
     F*  063863 - Correct update of debit/credit ind. for RSACMTPD.   *
     F*  063506 - Customer commission rebate was calculated using     *
     F*           the broker commission amount                        *
     F*  S01401 - The generation of MT5xx SWIFT Messages if the       *
     F*           option is available.                                *
     F*  E39495 - New /COPY subroutine ZCALCD added (called from      *
     F*           sr. ZYLD)                                           *
     F*         - /COPY subroutine ZACCZZ1 added (called from         *
     F*           sr. ZYLD and ZCALCD                                 *
     F*         - Recompiled over changed ZYLDZ2                      *
     F*  047922 - Recompiled over changed SR/ZYLDZ2                   *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*         - Added processing for Discount/Premium since First   *
     F*           Position Date for Amortisation by Security Report   *
     F*         - Recompiled for New Zealand Bond Formula             *
     F*  E43208 - Field AIBD changed to ISMA. ('Association of        *
     F*           International Bond Dealers' changed their name to   *
     F*           'International Securities Market Association').     *
     F*  E36791 - Should use standard subroutine ZPCINT to calculate  *
     F*           purchased interest and interest adjustment          *
     F*  E36792 - Clearance type should be defaulted for a sale       *
     F*  E27934 - Recompiled over the changed version of ZACCRZ1      *
     F*  E27092 - Recompiled over changed SR/ZLCD                     *
     F*  E24725 - DB error in PRONO processing when nostro no. is     *
     F*           blanked out and then used to chain to nostros file  *
     F*  E24559 - Loop when trying to find next coupon date. Use      *
     F*           Standard subroutine ZNCD instead                    *
     F*  S01117 - Release 10 Multibranching etc                       *
     F*  S01195 - Holiday processing                                  *
     F*  E28749 - nominal (sales) trade and value is zero on UDEPP if *
     F*           new position                                        *
     F*  S01220 - STRATEGIC RISK MANAGEMENT                           *
     F*           Recompiled over changed PF/SECTYD, PF/SEDEVD        *
     F*  E28748 - insert allowed if trade has reci of '*' not if 'C'  *
     F*  S01269 - Trade Authorisation                                 *
     F*  S01271 - Pay/Receive in input cycle - set PRPC on TRADSD to  *
     F*           'N'.                                                *
     F*  E23363 - Partial key should be used on chain to STDSED if    *
     F*           safe custody or discretionary customer, not full key*
     F*  E21668 - Recompiled over changed SR/ZYLDZ2                   *
     F*  E21616 - Recompiled over changed SR/ZLCD.                    *
     F*  E21604 - On Deletion, reverse Nominal Settled I/C fields if  *
     F*           any Settlements have been done.                     *
     F*  E21354 - Prime Retail Account Number not being written to    *
     F*           Trades file on Settlement Method 04.                *
     F*  E21063 - Deliver From/To should default according to the     *
     F*           Clearance Type using Client details or ICD.         *
     F*  E21064 - If Settlement within Euroclear/Cedel and counterparty
     F*           is a Portfolio Client but is not a Participant, use *
     F*           Euroclear Cedel Depot of BICN for default Depots.   *
     F*  E21065 - Inaccuracies in the calculation of Countervalue and *
     F*           Consideration. Program should now use standard S/R's*
     F*           ZCOTRZ1 and ZCNSD.                                  *
     F*  E20380 - ZYLDZ1 ABD ZYLDZ2 CHANGED. ZLCDZ1 NOW NEEDED.       *
     F*  E20196 - ZACCRZ1 REDEFINED ZWMLT FIELD TO 150.               *
     F*  S01154 - ACCOUNT MOVEMENTS.                                  *
     F*  E18356 - PAY DETAILS REMOVED AND SETTLEMENT METHOD SET TO 0  *
     F*           ON TRADES WITH PORTFOLIO CLIENTS WITH NO SETTLEMENT *
     F*           DETAILS.                                            *
     F*           DEPOTS ARE SET TO COUNTERPARTY IF NOT OTHERWISE     *
     F*           DEFAULTED.                                          *
     F*  E16772 - Recompiled for the Dividend Payment Amount field    *
     F*           changes.                                            *
     F*  E17739 - UPDATING OF MEMOS/PRONOS CORRECTION.                *
     F*  E17704 - RECOMPILE PROGRAM OVER CHANGED ZNCDZ3 SR.           *
     F*  E17303 - RECOMPILE PROGRAM OVER CHANGED ZDYYRZ3 ZYLDZ1 ZYLDZ2*
     F*  E17228 - UPDATE INPUT CYCLE POSITIONS CORRECTLY ON POSITION  *
     F*           FILES.                                              *
     F*  E16843 - IF DEFAULT RETAIL ACCOUNT IS BLOCKED, CHANGE        *
     F*           SETTLEMENT METHOD TO '00'.                          *
     F*  E16827 - OUTPUT OUTSTANDING VALUE AS COUNTERVALUE IF EXCHANGE*
     F*           RATE IS ZERO.                                       *
     F*  E16813 - UPDATE PROJECTED NOSTRO BALANCES AND ONLINE         *
     F*           POSITIONS FILES BY VALUE DATE.                      *
     F*  E16799 - DIFFERENTIATE BETWEEN CANCELLING LIVE AND HISTORIC  *
     F*           TRADE SETTLEMENTS TO CORRECT AUDIT CONTROL ERROR.   *
     F*  S01175 - EUCLID INCORPORATION.                               *
     F*  S01176 - SECURITIES TRADING 3.1                              *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     FBULKTD  UF  E           K        DISK
     F                                              KINFSR *PSSR
     FBULKSDY1IF  E           K        DISK                               S01401
     F            TRADSDD1                          KRENAMEBULKSDD1       S01401
     FBULKSDY2IF  E           K        DISK                               S01401
     F            TRADSDD2                          KRENAMEBULKSDD2       S01401
     FSECGT   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F***CUBRD***IF**E           K        DISK                            S01496
     FCUBRD   IF  E           K        DISK                           UC  S01496
     F                                              KINFSR *PSSR
     FSECUBRL0IF  E           K        DISK         KINFSR *PSSR      UC  S01496
     F            CUBRDDF                           KRENAMECUBRDSE        S01496
     F*CUBRC***IF  E           K        DISK                              S01176
     F**********  CUBRDDF                           KRENAMECUBRCF         S01176
     F**********                                    KINFSR *PSSR          S01176
     FSECTY   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F*SNAME***IF**E***        K        DISK                              S01117
     F*********** CLINTCBF                          KRENAMESNAMEF         S01117
     F***********                                   KINFSR *PSSR          S01117
     F*TABSE***IF**E           K        DISK                              S01117
     F*********** TABLETAF                          KIGNORE               S01117
     F*********** TABTB40F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F*********** TABTE20F                          KIGNORE               S01117
     F*********** TABLETHF                          KIGNORE               S01117
     F*********** TABLETKF                          KIGNORE               S01117
     F*********** TABLETNF                          KIGNORE               S01117
     F*********** TABLETPF                          KIGNORE               S01117
     F***         TABLETRF                          KIGNORE               E16843
     F*********** TABLETXF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     F*********** TABLET3F                          KIGNORE               S01117
     F*********** TABLET5F                          KIGNORE               S01117
     F***********                                   KINFSR *PSSR          S01117
     FSTDSED  IF  E           K        DISK
     F                                              KINFSR *PSSR
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     F                                              KINFSR *PSSR
     FINVTP   IF  E           K        DISK
     F                                              KINFSR *PSSR
     F***SECED***IF  E           K        DISK                            E36791
     F***********                                   KINFSR *PSSR          E36791
     FSEDEV   IF  E           K        DISK         KINFSR *PSSR          E36791
     FSECEO   IF  E           K        DISK         KINFSR *PSSR          E36791
     F            SEDEVDF                           KRENAMESEDEVDO        E36791
     F*********** SNDEVDF                           KIGNORE        E36791 E39495
     F            SNDEVDF                           KRENAMESNDEVDO        E39495
     F*ACNUM**IF**E           K        DISK                               082738
     F************ACCNTABF                          KRENAMEACNUMF         082738
     F************                                  KINFSR *PSSR          082738
     F*PRONO**UF**E           K        DISK         KCOMIT                082738
     F************PRONOHHF                          KIGNORE               082738
     F************                                  KINFSR *PSSR          082738
     F*MEMOS**UF**E                    DISK         KCOMIT                082738
     F************                                  KINFSR *PSSR          082738
     F*TABTB20*IF**E***                 DISK                           U1 S01117
     F*OLPOS**UF**E           K        DISK         KCOMIT                082738
     F************OLPOSHHF                          KIGNORE               082738
     F************OLPOSOBF                          KIGNORE               082738
     F************                                  KINFSR *PSSR          082738
     FTRADS   UF  E           K        DISK         KCOMIT       A
     F                                              KINFSR *PSSR
     F***TRADSDQDO   E                    DISK         KCOMIT                      AR596783 AR871625
     FTRADSQL0UF  E           K        DISK         KCOMIT       A                          AR871625
     F                                              KINFSR *PSSR                            AR596783
     FTRADSDY1UF  E           K        DISK         KCOMIT       A        S01401
     F                                              KINFSR *PSSR          S01401
     FTRADSDY2UF  E           K        DISK         KCOMIT       A        S01401
     F                                              KINFSR *PSSR          S01401
     FTRADSA  UF  E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     F*CLINT***UF**E***        K        DISK         KCOMIT               S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     F***********                                   KINFSR *PSSR          S01117
     FBKPOS   UF  E           K        DISK         KCOMIT       A
     F                                              KINFSR *PSSR
     FBKPOSA  UF  E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     FBKPHD   UF  E           K        DISK         KCOMIT       A
     F                                              KINFSR *PSSR
     FBKPHDA  UF  E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     FCPOSN   UF  E           K        DISK         KCOMIT       A
     F                                              KINFSR *PSSR
     FCPOSNA  UF  E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     FUDEPP   UF  E           K        DISK         KCOMIT       A
     F                                              KINFSR *PSSR
     FUDEPPA  UF  E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     FCDEPP   UF  E           K        DISK         KCOMIT       A
     F                                              KINFSR *PSSR
     FCDEPPA  UF  E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     FSETLE   UF  E           K        DISK         KCOMIT
     F                                              KINFSR *PSSR
     FSETLEA  UF  E                    DISK         KCOMIT
     F                                              KINFSR *PSSR
     F*RSACMTPDO***E                   DISK                        S01154 082738
     F*************                                 KCOMIT         S01154 082738
     F*SE3003P1O***E***                 PRINTER                        UC S01117
     FSE3003AUO   E                    PRINTER                        UC  S01117
     F                                              KINFSR *PSSR
     FMUSER   IF  E           K        DISK                               S01269
     FTRAUTD  O   E                    DISK         KCOMIT                S01269
     F                                              KINFSR *PSSR          S01269
     FSEPCBD  IF  E           K        DISK         KCOMIT       A        S01117
     F                                              KINFSR *PSSR          S01117
     FSEPCCD  IF  E           K        DISK         KCOMIT       A        S01117
     F                                              KINFSR *PSSR          S01117
     FSEPCA   UF  E                    DISK         KCOMIT                S01117
     F                                              KINFSR *PSSR          S01117
     FFDDIV   IF  E           K        DISK                               S01510
     F            SEDEVDF                           KRENAMESEDEVD2        S01510
     FMGECONL0IF  E           K        DISK                               CSW003
     F*                                                                   CSE006
     FBSPOSD  O   E                    DISK         KCOMIT            UC  CSE006
     F                                              KINFSR *PSSR          CSE006
     FSDWTCSL1IF  E           K        DISK                               CSE023
     F            SDWTCSD0                          KRENAME@WTCSL1        CSE023
     FSDWHTTL5IF  E           K        DISK                               CSE023
     F            SDWHTTD0                          KRENAME@WHTTL5        CSE023
     FSDTXBSL1IF  E           K        DISK                               CSE023
     F            SDTXBSD0                          KRENAME@TXBSL1        CSE023
      *                                                                                       CSD015
     FSDCWHTL1IF  E           K        DISK         KINFSR *PSSR                              CSD015
     F***SEMVTSPDO   E                    DISK         KCOMIT                        CSE039 BUG10273
     F**********                                    KINFSR *PSSR                     CSE039 BUG10273
      *                                                                                     BUG10273
      ** Midas SE Movements Status                                                          BUG10273
     FSEMVTSL6O   E           K        DISK         KCOMIT       A                          BUG10273
     F                                              KINFSR *PSSR                            BUG10273
      *                                                                                     BUG10273
      ** Midas SE Movements Status                                                          BUG10273
     FSEMVTSL0IF  E           K        DISK                                                 BUG10273
     F            SEMVTSD0                          KRENAMESEMVTSD1                         BUG10273
      *                                                                                       CAS006
     FSEDEVL9 IF  E           K        DISK         KINFSR *PSSR                              CAS006
     F            SEDEVDF                           KRENAMESEDEVD3                            CAS006
     F*
     FREADVCL1UF  E           K        DISK         KCOMIT       A    UC                      CRE020
      **  Midas RE Settled Transaction Index File by Ref No/Pgm Ref                           CRE020
      *                                                                                       CRE020
     F** Core hook for externalisation.                                   S01408
     F/COPY WNCPYSRC,SE3003FFPG                                           S01408
     F*                                                                   S01408
     FSETRX1L0O   E                    DISK         KINFSR *PSSR                              CER001
     F                                              KCOMIT                                    CER001
     FSEBLX1L0UF  E           K        DISK         KINFSR *PSSR A                            CER001
     F            TRADSDD6                          KRENAMEBULKTDD6                           CER001
     F                                              KCOMIT                                    CER001
     F*                                                                   S01176
      /EJECT
     F*****************************************************************   S01176
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01 - CHAIN or READ failure                                  *
     F*   02 - CHAIN or READ failure TRADSDY1/2 & BULKSDY1/2          *   S01401
     F*   04 - Default codes found                                    *
     F*   05 - Market update is active                                *   E16843
     F*   10 - Last trade for this batch read                         *
     F*   11 - First trade for this batch has been processed          *
     F*   12 - An error has occurred while updating the current trade *
     F*   13 - An error has occurred while processing this batch      *
     F*   14 - Charge Codes have been defaulted                       *   S01176
     F*   15 - Autocharges = 'Y' - for controlling Printer Output     *   S01176
     F*   17 - Account blocked for debits.                            *   E16843
     F*   18 - Account blocked for credits.                           *   E16843
     F*   19 - Print current factor                                   *   CAC002
     F*   20 - Analytical Accounting module is installed              *   CAC002
     F*   21      Chain failure on LF/MUSER                           *   S01269
     F*   22 - Print Transaction Profit Centre                        *   CAC002
     F*   23 - Print Margin Points and Amount                         *   CAC002
     F*   29 - Portfolio Management Module present                    *   S01486
     F*   30 - Multibranching environment                             *   S01117
     F*   31 - Originating branch used                                *   S01117
     F*   32 - Profit Centre used                                     *   S01117
     F*   33 - Display 'In Ccy in field 72' field                     *   CEU005
     F*   34 - Error on call to SWIFT98                               *   CSW098
      *   36 - Chain on file SDCWHTL1.                                *                       CSD015
      *   37 - CGL031 (Taxation of Savings Income) is enabled         *                       233607
      *   69         READVCL1 Search (CHAIN) Indicator                *                       CRE020
     F****84******Chain*failure*on*PF/TABTG10**********************S01269 S01117
     F*                                                               *
     F*90-99 - Used in validation/conversion routines (Z s/r's)       *
     F*                                                               *
     F*   U1 - Retail module is present in system                     *
     F*   U7 - Data base error                                        *
     F*   U8 - Data base error                                        *
     F*                                                               *
     F*****************************************************************   S01176
      /EJECT
     F*****************************************************************   S01176
     F*                                                               *
     F*   I N D E X   T O   S U B R O U T I N E S                     *
     F*                                                               *
     F*   AOBANK  Call access object - Bank details                   *   S01117
     F*   AOCURR  Call access object - Currencies                     *   S01117
     F*   AOCUST  Call access object - Customers                      *   S01117
     F*   AOGELR  Call access object - General Ledger ICD             *   S01117
     F*   AOPRFC  Call access object - Profit Centre details          *   CAC002
     F*   AOPRFM  Call access object - Profit Centre default          *   S01117
     F*   AORETL  Call access object - Retail ICD                     *   S01117
     F*   AOSECS  Call access object - Securities Trading Customers   *   S01117
     F*   AOSTRD  Call access object - Securities Trading ICD         *   S01117
     F*   AOSARD  Call access object - Switchable features file       *   S01401
     F*   SMSGR  - Set Settlement Message Request Indicator to 'N'?   *   CSW003
     F*   SUB001 - Program initialization                             *
     F*   SUB002 - Initialization for first trade                     *
     F*   SUB003 - Update processing control                          *
     F*   SUB004 - Program termination                                *
     F*   SUB100 - Set up common defaults                             *
     F*   SUB101 - Set up unrelated trade defaults - part 1           *
     F*   SUB102 - Set up trade related defaults                      *
     F*   SUB103 - Calculate charges/commissions                      *
     F*   SUB104 - Set up unrelated trade defaults - part 2           *
     F*   SUB105 - Accumulate totals for market trades                *
     F*   SUB200 - Print error report                                 *
     F*   SUB201 - Update database                                    *
     F*   SUB300 - Update trades file                                 *
     F****SUB400*-*Determine*next*coupon*date*for*int.*calcs***********   E24559
     F****SUB401*-*Calculate*int.*accrued*adjustment*******************   E36791
     F*   SUB403 - Determine Default Charge/Commission Codes          *   S01176
     F*   SUB405 - Determine Charge/Commission Tax Amounts            *   S01176
     F****SUB500*-*Update*client*details*******************************   S01117
     F****SUB501*-*Update prono                                       *   082738
     F****SUB502*-*Update memos                                       *   082738
     F****SUB503*-*Update olpos                                       *   082738
     F*   SUB504 - Update book                                        *
     F*   SUB505 - Update client depot positions                      *
     F*   SUB506 - Update user depot positions                        *
     F****SUB507*-*WRITE TO RSACMTPD                               S01154 082738
     F*   SUB600 - Calculate the latest book positions                *
     F*   SUB601 - Calculate the latest client positions              *
     F*   SUB700 - Calculate default charge/commission                *
     F****SUB701**Calculate*charge*amounts                            *   S01176
     F****SUB702**Calculate*tiered*charge*amounts                     *   S01176
     F****SUB703**Calculate*VAT*charges                               *   S01176
     F****SUB704**Calculate*VAT*charge*amounts                        *   S01176
     F****SUB705**Calculate*tiered*VAT*amounts                        *   S01176
     F*   SUB800  Write to PF/Trautd                                  *   S01269
     F*   SUB801  Convert countervalue in nom curr to base curr       *   S01269
     F*   SUB999 - Database error handling                            *
     F*   BLK1Z2 - Obtain BULKSDX1 & BULKSDX2 details                 *   S01401
     F*   TRD1Z2 - Obtain TRADSDX1 & TRADSDX2 details                 *   S01401
     F*   MT5DF1 - Default MT5xx Message Gen. Details (1st Record)    *   CSW003
     F*   MT5DF2 - Default MT5xx Message Gen. Details (2nd Record)    *   CSW003
     F*   WPRFC   Write new Profit Centre positions                   *   S01117
     F*   ZACCH   Access a holiday for a ccy and (optionally) location*   S01195
     F*   ZACCR  - Calculate interest accrued between two dates       *
     F*   ZACCZ  - Calculate accrued interest between two dates       *   E39495
     F****ZALIGN**Validate*and*right-align*numeric*fields             *   S01176
     F****ZASIGN**Validate*and*right-align*signed*numeric*fields      *   S01176
     F*   ZBKDT   Calculate the nth working day back from a given     *   S01195
     F*           start date for a currency and (optional) location   *   S01195
     F*   ZCALCD - Calculate long term CD price from yield            *   E39495
     F*   ZCCAL1 - Calculate Charege/Commission Amounts               *   S01176
     F*   ZCCAL2 - Calculate Charege/Commission Tiered Amounts        *   S01176
     F*   ZCHKH   Determine if a given date is a holiday in a         *   S01195
     F*           particular currency and (optional) location         *   S01195
     F*   ZCONV  - Convert an amount from one currency to another     *
     F*   ZCTRV  - Calculate countervalue of Trade                    *
     F*   ZDATE1 - Validate dates submitted and convert to a number   *
     F*                                             of days           *
     F*   ZDATE2 - Convert a day number to date format                *
     F****ZDATE5*-*Determine*if*a*day*number*date*is*a*holiday*in******   S01195
     F*******************given*currency*and,*if*day*is*a*holiday*******   S01195
     F****************and*if*required,*determine*next*working*day******   S01195
     F*   ZDAYS  - Calculate no. of days between two dates for        *
     F*                                      interest calculations    *
     F*   ZDYYR  - Calculate no. of days in interest year             *
     F*   ZEDIT  - Insert a decimal point into a numeric field        *
     F*   ZEVCD  - Determine event control date                       *
     F****ZICD2**-*Access*ICD*record*2*for*securities*trading**********   S01117
     F****ZICDSE*-*Access*ICD*record*3*for*securities*trading**********   S01117
     F*   ZLCD   - Determine last coupon date                         *   E24559
     F*   ZNCD   - Determine next coupon date                         *
     F*   ZNDD    Determine next dividend date                        *   S01510
     F*   ZPCINT - Calculate purchased interest                       *   E36791
     F*   ZPRCI  - Output price as %price                             *
     F*   ZRATE  - Calculate effective rate                           *
     F*   ZSEDIT - Insert a decimal point and sign into a numeric fld *
     F*            and to blank out leading zeros (optionally         *
     F*                                             inserting commas) *
     F****ZSYSTM*-*Chain*to*the*installation*control*data*record*******   S01117
     F*   ZTCAL1 - Calculate Tax on Charges/Commissions               *   S01176
     F*   ZTCAL2 - Calculate Tax on Charges/Commissions (Tiered)      *   S01176
     F*   ZTNLU1 - Determine next available transaction number        *
     F*   ZXRATE - Determine cross exchange rate between two currencie*
     F*   ZYLDI  - Output yield as percentage                         *
     F*   ZFWDT  - Calculate a number of Working days forward in a    *   S01448
     F*            ccy and (optional) location                        *   S01448
     F*                                                               *   S01176
     F*****************************************************************   S01176
      /EJECT
      *                                                                   S01176
     E                    CPY@    1   1 80
      *                                                                                       201192
      ** Array containing dummy timestamp                                                     201192
      *                                                                                       201192
     E                    STAMP   1   1 26                                                    201192
     E                    EUCLA       6  1                                CSW003
     E                    EUCLB       6  1                                CSW003
     E                    ECC         5  1                                CSW003
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDAYSZ1
     E*/COPY*ZSRSRC,ZDATE5Z1*****                                         S01117
     E*/COPY*ZSRSRC,ZDATE6Z1*****                                         S01117
      *                                                                   S01176
      ***  ZALIGN E-Spec Definitions ZA1 and ZA2 are used by ZEDIT        S01176
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E***********/COPY ZSRSRC,ZASIGNZ1                                    S01176
     E/COPY ZSRSRC,ZNCDZ1
     E***********         @ER     1  16 80               Error text       S01117
     E***********         @ER     1  18 80               Error textS01117 S01511
     E***********         @ER     1  19 80               Error textS01511 CAC002
     E***********         @ER     1  21 80               Error text                    CAC002 234552
     E                    @ER     1  22 80               Error text                           234552
     E***********         @RA        10 15 0             Range limits     S01176
     E***********         @PC        10  7 4             Percentages      S01176
     E***********         @CG        10 15 0             Flat charges     S01176
     E                    @RA        15 15 0             Charge Range U.L.S01176
     E                    @PC        15  7 4             Percentage LevelsS01176
     E                    @CG        15 15 0             Flat Charges     S01176
     E                    @TRA       15 15 0             Counterparty Tax S01176
     E                    @TPC       15  7 4             Counterparty Tax S01176
     E                    @TCG       15 15 0             Counterparty Tax S01176
     E**********          WLARR   2  76 40                                             CSD015 CSW210
     E                    WLARR   2  80 40                                                    CSW210
     E                    @FNXA      40 10                                                    233607
     E                    @MIXA      40  7                                                    233607
     E                    @MDXA      40 45                                                    233607
     E                    @WFNXA     40 10                                                    233607
     E                    @WMIXA     40  7                                                    233607
     E                    @WMDXA     40 45                                                    233607
     E***********         AND         5  3               Nostro dates     082738
     E***********         ANB         5  8               Nostro balances  082738
     E***********         ADT        16  3               Online pos date  082738
     E***********         AFI        16  8               Online pos FX in 082738
     E***********         AFO        16  8               Online pos FX out082738
     E***********         NND         5  5 0             Nostro dates     082738
     E***********         NNB         5 15 0             Nostro balances  082738
     E***********         NDT        16  5 0             Online pos date  082738
     E***********         NFI        16 15 0             Online pos FX in 082738
     E***********         NFO        16 15 0             Online pos FX out082738
     E/COPY ZSRSRC,ZPOWERZ1                                               S01129
     E/COPY ZSRSRC,ZCCAL1Z1                                               S01176
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E                    TMMP    1   1 26               TIMESTAMP                            CSE039
      *
      /EJECT
     I              'BulkTrades        '  C         WPSET                                     CRE020
     I              'SETRADUPD '          C         WPRGMN                                    CRE020
      *                                                                                       CRE020
     IBULKTDF
      * Rename fields on bulk trade file
     I              RECI                            @BRECI
     I              TDRF                            @BTDRF
     I              TINC                            @BTINC
     I              TDSS                            @BTDSS
     I              TCNR                            @BTCNR
     I              TDTP                            @BTDTP
     I              NOML                            @BNOML
     I              TNMC                            @BTNMC
     I              TNMD                            @BTNMD
     I              TPDY                            @BTPDY
     I              TDVD                            @BTDVD
     I***********   TDBR                            @BTDBR                S01117
     I              TDBA                            @BTDBA                S01117
     I              ORBR                            @BORBR                S01117
     I              TDBK                            @BTDBK
     I              TDDT                            @BTDDT
     I              TSUB                            @BTSUB
     I              LKRF                            @BLKRF
     I              TDMI                            @BTDMI
     I              TDNR                            @BTDNR
     I              TDID                            @BTDID
     I              AIIP                            @BAIIP
     I              TMKC                            @BTMKC
     I              TCAP                            @BTCAP
     I              TCFC                            @BTCFC
     I              ACIN                            @BACIN
     I              DADJ                            @BDADJ
     I              ADIN                            @BADIN
     I              ITRA                            @BITRA
     I              TINA                            @BTINA
     I              TDCR                            @BTDCR
     I              PRIC                            @BPRIC
     I              EXDV                            @BEXDV
     I              RALL                            @BRALL
     I              SETC                            @BSETC
     I              TDER                            @BTDER
     I              TMDI                            @BTMDI
     I              TBCR                            @BTBCR
     I              SMTH                            @BSMTH
     I              PYFM                            @BPYFM
     I***********   PYFB                            @BPYFB                S01117
     I              PYFA                            @BPYFA                S01117
     I              PAYT                            @BPAYT
     I***********   PYTB                            @BPYTB                S01117
     I              PYTA                            @BPYTA                S01117
     I              TDFA                            @BTDFA
     I              ASNM                            @BASNM
     I              CLTY                            @BCLTY
     I              DELT                            @BDELT
     I              DTFA                            @BDTFA
     I**************CLRH                            @BCLRH                S01175
     I              DELF                            @BDELF
     I              DFFA                            @BDFFA                S01175
     I              TDSI                            @BTDSI
     I              PRYC                            @BPRYC
     I              PCOD                            @BPCOD
     I              TBCC                            @BTBCC
     I              TBCA                            @BTBCA
     I              TCCC                            @BTCCC
     I              TCCA                            @BTCCA
     I              TCC1                            @BTCC1
     I              TCA1                            @BTCA1
     I              TCC2                            @BTCC2
     I              TCA2                            @BTCA2
     I              TCC3                            @BTCC3
     I              TCA3                            @BTCA3
     I              TCC4                            @BTCC4                S01176
     I              TCA4                            @BTCA4                S01176
     I              TCC5                            @BTCC5                S01176
     I              TCA5                            @BTCA5                S01176
     I              TCC6                            @BTCC6                S01176
     I              TCA6                            @BTCA6                S01176
     I              TCC7                            @BTCC7                S01176
     I              TCA7                            @BTCA7                S01176
     I              TAXA                            @BTAXA                S01176
     I              BCMR                            @BBCMR                S01176
     I              CCMR                            @BCCMR                S01176
     I              TXRB                            @BTXRB                S01176
     I              BLKR                            @BBLKR                S01176
     I              RTRF                            @BRTRF                S01176
     I              ATRD                            @BATRD                S01176
     I              BCON                            @BBCON                S01176
     I              TIME                            @BTIME                S01176
     I              AUTS                            @BAUTS                S01176
     I***********   TLTC                            @BTLTC                S01176
     I***********   TLTA                            @BTLTA                S01176
     I***********   TOCC                            @BTOCC                S01176
     I***********   TOCA                            @BTOCA                S01176
     I              TACI                            @BTACI
     I              TMSI                            @BTMSI
     I              TCFR                            @BTCFR
     I              TOSN                            @BTOSN
     I              TNSN                            @BTNSN
     I              TNSP                            @BTNSP
     I              TOSV                            @BTOSV
     I              TVSN                            @BTVSN
     I              TVSP                            @BTVSP
     I              TDSN                            @BTDSN
     I              TDSP                            @BTDSP
     I              TDFS                            @BTDFS
     I              TSSQ                            @BTSSQ
     I              TCSR                            @BTCSR
     I              TCTR                            @BTCTR
     I              TDMC                            @BTDMC
     I              PRFC                            @BPRFC                S01117
     I              PRPC                            @BPRPC                S01117
     I              TOED                            @BTOED
     I              LCD                             @BLCD
     I              CHTP                            @BCHTP
     I              TNLU                            @BTNLU
     I              LSWS                            @BLSWS                S01117
     I***********   TTCC                            @BTTCC                S01176
     I***********   LTCA                            @BLTCA                S01176
     I***********   TPCC                            @BTPCC                S01176
     I***********   TPCA                            @BTPCA                S01176
     I***********   TVCA                            @BTVCA                S01176
     I***********   BLKR                            @BBLKR                S01176
     I***********   RTRF                            @BRTRF                S01176
     I***********   ATRD                            @BATRD                S01176
     I              PTFR                            @BPTFR                S01486
     I              SPXR                            @BSPXR                S01486
     I              SPMD                            @BSPMD                S01486
     I              BPRC                            @BBPRC                CAC002
     I              TPRC                            @BTPRC                CAC002
     I              FXMP                            @BFXMP                CAC002
     I              FXMR                            @BFXMR                CAC002
     I              MAMT                            @BMAMT                CAC002
     I              ICCY                            @BICCY                CEU005
     I              WHTX                            @BWHTX                CSE023
     I              BWDI                            @BBWDI                187727
     I              CRSK                            @BCRSK                                    CAS006
     I              LQPR                            @BLQPR                                    CAS006
     I              TINN                            @BTINN                                    CAS006
     I              ITRN                            @BITRN                                    CAS006
     I              PRICN                           @BPRCN                                    CAS006
     I              FSPR                            @BFSPR                                    233607
     I              FSPP                            @BFSPP                                    233607
     I              EUTX                            @BEUTX                                    234440
     I              EUTS                            @BEUTS                                    234440
      *                                                                                       CAS006
     ITRADSDF                                                                                 CAS006
      * Rename fields on trades file                                                          CAS006
     I              FRNT                            WFRNT                                     CAS006
     I              AFRT                            WAFRT                                     CAS006
     I              REPA                            WREPA                                     CAS006
     I              TMST                            WTMST                                     CAS006
     I*
     ISECTYDF
     I*
     I*  Rename nominal currency field
     I*
     I              NMCY                            NMCYA
     I*                                                                   065663
     ICUBRDDF                                                             065663
     I*                                                                   065663
     I*  Rename investment type  field                                    065663
     I*                                                                   065663
     I              SITP                            SITPX                 065663
     I*
     ICUBRDSE                                                             S01496
     I*                                                                   S01496
     I** Rename fields                                                    S01496
     I*                                                                   S01496
     I              SITP                            SITPA                 S01496
     I              CLGR                            CLGRA                 S01496
     I              TBCC                            DBCC                  S01496
     I*                                                                   082738
     I*                                                                   CAC003
     ISEPCCDF                                                             CAC003
     I*                                                                   CAC003
     I** Rename fields                                                    CAC003
     I*                                                                   CAC003
     I              PTFR                            PTFRXX                CAC003
      *                                                                                       CAS006
     ISEDEVD3                                                                                 CAS006
      ** Rename fields                                                                        CAS006
     I              RECI                            WERECI                                    CAS006
     I              SDSN                            WESDSN                                    CAS006
     I              SDED                            WESDED                                    CAS006
     I              SDET                            WESDET                                    CAS006
     I              SDNV                            WESDNV                                    CAS006
     I              SDVA                            WESDVA                                    CAS006
     I              SRPT                            WESRPT                                    CAS006
     I              SDTR                            WESDTR                                    CAS006
     I              SRMI                            WESRMI                                    CAS006
     I              SDPD                            WESDPD                                    CAS006
     I              SDNC                            WESDNC                                    CAS006
     I              SDPP                            WESDPP                                    CAS006
     I              SDPC                            WESDPC                                    CAS006
     I              SDTA                            WESDTA                                    CAS006
     I              SDTP                            WESDTP                                    CAS006
     I              SDRP                            WESDRP                                    CAS006
     I              SDCV                            WESDCV                                    CAS006
     I              SDCX                            WESDCX                                    CAS006
     I              SDCE                            WESDCE                                    CAS006
     I              SDMD                            WESDMD                                    CAS006
     I              NMCY                            WENMCY                                    CAS006
     I              SDAD                            WESDAD                                    CAS006
     I              SDDT                            WESDDT                                    CAS006
     I              RCIC                            WERCIC                                    CAS006
     I              LCD                             WELCD                                     CAS006
     I              CHTP                            WECHTP                                    CAS006
     I              TNLU                            WETNLU                                    CAS006
     I              SDCP                            WESDCP                                    CAS006
     I              SDXD                            WESDXD                                    CAS006
     I              FRNT                            WEFRNT                                    CAS006
     I              REPA                            WEREPA                                    CAS006
     I              SCRS                            WESCRS                                    CAS006
     I              SLQP                            WESLQP                                    CAS006
     I              SDNN                            WESDNN                                    CAS006
     I              SETX                            WESETX                                    234440
     ISEDEVD2                                                                                 234440
     I              SETX                            WESETX                                    234440
     ISEDEVDF                                                                                 234440
     I              SETX                            WESETX                                    234440
     ISEDEVDO                                                                                 234440
     I              SETX                            WESETX                                    234440
     ISEMVTSD1                                                                              BUG10273
     I              TMTRRF                          MVTRRF                                  BUG10273
     I              TMTRTY                          MVTRTY                                  BUG10273
     I              TMNTDT                          MVNTDT                                  BUG10273
     I              TMSQNR                          MVSQNR                                  BUG10273
     I              TMNTMT                          MVNTMT                                  BUG10273
     I              TMSWSC                          MVSWSC                                  BUG10273
     I              TMSWRC                          MVSWRC                                  BUG10273
     I              TMMSGK                          MVMSGK                                  BUG10273
     I              TMNARR                          MVNARR                                  BUG10273
     I              TMINOR                          MVINOR                                  BUG10273
     I              TMTRBB                          MVTRBB                                  BUG10273
     I              TMSCRQ                          MVSCRQ                                  BUG10273
     I              TMSTMG                          MVSTMG                                  BUG10273
     I              TMSSQN                          MVSSQN                                  BUG10273
     I              TMFRNT                          MVFRNT                                  BUG10273
     I              TMAFRT                          MVAFRT                                  BUG10273
     I              TMREPA                          MVREPA                                  BUG10273
     I              TMTMST                          MVTMST                                  BUG10273
     I              TMLCTP                          MVLCTP                                  BUG10273
     I              TMLCDT                          MVLCDT                                  BUG10273
     I              TMLCUS                          MVLCUS                                  BUG10273
      *                                                                                       CSE028
      ** DS for customer/book standard settlement instruction                                 CSE028
      **  to be passed to SESSIR0                                                             CSE028
      *                                                                                       CSE028
     IPCBSTD    E DSSTDSED                    2                                               CSE028
     I              RECI                            WRECI                                     CSE028
     I              LCD                             WLCD                                      CSE028
     I              CHTP                            WCHTP                                     CSE028
     I              TNLU                            WTNLU                                     CSE028
      *                                                                                       CSE028
      ** Data structure for standard additional settlement details                            CSE028
      ** for customer/book to be passed to SESSIR0                                            CSE028
      *                                                                                       CSE028
     IPCBSAD    E DSSTDADSED                  8                                               CSE028
     I*                                                                   CAC003
     IZ#BSTS    E DSZ#BST                                                 082738
     IZ#ASTS    E DSZ#AST                                                 082738
     I*                                                                   082738
     I            DS
      * Data structure for compilation - Copyright insertion
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
     I@DSACC      DS
      *
      *  D.S. to make up KLIST for file ACCNT
      *
     I**********                              1   60CNUM                                      CSD027
     I                                        1   6 CNUM                                      CSD027
     I                                        7   9 CCY
     I**********                             10  130ACOD                                      CGL029
     I**********                             14  150ACSQ                                      CGL029
     I**********                             16  18 BRCA                               S01117 CGL029
     I                                       10  190ACOD                                      CGL029
     I                                       20  210ACSQ                                      CGL029
     I                                       22  24 BRCA                                      CGL029
      *                                                                   CSW003
     I            DS                                                      CSW003
      ** KMGECO data structure                                            CSW003
     I                                        1  20 WWGECO                CSW003
     I                                        1   5 WWSENT                CSW003
     I                                        6  12 WWINST                CSW003
     I                                       13  20 WWINSS                CSW003
      *                                                                   CSW003
      ** Security Details Data Structure                                                      234440
     I@SECTY    E DSSECTYD                                                                    234440
     I              RECI                            RECIA                                     234440
     I              NMCY                            NMCYA                                     234440
     I              ZZ005                           ZZ005A                                    234440
     I              CHTP                            CHTPA                                     234440
     I              TNLU                            TNLUA                                     234440
     I              REPI                            REPIA                                     234440
     I              REPA                            REPAA                                     234440
     I              LCD                             LCDTA                                     234440
     I              FRNT                            FRNTA                                     234440
     I              TMST                            TMSTA                                     234440
     I              CD01                            CD01A                                     234440
     I              CD02                            CD02A                                     234440
     I              CD03                            CD03A                                     234440
     I              CD04                            CD04A                                     234440
     I              CD05                            CD05A                                     234440
     I              CD06                            CD06A                                     234440
     I              CD07                            CD07A                                     234440
     I              CD08                            CD08A                                     234440
     I              CD09                            CD09A                                     234440
     I              CD10                            CD10A                                     234440
     I              CD11                            CD11A                                     234440
     I              CD12                            CD12A                                     234440
     I              CR01                            CR01A                                     234440
     I              CR02                            CR02A                                     234440
     I              CR03                            CR03A                                     234440
     I              CR04                            CR04A                                     234440
     I              CR05                            CR05A                                     234440
     I              CR06                            CR06A                                     234440
     I              CR07                            CR07A                                     234440
     I              CR08                            CR08A                                     234440
     I              CR09                            CR09A                                     234440
     I              CR10                            CR10A                                     234440
     I              CR11                            CR11A                                     234440
     I              CR12                            CR12A                                     234440
      ** Investment Proportion Data Structure                                                 234440
     I@INVTP    E DSINVTPD                                                                    234440
     I              RECI                            RECIB                                     234440
     I              LCD                             LCDTB                                     234440
     I              CHTP                            CHTPB                                     234440
     I              TNLU                            TNLUB                                     234440
     I              NDEC                            NDECB                                     CGL035
      ** Customer (Counterparty) Details Data Structure                                       234440
     I@PCUST      DS                                                                          234440
     I                                        1   6 CUSTN                                     234440
     I                                       16  16 CUSTC                                     234440
     I                                       48  49 CUSTL                                     234440
      ** Data structures to hold Security & Investment Type details.                          234440
     I@PSECT      DS                            899                                           234440
     I@PINVT      DS                            122                                           234440
     I@CUSDT      DS                                                                          234552
      ** Customer (Counterparty) Details                                                      234552
     I                                        1   6 WCUSNU                                    234552
     I                                        7  10 WCUSAC                                    234552
     I                                       11  13 WCUSCU                                    234552
     I                                       14  150WCUSSQ                                    234552
     I                                       16  16 WCUSCL                                    234552
     I                                       17  22 WCUSD1                                    234552
     I                                       23  28 WCUSD2                                    234552
     I                                       29  30 WCUSP1                                    234552
     I                                       31  32 WCUSP2                                    234552
     I                                       33  34 WCUSTA                                    234552
     I                                       35  35 WCUSAU                                    234552
     I                                       36  37 WCUSTD                                    234552
     I                                       38  38 WLPCUS                                    234552
     I                                       39  41 WCUSBY                                    234552
     I                                       42  420WCUSDP                                    234552
     I                                       43  46 WCUSPO                                    234552
     I                                       47  47 WPBCUS                                    234552
     I                                       48  49 WCUSCO                                    234552
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZYLDZ1
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
      *
      ***Define*Balance*fields*in*MEMOS***
     I**039*****  DS
     I**********                              1  150LGBL
     I**********                             16  300BKBL
     I/COPY ZSRSRC,ZTNLU1Z1
     I@CMTXT      DS
      *  Data structure to provide text on COMIT
     I                                        1   50@NTN
     I                                        6   7 @MID
     I                                        8  15 @PGM
     I                                       16  18 @WID
     I                                       19  240@TIME
     I                                       25  25 @ACTN
     I                                       26  35 @USER
     ILDA         DS                            256
      *  Error reporting data structure
     I*                                                                   S01117
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I                                      134 183 @DBALL                S01117
     I                                      134 141 @DBFIL                S01117
     I                                      142 170 @DBKEY                S01117
     I                                      171 180 @DBPGM                S01117
     I                                      181 1830@DBASE                S01117
     I***********                           134 138 @DBFIL                S01117
     I***********                           139 167 @DBKEY                S01117
     I***********                           168 175 @DBPGM                S01117
     I***********                           176 1770@DBASE                S01117
     I***********                           134 177 @DBALL                S01117
     IPSDS       SDS
      *  Program status data structure
     I                                      244 253 @JOB
     I                                      254 263 @USR
     I*********** DS                                                      E36791
      ***Fields*used*in*ZRATE*-*data*structure****************************E36791
     I***********                             1   1 ZPROT                 E36791
     I***********                             3  170ZSFPP                 E36791
     I***********                            18  320ZSINP                 E36791
      **From*INVTPD*******************************************************E36791
     I***********                             1   1 PROT                  E36791
      **From*SECTYD*******************************************************E36791
     I***********                             3  170SFPP                  E36791
     I***********                            18  320SINP                  E36791
      *  For transfer of bulk details to trade
     I@TRDDS    E DSTRADSD
      ***For*transfer*of*bulk*details*to*trade***                         S01175
     I*@BLKDS***** DS                            464                S01176S01175
     I*@BLKDS******DS                                               S01176S01175
     I**************                          1   1 @BRECI                S01175
     I*************                           2   7 @BTDRF                S01175
     I*************                           8   8 @BTINC                S01175
     I*************                           9  18 @BTDSS                S01175
     I*************                          19  240@BTCNR                S01175
     I*************                          25  26 @BTDTP                S01175
     I*************                       P  27  320@BNOML                S01175
     I*************                          33  35 @BTNMC                S01175
     I*************                       P  36  360@BTNMD                S01175
     I*************                       P  37  448@BTPDY                S01175
     I*************                       P  45  470@BTDVD                S01175
     I*************                          48  500@BTDBR                S01175
     I*************                          51  52 @BTDBK                S01175
     I*************                       P  53  550@BTDDT                S01175
     I*************                          56  57 @BTSUB                S01175
     I*************                          58  63 @BLKRF                S01175
     I*************                          64  64 @BTDMI                S01175
     I*************                          65  99 @BTDNR                S01175
     I*************                         100 102 @BTDID                S01175
     I*************                         103 103 @BAIIP                S01175
     I*************                         104 105 @BTMKC                S01175
     I*************                         106 1060@BTCAP                S01175
     I*************                       P 107 1118@BTCFC                S01175
     I*************                         112 112 @BACIN                S01175
     I*************                       P 113 1140@BDADJ                S01175
     I*************                         115 115 @BADIN                S01175
     I*************                       P 116 1220@BITRA                S01175
     I*************                       P 123 1290@BTINA                S01175
     I*************                       P 130 1357@BTDCR                S01175
     I*************                       P 136 1438@BPRIC                S01175
     I*************                         144 144 @BEXDV                S01175
     I*************                       P 145 1495@BRALL                S01175
     I*************                         150 152 @BSETC                S01175
     I*************                       P 153 1598@BTDER                S01175
     I*************                         160 160 @BTMDI                S01175
     I*************                       P 161 1678@BTBCR                S01175
     I*************                         168 1690@BSMTH                S01175
     I*************                         170 181 @BPYFM                S01175
     I*************                         182 1840@BPYFB                S01175
     I*************                         185 196 @BPAYT                S01175
     I*************                         197 1990@BPYTB                S01175
     I*************                         200 207 @BTDFA                S01175
     I*************                         208 2090@BASNM                S01175
     I*************                         210 210 @BCLTY                S01175
     I*************                         211 2160@BDELT                S01175
     I*************                         217 224 @BDTFA                S01175
     I*************                         225 225 @BCLRH                S01175
     I*************                         226 2310@BDELF                S01175
     I*************                         232 266 @BTDSI                S01175
     I*************                         267 267 @BPRYC                S01175
     I*************                         268 268 @BPCOD                S01175
     I*************                         269 270 @BTBCC                S01175
     I*************                       P 271 2770@BTBCA                S01175
     I*************                         278 279 @BTCCC                S01175
     I*************                       P 280 2860@BTCCA                S01175
     I*************                         287 288 @BTCC1                S01175
     I*************                       P 289 2950@BTCA1                S01175
     I*************                         296 297 @BTCC2                S01175
     I*************                       P 298 3040@BTCA2                S01175
     I*************                         305 306 @BTCC3                S01175
     I*************                       P 307 3130@BTCA3                S01175
     I*************                         314 315 @BTCC4          S01176S01175
     I*************                       P 316 3220@BTCA4          S01176S01175
     I*************                         323 324 @BTCC5          S01176S01175
     I*************                       P 325 3310@BTCA5          S01176S01175
     I*************                         332 333 @BTCC6          S01176S01175
     I*************                       P 334 3400@BTCA6          S01176S01175
     I*************                         341 342 @BTCC7          S01176S01175
     I*************                       P 343 3490@BTCA7          S01176S01175
     I*************                       P 350 3560@BTAXA          S01176S01175
     I*************                       P 357 3630@BBCMR          S01176S01175
     I*************                       P 364 3700@BCCMR          S01176S01175
     I*************                       P 371 3770@BTXRB          S01176S01175
     I*************                         378 383 @BBLKR          S01176S01175
     I*************                         384 389 @BRTRF          S01176S01175
     I*************                         390 390 @BATRD          S01176S01175
     I*************                         391 391 @BBCON          S01176S01175
     I*************                         392 3970@BTIME          S01176S01175
     I*************                         398 398 @BAUTS          S01176S01175
     I*************                         314 315 @BTLTC          S01176S01175
     I*************                       P 316 3220@BTLTA          S01176S01175
     I*************                         323 324 @BTOCC          S01176S01175
     I*************                       P 325 3310@BTOCA          S01176S01175
     I*************                         332 332 @BTACI          S01176S01175
     I*************                         333 333 @BTMSI          S01176S01175
     I*************                       P 335 3400@BTOSN          S01176S01175
     I*************                       P 341 3460@BTNSN          S01176S01175
     I*************                       P 347 3520@BTNSP          S01176S01175
     I*************                       P 353 3600@BTOSV          S01176S01175
     I*************                       P 361 3680@BTVSN          S01176S01175
     I*************                       P 369 3760@BTVSP          S01176S01175
     I*************                       P 377 3840@BTDSN          S01176S01175
     I*************                       P 385 3920@BTDSP          S01176S01175
     I*************                       P 393 3950@BTDFS          S01176S01175
     I*************                       P 396 3970@BTSSQ          S01176S01175
     I*************                       P 398 4050@BTCSR          S01176S01175
     I*************                       P 406 4130@BTCTR          S01176S01175
     I*************                       P 414 4160@BTDMC          S01176S01175
     I*************                       P 417 4190@BTOED          S01176S01175
     I*************                       P 420 4220@BLCD           S01176S01175
     I*************                         423 423 @BCHTP          S01176S01175
     I*************                       P 424 4260@BTNLU          S01176S01175
     I*************                         399 399 @BTACI          S01176S01175
     I*************                         400 400 @BTMSI          S01176S01175
     I*************                         401 401 @BTCFR          S01176S01175
     I*************                       P 402 4070@BTOSN          S01176S01175
     I*************                       P 408 4130@BTNSN          S01176S01175
     I*************                       P 414 4190@BTNSP          S01176S01175
     I*************                       P 420 4270@BTOSV          S01176S01175
     I*************                       P 428 4350@BTVSN          S01176S01175
     I*************                       P 436 4430@BTVSP          S01176S01175
     I*************                       P 444 4510@BTDSN          S01176S01175
     I*************                       P 452 4590@BTDSP          S01176S01175
     I*************                       P 460 4620@BTDFS          S01176S01175
     I*************                       P 463 4640@BTSSQ          S01176S01175
     I*************                       P 465 4720@BTCSR          S01176S01175
     I*************                       P 473 4800@BTCTR          S01176S01175
     I*************                       P 481 4830@BTDMC          S01176S01175
     I*************                       P 484 4860@BTOED          S01176S01175
     I*************                       P 487 4890@BLCD           S01176S01175
     I*************                         490 490 @BCHTP          S01176S01175
     I*************                       P 491 4930@BTNLU          S01176S01175
     I***********                           427 428 @BTTCC          S01176S01175
     I***********                         P 429 4350@BLTCA          S01176S01175
     I***********                           436 437 @BTPCC          S01176S01175
     I***********                         P 438 4440@BTPCA          S01176S01175
     I***********                         P 445 4510@BTVCA          S01176S01175
     I***********                           452 457 @BBLKR          S01176S01175
     I***********                           458 463 @BRTRF          S01176S01175
     I***********                           464 464 @BATRD          S01176S01175
     I*
     I@BLKDS      DS                                                      S01175
      *  For transfer of bulk details to trade                            S01175
     I                                        1   1 @BRECI                S01175
     I                                        2   7 @BTDRF                S01175
     I                                        8   8 @BTINC                S01175
     I                                        9  18 @BTDSS                S01175
     I**********                             19  240@BTCNR                             S01175 CSD027
     I                                       19  24 @BTCNR                                    CSD027
     I                                       25  26 @BTDTP                S01175
     I                                    P  27  320@BNOML                S01175
     I                                       33  35 @BTNMC                S01175
     I                                    P  36  360@BTNMD                S01175
     I                                    P  37  448@BTPDY                S01175
     I                                    P  45  470@BTDVD                S01175
     I***********                            48  500@BTDBR         S01175 S01117
     I***********                            51  52 @BTDBK         S01175 S01117
     I***********                         P  53  550@BTDDT         S01175 S01117
     I***********                            56  57 @BTSUB         S01175 S01117
     I***********                            58  63 @BLKRF         S01175 S01117
     I***********                            64  64 @BTDMI         S01175 S01117
     I***********                            65  99 @BTDNR         S01175 S01117
     I***********                           100 102 @BTDID         S01175 S01117
     I***********                           103 103 @BAIIP         S01175 S01117
     I***********                           104 105 @BTMKC         S01175 S01117
     I***********                           106 1060@BTCAP         S01175 S01117
     I***********                         P 107 1118@BTCFC         S01175 S01117
     I***********                           112 112 @BACIN         S01175 S01117
     I***********                         P 113 1140@BDADJ         S01175 S01117
     I***********                           115 115 @BADIN         S01175 S01117
     I***********                         P 116 1220@BITRA         S01175 S01117
     I***********                         P 123 1290@BTINA         S01175 S01117
     I***********                         P 130 1357@BTDCR         S01175 S01117
     I***********                         P 136 1438@BPRIC         S01175 S01117
     I***********                           144 144 @BEXDV         S01175 S01117
     I***********                         P 145 1495@BRALL         S01175 S01117
     I***********                           150 152 @BSETC         S01175 S01117
     I***********                         P 153 1598@BTDER         S01175 S01117
     I***********                           160 160 @BTMDI         S01175 S01117
     I***********                         P 161 1678@BTBCR         S01175 S01117
     I***********                           168 1690@BSMTH         S01175 S01117
     I***********                           170 181 @BPYFM         S01175 S01117
     I***********                           182 1840@BPYFB         S01175 S01117
     I***********                           185 196 @BPAYT         S01175 S01117
     I***********                           197 1990@BPYTB         S01175 S01117
     I***********                           200 207 @BTDFA         S01175 S01117
     I***********                           208 2090@BASNM         S01175 S01117
     I***********                           210 210 @BCLTY         S01175 S01117
     I***********                           211 2160@BDELT         S01175 S01117
     I***********                           217 224 @BDTFA         S01175 S01117
     I***********                           225 2300@BDELF         S01175 S01117
     I***********                           231 238 @BDFFA         S01175 S01117
     I***********                           239 273 @BTDSI         S01175 S01117
     I***********                           274 274 @BPRYC         S01175 S01117
     I***********                           275 275 @BPCOD         S01175 S01117
     I***********                           276 277 @BTBCC         S01175 S01117
     I***********                         P 278 2840@BTBCA         S01175 S01117
     I***********                           285 286 @BTCCC         S01175 S01117
     I***********                         P 287 2930@BTCCA         S01175 S01117
     I***********                           294 295 @BTCC1         S01175 S01117
     I***********                         P 296 3020@BTCA1         S01175 S01117
     I***********                           303 304 @BTCC2         S01175 S01117
     I***********                         P 305 3110@BTCA2         S01175 S01117
     I***********                           312 313 @BTCC3         S01175 S01117
     I***********                         P 314 3200@BTCA3         S01175 S01117
     I***********                           321 322 @BTCC4         S01175 S01117
     I***********                         P 323 3290@BTCA4         S01175 S01117
     I***********                           330 331 @BTCC5         S01175 S01117
     I***********                         P 332 3380@BTCA5         S01175 S01117
     I***********                           339 340 @BTCC6         S01175 S01117
     I***********                         P 341 3470@BTCA6         S01175 S01117
     I***********                           348 349 @BTCC7         S01175 S01117
     I***********                         P 350 3560@BTCA7         S01175 S01117
     I***********                         P 357 3630@BTAXA         S01175 S01117
     I***********                         P 364 3700@BBCMR         S01175 S01117
     I***********                         P 371 3770@BCCMR         S01175 S01117
     I***********                         P 378 3840@BTXRB         S01175 S01117
     I***********                           385 390 @BBLKR         S01175 S01117
     I***********                           391 396 @BRTRF         S01175 S01117
     I***********                           397 397 @BATRD         S01175 S01117
     I***********                           398 398 @BBCON         S01175 S01117
     I***********                           399 4040@BTIME         S01175 S01117
     I***********                           405 405 @BAUTS         S01175 S01117
     I***********                           406 406 @BTACI         S01175 S01117
     I***********                           407 407 @BTMSI         S01175 S01117
     I***********                           408 408 @BTCFR         S01175 S01117
     I***********                         P 409 4140@BTOSN         S01175 S01117
     I***********                         P 415 4200@BTNSN         S01175 S01117
     I***********                         P 421 4260@BTNSP         S01175 S01117
     I***********                         P 427 4340@BTOSV         S01175 S01117
     I***********                         P 435 4420@BTVSN         S01175 S01117
     I***********                         P 443 4500@BTVSP         S01175 S01117
     I***********                         P 451 4580@BTDSN         S01175 S01117
     I***********                         P 459 4660@BTDSP         S01175 S01117
     I***********                         P 467 4690@BTDFS         S01175 S01117
     I***********                         P 470 4710@BTSSQ         S01175 S01117
     I***********                         P 472 4790@BTCSR         S01175 S01117
     I***********                         P 480 4870@BTCTR         S01175 S01117
     I***********                         P 488 4900@BTDMC         S01175 S01117
     I***********                         P 491 4930@BTOED         S01175 S01117
     I***********                         P 494 4960@BLCD          S01175 S01117
     I***********                           497 497 @BCHTP         S01175 S01117
     I***********                         P 498 5000@BTNLU         S01175 S01117
     I                                       48  50 @BTDBA                S01117
     I                                       51  53 @BORBR                S01117
     I                                       54  55 @BTDBK                S01117
     I                                    P  56  580@BTDDT                S01117
     I                                       59  60 @BTSUB                S01117
     I                                       61  66 @BLKRF                S01117
     I                                       67  67 @BTDMI                S01117
     I                                       68 102 @BTDNR                S01117
     I                                      103 105 @BTDID                S01117
     I                                      106 106 @BAIIP                S01117
     I                                      107 108 @BTMKC                S01117
     I                                      109 1090@BTCAP                S01117
     I**********                          P 110 1148@BTCFC         S01117 052254
     I                                      110 114 @ZZ005                052254
     I                                      115 115 @BACIN                S01117
     I                                    P 116 1170@BDADJ                S01117
     I                                      118 118 @BADIN                S01117
     I                                    P 119 1250@BITRA                S01117
     I                                    P 126 1320@BTINA                S01117
     I                                    P 133 1387@BTDCR                S01117
     I                                    P 139 1468@BPRIC                S01117
     I                                      147 147 @BEXDV                S01117
     I                                    P 148 1525@BRALL                S01117
     I                                      153 155 @BSETC                S01117
     I                                    P 156 1628@BTDER                S01117
     I                                      163 163 @BTMDI                S01117
     I                                    P 164 1708@BTBCR                S01117
     I                                      171 1720@BSMTH                S01117
     I**********                            173 184 @BPYFM                             S01117 CGL029
     I                                      173 184 QQPYFM                                    CGL029
     I                                      185 187 @BPYFA                S01117
     I**********                            188 199 @BPAYT                             S01117 CGL029
     I                                      188 199 QQPAYT                                    CGL029
     I                                      200 202 @BPYTA                S01117
     I                                      203 210 @BTDFA                S01117
     I                                      211 2120@BASNM                S01117
     I                                      213 213 @BCLTY                S01117
     I**********                            214 2190@BDELT                             S01117 CSD027
     I                                      214 219 @BDELT                                    CSD027
     I                                      220 227 @BDTFA                S01117
     I**********                            228 2330@BDELF                             S01117 CSD027
     I                                      228 233 @BDELF                                    CSD027
     I                                      234 241 @BDFFA                S01117
     I                                      242 276 @BTDSI                S01117
     I                                      277 277 @BPRYC                S01117
     I                                      278 278 @BPCOD                S01117
     I                                      279 280 @BTBCC                S01117
     I                                    P 281 2870@BTBCA                S01117
     I                                      288 289 @BTCCC                S01117
     I                                    P 290 2960@BTCCA                S01117
     I                                      297 298 @BTCC1                S01117
     I                                    P 299 3050@BTCA1                S01117
     I                                      306 307 @BTCC2                S01117
     I                                    P 308 3140@BTCA2                S01117
     I                                      315 316 @BTCC3                S01117
     I                                    P 317 3230@BTCA3                S01117
     I                                      324 325 @BTCC4                S01117
     I                                    P 326 3320@BTCA4                S01117
     I                                      333 334 @BTCC5                S01117
     I                                    P 335 3410@BTCA5                S01117
     I                                      342 343 @BTCC6                S01117
     I                                    P 344 3500@BTCA6                S01117
     I                                      351 352 @BTCC7                S01117
     I                                    P 353 3590@BTCA7                S01117
     I                                    P 360 3660@BTAXA                S01117
     I                                    P 367 3730@BBCMR                S01117
     I                                    P 374 3800@BCCMR                S01117
     I                                    P 381 3870@BTXRB                S01117
     I                                      388 393 @BBLKR                S01117
     I                                      394 399 @BRTRF                S01117
     I                                      400 400 @BATRD                S01117
     I                                      401 401 @BBCON                S01117
     I                                      402 4070@BTIME                S01117
     I                                      408 408 @BAUTS                S01117
     I                                      409 409 @BTACI                S01117
     I                                      410 410 @BTMSI                S01117
     I                                      411 411 @BTCFR                S01117
     I                                    P 412 4170@BTOSN                S01117
     I                                    P 418 4230@BTNSN                S01117
     I                                    P 424 4290@BTNSP                S01117
     I                                    P 430 4370@BTOSV                S01117
     I                                    P 438 4450@BTVSN                S01117
     I                                    P 446 4530@BTVSP                S01117
     I                                    P 454 4610@BTDSN                S01117
     I                                    P 462 4690@BTDSP                S01117
     I                                    P 470 4720@BTDFS                S01117
     I                                    P 473 4740@BTSSQ                S01117
     I                                    P 475 4820@BTCSR                S01117
     I                                    P 483 4900@BTCTR                S01117
     I                                    P 491 4930@BTDMC                S01117
     I                                    P 494 4960@BTOED                S01117
     I                                      497 500 @BPRFC                S01117
     I                                      501 501 @BPRPC                S01117
     I                                    P 502 5040@BLCD                 S01117
     I                                      505 505 @BCHTP                S01117
     I                                    P 506 5080@BTNLU                S01117
     I                                    P 509 5100@BLSWS                S01117
     I                                    P 511 5169@BTCFC                052254
     I                                      517 520 @BPTFR                S01486
     I                                    P 521 5278@BSPXR                S01486
     I                                      528 528 @BSPMD                S01486
     I                                      529 532 @BBPRC                CAC002
     I                                      533 536 @BTPRC                CAC002
     I                                    P 537 5402@BFXMP                CAC002
     I                                    P 541 5478@BFXMR                CAC002
     I                                    P 548 5540@BMAMT                CAC002
     I                                      555 557 @BICCY                CEU005
     I                                    P 558 5640@BWHTX                CSE023
     I                                      565 565 @BBWDI                187727
     I                                    P 566 5738@BCRSK                                    CAS006
     I                                    P 574 5818@BLQPR                                    CAS006
     I                                    P 582 5880@BTINN                                    CAS006
     I                                    P 589 5950@BITRN                                    CAS006
     I                                    P 596 6038@BPRCN                                    CAS006
     I**********                            642 659 @BPYFM                             CGL029 233607
     I**********                            660 677 @BPAYT                             CGL029 233607
     I**********                            604 621 @BPYFM                             233607 CGL035
     I**********                            622 639 @BPAYT                             233607 CGL035
     I**********                          P 640 6478@BFSPR                             234440 CGL035
     I**********                          P 648 6558@BFSPP                             234440 CGL035
     I**********                          P 656 6620@BEUTX                             234440 CGL035
     I**********                          P 663 6690@BEUTS                             234440 CGL035
     I                                      680 697 @BPYFM                                    CGL035
     I                                      698 715 @BPAYT                                    CGL035
     I                                    P 716 7238@BFSPR                                    CGL035
     I                                    P 724 7318@BFSPP                                    CGL035
     I                                    P 732 7380@BEUTX                                    CGL035
     I                                    P 739 7450@BEUTS                                    CGL035
      *                                                                   S01175
     IWBLKY1    E DSBULKSDX1                                              S01401
      **  Data structure for transfer of bulk details BULKSDX1            S01401
      **  to trade TRADSDX1. Defining WBLKY1                              S01401
      *                                                                   S01401
     IWBLKY2    E DSBULKSDX2                                              S01401
      **  Data structure for transfer of bulk details BULKSDX2            S01401
      **  to trade TRADSDX2. Defining WBLKY2                              S01401
      *                                                                   S01401
     IWTRDY1    E DSTRADSDX1                                              S01401
      **  Data structure for receiving trade details TRADSDX1             S01401
      **  from bulk BULKSDX1. Defining WTRDY1                             S01401
      *                                                                   S01401
     IWTRDY2    E DSTRADSDX2                                              S01401
      **  Data structure for receiving trade details TRADSDX2             S01401
      **  from bulk BULKSDX2. Defining WTRDY2                             S01401
      *                                                                   S01401
     IOTRDDS    E DSTRADSD                                                                    CSD015
      ** Data structure for transfer of trade details TRADSD                                  CSD015
      ** Rename fields from trades file to compare if changes occur                           CSD015
     I              RECI                            O1RECI                                    CSD015
     I              TDRF                            O1TDRF                                    CSD015
     I              TINC                            O1TINC                                    CSD015
     I              TDSS                            O1TDSS                                    CSD015
     I              TCNR                            O1TCNR                                    CSD015
     I              TDTP                            O1TDTP                                    CSD015
     I              NOML                            O1NOML                                    CSD015
     I              TNMC                            O1TNMC                                    CSD015
     I              TNMD                            O1TNMD                                    CSD015
     I              TPDY                            O1TPDY                                    CSD015
     I              TDVD                            O1TDVD                                    CSD015
     I              TDBA                            O1TDBA                                    CSD015
     I              ORBR                            O1ORBR                                    CSD015
     I              TDBK                            O1TDBK                                    CSD015
     I              TDDT                            O1TDDT                                    CSD015
     I              TSUB                            O1TSUB                                    CSD015
     I              LKRF                            O1LKRF                                    CSD015
     I              TDMI                            O1TDMI                                    CSD015
     I              TDNR                            O1TDNR                                    CSD015
     I              TDID                            O1TDID                                    CSD015
     I              AIIP                            O1AIIP                                    CSD015
     I              TMKC                            O1TMKC                                    CSD015
     I              TCAP                            O1TCAP                                    CSD015
     I              ZZ005                           OZZ005                                    CSD015
     I              TCFC                            O1TCFC                                    CSD015
     I              ACIN                            O1ACIN                                    CSD015
     I              DADJ                            O1DADJ                                    CSD015
     I              ADIN                            O1ADIN                                    CSD015
     I              ITRA                            O1ITRA                                    CSD015
     I              TINA                            O1TINA                                    CSD015
     I              TDCR                            O1TDCR                                    CSD015
     I              PRIC                            O1PRIC                                    CSD015
     I              EXDV                            O1EXDV                                    CSD015
     I              RALL                            O1RALL                                    CSD015
     I              SETC                            O1SETC                                    CSD015
     I              TDER                            O1TDER                                    CSD015
     I              TMDI                            O1TMDI                                    CSD015
     I              TBCR                            O1TBCR                                    CSD015
     I              SMTH                            O1SMTH                                    CSD015
     I              PYFM                            O1PYFM                                    CSD015
     I              PYFA                            O1PYFA                                    CSD015
     I              PAYT                            O1PAYT                                    CSD015
     I              PYTA                            O1PYTA                                    CSD015
     I              TDFA                            O1TDFA                                    CSD015
     I              ASNM                            O1ASNM                                    CSD015
     I              CLTY                            O1CLTY                                    CSD015
     I              DELT                            O1DELT                                    CSD015
     I              DTFA                            O1DTFA                                    CSD015
     I              DELF                            O1DELF                                    CSD015
     I              DFFA                            O1DFFA                                    CSD015
     I              TDSI                            O1TDSI                                    CSD015
     I              PRYC                            O1PRYC                                    CSD015
     I              PCOD                            O1PCOD                                    CSD015
     I              TBCC                            O1TBCC                                    CSD015
     I              TBCA                            O1TBCA                                    CSD015
     I              TCCC                            O1TCCC                                    CSD015
     I              TCCA                            O1TCCA                                    CSD015
     I              TCC1                            O1TCC1                                    CSD015
     I              TCA1                            O1TCA1                                    CSD015
     I              TCC2                            O1TCC2                                    CSD015
     I              TCA2                            O1TCA2                                    CSD015
     I              TCC3                            O1TCC3                                    CSD015
     I              TCA3                            O1TCA3                                    CSD015
     I              TCC4                            O1TCC4                                    CSD015
     I              TCA4                            O1TCA4                                    CSD015
     I              TCC5                            O1TCC5                                    CSD015
     I              TCA5                            O1TCA5                                    CSD015
     I              TCC6                            O1TCC6                                    CSD015
     I              TCA6                            O1TCA6                                    CSD015
     I              TCC7                            O1TCC7                                    CSD015
     I              TCA7                            O1TCA7                                    CSD015
     I              TAXA                            O1TAXA                                    CSD015
     I              BCMR                            O1BCMR                                    CSD015
     I              CCMR                            O1CCMR                                    CSD015
     I              TXRB                            O1TXRB                                    CSD015
     I              BLKR                            O1BLKR                                    CSD015
     I              RTRF                            O1RTRF                                    CSD015
     I              ATRD                            O1ATRD                                    CSD015
     I              BCON                            O1BCON                                    CSD015
     I              TIME                            O1TIME                                    CSD015
     I              AUTS                            O1AUTS                                    CSD015
     I              TACI                            O1TACI                                    CSD015
     I              TMSI                            O1TMSI                                    CSD015
     I              TCFR                            O1TCFR                                    CSD015
     I              TOSN                            O1TOSN                                    CSD015
     I              TNSN                            O1TNSN                                    CSD015
     I              TNSP                            O1TNSP                                    CSD015
     I              TOSV                            O1TOSV                                    CSD015
     I              TVSN                            O1TVSN                                    CSD015
     I              TVSP                            O1TVSP                                    CSD015
     I              TDSN                            O1TDSN                                    CSD015
     I              TDSP                            O1TDSP                                    CSD015
     I              TDFS                            O1TDFS                                    CSD015
     I              TSSQ                            O1TSSQ                                    CSD015
     I              TCSR                            O1TCSR                                    CSD015
     I              TCTR                            O1TCTR                                    CSD015
     I              TDMC                            O1TDMC                                    CSD015
     I              TOED                            O1TOED                                    CSD015
     I              PRFC                            O1PRFC                                    CSD015
     I              PRPC                            O1PRPC                                    CSD015
     I              LCD                             O1LCD                                     CSD015
     I              CHTP                            O1CHTP                                    CSD015
     I              TNLU                            O1TNLU                                    CSD015
     I              LSWS                            O1LSWS                                    CSD015
     I              PTFR                            O1PTFR                                    CSD015
     I              SPXR                            O1SPXR                                    CSD015
     I              SPMD                            O1SPMD                                    CSD015
     I              BPRC                            O1BPRC                                    CSD015
     I              TPRC                            O1TPRC                                    CSD015
     I              FXMP                            O1FXMP                                    CSD015
     I              FXMR                            O1FXMR                                    CSD015
     I              MAMT                            O1MAMT                                    CSD015
     I              ICCY                            O1ICCY                                    CSD015
     I              COAF                            O1COAF                                    CSD015
     I              FRNT                            O1FRNT                                    CSD015
     I              AFRT                            O1AFRT                                    CSD015
     I              REPA                            O1REPA                                    CSD015
     I              TMST                            O1TMST                                    CSD015
     I              ORDE                            O1ORDE                                    CSD015
     I              REPI                            O1REPI                                    CSD015
     I              AUTH                            O1AUTH                                    CSD015
     I              WHTX                            O1WHTX                                    CSD015
     I              BWDI                            O1BWDI                                    CSD015
     I              CRSK                            O1CRSK                                    CAS006
     I              LQPR                            O1LQPR                                    CAS006
     I              TINN                            O1TINN                                    CAS006
     I              ITRN                            O1ITRN                                    CAS006
     I              PRICN                           O1PRCN                                    CAS006
     I              PYFMQQ                          QQPYF1                                    CGL029
     I              PAYTQQ                          QQPAY1                                    CGL029
     I              FSPR                            O1FSPR                                    CGL035
     I              FSPP                            O1FSPP                                    CGL035
     I              EUTX                            O1EUTX                                    CGL035
     I              EUTS                            O1EUTS                                    CGL035
      *
     IOTRDY2    E DSTRADSDX2                                                                  CSD015
      ** Data structure for transfer of trade details TRADSDX2                                CSD015
      ** Rename fields from extention file to compare if changes occur                        CSD015
     I              T2TDRF                          O2TDRF                                    CSD015
     I              T2AP1N                          O2AP1N                                    CSD015
     I              T2AP1L                          O2AP1L                                    CSD015
     I              T2AFPN                          O2AFPN                                    CSD015
     I              T2AFPL                          O2AFPL                                    CSD015
     I              T2AWIA                          O2AWIA                                    CSD015
     I              T2AWIN                          O2AWIN                                    CSD015
     I              T2AWIL                          O2AWIL                                    CSD015
     I              T2BOFA                          O2BOFA                                    CSD015
     I              T2BOFN                          O2BOFN                                    CSD015
     I              T2BOF1                          O2BOF1                                    CSD015
     I              T2BOF2                          O2BOF2                                    CSD015
     I              T2ACL1                          O2ACL1                                    CSD015
     I              T2ACL2                          O2ACL2                                    CSD015
     I              T2SRL1                          O2SRL1                                    CSD015
     I              T2SRL2                          O2SRL2                                    CSD015
     I              T2SRL3                          O2SRL3                                    CSD015
     I              T2FIN1                          O2FIN1                                    CSD015
     I              T2FIN2                          O2FIN2                                    CSD015
     I              T2RED1                          O2RED1                                    CSD015
     I              T2RED2                          O2RED2                                    CSD015
     I              T2NAL1                          O2NAL1                                    CSD015
     I              T2NAL2                          O2NAL2                                    CSD015
     I              T2IPYN                          O2IPYN                                    CSD015
     I              T2IPYL                          O2IPYL                                    CSD015
     I              T2CTYN                          O2CTYN                                    CSD015
     I              T2CTYL                          O2CTYL                                    CSD015
     I              T2SA1N                          O2SA1N                                    CSD015
     I              T2SA1L                          O2SA1L                                    CSD015
     I              T2SKAN                          O2SKAN                                    CSD015
     I              T2SKAL                          O2SKAL                                    CSD015
     I              T2CCTN                          O2CCTN                                    CSD015
     I              T2DCTL                          O2DCTL                                    CSD015
     I              T2RSSA                          O2RSSA                                    CSD015
     I              T2RSSN                          O2RSSN                                    CSD015
     I              T2RSS1                          O2RSS1                                    CSD015
     I              T2RSS2                          O2RSS2                                    CSD015
     I              T2RSS3                          O2RSS3                                    CSD015
     I              T2RSS4                          O2RSS4                                    CSD015
     I              T2DSSA                          O2DSSA                                    CSD015
     I              T2DSSN                          O2DSSN                                    CSD015
     I              T2DSS1                          O2DSS1                                    CSD015
     I              T2DSS2                          O2DSS2                                    CSD015
     I              T2DSS3                          O2DSS3                                    CSD015
     I              T2DSS4                          O2DSS4                                    CSD015
     I              T2BSSA                          O2BSSA                                    CSD015
     I              T2BSSN                          O2BSSN                                    CSD015
     I              T2BSS1                          O2BSS1                                    CSD015
     I              T2BSS2                          O2BSS2                                    CSD015
     I              T2WHEN                          O2WHEN                                    CSD015
     I              T2INVE                          O2INVE                                    CSD015
     I              T2IMD1                          O2IMD1                                    CSD015
     I              T2IMD2                          O2IMD2                                    CSD015
     I              T2IMD3                          O2IMD3                                    CSD015
     I              T2IMD4                          O2IMD4                                    CSD015
     I              T2IMD5                          O2IMD5                                    CSD015
     I              T2IMD6                          O2IMD6                                    CSD015
     I              T2IMD7                          O2IMD7                                    CSD015
     I              T2IMD8                          O2IMD8                                    CSD015
     I              T2IMD9                          O2IMD9                                    CSD015
     I              T2IMS1                          O2IMS1                                    CSD015
     I              T2IMS2                          O2IMS2                                    CSD015
     I              T2IMS3                          O2IMS3                                    CSD015
     I              T2IMS4                          O2IMS4                                    CSD015
     I              T2IMS5                          O2IMS5                                    CSD015
     I              T2IMS6                          O2IMS6                                    CSD015
     I              T2IMS7                          O2IMS7                                    CSD015
     I              T2IMS8                          O2IMS8                                    CSD015
     I              T2IMS9                          O2IMS9                                    CSD015
     I              T2PSET                          O2PSET                                    CSD015
     I              T2NAC1                          O2NAC1                                    CSD015
     I              T2NAC2                          O2NAC2                                    CSD015
     I              T2FRNT                          O2FRNT                                    CSE045
     I              T2AFRT                          O2AFRT                                    CSE045
     I              T2REPA                          O2REPA                                    CSE045
     I              T2TMST                          O2TMST                                    CSE045
     I              T2DIDN                          O2DIDN                                    CSW210
     I              T2DAD1                          O2DAD1                                    CSW210
     I              T2DAD2                          O2DAD2                                    CSW210
     I              T2DAD3                          O2DAD3                                    CSW210
     I              T2DAD4                          O2DAD4                                    CSW210
     I              T2DLIN                          O2DLIN                                    CSW210
     I              T2QFIN                          O2QFIN                                    CSW210
     I              T2PCLR                          O2PCLR                                    CSW210
     I              T2FAP1                          O2FAP1                                    CSW210
     I              T2FAP2                          O2FAP2                                    CSW210
     I              T2FDBT                          O2FDBT                                    CSW210
     I              T2FAI1                          O2FAI1                                    CSW210
     I              T2FBF1                          O2FBF1                                    CSW210
     I            DS
      *  Data structure to fill upper range limit array
     I***********                         P   1  80 @RA                   S01176
     I                                    P   1 120 @RA                   S01176
     I                                    P   1   80STU1
     I                                    P   9  160STU2
     I                                    P  17  240STU3
     I                                    P  25  320STU4
     I                                    P  33  400STU5
     I                                    P  41  480STU6
     I                                    P  49  560STU7
     I                                    P  57  640STU8
     I                                    P  65  720STU9
     I                                    P  73  800ST10                  S01176
     I                                    P  81  880ST11                  S01176
     I                                    P  89  960ST12                  S01176
     I                                    P  97 1040ST13                  S01176
     I                                    P 105 1120ST14                  S01176
     I                                    P 113 1200@DUMMY                S01176
      *                                                                   S01176
     I            DS
      *  Data structure to fill percentage array
     I***********                         P   1  40 @PC                   S01176
     I                                    P   1  60 @PC                   S01176
     I                                    P   1   44PL01
     I                                    P   5   84PL02
     I                                    P   9  124PL03
     I                                    P  13  164PL04
     I                                    P  17  204PL05
     I                                    P  21  244PL06
     I                                    P  25  284PL07
     I                                    P  29  324PL08
     I                                    P  33  364PL09
     I                                    P  37  404PL10
     I                                    P  41  444PL11                  S01176
     I                                    P  45  484PL12                  S01176
     I                                    P  49  524PL13                  S01176
     I                                    P  53  564PL14                  S01176
     I                                    P  57  604PL15                  S01176
      *                                                                   S01176
     I            DS
      *  Data structure to fill flat charge array
     I***********                         P   1  80 @CG                   S01176
     I                                    P   1 120 @CG                   S01176
     I                                    P   1   80FC01
     I                                    P   9  160FC02
     I                                    P  17  240FC03
     I                                    P  25  320FC04
     I                                    P  33  400FC05
     I                                    P  41  480FC06
     I                                    P  49  560FC07
     I                                    P  57  640FC08
     I                                    P  65  720FC09
     I                                    P  73  800FC10
     I                                    P  81  880FC11                  S01176
     I                                    P  89  960FC12                  S01176
     I                                    P  97 1040FC13                  S01176
     I                                    P 105 1120FC14                  S01176
     I                                    P 113 1200FC15                  S01176
      *                                                                   S01176
     I@TXDS       DS                                                      S01176
      *                                                                   S01176
      ***  Data structure for storing Tax Charge fields (obtained from    S01176
      ***  LF/SECGT using the Tax Code from the Counterparty).            S01176
      ***  (Used for moving fields into standard subroutine)              S01176
      *                                                                   S01176
     I                                        1   1 @TCHGB                S01176
     I                                        2   2 @TTHRI                S01176
     I                                    P   3 122 @TRA                  S01176
     I                                    P 123 182 @TPC                  S01176
     I                                    P 183 302 @TCG                  S01176
     I                                    P 303 3100@TMNCH                S01176
     I                                    P 311 3180@TMXCH                S01176
     I                                      319 319 @TTXAP                S01176
     I                                      320 320 @TREBA                S01176
     I                                      321 321 @TLPSI                S01176
      *                                                                   S01176
     I@ZCHDS      DS                                                      S01176
      *                                                                   S01176
      ***  Data structure for the charge fields from LF/SECGT             S01176
      ***  that are used in standard subroutines.                         S01176
      *                                                                   S01176
     I                                        1   1 ZCHGB                 S01176
     I                                        2   2 ZTHRI                 S01176
     I                                    P   3 122 ZRA                   S01176
     I                                    P 123 182 ZPC                   S01176
     I                                    P 183 302 ZCG                   S01176
     I                                    P 303 3100ZMNCH                 S01176
     I                                    P 311 3180ZMXCH                 S01176
      *
     I************DS                                                      082738
     I************                        P   1  48 NDT                   082738
     I************                        P  49 176 NFI                   082738
     I************                        P 177 304 NFO                   082738
     I************                            1  48 ADT                   082738
     I************                           49 176 AFI                   082738
     I************                          177 304 AFO                   082738
      ************                                                        082738
     I************DS                                                      082738
     I************                        P   1  15 NND                   082738
     I************                        P  16  55 NNB                   082738
     I************                            1  15 AND                   082738
     I************                           16  55 ANB                   082738
     I            DS
     I                                        1  21 ZOUT21
     I                                        1  20 ZOUT20
     I*
     I            DS
     I****Data*structure*for*array*used*in*ZDATE5*************************S01195
     I***********                             1  75 HCCY                  S01195
     I***********                             1  75 XCCY                  S01195
     I****Data*structure*for*redefining*nominal*field*as*alphanumeric*****S01176
     I*********** DS                                                      S01176
     I***********                             1  110@WKNOM                S01176
     I***********                             1  11 @WANOM                S01176
     I*
     I*@KTG10******DS                             12                      S01117
      **Key*to*TABTG10****************************************************S01117
     I***********                             9  11 @T10CY                S01117
     I*
     I*@KTG20******DS                             12                      S01117
      **Key*to*TABTG20**************************************************  S01117
     I***********                             9  11 @T20CY                S01117
     I*
     I*@KTBTL******DS                             12                      S01117
      **Key*to*TABLETL**************************************************  S01117
     I***********                             8  10 @TLCY                 S01117
     I***********                            11  12 @TLNN                 S01117
     I*
     I@ERRTX      DS                             80
      * Error text data structure
     I                                       43  48 @ETF1
     I                                       65  67 @ETF2
     I***********                            60  62 @ETF3                 S01176
     I***********                            58  60 @ETF4                 S01176
     I***********                            30  31 @ETF5A                S01176
     I***********                            46  48 @ETF5B                S01176
     I***********                            31  36 @ETF6A                S01176
     I***********                            37  39 @ETF6B                S01176
     I***********                            40  43 @ETF6C                S01176
     I***********                            44  45 @ETF6D                S01176
     I                                       14  19 @ETF7
     I                                       14  19 @ETF8
     I                                       69  80 @ETF9
     I                                       50  52 @ETF10                S01117
     I                                       51  54 @ETF11                CAC002
     I*                                                                   S01117
     I** Data structure for DB error on nostro file                       S01117
     IKNOST       DS                                                      S01117
     I                                        1   2 P@NONB                S01117
     I                                        3   5 P@CYCD                S01117
     I*                                                                   S01117
     I** Data area RUNDAT                                                 S01117
     I*                                                                   S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     ISDBANK    E DSSDBANKPD                                              S01117
     I** Bank details                                                     S01117
     ISDBRCH    E DSSDBRCHPD                                              S01195
     I** Branch details                                                   S01195
     ISCSARD    E DSSCSARDPD                                                                  233607
     I              LCD                             LCDT                                      233607
     I** Switchable Feature details                                                           233607
     ISDCURR    E DSSDCURRPD                                              S01117
     I** Currency details                                                 S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
     I              QQDFAC                          QQDFA1                                    CGL029
     I** Customer details                                                 S01117
     ISDPLCS    E DSSDPLCSPD                                                                  234552
     I** Portfolio Customer details                                                           234552
     ISDGELR    E DSSDGELRPD                                              S01117
     I** General ledger details                                           S01117
     ISDMMOD    E DSSDMMODPD                                              S01486
     I** Midas Module details                                             S01486
     ISDNOST    E DSSDNOSTPD                                              S01117
     I              QQACCD                          QQACC1                                    CGL029
     I** Nostro details                                                   S01117
     ISDPRFC    E DSSDPRFCPD                                              CAC002
     I** Profit Centre Details                                            CAC002
     ISDRETL    E DSSDRETLPD                                              S01117
     I              QQACCD                          QQACC2                                    CGL029
     I** Retail ICD                                                       S01117
     ISDSECS    E DSSDSECSPD                                              S01117
     I              QQACCD                          QQACC3                                    CGL029
     I              SEZONE                          SEZONA                                    CGL035
     I** Security Customer details                                        S01117
     ISDSTRD    E DSSDSTRDPD                                              S01117
     I** Securities Trading ICD                                           S01117
      *                                                                                       CSD015
     ISDWLTD    E DSSDWLTOPD                                                                  CSD015
      ** Data structure for 1st parameter of Watchlist Engine (SDCWLCHK)                      CSD015
      *                                                                                       CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      **  Midas Functions for Watch List Checking Details File                                CSD015
      *                                                                                       CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      ** DS For Watch List Configuration Data File                                            CSD015
      *                                                                                       CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      **  Midas SD Data Structure for SDSTAT *dtaara                                          CSD015
      *                                                                                       CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      **  Midas 24 x 7 Status Data Structure                                                  CSD015
      *                                                                                       CSD015
     IPSTRNG      DS                           9999                                           CSD015
      ** Data structure for 2nd parameter of Watchlist Engine (SDCWLCHK)                      CSD015
      *                                                                                       CSD015
     IDSFDY     E DSDSFDY                                                 S01117
     I*                                                                   S01408
     I@SEVDP    E DSSEVDPMVPD                                                                 234440
     I              RECI                            RECIV                                     234440
     I              ORBR                            ORBRV                                     234440
     I              TACI                            TACIV                                     234440
     I              ORED                            OREDV                                     234440
     I              LCD                             LCDV                                      234440
     I              CHTP                            CHTPV                                     234440
     I              TNLU                            TNLUV                                     234440
     I              SPXR                            SPXRV                                     234440
     I              SPMD                            SPMDV                                     234440
     I              PTFR                            PTFRV                                     234440
     I              COAF                            COAFV                                     234440
     I              ACIN                            ACINV                                     234440
     I              REPI                            REPIV                                     234440
     I              DPAP                            DPAPV                                     234440
     I              FSPR                            FSPRV                                     234440
     I              FSPP                            FSPPV                                     234440
     I*                                                                                       234440
     I              'SEVSEFSPR2'          C         SEVFSP                                    234440
     I              'SEETCPUPD'           C         SEETCP                                    234440
     I              'SEVTRADTAX'          C         SEVTAX                                    234440
     I              'SEVTAXDATE'          C         SEVDAT                                    234552
     I/COPY WNCPYSRC,SE3003IIPG                                           S01408
     I*                                                                   S01408
     C*                                                                   S01176
     C*****************************************************************   S01176
     C/EJECT
     C*****************************************************************   S01176
     C*    M A I N   P R O C E S S I N G                              *   S01176
     C*                                                               *   S01176
     C*    Calls : SUB001                                             *   S01176
     C*            SUB002                                             *   S01176
     C*            SUB003                                             *   S01176
     C*            SUB004                                             *   S01176
     C*****************************************************************   S01176
     C*
     C* Initialize program
     C                     EXSR SUB001
     C*
     C* Set pointer at first trade for this batch
     C           @XTNUM    SETLLBULKTDF
     C*
     C* Read and process next transaction for this batch
     C* (ignore deleted records)
     C           *IN10     DOUEQ'1'
     C           @XTNUM    READEBULKTDF                  10
      ***********                                                   S01401CSW003
      ****If*MT5xx present perform subroutine BLK1Z2 to obtain      S01401CSW003
      ****corresponding extension records on BULKSDX1 & BULKSDX2.   S01401CSW003
      ***********                                                   S01401CSW003
     C***********S01401    IFEQ 'Y'                                 S01401CSW003
     C***********          EXSR BLK1Z2                              S01401CSW003
     C***********          ENDIF                                    S01401CSW003
     C*
     C           *IN10     IFEQ '0'
     C           @BRECI    ANDNE'*'
     C/COPY WNCPYSRC,SE3003C001
     C  N11                EXSR SUB002
     C           *IN05     IFEQ '0'                                       S01511
     C                     EXSR SUB003
     C                     END                                            S01511
      *                                                                   CSE006
      * If Buy-Sell Back being processed, save details of 1st trade       CSE006
     C           @BYSL     IFEQ 'Y'                                       CSE006
     C           @BBLKR    ANDEQ@BTDRF                                    CSE006
     C                     Z-ADD@BTDVD    A#TDVD  50                      CSE006
     C                     MOVEL@BTDRF    A#TDRF  6                       CSE006
     C                     MOVE '0'       *IN05                                               202958
     C                     ENDIF                                          CSE006
      *                                                                   CSE006
     C                     END
     C*
     C                     END
     C*
     C* Terminate program
     C                     EXSR SUB004
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  PLIST's, KLIST's, DEFN's etc....                             *
     C*****************************************************************
     C*
     C           *NAMVAR   DEFN           LDA
     C           *LIKE     DEFN @DBALL    @DBSAV
     C           *LIKE     DEFN TMST      PTMST                                               235546
     C*
     C* Initial parameter
     C           *ENTRY    PLIST
     C                     PARM           @XUSER 10
     C                     PARM           @XTNUM  6
     C                     PARM           @CAGT   1                       S01448
     C                     PARM           @BYSL   1                       CSE006
     C*
     C* KLIST for LF/INVTP
     C           @KEY1     KLIST
     C                     KFLD           NMCYA
     C                     KFLD           SITP
     C*
     C* KLIST for LF/CUBRD
     C           @KEY3     KLIST
     C                     KFLD           @KC1DI  1
     C                     KFLD           @KSITP  3
     C                     KFLD           @KMRKT  2
     C**********           KFLD           @KCNUM  60                                          CSD027
     C                     KFLD           @KCNUM  6                                           CSD027
     C*
     C** KLIST for LF/SECUBRL0                                            S01496
     C*                                                                   S01496
     C           @KEY3A    KLIST                                          S01496
     C                     KFLD           @KCLGR  2                       S01496
     C                     KFLD           @KSITP  3                       S01496
     C                     KFLD           @KMRKT  2                       S01496
     C**********           KFLD           @KCNUM  60                                   S01496 CSD027
     C                     KFLD           @KCNUM  6                                           CSD027
     C* KLIST for LF/SECGT
     C           @KEY4     KLIST
     C***********          KFLD           @CCY    3                       S01176
     C***********          KFLD           @CAM                            S01176
     C                     KFLD           @XCCY   3                       S01176
     C                     KFLD           @XCODE  2                       S01176
     C*
     C* KLIST for LF/STDSED
     C           @KEY6     KLIST
     C***********          KFLD           @BTDBR                          S01117
     C                     KFLD           @BTDBA                          S01117
     C                     KFLD           @BTCNR
     C                     KFLD           WBKCD                                               CSE028
     C                     KFLD           VLCY
     C*
     C* KLIST for LF/STDSED                                               S01509
     C           @KEY6S    KLIST                                          S01509
     C                     KFLD           @BTDBA                          S01509
     C                     KFLD           @BTCNR                          S01509
     C                     KFLD           WBKCD                                               CSE028
     C                     KFLD           NMCYA                           S01509
     C*
     C* KLIST for LF/STDSED
     C           @KEY7     KLIST
     C***********          KFLD           @BTDBR                          S01117
     C                     KFLD           @BTDBA                          S01117
     C                     KFLD           @BTCNR
     C                     KFLD           WBKCD                                               CSE028
     C                     KFLD           @BSETC
     C*
     C* KLIST for LF/STDSED
     C           @KEY8     KLIST
     C***********          KFLD           @BTDBR                          S01117
     C                     KFLD           @BTDBA                          S01117
     C                     KFLD           @BTCNR
     C                     KFLD           WBKCD                                               CSE028
     C                     KFLD           @BSETC
     C                     KFLD           SITP
     C                     KFLD           WPTFR                                               CSE028
     C*                                                                   CEU005
     C* KLIST for LF/STDSED                                               CEU005
     C           @KEY9     KLIST                                          CEU005
     C                     KFLD           @BTDBA                          CEU005
     C                     KFLD           @BTCNR                          CEU005
     C                     KFLD           WBKCD                                               CSE028
     C                     KFLD           NMCYA                           CEU005
     C                     KFLD           SITP                            CEU005
     C                     KFLD           WPTFR                                               CSE028
     C***********                                                         E36791
     C**KLIST*for*LF/SECED,*format*SNDEVDF********************************E36791
     C***********@KEY9     KLIST                                          E36791
     C***********          KFLD           SNSN                            E36791
     C***********          KFLD           SNDT                            E36791
     C***********          KFLD           SNET                            E36791
     C***********                                                         E36791
     C**KLIST*for*LF/SECED,*format*SEDEVDF********************************E36791
     C***********@KEY11    KLIST                                          E36791
     C***********          KFLD           SDSN                            E36791
     C***********          KFLD           SDED                            E36791
     C***********          KFLD           SDET                            E36791
     C*
     C* KLIST for file BKPHD
     C           @KEYB     KLIST
     C                     KFLD           BHSC
     C***********          KFLD           BHBR                            S01117
     C                     KFLD           BHBA                            S01117
     C                     KFLD           BHBK
     C                     KFLD           BHMK
     C                     KFLD           BHTV
     C*
     C* KLIST for file BKPOS
     C           @KEYC     KLIST
     C                     KFLD           BPSC
     C***********          KFLD           BPBR                            S01117
     C                     KFLD           BPBA                            S01117
     C                     KFLD           BPBK
     C                     KFLD           BPMK
     C                     KFLD           BPTV
     C                     KFLD           BPPD
     C*
     C* KLIST for file ACCNT
     C           @KEYD     KLIST
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           BRCA                            S01117
     C*
     C* KLIST for file CPOSN
     C           @KEYE     KLIST
     C***********          KFLD           @BTDBR                          S01117
     C                     KFLD           @BTDBA                          S01117
     C                     KFLD           @BTDSS
     C                     KFLD           @BTCNR
     C*
     C* KLIST for file CDEPP
     C           @KEYF     KLIST
     C***********          KFLD           @BTDBR                          S01117
     C                     KFLD           @BTDBA                          S01117
     C                     KFLD           @BTCNR
     C                     KFLD           @BTDSS
     C                     KFLD           CDPT
     C                     KFLD           @BTDMI
     C*
     C* KLIST for file UDEPP
     C           @KEYG     KLIST
     C***********          KFLD           @BTDBR                          S01117
     C                     KFLD           @BTDBA                          S01117
     C                     KFLD           @BTDSS
     C                     KFLD           UDPT
     C                     KFLD           @BTDBK
     C                     KFLD           @BTDMI
     C***********                                                         082738
     C**KLIST*for file PRONO                                              082738
     C***********@KEYH     KLIST                                          082738
     C***********          KFLD           CCY                             082738
     C***********          KFLD           NOSN                            082738
     C***********                                                         082738
     C**KLIST*for file OLPOS                                              082738
     C***********@KEYI     KLIST                                          082738
     C***********          KFLD           BRCA                     S01117 082738
     C***********          KFLD           CCY                             082738
     C***********          KFLD           RECN                            082738
     C*
     C* KLIST for file SETLE
     C           @KEYJ     KLIST
     C***********          KFLD           @BTDBR                          S01117
     C                     KFLD           @BTDBA                          S01117
     C                     KFLD           @BTDRF
     C*                                                                   S01117
     C* Define key list for file SEPCBD                                   S01117
     C*                                                                   S01117
     C           KLSPCB    KLIST                                          S01117
     C                     KFLD           BOKC                            S01117
     C                     KFLD           KBRC    3                       S01117
     C                     KFLD           KSSN   10                       S01117
     C                     KFLD           MKTI                            S01117
     C*                                                                   S01117
     C* Define key list for file SEPCCD                                   S01117
     C*                                                                   S01117
     C           KLSPCC    KLIST                                          S01117
     C**********           KFLD           KCNUM   60                                   S01117 CSD027
     C                     KFLD           KCNUM   6                                           CSD027
     C                     KFLD           KBRCA   3                       S01117
     C                     KFLD           KSESN  10                       S01117
     C*                                                                   S01176
     C* Define key list for file TRADSDY1                                 CSW003
     C*                                                                   CSW003
     C           KTRDY1    KLIST                                          CSW003
     C                     KFLD           B1TDRF                          CSW003
     C                     KFLD           KWHEN   1                       CSW003
      *                                                                   CSE023
      ** Key list for LF/SDWTCSL0                                         CSE023
      *                                                                   CSE023
     C           KWTCS     KLIST                                          CSE023
     C                     KFLD           KTCNR                           CSE023
     C                     KFLD           CRTT                            CSE023
      *                                                                   CSE023
      ** Key list for LF/SDWHTTL5                                         CSE023
      *                                                                   CSE023
     C           KWHTT     KLIST                                          CSE023
     C                     KFLD           CRTT                            CSE023
     C                     KFLD           KSITP   3                       CSE023
      *                                                                   CSE023
      ** Key list for LF/SDTXBSL0                                         CSE023
      *                                                                   CSE023
     C           KTXBS     KLIST                                          CSE023
     C                     KFLD           CRTT                            CSE023
     C                     KFLD           WTDRBW                          CSE023
     C                     KFLD           @BTDVD                          CSE023
     C*                                                                   CSW003
      ** Compliance Watch Hit List Key List                                                   CSD015
      *                                                                                       CSD015
     C           CWHTKY    KLIST                                                              CSD015
     C                     KFLD           WFUNT   8                                           CSD015
     C                     KFLD           WIDEN  40                                           CSD015
     C                     KFLD           @BTDBA                                              CSD015
      *                                                                                       CSD015
      ** Midas RE Settled Transaction Index File Key List                                     CRE020
      *                                                                                       CRE020
     C           KADVC     KLIST                                                              CRE020
     C                     KFLD           KREFNO 30                                           CRE020
     C                     KFLD           KPRGMN 10                                           CRE020
      *                                                                                       CRE020
      ** Midas SE Movement Status File Key List                                             BUG10273
      *                                                                                     BUG10273
     C           KMVTS     KLIST                                                            BUG10273
     C                     KFLD           KTRRF   6                                         BUG10273
     C                     KFLD           KTRTY   1                                         BUG10273
     C                     KFLD           KNTDT   50                                        BUG10273
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB001 - Program initialization                              *
     C*****************************************************************
     C           SUB001    BEGSR
     C*
     C* Set up fixed values
     C                     MOVEL'L'       ZECODE
     C                     MOVEL'SE'      @MID
     C                     MOVEL'SE3003'  @PGM
     C                     MOVEL@JOB      @WID
     C                     MOVEL@USR      @USER
     C***********          MOVEL'20      '@KTG10                          S01117
     C***********          MOVE '       1'@KTG10                          S01117
     C***********          MOVEL'20      '@KTG20                          S01117
     C***********          MOVE '       2'@KTG20                          S01117
     C***********          MOVEL*BLANKS   @KTBTL                          S01117
     C***********          MOVEL'70'      @KTBTL                          S01117
     C***********                                                         S01117
     C**Get*ICD1**************************                                S01117
     C***********          EXSR ZSYSTM                                    S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          Z-ADD1         @DBASE           ***************S01117
     C***********          MOVEL'ICD1'    @DBFIL           * DB ERROR 01 *S01117
     C***********          MOVELZTABKY    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C**   Read in RUNDAT                                                 S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C**                                                                  S01117
     C**   Check System Date Format, DDMMYY or MMDDYY.                    S01117
     C**                                                                  S01117
     C           DATF      COMP 'M'                      98               S01117
     C*                                                                   S01117
     C**   Access Bank Details                                            S01117
     C*                                                                   S01117
     C                     EXSR AOBANK                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD1         @DBASE           ***************S01117
     C                     MOVEL'SDSTRDPD'@DBFIL           * DB ERROR 01 *S01117
     C                     MOVEL'*FIRST'  @DBKEY           ***************S01117
     C                     EXSR SUB999                                    S01117
     C                     END                                            S01117
     C*
     C* Set up print file fields
     C***********          MOVELTITL      @PTITL                          S01117
     C                     MOVELBJURPT    @PTITL                          S01117
     C                     MOVELRUNA      @PRUNA
     C                     MOVEL@XUSER    @PUSER
     C*
     C**Get*ICD2**************************                                S01117
     C***********          EXSR ZICD2                                     S01117
     C************INU7     IFEQ '1'                                       S01117
     C***********          Z-ADD2         @DBASE           ***************S01117
     C***********          MOVEL'ICD2'    @DBFIL           * DB ERROR 02 *S01117
     C***********          MOVELZTABKY    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C**Get*ICD3***************************                               S01117
     C***********1         CHAINTABTB20              01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          MOVE '30'      @DBASE            ************  S01117
     C***********          MOVEL'TABLE'   @DBFIL            * DATABASE *  S01117
     C***********          MOVEL'TABTB20' @DBKEY            * ERROR 30 *  S01117
     C***********          SETON                     U7U8   ************  S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C**Get*SE*ICD*************************                               S01117
     C***********          EXSR ZICDSE                                    S01117
     C************INU7     IFEQ '1'                                       S01117
     C***********          Z-ADD3         @DBASE           ***************S01117
     C***********          MOVEL'ICDSE'   @DBFIL           * DB ERROR 03 *S01117
     C***********          MOVELZTABKY    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C**   Access General Ledger details                                  S01117
     C*                                                                   S01117
     C                     EXSR AOGELR                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD2         @DBASE           ***************S01117
     C                     MOVEL'SDGELRPD'@DBFIL           * DB ERROR 02 *S01117
     C                     MOVEL'*FIRST'  @DBKEY           ***************S01117
     C                     EXSR SUB999                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   Access Securities Trading ICD                                  S01117
     C*                                                                   S01117
     C                     EXSR AOSTRD                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD3         @DBASE           ***************S01117
     C                     MOVEL'SDSTRDPD'@DBFIL           * DB ERROR 03 *S01117
     C                     MOVEL'*FIRST'  @DBKEY           ***************S01117
     C                     EXSR SUB999                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   If Retail module present, access Retail ICD                    S01117
     C*                                                                   S01117
     C           *INU1     IFEQ '1'                                       S01117
     C                     EXSR AORETL                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD4         @DBASE           ***************S01117
     C                     MOVEL'SDRETLPD'@DBFIL           * DB ERROR 04 *S01117
     C                     MOVEL'*FIRST'  @DBKEY           ***************S01117
     C                     EXSR SUB999                                    S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   Set on indicators for error report                             S01117
     C*                                                                   S01117
     C*  Multibranching environment                                       S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     30                   S01117
     C*  Originating Branch used                                          S01117
     C           BKOBRU    IFEQ 'Y'                                       S01117
     C                     SETON                     31                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*  Profit Centre used                                               S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C                     SETON                     32                   S01117
     C                     END                                            S01117
     C*                                                                   S01176
     C***  If Autocharges is on,                                          S01176
     C***  Seton Ind. 15 for the Print File Control                       S01176
     C***********AUMO      IFEQ 'Y'                                S01176 S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
     C                     SETON                     15                   S01176
     C                     END                                            S01176
     C*
     C* Get Event Control Date
     C                     Z-ADDBJDNWD    ZZDNWD                          S01117
     C                     Z-ADDBKAPDT    ZZAPDT                          S01117
     C                     EXSR ZEVCD
     C/COPY WNCPYSRC,SE3003C012
     C*
      **  Access Switchable features file for MT5xx processing -          S01401
      *                                                                   S01401
     C                     MOVE 'N'       S01401                          S01401
     C                     MOVE 'S01401'  USARN                           S01446
     C                     EXSR AOSARD                                    S01401
     C           @RTCD     IFEQ *BLANK                                    S01401
     C                     MOVE 'Y'       S01401  1                       S01401
     C                     ENDIF                                          S01401
      *                                                                   CSW003
     C                     MOVE 'N'       CSW003                          CSW003
     C                     MOVE 'CSW003'  USARN                           CSW003
     C                     EXSR AOSARD                                    CSW003
     C           @RTCD     IFEQ *BLANK                                    CSW003
     C                     MOVE 'Y'       CSW003  1                       CSW003
     C                     ENDIF                                          CSW003
     C*                                                                   S01496
     C**  Access Switchable features file for JYSKE SE processing -       S01496
     C*                                                                   S01496
     C                     MOVE 'N'       S01496                          S01496
     C                     MOVE 'S01496'  USARN                           S01496
     C                     EXSR AOSARD                                    S01496
     C           @RTCD     IFEQ *BLANK                                    S01496
     C                     MOVE 'Y'       S01496  1                       S01496
     C                     END                                            S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C                     OPEN SECUBRL0                                  S01496
     C                     ELSE                                           S01496
     C                     OPEN CUBRD                                     S01496
     C                     END                                            S01496
      *                                                                   S01509
     C**  Access SAR details file to see if S01509 is installed           S01509
      *                                                                   S01509
     C                     CALL 'AOSARDR0'                                S01509
     C                     PARM '       ' @RTCD                           S01509
     C                     PARM '*VERIFY' @OPTN                           S01509
     C                     PARM 'S01509'  @SARD                           S01509
      *                                                                   S01509
     C           @RTCD     IFEQ *BLANK                                    S01509
     C                     MOVE 'Y'       S01509  1                       S01509
     C                     ELSE                                           S01509
     C                     MOVE 'N'       S01509                          S01509
     C                     END                                            S01509
      *                                                                   S01510
     C**  Access SAR details file to see if S01510 is installed           S01510
      *                                                                   S01510
     C                     CALL 'AOSARDR0'                                S01510
     C                     PARM '       ' @RTCD                           S01510
     C                     PARM '*VERIFY' @OPTN                           S01510
     C                     PARM 'S01510'  @SARD                           S01510
      *                                                                   S01510
     C           @RTCD     IFEQ *BLANK                                    S01510
     C                     MOVE 'Y'       S01510  1                       S01510
     C                     ELSE                                           S01510
     C                     MOVE 'N'       S01510                          S01510
     C                     END                                            S01510
     C*                                                                   S01511
     C**  Access SAR details file to see if S01511 is installed           S01511
     C*                                                                   S01511
     C                     CALL 'AOSARDR0'                                S01511
     C                     PARM '       ' @RTCD                           S01511
     C                     PARM '*VERIFY' @OPTN                           S01511
     C                     PARM 'S01511'  @SARD                           S01511
      *                                                                   S01511
     C           @RTCD     IFEQ *BLANK                                    S01511
     C                     MOVE 'Y'       S01511  1                       S01511
     C                     ELSE                                           S01511
     C                     MOVE 'N'       S01511                          S01511
     C                     END                                            S01511
      *                                                                   CSE023
      ** Access Switchable Features file and check if CSE023 is           CSE023
      ** installed                                                        CSE023
      *                                                                   CSE023
     C                     MOVE 'N'       CSE023  1                       CSE023
     C                     CALL 'AOSARDR0'                                CSE023
     C                     PARM *BLANKS   @RTCD                           CSE023
     C                     PARM '*VERIFY' @OPTN                           CSE023
     C                     PARM 'CSE023'  @SARD                           CSE023
      *                                                                   CSE023
     C           @RTCD     IFEQ *BLANK                                    CSE023
     C                     MOVE 'Y'       CSE023                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                                       CSE028
      ** Check if CSE028 - MT5xx Standing Settlements Instructions is                         CSE028
      **   is switched on.                                                                    CSE028
      *                                                                                       CSE028
     C                     CALL 'AOSARDR0'                                                    CSE028
     C                     PARM *BLANKS   @RTCD                                               CSE028
     C                     PARM '*VERIFY' @OPTN                                               CSE028
     C                     PARM 'CSE028'  @SARD                                               CSE028
      *                                                                                       CSE028
     C           @RTCD     IFEQ *BLANK                                                        CSE028
     C                     MOVE 'Y'       CSE028  1                                           CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'N'       CSE028                                              CSE028
     C                     ENDIF                                                              CSE028
      *
      ** Check if CSE039 - Automatic Settlment of trades                                      CSE039
      **   is switched on.                                                                    CSE039
      *                                                                                       CSE039
     C                     CALL 'AOSARDR0'                                                    CSE039
     C                     PARM *BLANKS   @RTCD                                               CSE039
     C                     PARM '*VERIFY' @OPTN                                               CSE039
     C                     PARM 'CSE039'  @SARD                                               CSE039
      *                                                                                       CSE039
     C           @RTCD     IFEQ *BLANK                                                        CSE039
     C                     MOVE 'Y'       CSE039  1                                           CSE039
     C                     ELSE                                                               CSE039
     C                     MOVE 'N'       CSE039                                              CSE039
     C                     ENDIF                                                              CSE039
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP19                                           S01408
     C*                                                                   S01408
     C*                                                                   S01446
     C**  Define fields                                                   S01446
     C*                                                                   S01446
     C           *LIKE     DEFN A6SPRT    USPRT                           S01446
     C           *LIKE     DEFN A6MDIN    UMDIN                           S01446
     C           *LIKE     DEFN A6NBDP    UNBDP                           S01446
     C           *LIKE     DEFN A6MDIN    UCHXMD                          S01446
     C           *LIKE     DEFN A6SPRT    UCHXRT                          S01446
     C*                                                                   CAC002
     C**  Initialise fields                                               CAC002
     C*                                                                   CAC002
     C                     Z-ADD*ZEROS    @BFXMP                          CAC002
     C                     Z-ADD*ZEROS    @BFXMR                          CAC002
     C                     Z-ADD*ZEROS    @BMAMT                          CAC002
     C*                                                                   S01446
     C**  Access Switchable features file for Customer Commission         S01446
     C**  (Courtage)                                                      S01446
     C*                                                                   S01446
     C                     MOVE 'N'       S01446                          S01446
     C                     MOVE 'S01446'  USARN   6                       S01446
     C                     EXSR AOSARD                                    S01446
     C           @RTCD     IFEQ *BLANK                                    S01446
     C                     MOVE 'Y'       S01446  1                       S01446
     C                     ENDIF                                          S01446
     C*                                                                   S01448
     C**  Access Switchable features file for Bulk Input Enhancements     S01448
     C*                                                                   S01448
     C                     MOVE 'N'       S01448                          S01448
     C                     MOVE 'S01448'  USARN                           S01448
     C                     EXSR AOSARD                                    S01448
     C           @RTCD     IFEQ *BLANK                                    S01448
     C                     MOVE 'Y'       S01448  1                       S01448
     C                     ENDIF                                          S01448
     C*                                                                   S01446
     C**  If Customer Commissions feature on and autocharges is on        S01446
     C**  get details of single charge currency if not blank (on          S01446
     C**  SE ICD record)                                                  S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           *IN15     ANDEQ'1'                                       S01446
     C           BVCHRC    ANDNE*BLANK                                    S01446
     C                     MOVE *BLANKS   @RTCD                           S01446
     C                     MOVEL'*MSG  '  @RTCD                           S01446
     C                     MOVE BVCHRC    @AJCD                           S01446
     C                     EXSR AOCURR                                    S01446
     C           @RTCD     IFNE *BLANKS                                   S01446
     C                     Z-ADD18        @DBASE           ***************S01446
     C                     MOVEL'SDCURRPD'@DBFIL           * DB ERROR 18 *S01446
     C                     MOVELBVCHRC    @DBKEY           ***************S01446
     C                     EXSR SUB999                                    S01446
     C                     END                                            S01446
     C*                                                                   S01446
     C** Set up spot rate, multiply/divide indicator and number of        S01446
     C** decimal places                                                   S01446
     C*                                                                   S01446
     C                     MOVE A6SPRT    USPRT                           S01446
     C                     MOVE A6MDIN    UMDIN                           S01446
     C                     MOVE A6NBDP    UNBDP                           S01446
     C                     END                                            S01446
     C*                                                                   CEU005
     C**  Access SAR details file to see if CEU005 SAR is installed.      CEU005
     C*                                                                   CEU005
     C                     CALL 'AOSARDR0'                                CEU005
     C                     PARM *BLANKS   @RTCD                           CEU005
     C                     PARM '*VERIFY' @OPTN                           CEU005
     C                     PARM 'CEU005'  @SARD                           CEU005
     C*                                                                   CEU005
     C           @RTCD     IFEQ *BLANK                                    CEU005
     C                     MOVE 'Y'       CEU005  1                       CEU005
     C                     MOVE *ON       *IN33                           CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'N'       CEU005                          CEU005
     C                     MOVE *OFF      *IN33                           CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   S01486
     C**   Access MIDAS MODULES Details                                   S01486
     C*                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM '*DBERR ' @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
      *                                                                   CAC002
      * Checks if Analytical Accounting is available                      CAC002
      *                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C                     SETON                     1920                 CAC002
     C                     SETOF                     32                   CAC002
     C                     ELSE                                           CAC002
     C                     SETOF                     1920                 CAC002
     C                     ENDIF                                          CAC002
      *                                                                   CAC005
      ***  Check if CAC005 - PCA-SE Enhancement is on.                    CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   @RTCD                           CAC005
     C                     PARM '*VERIFY' @OPTN                           CAC005
     C                     PARM 'CAC005'  @SARD                           CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
     C*                                                                   S01486
     C** Check whether Portfolio Management is switched on                S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C                     SETON                     29                   S01486
     C                     END                                            S01486
     C*                                                                   CPB001
     C** Check whether Private Banking is switched on                     CPB001
     C*                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     SETON                     24                   CPB001
     C                     ENDIF                                          CPB001
      *                                                                   S01446
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CCPG                                           S01408
     C*                                                                   S01408
      *                                                                                       CER001
      **  Access switchable Sar ULX004                                                        CER001
      *                                                                                       CER001
     C                     MOVE 'N'       ULX004  1                                           CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM '       ' @RTCD                                               CER001
     C                     PARM '*VERIFY' @OPTN                                               CER001
     C                     PARM 'ULX004'  @SARD                                               CER001
      *                                                                                       CER001
     C           @RTCD     IFEQ *BLANK                                                        CER001
     C                     MOVE 'Y'       ULX004                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           @RTCD     IFNE *BLANKS                                                       CER001
     C           @RTCD     ANDNE'*NRF   '                                                     CER001
     C           *LOCK     IN   LDA                                                           CER001
     C                     MOVEL'SCSARDPD'@DBFIL                                              CER001
     C                     MOVEL'013'     @DBASE                                              CER001
     C                     MOVEL@OPTN     @DBKEY                                              CER001
     C                     OUT  LDA                                                           CER001
     C                     EXSR *PSSR                                                         CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
      **  Access switchable Sar ULX008                                                        CER001
      *                                                                                       CER001
     C                     MOVE 'N'       ULX008  1                                           CER001
      *                                                                                       CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM '       ' @RTCD                                               CER001
     C                     PARM '*VERIFY' @OPTN                                               CER001
     C                     PARM 'ULX008'  @SARD                                               CER001
      *                                                                                       CER001
     C           @RTCD     IFEQ *BLANK                                                        CER001
     C                     MOVE 'Y'       ULX008                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           @RTCD     IFNE *BLANKS                                                       CER001
     C           @RTCD     ANDNE'*NRF   '                                                     CER001
     C           *LOCK     IN   LDA                                                           CER001
     C                     MOVEL'SCSARDPD'@DBFIL                                              CER001
     C                     MOVEL'030'     @DBASE                                              CER001
     C                     MOVEL@OPTN     @DBKEY                                              CER001
     C                     OUT  LDA                                                           CER001
     C                     EXSR *PSSR                                                         CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CSE035
      *  Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  @SARD                                               CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  @SARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     END                                                                207543
      *                                                                   CSW098
      ** Check to see if switchable feature CSW098 is on or if date is    CSW098
      ** greater than 16 October 1998.                                    CSW098
     C                     CALL 'SWIFT98'              34                 CSW098
     C                     PARM           SWRTN   7                       CSW098
      *                                                                   CSW098
     C           *IN34     IFEQ *ON                        ***************CSW098
     C                     MOVEL'20'      @DBASE           **DB ERROR  20*CSW098
     C                     MOVEL'SE3003'  @DBFIL           ***************CSW098
     C                     MOVEL'SWIFT98' @DBKEY                          CSW098
     C                     EXSR SUB999                                    CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
      **  Access SAR details file to see if CSE006 is installed           CSE006
      *                                                                   CSE006
     C                     CALL 'AOSARDR0'                                CSE006
     C                     PARM *BLANKS   @RTCD                           CSE006
     C                     PARM '*VERIFY' @OPTN                           CSE006
     C                     PARM 'CSE006'  @SARD                           CSE006
      *                                                                   CSE006
     C           @RTCD     IFEQ *BLANK                                    CSE006
     C                     MOVE 'Y'       CSE006  1                       CSE006
     C                     OPEN BSPOSD                                    CSE006
     C                     ELSE                                           CSE006
     C                     MOVE 'N'       CSE006                          CSE006
     C                     END                                            CSE006
      *                                                                   CSE006
      **  Access SAR details file to see if CER049 is installed                             AR871625
      *                                                                                     AR871625
     C                     CALL 'AOSARDR0'                                                  AR871625
     C                     PARM *BLANKS   @RTCD                                             AR871625
     C                     PARM '*VERIFY' @OPTN                                             AR871625
     C                     PARM 'CER049'  @SARD                                             AR871625
      *                                                                                     AR871625
     C           @RTCD     IFEQ *BLANK                                                      AR871625
     C                     MOVE 'Y'       CER049  1                                         AR871625
      *                                                                                     AR871625
     C                     ELSE                                                             AR871625
     C                     MOVE 'N'       CER049                                            AR871625
     C                     END                                                              AR871625
      *                                                                                     AR871625
      **  Access SAR details file to see if CAS006 is installed                               CAS006
      *                                                                                       CAS006
     C                     CALL 'AOSARDR0'                                                    CAS006
     C                     PARM *BLANKS   @RTCD                                               CAS006
     C                     PARM '*VERIFY' @OPTN                                               CAS006
     C                     PARM 'CAS006'  @SARD                                               CAS006
      *                                                                                       CAS006
     C           @RTCD     IFEQ *BLANK                                                        CAS006
     C                     MOVE 'Y'       CAS006  1                                           CAS006
     C                     MOVE *ON       *IN45                                               CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'N'       CAS006                                              CAS006
     C                     MOVE *OFF      *IN45                                               CAS006
     C                     END                                                                CAS006
      *                                                                                       CAS006
      **  Check if Midas 24x7 (CSC011) is installed                                           CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSC011  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSC011'  @SARD                                               CSD015
      *                                                                                       CSD015
      ** Database Error (return code other than *NRF)                                         CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'@DBFIL                                              CSD015
     C                     MOVEL'CSC011'  @DBKEY                                              CSD015
     C                     Z-ADD21        @DBASE                                              CSD015
     C                     EXSR SUB999                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANK                                                        CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     MOVE 'Y'       CSC011                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      **  Check if Midas Compliance Watch (CSD015) is installed                               CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CSD015  1                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSD015'  @SARD                                               CSD015
      *                                                                                       CSD015
      ** Database Error (return code other than *NRF)                                         CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SCSARDPD'@DBFIL                                              CSD015
     C                     MOVEL'CSD015'  @DBKEY                                              CSD015
     C                     Z-ADD22        @DBASE                                              CSD015
     C                     EXSR SUB999                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015                                              CSD015
      *                                                                                       CSD015
      ** Check if function code is being monitored by the compliance watch                    CSD015
      *                                                                                       CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*KEY   ' @OPTN                                               CSD015
     C                     PARM 'SECTTRAD'@KEY    8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** Database Error (return code other than blank)                                        CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SDWLCCPD'@DBFIL                                              CSD015
     C                     MOVEL'SECTTRAD'@DBKEY                                              CSD015
     C                     Z-ADD23        @DBASE                                              CSD015
     C                     EXSR SUB999                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SDCWCDPD to get the 5 'Private Customer Industry Code'                        CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*FIRST ' @OPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C                     MOVELPOPTN     @DBKEY                                              CSD015
     C                     MOVEL'SDCWCDPD'@DBFIL                                              CSD015
     C                     Z-ADD26        @DBASE                                              CSD015
     C                     EXSR SUB999                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access SAR Details to see if Concord Interface Development is installed              CSD015
      *                                                                                       CSD015
     C                     MOVE 'N'       CCF001  1                                           CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY '@OPTN                                               CSD015
     C                     PARM 'CCF001'  @SARD                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'CCF001'  @DBKEY                                              CSD015
     C                     MOVEL'SCSARDPD'@DBFIL                                              CSD015
     C                     Z-ADD27        @DBASE                                              CSD015
     C                     EXSR SUB999                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
      ** Check if CRE020 is enabled.                                                          CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM '*VERIFY' POPTN                                               CRE020
     C                     PARM 'CRE020'  PSARD   6                                           CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     MOVE WPRGMN    KPRGMN                                              CRE020
     C                     ELSE                                                               CRE020
     C           PRTCD     IFNE '*NRF   '                                                     CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SCSARDPD'@DBFIL                                              CRE020
     C                     MOVEL'CRE020'  @DBKEY                                              CRE020
     C                     Z-ADD46        @DBASE                                              CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Check if a System Value exists for this maintenance.                                 CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSVALR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM WPSET     PSV01  20                                           CRE020
     C                     PARM           PCS01 200                                           CRE020
     C                     PARM           PSV02  20                                           CRE020
     C                     PARM           PCS02 200                                           CRE020
     C                     PARM           PSV03  20                                           CRE020
     C                     PARM           PCS03 200                                           CRE020
     C                     PARM           PSV04  20                                           CRE020
     C                     PARM           PCS04 200                                           CRE020
     C                     PARM           PSV05  20                                           CRE020
     C                     PARM           PCS05 200                                           CRE020
     C                     PARM           PSV06  20                                           CRE020
     C                     PARM           PCS06 200                                           CRE020
     C                     PARM           PSV07  20                                           CRE020
     C                     PARM           PCS07 200                                           CRE020
     C                     PARM           PSV08  20                                           CRE020
     C                     PARM           PCS08 200                                           CRE020
     C                     PARM           PSV09  20                                           CRE020
     C                     PARM           PCS09 200                                           CRE020
     C                     PARM           PSV10  20                                           CRE020
     C                     PARM           PCS10 200                                           CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       WSV01   1                                           CRE020
      *                                                                                       CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVELPCS01     WSV01                                               CRE020
     C                     ELSE                                                               CRE020
      *                                                                                       CRE020
     C           PRTCD     IFNE '*NRF'                                                        CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SDSVALPD'@DBFIL                                              CRE020
     C                     MOVELPSV01     @DBKEY                                              CRE020
     C                     Z-ADD102       @DBASE                                              CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Check if CGL031 (Taxation of Savings Income) is enabled.                             233607
      *                                                                                       233607
     C                     CALL 'AOSARDR0'                                                    233607
     C                     PARM *BLANKS   PRTCD                                               233607
     C                     PARM '*VERIFY' POPTN                                               233607
     C                     PARM 'CGL031'  PSARD   6                                           233607
     C           SCSARD    PARM SCSARD    DSFDY                                               233607
      *                                                                                       233607
     C                     MOVE 'N'       CGL031  1                                           233607
     C                     MOVE *OFF      *IN37                                               233607
      *                                                                                       233607
     C           PRTCD     IFEQ *BLANKS                                                       233607
     C                     MOVE 'Y'       CGL031                                              233607
     C                     MOVE *ON       *IN37                                               233607
     C                     ELSE                                                               233607
      *                                                                                       233607
     C           PRTCD     IFNE '*NRF   '                                                     233607
     C           *LOCK     IN   LDA                                                           233607
     C                     MOVEL'SCSARDPD'@DBFIL                                              233607
     C                     MOVEL'CGL031'  @DBKEY                                              233607
     C                     Z-ADD101       @DBASE                                              233607
     C                     OUT  LDA                                                           233607
     C                     EXSR *PSSR                                                         233607
     C                     ENDIF                                                              233607
      *                                                                                       233607
     C                     ENDIF                                                              233607
      *                                                                                       233607
     C                     ENDSR                           SUB001 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB002 - Get defaults for first trade processed              *
     C*****************************************************************
     C           SUB002    BEGSR
     C*
     C/COPY WNCPYSRC,SE3003C007
     C                     SETON                     11
     C/COPY WNCPYSRC,SE3003C008
     C***********          Z-ADD0         @CUMCH                          S01176
     C***********          Z-ADD0         @CUMNM                          S01176
     C                     MOVE '0'       *IN05                           S01511
     C*
     C* Get security via shortname
     C           @BTDSS    CHAINSECTYDF              01
     C           *IN01     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     Z-ADD4         @DBASE           ***************
     C                     MOVEL'SECTY'   @DBFIL           * DB ERROR 04 *
     C                     MOVEL@BTDSS    @DBKEY           ***************
     C                     EXSR SUB999
     C*                                                                   S01511
     C                     ELSE                                           S01511
     C           S01511    IFEQ 'Y'                                       S01511
     C           SMAI      ANDEQ'Y'                                       S01511
     C                     MOVE '1'       *IN05                           S01511
     C                     MOVEL@ER,19    @ERRTX                          S01511
     C                     EXSR SUB200                                    S01511
     C                     END                                            S01511
     C                     END
     C*                                                                   S01176
     C***  Store fields for charge calculations                           S01176
     C                     MOVELNMCYA     @XCCY                           S01176
     C                     Z-ADDNMDP      ZNMDP                           S01176
     C                     MOVE SPBS      ZSPBS                           S01176
     C                     MOVE CD01      CD01A                                               234691
     C                     MOVE CD02      CD02A                                               234691
     C                     MOVE CD03      CD03A                                               234691
     C                     MOVE CD04      CD04A                                               234691
     C                     MOVE CD05      CD05A                                               234691
     C                     MOVE CD06      CD06A                                               234691
     C                     MOVE CD07      CD07A                                               234691
     C                     MOVE CD08      CD08A                                               234691
     C                     MOVE CD09      CD09A                                               234691
     C                     MOVE CD10      CD10A                                               234691
     C                     MOVE CD11      CD11A                                               234691
     C                     MOVE CD12      CD12A                                               234691
     C                     MOVE CR01      CR01A                                               234691
     C                     MOVE CR02      CR02A                                               234691
     C                     MOVE CR03      CR03A                                               234691
     C                     MOVE CR04      CR04A                                               234691
     C                     MOVE CR05      CR05A                                               234691
     C                     MOVE CR06      CR06A                                               234691
     C                     MOVE CR07      CR07A                                               234691
     C                     MOVE CR08      CR08A                                               234691
     C                     MOVE CR09      CR09A                                               234691
     C                     MOVE CR10      CR10A                                               234691
     C                     MOVE CR11      CR11A                                               234691
     C                     MOVE CR12      CR12A                                               234691
      *                                                                                       233607
      ** Save Security details if CGL031 is enabled.                                          233607
      *                                                                                       233607
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     EXSR SRSSEC                                                        233607
     C                     ENDIF                                                              233607
     C*
     C*    Get Processing type
     C           @KEY1     CHAININVTPDF              01
     C           *IN01     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     Z-ADD5         @DBASE           ***************
     C                     MOVEL'INVTP'   @DBFIL           * DB ERROR 05 *
     C                     MOVELNMCYA     @WK6    6        ***************
     C                     MOVE SITP      @WK6
     C                     MOVEL@WK6      @DBKEY
     C                     EXSR SUB999
     C                     END
      *                                                                                       233607
      ** Save Investment Type details if CGL031 is enabled.                                   233607
      *                                                                                       233607
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     EXSR SRSINV                                                        233607
     C                     ENDIF                                                              233607
     C*
     C* Get related trade details if there are any
     C           @BRTRF    IFNE *BLANKS
     C           @BRTRF    CHAINTRADSDF              01
     C  N01                EXCPTRELTRD
     C           *IN01     IFEQ '1'
     C           RECI      ORNE 'D'
     C           RECI      ANDNE'A'
     C           RECI      ANDNE'S'
     C           RECI      ANDNE'L'                                       S01269
     C           RECI      ANDNE'P'                                       S01269
     C                     Z-ADD6         @DBASE           ***************
     C                     MOVEL'TRADS'   @DBFIL           * DB ERROR 06 *
     C                     MOVEL@BRTRF    @DBKEY           ***************
     C                     EXSR SUB999
     C                     END
     C                     END
     C*
     C* Get nominal currency decimal places for security
     C***********          MOVELNMCYA     @T10CY                          S01117
     C***********@KTG10    CHAINTABTG10F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C***********          Z-ADD14        @DBASE           ***************S01117
     C***********          MOVEL'TABLE'   @DBFIL           * DB ERROR 14 *S01117
     C***********          MOVEL@KTG10    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     MOVE NMCYA     @AJCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD14        @DBASE           ***************S01117
     C                     MOVEL'SDCURRPD'@DBFIL           * DB ERROR 14 *S01117
     C                     MOVELNMCYA     @DBKEY           ***************S01117
     C                     EXSR SUB999                                    S01117
     C                     END                                            S01117
     C*                                                                   S01176
     C***  Store fields for later calculations                            S01176
     C***********          Z-ADDCDP       NOMDP   10
     C***********          Z-ADDCDP       ZDECS                    S01176 S01117
     C                     Z-ADDA6NBDP    NOMDP   10                      S01117
     C                     Z-ADDA6NBDP    ZDECS                           S01117
     C                     MOVE A6MDIN    NOMMD   1                       S01117
     C*                                                                   S01446
     C* If Autocharges is on, switchable feature S01446 is on and the     S01446
     C* Charges Currency on SE ICD is not blank then calculate the        S01446
     C* cross rate and M/D indicator for use when converting Charge       S01446
     C* currency to nominal currency                                      S01446
     C*                                                                   S01446
     C           *IN15     IFEQ '1'                                       S01446
     C           S01446    ANDEQ'Y'                                       S01446
     C           BVCHRC    ANDNE*BLANK                                    S01446
     C                     Z-ADDUSPRT     ZRATE1                          S01446
     C                     MOVE UMDIN     ZMDI1                           S01446
     C                     Z-ADDA6SPRT    ZRATE2                          S01446
     C                     MOVE A6MDIN    ZMDI2                           S01446
     C                     EXSR ZXRATE                                    S01446
     C                     Z-ADDZRATEX    UCHXRT                          S01446
     C                     MOVE ZMDIX     UCHXMD                          S01446
     C                     END                                            S01446
     C*                                                                   S01117
     C                     ENDSR                           SUB002 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB003 - Update processing control                           *
     C*****************************************************************
     C           SUB003    BEGSR
     C*
     C                     SETOF                     12
     C**Get*CLINTSE*details*for*the*client**********************          S01117
     C* Get SDSECSPD details for the client                               S01117
     C*    and Tax Details from LF/SECGT                                  S01176
     C                     EXSR SUB009
     C*
     C* If defaults have not been generated (RECI = blank)
     C  N12      @BRECI    IFEQ *BLANK
     C*
     C* SUB100 - Common defaults
     C                     EXSR SUB100
     C*
     C* If not trade related, then get natural defaults (SUB101),
     C* else get trade related defaults (SUB102)
     C* Then get part 2 defaults (SUB104)
     C  N12      @BRTRF    IFEQ *BLANK
     C                     EXSR SUB101
     C                     ELSE
     C                     EXSR SUB102
     C                     END
     C  N12                EXSR SUB104
     C                     END
      *                                                                   CSW003
      **  If MT5xx present perform subroutine BLK1Z2 to obtain            CSW003
      **  corresponding extension records on BULKSDX1 & BULKSDX2.         CSW003
      *                                                                   CSW003
     C           S01401    IFEQ 'Y'                                       CSW003
     C                     EXSR BLK1Z2                                    CSW003
     C                     ENDIF                                          CSW003
     C*
     C* If this is a market trade, then accumulate market totals (SUB105)
     C  N12      @BATRD    IFEQ 'M'
     C           @BCHTP    ANDEQ'I'
     C                     EXSR SUB105
     C                     END
      *                                                                   041069
      * If Clearance Type is '0' trade cannot be complete unless Market   041069
      * is Grey                                                           041069
     C           @BCLTY    IFEQ '0'                                       041069
     C           @BTDMI    ANDNE'G'                                       041069
     C                     MOVE 'I'       @BTINC                          041069
     C                     END                                            041069
      *                                                                   CSE006
      * If a Buy-Sell Back, and this is the second of the two trades,     CSE006
      * update the Buy-Sell Backs position file.                          CSE006
     C           @BYSL     IFEQ 'Y'                                       CSE006
     C           @BBLKR    ANDNE@BTDRF                                    CSE006
     C                     EXSR BSPOS                                     CSE006
     C                     ENDIF                                          CSE006
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP13                                           S01408
     C*                                                                   S01408
     C*
     C* Update bulk trade with record id of '*'
     C                     MOVEL'*'       @BRECI
     C                     UPDATBULKTDF
     C                     MOVEL@BCHTP    @ACTN
     C                     Z-ADDNATN      @NTN
     C                     TIME           @TIME
      *                                                                   CSE006
      * If a Buy-Sell Back, and this is the second of the two trades,     CSE006
      * commit changes.                                                   CSE006
     C           @BYSL     IFEQ 'Y'                                       CSE006
     C           @BBLKR    IFNE @BTDRF                                    CSE006
     C           @CMTXT    COMIT                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ELSE                                           CSE006
     C           @CMTXT    COMIT
     C                     ENDIF                                          CSE006
     C*
     C* If an error has occurred, then print error report (SUB200), else
     C* update files (SUB201).
     C           *IN12     IFEQ '1'
     C                     EXSR SUB200
     C                     ELSE
     C                     EXSR SUB201
     C   12                EXSR SUB200
     C                     END
     C*
     C                     ENDSR                           SUB003 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB004 - Termination                                         *
     C*****************************************************************
     C           SUB004    BEGSR
     C*
     C* If an error has occurred, set return parameter
     C           *IN13     IFEQ '1'
     C                     MOVEL'ERROR '  @XTNUM
     C                     END
     C*
     C* If CSE006 is on close PF/BSPOSD                                   CSE006
     C           CSE006    IFEQ 'Y'                                       CSE006
     C                     CLOSEBSPOSD                                    CSE006
     C                     ENDIF                                          CSE006
     C*                                                                   CSE006
     C/COPY WNCPYSRC,SE3003C002
     C                     SETON                     LR
     C                     RETRN
     C*
     C                     ENDSR                           SUB004 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB009 - Get Security Customer Details for the client        *
     C*****************************************************************
     C           SUB009    BEGSR
     C*
     C* Get client trade details
     C***********@BTCNR    CHAINCLINTSEF             01                   S01117
     C**N01******          EXCPTRELCSE                                    S01117
     C***********RECI      IFEQ '*'                                       S01117
     C************IN01     OREQ '1'                                       S01117
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     MOVE @BTCNR    @WCUST                          S01117
     C                     EXSR AOSECS                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     12
     C                     MOVEL@ER,1     @ERRTX
     C                     MOVEL@BTCNR    @ETF1
     C*
     C                     ELSE
     C***********          MOVELTVCC      @VATCD  2                       S01176
     C***********          MOVE TAXC      @TAXC   2                S01176 S01117
     C***********          Z-ADDC1AC      @C1AC   40                      S01117
     C***********          Z-ADDC1SQ      @C1SQ   20                      S01117
     C***********          MOVELC1DI      @C1DI   1                       S01117
     C***********          MOVELC1SC      @C1SC   3                       S01117
     C***********          Z-ADDC1SQ      @C1SQ   20               S01176 S01117
     C***********          MOVELC101      @C101   6                       S01117
     C***********          MOVELC102      @C102   6                       S01117
     C***********          MOVE AUTS      @AUTS   1                S01176 S01117
     C                     MOVE BFTCD     @TAXC   2                       S01117
     C**********           MOVE BFACCD    @C1AC   4                                    S01117 CGL029
     C                     MOVE BFACCD    @C1AC  10                                           CGL029
     C                     Z-ADDBFACSN    @C1SQ   20                      S01117
     C                     MOVELBFCLAS    @C1DI   1                       S01117
     C                     MOVELBFCYCD    @C1SC   3                       S01117
      *                                                                   CSE022
      ** BFDRF1 needs to be updated by the 1st 6 characters of BFNDR1.    CSE022
      ** BFDRF2 needs to be updated by the 1st 6 characters of BFNDR2.    CSE022
      *                                                                   CSE022
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C                     MOVELBFDRF1    @C101   6                       S01117
     C                     MOVELBFDRF2    @C102   6                       S01117
     C                     MOVE BFASIN    @AUTS   1                       S01117
     C*                                                                   S01176
     C***  Chain to LF/SECGT for counterparty's standard tax details      S01176
     C                     MOVE @TAXC     @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   @TAXC                           S01176
     C                     ELSE                                           S01176
     C                     MOVE CHGB      @TCHGB                          S01176
     C                     MOVE THRI      @TTHRI                          S01176
     C                     Z-ADD@RA       @TRA                            S01176
     C                     Z-ADD@PC       @TPC                            S01176
     C                     Z-ADD@CG       @TCG                            S01176
     C                     Z-ADDMNCH      @TMNCH                          S01176
     C                     Z-ADDMXCH      @TMXCH                          S01176
     C                     MOVE TXAP      @TTXAP                          S01176
     C                     MOVE REBA      @TREBA                          S01176
     C                     MOVE LPSI      @TLPSI                          S01176
     C                     END                                            S01176
     C*
     C                     END
     C*
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE3003CCP1                                           S01408
     C*                                                                   S01408
     C                     ENDSR
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB100 - Set up common trade defaults                        *
     C*****************************************************************
     C           SUB100    BEGSR
     C*
     C**Branch*code:*defaults*to*value*on*ICD*******************   E18356 S01117
     C***********          Z-ADDDSTB      @BTDBR                          S01117
     C*
     C* Incomplete indicator defaults to value on security
     C                     MOVELINCS      @BTINC
     C*
     C* Book ID : If this is an agency trade
     C*           it should be set to default agency book from ICD. If
     C************an*agency*trade,*then*if*discretionary*ind.*is*M*use****S01176
     C*           not an agency trade, then if Classification is M, use   S01176
     C*           default market book else use default portfolio book.
     C*                                                                   S01176
     C           @BTDBK    IFEQ *BLANKS
     C           @BATRD    IFNE *BLANKS
     C***********          MOVELATBK      @BTDBK                          S01117
     C                     MOVELBVATBK    @BTDBK                          S01117
     C                     ELSE
     C           @C1DI     IFEQ 'M'
     C***********          MOVELDMKB      @BTDBK                          S01117
     C                     MOVELBVDMBC    @BTDBK                          S01117
     C                     ELSE
     C***********          MOVELDPFB      @BTDBK                          S01117
     C                     MOVELBVDPBC    @BTDBK                          S01117
     C                     END
     C                     END
     C                     END
     C*
     C* Market centre: defaults to market centre for investment type
     C                     MOVELDMKT      @BTMKC
     C*
     C**Trade*sub-type:*default*value*on*ICD*according*to*discretionary***S01176
     C******************indicator*****************************************S01176
     C* Trade sub-type: default value on ICD according to Classification  S01176
     C*                                                                   S01176
     C***********C1DI      IFEQ 'M'                                       S01117
     C***********          MOVELDMKS      @BTSUB                          S01117
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE3003CLD1                                           S01408
     C*                                                                   S01408
     C           BFCLAS    IFEQ 'M'                                       S01117
     C                     MOVELBVDMKS    @BTSUB                          S01117
     C                     ELSE
     C***********          MOVELDPFS      @BTSUB                          S01117
     C                     MOVELBVDPFS    @BTSUB                          S01117
     C                     END
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,SE3003CLD2                                           S01408
     C*                                                                   S01408
     C*
     C* Market indicator: defaults to market ind for security
     C                     MOVELMKTI      @BTDMI
     C*
     C**AIBD/IPMA:*defaults*to*Y***************************************   E43208
      * ISMA/IPMA: defaults to Y                                          E43208
      *                                                                   E43208
     C                     MOVEL'Y'       @BAIIP
     C*
     C* Current factor: from security details if processing type is 8
     C           PROT      IFEQ '8'
     C                     Z-ADDCFCT      @BTCFC
     C                     END
     C*
     C* Settlement currency: If customer is safe custody or discretionary,
     C*          then try 1. Value currency from standard settlements
     C*                   2. Settlement currency from client SE details
     C*                   3. Value currency from security details
     C*                   4. Nominal currency from security details
     C*       If multicurrency, then try payment currency then nominal
     C*       If not multicurrency, try value currency then nominal
     C           @C1DI     IFEQ 'S'
     C           @C1DI     OREQ 'D'
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C           S01509    IFEQ 'Y'                                                           CSE028
     C                     MOVELNMCYA     WCCY                                                CSE028
     C                     ELSE                                                               CSE028
     C                     MOVELVLCY      WCCY                                                CSE028
     C                     ENDIF                                                              CSE028
     C                     MOVE @BTDBK    WBKCD                                               CSE028
     C                     MOVE *BLANKS   WSMCC                                               CSE034
     C                     MOVE *BLANKS   WSITP                                               CSE028
     C                     MOVE *BLANKS   WPTFR                                               CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN01                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN01                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   WBKCD                                               CSE028
      *                                                                                       CSE028
     C           S01509    IFEQ 'Y'                                       S01509
     C/COPY WNCPYSRC,SE3003C013
     C           @KEY6S    CHAINSTDSEDF              01                   S01509
     C/COPY WNCPYSRC,SE3003C014
     C                     ELSE                                           S01509
     C/COPY WNCPYSRC,SE3003C015
     C           @KEY6     CHAINSTDSEDF              01
     C/COPY WNCPYSRC,SE3003C016
     C                     END                                            S01509
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C           *IN01     IFEQ '0'
     C           RECI      ANDEQ'D'
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVE NMCYA     @BSETC                          S01509
     C                     ELSE                                           S01509
     C                     MOVELVLCY      @BSETC
     C                     END                                            S01509
     C                     ELSE
     C           @C1SC     IFNE *BLANKS
     C                     MOVEL@C1SC     @BSETC
     C                     ELSE
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELNMCYA     @BSETC                          S01509
     C                     ELSE                                           S01509
     C           VLCY      IFNE *BLANKS
     C                     MOVELVLCY      @BSETC
     C                     ELSE
     C                     MOVELNMCYA     @BSETC
     C                     END
     C                     END                                            S01509
     C                     END
     C                     END
     C                     ELSE
     C           MLTI      IFEQ 'Y'
     C***********SPYC      IFNE *BLANKS                                   065524
     C***********          MOVELSPYC      @BSETC                          065524
     C***********          ELSE                                           065524
     C                     MOVELNMCYA     @BSETC
     C***********          END                                            065524
     C                     END
     C           MLTI      IFEQ 'N'
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELNMCYA     @BSETC                          S01509
     C                     ELSE                                           S01509
     C           VLCY      IFNE *BLANKS
     C                     MOVELVLCY      @BSETC
     C                     ELSE
     C                     MOVELNMCYA     @BSETC
     C                     END
     C                     END                                            S01509
     C                     END
     C                     END
     C*
     C* Capacity indicator:
      ** Capacity indicator should now be defaulted to 0, always.         085546
     C                     Z-ADD0         @BTCAP                          085546
     C***********                                                         085546
     C**********************If*not*an*agency*trade*=*5****************   085546
     C********Purchase******If*client*agency*trade*=*4****************   085546
     C**********************If*market*agency*trade*=*6****************   085546
     C***********                                                         085546
     C**********************If*not*an*agency*trade*=*2****************   085546
     C********Sale***********If*client*agency*trade*=*1****************   085546
     C**********************If*market*agency*trade*=*3****************   085546
     C***********@BTDTP    IFEQ 'TP'                                      085546
     C***********@BATRD    IFEQ 'C'                                       085546
     C***********          Z-ADD4         @BTCAP                          085546
     C***********          ELSE                                           085546
     C***********@BATRD    IFEQ 'M'                                       085546
     C***********          Z-ADD6         @BTCAP                          085546
     C***********          ELSE                                           085546
     C***********          Z-ADD5         @BTCAP                          085546
     C***********          END                                            085546
     C***********          END                                            085546
     C***********          ELSE                                           085546
     C***********@BATRD    IFEQ 'C'                                       085546
     C***********          Z-ADD1         @BTCAP                          085546
     C***********          ELSE                                           085546
     C***********@BATRD    IFEQ 'M'                                       085546
     C***********          Z-ADD3         @BTCAP                          085546
     C***********          ELSE                                           085546
     C***********          Z-ADD2         @BTCAP                          085546
     C***********          END                                            085546
     C***********          END                                            085546
     C***********          END                                            085546
     C***********                                                  S01448 085546
     C***If*Bulk*Input*Enhancements*feature*is*on*the*switchable***S01448 085546
     C***features*file*Then*overwrite*set*up*of*capacity*indicator*S01448 085546
     C***********                                                  S01448 085546
     C**********************If*not*an*agency*trade*=*5************S01448 085546
     C**********************Else**********************************S01448 085546
     C********Purchase******If*portfolio*client****=*4************S01448 085546
     C***********************Else**********************************S01448 085546
     C**********************Set*to*****************=*6************S01448 085546
     C***********                                                  S01448 085546
     C**********************If*not*an*agency*trade*=*2************S01448 085546
     C***********************Else**********************************S01448 085546
     C********Sale**********If*portfolio*client****=*1************S01448 085546
     C**********************Else**********************************S01448 085546
     C**********************set*to*****************=*3************S01448 085546
     C***********                                                  S01448 085546
     C***********S01448    IFEQ 'Y'                                S01448 085546
     C***********                                                  S01448 085546
     C***********@BTDTP    IFEQ 'TP'                               S01448 085546
     C***********@BATRD    IFEQ *BLANK                             S01448 085546
     C***********          Z-ADD5         @BTCAP                   S01448 085546
     C***********          ELSE                                    S01448 085546
     C***********@C1DI     IFEQ 'S'                                S01448 085546
     C***********@C1DI     OREQ 'D'                                S01448 085546
     C***********          Z-ADD4         @BTCAP                   S01448 085546
     C***********          ELSE                                    S01448 085546
     C***********          Z-ADD6         @BTCAP                   S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
     C***********@BTDTP    IFEQ 'TS'                               S01448 085546
     C***********@BATRD    IFEQ *BLANK                             S01448 085546
     C***********          Z-ADD2         @BTCAP                   S01448 085546
     C***********          ELSE                                    S01448 085546
     C***********@C1DI     IFEQ 'S'                                S01448 085546
     C***********@C1DI     OREQ 'D'                                S01448 085546
     C***********          Z-ADD1         @BTCAP                   S01448 085546
     C***********          ELSE                                    S01448 085546
     C***********          Z-ADD3         @BTCAP                   S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
     C***********          END                                     S01448 085546
     C*
     C**Exchange*rate*defaults*to*value*on*trade*details*if*settlement****065524
     C**currency*equals*payment*currency********************              065524
     C***********@BSETC    IFEQ SPYC                                      065524
     C***********          Z-ADDSEXR      @BTDER                          065524
     C***********SMDI      IFEQ '0'                                       065524
     C***********          MOVEL'D'       @BTMDI                          065524
     C***********          ELSE                                           065524
     C***********          MOVEL'M'       @BTMDI                          065524
     C***********          END                                            065524
     C***********          END                                            065524
     C*
     C* Exchange rate defaults to 1 if settlement currency is nominal
     C* currency
     C           @BSETC    IFEQ @BTNMC
     C                     Z-ADD1         @BTDER
     C                     MOVEL'M'       @BTMDI
     C*                                                                   065524
     C*    .. Settlement currency is not = Nominal currency               065524
     C*       Calculate cross rate                                        065524
     C                     ELSE                                           065524
     C           @BSETC    IFNE *BLANKS                                   065524
     C                     MOVE @BTNMC    @AJCD                           065524
     C                     MOVE '*DBERR ' @RTCD                           065524
     C                     EXSR AOCURR                                    065524
     C                     Z-ADDA6SPRT    ZRATE1 138                      065524
     C                     MOVE A6MDIN    ZMDI1   1                       065524
     C                     MOVE @BSETC    @AJCD                           065524
     C                     MOVE *BLANKS   @RTCD                           065524
     C                     EXSR AOCURR                                    065524
     C                     Z-ADDA6SPRT    ZRATE2 138                      065524
     C                     MOVE A6MDIN    ZMDI2   1                       065524
     C                     EXSR ZXRATE                                    065524
     C                     Z-ADDZRATEX    @BTDER                          065524
     C                     MOVE ZMDIX     @BTMDI                          065524
     C                     END                                            065524
     C                     END
     C*                                                                   CEU005
     C* If live record found on PF/STDSED and settlement currency is      CEU005
     C* not blank for a market client or portfolio client, then           CEU005
     C* check whether settlement and due Ccy is EURO or 'IN'.             CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           @C1DI     IFEQ 'M'                                       CEU005
     C/COPY WNCPYSRC,SE3003C019
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE @BTDBK    WBKCD                                               CSE028
     C                     MOVELNMCYA     WCCY                                                CSE028
     C                     MOVE SITP      WSITP                                               CSE028
     C                     MOVE SMCC      WSMCC                                               CSE034
     C                     MOVEL@BPTFR    WPTFR                                               CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN01                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN01                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   WBKCD                                               CSE028
     C                     MOVE *BLANKS   WPTFR                                               CSE028
      *                                                                                       CSE028
     C           @KEY9     CHAINSTDSED               01                   CEU005
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE3003C020
     C                     ENDIF                                          CEU005
     C           *IN01     IFEQ '0'                                       CEU005
     C           SCCY      ANDNE*BLANKS                                   CEU005
      *                                                                   CEU005
     C           NMCYA     IFEQ BKEURO                                    CEU005
     C                     MOVE *BLANKS   @RTCD                           CEU005
     C                     MOVE SCCY      @AJCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '39'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVELSCCY      @DBKEY            * ERROR 39 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   143690
     C           A6INCY    IFEQ 'Y'                                       143690
     C           @BTDVD    ANDGEA6TPSD                                    143690
     C                     MOVELSCCY      @BSETC                          143690
     C                     Z-ADDA6EUER    @BTDER                          143690
     C           A6EUMD    IFEQ 'M'                                       143690
     C                     MOVE 'D'       @BTMDI                          143690
     C                     ELSE                                           143690
     C                     MOVE 'M'       @BTMDI                          143690
     C                     ENDIF                                          143690
     C                     ENDIF                                          143690
     C*                                                                   143690
     C                     ELSE                                           CEU005
     C           SCCY      IFEQ BKEURO                                    CEU005
     C                     MOVE *BLANKS   @RTCD                           CEU005
     C                     MOVE NMCYA     @AJCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '40'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVELNMCYA     @DBKEY            * ERROR 40 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C                     END                                            CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           @BTDVD    ANDGEA6TPSD                                    CEU005
     C                     MOVELSCCY      @BSETC                          CEU005
     C                     Z-ADDA6EUER    @BTDER                          CEU005
     C*                                                                   CEU005
     C           SCCY      IFEQ BKEURO                                    CEU005
     C***********A6EUMD    IFEQ 'M'                                CEU005 143690
     C***********          MOVE 'D'       @BTMDI                   CEU005 143690
     C***********          ELSE                                    CEU005 143690
     C***********          MOVE 'M'       @BTMDI                   CEU005 143690
     C***********          ENDIF                                   CEU005 143690
     C***********          ELSE                                    CEU005 143690
     C                     MOVE A6EUMD    @BTMDI                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C*
     C* If exchange rate has not been set up, and client is safe
     C* custody or discretionary then make trade incomplete.
     C           @C1DI     IFEQ 'D'
     C           @BTDER    ANDEQ0
     C           @C1DI     OREQ 'S'
     C           @BTDER    ANDEQ0
     C                     MOVEL'I'       @BTINC
     C                     END
     C*
     C* Base currency rate defaults to spot rate from currency table
     C***********          MOVEL@BSETC    @T10CY                          S01117
     C***********@KTG10    CHAINTABTG10F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     MOVE @BSETC    @AJCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     12
     C                     MOVEL@ER,2     @ERRTX
     C                     MOVEL@BSETC    @ETF2
     C                     GOTO END100
     C                     END
     C***********          Z-ADDSPOT      @BTBCR                          S01117
     C                     Z-ADDA6SPRT    @BTBCR                          S01117
     C***********                                                         S01176
     C**Set*up*default*codes*and*commissions*if*none*entered**************S01176
     C***********@BTBCC    IFEQ *BLANKS                                   S01176
     C***********@BTCCC    ANDEQ*BLANKS                                   S01176
     C***********@BTTCC    ANDEQ*BLANKS                                   S01176
     C***********@BTPCC    ANDEQ*BLANKS                                   S01176
     C***********                                                         S01176
     C**Set*off*'defaults*found'*flag*************************************S01176
     C***********          SETOF                     04                   S01176
     C***********                                                         S01176
     C**Set*up*key*fields*************************************************S01176
     C***********          MOVEL@C1DI     @KC1DI                          S01176
     C***********          MOVELSITP      @KSITP                          S01176
     C***********          MOVELSMCC      @KMRKT                          S01176
     C***********          Z-ADD@BTCNR    @KCNUM                          S01176
     C***********                                                         S01176
     C**Access*customer/broker*defaults*file,*set*on*flag*if*record*found*S01176
     C***********@KEY3     CHAINCUBRD                01                   S01176
     C************IN01     IFEQ '0'                                       S01176
     C***********RECI      ANDEQ'D'                                       S01176
     C***********          SETON                     04                   S01176
     C***********          ELSE                                           S01176
     C***********                                                         S01176
     C**If*not*found,*access*customer/broker*defaults*by*customer*file****S01176
     C**If*record*found*on*this*file,*leave*default*codes*blank***********S01176
     C***********@KCNUM    CHAINCUBRC                01                   S01176
     C***********                                                         S01176
     C**If*record*not*found*on*LF/CUBRC,*chain*to*LF/CUBRD*again*with*a***S01176
     C**customer*number*of*zero*******************************************S01176
     C************IN01     IFEQ '1'                                       S01176
     C***********RECI      ORNE 'D'                                       S01176
     C***********          Z-ADD0         @KCNUM                          S01176
     C***********@KEY3     CHAINCUBRD                01                   S01176
     C************IN01     IFEQ '0'                                       S01176
     C***********RECI      ANDEQ'D'                                       S01176
     C***********          SETON                     04                   S01176
     C***********          ELSE                                           S01176
     C***********                                                         S01176
     C**If*record*not*found,*chain*to*LF/CUBRD*again*with*a*blank*market**S01176
     C**centre************************************************************S01176
     C***********          MOVEL*BLANKS   @KMRKT                          S01176
     C***********@KEY3     CHAINCUBRD                01                   S01176
     C************IN01     IFEQ '0'                                       S01176
     C***********RECI      ANDEQ'D'                                       S01176
     C***********          SETON                     04                   S01176
     C***********          ELSE                                           S01176
     C***********                                                         S01176
     C**If*record*not*found,*chain*to*LF/CUBRD*again*with*a*blank*********S01176
     C**investment*type***************************************************S01176
     C***********          MOVEL*BLANKS   @KSITP                          S01176
     C***********@KEY3     CHAINCUBRD                01                   S01176
     C************IN01     IFEQ '0'                                       S01176
     C***********RECI      ANDEQ'D'                                       S01176
     C***********          SETON                     04                   S01176
     C***********          END                                            S01176
     C***********          END                                            S01176
     C***********          END                                            S01176
     C***********          END                                            S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**If*default*found,*update*values*on*bulk*record********************S01176
     C************IN04     IFEQ '1'                                       S01176
     C***********          MOVELTBCC      @BTBCC                          S01176
     C***********          MOVELTTCC      @BTTCC                          S01176
     C***********          MOVELTPCC      @BTPCC                          S01176
     C**If*market*customer*suppress*customer*commission*******************S01176
     C***********@C1DI     IFEQ 'M'                                       S01176
     C***********          MOVE *BLANK    @BTCCC                          S01176
     C***********          ELSE                                           S01176
     C***********          MOVELTCCC      @BTCCC                          S01176
     C***********          END                                            S01176
     C***********          END                                            S01176
     C***********                                                         S01176
     C**If*default*brokerage*not*yet*set,*and*this*trade*is*a*client******S01176
     C**agency*trade******************************************************S01176
     C***********@BTBCC    IFEQ *BLANKS                                   S01176
     C***********@BATRD    ANDEQ'C'                                       S01176
     C***********          MOVELDEBC      @BTBCC                          S01176
     C***********          END                                            S01176
     C*                                                                   S01176
     C***  If Autocharges yes, determine the defaults for Charge /        S01176
     C***  Commission Codes and Rebate % (if not already set up)          S01176
     C           @BRECI    IFEQ *BLANKS                                   S01176
     C*                                                                   S01176
     C***********AUMO      IFEQ 'Y'                                S01176 S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
     C                     EXSR SUB403                                    S01176
     C*                                                                   S01176
     C***  ELSE, for a Client Agency Trade, Default the Broker            S01176
     C*****Commission*Code*to*that*held*on*PF/TABTB36*and*check*it*S01176 S01117
     C***  Commission Code to that held on SDSTRDPD and check it          S01117
     C***  against LF/SECGT.                                              S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C           @BATRD    IFEQ 'C'                                       S01176
     C***********          MOVE DEBC      @BTBCC                   S01176 S01117
     C                     MOVE BVDBCD    @BTBCC                          S01117
     C*                                                                   S01176
     C                     MOVE @BTBCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   @BTBCC                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*
     C                     END
     C*                                                                   S01176
     C***  The AUTO SETTLE INDICATOR defaults to the value on             S01176
     C***  LF/CLINTSE for the c/party.                                    S01176
     C*                                                                   S01176
     C                     MOVE @AUTS     @BAUTS                          S01176
     C*
     C* The following defaults are applied for primary and secondary
     C* trades only
     C           @BTDMI    IFEQ 'P'
     C           @BTDMI    OREQ 'S'
     C*
     C* Initialize settlement inst. record found flag
     C                     MOVE *BLANKS   SETFLG  1
     C*
     C* Initally set up clearance type as 0
     C                     MOVE '0'       @BCLTY
     C*
     C* If customer is safe custody or discretionary, get standard
     C* settlement details with a partial key, else use full key
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C           @C1DI     IFEQ 'D'                                                           CSE028
     C           @C1DI     OREQ 'S'                                                           CSE028
     C                     MOVEL*BLANKS   WSITP                                               CSE028
     C                     MOVEL*BLANKS   WSMCC                                               CSE034
     C                     MOVE *BLANKS   WPTFR                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVELSITP      WSITP                                               CSE028
     C                     MOVELSMCC      WSMCC                                               CSE034
     C                     MOVE @BPTFR    WPTFR                                               CSE028
     C                     ENDIF                                                              CSE028
     C                     MOVE @BSETC    WCCY                                                CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN01                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN01                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   WBKCD                                               CSE028
     C                     MOVE *BLANKS   WPTFR                                               CSE028
      *                                                                                       CSE028
     C           @C1DI     IFEQ 'D'
     C           @C1DI     OREQ 'S'
     C***********@KEY8     CHAINSTDSEDF              01                   E23363
     C/COPY WNCPYSRC,SE3003C017
     C           @KEY7     CHAINSTDSEDF              01                   E23363
     C/COPY WNCPYSRC,SE3003C018
     C                     ELSE
     C***********@KEY7     CHAINSTDSEDF              01                   E23363
     C/COPY WNCPYSRC,SE3003C021
     C           @KEY8     CHAINSTDSEDF              01                   E23363
     C/COPY WNCPYSRC,SE3003C022
     C                     END
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C*
     C* Settlement default record found
     C           *IN01     IFEQ '0'
     C           RECI      ANDEQ'D'
     C*
     C                     MOVE 'Y'       SETFLG
     C*
     C* Set up defaults for purchase trade
     C           @BTDTP    IFEQ 'TP'
     C*
     C* Settlement method: default to pay settlement method
     C           @BSMTH    IFEQ 0
     C           @BTINC    IFEQ 'I'
     C                     Z-ADD0         @BSMTH
     C                     ELSE
     C                     Z-ADDSPSM      @BSMTH
     C                     END
     C                     END
     C*
     C* Pay from: default to pay a/c
     C                     MOVELSPAT      @BPYFM
     C*
     C* Pay from branch: default to pay branch
     C***********          Z-ADDSPBR      @BPYFB                          S01117
     C                     MOVE SPBA      @BPYFA                          S01117
     C*
     C* Pay to: default to counterparty bank
     C                     MOVELSPCB      @BPAYT
     C*
     C* Pay to branch: default to pay branch
     C***********          Z-ADDSPBR      @BPYTB                          S01117
     C                     MOVE SPBA      @BPYTA                          S01117
     C*
     C* For a/c of: default to for a/c of
     C                     MOVELSPFA      @BTDFA
     C*
     C* Special instructions: default to special insructions
     C                     MOVELSPSI      @BTDSI
     C*
     C* Clearance Type
     C           SCLP      IFNE *BLANK
     C                     MOVELSCLP      @BCLTY
     C                     END
     C*
     C**C/H*ind:*default*to*C/H*ind********                               S01175
     C***********          MOVELSCLH      @BCLRH                          S01175
     C*
     C* Pay code: default to pay code purchase
     C                     MOVELSPCP      @BPCOD
     C*
     C*  For a/c of (DELIVER FROM)                                        S01175
     C                     MOVELSFAF      @BDFFA                          S01175
     C*
     C* Set up defaults for sale trade
     C                     ELSE
     C*
     C* Settlement method: default to receive settlement method
     C           @BSMTH    IFEQ 0
     C           @BTINC    IFEQ 'I'
     C                     Z-ADD0         @BSMTH
     C                     ELSE
     C                     Z-ADDSRSM      @BSMTH
     C                     END
     C                     END
     C*
     C* Pay from: default to counterparty bank
     C                     MOVELSRCB      @BPYFM
     C*
     C* Pay from branch: default to receive branch
     C***********          Z-ADDSRBR      @BPYFB                          S01117
     C                     MOVE SRAB      @BPYFA                          S01117
     C*
     C* Pay to: default to receive a/c
     C                     MOVELSRAC      @BPAYT
     C*
     C* Pay to branch: default to receive branch
     C***********          Z-ADDSRBR      @BPYTB                          S01117
     C                     MOVE SRAB      @BPYTA                          S01117
     C*
     C* Special instructions: default to special insructions
     C                     MOVELSPSI      @BTDSI
     C*
     C**C/H*ind:*default*to*C/H*ind*******                                S01175
     C***********          MOVELSCLH      @BCLRH                          S01175
     C*
     C* Pay code: default to pay code sale
     C                     MOVELSPCS      @BPCOD
     C*
     C* For a/c of
     C                     MOVELSFAT      @BDTFA
     C*                                                                   E36792
     C** For a/c of: default to for a/c of                                E36792
     C*                                                                   E36792
     C                     MOVELSPFA      @BTDFA                          E36792
     C*                                                                   E36792
     C** Clearance Type                                                   E36792
     C*                                                                   E36792
     C           SCLS      IFNE *BLANK                                    E36792
     C                     MOVELSCLS      @BCLTY                          E36792
     C                     END                                            E36792
     C*
     C                     END
     C                     END
     C*
     C* Apply natural defaults
     C*
     C*                                                                   CEU005
     C** If settlement Ccy is EURO, nominal Ccy is 'IN, live record       CEU005
     C** on PF/STDSED, field ERII is 'Y' and settlement method is         CEU005
     C** either 01 or 08 then move nominal Ccy into @BICCY                CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           @BSETC    ANDEQBKEURO                                    CEU005
      *                                                                   CEU005
     C           NMCYA     IFNE *BLANK                                    CEU005
     C                     MOVE *BLANKS   @RTCD                           CEU005
     C                     MOVE NMCYA     @AJCD                           CEU005
     C                     EXSR AOCURR                                    CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     SETON                     U7U8                 CEU005
     C                     MOVE '41'      @DBASE            ************  CEU005
     C                     MOVEL'SDCURRPD'@DBFIL            * DATABASE *  CEU005
     C                     MOVELNMCYA     @DBKEY            * ERROR 41 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C           A6INCY    IFEQ 'Y'                                       CEU005
     C           @BTDVD    ANDGEA6TPSD                                    CEU005
     C           RECI      ANDEQ'D'                                       CEU005
     C           ERII      ANDEQ'Y'                                       CEU005
     C           @BSMTH    ANDEQ1                                         CEU005
     C           A6INCY    OREQ 'Y'                                       CEU005
     C           @BTDVD    ANDGEA6TPSD                                    CEU005
     C           RECI      ANDEQ'D'                                       CEU005
     C           ERII      ANDEQ'Y'                                       CEU005
     C           @BSMTH    ANDEQ8                                         CEU005
     C                     MOVE NMCYA     @BICCY                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   CEU005
     C* Settlement method: If customer is not safe custody or discretionary,
     C* default to 1, else default to 15 if settlement a/c present on
     C* client security details.
     C           @BSMTH    IFEQ 0
     C           @BTINC    ANDNE'I'
     C           @C1DI     IFNE 'S'
     C           @C1DI     ANDNE'D'
     C                     Z-ADD1         @BSMTH
     C                     ELSE
     C***********@C1AC     IFNE 0                                         S01117
     C           @C1AC     IFNE *BLANKS                                   S01117
     C                     Z-ADD15        @BSMTH
     C                     END
     C                     END
     C                     END
     C*
     C* Pay code: if customer is safe custody or discretionary, default
     C* to 3, else default to 1
     C           @BPCOD    IFEQ *BLANKS
     C***********C1DI      IFEQ 'D'                                       S01117
     C***********C1DI      OREQ 'S'                                       S01117
     C           BFCLAS    IFEQ 'D'                                       S01117
     C           BFCLAS    OREQ 'S'                                       S01117
     C                     MOVEL'3'       @BPCOD
     C                     ELSE
     C                     MOVEL'1'       @BPCOD
     C                     END
     C                     END
     C*
     C           @BTDTP    IFEQ 'TP'
     C*
     C*  PAY TO :
     C           @BPAYT    IFEQ *BLANKS
     C           @BSMTH    ANDEQ1
     C                     MOVEL@BTCNR    @BPAYT
     C                     END
     C*
     C* Pay from:
     C*
     C* For purchase, and some settlement method, pay code and clearance
     C* type combinations, get details from standing data
     C           @BPYFM    IFEQ *BLANKS
     C*
     C           @BSMTH    IFEQ 1
     C           @BPCOD    IFEQ '1'
     C           @BPCOD    OREQ '5'
     C           @BCLTY    IFEQ '1'
     C           @BCLTY    OREQ '2'
     C           @BCLTY    OREQ '3'
     C           @BCLTY    OREQ '4'
     C***********          MOVEL@BSETC    @T20CY                          S01117
     C***********@KTG20    CHAINTABTG20F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD7         @DBASE           ***************S01117
     C***********          MOVEL'TABSE'   @DBFIL           * DB ERROR 07 *S01117
     C***********          MOVEL@KTG20    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     MOVE @BSETC    @AJCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD7         @DBASE           ***************S01117
     C                     MOVEL'SDCURRPD'@DBFIL           * DB ERROR 07 *S01117
     C                     MOVEL@BSETC    @DBKEY           ***************S01117
     C                     EXSR SUB999                                    S01117
     C                     END                                            S01117
     C*
     C* Use Euroclear or Cedel codes as appropriate
     C           @BCLTY    IFEQ '1'
     C           @BCLTY    OREQ '2'
     C***********          MOVELEUDN      @BPYFM                          S01117
     C                     MOVELA6ECDN    @BPYFM                          S01117
     C                     ELSE
     C***********          MOVELCEDN      @BPYFM                          S01117
     C                     MOVELA6CDFN    @BPYFM                          S01117
     C                     END
     C*
     C* Reset pay from branch
     C           @BPYFM    IFNE *BLANKS
     C*
     C***********          MOVEL@BPYFM    @TLNN                           S01117
     C***********          MOVEL@BSETC    @TLCY                           S01117
     C***********@KTBTL    CHAINTABLETLF             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD08        @DBASE           ***************S01117
     C***********          MOVEL'TABSE'   @DBFIL           * DB ERROR 08 *S01117
     C***********          MOVEL@KTBTL    @DBKEY           ***************S01117
     C***********          EXSR SUB999                                    S01117
     C***********          END                                            S01117
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     MOVE @BSETC    P@CYCD                          S01117
     C                     MOVEL@BPYFM    P@NONB                          S01117
     C                     EXSR AONOST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD08        @DBASE           ***************S01117
     C                     MOVEL'SDNOSTPD'@DBFIL           * DB ERROR 08 *S01117
     C                     MOVELKNOST     @DBKEY           ***************S01117
     C                     EXSR SUB999                                    S01117
     C                     END                                            S01117
     C*
     C                     MOVELA7ACCD    ACOD                            S01117
     C                     MOVELA7BRCD    BRCA                            S01117
     C                     MOVELA7CUST    CNUM                            S01117
     C                     MOVELA7ACSN    ACSQ                            S01117
     C                     MOVEL@BSETC    CCY
     C           @KEYD     CHAINACCNTABF             01
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C                     Z-ADD09        @DBASE           ***************
     C                     MOVEL'ACCNT'   @DBFIL           * DB ERROR 09 *
     C                     MOVEL@DSACC    @DBKEY           ***************
     C                     EXSR SUB999
     C                     END
     C*
     C***********          MOVELBRCD      @BPYFB                          S01117
     C                     MOVELA7BRCD    @BPYFA                          S01117
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C* If still blank, use customer number
     C           @BPYFM    IFEQ *BLANKS
     C***********@C1AC     IFNE 0                                         S01117
     C           @C1AC     IFNE *BLANKS                                   S01117
     C           @BSMTH    ANDEQ15
     C                     MOVEL@BTCNR    @BPYFM
     C**********           MOVEL@C1AC     WOUT06  6                                    E16843 CGL029
     C**********           MOVE @C1SQ     WOUT06                                       E16843 CGL029
     C**********           MOVE WOUT06    @BPYFM                                       E16843 CGL029
     C                     MOVEL@C1AC     WOUT12 12                                           CGL029
     C                     MOVE @C1SQ     WOUT12                                              CGL029
     C                     MOVE WOUT12    @BPYFM                                              CGL029
     C                     END
     C                     END
     C*                                                                   102775
     C* If Settlement method 15, check again that a/c code & seq are there102775
     C           @BPYFM    IFNE *BLANKS                                   102775
     C           @BSMTH    ANDEQ15                                        102775
     C           @C1AC     ANDNE*BLANKS                                   102775
     C**********           MOVE @BPAYT    WOUT06                                       102775 CGL029
     C********** WOUT06    IFEQ *BLANKS                                                102775 CGL029
     C**********           MOVEL@C1AC     WOUT06                                       102775 CGL029
     C**********           MOVE @C1SQ     WOUT06                                       102776 CGL029
     C**********           MOVE WOUT06    @BPYFM                                       102775 CGL029
     C                     MOVE @BPAYT    WOUT12                                              CGL029
     C           WOUT12    IFEQ *BLANKS                                                       CGL029
     C                     MOVEL@C1AC     WOUT12                                              CGL029
     C                     MOVE @C1SQ     WOUT12                                              CGL029
     C                     MOVE WOUT12    @BPYFM                                              CGL029
     C                     END                                            102775
     C                     END                                            102775
     C*
     C* If branch is still not set, use trade branch
     C***********@BPYFB    IFEQ 0                                         S01117
     C***********          Z-ADD@BTDBR    @BPYFB                          S01117
     C           @BPYFA    IFEQ *BLANKS                                   S01117
     C                     MOVE @BTDBA    @BPYFA                          S01117
     C                     MOVE @BTDBA    @BPYTA                          S01117
     C                     END
     C                     END
     C*
     C           @BTDTP    IFEQ 'TS'
     C*
     C*  PAY FROM:
     C           @BPYFM    IFEQ *BLANKS
     C           @BSMTH    ANDEQ1
     C                     MOVEL@BTCNR    @BPYFM
     C                     END
     C*
     C* Pay to:
     C           @BPAYT    IFEQ *BLANKS
     C*
     C* For sales, and some settlement method, pay code and clearance
     C* type combinations, get details from Standing Data
     C           @BSMTH    IFEQ 1
     C           @BPCOD    IFEQ '1'
     C           @BPCOD    OREQ '5'
     C           @BCLTY    IFEQ '1'
     C           @BCLTY    OREQ '2'
     C           @BCLTY    OREQ '3'
     C           @BCLTY    OREQ '4'
     C***********          MOVEL@BSETC    @T20CY                          S01117
     C***********@KTG20    CHAINTABTG20F             01                   S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      OREQ '*'                                       S01117
     C***********          Z-ADD10        @DBASE           ***************S01117
     C***********          MOVEL'TABSE'   @DBFIL           * DB ERROR 10 *S01117
     C***********          MOVEL@KTG20    @DBKEY           ***************S01117
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     MOVE @BSETC    @AJCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD10        @DBASE           ***************S01117
     C                     MOVEL'SDCURRPD'@DBFIL           * DB ERROR 10 *S01117
     C                     MOVEL@AJCD     @DBKEY           ***************S01117
     C                     EXSR SUB999
     C                     END
     C*
     C* Use Euroclear or Cedel codes as appropriate
     C           @BCLTY    IFEQ '1'
     C           @BCLTY    OREQ '2'
     C***********          MOVELEUDN      @BPAYT                          S01117
     C                     MOVELA6ECDN    @BPAYT                          S01117
     C                     ELSE
     C***********          MOVELCEDN      @BPAYT                          S01117
     C                     MOVELA6CDFN    @BPAYT                          S01117
     C                     END
     C*
     C* Reset pay to branch
     C           @BPAYT    IFNE *BLANKS
     C*
     C***********          MOVEL@BPAYT    @TLNN
     C***********          MOVEL@BSETC    @TLCY
     C***********@KTBTL    CHAINTABLETLF             01
     C************IN01     IFEQ '1'
     C***********RECI      OREQ '*'
     C***********          Z-ADD11        @DBASE           ***************
     C***********          MOVEL'TABSE'   @DBFIL           * DB ERROR 11 *
     C***********          MOVEL@KTBTL    @DBKEY           ***************
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     MOVE @BSETC    P@CYCD                          S01117
     C                     MOVEL@BPAYT    P@NONB                          S01117
     C                     EXSR AONOST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD11        @DBASE           ***************
     C                     MOVEL'SDNOSTPD'@DBFIL           * DB ERROR 11 *
     C                     MOVELKNOST     @DBKEY           ***************
     C                     EXSR SUB999
     C                     END
     C*
     C                     MOVELA7ACCD    ACOD                            S01117
     C                     MOVELA7BRCD    BRCA                            S01117
     C                     MOVELA7CUST    CNUM                            S01117
     C                     MOVELA7ACSN    ACSQ                            S01117
     C                     MOVEL@BSETC    CCY
     C           @KEYD     CHAINACCNTABF             01
     C           *IN01     IFEQ '1'
     C           RECI      OREQ '*'
     C                     Z-ADD12        @DBASE           ***************
     C                     MOVEL'ACCNT'   @DBFIL           * DB ERROR 12 *
     C                     MOVEL@DSACC    @DBKEY           ***************
     C                     EXSR SUB999
     C                     END
     C*
     C***********          MOVELBRCD      @BPYTB                          S01117
     C                     MOVELA7BRCD    @BPYTA                          S01117
     C*
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C* If still blank, use customer number
     C           @BPAYT    IFEQ *BLANKS
     C***********@C1AC     IFNE 0                                         S01117
     C           @C1AC     IFNE *BLANKS                                   S01117
     C           @BSMTH    ANDEQ15
     C                     MOVEL@BTCNR    @BPAYT
     C**********           MOVEL@C1AC     WOUT06                                       E16843 CGL029
     C**********           MOVE @C1SQ     WOUT06                                       E16843 CGL029
     C**********           MOVE WOUT06    @BPAYT                                       E16843 CGL029
     C                     MOVEL@C1AC     WOUT12                                              CGL029
     C                     MOVE @C1SQ     WOUT12                                              CGL029
     C                     MOVE WOUT12    @BPAYT                                              CGL029
     C                     END
     C                     END
     C*                                                                   102775
     C* If Settlement method 15, check again that a/c code & seq are there102775
     C           @BPAYT    IFNE *BLANKS                                   102775
     C           @BSMTH    ANDEQ15                                        102775
     C           @C1AC     ANDNE*BLANKS                                   102775
     C**********           MOVE @BPAYT    WOUT06                                       102775 CGL029
     C********** WOUT06    IFEQ *BLANKS                                                102775 CGL029
     C**********           MOVEL@C1AC     WOUT06                                       102775 CGL029
     C**********           MOVE @C1SQ     WOUT06                                       102776 CGL029
     C**********           MOVE WOUT06    @BPAYT                                       102775 CGL029
     C                     MOVE @BPAYT    WOUT12                                              CGL029
     C           WOUT12    IFEQ *BLANKS                                                       CGL029
     C                     MOVEL@C1AC     WOUT12                                              CGL029
     C                     MOVE @C1SQ     WOUT12                                              CGL029
     C                     MOVE WOUT12    @BPAYT                                              CGL029
     C                     END                                            102775
     C                     END                                            102775
     C*
     C* If branch is still not set, use trade branch
     C***********@BPYTB    IFEQ 0                                         S01117
     C***********          Z-ADD@BTDBR    @BPYTB                          S01117
     C           @BPYTA    IFEQ *BLANKS                                   S01117
     C                     MOVE @BTDBA    @BPYTA                          S01117
     C                     MOVE @BTDBA    @BPYFA                          S01117
     C                     END
     C                     END
     C*                                                                   E21063
     C* Deliver from: (purchase) -                                        E21063
     C*            If clearance type = 1 or 2 then use depot 1 from       E21063
     C*               client details if present else from ICD             E21063
     C*            If clearance type = 3 or 4 then use depot 2 from       E21063
     C*               client details if present else from ICD             E21063
     C           @BTDTP    IFEQ 'TP'                                      E21063
     C********** @BDELF    IFEQ 0                                                      E21063 CSD027
     C           @BDELF    IFEQ *BLANKS                                                       CSD027
     C           @BCLTY    IFEQ '1'                                       E21063
     C           @BCLTY    OREQ '2'                                       E21063
     C           @C101     IFNE *BLANKS                                   E21063
     C                     MOVEL@C101     @BDELF                          E21063
     C                     ELSE                                           E21063
     C***********          MOVELDC01      @BDELF                   E21063 S01117
     C                     MOVELBVDR1     @BDELF                          S01117
     C                     END                                            E21063
     C                     END                                            E21063
     C           @BCLTY    IFEQ '3'                                       E21063
     C           @BCLTY    OREQ '4'                                       E21063
     C           @C102     IFNE *BLANKS                                   E21063
     C                     MOVEL@C102     @BDELF                          E21063
     C                     ELSE                                           E21063
     C***********          MOVELDC02      @BDELF                   E21063 S01117
     C                     MOVELBVDR2     @BDELF                          S01117
     C                     END                                            E21063
     C                     END                                            E21063
     C                     END                                            E21063
     C*                                                                   E21063
     C* Deliver to: (purchase) -                                          E21063
     C*       If clearance type = 1 or 4 then use depot 1 from ICD        E21063
     C*       If clearance type = 2 or 3 then use depot 2 from ICD        E21063
     C********** @BDELT    IFEQ 0                                                      E21063 CSD027
     C           @BDELT    IFEQ *BLANKS                                                       CSD027
     C           @BCLTY    IFEQ '1'                                       E21063
     C           @BCLTY    OREQ '4'                                       E21063
     C***********          MOVELDC01      @BDELT                   E21063 S01117
     C                     MOVELBVDR1     @BDELT                          S01117
     C                     END                                            E21063
     C           @BCLTY    IFEQ '2'                                       E21063
     C           @BCLTY    OREQ '3'                                       E21063
     C***********          MOVELDC02      @BDELT                   E21063 S01117
     C                     MOVELBVDR2     @BDELT                          S01117
     C                     END                                            E21063
     C                     END                                            E21063
     C                     END                                            E21063
     C*                                                                   E21063
     C* Deliver from: (sale) -                                            E21063
     C*         If clearance type = 1 or 2 then use depot 1 from ICD      E21063
     C*         If clearance type = 3 or 4 then use depot 2 from ICD      E21063
     C           @BTDTP    IFEQ 'TS'                                      E21063
     C********** @BDELF    IFEQ 0                                                      E21063 CSD027
     C           @BDELF    IFEQ *BLANKS                                                       CSD027
     C           @BCLTY    IFEQ '1'                                       E21063
     C           @BCLTY    OREQ '2'                                       E21063
     C***********          MOVELDC01      @BDELF                   E21063 S01117
     C                     MOVELBVDR1     @BDELF                          S01117
     C                     END                                            E21063
     C           @BCLTY    IFEQ '3'                                       E21063
     C           @BCLTY    OREQ '4'                                       E21063
     C***********          MOVELDC02      @BDELF                   E21063 S01117
     C                     MOVELBVDR2     @BDELF                          S01117
     C                     END                                            E21063
     C                     END                                            E21063
     C*                                                                   E21063
     C* Deliver to: (sale) -                                              E21063
     C*             If clearance type = 1 or 4 then use depot 1 from      E21063
     C*              client details if present else from ICD              E21063
     C*             If clearance type = 2 or 3 then use depot 2 from      E21063
     C*              client details if present else from ICD              E21063
     C********** @BDELT    IFEQ 0                                                      E21063 CSD027
     C           @BDELT    IFEQ *BLANKS                                                       CSD027
     C           @BCLTY    IFEQ '1'                                       E21063
     C           @BCLTY    OREQ '4'                                       E21063
     C           @C101     IFNE *BLANKS                                   E21063
     C                     MOVEL@C101     @BDELT                          E21063
     C                     ELSE                                           E21063
     C***********          MOVELDC01      @BDELT                   E21063 S01117
     C                     MOVELBVDR1     @BDELT                          S01117
     C                     END                                            E21063
     C                     END                                            E36792
     C           @BCLTY    IFEQ '2'                                       E21063
     C           @BCLTY    OREQ '3'                                       E21063
     C           @C102     IFNE *BLANKS                                   E21063
     C                     MOVEL@C102     @BDELT                          E21063
     C                     ELSE                                           E21063
     C***********          MOVELDC02      @BDELT                   E21063 S01117
     C                     MOVELBVDR2     @BDELT                          S01117
     C                     END                                            E21063
     C                     END                                            E21063
     C***********          END                                      E21063E36792
     C*                                                                   E21063
     C                     END                                            E21063
     C                     END                                            E21063
     C*                                                                   E21063
     C*
     C           @BTDTP    IFEQ 'TP'
     C*
     C*  Deliver from
     C           SETFLG    IFNE 'Y'
     C           SETFLG    OREQ 'Y'
     C********** SDFT      ANDEQ*ZEROS                                                        CSD027
     C           SDFT      ANDEQ*BLANKS                                                       CSD027
     C***********                                                         S01175
     C***********@BCLTY    IFEQ '1'                                       S01175
     C***********          MOVELDC01      @BDELF                          S01175
     C***********                                                         S01175
     C***********          ELSE                                           S01175
     C***********@BCLTY    IFEQ '2'                                       S01175
     C***********@BCLRH    IFEQ 'C'                                       S01175
     C***********          MOVELDC02      @BDELF                          S01175
     C***********          ELSE                                           S01175
     C***********@BCLRH    IFEQ 'K'                                       S01175
     C***********          MOVELDC03      @BDELF                          S01175
     C***********          END                                            S01175
     C***********          END                                            S01175
     C***********                                                         S01175
     C***********          ELSE                                           S01175
     C***********@BCLTY    IFEQ '3'                                       S01175
     C***********          MOVELDC02      @BDELF                          S01175
     C***********          END                                            S01175
     C***********          END                                            S01175
     C***********          END                                            S01175
     C***********                                                         S01175
     C***********          ELSE                                           S01175
     C***********SDFT      IFNE *ZEROS                                    S01175
     C***********          MOVELSDFT      @BDELF                          S01175
     C***********          END                                            S01175
     C***********          END                                            S01175
     C           @BCLTY    IFEQ '1'                                       S01175
     C           @BCLTY    OREQ '2'                                       S01175
     C*                                                                   S01175
     C***********C1DI      IFEQ 'S'                                S01175 S01117
     C***********C1DI      OREQ 'D'                                S01175 S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C*                                                                   S01175
     C***********C101      IFNE *BLANKS                            S01175 S01117
     C***********          MOVELC101      @BDELF                   S01175 S01117
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C           BFDRF1    IFNE *BLANKS                                   S01117
     C                     MOVELBFDRF1    @BDELF                          S01117
     C                     ELSE                                           S01175
     C***********          MOVEL@BPYTB    @BDELF                   S01175 E21064
     C***********BICN      CHAINCLINTSEF             01            E21064 S01117
     C***********C101      IFNE *BLANKS                            E21064 S01117
     C***********          MOVELC101      @BDELF                   E21064 S01117
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     MOVE A8BICN    @WCUST                          S01117
     C                     EXSR AOSECS                                    S01117
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C           BFDRF1    IFNE *BLANKS                                   S01117
     C                     MOVELBFDRF1    @BDELF                          S01117
     C                     ELSE                                           E21064
     C***********          MOVELDC01      @BDELF                   E21064 S01117
     C                     MOVELBVDR1     @BDELF                          S01117
     C                     END                                            E21064
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C***********          MOVELDC01      @BDELF                   S01175 S01117
     C                     MOVELBVDR1     @BDELF                          S01117
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @BCLTY    IFEQ '3'                                       S01175
     C           @BCLTY    OREQ '4'                                       S01175
     C*                                                                   S01175
     C***********C1DI      IFEQ 'S'                                S01175 S01117
     C***********C1DI      OREQ 'D'                                S01175 S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C*                                                                   S01175
     C***********C102      IFNE *BLANKS                            S01175 S01117
     C***********          MOVELC102      @BDELF                   S01175 S01117
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C           BFDRF2    IFNE *BLANKS                                   S01117
     C                     MOVELBFDRF2    @BDELF                          S01117
     C                     ELSE                                           S01175
     C***********          MOVEL@BPYTB    @BDELF                   S01175 E21064
     C***********BICN      CHAINCLINTSEF             01            E21064 S01117
     C***********C101      IFNE *BLANKS                            E21064 S01117
     C***********          MOVELC101      @BDELF                   E21064 S01117
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     MOVE A8BICN    @WCUST                          S01117
     C                     EXSR AOSECS                                    S01117
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C           BFDRF1    IFNE *BLANKS                                   S01117
     C                     MOVELBFDRF1    @BDELF                          S01117
     C                     ELSE                                           E21064
     C***********          MOVELDC01      @BDELF                   E21064 S01117
     C                     MOVELBVDR1     @BDELF                          S01117
     C                     END                                            E21064
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C***********          MOVELDC02      @BDELF                   S01175 S01117
     C                     MOVELBVDR2     @BDELF                          S01117
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C********** SDFT      IFNE *ZEROS                                                 S01175 CSD027
     C           SDFT      IFNE *BLANKS                                                       CSD027
     C                     MOVELSDFT      @BDELF                          S01175
     C                     END                                            S01175
     C                     END                                            S01175
     C*
     C*  Deliver to
     C           SETFLG    IFNE 'Y'
     C           SETFLG    OREQ 'Y'
     C********** SDTO      ANDEQ*ZEROS                                                        CSD027
     C           SDTO      ANDEQ*BLANKS                                                       CSD027
     C*
     C           @BCLTY    IFEQ '1'
     C           @BCLTY    OREQ '2'
     C***********          MOVELDC01      @BDELT                          S01117
     C                     MOVELBVDR1     @BDELT                          S01117
     C*
     C                     ELSE
     C           @BCLTY    IFEQ '3'
     C           @BCLTY    OREQ '4'
     C***********          MOVELDC02      @BDELT                          S01117
     C                     MOVELBVDR2     @BDELT                          S01117
     C                     END
     C                     END
     C*
     C                     ELSE
     C********** SDTO      IFNE *ZEROS                                                        CSD027
     C           SDTO      IFNE *BLANKS                                                       CSD027
     C                     MOVELSDTO      @BDELT
     C                     END
     C                     END
     C                     END
     C*
     C           @BTDTP    IFEQ 'TS'
     C*
     C*  DELIVER FROM /TO FOR SALES
     C*
     C*  Deliver from
     C           SETFLG    IFNE 'Y'
     C           SETFLG    OREQ 'Y'
     C********** SDFO      ANDEQ*ZEROS                                                        CSD027
     C           SDFO      ANDEQ*BLANKS                                                       CSD027
     C*
     C           @BCLTY    IFEQ '1'
     C           @BCLTY    OREQ '2'
     C***********          MOVELDC01      @BDELF                          S01117
     C                     MOVELBVDR1     @BDELF                          S01117
     C*
     C                     ELSE
     C           @BCLTY    IFEQ '3'
     C           @BCLTY    OREQ '4'
     C***********          MOVELDC02      @BDELF                          S01117
     C                     MOVELBVDR2     @BDELF                          S01117
     C                     END
     C*
     C                     END
     C*
     C                     ELSE
     C********** SDFO      IFNE *ZEROS                                                        CSD027
     C           SDFO      IFNE *BLANKS                                                       CSD027
     C                     MOVELSDFO      @BDELF
     C                     END
     C                     END
     C*
     C*  Deliver to
     C           SETFLG    IFNE 'Y'
     C           SETFLG    OREQ 'Y'
     C********** SDTT      ANDEQ*ZEROS                                                        CSD027
     C           SDTT      ANDEQ*BLANKS                                                       CSD027
     C*
     C           @BCLTY    IFEQ '1'
     C           @BCLTY    OREQ '4'                                       S01175
     C***********          MOVELDC01      @BDELT                          S01117
     C                     MOVELBVDR1     @BDELT                          S01117
     C*
     C***********          ELSE                                           S01175
     C***********@BCLTY    IFEQ '2'                                       S01175
     C***********@BCLRH    IFEQ 'C'                                       S01175
     C***********          MOVELDC02      @BDELT                          S01175
     C***********          ELSE                                           S01175
     C***********@BCLRH    IFEQ 'K'                                       S01175
     C***********          MOVELDC03      @BDELT                          S01175
     C***********          END                                            S01175
     C***********          END                                            S01175
     C***********                                                         S01175
     C***********          ELSE                                           S01175
     C***********@BCLTY    IFEQ '3'                                       S01175
     C*                                                                   S01175
     C***********C1DI      IFEQ 'S'                                S01175 S01117
     C***********C1DI      OREQ 'D'                                S01175 S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C*                                                                   S01175
     C***********C101      IFNE *BLANKS                            S01175 S01117
     C***********          MOVELC101      @BDELT                   S01175 S01117
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C           BFDRF1    IFNE *BLANKS                                   S01117
     C                     MOVELBFDRF1    @BDELT                          S01117
     C                     ELSE                                           S01175
     C***********          MOVEL@BPYFB    @BDELT                   S01175 S01117
     C                     MOVEL@BPYFA    @BDELT                          S01117
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C***********          MOVELDC01      @BDELT                   S01175 S01117
     C                     MOVELBVDR1     @BDELT                          S01117
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C                     END                                            S01175
     C*                                                                   S01175
     C           @BCLTY    IFEQ '2'                                       S01175
     C           @BCLTY    OREQ '3'                                       S01175
     C*                                                                   S01175
     C***********C1DI      IFEQ 'S'                                S01175 S01117
     C***********C1DI      OREQ 'D'                                S01175 S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C*                                                                   S01175
     C***********C102      IFNE *BLANKS                            S01175 S01117
     C***********          MOVELC102      @BDELT                   S01175 S01117
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C           BFDRF2    IFNE *BLANKS                                   S01117
     C                     MOVELBFDRF2    @BDELT                          S01117
     C                     ELSE                                           S01175
     C***********          MOVEL@BPYFB    @BDELT                   S01175 S01117
     C                     MOVEL@BPYFA    @BDELT                          S01117
     C                     END                                            S01175
     C*                                                                   S01175
     C                     ELSE                                           S01175
     C*                                                                   S01175
     C***********          MOVELDC02      @BDELT                          S01117
     C                     MOVELBVDR2     @BDELT                          S01117
     C***********          END                                            S01175
     C                     END
     C                     END
     C*
     C                     ELSE
     C********** SDTT      IFNE *ZEROS                                                        CSD027
     C           SDTT      IFNE *BLANKS                                                       CSD027
     C                     MOVELSDTT      @BDELT
     C                     END
     C                     END
     C*
     C                     END
     C*
     C* Priority code: default to R
     C           @BPRYC    IFEQ *BLANKS
     C                     MOVEL'R'       @BPRYC
     C                     END
     C*
     C*   GREY MARKET TRADES REQUIRE PAY CODE & CLEARANCE TYPE
     C                     ELSE
     C                     MOVE '0'       @BCLTY
     C*
     C* Pay code: if customer is safe custody or discretionary,
     C* default to 3, else default to 1
     C           @BPCOD    IFEQ *BLANKS
     C***********C1DI      IFEQ 'D'                                       S01117
     C***********C1DI      OREQ 'S'                                       S01117
     C           @C1DI     IFEQ 'D'                                       S01117
     C           @C1DI     OREQ 'S'                                       S01117
     C                     MOVEL'3'       @BPCOD
     C                     ELSE
     C                     MOVEL'1'       @BPCOD
     C                     END
     C                     END
     C*
     C                     END
     C*
     C**If*not*grey*market*and*clearance*type*is*0*then*depot*details*    E18356
     C**will*not*be*available*at*this*stage*so*change*to*something*****   E18356
     C**that*is*valid.*************************************************   E18356
     C***********@BTDMI    IFNE 'G'                                       E18356
     C***********@BCLTY    ANDEQ'0'                                       E18356
     C***********          MOVE '5'       @BCLTY                          E18356
     C***********          Z-ADD@BTCNR    @BDELF                          E18356
     C***********          Z-ADD@BTCNR    @BDELT                          E18356
     C***********          END                                            E18356
     C*                                                                   E18356
     C* If counterparty is market client then put counterparty in         E18356
     C* counterpartys depot if not otherwise defaulted                    E18356
     C*                                                                   E18356
     C***********C1DI      IFEQ 'M'                                E18356 S01117
     C           @C1DI     IFEQ 'M'                                       S01117
     C           @BCLTY    ANDNE'1'                                       E18356
     C           @BCLTY    ANDNE'3'                                       E18356
     C*                                                                   E18356
     C           @BTDTP    IFEQ 'TP'                                      E18356
     C********** @BDELF    ANDEQ*ZEROS                                                 E18356 CSD027
     C**********           Z-ADD@BTCNR    @BDELF                                       E18356 CSD027
     C           @BDELF    ANDEQ*BLANKS                                                       CSD027
     C                     MOVE @BTCNR    @BDELF                                              CSD027
     C                     END                                            E18356
     C*                                                                   E18356
     C           @BTDTP    IFEQ 'TS'                                      E18356
     C********** @BDELT    ANDEQ*ZEROS                                                 E18356 CSD027
     C**********           Z-ADD@BTCNR    @BDELT                                       E18356 CSD027
     C           @BDELT    ANDEQ*BLANKS                                                       CSD027
     C                     MOVE @BTCNR    @BDELT                                              CSD027
     C                     END                                            E18356
     C                     END                                            E18356
     C*                                                                   E18356
     C* If depot details are not complete make trade incomplete           E18356
     C*                                                                   E18356
     C********** @BDELF    IFEQ *ZEROS                                                 E18356 CSD027
     C********** @BDELT    OREQ *ZEROS                                                 E18356 CSD027
     C           @BDELF    IFEQ *BLANKS                                                       CSD027
     C           @BDELT    OREQ *BLANKS                                                       CSD027
     C                     MOVE 'I'       @BTINC                          E18356
     C                     END                                            E18356
     C*                                                                   E18356
     C* Value date: Add run date to value date default, then check date   E18356
     C* as below and add 1 until valid date found.                        E18356
     C*    1. If date is issue date, use that                             E18356
     C*    2. If maturity date is non-zero, and date > maturity, use      E18356
     C*       maturity date                                               E18356
     C*    3. If clearance type = 1 or 2, date must not be holiday in     E18356
     C*       Euroclear currency                                          E18356
     C*    4. If clearance type = 3 or 4, date must not be holiday in     E18356
     C*       Cedel currency                                              E18356
     C*    5. If clearance type is 2,4 or 5, date must not be holiday     E18356
     C*       in the settlement currency                                  E18356
     C*    6. Date must not be a holiday in the value/payment currency    E18356
     C*                                                                   S01195
     C*  Find nostro location if settlement is by nostro                  S01195
     C*                                                                   S01195
     C           @BSMTH    IFEQ 1                                         S01195
     C           @BSMTH    OREQ 2                                         S01195
     C           @BSMTH    OREQ 7                                         S01195
     C           @BSMTH    OREQ 8                                         S01195
     C           @BSMTH    OREQ 12                                        S01195
     C*                                                                   S01195
     C                     MOVE *BLANKS   @DSNB                           S01195
     C*                                                                   S01195
     C           @BTDTP    IFEQ 'TP'                                      S01195
     C           @BPYFM    ANDNE*BLANKS                                   S01195
     C                     MOVE @BPYFA    @DSNB                           S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C           @BTDTP    IFEQ 'TS'                                      S01195
     C           @BPAYT    ANDNE*BLANKS                                   S01195
     C                     MOVE @BPYTA    @DSNB                           S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C           @DSNB     IFNE *BLANKS                                   S01195
     C                     MOVE '*MSG   ' @RTCD                           S01195
     C                     EXSR AOBRCH                                    S01195
     C           @RTCD     IFNE *BLANKS                                   S01195
     C                     Z-ADD15        @DBASE           ***************S01195
     C                     MOVEL'SDBRCHPD'@DBFIL           * DB ERROR 15 *S01195
     C                     MOVEL@DSNB     @DBKEY           ***************S01195
     C                     EXSR SUB999                                    S01195
     C                     END                                            S01195
     C                     MOVE A8LCCD    ZLOC                            S01195
     C                     ELSE                                           S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C*                                                                   S01195
     C           @BTDVD    IFEQ 0                                         E18356
     C                     MOVELVDFT      @WVDFT  20                      E18356
     C                     MOVE VDFT      @WVDFW  1                       S01448
     C*                                                                   S01448
     C*  If the Default number of days is 'Working Days', then call       S01448
     C*  ZFWDT to calculate the Default Value Date, else default is       S01448
     C*  actual days, so add the number of days to the Run Date.          S01448
     C*                                                                   S01448
     C           @WVDFW    IFEQ 'W'                                       S01448
     C                     Z-ADDRUND      ZDAYNO                          S01448
     C                     Z-ADD@WVDFT    ZNRDYS                          S01448
     C                     MOVE NMCYA     ZCCY                            S01448
     C                     MOVE *BLANK    ZLOC                            S01448
     C                     EXSR ZFWDT                                     S01448
     C                     Z-ADDZDYNBR    @BTDVD                          S01448
     C                     ELSE                                           S01448
     C           RUND      ADD  @WVDFT    @BTDVD                          E18356
     C                     END                                            S01448
     C           *IN99     DOUEQ'0'                                       E18356
     C                     SETOF                     99                   E18356
     C           @BTDVD    IFLT ISSD                                      E18356
     C                     Z-ADDISSD      @BTDVD                          E18356
     C                     ELSE                                           E18356
     C           MATY      IFGT 0                                         E18356
     C           @BTDVD    ANDGTMATY                                      E18356
     C                     Z-ADDMATY      @BTDVD                          E18356
     C                     ELSE                                           E18356
     C           PPDI      IFEQ 'Y'                                       E18356
     C           @BTDVD    ANDLESLCA                                      E18356
     C                     ADD  1         @BTDVD                          E18356
     C                     SETON                     99                   E18356
     C                     END                                            E18356
     C           *IN99     IFEQ '0'                                       E18356
     C           @BCLTY    ANDEQ'1'                                       E18356
     C           @BCLTY    OREQ '2'                                       E18356
     C                     Z-ADD@BTDVD    ZDAYNO                          E18356
     C***********          MOVELECYC      ZCCY                     E18356 S01195
     C***********          EXSR ZDATE5                             E18356 S01195
     C                     MOVELBVEUCY    ZCCY                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     SETON                     99                   S01195
     C                     END                                            S01195
     C   99                ADD  1         @BTDVD                          E18356
     C                     END                                            E18356
     C           *IN99     IFEQ '0'                                       E18356
     C           @BCLTY    ANDEQ'3'                                       E18356
     C           @BCLTY    OREQ '4'                                       E18356
     C                     Z-ADD@BTDVD    ZDAYNO                          E18356
     C***********          MOVELCCYC      ZCCY                     E18356 S01195
     C***********          EXSR ZDATE5                             E18356 S01195
     C                     MOVELBVCCCY    ZCCY                            S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     SETON                     99                   S01195
     C                     END                                            S01195
     C   99                ADD  1         @BTDVD                          E18356
     C                     END                                            E18356
     C           *IN99     IFEQ '0'                                       E18356
     C           @BCLTY    ANDEQ'2'                                       E18356
     C           @BCLTY    OREQ '4'                                       E18356
     C           @BCLTY    OREQ '5'                                       E18356
     C                     Z-ADD@BTDVD    ZDAYNO                          E18356
     C                     MOVEL@C1SC     ZCCY                            E18356
     C***********          EXSR ZDATE5                             E18356 S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     SETON                     99                   S01195
     C                     END                                            S01195
     C   99                ADD  1         @BTDVD                          E18356
     C                     END                                            E18356
     C           *IN99     IFEQ '0'                                       E18356
     C                     Z-ADD@BTDVD    ZDAYNO                          E18356
     C           S01509    IFEQ 'Y'                                       S01509
     C                     MOVELNMCYA     ZCCY                            S01509
     C                     ELSE                                           S01509
     C                     MOVELVLCY      ZCCY                            E18356
     C                     END                                            S01509
     C***********          EXSR ZDATE5                             E18356 S01195
     C                     EXSR ZCHKH                                     S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     SETON                     99                   S01195
     C                     END                                            S01195
     C   99                ADD  1         @BTDVD                          E18356
     C                     END                                            E18356
     C************IN99     IFEQ '0'                                E18356 065524
     C***********          Z-ADD@BTDVD    ZDAYNO                   E18356 065524
     C***********          MOVELSPYC      ZCCY                     E18356 065524
     C***********          EXSR ZDATE5                             E18356 S01195
     C***********          EXSR ZCHKH                              S01195 065524
     C***********ZIND      IFEQ 'H'                                S01195 065524
     C***********          SETON                     99            S01195 065524
     C***********          END                                     S01195 065524
     C***99******          ADD  1         @BTDVD                   E18356 065524
     C***********          END                                     E18356 065524
     C                     END                                            E18356
     C                     END                                            E18356
     C                     END                                            E18356
     C                     END                                            E18356
     C*                                                                   E18356
     C* Originating Branch - Default to Booking Branch                    S01117
     C*                                                                   S01117
     C                     MOVE @BTDBA    @BORBR                          S01117
     C*                                                                   S01117
     C* Profit Centre                                                     S01117
     C*                                                                   S01117
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C*                                                                   CAC002
     C*   If Profit Centre used                                           S01117
     C*                                                                   S01117
     C           BKPRCU    IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C*   If Book position/profit centres are to be reconciled            S01117
     C*                                                                   S01117
     C           BVTBRC    IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C*  Default from current book position profit centre record          S01117
     C*  if found                                                         S01117
     C*                                                                   S01117
     C                     MOVEL@BTDBK    BOKC                            S01117
     C                     MOVEL@BTDBA    KBRC                            S01117
     C                     MOVEL@BTDSS    KSSN                            S01117
     C                     MOVEL@BTDMI    MKTI                            S01117
     C           KLSPCB    CHAINSEPCBD               01                   S01117
     C           *IN01     IFEQ '0'                                       S01117
     C                     MOVE PCBK      @BPRFC                          S01117
     C*                                                                   S01117
     C*  Else default from matrix                                         S01117
     C                     ELSE                                           S01117
     C           BKPCDU    IFEQ 'Y'                                       S01117
     C                     MOVEL@BTDTP    @TRTY                           S01117
     C                     MOVEL@BTCNR    @WCUST                          S01117
     C                     EXSR AOPRFM                                    S01117
     C           #RTCD     IFEQ '0'                                       S01117
     C                     MOVE @PRFC     @BPRFC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C*  Customer Position Profit Centre defaulting                       S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C*  Default from current customer position profit centre             S01117
     C*  if found                                                         S01117
     C*                                                                   S01117
     C                     MOVE @BTDBA    KBRCA                           S01117
     C                     MOVE @BTDSS    KSESN                           S01117
     C                     MOVE @BTCNR    KCNUM                           S01117
     C           KLSPCC    CHAINSEPCCD               01                   S01117
     C           *IN01     IFEQ '0'                                       S01117
     C                     MOVE PCCU      @BPRFC                          S01117
     C                     ELSE                                           S01117
     C           BKPCDU    IFEQ 'Y'                                       S01117
     C                     MOVEL@BTDTP    @TRTY                           S01117
     C                     MOVEL@BTCNR    @WCUST                          S01117
     C                     EXSR AOPRFM                                    S01117
     C           #RTCD     IFEQ '0'                                       S01117
     C                     MOVE @PRFC     @BPRFC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   E18356
     C* Change settlement method to 00 and blank out pay to and           E18356
     C* For market trades where settlement method of 01 has been
     C* defaulted but a corresponding nostro has not been found
     C* change settlement method to 00 and blank out pay to and
     C* and pay from details.
     C           @BSMTH    IFEQ 1
     C           @BTDTP    IFEQ 'TP'
     C           @BPYFM    IFEQ *BLANK
     C                     Z-ADD0         @BSMTH
     C***********          MOVE *BLANK    @BPYFB                          S01117
     C                     MOVE @BTDBA    @BPYFA                          S01117
     C                     MOVE *BLANK    @BPAYT
     C***********          MOVE *BLANK    @BPYTB                          S01117
     C                     MOVE @BTDBA    @BPYTA                          S01117
     C                     END
     C                     ELSE
     C           @BPAYT    IFEQ *BLANK
     C                     Z-ADD0         @BSMTH
     C***********          MOVE *BLANK    @BPYFB                          S01117
     C                     MOVE @BTDBA    @BPYFA                          S01117
     C                     MOVE *BLANK    @BPYFM
     C***********          MOVE *BLANK    @BPYTB                          S01117
     C                     MOVE @BTDBA    @BPYTA                          S01117
     C                     END
     C                     END
     C                     END
     C*
     C* If settlement method is '15' check that the designated SE a/c     E16843
     C* does exist on ACCNT and the account has not been blocked;         E16843
     C* if not, change settlement method to '00'.                         E16843
     C*                                                                   E16843
     C           @BSMTH    IFEQ 15                                        E16843
     C           @BTDTP    IFEQ 'TP'                                      E16843
     C**********           MOVE @BPYFM    @WK12  12                                    E16843 CGL029
     C                     MOVE @BPYFM    @WK18  18                                           CGL029
     C***********          MOVE @BPYFB    @WKBR   30               E16843 S01117
     C                     ELSE                                           E16843
     C**********           MOVE @BPAYT    @WK12                                        E16843 CGL029
     C                     MOVE @BPAYT    @WK18                                               CGL029
     C***********          MOVE @BPYTB    @WKBR                    E16843 S01117
     C                     END                                            E16843
     C*                                                                   E16843
     C* SETUP ACCOUNT KEY                                                 E16843
     C                     MOVEL@BTDBA    BRCA                            S01117
     C**********           MOVEL@WK12     CNUM                                         E16843 CGL029
     C                     MOVEL@WK18     CNUM                                                CGL029
     C                     MOVE @BSETC    CCY                             E16843
     C                     MOVE @C1AC     ACOD                            E16843
     C                     MOVE @C1SQ     ACSQ                            E16843
     C*                                                                   E16843
     C           @KEYD     CHAINACCNTABF             01                   E16843
     C           *IN01     IFEQ '1'                                       E16843
     C           RECI      OREQ '*'                                       E16843
     C           DACO      ORGT @BTDVD                                    E16843
     C***********BRCD      ORNE @WKBR                              E16843 S01117
     C           ACST      OREQ 'C'                                       E16843
     C                     Z-ADD0         @BSMTH                          E16843
     C***********          MOVE *BLANK    @BPYFB                   E16843 S01117
     C                     MOVE *BLANK    @BPYFM                          E16843
     C***********          MOVE *BLANK    @BPYTB                   E16843 S01117
     C                     MOVE *BLANK    @BPAYT                          E16843
     C                     ELSE                                           E16843
     C                     TESTB'2'       RETB           17               E16843
     C                     TESTB'3'       RETB           18               E16843
     C           @BTDTP    IFEQ 'TP'                                      E16843
     C           *IN17     ANDEQ'1'                                       E16843
     C           @BTDTP    OREQ 'TS'                                      E16843
     C           *IN18     ANDEQ'1'                                       E16843
     C                     Z-ADD0         @BSMTH                          E16843
     C***********          MOVE *BLANK    @BPYFB                   E16843 S01117
     C                     MOVE *BLANK    @BPYFM                          E16843
     C***********          MOVE *BLANK    @BPYTB                   E16843 S01117
     C                     MOVE @BTDBA    @BPYTA                          S01117
     C                     END                                            E16843
     C                     END                                            E16843
     C                     END                                            E16843
     C*                                                                   CAC002
     C**  Analytical Accounting module is installed...                    CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
      *                                                                   CAC005
      ** Default book profit centre only if CAC005 is off.                CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'N'                                       CAC005
     C*                                                                   CAC002
     C**  Book Profit Centre defaulting                                   CAC002
     C*                                                                   CAC002
     C**  Default from current book position profit centre record         CAC002
     C**  if found                                                        CAC002
     C*                                                                   CAC002
     C                     MOVE *BLANKS   @BPRFC                          CAC002
     C                     MOVEL@BTDBK    BOKC                            CAC002
     C                     MOVEL@BTDBA    KBRC                            CAC002
     C                     MOVEL@BTDSS    KSSN                            CAC002
     C                     MOVEL@BTDMI    MKTI                            CAC002
     C           KLSPCB    CHAINSEPCBD               01                   CAC002
     C           *IN01     IFEQ '0'                                       CAC002
     C                     MOVE PCBK      @BBPRC                          CAC002
     C*                                                                   CAC002
     C**  Else default from matrix                                        CAC002
     C                     ELSE                                           CAC002
     C           BKPCDU    IFEQ 'Y'                                       CAC002
     C                     MOVEL@BTDTP    @TRTY                           CAC002
     C                     MOVEL@BTCNR    @WCUST                          CAC002
     C                     EXSR AOPRFM                                    CAC002
     C           #RTCD     IFEQ '0'                                       CAC002
     C                     MOVE @PRFC     @BBPRC                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C**  Check if the default Book Profit Centre is valid                CAC002
     C*                                                                   CAC002
     C                     MOVE @BBPRC    WWPRFC                          CAC002
     C                     EXSR AOPRFC                                    CAC002
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
     C*                                                                   CAC002
     C**  Transaction Profit Centre defaulting                            CAC002
     C*                                                                   CAC002
     C**  Default from current customer position profit centre            CAC002
     C**  if found (if trading with a portfolio customer)                 CAC002
     C*                                                                   CAC002
     C           @C1DI     IFEQ 'S'                                       CAC002
     C           @C1DI     OREQ 'D'                                       CAC002
     C                     MOVE @BTDBA    KBRCA                           CAC002
     C                     MOVE @BTDSS    KSESN                           CAC002
     C                     MOVE @BTCNR    KCNUM                           CAC002
     C           KLSPCC    CHAINSEPCCD               01                   CAC002
     C           *IN01     IFEQ '0'                                       CAC002
     C                     MOVE PCCU      @BTPRC                          CAC002
     C                     ELSE                                           CAC002
     C           BKPCDU    IFEQ 'Y'                                       CAC002
     C                     MOVEL@BTDTP    @TRTY                           CAC002
     C                     MOVEL@BTCNR    @WCUST                          CAC002
     C                     EXSR AOPRFM                                    CAC002
     C           #RTCD     IFEQ '0'                                       CAC002
     C                     MOVE @PRFC     @BTPRC                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C**  Check if the default Transaction Profit Centre is valid         CAC002
     C*                                                                   CAC002
     C                     MOVE @BTPRC    WWPRFC                          CAC002
     C                     EXSR AOPRFC                                    CAC002
     C*                                                                   CAC002
     C**  Else, trading with a non-portfolio customer so default it       CAC002
     C**  to the book profit centre                                       CAC002
     C                     ELSE                                           CAC002
     C                     MOVE @BBPRC    @BTPRC                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD*ZERO     @BCRSK                                              CAS006
     C                     Z-ADD*ZERO     @BLQPR                                              CAS006
     C                     ENDIF                                                              CAS006
     C*
     C           END100    ENDSR                           SUB100 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB101 - Set up unrelated trade defaults                     *
     C*****************************************************************
     C           SUB101    BEGSR
     C*                                                                   E18356
     C**Value*date:*Add*run*date*to*value*date*default,*then*check*date   E18356
     C**as*below*and*add*1*until*valid*date*found.*********************   E18356
     C*****1.*If*date*is*issue*date,*use*that**************************   E18356
     C*****2.*If*maturity*date*is*non-zero,*and*date*>*maturity,*use***   E18356
     C********maturity*date********************************************   E18356
     C*****3.*If*clearance*type*=*1*or*2,*date*must*not*be*holiday*in**   E18356
     C********Euroclear*currency***************************************   E18356
     C*****4.*If*clearance*type*=*3*or*4,*date*must*not*be*holiday*in**   E18356
     C********Cedel*currency*******************************************   E18356
     C*****5.*If*clearance*type*is*2,4*or*5,*date*must*not*be*holiday**   E18356
     C********in*the*settlement*currency*******************************   E18356
     C*****6.*Date*must*not*be*a*holiday*in*the*value/payment*currency*   E18356
     C***********@BTDVD    IFEQ 0                                         E18356
     C***********          MOVELVDFT      @WVDFT  20                      E18356
     C***********RUND      ADD  @WVDFT    @BTDVD                          E18356
     C************IN99     DOUEQ'0'                                       E18356
     C***********          SETOF                     99                   E18356
     C***********@BTDVD    IFLT ISSD                                      E18356
     C***********          Z-ADDISSD      @BTDVD                          E18356
     C***********          ELSE                                           E18356
     C***********MATY      IFGT 0                                         E18356
     C***********@BTDVD    ANDGTMATY                                      E18356
     C***********          Z-ADDMATY      @BTDVD                          E18356
     C***********          ELSE                                           E18356
     C***********PPDI      IFEQ 'Y'                                       E18356
     C***********@BTDVD    ANDLESLCA                                      E18356
     C***********          ADD  1         @BTDVD                          E18356
     C***********          SETON                     99                   E18356
     C***********          END                                            E18356
     C************IN99     IFEQ '0'                                       E18356
     C***********@BCLTY    ANDEQ'1'                                       E18356
     C***********@BCLTY    OREQ '2'                                       E18356
     C***********          Z-ADD@BTDVD    ZDAYNO                          E18356
     C***********          MOVELECYC      ZCCY                            E18356
     C***********          EXSR ZDATE5                                    E18356
     C***99******          ADD  1         @BTDVD                          E18356
     C***********          END                                            E18356
     C************IN99     IFEQ '0'                                       E18356
     C***********@BCLTY    ANDEQ'3'                                       E18356
     C***********@BCLTY    OREQ '4'                                       E18356
     C***********          Z-ADD@BTDVD    ZDAYNO                          E18356
     C***********          MOVELCCYC      ZCCY                            E18356
     C***********          EXSR ZDATE5                                    E18356
     C***99******          ADD  1         @BTDVD                          E18356
     C***********          END                                            E18356
     C************IN99     IFEQ '0'                                       E18356
     C***********@BCLTY    ANDEQ'2'                                       E18356
     C***********@BCLTY    OREQ '4'                                       E18356
     C***********@BCLTY    OREQ '5'                                       E18356
     C***********          Z-ADD@BTDVD    ZDAYNO                          E18356
     C***********          MOVEL@C1SC     ZCCY                            E18356
     C***********          EXSR ZDATE5                                    E18356
     C***99******          ADD  1         @BTDVD                          E18356
     C***********          END                                            E18356
     C************IN99     IFEQ '0'                                       E18356
     C***********          Z-ADD@BTDVD    ZDAYNO                          E18356
     C***********          MOVELVLCY      ZCCY                            E18356
     C***********          EXSR ZDATE5                                    E18356
     C***99******          ADD  1         @BTDVD                          E18356
     C***********          END                                            E18356
     C************IN99     IFEQ '0'                                       E18356
     C***********          Z-ADD@BTDVD    ZDAYNO                          E18356
     C***********          MOVELSPYC      ZCCY                            E18356
     C***********          EXSR ZDATE5                                    E18356
     C***99******          ADD  1         @BTDVD                          E18356
     C***********          END                                            E18356
     C***********          END                                            E18356
     C***********          END                                            E18356
     C***********          END                                            E18356
     C***********          END                                            E18356
     C*                                                                   E18356
     C**Branch*code:*defaults*to*value*on*ICD**************************   E18356
     C***********          Z-ADDDSTB      @BTDBR                          E18356
     C*
     C* Trade date: defaults to earlier of run and value dates
     C           RUND      IFLT @BTDVD
     C                     Z-ADDRUND      @BTDDT
     C                     ELSE
     C                     Z-ADD@BTDVD    @BTDDT
     C                     END
     C*
     C           PROT      IFEQ '1'
     C           PROT      OREQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C           STBS      IFEQ 'P'
     C           STBS      OREQ 'Y'
     C*
     C* Accrued indicator: If value date equals next coupon date (via
     C*                    ZNCD) = F
     C*                    If value date less than next coupon date,
     C*                    and greater than or equal to ex date = X
     C*                    Else = C
     C/COPY WNCPYSRC,SE3003C009
      *                                                                                       CSE035
      * Accrued indicator                                                                     CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C                     Z-ADDECD       SECD    50                                          CSE035
     C                     Z-ADDNCDD5     SNCDD5  50                                          CSE035
     C                     Z-ADDLCDD5     SLCDD5  50                                          CSE035
     C                     Z-ADD@BTDVD    ECD                                                 CSE035
     C*                                                                                       CSE035
     C* CALL ZLCD + ZNCD TO DETERMINE NEXT AND LAST COUPON DATES                              CSE035
     C                     Z-ADDNCD       @NCD    50                                          CSE035
     C                     EXSR ZNCD                                                          CSE035
     C                     Z-ADDNCD       NCDD5   50                                          CSE035
     C                     Z-ADD@NCD      NCD                                                 CSE035
     C                     Z-ADDZZLCD     @LCD    50                                          CSE035
     C           NCDD5     SUB  1         ZECD                                                CSE035
     C                     EXSR ZLCD                                                          CSE035
     C                     Z-ADDZZLCD     LCDD5   50                                          CSE035
     C                     Z-ADD@LCD      ZZLCD                                               CSE035
     C*                                                                                       CSE035
     C                     Z-ADDSECD      ECD                                                 CSE035
     C           @BTDVD    IFLT FCPN                                                          CSE035
     C           PROT      ANDEQ'1'                                                           CSE035
     C           ITLD      IFGE LCDD5                                                         CSE035
     C           NCDD5     IFNE FCPN                                                          CSE035
     C                     MOVE 'D'       @BACIN                                              CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       @BACIN                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'D'       @BACIN                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ELSE                                                               CSE035
      *                                                                                       CSE035
     C           @BACIN    IFEQ *BLANKS                                                       CSE035
     C                     MOVEL'C'       @BACIN                                              CSE035
     C                     EXSR ZNCD                                                          CSE035
     C           @BTDVD    IFEQ NCD                                                           CSE035
     C                     MOVEL'F'       @BACIN                                              CSE035
     C                     ELSE                                                               CSE035
     C                     MOVELEDFT      ZNRDYS                                              CSE035
     C           ZNRDYS    IFNE 0                                                             CSE035
     C                     MOVE EDFT      @WEDFT  1                                           CSE035
     C           @WEDFT    IFEQ 'W'                                                           CSE035
     C                     Z-ADDNCD       ZDAYNO                                              CSE035
     C                     MOVE NMCYA     ZCCY                                                CSE035
     C                     MOVE *BLANKS   ZLOC                                                CSE035
     C                     EXSR ZBKDT                                                         CSE035
     C                     ELSE                                                               CSE035
     C           NCD       SUB  ZNRDYS    ZDYNBR                                              CSE035
     C                     ENDIF                                                              CSE035
     C           @BTDVD    IFLT NCD                                                           CSE035
     C           @BTDVD    ANDGEZDYNBR                                                        CSE035
     C           NCD       ANDNEMATY                                                          CSE035
     C                     MOVEL'X'       @BACIN                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     Z-ADDSNCDD5    NCDD5                                               CSE035
     C                     Z-ADDSLCDD5    LCDD5                                               CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'N'                                                           CSE035
      *                                                                                       CSE035
     C           @BACIN    IFEQ *BLANKS
     C                     MOVEL'C'       @BACIN
     C/COPY WNCPYSRC,SE3003C005
     C                     Z-ADD@BTDVD    ECD                             E24559
     C                     EXSR ZNCD
     C           @BTDVD    IFEQ NCD
     C/COPY WNCPYSRC,SE3003C006
     C                     MOVEL'F'       @BACIN
     C                     ELSE
     C                     MOVELEDFT      ZNRDYS
     C           ZNRDYS    IFNE 0
     C                     MOVE EDFT      @WEDFT  1
     C           @WEDFT    IFEQ 'W'
     C                     Z-ADDNCD       ZDAYNO
     C                     MOVE NMCYA     ZCCY
     C***********          EXSR XDATE3                                    S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     EXSR ZBKDT                                     S01195
     C                     ELSE
     C           NCD       SUB  ZNRDYS    ZDYNBR
     C                     END
     C           @BTDVD    IFLT NCD
     C           @BTDVD    ANDGEZDYNBR
     C                     MOVEL'X'       @BACIN
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE3003C010
     C* Days adjustment: default from security details
     C                     Z-ADDIADJ      @BDADJ
     C*
     C* Actual/difference indicator: If days adj. not zero = D
     C           @BDADJ    IFNE 0
     C                     MOVEL'D'       @BADIN
     C                     ELSE
     C                     MOVE *BLANKS   @BADIN
     C                     END
      *                                                                                       CAS006
     C                     Z-ADDIADJ      WIADJ   30                                          CAS006
     C*
     C* Interest amount
     C           @BITRA    IFEQ 0
     C*
     C                     Z-ADDIADJ      SVIADJ  30                      E36791
     C                     Z-ADD@BTDVD    ECD                             E36791
     C                     Z-ADD@BNOML    NOML                            E36791
     C                     Z-ADD@BDADJ    ZDADJ                           E36791
     C                     MOVE @BACIN    ZACIN                           E36791
     C                     MOVE @BADIN    ZADIN                           E36791
     C                     MOVE ' '       ZCPOVR                          E36791
     C                     Z-ADDCPNR      TDCR                            E36791
     C                     Z-ADDNOMDP     ZCDP                            E36791
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CCP7                                           S01408
     C*                                                                   S01408
     C                     EXSR ZPCINT                                    E36791
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CCP8                                           S01408
     C*                                                                   S01408
     C                     Z-ADDZITRA     @BITRA                          E36791
     C                     Z-ADDZTINA     @BTINA                          E36791
     C***********                                                         E36791
     C***If*trade*is*flat*or**********************************************E36791
     C******Value*date*LT*Initial*date*interest*is*zero*******************E36791
     C***********@BACIN    IFEQ 'F'                                       E36791
     C***********@BTDVD    ORLT ITLD                                      E36791
     C***********          Z-ADD0         @BITRA                          E36791
     C***********                                                         E36791
     C***********          ELSE                                           E36791
     C***********                                                         E36791
     C***Zeroise*Days*Adj.*on*SECTY*as*this*should*not*be*included********E36791
     C*****in*ZDAYS*routine*(Purchase*interest/adjustment*are*************E36791
     C*****calculated*separately).****************************************E36791
     C***But*save*days*adjustment*from*SECTYD*before*zeroising************E36791
     C***********          Z-ADDIADJ      SVIADJ  30                      E36791
     C***********          Z-ADD0         IADJ                            E36791
     C***********                                                         E36791
     C***Access*Security*Diary*file*for*latest*coupon*event***************E36791
     C***********          Z-ADD0         @WPDAT                          E36791
     C***********          MOVE @BTDSS    SNSN                            E36791
     C***********          Z-ADD0         SNDT                            E36791
     C***********          MOVE 'CP'      SNET                            E36791
     C***********@KEY9     SETLLSNDEVDF                                   E36791
     C***********@BTDSS    READESNDEVDF                  01               E36791
     C***********                                                         E36791
     C************IN01     DOWEQ'0'                                       E36791
     C***********RECI      IFNE '*'                                       E36791
     C***********SNET      ANDEQ'CP'                                      E36791
     C***********SNDT      ANDLT@BTDVD                                    E36791
     C***********                                                         E36791
     C*****..**save*coupon*event*details**********************************E36791
     C***********          Z-ADDSNDT      @WPDAT                          E36791
     C***********          Z-ADDSNCR      ZCPNR                           E36791
     C***********          Z-ADDSNCP      ZPPCP                           E36791
     C***********          Z-ADDSNCF      ZCFCT                           E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********@BTDSS    READESNDEVDF                  01               E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***If*no*coupon*events*found*..*************************************E36791
     C*****..**prior*date*will*be*last*coupon*date************************E36791
     C***********@WPDAT    IFEQ 0                                         E36791
     C***********          Z-ADDLCPN      @WPDAT                          E36791
     C***********                                                         E36791
     C*****..**interest*rate*details*will*be*from*SECTY*******************E36791
     C***********          Z-ADDCPNR      ZCPNR                           E36791
     C***********                                                         E36791
     C***********PPDI      IFEQ 'Y'                                       E36791
     C***********SFPP      ANDGT0                                         E36791
     C***********SINP      DIV  SFPP      WKSPR  156                      E36791
     C***********          MULT 100       WKSPR                           E36791
     C***********          Z-ADDWKSPR     ZPPCP                           E36791
     C***********          ELSE                                           E36791
     C***********          Z-ADD*ZEROS    ZPPCP                           E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********          Z-ADDCFCT      ZCFCT                           E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***Determine*coupon*dates*prior*to*&*after*Value*date***************E36791
     C***********                                                   E24559E36791
     C***********          Z-ADD@BTDVD    ZECD                      E24559E36791
     C***********          EXSR ZLCD                                E24559E36791
     C***********          Z-ADDZZLCD     @WPDAT  50                E24559E36791
     C***********                                                   E24559E36791
     C***********          Z-ADD@BTDVD    ECD                       E24559E36791
     C***********          EXSR ZNCD                                E24559E36791
     C***********          Z-ADDNCD       @WADAT  50                E24559E36791
     C*****..*if*Last*Coupon*date*LT*Value*date***************************E24559
     C***********LCPN      IFNE 0                                         E24559
     C***********LCPN      ANDLT@BTDVD                                    E24559
     C***********          Z-ADDLCPN      @WPDAT                          E24559
     C***********          EXSR SUB400                                    E24559
     C***********          Z-ADDNCD       @WADAT                          S01175
     C***********NCD       IFLT @BTDVD                                    S01175
     C***********NCD       DOWLT@BTDVD                             S01175 E24559
     C***********          Z-ADDNCD       @WPDAT                   S01175 E24559
     C***********          EXSR SUB400                             S01175 E24559
     C***********          END                                     S01175 E24559
     C***********          Z-ADDNCD       @WPDAT                          E24559
     C***********          END                                            S01175
     C***********          END                                            E24559
     C***********                                                         E36791
     C*****..*if*Last*Coupon*date*zero*or*Value*date*LT*First*Coupon******E24559
     C***********LCPN      IFEQ 0                                         E24559
     C***********@BTDVD    ORLT FCPN                                      E24559
     C***********          Z-ADDITLD      @WPDAT  50                      E24559
     C***********          EXSR SUB400                                    E24559
     C***********FCPN      IFEQ 0                                         E24559
     C***********          Z-ADDNCD       @WADAT  50                      E24559
     C***********          ELSE                                           E24559
     C***********          Z-ADDFCPN      @WADAT                          E24559
     C***********          END                                            E24559
     C***********          ELSE                                           E24559
     C***********                                                         E24559
     C*****..*else*determine*dates*from*latest*coupon*event***************E24559
     C***********@BACIN    IFEQ 'X'                                       E36791
     C***********          Z-ADD@BTDVD    @WPDAT                          E36791
     C***********          EXSR SUB400                                    E24559
     C***********          Z-ADDNCD       @WADAT                          E24559
     C***********          END                                            E36791
     C***********          END                                            E24559
     C***********                                                         E36791
     C***If*Security*has*no*interest*changes*..***************************E36791
     C***********CPNR      IFNE 0                                         E36791
     C***********PPDI      ANDEQ'N'                                       E36791
     C***********PROT      ANDNE'3'                                       E36791
     C***********PROT      ANDNE'5'                                       E36791
     C***********PROT      ANDNE'8'                                       E36791
     C***********                                                         E36791
     C*****..*determine*rate*&*calculate*purchased*interest***************E36791
     C***********          Z-ADDCPNR      ZCPNR                           E36791
     C***********          MOVE 'N'       ZPPDI                           E36791
     C***********          Z-ADD0         ZPPCP                           E36791
     C***********          Z-ADD1         ZCFCT                           E36791
     C***********                                                         E36791
     C***********@BACIN    IFEQ 'C'                                       E36791
     C***********          Z-ADD@WPDAT    ZSDATE                          E36791
     C***********          Z-ADD@BTDVD    ZEDATE                          E36791
     C***********          ELSE                                           E36791
     C***********@BACIN    IFEQ 'X'                                       E36791
     C***********          Z-ADD@BTDVD    ZSDATE                          E36791
     C***********          Z-ADD@WADAT    ZEDATE                          E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C*******************  Z-ADD@BNOML    ZAMT
     C***********          Z-ADDNOMDP     CDP                             S01117
     C***********          Z-ADDNOMDP     ZCDP                      S01117E36791
     C***********          EXSR ZRATE                                     E36791
     C***********          EXSR ZACCR                                     E36791
     C***********          Z-ADDZACCRD    @BITRA                          E36791
     C***********                                                         E36791
     C*****..*calculate*interest*adjustment*and*adjust*actual*interest****E36791
     C***********          Z-ADD0         WPADJ                           E36791
     C***********@BDADJ    IFNE 0                                         E36791
     C***********          EXSR SUB401                                    E36791
     C***********@BADIN    IFEQ 'D'                                       E36791
     C***********          ADD  WPADJ     @BITRA                          E36791
     C***********          ELSE                                           E36791
     C***********          Z-ADDWPADJ     @BITRA                          E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********          ELSE                                           E36791
     C***********                                                         E36791
     C***If*Security*has*interest*changes*********************************E36791
     C*****..**access*Security*Diary*file*to*accumulate*interest**********E36791
     C*********from*coupon*event*to*last*of*types*IR/MP/PP*or*************E36791
     C*********value*date*************************************************E36791
     C***********          Z-ADD0         @BITRA                          E36791
     C***********          SETOF                     19                   E36791
     C***********                                                         E36791
     C********..**set*up*factor*******************************************E36791
     C***********          Z-ADD1         ZCFCT                           E36791
     C***********PROT      IFEQ '8'                                       E36791
     C***********          Z-ADDCFCT      ZCFCT                           E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C********..**if*Trade*is*cum-coupon**********************************E36791
     C***********@BACIN    IFEQ 'C'                                       E36791
     C***********          Z-ADD@WPDAT    ZSDATE                          E36791
     C***********                                                         E36791
     C***********          MOVE @BTDSS    SDSN                            E36791
     C***********          Z-ADD@WPDAT    SDED                            E36791
     C***********          MOVE 'IR'      SDET                            E36791
     C***********@KEY11    SETLLSEDEVDF                                   E36791
     C***********@BTDSS    READESEDEVDF                  01               E36791
     C***********                                                         E36791
     C************IN01     DOWEQ'0'                                       E36791
     C***********RECI      IFNE '*'                                       E36791
     C***********SDET      IFEQ 'IR'                                      E36791
     C***********SDET      OREQ 'MP'                                      E36791
     C***********SDET      OREQ 'PP'                                      E36791
     C***********SDED      IFGE @BTDVD                                    E36791
     C***********          SETON                     19                   E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C**********..*determine*rate*&*calculate*purchased*interest**********E36791
     C***********SDET      IFEQ 'MP'                                      E36791
     C***********          Z-ADDSDCP      ZCFCT                           E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********          MOVE PPDI      ZPPDI                           E36791
     C***********                                                         E36791
     C****Set*up*Amount*in*Nomimal*decimal*places*************************E36791
     C***********NMDP      ADD  5         DEC                             E36791
     C***********NOML      MULT POWER8,DECZAMT                            E36791
     C***********                                                         E36791
     C***********          Z-ADDNOMDP     CDP                             S01117
     C***********          Z-ADDNOMDP     ZCDP                      S01117E36791
     C***********SDED      IFLT @BTDVD                                    E36791
     C***********          Z-ADDSDED      ZEDATE                          E36791
     C***********          ELSE                                           E36791
     C***********          Z-ADD@BTDVD    ZEDATE                          E36791
     C***********          END                                            E36791
     C***********          EXSR ZRATE                                     E36791
     C***********          EXSR ZACCR                                     E36791
     C***********          ADD  ZACCRD    @BITRA                          E36791
     C***********                                                         E36791
     C***********          Z-ADDSDNC      ZCPNR                           E36791
     C***********          MOVE *ZEROS    ZPPCP                           E36791
     C***********          Z-ADDSDPC      ZPPCP                           E36791
     C***********          Z-ADDSDCP      ZCFCT                           E36791
     C***********          Z-ADDSDED      ZSDATE                          E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********@BTDSS    READESEDEVDF                  01               E36791
     C**N19******          END                                            E36791
     C***********                                                         E36791
     C**********..*if*no*more*events*found********************************E36791
     C************IN19     IFEQ '0'                                       E36791
     C***********          MOVE PPDI      ZPPDI                           E36791
     C***********                                                         E36791
     C**SET*UP*AMOUNT*IN*NOMINAL*DECIMAL*PLACES***************************E36791
     C***********NMDP      ADD  5         DEC                             E36791
     C***********@BNOML    MULT POWER8,DECZAMT                            E36791
     C***********          Z-ADDNOMDP     CDP                             S01117
     C***********          Z-ADDNOMDP     ZCDP                      S01117E36791
     C***********          Z-ADD@BTDVD    ZEDATE                          E36791
     C***********          EXSR ZRATE                                     E36791
     C***********          EXSR ZACCR                                     E36791
     C***********          ADD  ZACCRD    @BITRA                          E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C*******..*calculate*interest*adjustment*and*adjust*actual***********E36791
     C***********          Z-ADD0         WPADJ                           E36791
     C***********@BDADJ    IFNE 0                                         E36791
     C***********          EXSR SUB401                                    E36791
     C***********@BADIN    IFEQ 'D'                                       E36791
     C***********          ADD  WPADJ     @BITRA                          E36791
     C***********          ELSE                                           E36791
     C***********          Z-ADDWPADJ     @BITRA                          E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********          ELSE                                           E36791
     C***********                                                         E36791
     C********..**if*Trade*is*ex-coupon***********************************E36791
     C***********@BACIN    IFEQ 'X'                                       E36791
     C***********          Z-ADD@BTDVD    ZSDATE                          E36791
     C***********                                                         E36791
     C***********          MOVE @BTDSS    SDSN                            E36791
     C***********          Z-ADD@WPDAT    SDED                            E36791
     C***********          MOVE 'IR'      SDET                            E36791
     C***********@KEY11    SETLLSEDEVDF                                   E36791
     C***********@BTDSS    READESEDEVDF                  01               E36791
     C***********                                                         E36791
     C************IN01     DOWEQ'0'                                       E36791
     C***********RECI      IFNE '*'                                       E36791
     C***********SDET      IFEQ 'IR'                                      E36791
     C***********SDET      OREQ 'MP'                                      E36791
     C***********SDET      OREQ 'PP'                                      E36791
     C***********                                                         E36791
     C*****..*replace*interest*calc.*values*if*event*date*less************E36791
     C*****************************************than*value*date************E36791
     C***********SDET      IFEQ 'MP'                                      E36791
     C***********          Z-ADDSDCP      ZCFCT                           E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********SDED      IFLT @BTDVD                                    E36791
     C***********          Z-ADDSDPC      ZPPCP                           E36791
     C***********          Z-ADDSDNC      ZCPNR                           E36791
     C***********          Z-ADDSDCP      ZCFCT                           E36791
     C***********          ELSE                                           E36791
     C***********                                                         E36791
     C***********SDED      IFGE @WADAT                                    E36791
     C***********          SETON                     19                   E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C**********..*determine*rate*&*calculate*purchased*interest**********E36791
     C***********          MOVE PPDI      ZPPDI                           E36791
     C***********                                                         E36791
     C**SET*UP*AMOUNT*IN*NOMINAL*DECIMAL*PLACES***************************E36791
     C***********NMDP      ADD  5         DEC                             E36791
     C***********@BNOML    MULT POWER8,DECZAMT                            E36791
     C***********          Z-ADDNOMDP     CDP                             S01117
     C***********          Z-ADDNOMDP     ZCDP                      S01117E36791
     C***********SDED      IFLT @WADAT                                    E36791
     C***********          Z-ADDSDED      ZEDATE                          E36791
     C***********          ELSE                                           E36791
     C***********          Z-ADD@WADAT    ZEDATE                          E36791
     C***********          END                                            E36791
     C***********          EXSR ZRATE                                     E36791
     C***********          EXSR ZACCR                                     E36791
     C***********          ADD  ZACCRD    @BITRA                          E36791
     C***********                                                         E36791
     C***********          Z-ADDSDNC      ZCPNR                           E36791
     C***********          Z-ADDSDPC      ZPPCP                           E36791
     C***********          Z-ADDSDCP      ZCFCT                           E36791
     C***********          Z-ADDSDED      ZSDATE                          E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********@BTDSS    READESEDEVDF                  01               E36791
     C**N19******          END                                            E36791
     C***********                                                         E36791
     C**********..*if*no*more*events*found********************************E36791
     C************IN19     IFEQ '0'                                       E36791
     C***********          MOVE PPDI      ZPPDI                           E36791
     C***********                                                         E36791
     C**SET*UP*AMOUNT*IN*NOMINAL*DECIMAL*PLACES***************************E36791
     C***********NMDP      ADD  5         DEC     10                      E36791
     C***********@BNOML    MULT POWER8,DECZAMT                            E36791
     C***********          Z-ADDNOMDP     CDP                             S01117
     C***********          Z-ADDNOMDP     ZCDP                      S01117E36791
     C***********          Z-ADD@WADAT    ZEDATE                          E36791
     C***********          EXSR ZRATE                                     E36791
     C***********          EXSR ZACCR                                     E36791
     C***********          ADD  ZACCRD    @BITRA                          E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C******..*calculate*interest*adjustment*and*adjust*actual************E36791
     C****************************************accrued*interest************E36791
     C***********          Z-ADD0         WPADJ                           E36791
     C***********@BDADJ    IFNE 0                                         E36791
     C***********          EXSR SUB401                                    E36791
     C***********@BADIN    IFEQ 'D'                                       E36791
     C***********          ADD  WPADJ     @BITRA                          E36791
     C***********          ELSE                                           E36791
     C***********          Z-ADDWPADJ     @BITRA                          E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C*
     C* Restore SECTYD days adjustment field
     C                     Z-ADDSVIADJ    IADJ
     C***********          END                                            E36791
     C*
     C* Coupon rate: default from security details
     C                     Z-ADDCPNR      @BTDCR
     C*
     C                     END
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
     C           @BITRN    IFEQ 0                                                             CAS006
      *                                                                                       CAS006
     C                     Z-ADD@BTDVD    WSDED   50                                          CAS006
     C                     MOVE @BTDSS    WSDSN  10                                           CAS006
     C                     Z-ADD*ZERO     WNTCR  117                                          CAS006
     C                     Z-ADD*ZERO     WXSDED  50                                          CAS006
      *                                                                                       CAS006
     C           WSDSN     SETLLSEDEVL9                                                       CAS006
     C           WSDSN     READESEDEVL9                  41                                   CAS006
      *                                                                                       CAS006
     C           *IN41     DOWEQ*OFF                                                          CAS006
     C           WESDED    ANDLEWSDED                                                         CAS006
      *                                                                                       CAS006
     C           WESDET    IFEQ 'IR'                                                          CAS006
      *                                                                                       CAS006
     C           WESDED    IFEQ WSDED                                                         CAS006
     C                     Z-ADDWESDNN    WNTCR                                               CAS006
     C                     LEAVE                                                              CAS006
     C                     ELSE                                                               CAS006
     C           WESDED    IFGT WXSDED                                                        CAS006
     C                     Z-ADDWESDED    WXSDED                                              CAS006
     C                     Z-ADDWESDNN    WNTCR                                               CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C           WSDSN     READESEDEVL9                  41                                   CAS006
     C                     ENDDO                                                              CAS006
      *                                                                                       CAS006
     C           WNTCR     IFEQ *ZERO                                                         CAS006
     C                     Z-ADDCPNN      WNTCR                                               CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD@BTDVD    ECD                                                 CAS006
     C                     Z-ADD@BNOML    NOML                                                CAS006
     C                     Z-ADD@BDADJ    ZDADJ                                               CAS006
     C                     MOVE @BACIN    ZACIN                                               CAS006
     C                     MOVE @BADIN    ZADIN                                               CAS006
     C                     MOVE ' '       ZCPOVR                                              CAS006
     C                     Z-ADDWNTCR     TDCR                                                CAS006
     C                     Z-ADDNOMDP     ZCDP                                                CAS006
      *                                                                                       CAS006
     C                     EXSR ZPCINT                                                        CAS006
      *                                                                                       CAS006
     C                     Z-ADDZITRA     @BITRN                                              CAS006
     C                     Z-ADDZTINA     @BTINN                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADDWIADJ     IADJ                                                CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     END
     C                     END
     C*
     C                     ENDSR                           SUB101 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB102 - Set up trade related defaults                       *
     C*****************************************************************
     C           SUB102    BEGSR
     C*
     C* Value date defaults to value on related trade
     C                     MOVELTDVD      @BTDVD
     C*
     C* Branch code defaults to value on related trade
     C***********          MOVELTDBR      @BTDBR                          S01117
     C                     MOVELTDBA      @BTDBA                          S01117
     C*
     C* Trade date defaults to value on related trade
     C                     MOVELTDDT      @BTDDT
     C*
     C* The following defaults are only applied if processing type is
     C**1,3,5,6*or*8*and*trade*basis*is*P*or*Y.***************************S01176
     C***  1, 3, 5, 6, 8 or 9 and Trade Basis is P or Y.                  S01176
     C*                                                                   S01176
     C           PROT      IFEQ '1'
     C           PROT      OREQ '3'
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C           PROT      OREQ '9'                                       S01176
     C           STBS      IFEQ 'P'
     C           STBS      OREQ 'Y'
     C*
     C* Accrued indicator
     C                     MOVELACIN      @BACIN
     C*
     C* Days adjustment
     C                     Z-ADDDADJ      @BDADJ
     C*
     C* Actual difference
     C                     MOVELADIN      @BADIN
     C*
     C* Interest amount
     C                     Z-ADDITRA      @BITRA
     C                     Z-ADDTINA      @BTINA
     C*
     C* Coupon rate
     C                     Z-ADDTDCR      @BTDCR
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADDITRN      @BITRN                                              CAS006
     C                     Z-ADDTINN      @BTINN                                              CAS006
     C                     ENDIF                                                              CAS006
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR                           SUB102 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB103 - Calculate charges/commissions                       *
     C*                                                               *   S01176
     C*  THIS SUBROUTINE HAS BEEN TOTALLY REWRITTEN                   *   S01176
     C*                                                               *   S01176
     C*****************************************************************
     C***********SUB103    BEGSR                                          S01176
     C***********          ENDSR                           SUB103 ends    S01176
     C*****************************************************************   S01176
      /EJECT
     C*****************************************************************   S01176
     C**                                                              *   S01176
     C*    SUB103 - Determine Charge/Commission Amounts/tax amounts   *   S01176
     C*                                                               *   S01176
     C*    Called By : SUB104                                         *   S01176
     C*    Calls     : NCAAMT,CAAMT                                   *   S01176
     C**                                                              *   S01176
     C*  THIS SUBROUTINE HAS BEEN TOTALLY REWRITTEN                   *   S01176
     C*****************************************************************   S01176
     C*                                                                   S01176
     C           SUB103    BEGSR                                          S01176
     C*                                                                   S01448
     C***  If switchable feature Bulk Input Enhancements is on            S01448
     C***  change conditioning of client agency trade as customer         S01448
     C***  on the 'M' side of the trade can be a portfolio client         S01448
     C*                                                                   S01448
     C           S01448    IFEQ 'Y'                                       S01448
     C           @BATRD    IFEQ *BLANK                                    S01448
     C           @C1DI     ORNE 'S'                                       S01448
     C           @C1DI     ANDNE'D'                                       S01448
     C*                                                                   S01448
     C                     EXSR NCAAMT                                    S01448
     C*                                                                   S01448
     C                     ELSE                                           S01448
     C*                                                                   S01448
     C***  If the Trade is a client agency trade.                         S01448
     C*                                                                   S01448
     C                     EXSR CAAMT                                     S01448
     C*                                                                   S01448
     C                     END                                            S01448
     C                     ELSE                                           S01448
     C*                                                                   S01176
     C***  If the Trade is not a Client Agency Trade                      S01176
     C*                                                                   S01176
     C           @BATRD    IFNE 'C'                                       S01176
     C                     EXSR NCAAMT                                    S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C***  If the Trade is a client agency trade.                         S01176
     C*                                                                   S01176
     C                     EXSR CAAMT                                     S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01448
     C*                                                                   S01176
     C                     ENDSR                                          S01176
     C*****************************************************************   S01176
      /EJECT
     C*****************************************************************   S01176
     C*    SUB105 - Calculate total brokerage charge on an agency     *   S01176
     C*           - trade.                                            *   S01176
     C*                                                               *   S01176
     C*    Called By : SUB003                                         *   S01176
     C*    Calls     :                                                *   S01176
     C*****************************************************************   S01176
     C*
     C           SUB105    BEGSR
     C*
     C*                                                                   S01176
     C***  If the Trade is  a Market Agency Trade then                    S01176
     C***     add nominal to market side nominal total                    S01176
     C***     add broker comm, chg amt1,chg amt2 and tax associated       S01176
     C***     with these three amounts.                                   S01176
     C*                                                                   S01176
     C           *LIKE     DEFN NOML      @MNOMT                          S01176
     C                     ADD  @BNOML    @MNOMT                          S01176
     C*                                                                   S01176
     C* If the Bulk Enhancements feature is on then check the             S01448
     C* classification of the client as the customer on the market        S01448
     C* side can be portfolio. In that case no accumulation of market     S01448
     C* charges should be performed and therefore no brokerage will       S01448
     C* be defaulted on the second side.                                  S01448
     C*                                                                   S01448
     C           S01448    IFEQ 'Y'                                       S01448
     C           @C1DI     ANDNE'S'                                       S01448
     C           @C1DI     ANDNE'D'                                       S01448
     C           S01448    OREQ 'N'                                       S01448
     C*                                                                   S01448
     C           *LIKE     DEFN TBCA      @MCHGT                          S01176
     C                     ADD  @BTBCA    @MCHGT                          S01176
     C                     ADD  @BTCA1    @MCHGT                          S01176
     C                     ADD  @BTCA2    @MCHGT                          S01176
     C*                                                                   S01176
     C***  If the broker commission code is non-blank and the             S01176
     C***  broker commission amount <>0                                   S01176
     C*                                                                   S01176
     C           @BTBCC    IFNE *BLANKS                                   S01176
     C           @BTBCA    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C***  If the tax applicable for the broker commission                S01176
     C***  code =' Y' , the tax code for the c/party <> ' ' then          S01176
     C***  cal. the tax due on the broker commission amount.              S01176
     C*                                                                   S01176
     C                     MOVE @BTBCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C           TXAP      ANDEQ'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C*                                                                   S01176
     C           @BTBCA    IFLT 0                                         S01176
     C                     Z-SUB@BTBCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @MCHGT                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTBCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @MCHGT                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If charge code 1 is non-blank and the                          S01176
     C***  charge amount 1 <> 0                                           S01176
     C*                                                                   S01176
     C           @BTCC1    IFNE *BLANKS                                   S01176
     C           @BTCA1    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C***  If the tax applicable for the charge code 1 ='Y'               S01176
     C***  and  the tax code for the c/party <> ' ' then                  S01176
     C***  cal. the tax due on the broker amount 1.                       S01176
     C*                                                                   S01176
     C                     MOVE @BTCC1    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C           TXAP      ANDEQ'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C*                                                                   S01176
     C           @BTBCA    IFLT 0                                         S01176
     C                     Z-SUB@BTCA1    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @MCHGT                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCA1    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @MCHGT                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If charge code 2 is non-blank and the                          S01176
     C***  charge amount 2 <> 0                                           S01176
     C*                                                                   S01176
     C           @BTCC2    IFNE *BLANKS                                   S01176
     C           @BTCA2    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C***  If the tax applicable for the charge code 2 ='Y'               S01176
     C***  and  the tax code for the c/party <> ' ' then                  S01176
     C***  cal. the tax due on the broker amount 2.                       S01176
     C*                                                                   S01176
     C                     MOVE @BTCC2    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C           TXAP      ANDEQ'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C*                                                                   S01176
     C           @BTBCA    IFLT 0                                         S01176
     C                     Z-SUB@BTCA2    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @MCHGT                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCA2    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @MCHGT                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01448
     C                     END                                            S01448
     C*                                                                   S01176
     C                     ENDSR                                          S01176
     C*****************************************************************   S01176
      /EJECT
     C*****************************************************************   S01176
     C*    NCAAMT - Determine Charge/Commission Amounts/tax amounts   *   S01176
     C*           - for a non client agency trade.                    *   S01176
     C*                                                               *   S01176
     C*    Called By :SUB103                                          *   S01176
     C*    Calls     :                                                *   S01176
     C*****************************************************************   S01176
     C*                                                                   S01176
     C           NCAAMT    BEGSR                                          S01176
     C*                                                                   S01176
     C           *LIKE     DEFN TXRB      @TRTOT                          S01176
     C                     Z-ADD0         @TRTOT                          S01176
     C*                                                                   S01176
     C*                                                                   S01176
     C***  If the broker commission code is non-blank and the             S01176
     C***  broker commission amount is zero.                              S01176
     C*                                                                   S01176
     C           @BTBCC    IFNE *BLANKS                                   S01176
     C           @BTBCA    ANDEQ*ZERO                                     S01176
     C*                                                                   S01176
     C***  Calculate the broker commission amount.                        S01176
     C*                                                                   S01176
     C                     MOVE @BTBCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     EXSR SUB700                                    S01176
     C                     Z-ADD@XAMTN    @BTBCA                          S01176
     C*                                                                   S01176
     C***  If the tax applicable for the broker commission                S01176
     C***  code =' Y' , the tax code for the c/party <> ' '               S01176
     C***  and the broker commission amount<> 0 then                      S01176
     C***  cal. the tax due on the broker commission amount.              S01176
     C*                                                                   S01176
     C           TXAP      IFEQ 'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C           @BTBCA    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTBCA    IFLT 0                                         S01176
     C                     Z-SUB@BTBCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @BTAXA                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTBCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @BTAXA                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BTBCA                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If the customer commission code is non-blank and the           S01176
     C***  customer commission amount is zero.                            S01176
     C*                                                                   S01176
     C           @BTCCC    IFNE *BLANKS                                   S01176
     C           @BTCCA    ANDEQ*ZERO                                     S01176
     C*                                                                   S01176
     C**  Calculate the customer commission amount.                       S01176
     C*                                                                   S01176
     C                     MOVE @BTCCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     EXSR SUB700                                    S01176
     C                     Z-ADD@XAMTN    @BTCCA                          S01176
     C*                                                                   S01176
     C***  If the tax applicable for the customer commission              S01176
     C***  code =' Y' , the tax code for the c/party <> ' '               S01176
     C***  and the customer commission amount<> 0 then                    S01176
     C***  cal. the tax due on the customer commission amount.            S01176
     C*                                                                   S01176
     C           TXAP      IFEQ 'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C           @BTCCA    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTCCA    IFLT 0                                         S01176
     C                     Z-SUB@BTCCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @BTAXA                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @BTAXA                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BTCCA                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If charge code 1 is non-blank and the                          S01176
     C***  charge amount 1 is zero.                                       S01176
     C*                                                                   S01176
     C           @BTCC1    IFNE *BLANKS                                   S01176
     C           @BTCA1    ANDEQ*ZERO                                     S01176
     C*                                                                   S01176
     C**  Calculate the charge code amount 1.                             S01176
     C*                                                                   S01176
     C                     MOVE @BTCC1    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     EXSR SUB700                                    S01176
     C                     Z-ADD@XAMTN    @BTCA1                          S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CCP5                                           S01408
     C*                                                                   S01408
     C*                                                                   S01176
     C***  If the tax applicable for the charge                           S01176
     C***  code 1 =' Y' , the tax code for the c/party <> ' '             S01176
     C***  and the charge amount 1 <> 0 then                              S01176
     C***  cal. the tax due on charge amount 1.                           S01176
     C*                                                                   S01176
     C           TXAP      IFEQ 'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C           @BTCA1    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTCA1    IFLT 0                                         S01176
     C                     Z-SUB@BTCA1    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @BTAXA                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCA1    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @BTAXA                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BTCA1                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If charge code 2 is non-blank and the                          S01176
     C***  charge amount 2 is zero.                                       S01176
     C*                                                                   S01176
     C           @BTCC2    IFNE *BLANKS                                   S01176
     C           @BTCA2    ANDEQ*ZERO                                     S01176
     C*                                                                   S01176
     C**  Calculate the charge code amount 2.                             S01176
     C*                                                                   S01176
     C                     MOVE @BTCC2    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     EXSR SUB700                                    S01176
     C                     Z-ADD@XAMTN    @BTCA2                          S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CCP6                                           S01408
     C*                                                                   S01408
     C*                                                                   S01176
     C***  If the tax applicable for the charge                           S01176
     C***  code 2 =' Y' , the tax code for the c/party <> ' '             S01176
     C***  and the charge amount 2 <> 0 then                              S01176
     C***  cal. the tax due on charge amount 2.                           S01176
     C*                                                                   S01176
     C           TXAP      IFEQ 'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C           @BTCA2    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTCA2    IFLT 0                                         S01176
     C                     Z-SUB@BTCA2    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @BTAXA                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCA2    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @BTAXA                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BTCA2                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If the broker commission code is non-blank and the             S01176
     C***  broker commission amount <> zero.                              S01176
     C*                                                                   S01176
     C           @BTBCC    IFNE *BLANKS                                   S01176
     C           @BTBCA    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C***  Calculate the broker commission rebate.                        S01176
     C*                                                                   S01176
     C                     MOVE @BTBCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C*                                                                   S01176
     C***  If the rebate applicable ind. for the broker commission        S01176
     C***  code =' Y' and the commission rebate % <> 0                    S01176
     C*                                                                   S01176
     C           REBA      IFEQ 'Y'                                       S01176
     C           CMRP      ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTBCA    IFLT 0                                         S01176
     C                     Z-SUB@BTBCA    @WCHGA                          S01176
     C                     EXSR CALREB                                    S01176
     C                     Z-ADD@WREB     @BBCMR                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTBCA    @WCHGA                          S01176
     C                     EXSR CALREB                                    S01176
     C                     Z-SUB@WREB     @BBCMR                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  Cal the tax rebate due with the broker commission rebate       S01176
     C*                                                                   S01176
     C           @BBCMR    IFNE *ZERO                                     S01176
     C           TXAP      ANDEQ'Y'                                       S01176
     C           @TAXC     ANDNE*BLANK                                    S01176
     C*                                                                   S01176
     C           @BBCMR    IFLT 0                                         S01176
     C                     Z-SUB@BBCMR    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @TRTOT                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BBCMR    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @TRTOT                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BBCMR                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If the customer commission code is non-blank and the           S01176
     C***  broker commission amount <> zero.                              S01176
     C*                                                                   S01176
     C           @BTCCC    IFNE *BLANKS                                   S01176
     C           @BTCCA    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C***  Calculate the customer commission rebate.                      S01176
     C*                                                                   S01176
     C                     MOVE @BTCCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C*                                                                   S01176
     C***  If the rebate applicable ind. for the customer commission      S01176
     C***  code =' Y' and the commission rebate % <> 0                    S01176
     C*                                                                   S01176
     C           REBA      IFEQ 'Y'                                       S01176
     C           CMRP      ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTCCA    IFLT 0                                         S01176
     C                     Z-SUB@BTCCA    @WCHGA                          S01176
     C                     EXSR CALREB                                    S01176
     C                     Z-ADD@WREB     @BCCMR                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C***********          Z-ADD@BTBCA    @WCHGA                          063506
     C                     Z-ADD@BTCCA    @WCHGA                          063506
     C                     EXSR CALREB                                    S01176
     C                     Z-SUB@WREB     @BCCMR                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  Cal the tax rebate due with the customer commission rebate     S01176
     C*                                                                   S01176
     C           @BCCMR    IFNE *ZERO                                     S01176
     C           TXAP      ANDEQ'Y'                                       S01176
     C           @TAXC     ANDNE*BLANK                                    S01176
     C*                                                                   S01176
     C           @BCCMR    IFLT 0                                         S01176
     C                     Z-SUB@BCCMR    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @TRTOT                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BCCMR    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @TRTOT                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BCCMR                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  Default the tax rebate to the tax rebate total.                S01176
     C*                                                                   S01176
     C                     Z-ADD@TRTOT    @BTXRB                          S01176
     C*                                                                   S01176
     C                     ENDSR                                          S01176
     C*****************************************************************   S01176
      /EJECT
     C*****************************************************************   S01176
     C**                                                              *   S01176
     C*    CAAMT  - Determine Charge/Commission Amounts/tax amounts   *   S01176
     C*           - for a non client agency trade.                    *   S01176
     C*                                                               *   S01176
     C*    Called By :SUB103                                          *   S01176
     C*    Calls     :                                                *   S01176
     C**                                                              *   S01176
     C*****************************************************************   S01176
     C*                                                                   S01176
     C           CAAMT     BEGSR                                          S01176
     C*                                                                   S01176
     C***  If the broker commission code is non-blank and the             S01176
     C***  broker commission amount is zero.                              S01176
     C*                                                                   S01176
     C           @BTBCC    IFNE *BLANKS                                   S01176
     C           @BTBCA    ANDEQ*ZERO                                     S01176
     C*                                                                   S01176
     C***  Calculate the broker commission amount.                        S01176
     C*                                                                   S01176
     C                     MOVE @BTBCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C*                                                                   S01176
     C***  The broker commission will be equal to brokerage charge        S01176
     C***  that is a proportion of the sum of the broker commission       S01176
     C***  ,charge 1 ,charge 2 and tax for the market side of the         S01176
     C***  transaction.                                                   S01176
     C***                                                                 S01176
     C***  brokerage= sum of market charges x client nominal              S01176
     C***             --------------------------------------              S01176
     C***                   sum of market trades nominal                  S01176
     C*                                                                   S01176
     C           @MCHGT    MULT @BNOML    @WRK1  150                      S01176
     C           @WRK1     DIV  @MNOMT    @BTBCA                          S01176
     C*                                                                   S01176
     C           TXAP      IFEQ 'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C           @BTBCA    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTBCA    IFLT 0                                         S01176
     C                     Z-SUB@BTBCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @BTAXA                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTBCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @BTAXA                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BTBCA                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If the customer commission code is non-blank and the           S01176
     C***  customer commission amount is zero.                            S01176
     C*                                                                   S01176
     C           @BTCCC    IFNE *BLANKS                                   S01176
     C           @BTCCA    ANDEQ*ZERO                                     S01176
     C*                                                                   S01176
     C**  Calculate the customer commission amount.                       S01176
     C*                                                                   S01176
     C                     MOVE @BTCCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     EXSR SUB700                                    S01176
     C                     Z-ADD@XAMTN    @BTCCA                          S01176
     C*                                                                   S01176
     C***  If the tax applicable for the customer commission              S01176
     C***  code =' Y' , the tax code for the c/party <> ' '               S01176
     C***  and the customer commission amount<> 0 then                    S01176
     C***  cal. the tax due on the customer commission amount.            S01176
     C*                                                                   S01176
     C           TXAP      IFEQ 'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C           @BTCCA    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTCCA    IFLT 0                                         S01176
     C                     Z-SUB@BTCCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @BTAXA                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCCA    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @BTAXA                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BTCCA                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If charge code 1 is non-blank and the                          S01176
     C***  charge amount 1 is zero.                                       S01176
     C*                                                                   S01176
     C           @BTCC1    IFNE *BLANKS                                   S01176
     C           @BTCA1    ANDEQ*ZERO                                     S01176
     C*                                                                   S01176
     C**  Calculate the charge code amount 1.                             S01176
     C*                                                                   S01176
     C                     MOVE @BTCC1    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     EXSR SUB700                                    S01176
     C                     Z-ADD@XAMTN    @BTCA1                          S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CCP4                                           S01408
     C*                                                                   S01408
     C*                                                                   S01176
     C***  If the tax applicable for the charge                           S01176
     C***  code 1 =' Y' , the tax code for the c/party <> ' '             S01176
     C***  and the charge amount 1 <> 0 then                              S01176
     C***  cal. the tax due on charge amount 1.                           S01176
     C*                                                                   S01176
     C           TXAP      IFEQ 'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C           @BTCA1    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTCA1    IFLT 0                                         S01176
     C                     Z-SUB@BTCA1    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @BTAXA                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCA1    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @BTAXA                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BTCA1                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If charge code 2 is non-blank and the                          S01176
     C***  charge amount 2 is zero.                                       S01176
     C*                                                                   S01176
     C           @BTCC2    IFNE *BLANKS                                   S01176
     C           @BTCA2    ANDEQ*ZERO                                     S01176
     C*                                                                   S01176
     C**  Calculate the charge code amount 2.                             S01176
     C*                                                                   S01176
     C                     MOVE @BTCC2    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     EXSR SUB700                                    S01176
     C                     Z-ADD@XAMTN    @BTCA2                          S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CCP3                                           S01408
     C*                                                                   S01408
     C*                                                                   S01176
     C***  If the tax applicable for the charge                           S01176
     C***  code 2 =' Y' , the tax code for the c/party <> ' '             S01176
     C***  and the charge amount 2 <> 0 then                              S01176
     C***  cal. the tax due on charge amount 2.                           S01176
     C*                                                                   S01176
     C           TXAP      IFEQ 'Y'                                       S01176
     C           @TAXC     ANDNE*BLANKS                                   S01176
     C           @BTCA2    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTCA2    IFLT 0                                         S01176
     C                     Z-SUB@BTCA2    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @BTAXA                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCA2    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @BTAXA                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BTCA2                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If the broker commission code is non-blank and the             S01176
     C***  broker commission amount <> zero.                              S01176
     C           @BTBCC    IFNE *BLANKS                                   S01176
     C           @BTBCA    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C***  Calculate the broker commission rebate.                        S01176
     C*                                                                   S01176
     C                     MOVE @BTBCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C*                                                                   S01176
     C***  If the rebate applicable ind. for the broker commission        S01176
     C***  code =' Y' and the commission rebate % <> 0                    S01176
     C*                                                                   S01176
     C           REBA      IFEQ 'Y'                                       S01176
     C           CMRP      ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTBCA    IFLT 0                                         S01176
     C                     Z-SUB@BTBCA    @WCHGA                          S01176
     C                     EXSR CALREB                                    S01176
     C                     Z-ADD@WREB     @BBCMR                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTBCA    @WCHGA                          S01176
     C                     EXSR CALREB                                    S01176
     C                     Z-SUB@WREB     @BBCMR                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  Cal the tax rebate due with the broker commission rebate       S01176
     C*                                                                   S01176
     C           @BBCMR    IFNE *ZERO                                     S01176
     C           TXAP      ANDEQ'Y'                                       S01176
     C           @TAXC     ANDNE*BLANK                                    S01176
     C*                                                                   S01176
     C           @BBCMR    IFLT 0                                         S01176
     C                     Z-SUB@BBCMR    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @TRTOT                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BBCMR    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @TRTOT                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BBCMR                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If the customer commission code is non-blank and the           S01176
     C***  broker commission amount <> zero.                              S01176
     C*                                                                   S01176
     C           @BTCCC    IFNE *BLANKS                                   S01176
     C           @BTCCA    ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C***  Calculate the customer commission rebate.                      S01176
     C*                                                                   S01176
     C                     MOVE @BTCCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C*                                                                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C*                                                                   S01176
     C***  If the rebate applicable ind. for the customer commission      S01176
     C***  code =' Y' and the commission rebate % <> 0                    S01176
     C*                                                                   S01176
     C           REBA      IFEQ 'Y'                                       S01176
     C           CMRP      ANDNE*ZERO                                     S01176
     C*                                                                   S01176
     C           @BTCCA    IFLT 0                                         S01176
     C                     Z-SUB@BTCCA    @WCHGA                          S01176
     C                     EXSR CALREB                                    S01176
     C                     Z-ADD@WREB     @BCCMR                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C**************       Z-ADD@BTBCA    @WCHGA                    S01176063506
     C                     Z-ADD@BTCCA    @WCHGA                          063506
     C                     EXSR CALREB                                    S01176
     C                     Z-SUB@WREB     @BCCMR                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  Cal the tax rebate due with the customer commission rebate     S01176
     C*                                                                   S01176
     C           @BCCMR    IFNE *ZERO                                     S01176
     C           TXAP      ANDEQ'Y'                                       S01176
     C           @TAXC     ANDNE*BLANK                                    S01176
     C*                                                                   S01176
     C           @BCCMR    IFLT 0                                         S01176
     C                     Z-SUB@BCCMR    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     SUB  @WTAX     @TRTOT                          S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BCCMR    @WCHGA                          S01176
     C                     EXSR CALTAX                                    S01176
     C                     ADD  @WTAX     @TRTOT                          S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     Z-ADD*ZERO     @BCCMR                          S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  Default the tax rebate to the tax rebate total.                S01176
     C*                                                                   S01176
     C                     Z-ADD@TRTOT    @BTXRB                          S01176
     C*                                                                   S01176
     C                     ENDSR                                          S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CCP2                                           S01408
     C*                                                                   S01408
     C*****************************************************************   S01176
      /EJECT
     C*****************************************************************   S01176
     C*    CALTAX - Calculate the tax associated with a charge or     *   S01176
     C*           - commission amount.                                *   S01176
     C*                                                               *   S01176
     C*    Called By :NCAAMT, CAAMT                                   *   S01176
     C*    Calls     :ZTCAL1                                          *   S01176
     C*****************************************************************   S01176
     C*                                                                   S01176
     C           CALTAX    BEGSR                                          S01176
     C*                                                                   S01176
     C           *LIKE     DEFN TAXA      @WTAX                           S01176
     C           *LIKE     DEFN TBCA      @WCHGA                          S01176
     C*                                                                   S01176
     C***  Restore details of the tax code obtained from the c/party      S01176
     C*                                                                   S01176
     C                     MOVEL@TXDS     @ZCHDS                          S01176
     C*                                                                   S01176
     C***  If the trade type is 'TP' and the levied on ind. for the    .  S01176
     C***  default tax code is 'S' or the trade type is 'TS' and          S01176
     C***  the levied on indicator for the default tax code is 'P'        S01176
     C***  set the tax amount to 0.                                       S01176
     C*                                                                   S01176
     C           @BTDTP    IFEQ 'TP'                                      S01176
     C           @TLPSI    ANDEQ'S'                                       S01176
     C           @BTDTP    OREQ 'TS'                                      S01176
     C           @TLPSI    ANDEQ'P'                                       S01176
     C*                                                                   S01176
     C                     Z-ADD0         @WTAX                           S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C***  Calculate tax amount.                                          S01176
     C*                                                                   S01176
     C*                                                                   S01446
     C*  If customer Commissions feature is on, autocharges is on         S01446
     C*  and the charge currency from SE ICD is not blank then set        S01446
     C*  up the parameters for SR/ZCONV which will be called from         S01446
     C*  SR/ZTCAL1.                                                       S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           *IN15     ANDEQ'1'                                       S01446
     C           BVCHRC    ANDNE*BLANK                                    S01446
     C                     MOVE BVCHRC    ZCCYI                           S01446
     C                     MOVE NMCYA     ZCCYO                           S01446
     C                     MOVE UCHXRT    ZEXCH                           S01446
     C                     MOVE UCHXMD    ZMD                             S01446
     C                     MOVE UNBDP     ZCDPI                           S01446
     C                     MOVE NOMDP     ZCDPO                           S01446
     C                     ELSE                                           S01446
     C                     MOVE *BLANK    ZCCYI                           S01446
     C                     MOVE *BLANK    ZCCYO                           S01446
     C                     MOVE *ZERO     ZEXCH                           S01446
     C                     MOVE *BLANK    ZMD                             S01446
     C                     MOVE *BLANK    ZCDPI                           S01446
     C                     MOVE *BLANK    ZCDPO                           S01446
     C                     END                                            S01446
     C                     Z-ADD@WCHGA    ZCHGA                           S01176
     C                     EXSR ZTCAL1                                    S01176
     C                     Z-ADDZTAXA     @WTAX                           S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ENDSR                                          S01176
     C*****************************************************************   S01176
      /EJECT
     C*****************************************************************   S01176
     C*    CALREB - Calculate a commission rebate.                    *   S01176
     C*                                                               *   S01176
     C*    Called By :NCAAMT, CAAMT                                   *   S01176
     C*    Calls     :                                                *   S01176
     C*****************************************************************   S01176
     C*                                                                   S01176
     C           CALREB    BEGSR                                          S01176
     C*                                                                   S01176
     C           *LIKE     DEFN BCMR      @WREB                           S01176
     C*                                                                   S01176
     C***  Commission rebate = comm rebate % X commission amt.            S01176
     C***                      -------------------------------            S01176
     C***                                  100                            S01176
     C*                                                                   S01176
     C           CMRP      MULT @WCHGA    @WRK2  150                      S01176
     C           @WRK2     DIV  100       @WREB                           S01176
     C*                                                                   S01176
     C                     ENDSR                                          S01176
     C*****************************************************************
      /EJECT                                                              S01176
     C*****************************************************************
     C*  SUB104 - Common trade defaults part 2                        *
     C*****************************************************************
     C           SUB104    BEGSR                                          S01176
     C*
     C* Price: default calculated by ZPRCI
     C           STBS      IFEQ 'D'
     C           STBS      OREQ 'Y'
     C           @BTPDY    ANDNE0
     C                     Z-ADD@BTPDY    ZPRCIN
     C                     Z-ADD@BTDVD    ZFDATE
     C*                                                                   E39495
     C           @BACIN    IFEQ 'X'                                       E39495
     C                     MOVE 'X'       SCUMEX                          E39495
     C                     ELSE                                           E39495
     C                     MOVE 'C'       SCUMEX                          E39495
     C                     END                                            E39495
     C                     Z-ADD@BNOML    ZNOML                           E39495
     C*                                                                   E39495
     C                     EXSR ZPRCI
      *                                                                                       CSE035
      *  ADJUST PRICE : PRICE + PUR INT BEFORE ROUNDING                                       CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     Z-ADDZPRCOT    ZPRCOT                                              CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    ADD  ZWAMT     ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C           CSE035    IFEQ 'Y'                                                           CSE035
      *                                                                                       CSE035
     C           NCD       IFGE MATY                                                          CSE035
     C           SYBS      ANDEQ'AU'                                                          CSE035
     C                     ELSE                                                               CSE035
     C           SYBS      IFNE 'AU'                                                          CSE035
     C           SYBS      ANDNE'DA'                                                          CSE035
     C           STBS      ANDEQ'Y'                                                           CSE035
     C           ZPRCOT    SUB  PURINT    ZPRCOT                                              CSE035
     C                     ENDIF                                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
     C/COPY WNCPYSRC,SE3003C011
     C                     Z-ADDZPRCOT    @BPRIC
     C                     END
     C*
     C* Ex dividend: If processing type is 4 or 7
     C*              If next dividend date is zero = C
     C*              Else calculate ex date using default. If value
     C*               date is less than next dividend date and
     C*               greater or equal to ex date = X
     C*              Else = C
     C           PROT      IFEQ '4'
     C           PROT      OREQ '7'
     C                     EXSR SUB509                                    S01510
      ***********                                                         S01510
     C***********NDVD      IFEQ 0                                         S01510
     C***********          MOVEL'C'       @BEXDV                          S01510
     C***********          ELSE                                           S01510
     C***********          MOVELEDFT      ZNRDYS                          S01510
     C***********          MOVE EDFT      @WEDFT  1                       S01510
     C***********@WEDFT    IFEQ 'W'                                       S01510
     C***********          Z-ADDNDVD      ZDAYNO                          S01510
     C***********          MOVE NMCYA     ZCCY                            S01510
     C***********          MOVE *BLANKS   ZLOC                            S01195
     C***********          EXSR XDATE3                                    S01195
     C***********          EXSR ZBKDT                                     S01195
     C***********          ELSE                                           S01510
     C***********NDVD      SUB  ZNRDYS    ZDYNBR                          S01510
     C***********          END                                            S01510
     C***********@BTDVD    IFLT NDVD                                      S01510
     C***********@BTDVD    ANDGEZDYNBR                                    S01510
     C***********@BTDDT    IFLT NDVD                                      S01510
     C***********@BTDDT    ANDGEZDYNBR                                    S01510
     C***********          MOVEL'X'       @BEXDV                          S01510
     C***********          ELSE                                           S01510
     C***********          MOVEL'C'       @BEXDV                          S01510
     C***********          END                                            S01510
     C***********          END                                            S01510
     C                     END
     C*                                                                   S01176
     C***  If any Charge Codes were defaulted in SUB403...                S01176
     C*                                                                   S01176
     C           @DFYN     IFEQ 'Y'                                       S01176
     C*                                                                   S01176
     C***  ...Calculate the commission/charge/tax amountrs                S01176
     C*                                                                   S01176
     C                     EXSR SUB103                                    S01176
     C*                                                                   S01176
     C                     END                                            S01176
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
     C           SPBS      IFEQ 'D'                                                           CAS006
     C           SPBS      OREQ 'Y'                                                           CAS006
     C                     Z-ADD@BTPDY    ZPRCIN                                              CAS006
     C                     ADD  @BCRSK    ZPRCIN                                              CAS006
     C                     ADD  @BLQPR    ZPRCIN                                              CAS006
     C                     Z-ADD@BTDVD    ZFDATE                                              CAS006
     C           @BACIN    IFEQ 'X'                                                           CAS006
     C                     MOVE 'X'       SCUMEX                                              CAS006
     C                     ELSE                                                               CAS006
     C                     MOVE 'C'       SCUMEX                                              CAS006
     C                     END                                                                CAS006
     C                     Z-ADD@BNOML    ZNOML                                               CAS006
      *                                                                                       CAS006
     C                     EXSR ZPRCI                                                         CAS006
     C                     Z-ADDZPRCOT    @BPRCN                                              CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       234440
      ** Fiscal Price                                                                         234440
      *                                                                                       234440
     C           CGL031    IFEQ 'Y'                                                           234440
     C                     EXSR SRVFSP                                                        234440
      *                                                                                       234440
      ** Set EU Tax Amount by calling SEVTRADTAX                                              234440
      *                                                                                       234440
     C           @BTDTP    IFEQ 'TP'                                                          234440
     C           @C1DI     IFEQ 'S'                                                           234440
     C           @C1DI     OREQ 'D'                                                           234440
     C                     CALL SEVTAX                                                        234440
      * INPUTS                                                                                234440
      * Response Mode                                                                         234440
     C                     PARM *BLANKS   PRETC                                               234440
      * Valid Trade Details                                                                   234440
     C                     PARM           @BLKDS                                              234440
      * Security Details                                                                      234440
     C                     PARM           @SECTY                                              234440
      * Process Flag                                                                          234440
     C                     PARM 'E'       @WFLG   1                                           234440
      * OUTPUTS                                                                               234440
      * EU Tax Screen Format                                                                  234440
      * EU Tax in Nominal Currency File Format                                                234440
      * EU Tax in Settlement Currency File Format                                             234440
     C                     PARM           @SEUTX 15                                           234440
     C                     PARM           @BEUTX                                              234440
     C                     PARM           @BEUTS                                              234440
      *                                                                                       234552
      ** Validate whether account is blocked due to EU Tax by calling                         234552
      ** SEVTAXDATE                                                                           234552
      *                                                                                       234552
     C           BGPFMG    IFEQ 'Y'                                                           234552
      *                                                                                       234552
     C                     MOVE @BTCNR    @PTCN2  6                                           234552
     C                     MOVEL@BTCNR    @PLKY                                               234552
     C                     CALL 'AOPLCSR0'                                                    234552
     C                     PARM *BLANKS   @RTCD                                               234552
     C                     PARM '*KEY   ' @OPTN                                               234552
     C                     PARM           @PLKY  10                                           234552
     C           SDPLCS    PARM SDPLCS    DSFDY                                               234552
      *                                                                                       234552
     C           @RTCD     IFEQ *BLANKS                                                       234552
     C                     MOVEL'Y'       WLPCUS                                              234552
     C                     ELSE                                                               234552
     C                     MOVE 'N'       WLPCUS                                              234552
     C                     END                                                                234552
     C                     END                                                                234552
      *                                                                                       234552
     C                     CALL SEVDAT                                                        234552
      *                                                                                       234552
      ** INPUTS                                                                               234552
      *                                                                                       234552
      ** Return Code                                                                          234552
      *                                                                                       234552
     C                     PARM *BLANKS   PRETC                                               234552
     C                     PARM *BLANKS   WDFLT   1                                           234552
     C                     PARM @BCHTP    WACTN   1                                           234552
     C                     PARM           @BTDBA                                              234552
     C                     PARM           @BTCNR                                              234552
     C                     PARM           @BTDSS                                              234552
     C                     PARM           @BPTFR                                              234552
     C                     PARM           @BTDMI                                              234552
     C                     PARM 'T'       WTYPE   1                                           234552
     C                     PARM           @BTDRF                                              234552
     C                     PARM           @BTDVD                                              234552
     C                     PARM '@SPTFR'  WFIELD 10                                           234552
     C                     PARM           @SECTY                                              234552
     C                     PARM           @CUSDT                                              234552
      *                                                                                       234552
      ** OUTPUTS                                                                              234552
      *                                                                                       234552
      ** Error fields/message IDs/message data (arrays) from/to caller                        234552
     C                     PARM           @FNXA                                               234552
     C                     PARM           @MIXA                                               234552
     C                     PARM           @MDXA                                               234552
      ** Warning Fields/Message IDs/Message Data (arrays) From/To Caller                      234552
     C                     PARM           @WFNXA                                              234552
     C                     PARM           @WMIXA                                              234552
     C                     PARM           @WMDXA                                              234552
      *                                                                                       234552
      ** Value Date - OK                                                                      234552
     C                     PARM           WVDTOK  1                                           234552
     C           WVDTOK    IFEQ 'N'                                                           234552
     C                     SETON                     12                                       234552
     C                     MOVEL@ER,22    @ERRTX                                              234552
     C                     ENDIF                                                              234552
     C                     ENDIF                                                              234440
     C                     ENDIF                                                              234440
     C                     ENDIF                                                              234440
     C*
     C                     ENDSR                           SUB104 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB200 - Output error report                                 *
     C*****************************************************************
     C           SUB200    BEGSR
     C*
     C* Rollback any updates
     C                     ROLBK
     C*
     C* Set error indicator
     C                     SETON                     13
     C*
     C* Open print file
     C***********          OPEN SE3003P1                                  S01117
     C                     OPEN SE3003AU                                  S01117
     C*
     C* Get client details
     C***********@BTCNR    CHAINCLINTCBF             01                   S01117
     C**N01******          EXCPTRELCCB                                    S01117
     C************IN01     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C***********          MOVEL*BLANKS   CSNM                            S01117
     C***********          MOVEL*BLANKS   CRNM                            S01117
     C                     MOVE *BLANKS   @RTCD                           S01117
     C                     MOVE @BTCNR    @WCSNM                          S01117
     C                     EXSR AOCUST                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANKS   BBCSSN                          S01117
     C                     MOVEL*BLANKS   BBCRNM                          S01117
     C           BBPRBA    IFEQ 'Y'                                                           234552
     C                     MOVEL'Y'       WPBCUS  1                                           234552
     C                     ELSE                                                               234552
     C                     MOVE 'N'       WPBCUS                                              234552
     C                     ENDIF                                                              234552
     C                     END
     C*
     C* Set up fixed fields
     C                     MOVEL@BCHTP    @PATCD
     C                     MOVEL@BTDRF    @PTDRF
     C                     MOVEL@BBLKR    @PBLKR
     C                     MOVEL@BTDSS    @PSESN
     C                     MOVELSRPN      @PSERN
     C***********          MOVELCSNM      @PCLNN                          S01117
     C***********          MOVELCRNM      @PCLRN                          S01117
     C                     MOVELBBCSSN    @PCLNN                          S01117
     C                     MOVELBBCRNM    @PCLRN                          S01117
     C*
     C***********CSNM      IFEQ *BLANK                                    S01117
     C***********          MOVELCNUM      @PCLNN                          S01117
     C           BBCSSN    IFEQ *BLANK                                    S01117
     C                     MOVELBBCUST    @PCLNN                          S01117
     C                     END
     C*
     C                     MOVE @BTINC    @PICIN
     C*
     C*  Trade type
     C                     MOVE @BTDTP    @PTDTY
     C*
     C*  Nominal
     C                     MOVE @BNOML    ZFIELD
     C                     Z-ADD@BTNMD    ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    @PNOML
     C*
     C*  Price/Discount/Yield
     C                     Z-ADD0         ZFLD15
     C                     MOVE @BTPDY    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @PPDCY
     C*
     C*  Value date
     C           @BTDVD    IFNE 0
     C                     Z-ADD@BTDVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     @PVALD
     C                     ELSE
     C                     MOVEL*BLANKS   @PVALD
     C                     END
     C*
     C***Branch*code**********                                            S01117
     C*  Booking Branch                                                   S01117
     C***********@BTDBR    IFNE 0                                         S01117
     C***********          MOVEL@BTDBR    @PBRCH                          S01117
     C***********          ELSE                                           S01117
     C***********          MOVEL*BLANKS   @PBRCH                          S01117
     C***********          END                                            S01117
     C                     MOVEL@BTDBA    @PBRCH                          S01117
     C*
     C*  Book
     C                     MOVEL@BTDBK    @PBOOK
      *                                                                   CAC005
      ** If CAC005 is on, retrieve user book from AOBKPCR0.               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD   7                       CAC005
     C                     PARM '*USER  ' POPTN   7                       CAC005
     C           PMBKCD    PARM *BLANKS   PMBKCD  2                       CAC005
     C           PMPRFC    PARM *BLANKS   PMPRFC  4                       CAC005
     C                     PARM @BTDBK    PMPSBK  2                       CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPMBKCD    @PBOOK                          CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C*
     C*  Clearance type
     C                     MOVEL@BCLTY    @PCLTY
     C*
     C*  Settlement currency
     C                     MOVEL@BSETC    @PSLCY
     C*
     C*  Reallowance
     C                     Z-ADD0         ZFLD15
     C                     MOVE @BRALL    ZFLD15
     C                     Z-ADD5         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @PRASN
     C*
     C*  Market centre
     C                     MOVEL@BTMKC    @PMRKT
     C*                                                                   CAC002
     C*  If Analytical Accounting is installed...                         CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C*                                                                   CAC002
     C*  Book Profit centre                                               CAC002
     C*                                                                   CAC002
     C                     MOVEL@BBPRC    @PBPRC                          CAC002
     C*                                                                   CAC002
     C*  Transaction Profit centre                                        CAC002
     C*                                                                   CAC002
     C           @C1DI     IFEQ 'S'                                       CAC002
     C           @C1DI     OREQ 'D'                                       CAC002
     C                     MOVE *ON       *IN22                           CAC002
     C                     MOVEL@BTPRC    @PTPRC                          CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *OFF      *IN22                           CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C*  Ex Dividend  (if Processing type is 4 or 7)                      CAC002
     C*                                                                   CAC002
     C           PROT      IFEQ '4'                                       CAC002
     C           PROT      OREQ '7'                                       CAC002
     C                     SETOF                     19                   CAC002
     C                     MOVEL@BEXDV    @PEXDV                          CAC002
     C                     ELSE                                           CAC002
     C*                                                                   CAC002
     C**  Current Factor (if Processing type is 8)                        CAC002
     C           PROT      IFEQ '8'                                       CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE @BTCFC    ZFLD15                          CAC002
     C                     Z-ADD9         ZDECS                           CAC002
     C                     MOVE 'L'       ZECODE                          CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE ZOUT21    @PTCFC                          CAC002
     C                     ENDIF                                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*
     C*  Trade date
     C           @BTDDT    IFNE 0
     C                     Z-ADD@BTDDT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZDATE     @PTRDD
     C                     ELSE
     C                     MOVEL*BLANKS   @PTRDD
     C                     END
     C*
     C*  Trade sub-type
     C                     MOVEL@BTSUB    @PTDST
     C*
     C*  Market indicator
     C                     MOVEL@BTDMI    @PMKTI
     C*
     C***AIBD/IPPA*****************************************************   E43208
     C*  ISMA/IPMA                                                        E43208
     C                     MOVEL@BAIIP    @PAIIP
     C*
     C*  Capacity
     C                     MOVEL@BTCAP    @PCPCY
     C*
     C*  Trader I.D.
     C                     MOVEL@BTDID    @PTRID
     C*
     C*  Link reference
     C                     MOVEL@BLKRF    @PLKRF
     C*
     C*  Narrative
     C                     MOVEL@BTDNR    @PNARR
     C*
     C*  Price
     C                     Z-ADD0         ZFLD15
     C                     MOVE @BPRIC    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @PPRIC
      *                                                                                       233607
      ** Fiscal Price                                                                         233607
      *                                                                                       233607
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     Z-ADD0         ZFLD15                                              233607
     C                     MOVE @BFSPR    ZFLD15                                              233607
     C                     Z-ADD8         ZDECS                                               233607
     C                     EXSR ZSEDIT                                                        233607
     C                     MOVE ZOUT20    @PFSPR                                              233607
      *                                                                                       234440
      ** EU Tax                                                                               234440
      *                                                                                       234440
     C                     Z-ADD@BEUTX    ZFLD15                                              234440
     C                     Z-ADDNOMDP     ZDECS                                               234440
     C                     EXSR ZSEDIT                                                        234440
     C                     MOVE ZOUT21    @PEUTX                                              234440
     C                     ENDIF                                                              233607
     C*
     C*  Accrued Indicator
     C                     MOVE @BTACI    @PACIN
     C*
     C*  Days adjustment
     C                     Z-ADD@BDADJ    ZFLD15
     C                     Z-ADD0         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @PDAYS
     C*
     C*  Actual Difference indicator
     C                     MOVE @BADIN    @PACDF
     C*
     C*  Coupon rate
     C                     Z-ADD0         ZFLD15
     C                     MOVE @BTDCR    ZFLD15
     C                     Z-ADD7         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @PCPRT
     C*
     C*  Interest amount
     C                     Z-ADD@BITRA    ZFLD15
     C                     Z-ADD@BTNMD    ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @PIASG
     C*
     C*  Exchange Rate
     C                     Z-ADD0         ZFLD15
     C                     MOVE @BTDER    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @PEXCH
     C*  M/D indicator
     C                     MOVE @BTMDI    @PERMD
     C*
     C*  Base currency rate
     C                     Z-ADD0         ZFLD15
     C                     MOVE @BTBCR    ZFLD15
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT20    @PBCCR
     C*                                                                   CAC002
     C**  If Analytical Accounting is installed and nominal currency      CAC002
     C**  is not the same as the settlement currency, print margin        CAC002
     C**  points and margin amount                                        CAC002
     C*                                                                   CAC002
     C           BGN0ST    IFEQ 'Y'                                       CAC002
     C           NMCYA     ANDNE@BSETC                                    CAC002
     C*                                                                   CAC002
     C**  Margin Points                                                   CAC002
     C                     MOVE *ON       *IN23                           CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE @BFXMP    ZFLD15                          CAC002
     C                     Z-ADD2         ZDECS                           CAC002
     C                     MOVE 'L'       ZECODE                          CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE ZOUT21    @PFXMP                          CAC002
     C*                                                                   CAC002
     C**  Margin Amount                                                   CAC002
     C                     MOVE @BSETC    @AJCD                           CAC002
     C                     MOVE *BLANKS   @RTCD                           CAC002
     C                     EXSR AOCURR                                    CAC002
     C*                                                                   CAC002
     C                     MOVE *BLANKS   ZFLD15                          CAC002
     C                     MOVE @BMAMT    ZFLD15                          CAC002
     C                     Z-ADDA6NBDP    ZDECS                           CAC002
     C                     MOVE 'J'       ZECODE                          CAC002
     C                     EXSR ZSEDIT                                    CAC002
     C                     MOVE ZOUT21    @PMAMT                          CAC002
     C                     MOVE 'L'       ZECODE                          CAC002
     C*                                                                   CAC002
     C                     ELSE                                           CAC002
     C                     MOVE *OFF      *IN23                           CAC002
     C*                                                                   CAC002
     C                     ENDIF                                          CAC002
     C*
     C*  Settlement method
     C           @BSMTH    IFNE 0
     C                     MOVEL@BSMTH    @PSMTH
     C                     ELSE
     C                     MOVEL*BLANKS   @PSMTH
     C                     END
     C*
     C*  Pay from
     C                     MOVEL@BPYFM    @PPYFM
     C*
     C*  Pay from branch
     C***********@BPYFB    IFNE 0                                         S01117
     C***********          MOVEL@BPYFB    @PPYFB                          S01117
     C           @BPYFA    IFNE *BLANKS                                   S01117
     C                     MOVEL@BPYFA    @PPYFA                          S01117
     C                     ELSE
     C***********          MOVEL*BLANKS   @PPYFB                          S01117
     C                     MOVEL*BLANKS   @PPYFA                          S01117
     C                     END
     C*
     C*  Pay to
     C                     MOVEL@BPAYT    @PPYTO
     C*
     C*  Pay to branch
     C***********@BPYTB    IFNE 0                                         S01117
     C***********          MOVEL@BPYTB    @PPYTB                          S01117
     C           @BPYTA    IFNE *BLANKS                                   S01117
     C                     MOVEL@BPYTA    @PPYTA                          S01117
     C                     ELSE
     C***********          MOVEL*BLANKS   @PPYTB                          S01117
     C                     MOVEL*BLANKS   @PPYTA                          S01117
     C                     END
     C*
     C*  For a/c of
     C                     MOVEL@BTDFA    @PFAO1
     C*
     C*  A/c sequence
     C           @BASNM    IFNE 0
     C                     MOVEL@BASNM    @PACSQ
     C                     ELSE
     C                     MOVEL*BLANKS   @PACSQ
     C                     END
     C*
     C*  Special instructions
     C                     MOVEL@BTDSI    @PSPIN
     C*
     C*  Priority code
     C                     MOVEL@BPRYC    @PPTYC
     C*
     C***C/H*indicator******************                                  S01175
     C***********          MOVEL@BCLRH    @PCHIN                          S01175
     C*
     C*  Pay code
     C                     MOVEL@BPCOD    @PPAYC
     C*
     C*  Deliver from
     C********** @BDELF    IFNE 0                                                             CSD027
     C           @BDELF    IFNE *BLANKS                                                       CSD027
     C                     MOVEL@BDELF    @PDELF
     C                     ELSE
     C                     MOVEL*BLANKS   @PDELF
     C                     END
     C*
     C*  Deliver to
     C********** @BDELT    IFNE 0                                                             CSD027
     C           @BDELT    IFNE *BLANKS                                                       CSD027
     C                     MOVEL@BDELT    @PDELT
     C                     ELSE
     C                     MOVEL*BLANKS   @PDELT
     C                     END
     C*  For a/c of
     C                     MOVEL@BDTFA    @PFAO2
     C*                                                                   S01175
     C*  For a/c of (Deliver from)                                        S01175
     C                     MOVEL@BDFFA    @PDFFA                          S01175
     C*                                                                   S01176
     C***  Autocharges Indicator                                          S01176
     C*                                                                   S01176
     C                     MOVE @BAUTS    @PAUTS                          S01176
     C*
     C*  Work out decimal places
     C*
     C***                  Z-ADD0         NOMDP   10
     C***                  Z-ADD@BTNMD    NOMDP
     C***Local*transfer*code**********************************************S01176
     C***********          MOVEL@BTTCC    @PLCTC                          S01176
     C***********                                                         S01176
     C***Local*transfer*amount********************************************S01176
     C***********          Z-ADD@BLTCA    ZFLD15                          S01176
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @PLCTA                          S01176
     C***********                                                         S01176
     C***PMT*charge*code**************************************************S01176
     C***********          MOVEL@BTPCC    @PPMTC                          S01176
     C***********                                                         S01176
     C***PMT*charge*amount************************************************S01176
     C***********          Z-ADD@BTPCA    ZFLD15                          S01176
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @PPMTA                          S01176
     C***********                                                         S01176
     C***VAT*charge*amount************************************************S01176
     C***********          Z-ADD@BTVCA    ZFLD15                          S01176
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @PVATA                          S01176
     C*                                                                   S01176
     C***  Set up ZDECS for charges standard subroutine                   S01176
     C*                                                                   S01176
     C                     Z-ADDNOMDP     ZDECS                           S01176
     C*
     C*  Broker commission code
     C                     MOVEL@BTBCC    @PBKCC
     C*
     C*  Broker commission amount
     C                     Z-ADD@BTBCA    ZFLD15
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @PBKCA
     C*
     C*  Customer commission code
     C                     MOVEL@BTCCC    @PCSCC
     C*
     C*  Customer commission amount
     C                     Z-ADD@BTCCA    ZFLD15
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @PCSCA
     C*
     C*  Charges 1 code
     C                     MOVEL@BTCC1    @PCG1C
     C*
     C*  Charges 1 amount
     C                     Z-ADD@BTCA1    ZFLD15
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @PCG1A
     C*
     C*  Charges 2 code
     C                     MOVEL@BTCC2    @PCG2C
     C*
     C*  Charges 2 amount
     C                     Z-ADD@BTCA2    ZFLD15
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @PCG2A
     C*
     C*  Charges 3 code
     C                     MOVEL@BTCC3    @PCG3C
     C*
     C*  Charges 3 amount
     C                     Z-ADD@BTCA3    ZFLD15
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    @PCG3A
     C*                                                                   S01176
     C***  Charges 4 Code                                                 S01176
     C*                                                                   S01176
     C                     MOVE @BTCC4    @PCG4C                          S01176
     C*                                                                   S01176
     C***  Charges 4 Amount                                               S01176
     C*                                                                   S01176
     C                     Z-ADD@BTCA4    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @PCG4A                          S01176
     C*                                                                   S01176
     C***  Charges 5 Code                                                 S01176
     C*                                                                   S01176
     C                     MOVE @BTCC5    @PCG5C                          S01176
     C*                                                                   S01176
     C***  Charges 5 Amount                                               S01176
     C*                                                                   S01176
     C                     Z-ADD@BTCA5    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @PCG5A                          S01176
     C*                                                                   S01176
     C***  Don't bother setting up the other indicators unless            S01176
     C***  Autocharges is on, because they will not be printed.           S01176
     C*                                                                   S01176
     C***********AUMO      IFEQ 'Y'                                S01176 S01117
     C           BVACOP    IFEQ 'Y'                                       S01117
     C*                                                                   S01176
     C***  Charges 6 Code                                                 S01176
     C*                                                                   S01176
     C                     MOVE @BTCC6    @PCG6C                          S01176
     C*                                                                   S01176
     C***  Charges 6 Amount                                               S01176
     C*                                                                   S01176
     C                     Z-ADD@BTCA6    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @PCG6A                          S01176
     C*                                                                   S01176
     C***  Charges 7 Code                                                 S01176
     C*                                                                   S01176
     C                     MOVE @BTCC7    @PCG7C                          S01176
     C*                                                                   S01176
     C***  Charges 7 Amount                                               S01176
     C*                                                                   S01176
     C                     Z-ADD@BTCA7    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @PCG7A                          S01176
     C*                                                                   S01176
     C***  Tax Amount                                                     S01176
     C*                                                                   S01176
     C                     Z-ADD@BTAXA    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @PCGTX                          S01176
     C*                                                                   S01176
     C***  Broker Commission Rebate Amount                                S01176
     C*                                                                   S01176
     C                     Z-ADD@BBCMR    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @PBCMR                          S01176
     C*                                                                   S01176
     C***  Customer Commission Rebate Amount                              S01176
     C*                                                                   S01176
     C                     Z-ADD@BCCMR    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @PCCMR                          S01176
     C*                                                                   S01176
     C***  Tax Rebate Amount                                              S01176
     C*                                                                   S01176
     C                     Z-ADD@BTXRB    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @PTXRB                          S01176
     C*                                                                   S01176
     C***  Countervalue                                                   S01176
     C*                                                                   S01176
     C                     Z-ADD@BTCTR    ZFLD15                          S01176
     C                     EXSR ZSEDIT                                    S01176
     C                     MOVE ZOUT21    @PTCTR                          S01176
     C*                                                                   S01176
     C*                                                                   S01117
     C***  Originating Branch                                             S01117
     C*                                                                   S01117
     C                     MOVE @BORBR    @PORBR                          S01117
     C*                                                                   S01117
     C***  Profit Centre                                                  S01117
     C*                                                                   S01117
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C                     MOVE @BPRFC    @PPRFC                          S01117
     C                     ENDIF                                          CAC002
     C*                                                                   S01117
     C** Portfolio Reference                                              S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE @BPTFR    @PPTFR                          S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANKS   @PPTFR                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** FX Rate                                                          S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C                     Z-ADD@BSPXR    ZFLD15                          S01486
     C                     EXSR ZSEDIT                                    S01486
     C                     MOVE ZOUT21    @PSPXR                          S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANKS   @PSPXR                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C** Multiply/Divide Indicator                                        S01486
     C*                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C                     MOVE @BSPMD    @PSPMD                          S01486
     C                     ELSE                                           S01486
     C                     MOVE *BLANKS   @PSPMD                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C*                                                                   S01117
     C                     END                                            S01176
     C*                                                                   CEU005
     C** In Currency in field 72                                          CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C                     MOVE @BICCY    @PICCY                          CEU005
     C                     ENDIF                                          CEU005
     C*                                                                   S01176
     C***Charges*other*code***********************************************S01176
     C***********          MOVEL@BTOCC    @PCGOC                          S01176
     C***Charges*other*amount*********************************************S01176
     C***********          MOVE @BTOCA    ZFLD15                          S01176
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @PCGOA                          S01176
     C***Local*tax*code***************************************************S01176
     C***********          MOVEL@BTLTC    @PLTXC                          S01176
     C***Local*tax*amount*************************************************S01176
     C***********          MOVE @BTLTA    ZFLD15                          S01176
     C***********          Z-ADDNOMDP     ZDECS                           S01176
     C***********          EXSR ZSEDIT                                    S01176
     C***********          MOVE ZOUT21    @PLTXA                          S01176
     C/COPY WNCPYSRC,SE3003C003
     C*
     C           CAS006    IFEQ 'Y'                                                           CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE @BCRSK    ZFLD15                                              CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT20    @PCRSK                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE @BLQPR    ZFLD15                                              CAS006
     C                     Z-ADD8         ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT20    @PLQPR                                              CAS006
      *                                                                                       CAS006
     C                     Z-ADD0         ZFLD15                                              CAS006
     C                     MOVE @BITRN    ZFLD15                                              CAS006
     C                     Z-ADD@BTNMD    ZDECS                                               CAS006
     C                     EXSR ZSEDIT                                                        CAS006
     C                     MOVE ZOUT20    @PITRN                                              CAS006
      *                                                                                       CAS006
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C*  Write record and close file
     C                     WRITESE3003R1
     C***********          CLOSESE3003P1                                  S01117
     C                     CLOSESE3003AU                                  S01117
     C*
     C                     ENDSR                           SUB200 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB201 - Perform file updates                                *
     C*****************************************************************
     C           SUB201    BEGSR
     C*
     C                     Z-ADD0         @COUNT  50
      *                                                                   S01269
      * Chain to LF/muser on @USR                                         S01269
     C           @USR      CHAINMUSERDDF             21                   S01269
     C*
     C* Get next transaction number
     C                     EXSR ZTNLU1
     C*
     C* Update trades files
     C                     EXSR SUB300
      *                                                                                       234440
      ** Update EU Tax records on SDCSINPD                                                    234440
      *                                                                                       234440
     C           CGL031    IFEQ 'Y'                                                           234440
     C                     CALL SEVTAX                                                        234440
      * INPUTS                                                                                234440
      * Response Mode                                                                         234440
     C                     PARM *BLANKS   PRETC                                               234440
      * Valid Trade Details                                                                   234440
     C                     PARM           @TRDDS                                              234440
      * Security Details                                                                      234440
     C                     PARM           @SECTY                                              234440
      * Process Flag                                                                          234440
     C                     PARM @BCHTP    @WFLG                                               234440
      * OUTPUTS                                                                               234440
      * EU Tax Screen Format                                                                  234440
      * EU Tax in Nominal Currency File Format                                                234440
      * EU Tax in Settlement Currency File Format                                             234440
     C                     PARM           @SEUTX                                              234440
     C                     PARM           @BEUTX                                              234440
     C                     PARM           @BEUTS                                              234440
     C                     ENDIF                                                              234440
      *                                                                   S01269
      **If*Trade*Authorisation = '00' or Action is Insert and User'S01269 082738
      **entering*threshold is greater than countervalue on trade   S01269 082738
      ***********                                                  S01269 082738
     C***********AUTT      IFEQ '00'                               S01269 S01117
     C***********BVAUTH    IFEQ '00'                               S01117 082738
     C***********@BCHTP    OREQ 'I'                                S01269 082738
     C***********ENTL      ANDGECTCTR                              S01269 082738
      ***********                                                  S01269 082738
      **Update*client*file*********************                    S01269 S01117
     C**N12******          EXSR SUB500                             S01269 S01117
     C***********                                                         082738
     C**Update*following files if trade is complete                       082738
     C**N12******@BTINC    IFEQ 'C'                                       082738
     C***********                                                         082738
     C**Update*memos                                                      082738
     C***U1******          EXSR SUB502                                    082738
     C***********                                                         082738
     C**Update*prono                                                      082738
     C**N12******          EXSR SUB501                                    082738
     C***********                                                         082738
     C**Update*olpos                                                      082738
     C**N12******          EXSR SUB503                                    082738
     C***********                                                         082738
     C***********          END                                     S01269 082738
      ***********                                                  S01269 082738
     C***********          END                                     S01269 082738
     C*                                                                   082738
     C* Do On-line Updates                                                082738
     C*                                                                   082738
     C           *IN12     IFEQ '0'                                       082738
     C                     CALL 'AOOUTRU0'                                082738
     C                     PARM           ##RTCD  7                       082738
     C                     PARM           Z#BSTS                          082738
     C                     PARM           Z#ASTS                          082738
     C           ##RTCD    IFEQ '*ERROR*'                                 082738
     C                     Z-ADD80        @DBASE           ***************082738
     C                     MOVEL'AOOUTRU0'@DBFIL           * DB ERROR 80 *082738
     C                     MOVEL@BTDRF    @DBKEY           ***************082738
     C                     EXSR SUB999                                    082738
     C                     END                                            082738
     C                     END                                            082738
      *                                                                   S01269
      * Update following files if trade is complete                       S01269
     C  N12      @BTINC    IFEQ 'C'                                       S01269
      *                                                                   S01269
     C* Update book
     C  N12                EXSR SUB504
     C*
     C* Update client positions if portfolio client
     C* (i.e. safe custody or discretionary client)
     C  N12      @C1DI     IFEQ 'S'
     C           @C1DI     OREQ 'D'
     C                     EXSR SUB505
     C                     END
     C*
     C* Update user positions
     C  N12                EXSR SUB506
     C*                                                                   S01117
     C* Write position profit centre records                              S01117
     C           *IN12     IFEQ '0'                                       S01117
     C           BKPRCU    ANDEQ'Y'                                       S01117
     C           CAC005    ANDEQ'N'                                       CAC005
     C                     EXSR WPRFC                                     S01117
     C                     END                                            S01117
     C*
     C                     END                                            S01269
      *                                                                   S01269
     C*********************END                                            S01269
      *
      **Update*client*file************                                    S01269
     C**N12****************EXSR SUB500                                    S01269
     C*
     C* Update settlements file if delete
     C           @BCHTP    IFEQ 'D'
     C           *IN12     ANDEQ'0'
     C                     EXSR SUB507
     C                     END
     C*
     C* Update trades trailer
     C  N12                EXSR SUB508
     C*
      * Write to PF/Trautd if Trade Authorisation is not '00'             S01269
     C***********AUTT      IFNE '00'                               S01269 S01117
     C           BVAUTH    IFNE '00'                                      S01117
     C           *IN12     ANDEQ'0'                                       S01269
     C                     EXSR SUB800                                    S01269
     C                     END                                            S01269
      * Write to PF/SEMVTSPD if CSE039 is on                                                  CSE039
     C           CSE039    IFEQ 'Y'                                                           CSE039
     C           *IN12     ANDEQ'0'                                                           CSE039
     C                     EXSR SUB805                                                        CSE039
     C                     END                                                                CSE039
      *                                                                   CSW003
      ** Default second record too, if required.                          CSW003
     C           CSW003    IFEQ 'Y'                                       CSW003
     C           @BCHTP    ANDEQ'I'                                       CSW003
     C           @C1DI     IFEQ 'S'                                       CSW003
     C**CSW003***@BDELT    ANDNE@BDELF                                    CSW003
     C           @C1DI     OREQ 'D'                                       CSW003
     C**CSW003***@BDELT    ANDNE@BDELF                                    CSW003
     C                     MOVE 'N'       T1GMES                          CSW003
     C                     EXSR MT5DF2                                    CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      *                                                                   CSW003
     C* Comit file updates
     C           *IN12     IFEQ '0'
     C                     MOVEL@BCHTP    @ACTN
     C                     Z-ADDNATN      @NTN
     C                     TIME           @TIME
      *                                                                   CSE006
      * If a Buy-Sell Back, and this is the second of the two trades,     CSE006
      * commit changes.                                                   CSE006
     C           @BYSL     IFEQ 'Y'                                       CSE006
     C           @BBLKR    IFNE @BTDRF                                    CSE006
     C           @CMTXT    COMIT                                          CSE006
     C                     ENDIF                                          CSE006
     C                     ELSE                                           CSE006
     C           @CMTXT    COMIT
     C                     ENDIF                                          CSE006
     C                     END
     C*
     C                     ENDSR                           SUB201 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB300 - Update trades file                                  *
     C*****************************************************************
     C           SUB300    BEGSR
      *                                                                   S01271
      * Set PRPC field on TRADSD to 'N'                                   S01271
      *                                                                   S01271
     C                     MOVE 'N'       PRPC                            S01271
     C                     MOVEL*BLANKS   NOBACK                                              236125
      *                                                                   S01271
     C*
     C* If change type is D, delete trade
     C           @BCHTP    IFEQ 'D'
     C*
     C* An active record must exist
     C                     SETOF                         14
     C           @BTDRF    CHAINTRADSDF              12
     C  N12      RECI      COMP 'C'                      14
     C  N14      RECI      COMP '*'                      14               E28748
     C  N14      RECI      COMP 'R'                      14               S01269
     C   14                SETON                         12
     C*
     C           *IN12     IFEQ '1'
     C                     MOVEL@ER,7     @ERRTX
     C                     MOVEL@BTDRF    @ETF7
     C   14                UPDATTRADSDF
     C                     MOVEL'Y'       NOBACK  1                                           236125
     C                     ELSE
      *                                                                   082738
     C                     MOVEL@TRDDS    Z#BSTS                          082738
      *                                                                   082738
     C                     TESTB'0'       TMSI           99
     C           *IN99     IFEQ '0'
     C                     MOVE 'N'       TCFR
     C                     ELSE
     C                     MOVE 'Y'       TCFR
     C                     END
     C***********AUTT      IFEQ '00'                               S01269 S01117
     C           BVAUTH    IFEQ '00'                                      S01117
     C           @BTINC    OREQ 'I'                                                           190455
     C                     MOVEL'C'       RECI
     C                     ELSE                                           S01269
     C                     MOVE RECI      XRECI   1                       S01269
     C                     MOVEL'R'       RECI                            S01269
     C                     END                                            S01269
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD@BCRSK    CRSK                                                CAS006
     C                     Z-ADD@BLQPR    LQPR                                                CAS006
     C                     Z-ADD@BTINN    TINN                                                CAS006
     C                     Z-ADD@BITRN    ITRN                                                CAS006
     C                     Z-ADD@BPRCN    PRICN                                               CAS006
     C                     ELSE                                                              BUG2606
     C                     Z-ADD*ZERO     CRSK                                               BUG2606
     C                     Z-ADD*ZERO     LQPR                                               BUG2606
     C                     Z-ADD*ZERO     TINN                                               BUG2606
     C                     Z-ADD*ZERO     ITRN                                               BUG2606
     C                     Z-ADD*ZERO     PRICN                                              BUG2606
     C                     ENDIF                                                              CAS006
      *                                                                                       CAS006
     C                     MOVEL'Y'       BCON
     C                     MOVEL'D'       CHTP
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDRUND      LCD
     C                     TIME           TIME
     C                     UPDATTRADSDF
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C           BVAUTH    ANDEQ'00'                                                          CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP17                                           S01408
     C*                                                                   S01408
      *                                                                   082738
     C                     MOVEL@TRDDS    Z#ASTS                          082738
      *                                                                   082738
     C           S01401    IFEQ 'Y'                                       082738
     C*                                                                   069596
     C** Need to update T1SCMG in TRADSDD1 in order to produce            069596
     C** cancellation MSG.                                                069596
     C*                                                                   069596
     C           @BTDRF    CHAINTRADSDD1             02                   069596
     C*                                                                   069596
     C**  Corresponding record not found on the extendsion file perform   069596
     C**  data base handling subroutine.                                  069596
     C*                                                                   069596
     C           *IN02     IFEQ *ON                                       069596
     C                     Z-ADD35        @DBASE           ***************069596
     C                     MOVEL'TRADSDX1'@DBFIL           * DB ERROR 35 *069596
     C***********          MOVEL@BTDRF    @DBKEY     ***************069596CSW003
     C                     MOVEL@BTDRF    DBKEY1  8                       CSW003
     C           CSW003    IFEQ 'Y'                                       CSW003
     C                     MOVE 'A'       DBKEY1                          CSW003
     C                     ENDIF                                          CSW003
     C                     MOVELDBKEY1    @DBKEY                          CSW003
     C                     EXSR SUB999                                    069596
     C                     ELSE                                           069596
     C                     MOVEL'Y'       T1SCMG                          069596
     C                     UPDATTRADSDD1                                  069596
     C                     END                                            069596
      *                                                                   CSW003
     C           CSW003    IFEQ 'Y'                                       CSW003
      ** Update second record too, if it exists                           CSW003
      *                                                                   CSW003
     C           @C1DI     IFEQ 'S'                                       CSW003
     C**CSW003** @BDELF    ANDNE@BDELT                                    CSW003
     C           @C1DI     OREQ 'D'                                       CSW003
     C**CSW003** @BDELF    ANDNE@BDELT                                    CSW003
      *                                                                   CSW003
     C                     MOVE 'B'       KWHEN                           CSW003
     C           KTRDY1    CHAINTRADSDD1             02                   CSW003
     C*                                                                   CSW003
     C           *IN02     IFEQ *ON                                       CSW003
     C                     Z-ADD36        @DBASE           ***************CSW003
     C                     MOVEL'TRADSDX1'@DBFIL           * DB ERROR 36 *CSW003
     C                     MOVEL@BTDRF    DBKEY1           ***************CSW003
     C                     MOVE 'B'       DBKEY1                          CSW003
     C                     MOVELDBKEY1    @DBKEY                          CSW003
     C                     EXSR SUB999                                    CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'Y'       T1SCMG                          CSW003
     C                     UPDATTRADSDD1                                  CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
     C*                                                                   069596
     C                     END
     C                     END                                            082738
     C                     ENDIF                                          CSW003
     C*
     C* Change type is not D, so create a trade
     C                     ELSE
      *                                                                   082738
     C                     MOVEL*BLANK    Z#BSTS                          082738
     C*
     C* An active record must not exist
     C           @BTDRF    CHAINTRADSDF              01
     C**N01******RECI      COMP 'C'                  1212                 E28748
     C  N01      RECI      COMP '*'                  1212                 E28748
      *
      ** Also check if trade extension is existing                                            201192
     C********** @BTDRF    CHAINTRADSDD1             05                                201192 213066
     C           @BTDRF    CHAINTRADSDD1             03                                       213066
     C*
     C           *IN12     IFEQ '1'
     C                     MOVEL@ER,8     @ERRTX
     C                     MOVEL@BTDRF    @ETF8
     C                     ELSE
      *                                                                   S01401
      **  If MT5xx present perform subroutine TRD1Z2 to check if the      S01401
      **  corresponding extention records on TRADSDX1 & TRADSDX2 exist.   S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C                     EXSR TRD1Z2                                    S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP11                                           S01408
     C*                                                                   S01408
     C                     MOVEL@TRDDS    OTRDDS                                              CSD015
     C                     CLEAR@TRDDS                                                        233607
     C                     MOVEL@BLKDS    @TRDDS
      *                                                                   187727
      ** As BULKTD donot have the same structure as TRADSD                187727
      ** therefore need to initialise the following field because of      187727
      ** corruption.                                                      187727
      *                                                                   187727
     C                     MOVE *BLANK    COAF                            187727
     C                     MOVE *BLANKS   FRNT                            187727
     C                     MOVEASTAMP,1   TMST                                                233607
      *                                                                   S01401
      **  If MT5xx present move details from BULKSDX1 & BULKSDX2 to       S01401
      **  TRADSDX1 & TRADSDX2 respectively.                               S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C**********           MOVELWBLKY1    WTRDY1                                       S01401 201192
      *                                                                                       201192
      ** Move Bulk ext. 1 fields to trade ext. 1 fields                                       201192
     C                     EXSR SRBULK                                                        201192
     C                     MOVELWTRDY2    OTRDY2                                              CSD015
     C                     MOVELWBLKY2    WTRDY2                          S01401
     C                     ENDIF                                          S01401
     C*                                                                   E21354
     C*       .. if Settlement Method '04'                                E21354
     C*                                                                   E21354
     C           @BSMTH    IFEQ 4                                         E21354
     C*                                                                   E21354
     C**********           Z-ADD@BTCNR    CNUM                                         E21354 CSD027
     C                     MOVE @BTCNR    CNUM                                                CSD027
     C***********          Z-ADDCADC      ACOD                     E21354 S01117
     C                     MOVE BMACCD    ACOD                            S01117
     C                     MOVE @BTDBA    BRCA                            S01117
     C***********MBIN      IFEQ 'N'                                E21354 S01117
     C                     Z-ADD1         ACSQ                            E21354
     C***********          ELSE                                           E21354
     C***********          MOVEL*BLANKS   KEY12  12                       E21354
     C***********@BTDTP    IFEQ 'TP'                                      E21354
     C***********          MOVE @BPYFB    KEY12                           E21354
     C***********          ELSE                                           E21354
     C***********          MOVE @BPYTB    KEY12                           E21354
     C***********          END                                            E21354
     C***********          MOVEL'10'      KEY12                           E21354
     C***********KEY12     CHAINTABLETRF             44                   E21354
     C***********          Z-ADDNSACS     ACSQ                            E21354
     C***********          END                                            E21354
     C**********           MOVELACOD      WCOSQ   6                                    E21354 CGL029
     C**********           MOVE ACSQ      WCOSQ                                        E21354 CGL029
     C**********           MOVELCNUM      WPRAC  12                                    E21354 CGL029
     C**********           MOVE WCOSQ     WPRAC                                        E21354 CGL029
     C                     MOVELACOD      WCOSQ  12                                           CGL029
     C                     MOVE ACSQ      WCOSQ                                               CGL029
     C                     MOVELCNUM      WPRAC  18                                           CGL029
     C                     MOVE WCOSQ     WPRAC                                               CGL029
     C*                                                                   E21354
     C* Prepare account for writing to TRADS                              E21354
     C           @BTDTP    IFEQ 'TP'                                      E21354
     C                     MOVE WPRAC     PYFM                            E21354
     C                     ELSE                                           E21354
     C                     MOVE WPRAC     PAYT                            E21353
     C                     END                                            E21354
     C                     END                                            E21354
     C*
     C* IF TRADE BASIS ON SECURITY NOT D OR Y SET PRICE TO PR/Y/DIS
     C*
     C           STBS      IFNE 'D'
     C           STBS      ANDNE'Y'
     C                     Z-ADDTPDY      PRIC
     C                     Z-ADDTPDY      @BPRIC
     C                     END
     C*
     C                     Z-ADDRALL      WDRALL
     C*
     C*   . if Discount
     C           STBS      IFEQ 'D'
     C           RALL      ANDNE0
     C                     Z-ADDTDVD      ZSDATE
     C                     Z-ADDMATY      ZEDATE
     C**********           EXSR ZNCD
     C                     EXSR ZDAYS
     C                     Z-ADDZDDAYS    #DDAYS  50
     C                     EXSR ZDYYR
     C           ZINTDD    IFNE 0
     C           RALL      MULT #DDAYS    WPRICE
     C           WPRICE    DIV  ZINTDD    WCRALL    H
     C*
     C           WCRALL    IFGE 0
     C           1         SUB  WCRALL    WDRALL 158
     C                     ELSE
     C                     Z-SUBWCRALL    WCRALL 158
     C           1         SUB  WCRALL    WDRALL
     C                     Z-SUBWDRALL    WDRALL
     C                     END
     C*
     C                     ELSE
     C                     Z-ADD*ZEROS    WDRALL
     C                     END
     C                     END
     C*
     C*     . Check signs for Charges/Commission
     C*
     C           @C1DI     IFEQ 'M'
     C           TDTP      ANDEQ'TS'
     C           @C1DI     OREQ 'S'
     C           TDTP      ANDEQ'TP'
     C           @C1DI     OREQ 'D'
     C           TDTP      ANDEQ'TP'
     C                     Z-SUBTBCA      TBCA
     C                     Z-SUBTCCA      TCCA
     C                     Z-SUBTCA1      TCA1
     C                     Z-SUBTCA2      TCA2
     C                     Z-SUBTCA3      TCA3
     C                     Z-SUBTCA4      TCA4                            S01176
     C                     Z-SUBTCA5      TCA5                            S01176
     C                     Z-SUBTCA6      TCA6                            S01176
     C                     Z-SUBTCA7      TCA7                            S01176
     C                     Z-SUBTAXA      TAXA                            S01176
     C                     Z-SUBBCMR      BCMR                            S01176
     C                     Z-SUBCCMR      CCMR                            S01176
     C                     Z-SUBTXRB      TXRB                            S01176
     C***********          Z-SUBTOCA      TOCA                            S01176
     C***********          Z-SUBTLTA      TLTA                            S01176
     C***********          Z-SUBLTCA      LTCA                            S01176
     C***********          Z-SUBTPCA      TPCA                            S01176
     C***********          Z-SUBTVCA      TVCA                            S01176
     C                     END
     C*
     C*    .. Countervalue
     C***********          MOVE @C1DI     C1DI                            S01117
     C                     Z-ADDNOMDP     ZCDP                            S01117
     C                     MOVE NMCY      NMCYX   3
     C                     MOVE NMCYA     NMCY
     C                     Z-ADDWDRALL    ZWRALL
     C*************        EXSR ZCTRV                                   E21065
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CBD1                                           S01408
     C*                                                                   S01408
     C                     EXSR ZCOTR                                   E21065
      *                                                                   CSE023
     C                     Z-ADD@BWHTX    WHTX                            187727
     C                     MOVE @BBWDI    BWDI                            187727
     C           CGL031    IFEQ 'Y'                                                           233607
     C                     Z-ADD@BFSPR    FSPR                                                233607
     C                     Z-ADD@BFSPP    FSPP                                                233607
     C                     Z-ADD@BEUTX    EUTX                                                234440
     C                     Z-ADD@BEUTS    EUTS                                                234440
     C                     SUB  EUTX      ZCTRVL                                              234440
     C                     ENDIF                                                              233607
     C           CSE023    IFEQ 'Y'                                       CSE023
     C           CRTT      ANDNE*BLANKS                                   CSE023
     C           @BWHTX    ANDEQ*ZEROS                                    CSE023
     C           @BTDTP    IFEQ 'TP'                                      CSE023
     C                     EXSR SUB106                                    CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C           CSE023    IFEQ 'N'                                       CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           @BTDTP    ANDEQ'TS'                                      CSE023
     C                     Z-ADD0         WHTX                            CSE023
     C                     ENDIF                                          CSE023
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CBD2                                           S01408
     C*                                                                   S01408
     C                     MOVE NMCYX     NMCY
     C                     Z-ADDZCTRVL    WCVAL  150
     C                     Z-ADDZCTRVL    TCTR
     C*
     C*    .. Consideration
     C                     Z-ADDZCONS     TCSR
     C*
     C* Set date made complete if trade is complete
     C           @BTINC    IFEQ 'C'
     C                     Z-ADDRUND      TDMC
     C                     END
      *                                                                                       CAS006
     C           CAS006    IFEQ 'Y'                                                           CAS006
     C                     Z-ADD@BCRSK    CRSK                                                CAS006
     C                     Z-ADD@BLQPR    LQPR                                                CAS006
     C                     Z-ADD@BTINN    TINN                                                CAS006
     C                     Z-ADD@BITRN    ITRN                                                CAS006
     C                     Z-ADD@BPRCN    PRICN                                               CAS006
     C                     ELSE                                                              BUG2606
     C                     Z-ADD*ZERO     CRSK                                               BUG2606
     C                     Z-ADD*ZERO     LQPR                                               BUG2606
     C                     Z-ADD*ZERO     TINN                                               BUG2606
     C                     Z-ADD*ZERO     ITRN                                               BUG2606
     C                     Z-ADD*ZERO     PRICN                                              BUG2606
     C                     ENDIF                                                              CAS006
     C*
     C                     TIME           TIME
     C*
     C                     SETOF                     90
     C*
     C*   Set up outstanding value in settlement currency
     C*   only if the exchange rate is non-zero.
     C           TDER      IFNE 0
     C                     Z-ADDTCTR      ZAMTCI
     C                     Z-ADDTDER      ZEXCH
     C                     MOVE TMDI      ZMD
     C                     MOVE NMCYA     ZCCYI
     C                     MOVE NOMDP     ZCDPI                           S01117
     C                     MOVE SETC      @AJCD                           S01117
     C                     MOVE '*MSG   ' @RTCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD16        @DBASE           ***************S01117
     C                     MOVEL'SDCURRPD'@DBFIL           * DB ERROR 16 *S01117
     C                     MOVEL@AJCD     @DBKEY           ***************S01117
     C                     EXSR SUB999                                    S01117
     C                     END                                            S01117
     C                     MOVE A6NBDP    ZCDPO                           S01117
     C                     MOVE SETC      ZCCYO
     C                     EXSR ZCONV
     C                     ELSE                                           E16827
     C                     Z-ADDTCTR      ZAMTCO                          E16827
     C                     END
     C*
     C           *IN90     IFEQ '1'
     C                     MOVEL@ER,16    @ERRTX
     C***********          MOVELTKEY      @ETF9                        *  S01117
     C                     MOVEL@AJCD     @ETF9                           S01117
     C                     SETOF                     U7U8              *
     C                     SETON                         12            *
     C                     ELSE
     C*
     C                     Z-ADDZAMTCO    TOSV
     C*
      *                                                                   S01269
      * If Trade Authorisation = '00' or user's entering threshold is     S01269
      * greater than the countervalue on the trade then RECI = D.         S01269
      * Else RECI = L                                                     S01269
      *                                                                   S01269
      * Convert countervalue to base currency                             S01269
     C                     EXSR SUB801                                    S01269
      *                                                                   S01269
     C***********AUTT      IFEQ '00'                               S01269 S01117
     C           BVAUTH    IFEQ '00'                                      S01117
     C           ENTL      ORGT CTCTR                                     S01269
     C                     MOVEL'D'       RECI                            S01269
      *                                                                                     AR584890
      ** Update T1SCMG in TRADSDD1  to generate messages                                    AR584890
      *                                                                                     AR584890
     C                     MOVEL'Y'       T1SCMG                                            AR584890
     C                     ELSE                                           S01269
     C                     MOVEL'L'       RECI                            S01269
     C                     END                                            S01269
      *                                                                   S01269
     C*
     C                     MOVEL'I'       CHTP
     C                     MOVEL'Y'       BCON
     C                     MOVEL'Y'       TCFR
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDRUND      LCD
      *                                                                   136759
      ** Set Conf Generated Ind (T1CONG) to 'N'                           136759
      *                                                                   136759
     C                     MOVEL'N'       T1CONG                          136759
     C*
      ** For Midas Compliance Watch which is active and watch list checking applied,          CSD015
      ** perform compliance watch processing if 24x7 is off OR if switch on, must             CSD015
      ** be in the main system                                                                CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'N'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
      *                                                                                       CSD015
      ** If INSERT mode                                                                       CSD015
     C           *IN01     IFEQ '1'                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ELSE                                                               CSD015
      * If AMEND mode                                                                         CSD015
     C                     MOVE 'TRADSD  'WFUNT                                               CSD015
     C                     MOVE *BLANK    WIDEN                                               CSD015
     C                     MOVE TDRF      WIDEN                                               CSD015
     C           CWHTKY    CHAINSDCWHTL1             36                                       CSD015
      *                                                                                       CSD015
      ** If record found and unconfirmed status                                               CSD015
      *                                                                                       CSD015
     C           *IN36     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
     C           *IN36     OREQ *ON                                                           CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      *                                                                   S01401
      ** If MT5xx present, try to update TRADSDX1 & TRADSDX2.             S01401
      *                                                                   S01401
     C           S01401    IFEQ 'Y'                                       S01401
     C********** *IN01     IFEQ *OFF                                                   S01401 201192
     C********** *IN05     IFEQ *OFF                                                   201192 213066
     C           *IN03     IFEQ *OFF                                                          213066
     C                     UPDATTRADSDD1                                  S01401
     C           WTRDY2    IFNE *BLANKS                                   076604
     C                     UPDATTRADSDD2                                  S01401
     C                     ENDIF                                          076604
     C                     ELSE                                           S01401
     C                     MOVEASTAMP,1   T1TMST                                             BUG2606
     C                     WRITETRADSDD1                                  S01401
      *                                                                   S01401
      **  Output to TRADSDY2 only if there are details to output. The     S01401
      **  same should occur for TRADSDY1, but TRADSDY1 is mandatory so    S01401
      **  this check is not needed for TRADSDY1.                          S01401
     C           WTRDY2    IFNE *BLANKS                                   S01401
     C                     MOVEASTAMP,1   T2TMST                                             BUG2606
     C                     WRITETRADSDD2                                  S01401
     C**********           ENDIF                                                     S01401 AR630707
      *                                                                   S01401
      ** Insert second TRADSDX2 record                                                      AR597791
      *                                                                                     AR597791
     C                     MOVEL@BTDRF    T2TDRF                                            AR597791
     C                     MOVEASTAMP,1   T2TMST                                            AR597791
     C           CSW003    IFEQ 'Y'                                                         AR597791
     C           BFCLAS    IFEQ 'S'                                                         AR597791
     C           BFCLAS    OREQ 'D'                                                         AR597791
     C                     MOVEL'B'       T2WHEN                                            AR597791
     C                     WRITETRADSDD2                                                    AR597791
     C                     ENDIF                                                            AR597791
     C                     ENDIF                                                            AR597791
      *                                                                                     AR597791
     C                     ENDIF                                                            AR630707
     C                     ENDIF                                          S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
      **  Initialise PB Order Number to avoid decimal data error.         CSE006
     C                     Z-ADD*ZEROS    ORDE                            CSE006
      *                                                                   CSE006
     C/COPY WNCPYSRC,SE3003C023
     C           *IN01     IFEQ '0'
     C                     UPDATTRADSDF
     C                     ELSE
      *                                                                                       CAS006
     C                     MOVE *BLANKS   FRNT                                                CAS006
     C                     MOVE *BLANKS   AFRT                                                CAS006
     C                     MOVE *BLANKS   REPA                                                CAS006
     C                     MOVEASTAMP,1   WTMST                                               CAS006
      *                                                                                       CAS006
     C                     WRITETRADSDF
      *                                                                                     AR596783
      ** Populate record to Trade Details Extension File                                    AR596783
      *                                                                                     AR596783
     C           CER049    IFEQ 'Y'                                                         AR871625
     C                     MOVE TDRF      TQTDRF                                            AR596783
     C                     MOVE TDBA      TQTDBA                                            AR596783
     C           TQTDRF    CHAINTRADSQL0             01                                     AR871625
     C           *IN01     IFEQ '1'                                                         AR871625
     C                     WRITETRADSQD0                                                    AR596783
     C                     ENDIF                                                            AR871625
     C                     ENDIF                                                            AR871625
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP14                                           S01408
     C*                                                                   S01408
     C                     END
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C           BVAUTH    IFEQ '00'                                                          CRE020
     C           ENTL      ORGT CTCTR                                                         CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
     C                     ENDIF                                                              CRE020
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP18                                           S01408
     C*                                                                   S01408
      ** Check if record exist on extension file otherwise create it with                     CER001
      ** deafult values                                                                       CER001
      *                                                                                       CER001
     C           ULX004    IFEQ 'Y'                                                           CER001
     C           ULX008    OREQ 'Y'                                                           CER001
     C                     MOVE @BTDRF    WWREFE  6                                           CER001
     C           WWREFE    CHAINBULKTDD6             84                                       CER001
     C           *IN84     IFEQ *OFF                                                          CER001
     C                     Z-ADDCCAGSD    WWAGSD  50                                          CER001
     C                     TIME           CCTIME                                              CER001
     C                     WRITETRADSDD6                                                      CER001
     C                     ELSE                                                               CER001
     C           WWAGSD    IFNE 0                                                             CER001
     C           @CAGT     ANDEQ'Y'                                                           CER001
     C                     Z-ADDWWAGSD    CCAGSD                                              CER001
     C                     ELSE                                                               CER001
     C                     Z-ADDTDVD      CCAGSD                                              CER001
     C                     ENDIF                                                              CER001
     C                     MOVE WWREFE    CCTDRF                                              CER001
     C                     TIME           CCTIME                                              CER001
     C                     WRITEBULKTDD6                                                      CER001
     C                     WRITETRADSDD6                                                      CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                   082738
     C                     MOVEL@TRDDS    Z#ASTS                          082738
     C*
     C/COPY WNCPYSRC,SE3003C004
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR                           SUB300 ends
     C*****************************************************************                       201192
      /EJECT                                                                                  201192
     C*****************************************************************                       201192
      *                                                               *                       201192
      *  SRBULK - Move Bulk ext. 1 fields to trade ext. 1 fields      *                       201192
      *                                                               *                       201192
      *****************************************************************                       201192
     C           SRBULK    BEGSR                                                              201192
      *                                                                                       201192
     C                     MOVELB1TDRF    T1TDRF                                              201192
     C                     MOVELB1CONG    T1CONG                                              201192
     C                     MOVELB1RCDG    T1RCDG                                              201192
     C                     MOVELB1LSWS    T1LSWS                                              201192
     C                     MOVELB1LSSC    T1LSSC                                              201192
     C                     MOVELB1GMES    T1GMES                                              201192
     C                     MOVELB1INST    T1INST                                              201192
     C                     MOVELB1INSS    T1INSS                                              201192
     C                     MOVELB1EUCL    T1EUCL                                              201192
     C                     MOVELB1SAFA    T1SAFA                                              201192
     C                     MOVELB1RPTY    T1RPTY                                              201192
     C                     MOVELB1GMEC    T1GMEC                                              201192
     C                     MOVELB1FID1    T1FID1                                              201192
     C                     MOVELB1CCID    T1CCID                                              201192
     C                     MOVELB1TRTT    T1TRTT                                              201192
     C                     MOVELB1GDEL    T1GDEL                                              201192
     C                     MOVELB1FCOD    T1FCOD                                              201192
     C                     MOVELB1FTID    T1FTID                                              201192
     C                     MOVELB1SROL    T1SROL                                              201192
     C                     MOVELB1SCMG    T1SCMG                                              201192
     C                     MOVELB1WHEN    T1WHEN                                              201192
     C                     MOVELB1SIOR    T1SIOR                                              201192
     C                     MOVELB1NEW     T1NEW                                               201192
     C                     MOVELB1STMP    T1STMP                                              201192
     C                     MOVELB1CHID    T1CHID                                              201192
     C                     MOVELB1TRRM    T1TRRM                                              201192
      *                                                                                       201192
     C                     MOVEL*BLANKS   T1FRNT                                              201192
     C                     MOVEL*BLANKS   T1AFRT                                              201192
     C                     MOVEL*BLANKS   T1REPA                                              201192
     C                     MOVEASTAMP,1   T1TMST                                              201192
      *                                                                                       201192
     C                     ENDSR                                                              201192
     C*                                                                   S01176
     C*****************************************************************
      ***/EJECT*****                                                      E36791
     C*****************************************************************   E36791
     C***********                                                     *   E36791
     C*****Subroutine-*SUB400******************************************   E36791
     C*****Determine*next*coupon*date*for*purchase*interest*calcs******   E36791
     C***********                                                     *   E36791
     C***********                                                     *   E36791
     C****INPUT*-*CD*array*-*Coupon*dates*-*SECTYD*security*file*******   E36791
     C************CR*array*-*Rate/payt*inds*-*SECTYD*security*file*****   E36791
     C************FCPN*-*First*coupon*date*-*SECTYD*security*file******   E36791
     C************MATY*-*Maturity*date*-*SECTYD*security*file**********   E36791
     C************ECD*-*Event*control*date*-*ZEVCD*process*************   E36791
     C*************IN98*-*Date*format*-*from*TABTB10*record*via*ZSYSTM*   E36791
     C***********                                                     *   E36791
     C****OUTPUT*-*NCD*(5,0)*-*Next*coupon*date************************   E36791
     C***********                                                     *   E36791
     C****CALLS**-*ZDATE1**********************************************   E36791
     C*************ZDATE2**********************************************   E36791
     C***********                                                     *   E36791
     C*****************************************************************   E36791
     C***********SUB400    BEGSR                                          E36791
     C***********                                                         E36791
     C**Call*ZDATE2*to*obtain*MMDD*for*start*date*of*interest*************E36791
     C***********          Z-ADD@WPDAT    ZDAYNO                          E36791
     C***********          EXSR ZDATE2                                    E36791
     C***********          MOVELZDATE     ZZPDD4  40                      E36791
     C************IN98     IFEQ '0'                                       E36791
     C***********          MOVELZZPDD4    ZZWRKD                          E36791
     C***********          MOVE ZZPDD4    ZZWRKM                          E36791
     C***********          Z-ADDZZWRKD    ZZPDD4                          E36791
     C***********          MOVELZZWRKM    ZZPDD4                          E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C**If*date*format*is*DDMMYY*turn*round*array*of*coupon*dates*********E36791
     C****to*MMDD*********************************************************E36791
     C************IN98     IFEQ '0'                                       E36791
     C***********          DO   12        X       20                      E36791
     C***********          MOVE CD,X      ZZWRKM  20                      E36791
     C***********          MOVELCD,X      ZZWRKD  20                      E36791
     C***********          Z-ADDZZWRKD    CD,X                            E36791
     C***********          MOVELZZWRKM    CD,X                            E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C**Get*year*for*ECD**************************************************E36791
     C***********          MOVE ZDATE     ZECDYR  20                      E36791
     C***********                                                         E36791
     C**Find*next*coupon*date*from*arrays*-*******************************E36791
     C***If*RATE/PAYT*inds*all*blank*NCD*=*Maturity*date******************E36791
     C***********          Z-ADDMATY      NCD     50                      E36791
     C***********CRDS      IFNE *BLANKS                                   E36791
     C***********                                                         E36791
     C***If*RATE/PAYT*inds*not*all*blank*-********************************E36791
     C*****search*for*next*highest*coupon*>*start*date*of*interest********E36791
     C***********          MOVE '0'       ZFOUND  1                       E36791
     C***********          DO   12        X                               E36791
     C***********CR,X      IFEQ 'P'                                       E36791
     C***********CR,X      OREQ 'C'                                       E36791
     C***********ZZPDD4    IFLT CD,X                                      E36791
     C***********          MOVE '1'       ZFOUND                          E36791
     C***********          GOTO CNCD00                                    E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C*******Found*-*add*ECD'S*YY*to*form*date****************************E36791
     C***********CNCD00    TAG                             CNCD00 TAG     E36791
     C***********ZFOUND    IFEQ '1'                                       E36791
     C***********          Z-ADDZECDYR    ZDATE                           E36791
     C***********          MOVELCD,X      ZDATE                           E36791
     C***********                                                         E36791
     C*******Not*found*-*use*first*coupon*********************************E36791
     C*******************add*next*year's*YY*to*form*date******************E36791
     C***********          ELSE                                           E36791
     C***********          DO   12        X                               E36791
     C***********CR,X      IFEQ 'P'                                       E36791
     C***********CR,X      OREQ 'C'                                       E36791
     C***********          Z-ADDZECDYR    ZDATE                           E36791
     C***********          ADD  1         ZDATE                           E36791
     C***********          MOVELCD,X      ZDATE                           E36791
     C***********          MOVE '1'       ZFOUND                          E36791
     C***********          GOTO CNCD01                                    E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********CNCD01    TAG                             CNCD01 TAG     E36791
     C***********                                                         E36791
     C**Convert*date*to*day*no*using*ZDATE1*******************************E36791
     C**(Not*done*if*no*RATE/PAYT*ind*is*P*or*C)**************************E36791
     C**If*DDMMYY*format*turn*round*to*MMDDYY*****************************E36791
     C***********ZFOUND    IFEQ '1'                                       E36791
     C************IN98     IFEQ '0'                                       E36791
     C***********          MOVELZDATE     ZZWRK   40                      E36791
     C***********          MOVE ZZWRK     ZZWRKM                          E36791
     C***********          MOVELZZWRK     ZZWRKD                          E36791
     C***********          Z-ADDZZWRKD    ZZWRK                           E36791
     C***********          MOVELZZWRKM    ZZWRK                           E36791
     C***********          MOVELZZWRK     ZDATE                           E36791
     C***********          END                                            E36791
     C***********          EXSR ZDATE1                                    E36791
     C***********          Z-ADDZDAYNO    NCD                             E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C**If*NCD*>*maturity*date*,*reset*NCD*=*maturity*date****************E36791
     C***********NCD       IFGT MATY                                      E36791
     C***********          Z-ADDMATY      NCD                             E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C**If*NCD*<*1st*coupon*date*,*reset*NCD*=*1st*coupon*date************E36791
     C***********NCD       IFLT FCPN                                      E36791
     C***********          Z-ADDFCPN      NCD                             E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C**If*date*format*is*DDMMYY*turn*back*array*of*coupon*dates**********E36791
     C***to*DDMM**********************************************************E36791
     C************IN98     IFEQ '0'                                       E36791
     C***********          DO   12        X       20                      E36791
     C***********          MOVELCD,X      ZZWRKM  20                      E36791
     C***********          MOVE CD,X      ZZWRKD  20                      E36791
     C***********          Z-ADDZZWRKM    CD,X                            E36791
     C***********          MOVELZZWRKD    CD,X                            E36791
     C***********          END                                            E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********          ENDSR                           SUB400 ends    E36791
     C***********                                                   S01176E36791
     C********************************************************************E36791
      ***/EJECT******                                                     E36791
     C********************************************************************E36791
     C***SUB401*-*Sub*routine*to*calculate*the*interest*accrued***********E36791
     C**********adjustment*on*a*Trade*************************************E36791
     C********************************************************************E36791
     C***********SUB401    BEGSR                                          E36791
     C***********                                                         E36791
     C**Calculate*interest*adjustment*:-**********************************E36791
     C*****Nominal*amount*X*Current*coupon*X*Days*adjustment**************E36791
     C*****-------------------------------------------------**************E36791
     C*****************Days*in*interest*year*X*100************************E36791
     C***********                                                         E36791
     C***********NOMDP     SUB  NMDP      DEP     10                      E36791
     C***********          ADD  5         DEP                             E36791
     C***********@BNOML    MULT POWER8,DEPWNOML  150                      E36791
     C***********WNOML     DIV  100       ZWMLT  154                      E20196
     C***********WNOML     DIV  100       ZWMLT                     E20196E36791
     C***********          MULT @BDADJ    ZWMLT                           E36791
     C***********                                                         E36791
     C***********          MULT IRATE     ZWMLT     H                     E36791
     C***********ZINTDD    IFEQ 0                                         E36791
     C***********          Z-ADD0         WPADJ                           E36791
     C***********          ELSE                                           E36791
     C***********ZWMLT     DIV  ZINTDD    WPADJ  150H                     E36791
     C***********          END                                            E36791
     C***********                                                         E36791
     C***********                                                         E36791
     C***********          ENDSR                           SUB401 ends    E36791
     C***********                                                   S01176E36791
     C**************************************************************S01176E36791
      /EJECT                                                              S01176
      *****************************************************************   CSE006
      *    BSPOS  - Update Buy-Sell Backs Position file if required   *   CSE006
      *                                                               *   CSE006
      *    Called By : SUB201                                         *   CSE006
      *    Calls     : NONE                                           *   CSE006
      *                                                               *   CSE006
      *    Condition of entry : Buy-Sell Back flag is 'Y'             *   CSE006
      *****************************************************************   CSE006
      *                                                                   CSE006
     C           BSPOS     BEGSR                                          CSE006
      *                                                                   CSE006
      * Set up fields dependent on which trade is first                   CSE006
     C                     Z-ADDA#TDVD    BSVD1                           CSE006
     C                     Z-ADD@BTDVD    BSVD2                           CSE006
     C                     MOVELA#TDRF    BSPRF                           CSE006
      *                                                                   CSE006
      * Set up fields common to both trades                               CSE006
     C                     MOVEL'D'       BSRECI                          CSE006
     C                     MOVEL@BTDBA    BSBCH                           CSE006
     C                     MOVEL@BTDBK    BSBOK                           CSE006
     C                     MOVEL@BTDSS    BSSEN                           CSE006
     C                     Z-ADD*ZEROS    BSPL                            CSE006
     C                     Z-ADD*ZEROS    BSOPL                           CSE006
     C                     Z-ADD*ZEROS    BSAPL                           CSE006
     C                     Z-ADD*ZEROS    BSLATD                          CSE006
     C                     Z-ADD@BTDDT    BSTD1                           CSE006
     C                     Z-ADD@BTDDT    BSTD2                           CSE006
      *                                                                   CSE006
      * Write transaction to Buy-Sell Positions file                      CSE006
     C                     WRITEBSPOSD0                                   CSE006
      *                                                                   CSE006
     C                     ENDSR                                          CSE006
      *                                                                   CSE006
     C*****************************************************************   CSE006
      /EJECT                                                              CSE006
     C*****************************************************************   S01176
     C*    SUB403 - Determine Default Charge/Commission Codes         *   S01176
     C*             and Rebate Percentage                             *   S01176
     C*                                                               *   S01176
     C*    Called By : SUB100                                         *   S01176
     C*    Calls     : NONE                                           *   S01176
     C*                                                               *   S01176
     C*    Condition of entry : Autocharges set on                    *   S01176
     C*****************************************************************   S01176
     C*                                                                   S01176
     C           SUB403    BEGSR                           *** SUB403  ***S01176
     C*                                                                   S01176
     C***  Only process if all codes are blank                            S01176
     C*                                                                   S01176
     C           @BTBCC    IFEQ *BLANKS                                   S01176
     C           @BTCCC    ANDEQ*BLANKS                                   S01176
     C           @BTCC1    ANDEQ*BLANKS                                   S01176
     C           @BTCC2    ANDEQ*BLANKS                                   S01176
     C*                                                                   S01176
     C***  Initialise Commission Rebate Percentage                        S01176
     C*                                                                   S01176
     C                     Z-ADD0         @CMRP   53                      S01176
     C*                                                                   S01176
     C***  Set off 'defaults found' flag                                  S01176
     C*                                                                   S01176
     C                     SETOF                     04                   S01176
     C*                                                                   S01176
     C***  Initialise Ind. 14. default charge code found                  S01176
     C*                                                                   S01176
     C                     SETOF                     14                   S01176
     C*                                                                   S01176
     C***  Set up key fields                                              S01176
     C*                                                                   S01176
     C                     MOVE @C1DI     @KC1DI                          S01176
     C                     MOVE BFTDCG    @KCLGR                          S01496
     C                     MOVE SITP      @KSITP                          S01176
     C                     MOVE SMCC      @KMRKT                          S01176
     C**********           Z-ADD@BTCNR    @KCNUM                                       S01176 CSD027
     C                     MOVE @BTCNR    @KCNUM                                              CSD027
     C*                                                                   S01176
     C* Access customer/broker defaults file,                             S01176
     C*  set on flag if record found                                      S01176
     C*                                                                   S01176
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP15                                           S01408
     C*                                                                   S01408
     C           S01496    IFNE 'Y'                                       S01496
     C           BVACOP    ORNE 'Y'                                       S01496
     C           @KEY3     CHAINCUBRD                01                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     SETON                     04                   S01176
     C*                                                                   S01176
     C***  ELSE, Record not found on LF/CUBRD, chain to LF/CUBRD          S01176
     C***  again with a Customer Number of zero.                          S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C**********           Z-ADD0         @KCNUM                                       S01176 CSD027
     C                     MOVE *BLANKS   @KCNUM                                              CSD027
     C           @KEY3     CHAINCUBRD                01                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     SETON                     04                   S01176
     C*                                                                   S01176
     C***  ELSE, If record not found, chain to LF/CUBRD again with        S01176
     C***  a blank Market Centre                                          S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     MOVE *BLANKS   @KMRKT                          S01176
     C           @KEY3     CHAINCUBRD                01                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     SETON                     04                   S01176
     C*                                                                   S01176
     C***  If record not found, chain to LF/CUBRD again with              S01176
     C***  a blank Investment Type                                        S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     MOVE *BLANKS   @KSITP                          S01176
     C           @KEY3     CHAINCUBRD                01                   S01176
     C           *IN01     IFEQ '0'                                       S01176
     C           RECI      ANDEQ'D'                                       S01176
     C                     SETON                     04                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01496
     C                     ELSE                                           S01496
     C           @KEY3A    CHAINSECUBRL0             01                   S01496
     C           *IN01     IFEQ '0'                                       S01496
     C           RECI      ANDEQ'D'                                       S01496
     C                     SETON                     04                   S01496
     C*                                                                   S01496
     C***  ELSE, Record not found on LF/SECUBRL0, chain to LF/SECUBRL0    S01496
     C***  again with only first three priorities.                        S01496
     C                     ELSE                                           S01496
     C                     MOVELBVPCSD    PCSD    10                      S01496
     C                     MOVELBVPIDF    PIDF    10                      S01496
     C                     MOVELBVPMDF    PMDF    10                      S01496
     C                     MOVELBVPOCD    POCD    10                      S01496
     C*                                                                   S01496
     C                     EXSR SUB4A                                     S01496
     C           @KEY3A    CHAINSECUBRL0             01                   S01496
     C           *IN01     IFEQ '0'                                       S01496
     C           RECI      ANDEQ'D'                                       S01496
     C                     SETON                     04                   S01496
     C*                                                                   S01496
     C***  ELSE, If record not found, chain to LF/SECUBRL0 again with     S01496
     C***  only the first two priorities.                                 S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C                     EXSR SUB4A                                     S01496
     C           @KEY3A    CHAINSECUBRL0             01                   S01496
     C           *IN01     IFEQ '0'                                       S01496
     C           RECI      ANDEQ'D'                                       S01496
     C                     SETON                     04                   S01496
     C*                                                                   S01496
     C***  If record not found, chain to LF/SECUBRL0 again with           S01496
     C***  only first priority                                            S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C                     EXSR SUB4A                                     S01496
     C           @KEY3A    CHAINSECUBRL0             01                   S01496
     C           *IN01     IFEQ '0'                                       S01496
     C           RECI      ANDEQ'D'                                       S01496
     C                     SETON                     04                   S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP16                                           S01408
     C*                                                                   S01408
     C*                                                                   S01176
     C***  If default found, update values on the Bulk Record             S01176
     C*                                                                   S01176
     C           *IN04     IFEQ '1'                                       S01176
     C                     MOVE TBCC      @BTBCC                          S01176
     C                     MOVE TCCC      @BTCCC                          S01176
     C                     MOVE DCC1      @BTCC1                          S01176
     C                     MOVE DCC2      @BTCC2                          S01176
     C                     Z-ADDCMRP      @CMRP                           S01176
     C                     END                                            S01176
     C*                                                                   S01448
     C***  If switchable feature Bulk Input Enhancements is on            S01448
     C***  change conditioning of client agency trade as customer         S01448
     C***  on the 'M' side of the trade can be a portfolio client         S01448
     C*                                                                   S01448
     C           S01448    IFEQ 'Y'                                       S01448
     C*                                                                   S01448
     C***  If Broker Commission Code is still blank, and this is          S01448
     C***  a Client Agency Trade but not a cross agency trade then        S01448
     C***  use the default from ICD.                                      S01448
     C*                                                                   S01448
     C           @BTBCC    IFEQ *BLANK                                    S01448
     C           @CAGT     ANDNE'Y'                                       S01448
     C           @BATRD    ANDEQ'C'                                       S01448
     C                     MOVE BVDBCD    @BTBCC                          S01448
     C                     END                                            S01448
     C*                                                                   S01448
     C***  Check default assigned. If it does not exist on LF/SECGT,      S01448
     C***  then blank it out                                              S01448
     C*                                                                   S01448
     C           @BTBCC    IFNE *BLANK                                    S01448
     C                     MOVE @BTBCC    @XCODE                          S01448
     C           @KEY4     CHAINSECGT                01                   S01448
     C           *IN01     IFEQ '1'                                       S01448
     C           RECI      ORNE 'D'                                       S01448
     C                     MOVE *BLANKS   @BTBCC                          S01448
     C                     ELSE                                           S01448
     C                     SETON                     14                   S01448
     C                     END                                            S01448
     C                     END                                            S01448
     C*                                                                   S01448
     C***  If Client is a Market Client, blank out Customer               S01448
     C***  Commission Code                                                S01448
     C*                                                                   S01448
     C           @C1DI     IFNE 'S'                                       S01448
     C           @C1DI     ANDNE'D'                                       S01448
     C                     MOVE *BLANKS   @BTCCC                          S01448
     C                     END                                            S01448
     C*                                                                   S01448
     C*** Otherwise if S01448 is not on, processing as before             S01448
     C*                                                                   S01448
     C                     ELSE                                           S01448
     C*                                                                   S01176
     C***  If Broker Commission Code is still blank, and this is          S01176
     C***  a Client Agency Trade, then use default from ICD               S01176
     C*                                                                   S01176
     C           @BTBCC    IFEQ *BLANKS                                   S01176
     C           @BATRD    ANDEQ'C'                                       S01176
     C***********          MOVE DEBC      @BTBCC                   S01176 S01117
     C                     MOVE BVDBCD    @BTBCC                          S01117
     C                     END                                            S01176
     C*                                                                   S01176
     C***  Check default assigned. If it does not exist on LF/SECGT,      S01176
     C***  then blank it out                                              S01176
     C*                                                                   S01176
     C           @BTBCC    IFNE *BLANKS                                   S01176
     C*******    @BATRD    ANDNE'C'                                 S01176S01448
     C                     MOVE @BTBCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   @BTBCC                          S01176
     C                     ELSE                                           S01176
     C                     SETON                     14                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C***  If Client is a Market Client, blank out Customer               S01176
     C***  Commission Code                                                S01176
     C*                                                                   S01176
     C           @BATRD    IFEQ 'M'                                       S01176
     C                     MOVE *BLANKS   @BTCCC                          S01176
     C                     END                                            S01176
     C*                                                                   S01448
     C*** End conditioning for S01448                                     S01448
     C*                                                                   S01448
     C                     END                                            S01448
     C*                                                                   S01176
     C***  Check other defaults assigned.  If they do not appear on       S01176
     C***  LF/SECGT then blank them out.                                  S01176
     C*                                                                   S01176
     C           @BTCCC    IFNE *BLANKS                                   S01176
     C                     MOVE @BTCCC    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   @BTCCC                          S01176
     C                     ELSE                                           S01176
     C                     SETON                     14                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           @BTCC1    IFNE *BLANKS                                   S01176
     C                     MOVE @BTCC1    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   @BTCC1                          S01176
     C                     ELSE                                           S01176
     C                     SETON                     14                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           @BTCC2    IFNE *BLANKS                                   S01176
     C                     MOVE @BTCC2    @XCODE                          S01176
     C           @KEY4     CHAINSECGT                01                   S01176
     C           *IN01     IFEQ '1'                                       S01176
     C           RECI      ORNE 'D'                                       S01176
     C                     MOVE *BLANKS   @BTCC2                          S01176
     C                     ELSE                                           S01176
     C                     SETON                     14                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C           *IN14     IFEQ '1'                                       S01176
     C                     MOVE 'Y'       @DFYN   1                       S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C                     MOVE 'N'       @DFYN                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ENDSR                                          S01176
     C*                                                                   S01176
     C*****************************************************************
      /EJECT                                                              S01496
     C*****************************************************************   S01496
     C*    SUB4A - Determine Highest priority for customer charges    *   S01496
     C*                                                               *   S01496
     C*    Called By : SUB403                                         *   S01496
     C*    Calls     : NONE                                           *   S01496
     C*                                                               *   S01496
     C*    Condition of entry : Autocharges set on                    *   S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C           SUB4A     BEGSR                           *** SUB4A   ***S01496
     C*                                                                   S01496
     C                     MOVEL'N'       CHANGE  1                       S01496
     C           PCSD      IFGT PIDF                                      S01496
     C           PCSD      ANDGTPMDF                                      S01496
     C           PCSD      ANDGTPOCD                                      S01496
     C                     MOVE *BLANKS   @KCLGR                          S01496
     C                     Z-ADD0         PCSD                            S01496
     C                     MOVEL'Y'       CHANGE  1                       S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           PIDF      IFGT PCSD                                      S01496
     C           PIDF      ANDGTPMDF                                      S01496
     C           PIDF      ANDGTPOCD                                      S01496
     C                     MOVE *BLANKS   @KSITP                          S01496
     C                     Z-ADD0         PIDF                            S01496
     C                     MOVEL'Y'       CHANGE  1                       S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           PMDF      IFGT PIDF                                      S01496
     C           PMDF      ANDGTPCSD                                      S01496
     C           PMDF      ANDGTPOCD                                      S01496
     C                     MOVE *BLANKS   @KMRKT                          S01496
     C                     Z-ADD0         PMDF                            S01496
     C                     MOVEL'Y'       CHANGE  1                       S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C           POCD      IFGT PCSD                                      S01496
     C           POCD      ANDGTPMDF                                      S01496
     C           POCD      ANDGTPIDF                                      S01496
     C                     MOVE *BLANKS   @KCNUM                          S01496
     C                     Z-ADD0         POCD                            S01496
     C                     MOVEL'Y'       CHANGE  1                       S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           CHANGE    IFNE 'Y'                                       S01496
     C*                                                                   S01496
     C           PCSD      IFEQ PIDF                                      S01496
     C           PCSD      OREQ PMDF                                      S01496
     C           PCSD      OREQ POCD                                      S01496
     C*                                                                   S01496
     C           PCSD      IFEQ PIDF                                      S01496
     C                     MOVE *BLANKS   @KSITP                          S01496
     C                     Z-ADD0         PIDF                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PCSD      IFEQ PMDF                                      S01496
     C                     MOVE *BLANKS   @KMRKT                          S01496
     C                     Z-ADD0         PMDF                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PCSD      IFEQ POCD                                      S01496
     C                     MOVE *BLANKS   @KCNUM                          S01496
     C                     Z-ADD0         POCD                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     MOVE *BLANKS   @KCLGR                          S01496
     C                     Z-ADD0         PCSD                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PIDF      IFEQ PMDF                                      S01496
     C           PIDF      OREQ POCD                                      S01496
     C*                                                                   S01496
     C           PIDF      IFEQ PMDF                                      S01496
     C                     MOVE *BLANKS   @KMRKT                          S01496
     C                     Z-ADD0         PMDF                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PIDF      IFEQ POCD                                      S01496
     C                     MOVE *BLANKS   @KCNUM                          S01496
     C                     Z-ADD0         POCD                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     MOVE *BLANKS   @KSITP                          S01496
     C                     Z-ADD0         PIDF                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C           PMDF      IFEQ POCD                                      S01496
     C                     MOVE *BLANKS   @KCNUM                          S01496
     C                     Z-ADD0         POCD                            S01496
     C                     MOVE *BLANKS   @KMRKT                          S01496
     C                     Z-ADD0         PMDF                            S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
      /EJECT
     C*****************************************************************
     C***SUB500*-*Sub-routine*to*update*Client*details*****************   S01117
     C*****************************************************************   S01117
     C***********SUB500    BEGSR                                          S01117
     C***********                                                         S01117
     C***********          SETOF                     14                   S01117
     C***********@BTCNR    CHAINCLINTSEF             12                   S01117
     C**N12******RECI      COMP '*'                      14               S01117
     C***********                                                         S01117
     C************IN12     IFEQ '1'                                       S01117
     C************IN14     OREQ '1'                                       S01117
     C***********          MOVEL@ER,1     @ERRTX                          S01117
     C***********          MOVEL@BTCNR    @ETF1                           S01117
     C***14******          EXCPTRELCSE                                    S01117
     C***14******          SETON                     12                   S01117
     C***********          ELSE                                           S01117
     C**********           Z-ADDRUND      LCD
     C**********           MOVE 'A'       CHTP
     C***********          Z-ADDNATN      TNLU                            S01117
     C***********          ADD  @COUNT    C1CN                            S01117
     C***********@BCHTP    IFEQ 'I'                                       S01117
     C***********          ADD  1         C1CN                            S01117
     C***********          ELSE                                           S01117
     C***********          SUB  1         C1CN                            S01117
     C***********          END                                            S01117
     C**N12******          UPDATCLINTSEF                                  S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********          ENDSR                           SUB500 ends    S01117
     C***********                                                         S01117
      **/EJECT***                                                         S01117
     C*********************************************************
     C***SUB501*-*Sub*routine*to*update*projected*Nostro*details***       E17739
     C*********************************************************
     C***********SUB501    BEGSR                                          E17739
     C***********                                                         E17739
     C***********@BSMTH    IFEQ 1                                         E17739
     C***********@BSMTH    OREQ 2                                         E17739
     C***********@BSMTH    OREQ 7                                         E17739
     C***********@BSMTH    OREQ 8                                         E17739
     C***********@BSMTH    OREQ 12                                        E17739
     C***********                                                         E17739
     C****Get*Countervalue*of*trade*when*deletions***                     E17739
     C***********@BCHTP    IFEQ 'D'                                       E17739
     C***********          MOVE NMCY      NMCYX   3                       E17739
     C****SET*UP*NMCY*FIELD*WITH*SECURITY*NOMINAL*CURRENCY***             E17739
     C***********          MOVE NMCYA     NMCY                            E17739
     C***********          Z-ADDWDRALL    ZWRALL                          E17739
     C***********          Z-ADDCFCT      ZCFCT                           E17739
     C***********          EXSR ZCTRV                                     E17739
     C***********          MOVE NMCYX     NMCY                            E17739
     C***********          Z-ADDZCTRVL    WCVAL  150                      E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C**Access*nostro*details*according*to*trade*type***                  E17739
     C***********@BTDTP    IFEQ 'TP'                                      E17739
     C***********          MOVEL@BPYFM    NOSN                            E17739
     C***********          ELSE                                           E17739
     C***********          MOVEL@BPAYT    NOSN                            E17739
     C***********          END                                            E17739
     C***********          MOVEL@BSETC    CCY                             E17739
     C***********@KEYH     CHAINPRONOPNF             01                   E17739
     C***********                                                         E17739
     C************IN01     IFEQ '1'                                       E17739
     C***********RECI      OREQ '*'                                       E17739
     C***********          Z-ADD0         NOSN                            E17739
     C***********@KEYH     CHAINPRONOPNF             01                   E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C************IN01     IFEQ '0'                                       E17739
     C***********RECI      ANDNE'*'                                       E17739
     C***********                                                         E17739
     C***********          MOVEAPNB       ANB                             E17739
     C***********          MOVEAPND       AND                             E17739
     C***********                                                         E17739
     C**Find*next*working*day*after*last*on*file***                       E17739
     C***********          Z-ADDNND,5     ZDAYNO                   E16813 E17739
     C***********NND,5     ADD  1         ZDAYNO                   E16813 E17739
     C***********          MOVEL@BSETC    ZCCY                            E17739
     C***********          MOVE 'Y'       ZOPT                            E17739
     C***********          EXSR ZDATE5                                    E17739
     C***********                                                         E17739
     C***********ECD       IFLT ZDYNBR                             E16813 E17739
     C***********TDVD      IFLT ZDYNBR                             E16813 E17739
     C***********                                                         E17739
     C***********          Z-ADDCFCT      ZCFCT                           E17739
     C***********          EXSR ZCTRV                                     E17739
     C***********                                                         E17739
     C**Update*corresponding*nostro*balances***                           E17739
     C***********          Z-ADD0         @X      30               E16813 E17739
     C***********          DO   5         @Y      30                      E17739
     C***********                                                         E17739
     C***********NND,@Y    IFGE ECD                                E16813 E17739
     C***********NND,@Y    IFGE TDVD                               E16813 E17739
     C***********@X        IFEQ 0                                  E16813 E17739
     C***********          Z-ADD@Y        @X                       E16813 E17739
     C***********          END                                     E16813 E17739
     C***********                                                         E17739
     C***********@BCHTP    IFEQ 'I'                                       E17739
     C***********@BTDTP    IFEQ 'TP'                                      E17739
     C***********          SUB  WCVAL     NNB,@Y                          E17739
     C***********          ELSE                                           E17739
     C***********          ADD  WCVAL     NNB,@Y                          E17739
     C***********          END                                            E17739
     C***********          ELSE                                           E17739
     C***********@BTDTP    IFEQ 'TP'                                      E17739
     C***********          ADD  WCVAL     NNB,@Y                          E17739
     C***********          ELSE                                           E17739
     C***********          SUB  WCVAL     NNB,@Y                          E17739
     C***********          END                                            E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C***********@X        IFNE 0                                         E17739
     C***********NND,@X    IFNE ECD                                E16813 E17739
     C***********          SUB  1         @X                       E16813 E17739
     C***********@X        IFNE 0                                  E16813 E17739
     C***********@BCHTP    IFEQ 'I'                                E16813 E17739
     C***********@BTDTP    IFEQ 'TP'                               E16813 E17739
     C***********          SUB  WCVAL     NNB,@X                   E16813 E17739
     C***********          ELSE                                    E16813 E17739
     C***********          ADD  WCVAL     NNB,@X                   E16813 E17739
     C***********          END                                     E16813 E17739
     C***********          ELSE                                    E16813 E17739
     C***********@BTDTP    IFEQ 'TP'                               E16813 E17739
     C***********          ADD  WCVAL     NNB,@X                   E16813 E17739
     C***********          ELSE                                    E16813 E17739
     C***********          SUB  WCVAL     NNB,@X                   E16813 E17739
     C***********          END                                     E16813 E17739
     C***********          END                                     E16813 E17739
     C***********          END                                     E16813 E17739
     C***********          END                                     E16813 E17739
     C***********                                                         E17739
     C***********          END                                     E16813 E17739
     C***********          END                                            E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C***********                                                         E17739
     C***********          MOVEAANB       PNB                             E17739
     C***********          Z-ADDNATN      TNLU                            E17739
     C***********          UPDATPRONOPNF                                  E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C***********          END                                            E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C***********          ENDSR                           SUB501 ends    E17739
     C***********                                                  S01176 E11739
      /EJECT
     C*******************************************************************
     C***SUB502*-*Subroutine*to*update*Memos***                           E17739
     C******************************************************************* E17739
     C***********SUB502    BEGSR                                          E17739
     C***********                                                         E17739
     C***Access*settlement*a/c*for*pay*from/pay*to*if*account*has***      E17739
     C********changed*or*trade*is*deleted***                              E17739
     C***********                                                         E17739
     C***Deletion                                                         E17739
     C***********@BCHTP    IFEQ 'D'                                       E17739
     C***********                                                         E17739
     C***********if Settlement Method '04'                                E17739
     C***********@BSMTH    IFEQ 4                                         E17739
     C***********                                                         E17739
     C***********access Customer account***                               E17739
     C***********          Z-ADD@BTCNR    CNUM                            E17739
     C***********          MOVEL@BSETC    CCY                             E17739
     C***********          Z-ADDCADC      ACOD                            E17739
     C***********          Z-ADD1         ACSQ                     E16843 E17739
     C***********MBIN      IFEQ 'N'                                E16843 E17739
     C***********          Z-ADD1         ACSQ                     E16843 E17739
     C***********          ELSE                                    E16843 E17739
     C***********          MOVE *BLANKS   KEY12  12                E16843 E17739
     C***********@BTDTP    IFEQ 'TP'                               E16843 E17739
     C***********          MOVE @BPYFB    KEY12                    E16843 E17739
     C***********          ELSE                                    E16843 E17739
     C***********          MOVE @BPYTB    KEY12                    E16843 E17739
     C***********          END                                     E16843 E17739
     C***********          MOVEL'10'      KEY12                    E16843 E17739
     C***********KEY12     CHAINTABLETRF             44            E16843 E17739
     C***********          Z-ADDNSACS     ACSQ                     E16843 E17739
     C***********          END                                     E16843 E17739
     C***********@KEYD     CHAINACCNTABF             01                   E17739
     C************IN01     IFEQ '0'                                       E17739
     C***********RECI      ANDNE'*'                                       E17739
     C***********ATYP      ANDEQ'R'                                       E17739
     C***********                                                         E17739
     C***********access*MEMOS*by*RRN***                                   E17739
     C***********RRNM      CHAINMEMOSMDF             01                   E17739
     C************IN01     IFEQ '0'                                       E17739
     C***********RECI      ANDNE'*'                                       E17739
     C***********          SUB  @BTVSN    LDBLN                           E17739
     C***********          SUB  @BTVSP    CLBLN                           E17739
     C***********                                                         E17739
     C***********          UPDATMEMOSMDF                                  E17739
     C***********          END                                            E17739
     C***********          END                                            E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C***********if*Settlement*Method*'05',*'14'*or*'15'***               E17739
     C***********@BSMTH    IFEQ 5                                         E17739
     C***********@BSMTH    OREQ 14                                        E17739
     C***********@BSMTH    OREQ 15                                        E17739
     C***********                                                         E17739
     C***********@BSMTH    IFEQ 5                                         E17739
     C***********@BTDTP    IFEQ 'TP'                                      E17739
     C***********          MOVE @BPYFM    @DSACC                          E17739
     C***********          MOVEL@BPYFM    CNUM                            E17739
     C***********          ELSE                                           E17739
     C***********          MOVE @BPAYT    @DSACC                          E17739
     C***********          MOVEL@BPAYT    CNUM                            E17739
     C***********          END                                            E17739
     C***********          MOVEL@BSETC    CCY                             E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C***********@BSMTH    IFEQ 14                                        E17739
     C***********@BTDTP    IFEQ 'TP'                                      E17739
     C***********          MOVEL@BPYFM    @KEY10 100                      E17739
     C***********          ELSE                                           E17739
     C***********          MOVEL@BPAYT    @KEY10                          E17739
     C***********          END                                            E17739
     C***********@KEY10    CHAINACNUMF               01                   E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C***********@BSMTH    IFEQ 15                                        E17739
     C***********@BTDTP    IFEQ 'TP'                                      E17739
     C***********          MOVEL@BPYFM    CSNM                            E17739
     C***********          ELSE                                           E17739
     C***********          MOVEL@BPAYT    CSNM                            E17739
     C***********          END                                            E17739
     C***********CSNM      CHAINSNAMEF               01                   E17739
     C************IN01     IFEQ '1'                                       E17739
     C***********RECI      OREQ '*'                                       E17739
     C***********          MOVELCSNM      CNUM                            E17739
     C***********          END                                            E17739
     C***********CNUM      CHAINCLINTSEF             01                   E17739
     C**N01******          EXCPTRELCSE                                    E17739
     C***********                                                         E17739
     C************IN01     IFEQ '0'                                       E17739
     C***********RECI      ANDNE'*'                                       E17739
     C***********          MOVEL@BSETC    CCY                             E17739
     C***********          Z-ADDC1AC      ACOD                            E17739
     C***********          Z-ADDC1SQ      ACSQ                            E17739
     C***********          END                                            E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C***********access*Pay*From*account*if*purchase*or****               E17739
     C***********access*Pay*To*account*if*sale****                        E17739
     C***********@KEYD     CHAINACCNTABF             01                   E17739
     C************IN01     IFEQ '0'                                       E17739
     C***********RECI      ANDNE'*'                                       E17739
     C***********ATYP      ANDNE'R'                                       E17739
     C***********                                                         E17739
     C***********access*MEMOS*by*RRN****                                  E17739
     C***********RRNM      CHAINMEMOSMDF             01                   E17739
     C************IN01     IFEQ '0'                                       E17739
     C***********RECI      ANDNE'*'                                       E17739
     C***********          SUB  @BTVSN    LDBLN                           E17739
     C***********          SUB  @BTVSP    CLBLN                           E17739
     C***********                                                         E17739
     C***********          UPDATMEMOSMDF                                  E17739
     C***********          END                                            E17739
     C***********          END                                            E17739
     C***********          END                                            E17739
     C***********          END                                            E17739
     C***********                                                         E17739
     C***********          ENDSR                           SUB502 ends    E17739
     C***********                                                         E17739
     C*****************************************************************   E17739
     C***********                                                  E17739 082738
     C***SUB501*- Subroutine to update projected Nostro details    E17739 082738
     C***********                                                  E17739 082738
     C*************************************************************E17739 082738
     C***********SUB501    BEGSR                                   E17739 082738
     C***********                                                  E17739 082738
     C**Settlement does not involve nostros                        E17739 082738
     C***********                                                  E17739 082738
     C***********@BSMTH    IFNE 1                                  E17739 082738
     C***********@BSMTH    ANDNE2                                  E17739 082738
     C***********@BSMTH    ANDNE7                                  E17739 082738
     C***********@BSMTH    ANDNE8                                  E17739 082738
     C***********@BSMTH    ANDNE12                                 E17739 082738
     C***********          GOTO ESB501                             E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C**Access*nostro details for Pay From a/c if purchase         E17739 082738
     C***********                 Pay To   a/c if Sale             E17739 082738
     C***********                                                  E17739 082738
     C***********@BTDTP    IFEQ 'TP'                               E17739 082738
     C***********          MOVE @BSETC    CCY                      E17739 082738
     C***********          MOVEL@BPYFM    NOSN                     E17739 082738
     C***********          ELSE                                    E17739 082738
     C***********          MOVE @BSETC    CCY                      E17739 082738
     C***********          MOVEL@BPAYT    NOSN                     E17739 082738
     C***********          END                                     E17739 082738
     C***********          MOVELNOSN      SNOSN   2                E24725 082738
     C***********                                                  E17739 082738
     C***********@KEYH     CHAINPRONOPNF             44            E17739 082738
     C************IN44     IFEQ '1'                                E17739 082738
     C************IN44     OREQ '0'                                E17739 082738
     C***********RECI      ANDEQ'*'                                E17739 082738
     C***********          Z-ADD*ZEROS    NOSN                     E17739 082738
     C***********@KEYH     CHAINPRONOPNF             44            E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C***..**Update corresponding nostro balances                  E17739 082738
     C***********                                                  E17739 082738
     C************IN44     IFEQ '0'                                E17739 082738
     C***********RECI      ANDNE'*'                                E17739 082738
     C***********          MOVEAPNB       ANB                      E17739 082738
     C***********          MOVEAPND       AND                      E17739 082738
     C***********                                                  E17739 082738
     C***********          Z-ADD1         @X      30               E17739 082738
     C***********          DO   5         @X                       E17739 082738
     C***********NND,@X    IFGE @BTDVD                             E17739 082738
     C***********                                                  E17739 082738
     C***********@BCHTP    IFEQ 'I'                                E17739 082738
     C***********                                                  E17739 082738
     C***********@BTDTP    IFEQ 'TP'                               E17739 082738
     C***********                                                  S01448 082738
     C***Update*PRONO with the settlement currency amount not the  S01448 082738
     C***nominal*currency amount                                   S01448 082738
     C***********                                                  S01448 082738
     C***********          SUB  WCVAL     NNB,@X                    E17739S01448
     C***********          SUB  TOSV      NNB,@X                   S01448 082738
     C***********          Z-ADD1         DORC                     S01154 082738
     C***********          ELSE                                    E17739 082738
     C***********          ADD  WCVAL     NNB,@X                    E17739S01448
     C***********          ADD  TOSV      NNB,@X                   S01448 082738
     C***********          Z-ADD0         DORC                     S01154 082738
     C***********          END                                     E17739 082738
     C***********          Z-ADDWCVAL     MVAM                      S01154S01448
     C***********          Z-ADDTOSV      MVAM                     S01448 082738
     C***********          ELSE                                    E17739 082738
     C***********@BTDTP    IFEQ 'TP'                               E17739 082738
     C***********          ADD  @BTCTR    NNB,@X                    E17739S01448
     C***********          ADD  @BTOSV    NNB,@X                   S01448 082738
     C***********          Z-ADD0         DORC                     S01154 082738
     C***********          ELSE                                    E17739 082738
     C***********          SUB  @BTCTR    NNB,@X                    E17739S01448
     C***********          SUB  @BTOSV    NNB,@X                   S01448 082738
     C***********          Z-ADD1         DORC                     S01154 082738
     C***********          END                                     E17739 082738
     C***********          Z-ADD@BTCTR    MVAM                      S01154S01448
     C***********          Z-ADD@BTOSV    MVAM                     S01448 082738
     C***********          END                                     E17739 082738
     C***********          END                                     E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C***********          MOVEAANB       PNB                      E17739 082738
     C***********          Z-ADDNATN      TNLU                     E17739 082738
     C***********          UPDATPRONOPNF                           E17739 082738
     C***********                                                  S01154 082738
     C*****..Get*account*code*and*sequence*from*TABLETL************S01154 S01117
     C*****..Get*account code and sequence from SDNOSTPD           S01117 082738
     C***********                                                  S01154 082738
     C***********          MOVE *BLANKS   KEY12                    S01154 S01117
     C***********          MOVEL'70'      KEY12                    S01154 S01117
     C***********          MOVELNOSN      WFLD2   2                S01154 E24725
     C***********          MOVELSNOSN     WFLD2   2                E24725 S01117
     C***********          MOVELCCY       WFLD5   5                S01154 S01117
     C***********          MOVE WFLD2     WFLD5                    S01154 S01117
     C***********          MOVE WFLD5     KEY12                    S01154 S01117
     C***********KEY12     CHAINTABLETLF             99            S01154 S01117
     C************IN99     IFEQ '1'                                S01154 S01117
     C***********          MOVE '32'      @DBASE            *******S01154 S01117
     C***********          MOVEL'TABLE'   @DBFIL            * DATABASE1154S01117
     C***********          MOVEL'KEY12'   @DBKEY            * ERROR 321154S01117
     C***********          SETON                     U7U8   *******S01154 S01117
     C***********          GOTO ESB501                             S01154 S01117
     C***********          MOVE '*MSG   ' @RTCD                    S01117 082738
     C***********          MOVELCCY       P@CYCD                   S01117 082738
     C***********          MOVELSNOSN     P@NONB                   S01117 082738
     C***********          EXSR AONOST                             S01117 082738
     C***********@RTCD     IFNE *BLANKS                            S01117 082738
     C***********          Z-ADD32        @DBASE           ********S01117 082738
     C***********          MOVEL'SDNOSTPD'@DBFIL           * DB ERRS01117 082738
     C***********          MOVELKNOST     @DBKEY           ********S01117 082738
     C***********          EXSR SUB999                             S01117 082738
     C***********          END                                     S01154 082738
     C***********          MOVELA7ACCD    ACOD                     S01117 082738
     C***********          MOVELA7BRCD    BRCA                     S01117 082738
     C***********          MOVELA7CUST    CNUM                     S01117 082738
     C***********          MOVELA7ACSN    ACSQ                     S01117 082738
     C***********                                                  S01154 082738
     C***WRITE*A RECORD TO THE ACCOUNT MOVEMENT FILE               S01154 082738
     C***********          EXSR ACCMOV                             S01154 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C***********                                                  E17739 082738
     C***********ESB501    ENDSR                        SUB501 endsE17739 082738
     C*****************************************************************   E17739
      *EJECT*****                                                  S01154 082738
     C*****************************************************************   S01154
     C*****ACCMOV*SR. TO WRITE ACCOUNT MOVEMENTS RECORD            S01154 082738
     C***********                                                  S01154 082738
     C*****************************************************************   S01154
     C***********ACCMOV    BEGSR                           *** ACCMS01154 082738
     C***********                                                  S01154 082738
     C****..If*Movement Amount Is Zero No Record Is Written        S01154 082738
     C***********                                                  S01154 082738
     C***********MVAM      IFGT 0                                  S01154 082738
     C***********                                                  S01154 082738
     C****..Write Account Movement Record                          S01154 082738
     C***********                                                  S01154 082738
     C***********          Z-ADD*ZEROS    CQNR                     S01154 082738
     C***********          MOVE TDRF      TNMR                     S01154 082738
     C***********          Z-ADD*ZEROS    NRTC                     S01154 080050
     C***********          MOVE *BLANK    NRTC              S01154 080050 082738
     C***********          MOVE TDTP      TRYP                     S01154 082738
     C***********          Z-ADDTDVD      VUDT                     S01154 082738
     C***********                                                  S01448 082738
     C***********BVSKTV    IFEQ 'T'                                S01448 082738
     C***********          Z-ADDTDVD      PTDT                     S01448 082738
     C***********          ELSE                                    S01448 082738
     C***********          Z-ADDRUND      PTDT                     S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********          Z-ADDRUND      PTDT                      S01154S01448
     C***********          Z-ADDCNUM      CUSN                     S01154 082738
     C***********          Z-ADDACOD      ACDE                     S01154 082738
     C***********          Z-ADDACSQ      ASNC                     S01154 082738
     C***********          MOVE SETC      CCYD                     S01154 082738
     C***********          MOVELTDSS      NRTD                     S01154 082738
     C***********                                                  S01154 082738
     C***********          WRITERSACMTPO                           S01154 082738
     C***********                                                  S01154 082738
     C***********          END                                     S01154 082738
     C***********                                                  S01154 082738
     C***********          ENDSR                                   S01154 082738
     C***********                                                  S01154 082738
     C*****************************************************************   E17739
      *EJECT*****                                                  E17739 082738
     C*****************************************************************   E17739
     C***********                                                  E17739 082738
     C***SUB502*- Subroutine to update Memos                       E17739 082738
     C***********                                                  E17739 082738
     C*****************************************************************   E17739
     C***********SUB502    BEGSR                                   E17739 082738
     C***********                                                  E17739 082738
     C***Insert,autosettle ind is 'Y',value date<RUND,trade is compE17739 082738
     C***********                                                  E17739 082738
     C***********@BCHTP    IFEQ 'I'                                E17739 082738
     C***********@BAUTS    ANDEQ'Y'                                E17739 082738
     C***********@BTDVD    ANDLERUND                                E17739S01448
     C***********@BTDDT    ANDLERUND                               S01448 082738
     C***********@BTINC    ANDEQ'C'                                E17739 082738
     C***********          Z-ADDWCVAL     @VALS  150                E17739065355
     C***********          Z-ADDTOSV      @VALS  150               065355 082738
     C***********          EXSR UPMEMS                             E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C***Delete**                                                  E17739 082738
     C***********                                                  E17739 082738
     C***********@BCHTP    IFEQ 'D'                                E17739 082738
     C***********                                                  E17739 082738
     C***Autosettle ind was 'Y',value date<RUND,trade was complete E17739 082738
     C***Autosettle ind was 'N'                                    E17739 082738
     C***********                                                  E17739 082738
     C***********@BAUTS    IFEQ 'Y'                                 E17739065335
     C***********@BTDVD    ANDLERUND                                E17739065355
     C***********@BTINC    ANDEQ'C'                                 E17739065355
     C***********@BAUTS    OREQ 'N'                                 E17739065355
     C***********          MOVEL'Y'       REVERS                    E17739065355
     C***********@BAUTS    IFEQ 'Y'                                 E17739065355
     C***********          Z-ADD@BTCTR    @VALS                     E17739065355
     C***********          ELSE                                     E17739065355
     C***********@BTVSN    ADD  @BTVSP    @VALS                     E17739065355
     C***********          END                                      E17739065355
     C***********          EXSR UPMEMS                              E17739065355
     C***********          MOVEL*BLANK    REVERS  1                 E17739065355
     C***********          END                                      E17739065355
     C***********                                            E17739065355 082738
     C***********@BTDVD    IFLE RUND                               065355 082738
     C***********@BTINC    ANDEQ'C'                                065355 082738
     C***********          MOVEL'Y'       REVERS                   065355 082738
     C***********@BAUTS    IFEQ 'Y'                                065355 082738
     C***********@BTOED    IFEQ RUND                               065355 082738
     C***********          Z-ADD@BTOSV    @VALS                    065355 082738
     C***********          ELSE                                    065355 082738
     C***********          Z-ADD@BTVSP    @VALS                    065355 082738
     C***********          END                                     065355 082738
     C***********          ELSE                                    065355 082738
     C***********@BTVSN    ADD  @BTVSP    @VALS                    065355 082738
     C***********          END                                     065355 082738
     C***********          EXSR UPMEMS                             065355 082738
     C***********          MOVEL*BLANK    REVERS  1                065355 082738
     C***********          END                                     065355 082738
     C***********                                                  E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C***********          ENDSR                           SUB502 eE17739 082738
     C*****************************************************************   E17739
      *EJECT*****                                                  E17739 082738
     C*****************************************************************   E17739
     C***********                                                  E17739 082738
     C***UPMEMS*Update MEMOS                                       E17739 082738
     C***********                                                  E17739 082738
     C*****************************************************************   E17739
     C***********                                                  E17739 082738
     C***********UPMEMS    BEGSR                                   E17739 082738
     C***********                                                  E17739 082738
     C***Determine if settlement across Retail A/C                 E17739 082738
     C***********                                                  E17739 082738
     C***********          EXSR DETSAC                             E17739 082738
     C***********RETAC     CABNE'Y'       EUPMEM                   E17739 082738
     C***********                                                  E17739 082738
     C***Access*MEMOS by RRN  (RRNM is off ACCNT accessed in DETSACE17739 082738
     C***********                                                  E17739 082738
     C***********RRNM      CHAINMEMOSMDF             44            E17739 082738
     C************IN44     IFEQ '1'                                E17739 082738
     C***********          MOVE '28'      @DBASE            *******E17739 S01117
     C***********          Z-ADD28        @DBASE            *******S01117 082738
     C***********          MOVEL'MEMOS'   @DBFIL            * DATABE17739 082738
     C***********          MOVELRRNM      @DBKEY            * ERRORE17739 082738
     C***********          SETON                     U7U8   *******E17739 S01117
     C***********          GOTO EUPMEM                             E17739 S01117
     C***********          EXSR SUB999                             S01117 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C**Purchase*- update ledger & cleared balances with settled amE17739 082738
     C***********                                                  E17739 082738
     C***********@BTDTP    IFEQ 'TP'                               E17739 082738
     C***********REVERS    IFNE 'Y'                                E17739 082738
     C********             SUB  @VALS     LDBLN                     E17739S01448
     C********             SUB  @VALS     CLBLN                     E17739S01448
     C***********                                                  S01448 082738
     C***********BVSKTV    IFEQ 'T'                                S01448 082738
     C***********@BTDVD    ANDLERUND                               S01448 082738
     C***********BVSKTV    ORNE 'T'                                S01448 082738
     C***********          SUB  @VALS     LDBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********@BTDVD    IFLE RUND                               S01448 082738
     C***********          SUB  @VALS     CLBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********          Z-ADD0         DORC                      S01145063863
     C***********          Z-ADD1         DORC                     063863 082738
     C***********          ELSE                                    E17739 082738
     C*******              ADD  @VALS     LDBLN                     E17739S01448
     C*******              ADD  @VALS     CLBLN                     E17739S01448
     C***********          MOVE '28'      @DBASE            *******E17739 S01117
     C***********          Z-ADD28        @DBASE            *******S01117 082738
     C***********          MOVEL'MEMOS'   @DBFIL            * DATABE17739 082738
     C***********          MOVELRRNM      @DBKEY            * ERRORE17739 082738
     C***********          SETON                     U7U8   *******E17739 S01117
     C***********          GOTO EUPMEM                             E17739 S01117
     C***********          EXSR SUB999                             S01117 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C**Purchase*- update ledger & cleared balances with settled amE17739 082738
     C***********                                                  E17739 082738
     C***********@BTDTP    IFEQ 'TP'                               E17739 082738
     C***********REVERS    IFNE 'Y'                                E17739 082738
     C********             SUB  @VALS     LDBLN                     E17739S01448
     C********             SUB  @VALS     CLBLN                     E17739S01448
     C***********                                                  S01448 082738
     C***********BVSKTV    IFEQ 'T'                                S01448 082738
     C***********@BTDVD    ANDLERUND                               S01448 082738
     C***********BVSKTV    ORNE 'T'                                S01448 082738
     C***********          SUB  @VALS     LDBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********@BTDVD    IFLE RUND                               S01448 082738
     C***********          SUB  @VALS     CLBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********          Z-ADD0         DORC                      S01145063863
     C***********          Z-ADD1         DORC                     063863 082738
     C***********          ELSE                                    E17739 082738
     C*******              ADD  @VALS     LDBLN                     E17739S01448
     C*******              ADD  @VALS     CLBLN                     E17739S01448
     C***********                                                  S01448 082738
     C***********BVSKTV    IFEQ 'T'                                S01448 082738
     C***********@BTDVD    ANDLERUND                               S01448 082738
     C***********BVSKTV    ORNE 'T'                                S01448 082738
     C***********          ADD  @VALS     LDBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********@BTDVD    IFLE RUND                               S01448 082738
     C***********          ADD  @VALS     CLBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********          Z-ADD1         DORC                      S01154063863
     C***********          Z-ADD0         DORC                     063863 082738
     C***********          END                                     E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C**Sale*-*update ledger & cleared balances with settled amountE17739 082738
     C***********                                                  E17739 082738
     C***********@BTDTP    IFEQ 'TS'                               E17739 082738
     C***********REVERS    IFNE 'Y'                                E17739 082738
     C*******              ADD  @VALS     LDBLN                     E17739S01448
     C*******              ADD  @VALS     CLBLN                     E17739S01448
     C***********                                                  S01448 082738
     C***********BVSKTV    IFEQ 'T'                                S01448 082738
     C***********@BTDVD    ANDLERUND                               S01448 082738
     C***********BVSKTV    ORNE 'T'                                S01448 082738
     C***********          ADD  @VALS     LDBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********@BTDVD    IFLE RUND                               S01448 082738
     C***********          ADD  @VALS     CLBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********          Z-ADD1         DORC                      S01154063863
     C***********          Z-ADD0         DORC                     063863 082738
     C***********          ELSE                                    E17739 082738
     C********             SUB  @VALS     LDBLN                     E17739S01448
     C********             SUB  @VALS     CLBLN                     E17739S01448
     C***********                                                  S01448 082738
     C***********BVSKTV    IFEQ 'T'                                S01448 082738
     C***********@BTDVD    ANDLERUND                               S01448 082738
     C***********BVSKTV    ORNE 'T'                                S01448 082738
     C***********          SUB  @VALS     LDBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********@BTDVD    IFLE RUND                               S01448 082738
     C***********          SUB  @VALS     CLBLN                    S01448 082738
     C***********          END                                     S01448 082738
     C***********                                                  S01448 082738
     C***********          Z-ADD0         DORC                      S01154063863
     C***********          Z-ADD1         DORC                     063863 082738
     C***********          END                                     E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  S01154 082738
     C*****..save movement amount for PF/RSACMTPD                  S01154 082738
     C***********                                                  S01154 082738
     C***********          Z-ADD@VALS     MVAM                     S01154 082738
     C***********                                                  E17739 082738
     C***Update*MEMOS                                              E17739 082738
     C***********                                                  E17739 082738
     C***********          UPDATMEMOSMDF                           E17739 082738
     C***********                                                  E17739 082738
     C****WRITE*A RECORD TO THE ACCOUNT MOVEMENT FILE              S01154 082738
     C***********                                                  S01448 082738
     C****Only*update account movement if not already done for nostS01448 082738
     C***********                                                  S01448 082738
     C***********@BSMTH    IFNE 1                                  S01448 082738
     C***********@BSMTH    ANDNE2                                  S01448 082738
     C***********@BSMTH    ANDNE7                                  S01448 082738
     C***********@BSMTH    ANDNE8                                  S01448 082738
     C***********@BSMTH    ANDNE12                                 S01448 082738
     C***********          EXSR ACCMOV                             S01154 082738
     C***********          END                                     S01448 082738
     C***********                                                  E17739 082738
     C***********EUPMEM    ENDSR                                   E17739 082738
     C*****************************************************************   E17739
      *EJECT*****                                                  E17739 082738
     C*****************************************************************   E17739
     C***********                                                  E17739 082738
     C***DETSAC*Determine settlement account                       E17739 082738
     C***********                                                  E17739 082738
     C*****************************************************************   E17739
     C***********                                                  E17739 082738
     C***********DETSAC    BEGSR                                   E17739 082738
     C***********          MOVEL'N'       RETAC   1                E17739 082738
     C***********          Z-ADD*ZERO     CNUM                     E17739 082738
     C***********          MOVEL@BSETC    CCY                      E17739 082738
     C***********          Z-ADD*ZERO     ACOD                     E17739 082738
     C***********          Z-ADD*ZERO     ACSQ                     E17739 082738
     C***********                                                  E17739 082738
     C********..*if Settlement Method '04'                         E17739 082738
     C***********                                                  E17739 082738
     C***********@BSMTH    IFEQ 4                                  E17739 082738
     C***********                                                  E17739 082738
     C***********          Z-ADD@BTCNR    CNUM                     E17739 082738
     C***********          Z-ADDCADC      ACOD                     E17739 S01117
     C***********          MOVE BMACCD    ACOD                     S01117 082738
     C***********MBIN      IFEQ 'N'                                E17739 S01117
     C***********          Z-ADD1         ACSQ                     E17739 082738
     C***********          ELSE                                    E17739 S01117
     C***********          MOVEL*BLANKS   KEY12  12                E17739 S01117
     C***********@BTDTP    IFEQ 'TP'                               E17739 S01117
     C***********          MOVE @BPYFB    KEY12                    E17739 S01117
     C***********          ELSE                                    E17739 S01117
     C***********          MOVE @BPYTB    KEY12                    E17739 S01117
     C***********          END                                     E17739 S01117
     C***********          MOVEL'10'      KEY12                    E17739 S01117
     C***********KEY12     CHAINTABLETRF             44            E17739 S01117
     C***********          Z-ADDNSACS     ACSQ                     E17739 S01117
     C***********          END                                     E17739 S01117
     C***********                                                  E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C********..*if Settlement Method '05', '14' or '15'           E17739 082738
     C***********                                                  E17739 082738
     C***********@BSMTH    IFEQ 5                                  E17739 082738
     C***********@BSMTH    OREQ 14                                 E17739 082738
     C***********@BSMTH    OREQ 15                                 E17739 082738
     C***********                                                  E17739 082738
     C***********@BSMTH    IFEQ 5                                  E17739 082738
     C***********@BTDTP    IFEQ 'TP'                               E17739 082738
     C***********          MOVE @BPYFM    @DSACC                   E17739 S01117
     C***********          MOVE @BPYFM    WFLD6   6                S01117 082738
     C***********          MOVEL@BPYFM    CNUM                     E17739 082738
     C***********          MOVELWFLD6     ACOD                     S01117 082738
     C***********          MOVE WFLD6     ACSQ                     S01117 082738
     C***********          ELSE                                    E17739 082738
     C***********          MOVE @BPAYT    @DSACC                   E17739 S01117
     C***********          MOVE @BPAYT    WFLD6                    S01117 082738
     C***********          MOVEL@BPAYT    CNUM                     E17739 082738
     C***********          MOVELWFLD6     ACOD                     S01117 082738
     C***********          MOVE WFLD6     ACSQ                     S01117 082738
     C***********          END                                     E17739 082738
     C***********          MOVEL@BSETC    CCY                      E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C***********@BSMTH    IFEQ 14                                 E17739 082738
     C***********@BTDTP    IFEQ 'TP'                               E17739 082738
     C***********          MOVEL@BPYFM    @KEY10 100               E17739 082738
     C***********          ELSE                                    E17739 082738
     C***********          MOVEL@BPAYT    @KEY10                   E17739 082738
     C***********          END                                     E17739 082738
     C***********@KEY10    CHAINACNUMF               44            E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C***********@BSMTH    IFEQ 15                                 E17739 082738
     C***********@BTDTP    IFEQ 'TP'                               E17739 082738
     C***********          MOVEL@BPYFM    CSNM                     E17739 082738
     C***********          ELSE                                    E17739 082738
     C***********          MOVEL@BPAYT    CSNM                     E17739 S01117
     C***********          MOVEL@BPAYT    @WCSNM                   S01117 082738
     C***********          END                                     E17739 082738
     C***********CSNM      CHAINSNAMEF               44                   E17739
     C************IN44     IFEQ '1'                                       E17739
     C************IN44     OREQ '0'                                       E17739
     C***********RECI      ANDEQ'*'                                       E17739
     C***********          MOVELCSNM      CNUM                            E17739
     C***********          END                                            E17739
     C***********CNUM      CHAINCLINTSEF             44                   E17739
     C************IN44     IFEQ '0'                                       E17739
     C***********RECI      ANDNE'*'                                       E17739
     C***********          Z-ADDC1AC      ACOD                            E17739
     C***********          Z-ADDC1SQ      ACSQ                            E17739
     C***********          END                                            E17739
     C***********          EXSR AOCUST                             S01117 082738
     C***********          MOVE *BLANKS   @RTCD                    S01117 082738
     C***********          MOVE BBCUST    @WCUST                   S01117 082738
     C***********          MOVE *BLANKS   @RTCD                    S01117 082738
     C***********          EXSR AOSECS                             S01117 082738
     C***********@RTCD     IFNE *BLANKS                            S01117 082738
     C***********          MOVE BFCUST    CNUM                     S01117 082738
     C***********          MOVE BFACCD    ACOD                     S01117 082738
     C***********          MOVE BFACSN    ACSQ                     S01117 082738
     C***********          END                                     S01117 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C********..*Access account                                    E17739 082738
     C***********                                                  E17739 082738
     C***********@KEYD     CHAINACCNTABF             44            E17739 082738
     C************IN44     IFEQ '0'                                E17739 082738
     C***********RECI      ANDNE'*'                                E17739 082738
     C***********ATYP      ANDEQ'R'                                E17739 082738
     C***********          MOVEL'Y'       RETAC                    E17739 082738
     C***********          END                                     E17739 082738
     C***********                                                  E17739 082738
     C***********          ENDSR                                   E17739 082738
     C***********                                                  E17739 082738
     C*****************************************************************
      *EJECT*****                                                         082738
     C*****************************************************************
     C***SUB503*- Subroutine to update on-line positions details      *   082738
     C*****************************************************************
     C***********SUB503    BEGSR                                          082738
     C***********                                                         082738
     C***Access*OLPOS file for settlement and nominal currency            082738
     C***********          Z-ADD1         RECN                            082738
     C***********          MOVE @BTDBA    BRCA                     S01117 082738
     C***********                                                         082738
     C***When*accessing OLPOS using settlement currency, update    S01448 082738
     C***with*settlement currency amount not nominal currency amounS01448 082738
     C***Changed for S01448 - Bulk input enhancements              S01448 082738
     C***********                                                  S01448 082738
     C***********1         DO   2         @Z      10                      082738
     C***********                                                         082738
     C***********@Z        IFEQ 1                                         082738
     C***********          MOVEL@BSETC    CCY                             082738
     C***********          ELSE                                           082738
     C***********          MOVEL@BTNMC    CCY                             082738
     C***********          END                                            082738
     C***********                                                         082738
     C***********@KEYI     CHAINOLPOSOAF             01                   082738
     C************IN01     IFEQ '0'                                       082738
     C***********RECI      ANDNE'*'                                       082738
     C***********          MOVEAODT       ADT                             082738
     C***********          MOVEAOFI       AFI                             082738
     C***********          MOVEAOFO       AFO                             082738
     C***********                                                         082738
     C***********          DO   16        @Y                              E17739
     C***********          DO   16        @Y      30               E17739 082738
     C********** ECD       IFGE NDT,@Y                                    E16813
     C**********           Z-ADD@Y        @X                              E16813
     C***********@BTDVD    IFGE NDT,@Y                             E16813 082738
     C***********          Z-ADD@Y        @X      30               E16813 082738
     C***********          END                                            082738
     C***********          END                                            082738
     C***********                                                         082738
     C********** ECD       IFLT NDT,1                                     E16813
     C***********@BTDVD    IFLT NDT,1                              E16813 082738
     C***********          Z-ADD1         @X                              082738
     C***********          END                                            082738
     C***********                                                         082738
     C***********@BCHTP    IFEQ 'I'                                       082738
     C***********@BTDTP    IFEQ 'TP'                                      082738
     C***********@Z        IFEQ 1                                         082738
     C***********                                                         082738
     C***IF*UPDATING SETTLEMENT CURRENCY RECORD ADD TO OUTGOING AMO       082738
     C***ELSE*UPDATE INCOMING POSITION                                    082738
     C*******              ADD  WCVAL     NFO,@X                          S01448
     C***********          ADD  TOSV      NFO,@X                   S01448 082738
     C***********          ELSE                                           082738
     C***********          ADD  WCVAL     NFI,@X                          082738
     C***********          END                                            082738
     C***********          ELSE                                           082738
     C***********@Z        IFEQ 1                                         082738
     C***********                                                         082738
     C***IF*UPDATING SETTLEMENT CURRENCY RECORD ADD TO INCOMING AMOUNT    082738
     C***ELSE*UPDATE OUTGOING POSITION                                    082738
     C*******              ADD  WCVAL     NFI,@X                          S01448
     C***********          ADD  TOSV      NFI,@X                   S01448 082738
     C***********          ELSE                                           082738
     C***********          ADD  WCVAL     NFO,@X                          082738
     C***********          END                                            082738
     C***********          END                                            082738
     C***********          ELSE                                           082738
     C***********                                                         082738
     C***ACTION*CODE DELETE                                               082738
     C***********@BTDTP    IFEQ 'TP'                                      082738
     C***********@Z        IFEQ 1                                         082738
     C***********                                                         082738
     C***IF*UPDATING SETTLEMENT CURRENCY RECORD SUBTRACT FROM OUTGOING    082738
     C***AMOUNT*ELSE FROM INCOMING AMOUNT                                 082738
     C*******              SUB  WCVAL     NFO,@X                          S01448
     C***********          SUB  TOSV      NFO,@X                   S01448 082738
     C***********          ELSE                                           082738
     C***********          SUB  WCVAL     NFI,@X                          082738
     C***********          END                                            082738
     C***********          ELSE                                           082738
     C***********                                                         082738
     C****IF*SALE                                                         082738
     C***********@Z        IFEQ 1                                         082738
     C***********                                                         082738
     C***IF*UPDATING SETTLEMENT CURRENCY RECORD SUBTRACT FROM INCOMING    082738
     C***AMOUNT*ELSE FROM OUTGOING AMOUNT                                 082738
     C*******              SUB  WCVAL     NFI,@X                          S01448
     C***********          SUB  TOSV      NFI,@X                   S01448 082738
     C***********          ELSE                                           082738
     C***********          SUB  WCVAL     NFO,@X                          082738
     C***********          END                                            082738
     C***********          END                                            082738
     C***********          END                                            082738
     C***********                                                         082738
     C***********          MOVEAAFI       OFI                             082738
     C***********          MOVEAAFO       OFO                             082738
     C***********          Z-ADDNATN      TNLU                            082738
     C***********                                                         082738
     C***********          UPDATOLPOSOAF                                  082738
     C***********          END                                            082738
     C***********                                                         082738
     C***********          END                                            082738
     C***********                                                         082738
     C***********          ENDSR                           SUB503 ends    082738
     C***********                                                  S01176 S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB504 - Subroutine to update Book positions                 *
     C*****************************************************************
     C           SUB504    BEGSR
     C*
     C                     Z-ADD0         @CNT    50
     C*
     C***If*insertion***********************                              065377
     C***********@BCHTP    IFEQ 'I'                                       065377
     C*
     C*  Access BKPHD trade date position
     C                     MOVEL@BTDSS    BHSC
     C***********          MOVEL@BTDBR    BHBR                            S01117
     C                     MOVEL@BTDBA    BHBA                            S01117
     C                     MOVEL@BTDBK    BHBK
     C                     MOVEL@BTDMI    BHMK
     C                     MOVEL'T'       BHTV
     C           @KEYB     CHAINBKPHDDF              01
     C*
     C*  Update BKPHD trade date position
     C           *IN01     IFEQ '1'
     C                     MOVE 'D'       RECI
     C**********           Z-ADDRUND      FPSD                            E17228
     C**********           Z-ADDRUND      LPSD                            E17228
     C                     Z-ADDTDDT      FPSD                            E17228
     C                     Z-ADDTDDT      LPSD                            E17228
     C**********           Z-ADD*ZEROS    LPCD                            057181
     C                     Z-ADDTDDT      LPCD                            057181
     C                     Z-ADD0         LAVP
     C                     Z-ADD0         LATD
     C                     Z-ADD0         ARPC
     C**********           Z-ADD0         ICLD                            E17228
     C                     Z-ADDTDVD      ICLD                            E17228
     C                     Z-ADD0         IACR
     C                     Z-ADD0         IACP
     C                     Z-ADD0         INDO
     C                     Z-ADD0         UPPT
     C                     Z-ADD0         DPAP
     C                     Z-ADD0         DPFP                            S01397
     C                     Z-ADD0         BUDU
     C                     MOVE SITP      INVT
     C                     MOVE @BTNMC    NCRY
     C                     Z-ADD0         LPRC
     C                     Z-ADD0         BHDP
     C                     Z-ADD0         BHCP
     C                     Z-ADD0         BHPP
     C                     Z-ADDNATN      TNLU
     C                     Z-ADD0         LAVN                                                CAS006
     C                     Z-ADD0         DPAN                                                CAS006
     C                     Z-ADD0         BUDN                                                CAS006
     C                     Z-ADD0         INDN                                                CAS006
     C                     Z-ADD0         NAVP                                                CSE065
     C                     Z-ADD0         BKVAMT                                              CSE065
     C                     Z-ADD0         EQTAMT                                              CSE065
      *                                                                                       CSE065
     C                     WRITEBKPHDDF
     C                     ADD  1         @CNT
     C*
     C**********           ELSE                                           E17228
     C**********           Z-ADDNATN      TNLU                            E17228
     C**********           Z-ADDRUND      LPSD                            E17228
     C**********           UPDATBKPHDDF                                   E17228
     C                     END
     C*                                                                   E17228
     C* Remember latest position date                                     E17228
     C*                                                                   E17228
     C                     Z-ADDLPSD      TLPSD   50                      E17228
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP10                                           S01408
     C*                                                                   S01408
     C*
     C*  If value date LE run date :-
     C*  Access BKPHD value date position
     C           @BTDVD    IFLE RUND
     C*
     C                     MOVEL@BTDSS    BHSC
     C***********          MOVEL@BTDBR    BHBR                            S01117
     C                     MOVEL@BTDBA    BHBA                            S01117
     C                     MOVEL@BTDBK    BHBK
     C                     MOVEL@BTDMI    BHMK
     C                     MOVEL'V'       BHTV
     C           @KEYB     CHAINBKPHDDF              01
     C*
     C*  Update BKPHD value date position
     C           *IN01     IFEQ '1'
     C                     MOVE 'D'       RECI
     C**********           Z-ADDRUND      FPSD                            E17228
     C**********           Z-ADDRUND      LPSD                            E17228
     C                     Z-ADDTDVD      FPSD                            E17228
     C                     Z-ADDTDVD      LPSD                            E17228
     C**********           Z-ADD*ZEROS    LPCD                            057181
     C                     Z-ADDTDVD      LPCD                            057181
     C                     Z-ADD0         LAVP
     C                     Z-ADD0         LATD
     C                     Z-ADD0         ARPC
     C**********           Z-ADD0         ICLD                            E17228
     C                     Z-ADDTDVD      ICLD                            E17228
     C                     Z-ADD0         IACR
     C                     Z-ADD0         IACP
     C                     Z-ADD0         INDO
     C                     Z-ADD0         UPPT
     C                     Z-ADD0         DPAP
     C                     Z-ADD0         BUDU
     C                     MOVE SITP      INVT
     C                     MOVE @BTNMC    NCRY
     C                     Z-ADD0         LPRC
     C                     Z-ADD0         BHDP
     C                     Z-ADD0         BHCP
     C                     Z-ADD0         BHPP
     C                     Z-ADDNATN      TNLU
     C                     Z-ADD0         LAVN                                                CAS006
     C                     Z-ADD0         DPAN                                                CAS006
     C                     Z-ADD0         BUDN                                                CAS006
     C                     Z-ADD0         INDN                                                CAS006
     C                     Z-ADD0         NAVP                                                CSE065
     C                     Z-ADD0         BKVAMT                                              CSE065
     C                     Z-ADD0         EQTAMT                                              CSE065
      *                                                                                       CSE065
     C                     WRITEBKPHDDF
     C                     ADD  1         @CNT
     C*
     C**********           ELSE                                           E17228
     C**********           Z-ADDNATN      TNLU                            E17228
     C**********           Z-ADDRUND      LPSD                            E17228
     C**********           UPDATBKPHDDF                                   E17228
     C                     END
     C*                                                                   E17228
     C* Remember latest position date                                     E17228
     C*                                                                   E17228
     C                     Z-ADDLPSD      VLPSD   50                      E17228
     C                     END
     C*
     C***********          END                                            065377
     C*
     C*  Update trailer
     C           @CNT      IFNE 0
     C           1         CHAINBKPHDAF              12
     C           *IN12     IFEQ '0'
     C                     ADD  @CNT      NORE
     C                     Z-ADDNATN      TNLU
     C                     UPDATBKPHDAF
     C                     Z-ADD0         @CNT
     C                     ELSE
     C                     MOVEL@ER,9     @ERRTX
     C                     END
     C                     END
     C*
     C           *IN12     IFEQ '0'
     C*
     C*  Access BKPOS trade date position
     C                     MOVEL@BTDSS    BPSC
     C***********          MOVEL@BTDBR    BPBR                            S01117
     C                     MOVEL@BTDBA    BPBA                            S01117
     C                     MOVEL@BTDBK    BPBK
     C                     MOVEL@BTDMI    BPMK
     C                     MOVEL'T'       BPTV
     C**********           Z-ADDRUND      BPPD                            E17228
     C                     Z-ADDTLPSD     BPPD                            E17228
     C*
     C                     Z-ADD0         SNPI
     C                     Z-ADD0         SANP
     C                     Z-ADD0         SNSI
     C                     Z-ADD0         SANS
     C*
     C           @KEYC     CHAINBKPOSDF              01
     C*
     C*  Update trade date positions :-
     C                     Z-ADDNATN      TNLU
     C           *IN01     IFEQ '1'
     C*
     C****If*record*to*be*added*find*previous*nominal*position******      E17228
     C**********           Z-ADD99999     BPPD                            E17228
     C********** @KEYC     SETGTBKPOSDF                                   E17228
     C**********           READPBKPOSDF                  01               E17228
     C********** *IN01     IFEQ '1'                                       E17228
     C********** @BTDSS    ORNE BPSC                                      E17228
     C********** @BTDBR    ORNE BPBR                                      E17228
     C********** @BTDBK    ORNE BPBK                                      E17228
     C********** @BTDMI    ORNE BPMK                                      E17228
     C********** BPTV      ORNE 'T'                                       E17228
     C                     Z-ADD0         NPSN
     C**********           END                                            E17228
     C*
     C                     MOVE 'D'       RECI
     C                     MOVEL@BTDSS    BPSC
     C***********          MOVEL@BTDBR    BPBR                            S01117
     C                     MOVEL@BTDBA    BPBA                            S01117
     C                     MOVEL@BTDBK    BPBK
     C                     MOVEL@BTDMI    BPMK
     C                     MOVEL'T'       BPTV
     C**********           Z-ADDRUND      BPPD                            E17228
     C                     Z-ADDTDDT      BPPD                            E17228
     C                     Z-ADD0         ECNP
     C                     Z-ADD0         APPB
     C                     Z-ADD0         RPTP
     C                     Z-ADD0         PILP
     C                     Z-ADD0         APNC
     C                     Z-ADD0         ANMP
     C                     Z-ADD0         AAPR
     C                     Z-ADD0         SANP
     C                     Z-ADD0         SNPI
     C                     Z-ADD0         SANS
     C                     Z-ADD0         SNSI
     C                     MOVE *BLANK    ADJI
     C                     Z-ADDNATN      TNLU
     C                     Z-ADD0         APPN                                                CAS006
     C                     Z-ADD0         APNN                                                CAS006
     C                     Z-ADD0         PILN                                                CAS006
     C                     Z-ADD0         BKCOST                                              CSE065
     C*
     C*  Calculate trade date positions
     C                     EXSR SUB600
     C                     WRITEBKPOSDF
     C                     ADD  1         @CNT
     C*
     C                     ELSE
     C*
     C*  Calculate trade date positions
     C                     EXSR SUB600
     C*
     C                     UPDATBKPOSDF
     C*
     C                     END
     C*
     C*  If value date LE run date
     C*  Access BKPOS value date position
     C           @BTDVD    IFLE RUND
     C*
     C                     MOVEL@BTDSS    BPSC
     C***********          MOVEL@BTDBR    BPBR                            S01117
     C                     MOVEL@BTDBA    BPBA                            S01117
     C                     MOVEL@BTDBK    BPBK
     C                     MOVEL@BTDMI    BPMK
     C                     MOVEL'V'       BPTV
     C**********           Z-ADDRUND      BPPD                            E17228
     C                     Z-ADDVLPSD     BPPD                            E17228
     C*
     C                     Z-ADD0         SNPI
     C                     Z-ADD0         SANP
     C                     Z-ADD0         SNSI
     C                     Z-ADD0         SANS
     C*
     C           @KEYC     CHAINBKPOSDF              01
     C*
     C*  Update BKPOS value date positions :-
     C                     Z-ADDNATN      TNLU
     C           *IN01     IFEQ '1'
     C*
     C****If*record*to*be*added*find*previous*nominal*position************E17228
     C**********           Z-ADD99999     BPPD                            E17228
     C********** @KEYC     SETGTBKPOSDF                                   E17228
     C**********           READPBKPOSDF                  01               E17228
     C********** *IN01     IFEQ '1'                                       E17228
     C********** @BTDSS    ORNE BPSC                                      E17228
     C********** @BTDBR    ORNE BPBR                                      E17228
     C********** @BTDBK    ORNE BPBK                                      E17228
     C********** @BTDMI    ORNE BPMK                                      E17228
     C********** BPTV      ORNE 'V'                                       E17228
     C                     Z-ADD0         NPSN
     C**********           END                                            E17228
     C*
     C                     MOVE 'D'       RECI
     C                     MOVEL@BTDSS    BPSC
     C***********          MOVEL@BTDBR    BPBR                            S01117
     C                     MOVEL@BTDBA    BPBA                            S01117
     C                     MOVEL@BTDBK    BPBK
     C                     MOVEL@BTDMI    BPMK
     C                     MOVEL'V'       BPTV
     C**********           Z-ADDRUND      BPPD                            E17228
     C                     Z-ADDTDVD      BPPD                            E17228
     C                     Z-ADD0         ECNP
     C                     Z-ADD0         APPB
     C                     Z-ADD0         RPTP
     C                     Z-ADD0         PILP
     C                     Z-ADD0         APNC
     C                     Z-ADD0         ANMP
     C                     Z-ADD0         AAPR
     C                     Z-ADD0         SANP
     C                     Z-ADD0         SNPI
     C                     Z-ADD0         SANS
     C                     Z-ADD0         SNSI
     C                     MOVE *BLANK    ADJI
     C                     Z-ADDNATN      TNLU
     C                     Z-ADD0         APPN                                                CAS006
     C                     Z-ADD0         APNN                                                CAS006
     C                     Z-ADD0         PILN                                                CAS006
     C                     Z-ADD0         BKCOST                                              CSE065
     C*
     C*  Calculate BKPOS value date positions
     C                     EXSR SUB600
     C                     WRITEBKPOSDF
     C                     ADD  1         @CNT
     C*
     C                     ELSE
     C*
     C*  Calculate BKPOS value date positions
     C                     EXSR SUB600
     C*
     C                     UPDATBKPOSDF
     C*
     C                     END
     C                     END
     C*
     C*  Update trailer
     C           @CNT      IFNE 0
     C           1         CHAINBKPOSAF              12
     C           *IN12     IFEQ '0'
     C                     ADD  @CNT      NORE
     C                     Z-ADDNATN      TNLU
     C                     UPDATBKPOSAF
     C                     ELSE
     C                     MOVEL@ER,10    @ERRTX
     C                     END
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           SUB504 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB505 - Subroutine to update Client Depot positions         *
     C*****************************************************************
     C           SUB505    BEGSR
     C*
     C*  If insertion :-
     C           @BCHTP    IFEQ 'I'
     C*
     C***********          MOVEL@BTDBR    CSBR                            S01117
     C                     MOVEL@BTDBA    CSBA                            S01117
     C                     MOVEL@BTDSS    CSSC
     C                     MOVEL@BTCNR    CSCN
     C*
     C*  Access CPOSN client position
     C           @KEYE     CHAINCPOSNDF              01
     C*
     C*  Update CPOSN client position
     C                     Z-ADDNATN      TNLU
     C**********           Z-ADDRUND      CSDA                            E16843
     C*
     C           *IN01     IFEQ '1'
     C                     MOVE 'D'       RECI
     C           @BTDVD    IFLE RUND                                      E16843
     C                     Z-ADD@BTDVD    CSDA                            E16843
     C                     ELSE                                           E16843
     C                     Z-ADD@BTDDT    CSDA                            E16843
     C                     END                                            E16843
     C                     Z-ADD0         CSNT
     C                     Z-ADD0         CSNV
     C                     Z-ADD0         CSNS
     C                     Z-ADD0         CSEX
     C                     Z-ADD0         CSPT
     C                     Z-ADD0         CSPV
     C                     Z-ADD0         CSCT
     C                     Z-ADD0         CSCV
     C                     MOVE 'N'       CSBT
     C                     MOVE 'N'       CSBV
     C                     WRITECPOSNDF
     C*
     C* Update trailer
     C           1         CHAINCPOSNAF              12
     C           *IN12     IFEQ '0'
     C                     ADD  1         NORE
     C                     Z-ADDNATN      TNLU
     C                     UPDATCPOSNAF
     C                     ELSE
     C                     MOVEL@ER,11    @ERRTX
     C                     END
     C*
     C                     ELSE
     C*
     C           @BTDDT    IFLE CSCT
     C                     MOVE 'Y'       CSBT
     C                     END
     C           @BTDVD    IFLE CSCV
     C                     MOVE 'Y'       CSBV
     C                     END
     C*
     C                     UPDATCPOSNDF
     C                     END
     C*
     C                     END
     C*
     C           *IN12     IFEQ '0'
     C*
     C*  Access CDEPP client depot positions
     C           @BTDTP    IFEQ 'TP'
     C                     MOVEL@BDELF    CDPT
     C                     ELSE
     C                     MOVEL@BDELT    CDPT
     C                     END
     C*
     C***********          MOVEL@BTDBR    CDBR                            S01117
     C                     MOVEL@BTDBA    CDPA                            S01117
     C                     MOVEL@BTCNR    CDCN
     C                     MOVEL@BTDSS    CDSN
     C                     MOVEL@BTDMI    CDMK
     C*
     C           @KEYF     CHAINCDEPPDF              01
     C                     Z-ADDNATN      TNLU
     C*
     C*  Update CDEPP client depot positions
     C           *IN01     IFEQ '1'
     C                     MOVE 'D'       RECI
     C**********           Z-ADDRUND      DDTE                            E16843
     C           @BTDVD    IFLE RUND                                      E16843
     C                     Z-ADD@BTDVD    DDTE                            E16843
     C                     ELSE                                           E16843
     C                     Z-ADD@BTDDT    DDTE                            E16843
     C                     END                                            E16843
     C                     Z-ADD0         CECN
     C                     Z-ADD0         CDNT
     C                     Z-ADD0         CDNV
     C                     Z-ADD0         CDNS
     C                     Z-ADD0         SNPT
     C                     Z-ADD0         SAPP
     C                     Z-ADD0         CDST
     C                     Z-ADD0         SAPS
     C                     Z-ADD0         CNPV
     C                     Z-ADD0         SAPV
     C                     Z-ADD0         CNSV
     C                     Z-ADD0         SPSV
     C                     EXSR SUB601
     C                     WRITECDEPPDF
     C                     ADD  1         @COUNT
     C*
     C* Update trailer
     C           1         CHAINCDEPPAF              12
     C           *IN12     IFEQ '0'
     C                     ADD  1         NORE
     C                     Z-ADDNATN      TNLU
     C                     UPDATCDEPPAF
     C                     ELSE
     C                     MOVEL@ER,12    @ERRTX
     C                     END
     C*
     C                     ELSE
     C*
     C                     EXSR SUB601
     C                     UPDATCDEPPDF
     C*
     C                     END
     C*
     C                     END
      *                                                                                       234440
     C           CGL031    IFEQ 'Y'                                                           234440
      *                                                                                       235546
      ** Check if value date has changed and ensure that earlier value date                   235546
      ** is used                                                                              235546
     C                     Z-ADDTDVD      PTDVD   50                                          235546
      *                                                                                       235546
      ** Delete all records on ETCPOSND after the date/timestamp.                             235546
      *                                                                                       235546
     C           NOBACK    IFNE 'Y'                                                           236125
     C                     CALL 'SE006670'                                                    235546
     C                     PARM           @BCHTP                                              235546
     C                     PARM 'T'       WTYPE                                               235546
     C                     PARM           @TRDDS                                              235546
     C                     PARM           @SEVDP                                              235546
     C                     PARM           @SECTY                                              235546
     C                     PARM           PTDVD                                               235546
     C*                                                                                       235546
     C* if value date on trade has not changed to be later, then process                      235546
     C* this trade now                                                                        235546
     C*                                                                                       235546
     C                     Z-ADD0         PTDVD                                               235546
     C                     MOVEASTAMP,1   PTMST                                               235546
     C                     CALL SEETCP                                                        234440
     C                     PARM *BLANKS   PRETC                                               234440
     C                     PARM           @BCHTP                                              234440
     C                     PARM 'T'       WTYPE   1                                           234440
     C                     PARM           @TRDDS                                              234440
     C                     PARM           @SEVDP                                              234440
     C                     PARM           @SECTY                                              234440
     C*                                                                                       235546
     C* Re-process all the other trades/depot movements after this date.                      235546
     C*                                                                                       235546
     C                     CALL 'SE006680'                                                    235546
     C                     PARM 'T'       WTYPE                                               235546
     C**********           PARM           @TRDDS                                       235546 235546
     C**********           PARM           @SEVDP                                       235546 235546
     C                     PARM           @SECTY                                              235546
     C                     PARM           PROT                                                235546
     C                     PARM           C1DI                                                235546
     C                     PARM           NOMDP                                               235546
     C                     PARM           CSE023                                              235546
     C                     PARM           PTDVD                                               235546
     C                     PARM           PTMST                                               235546
     C                     ENDIF                                                              236125
     C                     MOVEL*BLANKS   NOBACK                                              236125
     C                     ENDIF                                                              234440
     C*
     C                     ENDSR                           SUB505 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB506 - Subroutine to update User depot positions           *
     C*****************************************************************
     C           SUB506    BEGSR
     C*
     C                     Z-ADD0         UDTP
     C                     Z-ADD0         UDPV
     C                     Z-ADD0         UDTS
     C                     Z-ADD0         UDSV
     C*
     C           @BTDTP    IFEQ 'TP'
     C                     MOVEL@BDELT    UDPT
     C                     ELSE
     C                     MOVEL@BDELF    UDPT
     C                     END
     C*
     C***********          MOVEL@BTDBR    UDBR                            S01117
     C                     MOVEL@BTDBA    UDBA                            S01117
     C                     MOVEL@BTDSS    UDSN
     C                     MOVEL@BTDBK    UDBK
     C                     MOVEL@BTDMI    UDMK
     C*
     C*  Access UDEPP user depot positions
     C           @KEYG     CHAINUDEPPDF              01
     C*
     C*  Update UDEPP user depot positions
     C                     Z-ADDNATN      TNLU
     C*
     C*  Trade date basis :-
     C           @BTDTP    IFEQ 'TP'
     C           @BCHTP    IFEQ 'I'
     C                     ADD  @BNOML    UDTP
     C                     ELSE
     C                     SUB  @BNOML    UDTP
     C                     END
     C                     ELSE
     C           @BCHTP    IFEQ 'I'
     C                     SUB  @BNOML    UDTS
     C                     ELSE
     C                     ADD  @BNOML    UDTS
     C                     END
     C                     END
     C*
     C*  Value date basis :-
     C           @BTDVD    IFLE RUND
     C           @BTDTP    IFEQ 'TP'
     C           @BCHTP    IFEQ 'I'
     C                     ADD  @BNOML    UDPV
     C                     ELSE
     C                     SUB  @BNOML    UDPV
     C                     END
     C                     ELSE
     C           @BCHTP    IFEQ 'I'
     C                     SUB  @BNOML    UDSV
     C                     ELSE
     C                     ADD  @BNOML    UDSV
     C                     END
     C                     END
     C                     END
     C*                                                                   S01176
     C***  Nominal Settled, Input Cycle                                   S01176
     C*                                                                   S01176
     C           @BTDVD    IFLE RUND                                      S01176
     C           @BAUTS    ANDEQ'Y'                                       S01176
     C*                                                                   S01176
     C           @BTDTP    IFEQ 'TP'                                      S01176
     C*                                                                   S01176
     C           @BCHTP    IFEQ 'I'                                       S01176
     C                     ADD  @BNOML    UNSI                            S01176
     C                     ELSE                                           S01176
     C                     SUB  @BNOML    UNSI                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C           @BCHTP    IFEQ 'I'                                       S01176
     C                     SUB  @BNOML    UNSI                            S01176
     C                     ELSE                                           S01176
     C                     ADD  @BNOML    UNSI                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   E21604
     C           @BCHTP    IFEQ 'D'                                       E21604
     C           @BTDVD    ANDLERUND                                      E21604
     C           @BAUTS    ANDEQ'N'                                       E21604
     C*                                                                   E21604
     C           TNSN      IFNE 0                                         E21604
     C           TNSP      ORNE 0                                         E21604
     C           TNSN      ADD  TNSP      WORK                            E21604
     C*                                                                   E21604
     C           @BTDTP    IFEQ 'TP'                                      E21604
     C                     SUB  WORK      UNSI                            E21604
     C                     ELSE                                           E21604
     C                     ADD  WORK      UNSI                            E21604
     C                     END                                            E21604
     C*                                                                   E21604
     C                     END                                            E21604
     C                     END                                            E21604
     C*
     C           *IN01     IFEQ '1'
     C                     MOVE 'D'       RECI
     C**********           Z-ADDRUND      UDDT                            E16843
     C           @BTDVD    IFLE RUND                                      E16843
     C                     Z-ADD@BTDVD    UDDT                            E16843
     C                     ELSE                                           E16843
     C                     Z-ADD@BTDDT    UDDT                            E16843
     C                     END                                            E16843
     C                     Z-ADD0         UECN
     C                     Z-ADD0         UDNT
     C                     Z-ADD0         UDNV
     C                     Z-ADD0         UDNS
     C***********          Z-ADD0         UDTS                            E28749
     C***********          Z-ADD0         UDSV                            E28749
     C                     Z-ADD0         UNRT
     C                     Z-ADD0         UNRV
     C                     Z-ADD0         USNT
     C                     Z-ADD0         USNR
     C                     Z-ADD0         USNV
     C                     Z-ADD0         USRV
     C                     WRITEUDEPPDF
     C                     ADD  1         @COUNT
     C*
     C* Update trailer
     C           1         CHAINUDEPPAF              12
     C           *IN12     IFEQ '0'
     C                     ADD  1         NORE
     C                     Z-ADDNATN      TNLU
     C                     UPDATUDEPPAF
     C                     ELSE
     C                     MOVEL@ER,13    @ERRTX
     C                     END
     C*
     C                     ELSE
     C*
     C                     UPDATUDEPPDF
     C                     END
     C*
     C                     ENDSR                           SUB506 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB507 - Subroutine to update trade settlements file         *
     C*****************************************************************
     C           SUB507    BEGSR
     C*
     C                     Z-ADD0         @CNT
     C*
     C* Update all records for this trade ref. to record ID of C
     C           @KEYJ     SETLLSETLEDF
     C*
     C           *IN01     DOUEQ'1'
     C           @KEYJ     READESETLEDF                  01
     C*
     C           *IN01     IFNE '1'
     C           RECI      ANDNE'C'
     C           RECI      ANDNE'*'                                       056846
     C           RECI      IFEQ 'H'                                       E16799
     C                     MOVE 'X'       CHTP                            E16799
     C                     ELSE                                           E16799
     C                     MOVE 'D'       CHTP                            E16799
     C                     END                                            E16799
     C                     MOVEL'C'       RECI
     C**********           MOVE 'D'       CHTP                            E16799
     C                     Z-ADDRUND      LCD
     C                     ADD  1         @CNT
     C                     UPDATSETLEDF
     C                     END
     C*
     C                     END
     C*
     C* Update trailer
     C           @CNT      IFNE 0
     C           1         CHAINSETLEAF              12
     C           *IN12     IFEQ '0'
     C                     ADD  @CNT      SDEL
     C                     UPDATSETLEAF
     C                     ELSE
     C                     MOVEL@ER,14    @ERRTX
     C                     END
     C                     END
     C*
     C                     ENDSR                           SUB507 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT                                                              S01401
      *****************************************************************   S01401
      *                                                               *   S01401
      *  BLK1Z2 - Subroutine to obtain BULKSDX1 and BULKSDX2 details. *   S01401
      *                                                               *   S01401
      *****************************************************************   S01401
      *                                                                   S01401
     C           BLK1Z2    BEGSR                                          S01401
      *                                                                   S01401
      **  Obtain corresponding bulk extension record                      S01401
     C           @BTDRF    CHAINBULKSDD1             02                   S01401
      *                                                                   S01401
      ****If*record*not*found*perform*data*base*error*handling*subS014011 068692
      ****subroutine.                                             S014011 068692
      **  If record not found set up defaults                             068692
     C           *IN02     IFEQ *ON                                       S01401
      *                                                                   S01401
     C***********          Z-ADD33        @DBASE           ********S01401 068692
     C***********          MOVEL'BULKSDX1'@DBFIL           * DB ERRS01401 068692
     C***********          MOVEL@BTDRF    @DBKEY           ********S01401 068692
     C***********          EXSR SUB999                             S01401 068692
     C                     RESETWBLKY1                                    068692
     C                     MOVE @BTDRF    B1TDRF                          068692
      *                                                                   068692
     C                     MOVEL'N'       B1GMES                          006869
     C                     MOVEL'Y'       B1SCMG                          068692
      *                                                                   068692
     C                     TIME           WWTIME  60                      068692
     C                     MOVELWWTIME    B1TRTT                          068692
      *                                                                   CSW003
      **  Set up MT5xx message defaults                                   CSW003
     C                     EXSR MT5DF1                                    CSW003
      *                                                                   068692
     C***********          ELSE                                    S01401 068692
     C                     ENDIF                                          068692
      *                                                                   S01401
      **  Record found, try to retrieve bulk settlement instructions      S01401
      **  This is not mandatory so if not found do not perform data       S01401
      **  base error subroutine.                                          S01401
     C           @BTDRF    CHAINBULKSDD2             02                   S01401
      *                                                                   S01401
      **  Record not found clear field WBLKY2 so that nothing is left     S01401
      **  over from previous chain.                                       S01401
     C           *IN02     IFEQ *ON                                       S01401
     C                     MOVE *BLANKS   WBLKY2                          S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
     C***********          ENDIF                                   S01401 068692
      *                                                                   S01401
     C                     ENDSR                                          S01401
      *                                                                   S01401
     C*****************************************************************   S01401
      /EJECT                                                              S01401
      *****************************************************************   S01401
      *                                                               *   S01401
      *  TRD1Z2 - Subroutine to obtain TRADSDX1 and TRADSDX2 details. *   S01401
      *                                                               *   S01401
      *****************************************************************   S01401
      *                                                                   S01401
     C           TRD1Z2    BEGSR                                          S01401
      *                                                                   S01401
      **  By now there are two possibilities.                             S01401
      **  1. A record on TRADSD has been found with RECI *eq '*' or       S01401
      **  2. A corresponding record has not been found(*IN01 *EQ *ON).    S01401
      **                                                                  S01401
      **  Thus if record found prepare record for UPDAT operation.        S01401
     C           *IN01     IFEQ *OFF                                      S01401
      *                                                                   S01401
     C           @BTDRF    CHAINTRADSDD1             02                   S01401
      *                                                                   S01401
      **  Corresponding record not found on the extendsion file perform   S01401
      **  data base handling subroutine.                                  S01401
     C           *IN02     IFEQ *ON                                       S01401
     C                     Z-ADD34        @DBASE           ***************S01401
     C                     MOVEL'TRADSDX1'@DBFIL           * DB ERROR 34 *S01401
     C                     MOVEL@BTDRF    @DBKEY           ***************S01401
     C                     EXSR SUB999                                    S01401
     C                     ELSE                                           S01401
      *                                                                   S01401
      **  Record found, try to retrieve trade settlement instructions     S01401
      **  This is not mandatory so if not found do not perform data       S01401
      **  base error subroutine.                                          S01401
     C           @BTDRF    CHAINTRADSDD2             02                   S01401
      *                                                                   S01401
      **  Record not found clear field WTRDY2 so that nothing is left     S01401
      **  over from previous chain.                                       S01401
     C           *IN02     IFEQ *ON                                       S01401
     C                     MOVE *BLANKS   WTRDY2                          S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
     C                     ENDIF                                          S01401
     C                     ENDIF                                          S01401
      *                                                                   S01401
     C                     ENDSR                                          S01401
      *                                                                   S01401
     C*****************************************************************   S01401
      /EJECT
      *****************************************************************   068692
      *                                                               *   068692
      *  *inzsr - Initialize BULKSDD1 fields.                         *   068692
      *                                                               *   068692
      *****************************************************************   068692
     C           *INZSR    BEGSR                                          068692
      *                                                                   068692
     C                     CLEARWBLKY1                                    068692
      *                                                                   068692
     C                     ENDSR                                          068692
     C*****************************************************************
      *                                                               *   CSW003
      *  MT5DF1 - Default MT5xx Message Generation Details            *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           MT5DF1    BEGSR                                          CSW003
      *                                                                   CSW003
      * Retrieve Securities Trading info for Deliver From Depot           CSW003
     C********** @BDELF    IFNE *ZEROS                                                 CSW003 CSD027
     C           @BDELF    IFNE *BLANKS                                                       CSD027
     C                     MOVEL@BDELF    @WCUST                          CSW003
     C                     EXSR AOSECS                                    CSW003
      ** Initialize 'Deliver From' classification indicator.              CSW003
     C                     MOVE BFCLAS    DFCLAS  1                       CSW003
      *                                                                   CSE022
      ** BFDRF1 needs to be updated by the 1st 6 characters of BFNDR1.    CSE022
      ** BFDRF2 needs to be updated by the 1st 6 characters of BFNDR2.    CSE022
      *                                                                   CSE022
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C                     MOVE BFDRF1    DFDRF1  6                       CSW003
     C                     MOVE BFDRF2    DFDRF2  6                       CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      * Retrieve Securities Trading info for Deliver To Depot             CSW003
     C********** @BDELT    IFNE *ZEROS                                                 CSW003 CSD027
     C           @BDELT    IFNE *BLANKS                                                       CSD027
     C                     MOVEL@BDELT    @WCUST                          CSW003
     C                     EXSR AOSECS                                    CSW003
      ** Initialize 'Deliver To' classification indicator.                CSW003
     C                     MOVE BFCLAS    DTCLAS  1                       CSW003
      *                                                                   CSE022
      ** BFDRF1 needs to be updated by the 1st 6 characters of BFNDR1.    CSE022
      ** BFDRF2 needs to be updated by the 1st 6 characters of BFNDR2.    CSE022
      *                                                                   CSE022
     C                     MOVELBFNDR1    BFDRF1                          CSE022
     C                     MOVELBFNDR2    BFDRF2                          CSE022
     C                     MOVE BFDRF1    DTDRF1  6                       CSW003
     C                     MOVE BFDRF2    DTDRF2  6                       CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Initialize Non-screen fields                                     CSW003
     C                     Z-ADD*ZEROS    B1LSWS                          CSW003
     C                     Z-ADD*ZEROS    B1LSSC                          CSW003
     C                     MOVE 'N'       B1CONG                          CSW003
     C                     MOVE 'N'       B1RCDG                          CSW003
     C                     MOVE @C1DI     B1CCID                          CSW003
     C           CSW003    IFEQ 'Y'                                       CSW003
     C                     MOVE 'A'       B1WHEN                          CSW003
     C                     MOVE *BLANKS   T1WHEN                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Initialize Instructions type and sub-type.                       CSW003
     C                     MOVE *BLANKS   B1INST                          CSW003
     C                     MOVE *BLANKS   B1INSS                          CSW003
      *                                                                   CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVEL'01'      B1INST                          CSW003
     C                     MOVE 'MATCH'   B1INSS                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C                     SELEC                                          CSW003
     C           DFCLAS    WHEQ 'C'                                       CSW003
     C                     MOVEL'03C'     B1INST                          CSW003
     C                     MOVE 'MATCH'   B1INSS                          CSW003
     C********** DFCLAS    WHEQ 'K'                                CSW003 CSE022
     C**********           MOVEL'03K'     B1INST                   CSW003 CSE022
     C           DFCLAS    WHEQ 'X'                                       CSW003
     C           DFCLAS    OREQ 'M'                                       CSW003
     C                     MOVEL'03'      B1INST                          CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C           @BPCOD    IFEQ '1'                                       CSW003
     C           @BPCOD    OREQ '5'                                       CSW003
     C                     MOVEL'41'      B1INST                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DFCLAS    ANDEQ'E'                                       CSW003
     C           @BPCOD    IFEQ '1'                                       CSW003
     C           @BPCOD    OREQ '5'                                       CSW003
     C                     MOVEL'41'      B1INST                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSL                                          CSW003
      * Else Trade Sale.                                                  CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVEL'02'      B1INST                          CSW003
     C                     MOVE 'MATCH'   B1INSS                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C                     SELEC                                          CSW003
     C           DTCLAS    WHEQ 'C'                                       CSW003
     C                     MOVEL'07C'     B1INST                          CSW003
     C                     MOVE 'MATCH'   B1INSS                          CSW003
     C********** DTCLAS    WHEQ 'K'                                CSW003 CSE022
     C**********           MOVEL'07K'     B1INST                   CSW003 CSE022
     C           DTCLAS    WHEQ 'X'                                       CSW003
     C           DTCLAS    OREQ 'M'                                       CSW003
     C                     MOVEL'07'      B1INST                          CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C           @BPCOD    IFEQ '1'                                       CSW003
     C           @BPCOD    OREQ '5'                                       CSW003
     C                     MOVEL'51'      B1INST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'31'      B1INST                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DTCLAS    ANDEQ'E'                                       CSW003
     C           @BPCOD    IFEQ '1'                                       CSW003
     C           @BPCOD    OREQ '5'                                       CSW003
     C                     MOVEL'51'      B1INST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'31'      B1INST                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Init Euroclear/Cedel code                                        CSW003
     C                     MOVE *BLANKS   B1EUCL                          CSW003
     C                     MOVE *BLANKS   EUCLA                           CSW003
     C                     MOVE *BLANKS   SEUCL                           CSW003
     C                     MOVE *BLANKS   WKEUCL  7                       CSW003
      *                                                                   CSW003
      ** Classification of Counterparty is 'M'.                           CSW003
     C           @C1DI     IFEQ 'M'                                       CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVEA@C101     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL  10 P                     CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
      **  Classification if equal 'C'.                                    CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
     C           DFCLAS    ANDEQ'C'                                       CSW003
     C           @BTDTP    OREQ 'TS'                                      CSW003
     C           DTCLAS    ANDEQ'C'                                       CSW003
     C                     MOVEA@C102     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ELSE                                           CSW003
     C                     MOVEA@C101     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C                     MOVEA@C102     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
      **  Classification if equal 'E'.                                    CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
     C           DFCLAS    ANDEQ'E'                                       CSW003
     C           @BTDTP    OREQ 'TS'                                      CSW003
     C           DTCLAS    ANDEQ'E'                                       CSW003
     C                     MOVEA@C101     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ELSE                                           CSW003
     C                     MOVEA@C102     EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
      ** Else Classification of Counterparty is 'S' or 'D'.               CSW003
     C                     ELSE                                           CSW003
     C           @BDELT    IFNE @BDELF                                    CSW003
      *                                                                   CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVEADFDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C                     MOVEADFDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C           DFCLAS    ANDEQ'C'                                       CSW003
     C                     MOVEADFDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DFCLAS    ANDEQ'E'                                       CSW003
     C                     MOVEADFDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDSL                                          CSW003
      *   ELSE  (TS)                                                      CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVEADTDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C                     MOVEADTDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C           DTCLAS    ANDEQ'C'                                       CSW003
     C                     MOVEADTDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DTCLAS    ANDEQ'E'                                       CSW003
     C                     MOVEADTDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  SEUCL     P                     CSW003
     C                     ENDSL                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     MOVELSEUCL     B1EUCL                          CSW003
      *                                                                   CSW003
      ** Init Safekeeping Account                                         CSW003
     C                     MOVE *BLANKS   B1SAFA                          CSW003
      *                                                                   CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C           @BCLTY    OREQ '2'                                       CSW003
     C                     MOVE DTDRF1    B1SAFA                          CSW003
     C                     MOVEL'/'       B1SAFA                          CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C           @BCLTY    OREQ '4'                                       CSW003
     C                     MOVE DTDRF2    B1SAFA                          CSW003
     C                     MOVEL'/'       B1SAFA                          CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
     C                     ELSE                                           CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C           @BCLTY    OREQ '2'                                       CSW003
     C                     MOVE DFDRF1    B1SAFA                          CSW003
     C                     MOVEL'/'       B1SAFA                          CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C           @BCLTY    OREQ '4'                                       CSW003
     C                     MOVE DFDRF2    B1SAFA                          CSW003
     C                     MOVEL'/'       B1SAFA                          CSW003
     C                     ENDSL                                          CSW003
     C                     ENDIF                                          CSW003
      **                                                                  CSW003
      ** Set Settlement Message Request Indicator to 'Y'?                 CSW003
     C                     EXSR SMSGR                                     CSW003
      *                                                                   CSW003
      ** Settlement Message Request Indicator (if not UNROUTABLE).        CSW003
     C           B1GMES    IFEQ 'Y'                                       CSW003
     C           @C1DI     IFEQ 'S'                                       CSW003
     C           @BDELT    ANDEQ@BDELF                                    CSW003
     C           @C1DI     OREQ 'D'                                       CSW003
     C           @BDELT    ANDEQ@BDELF                                    CSW003
     C                     MOVE 'N'       B1GMES                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Confirmation Message Request Indicator.                          CSW003
     C                     MOVE 'N'       B1GMEC                          CSW003
      *                                                                   CSW003
      ** Customer/Counterparty Indicator for MT510 or MT512               CSW003
     C           @C1DI     IFEQ 'M'                                       CSW003
     C                     MOVE 'P'       B1CCID                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE 'C'       B1CCID                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      **  Requested priorty.                                              CSW003
     C                     MOVEL'3'       B1RPTY                          CSW003
      *                                                                   CSW003
      **  Guaranteed Delivery.                                            CSW003
     C           @BPCOD    IFEQ '5'                                       CSW003
     C                     MOVE 'G'       B1GDEL                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           SWRTN     IFEQ 'CSW098 '                                 CSW098
     C                     MOVE 'N'       B1SIOR                          CSW098
     C                     ENDIF                                          CSW098
      *                                                                   CSW098
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      *  MT5DF2  - Initialize second record.                          *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           MT5DF2    BEGSR                                          CSW003
      *                                                                   CSW003
      ** Initialize Non-screen fields                                     CSW003
     C**********           MOVELWBLKY1    WTRDY1                                       CSW003 201192
     C                     EXSR SRBULK                                                        201192
     C                     MOVE 'B'       T1WHEN                          CSW003
      *                                                                   CSW003
     C           @BDELT    IFEQ @BDELF                                    CSW003
     C                     MOVE *BLANKS   T1INST                          CSW003
     C                     MOVE *BLANKS   T1INSS                          CSW003
     C                     MOVE *BLANKS   T1EUCL                          CSW003
     C                     MOVE *BLANKS   T1SAFA                          CSW003
     C                     MOVE 'N'       T1GMES                          CSW003
     C                     MOVE 'N'       T1GMEC                          CSW003
     C                     MOVE *BLANKS   T1CCID                          CSW003
     C                     MOVE *BLANKS   T1RPTY                          CSW003
     C                     MOVE *BLANKS   T1GDEL                          CSW003
      *                                                                   CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
      ** Instructions type and sub-type.                                  CSW003
     C                     MOVE *BLANKS   T1INST                          CSW003
     C                     MOVE *BLANKS   T1INSS                          CSW003
      *                                                                   CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVEL'02'      T1INST                          CSW003
     C                     MOVE 'MATCH'   T1INSS                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C           DFCLAS    ANDEQ'C'                                       CSW003
     C           @BPCOD    IFEQ '1'                                       CSW003
     C           @BPCOD    OREQ '5'                                       CSW003
     C                     MOVEL'51'      T1INST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'31'      T1INST                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C           @BPCOD    IFEQ '1'                                       CSW003
     C           @BPCOD    OREQ '5'                                       CSW003
     C                     MOVEL'51'      T1INST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'31'      T1INST                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DFCLAS    ANDEQ'E'                                       CSW003
     C                     MOVEL'07C'     T1INST                          CSW003
     C                     MOVEL'MATCH'   T1INSS                          CSW003
     C                     ENDSL                                          CSW003
      * Else Trade Sale                                                   CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVEL'01'      T1INST                          CSW003
     C                     MOVE 'MATCH'   T1INSS                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C           DTCLAS    ANDEQ'C'                                       CSW003
     C           @BPCOD    IFEQ '1'                                       CSW003
     C           @BPCOD    OREQ '5'                                       CSW003
     C                     MOVEL'41'      T1INST                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C           @BPCOD    IFEQ '1'                                       CSW003
     C           @BPCOD    OREQ '5'                                       CSW003
     C                     MOVEL'41'      T1INST                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DTCLAS    ANDEQ'E'                                       CSW003
     C                     MOVEL'03C'     T1INST                          CSW003
     C                     MOVE 'MATCH'   T1INSS                          CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      * Euroclear/Cedel Code                                              CSW003
     C                     MOVE *BLANKS   T1EUCL                          CSW003
      *                                                                   CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVEADTDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  T1EUCL    P                     CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C                     MOVEADTDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  T1EUCL    P                     CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C           DFCLAS    ANDEQ'C'                                       CSW003
     C                     MOVEADTDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  T1EUCL    P                     CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DFCLAS    ANDEQ'E'                                       CSW003
     C                     MOVEADTDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  T1EUCL    P                     CSW003
     C                     ENDSL                                          CSW003
      * Else Trade Sale                                                   CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVEADFDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  T1EUCL    P                     CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C                     MOVEADFDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '/'       CAT  WKEUCL:0  T1EUCL    P                     CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C           DTCLAS    ANDEQ'C'                                       CSW003
     C                     MOVEADFDRF1    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XE'    CAT  WKEUCL:0  T1EUCL    P                     CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DTCLAS    ANDEQ'E'                                       CSW003
     C                     MOVEADFDRF2    EUCLA     P                     CSW003
     C                     EXSR EUCLF                                     CSW003
     C           '//XC'    CAT  WKEUCL:0  T1EUCL    P                     CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Init Safekeeping Account                                         CSW003
     C                     MOVE *BLANKS   T1SAFA                          CSW003
      *                                                                   CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVE DFDRF1    T1SAFA                          CSW003
     C                     MOVEL'/'       T1SAFA                          CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C                     MOVE DFDRF2    T1SAFA                          CSW003
     C                     MOVEL'/'       T1SAFA                          CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DFCLAS    ANDEQ'E'                                       CSW003
     C                     MOVE DFDRF1    T1SAFA                          CSW003
     C                     MOVEL'/'       T1SAFA                          CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C           DFCLAS    ANDEQ'C'                                       CSW003
     C                     MOVE DFDRF2    T1SAFA                          CSW003
     C                     MOVEL'/'       T1SAFA                          CSW003
     C                     ENDSL                                          CSW003
      *                                                                   CSW003
     C                     ELSE                                           CSW003
     C                     SELEC                                          CSW003
     C           @BCLTY    WHEQ '1'                                       CSW003
     C                     MOVE DTDRF1    T1SAFA                          CSW003
     C                     MOVEL'/'       T1SAFA                          CSW003
     C           @BCLTY    WHEQ '3'                                       CSW003
     C                     MOVE DTDRF2    T1SAFA                          CSW003
     C                     MOVEL'/'       T1SAFA                          CSW003
     C           @BCLTY    WHEQ '4'                                       CSW003
     C           DTCLAS    ANDEQ'E'                                       CSW003
     C                     MOVE DTDRF1    T1SAFA                          CSW003
     C                     MOVEL'/'       T1SAFA                          CSW003
     C           @BCLTY    WHEQ '2'                                       CSW003
     C           DTCLAS    ANDEQ'C'                                       CSW003
     C                     MOVE DTDRF2    T1SAFA                          CSW003
     C                     MOVEL'/'       T1SAFA                          CSW003
     C                     ENDSL                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Set Settlement Message Request Indicator to 'Y'?                 CSW003
     C                     MOVE 'N'       T1GMEC                                            AR632291
     C                     MOVE 'N'       T1GMES                          CSW003
     C                     EXSR SMSGR                                     CSW003
      *                                                                   CSW003
      ** Settlement Message Request Indicator (if not UNROUTABLE).        CSW003
     C           T1GMES    IFEQ 'Y'                                       CSW003
     C           @C1DI     IFEQ 'S'                                       CSW003
     C           @BDELT    ANDEQ@BDELF                                    CSW003
     C           @C1DI     OREQ 'D'                                       CSW003
     C           @BDELT    ANDEQ@BDELF                                    CSW003
     C                     MOVE 'N'       T1GMES                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     WRITETRADSDD1                                  CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /TITLE SR/SMSGR                                                     CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      * SMSGR - Leave Settlement Message Request Indicator set to 'N' *   CSW003
      *         if Euroclear/Cedel Code, Safekeeping A/c, Instruction *   CSW003
      *         Type or Sub-Type are invalid.                         *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           SMSGR     BEGSR                                          CSW003
      *                                                                   CSW003
     C                     DO                                             CSW003
      *                                                                   CSW003
      ** Safekeeping A/c                                                  CSW003
     C           T1WHEN    IFNE 'B'                                       CSW003
     C           B1SAFA    IFEQ '/'                                       CSW003
     C                     LEAVE                                          CSW003
     C                     ENDIF                                          CSW003
      * Else second record                                                CSW003
     C                     ELSE                                           CSW003
     C           T1SAFA    IFEQ '/'                                       CSW003
     C                     LEAVE                                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Euroclear/Cedel Code                                             CSW003
     C                     MOVEA*BLANKS   ECC,1                           CSW003
     C           T1WHEN    IFNE 'B'                                       CSW003
     C                     MOVEAB1EUCL    ECC,1                           CSW003
     C           ECC,5     IFEQ *BLANKS                                   CSW003
     C                     LEAVE                                          CSW003
     C                     ENDIF                                          CSW003
      * Else second record                                                CSW003
     C                     ELSE                                           CSW003
     C                     MOVEAT1EUCL    ECC,1                           CSW003
     C           ECC,5     IFEQ *BLANKS                                   CSW003
     C                     LEAVE                                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Instructions type and Instructions sub-type                      CSW003
      ** Determine Network routing and addresses/settlements              CSW003
     C           T1WHEN    IFNE 'B'                                       CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
     C                     MOVE @BDELT    WSNDR   6                       CSW003
     C                     MOVE @BDELT    WDEST   6                       CSW003
     C                     ELSE                                           CSW003
     C                     MOVE @BDELF    WSNDR                           CSW003
     C                     MOVE @BDELF    WDEST                           CSW003
     C                     ENDIF                                          CSW003
      * Else second record                                                CSW003
     C                     ELSE                                           CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
     C                     MOVE @BDELF    WSNDR                           CSW003
     C                     MOVE @BDELF    WDEST                           CSW003
     C                     ELSE                                           CSW003
     C                     MOVE @BDELT    WSNDR                           CSW003
     C                     MOVE @BDELT    WDEST                           CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     MOVE *BLANKS   WSCSD  12                       CSW003
     C                     MOVE @BSMTH    WSETP   2                       CSW003
      *                                                                   CSW003
     C                     EXSR SR1100                                    CSW003
      *                                                                   CSW003
     C           T1WHEN    IFNE 'B'                                       CSW003
     C                     MOVE WWGME     B1GMES                          CSW003
      * Else second record                                                CSW003
     C                     ELSE                                           CSW003
     C                     MOVE WWGME     T1GMES                          CSW003
     C                     ENDIF
      *                                                                   CSW003
      ** Retrieve Cedel/Euroclear destination                             CSW003
     C                     MOVE *BLANKS   WWSENT  5                       CSW003
     C**********           MOVE WDEST     WWDEST  60                                   CSW003 CSD027
     C                     MOVE WDEST     WWDEST  6                                           CSD027
      *                                                                   CSW003
     C           WWDEST    IFEQ @BDELT                                    CSW003
     C                     SELEC                                          CSW003
     C           DTCLAS    WHEQ 'E'                                       CSW003
     C                     MOVE 'EOC  '   WWSENT                          CSW003
     C           DTCLAS    WHEQ 'C'                                       CSW003
     C                     MOVE 'CEDEL'   WWSENT                          CSW003
     C                     ENDSL                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           WWDEST    IFEQ @BDELF                                    CSW003
     C                     SELEC                                          CSW003
     C           DFCLAS    WHEQ 'E'                                       CSW003
     C                     MOVE 'EOC  '   WWSENT                          CSW003
     C           DFCLAS    WHEQ 'C'                                       CSW003
     C                     MOVE 'CEDEL'   WWSENT                          CSW003
     C                     ENDSL                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** When Trade Purchase                                              CSW003
     C           @BTDTP    IFEQ 'TP'                                      CSW003
     C           T1WHEN    ANDNE'B'                                       CSW003
     C           @BTDTP    OREQ 'TS'                                      CSW003
     C           T1WHEN    ANDEQ'B'                                       CSW003
     C           @BPCOD    IFNE '1'                                       CSW003
     C           @BPCOD    ANDNE'5'                                       CSW003
     C                     MOVEL'RECFREE' WWINST  7                       CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'RECAPMT' WWINST                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** When Trade Sale                                                  CSW003
     C           @BTDTP    IFEQ 'TS'                                      CSW003
     C           T1WHEN    ANDNE'B'                                       CSW003
     C           @BTDTP    OREQ 'TP'                                      CSW003
     C           T1WHEN    ANDEQ'B'                                       CSW003
     C           @BPCOD    IFNE '1'                                       CSW003
     C           @BPCOD    ANDNE'5'                                       CSW003
     C                     MOVEL'DELFREE' WWINST                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVEL'DELAPMT' WWINST                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C           T1WHEN    IFNE 'B'                                       CSW003
     C                     MOVELB1INST    WWINSS  8                       CSW003
     C                     MOVE B1INSS    WWINSS                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVELT1INST    WWINSS                          CSW003
     C                     MOVE T1INSS    WWINSS                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
      ** Key: Destination, Trade type, Pay code, Instructions type        CSW003
      **      and sub-type                                                CSW003
     C                     MOVEL*BLANKS   KMGECO 20                       CSW003
     C                     MOVELWWGECO    KMGECO                          CSW003
      *                                                                   CSW003
      ** Check the following for MT580 only                               CSW003
     C           WWSENT    IFEQ 'CEDEL'                                   CSW003
     C           WWSENT    OREQ 'EOC  '                                   CSW003
      *                                                                   CSW003
      ** Check instructions sub-type depending of type of delivering      CSW003
     C           KMGECO    CHAINMGECONL0             86                   CSW003
      *                                                                   CSW003
     C           *IN86     IFEQ *ON                                       CSW003
     C           T1WHEN    IFEQ 'B'                                       CSW003
     C                     MOVE 'N'       T1GMES                          CSW003
     C                     ELSE                                           CSW003
     C                     MOVE 'N'       B1GMES                          CSW003
     C                     ENDIF                                          CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDIF                                          CSW003
      *                                                                   CSW003
     C                     ENDDO                                          CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      /EJECT                                                              CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      *  SR1100 - Determine Network and Addresses.                    *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           SR1100    BEGSR                                          CSW003
      *                                                                   CSW003
     C                     MOVE *BLANKS   WNWSN  20                       CSW003
     C                     MOVE *BLANKS   WNWDS  22                       CSW003
     C                     MOVE *BLANKS   WNWRK   6                       CSW003
     C                     MOVE *BLANKS   WERRC   1                       CSW003
     C                     MOVE *BLANKS   WSRNM  20                       CSW003
     C                     MOVE *BLANKS   WSRTN  10                       CSW003
     C                     MOVE *BLANKS   WDRNM  20                       CSW003
     C                     MOVE *BLANKS   WDRTN  10                       CSW003
      *                                                                   CSW003
     C                     CALL 'ZM1100'               50                 CSW003
     C                     PARM           WSNDR                           CSW003
     C                     PARM           WSCSD                           CSW003
     C                     PARM           WDEST                           CSW003
     C                     PARM           WSETP                           CSW003
     C                     PARM           WNWSN                           CSW003
     C                     PARM           WNWDS                           CSW003
     C                     PARM           WNWRK                           CSW003
     C                     PARM           WERRC                           CSW003
     C                     PARM           WSRNM                           CSW003
     C                     PARM           WSRTN                           CSW003
     C                     PARM           WDRNM                           CSW003
     C                     PARM           WDRTN                           CSW003
      *                                                                   CSW003
     C           *IN50     IFEQ '1'                                       CSW003
     C           WERRC     OREQ 'S'                                       CSW003
     C           WERRC     OREQ 'D'                                       CSW003
     C           WNWRK     OREQ 'UNROUT'                                  CSW003
     C                     MOVE 'N'       WWGME   1                       CSW003
     C                     ELSE                                           CSW003
      *                                                                   CSW003
     C                     MOVE 'Y'       WWGME                           CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
      *****************************************************************   CSW003
      *                                                               *   CSW003
      *  EUCLF  - Remove leading blanks from Euroclear/Cedel Code     *   CSW003
      *                                                               *   CSW003
      *****************************************************************   CSW003
      *                                                                   CSW003
     C           EUCLF     BEGSR                                          CSW003
      *                                                                   CSW003
      ** If the array is empty, do not try to remove leading blanks       CSW003
      ** Otherwise, following existing logic.                             CSW003
     C                     MOVEAEUCLA     W0EUCL  6                       CSW003
     C           W0EUCL    IFEQ *BLANK                                    CSW003
     C                     MOVEL*BLANK    WKEUCL                          CSW003
     C                     ELSE                                           CSW003
     C                     Z-ADD1         I                               CSW003
     C           I         DOWLE6                                         CSW003
     C           EUCLA,I   ANDEQ*BLANK                                    CSW003
     C                     ADD  1         I                               CSW003
     C                     ENDDO                                          CSW003
     C                     MOVEAEUCLA,I   EUCLB     P                     CSW003
     C                     MOVEAEUCLB     WKEUCL    P                     CSW003
     C                     END                                            CSW003
      *                                                                   CSW003
     C                     ENDSR                                          CSW003
      *                                                                   CSW003
     C*****************************************************************   CSW003
     C*  SUB508 - Subroutine to update trade trailer                  *
     C*****************************************************************
     C           SUB508    BEGSR
     C*
     C           1         CHAINTRADSAF              12
     C           *IN12     IFEQ '0'
     C           @BCHTP    IFEQ 'I'
     C                     ADD  1         SINS
     C                     ADD  1         NORE
     C                     ELSE
     C                     ADD  1         SDEL
     C                     END
     C                     UPDATTRADSAF
     C                     ELSE
     C                     MOVEL@ER,15    @ERRTX
     C                     END
     C*
     C                     ENDSR                           SUB508 ends
     C*                                                                   S01176
      /EJECT
     C********************************************************************
     C*  SUB600 - Subroutine to calculate the latest Book positions      *
     C********************************************************************
     C           SUB600    BEGSR
     C*
     C* Initialise and fetch correct work field for result
     C                     Z-ADD0         WCONS  150
     C                     Z-ADD0         WCONS0 150
     C                     Z-ADD0         WCONS1 151
     C                     Z-ADD0         WCONS2 152
     C                     Z-ADD0         WCONS3 153
     C                     MOVEA'0000'    *IN,25
     C           25        ADD  NOMDP     J       20
     C                     MOVEA'1'       *IN,J
     C*
     C*  Calculate consideration/reallowance/charges/commission
     C   25      @BPRIC    MULT @BNOML    WCONS0    H
     C   26      @BPRIC    MULT @BNOML    WCONS1    H
     C   27      @BPRIC    MULT @BNOML    WCONS2    H
     C   28      @BPRIC    MULT @BNOML    WCONS3    H
     C*
     C           SPBS      IFEQ 'P'
     C   25                DIV  100       WCONS0
     C   26                DIV  100       WCONS1
     C   27                DIV  100       WCONS2
     C   28                DIV  100       WCONS3
     C                     END
     C*
     C***********PROT      IFEQ '8'                                       054259
     C***25******          MULT @BTCFC    WCONS0    H                     054259
     C***26******          MULT @BTCFC    WCONS1    H                     054259
     C***27******          MULT @BTCFC    WCONS2    H                     054259
     C***28******          MULT @BTCFC    WCONS3    H                     054259
     C***********          END                                            054259
     C*
     C   25                MOVE WCONS0    WCONS
     C   26                MOVE WCONS1    WCONS
     C   27                MOVE WCONS2    WCONS
     C   28                MOVE WCONS3    WCONS
     C*
     C*   Allow for nominal decimal places
     C           5         SUB  @BTNMD    DC
     C           WCONS     MULT POWER8,DC WCONS
     C*
     C                     Z-ADD0         WRALL  150
     C                     Z-ADD0         WRALL0 150
     C                     Z-ADD0         WRALL1 151
     C                     Z-ADD0         WRALL2 152
     C                     Z-ADD0         WRALL3 153
     C***********RBAP      IFEQ 'Y'                                       S01117
     C           BVRBAP    IFEQ 'Y'                                       S01117
     C   25      WDRALL    MULT @BNOML    WRALL0    H
     C   26      WDRALL    MULT @BNOML    WRALL1    H
     C   27      WDRALL    MULT @BNOML    WRALL2    H
     C   28      WDRALL    MULT @BNOML    WRALL3    H
     C*
     C           SPBS      IFEQ 'P'
     C   25                DIV  100       WRALL0
     C   26                DIV  100       WRALL1
     C   27                DIV  100       WRALL2
     C   28                DIV  100       WRALL3
     C                     END
     C*
     C   25                MOVE WRALL0    WRALL
     C   26                MOVE WRALL1    WRALL
     C   27                MOVE WRALL2    WRALL
     C   28                MOVE WRALL3    WRALL
     C*
     C*   Allow for nominal decimal places
     C           5         SUB  @BTNMD    DC
     C           WRALL     MULT POWER8,DC WRALL
     C                     END
     C*
     C                     Z-ADD0         WCHRG  150
     C***********CBAP      IFEQ 'Y'                                       S01117
     C           BVCBAP    IFEQ 'Y'                                       S01117
     C           @BTCA1    ADD  @BTCA2    WCHRG
     C                     ADD  @BTCA3    WCHRG
     C                     ADD  @BTCA4    WCHRG                           S01176
     C                     ADD  @BTCA5    WCHRG                           S01176
     C                     ADD  @BTCA6    WCHRG                           S01176
     C                     ADD  @BTCA7    WCHRG                           S01176
     C                     ADD  @BTAXA    WCHRG                           S01176
     C                     ADD  @BBCMR    WCHRG                           S01176
     C                     ADD  @BCCMR    WCHRG                           S01176
     C                     ADD  @BTXRB    WCHRG                           S01176
     C***********          ADD  @BTOCA    WCHRG                           S01176
     C***********          ADD  @BTLTA    WCHRG                           S01176
     C***********          ADD  @BLTCA    WCHRG                           S01176
     C***********          ADD  @BTPCA    WCHRG                           S01176
     C***********          ADD  @BTVCA    WCHRG                           S01176
     C                     END
     C*
     C                     Z-ADD0         WCOMM  150
     C***********COBP      IFEQ 'Y'                                       S01117
     C           BVCMBP    IFEQ 'Y'                                       S01117
     C           @BTBCA    ADD  @BTCCA    WCOMM
     C                     END
     C*
     C*   Insert (purchase)
     C           @BTDTP    IFEQ 'TP'
     C           @BCHTP    IFEQ 'I'
     C*
     C                     ADD  @BNOML    SNPI
     C*
     C                     ADD  WCONS     SANP
     C                     ADD  WRALL     SANP
     C*
     C           @C1DI     IFEQ 'M'
     C                     ADD  WCHRG     SANP
     C                     ADD  WCOMM     SANP
     C                     ELSE
     C                     SUB  WCHRG     SANP
     C                     SUB  WCOMM     SANP
     C                     END
     C*
     C                     ELSE
     C*
     C*  Deletion (purchase)
     C                     SUB  @BNOML    SNPI
     C*
     C                     SUB  WCONS     SANP
     C                     SUB  WRALL     SANP
     C           @C1DI     IFEQ 'M'
     C                     SUB  WCHRG     SANP
     C                     SUB  WCOMM     SANP
     C                     ELSE
     C                     ADD  WCHRG     SANP
     C                     ADD  WCOMM     SANP
     C                     END
     C*
     C                     END
     C*
     C                     ELSE
     C*
     C*   Insert (sale)
     C           @BCHTP    IFEQ 'I'
     C*
     C                     SUB  @BNOML    SNSI
     C*
     C**************       ADD  WCONS     SANS                            S01175
     C**************       ADD  WRALL     SANS                            S01175
     C                     SUB  WCONS     SANS                            S01175
     C                     SUB  WRALL     SANS                            S01175
     C           @C1DI     IFEQ 'M'
     C                     SUB  WCHRG     SANS
     C                     SUB  WCOMM     SANS
     C                     ELSE
     C                     ADD  WCHRG     SANS
     C                     ADD  WCOMM     SANS
     C                     END
     C*
     C                     ELSE
     C*
     C*  Deletion(sale)
     C                     ADD  @BNOML    SNSI
     C*
     C***********          SUB  WCONS     SANS                            065774
     C***********          SUB  WRALL     SANS                            065774
     C                     ADD  WCONS     SANS                            065774
     C                     ADD  WRALL     SANS                            065774
     C           @C1DI     IFEQ 'M'
     C                     ADD  WCHRG     SANS
     C                     ADD  WCOMM     SANS
     C                     ELSE
     C                     SUB  WCHRG     SANS
     C                     SUB  WCOMM     SANS
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR                           SUB600 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB601 - Subroutine to calculate the latest Client positions *
     C*****************************************************************
     C           SUB601    BEGSR
     C*
     C* Fetch correct work field for result
     C                     MOVEA'0000'    *IN,25
     C           25        ADD  NOMDP     J       20
     C                     MOVEA'1'       *IN,J
     C*
     C*  Calculate consideration/reallowance/charges/commission
     C   25      @BPRIC    MULT @BNOML    WCONS0    H
     C   26      @BPRIC    MULT @BNOML    WCONS1    H
     C   27      @BPRIC    MULT @BNOML    WCONS2    H
     C   28      @BPRIC    MULT @BNOML    WCONS3    H
     C*
     C           SPBS      IFEQ 'P'
     C   25                DIV  100       WCONS0
     C   26                DIV  100       WCONS1
     C   27                DIV  100       WCONS2
     C   28                DIV  100       WCONS3
     C                     END
     C*
     C           PROT      IFEQ '8'
     C   25                MULT @BTCFC    WCONS0    H
     C   26                MULT @BTCFC    WCONS1    H
     C   27                MULT @BTCFC    WCONS2    H
     C   28                MULT @BTCFC    WCONS3    H
     C                     END
     C*
     C   25                MOVE WCONS0    WCONS
     C   26                MOVE WCONS1    WCONS
     C   27                MOVE WCONS2    WCONS
     C   28                MOVE WCONS3    WCONS
     C*
     C*  Allow for nominal decimal places
     C           5         SUB  @BTNMD    DC
     C           WCONS     MULT POWER8,DC WCONS
     C*
     C                     Z-ADD0         WRALL
     C***********RCAP      IFEQ 'Y'                                       S01117
     C           BVRCAP    IFEQ 'Y'                                       S01117
     C   25      @BRALL    MULT @BNOML    WRALL0    H
     C   26      @BRALL    MULT @BNOML    WRALL1    H
     C   27      @BRALL    MULT @BNOML    WRALL2    H
     C   28      @BRALL    MULT @BNOML    WRALL3    H
     C*
     C           SPBS      IFEQ 'P'
     C   25                DIV  100       WRALL0
     C   26                DIV  100       WRALL1
     C   27                DIV  100       WRALL2
     C   28                DIV  100       WRALL3
     C                     END
     C*
     C   25                MOVE WRALL0    WRALL
     C   26                MOVE WRALL1    WRALL
     C   27                MOVE WRALL2    WRALL
     C   28                MOVE WRALL3    WRALL
     C*
     C*  Allow for nominal decimal places
     C           5         SUB  @BTNMD    DC
     C           WRALL     MULT POWER8,DC WRALL
     C                     END
     C*
     C                     Z-ADD0         WCHRG
     C***********CCAP      IFEQ 'Y'                                       S01117
     C           BVCCAP    IFEQ 'Y'                                       S01117
     C           @BTCA1    ADD  @BTCA2    WCHRG
     C                     ADD  @BTCA3    WCHRG
     C                     ADD  @BTCA4    WCHRG                           S01176
     C                     ADD  @BTCA5    WCHRG                           S01176
     C                     ADD  @BTCA6    WCHRG                           S01176
     C                     ADD  @BTCA7    WCHRG                           S01176
     C                     ADD  @BTAXA    WCHRG                           S01176
     C                     ADD  @BBCMR    WCHRG                           S01176
     C                     ADD  @BCCMR    WCHRG                           S01176
     C                     ADD  @BTXRB    WCHRG                           S01176
     C***********          ADD  @BTOCA    WCHRG                           S01176
     C***********          ADD  @BTLTA    WCHRG                           S01176
     C***********          ADD  @BLTCA    WCHRG                           S01176
     C***********          ADD  @BTPCA    WCHRG                           S01176
     C***********          ADD  @BTVCA    WCHRG                           S01176
     C                     END
     C*
     C                     Z-ADD0         WCOMM
     C***********COCP      IFEQ 'Y'                                       S01117
     C           BVCMCP    IFEQ 'Y'                                       S01117
     C           @BTBCA    ADD  @BTCCA    WCOMM
     C                     END
     C*
     C*   Trade date basis :-
     C*
     C*   Insert (purchase)
     C           @BTDTP    IFEQ 'TP'
     C           @BCHTP    IFEQ 'I'
     C*
     C                     SUB  @BNOML    SNPT
     C*
     C                     ADD  WCONS     SAPP
     C                     ADD  WRALL     SAPP
     C                     SUB  WCHRG     SAPP
     C                     SUB  WCOMM     SAPP
     C*
     C                     ELSE
     C*
     C*  Deletion (purchase)
     C                     ADD  @BNOML    SNPT
     C*
     C                     SUB  WCONS     SAPP
     C                     SUB  WRALL     SAPP
     C                     ADD  WCHRG     SAPP
     C                     ADD  WCOMM     SAPP
     C*
     C                     END
     C*
     C                     ELSE
     C*
     C*   Insert/amend(sale)
     C           @BCHTP    IFEQ 'I'
     C*
     C                     ADD  @BNOML    CDST
     C*
     C                     ADD  WCONS     SAPS
     C                     ADD  WRALL     SAPS
     C                     ADD  WCHRG     SAPS
     C                     ADD  WCOMM     SAPS
     C*
     C                     ELSE
     C*
     C*  Deletion (sale)
     C                     SUB  @BNOML    CDST
     C*
     C                     SUB  WCONS     SAPS
     C                     SUB  WRALL     SAPS
     C                     SUB  WCHRG     SAPS
     C                     SUB  WCOMM     SAPS
     C*
     C                     END
     C                     END
     C*
     C*   Value date basis :-
     C           @BTDVD    IFLE RUND
     C*
     C*   Insert (purchase)
     C           @BTDTP    IFEQ 'TP'
     C           @BCHTP    IFEQ 'I'
     C*
     C                     SUB  @BNOML    CNPV
     C*
     C                     ADD  WCONS     SAPV
     C                     ADD  WRALL     SAPV
     C                     SUB  WCHRG     SAPV
     C                     SUB  WCOMM     SAPV
     C*
     C                     ELSE
     C*
     C*  Deletion (purchase)
     C                     ADD  @BNOML    CNPV
     C*
     C                     SUB  WCONS     SAPV
     C                     SUB  WRALL     SAPV
     C                     ADD  WCHRG     SAPV
     C                     ADD  WCOMM     SAPV
     C*
     C                     END
     C*
     C                     ELSE
     C*
     C*   Insert/amend(sale)
     C           @BCHTP    IFEQ 'I'
     C*
     C                     ADD  @BNOML    CNSV
     C*
     C                     ADD  WCONS     SPSV
     C                     ADD  WRALL     SPSV
     C                     ADD  WCHRG     SPSV
     C                     ADD  WCOMM     SPSV
     C*
     C                     ELSE
     C*
     C*  Deletion (sale)
     C                     SUB  @BNOML    CNSV
     C*
     C                     SUB  WCONS     SPSV
     C                     SUB  WRALL     SPSV
     C                     SUB  WCHRG     SPSV
     C                     SUB  WCOMM     SPSV
     C*
     C                     END
     C                     END
     C                     END
     C*                                                                   S01176
     C***  Nominal Settled, Input Cycle                                   S01176
     C*                                                                   S01176
     C           @BTDVD    IFLE RUND                                      S01176
     C           @BAUTS    ANDEQ'Y'                                       S01176
     C*                                                                   S01176
     C           @BTDTP    IFEQ 'TP'                                      S01176
     C*                                                                   S01176
     C           @BCHTP    IFEQ 'I'                                       S01176
     C                     SUB  @BNOML    CNSI                            S01176
     C                     ELSE                                           S01176
     C                     ADD  @BNOML    CNSI                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C           @BCHTP    IFEQ 'I'                                       S01176
     C                     ADD  @BNOML    CNSI                            S01176
     C                     ELSE                                           S01176
     C                     SUB  @BNOML    CNSI                            S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C                     END                                            S01176
     C*                                                                   E21604
     C           @BCHTP    IFEQ 'D'                                       E21604
     C           @BTDVD    ANDLERUND                                      E21604
     C           @BAUTS    ANDEQ'N'                                       E21604
     C*                                                                   E21604
     C           TNSN      IFNE 0                                         E21604
     C           TNSP      ORNE 0                                         E21604
     C           TNSN      ADD  TNSP      WORK   150                      E21604
     C*                                                                   E21604
     C           @BTDTP    IFEQ 'TP'                                      E21604
     C                     ADD  WORK      CNSI                            E21604
     C                     ELSE                                           E21604
     C                     SUB  WORK      CNSI                            E21604
     C                     END                                            E21604
     C*                                                                   E21604
     C                     END                                            E21604
     C                     END                                            E21604
     C*
     C                     ENDSR                           SUB601 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB700 - Determine default charge/commission                 *
     C*****************************************************************
     C           SUB700    BEGSR
     C*
     C                     Z-ADD0         @XAMTN 150
     C*                                                                   S01446
     C*  If customer Commissions feature is on, autocharges is on         S01446
     C*  and the charge currency from SE ICD is not blank then set        S01446
     C*  up the parameters for SR/ZCONV which will be called from         S01446
     C*  SR/ZCCAL1.                                                       S01446
     C*  Also pass purchased interest parameter                           S01446
     C*                                                                   S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C           *IN15     ANDEQ'1'                                       S01446
     C           BVCHRC    ANDNE*BLANK                                    S01446
     C                     MOVE BVCHRC    ZCCYI                           S01446
     C                     MOVE NMCYA     ZCCYO                           S01446
     C                     MOVE UCHXRT    ZEXCH                           S01446
     C                     MOVE UCHXMD    ZMD                             S01446
     C                     MOVE UNBDP     ZCDPI                           S01446
     C                     MOVE NOMDP     ZCDPO                           S01446
     C                     ELSE                                           S01446
     C                     MOVE *BLANK    ZCCYI                           S01446
     C                     MOVE *BLANK    ZCCYO                           S01446
     C                     MOVE *ZERO     ZEXCH                           S01446
     C                     MOVE *BLANK    ZMD                             S01446
     C                     MOVE *BLANK    ZCDPI                           S01446
     C                     MOVE *BLANK    ZCDPO                           S01446
     C                     END                                            S01446
     C                     Z-ADD*ZERO     ZTPI                            S01446
     C           S01446    IFEQ 'Y'                                       S01446
     C                     Z-ADD@BITRA    ZTPI                            S01446
     C                     END                                            S01446
     C*
     C           @KEY4     CHAINSECGT                01
     C*
     C**If*not*found,*or*record*ID*invalid,*set*code*to*blank*and***      S01176
     C**return****                                                        S01176
     C************IN01     IFEQ '1'                                       S01176
     C***********RECI      ORNE 'D'                                       S01176
     C***********          MOVEL*BLANKS   @CAM                            S01176
     C***********          END                                            S01176
     C*
     C* If record found, calculate amount if trade type matches levied on
     C* indicator
     C           *IN01     IFEQ '0'
     C           RECI      ANDEQ'D'
     C*
     C           @BTDTP    IFEQ 'TP'
     C*                                                                   S01176
     C           LPSI      IFEQ 'P'
     C           LPSI      OREQ *BLANKS
     C                     MOVE CHGB      ZCHGB                           S01176
     C                     MOVE THRI      ZTHRI                           S01176
     C                     Z-ADD@RA       ZRA                             S01176
     C                     Z-ADD@PC       ZPC                             S01176
     C                     Z-ADD@CG       ZCG                             S01176
     C                     Z-ADDMNCH      ZMNCH                           S01176
     C                     Z-ADDMXCH      ZMXCH                           S01176
     C***********          EXSR SUB701                                    S01176
     C*                                                                   S01176
     C*  NOMINAL CURRENCY DECIMAL PLACES                                  S01176
     C*                                                                   S01176
     C                     Z-ADDNOMDP     ZDECS                           S01176
     C*                                                                   S01176
     C*  NOMINAL DECIMAL PLACES                                           S01176
     C*                                                                   S01176
     C                     Z-ADDNMDP      ZNMDP                           S01176
     C*                                                                   S01176
     C*  PRICE                                                            S01176
     C*                                                                   S01176
     C                     MOVE *BLANKS   ZFIELD                          S01176
     C*                                                                   S01176
     C*  If trade basis indicator is set for Yield or Discount (Y or D).. S01176
     C*                                                                   S01176
     C           STBS      IFEQ 'D'                                       S01176
     C           STBS      OREQ 'Y'                                       S01176
     C*                                                                   S01176
     C                     Z-ADD@BPRIC    ZPRICE                          S01176
     C*                                                                   S01176
     C*  else if set for Price (P)....                                    S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     MOVE @BTPDY    ZPRICE                          S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C*  NOMINAL                                                          S01176
     C*                                                                   S01176
     C                     Z-ADD@BNOML    ZNOML                           S01176
     C*                                                                   S01176
     C*  SECURITY DETAILS                                                 S01176
     C*                                                                   S01176
     C           @BCHTP    IFEQ 'I'                                       S01176
     C*                                                                   S01176
     C                     Z-ADDCFCT      ZTCFC                           S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCFC    ZTCFC                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     MOVE SPBS      ZSPBS                           S01176
     C                     MOVE PROT      ZPROT                           E39495
     C                     Z-ADDSFPP      ZSFPP                           E39495
     C*                                                                   S01176
     C                     EXSR ZCCAL1                                    S01176
     C                     Z-ADDZCHGA     @XAMTN
     C                     END
     C*                                                                   S01176
     C                     ELSE
     C*                                                                   S01176
     C           LPSI      IFEQ 'S'
     C           LPSI      OREQ *BLANKS
     C                     MOVE CHGB      ZCHGB                           S01176
     C                     MOVE THRI      ZTHRI                           S01176
     C                     Z-ADD@RA       ZRA                             S01176
     C                     Z-ADD@PC       ZPC                             S01176
     C                     Z-ADD@CG       ZCG                             S01176
     C                     Z-ADDMNCH      ZMNCH                           S01176
     C                     Z-ADDMXCH      ZMXCH                           S01176
     C***********          EXSR SUB701                                    S01176
     C*                                                                   S01176
     C*  NOMINAL CURRENCY DECIMAL PLACES                                  S01176
     C*                                                                   S01176
     C                     Z-ADDNOMDP     ZDECS                           S01176
     C*                                                                   S01176
     C*  NOMINAL DECIMAL PLACES                                           S01176
     C*                                                                   S01176
     C                     Z-ADDNMDP      ZNMDP                           S01176
     C*                                                                   S01176
     C*  PRICE                                                            S01176
     C*                                                                   S01176
     C                     MOVE *BLANKS   ZFIELD                          S01176
     C*                                                                   S01176
     C*  If trade basis indicator is set for Yield or Discount (Y or D).. S01176
     C*                                                                   S01176
     C           STBS      IFEQ 'D'                                       S01176
     C           STBS      OREQ 'Y'                                       S01176
     C*                                                                   S01176
     C                     Z-ADD@BPRIC    ZPRICE                          S01176
     C*                                                                   S01176
     C*  else if set for Price (P)....                                    S01176
     C*                                                                   S01176
     C                     ELSE                                           S01176
     C*                                                                   S01176
     C                     MOVE @BTPDY    ZPRICE                          S01176
     C*                                                                   S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C*  NOMINAL                                                          S01176
     C*                                                                   S01176
     C                     Z-ADD@BNOML    ZNOML                           S01176
     C*                                                                   S01176
     C*  SECURITY DETAILS                                                 S01176
     C*                                                                   S01176
     C           @BCHTP    IFEQ 'I'                                       S01176
     C*                                                                   S01176
     C                     Z-ADDCFCT      ZTCFC                           S01176
     C                     ELSE                                           S01176
     C                     Z-ADD@BTCFC    ZTCFC                           S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     MOVE SPBS      ZSPBS                           S01176
     C                     MOVE PROT      ZPROT                           E39495
     C                     Z-ADDSFPP      ZSFPP                           E39495
     C                     EXSR ZCCAL1                                    S01176
     C                     Z-ADDZCHGA     @XAMTN                          S01176
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR                           SUB700 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  SUB701 - Calculate charge amounts                            *
     C*                                                               *   S01176
     C*    THIS SUBROUTINE HAS BEEN REPLACED BY SUBROUTINE ZCCAL1.    *   S01176
     C*                                                               *   S01176
     C*****************************************************************
     C***********SUB701    BEGSR                                          S01176
     C***********          ENDSR                           SUB701 ends    S01176
      /SPACE                                                              S01176
     C*****************************************************************
     C*  SUB702 - Calculate tiered charge amounts                     *
     C*                                                               *   S01176
     C*    THIS SUBROUTINE HAS BEEN REPLACED BY SUBROUTINE ZCCAL2.    *   S01176
     C*                                                               *   S01176
     C*****************************************************************
     C***********SUB702    BEGSR                                          S01176
     C***********END702    ENDSR                           SUB702 ends    S01176
      /SPACE                                                              S01176
     C*****************************************************************
     C*  SUB703 - Determine VAT charges                               *
     C*                                                               *   S01176
     C*    THIS SUBROUTINE HAS BEEN DELETED BECAUSE IT IS OBSOLETE.   *   S01176
     C*                                                               *   S01176
     C*****************************************************************
     C***********SUB703    BEGSR                                          S01176
     C***********          ENDSR                           SUB703 ends    S01176
      /SPACE                                                              S01176
     C*****************************************************************
     C*  SUB704 - Calculate VAT charge amounts                        *
     C*                                                               *   S01176
     C*    THIS SUBROUTINE HAS BEEN DELETED BECAUSE IT IS OBSOLETE.   *   S01176
     C*                                                               *   S01176
     C*****************************************************************
     C***********SUB704    BEGSR                                          S01176
     C***********          ENDSR                           SUB704 ends    S01176
      /SPACE
     C*****************************************************************
     C*  SUB705 - Calculate tiered VAT amounts                        *
     C*                                                               *   S01176
     C*    THIS SUBROUTINE HAS BEEN DELETED BECAUSE IT IS OBSOLETE.   *   S01176
     C*                                                               *   S01176
     C*****************************************************************
     C***********SUB705    BEGSR                                          S01176
     C***********END705    ENDSR                           SUB705 ends    S01176
     C********************************************************************
      /EJECT                                                              S01269
     C******************************************************************* S01269
     C*          SUB800 - WRITE RECORD TO PF/TRAUTD                     * S01269
     C*                                                                 * S01269
     C*          CALLED BY SUB201                                       * S01269
     C******************************************************************* S01269
     C           SUB800    BEGSR                                          S01269
     C                     MOVE 'D'       RECI                            S01269
     C                     MOVE TDRF      TRDRF                           S01269
     C           @BCHTP    IFEQ 'I'                                       S01269
     C                     MOVE 'IN'      TATYP                           S01269
     C                     MOVE *BLANKS   TDRI                            S01269
     C                     END                                            S01269
     C           @BCHTP    IFEQ 'D'                                       S01269
     C                     MOVE 'DL'      TATYP                           S01269
     C                     MOVE XRECI     TDRI                            S01269
     C                     END                                            S01269
     C                     MOVE @USR      TAUSR                           S01269
     C                     MOVE RUND      TADT                            S01269
     C                     TIME           TATM1   60                      S01269
     C                     MOVE TATM1     TATM                            S01269
     C                     WRITETRAUTDF                                   S01269
     C                     ENDSR                                          S01269
     C******************************************************************* S01269
      /EJECT
      *******************************************************************                     CSE039
      *          SUB805 - WRITE RECORD TO PF/SEMVTSPD                   *                     CSE039
      *                                                                 *                     CSE039
      *          CALLED BY SUB201                                       *                     CSE039
      *******************************************************************                     CSE039
     C           SUB805    BEGSR                                                              CSE039
     C                     MOVELTDRF      TMTRRF                                              CSE039
     C                     MOVEL'T'       TMTRTY                                              CSE039
     C                     Z-ADDRUND      TMNTDT                                              CSE039
     C                     MOVELTDRF      KTRRF                                             BUG10273
     C                     MOVEL'T'       KTRTY                                             BUG10273
     C                     Z-ADDRUND      KNTDT                                             BUG10273
      *                                                                                     BUG10273
     C           KMVTS     CHAINSEMVTSL0             01                                     BUG10273
      *                                                                                     BUG10273
     C           *IN01     IFEQ *ON                                                         BUG10273
     C                     Z-ADD1         TMSQNR                                              CSE039
     C                     ELSE                                                             BUG10273
     C           MVSQNR    ADD  1         TMSQNR                                            BUG10273
     C                     ENDIF                                                            BUG10273
      *                                                                                     BUG10273
     C                     SELEC                                                            BUG10273
     C           @BCHTP    WHEQ 'I'                                                         BUG10273
     C                     MOVEL'INS'     TMSWSC                                              CSE039
     C           @BCHTP    WHEQ 'D'                                                         BUG10273
     C                     MOVEL'DEL'     TMSWSC                                            BUG10273
     C                     ENDSL                                                            BUG10273
      *                                                                                     BUG10273
     C                     MOVEL*BLANKS   TMSWRC                                              CSE039
     C                     MOVEL*BLANKS   TMNTMT                                              CSE039
     C                     MOVEL*BLANKS   TMLCUS                                              CSE039
     C                     MOVEL'MIDAS'   TMINOR                                              CSE039
     C                     MOVEL*BLANKS   TMMSGK                                              CSE039
     C                     MOVEL*BLANKS   TMSTMG                                              CSE039
     C                     MOVEL*BLANKS   TMNARR                                              CSE039
     C                     MOVEL'I'       TMLCTP                                              CSE039
     C                     Z-ADDRUND      TMLCDT                                              CSE039
     C                     MOVELTDBA      TMTRBB                                              CSE039
     C                     MOVELTMMP,1    TMTMST                                              CSE039
     C                     MOVE @USR      TMLCUS                                              CSE039
      *                                                                                       CSE039
     C                     WRITESEMVTSD0                                                      CSE039
      *                                                                                       CSE039
     C                     ENDSR                                                              CSE039
      *                                                                                       CSE039
      *******************************************************************
     C*          SUB801 - CONVERT COUNTERVALUE (NOM CURR) TO BASE CURR  * S01269
     C*                                                                 * S01269
     C*          CALLED BY SUB201,SUB300                                * S01269
     C*          INPUT FIELD : Countervalue (TCTR)                      * S01269
     C*          OUTPUT FIELD : Converted countervalue (CTCTR)          * S01269
     C*                                                                 * S01269
     C******************************************************************* S01269
     C           SUB801    BEGSR                                          S01269
      *                                                                   S01269
      * Convert Countervalue(in nominal curr) to base currency            S01269
      *                                                                   S01269
     C                     MOVE TCTR      ZAMTCI                          S01269
     C                     MOVE TBCR      ZEXCH                           S01269
      *                                                                   S01269
      ****CHAIN*TO*PF/TABTG10*ON*NOMINAL*CURRENCY******************S01269 S01117
      ***********                                                  S01269 S01117
      **Format*Key*for*chaining*on*to*PF/tabtg10*******************S01269 S01117
     C***********          MOVEL'20      'TKEY   12                S01269 S01117
     C***********          MOVELTNMC      ZWK4    4                S01269 S01117
     C***********          MOVE 1         ZWK4                     S01269 S01117
     C***********          MOVE ZWK4      TKEY                     S01269 S01117
     C***********                                                  S01269 S01117
     C***********TKEY      CHAINTABTG10F             84            S01269 S01117
     C***********                                                  S01269 S01117
     C***********MDIN      IFEQ 1                                  S01269 S01117
     C***********          MOVE 'D'       ZMD                      S01269 S01117
     C***********          ELSE                                    S01269 S01117
     C***********          MOVE 'M'       ZMD                      S01269 S01117
     C***********          END                                     S01269 S01117
     C                     MOVE TNMC      ZCCYI                           S01269
     C***********          MOVE BCCY      ZCCYO                    S01269 S01117
     C                     MOVE NOMDP     ZCDPI                           S01117
      *                                                                   S01117
     C                     MOVE BJCYCD    ZCCYO                           S01117
      *                                                                   S01117
      *  Get Base currency decimal places                                 S01117
      *                                                                   S01117
     C           BJCYCD    IFNE NMCYA                                     S01117
     C                     MOVE BJCYCD    @AJCD                           S01117
     C                     MOVE 'MSG    ' @RTCD                           S01117
     C                     EXSR AOCURR                                    S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     Z-ADD17        @DBASE           ***************S01117
     C                     MOVEL'SDCURRPD'@DBFIL           * DB ERROR 17 *S01117
     C                     MOVEL'BJCYCD'  @DBKEY           ***************S01117
     C                     EXSR SUB999                                    S01117
     C                     END                                            S01117
     C                     MOVE A6NBDP    ZCDPO                           S01117
     C                     ELSE                                           S01117
     C                     MOVE NOMDP     ZCDPO                           S01117
     C                     END                                            S01117
     C                     EXSR ZCONV                                     S01269
     C                     MOVE ZAMTCO    CTCTR  150                      S01269
     C*                                                                   S01269
     C                     ENDSR                                          S01269
     C*                                                                   S01269
     C******************************************************************* S01269
      /EJECT                                                              S01510
      *****************************************************************   S01510
      *                                                               *   S01510
      *  SUB509 - Determine Ex-Dividend Indicator default.            *   S01510
      *                                                               *   S01510
      *****************************************************************   S01510
      *                                                                   S01510
     C           SUB509    BEGSR                                          S01510
     C*                                                                   S01510
     C                     MOVEL'C'       @BEXDV                          S01510
     C*                                                                   S01510
     C* Must access diary events via ZNDD, then use ex-date from diary.   S01510
     C                     Z-ADD@BTDDT    ECD                             S01510
     C                     EXSR ZNDD                                      S01510
     C*                                                                   S01510
     C           NDD       IFNE *ZEROS                                    S01510
     C                     Z-ADD0         ZDYNBR                          S01510
     C*                                                                   S01510
     C           S01510    IFEQ 'Y'                                       S01510
     C* If diary event found, use ex-date from it.                        S01510
     C           *IN99     IFEQ '0'                                       S01510
     C           SDSN      ANDEQSESN                                      S01510
     C                     Z-ADDSDXD      ZDYNBR                          S01510
     C                     ELSE                                           S01510
     C* Calculate ex-date using default days from security.               S01510
     C                     MOVELEDFT      ZNRDYS                          S01510
     C           ZNRDYS    IFNE *ZEROS                                    S01510
     C                     MOVE EDFT      @WEDFT  1                       S01510
     C           @WEDFT    IFEQ 'W'                                       S01510
     C                     Z-ADDNDD       ZDAYNO                          S01510
     C                     MOVE VLCY      ZCCY                            S01510
     C                     MOVE *BLANKS   ZLOC                            S01510
     C                     EXSR ZBKDT                                     S01510
     C                     ELSE                                           S01510
     C           NDD       SUB  ZNRDYS    ZDYNBR                          S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C*                                                                   S01510
     C                     ELSE                                           S01510
     C* Calculate ex-date using default days from security.               S01510
     C                     MOVELEDFT      ZNRDYS                          S01510
     C           ZNRDYS    IFNE *ZEROS                                    S01510
     C                     MOVE EDFT      @WEDFT  1                       S01510
     C           @WEDFT    IFEQ 'W'                                       S01510
     C                     Z-ADDNDD       ZDAYNO                          S01510
     C                     MOVE NMCYA     ZCCY                            S01510
     C                     MOVE *BLANKS   ZLOC                            S01510
     C                     EXSR ZBKDT                                     S01510
     C                     ELSE                                           S01510
     C           NDD       SUB  ZNRDYS    ZDYNBR                          S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C                     END                                            S01510
     C*                                                                   S01510
     C* Note: Swiss dividends are based on TRADE DATE positions.          S01510
     C           @BTDDT    IFLT NDD                                       S01510
     C           @BTDDT    ANDGEZDYNBR                                    S01510
     C           ZDYNBR    ANDNE0                                         S01510
     C                     MOVEL'X'       @BEXDV                          S01510
     C                     END                                            S01510
      *                                                                   S01510
     C                     END                                            S01510
      *                                                                   S01510
     C                     ENDSR                           SUB509 Ends    S01510
      *                                                                   S01510
      *****************************************************************   S01510
      /EJECT                                                              CSE023
      *****************************************************************   CSE023
      *                                                               *   CSE023
      *  SUB106 - Calculate Withholding Tax                           *   CSE023
      *                                                               *   CSE023
      *****************************************************************   CSE023
     C           SUB106    BEGSR                                          CSE023
      *                                                                   CSE023
     C                     MOVE @BTCNR    @WCSNM                          CSE023
     C                     EXSR AOCUST                                    CSE023
      *                                                                   CSE023
     C                     MOVE @BTCNR    @WCUST                          CSE023
     C                     EXSR AOSECS                                    CSE023
      *                                                                   CSE023
      ** Chain to LF/SDWTCSL0 to obtain field 'backup withholding         CSE023
      ** applicable'                                                      CSE023
      *                                                                   CSE023
     C           BFCLAS    IFEQ 'S'                                       CSE023
     C           BFCLAS    OREQ 'D'                                       CSE023
     C                     MOVE @BTCNR    KTCNR   6                       CSE023
     C           KWTCS     CHAIN@WTCSL1              35                   CSE023
     C           *IN35     IFEQ *ON                                       CSE023
     C           WHBCWA    OREQ 'Y'                                       CSE023
     C                     MOVE SITP      KSITP                           CSE023
     C           KWHTT     CHAIN@WHTTL5              35                   CSE023
     C           *IN35     IFEQ *ON                                       CSE023
     C                     MOVE *BLANKS   KSITP                           CSE023
     C           KWHTT     CHAIN@WHTTL5              35                   CSE023
     C           *IN35     IFEQ *ON                                       CSE023
     C                     MOVELCRTT      WKEY1   5                       CSE023
     C                     MOVE KSITP     WKEY1                           CSE023
     C                     Z-ADD81        @DBASE                          CSE023
     C                     MOVEL'SDWHTTPD'@DBFIL                          CSE023
     C                     MOVELWKEY1     @DBKEY                          CSE023
     C                     EXSR SUB999                                    CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C           KTXBS     SETGT@TXBSL1                                   CSE023
     C                     READP@TXBSL1                  35               CSE023
      *                                                                   CSE023
      ** Calculate withholding tax                                        CSE023
      *                                                                   CSE023
     C           CRTT      IFEQ TBCRTT                                    CSE023
     C           WTDRBW    ANDEQTBTXBS                                    CSE023
      *                                                                   CSE023
     C           ZCTRVL    MULT TBTRAB    WTAX   130H                     CSE023
     C           WTAX      DIV  100       WTAX                            CSE023
     C           ZCTRVL    SUB  WTAX      ZCTRVL                          CSE023
      *                                                                   CSE023
     C                     Z-ADDWTAX      WHTX                            CSE023
     C                     MOVE 'Y'       BWDI                            187727
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
     C                     ENDIF                                          CSE023
      *                                                                   CSE023
     C                     ENDSR                                          CSE023
      *****************************************************************   CSE023
      /EJECT
     C*****************************************************************
     C*  SUB999 - Database error handling                             *
     C*****************************************************************
     C           SUB999    BEGSR
     C*
     C***********          ROLBK                                          S01117
     C***********          DUMP                                           S01117
     C                     MOVEL@DBALL    @DBSAV
     C           *LOCK     IN   LDA
     C                     MOVEL@DBSAV    @DBALL
     C                     MOVEL'SE3003'  @DBPGM
     C                     OUT  LDA
     C                     SETON                     U7U8LR
     C*
     C***********          OPEN SE3003P1                                  S01117
     C                     OPEN SE3003AU                                  S01117
     C                     WRITESE3003R2
     C*
     C*   Call error handling subroutine                                  S01117
     C*                                                                   S01117
     C                     EXSR *PSSR                                     S01117
     C*                                                                   S01117
     C                     RETRN
     C*
     C                     ENDSR                           SUB999 ends
     C*                                                                   S01176
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*  *PSSR - Program error handling                               *
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C* If flag is set, then this is a loop, so exit immediately
     C           @SW       IFEQ '*'
     C                     SETON                     LR
     C                     RETRN
     C                     END
     C*
     C* Set loop flag
     C                     MOVEL'*'       @SW     1
     C*
     C                     ROLBK
     C                     DUMP
     C                     SETON                     U7U8LR
     C                     RETRN
     C*
     C                     ENDSR                           *PSSR ends
     C*
     C*****************************************************************
      /EJECT                                                              S01117
     C*****************************************************************   S01117
     C*  WPRFC  - Create New  Position Profit Centre records          *   S01117
     C*****************************************************************   S01117
     C           WPRFC     BEGSR                           ** WPRFC  **   S01117
     C*                                                                   S01117
     C                     Z-ADD0         NWREC   10                      S01117
     C*                                                                   S01117
     C*  find if new book position profit centre                          S01117
     C*                                                                   S01117
     C                     MOVEL@BTDBK    BOKC                            S01117
     C                     MOVEL@BTDBA    KBRC                            S01117
     C                     MOVEL@BTDSS    KSSN                            S01117
     C                     MOVEL@BTDMI    MKTI                            S01117
     C           KLSPCB    CHAINSEPCBD               01                   S01117
     C*                                                                   S01117
     C*  if not found write new record                                    S01117
     C*                                                                   S01117
     C           *IN01     IFEQ '1'                                       S01117
     C                     MOVEL'D'       RECI                            S01117
     C                     MOVEL@BTDBA    BRCA                            S01117
     C                     MOVEL@BTDSS    SESN                            S01117
     C*                                                                   CAC002
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C                     MOVEL@BPRFC    PCBK                            S01117
     C                     ELSE                                           CAC002
     C                     MOVEL@BBPRC    PCBK                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     Z-ADDRUND      LCD                             S01117
     C                     MOVEL'I'       CHTP                            S01117
     C                     Z-ADDNATN      TNLU                            S01117
     C                     WRITESEPCBDF                                   S01117
     C                     ADD  1         NWREC                           S01117
     C*                                                                   S01117
     C*  if found, and if Trade/Book position profit centre reconciliable S01117
     C*  = Y, if Profit centre is different then it is an error caused    S01117
     C*  by another job creating the profit centre record in the meantime S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C           BVTBRC    IFEQ 'Y'                                       S01117
     C           @BPRFC    ANDNEPCBK                                      S01117
     C           BGN0ST    ANDNE'Y'                                       CAC002
     C           @BBPRC    ORNE PCBK                                      CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C                     SETON                     12                   S01117
     C                     MOVEL@ER,17    @ERRTX                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  find if new customer position profit centre, if portfolio        S01117
     C*    customer                                                       S01117
     C*                                                                   S01117
     C           BFCLAS    IFEQ 'S'                                       S01117
     C           BFCLAS    OREQ 'D'                                       S01117
     C*                                                                   CAC002
     C                     MOVEL@BTCNR    KCNUM                           S01117
     C                     MOVEL@BTDBA    KBRCA                           S01117
     C                     MOVEL@BTDSS    KSESN                           S01117
     C           KLSPCC    CHAINSEPCCD               01                   S01117
     C           *IN01     IFEQ '1'                                       S01117
     C                     MOVEL'D'       RECI                            S01117
     C                     MOVEL@BTCNR    CNUM                            S01117
     C                     MOVEL@BTDBA    BRCA                            S01117
     C                     MOVEL@BTDSS    SESN                            S01117
     C*                                                                   CAC002
     C           BGN0ST    IFNE 'Y'                                       CAC002
     C                     MOVEL@BPRFC    PCCU                            S01117
     C                     ELSE                                           CAC002
     C                     MOVEL@BTPRC    PCCU                            CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C                     Z-ADDRUND      LCD                             S01117
     C                     MOVEL'I'       CHTP                            S01117
     C                     Z-ADDNATN      TNLU                            S01117
     C*                                                                   CAC003
     C** Determine value of PTFRXX                                        CAC003
     C*                                                                   CAC003
     C           BGN0ST    IFEQ 'Y'                                       CAC003
     C           BGPFMG    ANDEQ'Y'                                       CAC003
     C           BGN0ST    OREQ 'Y'                                       CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C                     MOVEL@BPTFR    PTFRXX                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     WRITESEPCCDF                                   S01117
     C                     ADD  1         NWREC                           S01117
     C*                                                                   CAC002
     C*  if found, and if Trade/Book position profit centre reconciliable CAC002
     C*  = N, if Profit centre is different then it is an error caused    CAC002
     C*  by another job creating the profit centre record in the meantime CAC002
     C*                                                                   CAC002
     C                     ELSE                                           CAC002
     C           BVTBRC    IFEQ 'N'                                       CAC002
     C           @BPRFC    ANDNEPCCU                                      CAC002
     C           BGN0ST    ANDNE'Y'                                       CAC002
     C           @BTPRC    ORNE PCCU                                      CAC002
     C           BGN0ST    ANDEQ'Y'                                       CAC002
     C                     SETON                     12                   CAC002
     C                     MOVEL@ER,20    @ERRTX                          CAC002
     C                     ENDIF                                          CAC002
     C                     END                                            S01117
     C*                                                                   CAC002
     C                     END                                            S01117
     C*                                                                   S01117
     C* keep count in audit file                                          S01117
     C*                                                                   S01117
     C           NWREC     IFGT 0                                         S01117
     C***********1         CHAINSEPCA                12            S01117 CAC002
     C************IN12     IFEQ '0'                                S01117 CAC002
     C           1         CHAINSEPCA                01                   CAC002
     C           *IN01     IFEQ '0'                                       CAC002
     C                     ADD  NWREC     SINS                            S01117
     C                     ADD  NWREC     NORE                            S01117
     C                     UPDATSEPCAF                                    S01117
     C                     ELSE                                           S01117
     C                     SETON                     12                   CAC002
     C                     MOVEL@ER,18    @ERRTX                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
     C*                                                                   S01117
     C* AOBANK - Subroutine to call access object : Bank details          S01117
     C*                                                                   S01117
     C           AOBANK    BEGSR                           ** AOBANK **   S01117
     C*                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01195
     C* AOBRCH - Subroutine to call access object : Branch details        S01195
     C*                                                                   S01195
     C           AOBRCH    BEGSR                           ** AOBRCH **   S01195
     C*                                                                   S01195
     C**********           CALL 'AOBRCHR0'                                             S01195 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM           @RTCD   7                       S01195
     C                     PARM '*KEY   ' @OPTN   7                       S01195
     C                     PARM           @DSNB   3                       S01195
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01195 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01195
     C                     ENDSR                                          S01195
     C********************************************************************S01195
     C*                                                                   S01117
     C* AOCURR - Subroutine to call access object : Currency details      S01117
     C*                                                                   S01117
     C           AOCURR    BEGSR                           ** AOCURR **   S01117
     C*                                                                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @AJCD   3                       S01117
     C           SDCURR    PARM SDCURR    DSSDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOCUST - Subroutine to call access object : Customer details      S01117
     C*                                                                   S01117
     C           AOCUST    BEGSR                           ** AOCUST **   S01117
     C*                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @WCSNM 10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOGELR - Subroutine to call access object : General Ledger        S01117
     C*                                                                   S01117
     C           AOGELR    BEGSR                           ** AOGELR **   S01117
     C*                                                                   S01117
     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01117 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AONOST - SUBROUTINE TO CALL ACCESS OBJECT : NOSTRO DETAILS        S01117
     C*                                                                   S01117
     C           AONOST    BEGSR                           ** AONOST **   S01117
     C*                                                                   S01117
     C                     CALL 'AONOSTR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM *BLANKS   P@CUST  6          Customer No  S01117
     C                     PARM           P@CYCD  3          Currency     S01117
     C**********           PARM *BLANKS   P@ACCD  4          A/c Code                  S01117 CGL029
     C                     PARM *BLANKS   P@ACCD 10                                           CGL029
     C                     PARM *BLANKS   P@ACSN  2          A/c Seq      S01117
     C                     PARM           P@NONB  2          Nostro No    S01117
     C                     PARM *BLANKS   P@BRCD  3          Branch Code  S01117
     C                     PARM *BLANKS   P@CSSN 10          Cust ShortN  S01117
     C                     PARM *BLANKS   P@PNOI  1          Prime Nost InS01117
     C           SDNOST    PARM SDNOST    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C/EJECT                                                              CAC002
     C*****************************************************************   CAC002
     C*                                                               *   CAC002
     C*  Subroutine  :  AOPRFC                                        *   CAC002
     C*  Function    :  Access Profit Centre Details                  *   CAC002
     C*                                                               *   CAC002
     C*  Called by   :  SUB100 - Setup Common Defaults                *   CAC002
     C*  Calls       :  AOPRFCR0 - Profit Centre Access Object        *   CAC002
     C*                                                               *   CAC002
     C*****************************************************************   CAC002
     C*                                                                   CAC002
     C           AOPRFC    BEGSR                           ** AOPRFC **   CAC002
     C*                                                                   CAC002
     C                     CALL 'AOPRFCR0'                                CAC002
     C                     PARM *BLANKS   @RTCD                           CAC002
     C                     PARM '*KEY   ' @OPTN                           CAC002
     C                     PARM           WWPRFC  4                       CAC002
     C           SDPRFC    PARM SDPRFC    DSFDY                           CAC002
     C*                                                                   CAC002
     C**  Error if not found                                              CAC002
     C*                                                                   CAC002
     C           @RTCD     IFNE *BLANKS                                   CAC002
     C                     MOVE *ON       *IN12                           CAC002
     C                     MOVEL@ER,21    @ERRTX                          CAC002
     C                     MOVELWWPRFC    @ETF11                          CAC002
     C                     ENDIF                                          CAC002
     C*                                                                   CAC002
     C           AOPRF9    ENDSR                           ** AOPRF9 **   CAC002
     C*                                                                   CAC002
     C*****************************************************************   CAC002
     C/EJECT                                                              CAC002
     C*****************************************************************   CAC002
     C*                                                                   S01117
     C* AOPRFM - SUBROUTINE TO CALL ACCESS OBJECT : DEFAULT PROFIT CENTRE S01117
     C*                                                                   S01117
     C           AOPRFM    BEGSR                           ** AOPRFM **   S01117
     C*                                                                   S01117
     C*  To get the Account officer for the customer to pass to the       179732
     C*  Customer Access Object.                                          179732
     C                     MOVE @BTCNR    @WCSNM                          179732
     C*                                                                   179732
     C                     EXSR AOCUST                                    179732
     C*                                                                   179732
     C                     MOVELBBACOC    @ACOC                           179732
      *                                                                   179732
     C                     CALL 'AOPRFMR0'                                S01117
     C                     PARM *BLANKS   #RTCD   1                       S01117
     C                     PARM @BTDBK    @BKCD   2                       S01117
     C                     PARM           @TRTY   5                       S01117
     C                     PARM @BTSUB    @SBTY   2                       S01117
     C                     PARM @BTDBA    @BRCD   3                       S01117
     C                     PARM *BLANKS   @DPCD   3                       S01117
     C                     PARM @USR      @USID  10                       S01117
     C*******************  PARM *BLANKS   @ACOC   2                S01117 179732
     C                     PARM           @ACOC   2                       179732
     C                     PARM           @WCUST  6                       S01117
     C                     PARM           @PRFC   4                       S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AORETL - Subroutine to call access object : Retail ICD            S01117
     C*                                                                   S01117
     C           AORETL    BEGSR                           ** AORETL **   S01117
     C*                                                                   S01117
     C                     CALL 'AORETLR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDRETL    PARM SDRETL    DSFDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOSECS - Subroutine to call access object : Security customers    S01117
     C*                                                                   S01117
     C           AOSECS    BEGSR                           ** AOSECS **   S01117
     C*                                                                   S01117
     C                     CALL 'AOSECSR0'                                S01117
     C                     PARM           @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM           @WCUST  6                       S01117
     C           SDSECS    PARM SDSECS    DSSDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C* AOSTRD - Subroutine to call access object : Securities Trading    S01117
     C*                                                                   S01117
     C           AOSTRD    BEGSR                           ** AOSTRD **   S01117
     C*                                                                   S01117
     C                     CALL 'AOSTRDR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
      *                                                                   S01401
      *****************************************************************   S01401
      *                                                               *   S01401
      * AOSARD - Subroutine to call access object : Security customers*   S01401
      *                                                               *   S01401
      *****************************************************************   S01401
      *                                                                   S01401
     C           AOSARD    BEGSR                           ** AOSARD **   S01401
      *                                                                   S01401
     C                     CALL 'AOSARDR0'                                S01401
     C                     PARM '       ' @RTCD                           S01401
     C                     PARM '*VERIFY' @OPTN                           S01401
     C******               PARM 'S01401'  @SARD   6                 S01401S01446
     C                     PARM USARN     @SARD   6                       S01446
      *                                                                   S01401
     C                     ENDSR                                          S01401
      *                                                                   S01401
      *****************************************************************   S01117
      /EJECT                                                                                  CSE028
      *****************************************************************                       CSE028
      *                                                               *                       CSE028
      * SRSSIR - Sub-routine to call SESSIR0.                         *                       CSE028
      *                                                               *                       CSE028
      * Called by: SUB100                                             *                       CSE028
      *                                                               *                       CSE028
      * Calls:                                                        *                       CSE028
      *                                                               *                       CSE028
      *****************************************************************                       CSE028
     C           SRSSIR    BEGSR                                                              CSE028
      *                                                                                       CSE028
     C                     MOVE 'N'       NOTFND                                              CSE028
     C                     MOVE @BTCNR    WCUST   6                                           CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP   1                                           CSE028
     C                     PARM           @BTDBA                                              CSE028
     C                     PARM           WCUST                                               CSE028
     C                     PARM           WBKCD   2                                           CSE028
     C                     PARM           WCCY    3                                           CSE028
     C                     PARM           WSMCC   2                                           CSE034
     C                     PARM           WSITP   3                                           CSE028
     C                     PARM           WPTFR   4                                           CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRETCD  5                                           CSE028
      *                                                                                       CSE028
     C           PRETCD    IFNE '*NCRF'                                                       CSE028
     C           PRETCD    ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C           PRETCD    IFNE '*NBRF'                                                       CSE028
     C           PRETCD    ANDNE'*NRF '                                                       CSE028
     C           1         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'Y'       NOTFND  1                                           CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ENDSR                                                              CSE028
      *****************************************************************                       234440
      /EJECT                                                                                  234440
      *****************************************************************                       234440
      *                                                               *                       234440
      *  SRSSEC - Save Security details.                              *                       234440
      *                                                               *                       234440
      *****************************************************************                       234440
     C           SRSSEC    BEGSR                                                              234440
      *                                                                                       234440
     C                     MOVE RECI      RECIA                                               234440
     C                     MOVE CHTP      CHTPA                                               234440
     C                     MOVE LCD       LCDTA                                               234440
     C                     MOVE TNLU      TNLUA                                               234440
     C                     MOVE REPI      REPIA                                               234440
     C                     MOVE REPA      REPAA                                               234440
     C                     MOVE FRNT      FRNTA                                               234440
     C                     MOVE TMST      TMSTA                                               234440
     C                     MOVE CD01      CD01A                                               234440
     C                     MOVE CD02      CD02A                                               234440
     C                     MOVE CD03      CD03A                                               234440
     C                     MOVE CD04      CD04A                                               234440
     C                     MOVE CD05      CD05A                                               234440
     C                     MOVE CD06      CD06A                                               234440
     C                     MOVE CD07      CD07A                                               234440
     C                     MOVE CD08      CD08A                                               234440
     C                     MOVE CD09      CD09A                                               234440
     C                     MOVE CD10      CD10A                                               234440
     C                     MOVE CD11      CD11A                                               234440
     C                     MOVE CD12      CD12A                                               234440
     C                     MOVE CR01      CR01A                                               234440
     C                     MOVE CR02      CR02A                                               234440
     C                     MOVE CR03      CR03A                                               234440
     C                     MOVE CR04      CR04A                                               234440
     C                     MOVE CR05      CR05A                                               234440
     C                     MOVE CR06      CR06A                                               234440
     C                     MOVE CR07      CR07A                                               234440
     C                     MOVE CR08      CR08A                                               234440
     C                     MOVE CR09      CR09A                                               234440
     C                     MOVE CR10      CR10A                                               234440
     C                     MOVE CR11      CR11A                                               234440
     C                     MOVE CR12      CR12A                                               234440
      *                                                                                       234440
     C                     MOVEL@SECTY    @PSECT                                              234440
      *                                                                                       234440
     C                     ENDSR                                                              234440
      *****************************************************************                       234440
      /EJECT                                                                                  234440
      *****************************************************************                       234440
      *                                                               *                       234440
      *  SRSINV - Save Investment Type details.                       *                       234440
      *                                                               *                       234440
      *****************************************************************                       234440
     C           SRSINV    BEGSR                                                              234440
      *                                                                                       234440
     C                     MOVE RECI      RECIB                                               234440
     C                     MOVE LCD       LCDTB                                               234440
     C                     MOVE CHTP      CHTPB                                               234440
     C                     MOVE TNLU      TNLUB                                               234440
      *                                                                                       234440
     C                     MOVEL@INVTP    @PINVT                                              234440
      *                                                                                       234440
     C                     ENDSR                                                              234440
      *****************************************************************                       234440
      /EJECT                                                                                  234440
      *****************************************************************                       234440
      *                                                               *                       234440
      *  SRVFSP - Validate Fiscal Price.                              *                       234440
      *                                                               *                       234440
      *****************************************************************                       234440
     C           SRVFSP    BEGSR                                                              234440
      *                                                                                       234440
      ** Clear error and warning arrays.                                                      234440
      *                                                                                       234440
     C                     CLEAR@FNXA                                                         234440
     C                     CLEAR@MIXA                                                         234440
     C                     CLEAR@MDXA                                                         234440
     C                     CLEAR@WFNXA                                                        234440
     C                     CLEAR@WMIXA                                                        234440
     C                     CLEAR@WMDXA                                                        234440
      *                                                                                       234440
      ** Set customer classification.                                                         234440
      *                                                                                       234440
     C                     MOVE @C1DI     WCUSCL                                              234440
      *                                                                                       234440
      ** Validate Fiscal Price via SEVSEFSPR2.                                                234440
      *                                                                                       234440
     C                     CALL SEVFSP                                                        234440
      *                                                                                       234440
      ** INPUTS                                                                               234440
      *                                                                                       234440
      ** Return Code                                                                          234440
     C                     PARM *BLANKS   PRETC  10                                           234440
      ** Default & Validate (Y or N)                                                          234440
     C                     PARM 'Y'       PDFLT   1                                           234440
     C                     PARM 'Y'       PVLDT   1                                           234440
      ** Fiscal Price                                                                         234440
     C                     PARM *BLANKS   @SFSPR 16                                           234440
      *  Trade Date                                                                           234440
     C                     PARM           @BTDVD                                              234440
      ** Security Details                                                                     234440
     C                     PARM           @PSECT                                              234440
      ** Investment Type Details                                                              234440
     C                     PARM           @PINVT                                              234440
      ** Customer (Counterparty) Details                                                      234440
     C                     PARM           @CUSDT                                              234440
      ** Date Format Indicator                                                                234440
     C                     PARM           BJDFIN                                              234440
      ** Branch                                                                               234440
     C                     PARM           @BTDBA                                              234440
      ** Current File Trade Date                                                              235547
     C                     PARM           @BTDVD                                              235547
      *                                                                                       234440
      ** OUTPUTS                                                                              234440
      *                                                                                       234440
      ** Error Fields/Message IDs/Message Data (arrays) From/To Caller                        234440
     C                     PARM           @FNXA                                               234440
     C                     PARM           @MIXA                                               234440
     C                     PARM           @MDXA                                               234440
      ** Warning Fields/Message IDs/Message Data (arrays) From/To Caller                      234440
     C                     PARM           @WFNXA                                              234440
     C                     PARM           @WMIXA                                              234440
     C                     PARM           @WMDXA                                              234440
      ** Price OK Indicator (1A)                                                              234440
      ** Price (15P 8)                                                                        234440
     C                     PARM 'Y'       DDFPOK  1                                           234440
     C                     PARM *ZERO     @BFSPR                                              234440
     C                     PARM *ZERO     @BFSPP                                              234440
      *                                                                                       234440
      ** Set error code if error is encountered upon validation.                              234440
      *                                                                                       234440
     C           DDFPOK    IFNE 'Y'                                                           234440
     C                     SETON                     12                                       234440
     C                     ENDIF                                                              234440
      *                                                                                       234440
      *                                                                                       234440
     C                     ENDSR                                                              234440
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRWTCH - Sub-routine to perform compliance watch processing.  *                       CSD015
      *                                                               *                       CSD015
      * Called by: SUB300                                             *                       CSD015
      *                                                               *                       CSD015
      * Calls:                                                        *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialization                                                                       CSD015
      *                                                                                       CSD015
     C                     CLEARSDWLTD                                                        CSD015
     C                     CLEARPSTRNG                                                        CSD015
     C                     Z-ADD0         U       20                                          CSD015
     C                     MOVE *BLANK    FLD1   35                                           CSD015
     C                     MOVE *BLANKS   FLD2   35                                           CSD015
     C                     MOVE *BLANKS   FLD3   35                                           CSD015
     C                     MOVE *BLANKS   FLD4   35                                           CSD015
     C                     MOVE *BLANKS   FLD5   35                                           CSD015
      *                                                                                       CSD015
      ** Process strings for PARAMETER 2 of Watch List Engine                                 CSD015
      *                                                                                       CSD015
      ** Pay From                                                                             CSD015
     C           PYFM      IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           PYFM      ANDNEO1PYFM                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELPYFM      FLD1                                                CSD015
     C                     Z-ADD1         U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay To                                                                               CSD015
     C           PAYT      IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           PAYT      ANDNEO1PAYT                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELPAYT      FLD1                                                CSD015
     C                     Z-ADD3         U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Pay To - For Account Of                                                              CSD015
     C           TDFA      IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           TDFA      ANDNEO1TDFA                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELTDFA      FLD1                                                CSD015
     C                     Z-ADD5         U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deliver To                                                                           CSD015
     C********** DELT      IFNE *ZERO                                                  CSD015 CSD027
     C           DELT      IFNE *BLANKS                                                       CSD027
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           DELT      ANDNEO1DELT                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELDELT      FLD1                                                CSD015
     C                     Z-ADD7         U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deliver To - For Account Of                                                          CSD015
     C           DTFA      IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           DTFA      ANDNEO1DTFA                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELDTFA      FLD1                                                CSD015
     C                     Z-ADD9         U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deliver From                                                                         CSD015
     C********** DELF      IFNE *ZERO                                                  CSD015 CSD027
     C           DELF      IFNE *BLANKS                                                       CSD027
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           DELF      ANDNEO1DELF                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELDELF      FLD1                                                CSD015
     C                     Z-ADD11        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deliver From - For Account Of                                                        CSD015
     C           DFFA      IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           DFFA      ANDNEO1DFFA                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELDFFA      FLD1                                                CSD015
     C                     Z-ADD13        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** MT510 Account for Payment + Account Line                                             CSD015
     C                     SELEC                                                              CSD015
      *                                                                                       CSD015
     C           *IN01     WHEQ *ON                                                           CSD015
     C           T2AP1N    ANDNE*BLANKS                                                       CSD015
     C           *IN01     OREQ *OFF                                                          CSD015
     C           T2AP1N    ANDNEO2AP1N                                                        CSD015
     C                     MOVELT2AP1N    FLD1                                                CSD015
      *                                                                                       CSD015
     C           *IN01     WHEQ *ON                                                           CSD015
     C           T2AP1L    ANDNE*BLANKS                                                       CSD015
     C           *IN01     OREQ *OFF                                                          CSD015
     C           T2AP1L    ANDNEO2AP1L                                                        CSD015
     C                     MOVELT2AP1L    FLD1                                                CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C           FLD1      IFNE *BLANKS                                                       CSD015
     C                     Z-ADD15        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Account for Payment + Account Line                                                   CSD015
     C                     SELEC                                                              CSD015
      *                                                                                       CSD015
     C           *IN01     WHEQ *ON                                                           CSD015
     C           T2AFPN    ANDNE*BLANKS                                                       CSD015
     C           *IN01     OREQ *OFF                                                          CSD015
     C           T2AFPN    ANDNEO2AFPN                                                        CSD015
     C                     MOVELT2AFPN    FLD1                                                CSD015
      *                                                                                       CSD015
     C           *IN01     WHEQ *ON                                                           CSD015
     C           T2AFPL    ANDNE*BLANKS                                                       CSD015
     C           *IN01     OREQ *OFF                                                          CSD015
     C           T2AFPL    ANDNEO2AFPL                                                        CSD015
     C                     MOVELT2AFPL    FLD1                                                CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C           FLD1      IFNE *BLANKS                                                       CSD015
     C                     Z-ADD17        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Account with Institution + Account Line                                              CSD015
     C           T2AWIN    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2AWIN    ANDNEO2AWIN                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2AWIN    FLD1                                                CSD015
     C                     MOVELT2AWIL    FLD2                                                CSD015
     C                     Z-ADD19        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Beneficiary + Account Line                                                           CSD015
     C           T2BOFN    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2BOFN    ANDNEO2BOFN                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2BOFN    FLD1                                                CSD015
     C                     MOVELT2BOF1    FLD2                                                CSD015
     C                     MOVELT2BOF2    FLD3                                                CSD015
     C                     Z-ADD21        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Instructing Party + Account Line                                                     CSD015
     C           T2IPYN    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IPYN    ANDNEO2IPYN                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IPYN    FLD1                                                CSD015
     C                     MOVELT2IPYL    FLD2                                                CSD015
     C                     Z-ADD23        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Counterparty + Account Line                                                          CSD015
     C           T2CTYN    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2CTYN    ANDNEO2CTYN                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2CTYN    FLD1                                                CSD015
     C                     MOVELT2CTYL    FLD2                                                CSD015
     C                     Z-ADD25        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** MT510 Safekeeping Account + Account Line                                             CSD015
     C                     SELEC                                                              CSD015
      *                                                                                       CSD015
     C           *IN01     WHEQ *ON                                                           CSD015
     C           T2SA1N    ANDNE*BLANKS                                                       CSD015
     C           *IN01     OREQ *OFF                                                          CSD015
     C           T2SA1N    ANDNEO2SA1N                                                        CSD015
     C                     MOVELT2SA1N    FLD1                                                CSD015
      *                                                                                       CSD015
     C           *IN01     WHEQ *ON                                                           CSD015
     C           T2SA1L    ANDNE*BLANKS                                                       CSD015
     C           *IN01     OREQ *OFF                                                          CSD015
     C           T2SA1L    ANDNEO2SA1L                                                        CSD015
     C                     MOVELT2SA1L    FLD1                                                CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C           FLD1      IFNE *BLANKS                                                       CSD015
     C                     Z-ADD27        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account + Account Line                                                   CSD015
     C                     SELEC                                                              CSD015
      *                                                                                       CSD015
     C           *IN01     WHEQ *ON                                                           CSD015
     C           T2SKAN    ANDNE*BLANKS                                                       CSD015
     C           *IN01     OREQ *OFF                                                          CSD015
     C           T2SKAN    ANDNEO2SKAN                                                        CSD015
     C                     MOVELT2SKAN    FLD1                                                CSD015
      *                                                                                       CSD015
     C           *IN01     WHEQ *ON                                                           CSD015
     C           T2SKAL    ANDNE*BLANKS                                                       CSD015
     C           *IN01     OREQ *OFF                                                          CSD015
     C           T2SKAL    ANDNEO2SKAL                                                        CSD015
     C                     MOVELT2SKAL    FLD1                                                CSD015
     C                     ENDSL                                                              CSD015
      *                                                                                       CSD015
     C           FLD1      IFNE *BLANKS                                                       CSD015
     C                     Z-ADD29        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deliverer Instructing Party                                                          CSD015
     C           T2DCTL    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2DCTL    ANDNEO2DCTL                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2DCTL    FLD1                                                CSD015
     C                     Z-ADD31        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receivers of Securities                                                              CSD015
     C           T2RSSN    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2RSSN    ANDNEO2RSSN                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2RSSN    FLD1                                                CSD015
     C                     MOVELT2RSS1    FLD2                                                CSD015
     C                     MOVELT2RSS2    FLD3                                                CSD015
     C                     MOVELT2RSS3    FLD4                                                CSD015
     C                     MOVELT2RSS4    FLD5                                                CSD015
     C                     Z-ADD33        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Deliverer of Securities                                                              CSD015
     C           T2DSSN    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2DSSN    ANDNEO2DSSN                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2DSSN    FLD1                                                CSD015
     C                     MOVELT2DSS1    FLD2                                                CSD015
     C                     MOVELT2DSS2    FLD3                                                CSD015
     C                     MOVELT2DSS3    FLD4                                                CSD015
     C                     MOVELT2DSS4    FLD5                                                CSD015
     C                     Z-ADD35        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Beneficiary of Securities                                                            CSD015
     C           T2BSSN    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2BSSN    ANDNEO2BSSN                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2BSSN    FLD1                                                CSD015
     C                     MOVELT2BSS1    FLD2                                                CSD015
     C                     MOVELT2BSS2    FLD3                                                CSD015
     C                     Z-ADD37        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Investor                                                                             CSD015
     C           T2INVE    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2INVE    ANDNEO2INVE                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2INVE    FLD1                                                CSD015
     C                     Z-ADD39        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Settlement Parties Intermediary 1                                                    CSD015
     C           T2IMD1    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMD1    ANDNEO2IMD1                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMD1    FLD1                                                CSD015
     C                     Z-ADD41        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Settlement Parties Intermediary 2                                                    CSD015
     C           T2IMD2    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMD2    ANDNEO2IMD2                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMD2    FLD1                                                CSD015
     C                     Z-ADD43        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Settlement Parties Intermediary 3                                                    CSD015
     C           T2IMD3    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMD3    ANDNEO2IMD3                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMD3    FLD1                                                CSD015
     C                     Z-ADD45        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Settlement Parties Intermediary 4                                                    CSD015
     C           T2IMD4    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMD4    ANDNEO2IMD4                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMD4    FLD1                                                CSD015
     C                     Z-ADD47        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Settlement Parties Intermediary 5                                                    CSD015
     C           T2IMD5    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMD5    ANDNEO2IMD5                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMD5    FLD1                                                CSD015
     C                     Z-ADD49        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Settlement Parties Intermediary 6                                                    CSD015
     C           T2IMD6    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMD6    ANDNEO2IMD6                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMD6    FLD1                                                CSD015
     C                     Z-ADD51        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Settlement Parties Intermediary 7                                                    CSD015
     C           T2IMD7    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMD7    ANDNEO2IMD7                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMD7    FLD1                                                CSD015
     C                     Z-ADD53        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Settlement Parties Intermediary 8                                                    CSD015
     C           T2IMD8    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMD8    ANDNEO2IMD8                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMD8    FLD1                                                CSD015
     C                     Z-ADD55        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Settlement Parties Intermediary 9                                                    CSD015
     C           T2IMD9    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMD9    ANDNEO2IMD9                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMD9    FLD1                                                CSD015
     C                     Z-ADD57        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account Intermediary 1                                                   CSD015
     C           T2IMS1    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMS1    ANDNEO2IMS1                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMS1    FLD1                                                CSD015
     C                     Z-ADD59        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account Intermediary 2                                                   CSD015
     C           T2IMS2    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMS2    ANDNEO2IMS2                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMS2    FLD1                                                CSD015
     C                     Z-ADD61        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account Intermediary 3                                                   CSD015
     C           T2IMS3    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMS3    ANDNEO2IMS3                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMS3    FLD1                                                CSD015
     C                     Z-ADD63        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account Intermediary 4                                                   CSD015
     C           T2IMS4    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMS4    ANDNEO2IMS4                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMS4    FLD1                                                CSD015
     C                     Z-ADD65        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account Intermediary 5                                                   CSD015
     C           T2IMS5    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMS5    ANDNEO2IMS5                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMS5    FLD1                                                CSD015
     C                     Z-ADD67        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account Intermediary 6                                                   CSD015
     C           T2IMS6    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMS6    ANDNEO2IMS6                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMS6    FLD1                                                CSD015
     C                     Z-ADD69        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account Intermediary 7                                                   CSD015
     C           T2IMS7    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMS7    ANDNEO2IMS7                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMS7    FLD1                                                CSD015
     C                     Z-ADD71        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account Intermediary 8                                                   CSD015
     C           T2IMS8    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMS8    ANDNEO2IMS8                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMS8    FLD1                                                CSD015
     C                     Z-ADD73        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Safekeeping Account Intermediary 9                                                   CSD015
     C           T2IMS9    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C           *IN01     IFEQ *OFF                                                          CSD015
     C           T2IMS9    ANDNEO2IMS9                                                        CSD015
     C           *IN01     OREQ *ON                                                           CSD015
     C                     MOVELT2IMS9    FLD1                                                CSD015
     C                     Z-ADD75        U                                                   CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSW210
      ** Debtor                                                                               CSW210
     C           T2DIDN    IFNE *BLANKS                                                       CSW210
      *                                                                                       CSW210
     C           *IN01     IFEQ *OFF                                                          CSW210
     C           T2DIDN    ANDNEO2DIDN                                                        CSW210
     C           *IN01     OREQ *ON                                                           CSW210
     C                     MOVELT2DIDN    FLD1                                                CSW210
     C                     Z-ADD77        U                                                   CSW210
     C                     EXSR SRCONV                                                        CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
      ** Qualified Foreign Intermediary                                                       CSW210
     C           T2QFIN    IFNE *BLANKS                                                       CSW210
      *                                                                                       CSW210
     C           *IN01     IFEQ *OFF                                                          CSW210
     C           T2QFIN    ANDNEO2QFIN                                                        CSW210
     C           *IN01     OREQ *ON                                                           CSW210
     C                     MOVELT2QFIN    FLD1                                                CSW210
     C                     Z-ADD79        U                                                   CSW210
     C                     EXSR SRCONV                                                        CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSW210
     C                     ENDIF                                                              CSW210
      *                                                                                       CSD015
      ** If 2nd parameter string is not blank, process parameter 1 string and                 CSD015
      ** send transaction details to Watch List Engine                                        CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     EXSR SR1PRM                                                        CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           SDWLTD                                              CSD015
     C                     PARM           PSTRNG                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SR1PRM  - Subroutine to process details for 1st parameter     *                       CSD015
      *           of Watch List Engine.                               *                       CSD015
      *                                                               *                       CSD015
      * Called by: SRWTCH                                             *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SR1PRM    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** PARAMETER 1:                                                                         CSD015
      ** Item Type Code                                                                       CSD015
     C                     MOVEL'SETRAD'  W4ITEM                                              CSD015
      *                                                                                       CSD015
      ** Identifier                                                                           CSD015
     C                     MOVELTDRF      W4IDEN                                              CSD015
      *                                                                                       CSD015
      ** Branch                                                                               CSD015
     C                     MOVELTDBA      W4BRCH                                              CSD015
      *                                                                                       CSD015
      ** System                                                                               CSD015
      ** If Midas 24x7 is installed, use Main system prefix otherwise use system prefix       CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVELS1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Function Type                                                                        CSD015
     C                     MOVE 'TRADSD  'W4FUNT                                              CSD015
      *                                                                                       CSD015
      ** Counterparty details                                                                 CSD015
     C                     EXSR SRCUST                                                        CSD015
      *                                                                                       CSD015
      ** Deal Date                                                                            CSD015
     C                     Z-ADDTDDT      W4DDAT                                              CSD015
      *                                                                                       CSD015
      ** Value Date                                                                           CSD015
     C                     Z-ADDTDVD      W4VDAT                                              CSD015
      *                                                                                       CSD015
      ** Maturity Date                                                                        CSD015
     C                     Z-ADD*ZERO     W4MDAT                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 1                                                                  CSD015
      ** Get denomination from Securities file                                                CSD015
     C                     MOVE *BLANKS   W4DEN1                                              CSD015
     C                     MOVELTDSS      W4DEN1                                              CSD015
      *                                                                                       CSD015
      ** Denomination Side 2                                                                  CSD015
     C                     MOVE *BLANKS   W4DEN2                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 1                                                                        CSD015
     C                     MOVE *BLANKS   W4AMT1                                              CSD015
     C                     MOVELNOML      W4AMT1                                              CSD015
      *                                                                                       CSD015
      ** Amount Side 2                                                                        CSD015
     C                     Z-ADD*ZERO     W4AMT2                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRCUST  - Subroutine to setup counterpartry details.          *                       CSD015
      *                                                               *                       CSD015
      * Called by: SR1PRM                                             *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRCUST    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE TCNR      W4CNUM                                              CSD015
     C                     MOVE TCNR      WTCNR  10                                           CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*KEY'    @OPTN                                               CSD015
     C                     PARM WTCNR     PCUST  10                                           CSD015
     C                     PARM *BLANKS   PSTKEY  7                                           CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           BBCRNM    CAT  BBCRTN    W4CUST                                              CSD015
      *                                                                                       CSD015
      ** Get counterparty type depending on CCF001                                            CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANKS                                                       CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *                                                                                       CSD015
      *****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
      *                                                               *                       CSD015
      * SRCONV  - Subroutine to convert accounts, customer no. to     *                       CSD015
      *           custumer name and address.                          *                       CSD015
      * Called by: Main program                                       *                       CSD015
      *                                                               *                       CSD015
      * Calls: SDCWHLCHK                                              *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
     C           SRCONV    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   OUTFMT                                              CSD015
     C                     MOVE *BLANKS   PINPT                                               CSD015
     C                     MOVE *BLANKS   PINPT1                                              CSD015
     C                     MOVE *BLANKS   PINPT2                                              CSD015
     C                     MOVE *BLANKS   PINPT3                                              CSD015
     C                     MOVE *BLANKS   PINPT4                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM *BLANKS   PRTCD                                               CSD015
     C                     PARM FLD1      PINPT  35                                           CSD015
     C                     PARM FLD2      PINPT1 35                                           CSD015
     C                     PARM FLD3      PINPT2 35                                           CSD015
     C                     PARM FLD4      PINPT3 35                                           CSD015
     C                     PARM FLD5      PINPT4 35                                           CSD015
     C                     PARM           PINPT5 35                                           CSD015
     C                     PARM @BTNMC    WCCY1   3                                           CSD015
     C                     PARM           OUTFMT216                                           CSD015
     C                     PARM           OUTFT2  6                                           CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF    '                                                    CSD015
     C                     MOVEL'SDCWLFMT'@DBFIL                                              CSD015
     C                     MOVELFLD1      @DBKEY                                              CSD015
     C                     Z-ADD24        @DBASE                                              CSD015
     C                     EXSR SUB999                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   FLD1                                                CSD015
     C                     MOVE *BLANKS   FLD2                                                CSD015
     C                     MOVE *BLANKS   FLD3                                                CSD015
     C                     MOVE *BLANKS   FLD4                                                CSD015
     C                     MOVE *BLANKS   FLD5                                                CSD015
      *                                                                                       CSD015
     C           PSTRNG    CAT  WLARR,U:1 PSTRNG                                              CSD015
     C           PSTRNG    CAT  OUTFMT:1  PSTRNG                                              CSD015
     C                     ADD  1         U                                                   CSD015
     C           PSTRNG    CAT  WLARR,U:1 PSTRNG    P                                         CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CSE028
      /EJECT                                                                                  CRE020
      *****************************************************************                       CRE020
      *                                                               *                       CRE020
      * SRIDXT  - Handles the advice index of the current             *                       CRE020
      *           transaction.                                        *                       CRE020
      *                                                               *                       CRE020
      *****************************************************************                       CRE020
     C           SRIDXT    BEGSR                                                              CRE020
      *                                                                                       CRE020
     C                     MOVE TDRF      KREFNO                                              CRE020
      *                                                                                       CRE020
     C                     OPEN READVCL1                                                      CRE020
     C           KADVC     CHAINREADVCL1             69                                       CRE020
      *                                                                                       CRE020
     C           *IN69     IFEQ '1'                                                           CRE020
     C                     MOVELTDRF      RREFNO                                              CRE020
     C                     MOVE KPRGMN    RPRGMN                                              CRE020
     C                     MOVE *BLANKS   RSEQNO                                              CRE020
     C                     MOVE TDTP      RTRTYP                                              CRE020
     C                     MOVEL'Y'       RAUTHI                                              CRE020
     C                     MOVEL'N'       RSAPIN                                              CRE020
     C                     MOVE *BLANKS   RENARR                                              CRE020
     C                     MOVEL@BCHTP    RCHTYP                                              CRE020
     C                     WRITEREADVCD0                                                      CRE020
     C                     ELSE                                                               CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     MOVEL@BCHTP    RCHTYP                                              CRE020
     C                     UPDATREADVCD0                                                      CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     UNLCKREADVCL1                                                      CRE020
     C                     CLOSEREADVCL1                                                      CRE020
      *                                                                                       CRE020
     C                     ENDSR                                                              CRE020
      *****************************************************************                       CRE020
      */EJECT***************                                              S01195
     C*/COPY*ZSRSRC,XDATE3Z1*********                                     S01195
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT
     C/COPY ZSRSRC,ZACCRZ1
      /EJECT                                                              E39495
     C/COPY ZSRSRC,ZACCZZ1                                                E39495
      /EJECT
     C**********/COPY ZSRSRC,ZALIGNZ2                                     068692
      ********/EJECT                                               S01195 068692
     C/COPY ZSRSRC,ZBKDT                                                  S01195
      /EJECT                                                              E39495
     C/COPY ZSRSRC,ZCALCD                                                 E39495
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZCCAL1Z2                                               S01176
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZCCAL2Z1                                               S01176
      /EJECT                                                              S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
      /EJECT                                                              E21065
     C/COPY ZSRSRC,ZCNSDZ1                                                E21065
      /EJECT
     C/COPY ZSRSRC,ZCONVZ1
      /EJECT                                                              E21065
     C/COPY ZSRSRC,ZCOTRZ1                                                E21065
      /EJECT
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CP12                                           S01408
     C*                                                                   S01408
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2
      */EJECT******************                                           S01195
     C*/COPY*ZSRSRC,ZDATE6Z2*****                                         S01195
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      */EJECT******************                                           S01117
     C*/COPY*ZSRSRC,ZICD2Z1****                                           S01117
      */EJECT*******************                                          S01117
     C*/COPY*ZSRSRC,ZICDSEZ1****                                          S01117
      /EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
     C/EJECT                                                              S01510
     C/COPY ZSRSRC,ZNDDZ1                                                 S01510
      /EJECT
     C/COPY ZSRSRC,ZPCINTZ1                                               E36791
      /EJECT                                                              E36791
     C/COPY ZSRSRC,ZPRCIZ1
      ***/EJECT*****************                                          S01176
     C***/COPY*ZSRSRC,ZPRCOZ1***                                          S01176
      /EJECT
     C/COPY ZSRSRC,ZRATEZ1
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      */EJECT*******************                                          S01117
     C*/COPY*ZSRSRC,ZSYSTMZ1****                                          S01117
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZTCAL1Z1                                               S01176
      /EJECT                                                              S01176
     C/COPY ZSRSRC,ZTCAL2Z1                                               S01176
      /EJECT
     C/COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C/COPY ZSRSRC,ZYLDIZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDOZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDZ2
      /EJECT
     C/COPY ZSRSRC,ZXRATEZ1                                               065524
      /EJECT                                                              065524
     C/COPY ZSRSRC,ZFWDT                                                  S01448
     C/EJECT                                                              S01448
     C*                                                                   S01408
     C/COPY WNCPYSRC,SE3003CCP9                                           S01408
     C*                                                                   S01408
      ***
     OTRADSDF E                RELTRD
     O*
     O*CLINTCBFE****************RELCCB                                    S01117
     O*
     O*CLINTSEFE****************RELCSE                                    S01117
     O*
** CPY@
(c) Finastra International Limited 2001
** STAMP - Dummy timestamp                                                                    201192
0001-01-01-00.00.00.000000                                                                    201192
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
** @ER - Error messages for error report
CLIENT TRADE DETAILS NOT FOUND FOR CLIENT NNNNNN
BASE CURRENCY DEFAULT-DETAILS NOT FOUND FOR SETTLEMENT CURRENCY XXX
PAY FROM DEFAULT-DETAILS NOT FOUND FOR SETTLEMENT CURRENCY XXX
PAY TO DEFAULT-DETAILS NOT FOUND FOR SETTLEMENT CURRENCY XXX
PAY TO BRANCH DEFAULT-NOSTRO AA FOR CURRENCY BBB NOT FOUND
PAY TO BRANCH DEFAULT-ACCOUNT AAAAAABBBCCCCDD NOT FOUND
ACTIVE TRADE NNNNNN NOT FOUND
ACTIVE TRADE NNNNNN ALREADY EXISTS
BOOK POSITIONS HEADER FILE CONTROLS NOT FOUND
BOOK POSITIONS DETAIL FILE CONTROLS NOT FOUND
CLIENT POSITIONS FILE CONTROLS NOT FOUND
CLIENT DEPOT POSITIONS FILE CONTROLS NOT FOUND
USER DEPOT POSITIONS FILE CONTROLS NOT FOUND
TRADE SETTLEMENTS FILE CONTROLS NOT FOUND
TRADE FILE CONTROLS NOT FOUND
DB ERROR OCCURED WHEN SETTING OUTSTANDING VALUE FOR TRADE (P/ZCONV) AAAAAAAAAAAA
ERROR IN RECONCILING TRADE AND BOOK POSITION PROFIT CENTRE
POSITION PROFIT CENTRE FILE CONTROLS NOT FOUND
CONFLICT WITH MARKET MIGRATION
ERROR IN RECONCILING TRADE AND CUSTOMER POSITION PROFIT CENTRE
PROFIT CENTRE DETAILS NOT FOUND FOR PROFIT CENTRE XXXX
** WLARR - Watch list fields array                                                            CSD015
<Pay From>                              </Pay From>                                           CSD015
<Pay To>                                </Pay To>                                             CSD015
<Pay To - For Account Of>               </Pay To - For Account Of>                            CSD015
<Deliver To>                            </Deliver To>                                         CSD015
<Deliver To - For Account Of>           </Deliver To - For Account Of>                        CSD015
<Deliver From>                          </Deliver From>                                       CSD015
<Deliver From - For Account Of>         </Deliver From - For Account Of>                      CSD015
<MT510 Account for Payment>             </MT510 Account for Payment>                          CSD015
<Account for Payment>                   </Account for Payment>                                CSD015
<Account with Institution>              </Account with Institution>                           CSD015
<Beneficiary>                           </Beneficiary>                                        CSD015
<Instructing Party>                     </Instructing Party>                                  CSD015
<Counterparty>                          </Counterparty>                                       CSD015
<MT510 Safekeeping Account>             </MT510 Safekeeping Account>                          CSD015
<Safekeeping Account>                   </Safekeeping Account>                                CSD015
<Deliverer Instructing Party>           </Deliverer Instructing Party>                        CSD015
<Receivers of Security>                 </Receivers of Security>                              CSD015
<Deliverer of Security>                 </Deliverer of Security>                              CSD015
<Beneficiary of Securities>             </Beneficiary of Securities>                          CSD015
<Investor>                              </Investor>                                           CSD015
<Settlement Parties Intermediary 1>     </Settlement Parties Intermediary 1>                  CSD015
<Settlement Parties Intermediary 2>     </Settlement Parties Intermediary 2>                  CSD015
<Settlement Parties Intermediary 3>     </Settlement Parties Intermediary 3>                  CSD015
<Settlement Parties Intermediary 4>     </Settlement Parties Intermediary 4>                  CSD015
<Settlement Parties Intermediary 5>     </Settlement Parties Intermediary 5>                  CSD015
<Settlement Parties Intermediary 6>     </Settlement Parties Intermediary 6>                  CSD015
<Settlement Parties Intermediary 7>     </Settlement Parties Intermediary 7>                  CSD015
<Settlement Parties Intermediary 8>     </Settlement Parties Intermediary 8>                  CSD015
<Settlement Parties Intermediary 9>     </Settlement Parties Intermediary 9>                  CSD015
<Safekeeping Account Intermediary 1>    </Safekeeping Account Intermediary 1>                 CSD015
<Safekeeping Account Intermediary 2>    </Safekeeping Account Intermediary 2>                 CSD015
<Safekeeping Account Intermediary 3>    </Safekeeping Account Intermediary 3>                 CSD015
<Safekeeping Account Intermediary 4>    </Safekeeping Account Intermediary 4>                 CSD015
<Safekeeping Account Intermediary 5>    </Safekeeping Account Intermediary 5>                 CSD015
<Safekeeping Account Intermediary 6>    </Safekeeping Account Intermediary 6>                 CSD015
<Safekeeping Account Intermediary 7>    </Safekeeping Account Intermediary 7>                 CSD015
<Safekeeping Account Intermediary 8>    </Safekeeping Account Intermediary 8>                 CSD015
<Safekeeping Account Intermediary 9>    </Safekeeping Account Intermediary 9>                 CSD015
<Debtor>                                </Debtor>                                             CSW210
<Qualified Foreign Intermediary>        </Qualified Foreign Intermediary>                     CSW210
** ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** TMMP - Dummy timestamp                                                                     CSE039
0001-01-01-00.00.00.000000                                                                    CSE039
