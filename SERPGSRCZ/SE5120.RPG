     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Extract C.P. price change')                   *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module
     F*                                                               *
     F*  SE5120 - EXTRACT COMMERCIAL PAPER PRICE CHANGES              *
     F*                                                               *
     F*  Function: To extract and keep as Security events, changes    *
     F*   (COB)    input to the Commercial Paper Price matrix for a   *
     F*            security.                                          *
     F*                                                               *
     F*  Called by: SEC0602H - Extract Commercial Paper Price Changes *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
     F*  Last Amend No. 247420             Date 08Sep20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CRE073             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      *                 CSE075             Date 17Nov05               *
      *                 CSE071             Date 19Jul05               *
      *                 CAS008             Date 11May04               *
      *                 CAS006             Date 21Jan03               *
      *                 111152             Date 23Aug02               *
      *                 CSE037             Date 29Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 16May01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 12Jul00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CAP137             Date 07Feb00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 102718             DATE 22JAN97               *
     F*                 S01455             DATE 05NOV93               *
     F*                 052254             DATE 10JAN94               *
     F*                 S01397             DATE 10SEP92               *
     F*                 E37615             DATE 27MAR92               *
     F*                 E29170             DATE 18NOV91               *
     F*                 S01117             DATE 12JUN91               *
     F*                 E22107             DATE 02MAY90               *
     F*                 E20651             DATE 30JAN90               *
     F*                 E20885             DATE 23JAN90               *
     F*                 E17763             DATE 11/05/89              *
     F*                 E18128             DATE 25/04/89              *
     F*                 S01176             DATE 12/10/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  247420 - Rename and increase length of field NORE in file    *
      *           SNDEVA from NORE(5,0) to SNNORE(7,0). Also increase *
      *           length of working fields related to SNNORE.         *
      *           Applied fix 230439.                                 *
      *  MD046248 - Finastra Rebranding                               *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
      *           (Recompile)                                         *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CAS008 - Delayed Hedge Assessment (Recompile)                *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  111152 - Interpolation of discount rates incorrect           *
      *           Applied 2.3 fix NDF033 and recompiled.              *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input.    *
      *  CSD006 - Market Data Feed (Recompiled)                       *
      *  CSE023 - Treaty Withholding Tax (Recompiled)                 *
      *  CAP137 - Conversion of SE Security inputs into modular       *
      *           structure to use as APIs.                           *
      *           Recompiled over changes in PF/SECTYD.               *
     F*  102718 - Using wrong field for File Control update (SNDEVA)  *
     F*  S01455 - 'FF' ACCOUNT KEY ENHANCEMENTS.                      *
     F*           Recompiled due to changes in PF/TABTB80.            *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*          - Recompiled due to changes to files.                *
     F*  E37615 - Recompiled for minor correction to Audit Print File.*
     F*  E29170 - Report Control Facility changes                     *
     F*  S01117 - Multibranching                                      *
     F*  E22107 - OVERFLOW ERROR - OVERFLOW LINE EXCEEDED             *   E22107
     F*  E20651 - DB ERROR NUMBERS USED IN MORE THAN ONE PLACE.       *   E20651
     F*           NEW ERROR NUMBERS AS FOLLOWS:                       *   E20651
     F*           DB ERROR 91 -> 95                                   *   E20651
     F*           DB ERROR 91 -> 96                                   *   E20651
     F*  E20885 - REPORT SHOULD SHOW "NO DETAILS TO REPORT" IF FILE   *   E20885
     F*           CPPRIC EMPTY.                                       *   E20885
     F*  E17763 - DATES SHOULD BE DAYS SINCE RUN DATE. NOT 1 JAN '72. *   E17763
     F*  E18128 - INCLUDE S01186 CHANGES TO PREVENT D/B ERROR WHEN    *   E18128
     F*           FILE CPPRIC EMPTY.                                  *   E18128
     F*  S01176 - SECURITIES TRADING 3.1 (AUSTRALIA)                  *   S01176
     F*                                                               *
     F*****************************************************************
     FCPPRIC  IF  E           K        DISK         KINFDS CPRDS
     F                                              KINFSR CPRSR
     FTABICD  IF  E           K        DISK
     F            TABLETAF                          KIGNORE
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F            TABTB20F                          KIGNORE
     F            TABTB30F                          KIGNORE
     F            TABTB35F                          KIGNORE
     F            TABTB36F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F            TABTB50F                          KIGNORE
     F            TABTB55F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET5F                          KIGNORE
     FSECTYC  UF  E           K        DISK         KINFDS SECDS
     F                                              KINFSR SECSR
     FINVTPC  IF  E           K        DISK         KINFDS INVDS
     F                                              KINFSR INVSR
     F*PPRIA**UF  E                    DISK         KINFDS CPADS          E18128
     F***                                           KINFSR CPASR          E18128
     FCPPRIA  IF  E                    DISK         KINFDS CPADS          E18128
     F                                              KINFSR CPASR          E18128
     FSNDEVA  UF  E                    DISK         KINFDS SNADS
     F                                              KINFSR SNASR
     FSNDEVD  O   E           K        DISK         KINFDS SNDDS
     F/COPY WNCPYSRC,SE5120F001
     F                                              KINFSR SNDSR
     F***********SE5120P1O   E                    PRINTER                 E22107
     F***SE5120P1O***E             01     PRINTER                   E22107E29170
     FSE5120P1O   E             01     PRINTER                        UC  E29170
     F                                              KINFDS SPOOL          E29170
     FSE5120AUO   E                    PRINTER
     F                                              KINFDS SPOOLU         E29170
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*   01     OVERFLOW INDICATOR                                   *   E22107
     F*   31     READ INDICATOR FOR CP PRICE RECORD                   *
     F*   32     CHAIN INDICATOR FOR INVESTMENT TYPE RECORD           *
     F****33     CHAIN INDICATOR FOR SECTYDF                          *   E18128
     F*   33     SETLL INDICATOR FOR SECTYDF                          *   E18128
     F*   34     READ INDICATOR FOR CP PRICES  AUDIT                  *
     F*   35     READ INDICATOR FOR NON-DIARY EVENTS AUDIT            *
     F*   36     READ INDICATOR FOR SECTYDF                           *   S01176
     F*                                                               *
     F*   41     INDICATORS USED FOR COMPARING THE DAYS TO            *
     F*   42     MATURITY WITH THE VALUE IN THE EQUIVALENT            *
     F*   43     FIELD IN CPPRIC                                      *
     F*                                                               *
     F*   45     LOOKUP INDICATOR FOR DAYS TO MATURITY                *
     F*                                                               *
     F*   87     INDICATOR USED IN ERROR SUBROUTINES                  *
     F*                                                               *
     F*   99     INDICATOR USED IN ZSYSTM AND ZICD2                   *
     F*                                                               *
     F*                                                               *
     F*   U7     DATABASE ERROR                                       *
     F*   U8     DATABASE ERROR                                       *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  AUDIT  - PERFORM RUN CONTROL PROCESS                         *
     F*  *PSSR  - Error handling                                      *   S01117
     F*  RCFP1  - SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF      *   E29170
     F*  RCFAU  - SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF      *   E29170
     F*  ZEVCD  - CALCULATE EVENT CONTROL DATE                        *
     F*  ZICD2  - RETRIEVE INSTALLATION CONTROL RECORD NO 2           *
     F*  ZSYSTM - RETRIEVE INSTALLATION CONTROL RECORD                *
     F*  ZYMTX  - CALCULATE YIELD RATE                                *
     F*  ZEDIT  - INSERT DECIMAL POINT AND BLANK OUT LEADING ZEROS    *
     F*  ZSEDIT - INSERT DEC. PT., SIGN AND BLANK OUT LEADING ZEROS   *
     F*  ZDATE2 - CONVERT DAY NO. TO DATE FORMAT                      *
     F* *                                                             *
     F*****************************************************************
      /EJECT
     E/COPY ZSRSRC,ZYMTXZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZEDITZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E                    CPY@    1   1 80
      /EJECT
      *                                                                                       CSE037
     IINVTPDF                                                                                 CSE037
     I              SFLG                            ISFLG                                     CSE037
      *                                                                                       CSE037
     ICPPRIDF
     I* SET UP DATA STRUCTURE FOR CPPRID
     I              RECI                            CRECI
     I              ND01                            ZND,1
     I              ND02                            ZND,2
     I              ND03                            ZND,3
     I              ND04                            ZND,4
     I              ND05                            ZND,5
     I              ND06                            ZND,6
     I              ND07                            ZND,7
     I              ND08                            ZND,8
     I              ND09                            ZND,9
     I              ND10                            ZND,10
     I              ND11                            ZND,11
     I              ND12                            ZND,12
     I              ND13                            ZND,13
     I              ND14                            ZND,14
     I              ND15                            ZND,15
     I              ND16                            ZND,16
     I              ND17                            ZND,17
     I              ND18                            ZND,18
     I              ND19                            ZND,19
     I              ND20                            ZND,20
     I              ND21                            ZND,21
     I              ND22                            ZND,22
     I              ND23                            ZND,23
     I              ND24                            ZND,24
     I              ND25                            ZND,25
     I              YR01                            ZRT,1
     I              YR02                            ZRT,2
     I              YR03                            ZRT,3
     I              YR04                            ZRT,4
     I              YR05                            ZRT,5
     I              YR06                            ZRT,6
     I              YR07                            ZRT,7
     I              YR08                            ZRT,8
     I              YR09                            ZRT,9
     I              YR10                            ZRT,10
     I              YR11                            ZRT,11
     I              YR12                            ZRT,12
     I              YR13                            ZRT,13
     I              YR14                            ZRT,14
     I              YR15                            ZRT,15
     I              YR16                            ZRT,16
     I              YR17                            ZRT,17
     I              YR18                            ZRT,18
     I              YR19                            ZRT,19
     I              YR20                            ZRT,20
     I              YR21                            ZRT,21
     I              YR22                            ZRT,22
     I              YR23                            ZRT,23
     I              YR24                            ZRT,24
     I              YR25                            ZRT,25
     I/COPY WNCPYSRC,SE5120I001
     I*
     ICPRDS       DS
     I                                     *STATUS  STSCPR
     I*
     ISECDS       DS
     I                                     *STATUS  STSSEC
     I*
     IINVDS       DS
     I                                     *STATUS  STSINV
     I*
     ICPADS       DS
     I                                     *STATUS  STSCPA
     I*
     ISNADS       DS
     I                                     *STATUS  STSSNA
     I*
     ISNDDS       DS
     I                                     *STATUS  STSSND
     I*
     ILDA         DS                            256                       S01117
     I                                      134 183 DBLOT                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*LDA******* UDS                            256                      S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I*                                                                   E29170
     ISPOOL       DS                                                      E29170
     I*                                                                   E29170
     I**  DS FOR P1 SPOOL FILE NAME                                       E29170
     I*                                                                   E29170
     I                                       83  92 SFILE                 E29170
     I                                    B 123 1240SFNUM                 E29170
     I**                                                                  E29170
     ISPOOLU      DS                                                      E29170
     I                                       83  92 SFILEU                E29170
     I                                    B 123 1240SFNUMU                E29170
     I*
     I/COPY ZSRSRC,ZSEDITZ2
     I*
     ICPYR@#      DS
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I*
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/COPY WNCPYSRC,SE5120I002
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*    MAIN PROCESSING                                            *
     C*                                                               *
     C*****************************************************************
     C*
     C**  PERFORM INITIAL PROCESSING
     C*
     C                     EXSR INIT
     C*
     C           *INU7     IFEQ '0'
     C           *INU8     ANDEQ'0'
     C           *IN31     DOWEQ'0'
     C*
     C*  IF NO DATABASE ERRORS, PERFORM MAIN PROCESSING UNTIL EOF
     C*
     C                     EXSR MAIN
     C*
     C                     END
     C                     END
     C*
     C                     EXSR AUDIT
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* INIT - RETRIEVE ICD1 & ICD2 RECORDS, AND EVENT CONTROL DATE   *
     C*                                                               *
     C*****************************************************************
     C*
     C           INIT      BEGSR
     C*
     C* SETOF DATABASE ERROR INDICATORS
     C*
     C                     SETOF                       U7U8
     C*
     C* RETRIEVE ICD 1 RECORD - IF NOT THERE, DATABASE ERROR
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBLOT                           S01117
     C                     MOVEL'SE5120'  DBPGM
     C                     OUT  LDA                                       S01117
     C                     EXSR ZSYSTM
     C           *IN99     IFEQ '1'
     C                     SETON                     LRU7U8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVELZTABKY    DBKEY
     C***********          MOVE '01'      DBASE            **DB ERROR 01**S01117
     C                     Z-ADD1         DBASE            **DB ERROR 01**S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C* RETRIEVE ICD 2 RECORD - IF NOT THERE, DATABASE ERROR
     C*
     C                     EXSR ZICD2
     C           *IN99     IFEQ '1'
     C                     SETON                     LRU7U8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVELZTABKY    DBKEY
     C***********          MOVE '02'      DBASE            **DB ERROR 02**S01117
     C                     Z-ADD2         DBASE            **DB ERROR 02**S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C* CALCULATE EVENT CONTROL DATE
     C*
     C                     Z-ADDDNWD      ZZDNWD                          S01117
     C                     Z-ADDAPDA      ZZAPDT                          S01117
     C                     EXSR ZEVCD
      *                                                                                       111152
      ** Calculate Accrual Control Date                                                       111152
      *                                                                                       111152
     C           ACLD      IFEQ 'Y'                                                           111152
     C                     Z-ADDECD       ACDT    50                                          111152
     C                     ELSE                                                               111152
     C           ECD       ADD  1         ACDT                                                111152
     C                     END                                                                111152
      *
     C* SETOF COMMERCIAL PAPER PRICE FILE READ INDICATOR DURING
     C* FIRST TIME THROUGH PROCESS
     C*
     C                     SETOF                     31
     C                     MOVEL'N'       FILOPN  1                       E29170
     C/COPY WNCPYSRC,SE5120C001
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*   MAIN PROCESSING                                             *
     C*                                                               *
     C*****************************************************************
     C*
     C           MAIN      BEGSR
     C*
     C* PROCESS EACH LIVE COMMERCIAL PAPER PRICE
     C*
     C                     READ CPPRIC                   31
     C/COPY WNCPYSRC,SE5120C002
     C*
     C           *IN31     IFEQ '0'
     C*
     C*
     C*  ADD 1 TO RECORD COUNT
     C*
     C                     ADD  1         CPPCT   50
     C*
     C* PICK UP EACH NEW INVESTMENT TYPE USING KEY FROM CPPRID
     C*
     C           CPKEY     KLIST
     C                     KFLD           INVT
     C                     KFLD           CCY
     C*
     C           CPKEY     CHAININVTPC               32
     C*
     C           *IN32     IFEQ '0'
     C*
     C* ACCESS SECURITY FILE USING KEY FROM CPPRID
     C*
     C***********CPKEY     CHAINSECTYC               33                   S01176
     C           CPKEY     SETLLSECTYC                   33               S01176
     C*
     C* IF RECORD FOUND
     C*
     C************IN33     IFEQ '0'                                       S01176
     C           *IN33     IFEQ '1'                                       S01176
     C*                                                                   S01176
     C*                                                                   S01176
     C* READ ALL RECORDS EQUAL TO THIS KEY                                S01176
     C*                                                                   S01176
     C           CPKEY     READESECTYC                   36               S01176
     C*                                                                   S01176
     C           *IN36     DOWEQ'0'                                       S01176
     C*
     C* IF UNFIXED COMPLETE SECURITY, ENSURE MATURITY DATE IS NOT
     C* NEGATIVE
     C*
     C           MDTI      IFEQ 'A'
     C********** RUND      ORLT MATY                                                          111152
     C           ACDT      ORLT MATY                                                          111152
     C/COPY WNCPYSRC,SE5120C004
     C***********          Z-ADDRUND      ZBASD                                               111152
     C                     Z-ADDACDT      ZBASD                                               111152
     C                     Z-ADDMATY      ZMDAT
     C*
     C* CALCULATE YIELD RATE USING SR. ZYMTX
     C*
     C                     EXSR ZYMTX
     C/COPY WNCPYSRC,SE5120C005
     C*
     C* UPDATE SECURITY
     C*
     C                     MOVE ZY1       MKPR
     C                     MOVE ECD       LPRU
     C                     UPDATSECTYDF
     C                     ADD  1         SECUPD  50
     C*
     C                     ADD  1         UPDCT   50
     C*                                                                   E29170
     C** Open printer file if required                                    E29170
     C*                                                                   E29170
     C           FILOPN    IFEQ 'N'                                       E29170
     C                     OPEN SE5120P1                                  E29170
     C*                                                                   E29170
     C** RCF Processing for Detail Printer File                           E29170
     C*                                                                   E29170
     C                     EXSR RCFP1                                     E29170
     C                     Z-ADD0         PAGE                            E29170
     C                     MOVEL'Y'       FILOPN  1                       E29170
     C                     END                                            E29170
     C*
     C* PRINT OUT REPORT
     C*
     C           INVT      IFNE @INV
     C                     WRITEHEADP1
     C                     WRITEHEADP2                                    E20885
     C                     MOVE INVT      @INV    3
     C                     END
     C*
     C* DEFINE AND INITIALISE NO. DEC PLACES WORK FIELDS
     C*
     C                     Z-ADD8         ZADEC
     C                     Z-ADD8         ZDECS
     C                     MOVE *BLANK    ZECODE
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ZB1       ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RMAT
     C*
     C                     Z-ADDZMDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RDAT
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ZY1       ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RYR
     C*
     C* ONLY SHOW FOLLOWING FIELDS IF THE DAYS TO MATURITY ON THE
     C* SECURITY DOES NOT MATCH AN ENTRY ON MATRIX CPPRID
     C*
     C           ZB1       LOKUPZND                      45
     C*
     C           *IN45     IFEQ '0'
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE ZB2       ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    RPDY
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE ZB3       ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    RNDY
     C*
     C*********************Z-ADDZB2       ZDAYNO                          E17763
     C********** RUND      ADD  ZB2       ZDAYNO                                       E17763 111152
     C           ACDT      ADD  ZB2       ZDAYNO                                              111152
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RPDT
     C*
     C*********************Z-ADDZB3       ZDAYNO                          E17763
     C********** RUND      ADD  ZB3       ZDAYNO                                       E17763 111152
     C           ACDT      ADD  ZB3       ZDAYNO                                              111152
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RNDT
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ZY2       ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPYR
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ZY3       ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RNYR
     C*
     C                     ELSE
     C*
     C                     MOVE *BLANKS   RPDY
     C                     MOVE *BLANKS   RNDY
     C                     MOVE *BLANKS   RPDT
     C                     MOVE *BLANKS   RNDT
     C                     MOVE *BLANKS   RPYR
     C                     MOVE *BLANKS   RNYR
     C*
     C                     END
     C*
     C/COPY WNCPYSRC,SE5120C006
     C                     WRITEDETAIL
     C/COPY WNCPYSRC,SE5120C007
     C           *IN01     IFEQ '1'                                       E22107
     C                     WRITEHEADP1                                    E22107
     C                     WRITEHEADP2                                    E22107
     C                     SETOF                         01               E22107
     C                     END                                            E22107
     C*
     C* ADD RECORD TO SECURITY NON-DIARY EVENTS FILE (SNDEVD)
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE SESN      SNSN
     C**********           MOVE RUND      SNDT                                                111152
     C                     MOVE ECD       SNDT                                                111152
     C                     MOVE 'PR'      SNET
     C                     MOVE ZY1       SNPR
     C/COPY WNCPYSRC,SE5120C008
     C                     MOVEL'MATRIX M'SNNA
     C                     MOVE 'K PRICE' SNNA
     C/COPY WNCPYSRC,SE5120C009
     C*
     C                     WRITESNDEVDF
     C*
     C                     ADD  1         EVNCT   50
     C*
     C                     END
     C*                                                                   S01176
     C           CPKEY     READESECTYC                   36               S01176
     C                     END                                            S01176
     C*                                                                   S01176
     C                     END
     C                     END
     C*
     C* PRINT 'END OF REPORT' STATEMENT WHEN NO MORE CPP RECORDS
     C*
     C                     ELSE
     C*                                                                   E18128
     C* FIX TO PRODUCE HEADER IF NOT ALREADY WRITTEN ON PRINT FILE.       E18128
     C*                                                                   E18128
     C***********@INV      IFEQ *BLANKS                            E18128 E20885
     C***********          WRITEHEADP1                             E18128 E20885
     C***********          END                                     E18128 E20885
     C***********                                                  E18128 E20885
     C***********          WRITETRAILP1                            E18128 E20885
     C*                                                                   E20885
     C           @INV      IFEQ *BLANKS                                   E20885
     C***********          WRITEHEADP1                              E20885E29170
     C***********          WRITENONE                                E20885E29170
     C*                                                                   E20885
     C                     ELSE                                           E20885
     C           *INU7     IFEQ '1'                                       E29170
     C                     WRITEERRORP1                                   E29170
     C                     END                                            E29170
     C*                                                                   E20885
     C                     WRITETRAILP1                                   E20885
     C*                                                                   E20885
     C                     END                                            E20885
     C*                                                                   E20885
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*  AUDIT - SUBROUTINE TO PERFORM RUN CONTROL PROCESS            *
     C*                                                               *
     C*****************************************************************
     C*
     C           AUDIT     BEGSR
     C*
     C* IF ALREADY HAD DATABASE ERROR REPORT IT
     C*
     C           *IN32     IFEQ '1'
     C                     EXSR INVSR
     C                     END
     C*
     C************INU7     IFEQ '0'                                       E18128
     C************IN33     ANDEQ'1'                                       S01176
     C************IN33     ANDEQ'0'                                 S01176E18128
     C           *INU7     IFEQ '1'                                       E18128
     C/COPY WNCPYSRC,SE5120C003
     C                     EXSR SECSR
     C                     END
     C*
     C           *INU7     IFEQ '0'
     C*
     C* READ C.PAPER PRICES RECORD - IF NOT THERE, DATABASE ERROR
     C*
     C                     READ CPPRIAF                  34
     C           *IN34     IFEQ '1'
     C                     SETON                     U7U8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'C.P.PR'  DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            **DB ERROR 03**
     C***********          MOVE '03'      DBASE            ***************S01117
     C                     Z-ADD3         DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     ELSE
     C                     MOVE NORE      CNORE
     C                     MOVE CPPCT     CPPCTT
     C                     END
     C                     END
     C*
     C* READ SECURITY NON-DIARY EVENTS AUDIT RECORD - IF NOT THERE
     C*      DATA BASE ERROR
     C*
     C           *INU7     IFEQ '0'
     C*
     C                     READ SNDEVAF                  35
     C           *IN35     IFEQ '1'
     C                     SETON                     U7U8
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SNDEV'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY            **DB ERROR 04**
     C***********          MOVE '04'      DBASE            ***************S01117
     C                     Z-ADD4         DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C                     END
     C*
     C* ADD NO OF RECORDS OUTPUT TO RECORD COUNT AND UPDATE FILES
     C*
     C           *INU7     IFEQ '0'
     C*
     C**********           Z-ADDNORE      SNORE   50                                          247420
     C                     Z-ADDSNNORE    SNORE   70                                          247420
     C********** NORE      ADD  UPDCT     ONORE   50                      102718
     C********** NORE      ADD  EVNCT     ONORE   50                      102718              247420
     C**********           Z-ADDONORE     NORE                                                247420
     C           SNNORE    ADD  EVNCT     ONORE   70                                          247420
     C                     Z-ADDONORE     SNNORE                                              247420
     C                     UPDATSNDEVAF
     C*
     C*********************UPDATCPPRIAF                                   E18128
     C*
     C                     END
     C*                                                                   E29170
     C** RCF Processing for Audit File                                    E29170
     C*                                                                   E29170
     C                     EXSR RCFAU                                     E29170
     C                     Z-ADD0         PAGE                            E29170
     C*
     C* WRITE OUT CONTROL REPORT OR DATABASE ERROR
     C*
     C                     WRITEHEADAU
     C  NU7                WRITECONTROL
     C   U7 U8             WRITEERROR
     C           @INV      IFEQ *BLANKS                                   E29170
     C                     WRITENONE                                      E29170
     C                     END                                            E29170
     C***********          WRITETRAIL                                     E29170
     C*
     C                     SETON                     LR
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*   CPRSR  - SUBROUTINE FOR ERROR HANDLING OF COMMERCIAL PAPER  *
     C*            PRICES FILE                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           CPRSR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'COMPP'   DBFILE
     C                     MOVELINVT      PKEY   15
     C                     MOVE CCY       PKEY
     C                     MOVELPKEY      DBKEY
     C***********          MOVE '90'      DBASE                           S01117
     C                     Z-ADD90        DBASE                           S01117
     C                     MOVE STSCPR    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     LRU7U8
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*   SECSR  - SUBROUTINE FOR ERROR HANDLING OF SECURITIES FILE   *
     C*                                                               *
     C*****************************************************************
     C*
     C           SECSR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SECTY'   DBFILE
     C                     MOVELSESN      DBKEY
     C***********          MOVE '91'      DBASE                           E20651
     C***********          MOVE '95'      DBASE                    E20651 S01117
     C                     Z-ADD95        DBASE                           S01117
     C                     MOVE STSSEC    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     LRU7U8
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*   INVSR  - SUBROUTINE FOR ERROR HANDLING OF INVESTMENT TYPES  *
     C*            FILE                                               *
     C*                                                               *
     C*****************************************************************
     C*
     C           INVSR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'INVTP'   DBFILE
     C                     MOVELINVT      DBKEY
     C***********          MOVE '91'      DBASE                           E20651
     C***********          MOVE '96'      DBASE                    E20651 S01117
     C                     Z-ADD96        DBASE                           S01117
     C                     MOVE STSINV    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     LRU7U8
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*   CPASR  - SUBROUTINE FOR ERROR HANDLING OF CP PRICES FILE    *
     C*               AUDIT RECORD                                    *
     C*                                                               *
     C*****************************************************************
     C*
     C           CPASR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'C.P.P'   DBFILE
     C                     MOVEL'AUDIT'   DBKEY
     C***********          MOVE '92'      DBASE                           S01117
     C                     Z-ADD92        DBASE                           S01117
     C                     MOVE STSCPA    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     LRU7U8
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*   SNASR  - SUBROUTINE FOR ERROR HANDLING OF SECURITIES NON-   *
     C*               DIARY EVENTS AUDIT RECORD                       *
     C*                                                               *
     C*****************************************************************
     C*
     C           SNASR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SNDEV'   DBFILE
     C                     MOVEL'AUDIT'   DBKEY
     C***********          MOVE '93'      DBASE                           S01117
     C                     Z-ADD93        DBASE                           S01117
     C                     MOVE STSSNA    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     LRU7U8
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /SPACE 3
     C*****************************************************************
     C*                                                               *
     C*   SNDSR  - SUBROUTINE FOR ERROR HANDLING OF SECURITIES NON -  *
     C*               DIARY EVENTS FILE                               *
     C*                                                               *
     C*****************************************************************
     C*
     C           SNDSR     BEGSR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'SNDEV'   DBFILE
     C                     MOVELSNSN      SNKEY  17
     C                     MOVELSNDT      SNKEYA  7
     C                     MOVE 'CP'      SNKEYA
     C                     MOVE SNKEYA    SNKEY
     C                     MOVELSNKEY     DBKEY
     C***********          MOVE '94'      DBASE                           S01117
     C                     Z-ADD94        DBASE                           S01117
     C                     MOVE STSSND    DBSTAT
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     MOVE '1'       *IN87
     C                     SETON                     LRU7U8
     C*
     C                     ENDSR
     C*
      *****************************************************************   S01117
      /EJECT                                                              S01117
      *****************************************************************   S01117
      *                                                               *   S01117
      *  *PSSR  - Error control subroutine                            *   S01117
      *                                                               *   S01117
      *****************************************************************   S01117
      *                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C**                                                                  S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
      *                                                                   S01117
     C*****************************************************************
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFP1     BEGSR                            ** RCFP1 **   E29170
     C*                                                                   E29170
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUM     ZSNUM   60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ     5                       E29170
     C                     PARM *BLANKS   SENTY   3                       E29170
     C                     PARM           SFILE                           E29170
     C                     PARM           ZSNUM                           E29170
     C                     PARM           ZSERR   1                       E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C/EJECT                                                              E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C*  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          E29170
     C*                                                                   E29170
     C********************************************************************E29170
     C*                                                                   E29170
     C           RCFAU     BEGSR                            ** RCFAU **   E29170
     C*                                                                   E29170
     C**      ENSURE AUDIT SPOOL FILE RECORDED BY RCF                     E29170
     C*                                                                   E29170
     C                     Z-ADDSFNUMU    ZSNUMU  60                      E29170
     C**                                                                  E29170
     C                     CALL 'ZSFILE'                                  E29170
     C                     PARM           SEQ                             E29170
     C                     PARM *BLANKS   SENTY                           E29170
     C                     PARM           SFILEU                          E29170
     C                     PARM           ZSNUMU                          E29170
     C                     PARM *BLANK    ZSERR                           E29170
     C*                                                                   E29170
     C           ZSERR     IFEQ 'Y'                                       E29170
     C*                                                                   E29170
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       E29170
     C*                                                                   E29170
     C                     SETON                     U7U8LR               E29170
     C                     RETRN                                          E29170
     C                     END                                            E29170
     C*                                                                   E29170
     C                     ENDSR                                          E29170
     C*                                                                   E29170
     C*****************************************************************   E29170
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
     C/COPY ZSRSRC,ZICD2Z1
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZSYSTMZ1
      /EJECT
     C/COPY ZSRSRC,ZYMTXZ2
      /EJECT
      ***
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Finastra International Limited 2001
