     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Pool trades awaiting completion')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module.                           *
     F*                                                               *
     F*  SE5220 - Pool Trades Awaiting Completion.                    *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD058285           Date 22Jun21               *
      *  Prev Amend No. MD046998A          Date 15Apr21               *
      *                 248698             Date 01Jun20               *
      *                 MD057247           Date 01Feb21               *
      *                 MD050604           Date 21Feb20               *
      *                 MD046248           Date 27Oct17               *
      *                 226449             Date 24Jun15               *
      *                 MD034776           Date 09Jul15               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 07Jan03               *
      *                 211407             Date 07Jan03               *
      *                 207543             Date 17JUL02               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 02Dec98               *
      *                 130862             Date 18Oct98               *
      *                 CSE005             Date 04Feb97               *
      *                 084704             Date 01Aug96               *
     F*                 083039             DATE 01AUG96               *
     F*                 059110             DATE 25JUL96               *
     F*                 088047             DATE 27JUN96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 092961             DATE 04OCT95               *
     F*                 082677             DATE 14SEP95               *
     F*                 086491             DATE 15JUN95               *
     F*                 S01486 MD          DATE 04NOV94               *
     F*                 058886             DATE 20JUL93               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  MD046998A - Recompiled due to changes in /COPY ZDYYRZ3       *
      *            - Applied fix for MD057480                         *
      *  248698 - Rounding discrepancies on some SE reports. Applied  *
      *           fix 228682.                                         *
      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
      *  MD057247 - Multiple calls of UTCHOBJEX for several COB com-  *
      *             ponents - Securities module.                      *
      *           - Moved the call of AOSARDR0 from /copy ZLCDZ1.     *
      *  MD050604 - Average price of position changed incorrectly.    *
      *           - Recompiled due to changes in copy source ZCNSDZ1. *
      *  MD046248 - Finastra Rebranding                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  222373 - Parameter Mismatch                                  *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompile over changed ZYLDZ2.                      *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  CAC005 - PCA-SE Enhancement.                                 *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
      *  CSE005 - Effect of holidays on FRN Coupon Dates              *
      *           (recompilation due to change to ZNCD/ZLCD)          *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adj. on   *
     F*           SECTYD. Change subroutine to use DADJN to stop      *
     F*           interest day adjustment being used for amortisation.*
     F*           Recompile over amended subroutine ZDAYS.            *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  082677 - Recompiled over printer file                        *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  S01486  -  Private Banking Upgrade to Release 10.            *
     F*             LDA Changes, Access object, Standartization of    *
     F*             Reports Produced                                  *
     F*  058886  -  OBJECT PM5210 RENAMED TO SE5220                   *
     F*                                                               *
     F*****************************************************************
     F**PM5120P1O***E                 PRINTER                        U C  58886
     F**PM5120AUO***E                 PRINTER                             58886
     FSE5220P1O   E                    PRINTER                        UC  58886
     F                                              KINFDS SPOOL          S01486
     FSE5220AUO   E                    PRINTER                            58886
     F                                              KINFDS SPOOLU         S01486
     FSECTY   IF  E           K        DISK
     F*CLINT***IF**E           K        DISK                              S01486
     F************CLINTCAF                          KIGNORE               S01486
     F************CLINTCCF                          KIGNORE               S01486
     F************CLINTC1F                          KIGNORE               S01486
     F************CLINTSEF                          KIGNORE               S01486
     FPMPLTRL0IF  E           K        DISK
     F*TABSE***IF**E           K        DISK                              S01486
     F**ICD*1*****TABTB10F                          KIGNORE               S01486
     F**ICD*1*****TABTB11F                          KIGNORE               S01486
     F************TABTB36F                          KIGNORE               S01486
     F************TABTB40F                          KIGNORE               S01486
     F**CCY*1*****TABTG10F                          KIGNORE               S01486
     F************TABTG20F                          KIGNORE               S01486
     F************TABLETHF                          KIGNORE               S01486
     F**CCY*2*****TABLETJF                          KIGNORE               S01486
     F************TABLETKF                          KIGNORE               S01486
     F************TABLETLF                          KIGNORE               S01486
     F************TABLETNF                          KIGNORE               S01486
     F************TABLETPF                          KIGNORE               S01486
     F**BRANCH****TABLETRF                          KIGNORE               S01486
     F************TABLETXF                          KIGNORE               S01486
     F************TABLET2F                          KIGNORE               S01486
     F************TABLET3F                          KIGNORE               S01486
     F************TABLET5F                          KIGNORE               S01486
     F************TABTE10F                          KIGNORE               S01486
     F************TABLETAF                          KIGNORE               S01486
     F************TABTE20F                          KIGNORE               S01486
     FSEDEV   IF  E           K        DISK
     FSECEO   IF  E           K        DISK                               S01486
     F            SEDEVDF                           KRENAMESEDEVDO        S01486
     F            SNDEVDF                           KRENAMESNDEVDO        S01486
     FINVTP   IF  E           K        DISK                               S01486
     F**********************************************************************
     F*
     F*  F U N C T I O N   O F   I N D I C A T O R S
     F*
     F**********************************************************************
     F*
     F*    25     NOMINAL CCY NOT FOUND
     F*    31     END OF FILE FOR SECTY
     F*    36     IF MULTIBRANCHING PRESENT SETS ON                       S01486
     F*    37     IF REPORTS OF DETAILS SETS ON                           S01486
     F*    41     RECORD NOT FOUND WHEN CHAINING
     F*    50     USED AS INDICATOR IN AUDIT PRINT FILE
     F*    51     USED ON COMPARE OF BRANCH CODES BETWEEN RECORDS
     F*    52     AUSTRALIAN YIELD TRADED SECURITY
     F*    61     FIRST TIME INDICATOR FOR OPENING PRINTER FILE SE5220P1
     F*    71     USED ON COMPARE OF SECURITY NAMES BETWEEN RECORDS
     F*           AND IN THE PRINT FILE SE5220P1
     F*    99     USED IN THE Z-SUBROUTINES
     F*    U7-U8  DATABASE ERROR
     F*    U8     DIFFERENCE BETWEEN CALC AND FILE TOTALS OF RECORDS
     F*
     F*****************************************************************   S01486
     F/SPACE 3                                                            S01486
     F*****************************************************************   S01486
     F*
     F*    FIRST   -  OBTAINS ICD INFO
     F*    PR01    -  CONTROLS PRINTING OF REPORT
     F*    AUDIT   -  OUTPUTS CONTROL REPORT AND UPDATES AUDIT RECORD
     F*    RCFAU  - RCF PROCESSING FOR AUDIT REPORT                       S01486
     F*    RCFP1  - RCF PROCESSING FOR P1 REPORT                          S01486
     F*    ZDATE1  -  VALIDATE DATES AND CONVERT TO A NUMBER OF DAYS
     F*    ZDATE2  -  DAYNO - DATE CONVERSION
     F*    ZSEDIT  -  PUTS COMMAS, DEC.PL AND SIGN IN NUMERIC FIELDS
     F*    ZPRCO   -  SUBROUTINE FOR TO GET PRICE/DISC/YIELD
     F*    ZDAYS   -  CALCULATES NO. OF DAYS BETWEEN TWO DATES.
     F*    ZDYYR   -  CALCULATE NUMBER OF DAYS IN INTEREST YEAR
     F*    ZYLDO   -  SUBROUTINE TO OUTPUT  PRICE/DISC/YIELD
     F*    ZEVCD   -  DETERMINE EVENT CONTROL DATE
     F*    ZNCD    -  CALCULATES THE NEXT COUPON DATE
     F*    ZLCD    -  GET PREVIOUC COUPON DATE
     F*    ZACCZ   -                                                      S01486
     F*    ZCNSD   -  CALCULATES CONSIDERATION                            S01486
     F*    ZCALCD  -  CALCULATES LONG TERM CD PRICE FROM INPUT YELD       S01486
     F*    ZACCR   -  CALCULATES INTEREST ACCRUED BETWEEN TWO DATES       S01486
     F*    ZRATE   -  CALCULATES EFFECTIVE INTEREST RATE                  S01486
     F*
     F**********************************************************************
     E*
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZNCDZ1
     E/COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZACCRZ0                                                S01486
     E**/COPY*ZSRSRC,ZDATE6Z1                                             S01486
     E*
     I*
     I** Rename Porfolio pool trade fields to be immediately output on
     I** Trade file
     I*
     IPMPLTRP0
     I              OURECI                          RECI
     I              OUDLUP                          DLUP
     I              OUMLUP                          MLUP
     I              OUYLUP                          YLUP
     I              OUTLUP                          TLUP
     I              OUCHTP                          CHTP
     I              OUBLKR                          BLKR
     I              OULCD                           LCD
     I              OUTNLU                          TNLU
     I              OUPCNU                          PCNU
     I              OUPPTF                          PTFR
     I              OUTINC                          TINC
     I              OUTDSS                          TDSS
     I              OUTDTP                          TDTP
     I              OUTNOM                          NOML
     I              OUTPDY                          TPDY
     I              OUTDVD                          TDVD
     I              OUTDBR                          TDBR
     I              OUTDBK                          TDBK
     I              OUTDDT                          TDDT
     I              OUTSUB                          TSUB
     I              OULKRF                          LKRF
     I              OUTDMI                          TDMI
     I              OUTDNR                          TDNR
     I              OUTDID                          TDID
     I              OUAIIP                          AIIP
     I              OUTMKC                          TMKC
     I              OUTCAP                          TCAP
     I              OUACIN                          ACIN
     I              OUDADJ                          DADJ
     I              OUADIN                          ADIN
     I              OUPRIC                          PRIC
     I              OUEXDV                          EXDV
     I              OURALL                          RALL
     I              OUSETC                          SETC
     I              OUTDER                          TDER
     I              OUTMDI                          TMDI
     I              OUTBCR                          TBCR
     I              OUCLTY                          CLTY
     I              OUDELT                          DELT
     I              OUDELF                          DELF
     I              OUTBCC                          TBCC
     I              OUTCCC                          TCCC
     I              OUTCC1                          TCC1
     I              OUTCC2                          TCC2
     I              OUTCC3                          TCC3
     I              OUTCC4                          TCC4
     I              OUTCC5                          TCC5
     I              OUTCC6                          TCC6
     I              OUTCC7                          TCC7
     I              OUBCMR                          BCMR
     I              OUCCMR                          CCMR
     I              OUTXRB                          TXRB
     I              OUATRD                          ATRD
     I              OUAUTS                          AUTS
     I*                                                                   S01486
     ISDBANK    E DSSDBANKPD                                              S01486
     I*                                                                   S01486
     I** Bank Details                                                     S01486
     I*                                                                   S01486
     ISDBRCH    E DSSDBRCHPD                                              S01486
     I*                                                                   S01486
     I** Branch kodes                                                     S01486
     I*                                                                   S01486
     ISDGELR    E DSSDGELRPD                                              S01486
     I*                                                                   S01486
     I** General Ledger Details                                           S01486
     I*                                                                   S01486
     ISDCUST    E DSSDCUSTPD                                              S01486
     I              QQDFAC                          #DFAC1                                    CGL029
     I*                                                                   S01486
     I** Customer details                                                 S01486
     I*                                                                   S01486
     ISDCURR    E DSSDCURRPD                                              S01486
     I*                                                                   S01486
     I** Currency details                                                 S01486
     I*                                                                   S01401
     IDSFDY     E DSDSFDY                                                 S01486
     I*                                                                   S01486
     I** DS for access programs, short data structure                     S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
     I*                                                                   S01486
     I** Portfolio Definition Via Access Program                          S01486
     I*                                                                   S01486
      *  Error reporting data structure
     I*LDA********UDS                            256                      S01486
     ILDA         DS                            256                       S01486
     I************                          132 183 DBLOT                 S01486
     I                                      134 183 DBLOT                 S01486
     I************                          132 141 DBFILE                S01486
     I                                      134 141 DBFILE                S01486
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                   S01486
     IRUNDT       DS                                                      S01486
     I*                                                                   S01486
     I**  DATA STRUCTURE FOR RUN DATE DETAILS                             S01486
     I*                                                                   S01486
     I                                        1   7 RUNA                  S01486
     I                                    P   8  100RUND                  S01486
     I                                       11  11 SSF                   S01486
     I                                       12  12 DATF                  S01486
     I                                       13  13 MBIN                  S01486
     I*                                                                   S01486
     ISPOOL       DS                                                      S01486
     I*                                                                   S01486
     I**  DS FOR P1 SPOOL FILE NAME                                       S01486
     I*                                                                   S01486
     I                                       83  92 SFILE                 S01486
     I                                    B 123 1240SFNUM                 S01486
     I*                                                                   S01486
     ISPOOLU      DS                                                      S01486
     I*                                                                   S01486
     I**  DS FOR AU SPOOL FILE NAME                                       S01486
     I*                                                                   S01486
     I                                       83  92 SFILEU                S01486
     I                                    B 123 1240SFNUMU                S01486
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY ZSRSRC,ZNCDZ2
     I/COPY ZSRSRC,ZYLDZ1
     I/COPY WNCPYSRC,SE5220I001
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C********************************************************************
      *                                                                   S01486
      ** Initial parameter                                                S01486
     C           *ENTRY    PLIST                                          S01486
     C                     PARM           @RSEQ   5                       S01486
     C                     PARM           @RLEV   1                       S01486
     C                     PARM           @RENT   3                       S01486
      *                                                                   S01486
     C           *NAMVAR   DEFN           LDA                             S01486
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01486
     C                     IN   RUNDT                                     S01486
     C           *LIKE     DEFN DBLOT     @DBSAV                          S01486
     C                     SETOF                     U7U8                 S01486
     C*                                                                   S01486
     C** KEY LIST FOR LF/INVTP                                            S01486
     C*                                                                   S01486
     C           @KEYI     KLIST                                          S01486
     C                     KFLD           NMCY                            S01486
     C                     KFLD           SITP                            S01486
     C/COPY WNCPYSRC,SE5220C001
      *                                                                                       CSE035
      *  Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE031 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD  7                                         MD057247
     C                     PARM '*VERIFY' UOPTN   7                                         MD057247
     C                     PARM 'CSE031'  UUKEY   6                                         MD057247
     C                     PARM           UDSFDY 76                                         MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE031  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE031                                            MD057247
     C                     ENDIF                                                            MD057247
      *                                                                                     MD057247
      ** Access Switchable Features file to determine if CSE071 is                          MD057247
      ** installed in the system.                                                           MD057247
      *                                                                                     MD057247
     C                     CALL 'AOSARDR0'                                                  MD057247
     C                     PARM           URTNCD                                            MD057247
     C                     PARM '*VERIFY' UOPTN                                             MD057247
     C                     PARM 'CSE071'  UUKEY                                             MD057247
     C                     PARM           UDSFDY                                            MD057247
      *                                                                                     MD057247
     C                     MOVE 'N'       CSE071  1                                         MD057247
     C           URTNCD    IFEQ *BLANKS                                                     MD057247
     C                     MOVE 'Y'       CSE071                                            MD057247
     C                     ENDIF                                                            MD057247
     C*
     C* CLEAR LDA
     C*
     C                     MOVE *BLANK    DBLOT
     C****                 MOVEL'PM5120  'DBPGM                           58886
     C                     MOVEL'SE5220  'DBPGM                           58886
     C*
     C*                                                                   S01486
     C* REGISTRED AUDIT PRTFILE                                           S01486
     C*                                                                   S01486
     C                     EXSR RCFAU                                     S01486
     C*
     C* OBTAIN ICD INFO
     C*
     C                     EXSR FIRST
     C*
     C* CHECK FOR DATABASE ERRORS
     C*
     C           *INU7     IFEQ '1'
     C                     GOTO EAUDIT
     C                     END
     C*
     C                     Z-ADD0         LCNT    20
     C                     Z-ADD0         IREC    50
     C                     Z-ADD0         OREC    50
     C***********          Z-ADD0         CHKBR   30                      S01486
     C                     MOVE *BLANKS   CHKBR   3                       S01486
     C                     MOVE *BLANKS   CHKSS  10
     C                     Z-ADD0         SECINC  50
     C                     Z-ADD0         SECCOM  50
     C*
     C*  READ FIRST RECORD FROM THE TRADES FILE TRDIN
     C*  IF EOF SETON *IN31
     C*
     C                     READ PMPLTRL0                 31
     C           *IN31     DOWEQ'0'
     C           TINC      IFEQ 'I'
      *
      ***  Do 'Change of Branch' processing. Indicator 51 is set off if
      ***  the Trade Branch is different to the Current Branch and will
      ***  only be set on again when it is processed in PR01.
      *
     C           TDBR      IFNE CHKBR
     C                     SETOF                     51
     C                     MOVE TDBR      CHKBR
     C*
     C***GET*BRANCH*NAME*FROM*THE*FILE*TABLETR*IF*NOT*FOUND*STD*DB*ERROR**S01486
     C*  GET BRANCH NAME FROM THE FILE SDBRCHR0 IF NOT FOUND STD DB ERROR S01486
     C*                                                                   S01486
     C***********          MOVE *BLANKS   KEY                             S01486
     C***********          MOVE TDBR      KEY    12                       S01486
     C***********          MOVEL'10'      KEY                             S01486
     C                     MOVE TDBR      KEY     3                       S01486
     C***********KEY       CHAINTABLETRF             41                   S01486
     C**********           CALL 'AOBRCHR0'                                             S01486 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM KEY       @BRCD   3                       S01486
     C           SDBRCH    PARM SDBRCH    DSSDY                           S01486
     C*                                                                   S01786
     C************IN41     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C***********          MOVEL'TABLETRF'DBFILE                          S01486
     C                     MOVEL'SDBRCHPD'DBFILE                          S01486
     C                     MOVELKEY       DBKEY            **************
     C                     Z-ADD3         DBASE            * DB ERROR 3 *
     C                     GOTO EAUDIT                     **************
     C                     END
     C                     MOVE *BLANKS   KEY
     C                     END
     C*
     C*  CHECK THAT THE NEW SECURITY IS = CURRENT SECURITY, IF NOT PUT
     C*  SECURITY SHORTNAME INTO THE CHECKING FIELD AND THEN CHAIN TO
     C*  SECURITY FILE FOR THE NEW SECURITY NAME.
     C*
     C           TDSS      COMP CHKSS                    71
     C           *IN71     IFEQ '0'
     C                     MOVE TDSS      CHKSS
     C           TDSS      CHAINSECTYDF              41
     C*
     C*  IF SECURITY SHORTNAME NOT THERE, PERFORM STD DB ERROR
     C*
     C           *IN41     IFEQ '1'
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'SECTY'   DBFILE
     C                     MOVELTDSS      DBKEY            **************
     C                     Z-ADD4         DBASE            * DB ERROR 4 *
     C                     GOTO EAUDIT                     **************
     C                     END
     C*
     C*  INDICATE IF AUSTRALIAN YIELD SECURITY
     C*
     C           STBS      IFEQ 'Y'
     C           SYBS      ANDEQ'AU'
     C                     SETON                     52
     C                     ELSE
     C                     SETOF                     52
     C                     END
     C*                                                                   S01486
     C**   Get Processing type                                            S01486
     C*                                                                   S01486
     C           @KEYI     CHAININVTPDF              01                   S01486
     C*                                                                   S01486
     C           *IN01     IFEQ '1'                                       S01486
     C           RECI      OREQ '*'                                       S01486
     C                     MOVE '1'       *INU7                           S01486
     C                     MOVE '1'       *INU8                           S01486
     C                     MOVEL'INVTP'   DBFILE           ***************S01486
     C                     MOVE 'KEYI'    DBKEY            * DB ERROR  6 *S01486
     C                     Z-ADD6         DBASE            ***************S01486
     C                     GOTO EAUDIT                                    S01486
     C                     END                                            S01486
     C*
     C****ACCESS*TABTG10*FOR*NOMINAL*CURRENCY*DECIMAL*PLACES**************S01486
     C*   ACCESS SDCURRPD FOR NOMINAL CURRENCY DECIMAL PLACES             S01486
     C*
     C                     MOVEL'20      'TKEY   12
     C                     MOVELNMCY      ZWK4    4
     C                     MOVE 1         ZWK4
     C                     MOVE ZWK4      TKEY
     C***********TKEY      CHAINTABTG10F             25                   S01486
     C                     CALL 'AOCURRR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C**********           PARM 'TKEY   ' @OPTN   7                S01486 222373
     C                     PARM '*KEY   ' @OPTN   7                       222373
     C                     PARM NMCY      @KEY    3                       222373
     C           SDCURR    PARM SDCURR    DSSDY                           S01486
     C**N25******RECI      COMP 'D'                  2525                 S01486
     C*
     C*  IF NOMINAL CCY NOT THERE, PERFORM STD DB ERROR
     C*
     C************IN25     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANKS                                   S01486
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C***********          MOVEL'TABTG10F'DBFILE                          S01486
     C                     MOVEL'SDCURRPD'DBFILE                          S01486
     C                     MOVELTKEY      DBKEY            **************
     C                     Z-ADD5         DBASE            * DB ERROR 5 *
     C                     GOTO EAUDIT                     **************
     C                     END
     C***********          Z-ADDCDP       NCDP                            S01486
     C                     Z-ADDZCDP      NCDP                            S01486
     C*
     C                     END
     C*
     C*  CHECK FOR INCOMPLETE AND COMPLETE SECURITIES, ADD 1 TO THE
     C*  INCOMPLETE COUNT IF INCOMPLETE INDICATOR = I. ELSE ADD 1 TO
     C*  THE COMPLETE COUNT
     C*
     C           INCS      IFEQ 'I'
     C                     ADD  1         SECINC  50
     C                     ELSE
     C                     ADD  1         SECCOM  50
     C*
     C*  IF SECURITY IS COMPLETE THEN EXECUTE SR PR01 TO PRINT DETAILS
     C*
     C                     EXSR PR01
     C                     END
     C*
     C*  READ NEXT TRADE FROM TRDIN, SET ON 31 IF EOF
     C*
     C                     END
     C                     READ PMPLTRL0                 31
     C                     END
     C*
     C           EAUDIT    TAG
      *
      ***  If a Print File has been opened, write the Trailer and
      ***  close the File.
      *
     C           *IN61     IFEQ '1'
     C                     WRITETRAIL
     C****                 CLOSEPM5120P1                                  58886
     C                     CLOSESE5220P1                                  58886
     C                     END
      *
      ***  Then write the Audit Report.
      *
     C                     EXSR AUDIT
     C*
     C                     SETON                     LR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * FIRST - SUBROUTINE TO ACCESS ICD INFORMATION                  *
      *                                                               *
      *****************************************************************
      *
     C           FIRST     BEGSR                           ** FIRST **
     C*
     C* ACCESS ICDS AND PERFORM STANDARD DB ERRORS IF NOT THERE
     C*
     C***********          EXSR ZSYSTM                                    S01486
     C                     CALL 'AOBANKR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C           SDBANK    PARM SDBANK    DSFDY                           S01486
     C           BJDFIN    COMP 'M'                      98               S01486
     C*                                                                   S01486
     C************IN99     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'SDBANKPD'DBFILE           ***************S01486
     C                     MOVE *BLANKS   DBKEY            ** DB ERROR 01 S01486
     C                     Z-ADD1         DBASE            *****************
     C                     ELSE
     C***********          EXSR ZICD2                                     S01486
     C**********           CALL 'AOGELRR0'                                             S01486 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*FIRST ' @OPTN   7                       S01486
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01486 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C************INU7     IFEQ '1'                                       S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C                     MOVEL'SDGELRPD'DBFILE           ************** S01486
     C                     MOVE *BLANKS   DBKEY            * DB ERROR 2 * S01486
     C                     Z-ADD2         DBASE            **************
     C                     SETON                     U7U8                 S01486
     C                     ELSE
     C*
     C*  IF EVERYTHING OK AT PRESENT EXECUTE SR ZEVCD TO GET INFO THAT
     C*  IS REQUIRED LATER IN THE PROGRAM
     C*
     C                     EXSR ZEVCD
     C                     END
     C                     END
      *                                                                   S01486
      ** If Multibranching present set *IN36 ON.                          S01486
      *                                                                   S01486
     C           MBIN      IFEQ 'Y'                                       S01486
     C                     MOVE *ON       *IN36                           S01486
     C                     ENDIF                                          S01486
      *                                                                   CAC005
      ***  Check if CAC005 - PCA-SE Enhancement is on.                    CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   @RTCD   7                       CAC005
     C                     PARM '*VERIFY' @OPTN   7                       CAC005
     C                     PARM 'CAC005'  @SARD   6                       CAC005
      *                                                                   CAC005
     C           @RTCD     IFEQ *BLANK                                    CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  PR01 - SUBROUTINE THAT CONTROLS THE OUTPUT OF DATA TO THE    *
      *         PRINT FILE SE5220P1                                   *
      *                                                               *
      *****************************************************************
      *
     C           PR01      BEGSR                           ** PR01 BEGSR *
     C*
      ***  On change of Branch, if a Print File is open, write the
      ***  Trailer and close the File. Then open a new Print File.
      *
     C           *IN51     IFEQ '0'
      *
     C           *IN61     IFEQ '1'
     C                     WRITETRAIL
     C****                 CLOSEPM5120P1                                  58886
     C                     CLOSESE5220P1                                  58886
     C                     END
      *
      *
     C****                 OPEN PM5120P1                                  58886
     C                     OPEN SE5220P1                                  58886
     C                     EXSR RCFP1                                     S01486
     C                     Z-ADD0         PAGE
     C                     Z-ADD0         LCNT
     C                     SETON                     5161
     C                     END
     C*
     C*  MOVE VALUE DATE TO INPUT FIELD OF ZDATE2. EXECUTE ZDATE2 INORDER
     C*  TO GET DATE IN FORM DDMMMYY
     C*
     C                     MOVE TDVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ODATE1
     C*
     C*  MOVE TRADE DATE TO INPUT FILED OF ZDATE2. EXECUTE ZDATE2 INORDER
     C*  TO GHET DATE IN FORM DDMMMYY
     C*
     C                     MOVE TDDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ODATE2
     C*
     C***USE*COUNTERPARTY*NUMBER*TO*CHAIN*TO*CLIENT*FILE*CLINTCB.*IF******S01486
     C*  USE COUNTERPARTY NUMBER TO CHAIN TO SDCUSTPD FILE CLINTCB. IF    S01486
     C*  RECORD NOT FOUND OR CUSTOMER SHORTNAME = BLANKS *IN41 IS SET ON
     C*  AND THE TRADE COUNTERPARTY NUMBER IS PRINTED ON OUTPUT SE5220P1.
     C*
     C***********PCNU      CHAINCLINTCBF             41                   S01486
     C                     MOVE PCNU      WCSNM  10                       S01486
     C                     CALL 'AOCUSTR0'                                S01486
     C                     PARM *BLANKS   @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM WCSNM     @KEY1  10                       S01486
     C                     PARM           @KYST   7                       S01486
     C           SDCUST    PARM SDCUST    DSSDY                           S01486
     C***********CSNM      IFEQ *BLANKS                                   S01486
     C           @KYST     IFEQ '*NUMBER'                                 S01486
     C           @KYST     OREQ '*ERROR'                                  S01486
     C                     SETON                     41
     C                     END
     C*
     C*  EXECUTE THE FOLLOWING SUBROUTINES IN ORDER TO GET TRADE PRICE
     C*  EXPRESSED AS PRICE/DISC/YIELD VIA ZPRCO. THE FROM DATE SHOULD
     C*  BE THE TRADES VALUE DATE.
     C*
     C                     EXSR ZNCD
     C                     Z-ADDPRIC      ZPRICE
     C                     MOVE TDVD      ZFDATE
     C*
     C*     IF AN AUSTRALIAN YIELD SECURITY ...
     C*
     C           *IN52     IFEQ '1'
     C           NOML      ANDNE0
     C*          ITRA      DIV  NOML      WRKPI
     C*
     C                     ELSE
     C                     Z-ADD0         WRKPI
     C                     END
     C                     MOVE ACIN      SCUMEX
     C*
     C                     EXSR ZPRCO
     C                     MOVE ZPRCOT    ZFLD15
     C                     MOVE 'L'       ZECODE
     C                     Z-ADD8         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVELZOUT21    PRICE  20
     C*
     C*  EXECUTE SR ZSEDIT TO GET NOMINAL FROM TRADES FILE IN EDITED FORM
     C*  USE THE DECIMAL PLACES FROM THE SECTY FILE. MOVE INTO SMALL FIELD
     C*  SO THE SIGN IS DROPPED
     C*
     C                     MOVE 'J'       ZECODE
     C                     MOVE NMDP      ZDECS
     C                     Z-ADDNOML      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVELZOUT21    OUTNOM 20
     C*
     C*
     C*   - WRITE HEADINGS IF START OF PRINT OR OVERFLOW
     C*
     C           LCNT      IFGT 57
     C           LCNT      OREQ 0
     C                     WRITEHEAD1
     C                     Z-ADD13        LCNT
     C                     END
      *                                                                   CAC005
      ** If CAC005 is on, retrieve user book from AOBKPCR0.               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD   7                       CAC005
     C                     PARM '*USER  ' POPTN   7                       CAC005
     C           PMBKCD    PARM *BLANKS   PMBKCD  2                       CAC005
     C           PMPRFC    PARM *BLANKS   PMPRFC  4                       CAC005
     C                     PARM TDBK      PMPSBK  2                       CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPMBKCD    TDBK                            CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
     C*
     C*   - WRITE OUT THE DETAIL FOR CURRENT RECORD, ADD 1 OR 4 TO THE
     C*     LINE COUNT ADD 1 TO COUNT OF RECORDS REPORTED.
     C*
     C                     WRITEDETAIL
     C*                                                                   S01486
     C*   - IF WRITES DETAIL, SUPPRESS "NO DETAILS TO REPORT"             S01486
     C*                                                                   S01486
     C                     MOVE '1'       *IN37                           S01486
     C*                                                                   S01486
     C                     ADD  1         OREC
     C           *IN71     IFEQ '1'
     C                     ADD  1         LCNT
     C                     ELSE
     C                     ADD  4         LCNT
     C                     END
     C*
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  AUDIT  - SUBROUTINE TO OUTPUT AUDIT REPORT USING INFORMATION *
      *            FROM PROCESSING                                    *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR
     C*
     C                     MOVE '0'       *IN50
     C                     WRITEHEADAU
     C           *INU7     IFEQ '1'
     C                     MOVELDBLOT     @DBSAV                          S01486
     C           *LOCK     IN   LDA                                       S01486
     C                     MOVEL@DBSAV    DBLOT                           S01486
     C                     OUT  LDA                                       S01486
     C                     WRITEERROR
     C                     DUMP                                           S01486
     C                     ELSE
     C*
     C* CHECK FOR ANY RECORDS READ
     C*
     C           IREC      IFEQ 0
     C                     WRITECONTROL
     C**WRITE*P1*IF*NO*RECORD*********************************************S01486
     C***********          OPEN PM5120P1                            58886 S01486
     C***********          OPEN SE5220P1                            58886 S01486
     C***********          WRITEHEAD1                                     S01486
     C***********          WRITENONE1                                     S01486
     C***********          WRITETRAIL                                     S01486
     C***********          CLOSEPM5120P1                            58886 S01486
     C***********          CLOSESE5220P1                            58886 S01486
     C*
     C                     ELSE
     C                     WRITECONTROL
     C                     END
     C                     END
     C*
     C           *IN37     IFEQ '0'                                       S01486
     C                     WRITENONE                                      S01486
     C                     END                                            S01486
     C*
     C***********          WRITETRAILAU                                   S01486
     C*
     C                     ENDSR
      *
      *****************************************************************
     C/EJECT                                                              S01486
     C********************************************************************S01486
     C*                                                                   S01486
     C*  RCFP1 -- SUBROUTINE TO REGISTER P1 PRINTER FILE VIA RCF          S01486
     C*                                                                   S01486
     C********************************************************************S01486
     C*                                                                   S01486
     C           RCFP1     BEGSR                            ** RCFP1 **   S01486
     C*                                                                   S01486
     C**      ENSURE REPORT SPOOL FILE RECORDED BY RCF                    S01486
     C*                                                                   S01486
     C                     Z-ADDSFNUM     ZSNUM   60                      S01486
     C**                                                                  S01486
     C                     CALL 'ZSFILE'                                  S01486
     C                     PARM           @RSEQ   5                       S01486
     C                     PARM *BLANKS   SENTY   3                       S01486
     C                     PARM           SFILE                           S01486
     C                     PARM           ZSNUM                           S01486
     C                     PARM           ZSERR   1                       S01486
     C*                                                                   S01486
     C           ZSERR     IFEQ 'Y'                                       S01486
     C*                                                                   S01486
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01486
     C*                                                                   S01486
     C                     SETON                     U7U8LR               S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ENDSR                                          S01486
     C*                                                                   S01486
     C********************************************************************S01486
     C/EJECT                                                              S01486
     C********************************************************************S01486
     C*                                                                   S01486
     C*  RCFAU -- SUBROUTINE TO REGISTER AU PRINTER FILE VIA RCF          S01486
     C*                                                                   S01486
     C********************************************************************S01486
     C*                                                                   S01486
     C           RCFAU     BEGSR                            ** RCFAU **   S01486
     C*                                                                   S01486
     C**      ENSURE AUDIT SPOOL FILE RECORDED BY RCF                     S01486
     C*                                                                   S01486
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01486
     C**                                                                  S01486
     C                     CALL 'ZSFILE'                                  S01486
     C                     PARM           @RSEQ   5                       S01486
     C                     PARM *BLANKS   SENTY   3                       S01486
     C                     PARM           SFILEU                          S01486
     C                     PARM           ZSNUMU                          S01486
     C                     PARM           ZSERR   1                       S01486
     C*                                                                   S01486
     C           ZSERR     IFEQ 'Y'                                       S01486
     C*                                                                   S01486
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01486
     C*                                                                   S01486
     C                     SETON                     U7U8LR               S01486
     C                     RETRN                                          S01486
     C                     END                                            S01486
     C*                                                                   S01486
     C                     ENDSR                                          S01486
     C*                                                                   S01486
      *****************************************************************   S01486
      **/EJECT                                                            S01486
     C**/COPY*ZSRSRC,XDATE3Z1                                             S01486
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZDAYSZ2
      /EJECT
     C/COPY ZSRSRC,ZDYYRZ3
      /EJECT
     C/COPY ZSRSRC,ZEVCDZ1
      /EJECT
     C**/COPY*ZSRSRC,ZICD2Z1                                              S01486
      /EJECT
     C/COPY ZSRSRC,ZLCDZ1                                                                   MD057247
      /EJECT
     C/COPY ZSRSRC,ZNCDZ3
      /EJECT
     C/COPY ZSRSRC,ZPRCOZ1
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C**/COPY*ZSRSRC,ZSYSTMZ1                                             S01486
      /EJECT
     C/COPY ZSRSRC,ZYLDOZ1
      /EJECT
     C/COPY ZSRSRC,ZYLDZ2
      /EJECT
     C/COPY ZSRSRC,ZACCZZ1                                                S01486
      /EJECT                                                              S01486
     C/COPY ZSRSRC,ZCNSDZ1                                                S01486
      /EJECT                                                              S01486
     C/COPY ZSRSRC,ZCALCD                                                 S01486
      /EJECT                                                              S01486
     C/COPY ZSRSRC,ZACCRZ1                                                S01486
      /EJECT                                                              S01486
     C/COPY ZSRSRC,ZRATEZ1                                                S01486
      /EJECT                                                              S01486
      ***
**  CPY@
(c) Finastra International Limited 2001
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
