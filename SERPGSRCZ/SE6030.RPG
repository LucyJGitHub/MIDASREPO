000100200604     H
000200200604      *****************************************************************
000300200604/*STD *  RPGBASE                                                      *
000400200604/*EXI *  TEXT('Midas Cust/Inst Fee Codes Maintenance')
000500200604/*OVRF*: OVRDBF FILE(SECICFXX) TOFILE(SECICFPD) SHARE(*NO)          : *   S01464
000600200604     F*****************************************************************
000700200604     F**                                                              *
000800200604     F**   Midas  SAFE CUSTODY FEES MODULE                        *
000900200604     F**                                                              *
001000200604     F**   SE6030 - CUST/INST FEE CODES MAINTENANCE                   *
001100200604     F**                                                              *
001200200604     F**   FUNCTION:  This program allows the maintenance of Fee      *
001300200604     F**              structures to be charged per customer or        *
001400200604     F**              custody fee group for security positions and    *
001500200604     F**              precious metal balances.                        *
001600200604     F**                                                              *
001700200604     F**   CALLED BY: SEC02 - Input Cycle Processing                  *
001800200604     F**                                                              *
001900200604      *  (c) Finastra International Limited 2001                      *
002000200604     F**                                                              *
002100200604      *  Last Amend No. MD010785           Date 01Jun20               *
002200200604      *  Prev Amend No. MD046248           Date 27Oct17               *
002300200604      * Bank Fusion Midas 1.4 Base -----------------------------------*
002400200604      * Midas Plus 1.4 Base 04 ---------------------------------------*
002500200604      * Midas Plus 1.4 Base ------------------------------------------*
002600200604      * Midas Plus 1.3 ----------- Base ------------------------------*
002700200604      *                 CSD031             Date 10Apr06               *
002800200604      *                 CSD027             Date 09Dec05               *
002900200604      *                 CSE071             Date 19Jul05               *
003000200604      *                 CSW037A            Date 02May05               *
003100200604      *                 CSD025             Date 11Jan05               *
003200200604      *                 CSW037             Date 15Dec04               *
003300200604      *                 CSW036             Date 15Dec04               *
003400200604      *                 BUG3122            Date 17Jul04               *
003500200604      *                 CLE025             Date 20Oct03               *
003600200604      * Midas Release 4 --------------- Base -------------------------*
003700200604      * Midas DBA 3.00 ---------------- Base -------------------------*
003800200604      *                 S01464             Date 04Apr94               *
003900200604      *                 S01355             Date 11Dec92               *
004000200604     F**                                                              *
004100200604     F**--------------------------------------------------------------*
004200200604     F**                                                              *
004300200604      *  MD010785 - SEC6220 failure due to incorrect trailer update.  *
004400200604      *             Make sure trailer file is updated correctly       *
004500200604      *             when records are written to the detail file.      *
004600200604      *  MD046248 - Finastra Rebranding                               *
004700200604      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
004800200604      *  CSD027 - Conversion Of Customer Number to Alpha              *
004900200604      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
005000200604      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
005100200604      *  CSD025 - Customer De-Activation                              *
005200200604      *  CSW037 - Additional Field Data on MT300/MT320                *
005300200604      *  CSW036 - Dual SWIFT BIC held on Client Details               *
005400200604      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
005500200604      *  CLE025 - Credit Lines (Recompile)                            *
005600200604     F**    S01464 - SAFE CUSTODY FEES                                *
005700200604     F**    S01355  - RELEASE 3 INCORPORATION                         *
005800200604     F**                                                              *
005900200604     F*****************************************************************
006000200604     F** C R E A T I O N     P A R A M E T E R S                      *
006100200604     F**                                                              *
006200200604     F**                                                              *
006300200604     F** OVRDBF FILE(SCCICFXX) TOFILE(SCCICFPD) SHARE(*NO)          : *   S01464
006400200604     F**                                                              *
006500200604     F*****************************************************************
006600200604     F/EJECT
006700200604     F*****************************************************************
006800200604     F**
006900200604     F**      FILE DEFINITIONS
007000200604     F**     ------------------
007100200604     F*
007200200604     F**   WORKSTATION FILE
007300200604     F*SE6030DDCF  E                    WORKSTN      KINFSR *PSSR         S01464
007400200604     FSE6030DFCF  E                    WORKSTN      KINFSR *PSSR          S01464
007500200604     F                                        DD1RRNKSFILE SE6030S1
007600200604     F                                        DD2RRNKSFILE SE6030S2
007700200604     F                                              KINFDS ERF1DS
007800200604     F*
007900200604     F**   BANK DETAILS FILE. PREFIX BJ.
008000200604     FSDBANKPDIF  E                    DISK         KINFSR *PSSR
008100200604     F*
008200200604     F**   CUST/INST FEE CODES DETAILS (PRIMARY SEQUENCE). PREFIX SC.
008300200604     F***SCCICFXXIF**E***********K********DISK*********KINFSR *PSSR       S01464
008400200604     FSECICFXXIF  E           K        DISK         KINFSR *PSSR          S01464
008500200604     F************SCCICFP0**************************KRENAMESCCICFX0       S01464
008600200604     F            SECICFP0                          KRENAMESECICFX0       S01464
008700200604     F*
008800200604     F**   CUST/INST FEE CODES DETAILS ($HECKING SEQUENCE). PREFIX SC.
008900200604     F***SCCICFL1IF**E***********K********DISK*********KINFSR *PSSR       S01464
009000200604     FSECICFL1IF  E           K        DISK         KINFSR *PSSR          S01464
009100200604     F************SCCICFP0**************************KRENAMESCCICFP1       S01464
009200200604     F            SECICFP0                          KRENAMESECICFP1       S01464
009300200604     F*
009400200604     F**   CUSTODY FEE CHARGE CODE DETAILS. PREFIX SF.
009500200604     F***SCCGCDPDIF**E***********K********DISK*********KINFSR *PSSR       S01464
009600200604     FSECGCDPDIF  E           K        DISK         KINFSR *PSSR          S01464
009700200604     F*
009800200604     F*****CUSTOMER*MASTER*FILE*(SHORTNAME SEQUENCE).*PREFIX BB.          S01464
009900200604     F***SDCUSTL6IF**E***********K********DISK*********KINFSR *PSSR       S01464
010000200604     F*
010100200604     F*****SECURITY*CLIENT*FILE*(NUMBER*SEQUENCE).*PREFIX*BF.             S01464
010200200604     F***SDSECSL1IF**E***********K********DISK*********KINFSR**PSSR       S01464
010300200604     F*
010400200604     F**   SECURITY DEFINITIONS. NO PREFIX.
010500200604     FSECTY   IF  E           K        DISK         KINFSR *PSSR
010600200604     F*
010700200604     F**   INVESTMENT TYPES DEFINITIONS. NO PREFIX.
010800200604     FINVTPC  IF  E           K        DISK         KINFSR *PSSR
010900200604     F*
011000200604     F*****CURRENCY*DETAILS*EXTENSION.*PREFIX*A6*&*CY.                    S01464
011100200604     F***SDCURRJ0IF**E***********K********DISK*********KINFSR**PSSR       S01464
011200200604     F*
011300200604     F**   CUSTODY FEE GROUPS FILE. PREFIX SB.
011400200604     F***SCCFGRPDIF**E***********K********DISK*********KINFSR *PSSR       S01464
011500200604     FSECFGRPDIF  E           K        DISK         KINFSR *PSSR          S01464
011600200604     F*
011700200604     F**   CUST/INST FEE CODES TRAILER . PREFIX SC.
011800200604     F***SCCICFZZUF**E********************DISK*********KINFSR *PSSR       S01464
011900200604     FSECICFPAUF  E                    DISK         KINFSR *PSSR          S01464
012000200604     F                                              KCOMIT
012100200604     F*
012200200604     F**   CUST/INST FEE CODES DETAILS . PREFIX SC.
012300200604     F***SCCICFPDUF**E***********K********DISK*********KINFSR *PSSR A     S01464
012400200604     FSECICFPDUF  E           K        DISK         KINFSR *PSSR A        S01464
012500200604     F                                              KINFDS ERF2DS
012600200604     F                                              KCOMIT
012700200604     F*
012800200604     F*****************************************************************
012900200604     F/EJECT
013000200604     F*****************************************************************
013100200604     F**                                                              *
013200200604     F** ID F  C  H  L    FUNCTION OF INDICATORS                      *
013300200604     F**                 ------------------------                     *
013400200604     F**                                                              *
013500200604     F**       21         READ ON DISPLAY FILE - SE6030DF             *
013600200604     F**                                                              *
013700200604     F**       22         ACCESS TO SDBANKPD                          *
013800200604     F*********23*********ACCESS TO SCCICFXX                          *   S01464
013900200604     F**       23         ACCESS TO SECICFXX                          *   S01464
014000200604     F*********24*********ACCESS TO SCCICFL1                          *   S01464
014100200604     F**       24         ACCESS TO SECICFL1                          *   S01464
014200200604     F*********25*********ACCESS TO SCCGCDPD                          *   S01464
014300200604     F**       25         ACCESS TO SECGCDPD                          *   S01464
014400200604     F*********26*********ACCESS TO SDCUSTL6                          *   S01464
014500200604     F*********27*********ACCESS TO SDSECSL1                          *   S01464
014600200604     F**       28         ACCESS TO SECTY                             *
014700200604     F**       29         ACCESS TO INVTPC                            *
014800200604     F*********30*********ACCESS TO SDCURRJ0                          *   S01464
014900200604     F*********31*********ACCESS TO SCCFGRPD                          *   S01464
015000200604     F**       31         ACCESS TO SECFGRPD                          *   S01464
015100200604     F**                                                              *
015200200604     F*********32*********ACCESS TO SCCICFZZ                          *   S01464
015300200604     F**       32         ACCESS TO SECICFPA                          *   S01464
015400200604     F*********33*********ACCESS TO SCCICFPD                          *   S01464
015500200604     F**       33         ACCESS TO SECICFPD                          *   S01464
015600200604     F**                                                              *
015700200604     F**       40         SFLEND (MESSAGE SUBFILE)                    *
015800200604     F**       41         ROLLDOWN                                    *
015900200604     F**       42         ROLLUP                                      *
016000200604     F**                                                              *
016100200604     F**       43         SFLDSP                                      *
016200200604     F**       44         SFLDSPCTL                                   *
016300200604     F**       45         SFLCLR                                      *
016400200604     F**       46         SFLEND                                      *
016500200604     F**       47         SFLNXTCHG                                   *
016600200604     F**                                                              *
016700200604     F**                  CHANGE SCREEN                               *
016800200604     F**                  -------------                               *
016900200604     F**       50         ACTION 'RI PC'                              *
017000200604     F**       51         FEE CODE 'RI PC'                            *
017100200604     F**       52         REVIEW FROM CUSTOMER NO./SHORTNAME 'RI PC'  *
017200200604     F**       53         REVIEW FROM FEE GROUP 'RI PC'               *
017300200604     F**       54         REVIEW FROM SECURITY 'RI PC'                *
017400200604     F**       55         REVIEW FROM CURRENCY 'RI PC'                *
017500200604     F**       56         REVIEW FROM INVESTMENT TYPE 'RI PC'         *
017600200604     F**       63         FEE CODE 'PR'                               *
017700200604     F**       71         ACTION CODE 'PR'                            *
017800200604     F**                                                              *
017900200604     F**                  INPUT SCREEN                                *
018000200604     F**                  ------------                                *
018100200604     F**       57         CUSTOMER 'RI PC'                            *
018200200604     F**       58         FEE GROUP 'RI PC'                           *
018300200604     F**       59         SECURITY 'RI PC'                            *
018400200604     F**       60         CURRENCY 'RI PC'                            *
018500200604     F**       61         INVESTMENT TYPE 'RI PC'                     *
018600200604     F**       62         FEE CODE 'RI PC'                            *
018700200604     F**                                                              *
018800200604     F**       64         SUBFILE RECORD IN ERROR                     *
018900200604     F**                                                              *
019000200604     F**       67         NUMBER/SHORTNAME NOT VALID                  *
019100200604     F*********68*********LOKUP ON ALPHANUMERIC ARRAY                 *   S01464
019200200604     F*********69*********LOKUP ON NUMERIC ARRAY                      *   S01464
019300200604     F**                                                              *
019400200604     F**       70         CLEAR SUBFILE REQUIRED                      *
019500200604     F**                                                              *
019600200604     F**       88         MULTI-BRANCH INDICATOR                      *   S01464
019700200604     F**       90         FILE ERROR                                  *
019800200604     F**                                                              *
019900200604     F**       98         DATE FORMAT ON ZDATE2                       *
020000200604     F**       99         INVALID DATE ON ZDATE1                      *
020100200604     F**                                                              *
020200200604     F*****************************************************************
020300200604     F/EJECT
020400200604     E*****************************************************************
020500200604     E*
020600200604     E**   ARRAY FOR COPYRIGHT
020700200604     E*
020800200604     E                    CPY@    1   1 80
020900200604     E*****************************************************************
021000200604     E/EJECT
021100200604     E*****************************************************************
021200200604     E***********                                                         S01464
021300200604     E*****ARRAY*OF*ALPHANUMERICS                                         S01464
021400200604     E***********                                                         S01464
021500200604     E***********         ALPNU  37  37  1                                S01464
021600200604     E***********                                                         S01464
021700200604     E*****ARRAY*OF*NUMBERS                                               S01464
021800200604     E***********                                                         S01464
021900200604     E***********         NUM    10  10  1                                S01464
022000200604     E***********                                                         S01464
022100200604     E*****ARRAY*TO*SPLIT*CUSTOMER*FIELD*INTO*INDIVIDUAL*CHARACTERS       S01464
022200200604     E***********                                                         S01464
022300200604     E***********         CUS        10  1                                S01464
022400200604     E*
022500200604     E*****************************************************************
022600200604     E/EJECT
022700200604     I*****************************************************************
022800200604     I*
022900200604     I**   DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
023000200604     ICPYR@$      DS
023100200604     I                                        1  80 CPY@
023200200604     I                                        1  20 CPY@$$
023300200604     I*****************************************************************
023400200604     I/EJECT
023500200604     I*****************************************************************
023600200604     I*
023700200604     I** PROGRAM STATUS DATA STRUCTURE
023800200604     IPSDS       SDS
023900200604     I                                      244 253 DDWSID
024000200604     I                                      254 263 USER
024100200604     I*
024200200604     I** FILE INFORMATION DATA STRUCTURE - WORKSTN FILE
024300200604     IERF1DS      DS
024400200604     I                                    B 378 3790ER1SRN
024500200604     I*
024600200604     I** FILE INFORMATION DATA STRUCTURE - SECICFPD
024700200604     IERF2DS      DS
024800200604     I                                     *STATUS  STATUS
024900200604     I*                                                                   S01464
025000200604     IRUNDT       DS                             13                       S01464
025100200604     I** Rundate data area                                                S01464
025200200604     I                                       13  13 MBIN                  S01464
025300200604     I*
025400200604     I** LOCAL DATA AREA
025500200604     I*LDA        UDS                            256                      S01464
025600200604     ILDA         DS                            256                       S01464
025700200604     I***                                   132 141 DBFILE                S01464
025800200604     I                                      134 141 DBFILE                S01464
025900200604     I                                      142 170 DBKEY
026000200604     I                                      171 180 DBPGM
026100200604     I                                      181 1830DBASE
026200200604     I*                                                                   S01464
026300200604     I** Data Area of menu user                                           S01464
026400200604     IZMUSER      DS                             17                       S01464
026500200604     I                                       11  13 USRBCH                S01464
026600200604     I*
026700200604     I** DATA STRUCTURE TO UPDATE LAST TRANSACTION NUMBER DTAARA
026800200604     IDNATN       DS                              5
026900200604     I                                        1   50FNATN
027000200604     I*
027100200604     I** DATA STRUCTURE TO PROVIDE TEXT ON COMIT ENTRY IN JOURNAL
027200200604     ICMTTXT      DS                             55
027300200604     I                                        1   50WWNATN
027400200604     I                                        6   7 MDID
027500200604     I                                        8  17 PGMN
027600200604     I                                       18  27 WSIDX
027700200604     I                                       28  330MTIME
027800200604     I                                       34  34 ACTCDX
027900200604     I                                       35  42 USIDX
028000200604     I                                       43  48 DD3CN
028100200604     I                                       49  55 DD3SD
028200200604     I***********                                                         S01464
028300200604     I***DATA*STRUCTURE*TO*SPLIT*CUSTOMER*NUMBER/SHORTNAME                S01464
028400200604     I*********** DS                                                      S01464
028500200604     I***********                             1  10 WWSCNS                S01464
028600200604     I***********                             1  10 CUS                   S01464
028700200604     I***********                             1   1 WWCCH1                S01464
028800200604     I***********                             1   6 WWC16                 S01464
028900200604     I***********                             7  10 WWC710                S01464
029000200604     I*
029100200604     I** DAY, MONTH & YEAR OF LAST UPDATE
029200200604     IWWDATE      DS
029300200604     I                                        1   7 WWDAT
029400200604     I                                        1   20SCDLUP
029500200604     I                                        3   5 SCMLUP
029600200604     I                                        6   70SCYLUP
029700200604     I*                                                                   S01464
029800200604     ISDCURR    E DSSDCURRPD                                              S01464
029900200604     I** Currency Details                                                 S01464
030000200604     ISDCUST    E DSSDCUSTPD                                              S01464
030100200604     I** Customer Details                                                 S01464
030200200604     ISDSTRD    E DSSDSTRDPD                                              S01464
030300200604     I** Securities Trading ICD                                           S01464
030400200604     ISDSECS    E DSSDSECSPD                                              S01464
030500200604     I** Securities Clients file                                          S01464
030600200604     I**                                                                  S01464
030700200604     IDSSDY     E DSDSSDY                                                 S01464
030800200604     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01464
030900200604     I*
031000200604     I*****************************************************************
031100200604     C/EJECT
031200200604     C*****************************************************************
031300200604     C*
031400200604     C**   KEYS USED BY PROGRAM
031500200604     C**   --------------------
031600200604     C*
031700200604     C*****KEY*TO*ACCESS*SCCICFPD                                         S01464
031800200604     C**   KEY TO ACCESS SECICFPD                                         S01464
031900200604     C*
032000200604     C           WWCFPD    KLIST
032100200604     C                     KFLD           WWCFGD
032200200604     C                     KFLD           WWCNUD
032300200604     C                     KFLD           WWCKSD
032400200604     C                     KFLD           WWSESD
032500200604     C                     KFLD           WWCCYD
032600200604     C                     KFLD           WWSITD
032700200604     C*
032800200604     C*****KEY*TO*ACCESS*SCCICFXX                                         S01464
032900200604     C**   KEY TO ACCESS SCCICFXX                                         S01464
033000200604     C*
033100200604     C           WWCFXX    KLIST
033200200604     C                     KFLD           WWCFGX
033300200604     C                     KFLD           WWCNUX
033400200604     C                     KFLD           WWCKSX
033500200604     C                     KFLD           WWSESX
033600200604     C                     KFLD           WWCCYX
033700200604     C                     KFLD           WWSITX
033800200604     C*
033900200604     C*****KEY*TO*ACCESS*SCCICFL1                                         S01464
034000200604     C**   KEY TO ACCESS SECICFL1                                         S01464
034100200604     C*
034200200604     C           WWCFL1    KLIST
034300200604     C                     KFLD           WWCKS1
034400200604     C                     KFLD           WWSES1
034500200604     C                     KFLD           WWCCY1
034600200604     C                     KFLD           WWSIT1
034700200604     C                     KFLD           WWCFG1
034800200604     C                     KFLD           WWCNU1
034900200604     C*
035000200604     C**   KEY TO ACCESS INVTPC
035100200604     C*
035200200604     C           WWNVTP    KLIST
035300200604     C                     KFLD           WWINVT
035400200604     C                     KFLD           WWCCYI
035500200604     C*
035600200604     C*****************************************************************
035700200604     C*
035800200604     C**   INITIAL PROCESSING
035900200604     C**   ------------------
036000200604     C*
036100200604     C                     EXSR #A
036200200604     C*
036300200604     C**   MAIN PROCESSING
036400200604     C**   ---------------
036500200604     C*
036600200604     C**   DO WHILE NOT CMD-3
036700200604     C*
036800200604     C           *INKC     DOWEQ'0'
036900200604     C*
037000200604     C           WWSCID    CASEQ'CHANGE'  #B
037100200604     C           WWSCID    CASEQ'INPUT '  #C
037200200604     C                     END
037300200604     C*
037400200604     C                     END
037500200604     C*
037600200604     C**   END PROGRAM
037700200604     C**   -----------
037800200604     C*
037900200604     C                     MOVE '1'       *INLR
038000200604     C                     RETRN
038100200604     C*
038200200604     C*****************************************************************
038300200604     C/EJECT
038400200604     C*****************************************************************
038500200604     C**                                                              *
038600200604     C**     INDEX TO SUBROUTINES                                     *
038700200604     C**    ----------------------                                    *
038800200604     C**                                                              *
038900200604     C**   #A       - INITIAL PROCESSING                              *
039000200604     C**   #B       - CHANGE SCREEN PROCESSING                        *
039100200604     C**   #BA      - VALIDATE CHANGE SCREEN                          *
039200200604     C**   #BB      - PROCESS AMEND/DELETE                            *
039300200604     C**   #BC      - DETERMINE NEXT SCREEN                           *
039400200604     C**   #BCA     - LOAD PAGE OF CHANGE SCREEN SUBFILE (SECICFL1)   *
039500200604     C**   #C       - INPUT SCREEN PROCESSING                         *
039600200604     C**   #CA      - VALIDATE INPUT SCREEN                           *
039700200604     C**   #CB      - PROCESS INSERT                                  *
039800200604     C**   #CC      - LOAD PAGE OF INPUT SCREEN SUBFILE               *
039900200604     C**                                                              *
040000200604     C**   #ZA      - LOAD PAGE OF CHANGE SCREEN SUBFILE (SECICFXX)   *
040100200604     C**   #ZB      - UPDATE TRAILER FILE (SECICFPA)                  *
040200200604     C**                                                              *
040300200604     C**   ZTNLU1   - RETRIEVE/UPDATE TRANS. NO. LAST UPDATE          *
040400200604     C**   ZASNMS   - SEND MESSAGE TO PROGRAMS MESSAGE QUEUE          *
040500200604     C**   *PSSR    - ERROR HANDLING                                  *
040600200604     C**                                                              *
040700200604     C**                                                              *
040800200604     C*****************************************************************
040900200604     C/EJECT
041000200604     C*****************************************************************
041100200604     C**                                                              *
041200200604     C**   #A          - THIS SUBROUTINE PERFORMS INITIAL PROCESSING  *
041300200604     C**                                                              *
041400200604     C**   CALLS       - NONE                                         *
041500200604     C**                                                              *
041600200604     C**   CALLED BY   - MAINLINE                                     *
041700200604     C**                                                              *
041800200604     C*****************************************************************
041900200604     C*
042000200604     C           #A        BEGSR
042100200604     C*                                                                   S01464
042200200604     C**   LDA DEFINITION.                                                S01464
042300200604     C*                                                                   S01464
042400200604     C           *NAMVAR   DEFN           LDA                             S01464
042500200604     C*
042600200604     C**   INITIALISE DB ERROR FIELDS AND STORE PROGRAM NAME FOR
042700200604     C**   DB ERROR FIELD.
042800200604     C*
042900200604     C                     MOVE *BLANKS   DBFILE
043000200604     C                     MOVE *BLANKS   DBKEY
043100200604     C                     Z-ADD*ZEROS    DBASE
043200200604     C                     MOVEL'SE6030'  DBPGM
043300200604     C                     MOVE *BLANKS   ZAMSGF
043400200604     C                     MOVEL'SEUSRMSG'ZAMSGF
043500200604     C*
043600200604     C**   SET INITIAL SCREEN-ID TO 'CHANGE'
043700200604     C*
043800200604     C                     MOVE 'CHANGE'  WWSCID  6
043900200604     C*
044000200604     C**   DEFINE WORK FIELDS
044100200604     C*
044200200604     C           *LIKE     DEFN SCCFGC    WWCFGD
044300200604     C           *LIKE     DEFN SCCNUM    WWCNUD
044400200604     C           *LIKE     DEFN SCCKSQ    WWCKSD
044500200604     C           *LIKE     DEFN SCSESN    WWSESD
044600200604     C           *LIKE     DEFN SCCCY     WWCCYD
044700200604     C           *LIKE     DEFN SCSITP    WWSITD
044800200604     C*
044900200604     C           *LIKE     DEFN SCCFGC    WWCFGX
045000200604     C           *LIKE     DEFN SCCNUM    WWCNUX
045100200604     C           *LIKE     DEFN SCCKSQ    WWCKSX
045200200604     C           *LIKE     DEFN SCSESN    WWSESX
045300200604     C           *LIKE     DEFN SCCCY     WWCCYX
045400200604     C           *LIKE     DEFN SCSITP    WWSITX
045500200604     C*
045600200604     C           *LIKE     DEFN SCCKSQ    WWCKS1
045700200604     C           *LIKE     DEFN SCSESN    WWSES1
045800200604     C           *LIKE     DEFN SCCCY     WWCCY1
045900200604     C           *LIKE     DEFN SCSITP    WWSIT1
046000200604     C           *LIKE     DEFN SCCFGC    WWCFG1
046100200604     C           *LIKE     DEFN SCCNUM    WWCNU1
046200200604     C*
046300200604     C           *LIKE     DEFN CCYI      WWCCYI
046400200604     C           *LIKE     DEFN INVT      WWINVT
046500200604     C*
046600200604     C           *LIKE     DEFN SCNORE    WWNORD
046700200604     C           *LIKE     DEFN SCNORE    WWNORI
046800200604     C*
046900200604     C           *LIKE     DEFN SCCKSQ    WWCKSQ
047000200604     C           *LIKE     DEFN SCTNLU    WWDSTN
047100200604     C*
047200200604     C**   INITIALISE WORK FIELDS
047300200604     C*
047400200604     C                     Z-ADD0         LSTRR2  40
047500200604     C                     MOVE 'Y'       WWVALD  1
047600200604     C                     MOVE 'N'       WWUPDR  1
047700200604     C*
047800200604     C                     Z-ADD*ZEROS    WWSFLC  40
047900200604     C                     Z-ADD*ZEROS    WWSFRN  40
048000200604     C                     Z-ADD*ZEROS    WWFRRN  40
048100200604     C*
048200200604     C                     MOVE *BLANKS   WWCNUM  6
048300200604     C                     MOVE *BLANKS   DDUNDR
048400200604     C*
048500200604     C                     MOVE *BLANKS   WWTPGQ 10
048600200604     C                     MOVEL'*'       WWTPGQ
048700200604     C                     MOVE *BLANKS   WWPGQR  5
048800200604     C                     MOVEL'*PRV'    WWPGQR
048900200604     C*
049000200604     C**   SET OFF ALL INDICATORS
049100200604     C*
049200200604     C                     MOVEA'00000000'*IN,21           OFF 21-28
049300200604     C                     MOVEA'0000'    *IN,29           OFF 29-32
049400200604     C                     MOVEA'00000000'*IN,40           OFF 40-47
049500200604     C                     MOVEA'00000000'*IN,50           OFF 50-57
049600200604     C                     MOVEA'0000000' *IN,58           OFF 58-64
049700200604     C                     MOVEA'0000'    *IN,67           OFF 67-70
049800200604     C                     MOVEA'00'      *IN,98           OFF 98-99
049900200604     C*
050000200604     C**   ACCESS ICD RECORD 1 TO GET RUN DATE & TITLE
050100200604     C*
050200200604     C           1         SETLLSDBANKPD
050300200604     C                     READ SDBANKPD                 22
050400200604     C*
050500200604     C**   IF RECORD NOT FOUND OR LAST-CHANGE-TYPE = 'D' (DELETED)
050600200604     C*
050700200604     C           *IN22     IFEQ '1'
050800200604     C           BJTYLC    OREQ 'D'
050900200604     C           *LOCK     IN   LDA                                       S01464
051000200604     C                     Z-ADD1         DBASE            ***************
051100200604     C                     MOVE *BLANKS   DBFILE           *             *
051200200604     C                     MOVEL'SDBANKPD'DBFILE           * DBERROR 001 *
051300200604     C                     MOVE *BLANKS   DBKEY            *             *
051400200604     C                     MOVE '1'       *INU7            ***************
051500200604     C                     MOVE '1'       *INU8
051600200604     C                     MOVE '1'       *INLR
051700200604     C                     OUT  LDA                                       S01464
051800200604     C                     RETRN
051900200604     C                     END
052000200604     C*
052100200604     C**   SET UP DATE FORMAT INDICATOR
052200200604     C*
052300200604     C           BJDFIN    IFEQ 'M'
052400200604     C                     MOVE '1'       *IN98            ON-98
052500200604     C                     ELSE
052600200604     C                     MOVE '0'       *IN98            0FF-98
052700200604     C                     END
052800200604     C*
052900200604     C**   INITIALISE SCREEN MESSAGE QUEUE
053000200604     C*
053100200604     C                     MOVEL'*'       DDPGMQ
053200200604     C*
053300200604     C**   SET ON SUBFILE END INDICATOR
053400200604     C*
053500200604     C                     MOVE '1'       *IN40
053600200604     C*                                                                   S01464
053700200604     C**   ACCESS SECURITIES TRADING ICD.                                 S01464
053800200604     C*                                                                   S01464
053900200604     C                     CALL 'AOSTRDR0'                                S01464
054000200604     C                     PARM '*DBERR ' @RTCD   7                       S01464
054100200604     C                     PARM '*FIRST ' @OPTN   7                       S01464
054200200604     C           SDSTRD    PARM SDSTRD    DSSDY                           S01464
054300200604     C*                                                                   S01464
054400200604     C**   CHECK IF SAFE CUSTODY FEES IS NOT SET ON                       S01464
054500200604     C*                                                                   S01464
054600200604     C           BVCUIN    IFNE 'Y'                                       S01464
054700200604     C*                                                                   S01464
054800200604     C**   SEND MESSAGE TO SCREEN                                         S01464
054900200604     C*                                                                   S01464
055000200604     C                     MOVEL'SE02100' ZAMSID                          S01464
055100200604     C                     EXSR ZASNMS                                    S01464
055200200604     C                     EXFMTSE6030C3                                  S01464
055300200604     C                     SETON                     LR                   S01464
055400200604     C                     RETRN                                          S01464
055500200604      *                                                                   S01464
055600200604     C                     END                                            S01464
055700200604     C*                                                                   S01464
055800200604     C** In the data area RUNDAT                                          S01464
055900200604     C*                                                                   S01464
056000200604     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01464
056100200604     C                     IN   RUNDT                                     S01464
056200200604     C*                                                                   S01464
056300200604     C**   Read in ZMUSER                                                 S01464
056400200604     C*                                                                   S01464
056500200604     C           *NAMVAR   DEFN           ZMUSER                          S01464
056600200604     C                     IN   ZMUSER                                    S01464
056700200604     C*                                                                   S01464
056800200604     C** Test for multibranching                                          S01464
056900200604     C*                                                                   S01464
057000200604     C           MBIN      IFEQ 'Y'                                       S01464
057100200604     C                     MOVE '1'       *IN88                           S01464
057200200604     C                     ELSE                                           S01464
057300200604     C                     MOVE '0'       *IN88                           S01464
057400200604     C                     END                                            S01464
057500200604     C*
057600200604     C           #A0       ENDSR
057700200604     C*****************************************************************
057800200604     C/EJECT
057900200604     C*****************************************************************
058000200604     C**                                                              *
058100200604     C** #B          - CHANGE SCREEN PROCESSING                       *
058200200604     C**                                                              *
058300200604     C** CALLS       - #BA , #BB , #BC , #ZA                          *
058400200604     C**                                                              *
058500200604     C** CALLED BY   - MAINLINE                                       *
058600200604     C**                                                              *
058700200604     C*****************************************************************
058800200604     C           #B        BEGSR
058900200604     C*                                                                   S01464
059000200604     C**   CHECK BEFORE DISPLAYING IF USER IS AUTHORISED TO ACTION 'A'    S01464
059100200604     C*                                                                   S01464
059200200604     C           *IN88     IFEQ '0'                                       S01464
059300200604     C                     CALL 'ZVACTU'                                  S01464
059400200604     C                     PARM 'A'       @ZACTN  1                       S01464
059500200604     C                     PARM           @ERR    10                      S01464
059600200604     C*                                                                   S01464
059700200604     C**   MULTI-BRANCH ENVIRONMENT                                       S01464
059800200604     C*                                                                   S01464
059900200604     C                     ELSE                                           S01464
060000200604     C*                                                                   S01464
060100200604     C                     CALL 'ZVACTBU'                                 S01464
060200200604     C                     PARM 'A'       @ZACTN  1                       S01464
060300200604     C                     PARM USRBCH    @BRNCH  3                       S01464
060400200604     C                     PARM           @ERR    10                      S01464
060500200604     C                     END                                            S01464
060600200604     C*                                                                   S01464
060700200604     C**   IF ACTION INVALID FOR USER, PROTECT FEE CODE FIELD             S01464
060800200604     C*                                                                   S01464
060900200604     C           @ERR      IFNE *ZERO                                     S01464
061000200604     C                     MOVE 'Y'       @PRTCT  1                       S01464
061100200604     C                     END                                            S01464
061200200604     C*
061300200604     C**   SET UP KEY FIELDS
061400200604     C*
061500200604     C                     MOVE *BLANKS   WWCFGX
061600200604     C                     MOVE *BLANKS   WWCNUX
061700200604     C                     Z-ADD*ZEROS    WWCKSX
061800200604     C                     MOVE *BLANKS   WWSESX
061900200604     C                     MOVE *BLANKS   WWCCYX
062000200604     C                     MOVE *BLANKS   WWSITX
062100200604     C*
062200200604     C*****ACCESS*SCCICFXX                                                S01464
062300200604     C**   ACCESS SECICFXX                                                S01464
062400200604     C*
062500200604     C***********WWCFXX    SETLLSCCICFXX                                  S01464
062600200604     C           WWCFXX    SETLLSECICFXX                                  S01464
062700200604     C***********          READ SCCICFXX                 23               S01464
062800200604     C                     READ SECICFXX                 23               S01464
062900200604     C*
063000200604     C**   LOAD A PAGE OF SUBFILE RECORDS - SECICFXX
063100200604     C*
063200200604     C                     MOVE '1'       *IN70
063300200604     C                     EXSR #ZA
063400200604     C*
063500200604     C**   SET REVIEW FROM FIELDS TO BLANK
063600200604     C*
063700200604     C                     MOVE *BLANKS   DD1RNS
063800200604     C                     MOVE *BLANKS   DD1RFG
063900200604     C                     MOVE *BLANKS   DD1RSE
064000200604     C                     MOVE *BLANKS   DD1RCY
064100200604     C                     MOVE *BLANKS   DD1RIT
064200200604     C*
064300200604     C**   DOWHILE NOT CMD-3 & SCREEN-ID = 'CHANGE'
064400200604     C*
064500200604     C           *INKC     DOWEQ'0'
064600200604     C           WWSCID    ANDEQ'CHANGE'
064700200604     C*
064800200604     C**   WRITE CHANGE SCREEN FOOTING FORMAT
064900200604     C*
065000200604     C                     WRITESE6030F1
065100200604     C*
065200200604     C**   WRITE CHANGE SCREEN CONTROL FORMAT
065300200604     C*
065400200604     C                     WRITESE6030C1
065500200604     C*
065600200604     C**   IF ERRORS EXIST - DISPLAY MESSAGE SUBFILE
065700200604     C*
065800200604     C           WWVALD    IFEQ 'N'
065900200604     C                     WRITESE6030C3
066000200604     C                     END
066100200604     C*
066200200604     C**   READ CHANGE SCREEN CONTROL FORMAT
066300200604     C*
066400200604     C                     READ SE6030C1                 21
066500200604     C*
066600200604     C**   IF NOT CMD-3
066700200604     C*
066800200604     C           *INKC     IFEQ '0'
066900200604     C*
067000200604     C**   ROLLUP
067100200604     C*
067200200604     C           *IN42     IFEQ '1'
067300200604     C*
067400200604     C**   LOAD NEXT PAGE OF SUBFILE RECORDS - CHANGE SCREEN
067500200604     C*
067600200604     C                     MOVE '0'       *IN70
067700200604     C                     EXSR #ZA
067800200604     C*
067900200604     C                     ELSE
068000200604     C*
068100200604     C**   VALIDATE CHANGE SCREEN
068200200604     C*
068300200604     C                     EXSR #BA
068400200604     C*
068500200604     C**   IF VALID & RECORDS AMENDED/DELETED
068600200604     C*
068700200604     C           WWVALD    IFEQ 'Y'
068800200604     C           WWUPDR    ANDEQ'Y'
068900200604     C*
069000200604     C**   PROCESS AMEND/DELETE
069100200604     C*
069200200604     C                     EXSR #BB
069300200604     C*
069400200604     C                     END
069500200604     C*
069600200604     C**   IF VALID SO FAR
069700200604     C*
069800200604     C           WWVALD    IFEQ 'Y'
069900200604     C*
070000200604     C**   DETERMINE NEXT SCREEN
070100200604     C*
070200200604     C                     EXSR #BC
070300200604     C*
070400200604     C                     END
070500200604     C*
070600200604     C                     END
070700200604     C*
070800200604     C                     END
070900200604     C*
071000200604     C                     END
071100200604     C*
071200200604     C           #B0       ENDSR
071300200604     C*****************************************************************
071400200604     C/EJECT
071500200604     C*****************************************************************
071600200604     C**                                                              *
071700200604     C** #BA         - VALIDATE CHANGE SCREEN                         *
071800200604     C**                                                              *
071900200604     C** CALLS       - #BAA , ZASNMS                                  *
072000200604     C**                                                              *
072100200604     C** CALLED BY   - #B                                             *
072200200604     C**                                                              *
072300200604     C*****************************************************************
072400200604     C*
072500200604     C           #BA       BEGSR
072600200604     C*
072700200604     C**   CLEAR SCREEN MESSAGE QUEUE
072800200604     C*
072900200604     C                     CALL 'Y2CLMSC'
073000200604     C                     PARM           WWTPGQ 10
073100200604     C                     PARM           WWPGQR  5
073200200604     C*
073300200604     C**   SET OF ERROR INDICATORS
073400200604     C*
073500200604     C                     MOVE '0'       *IN52
073600200604     C                     MOVE '0'       *IN53
073700200604     C                     MOVE '0'       *IN54
073800200604     C                     MOVE '0'       *IN55
073900200604     C                     MOVE '0'       *IN56
074000200604     C                     MOVEA'00'      *IN,63           OFF 63-64
074100200604     C                     MOVE '0'       *IN71                           S01464
074200200604     C*
074300200604     C**   SET OF UPDATE REQUIRED FLAG
074400200604     C*
074500200604     C                     MOVE 'N'       WWUPDR
074600200604     C*
074700200604     C**   SET ON VALID FLAG
074800200604     C*
074900200604     C                     MOVE 'Y'       WWVALD
075000200604     C*
075100200604     C**   DONT VALIDATE FIELDS IF BLANK SUBFILE DISPLAYED
075200200604     C*
075300200604     C           *IN43     IFEQ '1'
075400200604     C*
075500200604     C**   VALIDATE REVIEW FROM FIELDS
075600200604     C**   ---------------------------
075700200604     C*
075800200604     C**   AT LEAST ONE REVIEW FIELD ENTERED
075900200604     C*
076000200604     C           DD1RNS    IFNE *BLANKS
076100200604     C           DD1RFG    ORNE *BLANKS
076200200604     C           DD1RSE    ORNE *BLANKS
076300200604     C           DD1RCY    ORNE *BLANKS
076400200604     C           DD1RIT    ORNE *BLANKS
076500200604     C*
076600200604     C**   IF CUSTOMER & FEE GROUP ENTERED
076700200604     C*
076800200604     C           DD1RNS    IFNE *BLANKS
076900200604     C           DD1RFG    ANDNE*BLANKS
077000200604     C*
077100200604     C**   IF SECURITY,CURRENCY OR INSTRUMENT ENTERED - ERROR
077200200604     C*
077300200604     C           DD1RSE    IFNE *BLANKS
077400200604     C           DD1RCY    ORNE *BLANKS
077500200604     C           DD1RIT    ORNE *BLANKS
077600200604     C*
077700200604     C                     MOVE '1'       *IN52
077800200604     C                     MOVE '1'       *IN53
077900200604     C                     MOVE 'N'       WWVALD
078000200604     C                     MOVEL'SE03001' ZAMSID
078100200604     C                     EXSR ZASNMS
078200200604     C*
078300200604     C                     END
078400200604     C*
078500200604     C                     END
078600200604     C*
078700200604     C**   IF CUSTOMER ENTERED
078800200604     C*
078900200604     C           DD1RNS    IFNE *BLANKS
079000200604     C*
079100200604     C**   VALIDATE CUSTOMER NUMBER/SHORTNAME
079200200604     C*
079300200604     C                     EXSR #BAA
079400200604     C*
079500200604     C                     END
079600200604     C*
079700200604     C**   IF ? ENTERED ON CURRENCY FIELD                                 S01464
079800200604     C*                                                                   S01464
079900200604     C           DD1RCY    IFEQ '?'                                       S01464
080000200604     C                     CALL 'AOCURRR0'                                S01464
080100200604     C                     PARM '*BLANKS' @RTCD   7                       S01464
080200200604     C                     PARM '*KEY   ' @OPTN   7                       S01464
080300200604     C                     PARM DD1RCY    @AJCD   3                       S01464
080400200604     C           SDCURR    PARM SDCURR    DSSDY                           S01464
080500200604     C           @RTCD     IFNE *BLANKS                                   S01464
080600200604     C           @RTCD     ANDNE'*NOSEL '                                 S01464
080700200604     C*                                                                   S01464
080800200604     C                     MOVE '1'       *IN55                           S01464
080900200604     C                     MOVE 'N'       WWVALD                          S01464
081000200604     C                     MOVEL'SE03004' ZAMSID                          S01464
081100200604     C                     EXSR ZASNMS                                    S01464
081200200604     C*                                                                   S01464
081300200604     C                     ELSE                                           S01464
081400200604     C                     MOVE A6CYCD    DD1RCY                          S01464
081500200604     C           @RTCD     IFEQ '*NOSEL '                                 S01464
081600200604     C                     MOVE *BLANKS   DD1RCY                          S01464
081700200604     C                     END                                            S01464
081800200604     C                     END                                            S01464
081900200604     C                     END                                            S01464
082000200604     C*
082100200604     C**   IF SECURITY ENTERED
082200200604     C*
082300200604     C           DD1RSE    IFNE *BLANKS
082400200604     C*
082500200604     C**   IF INVESTMENT TYPE ENTERED - ERROR
082600200604     C*
082700200604     C           DD1RIT    IFNE *BLANKS
082800200604     C*
082900200604     C                     MOVE '1'       *IN54
083000200604     C                     MOVE '1'       *IN56
083100200604     C                     MOVE 'N'       WWVALD
083200200604     C                     MOVEL'SE03003' ZAMSID
083300200604     C                     EXSR ZASNMS
083400200604     C*
083500200604     C                     END
083600200604     C*
083700200604     C**   IF CURRENCY ENTERED - ERROR
083800200604     C*
083900200604     C           DD1RCY    IFNE *BLANKS
084000200604     C*
084100200604     C                     MOVE '1'       *IN54
084200200604     C                     MOVE '1'       *IN55
084300200604     C                     MOVE 'N'       WWVALD
084400200604     C                     MOVEL'SE03004' ZAMSID
084500200604     C                     EXSR ZASNMS
084600200604     C*
084700200604     C                     END
084800200604     C*
084900200604     C                     END
085000200604     C*
085100200604     C**   SET UP CHECKING SEQUENCE
085200200604     C*
085300200604     C                     Z-ADD*ZEROS    WWCKSQ
085400200604     C*
085500200604     C           DD1RSE    IFNE *BLANKS
085600200604     C*
085700200604     C                     Z-ADD1         WWCKSQ
085800200604     C*
085900200604     C                     ELSE
086000200604     C*
086100200604     C           DD1RCY    IFNE *BLANKS
086200200604     C           DD1RIT    ANDNE*BLANKS
086300200604     C*
086400200604     C                     Z-ADD2         WWCKSQ
086500200604     C*
086600200604     C                     ELSE
086700200604     C*
086800200604     C           DD1RIT    IFNE *BLANKS
086900200604     C*
087000200604     C                     Z-ADD3         WWCKSQ
087100200604     C*
087200200604     C                     ELSE
087300200604     C*
087400200604     C           DD1RCY    IFNE *BLANKS
087500200604     C*
087600200604     C                     Z-ADD4         WWCKSQ
087700200604     C*
087800200604     C                     END
087900200604     C*
088000200604     C                     END
088100200604     C*
088200200604     C                     END
088300200604     C*
088400200604     C                     END
088500200604     C*
088600200604     C                     END
088700200604     C*
088800200604     C**   VALIDATE SUBFILE RECORDS
088900200604     C**   ------------------------
089000200604     C*
089100200604     C**   READ FIRST CHANGED RECORD
089200200604     C*
089300200604     C                     READCSE6030S1                 21
089400200604     C*
089500200604     C**   SET ON SFLNXTCHG INDICATOR (ALSO PROCESSED FOR FILE UPDATE)
089600200604     C*
089700200604     C                     MOVE '1'       *IN47
089800200604     C*
089900200604     C**   DOWHILE CHANGED RECORDS EXIST
090000200604     C*
090100200604     C           *IN21     DOWEQ'0'
090200200604     C*
090300200604     C**   SET OF ERROR INDICATORS
090400200604     C*
090500200604     C                     MOVE '0'       *IN50
090600200604     C                     MOVE '0'       *IN51
090700200604     C*
090800200604     C**   IF ACTION IS NON-BLANK OR FEE CODE HAS CHANGED
090900200604     C*
091000200604     C           DD1ACT    IFNE *BLANKS
091100200604     C           DD1FEC    ORNE HH1FEC
091200200604     C*
091300200604     C**   SET ON UPDATE REQUIRED FLAG
091400200604     C*
091500200604     C                     MOVE 'Y'       WWUPDR
091600200604     C*
091700200604     C**   ACTION - IF ENTERED MUST BE = 'D'
091800200604     C*
091900200604     C           DD1ACT    IFNE *BLANKS
092000200604     C           DD1ACT    ANDNE'D'
092100200604     C*
092200200604     C                     MOVE '1'       *IN50
092300200604     C                     MOVE '1'       *IN63                           S01464
092400200604     C                     MOVE 'N'       WWVALD
092500200604     C                     MOVEL'SE03005' ZAMSID
092600200604     C                     EXSR ZASNMS
092700200604     C*
092800200604     C                     END
092900200604     C*                                                                   S01464
093000200604     C** DO SPF VALIDATION FOR BRANCH/ACTION CODE AUTHORITY               S01464
093100200604     C*                                                                   S01464
093200200604     C           DD1ACT    IFEQ 'D'                                       S01464
093300200604     C           *IN88     IFNE '1'                                       S01464
093400200604     C                     CALL 'ZVACTU'                                  S01464
093500200604     C                     PARM DD1ACT    @ZACTN  1                       S01464
093600200604     C                     PARM           @ERR    10                      S01464
093700200604     C*                                                                   S01464
093800200604     C** If action invalid for user (single entity)                       S01464
093900200604     C*                                                                   S01464
094000200604     C           @ERR      IFEQ 1                                         S01464
094100200604     C                     MOVE '1'       *IN50                           S01464
094200200604     C                     MOVEL'N'       WWVALD                          S01464
094300200604     C                     MOVEL'SEM1019' ZAMSID                          S01464
094400200604     C                     EXSR ZASNMS                                    S01464
094500200604     C                     END                                            S01464
094600200604     C*                                                                   S01464
094700200604     C                     ELSE                                           S01464
094800200604     C                     CALL 'ZVACTBU'                                 S01464
094900200604     C                     PARM DD1ACT    @ZACTN  1                       S01464
095000200604     C                     PARM USRBCH    @BRNCH  3                       S01464
095100200604     C                     PARM           @ERR    10                      S01464
095200200604     C*                                                                   S01464
095300200604     C** If action invalid for user (multientity)                         S01464
095400200604     C*                                                                   S01464
095500200604     C           @ERR      IFEQ 1                                         S01464
095600200604     C                     MOVE '1'       *IN50                           S01464
095700200604     C                     MOVEL'N'       WWVALD                          S01464
095800200604     C                     MOVEL'SEM1020' ZAMSID                          S01464
095900200604     C                     EXSR ZASNMS                                    S01464
096000200604     C                     END                                            S01464
096100200604     C*                                                                   S01464
096200200604     C           @ERR      IFEQ 2                                         S01464
096300200604     C                     MOVE '1'       *IN50                           S01464
096400200604     C                     MOVEL'N'       WWVALD                          S01464
096500200604     C                     MOVEL'SEM1021' ZAMSID                          S01464
096600200604     C                     EXSR ZASNMS                                    S01464
096700200604     C                     END                                            S01464
096800200604     C                     END                                            S01464
096900200604     C                     END                                            S01464
097000200604     C*
097100200604     C**   IF FEE CODE HAS CHANGED
097200200604     C*
097300200604     C           DD1FEC    IFNE HH1FEC
097400200604     C*
097500200604     C*****FEE*CODE*MUST*EXIST*ON*SCCGCDPD                                S01464
097600200604     C**   FEE CODE MUST EXIST ON SECGCDPD                                S01464
097700200604     C*
097800200604     C***********DD1FEC    CHAINSCCGCDPD             25                   S01464
097900200604     C           DD1FEC    CHAINSECGCDPD             25                   S01464
098000200604     C*
098100200604     C           *IN25     IFEQ '1'
098200200604     C           SFRECI    OREQ '*'
098300200604     C*
098400200604     C                     MOVE '1'       *IN51
098500200604     C                     MOVE 'N'       WWVALD
098600200604     C                     MOVEL'SE03006' ZAMSID
098700200604     C                     EXSR ZASNMS
098800200604     C*
098900200604     C                     END
099000200604     C*
099100200604     C                     END
099200200604     C*
099300200604     C**   STORE RRN OF FIRST RECORD IN ERROR
099400200604     C*
099500200604     C           WWVALD    IFEQ 'N'
099600200604     C           *IN64     ANDEQ'0'
099700200604     C                     Z-ADDDD1RRN    WWFRRN
099800200604     C                     MOVE '1'       *IN64
099900200604     C                     END
100000200604     C*
100100200604     C                     END
100200200604     C*
100300200604     C**   UPDATE SUBFILE
100400200604     C*
100500200604     C                     UPDATSE6030S1
100600200604     C*
100700200604     C**   READ NEXT CHANGED RECORD
100800200604     C*
100900200604     C                     READCSE6030S1                 21
101000200604     C*
101100200604     C                     END
101200200604     C*
101300200604     C**   IF ERROR ON SUBFILE - RELOAD RRN OF FIRST RECORD IN ERROR
101400200604     C*
101500200604     C           *IN64     IFEQ '1'
101600200604     C                     Z-ADDWWFRRN    DD1RRN
101700200604     C                     END
101800200604     C*
101900200604     C                     END
102000200604     C*
102100200604     C           #BA0      ENDSR
102200200604     C*****************************************************************
102300200604     C/EJECT
102400200604     C*****************************************************************
102500200604     C**                                                              *
102600200604     C**   #BAA        - VALIDATE CUSTOMER NUMBER/SHORTNAME           *
102700200604     C**                                                              *
102800200604     C**   CALLS       - ZASNMS                                       *
102900200604     C**                                                              *
103000200604     C**   CALLED BY   - #BA                                          *
103100200604     C**                                                              *
103200200604     C*****************************************************************
103300200604     C*
103400200604     C           #BAA      BEGSR
103500200604     C***********                                                         S01464
103600200604     C*****SPLIT*CUSTOMER*FIELD                                           S01464
103700200604     C***********                                                         S01464
103800200604     C***********          MOVE DD1RNS    WWSCNS                          S01464
103900200604     C*
104000200604     C**   SET OFF VALID CUST NUMBER/SHORTNAME INDICATOR
104100200604     C*
104200200604     C                     MOVE '0'       *IN67
104300200604     C***********                                                         S01464
104400200604     C*****FIRST*CHARACTER*MUST*BE*ALPHANUMERIC*OR*BLANK                  S01464
104500200604     C***********                                                         S01464
104600200604     C***********WWCCH1    LOKUPALPNU                    68               S01464
104700200604     C***********                                                         S01464
104800200604     C*****IF*NOT*VALID*IE*CHARACTER*NOT*FOUND*IN*ARRAY                   S01464
104900200604     C***********                                                         S01464
105000200604     C************IN68     IFEQ '0'                                       S01464
105100200604     C***********          MOVE '1'       *IN67                           S01464
105200200604     C***********          ELSE                                           S01464
105300200604     C***********                                                         S01464
105400200604     C*****CHECK*IF*THE*FIRST*CHARACTER*IS*NUMERIC                        S01464
105500200604     C***********                                                         S01464
105600200604     C***********WWCCH1    LOKUPNUM                      69               S01464
105700200604     C***********                                                         S01464
105800200604     C*****IF*NOT*FOUND*IN*ARRAY*IE*SHORTNAME*ENTERED                     S01464
105900200604     C***********                                                         S01464
106000200604     C************IN69     IFEQ '0'                                       S01464
106100200604     C*
106200200604     C*****ACCESS*CLIENT*MASTER*FILE*TO*CHECK*IF*SHORTNAME*EXISTS         S01464
106300200604     C**   ACCESS AOCUSTR0 TO CHECK IF CUST NUMBER/SHORTNAME EXISTS       S01464
106400200604     C*
106500200604     C***********WWSCNS    SETLLSDCUSTL6                                  S01464
106600200604     C***********WWSCNS    READESDCUSTL6                 26               S01464
106700200604     C                     CALL 'AOCUSTR0'                                S01464
106800200604     C                     PARM *BLANKS   @RTCD   7                       S01464
106900200604     C                     PARM '*KEY   ' @OPTN   7                       S01464
107000200604     C                     PARM DD1RNS    @KEY1  10                       S01464
107100200604     C                     PARM *BLANKS   @KYST   7                       S01464
107200200604     C           SDCUST    PARM SDCUST    DSSDY                           S01464
107300200604     C*
107400200604     C************IN26     IFEQ '1'                                       S01464
107500200604     C           @RTCD     IFNE *BLANKS                                   S01464
107600200604     C           @RTCD     ANDNE'*NOSEL '                                 S01464
107700200604     C           @KYST     OREQ 'ERROR  '                                 S01464
107800200604     C                     MOVE '1'       *IN67
107900200604     C                     ELSE
108000200604     C                     MOVE BBCUST    WWCNUM
108100200604     C           @RTCD     IFEQ '*NOSEL '                                 S01464
108200200604     C                     MOVE *BLANKS   WWCNUM                          S01464
108300200604     C                     END                                            S01464
108400200604     C                     END
108500200604     C***********                                                         S01464
108600200604     C*****ELSE*CUSTOMER*NUMBER*ENTERED                                   S01464
108700200604     C***********                                                         S01464
108800200604     C***********          ELSE                                           S01464
108900200604     C***********                                                         S01464
109000200604     C*****CHECK*NEXT*5*CHARACTERS*ARE*NUMERIC                            S01464
109100200604     C***********                                                         S01464
109200200604     C***********          MOVE '1'       *IN69                           S01464
109300200604     C***********          Z-ADD1         WWFLD1  20                      S01464
109400200604     C***********WWFLD1    DOWLT6                                         S01464
109500200604     C************IN69     ANDEQ'1'                                       S01464
109600200604     C***********          ADD  1         WWFLD1                          S01464
109700200604     C***********CUS,WWFLD1LOKUPNUM                      69               S01464
109800200604     C***********          END                                            S01464
109900200604     C***********                                                         S01464
110000200604     C************IN69     IFEQ '0'                                       S01464
110100200604     C***********          MOVE '1'       *IN67                           S01464
110200200604     C***********          ELSE                                           S01464
110300200604     C***********                                                         S01464
110400200604     C*****LAST*4*CHARACTERS*MUST*BE*BLANK                                S01464
110500200604     C***********                                                         S01464
110600200604     C***********WWC710    IFNE *BLANKS                                   S01464
110700200604     C***********          MOVE '1'       *IN67                           S01464
110800200604     C***********          ELSE                                           S01464
110900200604     C***********                                                         S01464
111000200604     C*****SET*UP*CUSTOMER*NUMBER                                         S01464
111100200604     C***********                                                         S01464
111200200604     C***********          MOVE WWC16     WWCNUM                          S01464
111300200604     C***********                                                         S01464
111400200604     C***********          END                                            S01464
111500200604     C***********                                                         S01464
111600200604     C***********          END                                            S01464
111700200604     C***********                                                         S01464
111800200604     C***********          END                                            S01464
111900200604     C***********                                                         S01464
112000200604     C***********          END                                            S01464
112100200604     C*
112200200604     C           *IN67     IFEQ '1'
112300200604     C*
112400200604     C                     MOVE 'N'       WWVALD
112500200604     C                     MOVE '1'       *IN52
112600200604     C                     MOVEL'SE03002' ZAMSID
112700200604     C                     EXSR ZASNMS
112800200604     C*
112900200604     C                     END
113000200604     C*
113100200604     C           #BAA0     ENDSR
113200200604     C*****************************************************************
113300200604     C/EJECT
113400200604     C*****************************************************************
113500200604     C**                                                              *
113600200604     C**   #BB         - PROCESS AMEND/DELETE                         *
113700200604     C**                                                              *
113800200604     C**   CALLS       - #ZB , ZTNLU1 , ZASNMS                        *
113900200604     C**                                                              *
114000200604     C**   CALLED BY   - #B                                           *
114100200604     C**                                                              *
114200200604     C*****************************************************************
114300200604     C*
114400200604     C           #BB       BEGSR
114500200604     C*
114600200604     C**   READ FIRST CHANGED RECORD
114700200604     C*
114800200604     C                     READCSE6030S1                 21
114900200604     C*
115000200604     C**   INITIALISE NO OF RECORDS DELETED COUNT
115100200604     C*
115200200604     C                     Z-ADD*ZEROS    WWNORD
115300200604     C*
115400200604     C**   DOWHILE CHANGED RECORDS EXIST
115500200604     C*
115600200604     C           *IN21     DOWEQ'0'
115700200604     C*
115800200604     C**   IF RECORD HAS NOT BEEN CHANGED - IGNORE
115900200604     C*
116000200604     C           DD1ACT    IFNE *BLANKS
116100200604     C           DD1FEC    ORNE HH1FEC
116200200604     C*
116300200604     C**   GET TRANSACTION NO. OF LAST UPDATE
116400200604     C*
116500200604     C                     EXSR ZTNLU1
116600200604     C*
116700200604     C*****ACCESS*SCCICFPD                                                S01464
116800200604     C**   ACCESS SECICFPD                                                S01464
116900200604     C*
117000200604     C                     MOVE DD1CFG    WWCFGD
117100200604     C                     MOVE DD1CUS    WWCNUD
117200200604     C                     Z-ADDHH1CKS    WWCKSD
117300200604     C                     MOVE DD1SEC    WWSESD
117400200604     C                     MOVE DD1CCY    WWCCYD
117500200604     C                     MOVE DD1INT    WWSITD
117600200604     C*
117700200604     C***********WWCFPD    CHAINSCCICFPD             33                   S01464
117800200604     C           WWCFPD    CHAINSECICFPD             33                   S01464
117900200604     C*
118000200604     C**   SET UP DAY,MONTH,YEAR OF LAST UPDATE
118100200604     C*
118200200604     C                     MOVE BJMRDT    WWDAT
118300200604     C*
118400200604     C**   IF A RECORD NOT FOUND OR TNLU HAS CHANGED
118500200604     C*
118600200604     C           *IN33     IFEQ '1'
118700200604     C           SCTNLU    ORNE HH1NLU
118800200604     C*
118900200604     C**   HIGHLIGHT INPUT CAPABLE FIELDS & SETON SFLNXTCHG INDICATOR
119000200604     C*
119100200604     C                     MOVE '1'       *IN50
119200200604     C                     MOVE '1'       *IN51
119300200604     C                     MOVE '1'       *IN47
119400200604     C*
119500200604     C**   LOAD ERROR MESSAGE
119600200604     C*
119700200604     C                     MOVE 'N'       WWVALD
119800200604     C                     MOVEL'SE03007' ZAMSID
119900200604     C                     EXSR ZASNMS
120000200604     C*
120100200604     C**   IF RECORD FOUND
120200200604     C*
120300200604     C           *IN33     IFEQ '0'
120400200604     C*
120500200604     C**   SET UP SUBFILE WITH VALUES FROM FILE
120600200604     C*
120700200604     C                     MOVELSCCNUM    DD1CUS
120800200604     C                     MOVELSCCFGC    DD1CFG
120900200604     C                     MOVELSCSESN    DD1SEC
121000200604     C                     MOVELSCCCY     DD1CCY
121100200604     C                     MOVELSCSITP    DD1INT
121200200604     C                     MOVELSCCGCO    DD1FEC
121300200604     C                     MOVELSCCGCO    HH1FEC
121400200604     C                     Z-ADDSCCKSQ    HH1CKS
121500200604     C                     Z-ADDSCTNLU    HH1NLU
121600200604     C*
121700200604     C**   RELEASE RECORD
121800200604     C*
121900200604     C                     EXCPTSCCICF
122000200604     C*
122100200604     C                     END
122200200604     C*
122300200604     C**   UPDATE SUBFILE
122400200604     C*
122500200604     C                     UPDATSE6030S1
122600200604     C*
122700200604     C**   ELSE - UPDATE RECORD
122800200604     C*
122900200604     C                     ELSE
123000200604     C*
123100200604     C**   IF ACTION = BLANKS - AMENDMENT REQUIRED
123200200604     C*
123300200604     C           DD1ACT    IFEQ *BLANKS
123400200604     C*
123500200604     C                     MOVELDD1CUS    SCCNUM
123600200604     C                     MOVELDD1CFG    SCCFGC
123700200604     C                     MOVELDD1SEC    SCSESN
123800200604     C                     MOVELDD1CCY    SCCCY
123900200604     C                     MOVELDD1INT    SCSITP
124000200604     C                     MOVELDD1FEC    SCCGCO
124100200604     C                     Z-ADDHH1CKS    SCCKSQ
124200200604     C                     Z-ADDWWDSTN    SCTNLU
124300200604     C*
124400200604     C           SCLCD     IFNE BJRDNB
124500200604     C                     MOVE 'A'       SCCHTP
124600200604     C                     END
124700200604     C*
124800200604     C                     Z-ADDBJRDNB    SCLCD
124900200604     C                     TIME           SCTLUP
125000200604     C*
125100200604     C***********          UPDATSCCICFP0                                  S01464
125200200604     C                     UPDATSECICFP0                                  S01464
125300200604     C*
125400200604     C**   ELSE - DELETE RECORD
125500200604     C*
125600200604     C                     ELSE
125700200604     C*
125800200604     C                     MOVE '*'       SCRECI
125900200604     C*
126000200604     C                     Z-ADDWWDSTN    SCTNLU
126100200604     C                     MOVE 'D'       SCCHTP
126200200604     C                     Z-ADDBJRDNB    SCLCD
126300200604     C                     TIME           SCTLUP
126400200604     C*
126500200604     C***********          UPDATSCCICFP0                                  S01464
126600200604     C                     UPDATSECICFP0                                  S01464
126700200604     C*
126800200604     C                     ADD  1         WWNORD
126900200604     C*
127000200604     C                     END
127100200604     C*
127200200604     C                     END
127300200604     C*
127400200604     C                     END
127500200604     C*
127600200604     C**   READ NEXT CHANGED RECORD
127700200604     C*
127800200604     C                     READCSE6030S1                 21
127900200604     C*
128000200604     C                     END
128100200604     C*
128200200604     C**   IF NO ERROR
128300200604     C*
128400200604     C           WWVALD    IFEQ 'Y'
128500200604     C*
128600200604     C**   IF NO OF RECORDS DELETED > 0
128700200604     C*
128800200604     C           WWNORD    IFGT 0
128900200604     C*
129000200604     C**   UPDATE TRAILER FILE
129100200604     C*
129200200604     C                     EXSR #ZB
129300200604     C*
129400200604     C                     END
129500200604     C*
129600200604     C**   COMIT UPDATES
129700200604     C*
129800200604     C           CMTTXT    COMIT
129900200604     C*
130000200604     C                     END
130100200604     C*
130200200604     C           #BB0      ENDSR
130300200604     C*****************************************************************
130400200604     C/EJECT
130500200604     C*****************************************************************
130600200604     C**                                                              *
130700200604     C**   #BC         - DETERMINE NEXT SCREEN                        *
130800200604     C**                                                              *
130900200604     C**   CALLS       - #BCA , #ZA                                   *
131000200604     C**                                                              *
131100200604     C**   CALLED BY   - #B                                           *
131200200604     C**                                                              *
131300200604     C*****************************************************************
131400200604     C*
131500200604     C           #BC       BEGSR
131600200604     C*
131700200604     C**   IF CMD-9 PRESSED - DISPLAY INPUT SCREEN
131800200604     C*
131900200604     C           *INKI     IFEQ '1'
132000200604     C*
132100200604     C                     MOVE 'INPUT '  WWSCID
132200200604     C*                                                                   S01464
132300200604     C** DO SPF VALIDATION FOR BRANCH/ACTION CODE AUTHORITY               S01464
132400200604     C*                                                                   S01464
132500200604     C           *IN88     IFNE '1'                                       S01464
132600200604     C                     CALL 'ZVACTU'                                  S01464
132700200604     C                     PARM 'I'       @ZACTN  1                       S01464
132800200604     C                     PARM           @ERR    10                      S01464
132900200604     C*                                                                   S01464
133000200604     C** If action invalid for user (single entity)                       S01464
133100200604     C*                                                                   S01464
133200200604     C           @ERR      IFEQ 1                                         S01464
133300200604     C                     MOVEL'N'       WWVALD                          S01464
133400200604     C                     MOVEL'CHANGE'  WWSCID                          S01464
133500200604     C                     MOVEL'SEM1019' ZAMSID                          S01464
133600200604     C                     EXSR ZASNMS                                    S01464
133700200604     C                     END                                            S01464
133800200604     C*                                                                   S01464
133900200604     C                     ELSE                                           S01464
134000200604     C                     CALL 'ZVACTBU'                                 S01464
134100200604     C                     PARM 'I'       @ZACTN  1                       S01464
134200200604     C                     PARM USRBCH    @BRNCH  3                       S01464
134300200604     C                     PARM           @ERR    10                      S01464
134400200604     C*                                                                   S01464
134500200604     C** If action invalid for user (multientity)                         S01464
134600200604     C*                                                                   S01464
134700200604     C           @ERR      IFEQ 1                                         S01464
134800200604     C                     MOVEL'N'       WWVALD                          S01464
134900200604     C                     MOVEL'CHANGE'  WWSCID                          S01464
135000200604     C                     MOVEL'SEM1020' ZAMSID                          S01464
135100200604     C                     EXSR ZASNMS                                    S01464
135200200604     C                     END                                            S01464
135300200604     C*                                                                   S01464
135400200604     C           @ERR      IFEQ 2                                         S01464
135500200604     C                     MOVEL'N'       WWVALD                          S01464
135600200604     C                     MOVEL'CHANGE'  WWSCID                          S01464
135700200604     C                     MOVEL'SEM1021' ZAMSID                          S01464
135800200604     C                     EXSR ZASNMS                                    S01464
135900200604     C                     END                                            S01464
136000200604     C                     END                                            S01464
136100200604     C*
136200200604     C**   ELSE ENTER PRESSED
136300200604     C*
136400200604     C                     ELSE
136500200604     C*
136600200604     C                     MOVE 'CHANGE'  WWSCID
136700200604     C*
136800200604     C**   IF ALL REVIEW FROM FIELDS ARE BLANK
136900200604     C*
137000200604     C           DD1RNS    IFEQ *BLANKS
137100200604     C           DD1RFG    ANDEQ*BLANKS
137200200604     C           DD1RSE    ANDEQ*BLANKS
137300200604     C           DD1RCY    ANDEQ*BLANKS
137400200604     C           DD1RIT    ANDEQ*BLANKS
137500200604     C*
137600200604     C**   IF ANY RECORDS HAVE BEEN DELETED
137700200604     C*
137800200604     C           WWUPDR    IFEQ 'Y'
137900200604     C*
138000200604     C**   SET UP KEY FIELDS
138100200604     C*
138200200604     C                     MOVE *BLANKS   WWCFGX
138300200604     C                     MOVE *BLANKS   WWCNUX
138400200604     C                     Z-ADD*ZEROS    WWCKSX
138500200604     C                     MOVE *BLANKS   WWSESX
138600200604     C                     MOVE *BLANKS   WWCCYX
138700200604     C                     MOVE *BLANKS   WWSITX
138800200604     C*
138900200604     C*****ACCESS*SCCICFXX                                                S01464
139000200604     C**   ACCESS SECICFXX                                                S01464
139100200604     C*
139200200604     C***********WWCFXX    SETLLSCCICFXX                                  S01464
139300200604     C           WWCFXX    SETLLSECICFXX                                  S01464
139400200604     C***********          READ SCCICFXX                 23               S01464
139500200604     C                     READ SECICFXX                 23               S01464
139600200604     C*
139700200604     C**   REBUILD SUBFILE - SECICFXX
139800200604     C*
139900200604     C                     MOVE '1'       *IN70
140000200604     C                     EXSR #ZA
140100200604     C*
140200200604     C                     END
140300200604     C*
140400200604     C**   ELSE - AT LEAST ONE REVIEW FROM FIELD ENTERED
140500200604     C*
140600200604     C                     ELSE
140700200604     C*
140800200604     C**   IF REVIEW FROM CUSTOMER AND FEE GROUP BLANK
140900200604     C*
141000200604     C           DD1RNS    IFEQ *BLANKS
141100200604     C           DD1RFG    ANDEQ*BLANKS
141200200604     C*
141300200604     C**   SET UP KEY FIELDS
141400200604     C*
141500200604     C                     Z-ADDWWCKSQ    WWCKS1
141600200604     C                     MOVE DD1RSE    WWSES1
141700200604     C                     MOVE DD1RCY    WWCCY1
141800200604     C                     MOVE DD1RIT    WWSIT1
141900200604     C                     MOVE *BLANKS   WWCFG1
142000200604     C                     MOVE *BLANKS   WWCNU1
142100200604     C*
142200200604     C*****ACCESS*SCCICFL1                                                S01464
142300200604     C**   ACCESS SECICFL1                                                S01464
142400200604     C*
142500200604     C***********WWCFL1    SETLLSCCICFL1                                  S01464
142600200604     C           WWCFL1    SETLLSECICFL1                                  S01464
142700200604     C***********          READ SCCICFL1                 24               S01464
142800200604     C                     READ SECICFL1                 24               S01464
142900200604     C*
143000200604     C**   REBUILD SUBFILE - SECICFL1
143100200604     C*
143200200604     C                     MOVE '1'       *IN70
143300200604     C                     EXSR #BCA
143400200604     C*
143500200604     C**   ELSE - CUSTOMER OR FEE GROUP ENTERED
143600200604     C*
143700200604     C                     ELSE
143800200604     C*
143900200604     C**   SET UP KEY FIELDS
144000200604     C*
144100200604     C                     MOVELDD1RFG    WWCFGX
144200200604     C           DD1RFG    IFNE *BLANKS
144300200604     C                     MOVE *BLANKS   WWCNUX
144400200604     C                     ELSE
144500200604     C                     MOVE WWCNUM    WWCNUX
144600200604     C                     END
144700200604     C                     Z-ADDWWCKSQ    WWCKSX
144800200604     C                     MOVE DD1RSE    WWSESX
144900200604     C                     MOVE DD1RCY    WWCCYX
145000200604     C                     MOVE DD1RIT    WWSITX
145100200604     C*
145200200604     C*****ACCESS*SCCICFXX                                                S01464
145300200604     C**   ACCESS SECICFXX                                                S01464
145400200604     C*
145500200604     C***********WWCFXX    SETLLSCCICFXX                                  S01464
145600200604     C           WWCFXX    SETLLSECICFXX                                  S01464
145700200604     C***********          READ SCCICFXX                 23               S01464
145800200604     C                     READ SECICFXX                 23               S01464
145900200604     C*
146000200604     C**   REBUILD SUBFILE - SECICFXX
146100200604     C*
146200200604     C                     MOVE '1'       *IN70
146300200604     C                     EXSR #ZA
146400200604     C*
146500200604     C                     END
146600200604     C*
146700200604     C**   IF REVIEW FROM CUSTOMER ONLY ENTERED
146800200604     C*
146900200604     C           DD1RNS    IFNE *BLANKS
147000200604     C           DD1RFG    ANDEQ*BLANKS
147100200604     C           DD1RSE    ANDEQ*BLANKS
147200200604     C           DD1RCY    ANDEQ*BLANKS
147300200604     C           DD1RIT    ANDEQ*BLANKS
147400200604     C*
147500200604     C**   ACCESS SDSECSL1 TO GET CUSTODY FEE GROUP CODE
147600200604     C*
147700200604     C***********WWCNUM    CHAINSDSECSL1             27                   S01464
147800200604     C                     CALL 'AOSECSR0'                                S01464
147900200604     C                     PARM *BLANKS   @RTCD   7                       S01464
148000200604     C                     PARM '*KEY   ' @OPTN   7                       S01464
148100200604     C                     PARM WWCNUM    @KEY2   6                       S01464
148200200604     C           SDSECS    PARM SDSECS    DSSDY                           S01464
148300200604     C***********                                                         S01464
148400200604     C*****IF*RECORD*FOUND*WITH*NON*BLANK*FEE*GROUP                       S01464
148500200604     C********-*SET*UP*REVIEW*FROM*CUSTOMER*AND*FEE*GROUP                 S01464
148600200604     C*
148700200604     C************IN27     IFEQ '0'                                       S01464
148800200604     C           @RTCD     IFEQ *BLANKS                                   S01464
148900200604     C           BFTYLC    ANDNE'D'
149000200604     C           BFCFGC    ANDNE*BLANKS
149100200604     C*
149200200604     C                     MOVELBFCUST    DD1RNS
149300200604     C                     MOVE BFCFGC    DD1RFG
149400200604     C*
149500200604     C**   ELSE - SET ALL REVIEW FIELDS TO BLANKS
149600200604     C*
149700200604     C                     ELSE
149800200604     C*
149900200604     C                     MOVE *BLANKS   DD1RNS
150000200604     C                     MOVE *BLANKS   DD1RFG
150100200604     C                     MOVE *BLANKS   DD1RSE
150200200604     C                     MOVE *BLANKS   DD1RCY
150300200604     C                     MOVE *BLANKS   DD1RIT
150400200604     C*
150500200604     C                     END
150600200604     C*
150700200604     C**   ELSE - SET ALL REVIEW FIELDS TO BLANKS
150800200604     C*
150900200604     C                     ELSE
151000200604     C*
151100200604     C                     MOVE *BLANKS   DD1RNS
151200200604     C                     MOVE *BLANKS   DD1RFG
151300200604     C                     MOVE *BLANKS   DD1RSE
151400200604     C                     MOVE *BLANKS   DD1RCY
151500200604     C                     MOVE *BLANKS   DD1RIT
151600200604     C*
151700200604     C                     END
151800200604     C*
151900200604     C                     END
152000200604     C*
152100200604     C                     END
152200200604     C*
152300200604     C           #BC0      ENDSR
152400200604     C*****************************************************************
152500200604     C/EJECT
152600200604     C*****************************************************************
152700200604     C**                                                              *
152800200604     C**   #BCA        - LOAD PAGE OF SUBFILE ( SECICFL1 )            *
152900200604     C**                                                              *
153000200604     C**   CALLS       - NONE                                         *
153100200604     C**                                                              *
153200200604     C**   CALLED BY   - #BC                                          *
153300200604     C**                                                              *
153400200604     C*****************************************************************
153500200604     C           #BCA      BEGSR
153600200604     C*
153700200604     C**   IF REQUIRED INITIALISE VARIABLES & CLEAR SUBFILE
153800200604     C*
153900200604     C           *IN70     IFEQ '1'
154000200604     C*
154100200604     C**   INITIALISE SUBFILE RRN ETC.
154200200604     C*
154300200604     C                     Z-ADD0         DD1RRN
154400200604     C                     Z-ADD0         WWSFRN
154500200604     C                     Z-ADD0         WWSFLC
154600200604     C                     MOVE '0'       *IN46
154700200604     C                     MOVE '0'       *IN47
154800200604     C*
154900200604     C**   CLEAR CHANGE SCREEN SUBFILE
155000200604     C*
155100200604     C                     MOVEA'001'     *IN,43           OFF 43-44 ON-45
155200200604     C                     WRITESE6030C1
155300200604     C                     MOVEA'000'     *IN,43           OFF 43-45
155400200604     C*
155500200604     C                     MOVE '0'       *IN70
155600200604     C*
155700200604     C**   SET ON SFLDSP & SFLDSPCTL INDICATORS
155800200604     C*
155900200604     C                     MOVEA'11'      *IN,43           ON 43-44
156000200604     C*
156100200604     C                     END
156200200604     C*
156300200604     C                     MOVE '0'       *IN50
156400200604     C                     MOVE '0'       *IN51
156500200604     C*
156600200604     C                     Z-ADDWWSFRN    DD1RRN
156700200604     C*
156800200604     C**   DO WHILE NOT EOF AND 12 RECORDS NOT YET LOADED
156900200604     C*
157000200604     C           *IN24     DOWEQ'0'
157100200604     C           WWSFLC    ANDLT12
157200200604     C*
157300200604     C                     ADD  1         WWSFLC
157400200604     C                     ADD  1         WWSFRN
157500200604     C                     ADD  1         DD1RRN
157600200604     C*
157700200604     C**   IF RECORDS IS DELETED - PROTECT FIELDS
157800200604     C*
157900200604     C           SCRECI    IFEQ '*'
158000200604     C                     MOVE '1'       *IN63
158100200604     C                     MOVE '1'       *IN71                           S01464
158200200604     C                     MOVE 'D'       DD1STS
158300200604     C                     ELSE
158400200604     C                     MOVE '0'       *IN63
158500200604     C                     MOVE '0'       *IN71                           S01464
158600200604     C                     MOVE *BLANKS   DD1STS
158700200604     C                     END
158800200604     C*                                                                   S01464
158900200604     C***  PROTECT FEE CODE AND REMOVE UNDERLINE                          S01464
159000200604     C*                                                                   S01464
159100200604     C           @PRTCT    IFEQ 'Y'                                       S01464
159200200604     C                     MOVE '1'       *IN63                           S01464
159300200604     C                     END                                            S01464
159400200604     C*
159500200604     C                     MOVE *BLANKS   DD1ACT
159600200604     C********** SCCNUM    IFEQ *ZEROS                                                        CSD027
159700200604     C           SCCNUM    IFEQ *BLANKS                                                       CSD027
159800200604     C                     MOVE *BLANKS   DD1CUS
159900200604     C                     ELSE
160000200604     C                     MOVE SCCNUM    DD1CUS
160100200604     C                     END
160200200604     C                     MOVE SCCFGC    DD1CFG
160300200604     C                     MOVE SCSESN    DD1SEC
160400200604     C                     MOVE SCCCY     DD1CCY
160500200604     C                     MOVE SCSITP    DD1INT
160600200604     C                     MOVE SCCGCO    DD1FEC
160700200604     C*
160800200604     C                     MOVE SCCGCO    HH1FEC
160900200604     C                     Z-ADDSCTNLU    HH1NLU
161000200604     C                     Z-ADDSCCKSQ    HH1CKS
161100200604     C*
161200200604     C**   WRITE A SUBFILE RECORD
161300200604     C*
161400200604     C                     WRITESE6030S1
161500200604     C*
161600200604     C*****READ*NEXT*RECORD*ON*SCCICFL1                                   S01464
161700200604     C**   READ NEXT RECORD ON SECICFL1                                   S01464
161800200604     C*
161900200604     C***********          READ SCCICFL1                 24               S01464
162000200604     C                     READ SECICFL1                 24               S01464
162100200604     C*
162200200604     C                     END
162300200604     C*
162400200604     C**   INITIALISE COUNTER
162500200604     C*
162600200604     C                     Z-ADD*ZEROS    WWSFLC
162700200604     C*
162800200604     C**   IF EOF - SETON SFLEND INDICATOR
162900200604     C*
163000200604     C           *IN24     IFEQ '1'
163100200604     C                     MOVE '1'       *IN46
163200200604     C                     END
163300200604     C*
163400200604     C**   IF NO RECORDS WRITTEN TO SUBFILE
163500200604     C*
163600200604     C           WWSFRN    IFEQ 0
163700200604     C                     MOVEL'SE03018' ZAMSID
163800200604     C                     EXSR ZASNMS
163900200604     C                     MOVE 'N'       WWVALD
164000200604     C                     MOVE '0'       *IN43
164100200604     C                     END
164200200604     C*
164300200604     C           #BCA0     ENDSR
164400200604     C*****************************************************************
164500200604     C/EJECT
164600200604     C*****************************************************************
164700200604     C**                                                              *
164800200604     C**   #C          - INPUT SCREEN PROCESSING                      *
164900200604     C**                                                              *
165000200604     C**   CALLS       - #CA , #CB , #CC                              *
165100200604     C**                                                              *
165200200604     C**   CALLED BY   - MAINLINE                                     *
165300200604     C**                                                              *
165400200604     C*****************************************************************
165500200604     C*
165600200604     C           #C        BEGSR
165700200604     C*
165800200604     C**   LOAD A BLANK PAGE OF SUBFILE RECORDS
165900200604     C*
166000200604     C                     MOVE '1'       *IN70
166100200604     C                     EXSR #CC
166200200604     C*
166300200604     C**   SET REVIEW FROM FIELDS TO BLANK
166400200604     C*
166500200604     C                     MOVE *BLANKS   DD2RNS
166600200604     C                     MOVE *BLANKS   DD2RFG
166700200604     C                     MOVE *BLANKS   DD2RSE
166800200604     C                     MOVE *BLANKS   DD2RCY
166900200604     C                     MOVE *BLANKS   DD2RIT
167000200604     C*
167100200604     C**   DOWHILE NOT CMD-3 & SCREEN-ID = 'INPUT '
167200200604     C*
167300200604     C           *INKC     DOWEQ'0'
167400200604     C           WWSCID    ANDEQ'INPUT '
167500200604     C*
167600200604     C**   WRITE INPUT SCREEN FOOTING FORMAT
167700200604     C*
167800200604     C                     WRITESE6030F2
167900200604     C*
168000200604     C**   WRITE INPUT SCREEN CONTROL FORMAT
168100200604     C*
168200200604     C                     WRITESE6030C2
168300200604     C*
168400200604     C**   IF ERRORS EXIST - DISPLAY MESSAGE SUBFILE
168500200604     C*
168600200604     C           WWVALD    IFEQ 'N'
168700200604     C                     WRITESE6030C3
168800200604     C                     END
168900200604     C*
169000200604     C**   READ INPUT SCREEN CONTROL FORMAT
169100200604     C*
169200200604     C                     READ SE6030C2                 22
169300200604     C*
169400200604     C**   IF NOT CMD-3
169500200604     C*
169600200604     C           *INKC     IFEQ '0'
169700200604     C*
169800200604     C**   ROLLUP
169900200604     C*
170000200604     C           *IN42     IFEQ '1'
170100200604     C*
170200200604     C**   LOAD NEXT PAGE OF BLANK SUBFILE RECORDS
170300200604     C*
170400200604     C                     MOVE '0'       *IN70
170500200604     C                     EXSR #CC
170600200604     C*
170700200604     C                     ELSE
170800200604     C*
170900200604     C**   VALIDATE INPUT SCREEN
171000200604     C*
171100200604     C                     EXSR #CA
171200200604     C*
171300200604     C**   IF VALID & RECORDS INSERTED
171400200604     C*
171500200604     C           WWVALD    IFEQ 'Y'
171600200604     C           WWUPDR    ANDEQ'Y'
171700200604     C*
171800200604     C**   PROCESS INSERT
171900200604     C*
172000200604     C                     EXSR #CB
172100200604     C*
172200200604     C                     END
172300200604     C*
172400200604     C**   IF VALID SO FAR
172500200604     C*
172600200604     C           WWVALD    IFEQ 'Y'
172700200604     C*
172800200604     C**   IF CMD-9 PRESSED - DISPLAY CHANGE SCREEN
172900200604     C*
173000200604     C           *INKI     IFEQ '1'
173100200604     C*
173200200604     C                     MOVE '1'       *IN70
173300200604     C                     MOVE 'CHANGE'  WWSCID
173400200604     C*
173500200604     C**   ELSE - DISPLAY BLANK INPUT SCREEN
173600200604     C*
173700200604     C                     ELSE
173800200604     C*
173900200604     C                     MOVE '1'       *IN70
174000200604     C                     EXSR #CC
174100200604     C*
174200200604     C                     END
174300200604     C*
174400200604     C                     END
174500200604     C*
174600200604     C                     END
174700200604     C*
174800200604     C                     END
174900200604     C*
175000200604     C                     END
175100200604     C*
175200200604     C           #C0       ENDSR
175300200604     C*****************************************************************
175400200604     C/EJECT
175500200604     C*****************************************************************
175600200604     C**                                                              *
175700200604     C** #CA         - VALIDATE INPUT SCREEN                          *
175800200604     C**                                                              *
175900200604     C** CALLS       - ZASNMS                                         *
176000200604     C**                                                              *
176100200604     C** CALLED BY   - #C                                             *
176200200604     C**                                                              *
176300200604     C*****************************************************************
176400200604     C*
176500200604     C           #CA       BEGSR
176600200604     C*
176700200604     C**   CLEAR SCREEN MESSAGE QUEUE
176800200604     C*
176900200604     C                     CALL 'Y2CLMSC'
177000200604     C                     PARM           WWTPGQ 10
177100200604     C                     PARM           WWPGQR  5
177200200604     C*
177300200604     C**   SET OF UPDATE REQUIRED FLAG
177400200604     C*
177500200604     C                     MOVE 'N'       WWUPDR
177600200604     C*
177700200604     C**   SET ON VALID FLAG
177800200604     C*
177900200604     C                     MOVE 'Y'       WWVALD
178000200604     C*
178100200604     C                     MOVE '0'       *IN64
178200200604     C*
178300200604     C**   VALIDATE SUBFILE RECORDS
178400200604     C**   ------------------------
178500200604     C*
178600200604     C**   READ FIRST CHANGED RECORD
178700200604     C*
178800200604     C                     READCSE6030S2                 21
178900200604     C*
179000200604     C**   SET ON SFLNXTCHG INDICATOR (ALSO PROCESSED FOR FILE UPDATE)
179100200604     C*
179200200604     C                     MOVE '1'       *IN47
179300200604     C*
179400200604     C**   DOWHILE CHANGED RECORDS EXIST
179500200604     C*
179600200604     C           *IN21     DOWEQ'0'
179700200604     C*
179800200604     C**   SET OF ERROR INDICATORS
179900200604     C*
180000200604     C                     MOVE '0'       *IN57
180100200604     C                     MOVE '0'       *IN58
180200200604     C                     MOVE '0'       *IN59
180300200604     C                     MOVE '0'       *IN60
180400200604     C                     MOVE '0'       *IN61
180500200604     C                     MOVE '0'       *IN62
180600200604     C*
180700200604     C**   IF RECORD NON-BLANK
180800200604     C*
180900200604     C           DD2CUS    IFNE *BLANKS
181000200604     C           DD2CFG    ORNE *BLANKS
181100200604     C           DD2SEC    ORNE *BLANKS
181200200604     C           DD2CCY    ORNE *BLANKS
181300200604     C           DD2INT    ORNE *BLANKS
181400200604     C           DD2FEC    ORNE *BLANKS
181500200604     C*
181600200604     C**   SET ON UPDATE REQUIRED FLAG
181700200604     C*
181800200604     C                     MOVE 'Y'       WWUPDR
181900200604     C*                                                                   S01464
182000200604     C**   IF CUSTOMER ENTERED                                            S01464
182100200604     C*                                                                   S01464
182200200604     C           DD2CUS    IFNE *BLANKS                                   S01464
182300200604     C*                                                                   S01464
182400200604     C**   CUSTOMER MUST EXIST ON SDSECSL1                                S01464
182500200604     C*                                                                   S01464
182600200604     C                     CALL 'AOSECSR0'                                S01464
182700200604     C                     PARM *BLANKS   @RTCD   7                       S01464
182800200604     C                     PARM '*KEY   ' @OPTN   7                       S01464
182900200604     C                     PARM DD2CUS    @KEY2   6                       S01464
183000200604     C           SDSECS    PARM SDSECS    DSSDY                           S01464
183100200604     C*                                                                   S01464
183200200604     C           @RTCD     IFNE *BLANKS                                   S01464
183300200604     C           @RTCD     ANDNE'*NOSEL '                                 S01464
183400200604     C           BFTYLC    OREQ 'D'                                       S01464
183500200604     C           BFSBJF    ORNE 'Y'                                       S01464
183600200604     C           @RTCD     ANDNE'*NOSEL '                                 S01464
183700200604     C*                                                                   S01464
183800200604     C                     MOVE BFCUST    DD2CUS                          S01464
183900200604     C                     MOVE '1'       *IN57                           S01464
184000200604     C                     MOVE 'N'       WWVALD                          S01464
184100200604     C                     MOVEL'SE03008' ZAMSID                          S01464
184200200604     C                     EXSR ZASNMS                                    S01464
184300200604     C*                                                                   S01464
184400200604     C                     ELSE                                           S01464
184500200604     C                     MOVE BFCUST    DD2CUS                          S01464
184600200604     C           @RTCD     IFEQ '*NOSEL '                                 S01464
184700200604     C                     MOVE *BLANKS   DD2CUS                          S01464
184800200604     C                     END                                            S01464
184900200604     C                     END                                            S01464
185000200604     C*                                                                   S01464
185100200604     C                     END                                            S01464
185200200604     C*
185300200604     C**   IF CUSTOMER AND FEE GROUP NOT ENTERED
185400200604     C*
185500200604     C           DD2CUS    IFEQ *BLANKS
185600200604     C           DD2CFG    ANDEQ*BLANKS
185700200604     C*
185800200604     C                     MOVE '1'       *IN57
185900200604     C                     MOVE '1'       *IN58
186000200604     C                     MOVE 'N'       WWVALD
186100200604     C                     MOVEL'SE03010' ZAMSID
186200200604     C                     EXSR ZASNMS
186300200604     C*
186400200604     C                     ELSE
186500200604     C*
186600200604     C**   IF CUSTOMER AND FEE GROUP ENTERED
186700200604     C*
186800200604     C           DD2CUS    IFNE *BLANKS
186900200604     C           DD2CFG    ANDNE*BLANKS
187000200604     C*
187100200604     C                     MOVE '1'       *IN57
187200200604     C                     MOVE '1'       *IN58
187300200604     C                     MOVE 'N'       WWVALD
187400200604     C****                 MOVEL'SE03001' ZAMSID                          S01355
187500200604     C                     MOVEL'SE03020' ZAMSID                          S01355
187600200604     C                     EXSR ZASNMS
187700200604     C*
187800200604     C                     END
187900200604     C*
188000200604     C                     END
188100200604     C***********                                                         S01464
188200200604     C*****IF*CUSTOMER*ENTERED                                            S01464
188300200604     C************                                                        S01464
188400200604     C***********DD2CUS    IFNE *BLANKS                                   S01464
188500200604     C***********                                                         S01464
188600200604     C*****CUSTOMER*MUST*EXIST*ON*SDSECSL1                                S01464
188700200604     C***********                                                         S01464
188800200604     C***********DD2CUS    CHAINSDSECSL1             27                   S01464
188900200604     C***********                                                         S01464
189000200604     C************IN27     IFEQ '1'                                       S01464
189100200604     C***********BFTYLC    OREQ 'D'                                       S01464
189200200604     C***********BFSBJF    ORNE 'Y'                                       S01464
189300200604     C***********                                                         S01464
189400200604     C***********          MOVE '1'       *IN57                           S01464
189500200604     C***********          MOVE 'N'       WWVALD                          S01464
189600200604     C***********          MOVEL'SE03008' ZAMSID                          S01464
189700200604     C***********          EXSR ZASNMS                                    S01464
189800200604     C***********                                                         S01464
189900200604     C***********          END                                            S01464
190000200604     C***********                                                         S01464
190100200604     C***********          END                                            S01464
190200200604     C*
190300200604     C**   IF FEE GROUP ENTERED
190400200604     C*
190500200604     C           DD2CFG    IFNE *BLANKS
190600200604     C*
190700200604     C*****FEE*GROUP*MUST*EXIST*ON*SCCFGRPD                               S01464
190800200604     C**   FEE GROUP MUST EXIST ON SECFGRPD                               S01464
190900200604     C*
191000200604     C***********DD2CFG    CHAINSCCFGRPD             31                   S01464
191100200604     C           DD2CFG    CHAINSECFGRPD             31                   S01464
191200200604     C*
191300200604     C           *IN31     IFEQ '1'
191400200604     C           SBRECI    OREQ '*'
191500200604     C*
191600200604     C                     MOVE '1'       *IN58
191700200604     C                     MOVE 'N'       WWVALD
191800200604     C                     MOVEL'SE03009' ZAMSID
191900200604     C                     EXSR ZASNMS
192000200604     C*
192100200604     C                     END
192200200604     C*
192300200604     C                     END
192400200604     C*
192500200604     C**   IF SECURITY ENTERED
192600200604     C*
192700200604     C           DD2SEC    IFNE *BLANKS
192800200604     C*
192900200604     C**   IF INVESTMENT TYPE ENTERED - ERROR
193000200604     C*
193100200604     C           DD2INT    IFNE *BLANKS
193200200604     C*
193300200604     C                     MOVE '1'       *IN59
193400200604     C                     MOVE '1'       *IN61
193500200604     C                     MOVE 'N'       WWVALD
193600200604     C                     MOVEL'SE03003' ZAMSID
193700200604     C                     EXSR ZASNMS
193800200604     C*
193900200604     C                     END
194000200604     C*
194100200604     C**   IF CURRENCY ENTERED - ERROR
194200200604     C*
194300200604     C           DD2CCY    IFNE *BLANKS
194400200604     C*
194500200604     C                     MOVE '1'       *IN59
194600200604     C                     MOVE '1'       *IN60
194700200604     C                     MOVE 'N'       WWVALD
194800200604     C                     MOVEL'SE03004' ZAMSID
194900200604     C                     EXSR ZASNMS
195000200604     C*
195100200604     C                     END
195200200604     C*
195300200604     C**   SECURITY MUST EXIST ON SECTY
195400200604     C*
195500200604     C           DD2SEC    CHAINSECTY                28
195600200604     C*
195700200604     C           *IN28     IFEQ '1'
195800200604     C           RECI      OREQ '*'
195900200604     C*
196000200604     C                     MOVE '1'       *IN59
196100200604     C                     MOVE 'N'       WWVALD
196200200604     C                     MOVEL'SE03011' ZAMSID
196300200604     C                     EXSR ZASNMS
196400200604     C*
196500200604     C                     END
196600200604     C*
196700200604     C                     END
196800200604     C*
196900200604     C**   IF INVESTMENT TYPE ENTERED
197000200604     C*
197100200604     C           DD2INT    IFNE *BLANKS
197200200604     C*
197300200604     C**   INVESTMENT TYPE MUST EXIST ON INVTPC
197400200604     C*
197500200604     C           DD2INT    CHAININVTPC               29
197600200604     C*
197700200604     C           *IN29     IFEQ '1'
197800200604     C*
197900200604     C                     MOVE '1'       *IN61
198000200604     C                     MOVE 'N'       WWVALD
198100200604     C                     MOVEL'SE03013' ZAMSID
198200200604     C                     EXSR ZASNMS
198300200604     C*
198400200604     C                     END
198500200604     C*
198600200604     C**   IF CURRENCY ENTERED
198700200604     C*
198800200604     C           DD2CCY    IFNE *BLANKS
198900200604     C*
199000200604     C**   INVESTMENT TYPE & CURRENCY MUST EXIST ON INVTPC
199100200604     C*
199200200604     C                     MOVE DD2INT    WWINVT
199300200604     C                     MOVE DD2CCY    WWCCYI
199400200604     C           WWNVTP    CHAININVTPC               29
199500200604     C*
199600200604     C           *IN29     IFEQ '1'
199700200604     C*
199800200604     C                     MOVE '1'       *IN60
199900200604     C                     MOVE '1'       *IN61
200000200604     C                     MOVE 'N'       WWVALD
200100200604     C                     MOVEL'SE03013' ZAMSID
200200200604     C                     EXSR ZASNMS
200300200604     C*
200400200604     C                     END
200500200604     C*
200600200604     C                     END
200700200604     C*
200800200604     C                     END
200900200604     C*
201000200604     C**   IF CURRENCY ENTERED
201100200604     C*
201200200604     C           DD2CCY    IFNE *BLANKS
201300200604     C           DD2CCY    ANDNE'ALL'                                     S01464
201400200604     C*
201500200604     C*****CURRENCY*MUST*EXIST*ON*SCCURRJ0                                S01464
201600200604     C***  CURRENCY MUST EXIST ON SDCURRPD                                S01464
201700200604     C*
201800200604     C                     CALL 'AOCURRR0'                                S01464
201900200604     C                     PARM '*BLANKS' @RTCD   7                       S01464
202000200604     C                     PARM '*KEY   ' @OPTN   7                       S01464
202100200604     C                     PARM DD2CCY    @AJCD   3                       S01464
202200200604     C           SDCURR    PARM SDCURR    DSSDY                           S01464
202300200604     C***********DD2CCY    CHAINSDCURRJ0             30                   S01464
202400200604     C***********                                                         S01464
202500200604     C************IN30     IFEQ '1'                                       S01464
202600200604     C***********A6TYLC    OREQ 'D'                                       S01464
202700200604     C           @RTCD     IFNE *BLANKS                                   S01464
202800200604     C           @RTCD     ANDNE'*NOSEL '                                 S01464
202900200604     C*
203000200604     C                     MOVE '1'       *IN60
203100200604     C                     MOVE 'N'       WWVALD
203200200604     C                     MOVEL'SE03015' ZAMSID
203300200604     C                     EXSR ZASNMS
203400200604     C*
203500200604     C                     ELSE
203600200604     C*                                                                   S01464
203700200604     C                     MOVE A6CYCD    DD2CCY                          S01464
203800200604     C           @RTCD     IFEQ '*NOSEL '                                 S01464
203900200604     C                     MOVE *BLANKS   DD2CCY                          S01464
204000200604     C                     END                                            S01464
204100200604     C*
204200200604     C**   IF INVESTMENT TYPE IS NOT ENTERED
204300200604     C**      PRECIOUS METAL INDICATOR MUST = 'Y'
204400200604     C*
204500200604     C           DD2INT    IFEQ *BLANKS
204600200604     C***********CYPMRT    ANDNE'Y'                                       S01464
204700200604     C           A6PMRT    ANDNE'Y'                                       S01464
204800200604     C*
204900200604     C                     MOVE '1'       *IN60
205000200604     C                     MOVE 'N'       WWVALD
205100200604     C                     MOVEL'SE03015' ZAMSID
205200200604     C                     EXSR ZASNMS
205300200604     C*
205400200604     C                     END
205500200604     C*
205600200604     C                     END
205700200604     C*                                                                   S01464
205800200604     C**   IF ONLY CURRENCY FIELD ENTERED                                 S01464
205900200604     C*                                                                   S01464
206000200604     C           DD2CCY    IFEQ 'ALL'                                     S01464
206100200604     C           DD2SEC    ANDNE*BLANKS                                   S01464
206200200604     C           DD2INT    ANDNE*BLANKS                                   S01464
206300200604     C                     MOVE '1'       *IN60                           S01464
206400200604     C                     MOVE 'N'       WWVALD                          S01464
206500200604     C                     MOVEL'SE03015' ZAMSID                          S01464
206600200604     C                     EXSR ZASNMS                                    S01464
206700200604     C                     END                                            S01464
206800200604     C*
206900200604     C                     END
207000200604     C*
207100200604     C**   IF SECURITY , INVESTMENT TYPE & CCY NOT ENTERED
207200200604     C*
207300200604     C           DD2SEC    IFEQ *BLANKS
207400200604     C           DD2INT    ANDEQ*BLANKS
207500200604     C           DD2CCY    ANDEQ*BLANKS
207600200604     C*
207700200604     C                     MOVE '1'       *IN59
207800200604     C                     MOVE '1'       *IN60
207900200604     C                     MOVE '1'       *IN61
208000200604     C                     MOVE 'N'       WWVALD
208100200604     C                     MOVEL'SE03016' ZAMSID
208200200604     C                     EXSR ZASNMS
208300200604     C*
208400200604     C                     END
208500200604     C*
208600200604     C*****FEE*CODE*MUST*EXIST*ON*SCCGCDPD                                S01464
208700200604     C**   FEE CODE MUST EXIST ON SECGCDPD                                S01464
208800200604     C*
208900200604     C***********DD2FEC    CHAINSCCGCDPD             25                   S01464
209000200604     C           DD2FEC    CHAINSECGCDPD             25                   S01464
209100200604     C*
209200200604     C           *IN25     IFEQ '1'
209300200604     C           SFRECI    OREQ '*'
209400200604     C*
209500200604     C                     MOVE '1'       *IN62
209600200604     C                     MOVE 'N'       WWVALD
209700200604     C                     MOVEL'SE03006' ZAMSID
209800200604     C                     EXSR ZASNMS
209900200604     C*
210000200604     C                     END
210100200604     C*
210200200604     C**   SET UP CHECKING SEQUENCE
210300200604     C*
210400200604     C                     Z-ADD*ZEROS    HH2CKS
210500200604     C           DD2SEC    IFNE *BLANKS
210600200604     C                     Z-ADD1         HH2CKS
210700200604     C                     ELSE
210800200604     C           DD2CCY    IFNE *BLANKS
210900200604     C           DD2INT    ANDNE*BLANKS
211000200604     C                     Z-ADD2         HH2CKS
211100200604     C                     ELSE
211200200604     C           DD2INT    IFNE *BLANKS
211300200604     C                     Z-ADD3         HH2CKS
211400200604     C                     ELSE
211500200604     C           DD2CCY    IFNE *BLANKS
211600200604     C                     Z-ADD4         HH2CKS
211700200604     C                     END
211800200604     C                     END
211900200604     C                     END
212000200604     C                     END
212100200604     C*
212200200604     C**   CHECK RECORD DOES NOT ALREADY EXIST
212300200604     C*
212400200604     C                     MOVE DD2CFG    WWCFGX
212500200604     C                     MOVE DD2CUS    WWCNUX
212600200604     C                     Z-ADDHH2CKS    WWCKSX
212700200604     C                     MOVE DD2SEC    WWSESX
212800200604     C                     MOVE DD2CCY    WWCCYX
212900200604     C                     MOVE DD2INT    WWSITX
213000200604     C*
213100200604     C***********WWCFXX    CHAINSCCICFXX             23                   S01464
213200200604     C           WWCFXX    CHAINSECICFXX             23                   S01464
213300200604     C*
213400200604     C**   IF RECORD FOUND
213500200604     C*
213600200604     C           *IN23     IFEQ '0'
213700200604     C*
213800200604     C**   IF RECORD NOT DELETED - ERROR
213900200604     C*
214000200604     C           SCRECI    IFNE '*'
214100200604     C*
214200200604     C                     MOVE '1'       *IN57
214300200604     C                     MOVE '1'       *IN58
214400200604     C                     MOVE '1'       *IN59
214500200604     C                     MOVE '1'       *IN60
214600200604     C                     MOVE '1'       *IN61
214700200604     C                     MOVE 'N'       WWVALD
214800200604     C                     MOVEL'SE03017' ZAMSID
214900200604     C                     EXSR ZASNMS
215000200604     C*
215100200604     C                     ELSE
215200200604     C*
215300200604     C**   SAVE TRANSACTION NUMBER OF LAST UPDATE
215400200604     C*
215500200604     C                     Z-ADDSCTNLU    HH2NLU
215600200604     C*
215700200604     C                     END
215800200604     C*
215900200604     C                     END
216000200604     C*
216100200604     C**   STORE RRN OF FIRST RECORD IN ERROR
216200200604     C*
216300200604     C           WWVALD    IFEQ 'N'
216400200604     C           *IN64     ANDEQ'0'
216500200604     C                     Z-ADDDD2RRN    WWFRRN
216600200604     C                     MOVE '1'       *IN64
216700200604     C                     END
216800200604     C*
216900200604     C                     END
217000200604     C*
217100200604     C**   UPDATE SUBFILE
217200200604     C*
217300200604     C                     UPDATSE6030S2
217400200604     C*
217500200604     C**   READ NEXT CHANGED RECORD
217600200604     C*
217700200604     C                     READCSE6030S2                 21
217800200604     C*
217900200604     C                     END
218000200604     C*
218100200604     C**   IF ERROR - RELOAD RRN OF FIRST RECORD IN ERROR
218200200604     C*
218300200604     C           *IN64     IFEQ '1'
218400200604     C                     Z-ADDWWFRRN    DD2RRN
218500200604     C                     END
218600200604     C*
218700200604     C           #CA0      ENDSR
218800200604     C*****************************************************************
218900200604     C/EJECT
219000200604     C*****************************************************************
219100200604     C**                                                              *
219200200604     C**   #CB         - PROCESS INSERT                               *
219300200604     C**                                                              *
219400200604     C**   CALLS       - #ZB , ZASNMS                                 *
219500200604     C**                                                              *
219600200604     C**   CALLED BY   - #C                                           *
219700200604     C**                                                              *
219800200604     C*****************************************************************
219900200604     C*
220000200604     C           #CB       BEGSR
220100200604     C*
220200200604     C**   READ FIRST CHANGED RECORD
220300200604     C*
220400200604     C                     READCSE6030S2                 21
220500200604     C*
220600200604     C**   INITIALISE NO OF RECORDS INSERTED COUNT
220700200604     C*
220800200604     C                     Z-ADD*ZEROS    WWNORI
220900200604     C*
221000200604     C**   DOWHILE CHANGED RECORDS EXIST
221100200604     C*
221200200604     C           *IN21     DOWEQ'0'
221300200604     C*
221400200604     C**   CHECK THAT RECORD NOT BLANKS
221500200604     C*
221600200604     C           DD2CFG    IFNE *BLANKS
221700200604     C           DD2CUS    ORNE *BLANKS
221800200604     C           DD2SEC    ORNE *BLANKS
221900200604     C           DD2CCY    ORNE *BLANKS
222000200604     C           DD2INT    ORNE *BLANKS
222100200604     C*
222200200604     C**   GET TRANSACTION NO. OF LAST UPDATE
222300200604     C*
222400200604     C                     EXSR ZTNLU1
222500200604     C*
222600200604     C*****ACCESS*SCCICFPD                                                S01464
222700200604     C**   ACCESS SECICFPD                                                S01464
222800200604     C*
222900200604     C                     MOVE DD2CFG    WWCFGD
223000200604     C                     MOVE DD2CUS    WWCNUD
223100200604     C                     Z-ADDHH2CKS    WWCKSD
223200200604     C                     MOVE DD2SEC    WWSESD
223300200604     C                     MOVE DD2CCY    WWCCYD
223400200604     C                     MOVE DD2INT    WWSITD
223500200604     C*
223600200604     C***********WWCFPD    CHAINSCCICFPD             33                   S01464
223700200604     C           WWCFPD    CHAINSECICFPD             33                   S01464
223800200604     C*
223900200604     C**   SET UP DAY,MONTH,YEAR OF LAST UPDATE
224000200604     C*
224100200604     C                     MOVE BJMRDT    WWDAT
224200200604     C*
224300200604     C**   IF A RECORD ALREADY EXISTS
224400200604     C*
224500200604     C           *IN33     IFEQ '0'
224600200604     C*
224700200604     C**   IF TNLU HAS CHANGED
224800200604     C*
224900200604     C           SCTNLU    IFNE HH2NLU
225000200604     C*
225100200604     C**   HIGHLIGHT INPUT CAPABLE FIELDS & SETON SFLNXTCHG INDICATOR
225200200604     C*
225300200604     C                     MOVE '1'       *IN57
225400200604     C                     MOVE '1'       *IN58
225500200604     C                     MOVE '1'       *IN59
225600200604     C                     MOVE '1'       *IN60
225700200604     C                     MOVE '1'       *IN61
225800200604     C                     MOVE '1'       *IN62
225900200604     C                     MOVE '1'       *IN47
226000200604     C*
226100200604     C**   UPDATE SUBFILE WITH VALUES FROM FILE
226200200604     C*
226300200604     C                     MOVELSCCNUM    DD2CUS
226400200604     C                     MOVELSCCFGC    DD2CFG
226500200604     C                     MOVELSCSESN    DD2SEC
226600200604     C                     MOVELSCCCY     DD2CCY
226700200604     C                     MOVELSCSITP    DD2INT
226800200604     C                     MOVELSCCGCO    DD2FEC
226900200604     C                     Z-ADDSCCKSQ    HH2CKS
227000200604     C                     Z-ADDSCTNLU    HH2NLU
227100200604     C*
227200200604     C                     UPDATSE6030S2
227300200604     C*
227400200604     C**   LOAD MESSAGE & RELEASE RECORD
227500200604     C*
227600200604     C                     MOVE 'N'       WWVALD
227700200604     C                     MOVEL'SE03007' ZAMSID
227800200604     C                     EXSR ZASNMS
227900200604     C*
228000200604     C                     EXCPTSCCICF
228100200604     C*
228200200604     C**   ELSE - UPDATE RECORD
228300200604     C*
228400200604     C                     ELSE
228500200604     C*
228600200604     C                     MOVEL'D'       SCRECI
228700200604     C                     MOVELDD2CUS    SCCNUM
228800200604     C                     MOVELDD2CFG    SCCFGC
228900200604     C                     MOVELDD2SEC    SCSESN
229000200604     C                     MOVELDD2CCY    SCCCY
229100200604     C                     MOVELDD2INT    SCSITP
229200200604     C                     MOVELDD2FEC    SCCGCO
229300200604     C                     Z-ADDHH2CKS    SCCKSQ
229400200604     C                     Z-ADDWWDSTN    SCTNLU
229500200604     C                     MOVE 'I'       SCCHTP
229600200604     C*
229700200604     C                     Z-ADDBJRDNB    SCLCD
229800200604     C                     TIME           SCTLUP
229900200604     C*
230000200604     C***********          UPDATSCCICFP0                                  S01464
230100200604     C                     UPDATSECICFP0                                  S01464
230200200604     C*
230300200604     C                     ADD  1         WWNORI
230400200604     C*
230500200604     C                     END
230600200604     C*
230700200604     C**   ELSE - RECORD DOES NOT EXIST
230800200604     C*
230900200604     C                     ELSE
231000200604     C*
231100200604     C                     MOVEL'D'       SCRECI
231200200604     C                     MOVELDD2CUS    SCCNUM
231300200604     C                     MOVELDD2CFG    SCCFGC
231400200604     C                     MOVELDD2SEC    SCSESN
231500200604     C                     MOVELDD2CCY    SCCCY
231600200604     C                     MOVELDD2INT    SCSITP
231700200604     C                     MOVELDD2FEC    SCCGCO
231800200604     C                     Z-ADDHH2CKS    SCCKSQ
231900200604     C*
232000200604     C                     Z-ADDWWDSTN    SCTNLU
232100200604     C                     MOVE 'I'       SCCHTP
232200200604     C*
232300200604     C                     Z-ADDBJRDNB    SCLCD
232400200604     C                     TIME           SCTLUP
232500200604     C*
232600200604     C***********          WRITESCCICFP0               32                 S01464
232700200604     C                     WRITESECICFP0               32                 S01464
232800200604     C*
232900200604     C**   IF DUPLICATE KEY ERROR
233000200604     C*
233100200604     C           *IN32     IFEQ '1'
233200200604     C*
233300200604     C           STATUS    IFEQ 01021
233400200604     C*
233500200604     C                     ROLBK
233600200604     C*
233700200604     C**   CLEAR MESSAGES CAUSED BY STATUS ERROR
233800200604     C*
233900200604     C                     CALL 'Y2CLMSC'
234000200604     C                     PARM           WWTPGQ
234100200604     C                     PARM           WWPGQR
234200200604     C*
234300200604     C                     MOVE 'N'       WWVALD
234400200604     C                     MOVEL'SE03007' ZAMSID
234500200604     C                     EXSR ZASNMS
234600200604     C*
234700200604     C                     ELSE
234800200604     C*
234900200604     C                     EXSR *PSSR
235000200604     C*
235100200604     C                     END
235200200604     C*
235300200604     C**********           END                                                              MD010785
235400200604     C                     ELSE                                                             MD010785
235500200604     C*
235600200604     C                     ADD  1         WWNORI
235700200604     C*
235800200604     C                     ENDIF                                                            MD010785
235900200604      *                                                                                     MD010785
236000200604     C                     END
236100200604     C*
236200200604     C                     END
236300200604     C*
236400200604     C**   READ NEXT CHANGED RECORD
236500200604     C*
236600200604     C                     READCSE6030S2                 21
236700200604     C*
236800200604     C                     END
236900200604     C*
237000200604     C**   IF NO ERROR
237100200604     C*
237200200604     C           WWVALD    IFEQ 'Y'
237300200604     C           WWNORI    ORGT 0                                                           MD010785
237400200604     C*
237500200604     C**   IF NO OF RECORDS INSERTED > 0
237600200604     C*
237700200604     C           WWNORI    IFGT 0
237800200604     C*
237900200604     C**   UPDATE TRAILER FILE
238000200604     C*
238100200604     C                     EXSR #ZB
238200200604     C*
238300200604     C                     END
238400200604     C*
238500200604     C**   COMIT UPDATES
238600200604     C*
238700200604     C           CMTTXT    COMIT
238800200604     C*
238900200604     C                     END
239000200604     C*
239100200604     C           #CB0      ENDSR
239200200604     C*****************************************************************
239300200604     C/EJECT
239400200604     C*****************************************************************
239500200604     C**                                                              *
239600200604     C**   #CC         - LOAD PAGE OF INPUT SCREEN SUBFILE            *
239700200604     C**                                                              *
239800200604     C**   CALLS       - NONE                                         *
239900200604     C**                                                              *
240000200604     C**   CALLED BY   - #C                                           *
240100200604     C**                                                              *
240200200604     C*****************************************************************
240300200604     C           #CC       BEGSR
240400200604     C*
240500200604     C**   IF REQUIRED INITIALISE VARIABLES & CLEAR SUBFILE
240600200604     C*
240700200604     C           *IN70     IFEQ '1'
240800200604     C*
240900200604     C**   INITIALISE SUBFILE RRN ETC.
241000200604     C*
241100200604     C                     Z-ADD0         DD2RRN
241200200604     C                     Z-ADD0         WWSFRN
241300200604     C                     Z-ADD0         WWSFLC
241400200604     C                     MOVE '0'       *IN46
241500200604     C                     MOVE '0'       *IN47
241600200604     C*
241700200604     C**   CLEAR INPUT SCREEN SUBFILE
241800200604     C*
241900200604     C                     MOVEA'001'     *IN,43           OFF 43-44 ON-45
242000200604     C                     WRITESE6030C2
242100200604     C                     MOVEA'000'     *IN,43           OFF 43-45
242200200604     C*
242300200604     C                     MOVE '0'       *IN70
242400200604     C*
242500200604     C**   SET ON SFLDSP & SFLDSPCTL INDICATORS
242600200604     C*
242700200604     C                     MOVEA'11'      *IN,43           ON 43-44
242800200604     C*
242900200604     C                     END
243000200604     C*
243100200604     C                     Z-ADDWWSFRN    DD2RRN
243200200604     C*
243300200604     C                     MOVE '0'       *IN57
243400200604     C                     MOVE '0'       *IN58
243500200604     C                     MOVE '0'       *IN59
243600200604     C                     MOVE '0'       *IN60
243700200604     C                     MOVE '0'       *IN61
243800200604     C                     MOVE '0'       *IN62
243900200604     C*
244000200604     C**   DO WHILE 12 BLANK RECORDS NOT YET LOADED
244100200604     C*
244200200604     C           WWSFLC    DOWLT12
244300200604     C*
244400200604     C                     ADD  1         WWSFLC
244500200604     C                     ADD  1         WWSFRN
244600200604     C                     ADD  1         DD2RRN
244700200604     C*
244800200604     C                     MOVE *BLANKS   DD2CUS
244900200604     C                     MOVE *BLANKS   DD2CFG
245000200604     C                     MOVE *BLANKS   DD2SEC
245100200604     C                     MOVE *BLANKS   DD2CCY
245200200604     C                     MOVE *BLANKS   DD2INT
245300200604     C                     MOVE *BLANKS   DD2FEC
245400200604     C*
245500200604     C**   WRITE A SUBFILE RECORD
245600200604     C*
245700200604     C                     WRITESE6030S2
245800200604     C*
245900200604     C                     END
246000200604     C*
246100200604     C**   INITIALISE COUNTER
246200200604     C*
246300200604     C                     Z-ADD*ZEROS    WWSFLC
246400200604     C*
246500200604     C           #CC0      ENDSR
246600200604     C*****************************************************************
246700200604     C/EJECT
246800200604     C*****************************************************************
246900200604     C**                                                              *
247000200604     C**   #ZA         - LOAD PAGE OF SUBFILE ( SECICFXX )            *
247100200604     C**                                                              *
247200200604     C**   CALLS       - NONE                                         *
247300200604     C**                                                              *
247400200604     C**   CALLED BY   - #B , #BC                                     *
247500200604     C**                                                              *
247600200604     C*****************************************************************
247700200604     C           #ZA       BEGSR
247800200604     C*
247900200604     C**   IF REQUIRED INITIALISE VARIABLES & CLEAR SUBFILE
248000200604     C*
248100200604     C           *IN70     IFEQ '1'
248200200604     C*
248300200604     C**   INITIALISE SUBFILE RRN ETC.
248400200604     C*
248500200604     C                     Z-ADD0         DD1RRN
248600200604     C                     Z-ADD0         WWSFRN
248700200604     C                     Z-ADD0         WWSFLC
248800200604     C                     MOVE '0'       *IN46
248900200604     C                     MOVE '0'       *IN47
249000200604     C*
249100200604     C**   CLEAR CHANGE SCREEN SUBFILE
249200200604     C*
249300200604     C                     MOVEA'001'     *IN,43           OFF 43-44 ON-45
249400200604     C                     WRITESE6030C1
249500200604     C                     MOVEA'000'     *IN,43           OFF 43-45
249600200604     C*
249700200604     C                     MOVE '0'       *IN70
249800200604     C*
249900200604     C**   SET ON SFLDSP & SFLDSPCTL INDICATORS
250000200604     C*
250100200604     C                     MOVEA'11'      *IN,43           ON 43-44
250200200604     C*
250300200604     C                     END
250400200604     C*
250500200604     C                     MOVE '0'       *IN50
250600200604     C                     MOVE '0'       *IN51
250700200604     C*
250800200604     C                     Z-ADDWWSFRN    DD1RRN
250900200604     C*
251000200604     C**   DO WHILE NOT EOF AND 12 RECORDS NOT YET LOADED
251100200604     C*
251200200604     C           *IN23     DOWEQ'0'
251300200604     C           WWSFLC    ANDLT12
251400200604     C*
251500200604     C                     ADD  1         WWSFLC
251600200604     C                     ADD  1         WWSFRN
251700200604     C                     ADD  1         DD1RRN
251800200604     C*
251900200604     C**   IF RECORDS IS DELETED - PROTECT FIELDS
252000200604     C*
252100200604     C           SCRECI    IFEQ '*'
252200200604     C                     MOVE '1'       *IN63
252300200604     C                     MOVE '1'       *IN71                           S01464
252400200604     C                     MOVE 'D'       DD1STS
252500200604     C                     ELSE
252600200604     C                     MOVE '0'       *IN63
252700200604     C                     MOVE '0'       *IN71                           S01464
252800200604     C                     MOVE *BLANKS   DD1STS
252900200604     C                     END
253000200604     C*                                                                   S01464
253100200604     C***  PROTECT FEE CODE AND REMOVE UNDERLINE                          S01464
253200200604     C*                                                                   S01464
253300200604     C           @PRTCT    IFEQ 'Y'                                       S01464
253400200604     C                     MOVE '1'       *IN63                           S01464
253500200604     C                     END                                            S01464
253600200604     C*
253700200604     C                     MOVE *BLANKS   DD1ACT
253800200604     C********** SCCNUM    IFEQ *ZEROS                                                        CSD027
253900200604     C           SCCNUM    IFEQ *BLANKS                                                       CSD027
254000200604     C                     MOVE *BLANKS   DD1CUS
254100200604     C                     ELSE
254200200604     C                     MOVE SCCNUM    DD1CUS
254300200604     C                     END
254400200604     C                     MOVE SCCFGC    DD1CFG
254500200604     C                     MOVE SCSESN    DD1SEC
254600200604     C                     MOVE SCCCY     DD1CCY
254700200604     C                     MOVE SCSITP    DD1INT
254800200604     C                     MOVE SCCGCO    DD1FEC
254900200604     C*
255000200604     C                     MOVE SCCGCO    HH1FEC
255100200604     C                     MOVE SCTNLU    HH1NLU
255200200604     C                     MOVE SCCKSQ    HH1CKS
255300200604     C*
255400200604     C**   WRITE A SUBFILE RECORD
255500200604     C*
255600200604     C                     WRITESE6030S1
255700200604     C*
255800200604     C*****READ*NEXT*RECORD*ON*SCCICFXX                                   S01464
255900200604     C**   READ NEXT RECORD ON SECICFXX                                   S01464
256000200604     C*
256100200604     C***********          READ SCCICFXX                 23               S01464
256200200604     C                     READ SECICFXX                 23               S01464
256300200604     C*
256400200604     C                     END
256500200604     C*
256600200604     C**   INITIALISE COUNTER
256700200604     C*
256800200604     C                     Z-ADD*ZEROS    WWSFLC
256900200604     C*
257000200604     C**   IF EOF - SETON SFLEND INDICATOR
257100200604     C*
257200200604     C           *IN23     IFEQ '1'
257300200604     C                     MOVE '1'       *IN46
257400200604     C                     END
257500200604     C*
257600200604     C**   IF NO RECORDS WRITTEN TO SUBFILE
257700200604     C*
257800200604     C           WWSFRN    IFEQ 0
257900200604     C                     MOVEL'SE03018' ZAMSID
258000200604     C                     EXSR ZASNMS
258100200604     C                     MOVE 'N'       WWVALD
258200200604     C                     MOVE '0'       *IN43
258300200604     C                     END
258400200604     C*
258500200604     C           #ZA0      ENDSR
258600200604     C*****************************************************************
258700200604     C/EJECT
258800200604     C*****************************************************************
258900200604     C**                                                              *
259000200604     C**   #ZB         - UPDATE TRAILER FILE                          *
259100200604     C**                                                              *
259200200604     C**   CALLS       - NONE                                         *
259300200604     C**                                                              *
259400200604     C**   CALLED BY   - #BB , #CB                                    *
259500200604     C**                                                              *
259600200604     C*****************************************************************
259700200604     C*
259800200604     C           #ZB       BEGSR
259900200604     C*
260000200604     C**   ACCESS CUST/INST FEE CODES TRAILER
260100200604     C*
260200200604     C***********1         CHAINSCCICFZZ             32                   S01464
260300200604     C           1         CHAINSECICFPA             32                   S01464
260400200604     C*
260500200604     C           *IN32     IFEQ '1'
260600200604     C           SCRECI    ORNE 'Z'
260700200604     C                     ROLBK
260800200604     C           *LOCK     IN   LDA                                       S01464
260900200604     C                     Z-ADD2         DBASE            ***************
261000200604     C                     MOVE *BLANKS   DBFILE           *             *
261100200604     C***********          MOVEL'SCCICFZZ'DBFILE           * DBERROR 002 *S01464
261200200604     C                     MOVEL'SECICFPA'DBFILE           * DBERROR 002 *S01464
261300200604     C                     MOVEL*BLANKS   DBKEY            *             *
261400200604     C                     OUT  LDA                        ***************S01464
261500200604     C                     MOVE '1'       *INU7
261600200604     C                     MOVE '1'       *INU8
261700200604     C                     MOVE '1'       *INLR
261800200604     C                     RETRN
261900200604     C                     END
262000200604     C*
262100200604     C**   IF ACTION = 'D' , SUBTRACT NO OF RECORDS
262200200604     C*
262300200604     C           WWNORD    IFGT 0
262400200604     C*
262500200604     C                     SUB  WWNORD    SCNORE
262600200604     C*
262700200604     C**   ELSE - ACTION MUST BE INSERT , ADD TO NO OF RECORDS
262800200604     C*
262900200604     C                     ELSE
263000200604     C*
263100200604     C                     ADD  WWNORI    SCNORE
263200200604     C*
263300200604     C                     END
263400200604     C                     Z-ADD0         WWNORI                                            MD010785
263500200604     C*
263600200604     C**   UPDATE TRAILER FILE
263700200604     C*
263800200604     C***********          UPDATSCCICFZ0
263900200604     C                     UPDATSECICFZ0
264000200604     C*
264100200604     C**   SET UP COMMITMENT TEXT
264200200604     C*
264300200604     C                     MOVEL'SE'      MDID
264400200604     C                     MOVEL'SE6030'  PGMN
264500200604     C                     MOVELDDWSID    WSIDX
264600200604     C                     MOVELUSER      USIDX
264700200604     C                     MOVE *BLANKS   ACTCDX
264800200604     C                     TIME           MTIME
264900200604     C*
265000200604     C           #ZB0      ENDSR
265100200604     C*****************************************************************
265200200604     C/EJECT
265300200604     C*****************************************************************
265400200604     C**                                                              *
265500200604     C**   ZTNLU1    - RETREIVE/UPDATE TRANS NO. OF LAST UPDATE       *
265600200604     C**                                                              *
265700200604     C**   CALLS     - NONE                                           *
265800200604     C**                                                              *
265900200604     C**   CALLED BY - #BB , #CB                                      *
266000200604     C**                                                              *
266100200604     C*****************************************************************
266200200604     C*
266300200604     C           ZTNLU1    BEGSR
266400200604     C*
266500200604     C           *NAMVAR   DEFN MNATN     DNATN
266600200604     C           *LOCK     IN   DNATN
266700200604     C                     Z-ADDFNATN     WWDSTN
266800200604     C                     Z-ADDFNATN     WWNATN
266900200604     C                     ADD  1         FNATN
267000200604     C                     OUT  DNATN
267100200604     C*
267200200604     C                     ENDSR
267300200604     C*****************************************************************
267400200604     C/EJECT
267500200604     C*****************************************************************
267600200604     C**                                                              *
267700200604     C**   ZASNMS    - SEND MESSAGE TO PROGRAM'S MESSAGE QUEUE        *
267800200604     C**                                                              *
267900200604     C**   CALLS     - NONE                                           *
268000200604     C**                                                              *
268100200604     C**   CALLED BY - #BA , #BAA , #BB , #CA , #CB                   *
268200200604     C**                                                              *
268300200604     C*****************************************************************
268400200604     C*
268500200604     C           ZASNMS    BEGSR
268600200604     C*
268700200604     C                     CALL 'Y2SNMGC'
268800200604     C                     PARM           ZAPGM  10
268900200604     C                     PARM           ZAPGRL  5
269000200604     C                     PARM           ZAMSID  7
269100200604     C                     PARM           ZAMSGF 10
269200200604     C                     PARM           ZAMSDA132
269300200604     C                     PARM           ZAMSTP  7
269400200604     C*
269500200604     C                     ENDSR
269600200604     C*****************************************************************
269700200604     C/EJECT
269800200604     C*****************************************************************
269900200604     C**                                                              *
270000200604     C**   *PSSR       - PROGRAM ERROR HANDLING ROUTINE               *
270100200604     C**                                                              *
270200200604     C**   CALLS       - NONE                                         *
270300200604     C**                                                              *
270400200604     C**   CALLED BY   - #CB                                          *
270500200604     C**                                                              *
270600200604     C*****************************************************************
270700200604     C           *PSSR     BEGSR
270800200604     C*
270900200604     C                     DUMP
271000200604     C*
271100200604     C                     ROLBK
271200200604     C*
271300200604     C                     MOVE '1'       *INLR
271400200604     C*
271500200604     C                     RETRN
271600200604     C*
271700200604     C                     ENDSR
271800200604     C*****************************************************************
271900200604     C/EJECT
272000200604     O*****************************************************************
272100200604     O*
272200200604     O*****RELEASE*THE*RECORD*FROM*SCCICFPD                               S01464
272300200604     O**   RELEASE THE RECORD FROM SCCICFPD                               S01464
272400200604     O*
272500200604     O*SCCICFP0E                SCCICF                                    S01464
272600200604     OSECICFP0E                SCCICF                                     S01464
272700200604     O*****************************************************************
272800200604     O/EJECT
272900200604**  CPY@
273000200604(c) Finastra International Limited 2001
