000100200529     H
000200200529      *****************************************************************
000300200529/*STD *  RPGBASE                                                      *
000400200529/*EXI *  TEXT('Midas SE Settlement authorisation')                    *
000500200529/*OVRF*: OVRDBF FILE(SEOCFSXX) TOFILE(SEOCFSPD) SHARE(*NO)             : *S01464
000600200529/*OVRF*: OVRDBF FILE(SESCFAXX) TOFILE(SESCFAPD) SHARE(*NO)             : *S01464
000700200529     F********************************************************************
000800200529     F*                                                                  *
000900200529     F*       Midas  SAFE CUSTODY FEES MODULE                            *
001000200529     F*                                                                  *
001100200529     F*       SE6050 - SC FEE SETTLEMENT AUTHORIZATION                   *
001200200529     F*                                                                  *
001300200529     F**      FUNCTION:  This program, in amend mode, displays a list of *
001400200529     F**      I/C        outstanding custody fee settlements and allows  *
001500200529     F**                 the user to authorise, amend, delete as re-     *
001600200529     F**                 quired.  In insert mode, settlements are genera-*
001700200529     F**                 ted out of any accrued fees for a customer.     *
001800200529     F**                                                                 *
001900200529     F**      CALLED BY: SEC02 - Input Cycle Processing                  *
002000200529     F**                                                                 *
002100200529      *  (c) Finastra International Limited 2001                      *
002200200529     F*                                                               *
002300200604     F*  Last Amend No. 253084             Date 22May20               *
002400200604     F*  Prev Amend No. 252596             Date 22May20               *
002500200604     F*                 252447             Date 22May20               *
002600200604      *                 MD046248           Date 27Oct17               *
002700200529      *                 CER059             Date 19Jul10               *
002800200529      *                 CER043             Date 19May08               *
002900200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
003000200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
003100200529      * Midas Plus 1.4 Base ------------------------------------------*
003200200529      * Midas Plus 1.3 ----------- Base ------------------------------*
003300200529      *                 CSD031             Date 10Apr06               *
003400200529      *                 CSD027             Date 09Dec05               *
003500200529      *                 CSW037A            Date 02May05               *
003600200529      *                 CSD025             Date 11Jan05               *
003700200529      *                 CSW037             Date 15Dec04               *
003800200529      *                 CSW036             Date 15Dec04               *
003900200529      *                 CLE025             Date 20Oct03               *
004000200529      *                 CGL029             Date 01Sep03               *
004100200529      * Midas Release 4 --------------- Base -------------------------*
004200200529      * Midas DBA 3.03 -----------------------------------------------*
004300200529      *                 174057             Date 03May00               *
004400200529      * Midas DBA 3.02 -----------------------------------------------*
004500200529      *                 CPB001             Date 13Aug99               *
004600200529      * Midas DBA 3.00 ---------------- Base -------------------------*
004700200529     F*                 065025             DATE 02MAY96                  *
004800200529     F*                 049067             DATE 01MAY96                  *
004900200529     F*                 045532             DATE 01MAY96                  *
005000200529     F*                 096749             DATE 22APR96                  *
005100200529     F*                 092108             DATE 22AUG95                  *
005200200529     F*                 091522             DATE 14AUG95                  *
005300200529     F*                 S01464             DATE 04APR94                  *
005400200529     F*                 44139              DATE 23SEP92                  *
005500200529     F*                    S01355             DATE 14DEC92               *
005600200529     F*                    48202              DATE 07DEC92               *
005700200529     F*                    48200      GB      DATE 07DEC92               *
005800200529     F*                    47719              DATE 24NOV92               *
005900200529     F*                    R0192              DATE 20FEB91               *
006000200529     F*                                                                  *
006100200529     F*------------------------------------------------------------------*
006200200529     F*                                                                  *
006300200529      *  253084 - Unprotect action code for possible correction.      *
006400200529      *  252596 - Error in validating S1ACCV as numeric because ZALIGN*
006500200529      *           caters for 16-digit(with decimal point) numbers     *
006600200529      *           only.  Change the validation of S1ACCV if numeric.  *
006700200529      *  252447 - Subfile error problem.  Fix is to reverse fix 174057*
006800200529      *           Applied fix 249198.                                 *
006900200529      *  MD046248 - Finastra Rebranding                               *
007000200529      *  CER059 - German Feature Upgrade to Delhi                     *
007100200529      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
007200200529      *           (Recompile)                                            *
007300200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
007400200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
007500200529      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
007600200529      *  CSD025 - Customer De-Activation                              *
007700200529      *  CSW037 - Additional Field Data on MT300/MT320                *
007800200529      *  CSW036 - Dual SWIFT BIC held on Client Details               *
007900200529      *  CLE025 - Credit Lines (Recompile)                            *
008000200529      *  CGL029 - Increase Account Code to 10 digits                  *
008100200529      *  174057 - Program exits from enquiry when roll-up is pressed for *
008200200529      *           more screens. Should not limit loading to one screen.  *
008300200529     F*  CPB001 - 'Private Banking' Module                               *
008400200529     F*  065025 - SETTLEMENT DATE MUST BE AMENDABLE.                     *
008500200529     F*           (REMOVE PART OF 049067).                               *
008600200529     F*  049067 - NEED TO KEY SETTLEMENTS FILE WITH DATE AS POSSIBLE     *
008700200529     F*           TO HAVE TWO SETTLEMENTS FOR A CUSTOMER/PORTFOLIO       *
008800200529     F*           BUT WITH DIFFERENT VALUE DATES - THEREFORE R0192       *
008900200529     F*           REMOVED AND CORRECTED.                                 *
009000200529     F*  045532 - ERROR MESSAGE 'SE05015' DISPLAYED ON INSERTIONS        *
009100200529     F*           EVENT THOUGH SETTLEMENT HAS BEEN DELETED.              *
009200200529     F*           RE-USE DELETED SETTLEMEMT IF INSERTING NEW             *
009300200529     F*           SETTLEMENT FOR CUSTOMER/PORTFOLIO.                     *
009400200529     F*  096749 - AFTER ROLLUP, ONLY ONE RECORD WAS DISPLAYED DUE TO     *
009500200529     F*           END OF SUBFILE INDICATOR NOT RESET TO 0 WHEN RECORDS   *
009600200529     F*           FOUND AND WRONG COUNTER CONSIDERATION (7 RECORDS BY    *
009700200529     F*           SCREEN)                                                *
009800200529     F*  092108 - When a retail account number is used as settlement  *
009900200529     F*           account, settlement ccy and settlement branch must  *
010000200529     F*           be the same as the ccy and branch of the account.   *
010100200529     F*  091522 - Safe Custody Fees - Private Banking (CSE001)        *
010200200529     F*    S01464 - SAFE CUSTODY FEES                                    *
010300200529     F*    44139  - Fixes to ensure that manual insert of                *
010400200529     F*             settlements work                                     *
010500200529     F*    S01355 - RELEASE 3 INCORPORATION
010600200529     F*    48202  - IN INSERT MODE IF 'FEE ACCRUED' + 'OUTSTANDING
010700200529     F*        ADJUSTMENTS' *LT MINIMUM COMMISSION FOR PERIOD SET        *
010800200529     F*        ACTUAL FEE TO MINIMUM COMMISSION                          *
010900200529     F*     48200   -  SUPPRESS SUBR FOR CONVERSION OF AN AMOUNT      *
011000200529     F*                IN ANOTHER CURRENCY USING THE KONVENTIONKURSE  *
011100200529     F*                EXCHANGE RATE (SWISS)                         *
011200200529     F*    47719  - CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES
011300200529     F*       R0192  - Missing portfolio when you press roll up.         *
011400200529     F*              - Do not show the deleted portfolio customer.       *
011500200529     F*                                                                  *
011600200529     F********************************************************************
011700200529     F*  C R E A T I O N     P A R A M E T E R S                         *
011800200529     F*                                                                  *
011900200529     F***OVRDBF*FILE(SCOCFSXX)*TOFILE(SCOCFSPD)*SHARE(*NO)             : *S01464
012000200529     F***OVRDBF*FILE(SCSCFAXX)*TOFILE(SCSCFAPD)*SHARE(*NO)             : *S01464
012100200529     F*                                                                  *
012200200529     F********************************************************************
012300200529     F/EJECT
012400200529     F********************************************************************
012500200529     F*
012600200529     F*       FILE DEFINITIONS
012700200529     F*      ------------------
012800200529     F*
012900200529     F* Bank Details File (PREFIX - BJ).
013000200529     F*
013100200529     F***SDBANKPDIF**E********************DISK*********KINFSR**PSSR       S01464
013200200529     F********                                                            S01464
013300200529     F**Portfolio*Customer*Definitions*File.                              S01464
013400200529     F********                                                            S01464
013500200529     F***SDPLCSPDIF**E***********K********DISK*********KINFSR**PSSR       S01464
013600200529     FSDPLCSL0IF  E           K        DISK         KINFSR *PSSR          091522
013700200529     F** Portfolio Customer Definitions File.                             091522
013800200529     F*
013900200529     F* Safe Custody ICD.
014000200529     F*
014100200529     F***SCICDPPDIF**E***********K********DISK*********KINFSR**PSSR       S01464
014200200529     F********                                                            S01464
014300200529     F**Portfolio*Management*ICD.                                         S01464
014400200529     F********                                                            S01464
014500200529     F***SDPORTPDIF**E***********K********DISK*********KINFSR**PSSR       S01464
014600200529     F*
014700200529     F* Outstanding Custody Fee Settlements.
014800200529     F*
014900200529     F***SCOCFSXXIF**E***********K********DISK*********KINFSR**PSSR       S01464
015000200529     FSEOCFSXXIF  E           K        DISK         KINFSR *PSSR          S01464
015100200529     F*
015200200529     F* Safe Custody Fees Accrued File.
015300200529     F*
015400200529     F***SCSCFAXXIF**E***********K********DISK*********KINFSR**PSSR       S01464
015500200529     FSESCFAXXIF  E           K        DISK         KINFSR *PSSR          S01464
015600200529     F***********                                                         S01464
015700200529     F**Customer*master*File*(number*sequence).                           S01464
015800200529     F***********                                                         S01464
015900200529     F***SDCUSTL5IF**E***********K********DISK*********KINFSR**PSSR       S01464
016000200529     F***********                                                         S01464
016100200529     F**Customer*master*File*(shortname*sequence).                        S01464
016200200529     F***********                                                         S01464
016300200529     F***SDCUSTL6IF**E***********K********DISK*********KINFSR**PSSR       S01464
016400200529     F*
016500200529     F**Currency*Details*extension*File.                                  S01464
016600200529     F*******                                                             S01464
016700200529     F***SDCURRJ0IF**E***********K********DISK*********KINFSR**PSSR       S01464
016800200529     F*
016900200529     FSDCURRL0IF  E           K        DISK                                48200
017000200529     F                                              KINFSR *PSSR           48200
017100200529     F* Customer Account Details.
017200200529     F*
017300200529     FACCNT   IF  E           K        DISK         KINFSR *PSSR
017400200529     F*
017500200529     F* Customer Account Number details.
017600200529     F*
017700200529     FACNUM   IF  E           K        DISK         KINFSR *PSSR
017800200529     F            ACCNTABF                          KRENAMEACCNTAB2
017900200529     F*                                                                   S01464
018000200529     F* SD customer fees detail                                           S01464
018100200529     F*                                                                   S01464
018200200529     FSDCFCDL0IF  E           K        DISK         KINFSR *PSSR          S01464
018300200529     F*
018400200529     F**Portfolio*Definitions*File.                                       S01464
018500200529     F*********                                                           S01464
018600200529     F*PMPORTLLIF**E           K        DISK         KINFSR *PSSR         48202
018700200529     F***PMPORTPPIF**E***********K********DISK*********KINFSR**PSSR  48202S01464
018800200529     FPMPORTPDIF  E           K        DISK         KINFSR *PSSR          091522
018900200529     F** Portfolio Definitions File.                                      091522
019000200529     F*                                                                   48202
019100200529     F**   CUSTODY FEE GROUPS DEFINITION          PREFIX - SB             48202
019200200529     F***SCCFGRPDIF**E***********K********DISK*********KINFSR**PSSR  48202
019300200529     FSECFGRPDIF  E           K        DISK         KINFSR *PSSR          S01464
019400200529     F*
019500200529     F* Security Trading Clients File.
019600200529     F*
019700200529     FSDSECSL1IF  E           K        DISK         KINFSR *PSSR
019800200529     F*
019900200529     F* Safe Custody Fees Accrued.
020000200529     F*
020100200529     F***SCSCFAPDUF**E***********K********DISK*********KINFSR**PSSR       S01464
020200200529     FSESCFAPDUF  E           K        DISK         KINFSR *PSSR          S01464
020300200529     F                                              KCOMIT
020400200529     F************SCSCFAP0                          KRENAMESCSCFAP1       S01464
020500200529     F            SESCFAP0                          KRENAMESESCFAP1       S01464
020600200529     F*
020700200529     F* Outstanding Custody Fee Settlements.
020800200529     F*
020900200529     F***SCOCFSPDUF**E***********K********DISK*********KINFSR**PSSR A     S01464
021000200529     FSEOCFSPDUF  E           K        DISK         KINFSR *PSSR A        S01464
021100200529     F                                              KCOMIT
021200200529     F************SCOCFSP0                          KRENAMESCOCFSP1       S01464
021300200529     F            SEOCFSP0                          KRENAMESEOCFSP1       S01464
021400200529     F*
021500200529     F* Screen Format.
021600200529     F*
021700200529     F***SE6050DDCF**E********************WORKSTN******KINFSR**PSSR       S01464
021800200529     FSE6050DFCF  E                    WORKSTN      KINFSR *PSSR          S01464
021900200529     F                                        S1RRN KSFILE SE6050S1
022000200529     F*
022100200529     F/COPY WNCPYSRC,SE6050F001
022200200529     F********************************************************************
022300200529     F/EJECT
022400200529     F********************************************************************
022500200529     F*                                                                  *
022600200529     F*  ID F  C  H  L    FUNCTION OF INDICATORS                         *
022700200529     F*                  ------------------------                        *
022800200529     F*                                                                  *
022900200529     F*        03 - EXIT                                                 *
023000200529     F*                                                                  *
023100200529     F*        26 - SFLEND    }- MESSAGE SUBFILE                         *
023200200529     F*                                                                  *
023300200529     F*        27 - ROLLUP    }                                          *
023400200529     F*        31 - SFLCLR    }- REVIEW FROM SUBFILE                     *
023500200529     F*        32 - SFLDSP    }                                          *
023600200529     F*        34 - SFLDSPCTL }                                          *
023700200529     F*        35 - SFLEND    }                                          *
023800200529     F*        36 - SFLNXTCHG }                                          *
023900200529     F*                                                                  *
024000200529     F*        38 - DISPLAY OF (X,D) OR (D) ON ACTION FIELD              *
024100200529     F*                                                                  *
024200200529     F*********40 - READ SCICDPPD                                        *S01464
024300200529     F*        41 - READ SCPORTPD                                        *
024400200529     F*        42 - ENABLE CMD 9                                         *
024500200529     F*        43 - ENABLE CMD 12                                        *
024600200529     F*        45 - INSERT MODE                                          *
024700200529     F*        47 - CHAINING TO ACNUM                                    *
024800200529     F*        48 - CHAINING TO ACCNT                                    *
024900200529     F*        49 - REVERSE IMAGE CUSTOMER FIELD                         *
025000200529     F*                                                                  *
025100200529     F*        50 - MULTI-BRANCHING INDICATOR                            *S01464
025200200529     F*        58 - CONTROL OUTPUT OF PORTFOLIO DETAILS                  *
025300200529     F*        59 - READING SUBFILE                                      *
025400200529     F*                                                                  *
025500200529     F*        60 - 62 CONTROL OUTPUT OF CORRECT FOOTINGS                *
025600200529     F*        63 - PROTECT REVIEW FROM FIELDS                           *
025700200529     F*        64 - PROTECT SUBFILE FIELDS                               *
025800200529     F*        65 - UPDATE SUCCESSFUL                                    *
025900200529     F*        66 - RECORD CHANGED AND VALID ON SUBFILE                  *
026000200529     F*        67 - CONTROL OUTPUT OF CORRECT FOOTINGS                   *
026100200529     F*        68 - NON-DISPLAY OF CONFIRM OPTION                        *
026200200529     F*                                                                  *
026300200529     F*        70 - READING SDBANKPD                                     *
026400200529     F*        71 - READING SEOCFSXX                                     *
026500200529     F*        75 - READING SUBFILE                                      *
026600200529     F*        73 - CHAINING TO SDCURRJ0                                 *
026700200529     F*        77 - GENERAL ERROR INDICATOR                              *
026800200529     F*        78 - READ CHANGED RECORD ON SUBFILE                       *
026900200529     F*                                                                  *
027000200529     F*        81 - 88 REVERSE IMAGE INDICATORS                          *
027100200529     F*                                                                  *
027200200529     F********************************************************************
027300200529     F/EJECT
027400200529     E********************************************************************
027500200529     E*
027600200529     E*    ARRAY FOR COPYRIGHT
027700200529     E                    CPY@    1   1 80
027800200529     E*
027900200529     E                    POWER   1   7  7 3             POWER ARRAY
028000200529     E*
028100200529     E                    ZA1        16  1               ZALIGN SR. ARRAY
028200200529     E                    ZA2        16  1               ZALIGN SR. ARRAY
028300200529     E*
028400200529     E                    ZS1        15  1 0             ZSEDIT SR. ARRAY
028500200529     E                    ZS2        21  1               ZSEDIT SR. ARRAY
028600200529     E*
028700200529     E                    ZYDY    4   4  4 0             ZDATE1 YEAR
028800200529     E                    ZMDY   13  13  3 0             ZDATE1 MONTH
028900200529     E*
029000200529     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
029100200529     E/COPY WNCPYSRC,SE6050E001
029200200529     E********************************************************************
029300200529     E*
029400200529     E/EJECT
029500200529     I********************************************************************
029600200529     I*
029700200529     I* DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
029800200529     I*
029900200529     ICPYR@$      DS
030000200529     I                                        1  80 CPY@
030100200529     I                                        1  20 CPY@$$
030200200529     I*
030300200529     I* PROGRAM STATUS DATA STRUCTURE
030400200529     I*
030500200529     IPSDS       SDS
030600200529     I                                      244 253 DDWID
030700200529     I                                      254 263 USER
030800200529     I*
030900200529     I* FILE INFORMATION DATA STRUCTURE
031000200529     I*
031100200529     I**FIL1DS      DS
031200200529     I**                                   *STATUS  STATUS
031300200529     I*
031400200529     I* FILE INFORMATION DATA STRUCTURE
031500200529     I*
031600200529     IFIL2DS      DS
031700200529     I                                    B 397 4000WWHRRN
031800200529     I*                                                                   S01464
031900200529     IRUNDT       DS                             13                       S01464
032000200529     I** Rundate data area                                                S01464
032100200529     I                                       13  13 MBIN                  S01464
032200200529     I*
032300200529     I* LOCAL DATA AREA FOR DATA BASE ERRORS
032400200529     I*
032500200529     I*LDA        UDS                            256                      S01464
032600200529     ILDA         DS                            256                       S01464
032700200529     I***                                   132 141 DBFILE                S01464
032800200529     I                                      134 141 DBFILE                S01464
032900200529     I                                      142 170 DBKEY
033000200529     I                                      171 180 DBPGM
033100200529     I                                      181 1830DBASE
033200200529     I*                                                                   S01464
033300200529     I** Data Area of menu user                                           S01464
033400200529     IZMUSER      DS                             17                       S01464
033500200529     I                                       11  13 USRBCH                S01464
033600200529     I*
033700200529     I* DATA AREA FOR UPDATE PROCESSING
033800200529     I*
033900200529     IDNATN       DS                              5
034000200529     I                                        1   50FNATN
034100200529     I*
034200200529     I**   DATA STRUCTURE TO PROVIDE TEXT ON COMIT ENTRY IN JOURNAL
034300200529     I*
034400200529     ICMTTXT      DS                             56
034500200529     I                                        1   50WWNATN
034600200529     I                                        6   7 MDID
034700200529     I                                        8  17 PGMN
034800200529     I                                       18  27 WSIDX
034900200529     I                                       28  330MTIME
035000200529     I                                       34  34 ACTCDX
035100200529     I                                       35  42 USIDX
035200200529     I**********                             43  480SECNUM                                    CSD027
035300200529     I                                       43  48 SECNUM                                    CSD027
035400200529     I                                       49  52 S1PORT
035500200529     I*
035600200529     I            DS
035700200529     I                                        1  150WORK15
035800200529     I                                        1  150ZS1
035900200529     I*
036000200529     I* DAY, MONTH & YEAR OF LAST UPDATE
036100200529     I*
036200200529     I            DS
036300200529     I                                        1   7 WKDAT
036400200529     I                                        1   20WKDAY
036500200529     I                                        3   5 WKMTH
036600200529     I                                        6   70WKYR
036700200529     I*
036800200529     I* Customer number Shortname data Structure.
036900200529     I*
037000200529     I            DS
037100200529     I                                        1  10 S1CUST
037200200529     I                                        1   6 WKCUSA
037300200529     I                                        7  10 WKCUSB
037400200529     I*
037500200529     I* Settlement Account data Structure.
037600200529     I*
037700200529     I            DS
037800200529     I**********                              1  12 S1ACCV                                    CGL029
037900200529     I**********                              1  10 WKACC1                                    CGL029
038000200529     I**********                             11  12 WKACC2                                    CGL029
038100200529     I                                        1  18 S1ACCV                                    CGL029
038200200529     I                                        1  16 WKACC1                                    CGL029
038300200529     I                                       17  18 WKACC2                                    CGL029
038400200529     I**********                              1   60WKAKCU                                    CSD027
038500200529     I                                        1   6 WKAKCU                                    CSD027
038600200529     I**********                              7  100WKAKCD                                    CGL029
038700200529     I**********                             11  120WKAKSQ                                    CGL029
038800200529     I                                        7  160WKAKCD                                    CGL029
038900200529     I                                       17  180WKAKSQ                                    CGL029
039000200529     I/COPY WNCPYSRC,SE6050I001
039100200529     I*                                                                   S01464
039200200529     ISDBANK    E DSSDBANKPD                                              S01464
039300200529     I** Bank details                                                     S01464
039400200529     ISDCURR    E DSSDCURRPD                                              S01464
039500200529     I** Currency Details                                                 S01464
039600200529     ISDCUST    E DSSDCUSTPD                                              S01464
039700200529     I** Customer Details                                                 S01464
039800200529     ISDBRCH    E DSSDBRCHPD                                              S01464
039900200529     I              QQDFAC                          QQDFA1                                    CGL029
040000200529     I** Customer Branch Details                                          S01464
040100200529     ISDSTRD    E DSSDSTRDPD                                              S01464
040200200529     I** Securities Trading ICD                                           S01464
040300200529     ISDSCFE    E DSSDSCFEPD                                              S01464
040400200529     I** Safe Custody ICD                                                 S01464
040500200529     I**                                                                  S01194
040600200529     ISDMMOD    E DSSDMMODPD                                              091522
040700200529     I** Midas Modules File                                               091522
040800200529     I*                                                                   091522
040900200529     ISDPORT    E DSSDPORTPD                                              091522
041000200529     I** Portfolio Management ICD                                         091522
041100200529     I*                                                                   091522
041200200529     IDSFDY     E DSDSFDY                                                 S01194
041300200529     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01194
041400200529     I**                                                                  S01464
041500200529     IDSSDY     E DSDSSDY                                                 S01464
041600200529     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01464
041700200529     I*
041800200529     I********************************************************************
041900200529     C*
042000200529     C* KEY LISTS AND PARAMETER LISTS.
042100200529     C* ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
042200200529     C*
042300200529     C* Key List for File SEOCFSPD.
042400200529     C*
042500200529     C           FSPDKY    KLIST
042600200529     C                     KFLD           SEBRCA                          S01464
042700200529     C                     KFLD           SECNUM
042800200529     C                     KFLD           SEPTFR
042900200529     C                     KFLD           SESEVD                          049067
043000200529     C*
043100200529     C* Key List for File SEOCFSXX.
043200200529     C*
043300200529     C           FAXKEY    KLIST
043400200529     C***********          KFLD           WKBRCA  3                S01464 091522
043500200529     C                     KFLD           S1BRCH                          091522
043600200529     C**********           KFLD           WKCNUM  60                                          CSD027
043700200529     C                     KFLD           WKCNUM  6                                           CSD027
043800200529     C                     KFLD           WKPTFR  4
043900200529     C***********                                                         S01464
044000200529     C**Key*List*for*File*PMPORTLL.                                       S01464
044100200529     C***********                                                         S01464
044200200529     C***********PORTKY    KLIST                                          S01464
044300200529     C***********          KFLD           PNCNUM                          S01464
044400200529     C***********          KFLD           PNPTFR                          S01464
044500200529     C*                                                                   091522
044600200529     C** Key List for File PMPORTPD.                                      091522
044700200529     C*                                                                   091522
044800200529     C           PORTKY    KLIST                                          091522
044900200529     C                     KFLD           PNCNUM                          091522
045000200529     C                     KFLD           PNPTFR                          091522
045100200529     C*
045200200529     C* Key List for File ACCNT
045300200529     C*
045400200529     C           ACNTKY    KLIST
045500200529     C                     KFLD           WKAKCU
045600200529     C                     KFLD           S1CURR
045700200529     C                     KFLD           WKAKCD
045800200529     C                     KFLD           WKAKSQ
045900200529     C*                                                                   S01464
046000200529     C           ACNTK2    KLIST                                          S01464
046100200529     C                     KFLD           WKAKCU                          S01464
046200200529     C                     KFLD           S1CURR                          S01464
046300200529     C                     KFLD           WKAKCD                          S01464
046400200529     C                     KFLD           WKAKSQ                          S01464
046500200529     C                     KFLD           S1BRCA                          S01464
046600200529     C/EJECT
046700200529     C********************************************************************
046800200529     C*
046900200529     C*               START MAINLINE
047000200529     C*              ----------------
047100200529     C*
047200200529     C* Initial Processing.
047300200529     C*
047400200529     C                     EXSR #A
047500200529     C*
047600200529     C* Initialize Subfile.
047700200529     C*
047800200529     C                     EXSR #B
047900200529     C*
048000200529     C* Load first page of subfile.
048100200529     C*
048200200529     C                     EXSR #YA
048300200529     C*
048400200529     C* Output Screen.
048500200529     C*
048600200529     C                     EXSR #YB
048700200529     C*
048800200529     C* Process Screen while not CMD 3 selected.
048900200529     C*
049000200529     C           *INKC     DOWEQ'0'
049100200529     C*
049200200529     C* Process according to Command Key selected.
049300200529     C*
049400200529     C           *IN27     CASEQ'1'       #YA              Roll-up
049500200529     C                     CAS            #C               Enter
049600200529     C                     END
049700200529     C*
049800200529     C* If Confirm screen required allow confirm option to be          .
049900200529     C* displayed and Subfile protected.                               .
050000200529     C*
050100200529     C           *IN45     IFEQ '1'
050200200529     C*
050300200529     C           WKINSA    IFNE 'Y'
050400200529     C           WKINER    ANDEQ'N'
050500200529     C                     EXSR #G
050600200529     C                     END
050700200529     C*
050800200529     C           WKLDCF    IFEQ 'Y'
050900200529     C                     EXSR #D
051000200529     C                     END
051100200529     C*
051200200529     C                     EXSR #YB
051300200529     C*
051400200529     C                     ELSE
051500200529     C*
051600200529     C           WKLDCF    IFEQ 'Y'
051700200529     C                     EXSR #D
051800200529     C                     END
051900200529     C*
052000200529     C                     EXSR #YB
052100200529     C                     END
052200200529     C*
052300200529     C                     END
052400200529     C*
052500200529     C* End program.
052600200529     C                     MOVE '1'       *INLR
052700200529     C                     RETRN
052800200529     C*
052900200529     C********************************************************************
053000200529     C/EJECT
053100200529     C********************************************************************
053200200529     C*                                                                  *
053300200529     C*           INDEX TO SUBROUTINES                                   *
053400200529     C*          ----------------------                                  *
053500200529     C*                                                                  *
053600200529     C*    1.  #A     - INITIALISATION                                   *
053700200529     C*    2.  #B     - INITIALISATION OF SUBFILE                        *
053800200529     C*    3.  #C     - CONTROL OF VALIDATION                            *
053900200529     C*    4.  #CA    - VALIDATION OF CONFIRM SCREEN                     *
054000200529     C*    5.  #CB    - VALIDATION OF MAIN CHANGE SUBFILE SCREEN         *
054100200529     C*    6.  #CBA   - FIELD VALIDATION OF SUBFILE.                     *
054200200529     C*    7.  #CBB   - VALIDATION OF REVIEW FROM FIELDS                 *
054300200529     C*    8.  #D     - SETUP CONFIRM SCREEN                             *
054400200529     C*    9.  #E     - UPDATE IN CHANGE MODE                            *
054500200529     C*   10.  #F     - SETUP UNPROTECTED SUBFILE AFTER CONFIRM          *
054600200529     C*   11.  #G     - SETUP INSERT SCREEN - INSERT MODE                *
054700200529     C*   12.  #CE    - VALIDATION OF INSERT SCREEN - INSERT MODE        *
054800200529     C*   13.  #CD    - VALIDATION OF INSERT SCREEN - AMEND MODE         *
054900200529     C*   14.  #CC    - VALIDATION OF INSERT SCREEN - CONFIRM MODE       *
055000200529     C*   15.  #K     - UPDATE IN INSERT MODE                            *
055100200529     C*   16.  #H     - CREATE SUBFILE IN INSERT MODE                    *
055200200529     C*   17.  #I     - CREATE SUBFILE RECORD IN INSERT MODE             *
055300200529     C*   18.  #YA    - CREATE SUBFILE                                   *
055400200529     C*   19.  #YAA   - CREATE SUBFILE RECORD                            *
055500200529     C*   20.  #YB    - DISPLAY SCREENS                                  *
055600200529     C*   22.  #PSSR  - PROGRAM ERROR HANDLING ROUTINE                   *
055700200529     C*                                                                  *
055800200529     C********************************************************************
055900200529     C*
056000200529     C/EJECT
056100200529     C********************************************************************
056200200529     C*                                                                  *
056300200529     C*  #A        - INITIALISATION                                      *
056400200529     C*                                                                  *
056500200529     C*  CALLS     - NONE                                                *
056600200529     C*                                                                  *
056700200529     C*  CALLED BY - MAINLINE                                            *
056800200529     C*                                                                  *
056900200529     C********************************************************************
057000200529     C           #A        BEGSR
057100200529     C*
057200200529     C* INITIALISE DB ERROR FIELDS ETC, AND STORE PROGRAM NAME FOR
057300200529     C* DB ERROR FIELD.
057400200529     C*
057500200529     C** Prepare LDA                                                      S01464
057600200529     C*                                                                   S01464
057700200529     C           *NAMVAR   DEFN           LDA                             S01464
057800200529     C                     MOVE *BLANKS   DBFILE
057900200529     C                     MOVE *BLANKS   DBKEY
058000200529     C                     MOVE *BLANKS   DBASE
058100200529     C                     MOVEL'SE6050'  DBPGM
058200200529     C*
058300200529     C                     MOVE *BLANKS   WWTPGQ 10
058400200529     C                     MOVEL'*'       WWTPGQ
058500200529     C                     MOVE *BLANKS   WWPGQR  5
058600200529     C                     MOVEL'*PRV'    WWPGQR
058700200529     C*
058800200529     C                     MOVE *BLANKS   ZAMSGF
058900200529     C                     MOVEL'SEUSRMSG'ZAMSGF
059000200529     C*
059100200529     C* Initialise indicator responsible for controlling validation of
059200200529     C* Confirm screen.
059300200529     C*
059400200529     C                     MOVE 'N'       WKFSRN  1
059500200529     C*
059600200529     C* Initialise error indicator.
059700200529     C*
059800200529     C                     MOVE *BLANKS   WKEROR  1
059900200529     C                     MOVE *BLANKS   WWEROR  1                       S01464
060000200529     C*
060100200529     C* Initialise indicators.
060200200529     C*
060300200529     C                     SETOF                     2749
060400200529     C*
060500200529     C* Set off insert mode indicator.
060600200529     C*
060700200529     C                     SETOF                     45
060800200529     C*
060900200529     C* Set off 'non-display of subfile header fields' indicator.
061000200529     C*
061100200529     C                     SETOF                     46
061200200529     C*
061300200529     C                     SETOF                     28
061400200529     C*
061500200529     C* Set up Screen initial screen Review from fields.
061600200529     C*
061700200529     C                     MOVE *BLANKS   S1CUST
061800200529     C                     MOVE *BLANKS   S1PORT
061900200529     C                     MOVE *BLANKS   S1BRCH                          S01464
062000200529      *                                                                                       252596
062100200529      ** Constant digits variable                                                             252596
062200200529      *                                                                                       252596
062300200529     C                     MOVEL'01234567'DIGITS 10                                           252596
062400200529     C                     MOVE '89'      DIGITS 10                                           252596
062500200529     C*
062600200529     C* Initialize Confirm field.
062700200529     C*
062800200529     C                     MOVE *BLANKS   S1CNFM
062900200529     C*
063000200529     C* Initialize 'Load Confirm Screen' work indicator.
063100200529     C*
063200200529     C                     MOVE 'N'       WKLDCF  1
063300200529     C*
063400200529     C* Initialize 'Error on Insert screen -insert mode' indicator.
063500200529     C*
063600200529     C                     MOVE 'N'       WKINER  1
063700200529     C*
063800200529     C* Initialize 'Insert screen Amend' work indicator.
063900200529     C*
064000200529     C                     MOVE 'N'       WKINSA  1
064100200529     C*
064200200529     C* Access ICD File SDBANKPD.
064300200529     C*
064400200529     C***********1         SETLLSDBANKPD                                  S01464
064500200529     C***********          READ SDBANKPD                 70               S01464
064600200529     C                     CALL 'AOBANKR0'                                S01464
064700200529     C                     PARM '*DBERR ' @RTCD   7                       S01464
064800200529     C                     PARM '*FIRST ' @OPTN   7                       S01464
064900200529     C           SDBANK    PARM SDBANK    DSSDY                           S01464
065000200529     C*                                                                   S01464
065100200529     C**If*Record*not*found*or*deleted*-*Database*Error.                  S01464
065200200529     C***********                                                         S01464
065300200529     C************IN70     IFEQ '1'                                       S01464
065400200529     C***********BJTYLC    OREQ 'D'                                       S01464
065500200529     C***********          Z-ADD1         DBASE
065600200529     C***********          MOVE *BLANKS   DBFILE           ***************
065700200529     C***********          MOVEL'SDBANKPD'DBFILE           * DBERROR 001 *
065800200529     C***********          MOVE *BLANKS   DBKEY            ***************
065900200529     C***********          MOVE '1'       *INU7
066000200529     C***********          MOVE '1'       *INU8
066100200529     C***********          MOVE '1'       *INLR
066200200529     C***********          RETRN
066300200529     C***********          END
066400200529     C*
066500200529     C**   SET UP DATE FORMAT INDICATOR
066600200529     C*
066700200529     C           BJDFIN    IFEQ 'M'
066800200529     C                     MOVE '1'       *IN98            ON-98
066900200529     C                     ELSE
067000200529     C                     MOVE '0'       *IN98            0FF-98
067100200529     C                     END
067200200529     C*                                                                   091522
067300200529     C** Check if Portfolio Management is ON using access object.         091522
067400200529     C*                                                                   091522
067500200529     C                     CALL 'AOMMODR0'                                091522
067600200529     C                     PARM '*DBERR ' @RTCD                           091522
067700200529     C                     PARM '*FIRST ' @OPTN                           091522
067800200529     C           SDMMOD    PARM SDMMOD    DSFDY                           091522
067900200529     C*                                                                   091522
068000200529     C** If Portfolio Management is ON, access Portfolio Management       091522
068100200529     C** ICD.                                                             091522
068200200529     C*                                                                   091522
068300200529     C           BGPFMG    IFEQ 'Y'                                       091522
068400200529     C*                                                                   091522
068500200529     C                     CALL 'AOPORTR0'                                091522
068600200529     C                     PARM '*DBERR ' @RTCD                           091522
068700200529     C                     PARM '*FIRST ' @OPTN                           091522
068800200529     C           SDPORT    PARM SDPORT    DSFDY                           091522
068900200529     C*                                                                   091522
069000200529     C                     END                                            091522
069100200529     C*                                                                   S01464
069200200529     C**Access*File*SCICDPPD*-*Safe*Custody*ICD*File.                     S01464
069300200529     C* Access File SDSCFEPD - Safe Custody ICD File.                     S01464
069400200529     C*                                                                   S01464
069500200529     C***********          READ SCICDPPD                 40               S01464
069600200529     C                     CALL 'AOSCFER0'                                S01464
069700200529     C                     PARM '*DBERR ' @RTCD   7                       S01464
069800200529     C                     PARM '*FIRST ' @OPTN   7                       S01464
069900200529     C           SDSCFE    PARM SDSCFE    DSSDY                           S01464
070000200529     C*                                                                   S01464
070100200529     C**If*Record*not*found*or*deleted*-*Database*Error.                  S01464
070200200529     C***********                                                         S01464
070300200529     C************IN40     IFEQ '1'                                       S01464
070400200529     C***********          Z-ADD2         DBASE                           S01464
070500200529     C***********          MOVE *BLANKS   DBFILE                          S01464
070600200529     C***********          MOVEL'SCICDPPD'DBFILE           ***************S01464
070700200529     C***********          MOVE *BLANKS   DBKEY            ***************S01464
070800200529     C***********          MOVE '1'       *INU7                           S01464
070900200529     C***********          MOVE '1'       *INU8                           S01464
071000200529     C***********          MOVE '1'       *INLR                           S01464
071100200529     C***********          RETRN                                          S01464
071200200529     C***********          END                                            S01464
071300200529     C*
071400200529     C***********          MOVE SABCGC    S1FCUR                          S01464
071500200529     C                     MOVE FBBCGC    S1FCUR                          S01464
071600200529     C***********                                                         S01464
071700200529     C**Access*File*SDPORTPD*-*Portfolio*Management*File.                 S01464
071800200529     C***********                                                         S01464
071900200529     C***********          READ SDPORTPD                 41               S01464
072000200529     C***********                                                         S01464
072100200529     C**If*Record*not*found*or*deleted*-*Database*Error.                  S01464
072200200529     C***********                                                         S01464
072300200529     C************IN41     IFEQ '1'                                       S01464
072400200529     C***********          Z-ADD3         DBASE                           S01464
072500200529     C***********          MOVE *BLANKS   DBFILE           ***************S01464
072600200529     C***********          MOVEL'SDPORTPD'DBFILE           * DBERROR 003 *S01464
072700200529     C***********          MOVE *BLANKS   DBKEY            ***************S01464
072800200529     C***********          MOVE '1'       *INU7                           S01464
072900200529     C***********          MOVE '1'       *INU8                           S01464
073000200529     C***********          MOVE '1'       *INLR                           S01464
073100200529     C***********          RETRN                                          S01464
073200200529     C***********          END                                            S01464
073300200529     C*                                                                   S01464
073400200529     C* If Fees Per Customer positions Indicator equals 'P' then
073500200529     C* output Portfolio Headings and details and Review from field
073600200529     C* else suppress all the above.
073700200529     C*
073800200529     C***********SACFCP    IFEQ 'P'                                       S01464
073900200529     C           FBCFCP    IFEQ 'P'                                       S01464
074000200529     C                     SETOF                     58
074100200529     C                     ELSE
074200200529     C                     SETON                     58
074300200529     C                     END
074400200529     C*
074500200529     C* If Automatic posting indicator = 'Y' only display 'D' on          S01464
074600200529     C* action column heading.                                            S01464
074700200529     C*                                                                   S01464
074800200529     C***********SAAUPI    IFEQ 'Y'                                       S01464
074900200529     C           FBAUPI    IFEQ 'Y'                                       S01464
075000200529     C                     SETOF                     38
075100200529     C                     ELSE
075200200529     C                     SETON                     38
075300200529     C                     END
075400200529     C*                                                                   S01464
075500200529     C** In the data area RUNDAT                                          S01464
075600200529     C*                                                                   S01464
075700200529     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01464
075800200529     C                     IN   RUNDT                                     S01464
075900200529     C*                                                                   S01464
076000200529     C**   Read in ZMUSER                                                 S01464
076100200529     C*                                                                   S01464
076200200529     C           *NAMVAR   DEFN           ZMUSER                          S01464
076300200529     C                     IN   ZMUSER                                    S01464
076400200529     C*                                                                   S01464
076500200529     C** Test for multibranching                                          S01464
076600200529     C*                                                                   S01464
076700200529     C           MBIN      IFEQ 'Y'                                       S01464
076800200529     C                     MOVE '1'       *IN50                           S01464
076900200529     C                     ELSE                                           S01464
077000200529     C                     MOVE '0'       *IN50                           S01464
077100200529     C                     END                                            S01464
077200200529     C*                                                                   S01464
077300200529     C** SET UP CURRENCY DECIMAL PLACES FROM BANK CHARGING CCY            S01464
077400200529     C*                                                                   S01464
077500200529     C           FBBCGC    CHAINSDCURRL0             80                   S01464
077600200529     C*                                                                   S01464
077700200529     C           *IN80     IFEQ '0'                                       S01464
077800200529     C                     Z-ADDA6NBDP    WWNBDP  10                      S01464
077900200529     C                     END                                            S01464
078000200529     C*
078100200529     C* Set up Work Station ID and Date for screen.
078200200529     C*
078300200529     C                     MOVE BJMRDT    S1DATE
078400200529     C                     MOVE DDWID     S1WSID
078500200529     C*
078600200529     C**   SET UP COMMITMENT TEXT
078700200529     C*
078800200529     C                     MOVEL'SE'      MDID
078900200529     C                     MOVEL'SE6050'  PGMN
079000200529     C                     MOVELDDWID     WSIDX
079100200529     C                     MOVELUSER      USIDX
079200200529     C*
079300200529     C                     MOVE *BLANKS   S1CUST
079400200529     C                     MOVE *BLANKS   S1PORT
079500200529     C                     MOVE *BLANKS   S1BRCH                          S01464
079600200529     C*
079700200529     C* Initialize screen message queue.
079800200529     C*
079900200529     C                     MOVEL'*'       DDPGMQ
080000200529     C                     SETON                     26
080100200529     C*                                                                   S01464
080200200529     C**   ACCESS SECURITIES TRADING ICD.                                 S01464
080300200529     C*                                                                   S01464
080400200529     C                     CALL 'AOSTRDR0'                                S01464
080500200529     C                     PARM '*DBERR ' @RTCD   7                       S01464
080600200529     C                     PARM '*FIRST ' @OPTN   7                       S01464
080700200529     C           SDSTRD    PARM SDSTRD    DSSDY                           S01464
080800200529     C*                                                                   S01464
080900200529     C**   CHECK IF SAFE CUSTODY FEES IS NOT SET ON                       S01464
081000200529     C*                                                                   S01464
081100200529     C           BVCUIN    IFNE 'Y'                                       S01464
081200200529     C*                                                                   S01464
081300200529     C**   SEND MESSAGE TO SCREEN                                         S01464
081400200529     C*                                                                   S01464
081500200529     C                     MOVEL'SE02100' ZAMSID                          S01464
081600200529     C                     EXSR ZASNMS                                    S01464
081700200529     C                     EXFMTSE6050C4                                  S01464
081800200529     C                     MOVE '1'       *INLR                           S01464
081900200529     C                     RETRN                                          S01464
082000200529      *                                                                   S01464
082100200529     C                     END                                            S01464
082200200529     C*
082300200529     C/COPY WNCPYSRC,SE6050C001
082400200529     C                     ENDSR
082500200529     C*
082600200529     C********************************************************************
082700200529     C*
082800200529     C/EJECT
082900200529     C********************************************************************
083000200529     C*                                                                  *
083100200529     C*  #B        - INITIALISATION OF SUBFILE                           *
083200200529     C*                                                                  *
083300200529     C*  CALLS     - NONE                                                *
083400200529     C*                                                                  *
083500200529     C*  CALLED BY - MAINLINE                                            *
083600200529     C*                                                                  *
083700200529     C********************************************************************
083800200529     C*
083900200529     C           #B        BEGSR
084000200529     C*
084100200529     C* Set of Subfile Next Change and Subfile End indicators.
084200200529     C*
084300200529     C                     SETOF                     3536
084400200529     C*
084500200529     C* Set on subfile display indicators.
084600200529     C*
084700200529     C                     SETON                     3234
084800200529     C*
084900200529     C* Set of Protect indicators and error indicator.
085000200529     C*
085100200529     C                     SETOF                     636477
085200200529     C                     SETON                     68
085300200529     C*
085400200529     C* Enable CMD 9.
085500200529     C*
085600200529     C                     SETON                     42
085700200529     C                     SETOF                     43
085800200529     C*
085900200529     C* Display correct footings.
086000200529     C*
086100200529     C                     SETON                     61
086200200529     C                     SETOF                     606267
086300200529     C* Clear Subfile.
086400200529     C                     SETON                     31
086500200529     C                     WRITESE6050C2
086600200529     C                     SETOF                     31
086700200529     C*
086800200529     C* Define and initialize relative record numbers.
086900200529     C*
087000200529     C                     Z-ADD*ZEROS    S1RRN
087100200529     C                     Z-ADD*ZEROS    WKFRRN  30       First RRN
087200200529     C                     Z-ADD*ZEROS    WKLRRN  30       Last RRN
087300200529     C*                                                                   S01464
087400200529     C** Check if authorise to default branch                             S01464
087500200529     C*                                                                   S01464
087600200529     C           *IN50     IFEQ '1'                                       S01464
087700200529     C*                                                                   S01464
087800200529     C           S1BRCH    IFEQ *BLANKS                                   S01464
087900200529     C                     MOVE USRBCH    S1BRCH                          S01464
088000200529     C                     END                                            S01464
088100200529     C*                                                                   S01464
088200200529     C                     CALL 'ZVACTBU'                                 S01464
088300200529     C                     PARM 'A'       @ZACTN  1                       S01464
088400200529     C                     PARM S1BRCH    @BRNCH  3                       S01464
088500200529     C                     PARM           @ERR    10                      S01464
088600200529     C*                                                                   S01464
088700200529     C                     ELSE                                           S01464
088800200529     C                     CALL 'ZVACTU'                                  S01464
088900200529     C                     PARM 'A'       @ZACTN  1                       S01464
089000200529     C                     PARM           @ERR    10                      S01464
089100200529     C                     END                                            S01464
089200200529     C*                                                                   S01464
089300200529     C** If action invalid for user                                       S01464
089400200529     C*                                                                   S01464
089500200529     C           @ERR      IFEQ 1                                         S01464
089600200529     C           @ERR      OREQ 2                                         S01464
089700200529     C                     MOVEL'1'       WKEROR                          S01464
089800200529     C                     MOVEL'1'       WWEROR  1                       S01464
089900200529     C                     MOVE '1'       *IN51                           S01464
090000200529     C                     MOVEL'SE05024' ZAMSID                          S01464
090100200529     C                     EXSR ZASNMS                                    S01464
090200200529     C                     END                                            S01464
090300200529     C*
090400200529     C                     ENDSR
090500200529     C*
090600200529     C/EJECT
090700200529     C********************************************************************
090800200529     C*                                                                  *
090900200529     C*  #YA       - LOAD PAGE OF SUBFILE4                               *
091000200529     C*                                                                  *
091100200529     C*  CALLS     - #YAA                                                *
091200200529     C*                                                                  *
091300200529     C*  CALLED BY - MAINLINE                                            *
091400200529     C*                                                                  *
091500200529     C********************************************************************
091600200529     C*
091700200529     C           #YA       BEGSR
091800200529     C*
091900200529     C* Initialize Counter.
092000200529     C*
092100200529     C***********          Z-ADD1         WCOUNT  20                      S01464
092200200529     C                     Z-ADD0         WCOUNT  20                      S01464
092300200529     C                     MOVE *BLANKS   WKPTFR                          091522
092400200529     C*
092500200529     C* Read First/Next 'non-deleted' Record from File SEOCFSXX.
092600200529     C*
092700200529     C*                                                                   S01464
092800200529     C***********S1BRCH    IFNE *BLANKS                            S01464 091522
092900200529     C***********S1CUST    ANDEQ*BLANKS                            S01464 091522
093000200529     C************IN27     ANDEQ'0'                                S01464 091522
093100200529     C***********          Z-ADD0         WKLRRN                   S01464 091522
093200200529     C***********          Z-ADD0         S1RRN                    S01464 091522
093300200529     C***********S1RRN     ADD  1         WKFRRN                   S01464 091522
093400200529     C***********          MOVE S1BRCH    WKBRCA                   S01464 091522
093500200529     C***********          MOVE *LOVAL    WKCNUM                   S01464 091522
093600200529     C***********          MOVE *LOVAL    WKPTFR                   S01464 091522
093700200529     C***********FAXKEY    SETLLSEOCFSXX                           S01464 091522
093800200529     C***********          READ SEOCFSXX                 71        S01464 091522
093900200529     C***********          END                                     S01464 091522
094000200529     C*                                                                   S01464
094100200529     C           S1CUST    IFNE *BLANKS                    B1
094200200529     C***********S1BRCH    ANDEQ*BLANKS                            S01464 091522
094300200529     C           S1PORT    ANDEQ*BLANKS
094400200529     C           *IN27     ANDEQ'0'
094500200529     C                     Z-ADD0         WKLRRN
094600200529     C                     Z-ADD0         S1RRN
094700200529     C           S1RRN     ADD  1         WKFRRN
094800200529     C*
094900200529     C** MOVE CUSTOMER NUMBER FORM SCREEN OR FROM LF/SDCUSTL6 INTO KEY
095000200529     C                     MOVE S1CUST    WWCHK4  4
095100200529     C           WWCHK4    IFEQ *BLANKS                    B2
095200200529     C                     MOVELS1CUST    WKCNUM
095300200529     C                     ELSE                            X2
095400200529     C                     MOVE BBCUST    WKCNUM
095500200529     C                     END                             E2
095600200529     C                     MOVEL*LOVAL    WKPTFR
095700200529     C***********          MOVE *LOVAL    WKBRCA                   S01464 091522
095800200529     C*
095900200529     C***********FAXKEY    SETLLSCOCFSXX                                  S01464
096000200529     C           FAXKEY    SETLLSEOCFSXX                                  S01464
096100200529     C***********          READ SCOCFSXX                 71               S01464
096200200529     C                     READ SEOCFSXX                 71               S01464
096300200529     C*
096400200529     C***********          END                             E1             091522
096500200529     C                     ELSE                                           091522
096600200529     C*
096700200529     C           S1CUST    IFNE *BLANKS                    B1             S01464
096800200529     C***********S1BRCH    ANDNE*BLANKS                            S01464 091522
096900200529     C***********S1PORT    ANDNE*BLANKS                                   S01464
097000200529     C           S1PORT    ANDNE*BLANKS                                   091522
097100200529     C           *IN27     ANDEQ'0'                                       S01464
097200200529     C                     Z-ADD0         WKLRRN                          S01464
097300200529     C                     Z-ADD0         S1RRN                           S01464
097400200529     C           S1RRN     ADD  1         WKFRRN                          S01464
097500200529     C*                                                                   S01464
097600200529     C** MOVE CUSTOMER NUMBER FORM SCREEN OR FROM LF/SDCUSTL6 INTO KEY    S01464
097700200529     C                     MOVE S1CUST    WWCHK4  4                       S01464
097800200529     C           WWCHK4    IFEQ *BLANKS                    B2             S01464
097900200529     C                     MOVELS1CUST    WKCNUM                          S01464
098000200529     C                     ELSE                            X2             S01464
098100200529     C                     MOVE BBCUST    WKCNUM                          S01464
098200200529     C                     END                             E2             S01464
098300200529     C***********          MOVE S1BRCH    WKBRCA                   S01464 091522
098400200529     C*                                                                   S01464
098500200529     C***********S1PORT    IFEQ P9R997                     B2             S01464
098600200529     C***********          MOVE '9997'    WKPTFR                          S01464
098700200529     C***********          END                             E2             S01464
098800200529     C***********                                                         S01464
098900200529     C***********S1PORT    IFEQ P9R999                     B2             S01464
099000200529     C***********          MOVE '9999'    WKPTFR                          S01464
099100200529     C***********          END                             E2             S01464
099200200529     C***********                                                         S01464
099300200529     C***********S1PORT    IFEQ *BLANKS                    B2             S01464
099400200529     C***********          MOVE *LOVAL    WKPTFR                   S01464 091522
099500200529     C***********          END                             E2             S01464
099600200529     C***********                                                         S01464
099700200529     C***********S1PORT    IFNE P9R997                     B2             S01464
099800200529     C***********S1PORT    ANDNEP9R999                                    S01464
099900200529     C***********S1PORT    ANDNE*BLANKS                                   S01464
100000200529     C***********          MOVE S1PORT    WKPTFR                          S01464
100100200529     C***********          END                             E2             S01464
100200200529     C*                                                                   091522
100300200529     C           S1PORT    IFEQ FCR997                     B2             091522
100400200529     C           BGN4ST    ANDNE'Y'                                       CPB001
100500200529     C                     MOVE '9997'    WKPTFR                          091522
100600200529     C                     END                             E2             091522
100700200529     C*                                                                   091522
100800200529     C           S1PORT    IFEQ FCR999                     B2             091522
100900200529     C           BGN4ST    ANDNE'Y'                                       CPB001
101000200529     C                     MOVE '9999'    WKPTFR                          091522
101100200529     C                     END                             E2             091522
101200200529     C*                                                                   091522
101300200529     C           S1PORT    IFEQ *BLANKS                    B2             091522
101400200529     C                     MOVE *LOVAL    WKPTFR                          091522
101500200529     C                     END                             E2             091522
101600200529     C*                                                                   091522
101700200529     C           S1PORT    IFNE FCR997                     B2             091522
101800200529     C           S1PORT    ANDNEFCR999                                    091522
101900200529     C           S1PORT    ANDNE*BLANKS                                   091522
102000200529     C           S1PORT    OREQ FCR997                                    CPB001
102100200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
102200200529     C           S1PORT    OREQ FCR999                                    CPB001
102300200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
102400200529     C                     MOVE S1PORT    WKPTFR                          091522
102500200529     C                     END                             E2             091522
102600200529     C*                                                                   S01464
102700200529     C***********FAXKEY    SETLLSCOCFSXX                                  S01464
102800200529     C           FAXKEY    SETLLSEOCFSXX                                  S01464
102900200529     C***********          READ SCOCFSXX                 71               S01464
103000200529     C                     READ SEOCFSXX                 71               S01464
103100200529     C*                                                                   S01464
103200200529     C***********          END                             E1      S01464 091522
103300200529     C                     ELSE                                           091522
103400200529     C*
103500200529     C***********S1CUST    IFEQ *BLANKS                    B1             091522
103600200529     C***********S1PORT    ANDEQ*BLANKS                                   091522
103700200529     C***********S1BRCH    ANDEQ*BLANKS                            S01464 091522
103800200529     C*                                                                   091522
103900200529     C           S1BRCH    IFNE WKBRCH                                    091522
104000200529     C           *IN27     ANDEQ'0'
104100200529     C           WKCUST    ORNE WKCNUM                                    091522
104200200529     C           *IN27     ANDEQ'0'                                       091522
104300200529     C                     MOVE *BLANKS   WKCNUM                          091928
104400200529     C                     Z-ADD0         WKLRRN
104500200529     C                     Z-ADD0         S1RRN
104600200529     C           S1RRN     ADD  1         WKFRRN
104700200529     C*
104800200529     C***********          MOVE *LOVAL    WKCNUM                                              CSD027
104900200529     C                     MOVE *BLANKS   WKCNUM                                              CSD027
105000200529     C                     MOVE *LOVAL    WKPTFR
105100200529     C*
105200200529     C***********FAXKEY    SETLLSCOCFSXX                                  S01464
105300200529     C           FAXKEY    SETLLSEOCFSXX                                  S01464
105400200529     C***********          READ SCOCFSXX                 71               S01464
105500200529     C                     READ SEOCFSXX                 71               S01464
105600200529     C*                                                                   091522
105700200529     C                     ELSE                                           091522
105800200529     C                     Z-ADDWKLRRN    S1RRN                           091522
105900200529     C           S1RRN     ADD  1         WKFRRN                          091522
106000200529     C                     READ SEOCFSXX                 71               091522
106100200529     C                     END                                            091522
106200200529     C*                                                                   091522
106300200529     C                     END                                            091522
106400200529     C*
106500200529     C                     END                             E1
106600200529     C*
106700200529     C* Blank out Review from fields.
106800200529     C*
106900200529     C                     MOVE *BLANKS   S1CUST
107000200529     C                     MOVE *BLANKS   S1PORT
107100200529     C*
107200200529     C** ROLLUP WAS PRESSED
107300200529     C*
107400200529     C* Set of reverse Image indicators.
107500200529     C*
107600200529     C           *IN27     IFEQ '1'                        B1
107700200529     C                     SETOF                     818289
107800200529     C                     SETOF                     858687
107900200529     C                     SETOF                     52                   S01464
108000200529     C*
108100200529     C                     Z-ADDWKLRRN    S1RRN
108200200529     C           S1RRN     ADD  1         WKFRRN
108300200529     C*
108400200529     C* This line not reinststed as otherwise every 8th record is not     049067
108500200529     C* displayed on the screen.                                          049067
108600200529     C**                   READ SCOCFSXX                 71               R0192
108700200529     C*
108800200529     C                     END                             E1
108900200529     C*
109000200529     C* Write records to subfile until page is full or there are no
109100200529     C* more records on file.
109200200529     C*
109300200529     C           WWEROR    IFNE '1'                                       S01464
109400200529     C           *IN71     DOWEQ'0'
109500200529     C***********WCOUNT    ANDLE7                                         096749
109600200529     C***********WCOUNT    ANDLT7                                  096749 174057
109700200529     C           WCOUNT    ANDLT7                                                             252447
109800200529     C*
109900200529     C**Do*not*show*the*deleted*customer*************************** R0192 049067
110000200529     C* Show the deleted customer                                         049067
110100200529     C*                                                                   R0192
110200200529     C***********SERECI    IFNE '*'                                 R0192 049067
110300200529     C***********SEBRCA    ANDEQS1BRCH                              S01464049607
110400200529      *
110500200529     C           SEBRCA    IFEQ S1BRCH                                    049067
110600200529      *                                                                   R0192
110700200529     C                     SETOF                     36
110800200529     C                     ADD  1         S1RRN
110900200529     C*
111000200529     C* Move values from file to screen fields.
111100200529     C*
111200200529     C                     EXSR #YAA
111300200529     C*
111400200529     C* Write record to subfile.
111500200529     C*
111600200529     C                     WRITESE6050S1
111700200529     C***********          ADD  1         WCOUNT                    R0192 049067
111800200529     C                     END                                            R0192
111900200529     C*
112000200529     C* Read next 'non-deleted' Record from File SEOCFSXX.
112100200529     C*
112200200529     C***********          READ SCOCFSXX                 71               S01464
112300200529     C                     READ SEOCFSXX                 71               S01464
112400200529     C*
112500200529     C************         ADD  1         WCOUNT                          R0192
112600200529     C                     ADD  1         WCOUNT                          049067
112700200529     C                     END
112800200529     C                     END                                            S01464
112900200529     C*
113000200529     C           *IN71     IFEQ '1'
113100200529     C                     SETON                     35
113200200529     C                     ELSE                                           096749
113300200529     C                     SETOF                     35                   096749
113400200529     C                     END
113500200529     C*
113600200529     C* Store RRN's.
113700200529     C                     Z-ADDS1RRN     WKLRRN
113800200529     C                     Z-ADDWKFRRN    S1RRN
113900200529     C*
114000200529     C**   IF NO RECORDS WRITTEN TO SUBFILE
114100200529     C*
114200200529     C           WKLRRN    IFEQ 0
114300200529     C                     MOVEL'SE03018' ZAMSID
114400200529     C                     EXSR ZASNMS
114500200529     C                     MOVE '1'       WKEROR
114600200529     C                     MOVE '0'       *IN32
114700200529     C                     ELSE
114800200529     C                     MOVE '1'       *IN32
114900200529     C                     SETOF                     6481                                     253084
115000200529     C                     END
115100200529     C*
115200200529     C                     ENDSR
115300200529     C********************************************************************
115400200529     C*
115500200529     C*
115600200529     C/EJECT
115700200529     C********************************************************************
115800200529     C*                                                                  *
115900200529     C*  #YAA      - SETUP SUBFILE RECORD                                *
116000200529     C*                                                                  *
116100200529     C*  CALLS     - NONE                                                *
116200200529     C*                                                                  *
116300200529     C*  CALLED BY - #YA                                                 *
116400200529     C*                                                                  *
116500200529     C********************************************************************
116600200529     C*
116700200529     C           #YAA      BEGSR
116800200529     C*
116900200529     C* Move values to screen fields.
117000200529     C*
117100200529     C                     SETOF                     36
117200200529     C*
117300200529     C* Initially move 'N' to hidden subfile field 'S1UPDT' (i.e.) We
117400200529     C* do not want to update file unless record changed and valid.
117500200529     C*
117600200529     C                     MOVE 'N'       S1UPDT
117700200529     C                     MOVE *BLANKS   S1ACTN
117800200529     C*
117900200529     C* If record is deleted set status field to 'D'.
118000200529     C*
118100200529     C           SERECI    IFEQ '*'
118200200529     C                     MOVE 'D'       S1STAT
118300200529     C                     SETON                     64
118400200529     C*
118500200529     C                     ELSE
118600200529     C                     SETOF                     64
118700200529     C*
118800200529     C* If record is authorized set status field to 'X'.
118900200529     C*
119000200529     C           SEAUIN    IFEQ 'Y'
119100200529     C                     MOVE 'X'       S1STAT
119200200529     C*******    SAAUPI    IFEQ 'N'
119300200529     C*******              SETON                     64
119400200529     C*******              END
119500200529     C                     ELSE
119600200529     C                     MOVE *BLANKS   S1STAT
119700200529     C                     END
119800200529     C*
119900200529     C                     END
120000200529     C*
120100200529     C* Customer.
120200200529     C                     MOVE SECNUM    S1CUSS
120300200529     C**Folio.                                                            S01464
120400200529     C***********SACFCP    IFEQ 'C'                                       S01464
120500200529     C***********          MOVE *BLANKS   S1FOLI                          091522
120600200529     C***********                                                         S01464
120700200529     C***********          ELSE                                           S01464
120800200529     C***********SEPTFR    IFEQ '9997'                                    S01464
120900200529     C***********          MOVE P9R997    S1FOLI                          S01464
121000200529     C***********                                                         S01464
121100200529     C***********          ELSE                                           S01464
121200200529     C***********SEPTFR    IFEQ '9999'                                    S01464
121300200529     C***********          MOVE P9R999    S1FOLI                          S01464
121400200529     C***********                                                         S01464
121500200529     C***********          ELSE                                           S01464
121600200529     C***********          MOVE SEPTFR    S1FOLI                          S01464
121700200529     C***********          END                                            S01464
121800200529     C***********          END                                            S01464
121900200529     C***********          END                                            S01464
122000200529     C*                                                                   091522
122100200529     C** Folio.                                                           091522
122200200529     C*                                                                   091522
122300200529     C           FBCFCP    IFEQ 'C'                                       091522
122400200529     C                     MOVE *BLANKS   S1FOLI                          091522
122500200529     C*                                                                   091522
122600200529     C                     ELSE                                           091522
122700200529     C           SEPTFR    IFEQ '9997'                                    091522
122800200529     C           BGN4ST    ANDNE'Y'                                       CPB001
122900200529     C                     MOVE FCR997    S1FOLI                          091522
123000200529     C*                                                                   091522
123100200529     C                     ELSE                                           091522
123200200529     C           SEPTFR    IFEQ '9999'                                    091522
123300200529     C           BGN4ST    ANDNE'Y'                                       CPB001
123400200529     C                     MOVE FCR999    S1FOLI                          091522
123500200529     C*                                                                   091522
123600200529     C                     ELSE                                           091522
123700200529     C                     MOVE SEPTFR    S1FOLI                          091522
123800200529     C                     END                                            091522
123900200529     C                     END                                            091522
124000200529     C                     END                                            091522
124100200529     C*
124200200529     C* Initialize ZSEDIT Parameters.
124300200529     C*
124400200529     C***********          Z-ADDSABCGD    ZDECS                           S01464
124500200529     C           SECSCY    IFNE *BLANKS                                   S01464
124600200529     C*                                                                   S01464
124700200529     C           SECSCY    CHAINSDCURRL0             80                   S01464
124800200529     C*                                                                   S01464
124900200529     C           *IN80     IFEQ '0'                                       S01464
125000200529     C                     Z-ADDA6NBDP    ZDECS                           S01464
125100200529     C                     ELSE                                           S01464
125200200529     C                     Z-ADDWWNBDP    ZDECS                           S01464
125300200529     C                     END                                            S01464
125400200529     C*                                                                   S01464
125500200529     C                     ELSE                                           S01464
125600200529     C                     Z-ADDWWNBDP    ZDECS                           S01464
125700200529     C                     END                                            S01464
125800200529     C                     MOVE 'L'       ZECODE
125900200529     C*
126000200529     C* Edit Fee Accrued to Date.
126100200529     C*
126200200529     C                     Z-ADDSECFAC    ZFLD15
126300200529     C                     EXSR ZSEDIT
126400200529     C                     MOVE ZOUT21    WWFL15 15
126500200529     C                     MOVELWWFL15    S1ACRU
126600200529     C*
126700200529     C* Actual Fee.
126800200529     C*
126900200529     C                     Z-ADDSEAFTS    ZFLD15
127000200529     C                     EXSR ZSEDIT
127100200529     C                     MOVE ZOUT21    WWFL15
127200200529     C                     MOVELWWFL15    S1ACTF
127300200529     C                     MOVELWWFL15    S1HACT
127400200529     C*
127500200529     C* Currency.
127600200529     C                     MOVE SECSCY    S1CURR
127700200529     C*                                                                   S01464
127800200529     C* If multi-branch environment, display settle branch                S01464
127900200529     C*                                                                   S01464
128000200529     C           *IN50     IFEQ '1'                                       S01464
128100200529     C                     MOVE SECUSB    S1BRCA                          S01464
128200200529     C                     END                                            S01464
128300200529     C* Settle Account.
128400200529     C                     MOVE SECUSA    S1ACCV
128500200529     C* Settle Value Date.
128600200529     C                     MOVE SESEVD    ZDAYNO
128700200529     C                     EXSR ZDATE2
128800200529     C                     MOVE ZDATE     S1CDTE
128900200529     C*
129000200529     C* Store values in hidden fields.
129100200529     C*
129200200529     C                     MOVE SECSCY    S1HCCY
129300200529     C                     MOVE SECUSA    S1HACC
129400200529     C                     MOVE S1CDTE    S1HDAT
129500200529     C                     MOVE S1BRCA    S1HBRC                          S01464
129600200529     C                     MOVE SECUSB    S1HCUS
129700200529     C                     MOVE SETNLU    S1HTRN
129800200529     C*
129900200529     C                     MOVE 'N'       S1UPDT
130000200529     C*
130100200529     C* Convert projected Settlement Amount to Settlement Currency.
130200200529     C*
130300200529     C           SECSCY    IFNE *BLANKS
130400200529     C                     Z-ADDSEAFTS    ZAMTF
130500200529     C***********          MOVE SABCGC    ZCCYF                           S01464
130600200529     C                     MOVE FBBCGC    ZCCYF                           S01464
130700200529     C                     MOVE SECSCY    ZCCYT
130800200529     C                     MOVE BJCYCD    ZCCYB
130900200529     C******************** EXSR ZCCYKK                                    48200
131000200529     C/COPY WNCPYSRC,SE6050C002
131100200529     C                     EXSR ZCCYGB                                    48200
131200200529     C/COPY WNCPYSRC,SE6050C003
131300200529     C*
131400200529     C                     Z-ADDZSCYDP    ZDECS
131500200529     C                     Z-ADDZAMTT     ZFLD15
131600200529     C                     ELSE
131700200529     C***********          Z-ADDSABCGD    ZDECS                           S01464
131800200529     C                     Z-ADDWWNBDP    ZDECS                           S01464
131900200529     C                     Z-ADD0         ZFLD15
132000200529     C                     END
132100200529     C*
132200200529     C                     EXSR ZSEDIT
132300200529     C                     MOVE ZOUT21    WWFL15
132400200529     C*
132500200529     C* Move Value to screen field.
132600200529     C*
132700200529     C                     MOVELWWFL15    S1SETA
132800200529     C*
132900200529     C                     ENDSR
133000200529     C********************************************************************
133100200529     C*
133200200529     C*
133300200529     C/EJECT
133400200529     C********************************************************************
133500200529     C*                                                                  *
133600200529     C*  #C        - VALIDATION OF SCREENS                               *
133700200529     C*                                                                  *
133800200529     C*  CALLS     - #CA #CB                                             *
133900200529     C*                                                                  *
134000200529     C*  CALLED BY - MAINLINE                                            *
134100200529     C*                                                                  *
134200200529     C********************************************************************
134300200529     C           #C        BEGSR
134400200529     C*
134500200529     C* If Insert screen - validate it.
134600200529     C*
134700200529     C           *IN45     IFEQ '1'                        B1
134800200529     C*
134900200529     C           WKINSA    IFEQ 'Y'                        B2
135000200529     C*
135100200529     C* Amend Mode.
135200200529     C           WKFSRN    IFEQ 'Y'                        B3
135300200529     C                     EXSR #CC
135400200529     C                     ELSE                            X3
135500200529     C                     EXSR #CD
135600200529     C                     END                             E3
135700200529     C*
135800200529     C                     ELSE                            X2
135900200529     C* Insert Mode.
136000200529     C                     EXSR #CE
136100200529     C                     END                             E2
136200200529     C*
136300200529     C                     ELSE                            X1
136400200529     C*
136500200529     C* If Confirm Screen then execute subroutine '#CA' else Subfile
136600200529     C* screen so validate it by executing subroutine '#CB'.
136700200529     C*
136800200529     C           WKFSRN    IFEQ 'Y'                        B2
136900200529     C                     EXSR #CA
137000200529     C                     ELSE                            X2
137100200529     C                     EXSR #CB
137200200529     C                     END                             E2
137300200529     C*
137400200529     C                     END                             E1
137500200529     C*
137600200529     C                     ENDSR
137700200529     C********************************************************************
137800200529     C*
137900200529     C*
138000200529     C/EJECT
138100200529     C********************************************************************
138200200529     C*                                                                  *
138300200529     C*  #CA       - VALIDATION OF CONFIRM SCREEN                        *
138400200529     C*                                                                  *
138500200529     C*  CALLS     - #E #F #YA                                           *
138600200529     C*                                                                  *
138700200529     C*  CALLED BY - #C                                                  *
138800200529     C*                                                                  *
138900200529     C********************************************************************
139000200529     C           #CA       BEGSR
139100200529     C*
139200200529     C* Clear screen message queue.
139300200529     C*
139400200529     C                     CALL 'Y2CLMSC'
139500200529     C                     PARM           WWTPGQ
139600200529     C                     PARM           WWPGQR
139700200529     C*
139800200529     C* Set of error indicators.
139900200529     C*
140000200529     C                     SETOF                     887765
140100200529     C                     MOVE *BLANKS   WKEROR
140200200529     C*
140300200529     C* Only validate Confirm field.
140400200529     C*
140500200529     C           S1CNFM    IFNE 'Y'
140600200529     C           S1CNFM    ANDNE'N'
140700200529     C***                  MOVEL'SE04007' ZAMSID                          S01355
140800200529     C                     MOVEL'SE05009' ZAMSID                          S01355
140900200529     C                     EXSR ZASNMS
141000200529     C                     SETON                     8877
141100200529     C                     MOVE '1'       WKEROR
141200200529     C                     ELSE
141300200529     C*
141400200529     C* Re-set Subfile End indicator.
141500200529     C*
141600200529     C           WKSEND    IFEQ 'Y'
141700200529     C                     SETON                     35
141800200529     C                     ELSE
141900200529     C                     SETOF                     35
142000200529     C                     END
142100200529     C*
142200200529     C* Confirm field Valid.
142300200529     C*
142400200529     C           S1CNFM    IFEQ 'Y'
142500200529     C*
142600200529     C* Process Update.
142700200529     C                     EXSR #E
142800200529     C*
142900200529     C* If update successful and Review from fields not blank then
143000200529     C* clear Subfile and re-load subfile from those values on.
143100200529     C*
143200200529     C           *IN65     IFEQ '0'
143300200529     C*
143400200529     C           WKIN09    IFEQ 'N'
143500200529     C*
143600200529     C           S1CUST    IFNE *BLANKS
143700200529     C           S1BRCH    ORNE *BLANKS                                   S01464
143800200529     C*
143900200529     C* Clear Subfile.
144000200529     C                     SETON                     31
144100200529     C                     WRITESE6050C2
144200200529     C                     SETOF                     31
144300200529     C                     SETOF                     6364
144400200529     C                     SETON                     68
144500200529     C*                                                                   S01464
144600200529     C           S1BRCH    IFEQ *BLANKS                                   S01464
144700200529     C                     MOVE USRBCH    S1BRCH                          S01464
144800200529     C                     END                                            S01464
144900200529     C*                                                                   S01464
145000200529     C** Check if authorise to default branch                             S01464
145100200529     C*                                                                   S01464
145200200529     C           *IN50     IFEQ '1'                                       S01464
145300200529     C                     CALL 'ZVACTBU'                                 S01464
145400200529     C                     PARM 'A'       @ZACTN  1                       S01464
145500200529     C                     PARM S1BRCH    @BRNCH  3                       S01464
145600200529     C                     PARM           @ERR    10                      S01464
145700200529     C                     MOVE *BLANKS   WWEROR                          S01464
145800200529     C*                                                                   S01464
145900200529     C                     ELSE                                           S01464
146000200529     C                     CALL 'ZVACTU'                                  S01464
146100200529     C                     PARM 'A'       @ZACTN  1                       S01464
146200200529     C                     PARM           @ERR    10                      S01464
146300200529     C                     END                                            S01464
146400200529     C*                                                                   S01464
146500200529     C** If action invalid for user                                       S01464
146600200529     C*                                                                   S01464
146700200529     C           @ERR      IFEQ 1                                         S01464
146800200529     C           @ERR      OREQ 2                                         S01464
146900200529     C                     MOVEL'1'       WWEROR                          S01464
147000200529     C                     MOVEL'1'       WKEROR                          S01464
147100200529     C                     MOVE '1'       *IN51                           S01464
147200200529     C                     MOVEL'SE05024' ZAMSID                          S01464
147300200529     C                     EXSR ZASNMS                                    S01464
147400200529     C                     END                                            S01464
147500200529     C*
147600200529     C                     EXSR #YA
147700200529     C                     Z-ADD1         S1RRN
147800200529     C                     MOVE *BLANKS   S1CUST
147900200529     C                     MOVE *BLANKS   S1PORT
148000200529     C                     MOVE 'N'       WKFSRN
148100200529     C*
148200200529     C                     ELSE
148300200529     C                     EXSR #F
148400200529     C                     MOVE 'N'       WKFSRN
148500200529     C                     END
148600200529     C*
148700200529     C* Enable CMD 9.
148800200529     C                     SETON                     42
148900200529     C*
149000200529     C* Display Correct footings.
149100200529     C*
149200200529     C                     SETON                     61
149300200529     C                     SETOF                     606267
149400200529     C*
149500200529     C                     ELSE
149600200529     C*
149700200529     C           WKIN09    IFEQ 'Y'
149800200529     C*
149900200529     C* Insert Screen next.
150000200529     C                     SETON                     45
150100200529     C                     MOVE 'N'       WKFSRN
150200200529     C                     END
150300200529     C                     END
150400200529     C*
150500200529     C                     ELSE
150600200529     C*
150700200529     C                     EXSR #F
150800200529     C* Enable CMD 9.
150900200529     C                     SETON                     42
151000200529     C*
151100200529     C* Display Correct footings.
151200200529     C*
151300200529     C                     SETON                     61
151400200529     C                     SETOF                     606267
151500200529     C*
151600200529     C                     Z-ADDWKFRRN    S1RRN
151700200529     C                     END
151800200529     C*
151900200529     C                     ELSE
152000200529     C*
152100200529     C* Prepare to output original unprotected subfile again.
152200200529     C*
152300200529     C                     EXSR #F
152400200529     C*
152500200529     C* Enable CMD 9.
152600200529     C                     SETON                     42
152700200529     C*
152800200529     C* Display Correct footings.
152900200529     C*
153000200529     C                     SETON                     61
153100200529     C                     SETOF                     606267
153200200529     C                     MOVE 'N'       WKFSRN
153300200529     C                     END
153400200529     C*
153500200529     C                     END
153600200529     C*
153700200529     C                     ENDSR
153800200529     C********************************************************************
153900200529     C*
154000200529     C/EJECT
154100200529     C********************************************************************
154200200529     C*                                                                  *
154300200529     C*  #CB       - VALIDATION OF SUBFILE SCREEN                        *
154400200529     C*                                                                  *
154500200529     C*  CALLS     - #YA                                                 *
154600200529     C*                                                                  *
154700200529     C*  CALLED BY - #C                                                  *
154800200529     C*                                                                  *
154900200529     C********************************************************************
155000200529     C           #CB       BEGSR
155100200529     C*
155200200529     C* Clear screen message queue.
155300200529     C*
155400200529     C                     CALL 'Y2CLMSC'
155500200529     C                     PARM           WWTPGQ
155600200529     C                     PARM           WWPGQR
155700200529     C*
155800200529     C* Set of error indicators.
155900200529     C*
156000200529     C                     SETOF                     838466
156100200529     C                     SETOF                     51                   S01464
156200200529     C                     SETOF                     7977
156300200529     C                     MOVE *BLANKS   WKEROR
156400200529     C*
156500200529     C* Store 'CMD 9 or ENTER taken' in workfield.
156600200529     C*
156700200529     C           *IN09     IFEQ '1'                        B1
156800200529     C                     MOVE 'Y'       WKIN09  1
156900200529     C                     ELSE                            X1
157000200529     C                     MOVE 'N'       WKIN09
157100200529     C                     END                             E1
157200200529     C*
157300200529     C* IF NO RECORDS ON SUBFILE - DO NOT VALIDATE
157400200529     C*
157500200529     C           WKLRRN    IFGT 0                          B1
157600200529     C*
157700200529     C* Read First Changed Record on Subfile.
157800200529     C*
157900200529     C                     READCSE6050S1                 75
158000200529     C*
158100200529     C           *IN75     DOWEQ'0'                        B2
158200200529     C*
158300200529     C* Set off Reverse Image indicators.
158400200529     C*
158500200529     C***********          SETOF                     8182                 S01464
158600200529     C                     SETOF                     818252               S01464
158700200529     C                     SETOF                     868789
158800200529     C*
158900200529     C* Set off SFLNXTCHG and general error indicator (for this record)
159000200529     C*
159100200529     C                     SETOF                     3678
159200200529     C*
159300200529     C* Validate fields.
159400200529     C                     EXSR #CBA
159500200529     C*
159600200529     C           *IN78     IFEQ '0'                        B3
159700200529     C*
159800200529     C* Save Relative Record number of first changed record so that
159900200529     C* correct confirm screen will be displayed.
160000200529     C*
160100200529     C           *IN79     IFEQ '0'                        B4
160200200529     C                     Z-ADDS1RRN     WKSRRN  30
160300200529     C                     SETON                     79
160400200529     C                     END                             E4
160500200529     C                     END                             E3
160600200529     C*
160700200529     C                     UPDATSE6050S1
160800200529     C*
160900200529     C                     READCSE6050S1                 75
161000200529     C                     END                             E2
161100200529     C*
161200200529     C* If Errors in Subfile, Re-Display screen with messages, at
161300200529     C* first field in error.
161400200529     C*
161500200529     C           *IN77     IFEQ '1'                        B2
161600200529     C                     Z-ADDWKFRRN    S1RRN
161700200529     C                     MOVE '1'       WKEROR
161800200529     C                     END                             E2
161900200529     C*
162000200529     C                     END                             E1
162100200529     C* If not Insert.
162200200529     C*
162300200529     C           WKINSA    IFNE 'Y'                        B1
162400200529     C*
162500200529     C* Validate review from fields.
162600200529     C*
162700200529     C                     EXSR #CBB
162800200529     C*
162900200529     C* If a record has changed and there are no errors on screen
163000200529     C* then set flag to ensure Confirm screen is displayed.
163100200529     C*
163200200529     C           *IN77     IFEQ '0'                        B2
163300200529     C           *IN66     IFEQ '1'                        B3
163400200529     C                     MOVE 'Y'       WKLDCF
163500200529     C                     SETOF                     66
163600200529     C*
163700200529     C                     ELSE                            X3
163800200529     C*                                                                   091522
163900200529     C** Set up customer number field.                                    091522
164000200529     C*                                                                   091522
164100200529     C           WWCHK4    IFEQ *BLANKS                                   091522
164200200529     C**********           MOVELS1CUST    WKCUST  60                                   091522 CSD027
164300200529     C                     MOVELS1CUST    WKCUST  6                                           CSD027
164400200529     C                     ELSE                                           091522
164500200529     C                     MOVELBBCUST    WKCUST                          091522
164600200529     C                     END                                            091522
164700200529     C*                                                                   091522
164800200529     C* Re-build Subfile if review from fields not blank and no
164900200529     C* changed records.
165000200529     C*
165100200529     C           WKIN09    IFEQ 'N'                        B4
165200200529     C           S1CUST    ANDNE*BLANKS
165300200529     C           WKIN09    OREQ 'N'                                      S01464
165400200529     C           S1BRCH    ANDNE*BLANKS
165500200529     C           WKIN09    OREQ 'N'                                       091522
165600200529     C           WKCUST    ANDNEWKCNUM                                    091522
165700200529     C*
165800200529     C* Clear Subfile before re-building.
165900200529     C*
166000200529     C                     SETON                     31
166100200529     C                     WRITESE6050C2
166200200529     C                     SETOF                     31
166300200529     C*                                                                   S01464
166400200529     C           S1BRCH    IFEQ *BLANKS                                   S01464
166500200529     C                     MOVE USRBCH    S1BRCH                          S01464
166600200529     C                     END                                            S01464
166700200529     C*                                                                   S01464
166800200529     C** Check if authorise to default branch                             S01464
166900200529     C*                                                                   S01464
167000200529     C           *IN50     IFEQ '1'                                       S01464
167100200529     C                     CALL 'ZVACTBU'                                 S01464
167200200529     C                     PARM 'A'       @ZACTN  1                       S01464
167300200529     C                     PARM S1BRCH    @BRNCH  3                       S01464
167400200529     C                     PARM           @ERR    10                      S01464
167500200529     C                     MOVE *BLANKS   WWEROR                          S01464
167600200529     C*                                                                   S01464
167700200529     C                     ELSE                                           S01464
167800200529     C                     CALL 'ZVACTU'                                  S01464
167900200529     C                     PARM 'A'       @ZACTN  1                       S01464
168000200529     C                     PARM           @ERR    10                      S01464
168100200529     C                     END                                            S01464
168200200529     C*                                                                   S01464
168300200529     C** If action invalid for user                                       S01464
168400200529     C*                                                                   S01464
168500200529     C           @ERR      IFEQ 1                                         S01464
168600200529     C           @ERR      OREQ 2                                         S01464
168700200529     C                     MOVEL'1'       WWEROR                          S01464
168800200529     C                     MOVEL'1'       WKEROR                          S01464
168900200529     C                     MOVE '1'       *IN51                           S01464
169000200529     C                     MOVEL'SE05024' ZAMSID                          S01464
169100200529     C                     EXSR ZASNMS                                    S01464
169200200529     C                     END                                            S01464
169300200529     C                     EXSR #YA
169400200529     C*
169500200529     C                     ELSE                            X4
169600200529     C*
169700200529     C           WKIN09    IFEQ 'Y'                        B5
169800200529     C                     SETON                     45
169900200529     C                     END                             E5
170000200529     C*
170100200529     C                     END                             E4
170200200529     C                     END                             E3
170300200529     C                     END                             E2
170400200529     C*
170500200529     C* Set off SFLNXTCHG and Error Indicator.
170600200529     C*
170700200529     C                     SETOF                     3677
170800200529     C                     END                             E1
170900200529     C*
171000200529     C                     ENDSR
171100200529     C********************************************************************
171200200529     C*
171300200529     C*
171400200529     C/EJECT
171500200529     C********************************************************************
171600200529     C*                                                                  *
171700200529     C*  #CF       - VALIDATION OF SUBFILE SCREEN - INSERT MODE          *
171800200529     C*                                                                  *
171900200529     C*  CALLS     - #YA                                                 *
172000200529     C*                                                                  *
172100200529     C*  CALLED BY - #C                                                  *
172200200529     C*                                                                  *
172300200529     C********************************************************************
172400200529     C           #CF       BEGSR
172500200529     C*
172600200529     C* Clear screen message queue.
172700200529     C*
172800200529     C                     CALL 'Y2CLMSC'
172900200529     C                     PARM           WWTPGQ
173000200529     C                     PARM           WWPGQR
173100200529     C*
173200200529     C* Set of error indicators.
173300200529     C*
173400200529     C                     SETOF                     838466
173500200529     C                     SETOF                     51                   S01464
173600200529     C                     SETOF                     7977
173700200529     C                     MOVE *BLANKS   WKEROR
173800200529     C                     Z-ADD1         S1RRN
173900200529     C*
174000200529     C* Store 'CMD 9 or ENTER taken' in workfield.
174100200529     C*
174200200529     C           *IN09     IFEQ '1'
174300200529     C                     MOVE 'Y'       WKIN09  1
174400200529     C                     ELSE
174500200529     C                     MOVE 'N'       WKIN09
174600200529     C                     END
174700200529     C*
174800200529     C* IF NO RECORDS ON SUBFILE - DO NOT VALIDATE
174900200529     C*
175000200529     C           WKLRRN    IFGT 0
175100200529     C*
175200200529     C* Read First Changed Record on Subfile.
175300200529     C*
175400200529     C           S1RRN     CHAINSE6050S1             75
175500200529     C*
175600200529     C           *IN75     DOWEQ'0'
175700200529     C*
175800200529     C* Set off Reverse Image indicators.
175900200529     C*
176000200529     C***********          SETOF                     8182                 S01464
176100200529     C                     SETOF                     818252
176200200529     C                     SETOF                     868789
176300200529     C*
176400200529     C* Set off SFLNXTCHG and general error indicator (for this record)
176500200529     C*
176600200529     C                     SETOF                     3678
176700200529     C*
176800200529     C* Validate fields.
176900200529     C                     EXSR #CBA
177000200529     C*
177100200529     C           *IN78     IFEQ '0'
177200200529     C*
177300200529     C* Save Relative Record number of first changed record so that
177400200529     C* correct confirm screen will be displayed.
177500200529     C*
177600200529     C           *IN79     IFEQ '0'
177700200529     C                     Z-ADDS1RRN     WKSRRN  30
177800200529     C                     SETON                     79
177900200529     C                     END
178000200529     C                     END
178100200529     C*
178200200529     C                     UPDATSE6050S1
178300200529     C*
178400200529     C                     ADD  1         S1RRN
178500200529     C           S1RRN     CHAINSE6050S1             75
178600200529     C                     END
178700200529     C*
178800200529     C* If Errors in Subfile, Re-Display screen with messages, at
178900200529     C* first field in error.
179000200529     C*
179100200529     C           *IN77     IFEQ '1'
179200200529     C                     Z-ADDWKFRRN    S1RRN
179300200529     C                     MOVE '1'       WKEROR
179400200529     C                     ELSE
179500200529     C                     Z-ADD1         S1RRN
179600200529     C                     END
179700200529     C*
179800200529     C                     END
179900200529     C*
180000200529     C                     ENDSR
180100200529     C********************************************************************
180200200529     C*
180300200529     C/EJECT
180400200529     C********************************************************************
180500200529     C*                                                                  *
180600200529     C*  #CBA      - VALIDATE FIELDS                                     *
180700200529     C*                                                                  *
180800200529     C*  CALLS     - NONE                                                *
180900200529     C*                                                                  *
181000200529     C*  CALLED BY - #CB                                                 *
181100200529     C*                                                                  *
181200200529     C********************************************************************
181300200529     C           #CBA      BEGSR
181400200529     C*                                                                  *
181500200529     C********************************************************************
181600200529     C**   VALIDATE ACTION CODE                                          *
181700200529     C********************************************************************
181800200529     C*
181900200529     C           S1ACTN    IFNE *BLANKS                    B1
182000200529     C*
182100200529     C* Action Code must be 'D' if FBAUPI = 'Y' else it must be 'X'
182200200529     C* or 'D' if FBAUPI = 'N'.
182300200529     C*
182400200529     C***********SAAUPI    IFEQ 'Y'                        B2             S01464
182500200529     C           FBAUPI    IFEQ 'Y'                        B2             S01464
182600200529     C           S1ACTN    IFNE 'D'                        B3
182700200529     C*
182800200529     C* ACTION entered is invalid.
182900200529     C*
183000200529     C                     MOVEL'SE05004' ZAMSID
183100200529     C                     EXSR ZASNMS
183200200529     C*
183300200529     C* If first error save RRN to position Subfile at first field in
183400200529     C* error.
183500200529     C*
183600200529     C           *IN77     IFEQ '0'                        B4
183700200529     C                     Z-ADDS1RRN     WKFRRN
183800200529     C                     END                             E4
183900200529     C*
184000200529     C                     SETON                     817736
184100200529     C                     SETON                     78
184200200529     C*
184300200529     C                     END                             E3
184400200529     C*
184500200529     C                     ELSE                            X2
184600200529     C*
184700200529     C           S1ACTN    IFNE 'D'                        B3
184800200529     C           S1ACTN    ANDNE'X'
184900200529     C*
185000200529     C* ACTION entered is invalid.
185100200529     C*
185200200529     C                     MOVEL'SE05003' ZAMSID
185300200529     C                     EXSR ZASNMS
185400200529     C*
185500200529     C* If first error save RRN to position Subfile at first field in
185600200529     C* error.
185700200529     C*
185800200529     C           *IN77     IFEQ '0'                        B4
185900200529     C                     Z-ADDS1RRN     WKFRRN
186000200529     C                     END                             E4
186100200529     C*
186200200529     C                     SETON                     817736
186300200529     C                     SETON                     78
186400200529     C*
186500200529     C                     END                             E3
186600200529     C                     END                             E2
186700200529     C*                                                                   S01464
186800200529     C** Check if authorise to action code                                S01464
186900200529     C*                                                                   S01464
187000200529     C           *IN81     IFEQ '0'
187100200529     C           *IN50     IFNE '1'                                       S01464
187200200529     C                     CALL 'ZVACTU'                                  S01464
187300200529     C                     PARM S1ACTN    @ZACTN  1                       S01464
187400200529     C                     PARM           @ERR    10                      S01464
187500200529     C*                                                                   S01464
187600200529     C** If action invalid for user                                       S01464
187700200529     C*                                                                   S01464
187800200529     C           @ERR      IFEQ 1                                         S01464
187900200529     C                     MOVEL'SEM1019' ZAMSID                          S01464
188000200529     C                     MOVE '1'       WKEROR
188100200529     C                     EXSR ZASNMS                                    S01464
188200200529     C           *IN77     IFEQ '0'
188300200529     C                     Z-ADDS1RRN     WKFRRN
188400200529     C                     END
188500200529     C                     SETON                     817736
188600200529     C                     SETON                     78
188700200529     C                     END                                            S01464
188800200529     C*                                                                   S01464
188900200529     C                     ELSE                                           S01464
189000200529     C*                                                                   S01464
189100200529     C           S1BRCH    IFEQ *BLANKS                                   S01464
189200200529     C                     MOVE USRBCH    S1BRCH                          S01464
189300200529     C                     END                                            S01464
189400200529     C*                                                                   S01464
189500200529     C                     CALL 'ZVACTBU'                                 S01464
189600200529     C                     PARM S1ACTN    @ZACTN  1                       S01464
189700200529     C                     PARM S1BRCH    @BRNCH  3                       S01464
189800200529     C                     PARM           @ERR    10                      S01464
189900200529     C*                                                                   S01464
190000200529     C** If action invalid for user (multientity)                         S01464
190100200529     C*                                                                   S01464
190200200529     C           @ERR      IFEQ 1                                         S01464
190300200529     C                     MOVEL'SEM1020' ZAMSID                          S01464
190400200529     C                     MOVE '1'       WKEROR
190500200529     C                     MOVE '1'       *IN51                           S01464
190600200529     C                     EXSR ZASNMS                                    S01464
190700200529     C           *IN77     IFEQ '0'
190800200529     C                     Z-ADDS1RRN     WKFRRN
190900200529     C                     END
191000200529     C                     SETON                     817736
191100200529     C                     SETON                     78
191200200529     C                     END                                            S01464
191300200529     C*                                                                   S01464
191400200529     C** If action invalid for user for branch                            S01464
191500200529     C*                                                                   S01464
191600200529     C           @ERR      IFEQ 2                                         S01464
191700200529     C                     MOVEL'SEM1021' ZAMSID                          S01464
191800200529     C                     MOVE '1'       WKEROR
191900200529     C                     MOVE '1'       *IN51                           S01464
192000200529     C                     EXSR ZASNMS                                    S01464
192100200529     C           *IN77     IFEQ '0'
192200200529     C                     Z-ADDS1RRN     WKFRRN
192300200529     C                     END
192400200529     C                     SETON                     817736
192500200529     C                     SETON                     78
192600200529     C                     END                                            S01464
192700200529     C                     END                                            S01464
192800200529     C                     END                                            S01464
192900200529     C                     END                             E1
193000200529     C*                                                                  *
193100200529     C********************************************************************
193200200529     C**   VALIDATE ACTUAL FEE                                           *
193300200529     C********************************************************************
193400200529     C*
193500200529     C                     MOVE 'N'       WWSTLV  1
193600200529     C*
193700200529     C* Call ZALIGN to validate amount.
193800200529     C*
193900200529     C***********          Z-ADDSABCGD    ZADEC                           S01464
194000200529     C                     Z-ADDWWNBDP    ZADEC                           S01464
194100200529     C                     Z-ADD0         ZADIG
194200200529     C***********13        SUB  SABCGD    ZADIG                           S01464
194300200529     C           13        SUB  WWNBDP    ZADIG                           S01464
194400200529     C                     MOVE '0'       *IN99
194500200529     C                     MOVE *BLANKS   ZFIELD
194600200529     C                     MOVE S1ACTF    ZFIELD
194700200529     C                     EXSR ZALIGN
194800200529     C                     MOVE ZFIELD    S1HACF
194900200529     C*
195000200529     C           *IN99     IFEQ '1'
195100200529     C*
195200200529     C* Amount entered is invalid.
195300200529     C*
195400200529     C                     MOVEL'SE05005' ZAMSID
195500200529     C                     EXSR ZASNMS
195600200529     C*
195700200529     C* If first error save RRN to position Subfile at first field in
195800200529     C* error.
195900200529     C*
196000200529     C           *IN77     IFEQ '0'
196100200529     C                     Z-ADDS1RRN     WKFRRN
196200200529     C                     END
196300200529     C*
196400200529     C                     SETON                     827736
196500200529     C                     SETON                     78
196600200529     C*
196700200529     C                     ELSE
196800200529     C*
196900200529     C**   Valid amount, call ZSEDIT to redisplay
197000200529     C*
197100200529     C                     MOVE 'Y'       WWSTLV
197200200529     C                     MOVE ZFIELD    WWSTLA 150
197300200529     C                     MOVE ZFIELD    ZFLD15
197400200529     C***********          Z-ADDSABCGD    ZDECS                           S01464
197500200529     C                     Z-ADDWWNBDP    ZDECS                           S01464
197600200529     C                     EXSR ZSEDIT
197700200529     C                     MOVE ZOUT21    WWFL15
197800200529     C                     MOVELWWFL15    S1ACTF
197900200529     C*
198000200529     C                     END
198100200529     C*                                                                  *
198200200529     C********************************************************************
198300200529     C**   VALIDATE SETTLEMENT CURRENCY                                  *
198400200529     C********************************************************************
198500200529     C*
198600200529     C* Settlement Currency must be a valid currency.
198700200529     C*
198800200529     C           WWSTLV    IFEQ 'Y'                        B1
198900200529     C           WWSTLA    ANDEQ0
199000200529     C           S1CURR    ANDEQ*BLANKS
199100200529     C                     GOTO VLCCY
199200200529     C                     ELSE                            X1
199300200529     C*                                                                   092108
199400200529     C** If retail account number is used as settlement account and       092108
199500200529     C** settlement ccy not entered, use retail account ccy.              092108
199600200529     C*                                                                   092108
199700200529     C           WKACC2    IFNE *BLANKS                                   092108
199800200529     C           S1CURR    ORNE *BLANKS                                   092108
199900200529     C*
200000200529     C* Settlement Currency must be a valid currency.
200100200529     C*
200200200529     C***********S1CURR    CHAINSDCURRJ0             76                   S01464
200300200529     C                     CALL 'AOCURRR0'                                S01464
200400200529     C                     PARM '*BLANKS' @RTCD   7                       S01464
200500200529     C                     PARM '*KEY   ' @OPTN   7                       S01464
200600200529     C                     PARM S1CURR    @AJCD   3                       S01464
200700200529     C           SDCURR    PARM SDCURR    DSSDY                           S01464
200800200529     C************IN76     IFEQ '1'                                       S01464
200900200529     C           @RTCD     IFNE *BLANKS                                   S01464
201000200529     C           @RTCD     ANDNE'*NOSEL '                                 S01464
201100200529     C*
201200200529     C                     MOVEL'SE05006' ZAMSID
201300200529     C                     EXSR ZASNMS
201400200529     C*
201500200529     C* If first error save RRN to position Subfile at first field in
201600200529     C* error.
201700200529     C*
201800200529     C           *IN77     IFEQ '0'
201900200529     C                     Z-ADDS1RRN     WKFRRN
202000200529     C                     END
202100200529     C*
202200200529     C                     SETON                     867736
202300200529     C                     SETON                     78
202400200529     C                     ELSE                                           S01464
202500200529     C*                                                                   S01464
202600200529     C                     MOVE A6CYCD    S1CURR                          S01464
202700200529     C           @RTCD     IFEQ '*NOSEL '                                 S01464
202800200529     C                     MOVE *BLANKS   S1CURR                          S01464
202900200529     C                     END                                            S01464
203000200529     C                     END                                            S01464
203100200529     C                     END                                            092108
203200200529     C                     END
203300200529     C*
203400200529     C           VLCCY     TAG
203500200529     C*
203600200529     C**   IF ACTUAL FEE AND CURRENCY WERE VALID, RECALCULATE SETTLEMENT
203700200529     C**   AMOUNT
203800200529     C*
203900200529     C           *IN82     IFEQ '0'
204000200529     C           *IN86     ANDEQ'0'
204100200529     C*
204200200529     C* Convert projected Settlement Amount to Settlement Currency.
204300200529     C*
204400200529     C           S1CURR    IFNE *BLANKS
204500200529     C                     MOVE S1HACF    ZAMTF
204600200529     C***********          MOVE SABCGC    ZCCYF                           S01464
204700200529     C                     MOVE FBBCGC    ZCCYF                           S01464
204800200529     C                     MOVE S1CURR    ZCCYT
204900200529     C                     MOVE BJCYCD    ZCCYB
205000200529     C******************** EXSR ZCCYKK                                    48200
205100200529     C/COPY WNCPYSRC,SE6050C004
205200200529     C                     EXSR ZCCYGB                                    48200
205300200529     C/COPY WNCPYSRC,SE6050C005
205400200529     C*
205500200529     C                     Z-ADDZSCYDP    ZDECS
205600200529     C                     Z-ADDZAMTT     ZFLD15
205700200529     C                     ELSE
205800200529     C***********          Z-ADDSABCGD    ZDECS                           S01464
205900200529     C                     Z-ADDWWNBDP    ZDECS                           S01464
206000200529     C                     Z-ADD0         ZFLD15
206100200529     C                     END
206200200529     C*
206300200529     C                     EXSR ZSEDIT
206400200529     C                     MOVE ZOUT21    WWFL15
206500200529     C*
206600200529     C* Move Value to screen field.
206700200529     C*
206800200529     C                     MOVELWWFL15    S1SETA
206900200529     C                     END
207000200529     C*                                                                  *
207100200529     C********************************************************************
207200200529     C**   VALIDATE SETTLEMENT ACCOUNT                                   *
207300200529     C********************************************************************
207400200529     C*
207500200529     C** DO NOT VALIDATE SETTLEMENT ACCOUNT IF ACTION CODE OF 'D'
207600200529     C           S1ACTN    IFEQ 'D'
207700200529     C                     GOTO VLACC
207800200529     C                     END
207900200529     C*
208000200529     C           WWSTLV    IFEQ 'Y'                        B1
208100200529     C           WWSTLA    ANDEQ0
208200200529     C           S1ACCV    ANDEQ*BLANKS
208300200529     C                     GOTO VLACC
208400200529     C                     ELSE                            X1
208500200529     C*
208600200529     C* Settlement Account must be a valid account for this customer.
208700200529     C*
208800200529     C           WKACC2    IFEQ *BLANKS
208900200529     C*
209000200529     C* Call ZALIGN to validate account code (check numeric)
209100200529     C*
209200200529     C                     Z-ADD0         ZADEC
209300200529     C                     Z-ADD10        ZADIG
209400200529     C                     MOVE '0'       *IN99
209500200529     C                     MOVE *BLANKS   ZFIELD
209600200529     C                     MOVE WKACC1    ZFIELD
209700200529     C                     EXSR ZALIGN
209800200529     C*
209900200529     C           *IN99     IFEQ '0'
210000200529     C                     MOVE ZFIELD    ACNO
210100200529     C           ACNO      CHAINACNUM                47
210200200529     C                     END
210300200529     C*
210400200529     C           *IN47     IFEQ '1'
210500200529     C           RECI      OREQ '*'
210600200529     C           *IN99     OREQ '1'
210700200529     C*
210800200529     C                     MOVEL'SE05007' ZAMSID
210900200529     C                     EXSR ZASNMS
211000200529     C*
211100200529     C* If first error save RRN to position Subfile at first field in
211200200529     C* error.
211300200529     C*
211400200529     C           *IN77     IFEQ '0'
211500200529     C                     Z-ADDS1RRN     WKFRRN
211600200529     C                     END
211700200529     C*
211800200529     C                     SETON                     877736
211900200529     C                     SETON                     78
212000200529     C                     END
212100200529     C*                                                                   092108
212200200529     C** Check that the currency code of the retail account matches       092108
212300200529     C** the settlement ccy entered on screen.  If the screen value       092108
212400200529     C** is blank, use the ccy from the retail account.                   092108
212500200529     C*                                                                   092108
212600200529     C           *IN87     IFEQ '0'                                       092108
212700200529     C*                                                                   092108
212800200529     C           S1CURR    IFEQ *BLANKS                                   092108
212900200529     C                     MOVE CCY       S1CURR                          092108
213000200529     C                     ELSE                                           092108
213100200529     C*                                                                   092108
213200200529     C           S1CURR    IFNE CCY                                       092108
213300200529     C*                                                                   092108
213400200529     C                     MOVEL'SE05025' ZAMSID                          092108
213500200529     C                     EXSR ZASNMS                                    092108
213600200529     C*                                                                   092108
213700200529     C** If first error save RRN to position Subfile at first field in    092108
213800200529     C** error.                                                           092108
213900200529     C*                                                                   092108
214000200529     C           *IN77     IFEQ '0'                                       092108
214100200529     C                     Z-ADDS1RRN     WKFRRN                          092108
214200200529     C                     END                                            092108
214300200529     C*                                                                   092108
214400200529     C                     SETON                     877736               092108
214500200529     C                     SETON                     7886                 092108
214600200529     C                     END                                            092108
214700200529     C*                                                                   092108
214800200529     C                     END                                            092108
214900200529     C*                                                                   092108
215000200529     C                     END                                            092108
215100200529     C*
215200200529     C                     ELSE
215300200529     C*
215400200529     C* Call ZALIGN to validate account code (check numeric)
215500200529     C*
215600200529     C*****************************************************************                       252596
215700200529     C**Call*ZALIGN*to*validate*account*code*(check numeric)***********                       252596
215800200529     C*****************************************************************                       252596
215900200529     C**********           Z-ADD0         ZADEC                                               252596
216000200529     C**********           Z-ADD12        ZADIG                                               252596
216100200529     C**********           MOVE '0'       *IN99                                               252596
216200200529     C**********           MOVE *BLANKS   ZFIELD                                              252596
216300200529     C**********           MOVE S1ACCV    ZFIELD                                              252596
216400200529     C**********           EXSR ZALIGN                                                        252596
216500200529     C*
216600200529     C********** *IN99     IFEQ '0'                                                           252596
216700200529      *                                                                                       252596
216800200529      ** To check if partial account is numeric                                               252596
216900200529      *                                                                                       252596
217000200529     C           DIGITS    CHECKS1ACCV    MY      20                                          252596
217100200529     C           MY        IFEQ 0                                                             252596
217200200529     C           ACNTKY    CHAINACCNT                48
217300200529     C                     END
217400200529     C*
217500200529     C           *IN48     IFEQ '1'
217600200529     C           RECI      OREQ '*'
217700200529     C           MY        ORNE 0                                                             252596
217800200529     C********** *IN99     OREQ '1'                                                           252596
217900200529     C*
218000200529     C****                 MOVEL'SE05007' ZAMSID                          S01355
218100200529     C                     MOVEL'SE05019' ZAMSID                          S01355
218200200529     C                     EXSR ZASNMS
218300200529     C*
218400200529     C* If first error save RRN to position Subfile at first field in
218500200529     C* error.
218600200529     C*
218700200529     C           *IN77     IFEQ '0'
218800200529     C                     Z-ADDS1RRN     WKFRRN
218900200529     C                     END
219000200529     C*
219100200529     C                     SETON                     877736
219200200529     C                     SETON                     78
219300200529     C                     END
219400200529     C*
219500200529     C                     END
219600200529     C*
219700200529     C                     END
219800200529     C*
219900200529     C           VLACC     TAG
220000200529     C********************************************************************
220100200529     C**   VALIDATE ACTION CODE FURTHER                                  *
220200200529     C********************************************************************
220300200529     C*
220400200529     C** IF ACTION CODE OF 'D' ENTERED NO DETAILS MAY HAVE CHANGED
220500200529     C           S1ACTN    IFEQ 'D'                        B1
220600200529     C*
220700200529     C           S1ACTF    IFNE S1HACT                     B2
220800200529     C           S1CURR    ORNE S1HCCY
220900200529     C           S1ACCV    ORNE S1HACC
221000200529     C           S1CDTE    ORNE S1HDAT
221100200529     C           S1BRCA    ORNE S1HBRC                                    S01464
221200200529     C           *IN50     ANDEQ'1'                                       S01464
221300200529     C                     MOVEL'SE05017' ZAMSID
221400200529     C                     EXSR ZASNMS
221500200529     C*
221600200529     C* If first error save RRN to position Subfile at first field in
221700200529     C* error.
221800200529     C*
221900200529     C           *IN77     IFEQ '0'                        B3
222000200529     C                     Z-ADDS1RRN     WKFRRN
222100200529     C                     END                             E3
222200200529     C*
222300200529     C                     SETON                     817736
222400200529     C                     SETON                     78
222500200529     C*
222600200529     C                     END                             E2
222700200529     C*
222800200529     C                     END                             E1
222900200529     C*                                                                   S01464
223000200529     C********************************************************************S01464
223100200529     C**   VALIDATE SETTLEMENT BRANCH                                    *S01464
223200200529     C********************************************************************S01464
223300200529     C*                                                                   S01464
223400200529     C*                                                                   S01464
223500200529     C* Entry is mandatory unless account entered is a retail account     S01464
223600200529     C*                                                                   S01464
223700200529     C* This is done only for multi-branch environment                    S01464
223800200529     C*                                                                   S01464
223900200529     C           *IN50     IFEQ '1'                        B1             S01464
224000200529     C***********S1ACTN    ANDEQ*BLANKS                            S01464 092108
224100200529     C           S1BRCA    IFNE *BLANKS                    B2             S01464
224200200529     C**********           CALL 'AOBRCHR0'                                S01464              CGL029
224300200529     C                     CALL 'AOBRCHR1'                                                    CGL029
224400200529     C                     PARM '*BLANKS' @RTCD   7                       S01464
224500200529     C                     PARM '*KEY   ' @OPTN   7                       S01464
224600200529     C                     PARM S1BRCA    @DSNB   3                       S01464
224700200529     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01464              CGL029
224800200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
224900200529     C*                                                                   S01464
225000200529     C           @RTCD     IFNE *BLANKS                    B3             S01464
225100200529     C           @RTCD     ANDNE'*NOSEL '                                 S01464
225200200529     C                     MOVEL'SE05020' ZAMSID                          S01464
225300200529     C                     EXSR ZASNMS                                    S01464
225400200529     C*                                                                   S01464
225500200529     C* If first error save RRN to position Subfile at first field in     S01464
225600200529     C* error.                                                            S01464
225700200529     C*                                                                   S01464
225800200529     C           *IN77     IFEQ '0'                        B4             S01464
225900200529     C                     Z-ADDS1RRN     WKFRRN                          S01464
226000200529     C                     END                             E4             S01464
226100200529     C                     SETON                     527736               S01464
226200200529     C                     SETON                     78                   S01464
226300200529     C                     MOVE '1'       WKEROR                          S01464
226400200529     C*                                                                   S01464
226500200529     C                     ELSE                            X3             S01464
226600200529     C                     MOVE A8BRCD    S1BRCA                          S01464
226700200529     C           @RTCD     IFEQ '*NOSEL '                  B4             S01464
226800200529     C                     MOVE *BLANKS   S1BRCA                          S01464
226900200529     C                     END                             E4             S01464
227000200529     C                     END                             E3             S01464
227100200529     C                     END                             E2             S01464
227200200529     C*                                                                   S01464
227300200529     C           S1BRCA    IFEQ *BLANKS                    B2             S01464
227400200529     C           WKACC2    ANDNE*BLANKS                                   092108
227500200529     C***********ATYP      ANDNE'R'                                S01464 092108
227600200529     C                     MOVEL'SE05021' ZAMSID                          S01464
227700200529     C                     EXSR ZASNMS                                    S01464
227800200529     C*                                                                   S01464
227900200529     C* If first error save RRN to position Subfile at first field in     S01464
228000200529     C* error.                                                            S01464
228100200529     C*                                                                   S01464
228200200529     C           *IN77     IFEQ '0'                        B3             S01464
228300200529     C                     Z-ADDS1RRN     WKFRRN                          S01464
228400200529     C                     END                             E3             S01464
228500200529     C                     SETON                     527736               S01464
228600200529     C                     SETON                     78                   S01464
228700200529     C                     MOVE '1'       WKEROR                          S01464
228800200529     C                     END                             E2             S01464
228900200529     C*                                                                   S01464
229000200529     C           S1BRCA    IFNE *BLANKS                    B2             S01464
229100200529     C           @RTCD     ANDEQ*BLANKS                                   S01464
229200200529     C           WKACC2    ANDNE*BLANKS                                   092108
229300200529     C           ACNTK2    CHAINACCNT                48                   S01464
229400200529     C*                                                                   S01464
229500200529     C           *IN48     IFEQ '1'                        B3             S01464
229600200529     C           RECI      OREQ '*'                                       S01464
229700200529     C                     MOVEL'SE05022' ZAMSID                          S01464
229800200529     C                     EXSR ZASNMS                                    S01464
229900200529     C*                                                                   S01464
230000200529     C* If first error save RRN to position Subfile at first field in     S01464
230100200529     C* error.                                                            S01464
230200200529     C*                                                                   S01464
230300200529     C           *IN77     IFEQ '0'                        B4             S01464
230400200529     C                     Z-ADDS1RRN     WKFRRN                          S01464
230500200529     C                     END                             E4             S01464
230600200529     C                     SETON                     527736               S01464
230700200529     C                     SETON                     788687               S01464
230800200529     C                     END                             E3             S01464
230900200529     C                     END                             E2             S01464
231000200529     C*                                                                   092108
231100200529     C** Check that the branch code of the retail account matches         092108
231200200529     C** the settlement branch entered on screen.  If the screen value    092108
231300200529     C** is blank, use the branch field from the retail account.          092108
231400200529     C*                                                                   092108
231500200529     C           WKACC2    IFEQ *BLANKS                                   092108
231600200529     C           *IN52     ANDEQ'0'                                       092108
231700200529     C*                                                                   092108
231800200529     C           S1BRCA    IFEQ *BLANKS                                   092108
231900200529     C                     MOVE BRCA      S1BRCA                          092108
232000200529     C                     ELSE                                           092108
232100200529     C*                                                                   092108
232200200529     C           S1BRCA    IFNE BRCA                                      092108
232300200529     C*                                                                   092108
232400200529     C                     MOVEL'SE05026' ZAMSID                          092108
232500200529     C                     EXSR ZASNMS                                    092108
232600200529     C*                                                                   092108
232700200529     C** If first error save RRN to position Subfile at first field in    092108
232800200529     C** error.                                                           092108
232900200529     C*                                                                   092108
233000200529     C           *IN77     IFEQ '0'                                       092108
233100200529     C                     Z-ADDS1RRN     WKFRRN                          092108
233200200529     C                     END                                            092108
233300200529     C*                                                                   092108
233400200529     C                     SETON                     527736               092108
233500200529     C                     SETON                     7887                 092108
233600200529     C                     END                                            092108
233700200529     C*                                                                   092108
233800200529     C                     END                                            092108
233900200529     C*                                                                   092108
234000200529     C                     END                                            092108
234100200529     C*                                                                   S01464
234200200529     C                     END                             E1             S01464
234300200529     C*                                                                  *
234400200529     C********************************************************************
234500200529     C**   VALIDATE SETTLEMENT DATE                                      *
234600200529     C********************************************************************
234700200529     C*
234800200529     C*
234900200529     C* Settlement Date must be a valid date.
235000200529     C*
235100200529     C* Call ZALIGN to validate if numeric or not.
235200200529     C*
235300200529     C                     Z-ADD0         ZADEC
235400200529     C                     Z-ADD6         ZADIG
235500200529     C                     MOVE '0'       *IN99
235600200529     C                     MOVE *BLANKS   ZFIELD
235700200529     C                     MOVE S1CDTE    ZFIELD
235800200529     C                     EXSR ZALIGN
235900200529     C*
236000200529     C           *IN99     IFEQ '0'                        B2
236100200529     C                     MOVE S1CDTE    ZDATE
236200200529     C                     EXSR ZDATE1
236300200529     C                     END                             E2
236400200529     C*
236500200529     C           *IN99     IFEQ '1'                        B2
236600200529     C*
236700200529     C                     MOVEL'SE05008' ZAMSID
236800200529     C                     EXSR ZASNMS
236900200529     C*
237000200529     C* If first error save RRN to position Subfile at first field in
237100200529     C* error.
237200200529     C*
237300200529     C           *IN77     IFEQ '0'                        B3
237400200529     C                     Z-ADDS1RRN     WKFRRN
237500200529     C                     END                             E3
237600200529     C*
237700200529     C                     SETON                     897736
237800200529     C                     SETON                     78
237900200529     C                     END                             E2
238000200529     C*                                                                   049067
238100200529     C** VALIDATE UNIQUENESS OF RECORD & DATE NOT AMENDED :               049067
238200200529     C** VALIDATE WHETHER CUSTOMER/PORTFOLIO/DATE ALREADY ON SEOCFSPD     049067
238300200529     C*                                                                   049067
238400200529     C           *IN45     IFEQ '1'                        B1             049067
238500200529     C* If insert                                                         049067
238600200529     C                     MOVELWKCNUM    SECNUM                          049067
238700200529     C                     MOVELWKPTFR    SEPTFR                          049067
238800200529     C                     MOVE S1CDTE    ZDATE                           049067
238900200529     C                     EXSR ZDATE1                                    049067
239000200529     C                     Z-ADDZDAYNO    SESEVD                          049067
239100200529     C           FSPDKY    CHAINSEOCFSP0             71                   049067
239200200529     C           *IN71     IFEQ '0'                        B2             049067
239300200529     C                     MOVEL'SE05019' ZAMSID                          049067
239400200529     C                     EXSR ZASNMS                                    049067
239500200529     C*                                                                   049067
239600200529     C* If first error save RRN to position Subfile at first field in     049067
239700200529     C* error.                                                            049067
239800200529     C*                                                                   049067
239900200529     C           *IN77     IFEQ '0'                        B3             049067
240000200529     C                     Z-ADDS1RRN     WKFRRN                          049067
240100200529     C                     END                             E3             049067
240200200529     C*                                                                   049067
240300200529     C                     SETON                     897736               049067
240400200529     C                     SETON                     78                   049067
240500200529     C                     END                             E2             049067
240600200529      *                                                                   049067
240700200529     C***********          ELSE                            X1      049067 065025
240800200529     C**VALIDATE*WHETHER DATE HAS BEEN AMENDED                     049067 065025
240900200529     C***********S1CDTE    IFNE S1HDAT                     B2      049067 065025
241000200529     C***********          MOVEL'SE05018' ZAMSID                   049067 065025
241100200529     C***********          EXSR ZASNMS                             049067 065025
241200200529     C***********                                                  049067 065025
241300200529     C**If*first*error save RRN to position Subfile at first field in 049 065025
241400200529     C**error.***                                                  049067 065025
241500200529     C***********                                                  049067 065025
241600200529     C************IN77     IFEQ '0'                        B3      049067 065025
241700200529     C***********          Z-ADDS1RRN     WKFRRN                   049067 065025
241800200529     C***********          END                             E3      049067 065025
241900200529     C***********                                                  049067 065025
242000200529     C***********          SETON                     897736        049067 065025
242100200529     C***********          SETON                     78            049067 065025
242200200529     C***********          END                             E2      049067 065025
242300200529     C                     END                             E1             049067
242400200529     C*
242500200529     C           VLDAT     TAG
242600200529     C*
242700200529     C**   IF VALIDATION SUCCESSFUL
242800200529     C*
242900200529     C           *IN78     IFEQ '0'                        B1
243000200529     C*
243100200529     C**   IF NO FIELDS CHANGED
243200200529     C*
243300200529     C           S1ACTF    IFEQ S1HACT                     B2
243400200529     C           S1CURR    ANDEQS1HCCY
243500200529     C           S1ACCV    ANDEQS1HACC
243600200529     C           S1CDTE    ANDEQS1HDAT
243700200529     C           S1BRCA    ANDEQS1HBRC                                    S01464
243800200529     C                     MOVE 'N'       S1UPDT
243900200529     C                     MOVE '0'       *IN36
244000200529     C                     ELSE                            X2
244100200529     C                     MOVE 'Y'       S1UPDT
244200200529     C                     MOVE '1'       *IN36
244300200529     C                     MOVE '1'       *IN66
244400200529     C                     END                             E2
244500200529     C*
244600200529     C           S1ACTN    IFNE *BLANKS                    B2
244700200529     C                     MOVE 'Y'       S1UPDT
244800200529     C                     MOVE '1'       *IN36
244900200529     C                     MOVE '1'       *IN66
245000200529     C                     END                             E2
245100200529     C*
245200200529     C                     ELSE                            X1
245300200529     C                     MOVE 'N'       S1UPDT
245400200529     C                     MOVE '1'       *IN36
245500200529     C                     END                             E1
245600200529     C*
245700200529     C*
245800200529     C                     ENDSR
245900200529     C/EJECT
246000200529     C********************************************************************
246100200529     C*                                                                  *
246200200529     C*  #CBB      - VALIDATE REVIEW FROM FIELDS                         *
246300200529     C*                                                                  *
246400200529     C*  CALLS     - #CB                                                 *
246500200529     C*                                                                  *
246600200529     C*  CALLED BY - MAINLINE                                            *
246700200529     C*                                                                  *
246800200529     C********************************************************************
246900200529     C           #CBB      BEGSR
247000200529     C*
247100200529     C***********S1PORT    IFNE *BLANKS                                   S01464
247200200529     C***********S1CUST    ORNE *BLANKS                                   S01464
247300200529     C***********                                                         S01464
247400200529     C**Portfolio*may*not*be*entered*without*Customer.                    S01464
247500200529     C***********                                                         S01464
247600200529     C***********S1PORT    IFNE *BLANKS                                   S01464
247700200529     C***********S1CUST    ANDEQ*BLANKS                                   S01464
247800200529     C***********                                                         S01464
247900200529     C***********          MOVEL'SE05001' ZAMSID                          S01464
248000200529     C***********          EXSR ZASNMS                                    S01464
248100200529     C***********          MOVE '1'       WKEROR                          S01464
248200200529     C***********          SETON                     8477                 S01464
248300200529     C***********                                                         S01464
248400200529     C***********          ELSE                                           S01464
248500200529     C*                                                                   091522
248600200529     C           S1PORT    IFNE *BLANKS                                   091522
248700200529     C           S1CUST    ORNE *BLANKS                                   091522
248800200529     C*                                                                   091522
248900200529     C** Portfolio may not be entered without Customer.                   091522
249000200529     C*                                                                   091522
249100200529     C           S1PORT    IFNE *BLANKS                                   091522
249200200529     C           S1CUST    ANDEQ*BLANKS                                   091522
249300200529     C*                                                                   091522
249400200529     C                     MOVEL'SE05001' ZAMSID                          091522
249500200529     C                     EXSR ZASNMS                                    091522
249600200529     C                     MOVE '1'       WKEROR                          091522
249700200529     C                     SETON                     8477                 091522
249800200529     C*                                                                   091522
249900200529     C                     ELSE                                           091522
250000200529     C*
250100200529     C* A valid customer number or Shortname must be entered.
250200200529     C***********                                                         S01464
250300200529     C**Call*ZALIGN*to*validate*CUSTOMER                                  S01464
250400200529     C***********                                                         S01464
250500200529     C***********          MOVE '0'       *IN99                           S01464
250600200529     C***********WKCUSB    IFEQ *BLANKS                                   S01464
250700200529     C***********          Z-ADD0         ZADEC                           S01464
250800200529     C***********          Z-ADD6         ZADIG                           S01464
250900200529     C***********          MOVE *BLANKS   ZFIELD                          S01464
251000200529     C***********          MOVE WKCUSA    ZFIELD                          S01464
251100200529     C***********          EXSR ZALIGN                                    S01464
251200200529     C***********          END                                            S01464
251300200529     C***********                                                         S01464
251400200529     C************IN99     IFEQ '1'                                       S01464
251500200529     C***********WKCUSB    ORNE *BLANKS                                   S01464
251600200529     C***********                                                         S01464
251700200529     C***********S1CUST    CHAINSDCUSTL6             74                   S01464
251800200529     C           S1CUST    IFNE *BLANKS                                   S01464
251900200529     C                     CALL 'AOCUSTR0'                                S01464
252000200529     C                     PARM *BLANKS   @RTCD   7                       S01464
252100200529     C                     PARM '*KEY   ' @OPTN   7                       S01464
252200200529     C                     PARM S1CUST    @KEY1  10                       S01464
252300200529     C                     PARM *BLANKS   @KYST   7                       S01464
252400200529     C           SDCUST    PARM SDCUST    DSSDY                           S01464
252500200529     C*                                                                   S01464
252600200529     C************IN74     IFEQ '1'                                       S01464
252700200529     C           @RTCD     IFNE *BLANKS                                   S01464
252800200529     C           @RTCD     ANDNE'*NOSEL '                                 S01464
252900200529     C           @KYST     OREQ 'ERROR  '                                 S01464
253000200529     C                     MOVEL'SE05002' ZAMSID
253100200529     C                     EXSR ZASNMS
253200200529     C                     SETON                     8377
253300200529     C                     MOVE '1'       WKEROR
253400200529     C                     ELSE                                           S01464
253500200529     C                     MOVELBBCUST    S1CUST                          S01464
253600200529     C           @RTCD     IFEQ '*NOSEL '                                 S01464
253700200529     C                     MOVE *BLANKS   S1CUST                          S01464
253800200529     C                     END                                            S01464
253900200529     C                     END                                            S01464
254000200529     C                     END
254100200529     C*                                                                   S01464
254200200529     C** Validate Branch of Customer                                      S01464
254300200529     C*                                                                   S01464
254400200529     C           *IN50     IFEQ '1'                        B1             S01464
254500200529     C           S1BRCH    IFNE *BLANKS                    B2             S01464
254600200529     C**********           CALL 'AOBRCHR0'                                S01464              CGL029
254700200529     C                     CALL 'AOBRCHR1'                                                    CGL029
254800200529     C                     PARM '*BLANKS' @RTCD   7                       S01464
254900200529     C                     PARM '*KEY   ' @OPTN   7                       S01464
255000200529     C                     PARM S1BRCH    @DSNB   3                       S01464
255100200529     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01464              CGL029
255200200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
255300200529     C*                                                                   S01464
255400200529     C           @RTCD     IFNE *BLANKS                    B3             S01464
255500200529     C           @RTCD     ANDNE'*NOSEL '                                 S01464
255600200529     C                     MOVEL'SE05020' ZAMSID                          S01464
255700200529     C                     EXSR ZASNMS                                    S01464
255800200529     C                     SETON                     5177                 S01464
255900200529     C                     MOVE '1'       WKEROR                          S01464
256000200529     C*                                                                   S01464
256100200529     C                     ELSE                            X3             S01464
256200200529     C                     MOVE A8BRCD    S1BRCH                          S01464
256300200529     C           @RTCD     IFEQ '*NOSEL '                  B4             S01464
256400200529     C                     MOVE *BLANKS   S1BRCH                          S01464
256500200529     C                     END                             E4             S01464
256600200529     C                     END                             E3             S01464
256700200529     C*                                                                   S01464
256800200529     C                     ELSE                            X2             S01464
256900200529     C                     MOVE USRBCH    S1BRCH                          S01464
257000200529     C                     END                             E2             S01464
257100200529     C                     END                             E1             S01464
257200200529     C*
257300200529     C***********          END
257400200529     C***********          END                                            S01464
257500200529     C***********          END                                            S01464
257600200529     C                     END                                            091522
257700200529     C                     END                                            091522
257800200529     C*
257900200529     C                     ENDSR
258000200529     C********************************************************************
258100200529     C*
258200200529     C*
258300200529     C/EJECT
258400200529     C********************************************************************
258500200529     C*                                                                  *
258600200529     C*  #D        - DISPLAY CONFIRM SCREEN                              *
258700200529     C*                                                                  *
258800200529     C*  CALLS     - #YB                                                 *
258900200529     C*                                                                  *
259000200529     C*  CALLED BY - MAINLINE                                            *
259100200529     C*                                                                  *
259200200529     C********************************************************************
259300200529     C           #D        BEGSR
259400200529     C*
259500200529     C* Clear screen message queue.
259600200529     C*
259700200529     C                     CALL 'Y2CLMSC'
259800200529     C                     PARM           WWTPGQ
259900200529     C                     PARM           WWPGQR
260000200529     C*
260100200529     C* Display protected screen with option to Confirm.
260200200529     C*
260300200529     C                     SETOF                     68
260400200529     C                     Z-ADD1         S1RRN
260500200529     C*
260600200529     C* Display Correct Footings.
260700200529     C*
260800200529     C                     SETON                     60
260900200529     C                     SETOF                     616267
261000200529     C*
261100200529     C* Disable CMD 9 and CMD 12.
261200200529     C*
261300200529     C                     SETOF                     4243
261400200529     C*
261500200529     C* Protect fields.
261600200529     C                     SETON                     63
261700200529     C*
261800200529     C* Save Subfile End indicator to previous value.
261900200529     C*
262000200529     C           *IN35     IFEQ '1'
262100200529     C                     MOVE 'Y'       WKSEND  1
262200200529     C                     ELSE
262300200529     C                     MOVE 'N'       WKSEND
262400200529     C                     END
262500200529     C*
262600200529     C* Read First Record on Subfile.
262700200529     C*
262800200529     C           S1RRN     CHAINSE6050S1             75
262900200529     C*
263000200529     C           *IN75     DOWEQ'0'
263100200529     C*
263200200529     C* Reverse Image any changed records to alert user that they
263300200529     C* are going to be update in file.
263400200529     C*
263500200529     C           S1UPDT    IFEQ 'Y'
263600200529     C                     SETON                     49
263700200529     C                     ELSE
263800200529     C                     SETOF                     49
263900200529     C                     END
264000200529     C*
264100200529     C* Protect fields.
264200200529     C                     SETON                     64
264300200529     C*
264400200529     C                     UPDATSE6050S1
264500200529     C*
264600200529     C                     ADD  1         S1RRN
264700200529     C           S1RRN     CHAINSE6050S1             75
264800200529     C                     END
264900200529     C*
265000200529     C           *IN45     IFEQ '1'
265100200529     C                     Z-ADD1         S1RRN
265200200529     C                     ELSE
265300200529     C                     Z-ADDWKSRRN    S1RRN
265400200529     C                     END
265500200529     C*
265600200529     C                     MOVE 'Y'       WKFSRN
265700200529     C                     MOVE 'N'       WKLDCF
265800200529     C                     SETOF                     49
265900200529     C                     SETON                     35
266000200529     C*
266100200529     C                     ENDSR
266200200529     C********************************************************************
266300200529     C*
266400200529     C*
266500200529     C/EJECT
266600200529     C********************************************************************
266700200529     C*                                                                  *
266800200529     C*  #G        - DISPLAY INSERT SCREEN - Insert Mode                 *
266900200529     C*                                                                  *
267000200529     C*  CALLS     - #YB                                                 *
267100200529     C*                                                                  *
267200200529     C*  CALLED BY - MAINLINE                                            *
267300200529     C*                                                                  *
267400200529     C********************************************************************
267500200529     C           #G        BEGSR
267600200529     C*
267700200529     C           *IN28     IFEQ '0'
267800200529     C*
267900200529     C* Clear screen message queue.
268000200529     C*
268100200529     C                     CALL 'Y2CLMSC'
268200200529     C                     PARM           WWTPGQ
268300200529     C                     PARM           WWPGQR
268400200529     C                     ELSE
268500200529     C                     SETOF                     28
268600200529     C                     END
268700200529     C*
268800200529     C* Clear Subfile.
268900200529     C                     SETON                     31
269000200529     C                     WRITESE6050C2
269100200529     C                     SETOF                     31
269200200529     C*
269300200529     C                     MOVE 'N'       WKFSRN
269400200529     C                     MOVE 'N'       WKLDCF
269500200529     C*
269600200529     C* Allow customer and portfolio fields to be input capable.
269700200529     C*
269800200529     C***********          SETOF                     6358
269900200529     C                     SETOF                     63                   S01464
270000200529     C*
270100200529     C* Set on 'non-display of subfile header fields' indicator.
270200200529     C*
270300200529     C                     SETON                     46
270400200529     C*
270500200529     C* Don't display confirm.
270600200529     C*
270700200529     C                     SETON                     68
270800200529     C*
270900200529     C* Not Amend Mode Yet.
271000200529     C*
271100200529     C                     MOVE 'N'       WKINSA
271200200529     C*
271300200529     C* Enable CMD 9, and not CMD 12.
271400200529     C*
271500200529     C                     SETON                     42
271600200529     C                     SETOF                     43
271700200529     C*
271800200529     C                     MOVE *BLANKS   S1CUST
271900200529     C                     MOVE *BLANKS   S1PORT
272000200529     C                     MOVE *BLANKS   S1BRCH                          S01464
272100200529     C*
272200200529     C* Display correct footings.
272300200529     C*
272400200529     C                     SETON                     62
272500200529     C                     SETOF                     606167
272600200529     C*
272700200529     C* Don't display subfile.
272800200529     C*
272900200529     C                     SETOF                     32
273000200529     C*
273100200529     C                     ENDSR
273200200529     C********************************************************************
273300200529     C*
273400200529     C*
273500200529     C/EJECT
273600200529     C********************************************************************
273700200529     C*                                                                  *
273800200529     C*  #F        - RE-DISPLAY UN-PROTECTED SUBFILE                     *
273900200529     C*                                                                  *
274000200529     C*  CALLS     - NONE                                                *
274100200529     C*                                                                  *
274200200529     C*  CALLED BY - #CA                                                 *
274300200529     C*                                                                  *
274400200529     C********************************************************************
274500200529     C           #F        BEGSR
274600200529     C*
274700200529     C* Prepare Display of un-protected screen without Confirm option.
274800200529     C*
274900200529     C                     SETON                     68
275000200529     C                     Z-ADD1         S1RRN
275100200529     C                     MOVE *BLANKS   S1CNFM
275200200529     C*
275300200529     C           *IN45     IFEQ '0'
275400200529     C                     SETOF                     63
275500200529     C                     END
275600200529     C*
275700200529     C* DONT ACCESS SUBFILE IF EMPTY.
275800200529     C*
275900200529     C           WKLRRN    IFGT 0
276000200529     C*
276100200529     C* Read First Record on Subfile.
276200200529     C*
276300200529     C           S1RRN     CHAINSE6050S1             75
276400200529     C*
276500200529     C           *IN75     DOWEQ'0'
276600200529     C*
276700200529     C           S1UPDT    IFEQ 'Y'
276800200529     C                     SETON                     36
276900200529     C                     ELSE
277000200529     C                     SETOF                     36
277100200529     C                     END
277200200529     C*
277300200529     C* Un-Protect fields.
277400200529     C****       S1STAT    IFEQ *BLANKS
277500200529     C****                 SETOF                     64
277600200529     C****                 ELSE
277700200529     C****                 SETON                     64
277800200529     C****                 END
277900200529     C*
278000200529     C           S1STAT    IFEQ 'D'
278100200529     C                     SETON                     64
278200200529     C                     ELSE
278300200529     C                     SETOF                     64
278400200529     C                     END
278500200529     C*
278600200529     C                     UPDATSE6050S1
278700200529     C*
278800200529     C                     ADD  1         S1RRN
278900200529     C           S1RRN     CHAINSE6050S1             75
279000200529     C                     END
279100200529     C*
279200200529     C                     Z-ADD1         S1RRN
279300200529     C                     SETOF                     64
279400200529     C*
279500200529     C                     END
279600200529     C*
279700200529     C                     ENDSR
279800200529     C********************************************************************
279900200529     C*
280000200529     C/EJECT
280100200529     C********************************************************************
280200200529     C*                                                                  *
280300200529     C*  #CE       - VALIDATE INSERT SCREEN -Insert Mode                 *
280400200529     C*                                                                  *
280500200529     C*  CALLS     -                                                     *
280600200529     C*                                                                  *
280700200529     C*  CALLED BY -                                                     *
280800200529     C*                                                                  *
280900200529     C********************************************************************
281000200529     C           #CE       BEGSR
281100200529     C*
281200200529     C* Clear screen message queue.
281300200529     C*
281400200529     C                     CALL 'Y2CLMSC'
281500200529     C                     PARM           WWTPGQ
281600200529     C                     PARM           WWPGQR
281700200529     C*
281800200529     C                     SETOF                     778384
281900200529     C                     SETOF                     51                   S01464
282000200529     C                     MOVE *BLANKS   WKEROR
282100200529     C                     MOVE 'N'       WKSNER  1
282200200529     C*
282300200529     C* A Safe Custody Fees customer number or shortname must be
282400200529     C* entered.
282500200529     C           S1CUST    IFNE *BLANKS                                   S01464
282600200529     C                     CALL 'AOCUSTR0'                                S01464
282700200529     C                     PARM *BLANKS   @RTCD   7                       S01464
282800200529     C                     PARM '*KEY   ' @OPTN   7                       S01464
282900200529     C                     PARM S1CUST    @KEY1  10                       S01464
283000200529     C                     PARM *BLANKS   @KYST   7                       S01464
283100200529     C           SDCUST    PARM SDCUST    DSSDY                           S01464
283200200529     C*                                                                   S01464
283300200529     C           @RTCD     IFNE *BLANKS                                   S01464
283400200529     C           @RTCD     ANDNE'*NOSEL '                                 S01464
283500200529     C           @KYST     OREQ 'ERROR  '                                 S01464
283600200529     C                     MOVE 'Y'       WKSNER                          S01464
283700200529     C                     ELSE                                           S01464
283800200529     C                     MOVELBBCUST    S1CUST                          S01464
283900200529     C           @RTCD     IFEQ '*NOSEL '                                 S01464
284000200529     C                     MOVE *BLANKS   S1CUST                          S01464
284100200529     C                     END                                            S01464
284200200529     C                     END                                            S01464
284300200529     C***********                                                         S01464
284400200529     C**Call*ZALIGN*to*validate*amount.                                   S01464
284500200529     C***********                                                         S01464
284600200529     C***********          MOVE '0'       *IN99                           S01464
284700200529     C***********WKCUSB    IFEQ *BLANKS                    B1             S01464
284800200529     C***********          Z-ADD0         ZADEC                           S01464
284900200529     C***********          Z-ADD6         ZADIG                           S01464
285000200529     C***********          MOVE *BLANKS   ZFIELD                          S01464
285100200529     C***********          MOVE WKCUSA    ZFIELD                          S01464
285200200529     C***********          EXSR ZALIGN                                    S01464
285300200529     C***********          END                             E1             S01464
285400200529     C***********                                                         S01464
285500200529     C**VALUE*entered*is*NUMERIC                                          S01464
285600200529     C***********                                                         S01464
285700200529     C************IN99     IFEQ '0'                        B1             S01464
285800200529     C***********WKCUSB    ANDEQ*BLANKS                                   S01464
285900200529     C***********                                                         S01464
286000200529     C**First*check*for*SC*Fee*Customer*('BFSBJF must = 'Y').             S01464
286100200529     C***********                                                         S01464
286200200529     C************IN09     IFEQ '0'                        B2             S01464
286300200529     C***********WKCUSA    CHAINSDSECSL1             37                   S01464
286400200529     C***********                                                         S01464
286500200529     C************IN37     IFEQ '0'                        B3             S01464
286600200529     C***********WKCUSA    CHAINSDCUSTL5             74                   S01464
286700200529     C***********          MOVE BFCFGC    WWCFGC  2                 48202 S01464
286800200529     C***********          END                             E3             S01464
286900200529     C***********                                                         S01464
287000200529     C************IN74     IFEQ '1'                        B3             S01464
287100200529     C************IN37     OREQ '1'                                       S01464
287200200529     C***********BFSBJF    ORNE 'Y'                                       S01464
287300200529     C***********BBDTDL    ORNE *ZEROS                                    S01464
287400200529     C***********BBDTDL    ANDLEBJRDNB                                    S01464
287500200529     C***********                                                         S01464
287600200529     C***********          MOVEL'SE05011' ZAMSID                          S01464
287700200529     C***********          EXSR ZASNMS                                    S01464
287800200529     C***********          SETON                     8377                 S01464
287900200529     C***********          MOVE '1'       WKEROR                          S01464
288000200529     C***********          END                             E3             S01464
288100200529     C***********          END                             E2             S01464
288200200529     C***********                                                         S01464
288300200529     C***********          ELSE                            X1             S01464
288400200529     C***********                                                         S01464
288500200529     C***********S1CUST    CHAINSDCUSTL6             74                   S01464
288600200529     C***********                                                         S01464
288700200529     C************IN74     IFEQ '1'                                       S01464
288800200529     C***********          MOVE 'Y'       WKSNER                          S01464
288900200529     C***********          END                                            S01464
289000200529     C*                                                                   S01464
289100200529     C* First check for SC Fee Customer ('BFSBJF must = 'Y').
289200200529     C*
289300200529     C************IN74     IFEQ '0'                        B2             S01464
289400200529     C           @RTCD     IFEQ *BLANKS                                   S01464
289500200529     C           BBCUST    CHAINSDSECSL1             37
289600200529     C*
289700200529     C           *IN37     IFEQ '0'                        B3             48202
289800200529     C                     MOVE BFCFGC    WWCFGC  2                       48202
289900200529     C                     END                             E3             48202
290000200529     C*
290100200529     C                     END                             E2
290200200529     C*
290300200529     C************IN74     IFEQ '1'                        B2             S01464
290400200529     C           @RTCD     IFNE *BLANKS                                   S01464
290500200529     C           @RTCD     ANDNE'*NOSEL '                                 S01464
290600200529     C           *IN37     OREQ '1'
290700200529     C           BFSBJF    ORNE 'Y'
290800200529     C           BBDTDL    ORNE *ZEROS
290900200529     C           BBDTDL    ANDLEBJRDNB
291000200529     C                     MOVEL'SE05011' ZAMSID
291100200529     C                     EXSR ZASNMS
291200200529     C                     SETON                     8377
291300200529     C                     MOVE '1'       WKEROR
291400200529     C                     END                             E2
291500200529     C*
291600200529     C                     END                             E1
291700200529     C*                                                                   S01464
291800200529     C** Validate Branch of Customer                                      S01464
291900200529     C*                                                                   S01464
292000200529     C           *IN50     IFEQ '1'                        B1             S01464
292100200529     C           S1BRCH    IFNE *BLANKS                    B2             S01464
292200200529     C**********           CALL 'AOBRCHR0'                                S01464              CGL029
292300200529     C                     CALL 'AOBRCHR1'                                                    CGL029
292400200529     C                     PARM '*BLANKS' @RTCD   7                       S01464
292500200529     C                     PARM '*KEY   ' @OPTN   7                       S01464
292600200529     C                     PARM S1BRCH    @DSNB   3                       S01464
292700200529     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01464              CGL029
292800200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
292900200529     C*                                                                   S01464
293000200529     C           @RTCD     IFNE *BLANKS                    B3             S01464
293100200529     C           @RTCD     ANDNE'*NOSEL '                                 S01464
293200200529     C                     MOVEL'SE05020' ZAMSID                          S01464
293300200529     C                     EXSR ZASNMS                                    S01464
293400200529     C                     SETON                     5177                 S01464
293500200529     C                     MOVE '1'       WKEROR                          S01464
293600200529     C*                                                                   S01464
293700200529     C                     ELSE                            X3             S01464
293800200529     C                     MOVE A8BRCD    S1BRCH                          S01464
293900200529     C           @RTCD     IFEQ '*NOSEL '                  B4             S01464
294000200529     C                     MOVE *BLANKS   S1BRCH                          S01464
294100200529     C                     END                             E4             S01464
294200200529     C                     END                             E3             S01464
294300200529     C*                                                                   S01464
294400200529     C           S1BRCH    IFNE BBBRCD                                    S01464
294500200529     C                     MOVEL'SE05023' ZAMSID                          S01464
294600200529     C                     EXSR ZASNMS                                    S01464
294700200529     C                     SETON                     5177                 S01464
294800200529     C                     MOVE '1'       WKEROR                          S01464
294900200529     C                     END                                            S01464
295000200529     C*                                                                   S01464
295100200529     C                     ELSE                            X2             S01464
295200200529     C                     MOVE BBBRCD    S1BRCH                          S01464
295300200529     C                     END                             E2             S01464
295400200529     C                     END                             E1             S01464
295500200529     C*                                                                   S01464
295600200529     C** DO SPF VALIDATION FOR BRANCH/ACTION CODE AUTHORITY               S01464
295700200529     C*                                                                   S01464
295800200529     C           *IN50     IFNE '1'                                       S01464
295900200529     C                     CALL 'ZVACTU'                                  S01464
296000200529     C                     PARM 'I'       @ZACTN  1                       S01464
296100200529     C                     PARM           @ERR    10                      S01464
296200200529     C*                                                                   S01464
296300200529     C** If action invalid for user (single entity)                       S01464
296400200529     C*                                                                   S01464
296500200529     C           @ERR      IFEQ 1                                         S01464
296600200529     C                     MOVEL'SEM1019' ZAMSID                          S01464
296700200529     C                     EXSR ZASNMS                                    S01464
296800200529     C                     SETON                     77
296900200529     C                     MOVE '1'       WKEROR
297000200529     C                     END                                            S01464
297100200529     C*                                                                   S01464
297200200529     C                     ELSE                                           S01464
297300200529     C                     CALL 'ZVACTBU'                                 S01464
297400200529     C                     PARM 'I'       @ZACTN  1                       S01464
297500200529     C                     PARM S1BRCH    @BRNCH  3                       S01464
297600200529     C                     PARM           @ERR    10                      S01464
297700200529     C*                                                                   S01464
297800200529     C** If action invalid for user (multientity)                         S01464
297900200529     C*                                                                   S01464
298000200529     C           @ERR      IFEQ 1                                         S01464
298100200529     C                     MOVEL'SEM1020' ZAMSID                          S01464
298200200529     C                     EXSR ZASNMS                                    S01464
298300200529     C                     SETON                     77
298400200529     C                     MOVE '1'       *IN51                           S01464
298500200529     C                     MOVE '1'       WKEROR
298600200529     C                     END                                            S01464
298700200529     C*                                                                   S01464
298800200529     C           @ERR      IFEQ 2                                         S01464
298900200529     C                     MOVEL'SEM1021' ZAMSID                          S01464
299000200529     C                     EXSR ZASNMS                                    S01464
299100200529     C                     SETON                     77
299200200529     C                     MOVE '1'       WKEROR
299300200529     C                     MOVE '1'       *IN51                           S01464
299400200529     C                     END                                            S01464
299500200529     C                     END                                            S01464
299600200529     C*                                                                   S01464
299700200529     C***********                                                         S01464
299800200529     C**Validate*Portfolio.                                               S01464
299900200529     C***********                                                         S01464
300000200529     C***********S1PORT    IFNE *BLANKS                    B1             S01464
300100200529     C***********                                                         S01464
300200200529     C***********S1PORT    IFNE P9R997                     B2             S01464
300300200529     C***********S1PORT    ANDNEP9R999                                    S01464
300400200529     C***********S1PORT    ANDNE*BLANKS                                   S01464
300500200529     C***********                                                         S01464
300600200529     C***********          MOVE BBCUST    PNCNUM                          S01464
300700200529     C***********          MOVE S1PORT    PNPTFR                          S01464
300800200529     C*
300900200529     C****       PORTKY    CHAINPMPORTLL             71                   48202
301000200529     C***********PORTKY    CHAINPMPORTPP             71             48202 S01464
301100200529     C***********                                                         S01464
301200200529     C**Must*be*a*live*record.                                            S01464
301300200529     C***********                                                         S01464
301400200529     C************IN71     IFEQ '1'                        B3             S01464
301500200529     C***********PNRECI    OREQ '*'                                       S01464
301600200529     C****                 MOVEL'SE05011' ZAMSID                          S01355
301700200529     C***********          MOVEL'SE05018' ZAMSID                    S01355S01464
301800200529     C***********          EXSR ZASNMS                                    S01464
301900200529     C***********          SETON                     8477                 S01464
302000200529     C***********          MOVE '1'       WKEROR                          S01464
302100200529     C***********          END                             E3             S01464
302200200529     C************IN71     IFEQ '0'                        B3        48202S01464
302300200529     C***********          MOVE PNCFGC    WWCFGC  2                  48202S01464
302400200529     C***********          END                             E3        48202S01464
302500200529     C***********                                                         S01464
302600200529     C***********                                                         S01464
302700200529     C***********          END                             E2             S01464
302800200529     C***********          END                             E1             S01464
302900200529     C*                                                                   091522
303000200529     C** Validate Portfolio.                                              091522
303100200529     C*                                                                   091522
303200200529     C           S1PORT    IFNE *BLANKS                                   091522
303300200529     C*                                                                   091522
303400200529     C           S1PORT    IFNE FCR997                                    091522
303500200529     C           S1PORT    ANDNEFCR999                                    091522
303600200529     C           S1PORT    ANDNE*BLANKS                                   091522
303700200529     C           BGN4ST    OREQ 'Y'                                       CPB001
303800200529     C*                                                                   091522
303900200529     C                     MOVE BBCUST    PNCNUM                          091522
304000200529     C                     MOVE S1PORT    PNPTFR                          091522
304100200529     C*                                                                   091522
304200200529     C           PORTKY    CHAINPMPORTPD             71                   091522
304300200529     C*                                                                   091522
304400200529     C* Must be a live record.                                            091522
304500200529     C*                                                                   091522
304600200529     C           *IN71     IFEQ '1'                                       091522
304700200529     C           PNRECI    OREQ '*'                                       091522
304800200529     C                     MOVEL'SE05018' ZAMSID                          091522
304900200529     C                     EXSR ZASNMS                                    091522
305000200529     C                     SETON                     8477                 091522
305100200529     C                     MOVE '1'       WKEROR                          091522
305200200529     C                     END                                            091522
305300200529     C*                                                                   091522
305400200529     C           *IN71     IFEQ '0'                                       091522
305500200529     C                     MOVE PNCFGC    WWCFGC  2                       091522
305600200529     C                     END                                            091522
305700200529     C*                                                                   091522
305800200529     C                     END                                            091522
305900200529     C*                                                                   091522
306000200529     C                     END                                            091522
306100200529     C*
306200200529     C** IF BOTH CUSTOMER AND PORTFOLIO BLANK SET OFF ERROR INDICATORS
306300200529     C** AND F9 SETOFF ERROR INDICATORS
306400200529     C           *IN09     IFEQ '1'
306500200529     C           WKSNER    ANDEQ'N'
306600200529     C                     SETOF                     838477
306700200529     C                     SETOF                     51                   S01464
306800200529     C                     CALL 'Y2CLMSC'
306900200529     C                     PARM           WWTPGQ
307000200529     C                     PARM           WWPGQR
307100200529     C                     END
307200200529     C*
307300200529     C** CHECK WHETHER ACCRUALS EXIST ON PF/SESCFAPD FOR CUSTOMER AND
307400200529     C** PORTFOLIO
307500200529     C           *IN77     IFEQ '0'                        B1
307600200529     C           *IN09     ANDEQ'0'                        B1
307700200529     C*
307800200529     C           S1CUST    IFNE *BLANKS                    B2
307900200529     C***********S1PORT    ANDEQ*BLANKS                                   S01464
308000200529     C           S1PORT    ANDEQ*BLANKS                                   091522
308100200529     C*
308200200529     C           WKCUSB    IFEQ *BLANKS
308300200529     C                     MOVELS1CUST    WKCNUM
308400200529     C                     MOVELS1CUST    S1CUSS
308500200529     C                     ELSE
308600200529     C                     MOVE BBCUST    WKCNUM
308700200529     C                     MOVE BBCUST    S1CUSS
308800200529     C                     END
308900200529     C*
309000200529     C                     MOVE *LOVAL    WKPTFR
309100200529     C***********          MOVE S1BRCH    WKBRCA                   S01464 091522
309200200529     C***********FAXKEY    SETLLSCSCFAXX                                  S01464
309300200529     C           FAXKEY    SETLLSESCFAXX                                  S01464
309400200529     C***********          READ SCSCFAXX                 71               S01464
309500200529     C                     READ SESCFAXX                 71               S01464
309600200529     C*
309700200529     C** IF NO RECORD FOUND FOR CUSTOMER ERROR
309800200529     C           *IN71     IFEQ '1'                        B3
309900200529     C           SDCNUM    ORNE WKCNUM
310000200529     C                     MOVEL'SE05014' ZAMSID
310100200529     C                     EXSR ZASNMS
310200200529     C                     SETON                     8477
310300200529     C                     MOVE '1'       WKEROR
310400200529     C                     END                             E3
310500200529     C                     END                             E2
310600200529     C***********                                                         S01464
310700200529     C***IF*PORTFOLIO*REFERENCE*ENTERED*CHECK*THAT*EXIXTS*ON*FILE         S01464
310800200529     C***********                                                         S01464
310900200529     C***********S1CUST    IFNE *BLANKS                    B2             S01464
311000200529     C***********S1PORT    ANDNE*BLANKS                                   S01464
311100200529     C***********                                                         S01464
311200200529     C***********WKCUSB    IFEQ *BLANKS                                   S01464
311300200529     C***********          MOVELS1CUST    WKCNUM                          S01464
311400200529     C***********          MOVELS1CUST    S1CUSS                          S01464
311500200529     C***********          ELSE                                           S01464
311600200529     C***********          MOVE BBCUST    WKCNUM                          S01464
311700200529     C***********          MOVE BBCUST    S1CUSS                          S01464
311800200529     C***********          END                                            S01464
311900200529     C***********                                                         S01464
312000200529     C***********S1PORT    IFEQ P9R997                     B3             S01464
312100200529     C***********          MOVE '9997'    WKPTFR                          S01464
312200200529     C***********          END                             E3             S01464
312300200529     C***********                                                         S01464
312400200529     C***********S1PORT    IFEQ P9R999                     B3             S01464
312500200529     C***********          MOVE '9999'    WKPTFR                          S01464
312600200529     C***********          END                             E3             S01464
312700200529     C***********                                                         S01464
312800200529     C***********S1PORT    IFNE P9R997                     B3             S01464
312900200529     C***********S1PORT    ANDNEP9R999                                    S01464
313000200529     C***********S1PORT    ANDNE*BLANKS                                   S01464
313100200529     C***********          MOVE S1PORT    WKPTFR                          S01464
313200200529     C***********          END                             E3             S01464
313300200529     C***********                                                         S01464
313400200529     C***********FAXKEY    SETLLSCSCFAXX                                  S01464
313500200529     C***********          READ SCSCFAXX                 71               S01464
313600200529     C************                                                        S01464
313700200529     C***IF*NO*RECORD*FOUN*FOR*CUSTOMER*ERROR                             S01464
313800200529     C************IN71     IFEQ '1'                        B3             S01464
313900200529     C***********SDCNUM    ORNE WKCNUM                                    S01464
314000200529     C***********SDPTFR    ORNE WKPTFR                                    S01464
314100200529     C***********          MOVEL'SE05013' ZAMSID                          S01464
314200200529     C***********          EXSR ZASNMS                                    S01464
314300200529     C***********          SETON                     847783               S01464
314400200529     C***********          MOVE '1'       WKEROR                          S01464
314500200529     C***********          END                                            S01464
314600200529     C***********          END                                            S01464
314700200529     C*                                                                   091522
314800200529     C** If Portfolio Reference entered, check that it exists on file     091522
314900200529     C*                                                                   091522
315000200529     C           S1CUST    IFNE *BLANKS                                   091522
315100200529     C           S1PORT    ANDNE*BLANKS                                   091522
315200200529     C*                                                                   091522
315300200529     C           WKCUSB    IFEQ *BLANKS                                   091522
315400200529     C                     MOVELS1CUST    WKCNUM                          091522
315500200529     C                     MOVELS1CUST    S1CUSS                          091522
315600200529     C                     ELSE                                           091522
315700200529     C                     MOVE BBCUST    WKCNUM                          091522
315800200529     C                     MOVE BBCUST    S1CUSS                          091522
315900200529     C                     END                                            091522
316000200529     C*                                                                   091522
316100200529     C           S1PORT    IFEQ FCR997                                    091522
316200200529     C           BGN4ST    ANDNE'Y'                                       CPB001
316300200529     C                     MOVE '9997'    WKPTFR                          091522
316400200529     C                     END                                            091522
316500200529     C*                                                                   091522
316600200529     C           S1PORT    IFEQ FCR999                                    091522
316700200529     C           BGN4ST    ANDNE'Y'                                       CPB001
316800200529     C                     MOVE '9999'    WKPTFR                          091522
316900200529     C                     END                                            091522
317000200529     C*                                                                   091522
317100200529     C           S1PORT    IFNE FCR997                                    091522
317200200529     C           S1PORT    ANDNEFCR999                                    091522
317300200529     C           S1PORT    ANDNE*BLANKS                                   091522
317400200529     C           S1PORT    OREQ FCR997                                    CPB001
317500200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
317600200529     C           S1PORT    OREQ FCR999                                    CPB001
317700200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
317800200529     C                     MOVE S1PORT    WKPTFR                          091522
317900200529     C                     END                                            091522
318000200529     C*                                                                   091522
318100200529     C           FAXKEY    SETLLSESCFAXX                                  091522
318200200529     C                     READ SESCFAXX                 71               091522
318300200529     C*                                                                   091522
318400200529     C** If no record found for customer, error.                          091522
318500200529     C*                                                                   091522
318600200529     C           *IN71     IFEQ '1'                                       091522
318700200529     C           SDCNUM    ORNE WKCNUM                                    091522
318800200529     C           SDPTFR    ORNE WKPTFR                                    091522
318900200529     C                     MOVEL'SE05013' ZAMSID                          091522
319000200529     C                     EXSR ZASNMS                                    091522
319100200529     C                     SETON                     847783               091522
319200200529     C                     MOVE '1'       WKEROR                          091522
319300200529     C                     END                                            091522
319400200529     C*                                                                   091522
319500200529     C                     END                                            091522
319600200529     C*                                                                   091522
319700200529     C                     END                             E1
319800200529     C*
319900200529     C* If CMD 9 pressed then go back to First screen
320000200529     C*
320100200529     C                     MOVE 'N'       WKINSA
320200200529     C           *IN77     IFEQ '0'                        B1
320300200529     C*
320400200529     C** SET OFF ERROR INDICATORS
320500200529     C                     SETOF                     46
320600200529     C                     MOVE 'N'       WKINER  1
320700200529     C*
320800200529     C           *IN09     IFEQ '1'                        B2
320900200529     C                     SETOF                     454609
321000200529     C                     SETOF                     818283
321100200529     C                     SETOF                     5152                 S01464
321200200529     C                     SETOF                     848687
321300200529     C                     SETOF                     89
321400200529     C                     MOVE 'N'       WKINER
321500200529     C                     EXSR #B
321600200529     C*                                                                   S01464
321700200529     C           S1BRCH    IFEQ *BLANKS                                   S01464
321800200529     C                     MOVE USRBCH    S1BRCH                          S01464
321900200529     C                     END                                            S01464
322000200529     C*                                                                   S01464
322100200529     C** Check if authorise to default branch                             S01464
322200200529     C*                                                                   S01464
322300200529     C           *IN50     IFEQ '1'                                       S01464
322400200529     C                     CALL 'ZVACTBU'                                 S01464
322500200529     C                     PARM 'A'       @ZACTN  1                       S01464
322600200529     C                     PARM S1BRCH    @BRNCH  3                       S01464
322700200529     C                     PARM           @ERR    10                      S01464
322800200529     C                     MOVE *BLANKS   WWEROR                          S01464
322900200529     C*                                                                   S01464
323000200529     C                     ELSE                                           S01464
323100200529     C                     CALL 'ZVACTU'                                  S01464
323200200529     C                     PARM 'A'       @ZACTN  1                       S01464
323300200529     C                     PARM           @ERR    10                      S01464
323400200529     C                     END                                            S01464
323500200529     C*                                                                   S01464
323600200529     C** If action invalid for user                                       S01464
323700200529     C*                                                                   S01464
323800200529     C           @ERR      IFEQ 1                                         S01464
323900200529     C           @ERR      OREQ 2                                         S01464
324000200529     C                     MOVEL'1'       WWEROR                          S01464
324100200529     C                     MOVEL'1'       WKEROR                          S01464
324200200529     C                     MOVE '1'       *IN51                           S01464
324300200529     C                     MOVEL'SE05024' ZAMSID                          S01464
324400200529     C                     EXSR ZASNMS                                    S01464
324500200529     C                     END                                            S01464
324600200529     C                     EXSR #YA
324700200529     C*
324800200529     C                     ELSE                            X2
324900200529     C*
325000200529     C* Build Subfile.
325100200529     C                     SETOF                     64
325200200529     C                     EXSR #H
325300200529     C*
325400200529     C                     MOVE 'Y'       WKINSA
325500200529     C                     Z-ADD1         S1RRN
325600200529     C                     Z-ADDS1RRN     WKFRRN
325700200529     C***********          SETOF                     8384                 S01464
325800200529     C                     SETOF                     838452               S01464
325900200529     C*
326000200529     C                     END                             E2
326100200529     C*
326200200529     C* Set 'Error on Insert screen - insert mode' indicator.
326300200529     C*
326400200529     C                     ELSE                            X1
326500200529     C                     MOVE 'Y'       WKINER
326600200529     C                     END                             E1
326700200529     C*
326800200529     C           WKINSA    IFEQ 'Y'
326900200529     C*
327000200529     C* Prepare Screen for Output.
327100200529     C*
327200200529     C* Customer and portfolio fields protected.
327300200529     C*
327400200529     C                     SETON                     63
327500200529     C*
327600200529     C* Subfile not protected.
327700200529     C*
327800200529     C                     SETOF                     64
327900200529     C*
328000200529     C* Confirm non-display.
328100200529     C*
328200200529     C                     SETON                     68
328300200529     C*
328400200529     C* Enable CMD 9 and CMD 12.
328500200529     C*
328600200529     C                     SETON                     4243
328700200529     C*
328800200529     C* Display correct footings.
328900200529     C*
329000200529     C                     SETON                     67
329100200529     C                     SETOF                     606162
329200200529     C*
329300200529     C* Set on Subfile indicators.
329400200529     C*
329500200529     C                     SETON                     353234
329600200529     C*
329700200529     C                     END
329800200529     C*
329900200529     C                     ENDSR
330000200529     C********************************************************************
330100200529     C*
330200200529     C*
330300200529     C/EJECT
330400200529     C********************************************************************
330500200529     C*                                                                  *
330600200529     C*  #CD       - VALIDATE INSERT SCREEN -Amend Mode                  *
330700200529     C*                                                                  *
330800200529     C*  CALLS     -                                                     *
330900200529     C*                                                                  *
331000200529     C*  CALLED BY -                                                     *
331100200529     C*                                                                  *
331200200529     C********************************************************************
331300200529     C           #CD       BEGSR
331400200529     C*                                                                   S01464
331500200529     C           S1BRCH    IFEQ *BLANKS                                   S01464
331600200529     C                     MOVE USRBCH    S1BRCH                          S01464
331700200529     C                     END                                            S01464
331800200529     C*                                                                   S01464
331900200529     C** Check if authorise to default branch                             S01464
332000200529     C*                                                                   S01464
332100200529     C           *IN50     IFEQ '1'                                       S01464
332200200529     C                     CALL 'ZVACTBU'                                 S01464
332300200529     C                     PARM 'A'       @ZACTN  1                       S01464
332400200529     C                     PARM S1BRCH    @BRNCH  3                       S01464
332500200529     C                     PARM           @ERR    10                      S01464
332600200529     C                     MOVE *BLANKS   WWEROR  1                       S01464
332700200529     C*                                                                   S01464
332800200529     C                     ELSE                                           S01464
332900200529     C                     CALL 'ZVACTU'                                  S01464
333000200529     C                     PARM 'A'       @ZACTN  1                       S01464
333100200529     C                     PARM           @ERR    10                      S01464
333200200529     C                     END                                            S01464
333300200529     C*                                                                   S01464
333400200529     C** If action invalid for user                                       S01464
333500200529     C*                                                                   S01464
333600200529     C           @ERR      IFEQ 1                                         S01464
333700200529     C           @ERR      OREQ 2                                         S01464
333800200529     C                     MOVEL'1'       WWEROR                          S01464
333900200529     C                     MOVEL'1'       WKEROR                          S01464
334000200529     C                     MOVE '1'       *IN51                           S01464
334100200529     C                     MOVEL'SE05024' ZAMSID                          S01464
334200200529     C                     EXSR ZASNMS                                    S01464
334300200529     C                     END                                            S01464
334400200529     C*
334500200529     C* If CMD 12 then Output Insert Mode screen again i.e no subfile
334600200529     C* displayed.
334700200529     C*
334800200529     C           *IN12     IFEQ '1'
334900200529     C                     MOVE 'N'       WKINSA
335000200529     C                     SETOF                     818286
335100200529     C***********          SETOF                     8789                 S01464
335200200529     C                     SETOF                     878952               S01464
335300200529     C                     ELSE
335400200529     C*
335500200529     C           *IN09     IFEQ '1'
335600200529     C                     MOVE 'Y'       WKIN09
335700200529     C                     ELSE
335800200529     C*
335900200529     C                     MOVE 'N'       WKIN09
336000200529     C                     END
336100200529     C*  Validate Screen.
336200200529     C*
336300200529     C                     EXSR #CF
336400200529     C*
336500200529     C* If a record has changed and there are no errors on screen
336600200529     C* then set flag to ensure Confirm screen is displayed.
336700200529     C*
336800200529     C           *IN77     IFEQ '0'
336900200529     C*
337000200529     C* Prepare to output Confirm.
337100200529     C*
337200200529     C                     MOVE 'Y'       WKLDCF
337300200529     C*
337400200529     C                     SETOF                     66
337500200529     C*
337600200529     C                     END
337700200529     C*
337800200529     C* Set off SFLNXTCHG and Error Indicator.
337900200529     C*
338000200529     C                     SETOF                     77
338100200529     C*
338200200529     C                     END
338300200529     C*
338400200529     C                     ENDSR
338500200529     C********************************************************************
338600200529     C*
338700200529     C*
338800200529     C/EJECT
338900200529     C********************************************************************
339000200529     C*                                                                  *
339100200529     C*  #CC       - VALIDATION OF CONFIRM SCREEN (Insert Mode)          *
339200200529     C*                                                                  *
339300200529     C*  CALLS     -                                                     *
339400200529     C*                                                                  *
339500200529     C*  CALLED BY - #C                                                  *
339600200529     C*                                                                  *
339700200529     C********************************************************************
339800200529     C           #CC       BEGSR
339900200529     C*
340000200529     C* Clear screen message queue.
340100200529     C*
340200200529     C                     CALL 'Y2CLMSC'
340300200529     C                     PARM           WWTPGQ
340400200529     C                     PARM           WWPGQR
340500200529     C*
340600200529     C* Set of error indicators.
340700200529     C*
340800200529     C                     SETOF                     887765
340900200529     C                     MOVE *BLANKS   WKEROR
341000200529     C*
341100200529     C* Only validate Confirm field.
341200200529     C*
341300200529     C           S1CNFM    IFNE 'Y'
341400200529     C           S1CNFM    ANDNE'N'
341500200529     C                     MOVEL'SE05009' ZAMSID
341600200529     C                     EXSR ZASNMS
341700200529     C                     SETON                     8877
341800200529     C                     MOVE '1'       WKEROR
341900200529     C                     ELSE
342000200529     C*
342100200529     C* Confirm field Valid.
342200200529     C*
342300200529     C           S1CNFM    IFEQ 'Y'
342400200529     C*
342500200529     C* Re-set Subfile End indicator.
342600200529     C*
342700200529     C           WKSEND    IFEQ 'Y'
342800200529     C                     SETON                     35
342900200529     C                     ELSE
343000200529     C                     SETOF                     35
343100200529     C                     END
343200200529     C*
343300200529     C* Process Update.
343400200529     C                     EXSR #K
343500200529     C*
343600200529     C* If update successful and Review from fields not blank then
343700200529     C* clear Subfile and re-load subfile from those values on.
343800200529     C*
343900200529     C           *IN65     IFEQ '0'
344000200529     C*
344100200529     C           WKIN09    IFEQ 'N'
344200200529     C*
344300200529     C* Customer and portfolio fields protected.
344400200529     C*
344500200529     C                     SETON                     63
344600200529     C                     SETON                     4243
344700200529     C                     SETON                     67
344800200529     C                     SETOF                     606162
344900200529     C*
345000200529     C                     EXSR #F
345100200529     C                     MOVE 'N'       WKFSRN
345200200529     C*
345300200529     C                     ELSE
345400200529     C*
345500200529     C* Change Screen next (Amend Mode).
345600200529     C*
345700200529     C*
345800200529     C** MOVE CUSTOMER NUMBER FORM SCREEN OR FROM LF/SDCUSTL6 INTO KEY
345900200529     C                     MOVE S1CUST    WWCHK4  4
346000200529     C           WWCHK4    IFEQ *BLANKS
346100200529     C                     MOVELS1CUST    WKCNUM
346200200529     C                     ELSE
346300200529     C                     MOVE BBCUST    WKCNUM
346400200529     C                     END
346500200529     C***********          MOVE S1BRCH    WKBRCA                   S01464 091522
346600200529     C*
346700200529     C***********S1PORT    IFEQ P9R997                                    S01464
346800200529     C***********          MOVE '9997'    WKPTFR                          S01464
346900200529     C***********          END                                            S01464
347000200529     C***********                                                         S01464
347100200529     C***********S1PORT    IFEQ P9R999                                    S01464
347200200529     C***********          MOVE '9999'    WKPTFR                          S01464
347300200529     C***********          END                                            S01464
347400200529     C***********                                                         S01464
347500200529     C***********S1PORT    IFEQ *BLANKS                                   S01464
347600200529     C***********          MOVE *LOVAL    WKPTFR                   S01464 091522
347700200529     C***********          END                                            S01464
347800200529     C***********                                                         S01464
347900200529     C***********S1PORT    IFNE P9R997                                    S01464
348000200529     C***********S1PORT    ANDNEP9R999                                    S01464
348100200529     C***********S1PORT    ANDNE*BLANKS                                   S01464
348200200529     C***********          MOVE S1PORT    WKPTFR                          S01464
348300200529     C***********          END                                            S01464
348400200529     C*                                                                   091522
348500200529     C           S1PORT    IFEQ FCR997                                    091522
348600200529     C           BGN4ST    ANDNE'Y'                                       CPB001
348700200529     C                     MOVE '9997'    WKPTFR                          091522
348800200529     C                     END                                            091522
348900200529     C*                                                                   091522
349000200529     C           S1PORT    IFEQ FCR999                                    091522
349100200529     C           BGN4ST    ANDNE'Y'                                       CPB001
349200200529     C                     MOVE '9999'    WKPTFR                          091522
349300200529     C                     END                                            091522
349400200529     C*                                                                   091522
349500200529     C           S1PORT    IFEQ *BLANKS                                   091522
349600200529     C                     MOVE *LOVAL    WKPTFR                          091522
349700200529     C                     END                                            091522
349800200529     C*                                                                   091522
349900200529     C           S1PORT    IFNE FCR997                                    091522
350000200529     C           S1PORT    ANDNEFCR999                                    091522
350100200529     C           S1PORT    ANDNE*BLANKS                                   091522
350200200529     C           S1PORT    OREQ FCR997                                    CPB001
350300200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
350400200529     C           S1PORT    OREQ FCR999                                    CPB001
350500200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
350600200529     C                     MOVE S1PORT    WKPTFR                          091522
350700200529     C                     END                                            091522
350800200529     C*
350900200529     C***********FAXKEY    SETLLSCOCFSXX                                  S01464
351000200529     C           FAXKEY    SETLLSEOCFSXX                                  S01464
351100200529     C                     SETOF                     4589
351200200529     C                     SETOF                     818283
351300200529     C                     SETOF                     5152                 S01464
351400200529     C                     SETOF                     848687
351500200529     C                     MOVE *BLANKS   S1ACTN
351600200529     C                     MOVE *BLANKS   S1CUST
351700200529     C                     MOVE *BLANKS   S1PORT
351800200529     C                     MOVE 'N'       WKFSRN
351900200529     C                     MOVE 'N'       WKINSA
352000200529     C                     EXSR #B
352100200529     C*                                                                   S01464
352200200529     C           S1BRCH    IFEQ *BLANKS                                   S01464
352300200529     C                     MOVE USRBCH    S1BRCH                          S01464
352400200529     C                     END                                            S01464
352500200529     C*                                                                   S01464
352600200529     C** Check if authorise to default branch                             S01464
352700200529     C*                                                                   S01464
352800200529     C           *IN50     IFEQ '1'                                       S01464
352900200529     C                     CALL 'ZVACTBU'                                 S01464
353000200529     C                     PARM 'A'       @ZACTN  1                       S01464
353100200529     C                     PARM S1BRCH    @BRNCH  3                       S01464
353200200529     C                     PARM           @ERR    10                      S01464
353300200529     C                     MOVE *BLANKS   WWEROR  1                       S01464
353400200529     C*                                                                   S01464
353500200529     C                     ELSE                                           S01464
353600200529     C                     CALL 'ZVACTU'                                  S01464
353700200529     C                     PARM 'A'       @ZACTN  1                       S01464
353800200529     C                     PARM           @ERR    10                      S01464
353900200529     C                     END                                            S01464
354000200529     C*                                                                   S01464
354100200529     C** If action invalid for user                                       S01464
354200200529     C*                                                                   S01464
354300200529     C           @ERR      IFEQ 1                                         S01464
354400200529     C           @ERR      OREQ 2                                         S01464
354500200529     C                     MOVEL'1'       WWEROR                          S01464
354600200529     C                     MOVEL'1'       WKEROR                          S01464
354700200529     C                     MOVE '1'       *IN51                           S01464
354800200529     C                     MOVEL'SE05024' ZAMSID                          S01464
354900200529     C                     EXSR ZASNMS                                    S01464
355000200529     C                     END                                            S01464
355100200529     C                     EXSR #YA
355200200529     C*
355300200529     C                     END
355400200529     C*
355500200529     C                     ELSE
355600200529     C*
355700200529     C                     Z-ADDWKFRRN    S1RRN
355800200529     C                     END
355900200529     C*
356000200529     C                     ELSE
356100200529     C*
356200200529     C* Prepare to output original unprotected subfile again.
356300200529     C*
356400200529     C* Customer and portfolio fields protected.
356500200529     C*
356600200529     C                     SETON                     63
356700200529     C*
356800200529     C* Enable CMD 9 and CMD 12.
356900200529     C*
357000200529     C                     SETON                     4243
357100200529     C*
357200200529     C* Display correct footings.
357300200529     C*
357400200529     C                     SETON                     67
357500200529     C                     SETOF                     606162
357600200529     C*
357700200529     C                     EXSR #F
357800200529     C                     MOVE 'N'       WKFSRN
357900200529     C                     END
358000200529     C*
358100200529     C                     END
358200200529     C*
358300200529     C                     ENDSR
358400200529     C********************************************************************
358500200529     C*
358600200529     C*
358700200529     C/EJECT
358800200529     C********************************************************************
358900200529     C*                                                                  *
359000200529     C*  #H        - LOAD SUBFILE - INSERT MODE                          *
359100200529     C*                                                                  *
359200200529     C*  CALLS     -                                                     *
359300200529     C*                                                                  *
359400200529     C*  CALLED BY -                                                     *
359500200529     C*                                                                  *
359600200529     C********************************************************************
359700200529     C*
359800200529     C           #H        BEGSR
359900200529     C*
360000200529     C* Initialize Counter.
360100200529     C                     Z-ADD0         S1RRN
360200200529     C                     Z-ADD0         WKLRRN
360300200529     C           S1RRN     ADD  1         WKFRRN
360400200529     C*
360500200529     C* Clear Subfile.
360600200529     C                     SETON                     31
360700200529     C                     WRITESE6050C2
360800200529     C                     SETOF                     31
360900200529     C*                                                                   S01464
361000200529     C*  IF SPECIFIC PORTFOLIO ENTERED FORMAT DETAILS                     S01464
361100200529     C           S1PORT    IFNE *BLANKS                    B1             S01464
361200200529     C***********                                                         S01464
361300200529     C***IF*CUSTOMER*POSITION*USED*SET*PORTFOLIO*TO*BLANK                 S01464
361400200529     C***********SACFCP    IFEQ 'C'                        B2             S01464
361500200529     C***********          MOVE *BLANKS   S1FOLI                          S01464
361600200529     C***********          ELSE                            X2             S01464
361700200529     C***********                                                         S01464
361800200529     C***SET*FOLIO*UP*CONTAINING*DETAILS*OF*REQUESTED*PORTFOLIO           S01464
361900200529     C***********                                                         S01464
362000200529     C***********SDPTFR    IFEQ '9997'                                    S01464
362100200529     C***********          MOVE P9R997    S1FOLI                          S01464
362200200529     C***********          END                                            S01464
362300200529     C***********                                                         S01464
362400200529     C***********SDPTFR    IFEQ '9999'                                    S01464
362500200529     C***********          MOVE P9R999    S1FOLI                          S01464
362600200529     C***********          END                                            S01464
362700200529     C***********                                                         S01464
362800200529     C***********SDPTFR    IFNE '9997'                                    S01464
362900200529     C***********SDPTFR    ANDNE'9999'                                    S01464
363000200529     C***********          MOVE SDPTFR    S1FOLI                          S01464
363100200529     C***********          END                                            S01464
363200200529     C***********                                                         S01464
363300200529     C***********          EXSR #I                                        S01464
363400200529     C**Write*record*to*subfile.                                          S01464
363500200529     C***********                                                         S01464
363600200529     C***********          ADD  1         S1RRN                           S01464
363700200529     C***********          WRITESE6050S1                                  S01464
363800200529     C***********                                                         S01464
363900200529     C***********          END                             E2             S01464
364000200529     C*                                                                   091522
364100200529     C** If customer position used set portfolio to blank                 091522
364200200529     C*                                                                   091522
364300200529     C           FBCFCP    IFEQ 'C'                                       091522
364400200529     C                     MOVE *BLANKS   S1FOLI                          091522
364500200529     C                     ELSE                                           091522
364600200529     C*                                                                   091522
364700200529     C** Set folio up containing details of requested portfolio           091522
364800200529     C*                                                                   091522
364900200529     C           SDPTFR    IFEQ '9997'                                    091522
365000200529     C           BGN4ST    ANDNE'Y'                                       CPB001
365100200529     C                     MOVE FCR997    S1FOLI                          091522
365200200529     C                     END                                            091522
365300200529     C*                                                                   091522
365400200529     C           SDPTFR    IFEQ '9999'                                    091522
365500200529     C           BGN4ST    ANDNE'Y'                                       CPB001
365600200529     C                     MOVE FCR999    S1FOLI                          091522
365700200529     C                     END                                            091522
365800200529     C*                                                                   091522
365900200529     C           SDPTFR    IFNE '9997'                                    091522
366000200529     C           SDPTFR    ANDNE'9999'                                    091522
366100200529     C           BGN4ST    OREQ 'Y'                                       CPB001
366200200529     C                     MOVE SDPTFR    S1FOLI                          091522
366300200529     C                     END                                            091522
366400200529     C*                                                                   091522
366500200529     C                     EXSR #I                                        091522
366600200529     C*                                                                   091522
366700200529     C** Write record to subfile.                                         091522
366800200529     C*                                                                   091522
366900200529     C                     ADD  1         S1RRN                           091522
367000200529     C                     WRITESE6050S1                                  091522
367100200529     C*                                                                   091522
367200200529     C                     END                             E2             091522
367300200529     C*
367400200529     C** IF CUSTODY FEES NOT REQUESTED FOR SPECIFIC PORTFOLIO
367500200529     C                     ELSE                            X1
367600200529     C*
367700200529     C***********SACFCP    IFEQ 'C'                        B2             S01464
367800200529     C           FBCFCP    IFEQ 'C'                        B2            S01464
367900200529     C*
368000200529     C**   Add one record to subfile for cutomer if fees per customer
368100200529     C**   (not portfolio)
368200200529     C*
368300200529     C                     MOVE *BLANKS   S1FOLI
368400200529     C                     EXSR #I
368500200529     C* Write record to subfile.
368600200529     C*
368700200529     C                     ADD  1         S1RRN
368800200529     C                     WRITESE6050S1
368900200529     C*
369000200529     C                     ELSE                            X2
369100200529     C***********                                                         S01464
369200200529     C*****Add*one*record*to*subfile*for*each*of*the*customers*portfolios S01464
369300200529     C*****which*has*an*accruals*record                                   S01464
369400200529     C***********                                                         S01464
369500200529     C***********          Z-ADDSDCNUM    PNCNUM                          S01464
369600200529     C***********          MOVE *LOVAL    PNPTFR                          S01464
369700200529     C***********                                                         S01464
369800200529     C****       PORTKY    SETLLPMPORTLL                                  48202
369900200529     C****                 READ PMPORTLL                 71               48202
370000200529     C***********PORTKY    SETLLPMPORTPP                            48202 S01464
370100200529     C***********          READ PMPORTPP                 71         48202 S01464
370200200529     C***********                                                         S01464
370300200529     C**Write*records*to*subfile*until*there*are*no                       S01464
370400200529     C**more*records*on*file.                                             S01464
370500200529     C***********                                                         S01464
370600200529     C************IN71     DOWEQ'0'                        B3             S01464
370700200529     C***********PNCNUM    ANDEQSDCNUM                                    S01464
370800200529     C***********                                                         S01464
370900200529     C***********          SETOF                     36                   S01464
371000200529     C***********                                                         S01464
371100200529     C***********          MOVE PNPTFR    WKPTFR                          S01464
371200200529     C***********          Z-ADDPNCNUM    WKCNUM                          S01464
371300200529     C***********FAXKEY    CHAINSCSCFAXX             72                   S01464
371400200529     C***********FAXKEY    CHAINSESCFAXX             72                   S01464
371500200529     C***********                                                         S01464
371600200529     C************IN72     IFEQ '0'                        B4             S01464
371700200529     C***********SDRECI    ANDNE'*'                                       S01464
371800200529     C**Move*values*from*file*to*screen*fields.                           S01464
371900200529     C***********                                                         S01464
372000200529     C***********          MOVE PNPTFR    S1FOLI                          S01464
372100200529     C***********          EXSR #I                                        S01464
372200200529     C***********          ADD  1         S1RRN                           S01464
372300200529     C***********                                                         S01464
372400200529     C**Write*record*to*subfile.                                          S01464
372500200529     C***********                                                         S01464
372600200529     C***********          WRITESE6050S1                                  S01464
372700200529     C***********          END                             E4             S01464
372800200529     C***********                                                         S01464
372900200529     C**Read*next*'non-deleted'*Record*from*File*SEOCFSXX.                S01464
373000200529     C***********                                                         S01464
373100200529     C****                 READ PMPORTLL                 71               48202
373200200529     C***********          READ PMPORTPP                 71         48202 S01464
373300200529     C***********                                                         S01464
373400200529     C***********          END                             E3             S01464
373500200529     C***********                                                         S01464
373600200529     C**Record*from*File*SCCCFAXX.                                        S01464
373700200529     C***********                                                         S01464
373800200529     C***********          MOVE SDCNUM    QBCUST                          S01464
373900200529     C***********QBCUST    CHAINSDPLCSPD             71                   S01464
374000200529     C***********                                                         S01464
374100200529     C************IN71     IFEQ '1'                                       S01464
374200200529     C***********QBRECI    OREQ '*'                                       S01464
374300200529     C***********          MOVE '9999'    WKPTFR                          S01464
374400200529     C***********          MOVE P9R999    S1FOLI                          S01464
374500200529     C***********          ELSE                                           S01464
374600200529     C***********          MOVE '9997'    WKPTFR                          S01464
374700200529     C***********          MOVE P9R997    S1FOLI                          S01464
374800200529     C***********          END                                            S01464
374900200529     C*                                                                   091522
375000200529     C** Add one record to subfile for each of the customers portfolios   091522
375100200529     C** which has an accruals record                                     091522
375200200529     C*                                                                   091522
375300200529     C**********           Z-ADDSDCNUM    PNCNUM                          091522       091522 CSD027
375400200529     C                     MOVE SDCNUM    PNCNUM                                              CSD027
375500200529     C                     MOVE *LOVAL    PNPTFR                          091522
375600200529     C*                                                                   091522
375700200529     C           PORTKY    SETLLPMPORTPD                                  091522
375800200529     C                     READ PMPORTPD                 71               091522
375900200529     C*                                                                   091522
376000200529     C** Write records to subfile until there are no                      091522
376100200529     C** more records on file.                                            091522
376200200529     C*                                                                   091522
376300200529     C           *IN71     DOWEQ'0'                        B3             091522
376400200529     C           PNCNUM    ANDEQSDCNUM                                    091522
376500200529     C*                                                                   091522
376600200529     C                     SETOF                     36                   091522
376700200529     C*                                                                   091522
376800200529     C                     MOVE PNPTFR    WKPTFR                          091522
376900200529     C**********           Z-ADDPNCNUM    WKCNUM                                       091522 CSD027
377000200529     C                     MOVE PNCNUM    WKCNUM                                              CSD027
377100200529     C           FAXKEY    CHAINSESCFAXX             72                   091522
377200200529     C*                                                                   091522
377300200529     C           *IN72     IFEQ '0'                        B4             091522
377400200529     C           SDRECI    ANDNE'*'                                       091522
377500200529     C*                                                                   091522
377600200529     C** Move values from file to screen fields.                          091522
377700200529     C*                                                                   091522
377800200529     C                     MOVE PNPTFR    S1FOLI                          091522
377900200529     C                     EXSR #I                                        091522
378000200529     C                     ADD  1         S1RRN                           091522
378100200529     C*                                                                   091522
378200200529     C* Write record to subfile.                                          091522
378300200529     C*                                                                   091522
378400200529     C                     WRITESE6050S1                                  091522
378500200529     C                     END                                            091522
378600200529     C*                                                                   091522
378700200529     C* Read next 'non-deleted' Record from File SCOCFSXX.                091522
378800200529     C*                                                                   091522
378900200529     C                     READ PMPORTPD                 71               091522
379000200529     C*                                                                   091522
379100200529     C                     END                                            091522
379200200529     C*                                                                   091522
379300200529     C* Record from File SCCCFAXX.                                        091522
379400200529     C*                                                                   091522
379500200529     C                     MOVE SDCNUM    QBCUST                          091522
379600200529     C           QBCUST    CHAINSDPLCSL0             71                   091522
379700200529     C*                                                                   091522
379800200529     C           *IN71     IFEQ '1'                                       091522
379900200529     C           QBRECI    OREQ '*'                                       091522
380000200529     C                     MOVE '9999'    WKPTFR                          091522
380100200529     C                     MOVE FCR999    S1FOLI                          091522
380200200529     C                     ELSE                                           091522
380300200529     C                     MOVE '9997'    WKPTFR                          091522
380400200529     C                     MOVE FCR997    S1FOLI                          091522
380500200529     C                     END                                            091522
380600200529     C*
380700200529     C**********           Z-ADDSDCNUM    WKCNUM                                              CSD027
380800200529     C                     MOVE SDCNUM    WKCNUM                                              CSD027
380900200529     C***********          MOVE SDBRCA    WKBRCA                   S01464 091522
381000200529     C                     MOVE SDBRCA    S1BRCH                          091522
381100200529     C                     MOVE *BLANKS   WKPTFR                          S01464
381200200529     C***********FAXKEY    CHAINSCSCFAXX             71                   S01464
381300200529     C           FAXKEY    CHAINSESCFAXX             71                   S01464
381400200529     C*
381500200529     C           *IN71     IFEQ '0'                        B3
381600200529     C           SDRECI    ANDNE'*'
381700200529     C                     EXSR #I
381800200529     C*
381900200529     C* Write record to subfile.
382000200529     C*
382100200529     C                     ADD  1         S1RRN
382200200529     C                     WRITESE6050S1
382300200529     C                     END                             E3
382400200529     C                     END                             E2
382500200529     C                     END                             E1
382600200529     C*
382700200529     C* Store RRN's.
382800200529     C                     Z-ADDS1RRN     WKLRRN
382900200529     C                     Z-ADDWKFRRN    S1RRN
383000200529     C*
383100200529     C                     SETON                     35
383200200529     C*
383300200529     C                     ENDSR
383400200529     C********************************************************************
383500200529     C*
383600200529     C*
383700200529     C/EJECT
383800200529     C********************************************************************
383900200529     C*                                                                  *
384000200529     C*  #I        - LOAD SUBFILE RECORD - INSERT MODE                   *
384100200529     C*                                                                  *
384200200529     C*  CALLS     - NONE                                                *
384300200529     C*                                                                  *
384400200529     C*  CALLED BY - #H                                                  *
384500200529     C*                                                                  *
384600200529     C********************************************************************
384700200529     C           #I        BEGSR
384800200529     C*
384900200529     C                     MOVE 'Y'       S1UPDT
385000200529     C                     MOVE *BLANKS   S1ACTN
385100200529     C*
385200200529     C***********SAAUPI    IFEQ 'Y'                                       S01464
385300200529     C           FBAUPI    IFEQ 'Y'                                       S01464
385400200529     C                     MOVE 'X'       S1STAT
385500200529     C                     ELSE
385600200529     C                     MOVE *BLANKS   S1STAT
385700200529     C                     END
385800200529     C*
385900200529     C                     MOVE BBCUST    S1CUSS
386000200529     C*
386100200529     C                     Z-ADDSDCFAC    WKCFAC 140
386200200529     C           SDOSAS    IFEQ '+'
386300200529     C           SDCFAC    ADD  SDOSAJ    WKACTF 140
386400200529     C                     ELSE
386500200529     C           SDCFAC    SUB  SDOSAJ    WKACTF
386600200529     C                     END
386700200529     C*                                                                   48202
386800200529     C** CHECK THAT 'ACTUAL FEE' *GE MINIMUM COMMISSION                   48202
386900200529     C                     EXSR MINCOM                                    48202
387000200529     C*
387100200529     C                     MOVE WKCFAC    ZFLD15                          48202
387200200529     C***********          Z-ADDSABCGD    ZDECS                      48202S01464
387300200529     C                     Z-ADDWWNBDP    ZDECS                           S01464
387400200529     C                     EXSR ZSEDIT                                    48202
387500200529     C                     MOVE ZOUT21    WWFL15                          48202
387600200529     C                     MOVELWWFL15    S1ACRU                          48202
387700200529     C*
387800200529     C                     MOVE WKACTF    ZFLD15
387900200529     C***********          Z-ADDSABCGD    ZDECS                           S01464
388000200529     C                     Z-ADDWWNBDP    ZDECS                           S01464
388100200529     C                     EXSR ZSEDIT
388200200529     C                     MOVE ZOUT21    WWFL15
388300200529     C****                 MOVELWWFL15    S1ACRU                          48202
388400200529     C                     MOVELWWFL15    S1ACTF                          48202
388500200529     C****                 MOVE S1ACRU    S1ACTF                          48202
388600200529     C                     MOVE S1ACTF    S1HACT
388700200529     C*
388800200529     C**   Set up Currency, Account and Branch fields
388900200529     C*
389000200529     C           S1FOLI    IFEQ *BLANKS
389100200529     C***********S1FOLI    OREQ P9R997                                    S01464
389200200529     C***********S1FOLI    OREQ P9R999                                    S01464
389300200529     C           S1FOLI    OREQ FCR997                                    091522
389400200529     C           S1FOLI    OREQ FCR999                                    091522
389500200529     C*                                                                   S01464
389600200529     C           BBCUST    CHAINSDCFCDL0             74                   S01464
389700200529     C*                                                                   S01464
389800200529     C           *IN74     IFEQ '1'                                       S01464
389900200529     C                     MOVE *BLANKS   S1CURR                          S01464
390000200529     C                     MOVE *BLANKS   S1ACCV                          S01464
390100200529     C                     MOVE *BLANKS   S1BRCA                          S01464
390200200529     C                     MOVE *BLANKS   S1HCUS                          S01464
390300200529     C                     ELSE                                           S01464
390400200529     C                     MOVE E6SCCY    S1CURR                          S01464
390500200529     C                     MOVE E6SMAC    S1ACCV                          S01464
390600200529     C                     MOVE E6SBCH    S1BRCA                          S01464
390700200529     C                     MOVE *BLANKS   S1HCUS                          S01464
390800200529     C                     END                                            S01464
390900200529     C***********          MOVE BBCSCY    S1CURR                          S01464
391000200529     C***********          MOVE BBCUSA    S1ACCV                          S01464
391100200529     C***********          MOVE BBCUSB    S1HCUS                          S01464
391200200529     C***********          ELSE                                           S01464
391300200529     C***********                                                         S01464
391400200529     C***********PNCSCY    IFNE *BLANKS                                   S01464
391500200529     C***********          MOVE PNCSCY    S1CURR                          S01464
391600200529     C***********          MOVE PNCUSA    S1ACCV                          S01464
391700200529     C***********          MOVE PNCUSB    S1HCUS                          S01464
391800200529     C***********          ELSE                                           S01464
391900200529     C***********          MOVE BBCSCY    S1CURR                          S01464
392000200529     C***********          MOVE BBCUSA    S1ACCV                          S01464
392100200529     C***********          MOVE BBCUSB    S1HCUS                          S01464
392200200529     C***********          END                                            S01464
392300200529     C*                                                                   091522
392400200529     C                     ELSE                                           091522
392500200529     C*                                                                   091522
392600200529     C           PNCSCY    IFNE *BLANKS                                   091522
392700200529     C                     MOVE PNCSCY    S1CURR                          091522
392800200529     C                     MOVE PNCUSA    S1ACCV                          091522
392900200529     C                     MOVE PNCUSB    S1BRCA                          091522
393000200529     C                     MOVE *BLANKS   S1HCUS                          091522
393100200529     C                     ELSE                                           091522
393200200529     C*                                                                   091522
393300200529     C           BBCUST    CHAINSDCFCDL0             74                   091522
393400200529     C*                                                                   091522
393500200529     C           *IN74     IFEQ '1'                                       091522
393600200529     C                     MOVE *BLANKS   S1CURR                          091522
393700200529     C                     MOVE *BLANKS   S1ACCV                          091522
393800200529     C                     MOVE *BLANKS   S1BRCA                          091522
393900200529     C                     MOVE *BLANKS   S1HCUS                          091522
394000200529     C                     ELSE                                           091522
394100200529     C                     MOVE E6SCCY    S1CURR                          091522
394200200529     C                     MOVE E6SMAC    S1ACCV                          091522
394300200529     C                     MOVE E6SBCH    S1BRCA                          091522
394400200529     C                     MOVE *BLANKS   S1HCUS                          091522
394500200529     C                     END                                            091522
394600200529     C*                                                                   091522
394700200529     C                     END                                            091522
394800200529     C*
394900200529     C                     END
395000200529     C*
395100200529     C** IF SETTLEMENT CURRENCY BLANK (IE NO SETTLEMENT ACCOUNT DEFINED)
395200200529     C** SETTLEMENT WILL BE GENERATED TO SUSPENSE ACCOUNT IN BANK
395300200529     C** CHARGING CURRENCY
395400200529     C           S1ACCV    IFEQ *BLANKS
395500200529     C***********          MOVE SABCGC    S1CURR                          S01464
395600200529     C                     MOVE FBBCGC    S1CURR                          S01464
395700200529     C                     MOVE BBBRCD    S1HCUS
395800200529     C                     END
395900200529     C*
396000200529     C                     MOVE S1CURR    S1HCCY
396100200529     C                     MOVE S1ACCV    S1HACC
396200200529     C                     MOVE S1BRCA    S1HBRC                          S01464
396300200529     C*
396400200529     C* Convert projected Settlement Amount to Settlement Currency.
396500200529     C*
396600200529     C                     Z-ADDWKACTF    ZAMTF
396700200529     C***********          MOVE SABCGC    ZCCYF                           S01464
396800200529     C                     MOVE FBBCGC    ZCCYF                           S01464
396900200529     C                     MOVE S1CURR    ZCCYT
397000200529     C                     MOVE BJCYCD    ZCCYB
397100200529     C******************** EXSR ZCCYKK                                    48200
397200200529     C/COPY WNCPYSRC,SE6050C006
397300200529     C                     EXSR ZCCYGB                                    48200
397400200529     C/COPY WNCPYSRC,SE6050C007
397500200529     C*
397600200529     C                     Z-ADDZSCYDP    ZDECS
397700200529     C                     Z-ADDZAMTT     ZFLD15
397800200529     C                     EXSR ZSEDIT
397900200529     C                     MOVE ZOUT21    WWFL15
398000200529     C                     MOVELWWFL15    S1SETA
398100200529     C*
398200200529     C                     MOVE BJRDNB    S1HVDN
398300200529     C                     MOVE BJRDNB    ZDAYNO
398400200529     C                     EXSR ZDATE2
398500200529     C                     MOVE ZDATE     S1CDTE
398600200529     C                     MOVE S1CDTE    S1HDAT
398700200529     C*
398800200529     C*
398900200529     C                     Z-ADD0         S1HTRN
399000200529     C                     Z-ADDSDTNLU    S1HATN
399100200529     C*
399200200529     C                     ENDSR
399300200529     C********************************************************************48202
399400200529     C/EJECT                                                              48202
399500200529     C********************************************************************48202
399600200529     C**                                                              *   48202
399700200529     C**   MINCOM    - If the Amount accrued (SDCFAC) is less than    *   48202
399800200529     C**               minimum commission and the minimum is not zero,*   48202
399900200529     C**               output the minimum Amount insted of the Accrued*   48202
400000200529     C**               amount to field SEAFTS when writing to SEOCFSPD*   48202
400100200529     C**                                                              *   48202
400200200529     C**   CALLS     - NONE                                           *   48202
400300200529     C**                                                              *   48202
400400200529     C**   CALLED BY - #BB                                            *   48202
400500200529     C**                                                              *   48202
400600200529     C*****************************************************************   48202
400700200529     C           MINCOM    BEGSR                                          48202
400800200529     C*                                                                   48202
400900200529     C** FOR DEFINED PORTFOLIOS DETERMINE CUSTODY FEE GROUP FROM          48202
401000200529     C** PORTFOLIO DEFINITION                                             48202
401100200529     C*                                                                   091522
401200200529     C           FBCFCP    IFEQ 'P'                                       091522
401300200529     C*                                                                   091522
401400200529     C           SDPTFR    IFNE '9997'                     B1             48202
401500200529     C           SDPTFR    ANDNE'9998'                                    48202
401600200529     C           SDPTFR    ANDNE'9999'                                    48202
401700200529     C***********          MOVE SDCNUM    PNCNUM                    48202 S01464
401800200529     C***********          MOVE SDPTFR    PNPTFR                    48202 S01464
401900200529     C*                                                                   48202
402000200529     C***********PORTKY    CHAINPMPORTPP             71             48202 S01464
402100200529     C************IN71     IFEQ '1'                        B2       48202 S01464
402200200529     C***********          Z-ADD11        DBASE                     48202 S01464
402300200529     C***********          MOVE *BLANKS   DBFILE     ***************48202 S01464
402400200529     C***********          MOVEL'PMPORTPP'DBFILE     * DBERROR 001 *48202 S01464
402500200529     C***********          MOVELPNCNUM    DBKEY      ***************48202 S01464
402600200529     C***********          MOVE PNPTFR    DBKEY                     48202 S01464
402700200529     C***********          MOVE '1'       *INU7                     48202 S01464
402800200529     C***********          MOVE '1'       *INU8                     48202 S01464
402900200529     C***********          MOVE '1'       *INLR                     48202 S01464
403000200529     C***********          RETRN                                    48202 S01464
403100200529     C***********          END                             E2       48202 S01464
403200200529     C*                                                                   48202
403300200529     C***********          MOVE PNCFGC    WWCFGC                    48202 S01464
403400200529     C*                                                                   091522
403500200529     C                     MOVE SDCNUM    PNCNUM                          091522
403600200529     C                     MOVE SDPTFR    PNPTFR                          091522
403700200529     C*                                                                   091522
403800200529     C           PORTKY    CHAINPMPORTPD             71                   091522
403900200529     C           *IN71     IFEQ '1'                                       091522
404000200529     C                     Z-ADD11        DBASE                           091522
404100200529     C                     MOVE *BLANKS   DBFILE           ***************091522
404200200529     C                     MOVEL'PMPORTPD'DBFILE           * DBERROR 011 *091522
404300200529     C                     MOVELPNCNUM    DBKEY            ***************091522
404400200529     C                     MOVE PNPTFR    DBKEY                           091522
404500200529     C                     MOVE '1'       *INU7                           091522
404600200529     C                     MOVE '1'       *INU8                           091522
404700200529     C                     MOVE '1'       *INLR                           091522
404800200529     C                     RETRN                                          091522
404900200529     C                     END                                            091522
405000200529     C*                                                                   091522
405100200529     C                     MOVE PNCFGC    WWCFGC                          091522
405200200529     C                     END                                            48202
405300200529     C*                                                                   091522
405400200529     C                     END                                            091522
405500200529     C*                                                                   48202
405600200529     C** IF CUSTODY FEE GROUP CODE BLANK BRANCH TO END OF ROUTINE         48202
405700200529     C           WWCFGC    CABEQ'  '      ENDMIN                          48202
405800200529      *                                                                   48202
405900200529     C***********WWCFGC    CHAINSCCFGRP0             10             48202 S01464
406000200529     C           WWCFGC    CHAINSECFGRP0             10                   S01464
406100200529      *  Bypass if does not exist                                         48202
406200200529     C           *IN10     CABEQ'1'       ENDMIN                          48202
406300200529      *  Bypass if deleted                                                48202
406400200529     C           SBCHTP    CABEQ'D'       ENDMIN                          48202
406500200529     C*                                                                   48202
406600200529     C** IF THE MINIMUM COMMISSION IS NOT EQUAL TO ZERO CALCULATE         48202
406700200529     C** THE MINIMUM COMMISSION DUE SINCE LAST SETTLEMENT DATE            48202
406800200529     C           SBMICO    IFNE 0                                         48202
406900200529     C*                                                                   48202
407000200529     C***********BJRDNB    SUB  SALCRD    WWMIND  50                48202 S01464
407100200529     C           BJRDNB    SUB  FBLCRD    WWMIND  50                      S01464
407200200529     C           WWMIND    MULT SBMICO    WWMICO 150                      48202
407300200529     C           WWMICO    DIV  365       WWMICO 150H                     48202
407400200529     C*                                                                   48202
407500200529     C** IF THE ACTUAL FEE IS LESS THAN THE MINIMUM COMMISSION RESET      48202
407600200529     C** THE ACTUAL FEE TO THE MINIMUM COMMISSION                         48202
407700200529     C           WKACTF    IFLT WWMICO                                    48202
407800200529     C                     Z-ADDWWMICO    WKACTF                          48202%
407900200529     C                     END                                            48202
408000200529     C                     END                                            48202
408100200529      *                                                                   48202
408200200529     C           ENDMIN    ENDSR                                          48202
408300200529     C********************************************************************
408400200529     C*
408500200529     C/EJECT
408600200529     C********************************************************************
408700200529     C*                                                                  *
408800200529     C*  #YB       - DISPLAY SCREEN                                      *
408900200529     C*                                                                  *
409000200529     C*  CALLS     - NONE                                                *
409100200529     C*                                                                  *
409200200529     C*  CALLED BY - #B                                                  *
409300200529     C*                                                                  *
409400200529     C********************************************************************
409500200529     C           #YB       BEGSR
409600200529     C*
409700200529     C* Display headings and subfile.
409800200529     C*
409900200529     C                     WRITESE6050C2
410000200529     C*
410100200529     C* Display footings.
410200200529     C*
410300200529     C                     WRITESE6050C3
410400200529     C*
410500200529     C* If errors write message subfile to screen.
410600200529     C*
410700200529     C           WKEROR    IFEQ '1'
410800200529     C                     WRITESE6050C4
410900200529     C                     END
411000200529     C*
411100200529     C* Read Screen.
411200200529     C*
411300200529     C                     MOVE S1BRCH    WKBRCH  3                       091522
411400200529     C           WKFSRN    IFEQ 'Y'
411500200529     C                     READ SE6050C3                 59
411600200529     C                     ELSE
411700200529     C                     READ SE6050C2                 59
411800200529     C                     END
411900200529     C*
412000200529     C                     ENDSR
412100200529     C********************************************************************
412200200529     C*
412300200529     C/EJECT
412400200529     C********************************************************************
412500200529     C*                                                                  *
412600200529     C*  #E        - UPDATE PROCESSING                                   *
412700200529     C*                                                                  *
412800200529     C*  CALLS     -                                                     *
412900200529     C*                                                                  *
413000200529     C*  CALLED BY -                                                     *
413100200529     C*                                                                  *
413200200529     C********************************************************************
413300200529     C           #E        BEGSR
413400200529     C*
413500200529     C                     SETOF                     65
413600200529     C                     MOVE *BLANKS   WKEROR
413700200529     C*
413800200529     C* Read all Records in the Subfile.
413900200529     C*
414000200529     C                     Z-ADD1         S1RRN
414100200529     C           S1RRN     CHAINSE6050S1             75
414200200529     C*
414300200529     C           *IN75     DOWEQ'0'                        B1
414400200529     C                     SETOF                     368182
414500200529     C*
414600200529     C* If hidden field is 'Y' then record has changed so therefore
414700200529     C* update the files.
414800200529     C*
414900200529     C           S1UPDT    IFEQ 'Y'                        B2
415000200529     C                     MOVE 'N'       S1UPDT
415100200529     C*
415200200529     C* Get Transaction no. of last update.
415300200529     C*
415400200529     C                     EXSR ZTNLU1
415500200529     C*
415600200529     C                     MOVE S1CUSS    SECNUM
415700200529     C************************************************************ S01464 091522
415800200529     C**If*multi-branch*environment,*move*branch*code************* S01464 091522
415900200529     C************************************************************ S01464 091522
416000200529     C************IN50     IFEQ '1'                                S01464 091522
416100200529     C*                                                                   091522
416200200529     C** Always use screen branch in the key.                             091522
416300200529     C*                                                                   091522
416400200529     C                     MOVE S1BRCH    SEBRCA                          S01464
416500200529     C***********          END                                     S01464 091522
416600200529     C*
416700200529     C***********S1FOLI    IFEQ P9R997                                    S01464
416800200529     C***********          MOVE '9997'    SEPTFR                          S01464
416900200529     C***********          END                                            S01464
417000200529     C***********                                                         S01464
417100200529     C***********S1FOLI    IFEQ P9R999                                    S01464
417200200529     C***********          MOVE '9999'    SEPTFR                          S01464
417300200529     C***********          END                                            S01464
417400200529     C***********                                                         S01464
417500200529     C***********S1FOLI    IFNE P9R997                                    S01464
417600200529     C***********S1FOLI    ANDNEP9R999                                    S01464
417700200529     C***********S1FOLI    ANDNE*BLANKS                                   S01464
417800200529     C***********          MOVE S1FOLI    SEPTFR                          S01464
417900200529     C***********          END                                            S01464
418000200529     C*                                                                   091522
418100200529     C           FBCFCP    IFEQ 'P'                                       091522
418200200529     C*                                                                   091522
418300200529     C           S1FOLI    IFEQ FCR997                                    091522
418400200529     C           BGN4ST    ANDNE'Y'                                       CPB001
418500200529     C                     MOVE '9997'    SEPTFR                          091522
418600200529     C                     END                                            091522
418700200529     C*                                                                   091522
418800200529     C           S1FOLI    IFEQ FCR999                                    091522
418900200529     C           BGN4ST    ANDNE'Y'                                       CPB001
419000200529     C                     MOVE '9999'    SEPTFR                          091522
419100200529     C                     END                                            091522
419200200529     C*                                                                   091522
419300200529     C           S1FOLI    IFNE FCR997                                    091522
419400200529     C           S1FOLI    ANDNEFCR999                                    091522
419500200529     C           S1FOLI    ANDNE*BLANKS                                   091522
419600200529     C           S1FOLI    OREQ FCR997                                    CPB001
419700200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
419800200529     C           S1FOLI    OREQ FCR999                                    CPB001
419900200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
420000200529     C                     MOVE S1FOLI    SEPTFR                          091522
420100200529     C                     END                                            091522
420200200529     C*                                                                   091522
420300200529     C                     END                                            091522
420400200529     C*                                                                   049067
420500200529     C                     MOVE S1CDTE    ZDATE                           049067
420600200529     C                     EXSR ZDATE1                                    049067
420700200529     C                     Z-ADDZDAYNO    SESEVD                          049067
420800200529     C*
420900200529     C* Access File 'SEOCFSPD'.
421000200529     C*
421100200529     C***********FSPDKY    CHAINSCOCFSPD             33                   S01464
421200200529     C           FSPDKY    CHAINSEOCFSPD             33                   S01464
421300200529     C*
421400200529     C           *IN33     IFEQ '0'                        B3
421500200529     C*
421600200529     C* If Transaction Number of last update has changed since
421700200529     C* last access update subfile with new values from file.
421800200529     C*
421900200529     C           SETNLU    IFNE S1HTRN                     B4
422000200529     C*
422100200529     C* Move File values to screen fields.
422200200529     C*
422300200529     C                     MOVE *BLANKS   S1ACTN
422400200529     C           SERECI    IFEQ '*'                        B5
422500200529     C                     MOVE 'D'       S1STAT
422600200529     C                     SETON                     64
422700200529     C                     ELSE                            X5
422800200529     C                     SETOF                     64
422900200529     C           SEAUIN    IFEQ 'Y'                        B6
423000200529     C                     MOVE 'X'       S1STAT
423100200529     C*****      SAAUPI    IFEQ 'N'
423200200529     C*****                SETON                     64
423300200529     C*****                END
423400200529     C                     ELSE                            X6
423500200529     C                     MOVE *BLANKS   S1STAT
423600200529     C                     END                             E6
423700200529     C                     END                             E5
423800200529     C*
423900200529     C***********          Z-ADDSABCGD    ZDECS                           S01464
424000200529     C                     Z-ADDWWNBDP    ZDECS                           S01464
424100200529     C                     Z-ADDSECFAC    ZFLD15
424200200529     C                     EXSR ZSEDIT
424300200529     C                     MOVE ZOUT21    WWFL15
424400200529     C                     MOVELWWFL15    S1ACRU
424500200529     C*
424600200529     C                     Z-ADDSEAFTS    ZFLD15
424700200529     C                     EXSR ZSEDIT
424800200529     C                     MOVE ZOUT21    WWFL15
424900200529     C                     MOVELWWFL15    S1ACTF
425000200529     C                     MOVELS1ACTF    S1HACT
425100200529     C*
425200200529     C                     MOVE SECSCY    S1CURR
425300200529     C                     MOVE SECSCY    S1HCCY
425400200529     C                     MOVE SECUSA    S1ACCV
425500200529     C                     MOVE SECUSA    S1HACC
425600200529     C                     MOVE SESEVD    S1HVDN
425700200529     C                     MOVE SESEVD    ZDAYNO
425800200529     C                     EXSR ZDATE2
425900200529     C                     MOVE ZDATE     S1CDTE
426000200529     C                     MOVE ZDATE     S1HDAT
426100200529     C                     MOVE SECUSB    S1HCUS
426200200529     C           *IN50     IFEQ '1'                                       S01464
426300200529     C                     MOVE SECUSB    S1BRCA                          S01464
426400200529     C                     MOVE SECUSB    S1HBRC                          S01464
426500200529     C                     END                                            S01464
426600200529     C                     MOVE SETNLU    S1HTRN
426700200529     C*
426800200529     C* Convert projected Settlement Amount to Settlement Currency.
426900200529     C*
427000200529     C                     Z-ADDSEAFTS    ZAMTF
427100200529     C***********          MOVE SABCGC    ZCCYF                           S01464
427200200529     C                     MOVE FBBCGC    ZCCYF                           S01464
427300200529     C                     MOVE SECSCY    ZCCYT
427400200529     C                     MOVE BJCYCD    ZCCYB
427500200529     C******************** EXSR ZCCYKK                                    48200
427600200529     C/COPY WNCPYSRC,SE6050C008
427700200529     C                     EXSR ZCCYGB                                    48200
427800200529     C/COPY WNCPYSRC,SE6050C009
427900200529     C*
428000200529     C                     Z-ADDZSCYDP    ZDECS
428100200529     C                     Z-ADDZAMTT     ZFLD15
428200200529     C                     EXSR ZSEDIT
428300200529     C                     MOVE ZOUT21    WWFL15
428400200529     C                     MOVELWWFL15    S1SETA
428500200529     C*
428600200529     C                     MOVE '1'       WKEROR
428700200529     C                     MOVEL'SE05010' ZAMSID
428800200529     C                     EXSR ZASNMS
428900200529     C                     SETON                     368182
429000200529     C                     SETON                     65
429100200529     C                     MOVE 'Y'       S1UPDT
429200200529     C*
429300200529     C* Else - No Change so update file values.
429400200529     C*
429500200529     C                     ELSE
429600200529     C*
429700200529     C           S1ACTN    IFEQ 'D'
429800200529     C                     MOVE '*'       SERECI
429900200529     C                     ELSE
430000200529     C                     MOVE 'D'       SERECI
430100200529     C                     END
430200200529     C*
430300200529     C                     MOVE BJMRDT    WKDAT
430400200529     C                     MOVE BJRDNB    SELCD
430500200529     C                     MOVE WKDAY     SEDLUP
430600200529     C                     MOVE WKMTH     SEMLUP
430700200529     C                     MOVE WKYR      SEYLUP
430800200529     C*
430900200529     C                     TIME           SETLUP
431000200529     C*
431100200529     C           S1ACTN    IFEQ 'D'
431200200529     C                     MOVE 'D'       SECHTP
431300200529     C                     ELSE
431400200529     C           SELCD     IFNE BJRDNB
431500200529     C           S1ACTN    IFEQ 'X'
431600200529     C                     MOVE 'X'       SECHTP
431700200529     C                     ELSE
431800200529     C                     MOVE 'A'       SECHTP
431900200529     C                     END
432000200529     C                     END
432100200529     C                     END
432200200529     C*
432300200529     C                     MOVE WWNATN    SETNLU
432400200529     C*
432500200529     C***********          Z-ADDSABCGD    ZADEC                           S01464
432600200529     C                     Z-ADDWWNBDP    ZADEC                           S01464
432700200529     C                     Z-ADD0         ZADIG
432800200529     C***********13        SUB  SABCGD    ZADIG                           S01464
432900200529     C           13        SUB  WWNBDP    ZADIG                           S01464
433000200529     C                     MOVE '0'       *IN99
433100200529     C                     MOVE *BLANKS   ZFIELD
433200200529     C                     MOVE S1ACTF    ZFIELD
433300200529     C                     EXSR ZALIGN
433400200529     C                     MOVE ZFIELD    SEAFTS
433500200529     C*
433600200529     C                     MOVE S1CURR    SECSCY
433700200529     C                     MOVE S1ACCV    SECUSA
433800200529     C                     MOVE S1BRCA    SECUSB                          S01464
433900200529     C                     MOVE S1CDTE    ZDATE
434000200529     C                     EXSR ZDATE1
434100200529     C                     Z-ADDZDAYNO    SESEVD
434200200529     C*
434300200529     C           S1ACTN    IFEQ 'X'
434400200529     C                     MOVE 'Y'       SEAUIN
434500200529     C                     END
434600200529     C*
434700200529     C* Update File.
434800200529     C***********          UPDATSCOCFSP1                                  S01464
434900200529     C                     UPDATSEOCFSP1                                  S01464
435000200529     C*
435100200529     C* Update Hidden Subfile fields.
435200200529     C*
435300200529     C                     MOVE WWNATN    S1HTRN
435400200529     C                     MOVE S1ACTF    S1HACT
435500200529     C                     MOVE S1CURR    S1HCCY
435600200529     C                     MOVE S1BRCA    S1HBRC                          S01464
435700200529     C                     MOVE S1ACCV    S1HACC
435800200529     C                     MOVE S1CDTE    S1HDAT
435900200529     C                     Z-ADDSESEVD    S1HVDN
436000200529     C                     MOVE *BLANKS   S1ACTN
436100200529     C           SERECI    IFEQ '*'
436200200529     C                     MOVE 'D'       S1STAT
436300200529     C                     SETON                     64
436400200529     C                     ELSE
436500200529     C                     SETOF                     64
436600200529     C           SEAUIN    IFEQ 'Y'
436700200529     C                     MOVE 'X'       S1STAT
436800200529     C******     SAAUPI    IFEQ 'N'
436900200529     C******               SETON                     64
437000200529     C******               END
437100200529     C                     ELSE
437200200529     C                     MOVE *BLANKS   S1STAT
437300200529     C                     END
437400200529     C                     END
437500200529     C*
437600200529     C                     END
437700200529     C                     END
437800200529     C*
437900200529     C                     UPDATSE6050S1
438000200529     C                     END
438100200529     C*
438200200529     C                     ADD  1         S1RRN
438300200529     C           S1RRN     CHAINSE6050S1             75
438400200529     C                     END
438500200529     C*
438600200529     C**   COMIT UPDATES
438700200529     C*
438800200529     C**   SET UP COMMITMENT TEXT
438900200529     C*
439000200529     C                     MOVE *BLANKS   ACTCDX
439100200529     C                     TIME           MTIME
439200200529     C           CMTTXT    COMIT
439300200529     C*
439400200529     C                     ENDSR
439500200529     C*
439600200529     C********************************************************************
439700200529     C*
439800200529     C*
439900200529     C/EJECT
440000200529     C********************************************************************
440100200529     C*                                                                  *
440200200529     C*  #K        - UPDATE PROCESSING FOR INSERTIONS                    *
440300200529     C*                                                                  *
440400200529     C*  CALLS     -                                                     *
440500200529     C*                                                                  *
440600200529     C*  CALLED BY -                                                     *
440700200529     C*                                                                  *
440800200529     C********************************************************************
440900200529     C           #K        BEGSR
441000200529     C*
441100200529     C                     SETOF                     65
441200200529     C                     MOVE *BLANKS   WKEROR
441300200529     C*
441400200529     C* Clear screen message queue.
441500200529     C*
441600200529     C                     CALL 'Y2CLMSC'
441700200529     C                     PARM           WWTPGQ
441800200529     C                     PARM           WWPGQR
441900200529     C*
442000200529     C* Read all Records in the Subfile.
442100200529     C*
442200200529     C                     Z-ADD1         S1RRN
442300200529     C           S1RRN     CHAINSE6050S1             75
442400200529     C*
442500200529     C           *IN75     DOWEQ'0'                        B1
442600200529     C           *IN65     ANDEQ'0'
442700200529     C*
442800200529     C* Get Transaction no. of last update.
442900200529     C*
443000200529     C                     EXSR ZTNLU1
443100200529     C*
443200200529     C                     MOVE S1CUSS    SECNUM
443300200529     C*************************************************************S01464 091522
443400200529     C**If*multi-branch*environment,*move*branch*code**************S01464 091522
443500200529     C*************************************************************S01464 091522
443600200529     C************IN50     IFEQ '1'                                S01464 091522
443700200529     C*                                                                   091522
443800200529     C** Always use screen branch as key.                                 091522
443900200529     C*                                                                   091522
444000200529     C                     MOVE S1BRCH    SEBRCA                          S01464
444100200529     C***********          END                                     S01464 091522
444200200529     C*
444300200529     C***********S1FOLI    IFEQ P9R997                     B2             S01464
444400200529     C***********          MOVE '9997'    SEPTFR                          S01464
444500200529     C***********          END                             E2             S01464
444600200529     C***********                                                         S01464
444700200529     C***********S1FOLI    IFEQ P9R999                     B2             S01464
444800200529     C***********          MOVE '9999'    SEPTFR                          S01464
444900200529     C***********          END                             E2             S01464
445000200529     C***********                                                         S01464
445100200529     C***********S1FOLI    IFNE P9R997                     B2             S01464
445200200529     C***********S1FOLI    ANDNEP9R999                                    S01464
445300200529     C***********S1FOLI    ANDNE*BLANKS                                   S01464
445400200529     C***********          MOVE S1FOLI    SEPTFR                          S01464
445500200529     C***********          END                             E2             S01464
445600200529     C*                                                                   091522
445700200529     C           FBCFCP    IFEQ 'P'                                       091522
445800200529     C*                                                                   091522
445900200529     C           S1FOLI    IFEQ FCR997                                    091522
446000200529     C           BGN4ST    ANDNE'Y'                                       CPB001
446100200529     C                     MOVE '9997'    SEPTFR                          091522
446200200529     C                     END                                            091522
446300200529     C*                                                                   091522
446400200529     C           S1FOLI    IFEQ FCR999                                    091522
446500200529     C           BGN4ST    ANDNE'Y'                                       CPB001
446600200529     C                     MOVE '9999'    SEPTFR                          091522
446700200529     C                     END                                            091522
446800200529     C*                                                                   091522
446900200529     C           S1FOLI    IFNE FCR997                                    091522
447000200529     C           S1FOLI    ANDNEFCR999                                    091522
447100200529     C           S1FOLI    ANDNE*BLANKS                                   091522
447200200529     C           S1FOLI    OREQ FCR997                                    CPB001
447300200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
447400200529     C           S1FOLI    OREQ FCR999                                    CPB001
447500200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
447600200529     C                     MOVE S1FOLI    SEPTFR                          091522
447700200529     C                     END                                            091522
447800200529     C*                                                                   049067
447900200529     C                     MOVE S1CDTE    ZDATE                           049067
448000200529     C                     EXSR ZDATE1                                    049067
448100200529     C                     Z-ADDZDAYNO    SESEVD                          049067
448200200529     C*                                                                   091522
448300200529     C                     END                                            091522
448400200529     C*
448500200529     C* Access File 'SEOCFSPD'.
448600200529     C*
448700200529     C***********FSPDKY    CHAINSCOCFSPD             33                   S01464
448800200529     C           FSPDKY    CHAINSEOCFSPD             33                   S01464
448900200529     C*
449000200529     C           *IN33     IFEQ '0'                        B2
449100200529     C           SERECI    ANDEQ'D'                                       44139
449200200529     C*
449300200529     C                     MOVEL'SE05015' ZAMSID
449400200529     C                     EXSR ZASNMS
449500200529     C                     SETON                     65
449600200529     C                     MOVE '1'       WKEROR
449700200529     C*
449800200529     C                     ELSE                            X2
449900200529     C*
450000200529     C* Create new record.
450100200529     C*
450200200529     C***********S1ACTN    IFEQ 'D'                        B3             44139
450300200529     C***********          MOVE '*'       SERECI                          44139
450400200529     C***********          ELSE                            X3             44139
450500200529     C***********          MOVE 'D'       SERECI                          44139
450600200529     C***********          END                             E3             44139
450700200529     C                     MOVE 'D'       SERECI                          44139
450800200529     C*
450900200529     C                     MOVE BJMRDT    WKDAT
451000200529     C                     MOVE WKDAY     SEDLUP
451100200529     C                     MOVE WKMTH     SEMLUP
451200200529     C                     MOVE WKYR      SEYLUP
451300200529     C*
451400200529     C                     TIME           SETLUP
451500200529     C*                                                                   045532
451600200529     C                     MOVE 'I'       SECHTP                          045532
451700200529     C*
451800200529     C***********S1ACTN    IFEQ 'D'                        B3             44139
451900200529     C***********          MOVE 'D'       SECHTP                          44139
452000200529     C***********          ELSE                            X3             44139
452100200529     C***********S1ACTN    IFEQ 'X'                        B4             44139
452200200529     C****                 MOVE 'I'       SECHTP                          48202
452300200529     C                     MOVE 'X'       SECHTP                          48202
452400200529     C***********          END                             E4             44139
452500200529     C***********          END                             E3             44139
452600200529     C*
452700200529     C                     MOVE BJRDNB    SELCD
452800200529     C                     MOVE WWNATN    SETNLU
452900200529     C*
453000200529     C***********          Z-ADDSABCGD    ZADEC                           S01464
453100200529     C                     Z-ADDWWNBDP    ZADEC                           S01464
453200200529     C                     Z-ADD0         ZADIG
453300200529     C***********13        SUB  SABCGD    ZADIG                           S01464
453400200529     C           13        SUB  WWNBDP    ZADIG                           S01464
453500200529     C                     MOVE '0'       *IN99
453600200529     C                     MOVE *BLANKS   ZFIELD
453700200529     C                     MOVE S1ACRU    ZFIELD
453800200529     C                     EXSR ZALIGN
453900200529     C                     MOVE ZFIELD    SECFAC
454000200529     C*
454100200529     C                     MOVE '0'       *IN99
454200200529     C                     MOVE *BLANKS   ZFIELD
454300200529     C                     MOVE S1ACTF    ZFIELD
454400200529     C                     EXSR ZALIGN
454500200529     C                     MOVE ZFIELD    SEAFTS
454600200529     C*
454700200529     C                     MOVE S1CURR    SECSCY
454800200529     C                     MOVE S1ACCV    SECUSA
454900200529     C*                                                                   S01464
455000200529     C           *IN50     IFEQ '0'                                       S01464
455100200529     C                     MOVE S1HCUS    SECUSB
455200200529     C                     ELSE                                           S01464
455300200529     C                     MOVE S1BRCA    SECUSB                          S01464
455400200529     C                     END                                            S01464
455500200529     C*
455600200529     C                     MOVE S1CDTE    ZDATE
455700200529     C                     EXSR ZDATE1
455800200529     C                     Z-ADDZDAYNO    SESEVD
455900200529     C*
456000200529     C***********S1ACTN    IFEQ 'X'                                       44139
456100200529B3   C           FBAUPI    IFEQ 'Y'                        B3             44139
456200200529     C                     MOVE 'Y'       SEAUIN
456300200529     C                     ELSE                            X3
456400200529     C                     MOVE 'N'       SEAUIN
456500200529     C                     END                             E3
456600200529     C*
456700200529     C* Update existing deleted record or write new record                045532
456800200529     C*                                                                   045532
456900200529     C           *IN33     IFEQ '1'                                       045532
457000200529     C***********          WRITESCOCFSP1               33                 S01464
457100200529     C                     WRITESEOCFSP1               33                 S01464
457200200529     C                     ELSE                                           045532
457300200529     C                     UPDATSEOCFSP1               33                 045532
457400200529     C                     END                                            045532
457500200529     C*
457600200529     C           *IN33     IFEQ '0'                        B3
457700200529     C*
457800200529     C* Chain to SESCFAPD.
457900200529     C                     MOVE S1CUSS    WKCNUM
458000200529     C***********          MOVE S1BRCH    WKBRCA                   S01464 091522
458100200529     C                     MOVE *BLANKS   WKPTFR                          S01464
458200200529     C***********S1FOLI    IFEQ P9R999                     B4             S01464
458300200529     C***********          MOVE '9999'    WKPTFR                          S01464
458400200529     C***********          ELSE                            X4             S01464
458500200529     C***********S1FOLI    IFEQ P9R997                     B5             S01464
458600200529     C***********          MOVE '9997'    WKPTFR                          S01464
458700200529     C***********          ELSE                            X5             S01464
458800200529     C***********          MOVE S1FOLI    WKPTFR                          S01464
458900200529     C***********          END                             E5             S01464
459000200529     C***********          END                             E4             S01464
459100200529     C*
459200200529     C           S1FOLI    IFEQ FCR999                                    091522
459300200529     C                     MOVE '9999'    WKPTFR                          091522
459400200529     C                     ELSE                                           091522
459500200529     C           S1FOLI    IFEQ FCR997                                    091522
459600200529     C           BGN4ST    ANDNE'Y'                                       CPB001
459700200529     C                     MOVE '9997'    WKPTFR                          091522
459800200529     C                     ELSE                                           091522
459900200529     C                     MOVE S1FOLI    WKPTFR                          091522
460000200529     C                     END                                            091522
460100200529     C                     END                                            091522
460200200529     C*                                                                   091522
460300200529     C***********FAXKEY    CHAINSCSCFAPD             75                   S01464
460400200529     C           FAXKEY    CHAINSESCFAPD             75                   S01464
460500200529     C*
460600200529     C           *IN75     IFEQ '1'                        B4
460700200529     C***********SDTNLU    ORNE S1HATN                                    44139
460800200529     C*
460900200529     C                     MOVEL'SE05016' ZAMSID
461000200529     C                     EXSR ZASNMS
461100200529     C                     SETON                     65
461200200529     C                     MOVE '1'       WKEROR
461300200529     C*
461400200529     C                     ELSE                            X4
461500200529     C*
461600200529     C***********          DELETSCSCFAP1                                  S01464
461700200529     C                     DELETSESCFAP1                                  S01464
461800200529     C                     END                             E4
461900200529     C*
462000200529     C                     ELSE                            X3
462100200529     C*
462200200529     C* File update not successful.
462300200529     C*
462400200529     C                     MOVEL'SE05016' ZAMSID
462500200529     C                     EXSR ZASNMS
462600200529     C                     SETON                     65
462700200529     C                     MOVE '1'       WKEROR
462800200529     C*
462900200529     C                     END                             E3
463000200529     C                     END                             E2
463100200529     C*
463200200529     C                     ADD  1         S1RRN
463300200529     C           S1RRN     CHAINSE6050S1             75
463400200529     C                     END                             E1
463500200529     C*
463600200529     C           *IN65     IFEQ '0'                        B1
463700200529     C           CMTTXT    COMIT
463800200529     C*
463900200529     C* Clear Subfile.
464000200529     C                     SETON                     31
464100200529     C                     WRITESE6050C2
464200200529     C                     SETOF                     31
464300200529     C*
464400200529     C                     MOVE 'Y'       WKIN09
464500200529     C*
464600200529     C                     ELSE                            X1
464700200529     C                     ROLBK
464800200529     C                     MOVE 'N'       WKINSA
464900200529     C                     MOVE 'N'       WKINER
465000200529     C                     SETON                     28
465100200529     C                     END                             E1
465200200529     C*
465300200529     C                     ENDSR
465400200529     C*
465500200529     C********************************************************************
465600200529     C*
465700200529     C/EJECT
465800200529     C*********************************************************************
465900200529     C**                                                                  *
466000200529     C** ZCCYKK subroutine to convert an amount in one currency to an     *
466100200529     C** amount in another currency using the Swiss Konventionkurse       *
466200200529     C** exchange rates.                                                  *
466300200529     C**     Input fields:   ZAMTF  15/0   Amount in 'From' Currency      *
466400200529     C**                     ZCCYF  3      'From' Currency                *
466500200529     C**                     ZCCYT  3      'To' Currency                  *
466600200529     C**                     ZCCYB  3      Base Currency                  *
466700200529     C**                                                                  *
466800200529     C**     Output fields:  ZAMTT  ]5/0   Amount in 'To' Currency        *
466900200529     C**                     ZCRSRT 13/8   Cross Exchange Rate            *
467000200529     C**                     ZCRSMD 1      Cross Rate Mult/Div Ind.       *
467100200529     C**                     ZSCYDP 1/0    Settle. Ccy Dec Places         *
467200200529     C**                                                                  *
467300200529     C**     If Indicator 85 is set after calling this subroutine         *
467400200529     C**     standard Database Error processing must be performed         *
467500200529     C**                                                                  *
467600200529     C**     Also Requires:  Currency file (SDCURRJ0)                     *
467700200529     C**                                                                  *
467800200529     C**     Calls:   ZCCYCN                                              *
467900200529     C**                                                                  *
468000200529     C***        ZCCYKK    BEGSR                           **  ZCCYKK     *
468100200529     C***
468200200529     C***DEFINE WORK FIELDS
468300200529     C***                  Z-ADDZAMTF     ZAMTF  150
468400200529     C***                  MOVE ZCCYF     ZCCYF   3
468500200529     C***                  MOVE ZCCYT     ZCCYT   3
468600200529     C***                  MOVE ZCCYB     ZCCYB   3
468700200529     C***                  Z-ADDZAMTT     ZAMTT  150
468800200529     C***                  Z-ADDZCRSRT    ZCRSRT 138
468900200529     C***                  MOVE ZCRSMD    ZCRSMD  1
469000200529     C***                  MOVE ZSCYDP    ZSCYDP  10
469100200529     C***                  MOVE 'N'       ZZIND   1
469200200529     C*
469300200529     C** INITIALISE INDICATOR FOR DATABASE ERROR
469400200529     C***                  MOVE '0'       *IN85
469500200529     C***
469600200529     C***CHECK IF THE 'FROM' CURRENCY EQUALS THE 'TO' CURRENCY
469700200529     C***        ZCCYF     IFEQ ZCCYT                      B1
469800200529     C***                  Z-ADDZAMTF     ZAMTT
469900200529     C***                  Z-ADD1         ZCRSRT
470000200529     C***                  MOVE 'M'       ZCRSMD
470100200529     C***
470200200529     C***                  ELSE                            X1
470300200529     C***
470400200529     C***ACCESS THE CURRENCY FILE USING THE 'FROM' CCY
470500200529     C***        ZCCYF     CHAINSDCURRJ0             80
470600200529     C*
470700200529     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
470800200529     C*
470900200529     C***        *IN80     IFEQ '1'                        B2
471000200529     C***                  MOVE '1'       *IN85                        ****
471100200529     C***                  ELSE                            X2
471200200529     C***
471300200529     C***CHECK THE 'FROM' CURRENCY AGAINST THE BASE CURRENCY
471400200529     C***        ZCCYF     IFEQ ZCCYB                      B3
471500200529     C***                  Z-ADDA6NBDP    ZCDPF
471600200529     C***                  MOVE 'M'       ZMDINF
471700200529     C***                  Z-ADD1         ZRATEF
471800200529     C***                  ELSE                            X3
471900200529     C***
472000200529     C***CHECK THE 'TO' CURRENCY AGAINST THE BASE CURRENCY
472100200529     C***        ZCCYT     IFEQ ZCCYB                      B4
472200200529     C***                  Z-ADDA6NBDP    ZCDPF
472300200529     C***
472400200529     C***        CYSELR    IFNE 0                          B5
472500200529     C***                  MOVE CYSELI    ZMDINF
472600200529     C***                  Z-ADDCYSELR    ZRATEF
472700200529     C***                  ELSE                            X5
472800200529     C***                  MOVE A6MDIN    ZMDINF
472900200529     C***                  Z-ADDA6SPRT    ZRATEF
473000200529     C***                  END                             E5
473100200529     C***
473200200529     C***                  ELSE                            X4
473300200529     C***
473400200529     C***        CYBUYR    IFEQ 0                          B5
473500200529     C***                  MOVE A6MDIN    CYBUYI
473600200529     C***                  Z-ADDA6SPRT    CYBUYR
473700200529     C***                  END                             E5
473800200529     C***
473900200529     C***        CYSELR    IFEQ 0                          B5
474000200529     C***                  MOVE A6MDIN    CYSELI
474100200529     C***                  Z-ADDA6SPRT    CYSELR
474200200529     C***                  END                             E5
474300200529     C***
474400200529     C***CHECK THE CONVENTION BID MULT/DIV INDICATOR
474500200529     C***        CYBUYI    IFEQ 'D'                        B5
474600200529     C***
474700200529     C***TAKE THE INVERSE OF THE BID RATE - CHECK FOR DIVIDE BY ZERO
474800200529     C***        CYBUYR    IFNE 0                          B6
474900200529     C***        1         DIV  CYBUYR    WWBMLT 138H
475000200529     C***                  ELSE                            X6
475100200529     C***                  Z-ADD0         WWBMLT
475200200529     C***                  END                             E6
475300200529     C***                  ELSE                            X5
475400200529     C***                  Z-ADDCYBUYR    WWBMLT
475500200529     C***                  END                             E5
475600200529     C***
475700200529     C** CHECK THE CONVENTION SELL MULT/DIV INDICATOR
475800200529     C***        CYSELI    IFEQ 'D'                        B5
475900200529     C***
476000200529     C***TAKE THE INVERSE OF THE SELL RATE - CHECK FOR DIVIDE BY ZERO
476100200529     C***        CYSELR    IFNE 0                          B6
476200200529     C***        1         DIV  CYSELR    WWSMLT 138H
476300200529     C***                  ELSE                            X6
476400200529     C***                  Z-ADD0         WWSMLT
476500200529     C***                  END                             E6
476600200529     C***                  ELSE                            X5
476700200529     C***                  Z-ADDCYSELR    WWSMLT
476800200529     C***                  END                             E5
476900200529     C***
477000200529     C***                  Z-ADDA6NBDP    ZCDPF
477100200529     C***                  MOVE 'M'       ZMDINF
477200200529     C***        WWBMLT    ADD  WWSMLT    WWMRAT 148
477300200529     C***        WWMRAT    DIV  2         ZRATEF
477400200529     C***                  END                             E4
477500200529     C***                  END                             E3
477600200529     C***
477700200529     C***ACCESS THE CURRENCY FILE USING THE 'TO' CCY
477800200529     C***        ZCCYT     CHAINSDCURRJ0             80
477900200529     C***
478000200529     C***IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
478100200529     C***
478200200529     C***        *IN80     IFEQ '1'                        B3
478300200529     C***                  MOVE '1'       *IN85                        ****
478400200529     C***                  ELSE                            X3
478500200529     C***
478600200529     C** SET ON INDICATOR STATING ZCCYT USED TO ACCESS LF/SDCURRJ0 AND
478700200529     C** SAVE DECIMAL PLACES
478800200529     C***                  MOVE 'Y'       ZZIND
478900200529     C***                  Z-ADDA6NBDP    ZSCYDP
479000200529     C***
479100200529     C***CHECK THE 'TO' CURRENCY AGAINST THE BASE CURRENCY
479200200529     C***        ZCCYT     IFEQ ZCCYB                      B4
479300200529     C***                  Z-ADDA6NBDP    ZCDPT
479400200529     C***                  MOVE 'M'       ZMDINT
479500200529     C***                  Z-ADD1         ZRATET
479600200529     C***                  ELSE                            X4
479700200529     C***
479800200529     C***                  Z-ADDA6NBDP    ZCDPT
479900200529     C***
480000200529     C***        CYBUYR    IFEQ 0                          B5
480100200529     C***                  MOVE A6MDIN    ZMDINT
480200200529     C***                  Z-ADDA6SPRT    ZRATET
480300200529     C***                  ELSE                            X5
480400200529     C***                  MOVE CYBUYI    ZMDINT
480500200529     C***                  Z-ADDCYBUYR    ZRATET
480600200529     C***                  END                             E5
480700200529     C***
480800200529     C***                  END                             E4
480900200529     C***
481000200529     C***                  EXSR ZCCYCN
481100200529     C***
481200200529     C***                  END                             E3
481300200529     C***                  END                             E2
481400200529     C***                  END                             E1
481500200529     C***
481600200529     C** IF CURRENCIES FILE NOT ACCESSED WITH ZCCYT ACCESS TO GET TO
481700200529     C** CURRENCY DECIMAL PLACES
481800200529     C***        ZZIND     IFEQ 'N'                        B1
481900200529     C***        ZCCYT     CHAINSDCURRJ0             80
482000200529     C***
482100200529     C***IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
482200200529     C***
482300200529     C***        *IN80     IFEQ '1'                        B2
482400200529     C***                  MOVE '1'       *IN85                        ****
482500200529     C***                  ELSE                            X2
482600200529     C***                  Z-ADDA6NBDP    ZSCYDP
482700200529     C***                  END                             E2
482800200529     C***                  END                             E1
482900200529     C***
483000200529     C***        ZKKEND    ENDSR
483100200529     C***
483200200529     C********************************************************************
483300200529     C**                                                                 *
483400200529     C/EJECT
483500200529     C********************************************************************
483600200529     C**                                                                 *
483700200529     C** ZTNLU1    - RETRIEVE/UPDATE TRANS NO. OF LAST UPDATE            *
483800200529     C**                                                                 *
483900200529     C** CALLS     - NONE                                                *
484000200529     C**                                                                 *
484100200529     C** CALLED BY - #ZAA                                                *
484200200529     C**                                                                 *
484300200529     C********************************************************************
484400200529     C           ZTNLU1    BEGSR                                        **
484500200529     C*
484600200529     C           *NAMVAR   DEFN MNATN     DNATN
484700200529     C           *LOCK     IN   DNATN
484800200529     C                     Z-ADDFNATN     WWDSTN  50
484900200529     C                     Z-ADDFNATN     WWNATN
485000200529     C                     ADD  1         FNATN
485100200529     C                     OUT  DNATN
485200200529     C*
485300200529     C                     ENDSR
485400200529     C********************************************************************
485500200529     C*
485600200529     C/EJECT
485700200529     C********************************************************************
485800200529     C**                                                                 *
485900200529     C** ZSEDIT subroutine to insert a decimal point and sign into a     *
486000200529     C** numeric field and to blank out leading zeros (optionaly         *
486100200529     C** inserting commas).                                              *
486200200529     C**     Input fields:   ZFLD15 15/0                                 *
486300200529     C**                     ZDECS  1/0                                  *
486400200529     C**                     ZECODE 1/  ('J', 'L' or blank)              *
486500200529     C**                                                                 *
486600200529     C**     Arrays:         ZS1    15/1/0                               *
486700200529     C**                     ZS2    21/1/                                *
486800200529     C**                                                                 *
486900200529     C**     Output fields:  ZOUT21 21                                   *
487000200529     C**                                                                 *
487100200529     CSR         ZSEDIT    BEGSR                           **  ZSEDIT   *
487200200529     C*
487300200529     C* Define/Clear fields
487400200529     C*
487500200529     C                     Z-ADDZFLD15    ZFLD15 150
487600200529     C                     Z-ADDZDECS     ZDECS   10
487700200529     C                     MOVE ZECODE    ZECODE  1
487800200529     C                     MOVE *BLANKS   ZOUT21 21
487900200529     C*
488000200529     C*       SET UP WORK FIELDS
488100200529     C*
488200200529     C                     Z-ADD0         ZS1
488300200529     C                     MOVE ' '       ZS2
488400200529     C*
488500200529     C                     Z-ADD15        Z1      20
488600200529     C                     Z-ADD20        Z2      20
488700200529     C*
488800200529     C           15        SUB  ZDECS     ZINTS   20
488900200529     C*
489000200529     C* Check if numeric field is negative
489100200529     C*
489200200529     C           ZFLD15    IFLT *ZEROS
489300200529     C                     MOVE '-'       ZS2,21
489400200529     C                     Z-SUBZFLD15    ZFLD15
489500200529     C                     END
489600200529     C*
489700200529     C                     Z-ADDZFLD15    WORK15
489800200529     C*
489900200529     C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES
490000200529     C*
490100200529     C           ZDECS     CABEQ0         ZS10
490200200529     C*
490300200529     C*       SET UP DECIMALS
490400200529     C*
490500200529     C                     Z-ADD*ZEROS    ZCNT    10
490600200529     C           ZCNT      DOUEQZDECS
490700200529     C                     MOVE ZS1,Z1    ZS2,Z2
490800200529     C                     SUB  1         Z2
490900200529     C                     ADD  1         ZCNT
491000200529     C                     SUB  1         Z1
491100200529     C                     END
491200200529     C*
491300200529     C*       PUT IN DECIMAL PLACE
491400200529     C*
491500200529     C                     MOVE '.'       ZS2,Z2
491600200529     C                     SUB  1         Z2
491700200529     C*
491800200529     C           ZS10      TAG                             ** ZS10 TAG **
491900200529     C*
492000200529     C*       SET UP INTEGERS
492100200529     C*
492200200529     C                     Z-ADD*ZEROS    CNT3    10
492300200529     C           Z1        DOUEQ*ZEROS
492400200529     C                     MOVE ZS1,Z1    ZS2,Z2
492500200529     C                     SUB  1         Z1
492600200529     C                     SUB  1         Z2
492700200529     C*
492800200529     C* If edit code is 'J', insert a ',' before each group of three
492900200529     C* digits - not if beginning of array reached.
493000200529     C*
493100200529     C           Z2        IFGT *ZEROS
493200200529     C           ZECODE    ANDEQ'J'
493300200529     C                     ADD  1         CNT3
493400200529     C           CNT3      IFEQ 3
493500200529     C                     MOVE ','       ZS2,Z2
493600200529     C                     SUB  1         Z2
493700200529     C                     Z-ADD*ZEROS    CNT3
493800200529     C                     END
493900200529     C                     END
494000200529     C*
494100200529     C                     END
494200200529     C*
494300200529     C*       PUT IN LEADING BLANKS
494400200529     C*
494500200529     C                     Z-ADD1         Z2
494600200529     C           ZS2,Z2    DOWEQ'0'
494700200529     C           ZS2,Z2    OREQ ' '
494800200529     C           ZS2,Z2    OREQ ','
494900200529     C                     MOVE ' '       ZS2,Z2
495000200529     C                     ADD  1         Z2
495100200529     C           Z2        CABEQ22        ZS20
495200200529     C                     END
495300200529     C*
495400200529     C*       IF NO INTEGERS PUT IN LEADING ZERO
495500200529     C*
495600200529     C           ZS20      TAG                             ** ZS20 TAG **
495700200529     C*
495800200529     C           Z2        IFEQ 22
495900200529     C                     SUB  2         Z2
496000200529     C                     MOVE '0'       ZS2,Z2
496100200529     C                     ELSE
496200200529     C*
496300200529     C           ZS2,Z2    IFEQ '.'
496400200529     C                     SUB  1         Z2
496500200529     C                     MOVE '0'       ZS2,Z2
496600200529     C                     END
496700200529     C                     END
496800200529     C*
496900200529     C*       SET UP OUTPUT FIELD
497000200529     C*
497100200529     C                     MOVEAZS2       ZOUT21
497200200529     C*
497300200529     CSR                   ENDSR
497400200529     C*****************************************************************
497500200529     C/EJECT
497600200529     C********************************************************************
497700200529     C**
497800200529     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
497900200529     C**
498000200529     C           ZALIGN    BEGSR                           *** ZALIGN ***
498100200529     C**
498200200529     C                     SETOF                     929399
498300200529     C**
498400200529     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
498500200529     C                     MOVEAZFIELD    ZA1
498600200529     C**
498700200529     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
498800200529     C                     Z-ADDZADIG     ZADIG   20
498900200529     C                     Z-ADDZADEC     ZADEC   10
499000200529     C**
499100200529     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
499200200529     C                     MOVE ' '       ZA2
499300200529     C                     MOVEAZA2       ZFIELD 16
499400200529     C                     Z-ADD0         ZX      20
499500200529     C                     Z-ADD0         ZY      20
499600200529     C**
499700200529     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
499800200529     C           ZADIG     ADD  ZADEC     ZZ      20
499900200529     C           ZZ        COMP 15                   99
500000200529     C   99                GOTO ZAEND
500100200529     C**
500200200529     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
500300200529     C           ZATAG1    TAG                             ** ZATAG1 TAG *
500400200529     C           ZX        ADD  1         ZX
500500200529     C**
500600200529     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
500700200529     C           ZA1,ZX    COMP '.'                      90
500800200529     C   90 93             SETON                     99
500900200529     C   99                GOTO ZAEND
501000200529     C**
501100200529     C**
501200200529     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
501300200529     C           ZA1,ZX    COMP 'M'                      96
501400200529     C   96                DO
501500200529     C           ZX        COMP 15                   99  99
501600200529     C   99                GOTO ZAEND
501700200529     C           ZX        ADD  1         ZX
501800200529     C           ZA1,ZX    COMP ' '                  9999
501900200529     C   99                GOTO ZAEND
502000200529     C           ZX        SUB  1         ZX
502100200529     C           ZX        COMP 9                    99
502200200529     C   99                GOTO ZAEND
502300200529     C                     END
502400200529     C**
502500200529     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
502600200529     C           ZA1,ZX    COMP 'T'                      97
502700200529     C   97                DO
502800200529     C           ZX        COMP 15                   99  99
502900200529     C   99                GOTO ZAEND
503000200529     C           ZX        ADD  1         ZX
503100200529     C           ZA1,ZX    COMP ' '                  9999
503200200529     C   99                GOTO ZAEND
503300200529     C           ZX        SUB  1         ZX
503400200529     C           ZX        COMP 12                   99
503500200529     C   99                GOTO ZAEND
503600200529     C                     END
503700200529     C**
503800200529     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
503900200529     C   96
504000200529     COR 97                MOVE ' '       ZA1,ZX
504100200529     C**
504200200529     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
504300200529     C           ZA1,ZX    COMP ' '                      91
504400200529     C   91 92             GOTO ZATAG2
504500200529     C**
504600200529     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
504700200529     C  N90N91   ZA1,ZX    COMP '0'                    99
504800200529     C  N90N91N99ZA1,ZX    COMP '9'                  99
504900200529     C   99                GOTO ZAEND                      NOT NUMERIC
505000200529     C**
505100200529     C**   STORE DIGITS IN ARRAY AND HOW MANY.
505200200529     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
505300200529     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
505400200529     C  N90N91   ZY        ADD  1         ZY         92
505500200529     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
505600200529     C   90                Z-ADDZY        ZZ         93  93
505700200529     C**
505800200529     C           ZX        COMP 16                     94  CHECK IF ALL
505900200529     C   94                GOTO ZATAG1
506000200529     C**
506100200529     C           ZATAG2    TAG                             ** ZATAG2 TAG *
506200200529     C**
506300200529     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
506400200529     C   96      ZZ        ADD  6         ZZ
506500200529     C**
506600200529     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
506700200529     C   97      ZZ        ADD  3         ZZ
506800200529     C**
506900200529     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
507000200529     C   96 93
507100200529     COR 97 93   ZZ        DOWGTZY
507200200529     C           ZY        ADD  1         ZY
507300200529     C                     MOVE '0'       ZA2,ZY
507400200529     C                     END
507500200529     C**
507600200529     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
507700200529     C   96N93             DO   6
507800200529     C           ZY        ADD  1         ZY
507900200529     C                     MOVE '0'       ZA2,ZY
508000200529     C                     END
508100200529     C**
508200200529     C   97N93             DO   3
508300200529     C           ZY        ADD  1         ZY
508400200529     C                     MOVE '0'       ZA2,ZY
508500200529     C                     END
508600200529     C**
508700200529     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
508800200529     C  N93                Z-ADDZY        ZZ
508900200529     C**
509000200529     C**   CHECK FOR EMBEDDED BLANKS.
509100200529     C   91 92             MOVEAZA1,ZX    ZFIELD
509200200529     C   91 92   ZFIELD    COMP ' '                  9999
509300200529     C   99                GOTO ZAEND                      EMBEDDED BLANK
509400200529     C**
509500200529     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
509600200529     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
509700200529     C           ZZ        COMP ZADIG                99
509800200529     C           ZY        SUB  ZZ        ZX
509900200529     C  N99      ZADEC     SUB  ZX        ZX           9995
510000200529     C   99                GOTO ZAEND
510100200529     C   95                GOTO ZATAG4                     NO TRAILING
510200200529     C**                                                   BLANKS.
510300200529     C**   FILL THE TRAILING BLANKS WITH ZEROS.
510400200529     C           ZY        ADD  ZX        ZZ
510500200529     C           ZATAG3    TAG                             ** ZATAG3 TAG *
510600200529     C           ZY        ADD  1         ZY
510700200529     C                     MOVE '0'       ZA2,ZY
510800200529     C           ZY        COMP ZZ                     94
510900200529     C   94                GOTO ZATAG3
511000200529     C**
511100200529     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
511200200529     C           ZATAG4    TAG                             ** ZATAG4 TAG *
511300200529     C                     MOVE '0'       ZA1
511400200529     C                     Z-ADD16        ZX
511500200529     C           ZATAG5    TAG                             ** ZATAG5 TAG *
511600200529     C           ZY        COMP 0                        94
511700200529     C   94                GOTO ZATAG6
511800200529     C                     MOVE ZA2,ZY    ZA1,ZX
511900200529     C           ZY        SUB  1         ZY
512000200529     C           ZX        SUB  1         ZX
512100200529     C                     GOTO ZATAG5
512200200529     C           ZATAG6    TAG                             ** ZATAG6 TAG *
512300200529     C**
512400200529     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
512500200529     C                     MOVEAZA1       ZFIELD
512600200529     C**
512700200529     C                     SETOF                     9697
512800200529     C**
512900200529     C           ZAEND     ENDSR                           * ZAEND ENDSR *
513000200529     C**
513100200529     C**
513200200529     C********************************************************************
513300200529     C**
513400200529     C/EJECT
513500200529     C********************************************************************
513600200529     C**
513700200529     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
513800200529     C**              CONVERT TO A NUMBER OF DAYS.
513900200529     C**
514000200529     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
514100200529     C**
514200200529     C           ZDATE1    BEGSR                           *** ZDATE1 ***
514300200529     C**
514400200529     C**   CLEAR DAY NUMBER. RESET ERROR INDICATOR
514500200529     C                     Z-ADD0         ZDAYNO  50
514600200529     C                     SETOF                     99
514700200529     C**
514800200529     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
514900200529     C                     Z-ADDZDATE     ZDATE   60
515000200529     C**
515100200529     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
515200200529     C                     MOVE ZDATE     ZYEAR   20
515300200529     C  N98                MOVELZDATE     ZDAY    20
515400200529     C   98                MOVELZDATE     ZMTH    20
515500200529     C                     MOVE ZDATE     ZWRK4   40
515600200529     C  N98                MOVELZWRK4     ZMTH
515700200529     C   98                MOVELZWRK4     ZDAY
515800200529     C**
515900200529     C**   ENSURE MONTH IS VALID. BYPASS IF ERROR
516000200529     C           ZMTH      IFLE 0
516100200529     C           ZMTH      ORGT 12
516200200529     C                     SETON                     99
516300200529     C                     GOTO ZDEND1
516400200529     C                     END
516500200529     C**
516600200529     C**   ENSURE DAY IS VALID. BYPASS IF ERROR
516700200529     C           ZDAY      IFLE 0
516800200529     C                     SETON                     99
516900200529     C                     GOTO ZDEND1
517000200529     C                     END
517100200529     C**
517200200529     C**   CHECK FOR 30 DAY MONTHS. BYPASS IF ERROR
517300200529     C           ZMTH      IFEQ 4
517400200529     C           ZMTH      OREQ 6
517500200529     C           ZMTH      OREQ 9
517600200529     C           ZMTH      OREQ 11
517700200529     C**
517800200529     C           ZDAY      IFGT 30
517900200529     C                     SETON                     99
518000200529     C                     GOTO ZDEND1
518100200529     C                     END
518200200529     C**
518300200529     C                     ELSE
518400200529     C**
518500200529     C**   CHECK FOR 31 DAY MONTHS (ALL OTHERS BUT FEB). BYPASS IF ERROR
518600200529     C           ZDAY      IFGT 31
518700200529     C           ZMTH      ANDNE2
518800200529     C                     SETON                     99
518900200529     C                     GOTO ZDEND1
519000200529     C                     END
519100200529     C**
519200200529     C                     END
519300200529     C**
519400200529     C**   CHECK FOR LEAP YEAR: REMAINDER WILL BE ZERO IF IT IS A LEAP YR
519500200529     C           ZYEAR     ADD  28        ZYEAR
519600200529     C           ZYEAR     DIV  4         ZLYR    20
519700200529     C                     MVR            ZLY     10
519800200529     C**
519900200529     C**   IF FEBUARY FURTHER VALIDATE DAY.
520000200529     C           ZMTH      IFEQ 2
520100200529     C**
520200200529     C**   INVALID IF GREATER THAN 28 AND NOT A LEAP YEAR
520300200529     C           ZLY       IFGT 0
520400200529     C           ZDAY      ANDGT28
520500200529     C                     SETON                     99
520600200529     C                     GOTO ZDEND1                     BYPASS IF ERROR
520700200529     C                     END
520800200529     C**
520900200529     C**   INVALID IF GREATER THAN 29 AND A LEAP YEAR - BYPASS IF ERROR
521000200529     C           ZLY       IFEQ 0
521100200529     C           ZDAY      ANDGT29
521200200529     C                     SETON                     99
521300200529     C                     GOTO ZDEND1
521400200529     C                     END
521500200529     C**
521600200529     C                     END
521700200529     C**
521800200529     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.
521900200529     C**
522000200529     C**   MULTIPLY NO. OF FOUR-YEAR SPANS, BY NO. OF DAYS IN SPAN
522100200529     C           ZLYR      MULT 1461      ZDAYNO
522200200529     C**
522300200529     C**   IF NOT A LEAP YEAR, ADD APPROPRIATE NO. OF DAYS FOR EXTRA
522400200529     C**   YEARS USING REMAINDER FIELD (IE. 1, 2 OR 3 X 356)
522500200529     C           ZLY       IFGT 0
522600200529     C           ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO
522700200529     C                     END
522800200529     C**
522900200529     C**   IF IT IS A LEAP YEAR, AND LATER THAN FEBRUARY, ADD ONE FOR
523000200529     C**   29TH OF FEB
523100200529     C           ZLY       IFEQ 0
523200200529     C           ZMTH      ANDGT2
523300200529     C           ZDAYNO    ADD  1         ZDAYNO
523400200529     C                     END
523500200529     C**
523600200529     C**   ADD APPROPRIATE NUMBER OF DAYS FOR THE MONTH NUMBER
523700200529     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO
523800200529     C**
523900200529     C**   ADD NUMBER OF DAYS IN MONTH
524000200529     C           ZDAYNO    ADD  ZDAY      ZDAYNO
524100200529     C**
524200200529     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
524300200529     C**
524400200529     C**
524500200529     C********************************************************************
524600200529     C********************************************************************
524700200529     C**
524800200529     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
524900200529     C**
525000200529     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
525100200529     C**
525200200529     C           ZDATE2    BEGSR                           *** ZDATE2 ***
525300200529     C**
525400200529     C**   CLEAR LEAP YEAR WORK FIELD.
525500200529     C                     MOVE 'N'       ZLEAP   1
525600200529     C**
525700200529     C**   CLEAR DATE FIELDS.
525800200529     C                     Z-ADD0         ZDATE   60
525900200529     C                     MOVEL'       ' ZADATE  7
526000200529     C**
526100200529     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
526200200529     C                     Z-ADDZDAYNO    ZDAYNO  50
526300200529     C**
526400200529     C**   DETERMINE YEAR NUMBER.
526500200529     C**
526600200529     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
526700200529     C           ZDAYNO    SUB  1         ZDAYN1  50
526800200529     C           ZDAYN1    IFLT 0
526900200529     C                     GOTO ZDEND2
527000200529     C                     END
527100200529     C**
527200200529     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
527300200529     C           ZDAYN1    DIV  1461      ZLYR    20
527400200529     C                     MVR            ZDAYN1           SAVE REMAINING
527500200529     C**                                                   DAYS
527600200529     C**   CALCULATE NUMBER OF REMAINING YEARS.
527700200529     C                     Z-ADD1         ZWRK2   20
527800200529     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
527900200529     C           ZDAYN1    IFGE ZYDY,ZWRK2
528000200529     C           ZWRK2     ADD  1         ZWRK2
528100200529     C                     GOTO ZDTAG1
528200200529     C                     END
528300200529     C*
528400200529     C           ZWRK2     SUB  1         ZWRK2
528500200529     C**
528600200529     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
528700200529     C           ZWRK2     IFNE 0
528800200529     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
528900200529     C                     END
529000200529     C**
529100200529     C**   CALCULATE ACTUAL YEAR NUMBER.
529200200529     C           ZLYR      MULT 4         ZWRK3   30
529300200529     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
529400200529     C                     Z-ADDZWRK3     ZYEAR   20
529500200529     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
529600200529     C**
529700200529     C**   DETERMINE MONTH NUMBER.
529800200529     C**
529900200529     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
530000200529     C           ZWRK2     IFEQ 0
530100200529     C           ZDAYN1    IFEQ 59
530200200529     C                     MOVE 'Y'       ZLEAP
530300200529     C                     END
530400200529     C           ZDAYN1    IFGE 59
530500200529     C           ZDAYN1    SUB  1         ZDAYN1
530600200529     C                     END
530700200529     C                     END
530800200529     C**
530900200529     C**   CALCULATE MONTH NUMBER.
531000200529     C                     Z-ADD2         ZWRK2
531100200529     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
531200200529     C           ZDAYN1    IFGE ZMDY,ZWRK2
531300200529     C           ZWRK2     ADD  1         ZWRK2
531400200529     C                     GOTO ZDTAG2
531500200529     C                     END
531600200529     C*
531700200529     C           ZWRK2     SUB  1         ZWRK2
531800200529     C**
531900200529     C                     Z-ADDZWRK2     ZMTH    20       MONTH
532000200529     C**
532100200529     C**   DETERMINE DAY OF MONTH.
532200200529     C**
532300200529     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
532400200529     C           ZDAYN1    ADD  1         ZDAYN1
532500200529     C**
532600200529     C**   CALCULATE DAY OF MONTH.
532700200529     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
532800200529     C**
532900200529     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
533000200529     C           ZLEAP     IFEQ 'Y'
533100200529     C           ZDAY      ADD  1         ZDAY
533200200529     C                     END
533300200529     C**
533400200529     C**   FORMAT DATE, DDMMYY OR MMDDYY.
533500200529     C  N98                MOVELZDAY      ZWRK4   40
533600200529     C   98                MOVE ZDAY      ZWRK4
533700200529     C  N98                MOVE ZMTH      ZWRK4
533800200529     C   98                MOVELZMTH      ZWRK4
533900200529     C                     MOVELZWRK4     ZDATE
534000200529     C                     MOVE ZYEAR     ZDATE
534100200529     C**
534200200529     C**   FORMAT ALPHA DATE, DDMMMYY.
534300200529     C                     MOVELZDAY      ZWRK5   5
534400200529     C           ZDAY      IFLT 10
534500200529     C                     MOVEL' '       ZWRK5
534600200529     C                     END
534700200529     C                     MOVE ZMNM,ZMTH ZWRK5
534800200529     C                     MOVELZWRK5     ZADATE
534900200529     C                     MOVE ZYEAR     ZADATE
535000200529     C**
535100200529     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
535200200529     C**
535300200529     C**
535400200529     C********************************************************************
535500200529     C/EJECT
535600200529     C********************************************************************
535700200529     C**                                                                 *
535800200529     C** ZASNMS    - SEND MESSAGE TO PROGRAM'S MESSAGE QUEUE             *
535900200529     C**                                                                 *
536000200529     C** CALLS     - Y2SNMGC                                             *
536100200529     C**                                                                 *
536200200529     C** CALLED BY - #BA, #BAA, #BBA, #ZAA, #ZAB                         *
536300200529     C**                                                                 *
536400200529     C********************************************************************
536500200529     C           ZASNMS    BEGSR                           ** ZASNMS    **
536600200529     C*
536700200529     C                     CALL 'Y2SNMGC'
536800200529     C                     PARM           ZAPGM  10
536900200529     C                     PARM           ZAPGRL  5
537000200529     C                     PARM           ZAMSID  7
537100200529     C                     PARM           ZAMSGF 10
537200200529     C                     PARM           ZAMSDA132
537300200529     C                     PARM           ZAMSTP  7
537400200529     C*
537500200529     C                     ENDSR
537600200529     C/COPY ZSRSRC,ZCCYGBZ1                                               48200
537700200529     C/COPY ZSRSRC,ZCCYCN
537800200529     C****/COPY ZSRSRC,ZCCYXR                                             47719
537900200529     C/COPY WNCPYSRC,SE6050C010
538000200529     C********************************************************************
538100200529     C/EJECT
538200200529     C********************************************************************
538300200529     C**                                                                 *
538400200529     C** *PSSR     - PROGRAM ERROR HANDLING ROUTINE                      *
538500200529     C**                                                                 *
538600200529     C** CALLS     - NONE                                                *
538700200529     C**                                                                 *
538800200529     C** CALLED BY - #ZAA                                                *
538900200529     C**                                                                 *
539000200529     C********************************************************************
539100200529     C           *PSSR     BEGSR
539200200529     C*
539300200529     C                     DUMP
539400200529     C*
539500200529     C                     ROLBK
539600200529     C*
539700200529     C                     MOVE '1'       *INLR
539800200529     C*
539900200529     C                     RETRN
540000200529     C*
540100200529     C                     ENDSR
540200200529     C********************************************************************
540300200529     C/EJECT
540400200529     O*****************************************************************
540500200529     O/EJECT
540600200529** CPY@
540700200529(c) Finastra International Limited 2001
540800200529**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
5409002005290000001
5410002005290000010
5411002005290000100
5412002005290001000
5413002005290010000
5414002005290100000
5415002005291000000
541600200529**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
5417002005290366073110961461
541800200529**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
541900200529000031059090120151181212243273304334365
542000200529**   ZMNM - MONTHS SHORT NAMES
542100200529JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
