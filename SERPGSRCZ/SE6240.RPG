     H
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Safe custody fee accruals')                   *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Modules                           *
     F*                                                               *
     F*  RPG/SE6240 - Safe Custody Fee Accruals                       *
     F*                                                               *
     F*  Function:  This Program calculates Fees Accrued on security  *
     F*  (COB)      positions and Precious Metal Account balances,    *
     F*             generates accrual postings and provides an accrual*
     F*             report.                                           *
     F*                                                               *
     F*  Called by: SEC6240 - Calculate Safe Custody Fee Accruals     *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. 226449             Date 24Jun15               *
      *  Prev Amend No. MD034776           Date 08Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 229857             Date 07Oct04               *
      *                 226570             Date 27Jun04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CGL029             Date 01Sep03               *
      *                 211407             Date 07Jan03               *
      *                 207543             Date 17Jul02               *
      *                 194370             Date 12Jul01               *
      *                 180056             Date 18Oct00               *
      *                 CSE035             Date 22Apr02               *
      *                 CGL020             Date 12Dec02               *
      *                 206316             Date 19Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun01               *
      *                 CSE031             Date 09Nov01               *
      *                 180707             Date 25Jul00               *
      *                 179044             Date 17Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 157193             Date 29Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 130862             Date 18Oct98               *
      *                 CTI002             DATE 23SEP98               *
      *                 151945             DATE 06Jan99               *
     F*                 CSE005             Date 09Mar98               *
     F*                 CAC003             Date 25Feb97               *
     F*                 084704             Date 01AUG96               *
     F*                 083039             DATE 01AUG96               *
     F*                 059110             DATE 25JUL96               *
     F*                 088047             DATE 27JUN96               *
     F*                 099886             DATE 18APR96               *
     F*                 100017             DATE 18APR96               *
     F*                 100125             DATE 26FEB96               *
     F*                 092961             DATE 04OCT95               *
     F*                 091522             DATE 15AUG95               *
     F*                 086491             DATE 15JUN95               *
     F*                 083825             DATE 12JUN95               *
     F*                 S01464             DATE 04APR94               *
     F*                 048360             DATE 11DEC92               *
     F*                 047719             DATE 24NOV92               *
     F*                    036734     JPJ     DATE 14APR92               *
     F*                    B07896     SC      DATE 15JUL91               *
     F*                    B5945      SC      DATE 15JUL91               *
     F**                   B5920      DC      DATE 15JUL91               *
     F**                   R5553              DATE 27FEB91               *
     F**                   R5516              DATE 27FEB91               *
     F**                   R0134              DATE 11FEB91               *
     F**                   R0131              DATE 11FEB91               *
     F*                                                                  *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A - Coupon rate was still used in computation of    *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  229857 - Recompiled due to change in ZYLDZ2.                 *
      *  226570 - Recompiled due to change in ZYLDZ2.                 *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  211407 - Recompile after change on copy sources ZYLDZ2,      *
      *           ZACCRZ1 and ZYCEZ1 for NX/NNX processing.           *
      *           The change was to call subroutine ZLCD1 instead     *
      *           of ZLCD in retrieving the PERIOD for NNX processing *
      *           and ZNCD1 is called instead of ZNCD in retrieving   *
      *           the WBENCD for NNX processing. Also rewrite tests   *
      *           for identifying if position is NX,NNX or CUM.       *
      *  207543 - CEU018 not working on a price basis.                *
      *           Recompile over changed ZYLDZ2.                      *
      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
      *           For securities with divisor basis = '5' and first   *
      *           coupon date > valuation date (rundate + 1), set     *
      *           event control date to first coupon date before      *
      *           processing SR/ZDYYR. This is to ensure that the     *
      *           correct hypothetical last and next coupon dates are *
      *           used in deriving the price/yield rate.              *
      *  180056 - Recompiled over changed in ZDYYRZ3.                 *
      *  CSE035 - NX/NNX Coupon Payment Processing.                   *
      *           Recompile over changed ZACCRZ1/ZYLDZ2
      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
      *           Information (Recompile)                             *
      *  206316 - Recompiled over changed ZLCDZ1.                     *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed ZYLDZ2.                      *
      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
      *           recompilation over amended subroutine ZACCR.        *
      *  180707 - No Position Settlements generated. Recompile over   *
      *           changes in /COPY ZNCDZ3.                            *
      *  179044 - Apply S01522 processing to enable Multi-language    *
      *           Posting Narratives in Safe Custody Fees.            *
      *  157193 - Report SE6240P1 is without a header.                *
      *  CGL007 - Account Postings Enquiry.  Recompile.               *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
     F*  130862 - Recompiled over ZLCDZ1 & ZDAYSZ2 changes.           *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  151945 - Recompiled Over changed ZDYYRZ3 .                   *
     F*  CSE005 - Effect of holidays on FRN coupon dates:             *
     F*           recompilation over amended subroutine ZACCR.        *
     F*  CAC003 - Profit Centre Accounting Development Phase 3.       *
     F*  084704 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  083039 - RECOMPILE OVER CHANGED ZYLDZ2 SUB.                  *
     F*  059110 - Recompile over changed ZYLDZ2 sub.                  *
     F*  088047 - RECOMPILE over change SR/ZYLDZ2.                    *
     F*  099886 - Rounding problem for partly paid securities.        *
     F*           Recompile over amended standard subroutine ZACCZ.   *
     F*  100017 - Position settlement unable to pick up day adjustment*
     F*           on SECTYD. Therefore subroutine ZDAYSZ2 changed to  *
     F*           use indicator DADJN to not apply interest rate      *
     F*           adjustment for amortisation if set to 'N'.          *
     F*  100125 - Fix 092961/086491 - recompile did not work because  *
     F*           SR/ZDAYSZ2 is internally defined in the program.    *
     F*           Amend pgm to use the version in ZSRSRC instead.     *
     F*           This also applied to ZDAYSZ3, ZDATE1Z2 and ZDATE2Z2.*
     F*           Note - these subroutines have been removed.         *
     F*  092961 - Recompile over ZDAYSZ2 which was amended by 086491  *
     F*           (Wrong number of days calculated for day basis 1    *
     F*           when start or end day is last day of February)      *
     F*  091522 - Safe Custody Fees - Private Banking (CSE001)        *
     F*  086491 - Wrong nbr of days calculated for day basis 1        *
     F*           when start or end day is last day of February       *
     F*           Recompiled for ZSRSRC/ZDAYSZ2 changes.              *
     F*  083825 - Overflow must be checked before writing a           *
     F*           detail line.                                        *
     F*  S01464 - Safe Custody Fees                                   *
     F*    48360  - DO NOT OUTPUT POSTINGS WITH ZERO AMOUNT
     F*    47719  - CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES
     F*    036734 - Recompiled due to changes on ZYLDZ2                  *
     F*    B07896 - CALCULATE ACCRUALS ON POSITIONS WITH NO MARKET       *
     F*             VALUE IF THE CHARGE BASIS IS FLAT                    *
     F*    B5945  - INCORRECT ACCRUALS FOR DISCOUNT SECURITIES           *
     F*             WRITE NO DETAILS IF POSITION IS FLAT                 *
     F*    B5920  - NO ACCRUALS HAVE BEEN CREATED|                       *
     F*    R5553  - ACCOUNT TYPES WRONG                                  *
     F*    R5516  - LAST BRACKET MISSING ON NARRATIVE. FIX NOT TESTED.   *
     F*    R0134  - Field names changes.                                 *
     F*    R0131  - Changes the presentation on report.                  *
     F*                                                                  *
     F********************************************************************
     F**  C R E A T I O N     P A R A M E T E R S                        *
     F*                                                                  *
     F*                                                                  *
     F********************************************************************
     F/EJECT
     F********************************************************************
     F*
     F**      FILE DEFINITIONS
     F**     ------------------
     F*
     F*****SAFE*CUSTODY*CUSTOMERS.*PREFIX*-*AZ/BB/BF*******************   S01464
     F***SCCUSTL1IF**E        K        DISK         KINFSR *PSSR          S01464
     F*
     F**   BANK*DETAILS. PREFIX - BJ
     FSDBANKPDIF  E                    DISK         KINFSR *PSSR
     F*
     F**   BRANCH DETAILS. PREFIX - A8
     FSDBRCHL1IF  E           K        DISK         KINFSR *PSSR
     F*****************************************************************   S01464
     F*****PORTFOLIO*MANAGEMENT*ICD*FILE.*PREFIX*-*P9******************   S01464
     F***SDPORTPDIF**E                 DISK         KINFSR *PSSR          S01464
     F*****************************************************************   S01464
     F*****PORTFOLIO*CUSTOMER*DEFINITION.*PREFIX*-*QB******************   S01464
     F***SDPLCSPDIF**E        K        DISK         KINFSR *PSSR          S01464
     F*****************************************************************   S01464
     F*****PORTFOLIO*DEFINITION.*PREFIX*-*PN***************************   S01464
     F***PMPORTLLIF**E        K        DISK         KINFSR *PSSR          S01464
     F*****************************************************************   S01464
     F*****SECURITY*CUSTOMER*POSITIONS.*PREFIX*-*CS********************   S01464
     F***SCSEPSLLIF**E        K        DISK         KINFSR *PSSR          S01464
     F*****************************************************************   S01464
     F*****PORTFOLIO*CUSTOMER*POSITIONS.*PREFIX*-*QA*******************   S01464
     F***SCPMPSLLIF**E        K        DISK         KINFSR *PSSR          S01464
     F*****************************************************************   S01464
     F*****SAFE*CUSTODY*CHARGE*DEFINITION.*PREFIX*-*SF*****************   S01464
     F***SCCGCDPDIF**E        K        DISK         KINFSR *PSSR          S01464
     F*****************************************************************   S01464
     F*****PRECIOUS*METAL*ACCOUNT*BALANCES*EXTRACT.*PREFIX*-*SE********   S01464
     F***SCPMABPDIF**E        K        DISK         KINFSR *PSSR          S01464
     F*                                                                   S01464
     F**   SAFE CUSTODY CUSTOMERS. PREFIX - AZ/BB/BF                      S01464
     FSECUSTL1IF  E           K        DISK         KINFSR *PSSR          S01464
     F*                                                                   S01464
     F**   Security Customer Positions. Prefix - CS                       S01464
     FSESEPSLLIF  E           K        DISK         KINFSR *PSSR          S01464
     F*                                                                   S01464
     F**   Safe Custody Charge Definition. Prefix - SF                    S01464
     FSECGCDPDIF  E           K        DISK         KINFSR *PSSR          S01464
     F*                                                                   S01464
     F**   Precious Metal Account Balances Extract. Prefix - SG           S01464
     FSEPMABPDIF  E           K        DISK         KINFSR *PSSR          S01464
     F*                                                                   091522
     F**   Portfolio customer definition. prefix - QB                     091522
     FSDPLCSL0IF  E           K        DISK         KINFSR *PSSR          091522
     F*                                                                   091522
     F**   Portfolio definition. prefix - PN                              091522
     FPMPORTLLIF  E           K        DISK         KINFSR *PSSR          091522
     F**   Portfolio customer positions. prefix - QA                      091522
     FSEPMPSL0IF  E           K        DISK         KINFSR *PSSR          091522
     F*                                                                   R5553
     FSDACODL0IF  E           K        DISK                               R5553
     F*
     F**   CURRENCY DETAILS. PREFIX - A6
     F***SDCURRJ0IF**E        K        DISK         KINFSR *PSSR          S01464
     FSDCURRL0IF  E           K        DISK         KINFSR *PSSR          S01464
     F*
     F**   SECURITY DETAILS.
     FSECTY   IF  E           K        DISK         KINFSR *PSSR
     F*
     F*****CUSTOMER/INSTRUMENT*CUSTODY*FEE*DETAILS.*PREFIX*-*SC********   S01464
     F***SCCICFPDIF**E        K        DISK         KINFSR *PSSR          S01464
     F*****************************************************************   S01464
     F*****SAFE*CUSTODY*ICD*FILE.*PREFIX*-*SA**************************   S01464
     F*SCICDPPDUF  E                    DISK         KINFSR *PSSR         B5920
     F***SCICDPPDIF**E                  DISK         KINFSR *PSSR   B5920 S01464
     F*****************************************************************   S01464
     F*****SAFE*CUSTODY*FEES*ACCRUED.*PREFIX*-*PC**********************   S01464
     F***SCSCFAPDUF**E        K        DISK         KINFSR *PSSR A        S01464
     F*                                                                   S01464
     F**   Safe Custody ICD File. Prefix - FB                             S01464
     FSDSCFEPDIF  E                    DISK         KINFSR *PSSR          S01464
     F*                                                                   S01464
     F**   Customer/Instrument Custody Fee Details. Prefix - SC           S01464
     FSECICFPDIF  E           K        DISK         KINFSR *PSSR          S01464
     F*                                                                   S01464
     F**   SAFE CUSTODY FEES ACCRUED. PREFIX - PC                         S01464
     FSESCFAPDUF  E           K        DISK         KINFSR *PSSR A        S01464
     F*
     F**   SAFE CUSTODY FEES POSTING FILE.
     FGESCPD  O   E           K        DISK         KINFSR *PSSR A
     F*
     F**   SAFE CUSTODY FEES POSTING FILE TRAILER
     FGESCZZ  O   E           K        DISK         KINFSR *PSSR A
     F*                                                                   S01464
     F**   ACCOUNT OFFICER DETAILS FILE. PREFIX - AZ                      S01464
     FSDACOFL1IF  E           K        DISK         KINFSR *PSSR      UC  S01464
     F*
     F**   CUSTODY FEES ACCRUED TODAY REPORT.
     FSE6240P1O   E             21     PRINTER      KINFDS ERF1DS     UC
     F                                              KINFSR *PSSR
     F*                                                                   B05945
     FSEDEV   IF  E           K        DISK                               B05945
     F*                                                                   S01464
     FSECEO   IF  E           K        DISK                               S01464
     F            SNDEVDF                           KRENAMESNDEVDO        S01464
     F            SEDEVDF                           KRENAMESEDEVDO        S01464
     F*                                                                   S01464
     FINVTP   IF  E           K        DISK                               S01464
     F*
     F**   CUSTODY FEES ACCRUED TODAY RUN CONTROLS REPORT
     FSE6240AUO   E             22     PRINTER      KINFDS ERF2DS
     F                                              KINFSR *PSSR
     F/COPY WNCPYSRC,SE6240F001
     F*
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F**                                                              *
     F** ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F**                 ------------------------                     *
     F**      10 - Multibranch Indicator                              *   S01464
     F**   21 - OVERFLOW INDICATOR ON PRINTER FILE                    *
     F**   22 - OVERFLOW INDICATOR ON RUN CONTROLS                    *
     F**                                                              *
     F**      30 - HEADINGS ALREADY WRITTEN ON NEW PAGE INDICATOR     *
     F**      31 - HEADER 3 NECESSARY INDICATOR                       *
     F**                                                              *
     F**      40 - READ FAIL ON SDBANKPD                              *
     F**      41 - READ FAIL ON SCICDPPD                              *
     F********42*-*CHAIN*FAIL*ON*SDCURRJ0*USING*BANK*CHARGING*CCY.*****   S01464
     F**      42 - CHAIN FAIL ON SDCURRL0 USING BANK CHARGING CCY.    *   S01464
     F**      43 - READ FAIL ON SDPORTPD                              *
     F**      44 - READ FAIL ON SCCUSTL1                              *
     F**      45 - CHAIN FAIL ON SDPLCSPD                             *
     F**      46 - CHAIN FAIL ON SCSCFAPD                             *
     F**      47 - CHAIN FAIL ON SCSEPSLL                             *
     F**      48 - CHAIN FAIL ON SECTY                                *
     F**      49 - CHAIN FAIL ON SCCGCDPD                             *
     F********50*-*CHAIN*FAIL*ON*SDCURRJ0*USING*NOMINAL*CCY.***********   S01464
     F**      50 - CHAIN FAIL ON SDCURRL0 USING NOMINAL CCY.          *   S01464
     F**      51 - CHAIN FAIL ON SCCICFPD                             *
     F**      52 - CHAIN FAIL ON SDBRCHL1                             *
     F**      53 - CHAIN FAIL ON SCPMABPD                             *
     F**      54 - CHAIN FAIL ON PMPORTLL                             *
     F**      55 - CHAIN FAIL ON SCPMPSLL                             *
     F********56*-*CHAIN*FAIL*ON*SDCURRJ0*USING*ACCOUNT*CCY.***********   S01464
     F**      56 - CHAIN FAIL ON SDCURRL0 USING ACCOUNT CCY.          *   S01464
     F**      57 - CHAIN FAIL ON SDACOFL1                             *   S01464
     F**      90 - NEGATIVE OR ZERO RESULT ON SUB OPERATION           *   S01464
     F**                                                              *
     F*****************************************************************
     E/EJECT
     E*****************************************************************
     E*****************************************************************   S01464
     E*****QCMDEXC*ARRAY***********************************************   S01464
     E***********         CMD     1   1 39                                S01464
     E*****************************************************************   S01464
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E**   ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E**   ARRAY FOR STANDARD SUBROUTINE ZSEDIT
     E*/COPY ZSRSRC,ZSEDITZ1
     E                    ZS1        15  1 0
     E                    ZS2        21  1
     E*
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E**   ARRAY FOR STANDARD SUBROUTINE ZPMCRG
     E*/COPY ZSRSRC,ZPMCRGZ1
     E                    ZRA        14 15 0             RANGE LIMITS
     E                    ZRB        15 15 0             INTERNAL RANGE LIMITS
     E                    ZPC        15 11 7             PERCENTAGES
     E                    ZCG        15 15 0             FLAT CHARGES
     E*
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E**   ARRAY FOR STANDARD SUBROUTINE ZDAYS
     E*/COPY ZSRSRC,ZDAYSZ1
     E                    ZF29   14  32  5 0             29TH FEB ARRAY
     E*
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E**   ARRAY FOR STANDARD SUBROUTINE ZDYYR
     E*/COPY ZSRSRC,ZDYYRZ1
     E***                 CD         12  5 0             CD01-12 ARRAY CE14 GB
     E                    CD         12  4 0             CD01-12 ARRAY CE14 GB
     E                    CR         12  1               CR01-12 ARRAY
     E*
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E**   ARRAY FOR STANDARD SUBROUTINE ZDATE2
     E*/COPY ZSRSRC,ZDATE2Z1
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E*
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E** ARRAY USED IN CURRENCY AMOUNT CONVERSION
     E*/COPY ZSRSRC,ZPOWERZ1
     E                    POWER   1   7  7 3             POWER ARRAY
     E*
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E** ARRAY USED IN CURRENCY AMOUNT CONVERSION FOR ZAPNUM
     E*/COPY ZSRSRC,ZPOWER8Z1
     E                    POWER8  1   8  8 4             POWER8 ARRAY
     E*
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E** ARRAY USED FOR 'POSTING NARRATIVE' ON PF/GESCPD
     E                    PNARR   1   1 15
     E*
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E*                                                                   S01464
     E** NUMBER OF DAYS IN EACH MONTH                                     S01464
     E                    ZFMD   12  12  2               ZFREQ SR. ARRAY  S01464
     E*
     E*****************************************************************
     E*                                                                   S01464
     E/COPY ZSRSRC,ZACCRZ0                                                S01464
     E*****************************************************************   S01464
     E/EJECT                                                              S01464
     E*****************************************************************   S01464
     I/EJECT
     I*****************************************************************
     I*
     I**   DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I**   PROGRAM STATUS DATA STRUCTURE
     IPSDS       SDS
     I                                      244 253 JOB
     I                                      254 263 USER
     I*
     I**   FILE INFORMATION DATA STRUCTURE
     IERF1DS      DS
     I                                       83  92 SFILE                 S01464
     I                                    B 123 1240SFNUM                 S01464
     I**   FOR OVERFLOW
     I                                    B 367 3680LINE
     IERF2DS      DS
     I                                       83  92 SFILEU                S01464
     I                                    B 123 1240SFNUMU                S01464
     I**   FOR OVERFLOW
     I                                    B 367 3680LINE1
     I*                                                                   S01464
     I** Rundate data area                                                S01464
     I*                                                                   S01464
     IRUNDT       DS                             13                       S01464
     I                                       13  13 MBIN                  S01464
     I*
     I**   LOCAL DATA AREA
     ILDA        UDS                            256
     I**************************************132 141 DBFILE                S01464
     I                                      134 141 DBFILE                S01464
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I********************************************************************
     I/EJECT
     I********************************************************************
     I*
     I**  DATA STRUCTURE FOR 'POSTING NARRATIVE' ON PF/GESCPD
     IPNART       DS
     I                                        1  30 WWPNAR
     I                                        1  15 WWTEXT
     I                                       16  17 WWSPAC
     I                                       17  22 WWCUSN
     I                                       23  24 WWLBRK
     I                                       25  28 WWPORT
     I                                       29  30 WWRBRK
     I**                                                                  B05945
     I/COPY ZSRSRC,ZYLDZ1                                                 B05945
     I/COPY ZSRSRC,ZNCDZ2                                                 B05945
     I********************************************************************
     I/EJECT
     I********************************************************************
     I*
     I**  FIELD NAME FOR 'POSTING RECORD INDICATOR' ON PF/GESCPD
     I*
     I**            '01234567'            C         BITNC                 R5516
     I********************************************************************
     I/EJECT
     I********************************************************************
     I*
     I**  DATA STRUCTURE FOR 'ACCOUNT CODE' ON REPORT
     IACNT        DS
     I**********                              1  14 WWACNT                                    CGL029
     I                                        1  20 WWACNT                                    CGL029
     I**********                              1   60SGCNUM                                    CSD027
     I                                        1   6 SGCNUM                                    CSD027
     I                                        7   7 WWDASH
     I**********                              8  110SGACOD                                    CGL029
     I**********                             12  12 WWDAS1                                    CGL029
     I**********                             13  140SGACSQ                                    CGL029
     I                                        8  170SGACOD                                    CGL029
     I                                       18  18 WWDAS1                                    CGL029
     I                                       19  200SGACSQ                                    CGL029
     I********************************************************************
     I/EJECT
     I********************************************************************
     I*
     I**  DATA STRUCTURE FOR DATE OF LAST UPDATE ON PF/SCSCFAPD
     IDATE        DS
     I                                        1   7 BJMRDT
     I                                        1   20WWDAYU
     I                                        3   5 WWMTHU
     I                                        6   70WWYERU
     I*
     I*    MIDAS 'Next Available Transaction No.' Data Area DNATN .
     IDNATN       DS                              5
     I                                        1   50FNATN
     I********************************************************************
     I/EJECT
     I********************************************************************
     I*
     I**  EXTERNAL DATA STRUCTURE FOR 'EVENT CONTROL DATE' FROM SDSTAT
     ISDSTAT    EUDS
     I*
     I********************************************************************
     I/EJECT
     I********************************************************************
     I*
     I** DATA STRUCTURE FOR STANDARD SUBROUTINE ZSEDIT
     I*
     I*/COPY ZSRSRC,ZSEDITZ2
     I            DS
     I                                        1  150WORK15
     I                                        1  150ZS1
     I*
     I********************************************************************
     I/EJECT
     I********************************************************************
     I*
     I** DATA STRUCTURE FOR STANDARD SUBROUTINE ZDYYR
     I*
     I*/COPY ZSRSRC,ZDYYRZ2
     I*CRDS        DS                                                     B05945
     I*                                       1   1 CR01                  B05945
     I*                                       2   2 CR02                  B05945
     I*                                       3   3 CR03                  B05945
     I*                                       4   4 CR04                  B05945
     I*                                       5   5 CR05                  B05945
     I*                                       6   6 CR06                  B05945
     I*                                       7   7 CR07                  B05945
     I*                                       8   8 CR08                  B05945
     I*                                       9   9 CR09                  B05945
     I*                                      10  10 CR10                  B05945
     I*                                      11  11 CR11                  B05945
     I*                                      12  12 CR12                  B05945
     I*                                       1  12 CR                    B05945
     I********************************************************************
     ISDPORT    E DSSDPORTPD                                              091522
     I** EXTERNAL DS FOR PM ICD                                           091522
     ISDMMOD    E DSSDMMODPD                                              091522
     I** EXTERNAL DS FOR MMOD                                             091522
     IDSFDY     E DSDSFDY                                                 091522
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                091522
     IDSSDY     E DSDSSDY                                                 091522
     I* DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                       091522
     I/COPY WNCPYSRC,SE6240I001
     I/EJECT
      *                                                                   179044
      ** SAR File Details Accessed via access program AOSARDR0            179044
      *                                                                   179044
     ISCSARD    E DSSCSARDPD                                              179044
      *                                                                   179044
      ** UDC Multi Language Narrative Data Structure                      179044
      *                                                                   179044
     ICGPNAR    E DSCGPNARPD                                              179044
      *                                                                   179044
      ** Data Structure for Customer and Branch                           179044
      *                                                                   179044
     I##PRM1      DS                                                      179044
     I                                        1   6 A#CUST                179044
     I                                        7   9 A#BRCA                179044
     I/EJECT                                                              179044
     I********************************************************************
     C*                                                               *
     C**   KEY LISTS USED IN PROGRAM                                  *
     C**   -------------------------                                  *
     C*                                                               *
     C**   KEY LIST FOR PF/SCSCFAPD
     C           WWKEY1    KLIST                                      *
     C                     KFLD           WWBRCH                      *   S01464
     C                     KFLD           WWCNUM                      *
     C                     KFLD           WWPTFR                      *
     C*                                                               *
     C**   KEY LIST FOR PFSCCICFPD                                    *
     C           WWKEY2    KLIST                                      *
     C                     KFLD           WWFGCK                      *
     C                     KFLD           WWCNOK                      *
     C                     KFLD           WWCSQK                      *
     C                     KFLD           WWSSNK                      *
     C                     KFLD           WWCCYK                      *
     C                     KFLD           WWIVTK                      *
     C*                                                               *
     C**   KEY LIST FOR PF/SCPMABPD
     C           WWKEY3    KLIST                                      *
     C                     KFLD           WWCNUM                      *
     C                     KFLD           WWPTFR                      *
     C                     KFLD           WWCCYP                      *
     C                     KFLD           WWACOD                      *
     C                     KFLD           WWACSQ                      *
     C*                                                               *   S01464
     C**   Key List for LF/INVTP                                          S01464
     C           WWKEY4    KLIST                                      *   S01464
     C                     KFLD           NMCY                        *   S01464
     C                     KFLD           SITP                        *   S01464
     C*                                                               *
     C**   KEY LIST FOR LF/SEPMPSL0                                       091522
     C           WWKEY5    KLIST                                      *   091522
     C                     KFLD           WWCNUM                      *   091522
     C                     KFLD           WWPTFR                      *   091522
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**              START MAIN
     C**             -------------
     C*
     C**   INITIAL PROCESSING
     C                     EXSR #INIT
     C*
     C**   CUSTOMER PROCESSING
     C                     EXSR #P01
     C*
     C**   AUDIT PROCESSING
     C**   Check first if null indicator is not set on                    S01464
     C           WWNUIN    IFNE '1'                                       S01464
     C                     EXSR #P12
     C                     END                                            S01464
     C*                                                                   S01464
     C** Call ZSFILE for AU file                                          S01464
     C*                                                                   S01464
     C                     Z-ADDSFNUMU    ZSNUM   60                      S01464
     C                     CALL 'ZSFILE'                                  S01464
     C                     PARM           SEQ     5                       S01464
     C                     PARM *BLANKS   @PARM   3                       S01464
     C                     PARM           SFILEU                          S01464
     C                     PARM           ZSNUM                           S01464
     C                     PARM           ZSERR   1                       S01464
     C*                                                                   S01464
     C           ZSERR     IFEQ 'Y'                                       S01464
     C                     MOVE '1'       *INU7                           S01464
     C                     MOVE '1'       *INU8                           S01464
     C                     MOVE '1'       *INLR                           S01464
     C                     RETRN                                          S01464
     C                     END                                            S01464
     C*
     C**   END PROGRAM
     C                     MOVE '1'       *INLR
     C*
     C*****CLOSE*PRINTER*FILE******************************************   S01464
     C***********          CLOSESE6240P1                                  S01464
     C                     RETRN
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #INIT     BEGSR
     C*                                                                   S01464
     C** Move the copyright statement                                     S01464
     C*                                                                   S01464
     C                     MOVEACPY@      BIS@   80                       S01464
     C*                                                                   S01464
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01464
     C                     IN   RUNDT                                     S01464
     C*
     C**   INITIALISE DB ERROR FIELDS AND STORE PROGRAM NAME FOR
     C**   DB ERROR FIELD.
     C**   Prepare LDA                                                    S01464
     C*                                                                   S01464
     C           *NAMVAR   DEFN           LDA                             S01464
     C           *LOCK     IN   LDA                                       S01464
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     MOVE *BLANKS   DBPGM                           S01464
     C                     MOVEL'SE6240'  DBPGM
     C                     OUT  LDA                                       S01464
     C*
     C**   RETRIEVE 'EVENT CONTROL DATE' FROM SDSTAT FOR STANDARD
     C**    SUBROUTINE ZDYYR
     C                     MOVE MECD      ECD     50
     C*
     C**   DEFINE WORK FIELDS
     C************LIKE     DEFN SABCGC    WWBCGC                          S01464
     C           *LIKE     DEFN FBBCGC    WWBCGC                          S01464
     C           *LIKE     DEFN BBCUST    WWCUST
     C************LIKE     DEFN AZPRTL    WWPLOC                          S01464
     C************LIKE     DEFN AZACOC    WWACOC                          S01464
     C           *LIKE     DEFN BBACOC    WWACOC                          S01464
     C           *LIKE     DEFN SDPTFR    WWPTFR
     C           *LIKE     DEFN BFCFGC    WWCFGC
     C           *LIKE     DEFN CSSC      WWCSSC
     C           *LIKE     DEFN SCCGCO    WWCGCO
     C           *LIKE     DEFN SCCFGC    WWFGCK
     C           *LIKE     DEFN SCSESN    WWSSNK
     C           *LIKE     DEFN SCCCY     WWCCYK
     C           *LIKE     DEFN SCCCY     WWLCCY
     C           *LIKE     DEFN SCSITP    WWIVTK
     C           *LIKE     DEFN SCCNUM    WWCNUM
     C           *LIKE     DEFN SCCNUM    WWCNOK
     C           *LIKE     DEFN SCCKSQ    WWCSQK
     C           *LIKE     DEFN BBBRCD    WWBRCD
     C           *LIKE     DEFN BBBRCD    WWBRCH                          S01464
     C           *LIKE     DEFN SDCFAC    WWCFAC
     C           *LIKE     DEFN SDOSAJ    WWOSAJ
     C           *LIKE     DEFN SDOSAS    WWOSAS
     C           *LIKE     DEFN SGACOD    WWACOD
     C           *LIKE     DEFN SGACSQ    WWACSQ
     C           *LIKE     DEFN SGBRCA    WWBRCA                          S01464
     C**
     C           PMPORK    KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           WWPREF  4
     C*
     C**   INITIALISE WORK FIELDS
     C                     MOVE *BLANKS   WWBCGC
     C                     MOVE *BLANKS   WWCUST
     C***********          MOVE *BLANKS   WWPLOC                          S01464
     C***********          MOVE *BLANKS   WWPRTL                          S01464
     C                     MOVE *BLANKS   WWACOC
     C                     MOVE *BLANKS   WWPTFR
     C                     MOVE *BLANKS   WWCFGC
     C                     MOVE *BLANKS   WWCSSC
     C                     MOVE *BLANKS   WWCGCO
     C                     MOVE *BLANKS   WWFGCK
     C                     MOVE *BLANKS   WWSSNK
     C                     MOVE *BLANKS   WWCCYK
     C                     MOVE *BLANKS   WWIVTK
     C                     MOVE *BLANKS   WWBRCD
     C                     MOVE *BLANKS   WWBRCH                          S01464
     C                     MOVE *BLANKS   WWOSAS
     C                     MOVE *BLANKS   WWBRCA                          S01464
     C                     MOVE *BLANKS   WWBLHD  1                       S01464
     C**********           Z-ADD*ZEROS    WWCNUM                                              CSD027
     C**********           Z-ADD*ZEROS    WWCNOK                                              CSD027
     C                     MOVE *BLANKS   WWCNUM                                              CSD027
     C                     MOVE *BLANKS   WWCNOK                                              CSD027
     C                     Z-ADD*ZEROS    WWCSQK
     C                     Z-ADD*ZEROS    WWCFAC
     C                     Z-ADD*ZEROS    WWOSAJ
     C                     Z-ADD*ZEROS    WWTOTP 180
     C                     Z-ADD*ZEROS    WWNUMR  50
     C                     MOVE 'N'       DADJN                           100017
     C*
     C**   INITIALISE OUTPUT FIELDS
     C***********          MOVE *BLANKS   RRPLOC                          S01464
     C                     MOVE *BLANKS   RRBRCD                          S01464
     C                     MOVE *BLANKS   RRACOC
     C                     MOVE *BLANKS   RRACON
     C***********          MOVE *BLANKS   RRCNM1                          S01464
     C***********          MOVE *BLANKS   RRSNM1                          S01464
     C***********          MOVE *BLANKS   RRPNM1                          S01464
     C***********          MOVE *BLANKS   RRPSN1                          S01464
     C***********          MOVE *BLANKS   RRAFG1                          S01464
     C                     MOVE *BLANKS   RRCNM2
     C                     MOVE *BLANKS   RRSNM2
     C                     MOVE *BLANKS   RRAFG2
     C                     MOVE *BLANKS   RRBCCY
     C                     MOVE *BLANKS   RRCCCY
     C                     MOVE *BLANKS   RRFATT
     C                     MOVE *BLANKS   RROTAS
     C                     MOVE *BLANKS   RROUTA
     C                     MOVE *BLANKS   RRFATD
     C                     MOVE *BLANKS   RRBRCA                          S01464
     C                     MOVE *BLANKS   RRSCTY
     C                     MOVE *BLANKS   RRIVTS
     C                     MOVE *BLANKS   RRNMCS
     C                     MOVE *BLANKS   RRNPSS
     C                     MOVE *BLANKS   RRMNCS
     C                     MOVE *BLANKS   RRMCCS
     C                     MOVE *BLANKS   RRFECS
     C                     MOVE *BLANKS   RRAATS
     C                     MOVE *BLANKS   RRACNT
     C                     MOVE *BLANKS   RRIVTA
     C                     MOVE *BLANKS   RRNMCA
     C                     MOVE *BLANKS   RRNPSA
     C                     MOVE *BLANKS   RRMNCA
     C                     MOVE *BLANKS   RRMCCA
     C                     MOVE *BLANKS   RRFECA
     C                     MOVE *BLANKS   RRAATA
     C                     Z-ADD*ZEROS    RRPROG
     C*
     C** SET UP ACCOUNT FORMAT DETAILS
     C                     MOVE '-'       WWDASH
     C                     MOVE '-'       WWDAS1
     C*
     C**   SET OFF ALL INDICATORS
     C                     MOVEA'00'      *IN,21
     C                     MOVEA'00'      *IN,30
     C                     MOVEA'0000000' *IN,40
     C                     MOVEA'0000000' *IN,47
     C                     MOVEA'000'     *IN,54
     C                     MOVE '1'       *IN98
     C*
     C**   INITIALISE LINE COUNTERS
     C                     Z-ADD*ZEROS    LINE
     C                     Z-ADD*ZEROS    LINE1
     C*
     C*****BUILD*COMMAND*EXPRESSION*FOR*QCMDEXC************************   S01464
     C***********          MOVELCMD,1     WWCMDP 43                       S01464
     C***********          MOVE ')'       WWPRTL  4                       S01464
     C*                                                                   S01464
     C** Test for multibranching                                          S01464
     C*                                                                   S01464
     C           MBIN      IFEQ 'Y'                                       S01464
     C                     MOVE '1'       *IN10                           S01464
     C                     END                                            S01464
     C/COPY WNCPYSRC,SE6240C001
      *                                                                                       CSE035
      *  Access SAR details file to see if CSE035 is installed                                CSE035
      *                                                                                       CSE035
     C                     CALL 'AOSARDR0'                                                    CSE035
     C                     PARM *BLANKS   @RTCD                                               CSE035
     C                     PARM '*VERIFY' @OPTN                                               CSE035
     C                     PARM 'CSE035'  WSARD   6                                           CSE035
      *                                                                                       CSE035
     C           @RTCD     IFEQ *BLANK                                                        CSE035
     C                     MOVE 'Y'       CSE035  1                                           CSE035
     C                     ELSE                                                               CSE035
     C                     MOVE 'N'       CSE035                                              CSE035
     C                     ENDIF                                                              CSE035
      *                                                                                       207543
      ** Access SAR details file to see if CEU018 is installed                                207543
      *                                                                                       207543
     C                     CALL 'AOSARDR0'                                                    207543
     C                     PARM *BLANKS   @RTCD                                               207543
     C                     PARM '*VERIFY' @OPTN                                               207543
     C                     PARM 'CEU018'  WSARD                                               207543
      *                                                                                       207543
     C           @RTCD     IFEQ *BLANK                                                        207543
     C                     MOVE 'Y'       CEU018  1                                           207543
     C                     ELSE                                                               207543
     C                     MOVE 'N'       CEU018                                              207543
     C                     ENDIF                                                              207543
     C*
     C**   ACCESS ICD FILE SDBANKL1
     C           1         SETLLSDBANKPD
     C                     READ SDBANKPD                 40
     C*
     C**   IF RECORD NOT FOUND OR DELETED
     C           *IN40     IFEQ '1'
     C           BJTYLC    OREQ 'D'
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD1         DBASE
     C                     MOVE *BLANKS   DBFILE           ***************
     C                     MOVEL'SDBANKPD'DBFILE           * DBERROR 001 *
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C                     END
     C*
     C*****ACCESS*SAFE*CUSTODY*ICD*FILE********************************   S01464
     C***********1         SETLLSCICDPPD                                  S01464
     C***********          READ SCICDPPD                 41               S01464
     C*****************************************************************   S01464
     C*****IF*RECORD*NOT*FOUND*OR*DELETED******************************   S01464
     C************IN41     IFEQ '1'                                       S01464
     C***********SACHTP    OREQ 'D'                                       S01464
     C***********          Z-ADD2         DBASE                           S01464
     C***********          MOVE *BLANKS   DBFILE           ***************S01464
     C***********          MOVEL'SCICDPPD'DBFILE           * DBERROR 002 *S01464
     C***********          MOVE *BLANKS   DBKEY            ***************S01464
     C***********          EXSR #ZA                                       S01464
     C*****************************************************************   S01464
     C***********          ELSE                                           S01464
     C*****************************************************************   S01464
     C*****SAVE*'LAST*ACCRUAL*DATE'*AND*'CURRENT*ACCRUAL*DATE'*INTO****   S01464
     C******SR/ZPMCRG*PARAMETER*FIELDS*********************************   S01464
     C***********          Z-ADDSALCRD    ZFMDAT                          S01464
     C***********          Z-ADDSACCRD    ZTODAT                          S01464
     C*****************************************************************   S01464
     C*****SAVE*'BANK*CHARGING*CCY'*INTO*A*WORK*FIELD*AND*INTO*********   S01464
     C******SR/ZCCYCN*PARAMETER*FIELD**********************************   S01464
     C***********          MOVE SABCGC    WWBCGC                          S01464
     C***********          MOVE SABCGC    ZCCYT                           S01464
     C***********          END                                            S01464
     C*                                                                   S01464
     C**   Access Safe Custody ICD File                                   S01464
     C           1         SETLLSDSCFEPD                                  S01464
     C                     READ SDSCFEPD                 41               S01464
     C*                                                                   S01464
     C**   If Record Not Found or Deleted                                 S01464
     C           *IN41     IFEQ '1'                                       S01464
     C           FBTYLC    OREQ 'D'                                       S01464
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD2         DBASE                           S01464
     C                     MOVE *BLANKS   DBFILE           ***************S01464
     C                     MOVEL'SDSCFEPD'DBFILE           * DBERROR 002 *S01464
     C                     MOVE *BLANKS   DBKEY            ***************S01464
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA                                       S01464
     C*                                                                   S01464
     C                     ELSE                                           S01464
     C*                                                                   S01464
     C**   Compute last accrual date based on current accrual date and    S01464
     C**   accrual frequency if last accrual date is zero.                S01464
     C           FBLCRD    IFEQ 0                                         S01464
     C                     EXSR ZLCRD                                     S01464
     C                     Z-ADDZDAYNO    FBLCRD                          S01464
     C                     END                                            S01464
     C*                                                                   S01464
     C**   Save 'LAST ACCRUAL DATE' and 'CURRENT ACCRUAL DATE' into       S01464
     C**    SR/ZPMCRG parameter fields                                    S01464
     C                     Z-ADDFBLCRD    ZFMDAT                          S01464
     C                     Z-ADDFBCCRD    ZTODAT                          S01464
     C*                                                                   S01464
     C**   Save 'BANK CHARGING CCY' into a work field and into            S01464
     C**    SR/ZCCYCN parameter field                                     S01464
     C                     MOVE FBBCGC    WWBCGC                          S01464
     C                     MOVE FBBCGC    ZCCYT                           S01464
     C                     END                                            S01464
     C*
     C**   MOVE 'CURRENT ACCRUAL DATE' TO 'LAST ACCRUAL DATE' AND
     C**    UPDATE PF/SCICDPPD
     C**                   Z-ADDSACCRD    SALCRD                          B5920
     C**                   UPDATSCICDPP0                                  B5920
     C*
     C**   ACCESS CURRENCY CODES FILE WITH BANK CHARGING CURRENCY
     C***********WWBCGC    CHAINSDCURRJ0             42                   S01464
     C           WWBCGC    CHAINSDCURRL0             42                   S01464
     C*
     C**   IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C           *IN42     IFEQ '1'
     C           A6TYLC    OREQ 'D'
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD3         DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDCURRJ0'DBFILE         ** DBERROR  003**S01464
     C                     MOVEL'SDCURRL0'DBFILE           **DBERROR 003**S01464
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVELWWBCGC    DBKEY
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C*
     C                     ELSE
     C*
     C**   SAVE 'SPOT RATE' 'MULTIPLY/DIVIDE INDICATOR' AND 'BANK
     C**    CHARGING CCY DECIMAL PLACES' INTO SR/ZCCYCN PARAMETERS
     C                     Z-ADDA6SPRT    ZRATET
     C                     MOVE A6MDIN    ZMDINT
     C                     MOVE A6NBDP    ZCDPT
     C                     END
     C*
     C*****ACCESS*PORTFOLIO*MANAGEMENT*ICD*FILE************************   S01464
     C***********1         SETLLSDPORTPD                                  S01464
     C***********          READ SDPORTPD                 43               S01464
     C*****************************************************************   S01464
     C*****IF*RECORD*NOT*FOUND*OR*DELETED******************************   S01464
     C************IN43     IFEQ '1'                                       S01464
     C**         P9TYLC    OREQ 'D'                                       R0134
     C***********P9ADST    OREQ 'D'                                 R0134 S01464
     C***********          Z-ADD4         DBASE                           S01464
     C***********          MOVE *BLANKS   DBFILE           ***************S01464
     C***********          MOVEL'SDPORTPD'DBFILE           * DBERROR 004 *S01464
     C***********          MOVE *BLANKS   DBKEY            ***************S01464
     C***********          EXSR #ZA                                       S01464
     C***********          END                                            S01464
     C*                                                                   091522
     C**   ACCESS PORTFOLIO MANAGEMENT ICD FILE IF MODULE IS ON           091522
     C                     CALL 'AOMMODR0'                                091522
     C                     PARM *BLANKS   P@RTCD  7                       091522
     C                     PARM '*FIRST'  P@OPTN  7                       091522
     C           SDMMOD    PARM SDMMOD    DSSDY                           091522
     C           P@RTCD    IFNE *BLANKS                                   091522
     C                     Z-ADD11        DBASE                           091522
     C                     MOVE *BLANKS   DBFILE           ***************091522
     C                     MOVEL'SDMMODPD'DBFILE           * DBERROR 011 *091522
     C                     MOVE *BLANKS   DBKEY            ***************091522
     C                     EXSR #ZA                                       091522
     C                     ELSE                                           091522
     C           BGPFMG    IFEQ 'Y'                                       091522
     C                     CALL 'AOPORTR0'                                091522
     C                     PARM *BLANKS   P@RTCD                          091522
     C                     PARM '*FIRST'  P@OPTN                          091522
     C           SDPORT    PARM SDPORT    DSFDY                           091522
     C*                                                                   091522
     C           P@RTCD    IFNE *BLANKS                                   091522
     C                     Z-ADD4         DBASE                           091522
     C                     MOVE *BLANKS   DBFILE           ***************091522
     C                     MOVEL'SDPORTPD'DBFILE           * DBERROR 004 *091522
     C                     MOVE *BLANKS   DBKEY            ***************091522
     C                     EXSR #ZA                                       091522
     C                     END                                            091522
     C                     END                                            091522
     C                     END                                            091522
      *                                                                   179044
      **  Check for Switchable feature                                    179044
      *                                                                   179044
     C                     MOVE 'N'       SEPNAR  1                       179044
     C           BGN1ST    IFEQ 'Y'                                       179044
      *                                                                   179044
     C                     CALL 'AOSARDR0'                                179044
     C                     PARM '       ' @RTCD   7                       179044
     C                     PARM '*VERIFY' @OPTN   7                       179044
     C                     PARM 'SEPNAR'  @SARD   6                       179044
     C           SCSARD    PARM SCSARD    DSFDY                           179044
      *                                                                   179044
     C           @RTCD     IFNE *BLANK                                    179044
     C           @RTCD     ANDNE'*NRF   '                                 179044
     C           *LOCK     IN   LDA                                       179044
     C                     SETON                     U7U8                 179044
     C                     MOVEL'SCSARDPD'DBFILE           ************** 179044
     C                     Z-ADD13        DBASE            * DBERROR 13 * 179044
     C                     MOVEL@SARD     DBKEY            ************** 179044
     C                     OUT  LDA                                       179044
     C                     EXSR #ZA                                       179044
     C                     ENDIF                                          179044
      *                                                                   179044
     C           @RTCD     IFEQ *BLANK                                    179044
     C                     MOVE 'Y'       SEPNAR                          179044
     C                     ENDIF                                          179044
     C                     ENDIF                                          179044
      *                                                                   CAC003
      ** Check if CAC003 is switched on.                                  CAC003
      *                                                                   CAC003
     C                     SETOF                     20                   CAC003
      *                                                                   CAC003
     C                     CALL 'AOSARDR0'                                CAC003
     C                     PARM           P@RTCD                          CAC003
     C                     PARM '*VERIFY' P@OPTN                          CAC003
     C                     PARM 'CAC003'  P@SARD  6                       CAC003
      *                                                                   CAC003
     C           P@RTCD    IFEQ *BLANK                                    CAC003
     C           BGN0ST    ANDEQ'Y'                                       CAC003
     C                     SETON                     20                   CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C/COPY WNCPYSRC,SE6240C024
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #P01      BEGSR
     C*
     C*****READ*FROM*LF/SCCUSTL1***************************************   S01464
     C***********          READ SCCUSTL1                 44               S01464
     C**   Read from LF/SECUSTL1                                          S01464
     C                     READ SECUSTL1                 44               S01464
     C*
     C*****IF*NO*RECORDS*ON*SCCUSTL1***********************************   S01464
     C**   If no records on SECUSTL1                                      S01464
     C           *IN44     IFEQ '1'
     C***********          OPEN SE6240P1                                  S01464
     C***********          WRITEHEADER1                                   S01464
     C***********          MOVE SABCGC    RRBCCY                          S01464
     C***********          MOVE SABCGC    RRCCCY                          S01464
     C***********          WRITEHEADER3                                   S01464
     C                     MOVE '1'       WWNUIN  1                       S01464
     C                     WRITEHEADER                                    S01464
     C                     WRITENULL1
     C***********          WRITEFOOTING1                                  S01464
     C                     ELSE
     C*
     C*****MOVE*PRINTER*LOCATION*INTO*WORK*FIELD*AND*CALL*'QCMDEXC'****   S01464
     C***********          MOVE AZPRTL    WWPLOC                          S01464
     C***********          MOVELAZPRTL    WWPRTL                          S01464
     C***********          MOVE WWPRTL    WWCMDP                          S01464
     C***********          CALL 'QCMDEXC'                                 S01464
     C***********          PARM WWCMDP    QCAA   43                       S01464
     C***********          PARM 43        QCAN   155                      S01464
     C*                                                                   S01464
     C**   Move Branch Code into a work field                             S01464
     C                     MOVE BBBRCD    WWBRCH                          S01464
     C                     OPEN SE6240P1
     C                     MOVE 'Y'       WWOPEN  1                       S01464
     C*                                                                   S01464
     C** Call ZSFILE for P1 file                                          S01464
     C*                                                                   S01464
     C                     Z-ADDSFNUM     ZSNUM   60                      S01464
     C                     CALL 'ZSFILE'                                  S01464
     C                     PARM           SEQ     5                       S01464
     C                     PARM BBBRCD    @PARM   3                       S01464
     C                     PARM           SFILE                           S01464
     C                     PARM           ZSNUM                           S01464
     C                     PARM           ZSERR   1                       S01464
     C*                                                                   S01464
     C           ZSERR     IFEQ 'Y'                                       S01464
     C                     MOVE '1'       *INU7                           S01464
     C                     MOVE '1'       *INU8                           S01464
     C                     MOVE '1'       *INLR                           S01464
     C                     RETRN                                          S01464
     C                     END                                            S01464
     C*
     C*****DO*WHILE*RECORDS*EXIST*ON*SCCUSTL1**************************   S01464
     C**   Do while records exist on SECUSTL1                             S01464
     C           *IN44     DOWEQ'0'
     C*
     C*****MOVE*CUSTOMER*NUMBER*ON*SCCUSTL1*INTO*A*CHARACTER*AND*A*****   S01464
     C******NUMERIC*WORK*FIELD*****************************************   S01464
     C**   Move customer number on SECUSTL1 into a character and a        S01464
     C**    numeric work field                                            S01464
     C                     MOVE BBCUST    WWCUST
     C                     MOVE BBCUST    WWCNUM
     C                     MOVE BFCFGC    WWCFGC
     C                     MOVE BBCRNM    ##CRNM                          179044
     C/COPY WNCPYSRC,SE6240C002
     C*
     C**   IF AT END OF PAGE WRITE HEADINGS
     C           LINE      IFGT 55
     C*
     C*****MOVE*PRINTER*LOCATION*TO*REPORT*FIELD***********************   S01464
     C***********          MOVE WWPLOC    RRPLOC                          S01464
     C*                                                                   S01464
     C**   Move Branch Code to Report Field                               S01464
     C                     MOVE WWBRCH    RRBRCD                          S01464
     C*
     C**   WRITE MAIN HEADING
     C                     WRITEHEADER1
     C*
     C**  MOVE FILE FIELDS TO REPORT FIELDS FOR ACCOUNT OFFICER HEADING
     C***********          MOVE AZACOC    RRACOC                          S01464
     C                     MOVE BBACOC    RRACOC                          S01464
     C*                                                                   S01464
     C** OPEN ACCOUNT OFFICER DETAILS FILE                                S01464
     C                     OPEN SDACOFL1                                  S01464
     C*                                                                   S01464
     C** ACCESS LF/SDACOFL1 WITH ACCOUNT OFFICER CODE                     S01464
     C           BBACOC    CHAINSDACOFL1             57                   S01464
     C*                                                                   S01464
     C** GET ACCOUNT OFFICER NAME FOR ACCOUNT OFFICER HEADING             S01464
     C           *IN57     IFEQ '1'                                       S01464
     C                     MOVE *BLANKS   RRACON                          S01464
     C                     ELSE                                           S01464
     C                     MOVE AZACON    RRACON
     C                     END                                            S01464
     C*                                                                   S01464
     C                     CLOSESDACOFL1                                  S01464
     C*
     C**   WRITE ACCOUNT OFFICER HEADING
     C                     WRITEHEADER2
     C*
     C**   MOVE FEE GROUP CODE TO REPORT FIELDS
     C                     MOVE BFCFGC    WWCFGC
     C*
     C**   OUTPUT BANK CHARGING CURRENCY TO REPORT
     C                     MOVE WWBCGC    RRBCCY
     C                     MOVE WWBCGC    RRCCCY
     C*
     C*****IF*FEES*PER*CUSTOMER*POSITIONS*=*'P'************************   S01464
     C***********SACFCP    IFEQ 'P'                                       S01464
     C*****************************************************************   S01464
     C*****MOVE*FILE*FIELDS*TO*REPORT*FIELDS*FOR*PORTFOLIO*CUST*HEADING   S01464
     C***********          MOVE BBCUST    RRCNM1                          S01464
     C***********          MOVE BBCRNM    RRSNM1                          S01464
     C*****************************************************************   S01464
     C*****SET*ON*HEADER*3*NECESSARY*INDICATOR*************************   S01464
     C***********          MOVE '1'       *IN31                           S01464
     C*****************************************************************   S01464
     C***********          ELSE                                           S01464
     C**   IF FEES PER CUSTOMER POSITIONS = 'P'                           091522
     C           FBCFCP    IFEQ 'P'                                       091522
     C*                                                                   091522
     C**   MOVE FILE FIELDS TO REPORT FIELDS FOR PORTFOLIO CUST HEADING   091522
     C                     MOVE BBCUST    RRCNM1                          091522
     C                     MOVE BBCRNM    RRSNM1                          091522
     C*                                                                   091522
     C**   SET ON HEADER 3 NECESSARY INDICATOR                            091522
     C                     MOVE '1'       *IN31                           091522
     C*                                                                   091522
     C                     ELSE                                           091522
     C*
     C**   IF FEES PER CUSTOMER POSITIONS = 'C'
     C***********SACFCP    IFEQ 'C'                                       S01464
     C           FBCFCP    IFEQ 'C'                                       S01464
     C*
     C**   MOVE FILE FIELDS TO REPORT FIELDS FOR CUSTOMER HEADING
     C                     MOVE BBCUST    RRCNM2
     C                     MOVE BBCRNM    RRSNM2
     C*
     C**   WRITE NON PORTFOLIO CUSTOMER HEADING
     C**                   MOVE BFCFGC    WWCFGC                          R0131
     C**                   MOVE WWCFGC    RRAFG2                          R0131
     C**                   WRITEDETAIL2                                   R0131
     C*
     C**   WRITE HEADINGS FOR CUSTOMER DETAILS
     C                     WRITEHEADER3
     C*                                                                   R0131
     C**   WRITE NON PORTFOLIO CUSTOMER HEADING                           R0131
     C                     MOVE BFCFGC    WWCFGC                          R0131
     C                     MOVE WWCFGC    RRAFG2                          R0131
     C                     WRITEDETAIL2                                   R0131
     C*
     C                     END
     C***********          END                                            S01464
     C                     END                                            091522
     C*
     C**   SET ON HEADINGS ALREADY WRITTEN INDICATOR
     C                     MOVE '1'       *IN30
     C*
     C                     END
     C*
     C*****IF*FEES*PER*CUSTOMER*POSITIONS*ON*PF/SCICDPPD*=*'P'*********   S01464
     C***********SACFCP    IFEQ 'P'                                       S01464
     C*****************************************************************   S01464
     C*****ACCESS*PF/SDPLCSPD*WITH*CUSTOMER*NUMBER*********************   S01464
     C***********WWCUST    CHAINSDPLCSPD             45                   S01464
     C*****************************************************************   S01464
     C*****IF*LIVE*RECORD*IS*FOUND*************************************   S01464
     C************IN45     IFEQ '0'                                       S01464
     C***********QBRECI    ANDEQ'D'                                       S01464
     C*****************************************************************   S01464
     C*****CALL*SUBROUTINE*TO*DO*PORTFOLIO*POSITION*PROCESSING*********   S01464
     C***********          EXSR #P04                                      S01464
     C*****************************************************************   S01464
     C***********          ELSE                                           S01464
     C*****************************************************************   S01464
     C*****CALL*SUBROUTINE*TO*DO*CUSTOMER*POSITION*PROCESSING**********   S01464
     C***********          EXSR #P03                                      S01464
     C*****************************************************************   S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***********          ELSE                                           S01464
     C**   IF FEES PER CUSTOMER POSITIONS ON PF/SCICDPPD = 'P'            091522
     C           FBCFCP    IFEQ 'P'                                       091522
     C/COPY WNCPYSRC,SE6240C003
     C*                                                                   091522
     C**   ACCESS PF/SDPLCSL0 WITH CUSTOMER NUMBER                        091522
     C           WWCUST    CHAINSDPLCSL0             45                   091522
     C*                                                                   091522
     C**   IF LIVE RECORD IS FOUND                                        091522
     C           *IN45     IFEQ '0'                                       091522
     C           QBRECI    ANDEQ'D'                                       091522
     C*                                                                   091522
     C**   CALL SUBROUTINE TO DO PORTFOLIO POSITION PROCESSING            091522
     C                     EXSR #P04                                      091522
     C*                                                                   091522
     C                     ELSE                                           091522
     C*                                                                   091522
     C**   CALL SUBROUTINE TO DO CUSTOMER POSITION PROCESSING             091522
     C                     EXSR #P03                                      091522
     C*                                                                   091522
     C                     END                                            091522
     C*                                                                   091522
     C                     ELSE                                           091522
     C*
     C**   IF FEES PER CUSTOMER POSITIONS = 'C'
     C***********SACFCP    IFEQ 'C'                                       S01464
     C           FBCFCP    IFEQ 'C'                                       S01464
     C*
     C**   CALL SUBROUTINE TO DO CUSTOMER POSITION PROCESSING
     C                     EXSR #P03
     C*
     C                     END
     C***********          END                                            S01464
     C                     END                                            091522
     C*****************************************************************   S01464
     C*****READ*NEXT*RECORD*FROM*LF/SCCUSTL1***************************   S01464
     C***********          READ SCCUSTL1                 44               S01464
     C*****************************************************************   S01464
     C*****ON*CHANGE*OF*PRINTER*LOCATION*CODE*OR*EOF*******************   S01464
     C***********WWPLOC    IFNE AZPRTL                                    S01464
     C*                                                                   S01464
     C**   Read next record from LF/SECUSTL1                              S01464
     C                     READ SECUSTL1                 44               S01464
     C*                                                                   S01464
     C**   On change of branch code or EOF                                S01464
     C           WWBRCH    IFNE BBBRCD                                    S01464
     C           *IN44     OREQ '1'
     C*
     C**   CALL SUBROUTINE TO OPEN/CLOSE PRINTER FILE
     C                     EXSR #P02
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #P02      BEGSR
     C*
     C***********          MOVE WWCFGC    RRAFG1                          S01464
     C                     MOVE WWCFGC    RRAFG2
     C*
     C**   IF AT END OF PAGE WRITE HEADINGS
     C           LINE      IFGT 55
     C*
     C**   WRITE MAIN HEADING
     C                     WRITEHEADER1
     C*
     C**   WRITE ACCOUNT OFFICER HEADING
     C                     WRITEHEADER2
     C*                                                                   R0131
     C**   WRITE HEADINGS FOR CUSTOMER DETAILS                            R0131
     C                     WRITEHEADER3                                   R0131
     C*
     C*****IF*FEES*PER*CUSTOMER*POSITIONS*=*'P'************************   S01464
     C***********SACFCP    IFEQ 'P'                                       S01464
     C*****************************************************************   S01464
     C*****WRITE*PORTFOLIO*CUSTOMER*HEADING****************************   S01464
     C***********          WRITEDETAIL1                                   S01464
     C*****************************************************************   S01464
     C***********          ELSE                                           S01464
     C**   IF FEES PER CUSTOMER POSITIONS = 'P'                           091522
     C           FBCFCP    IFEQ 'P'                                       091522
     C*                                                                   091522
     C**   WRITE PORTFOLIO CUSTOMER HEADING                               091522
     C                     WRITEDETAIL1                                   091522
     C*                                                                   091522
     C                     ELSE                                           091522
     C*
     C**   IF FEES PER CUSTOMER POSITIONS = 'C'
     C***********SACFCP    IFEQ 'C'                                       S01464
     C           FBCFCP    IFEQ 'C'                                       S01464
     C*
     C**   WRITE NON PORTFOLIO CUSTOMER HEADING
     C                     WRITEDETAIL2
     C                     END
     C***********          END                                            S01464
     C                     END                                            091522
     C*
     C**   WRITE HEADINGS FOR CUSTOMER DETAILS
     C**                   WRITEHEADER3                                   R0131
     C                     END
     C                     WRITEFOOTING1
     C                     CLOSESE6240P1
     C                     MOVE 'N'       WWOPEN                          S01464
     C*
     C*****IF*NOT*AT*END*OF*FILE*OVERRIDE*TO*NEW*PRINTER*LOCATION******   S01464
     C************IN44     IFEQ '0'                                       S01464
     C***********          MOVELAZPRTL    WWPRTL                          S01464
     C***********          MOVE WWPRTL    WWCMDP                          S01464
     C***********          CALL 'QCMDEXC'                                 S01464
     C***********          PARM WWCMDP    QCAA   43                       S01464
     C***********          PARM 43        QCAN   155                      S01464
     C           *IN44     IFEQ '0'                                       S01464
     C                     OPEN SE6240P1
     C                     Z-ADD*ZERO     PAGE
     C                     MOVE 'Y'       WWOPEN                          S01464
     C***********          MOVE AZPRTL    WWPLOC                          S01464
     C                     MOVE *BLANKS   WWBLHD                          S01464
     C                     MOVE BBBRCD    WWBRCH                          S01464
     C*                                                                   S01464
     C** Call ZSFILE for P1 file                                          S01464
     C*                                                                   S01464
     C                     Z-ADDSFNUM     ZSNUM   60                      S01464
     C                     CALL 'ZSFILE'                                  S01464
     C                     PARM           SEQ     5                       S01464
     C                     PARM BBBRCD    @PARM   3                       S01464
     C                     PARM           SFILE                           S01464
     C                     PARM           ZSNUM                           S01464
     C                     PARM           ZSERR   1                       S01464
     C*                                                                   S01464
     C           ZSERR     IFEQ 'Y'                                       S01464
     C                     MOVE '1'       *INU7                           S01464
     C                     MOVE '1'       *INU8                           S01464
     C                     MOVE '1'       *INLR                           S01464
     C                     RETRN                                          S01464
     C                     END                                            S01464
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C/COPY WNCPYSRC,SE6240C004
     C           #P03      BEGSR
     C*
     C** MOVE FEE GROUP CODE TO REPORT FIELDS AND TO A WORK FIELD
     C***********          MOVE WWCFGC    RRAFG1                          S01464
     C                     MOVE WWCFGC    RRAFG2
     C*
     C** IF HEADINGS NOT ALREADY WRITTEN ON NEW PAGE
     C           *IN30     IFEQ '0'
     C*
     C** IF CHANGE OF ACCOUNT OFFICER
     C***********AZACOC    IFNE WWACOC                                    S01464
     C           BBACOC    IFNE WWACOC                                    S01464
     C           BBACOC    OREQ *BLANKS                                   S01464
     C           RRBRCD    ORNE WWBRCH                                    157193
     C           WWBLHD    ANDEQ*BLANKS                                   S01464
     C                     MOVE 'Y'       WWBLHD                          S01464
     C*
     C***MOVE*PRINTER*LOCATION*INTO*REPORT*FIELD***********************   S01464
     C***********          MOVE WWPLOC    RRPLOC                          S01464
     C*                                                                   S01464
     C** Move branch code into report field                               S01464
     C                     MOVE WWBRCH    RRBRCD                          S01464
     C*
     C** WRITE MAIN HEADING
     C                     WRITEHEADER1
     C*
     C** MOVE FILE FIELDS TO REPORT FIELDS FOR ACCOUNT OFFICER HEADING
     C***********          MOVE AZACOC    RRACOC
     C                     MOVE BBACOC    RRACOC                          S01464
     C*                                                                   S01464
     C** OPEN ACCOUNT OFFICER DETAILS FILE                                S01464
     C                     OPEN SDACOFL1                                  S01464
     C*                                                                   S01464
     C** ACCESS LF/SDACOFL1 WITH ACCOUNT OFFICER CODE                     S01464
     C           BBACOC    CHAINSDACOFL1             57                   S01464
     C*                                                                   S01464
     C** GET ACCOUNT OFFICER NAME FOR ACCOUNT OFFICER HEADING             S01464
     C           *IN57     IFEQ '1'                                       S01464
     C                     MOVE *BLANKS   RRACON                          S01464
     C                     ELSE                                           S01464
     C                     MOVE AZACON    RRACON
     C                     END                                            S01464
     C*                                                                   S01464
     C                     CLOSESDACOFL1                                  S01464
     C*
     C** WRITE ACCOUNT OFFICER HEADING
     C                     WRITEHEADER2
      *                                                                   R0131
     C** IF CHANGE OF ACCOUNT OFFICER                                     R0131
     C***********AZACOC    IFNE WWACOC                              R0131 S01464
     C*                                                                   R0131
     C** OUTPUT BANK CHARGING CURRENCY TO REPORT                          R0131
     C                     MOVE WWBCGC    RRBCCY                          R0131
     C                     MOVE WWBCGC    RRCCCY                          R0131
     C*                                                                   R0131
     C** WRITE HEADINGS FOR CUSTOMER DETAILS                              R0131
     C                     WRITEHEADER3                                   R0131
     C*                                                                   R0131
     C** MOVE NEW ACCOUNT OFFICER CODE INTO WORK FIELD                    R0131
     C***********          MOVE AZACOC    WWACOC                    R0131 S01464
     C                     MOVE BBACOC    WWACOC                          S01464
     C*                                                                   R0131
     C***********          END                                      R0131 S01464
     C*
     C                     END
     C*
     C***IF*FEES*PER*CUSTOMER*POSITIONS*=*'P'**************************   S01464
     C***********SACFCP    IFEQ 'P'                                       S01464
     C*****************************************************************   S01464
     C***MOVE*FILE*FIELDS*TO*REPORT*FIELDS*FOR*PORTFOLIO*CUST*HEADING**   S01464
     C***********          MOVE BBCUST    RRCNM1                          S01464
     C***********          MOVE BBCRNM    RRSNM1                          S01464
     C***********          MOVE P9R999    RRPNM1                          S01464
     C***********          MOVE P9N999    RRPSN1                          S01464
     C*****************************************************************   S01464
     C***SET*PORTFOLIO*REFERENCE***************************************   S01464
     C***********          MOVE '9999'    WWPTFR                          S01464
     C*****************************************************************   S01464
     C***WRITE*PORTFOLIO*CUSTOMER*HEADING******************************   S01464
     C***********          WRITEDETAIL1                                   S01464
     C*****************************************************************   S01464
     C***********          ELSE                                           S01464
     C** IF FEES PER CUSTOMER POSITIONS = 'P'                             091522
     C           FBCFCP    IFEQ 'P'                                       091522
     C*                                                                   091522
     C** MOVE FILE FIELDS TO REPORT FIELDS FOR PORTFOLIO CUST HEADING     091522
     C                     MOVE BBCUST    RRCNM1                          091522
     C                     MOVE BBCRNM    RRSNM1                          091522
     C                     MOVE FCR999    RRPNM1                          091522
     C                     MOVE FCN999    RRPSN1                          091522
     C*                                                                   091522
     C** SET PORTFOLIO REFERENCE                                          091522
     C                     MOVE '9999'    WWPTFR                          091522
     C*                                                                   091522
     C** WRITE PORTFOLIO CUSTOMER HEADING                                 091522
     C                     WRITEDETAIL1                                   091522
     C*                                                                   091522
     C                     ELSE                                           091522
     C*
     C** IF FEES PER CUSTOMER POSITIONS = 'C'
     C***********SACFCP    IFEQ 'C'                                       S01464
     C           FBCFCP    IFEQ 'C'                                       S01464
     C*
     C** MOVE FILE FIELDS TO REPORT FIELDS FOR CUSTOMER HEADING
     C                     MOVE BBCUST    RRCNM2
     C                     MOVE BBCRNM    RRSNM2
     C*
     C** SET PORTFOLIO REFERENCE BLANK
     C                     MOVE *BLANKS   WWPTFR
     C*
     C** WRITE NON PORTFOLIO CUSTOMER HEADING
     C                     WRITEDETAIL2
     C*                                                                   083825
     C** Print header and sub-header if detail line will                  083825
     C**    be greater than the overflow                                  083825
     C*                                                                   083825
     C           LINE      IFGT 52                                        083825
     C                     WRITEHEADER1                                   083825
     C                     WRITEHEADER2                                   083825
     C                     WRITEHEADER3                                   083825
     C                     END                                            083825
     C*                                                                   083825
     C*
     C                     END
     C***********          END                                            S01464
     C                     END                                            091522
     C*
     C** IF CHANGE OF ACCOUNT OFFICER
     C**         AZACOC    IFNE WWACOC                                    R0131
     C*
     C** OUTPUT BANK CHARGING CURRENCY TO REPORT
     C**                   MOVE WWBCGC    RRBCCY                          R0131
     C**                   MOVE WWBCGC    RRCCCY                          R0131
     C*
     C** WRITE HEADINGS FOR CUSTOMER DETAILS
     C**                   WRITEHEADER3                                   R0131
     C*
     C** MOVE NEW ACCOUNT OFFICER CODE INTO WORK FIELD
     C**                   MOVE AZACOC    WWACOC                          R0131
     C*
     C**                   END                                            R0131
     C*
     C                     ELSE
     C*
     C** RESET HEADINGS ALREADY WRITTEN INDICATOR
     C                     MOVE '0'       *IN30
     C*
     C** DECIDE PORTFOLIO REFERENCE TO BE USED
     C***********SACFCP    IFEQ 'P'                                       S01464
     C***********          MOVE '9999'    WWPTFR                          S01464
     C***********          ELSE                                           S01464
     C           FBCFCP    IFEQ 'P'                                       091522
     C                     MOVE '9999'    WWPTFR                          091522
     C                     ELSE                                           091522
     C***********SACFCP    IFEQ 'C'                                       S01464
     C           FBCFCP    IFEQ 'C'                                       S01464
     C                     MOVE *BLANKS   WWPTFR
     C                     END
     C***********          END                                            S01464
     C                     END                                            091522
     C*****************************************************************   S01464
     C***IF*HEADER*3*INDICATOR*IS*ON*MOVE*PORTFOLIO*VALUES*INTO*REPORT*   S01464
     C****FIELDS,*FINISH*PRINTING*HEADINGS*AND*RESET*INDICATOR*********   S01464
     C************IN31     IFEQ '1'                                       S01464
     C***********          MOVE P9R999    RRPNM1                          S01464
     C***********          MOVE P9N999    RRPSN1                          S01464
     C**                   WRITEDETAIL1                             R0131 S01464
     C***********          WRITEHEADER3                                   S01464
     C***********          WRITEDETAIL1                             R0131 S01464
     C***********          MOVE '0'       *IN31                           S01464
     C***********          END                                            S01464
     C** IF HEADER 3 INDICATOR IS ON MOVE PORTFOLIO VALUES INTO REPORT    091522
     C**  FIELDS, FINISH PRINTING HEADINGS AND RESET INDICATOR            091522
     C           *IN31     IFEQ '1'                                       091522
     C                     MOVE FCR999    RRPNM1                          091522
     C                     MOVE FCN999    RRPSN1                          091522
     C                     WRITEHEADER3                                   091522
     C                     WRITEDETAIL1                                   091522
     C                     MOVE '0'       *IN31                           091522
     C                     END                                            091522
     C                     END
     C*
     C** INITIALISE A WORK FIELD TO HOLD 'FEES ACCRUED TODAY'
     C                     Z-ADD*ZEROS    WWFACT 130
     C*
     C***ACCESS*PF/SCSCFAPD*WITH*CUSTOMER*NUMBER*AND*PORTFOLIO*REF.****   S01464
     C***********WWKEY1    CHAINSCSCFAPD             46                   S01464
     C*                                                                   S01464
     C** Access PF/SESCFAPD with branch code, customer number and         S01464
     C** portfolio reference.                                             S01464
     C           WWKEY1    CHAINSESCFAPD             46                   S01464
     C*
     C** IF NO RECORD FOUND
     C           *IN46     IFEQ '1'
     C*
     C** SET UP WORK FIELDS FOR 'FEE ACCRUED TO DATE', 'OUTSTANDING
     C**  ACCRUAL ADJUSTMENT' AND 'OUTSTANDING ACCRUAL ADJUSTMENT SIGN'
     C                     Z-ADD*ZEROS    WWCFAC
     C                     Z-ADD*ZEROS    WWOSAJ
     C                     MOVE *BLANKS   WWOSAS
     C                     ELSE
     C*
     C** SET UP WORK FIELDS WITH VALUES FROM FILE
     C                     Z-ADDSDCFAC    WWCFAC
     C                     Z-ADDSDOSAJ    WWOSAJ
     C                     MOVE SDOSAS    WWOSAS
     C                     END
     C*
     C** OUTPUT 'FEES ACCRUED TO TODAY' REPORT LINE
     C                     Z-ADDWWCFAC    ZFLD15
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C                     Z-ADDZCDPT     ZDECS                           S01464
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRFATT
     C*                                                                   083825
     C**  Check for overflow and write the appropiate header              083825
     C*                                                                   083825
     C           LINE      IFGT 55                                        083825
     C                     EXSR #WRTHD                                    083825
     C                     END                                            083825
     C*                                                                   083825
     C                     WRITEDETAIL3
     C*
     C** IF 'OUTSTANDING ACCRUAL ADJUSTMENTS' > 0 WRITE REPORT LINE
     C           WWOSAJ    IFGT *ZEROS
     C                     Z-ADDWWOSAJ    ZFLD15
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C                     Z-ADDZCDPT     ZDECS                           S01464
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RROUTA
     C*
     C** OUTPUT 'OUTSTANDING ADJUSTMENT SIGN' TO REPORT
     C                     MOVE WWOSAS    RROTAS
     C*                                                                   083825
     C**  Check for overflow and write the appropiate header              083825
     C*                                                                   083825
     C           LINE      IFGT 55                                        083825
     C                     EXSR #WRTHD                                    083825
     C                     END                                            083825
     C*                                                                   083825
     C                     WRITEDETAIL4
     C*
     C** UPDATE 'FEES ACCRUED TO DATE' AND GENERATE ACCRUAL ADJUSTMENT
     C**  POSTINGS
     C                     EXSR #P05
     C                     END
     C*
     C***ACCESS*LF/SCSEPSLL*WITH*A*NUMERIC*CUSTOMER*NUMBER*************   S01464
     C***********WWCNUM    SETLLSCSEPSLL                                  S01464
     C***********          READ SCSEPSLL                 47               S01464
     C/COPY WNCPYSRC,SE6240C027
     C*                                                                   S01464
     C** Access LF/SESEPSLL with a numeric customer number                S01464
     C           WWCNUM    SETLLSESEPSLL                                  S01464
     C                     READ SESEPSLL                 47               S01464
     C*
     C***DO*WHILE*RECORDS*ON*LF/SCSEPSLL*FOR*CUSTOMER******************   S01464
     C** Do while records on LF/SESEPSLL for customer                     S01464
     C           *IN47     DOWEQ'0'
     C           WWCNUM    ANDEQCSCN
     C*                                                                   S01464
     C** Move 'Branch Reference' into a work field                        S01464
     C                     MOVE CSBA      WWBRCA                          S01464
     C*
     C** MOVE 'SECURITY REFERENCE' INTO A WORK FIELD
     C                     MOVE CSSC      WWCSSC
     C*
     C** SET WORK FIELD FOR 'TOTAL VALUE DATE NOMINAL' TO ZERO
     C                     Z-ADD*ZEROS    WWTVDN 150
     C*
     C***DO*WHILE*RECORDS*ON*LF/SCSEPSLL*FOR*SAVED*SECURITY*REFERENCE**   S01464
     C** Do while records on LF/SESEPSLL for saved security and branch    S01464
     C** reference.                                                       S01464
     C           CSSC      DOWEQWWCSSC
     C           *IN47     ANDEQ'0'
     C           CSBA      ANDEQWWBRCA                                    S01464
     C           CSCN      ANDEQWWCNUM                                    S01464
     C*
     C** ADD 'VALUE DATE NOMINAL' INTO TOTAL WORK FIELD
     C/COPY WNCPYSRC,SE6240C005
     C                     ADD  CSNV      WWTVDN
     C/COPY WNCPYSRC,SE6240C028
     C*
     C***READ*NEXT*RECORD*ON*LF/SCSEPSLL*WITH*CUSTOMER*NUMBER**********   S01464
     C***********          READ SCSEPSLL                 47               S01464
     C*                                                                   S01464
     C** Read next record on LF/SESEPSLL with customer number             S01464
     C                     READ SESEPSLL                 47               S01464
     C*
     C                     END
     C*
     C** CALCULATE FEE TO BE ACCRUED FOR THIS SECURITY
     C                     EXSR #P06
     C*
     C** IF CHARGE CODE NOT BLANK
     C           WWCGCO    IFNE *BLANKS
     C*
     C** SET UP REPORT FIELDS FOR SECURITY DETAIL LINE
     C** SECURITY REFERENCE
     C                     MOVE WWCSSC    RRSCTY
     C*                                                                   S01464
     C** Branch Reference                                                 S01464
     C                     MOVE WWBRCA    RRBRCA                          S01464
     C*
     C** INVESTMENT TYPE
     C                     MOVE SITP      RRIVTS
     C*
     C** NOMINAL CURRENCY
     C                     MOVE NMCY      RRNMCS
     C*
     C** NOMINAL POSITION
     C                     Z-ADDWWTVDN    ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRNPSS
     C*
     C** MARKET VALUE IN NOMINAL CURRENCY
     C                     Z-ADDWWMVNC    ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRMNCS
     C*
     C** MARKET VALUE IN BANK CHARGING CURRENCY
     C                     Z-ADDWWMVBC    ZFLD15
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C                     Z-ADDZCDPT     ZDECS                           S01464
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRMCCS
     C*
     C** FEE CODE
     C                     MOVE WWCGCO    RRFECS
     C*
     C** AMOUNT ACCRUED TODAY
     C                     Z-ADDWWAAFS    ZFLD15
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C                     Z-ADDZCDPT     ZDECS                           S01464
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C/COPY WNCPYSRC,SE6240C006
     C                     MOVE ZOUT21    RRAATS
     C/COPY WNCPYSRC,SE6240C007
     C*
     C** WRITE DETAIL LINE TO REPORT
     C           CSNV      IFNE 0                                         B05945
     C*                                                                   083825
     C**  Check for overflow and write the appropiate header              083825
     C*                                                                   083825
     C           LINE      IFGT 55                                        083825
     C                     EXSR #WRTHD                                    083825
     C                     END                                            083825
     C*                                                                   083825
     C                     WRITEDETAIL6
     C                     END                                            B05945
     C*
     C** ADD FEE ACCRUED IN #P06 TO 'FEES ACCRUED TO DATE' AND TO
     C**  'FEES ACCRUED TODAY'
     C                     ADD  WWAAFS    WWCFAC
     C                     ADD  WWAAFS    WWFACT
     C/COPY WNCPYSRC,SE6240C029
     C*
     C                     END
     C                     END
     C*
     C***ACCESS*PF/SCPMABPD*WITH*CUST*NUMBER*AND*PORTFOLIO*REFERENCE***   S01464
     C*                                                                   S01464
     C** Access PF/SEPMABPD with CUST Number and Portfolio Reference      S01464
     C*                                                                   S01464
     C                     MOVE *BLANKS   WWPTFR
     C                     MOVE *BLANKS   WWCCYP  3
     C***********WWKEY3    SETLLSCPMABPD                                  S01464
     C***********          READ SCPMABPD                 53               S01464
     C           WWKEY3    SETLLSEPMABPD                                  S01464
     C                     READ SEPMABPD                 53               S01464
     C*
     C** SET UP PORTFOLIO REFERENCE TO BE OUTPUT TO SCSCFAPD
     C           FBCFCP    IFNE 'C'                                       S01464
     C           WWPTFR    IFEQ *BLANKS
     C                     MOVE '9999'    WWPTFR
     C                     ELSE
     C                     MOVE SGPTFR    WWPTFR
     C                     END
     C                     END                                            S01464
     C*
     C** WHILE RECORDS EXIST FOR THIS CUSTOMER
     C           *IN53     DOWEQ'0'
     C           WWCNUM    ANDEQSGCNUM
     C*
     C** CALCULATE FEE TO BE ACCRUED FOR THIS ACCOUNT
     C                     EXSR #P07
     C*
     C** IF CHARGE CODE NOT BLANK
     C           WWCGCO    IFNE *BLANKS
     C*
     C** SET UP REPORT FIELDS FOR ACCOUNT DETAIL LINE
     C*                                                                   S01464
     C** If in a multi-branch environment, output branch to report.       S01464
     C           *IN10     IFEQ '1'                                       S01464
     C                     MOVE SGBRCA    RRBRCA                          S01464
     C                     END                                            S01464
     C*                                                                   S01464
     C** ACCOUNT CODE
     C                     MOVE WWACNT    RRACNT
     C*
     C** INVESTMENT TYPE
     C                     MOVE *BLANKS   RRIVTA
     C*
     C** NOMINAL CURRENCY
     C                     MOVE SGCCY     RRNMCA
     C*
     C** NOMINAL POSITION
     C           SGCLBL    IFLT 0
     C                     Z-SUBSGCLBL    ZFLD15
     C                     ELSE
     C                     Z-ADDSGCLBL    ZFLD15
     C                     END
     C*
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRNPSA
     C*
     C** SET UP CREDIT DEBIT INDICATOR
     C           SGCLBL    IFLT 0
     C                     MOVE 'CR'      RRDRCR
     C                     ELSE
     C                     MOVE 'DR'      RRDRCR
     C                     END
     C*
     C** MARKET VALUE IN NOMINAL CURRENCY
     C                     Z-ADDWWMVNC    ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRMNCA
     C*
     C** MARKET VALUE IN BANK CHARGING CURRENCY
     C                     Z-ADDWWMVBC    ZFLD15
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C                     Z-ADDZCDPT     ZDECS                           S01464
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRMCCA
     C*
     C** FEE CODE
     C                     MOVE WWCGCO    RRFECA
     C*
     C** AMOUNT ACCRUED TODAY
     C                     Z-ADDWWAAFA    ZFLD15
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C                     Z-ADDZCDPT     ZDECS                           S01464
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C/COPY WNCPYSRC,SE6240C008
     C                     MOVE ZOUT21    RRAATA
     C/COPY WNCPYSRC,SE6240C009
     C*
     C** WRITE DETAIL LINE TO REPORT
     C           SGCLBL    IFNE 0                                         B05945
     C*                                                                   083825
     C**  Check for overflow and write the appropiate header              083825
     C*                                                                   083825
     C           LINE      IFGT 55                                        083825
     C                     EXSR #WRTHD                                    083825
     C                     END                                            083825
     C*                                                                   083825
     C                     WRITEDETAIL7
     C                     END                                            B05945
     C*
     C** ADD FEE ACCRUED IN #P07 TO 'FEES ACCRUED TO DATE' AND TO
     C**  'FEES ACCRUED TODAY'
     C                     ADD  WWAAFA    WWCFAC
     C                     ADD  WWAAFA    WWFACT
     C*
     C                     END
     C*
     C***READ*NEXT*RECORD*ON*PF/SCPMABPD*******************************   S01464
     C***********          READ SCPMABPD                 53               S01464
     C*                                                                   S01464
     C** Read next record ON PF/SEPMABPD                                  S01464
     C                     READ SEPMABPD                 53               S01464
     C*
     C                     END
     C/COPY WNCPYSRC,SE6240C010
     C*
     C***ACCESS*PF/SCSCFAPD*WITH*CUSTOMER*AND*PORTFOLIO*REFERENCE*TO***   S01464
     C****SEE*IF*RECORD*EXISTS*****************************************   S01464
     C***********WWKEY1    CHAINSCSCFAPD             46                   S01464
     C*                                                                   S01464
     C** Access PF/SCSCFAPD with Customer and Portfolio Reference to      S01464
     C**  see if record exists                                            S01464
     C*                                                                   S01464
     C           WWKEY1    CHAINSESCFAPD             46                   S01464
     C*****************************************************************   S01464
     C***IF*RECORD*EXISTS*UPDATE*RECORD*ON*PF/SCSCFAPD*****************   S01464
     C** IF RECORD EXISTS UPDATE RECORD ON PF/SESCFAPD                    S01464
     C           *IN46     IFEQ '0'
     C*
     C** TYPE OF LAST CHANGE
     C                     MOVE 'A'       SDCHTP
     C*
     C** CUSTODY FEE ACCRUED TO DATE
     C                     Z-ADDWWCFAC    SDCFAC
     C*
     C** OUTSTANDING ACCRUAL ADJUSTMENT
     C                     Z-ADD*ZEROS    SDOSAJ
     C*
     C** OUTSTANDING ACCRUAL ADJUSTMENT SIGN
     C                     MOVE *BLANKS   SDOSAS
     C*
     C***UPDATE*PF/SCSCFAPD********************************************   S01464
     C***********          UPDATSCSCFAP0                                  S01464
     C*                                                                   S01464
     C** Update PF/SESCFAPD                                               S01464
     C                     UPDATSESCFAP0                                  S01464
     C*
     C                     ELSE
     C*
     C***IF*RECORD*DOES*NOT*EXIST*WRITE*RECORD*TO*PF/SCSCFAPD**********   S01464
     C** If record does not exist write record to PF/SESCFAPD             S01464
     C*
     C** RECORD ID
     C                     MOVE 'D'       SDRECI
     C*
     C** DAY OF LAST UPDATE
     C                     Z-ADDWWDAYU    SDDLUP
     C*
     C** MONTH OF LAST UPDATE
     C                     MOVE WWMTHU    SDMLUP
     C*
     C** YEAR OF LAST UPDATE
     C                     Z-ADDWWYERU    SDYLUP
     C*
     C** TIME OF LAST UPDATE
     C                     TIME           SDTLUP
     C*
     C** TYPE OF LAST CHANGE
     C                     MOVE 'I'       SDCHTP
     C*
     C** LAST CHANGE DATE
     C                     Z-ADDBJRDNB    SDLCD
     C*
     C** TRANSACTION NUMBER OF LAST UPDATE
     C********             Z-ADD*ZEROS    SDTNLU
     C*
     C** RETRIEVE NEXT TRANSACTION NUMBER
     C*
     C                     EXSR ZTNLU1
     C                     MOVELNATN      SDTNLU
     C*
     C** CUSTOMER NUMBER
     C**********           Z-ADDWWCNUM    SDCNUM                                              CSD027
     C                     MOVE WWCNUM    SDCNUM                                              CSD027
     C*
     C** PORTFOLIO REFERENCE
     C                     MOVE WWPTFR    SDPTFR
     C*
     C** CUSTODY FEE ACCRUED TO DATE
     C                     Z-ADDWWCFAC    SDCFAC
     C*
     C** OUTSTANDING ACCRUAL ADJUSTMENT
     C                     Z-ADD*ZEROS    SDOSAJ
     C*
     C** OUTSTANDING ACCRUAL ADJUSTMENT SIGN
     C                     MOVE *BLANKS   SDOSAS
     C*
     C** Branch Code                                                      S01464
     C                     MOVE WWBRCH    SDBRCA                          S01464
     C*                                                                   S01464
     C***WRITE*RECORD*TO*PF/SCSCFAPD***********************************   S01464
     C***********          WRITESCSCFAP0                                  S01464
     C*                                                                   S01464
     C** Write record to PF/SESCFAPD                                      S01464
     C                     WRITESESCFAP0                                  S01464
     C*
     C                     END
     C/COPY WNCPYSRC,SE6240C030
     C*
     C** IF 'FEE ACCRUED TODAY' NOT ZERO CALL #P10
     C           WWFACT    IFNE *ZEROS
     C                     EXSR #P10
     C                     END
     C/COPY WNCPYSRC,SE6240C011
     C*
     C** OUTPUT 'FEES ACCRUED TO DATE' REPORT LINE
     C                     Z-ADDWWCFAC    ZFLD15
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C                     Z-ADDZCDPT     ZDECS                           S01464
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRFATD
     C*                                                                   083825
     C**  Check for overflow and write the appropiate header              083825
     C*                                                                   083825
     C           LINE      IFGT 55                                        083825
     C                     EXSR #WRTHD                                    083825
     C                     END                                            083825
     C*                                                                   083825
     C                     WRITEDETAIL5
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C***********#P04      BEGSR                                          S01464
     C*****************************************************************   S01464
     C***IF*HEADINGS*NOT*ALREADY*WRITTEN*ON*NEW*PAGE*******************   S01464
     C************IN30     IFEQ '0'                                       S01464
     C*****************************************************************   S01464
     C***IF*CHANGE*OF*ACCOUNT*OFFICER**********************************   S01464
     C***********AZACOC    IFNE WWACOC                                    S01464
     C*****************************************************************   S01464
     C***MOVE*PRINTER*LOCATION*INTO*REPORT*FIELD***********************   S01464
     C***********          MOVE WWPLOC    RRPLOC                          S01464
     C*****************************************************************   S01464
     C***WRITE*MAIN*HEADING********************************************   S01464
     C***********          WRITEHEADER1                                   S01464
     C*****************************************************************   S01464
     C***MOVE*FILE*FIELDS*TO*REPORT*FIELDS*FOR*ACCOUNT*OFFICER*HEADING*   S01464
     C***********          MOVE AZACOC    RRACOC                          S01464
     C***********          MOVE AZACON    RRACON                          S01464
     C*****************************************************************   S01464
     C***WRITE*ACCOUNT*OFFICER*HEADING*********************************   S01464
     C***********          WRITEHEADER2                                   S01464
     C*****************************************************************   S01464
     C***********          END                                            S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***ACCESS*PF/PMPORTPP*WITH*NUMERIC*CUSTOMER*NUMBER***************   S01464
     C*******    WWCNUM    CHAINPMPORTPP             54
     C***********          MOVE *LOVAL    WWPREF                          S01464
     C***********PMPORK    SETLLPMPORTLL                                  S01464
     C***********          READ PMPORTLL                 54               S01464
     C*****************************************************************   S01464
     C***WHILE*RECORDS*FOR*THIS*CUSTOMER*******************************   S01464
     C************IN54     DOWEQ'0'                                       S01464
     C***********PNCNUM    ANDEQWWCNUM                                    S01464
     C*****************************************************************   S01464
     C***SET*'FEES*ACCRUED*TODAY'*TO*ZERO******************************   S01464
     C***********          Z-ADD*ZEROS    WWFACT                          S01464
     C*****************************************************************   S01464
     C***SET*PORTFOLIIO*REFERENCE**************************************   S01464
     C***********          MOVE PNPTFR    WWPTFR                          S01464
     C*****************************************************************   S01464
     C***CALL*SUBROUTINE*TO*CALCULATE*ACCRUALS*FOR*PORTFOLIO***********   S01464
     C***********          EXSR #P11                                      S01464
     C*****************************************************************   S01464
     C***READ*NEXT*RECORD*FOR*THIS*CUSTOMER*FROM*LF/PMPORTLL***********   S01464
     C***********          READ PMPORTLL                 54               S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***SET*'FEES*ACCRUED*TODAY'*TO*ZERO******************************   S01464
     C***********          Z-ADD*ZEROS    WWFACT                          S01464
     C*****************************************************************   S01464
     C***SET*PORTFOLIIO*REFERENCE**************************************   S01464
     C***********          MOVE '9997'    WWPTFR                          S01464
     C*****************************************************************   S01464
     C***CALL*SUBROUTINE*TO*CALCULATE*ACCRUALS*FOR*PORTFOLIO***********   S01464
     C***********          EXSR #P11                                      S01464
     C*****************************************************************   S01464
     C***********          ENDSR                                          S01464
     C*                                                                   091522
     C           #P04      BEGSR                                          091522
     C*                                                                   091522
     C** IF HEADINGS NOT ALREADY WRITTEN ON NEW PAGE                      091522
     C           *IN30     IFEQ '0'                                       091522
     C*                                                                   091522
     C** IF CHANGE OF ACCOUNT OFFICER                                     091522
     C           BBACOC    IFNE WWACOC                                    091522
     C           BBACOC    OREQ *BLANKS                                   091522
     C           RRBRCD    ORNE WWBRCH                                    157193
     C           WWBLHD    ANDEQ*BLANKS                                   091522
     C                     MOVE 'Y'       WWBLHD                          091522
     C*                                                                   091522
     C** Move branch code into report field                               091522
     C                     MOVE WWBRCH    RRBRCD                          091522
     C*                                                                   091522
     C** WRITE MAIN HEADING                                               091522
     C                     WRITEHEADER1                                   091522
     C*                                                                   091522
     C** MOVE FILE FIELDS TO REPORT FIELDS FOR ACCOUNT OFFICER HEADING    091522
     C                     MOVE BBACOC    RRACOC                          091522
     C*                                                                   091522
     C** OPEN ACCOUNT OFFICER DETAILS FILE                                091522
     C                     OPEN SDACOFL1                                  091522
     C*                                                                   091522
     C** ACCESS LF/SDACOFL1 WITH ACCOUNT OFFICER CODE                     091522
     C           BBACOC    CHAINSDACOFL1             57                   091522
     C*                                                                   091522
     C** GET ACCOUNT OFFICER NAME FOR ACCOUNT OFFICER HEADING             091522
     C           *IN57     IFEQ '1'                                       091522
     C                     MOVE *BLANKS   RRACON                          091522
     C                     ELSE                                           091522
     C                     MOVE AZACON    RRACON                          091522
     C                     END                                            091522
     C*                                                                   091522
     C                     CLOSESDACOFL1                                  091522
     C*                                                                   091522
     C** WRITE ACCOUNT OFFICER HEADING                                    091522
     C                     WRITEHEADER2                                   091522
     C**                                                                  091522
     C                     END                                            091522
     C                     END                                            091522
     C*                                                                   091522
     C** ACCESS PF/PMPORTPP WITH NUMERIC CUSTOMER NUMBER                  091522
     C                     MOVE *LOVAL    WWPREF                          091522
     C           PMPORK    SETLLPMPORTLL                                  091522
     C                     READ PMPORTLL                 54               091522
     C*                                                                   091522
     C** WHILE RECORDS FOR THIS CUSTOMER                                  091522
     C           *IN54     DOWEQ'0'                                       091522
     C           PNCNUM    ANDEQWWCNUM                                    091522
     C*                                                                   091522
     C** SET 'FEES ACCRUED TODAY' TO ZERO                                 091522
     C                     Z-ADD*ZEROS    WWFACT                          091522
     C/COPY WNCPYSRC,SE6240C012
     C*                                                                   091522
     C** SET PORTFOLIO REFERENCE                                          091522
     C                     MOVE PNPTFR    WWPTFR                          091522
     C*                                                                   091522
     C** CALL SUBROUTINE TO CALCULATE ACCRUALS FOR PORTFOLIO              091522
     C                     EXSR #P11                                      091522
     C*                                                                   091522
     C** READ NEXT RECORD FOR THIS CUSTOMER FROM LF/PMPORTLL              091522
     C                     READ PMPORTLL                 54               091522
     C                     END                                            091522
     C*                                                                   091522
     C** SET 'FEES ACCRUED TODAY' TO ZERO                                 091522
     C                     Z-ADD*ZEROS    WWFACT                          091522
     C/COPY WNCPYSRC,SE6240C026
     C*                                                                   091522
     C** SET PORTFOLIO REFERENCE                                          091522
     C                     MOVE '9997'    WWPTFR                          091522
     C*                                                                   091522
     C** CALL SUBROUTINE TO CALCULATE ACCRUALS FOR PORTFOLIO              091522
     C                     EXSR #P11                                      091522
     C*                                                                   091522
     C                     ENDSR                                          091522
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #P05      BEGSR
     C*
     C** IF CHARGE ADJUSTMENT SIGN ON PF/SCSCFAPD IS '+'
     C           WWOSAS    IFEQ '+'
     C*
     C** GENERATE ACCRUAL ENTRIES WITH 'FEES ACCRUED TODAY' EQUAL TO
     C**  'OUTSTANDING ADJUSTMENT AMOUNT' ON PF/SCSCFAPD
     C                     Z-ADDWWOSAJ    WWFACT
     C                     EXSR #P10
     C                     ADD  WWOSAJ    WWCFAC
     C*
     C                     ELSE
     C*
     C** IF CHARGE ADJUSTMENT SIGN ON PF/SCSCFAPD IS '-'
     C           WWOSAS    IFEQ '-'
     C*
     C** GENERATE ACCRUAL ENTRIES WITH 'FEES ACCRUED TODAY' EQUAL TO
     C**  '-OUTSTANDING ADJUSTMENT AMOUNT' ON PF/SCSCFAPD
     C                     Z-SUBWWOSAJ    WWFACT
     C                     EXSR #P10
     C                     SUB  WWOSAJ    WWCFAC
     C*
     C                     END
     C                     END
     C*
     C** ZEROISE THE CHARGE ADJUSTMENT AMOUNT AND BLANK OUT THE
     C**  CHARGE ADJUSTMENT SIGN
     C                     Z-ADD*ZEROS    WWOSAJ
     C                     MOVE *BLANKS   WWOSAS
     C*
     C** SET 'FEES ACCRUED TODAY' TO ZERO
     C                     Z-ADD*ZEROS    WWFACT
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #P06      BEGSR
     C*
     C** INITIALISE WORK FIELD FOR 'AMOUNT ACCRUED FOR SECURITY'
     C                     Z-ADD*ZEROS    WWAAFS 150
     C*
     C** SET WORK FIELD FOR 'CHARGE CODE ' TO BLANK
     C                     MOVE *BLANKS   WWCGCO
     C*
     C** ACCESS LF/SECTY WITH SECURITY REFERENCE
     C           WWCSSC    CHAINSECTY                48
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C           *IN48     IFEQ '1'
     C           CHTP      OREQ 'D'
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD5         DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C                     MOVEL'SECTY   'DBFILE           ** DBERROR  005**
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVELWWCSSC    DBKEY
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C*
     C                     ELSE
     C*
     C** DETERMINE CHARGE TO BE LEVIED
     C                     EXSR #P08
     C                     END
     C*
     C** IF CHARGE CODE BLANK TERMINATE ROUTINE
     C           WWCGCO    IFEQ *BLANKS
     C                     GOTO #P060
     C                     END
     C*
     C***ACCESS*PF/SCCHRGPD*WITH*CHARGE*CODE*RETURNED*FROM*#P08           S01464
     C***********WWCGCO    CHAINSCCGCDPD             49                   S01464
     C*                                                                   S01464
     C** Access PF/SECGCDPD with charge code returned from #P08           S01464
     C           WWCGCO    CHAINSECGCDPD             49                   S01464
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C           *IN49     IFEQ '1'
     C           SFCHTP    OREQ 'D'
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD6         DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SCCGCDPD'DBFILE         ** DBERROR  006**S01464
     C                     MOVEL'SECGCDPD'DBFILE           * DBERROR 006 *S01464
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVELWWCGCO    DBKEY
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C*
     C                     ELSE
     C*
     C***ACCESS*LF/SDCURRJ0*WITH*NOMINAL*CCY*FROM*LF/SECTY*************   S01464
     C***********NMCY      CHAINSDCURRJ0             50                   S01464
     C*                                                                   S01464
     C** Access LF/SDCURRL0 with Nominal Ccy from LF/SECTY                S01464
     C           NMCY      CHAINSDCURRL0             50                   S01464
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C           *IN50     IFEQ '1'
     C           A6TYLC    OREQ 'D'
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD7         DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDCURRJ0'DBFILE         ** DBERROR  007**S01464
     C                     MOVEL'SDCURRL0'DBFILE           **DBERROR 007**S01464
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVELNMCY      DBKEY
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C*
     C                     ELSE
     C*
     C** CALCULATE 'MARKET VALUE OF SECURITY' IN NOMINAL CCY USING
     C**  STANDARD SUBROUTINE ZAPNUM
     C                     Z-ADDWWTVDN    ZNOML
     C*                                                                   B05945
     C** CONVERT DISCOUNT/YIELD INTO PERCENTAGE PRICE                     B05945
     C           SPBS      IFEQ 'D'                                       B05945
     C           SPBS      OREQ 'Y'                                       B05945
     C                     Z-ADDBJRDNB    ZFDATE                          B05945
     C                     Z-ADDMKPR      ZPRCIN                          B05945
     C*                                                                   S01464
     C** Access LF/INVTP with Nominal Ccy and Investment Type             S01464
     C** from LF/SECTY.                                                   S01464
     C           WWKEY4    CHAININVTP                60                   S01464
     C*                                                                   S01464
     C** If record not found or RECI not equal to 'D' then DB error       S01464
     C           *IN60     IFEQ '1'                                       S01464
     C           RECI      ORNE 'D'                                       S01464
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD10        DBASE                           S01464
     C                     MOVE *BLANKS   DBFILE           ***************S01464
     C                     MOVEL'INVTP   'DBFILE           **DBERROR 010**S01464
     C                     MOVE *BLANKS   DBKEY            ***************S01464
     C                     MOVELNMCY      DBKEY                           S01464
     C                     MOVE SITP      DBKEY                           S01464
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA                                       S01464
     C                     ELSE                                           S01464
     C                     EXSR ZPRCI                                     B05945
     C                     END                                            S01464
     C*                                                                   S01464
     C                     Z-ADDZPRCOT    ZAVPR                           B05945
     C                     ELSE                                           B05945
     C                     Z-ADDMKPR      ZAVPR
     C                     END                                            B05945
     C/COPY WNCPYSRC,SE6240C032
     C                     Z-ADDNMDP      ZNMDP
     C                     Z-ADDA6NBDP    ZNMCD
     C                     MOVE SPBS      ZPRCB
     C                     EXSR ZAPNUM
     C                     Z-ADDZVALU     WWMVNC 150
     C*
     C** CONVERT FROM NOMINAL CCY TO BANK CHARGING CCY. USING SR/ZCCYCN
     C                     Z-ADDWWMVNC    ZAMTF
     C                     MOVE NMCY      ZCCYF
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVE A6MDIN    ZMDINF
     C                     Z-ADDA6NBDP    ZCDPF
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWMVBC 150
     C*                                                                   B07896
     C** IF POSITION EXISTS, BUT MARKET VALUE IS ZERO, SHOULD CALCULATE   B07896
     C** FEE IF THE CHARGE BASIS IS FLAT                                  B07896
     C           SFCGBS    IFEQ 'F'                                       B07896
     C           ZNOML     ANDGT0                                         B07896
     C           WWMVBC    ANDEQ0                                         B07896
     C                     Z-ADD1         WWMVBC                          B07896
     C                     END                                            B07896
     C*
     C** CALCULATE FEE TO BE CHARGED FOR SECURITY USING SR/ZPMCRG
     C           SFCGBS    IFEQ 'N'
     C                     Z-ADDWWTVDN    WWTVDS 150
     C           NMDP      IFGT *ZEROS
     C*          NMDP      ADD  4         X       10                      B05945
     C           NMDP      ADD  4         X       20                      B05945
     C           WWTVDN    DIV  POWER8,X  WWTVDN
     C                     END
     C                     Z-ADDWWTVDN    ZAMT
     C                     Z-ADDWWTVDS    WWTVDN
     C                     ELSE
     C           SFCGBS    IFEQ 'F'
     C           SFCGBS    OREQ 'P'
     C                     Z-ADDWWMVBC    ZAMT
     C                     END
     C                     END
     C                     Z-ADD3         ZDYBS
     C                     Z-ADD3         ZDVBS
     C                     Z-ADD*ZEROS    ZSPRD
     C                     MOVE *BLANKS   ZSPRI
     C           SFCGBS    IFEQ 'N'
     C                     MOVE 'F'       ZCGBS
     C                     ELSE
     C           SFCGBS    IFEQ 'F'
     C           SFCGBS    OREQ 'P'
     C                     MOVE SFCGBS    ZCGBS
     C                     END
     C                     END
     C                     MOVE SFCGMT    ZCGMT
     C                     Z-ADDSFMINC    ZMINC
     C                     Z-ADDSFCRU1    ZRA,1
     C                     Z-ADDSFCRU2    ZRA,2
     C                     Z-ADDSFCRU3    ZRA,3
     C                     Z-ADDSFCRU4    ZRA,4
     C                     Z-ADDSFCRU5    ZRA,5
     C                     Z-ADDSFCRU6    ZRA,6
     C                     Z-ADDSFCRU7    ZRA,7
     C                     Z-ADDSFCRU8    ZRA,8
     C                     Z-ADDSFCRU9    ZRA,9
     C                     Z-ADDSFCR10    ZRA,10
     C                     Z-ADDSFCR11    ZRA,11
     C                     Z-ADDSFCR12    ZRA,12
     C                     Z-ADDSFCR13    ZRA,13
     C                     Z-ADDSFCR14    ZRA,14
     C                     Z-ADDSFPCL1    ZPC,1
     C                     Z-ADDSFPCL2    ZPC,2
     C                     Z-ADDSFPCL3    ZPC,3
     C                     Z-ADDSFPCL4    ZPC,4
     C                     Z-ADDSFPCL5    ZPC,5
     C                     Z-ADDSFPCL6    ZPC,6
     C                     Z-ADDSFPCL7    ZPC,7
     C                     Z-ADDSFPCL8    ZPC,8
     C                     Z-ADDSFPCL9    ZPC,9
     C                     Z-ADDSFPC10    ZPC,10
     C                     Z-ADDSFPC11    ZPC,11
     C                     Z-ADDSFPC12    ZPC,12
     C                     Z-ADDSFPC13    ZPC,13
     C                     Z-ADDSFPC14    ZPC,14
     C                     Z-ADDSFPC15    ZPC,15
     C                     Z-ADDSFFLC1    ZCG,1
     C                     Z-ADDSFFLC2    ZCG,2
     C                     Z-ADDSFFLC3    ZCG,3
     C                     Z-ADDSFFLC4    ZCG,4
     C                     Z-ADDSFFLC5    ZCG,5
     C                     Z-ADDSFFLC6    ZCG,6
     C                     Z-ADDSFFLC7    ZCG,7
     C                     Z-ADDSFFLC8    ZCG,8
     C                     Z-ADDSFFLC9    ZCG,9
     C                     Z-ADDSFFL10    ZCG,10
     C                     Z-ADDSFFL11    ZCG,11
     C                     Z-ADDSFFL12    ZCG,12
     C                     Z-ADDSFFL13    ZCG,13
     C                     Z-ADDSFFL14    ZCG,14
     C                     Z-ADDSFFL15    ZCG,15
     C*
     C** ONLY PERFORM ROUTINE SR/ZPMCRG FOR LONG POSITIONS
     C           ZAMT      IFGT 0
     C                     EXSR ZPMCRG
     C                     ELSE
     C                     Z-ADD0         ZCHGA
     C                     END
     C                     Z-ADDZCHGA     WWAAFS
     C*
     C                     END
     C                     END
     C*
     C           #P060     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #P07      BEGSR
     C*
     C** INITIALISE WORK FIELD FOR 'AMOUNT ACCRUED FOR ACCOUNT'
     C                     Z-ADD*ZEROS    WWAAFA 150
     C*
     C** SET WORK FIELD FOR 'CHARGE CODE ' TO BLANK
     C                     MOVE *BLANKS   WWCGCO
     C*
     C** DETERMINE CHARGE TO BE LEVIED
     C                     EXSR #P09
     C*
     C** IF CHARGE CODE BLANK TERMINATE ROUTINE
     C           WWCGCO    IFEQ *BLANKS                    B1
     C                     GOTO #P070
     C                     END                             E1
     C*
     C***ACCESS*PF/SCCHRGPD*WITH*CHARGE*CODE*RETURNED*FROM*#P09           S01464
     C***********WWCGCO    CHAINSCCGCDPD             49                   S01464
     C*                                                                   S01464
     C** Access PF/SECGCDPD with charge code returned from #P09           S01464
     C           WWCGCO    CHAINSECGCDPD             49                   S01464
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C           *IN49     IFEQ '1'                        B1
     C           SFCHTP    OREQ 'D'
     C           *LOCK     IN   LDA                                       S01464
     C***********          Z-ADD6         DBASE                           091522
     C                     Z-ADD12        DBASE                           091522
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SCCGCDPD'DBFILE         ** DBERROR  006**S01464
     C***********          MOVEL'SCCGCDPD'DBFILE           * DBERRORS01464091522
     C                     MOVEL'SCCGCDPD'DBFILE           * DBERROR 012 *091522
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVELWWCGCO    DBKEY
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C*
     C                     ELSE                            X1
     C*
     C***ACCESS*LF/SDCURRJ0*WITH*ACCOUNT*CCY*FROM*PF/SCPMABPD**********   S01464
     C***********SGCCY     CHAINSDCURRJ0             56                   S01464
     C*                                                                   S01464
     C** Access LF/SDCURRL0 with Account Ccy from PF/SEPMABPD             S01464
     C           SGCCY     CHAINSDCURRL0             56                   S01464
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C           *IN56     IFEQ '1'                        B2
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD9         DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDCURRJ0'DBFILE         ** DBERROR  009**S01464
     C                     MOVEL'SDCURRL0'DBFILE           **DBERROR 009**S01464
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVELSGCCY     DBKEY
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C*
     C                     ELSE                            X2
     C*
     C** SET 'MARKET VALUE OF SECURITY IN NOMINAL CCY' TO 'ACCOUNT
     C**  BALANCE' ON PF/SCPMABPD
     C/COPY WNCPYSRC,SE6240C013
     C                     Z-SUBSGCLBL    WWMVNC
     C/COPY WNCPYSRC,SE6240C014
     C*
     C** CONVERT FROM NOMINAL CCY TO BANK CHARGING CCY. USING SR/ZCCYCN
     C                     Z-ADDWWMVNC    ZAMTF
     C                     MOVE SGCCY     ZCCYF
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVE A6MDIN    ZMDINF
     C                     Z-ADDA6NBDP    ZCDPF
     C                     EXSR ZCCYCN
     C                     Z-ADDZAMTT     WWMVBC 150
     C*
     C** CALCULATE FEE TO BE CHARGED FOR ACCOUNT USING SR/ZPMCRG
     C           SFCGBS    IFEQ 'N'                        B3
     C           A6NBDP    IFGT *ZEROS                     B4
     C*          A6NBDP    ADD  4         X       10                      B05945
     C           A6NBDP    ADD  4         X       20                      B05945
     C           WWMVNC    DIV  POWER,X   WWMVNC
     C                     END                             E4
     C*
     C** INVERSE NOMINAL AMOUNT PASSED TO SR/ZPMCRG SO THAT NOMINAL
     C** AMOUNT CAN BE COMPARED WITH AMOUNTS FROM CHARGES FILE
     C                     Z-ADDWWMVNC    ZAMT
     C                     END                             E3
     C*
     C           SFCGBS    IFEQ 'F'                        B3
     C           SFCGBS    OREQ 'P'
     C                     Z-ADDWWMVBC    ZAMT
     C                     END                             E3
     C                     Z-ADD3         ZDYBS
     C                     Z-ADD3         ZDVBS
     C                     Z-ADD*ZEROS    ZSPRD
     C                     MOVE *BLANKS   ZSPRI
     C           SFCGBS    IFEQ 'N'                        B3
     C                     MOVE 'F'       ZCGBS
     C                     ELSE                            X3
     C           SFCGBS    IFEQ 'F'                        B4
     C           SFCGBS    OREQ 'P'
     C                     MOVE SFCGBS    ZCGBS
     C                     END                             E4
     C                     END                             E3
     C                     MOVE SFCGMT    ZCGMT
     C                     Z-ADDSFMINC    ZMINC
     C                     Z-ADDSFCRU1    ZRA,1
     C                     Z-ADDSFCRU2    ZRA,2
     C                     Z-ADDSFCRU3    ZRA,3
     C                     Z-ADDSFCRU4    ZRA,4
     C                     Z-ADDSFCRU5    ZRA,5
     C                     Z-ADDSFCRU6    ZRA,6
     C                     Z-ADDSFCRU7    ZRA,7
     C                     Z-ADDSFCRU8    ZRA,8
     C                     Z-ADDSFCRU9    ZRA,9
     C                     Z-ADDSFCR10    ZRA,10
     C                     Z-ADDSFCR11    ZRA,11
     C                     Z-ADDSFCR12    ZRA,12
     C                     Z-ADDSFCR13    ZRA,13
     C                     Z-ADDSFCR14    ZRA,14
     C                     Z-ADDSFPCL1    ZPC,1
     C                     Z-ADDSFPCL2    ZPC,2
     C                     Z-ADDSFPCL3    ZPC,3
     C                     Z-ADDSFPCL4    ZPC,4
     C                     Z-ADDSFPCL5    ZPC,5
     C                     Z-ADDSFPCL6    ZPC,6
     C                     Z-ADDSFPCL7    ZPC,7
     C                     Z-ADDSFPCL8    ZPC,8
     C                     Z-ADDSFPCL9    ZPC,9
     C                     Z-ADDSFPC10    ZPC,10
     C                     Z-ADDSFPC11    ZPC,11
     C                     Z-ADDSFPC12    ZPC,12
     C                     Z-ADDSFPC13    ZPC,13
     C                     Z-ADDSFPC14    ZPC,14
     C                     Z-ADDSFPC15    ZPC,15
     C                     Z-ADDSFFLC1    ZCG,1
     C                     Z-ADDSFFLC2    ZCG,2
     C                     Z-ADDSFFLC3    ZCG,3
     C                     Z-ADDSFFLC4    ZCG,4
     C                     Z-ADDSFFLC5    ZCG,5
     C                     Z-ADDSFFLC6    ZCG,6
     C                     Z-ADDSFFLC7    ZCG,7
     C                     Z-ADDSFFLC8    ZCG,8
     C                     Z-ADDSFFLC9    ZCG,9
     C                     Z-ADDSFFL10    ZCG,10
     C                     Z-ADDSFFL11    ZCG,11
     C                     Z-ADDSFFL12    ZCG,12
     C                     Z-ADDSFFL13    ZCG,13
     C                     Z-ADDSFFL14    ZCG,14
     C                     Z-ADDSFFL15    ZCG,15
     C*
     C** ONLY PERFORM ROUTINE SR/ZPMCRG FOR CR ACCOUNT BALANCES
     C           ZAMT      IFGT 0
     C                     EXSR ZPMCRG
     C                     ELSE
     C                     Z-ADD0         ZCHGA
     C                     END
     C                     Z-ADDZCHGA     WWAAFA
     C*
     C                     END                             E2
     C                     END                             E1
     C*
     C           #P070     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #P08      BEGSR
     C*
     C***SET*FIRST*KEY*AND*ACCESS*PF/SCCICFPD**************************   S01464
     C** Set first key and access PF/SCCICFPD                             S01464
     C                     MOVE *BLANKS   WWFGCK
     C**********           Z-ADDWWCNUM    WWCNOK                                              CSD027
     C                     MOVE WWCNUM    WWCNOK                                              CSD027
     C                     Z-ADD1         WWCSQK
     C                     MOVE WWCSSC    WWSSNK
     C                     MOVE *BLANKS   WWCCYK
     C                     MOVE *BLANKS   WWIVTK
     C*
     C***********WWKEY2    CHAINSCCICFPD             51                   S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*
     C** IF LIVE RECORD FOUND MOVE 'CHARGE CODE' TO A WORK FIELD AND
     C**  TERMINATE ROUTINE
     C           *IN51     IFEQ '0'
     C           SCRECI    ANDEQ'D'
     C                     MOVE SCCGCO    WWCGCO
     C                     GOTO #P080
     C                     END
     C*
     C***SET*SECOND*KEY*AND*ACCESS*PF/SCCICFPD*************************   S01464
     C** Set second key and access PF/SECICFPD                            S01464
     C                     MOVE *BLANKS   WWFGCK
     C**********           Z-ADDWWCNUM    WWCNOK                                              CSD027
     C                     MOVE WWCNUM    WWCNOK                                              CSD027
     C                     Z-ADD2         WWCSQK
     C                     MOVE *BLANKS   WWSSNK
     C                     MOVE NMCY      WWCCYK
     C                     MOVE SITP      WWIVTK
     C*
     C***********WWKEY2    CHAINSCCICFPD             51                   S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*
     C** IF LIVE RECORD FOUND MOVE 'CHARGE CODE' TO A WORK FIELD AND
     C**  TERMINATE ROUTINE
     C           *IN51     IFEQ '0'
     C           SCRECI    ANDEQ'D'
     C                     MOVE SCCGCO    WWCGCO
     C                     GOTO #P080
     C                     END
     C*
     C***SET*THIRD*KEY*AND*ACCESS*PF/SCCICFPD**************************   S01464
     C** Set third key and access PF/SECICFPD                             S01464
     C                     MOVE *BLANKS   WWFGCK
     C**********           Z-ADDWWCNUM    WWCNOK                                              CSD027
     C                     MOVE WWCNUM    WWCNOK                                              CSD027
     C                     Z-ADD3         WWCSQK
     C                     MOVE *BLANKS   WWSSNK
     C                     MOVE *BLANKS   WWCCYK
     C                     MOVE SITP      WWIVTK
     C*
     C***********WWKEY2    CHAINSCCICFPD             51                   S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*
     C** IF LIVE RECORD FOUND MOVE 'CHARGE CODE' TO A WORK FIELD AND
     C**  TERMINATE ROUTINE
     C           *IN51     IFEQ '0'
     C           SCRECI    ANDEQ'D'
     C                     MOVE SCCGCO    WWCGCO
     C                     GOTO #P080
     C                     END
     C*
     C***SET*FOURTH*KEY*AND*ACCESS*PF/SCCICFPD*************************   S01464
     C** Set fourth key and access PF/SECICFPD                            S01464
     C                     MOVE WWCFGC    WWFGCK
     C**********           Z-ADD*ZEROS    WWCNOK                                              CSD027
     C                     MOVE *BLANKS   WWCNOK                                              CSD027
     C                     Z-ADD1         WWCSQK
     C                     MOVE WWCSSC    WWSSNK
     C                     MOVE *BLANKS   WWCCYK
     C                     MOVE *BLANKS   WWIVTK
     C*
     C***********WWKEY2    CHAINSCCICFPD             51                   S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*
     C** IF LIVE RECORD FOUND MOVE 'CHARGE CODE' TO A WORK FIELD AND
     C**  TERMINATE ROUTINE
     C           *IN51     IFEQ '0'
     C           SCRECI    ANDEQ'D'
     C                     MOVE SCCGCO    WWCGCO
     C                     GOTO #P080
     C                     END
     C*
     C***SET*FIFTH*KEY*AND*ACCESS*PF/SCCICFPD**************************   S01464
     C** Set fifth key and access PF/SECICFPD                             S01464
     C                     MOVE WWCFGC    WWFGCK
     C**********           Z-ADD*ZEROS    WWCNOK                                              CSD027
     C                     MOVE *BLANKS   WWCNOK                                              CSD027
     C                     Z-ADD2         WWCSQK
     C                     MOVE *BLANKS   WWSSNK
     C                     MOVE NMCY      WWCCYK
     C                     MOVE SITP      WWIVTK
     C*
     C***********WWKEY2    CHAINSCCICFPD             51                   S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*
     C** IF LIVE RECORD FOUND MOVE 'CHARGE CODE' TO A WORK FIELD AND
     C**  TERMINATE ROUTINE
     C           *IN51     IFEQ '0'
     C           SCRECI    ANDEQ'D'
     C                     MOVE SCCGCO    WWCGCO
     C                     GOTO #P080
     C                     END
     C*
     C***SET*SIXTH*KEY*AND*ACCESS*PF/SCCICFPD**************************   S01464
     C** Set sixth key and access PF/SECICFPD                             S01464
     C                     MOVE WWCFGC    WWFGCK
     C**********           Z-ADD*ZEROS    WWCNOK                                              CSD027
     C                     MOVE *BLANKS   WWCNOK                                              CSD027
     C                     Z-ADD3         WWCSQK
     C                     MOVE *BLANKS   WWSSNK
     C                     MOVE *BLANKS   WWCCYK
     C                     MOVE SITP      WWIVTK
     C*
     C***********WWKEY2    CHAINSCCICFPD             51                   S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*
     C** IF LIVE RECORD FOUND MOVE 'CHARGE CODE' TO A WORK FIELD AND
     C**  TERMINATE ROUTINE
     C           *IN51     IFEQ '0'
     C           SCRECI    ANDEQ'D'
     C                     MOVE SCCGCO    WWCGCO
     C                     GOTO #P080
     C                     END
     C*
     C           #P080     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #P09      BEGSR
     C*
     C***SET*FIRST*KEY*AND*ACCESS*PF/SCCICFPD**************************   S01464
     C** Set first key and access PF/SECICFPD                             S01464
     C                     MOVE *BLANKS   WWFGCK
     C**********           Z-ADDWWCNUM    WWCNOK                                              CSD027
     C                     MOVE WWCNUM    WWCNOK                                              CSD027
     C                     Z-ADD4         WWCSQK
     C                     MOVE *BLANKS   WWSSNK
     C                     MOVE SGCCY     WWCCYK
     C                     MOVE *BLANKS   WWIVTK
     C*
     C***********WWKEY2    CHAINSCCICFPD             51                   S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*
     C** IF LIVE RECORD FOUND MOVE 'CHARGE CODE' TO A WORK FIELD AND
     C**  TERMINATE ROUTINE
     C           *IN51     IFEQ '0'
     C           SCRECI    ANDEQ'D'
     C                     MOVE SCCGCO    WWCGCO
     C                     GOTO #P090
     C                     ELSE                                           S01464
     C                     MOVE 'ALL'     WWCCYK                          S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*                                                                   S01464
     C** If live record found move 'CHARGE CODE' to a work field and      S01464
     C**  terminate routine.                                              S01464
     C           *IN51     IFEQ '0'                                       S01464
     C           SCRECI    ANDEQ'D'                                       S01464
     C                     MOVE SCCGCO    WWCGCO                          S01464
     C                     GOTO #P090                                     S01464
     C                     END                                            S01464
     C                     END
     C*
     C***SET*SECOND*KEY*AND*ACCESS*PF/SCCICFPD*************************   S01464
     C** Set second key and access PF/SECICFPD                            S01464
     C                     MOVE WWCFGC    WWFGCK
     C**********           Z-ADD*ZEROS    WWCNOK                                              CSD027
     C                     MOVE *BLANKS   WWCNOK                                              CSD027
     C                     Z-ADD4         WWCSQK
     C                     MOVE *BLANKS   WWSSNK
     C                     MOVE SGCCY     WWCCYK
     C                     MOVE *BLANKS   WWIVTK
     C*
     C***********WWKEY2    CHAINSCCICFPD             51                   S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*
     C** IF LIVE RECORD FOUND MOVE 'CHARGE CODE' TO A WORK FIELD AND
     C**  TERMINATE ROUTINE
     C           *IN51     IFEQ '0'
     C           SCRECI    ANDEQ'D'
     C                     MOVE SCCGCO    WWCGCO
     C                     GOTO #P090
     C                     ELSE                                           S01464
     C                     MOVE 'ALL'     WWCCYK                          S01464
     C           WWKEY2    CHAINSECICFPD             51                   S01464
     C*                                                                   S01464
     C** If live record found move 'CHARGE CODE' to a work field and      S01464
     C**  terminate routine.                                              S01464
     C           *IN51     IFEQ '0'                                       S01464
     C           SCRECI    ANDEQ'D'                                       S01464
     C                     MOVE SCCGCO    WWCGCO                          S01464
     C                     GOTO #P090                                     S01464
     C                     END                                            S01464
     C                     END
     C*
     C           #P090     ENDSR
      ********************************************************************R5553
      /EJECT                                                              R5553
      ********************************************************************R5553
      *                                                                   R5553
      **   #ACOD - Subroutine to access account code details              R5553
      *                                                                   R5553
      **   Called by                                                      R5553
      *                                                                   R5553
      **   Calls - *PSSR                                                  R5553
      *                                                                   R5553
      *===================================================================R5553
     C           #ACOD     BEGSR                           * #ACOD BEGS **R5553
      *                                                                   R5553
     C**********           MOVE ACOD      KKACOD  4                                     R5553 CGL029
     C                     MOVE ACOD      KKACOD 10                                           CGL029
     C           KKACOD    CHAINSDACODL0             81                   R5553
     C           *IN81     IFEQ '0'                                       R5553
     C                     MOVE A5ACTY    ATYP                            R5553
     C                     ELSE                                           R5553
      **   DB error:                                                      R5553
     C           *LOCK     IN   LDA                                       S01464
     C***********          MOVEL'09'      DBASE            *********R5553 091522
     C***********          MOVEL'SDACODL0'DBFILE           *  DB ERROR5553091522
     C                     MOVEL'13'      DBASE            ***************091522
     C                     MOVEL'SDACODL0'DBFILE           *  DB ERROR 13 091522
     C                     MOVEL'KKACOD'  DBKEY            ***************R5553
     C                     OUT  LDA                                       S01464
     C                     EXSR *PSSR                                     R5553
     C                     END                                            R5553
      *                                                                   R5553
     C                     ENDSR                           * #ACOD ENDS **R5553
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #P10      BEGSR
     C*
     C** IF CHANGE OF BRANCH CODE
     C           BBBRCD    IFNE WWBRCD
     C*
     C** MOVE NEW BRANCH CODE INTO WORK FIELD
     C                     MOVE BBBRCD    WWBRCD
     C*
     C** ACCESS LF/SDBRCHL1 WITH BRANCH CODE
     C           BBBRCD    CHAINSDBRCHL1             52
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C           *IN52     IFEQ '1'
     C           A8TYLC    OREQ 'D'
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD8         DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C                     MOVEL'SDBRCHL1'DBFILE           ** DBERROR  008**
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVELBBBRCD    DBKEY
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C*
     C                     END
     C                     END
     C*
     C** SET UP FIELDS FOR UPDATE OF PF/GESCPD
     C*
     C** RECORD ID
     C                     MOVE 'P'       RECI
     C*
     C** CUSTOMER NUMBER
     C                     MOVE A8BICN    CNUM
     C*
     C** CURRENCY
     C                     MOVE WWBCGC    CCY
     C*
     C** ACCOUNT CODE
     C***********          Z-ADDSAAACT    ACOD                            S01464
     C                     Z-ADDFBAACT    ACOD                            S01464
     C*
     C** ACCOUNT SEQUENCE
     C                     Z-ADD1         ACSQ
     C*
     C** RETAIL ACCOUNT NUMBER
     C                     Z-ADD*ZEROS    ACNO
     C*
     C** POSTING DATE
     C                     Z-ADDBJRDNB    PSTD
     C*
     C** VALUE DATE
     C***********          Z-ADDSACCRD    VALD                            S01464
     C                     Z-ADDFBCCRD    VALD                            S01464
     C*
     C** TRANSACTION TYPE
     C                     Z-ADD*ZEROS    TRAT
     C*
     C** POSTING NARRATIVE
     C                     MOVEAPNARR     WWTEXT
     C                     MOVE *BLANKS   WWSPAC
     C                     MOVE WWCUST    WWCUSN
     C***********SACFCP    IFEQ 'C'                                       S01464
     C           FBCFCP    IFEQ 'C'                                       S01464
     C                     MOVE *BLANKS   WWLBRK
     C                     MOVE *BLANKS   WWPORT
     C                     MOVE *BLANKS   WWRBRK
     C***********          ELSE                                           S01464
     C***********SACFCP    IFEQ 'P'                                       S01464
     C***********          MOVE ' ('      WWLBRK                          S01464
     C***********          MOVE ') '      WWRBRK                          S01464
     C***********WWPTFR    IFEQ '9997'                                    S01464
     C***********          MOVE P9R997    WWPORT                          S01464
     C***********          ELSE                                           S01464
     C***********WWPTFR    IFEQ '9999'                                    S01464
     C***********          MOVE P9R999    WWPORT                          S01464
     C***********          ELSE                                           S01464
     C***********          MOVE WWPTFR    WWPORT                          S01464
     C***********          END                                            S01464
     C***********          END                                            S01464
     C***********          END                                            S01464
     C                     ELSE                                           091522
     C           FBCFCP    IFEQ 'P'                                       091522
     C                     MOVE ' ('      WWLBRK                          091522
     C                     MOVE ') '      WWRBRK                          091522
     C           WWPTFR    IFEQ '9997'                                    091522
     C                     MOVE FCR997    WWPORT                          091522
     C                     ELSE                                           091522
     C           WWPTFR    IFEQ '9999'                                    091522
     C                     MOVE FCR999    WWPORT                          091522
     C                     ELSE                                           091522
     C                     MOVE WWPTFR    WWPORT                          091522
     C                     END                                            091522
     C                     END                                            091522
     C                     END                                            091522
     C                     END
     C*
     C                     MOVE WWPNAR    PNAR
     C*
     C** POSTING AMOUNT
     C                     Z-ADDWWFACT    PSTA
     C*
     C** DEBIT/CREDIT INDICATOR
     C           PSTA      IFGT *ZEROS
     C                     Z-ADD*ZEROS    DRCR
     C                     ELSE
     C           PSTA      IFLT *ZEROS
     C                     Z-ADD1         DRCR
     C                     Z-SUBPSTA      PSTA
     C                     END
     C                     END
     C*
     C** ASSOCIATED CUSTOMER
     C                     MOVE WWCUST    ASOC
     C*
     C** CHEQUE NUMBER
     C                     Z-ADD*ZEROS    CHQN
     C*
     C** SOURCE OF POSTING
     C                     MOVE 'GE-SC'   SPOS
     C*
     C** BRANCH CODE
     C***********          MOVE BBBRCD    BRCD                            S01464
     C                     MOVE BBBRCD    BRCA                            S01464
     C*
     C** RETAIL INDICATOR
     C                     Z-ADD*ZEROS    RIND
     C*
     C** REJECT CODE
     C                     Z-ADD*ZEROS    REJC
     C*
     C** DEPARTMENT CODE
     C                     MOVE *BLANKS   DPMT
     C*
     C** RELATIVE RECORD NUMBER
     C                     Z-ADD*ZEROS    RRNM
     C*
     C** ACCOUNT TYPE
     C*********************MOVE 'G'       ATYP                            R5553
     C                     EXSR #ACOD                                     R5553
     C*
     C** EXTRACT INDICATOR
     C                     MOVE *BLANKS   EXIN
     C*
     C** POSTING RECORD INDICATOR
     C**                   BITOFBITNC     PRIN                            R5516
     C                     BITOF'01234567'PRIN                            R5516
     C*
     C** GENERATED ENTRY TYPE
     C***********          MOVE *BLANKS   GETP                            S01464
     C                     MOVE 'B'       GETP                            S01464
     C*
     C** ACCUMULATOR
     C                     Z-ADD*ZEROS    ACUM
     C*
     C** PROFIT CENTRE
     C*                                                                   CAC003
     C** If Analytical Accounting and SAR CAC003 are installed,           CAC003
     C** move the Safe Custody Fee Profit Centre.                         CAC003
     C*                                                                   CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     MOVE FBPCSF    PRFC                            CAC003
     C                     ELSE                                           CAC003
     C*                                                                   CAC003
     C                     MOVE *BLANKS   PRFC
     C*                                                                   CAC003
     C                     ENDIF                                          CAC003
     C*
     C***REBATABLE*INDICATOR*******************************************   S01464
     C***********          MOVE *BLANKS   REBI                            S01464
     C*
     C***CHARGE*AMOUNT*************************************************   S01464
     C***********          Z-ADD*ZEROS    CHGA                            S01464
     C*
     C** SWIFT COMMON REFERENCE
     C                     MOVE *BLANKS   SWCR
     C*
     C** DEAL/LOAN REFERENCE
     C                     MOVE *BLANKS   DLREF
     C*
     C** FOR ACCOUNT OF
     C                     MOVE *BLANKS   FACO
     C*
     C** DEALT/BORROWER CUSTOMER
     C**********           Z-ADD*ZEROS    DBCNUM                                              CSD027
     C                     MOVE *BLANKS   DBCNUM                                              CSD027
     C*
     C** PAYMENT REFERENCE
     C                     MOVE *BLANKS   PREF
     C*
     C***NUMBER*OF*ITEMS***********************************************   S01464
     C***********          Z-ADD*ZEROS    NITMS                           S01464
     C*
     C** ORIGINAL TRANSACTION REFERENCE
     C                     MOVE WWPNAR    OTRF
     C*
     C** ORIGINAL TRANSACTION SUB-TYPE
     C                     MOVE *BLANKS   OTST
     C*
     C** ORIGINAL TRANSACTION TYPE
     C                     MOVE *BLANKS   OTTP
     C*
     C** START OF DAY CLEARED BALANCE
     C                     Z-ADD*ZEROS    SDCB
     C*
     C** START OF DAY LEDGER BALANCE
     C                     Z-ADD*ZEROS    SDLB
     C*
     C** BOOK CODE
     C                     MOVE *BLANKS   BOKC
      *                                                                   179044
      ** Message ID                                                       179044
      *                                                                   179044
     C                     MOVE 'GBC7000' ##MGID                          179044
     C*
     C** WRITE A RECORD TO PF/GESCPD
     C           PSTA      IFNE 0                                         48360
      *                                                                   179044
      ** Determine the posting narrative:                                 179044
      *                                                                   179044
     C                     EXSR SRPNAR                                    179044
      *                                                                   179044
     C                     WRITEAPOSTPDF
     C*
     C** TOTAL POSTING AMOUNT
     C                     ADD  PSTA      WWTOTP
     C*
     C** INCREMENT NUMBER OF RECORDS WRITTEN TO PF/GESCPD
     C                     ADD  1         WWNUMR
     C                     END                                            48360
     C*
     C** SET ACCOUNT CODE
     C***********          Z-ADDSAINCA    ACOD                            S01464
     C                     Z-ADDFBINCA    ACOD                            S01464
     C*
     C** REVERSE DB/CR
     C           DRCR      IFEQ *ZEROS
     C                     Z-ADD1         DRCR
     C                     ELSE
     C           DRCR      IFEQ 1
     C                     Z-ADD*ZEROS    DRCR
     C                     END
     C                     END
     C*
     C** RESET ACCOUNT TYPE
     C*********************MOVE 'G'       ATYP                            R5553
     C                     EXSR #ACOD                                     R5553
     C*
     C** RESET RETAIL ACCOUNT NUMBER TRANSACTION TYPE AND RETAIL IND.
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C*
     C** WRITE ANOTHER RECORD TO PF/GESCPD
     C           PSTA      IFNE 0                                         48360
      *                                                                   179044
      ** Determine the posting narrative:                                 179044
      *                                                                   179044
     C                     EXSR SRPNAR                                    179044
      *                                                                   179044
     C                     WRITEAPOSTPDF
     C*
     C** TOTAL POSTING AMOUNT
     C                     ADD  PSTA      WWTOTP
     C*
     C** INCREMENT NUMBER OF RECORDS WRITTEN TO PF/GESCPD
     C                     ADD  1         WWNUMR
     C                     END                                            48360
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C***********#P11      BEGSR                                          S01464
     C*****************************************************************   S01464
     C***CHECK*VALUE*OF*'CUSTODY*FEE*GROUP*CODE'*ON*LF/PMPORTLL********   S01464
     C***********PNCFGC    IFNE *BLANKS                                   S01464
     C***********WWPTFR    ANDNE'9997'                                    S01464
     C***********          MOVE PNCFGC    WWCFGC                          S01464
     C***********          ELSE                                           S01464
     C***********          MOVE BFCFGC    WWCFGC                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***IF*HEADINGS*HAVE*NOT*JUST*BEEN*WRITTEN************************   S01464
     C************IN30     IFEQ '0'                                       S01464
     C*****************************************************************   S01464
     C***MOVE*VALUES*FOR*CUSTOMER*HEADING*INTO*REPORT*FIELDS***********   S01464
     C***********          MOVE BBCUST    RRCNM1                          S01464
     C***********          MOVE BBCRNM    RRSNM1                          S01464
     C*****************************************************************   S01464
     C***********          ELSE                                           S01464
     C*****************************************************************   S01464
     C***RESET*HEADINGS*ALREADY*WRITTEN*INDICATOR**********************   S01464
     C***********          MOVE '0'       *IN30                           S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***DECIDE*PORTFOLIO*REFERENCE*TO*BE*USED*IN*CUSTOMER*HEADING*****   S01464
     C***********WWPTFR    IFEQ '9997'                                    S01464
     C***********          MOVE P9R997    RRPNM1                          S01464
     C***********          MOVE P9N997    RRPSN1                          S01464
     C***********          ELSE                                           S01464
     C***********          MOVE PNPTFR    RRPNM1                          S01464
     C***********          MOVE PNPTFN    RRPSN1                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***WRITE*PORTFOLIO*CUSTOMER*HEADING******************************   S01464
     C***********          MOVE WWCFGC    RRAFG1                          S01464
     C***                  WRITEDETAIL1                                   R0131
     C*****************************************************************   S01464
     C***IF*HEADER*3*NECESSARY*OR*ACCOUNT*OFFICER*CHANGED**************   S01464
     C************IN31     IFEQ '1'                                       S01464
     C***********AZACOC    ORNE WWACOC                                    S01464
     C*****************************************************************   S01464
     C***OUTPUT*BANK*CHARGING*CURRENCY*TO*REPORT***********************   S01464
     C***********          MOVE WWBCGC    RRBCCY                          S01464
     C***********          MOVE WWBCGC    RRCCCY                          S01464
     C***********          WRITEHEADER3                                   S01464
     C*****************************************************************   S01464
     C***RESET*HEADER*3*NECESSARY*INDICATOR****************************   S01464
     C***********          MOVE '0'       *IN31                           S01464
     C*****************************************************************   S01464
     C***MOVE*NEW*ACCOUNT*OFFICER*CODE*INTO*WORK*FIELD*****************   S01464
     C***********          MOVE AZACOC    WWACOC                          S01464
     C*****************************************************************   S01464
     C***********          END                                            S01464
     C***WRITE*PORTFOLIO*CUSTOMER*HEADING***************************R0131 S01464
     C***********          WRITEDETAIL1                             R0131 S01464
     C*****************************************************************   S01464
     C***ACCESS*PF/SCSCFAPD*WITH*CUSTOMER*NUMBER*AND*PORTFOLIO*REF.****   S01464
     C***********WWKEY1    CHAINSCSCFAPD             46                   S01464
     C*****************************************************************   S01464
     C***IF*NO*RECORD*FOUND********************************************   S01464
     C************IN46     IFEQ '1'                                       S01464
     C*****************************************************************   S01464
     C***SET*UP*WORK*FIELDS*FOR*'FEE*ACCRUED*TO*DATE',*'OUTSTANDING****   S01464
     C****ACCRUAL*ADJUSTMENT'*AND*'OUTSTANDING*ACCRUAL*ADJUSTMENT*SIGN'   S01464
     C***********          Z-ADD*ZEROS    WWCFAC                          S01464
     C***********          Z-ADD*ZEROS    WWOSAJ                          S01464
     C***********          MOVE *BLANKS   WWOSAS                          S01464
     C***********          ELSE                                           S01464
     C*****************************************************************   S01464
     C***SET*UP*WORK*FIELDS*WITH*VALUES*FROM*FILE**********************   S01464
     C***********          Z-ADDSDCFAC    WWCFAC                          S01464
     C***********          Z-ADDSDOSAJ    WWOSAJ                          S01464
     C***********          MOVE SDOSAS    WWOSAS                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***OUTPUT*'FEES*ACCRUED*TO*TODAY'*REPORT*LINE********************   S01464
     C***********          Z-ADDWWCFAC    ZFLD15                          S01464
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRFATT                          S01464
     C***********          WRITEDETAIL3                                   S01464
     C*****************************************************************   S01464
     C***IF*'OUTSTANDING*ACCRUAL*ADJUSTMENTS'*>*0*WRITE*REPORT*LINE****   S01464
     C***********WWOSAJ    IFGT *ZEROS                                    S01464
     C***********          Z-ADDWWOSAJ    ZFLD15                          S01464
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RROUTA                          S01464
     C*****************************************************************   S01464
     C***OUTPUT*'OUTSTANDING*ADJUSTMENT*SIGN'*TO*REPORT****************   S01464
     C***********          MOVE SDOSAS    RROTAS                          S01464
     C***********          WRITEDETAIL4                                   S01464
     C*****************************************************************   S01464
     C***UPDATE*'FEES*ACCRUED*TO*DATE'*AND*GENERATE*ACCRUAL*ADJUSTMENT*   S01464
     C****POSTINGS*****************************************************   S01464
     C***********          EXSR #P05                                      S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***ACCESS*LF/SCPMPSLL*WITH*CUSTOMER*NUMBER*AND*PORTFOLIO*REF.****   S01464
     C*****      WWKEY1    CHAINSCPMPSLL             55
     C***********WWKEY1    SETLLSCPMPSLL             55                   S01464
     C***********          READ SCPMPSLL                 55               S01464
     C*****************************************************************   S01464
     C***DO*WHILE*RECORDS*ON*LF/SCPMPSLL*FOR*CUSTOMER*AND PORTFOLIO****   S01464
     C************IN55     DOWEQ'0'                                       S01464
     C***********WWCNUM    ANDEQQACNUM                                    S01464
     C***********WWPTFR    ANDEQQAPTFR                                    S01464
     C*****************************************************************   S01464
     C***MOVE*'SECURITY*REFERENCE'*INTO*A*WORK*FIELD*******************   S01464
     C***********          MOVE QATDSS    WWCSSC                          S01464
     C*****************************************************************   S01464
     C***SET*WORK*FIELD*FOR*'TOTAL*VALUE*DATE*NOMINAL'*****************   S01464
     C***********          Z-ADDQANOML    WWTVDN 150                      S01464
     C*****************************************************************   S01464
     C***CALCULATE*FEE*TO*BE*ACCRUED*FOR*THIS*SECURITY*****************   S01464
     C***********          EXSR #P06                                      S01464
     C*****************************************************************   S01464
     C***IF*CHARGE*CODE*NOT*BLANK**************************************   S01464
     C***********WWCGCO    IFNE *BLANKS                                   S01464
     C*****************************************************************   S01464
     C***SET*UP*REPORT*FIELDS*FOR*SECURITY*DETAIL*LINE*****************   S01464
     C***SECURITY*REFERENCE********************************************   S01464
     C***********          MOVE WWCSSC    RRSCTY                          S01464
     C*****************************************************************   S01464
     C***INVESTMENT*TYPE***********************************************   S01464
     C***********          MOVE SITP      RRIVTS                          S01464
     C*****************************************************************   S01464
     C***NOMINAL*CURRENCY**********************************************   S01464
     C***********          MOVE NMCY      RRNMCS                          S01464
     C*****************************************************************   S01464
     C***NOMINAL*POSITION**********************************************   S01464
     C***********          Z-ADDWWTVDN    ZFLD15                          S01464
     C***********          Z-ADDNMDP      ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRNPSS                          S01464
     C*****************************************************************   S01464
     C***MARKET*VALUE*IN*NOMINAL*CURRENCY******************************   S01464
     C***********          Z-ADDWWMVNC    ZFLD15                          S01464
     C***********          Z-ADDA6NBDP    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRMNCS                          S01464
     C*****************************************************************   S01464
     C***MARKET*VALUE*IN*BANK*CHARGING*CURRENCY************************   S01464
     C***********          Z-ADDWWMVBC    ZFLD15                          S01464
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRMCCS                          S01464
     C*****************************************************************   S01464
     C***FEE*CODE******************************************************   S01464
     C***********          MOVE WWCGCO    RRFECS                          S01464
     C*****************************************************************   S01464
     C***AMOUNT*ACCRUED*TODAY******************************************   S01464
     C***********          Z-ADDWWAAFS    ZFLD15                          S01464
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRAATS                          S01464
     C*****************************************************************   S01464
     C***WRITE*DETAIL*LINE*TO*REPORT***********************************   S01464
     C***********QANOML    IFNE 0                                  B05945 S01464
     C***********          WRITEDETAIL6                                   S01464
     C***********          END                                     B05945 S01464
     C*****************************************************************   S01464
     C***ADD*FEE*ACCRUED*IN*#P06*TO*'FEES*ACCRUED*TO*DATE'*AND*TO******   S01464
     C****'FEES*ACCRUED*TODAY'*****************************************   S01464
     C***********          ADD  WWAAFS    WWCFAC                          S01464
     C***********          ADD  WWAAFS    WWFACT                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***READ*NEXT*RECORD*ON*LF/SCPMPSLL*WITH*CUST*NUMBER*AND*PORT.****   S01464
     C***********          READ SCPMPSLL                 55               S01464
     C*****************************************************************   S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***ACCESS*PF/SCPMABPD*WITH*CUST*NUMBER*AND*PORTFOLIO*REFERENCE***   S01464
     C***********          MOVE *LOVAL    WWCCYP  3                       S01464
     C***********WWKEY3    SETLLSCPMABPD                                  S01464
     C***********          READ SCPMABPD                 53               S01464
     C*****************************************************************   S01464
     C***WHILE*RECORDS*EXIST*FOR*THIS*CUSTOMER*************************   S01464
     C************IN53     DOWEQ'0'                                       S01464
     C***********WWCNUM    ANDEQSGCNUM                                    S01464
     C***********WWPTFR    ANDEQSGPTFR                                    S01464
     C*****************************************************************   S01464
     C***CALCULATE*FEE*TO*BE*ACCRUED*FOR*THIS*ACCOUNT******************   S01464
     C***********          EXSR #P07                                      S01464
     C*****************************************************************   S01464
     C***IF*CHARGE*CODE*NOT*BLANK**************************************   S01464
     C***********WWCGCO    IFNE *BLANKS                                   S01464
     C*****************************************************************   S01464
     C***SET*UP*REPORT*FIELDS*FOR*ACCOUNT*DETAIL*LINE******************   S01464
     C***ACCOUNT*CODE**************************************************   S01464
     C***********          MOVE WWACNT    RRACNT                          S01464
     C*****************************************************************   S01464
     C***INVESTMENT*TYPE***********************************************   S01464
     C***********          MOVE *BLANKS   RRIVTA                          S01464
     C*****************************************************************   S01464
     C***NOMINAL*CURRENCY**********************************************   S01464
     C***********          MOVE SGCCY     RRNMCA                          S01464
     C*****************************************************************   S01464
     C***NOMINAL*POSITION**********************************************   S01464
     C***********SGCLBL    IFLT 0                                         S01464
     C***********          Z-SUBSGCLBL    ZFLD15                          S01464
     C***********          ELSE                                           S01464
     C***********          Z-ADDSGCLBL    ZFLD15                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***********          Z-ADDA6NBDP    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRNPSA                          S01464
     C*****************************************************************   S01464
     C***SET*UP*CREDIT*DEBIT*INDICATOR*********************************   S01464
     C***********SGCLBL    IFLT 0                                         S01464
     C***********          MOVE 'CR'      RRDRCR                          S01464
     C***********          ELSE                                           S01464
     C***********          MOVE 'DR'      RRDRCR                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***MARKET*VALUE*IN*NOMINAL*CURRENCY******************************   S01464
     C***********          Z-ADDWWMVNC    ZFLD15                          S01464
     C***********          Z-ADDA6NBDP    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRMNCA                          S01464
     C*****************************************************************   S01464
     C***MARKET*VALUE*IN*BANK*CHARGING*CURRENCY************************   S01464
     C***********          Z-ADDWWMVBC    ZFLD15                          S01464
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRMCCA                          S01464
     C*****************************************************************   S01464
     C***FEE*CODE******************************************************   S01464
     C***********          MOVE WWCGCO    RRFECA                          S01464
     C*****************************************************************   S01464
     C***AMOUNT*ACCRUED*TODAY******************************************   S01464
     C***********          Z-ADDWWAAFA    ZFLD15                          S01464
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRAATA                          S01464
     C*****************************************************************   S01464
     C***WRITE*DETAIL*LINE*TO*REPORT***********************************   S01464
     C***********SGCLBL    IFNE 0                                  B05945 S01464
     C***********          WRITEDETAIL7                                   S01464
     C***********          END                                     B05945 S01464
     C*****************************************************************   S01464
     C***ADD*FEE*ACCRUED*IN*#P07*TO*'FEES*ACCRUED*TO*DATE'*AND*TO******   S01464
     C****'FEES*ACCRUED*TODAY'*****************************************   S01464
     C***********          ADD  WWAAFA    WWCFAC                          S01464
     C***********          ADD  WWAAFA    WWFACT                          S01464
     C*****************************************************************   S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***READ*NEXT*RECORD*ON*PF/SCPMABPD*******************************   S01464
     C***********          READ SCPMABPD                 53               S01464
     C*****************************************************************   S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C** ACCESS PF/SCSCFAPD WITH CUSTOMER AND PORTFOLIO REFERENCE TO      S01464
     C****SEE*IF*RECORD*EXISTS*****************************************   S01464
     C***********WWKEY1    CHAINSCSCFAPD             46                   S01464
     C*****************************************************************   S01464
     C***IF*RECORD*EXISTS*UPDATE*RECORD*ON*PF/SCSCFAPD*****************   S01464
     C************IN46     IFEQ '0'                                       S01464
     C*****************************************************************   S01464
     C***TYPE*OF*LAST*CHANGE*******************************************   S01464
     C***********          MOVE 'A'       SDCHTP                          S01464
     C*****************************************************************   S01464
     C***CUSTODY*FEE*ACCRUED*TO*DATE***********************************   S01464
     C***********          Z-ADDWWCFAC    SDCFAC                          S01464
     C*****************************************************************   S01464
     C***OUTSTANDING*ACCRUAL*ADJUSTMENT********************************   S01464
     C***********          Z-ADD*ZEROS    SDOSAJ                          S01464
     C*****************************************************************   S01464
     C***OUTSTANDING*ACCRUAL*ADJUSTMENT*SIGN***************************   S01464
     C***********          MOVE *BLANKS   SDOSAS                          S01464
     C*****************************************************************   S01464
     C***UPDATE*PF/SCSCFAPD********************************************   S01464
     C***********          UPDATSCSCFAP0                                  S01464
     C*****************************************************************   S01464
     C***********          ELSE                                           S01464
     C*****************************************************************   S01464
     C***IF*RECORD*DOES*NOT*EXIST*WRITE*RECORD*TO*PF/SCSCFAPD**********   S01464
     C*****************************************************************   S01464
     C***RECORD*ID*****************************************************   S01464
     C***********          MOVE 'D'       SDRECI                          S01464
     C*****************************************************************   S01464
     C***DAY*OF*LAST*UPDATE********************************************   S01464
     C***********          Z-ADDWWDAYU    SDDLUP                          S01464
     C*****************************************************************   S01464
     C***MONTH*OF*LAST*UPDATE******************************************   S01464
     C***********          MOVE WWMTHU    SDMLUP                          S01464
     C*****************************************************************   S01464
     C***YEAR*OF*LAST*UPDATE*******************************************   S01464
     C***********          Z-ADDWWYERU    SDYLUP                          S01464
     C*****************************************************************   S01464
     C***TIME*OF*LAST*UPDATE*******************************************   S01464
     C***********          TIME           SDTLUP                          S01464
     C*****************************************************************   S01464
     C***TYPE*OF*LAST*CHANGE*******************************************   S01464
     C***********          MOVE 'I'       SDCHTP                          S01464
     C*****************************************************************   S01464
     C***LAST*CHANGE*DATE**********************************************   S01464
     C***********          Z-ADDBJRDNB    SDLCD                           S01464
     C*****************************************************************   S01464
     C***TRANSACTION*NUMBER*OF*LAST*UPDATE*****************************   S01464
     C********             Z-ADD*ZEROS    SDTNLU
     C*****************************************************************   S01464
     C***RETRIEVE*NEXT*TRANSACTION*NUMBER******************************   S01464
     C*****************************************************************   S01464
     C***********          EXSR ZTNLU1                                    S01464
     C***********          MOVELNATN      SDTNLU                          S01464
     C*****************************************************************   S01464
     C***CUSTOMER*NUMBER***********************************************   S01464
     C***********          Z-ADDWWCNUM    SDCNUM                          S01464
     C*****************************************************************   S01464
     C***PORTFOLIO*REFERENCE*******************************************   S01464
     C***********          MOVE WWPTFR    SDPTFR                          S01464
     C*****************************************************************   S01464
     C***CUSTODY*FEE*ACCRUED*TO*DATE***********************************   S01464
     C***********          Z-ADDWWCFAC    SDCFAC                          S01464
     C*****************************************************************   S01464
     C***OUTSTANDING*ACCRUAL*ADJUSTMENT********************************   S01464
     C***********          Z-ADD*ZEROS    SDOSAJ                          S01464
     C*****************************************************************   S01464
     C***OUTSTANDING*ACCRUAL*ADJUSTMENT*SIGN***************************   S01464
     C***********          MOVE *BLANKS   SDOSAS                          S01464
     C*****************************************************************   S01464
     C***WRITE*RECORD*TO*PF/SCSCFAPD***********************************   S01464
     C***********          WRITESCSCFAP0                                  S01464
     C*****************************************************************   S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***IF*'FEE*ACCRUED*TODAY'*NOT*ZERO*CALL*#P10*********************   S01464
     C***********WWFACT    IFNE *ZEROS                                    S01464
     C***********          EXSR #P10                                      S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***OUTPUT*'FEES*ACCRUED*TO*DATE'*REPORT*LINE*********************   S01464
     C***********          Z-ADDWWCFAC    ZFLD15                          S01464
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C***********          MOVE 'J'       ZECODE                          S01464
     C***********          EXSR ZSEDIT                                    S01464
     C***********          MOVE ZOUT21    RRFATD                          S01464
     C***********          WRITEDETAIL5                                   S01464
     C*****************************************************************   S01464
     C***********          ENDSR                                          S01464
     C*                                                                   091522
     C           #P11      BEGSR                                          091522
     C*                                                                   091522
     C** CHECK VALUE OF 'CUSTODY FEE GROUP CODE' ON LF/PMPORTLL           091522
     C           FBFGCP    IFEQ 'Y'                                       091522
     C           WWPTFR    ANDNE'9997'                                    091522
     C                     MOVE PNCFGC    WWCFGC                          091522
     C                     ELSE                                           091522
     C                     MOVE BFCFGC    WWCFGC                          091522
     C                     END                                            091522
     C*                                                                   091522
     C** IF HEADINGS HAVE NOT JUST BEEN WRITTEN                           091522
     C           *IN30     IFEQ '0'                                       091522
     C*                                                                   091522
     C** MOVE VALUES FOR CUSTOMER HEADING INTO REPORT FIELDS              091522
     C                     MOVE BBCUST    RRCNM1                          091522
     C                     MOVE BBCRNM    RRSNM1                          091522
     C*                                                                   091522
     C                     ELSE                                           091522
     C*                                                                   091522
     C** RESET HEADINGS ALREADY WRITTEN INDICATOR                         091522
     C                     MOVE '0'       *IN30                           091522
     C                     END                                            091522
     C*                                                                   091522
     C** DECIDE PORTFOLIO REFERENCE TO BE USED IN CUSTOMER HEADING        091522
     C           WWPTFR    IFEQ '9997'                                    091522
     C                     MOVE FCR997    RRPNM1                          091522
     C                     MOVE FCN997    RRPSN1                          091522
     C                     ELSE                                           091522
     C                     MOVE PNPTFR    RRPNM1                          091522
     C                     MOVE PNPTFN    RRPSN1                          091522
     C                     END                                            091522
     C*                                                                   091522
     C** WRITE PORTFOLIO CUSTOMER HEADING                                 091522
     C                     MOVE WWCFGC    RRAFG1                          091522
     C*                                                                   091522
     C** IF HEADER 3 NECESSARY OR ACCOUNT OFFICER CHANGED                 091522
     C           *IN31     IFEQ '1'                                       091522
     C           BBACOC    ORNE WWACOC                                    091522
     C*                                                                   091522
     C** OUTPUT BANK CHARGING CURRENCY TO REPORT                          091522
     C                     MOVE WWBCGC    RRBCCY                          091522
     C                     MOVE WWBCGC    RRCCCY                          091522
     C                     WRITEHEADER3                                   091522
     C*                                                                   091522
     C** RESET HEADER 3 NECESSARY INDICATOR                               091522
     C                     MOVE '0'       *IN31                           091522
     C*                                                                   091522
     C** MOVE NEW ACCOUNT OFFICER CODE INTO WORK FIELD                    091522
     C                     MOVE BBACOC    WWACOC                          091522
     C*                                                                   091522
     C                     END                                            091522
     C** WRITE PORTFOLIO CUSTOMER HEADING                                 091522
     C                     WRITEDETAIL1                             R0131 091522
     C*                                                                   091522
     C** ACCESS PF/SCSCFAPD WITH CUSTOMER NUMBER AND PORTFOLIO REF.       091522
     C           WWKEY1    CHAINSESCFAPD             46                   091522
     C*                                                                   091522
     C** IF NO RECORD FOUND                                               091522
     C           *IN46     IFEQ '1'                                       091522
     C*                                                                   091522
     C** SET UP WORK FIELDS FOR 'FEE ACCRUED TO DATE', 'OUTSTANDING       091522
     C**  ACCRUAL ADJUSTMENT' AND 'OUTSTANDING ACCRUAL ADJUSTMENT SIGN'   091522
     C                     Z-ADD*ZEROS    WWCFAC                          091522
     C                     Z-ADD*ZEROS    WWOSAJ                          091522
     C                     MOVE *BLANKS   WWOSAS                          091522
     C                     ELSE                                           091522
     C*                                                                   091522
     C** SET UP WORK FIELDS WITH VALUES FROM FILE                         091522
     C                     Z-ADDSDCFAC    WWCFAC                          091522
     C                     Z-ADDSDOSAJ    WWOSAJ                          091522
     C                     MOVE SDOSAS    WWOSAS                          091522
     C                     END                                            091522
     C*                                                                   091522
     C** OUTPUT 'FEES ACCRUED TO TODAY' REPORT LINE                       091522
     C                     Z-ADDWWCFAC    ZFLD15                          091522
     C                     Z-ADDZCDPT     ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C                     MOVE ZOUT21    RRFATT                          091522
     C                     WRITEDETAIL3                                   091522
     C*                                                                   091522
     C** IF 'OUTSTANDING ACCRUAL ADJUSTMENTS' > 0 WRITE REPORT LINE       091522
     C           WWOSAJ    IFGT *ZEROS                                    091522
     C                     Z-ADDWWOSAJ    ZFLD15                          091522
     C                     Z-ADDZCDPT     ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C                     MOVE ZOUT21    RROUTA                          091522
     C*                                                                   091522
     C** OUTPUT 'OUTSTANDING ADJUSTMENT SIGN' TO REPORT                   091522
     C                     MOVE SDOSAS    RROTAS                          091522
     C                     WRITEDETAIL4                                   091522
     C*                                                                   091522
     C** UPDATE 'FEES ACCRUED TO DATE' AND GENERATE ACCRUAL ADJUSTMENT    091522
     C**  POSTINGS                                                        091522
     C                     EXSR #P05                                      091522
     C                     END                                            091522
     C*                                                                   091522
     C** ACCESS LF/SCPMPSLL WITH CUSTOMER NUMBER AND PORTFOLIO REF.       091522
     C           WWKEY5    SETLLSEPMPSL0             55                   091522
     C                     READ SEPMPSL0                 55               091522
     C*                                                                   091522
     C** DO WHILE RECORDS ON LF/SCPMPSLL FOR CUSTOMER AND PORTFOLIO       091522
     C           *IN55     DOWEQ'0'                                       091522
     C           WWCNUM    ANDEQQACNUM                                    091522
     C           WWPTFR    ANDEQQAPTFR                                    091522
     C*                                                                   091522
     C** MOVE 'SECURITY REFERENCE' INTO A WORK FIELD                      091522
     C                     MOVE QATDSS    WWCSSC                          091522
     C*                                                                   091522
     C** SET WORK FIELD FOR 'TOTAL VALUE DATE NOMINAL'                    091522
     C/COPY WNCPYSRC,SE6240C015
     C                     Z-ADDQANOML    WWTVDN 150                      091522
     C*                                                                   091522
     C** CALCULATE FEE TO BE ACCRUED FOR THIS SECURITY                    091522
     C                     EXSR #P06                                      091522
     C*                                                                   091522
     C** IF CHARGE CODE NOT BLANK                                         091522
     C           WWCGCO    IFNE *BLANKS                                   091522
     C*                                                                   091522
     C** SET UP REPORT FIELDS FOR SECURITY DETAIL LINE                    091522
     C** BRANCH CODE                                                      091522
     C                     MOVE *BLANKS   RRBRCA                          091522
     C** SECURITY REFERENCE                                               091522
     C                     MOVE WWCSSC    RRSCTY                          091522
     C*                                                                   091522
     C** INVESTMENT TYPE                                                  091522
     C                     MOVE SITP      RRIVTS                          091522
     C*                                                                   091522
     C** NOMINAL CURRENCY                                                 091522
     C                     MOVE NMCY      RRNMCS                          091522
     C*                                                                   091522
     C** NOMINAL POSITION                                                 091522
     C                     Z-ADDWWTVDN    ZFLD15                          091522
     C                     Z-ADDNMDP      ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C                     MOVE ZOUT21    RRNPSS                          091522
     C*                                                                   091522
     C** MARKET VALUE IN NOMINAL CURRENCY                                 091522
     C                     Z-ADDWWMVNC    ZFLD15                          091522
     C                     Z-ADDA6NBDP    ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C                     MOVE ZOUT21    RRMNCS                          091522
     C*                                                                   091522
     C** MARKET VALUE IN BANK CHARGING CURRENCY                           091522
     C                     Z-ADDWWMVBC    ZFLD15                          091522
     C                     Z-ADDZCDPT     ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C                     MOVE ZOUT21    RRMCCS                          091522
     C*                                                                   091522
     C** FEE CODE                                                         091522
     C                     MOVE WWCGCO    RRFECS                          091522
     C*                                                                   091522
     C** AMOUNT ACCRUED TODAY                                             091522
     C                     Z-ADDWWAAFS    ZFLD15                          091522
     C                     Z-ADDZCDPT     ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C/COPY WNCPYSRC,SE6240C016
     C                     MOVE ZOUT21    RRAATS                          091522
     C/COPY WNCPYSRC,SE6240C017
     C*                                                                   091522
     C** WRITE DETAIL LINE TO REPORT                                      091522
     C           QANOML    IFNE 0                                         091522
     C                     WRITEDETAIL6                                   091522
     C                     END                                            091522
     C*                                                                   091522
     C** ADD FEE ACCRUED IN #P06 TO 'FEES ACCRUED TO DATE' AND TO         091522
     C**  'FEES ACCRUED TODAY'                                            091522
     C                     ADD  WWAAFS    WWCFAC                          091522
     C                     ADD  WWAAFS    WWFACT                          091522
     C/COPY WNCPYSRC,SE6240C018
     C                     END                                            091522
     C*                                                                   091522
     C** READ NEXT RECORD ON LF/SEPMPSL0 WITH CUST NUMBER AND PORT.       091522
     C                     READ SEPMPSL0                 55               091522
     C*                                                                   091522
     C                     END                                            091522
     C*                                                                   091522
     C** ACCESS PF/SCPMABPD WITH CUST NUMBER AND PORTFOLIO REFERENCE      091522
     C                     MOVE *LOVAL    WWCCYP  3                       091522
     C           WWKEY3    SETLLSEPMABPD                                  091522
     C                     READ SEPMABPD                 53               091522
     C*                                                                   091522
     C** WHILE RECORDS EXIST FOR THIS CUSTOMER                            091522
     C           *IN53     DOWEQ'0'                                       091522
     C           WWCNUM    ANDEQSGCNUM                                    091522
     C           WWPTFR    ANDEQSGPTFR                                    091522
     C*                                                                   091522
     C** CALCULATE FEE TO BE ACCRUED FOR THIS ACCOUNT                     091522
     C                     EXSR #P07                                      091522
     C*                                                                   091522
     C** IF CHARGE CODE NOT BLANK                                         091522
     C           WWCGCO    IFNE *BLANKS                                   091522
     C*                                                                   091522
     C** SET UP REPORT FIELDS FOR ACCOUNT DETAIL LINE                     091522
     C** BRANCH CODE                                                      091522
     C                     MOVE SGBRCA    RRBRCA                          091522
     C** ACCOUNT CODE                                                     091522
     C                     MOVE WWACNT    RRACNT                          091522
     C*                                                                   091522
     C** INVESTMENT TYPE                                                  091522
     C                     MOVE *BLANKS   RRIVTA                          091522
     C*                                                                   091522
     C** NOMINAL CURRENCY                                                 091522
     C                     MOVE SGCCY     RRNMCA                          091522
     C*                                                                   091522
     C** NOMINAL POSITION                                                 091522
     C           SGCLBL    IFLT 0                                         091522
     C                     Z-SUBSGCLBL    ZFLD15                          091522
     C                     ELSE                                           091522
     C                     Z-ADDSGCLBL    ZFLD15                          091522
     C                     END                                            091522
     C*                                                                   091522
     C                     Z-ADDA6NBDP    ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C                     MOVE ZOUT21    RRNPSA                          091522
     C*                                                                   091522
     C** SET UP CREDIT DEBIT INDICATOR                                    091522
     C           SGCLBL    IFLT 0                                         091522
     C                     MOVE 'CR'      RRDRCR                          091522
     C                     ELSE                                           091522
     C                     MOVE 'DR'      RRDRCR                          091522
     C                     END                                            091522
     C*                                                                   091522
     C** MARKET VALUE IN NOMINAL CURRENCY                                 091522
     C                     Z-ADDWWMVNC    ZFLD15                          091522
     C                     Z-ADDA6NBDP    ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C                     MOVE ZOUT21    RRMNCA                          091522
     C*                                                                   091522
     C** MARKET VALUE IN BANK CHARGING CURRENCY                           091522
     C                     Z-ADDWWMVBC    ZFLD15                          091522
     C                     Z-ADDZCDPT     ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C                     MOVE ZOUT21    RRMCCA                          091522
     C*                                                                   091522
     C** FEE CODE                                                         091522
     C                     MOVE WWCGCO    RRFECA                          091522
     C*                                                                   091522
     C** AMOUNT ACCRUED TODAY                                             091522
     C                     Z-ADDWWAAFA    ZFLD15                          091522
     C                     Z-ADDZCDPT     ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C/COPY WNCPYSRC,SE6240C019
     C                     MOVE ZOUT21    RRAATA                          091522
     C/COPY WNCPYSRC,SE6240C020
     C*                                                                   091522
     C** WRITE DETAIL LINE TO REPORT                                      091522
     C           SGCLBL    IFNE 0                                         091522
     C                     WRITEDETAIL7                                   091522
     C                     END                                            091522
     C*                                                                   091522
     C** ADD FEE ACCRUED IN #P07 TO 'FEES ACCRUED TO DATE' AND TO         091522
     C**  'FEES ACCRUED TODAY'                                            091522
     C                     ADD  WWAAFA    WWCFAC                          091522
     C                     ADD  WWAAFA    WWFACT                          091522
     C/COPY WNCPYSRC,SE6240C021
     C*                                                                   091522
     C                     END                                            091522
     C*                                                                   091522
     C** READ NEXT RECORD ON PF/SEPMABPD                                  091522
     C                     READ SEPMABPD                 53               091522
     C*                                                                   091522
     C                     END                                            091522
     C*                                                                   091522
     C** ACCESS PF/SESCFAPD WITH CUSTOMER AND PORTFOLIO REFERENCE TO      091522
     C**  SEE IF RECORD EXISTS                                            091522
     C/COPY WNCPYSRC,SE6240C022
     C           WWKEY1    CHAINSESCFAPD             46                   091522
     C*                                                                   091522
     C** IF RECORD EXISTS UPDATE RECORD ON PF/SCSCFAPD                    091522
     C           *IN46     IFEQ '0'                                       091522
     C*                                                                   091522
     C** TYPE OF LAST CHANGE                                              091522
     C                     MOVE 'A'       SDCHTP                          091522
     C*                                                                   091522
     C** CUSTODY FEE ACCRUED TO DATE                                      091522
     C                     Z-ADDWWCFAC    SDCFAC                          091522
     C*                                                                   091522
     C** OUTSTANDING ACCRUAL ADJUSTMENT                                   091522
     C                     Z-ADD*ZEROS    SDOSAJ                          091522
     C*                                                                   091522
     C** OUTSTANDING ACCRUAL ADJUSTMENT SIGN                              091522
     C                     MOVE *BLANKS   SDOSAS                          091522
     C*                                                                   091522
     C** UPDATE PF/SESCFAPD                                               091522
     C                     UPDATSESCFAP0                                  091522
     C*                                                                   091522
     C                     ELSE                                           091522
     C*                                                                   091522
     C** IF RECORD DOES NOT EXIST WRITE RECORD TO PF/SCSCFAPD             091522
     C*                                                                   091522
     C** RECORD ID                                                        091522
     C                     MOVE 'D'       SDRECI                          091522
     C*                                                                   091522
     C** DAY OF LAST UPDATE                                               091522
     C                     Z-ADDWWDAYU    SDDLUP                          091522
     C*                                                                   091522
     C** MONTH OF LAST UPDATE                                             091522
     C                     MOVE WWMTHU    SDMLUP                          091522
     C*                                                                   091522
     C** YEAR OF LAST UPDATE                                              091522
     C                     Z-ADDWWYERU    SDYLUP                          091522
     C*                                                                   091522
     C** TIME OF LAST UPDATE                                              091522
     C                     TIME           SDTLUP                          091522
     C*                                                                   091522
     C** TYPE OF LAST CHANGE                                              091522
     C                     MOVE 'I'       SDCHTP                          091522
     C*                                                                   091522
     C** LAST CHANGE DATE                                                 091522
     C                     Z-ADDBJRDNB    SDLCD                           091522
     C*                                                                   091522
     C** RETRIEVE NEXT TRANSACTION NUMBER                                 091522
     C*                                                                   091522
     C                     EXSR ZTNLU1                                    091522
     C                     MOVELNATN      SDTNLU                          091522
     C*                                                                   091522
     C** CUSTOMER NUMBER                                                  091522
     C**********           Z-ADDWWCNUM    SDCNUM                                       091522 CSD027
     C                     MOVE WWCNUM    SDCNUM                                              CSD027
     C*                                                                   091522
     C** PORTFOLIO REFERENCE                                              091522
     C                     MOVE WWPTFR    SDPTFR                          091522
     C*                                                                   091522
     C** CUSTODY FEE ACCRUED TO DATE                                      091522
     C                     Z-ADDWWCFAC    SDCFAC                          091522
     C*                                                                   091522
     C** OUTSTANDING ACCRUAL ADJUSTMENT                                   091522
     C                     Z-ADD*ZEROS    SDOSAJ                          091522
     C*                                                                   091522
     C** OUTSTANDING ACCRUAL ADJUSTMENT SIGN                              091522
     C                     MOVE *BLANKS   SDOSAS                          091522
     C*                                                                   091522
     C** BRANCH CODE                                                      091522
     C                     MOVE WWBRCH    SDBRCA                          091522
     C*                                                                   091522
     C** WRITE RECORD TO PF/SESCFAPD                                      091522
     C                     WRITESESCFAP0                                  091522
     C*                                                                   091522
     C                     END                                            091522
     C*                                                                   091522
     C** IF 'FEE ACCRUED TODAY' NOT ZERO CALL #P10                        091522
     C           WWFACT    IFNE *ZEROS                                    091522
     C                     EXSR #P10                                      091522
     C                     END                                            091522
     C/COPY WNCPYSRC,SE6240C023
     C*                                                                   091522
     C** OUTPUT 'FEES ACCRUED TO DATE' REPORT LINE                        091522
     C                     Z-ADDWWCFAC    ZFLD15                          091522
     C                     Z-ADDZCDPT     ZDECS                           091522
     C                     MOVE 'J'       ZECODE                          091522
     C                     EXSR ZSEDIT                                    091522
     C                     MOVE ZOUT21    RRFATD                          091522
     C                     WRITEDETAIL5                                   091522
     C*                                                                   091522
     C                     ENDSR                                          091522
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           #P12      BEGSR
     C*
     C** SET UP FIELDS FOR OUTPUT TO TRAILER FILE GESCZZ
     C                     MOVE 'T'       RECI
     C                     Z-ADDWWNUMR    NORE1
     C                     ADD  2         NORE1                           S01464
     C           WWTOTP    DIV  1000      HRWN
     C                     MVR            HRDC
     C*
     C** WRITE RECORD TO TRAILER FILE GESCZZ
     C                     WRITEAPOSTZZF
     C*
     C** OUTPUT RUN CONTROLS REPORT
     C                     WRITEHEADER
     C                     Z-ADDWWNUMR    RRPROG
     C                     WRITEDETAILA
     C***********          WRITEFOOTING                                   S01464
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT                                                              083825
     C*****************************************************************   083825
     C*                                                               *   083825
     C* #WRTHD  -  Write the appropiate header and subheader          *   083825
     C*                                                               *   083825
     C* Called by: #P03                                               *   083825
     C* Calls    : None                                               *   083825
     C*                                                               *   083825
     C*****************************************************************   083825
     C*                                                                   083825
     C           #WRTHD    BEGSR                                          083825
     C*                                                                   083825
     C                     WRITEHEADER1                                   083825
     C                     WRITEHEADER2                                   083825
     C                     WRITEHEADER3                                   083825
     C           FBCFCP    IFEQ 'C'                                       083825
     C                     WRITEDETAIL2                                   083825
     C                     END                                            083825
     C*                                                                   083825
     C                     ENDSR                                          083825
     C********************************************************************083825
     C/EJECT
     C********************************************************************
     C*
     C           #ZA       BEGSR
     C*
     C                     WRITEHEADER
     C                     WRITEDBERROR
     C***********          WRITEFOOTING                                   S01464
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           *PSSR     BEGSR
     C                     DUMP
     C           #PSSR0    ENDSR
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C*/COPY ZSRSRC,ZPMCRG
     C**************************************************************************
     C*                                                                        *
     C*  ZPMCRG SR. TO CALCULATE PORTFOLIO MANAGEMENT CHARGES                  *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C********ZAMT***150*****PRINCIPAL*AMOUNT**************************   S01464
     C*       ZAMT   110     Principal Amount                         *   S01464
     C*       ZDYBS   10     DAY BASIS                                         *
     C*       ZDVBS   10     DIVISOR BASIS                                     *
     C*       ZFMDAT  50     FROM DATE                                         *
     C*       ZTODAT  50     TO DATE                                           *
     C*       ZSPRD  130     EFFECTIVE CHARGE SPREAD                           *
     C*       ZSPRI   1      EFFECTIVE CHARGE SPREAD INDICATOR                 *
     C*       ZCGBS   1      CHARGE BASIS                                      *
     C*       ZCGMT   1      CHARGING METHOD                                   *
     C*       ZMINC  150     MINIMUM CHARGE AMOUNT                             *
     C*       ZRA    150x14  RANGE UPPER LIMITS                                *
     C*       ZPC    117x15  PERCENTAGES                                       *
     C*       ZCG    150x15  FLAT CHARGE AMOUNTS                               *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZCHGA  150     TOTAL CHARGE AMOUNT                               *
     C*                                                                        *
     C*  CALLS: ZDYYR                                                          *
     C*         ZDAYS                                                          *
     C**************************************************************************
     C*
     C           ZPMCRG    BEGSR                           *** ZPMCRG ***
     C*
     C** DEFINE ALL FIELDS
     C                     Z-ADD*ZEROS    NCD     50
     C                     MOVE *BLANKS   DVBS    1
     C                     MOVE *BLANKS   DYBS    1
     C                     Z-ADD*ZEROS    MATY    50
     C                     Z-ADD*ZEROS    LCPN    50
     C                     Z-ADD*ZEROS    ITLD    50
     C*********************Z-ADD*ZEROS    IADJ    50
     C                     Z-ADD*ZEROS    WIADJ   50       **RENAMED 23/10/90**
     C***********          Z-ADDZAMT      ZAMT   150                      S01464
     C                     Z-ADDZAMT      ZAMT                            S01464
     C                     Z-ADDZDYBS     ZDYBS   10
     C                     Z-ADDZDVBS     ZDVBS   10
     C                     Z-ADDZFMDAT    ZFMDAT  50
     C                     Z-ADDZTODAT    ZTODAT  50
     C                     Z-ADDZSPRD     ZSPRD  130
     C                     MOVE ZSPRI     ZSPRI   1
     C                     MOVE ZCGBS     ZCGBS   1
     C                     MOVE ZCGMT     ZCGMT   1
     C                     Z-ADDZMINC     ZMINC  150
     C                     Z-ADD*ZEROS    ZCHGA  150
     C                     Z-ADD*ZEROS    ZZ      20
     C                     MOVEAZRA       ZRB
     C                     Z-ADD*HIVAL    ZRB,15
     C                     MOVE *BLANKS   ZFLAG   1
     C*
     C** DETERMINE THE NUMBER OF CHARGE DAYS
     C*
     C                     Z-ADDZFMDAT    ZSDATE
     C                     Z-ADDZTODAT    ZEDATE
     C                     MOVE ZDYBS     DYBS
     C** PROCESS SUB-ROUTINE
     C                     EXSR ZDAYS
     C*
     C                     Z-ADDZDDAYS    ZNOCD   50
     C*
     C** DETERMINE THE NUMBER OF DAYS IN THE CHARGE YEAR
     C*
     C                     Z-ADDZFMDAT    NCD
     C                     MOVE ZDVBS     DVBS
     C                     Z-ADDZTODAT    MATY
     C                     Z-ADD*ZEROS    LCPN
     C                     Z-ADD*ZEROS    ITLD
     C                     MOVE *BLANKS   CR
     C** PROCESS SUB-ROUTINE
     C                     EXSR ZDYYR
     C*
     C                     Z-ADDZINTDD    ZNOCY   50
     C*
     C** CHECK IF CHARGE BASIS (ZCGBS) IS 'F' (FLAT)
     C*
     C           ZCGBS     IFEQ 'F'                        - B1
     C*
     C** DO UNTIL FLAG IS 'Y'
     C*
     C           ZFLAG     DOUEQ'Y'                        - B2
     C                     ADD  1         ZZ
     C*
     C** CHECK INDEX
     C*
     C           ZZ        IFEQ 15                         - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF PRINCIPAL AMOUNT IS LESS EQUAL THAN RANGE UPPER LIMITS
     C*
     C           ZAMT      IFLE ZRB,ZZ                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF RANGE UPPER LIMITS IS ZERO
     C*
     C           ZRB,ZZ    IFEQ *ZEROS                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C** SET THE TOTAL CHARGE AMOUNT (ZCHGA) TO FLAT CHARGE AMOUNTS
     C*
     C                     Z-ADDZCG,ZZ    ZCHGA
     C*
     C** CHECK IF THE CHARGE SPREAD INDICATOR IS '+' OR '-'
     C*
     C           ZSPRI     IFEQ '+'                        - B2
     C                     ADD  ZSPRD     ZCHGA
     C                     ELSE                            - X2
     C                     SUB  ZSPRD     ZCHGA
     C                     END                             - E2
     C*
     C** MULTIPLY TOTAL CHARGE AMOUNT BY NUMBER OF CHARGE DAYS
     C*
     C           ZCHGA     MULT ZNOCD     ZCHGA
     C*
     C** DIVIDE TOTAL CHARGE AMOUNT BY NUMBER OF DAYS IN THE CHARGE YEAR
     C*
     C           ZCHGA     DIV  ZNOCY     ZCHGA     H
     C*
     C                     END                             - E1
     C*
     C** CHECK IF CHARGE BASIS (ZCGBS) IS 'P' (PERCENTAGE) AND THE CHARGING
     C** METHOD IS 'T' (THRESHOLD)
     C*
     C           ZCGBS     IFEQ 'P'                        - B1
     C           ZCGMT     ANDEQ'T'
     C*
     C** DO UNTIL FLAG IS 'Y'
     C*
     C           ZFLAG     DOUEQ'Y'                        - B2
     C                     ADD  1         ZZ
     C*
     C** CHECK INDEX
     C*
     C           ZZ        IFEQ 15                         - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF PRINCIPAL AMOUNT IS LESS EQUAL THAN RANGE UPPER LIMITS
     C*
     C           ZAMT      IFLE ZRB,ZZ                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF RANGE UPPER LIMITS IS ZERO
     C*
     C           ZRB,ZZ    IFEQ *ZEROS                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C** SET THE CHARGE RATE (ZCGRT) EQUAL TO PERCENTAGE
     C*
     C                     Z-ADDZPC,ZZ    ZCGRT  117
     C*
     C** MOVE THE EFFECTIVE CHARGE SPREAD (ZSPRD) INTO THE ADJUSTED
     C** CHARGE SPREAD (ZACSD)
     C*
     C                     MOVE ZSPRD     ZACSD  117
     C*
     C** CHECK IF THE CHARGE SPREAD INDICATOR IS '+' OR '-'
     C*
     C           ZSPRI     IFEQ '+'                        - B2
     C                     ADD  ZACSD     ZCGRT
     C                     ELSE                            - X2
     C                     SUB  ZACSD     ZCGRT
     C                     END                             - E2
     C*
     C** DIVIDE THE PRINCIPAL AMOUNT BY 100 AND PUT THE RESULT IN A WORK
     C** FIELD (ZZ152)
     C*
     C           ZAMT      DIV  100       ZZ152  152H
     C*
     C** MULTIPLY THIS WORK FIELD BY NUMBER OF CHARGE DAYS AND PUT THE
     C** RESULT IN A WORK FIELD (ZZ154)
     C*
     C           ZZ152     MULT ZNOCD     ZZ154  154
     C*
     C** DIVIDE TOTAL CHARGE AMOUNT BY NUMBER OF DAYS IN THE CHARGE YEAR
     C*
     C           ZZ154     DIV  ZNOCY     ZZ154     H
     C*
     C** MULTIPLY THIS WORK FIELD BY THE CHARGE RATE (ZCGRT)
     C*
     C           ZZ154     MULT ZCGRT     ZCHGA
     C*
     C           ZMINC     MULT ZNOCD     ZMINC
     C           ZMINC     DIV  ZNOCY     ZMINC     H
     C*
     C           ZCHGA     IFLT ZMINC
     C                     Z-ADDZMINC     ZCHGA
     C                     END
     C*
     C                     END                             - E1
     C*
     C** CHECK IF CHARGE BASIS (ZCGBS) IS 'P' (PERCENTAGE) AND THE CHARGING
     C** METHOD IS 'X' (TIERED)
     C*
     C           ZCGBS     IFEQ 'P'                        - B1
     C           ZCGMT     ANDEQ'X'
     C*
     C** DO UNTIL FLAG IS 'Y'
     C*
     C           ZFLAG     DOUEQ'Y'                        - B2
     C                     ADD  1         ZZ
     C*
     C** CHECK INDEX
     C*
     C           ZZ        IFEQ 15                         - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF PRINCIPAL AMOUNT IS LESS EQUAL THAN RANGE UPPER LIMITS
     C*
     C           ZAMT      IFLE ZRB,ZZ                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** CHECK IF RANGE UPPER LIMITS IS ZERO
     C*
     C           ZRB,ZZ    IFEQ *ZEROS                     - B3
     C                     MOVE 'Y'       ZFLAG
     C                     END                             - E3
     C*
     C** SET THE CHARGE RATE (ZCGRT) EQUAL TO PERCENTAGE
     C*
     C                     Z-ADDZPC,ZZ    ZCGRT
     C*
     C** MOVE THE EFFECTIVE CHARGE SPREAD (ZSPRD) INTO THE ADJUSTED
     C** CHARGE SPREAD (ZACSD)
     C*
     C                     MOVE ZSPRD     ZACSD
     C*
     C** CHECK IF THE CHARGE SPREAD INDICATOR IS '+' OR '-'
     C*
     C           ZSPRI     IFEQ '+'                        - B3
     C                     ADD  ZACSD     ZCGRT
     C                     ELSE                            - X3
     C                     SUB  ZACSD     ZCGRT
     C                     END                             - E3
     C*
     C** IF THE PRINCIPAL AMOUNT IS GREATER THAN RANGE UPPER LIMITS
     C*
     C           ZAMT      IFGT ZRB,ZZ                     - B3
     C           ZRB,ZZ    ANDNE*ZEROS
     C*
     C** CHECK THE INDEX
     C*
     C           ZZ        IFEQ 1                          - B4
     C*
     C** IF INDEX IS 1 PUT THE RANGE UPPER LIMITS IN A WORK FIELD ZZ152
     C*
     C                     Z-ADDZRB,ZZ    ZZ152  152
     C*
     C                     ELSE                            - X4
     C*
     C** OTHERWISE CALCULATE THE DIFFERENCE BETWEEN THE TWO LIMITS
     C*
     C           ZZ        SUB  1         Z2      20
     C           ZRB,ZZ    SUB  ZRB,Z2    ZZ152
     C                     END                             - E4
     C*
     C                     ELSE                            - X3
     C*
     C** IF THE PRINCIPAL AMOUNT IS LESS OR EQUAL THAN RANGE UPPER LIMITS
     C*
     C*
     C** CHECK THE INDEX
     C*
     C           ZZ        IFEQ 1                          - B4
     C*
     C** IF INDEX IS 1 PUT THE RANGE UPPER LIMITS IN A WORK FIELD ZZ152
     C*
     C                     Z-ADDZAMT      ZZ152
     C*
     C                     ELSE                            - X4
     C*
     C** OTHERWISE CALCULATE THE DIFFERENCE BETWEEN THE TWO LIMITS
     C*
     C           ZZ        SUB  1         Z2      20
     C           ZAMT      SUB  ZRB,Z2    ZZ152
     C                     END                             - E4
     C*
     C                     END                             - E3
     C*
     C** DIVIDE ZZ152 BY 100
     C*
     C           ZZ152     DIV  100       ZZ152     H
     C*
     C** MULTIPLY ZZ152 BY THE NUMBER OF CHARGE DAYS AND PUT THE RESULT
     C** IN A WORK FIELD (ZZ154)
     C*
     C           ZZ152     MULT ZNOCD     ZZ154  154
     C*
     C** DIVIDE THIS WORK FIELD (ZZ154) BY THE NUMBER OF DAYS IN THE
     C** CHARGE YEAR (ZNOCY)
     C*
     C           ZZ154     DIV  ZNOCY     ZZ154     H
     C*
     C**MULTIPLY THIS WORK FIELD ZZ154 BY THE CHARGE RATE (ZCGRT)
     C*
     C           ZZ154     MULT ZCGRT     ZZ154
     C*
     C** ADD THIS WORK FIELD ZZ154 TO THE TOTAL CHARGE AMOUNT (ZCHGA)
     C*
     C                     ADD  ZZ154     ZCHGA
     C*
     C           ZMINC     MULT ZNOCD     ZMINC
     C           ZMINC     DIV  ZNOCY     ZMINC     H
     C*
     C           ZCHGA     IFLT ZMINC
     C                     Z-ADDZMINC     ZCHGA
     C                     END
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR                           ** ZPMCRG ESR**
     C********************************************************************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*/COPY ZSRSRC,ZSEDITZ3
     C********************************************************************
     C********************************************************************
     C**                                                                 *
     C** ZSEDIT subroutine to insert a decimal point and sign into a     *
     C** numeric field and to blank out leading zeros (optionaly         *
     C** inserting commas).                                              *
     C**     Input fields:   ZFLD15 15/0                                 *
     C**                     ZDECS  1/0                                  *
     C**                     ZECODE 1/  ('J', 'L' or blank)              *
     C**                                                                 *
     C**     Arrays:         ZS1    15/1/0                               *
     C**                     ZS2    21/1/                                *
     C**                                                                 *
     C**     Output fields:  ZOUT21 21                                   *
     C**                                                                 *
     CSR         ZSEDIT    BEGSR                           **  ZSEDIT   *
     C*
     C* Define/Clear fields
     C*
     C                     Z-ADDZFLD15    ZFLD15 150
     C                     Z-ADDZDECS     ZDECS   10
     C                     MOVE ZECODE    ZECODE  1
     C                     MOVE *BLANKS   ZOUT21 21
     C*
     C*       SET UP WORK FIELDS
     C*
     C                     Z-ADD0         ZS1
     C                     MOVE ' '       ZS2
     C*
     C                     Z-ADD15        Z1      20
     C                     Z-ADD20        Z2      20
     C*
     C           15        SUB  ZDECS     ZINTS   20
     C*
     C* Check if numeric field is negative
     C*
     C           ZFLD15    IFLT *ZEROS
     C                     MOVE '-'       ZS2,21
     C                     Z-SUBZFLD15    ZFLD15
     C                     END
     C*
     C                     Z-ADDZFLD15    WORK15
     C*
     C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES
     C*
     C           ZDECS     CABEQ0         ZS10
     C*
     C*       SET UP DECIMALS
     C*
     C                     Z-ADD*ZEROS    ZCNT    10
     C           ZCNT      DOUEQZDECS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z2
     C                     ADD  1         ZCNT
     C                     SUB  1         Z1
     C                     END
     C*
     C*       PUT IN DECIMAL PLACE
     C*
     C                     MOVE '.'       ZS2,Z2
     C                     SUB  1         Z2
     C*
     C           ZS10      TAG                             ** ZS10 TAG **
     C*
     C*       SET UP INTEGERS
     C*
     C                     Z-ADD*ZEROS    CNT3    10
     C           Z1        DOUEQ*ZEROS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z1
     C                     SUB  1         Z2
     C*
     C* If edit code is 'J', insert a ',' before each group of three
     C* digits - not if beginning of array reached.
     C*
     C           Z2        IFGT *ZEROS
     C           ZECODE    ANDEQ'J'
     C                     ADD  1         CNT3
     C           CNT3      IFEQ 3
     C                     MOVE ','       ZS2,Z2
     C                     SUB  1         Z2
     C                     Z-ADD*ZEROS    CNT3
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*       PUT IN LEADING BLANKS
     C*
     C                     Z-ADD1         Z2
     C           ZS2,Z2    DOWEQ'0'
     C           ZS2,Z2    OREQ ' '
     C           ZS2,Z2    OREQ ','
     C                     MOVE ' '       ZS2,Z2
     C                     ADD  1         Z2
     C           Z2        CABEQ22        ZS20
     C                     END
     C*
     C*       IF NO INTEGERS PUT IN LEADING ZERO
     C*
     C           ZS20      TAG                             ** ZS20 TAG **
     C*
     C           Z2        IFEQ 22
     C                     SUB  2         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     ELSE
     C*
     C           ZS2,Z2    IFEQ '.'
     C                     SUB  1         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     END
     C                     END
     C*
     C*       SET UP OUTPUT FIELD
     C*
     C                     MOVEAZS2       ZOUT21
     C*
     CSR                   ENDSR
     C*****************************************************************
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*/COPY ZSRSRC,ZAPNUM
     C**************************************************************************
     C*                                                                        *
     C*  ZAPNUM - CALCULATE AP NUMERATOR                                       *
     C*                                                                        *
     C*  PURPOSE : TO MULTIPLY A NOMINAL POSITION BY THE PRICE OF THE          *
     C*  POSITION TO GIVE A VALUE OF THE POSITION WITH THE CORRECT NUMBER      *
     C*  OF DECIMAL PLACES FOR THE NOMINAL CURRENCY                            *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C********ZNOML**11*0*****NOMINAL**********************************   S01464
     C*       ZNOML  15 0     Nominal                                 *   S01464
     C*       ZAVPR  15 8     AVERAGE PRICE                                    *
     C*       ZNMDP   1 0     NOMINAL DECIMAL PLACES (0-4)                     *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3)            *
     C*       ZPRCB   1 A     PRICE BASIS (P/U)                                *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZVALU  15 0     VALUE                                            *
     C*                                                                        *
     C*  ALSO REQUIRED                                                         *
     C*       POWER8 ARRAY OF MULTIPLYING FACTORS FOR NOMINAL DECIMAL PLACES   *
     C*                                                                        *
     C*  WORK FIELDS:                                                          *
     C*       ZVAL0  15 0 - AVERAGE PRICE WITH 0 DECIMAL PLACES                *
     C*       ZVAL1  15 1 - --------------- '' ----------------                *
     C*       ZVAL2  15 2 - --------------- '' ----------------                *
     C*       ZVAL3  15 3 - --------------- '' ----------------                *
     C*       ZI      1 0 - POWER ARRAY                                        *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                        *
     C*************************************************************************
     C           ZAPNUM    BEGSR                           *** ZAPNUM ***
     C*
     C** DEFINE ALL FIELDS
     C***********          Z-ADDZNOML     ZNOML  110                      S01464
     C                     Z-ADDZNOML     ZNOML                           S01464
     C                     Z-ADDZAVPR     ZAVPR  158
     C                     Z-ADDZNMDP     ZNMDP   10
     C                     Z-ADDZNMCD     ZNMCD   10
     C                     MOVE ZPRCB     ZPRCB   1
     C                     Z-ADDZVALU     ZVALU  150
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 0
     C           ZNMCD     IFEQ 0
     C           ZNOML     MULT ZAVPR     ZVAL0  150H
     C                     MOVE ZVAL0     ZVALU
     C                     END
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 1
     C           ZNMCD     IFEQ 1
     C           ZNOML     MULT ZAVPR     ZVAL1  151H
     C                     MOVE ZVAL1     ZVALU
     C                     END
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 2
     C           ZNMCD     IFEQ 2
     C           ZNOML     MULT ZAVPR     ZVAL2  152H
     C                     MOVE ZVAL2     ZVALU
     C                     END
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 3
     C           ZNMCD     IFEQ 3
     C           ZNOML     MULT ZAVPR     ZVAL3  153H
     C                     MOVE ZVAL3     ZVALU
     C                     END
     C*
     C** SET INDEX ZI EQUAL TO 5 -. NOMINAL DECIMAL PLACES )
     C           5         SUB  ZNMDP     ZI      10
     C*
     C** MULTIPLY ZVALU BY  POWER8,ZI TO GET AMOUNT WITH NOMINAL DECIMAL PLACES
     C           ZVALU     MULT POWER8,ZI ZVALU
     C*
     C** PRICE BASIS IF = PERCENTAGE
     C           ZPRCB     IFEQ 'P'
     C           ZVALU     DIV  100       ZVALU     H
     C                     END
     C*
     C                     ENDSR
     C*************************************************************************
     C********************************************************************
     C/EJECT
     C/COPY ZSRSRC,ZDAYSZ2                                                100125
     C/EJECT                                                              100125
     C/COPY ZSRSRC,ZDYYRZ3                                                100125
     C/EJECT                                                              100125
     C/COPY ZSRSRC,ZDATE1Z2                                               100125
     C/EJECT                                                              100125
     C/COPY ZSRSRC,ZDATE2Z2                                               100125
     C/EJECT                                                              100125
     C********************************************************************
     C**==================================================================S01464
     C**  ZLCRD      :       TO COMPUTE LAST ACCRUAL DATE BASED ON        S01464
     C**                     CURRENT ACCRUAL DATE AND ACCRUAL FREQUENCY   S01464
      ** CALLED FROM :       #INIT                                        S01464
      ** CALLS       :       ZDATE2                                       S01464
     C*===================================================================S01464
     C           ZLCRD     BEGSR                           *** ZLCRD ***  S01464
     C**                                                                  S01464
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.                           S01464
     C                     MOVE FBAFRQ    ZFREQ   1                       S01464
     C                     Z-ADDFBCCRD    ZDAYNO  50                      S01464
     C                     Z-ADDFBADYM    ZMDAY   20                      S01464
     C**                                                                  S01464
     C**   CONVERT DAY NUMBER TO DATE.                                    S01464
     C                     EXSR ZDATE2                                    S01464
      *                                                                   S01464
      ** If the day number input (zmday ) is zero set it equal to the     S01464
      ** day number of the current accrual date.                          S01464
      *                                                                   S01464
     C           ZMDAY     IFEQ 0                                         S01464
     C*                                                                   S01464
     C                     MOVELZADATE    ZZWRK2  2                       S01464
     C                     MOVE ZZWRK2    ZMDAY                           S01464
     C*                                                                   S01464
     C                     END                                            S01464
     C**                                                                  S01464
     C/COPY WNCPYSRC,SE6240C025
     C**   CHECK FOR AND DECREMENT FOR CODE W-WEEKLY.                     S01464
     C           ZFREQ     IFEQ 'W'                                       S01464
     C           ZDAYNO    SUB  7         ZDAYNO                          S01464
     C                     GOTO ZLEND                                     S01464
     C                     END                                            S01464
     C**                                                                  S01464
     C**   CHECK FOR AND DECREMENT FOR CODE M-MONTHLY.                    S01464
     C           ZFREQ     IFEQ 'M'                                       S01464
     C                     Z-ADDZMDAY     ZDAY                            S01464
     C           ZMTH      SUB  1         ZMTH         9090               S01464
     C   90      12        ADD  ZMTH      ZMTH                            S01464
     C   90      ZYEAR     SUB  1         ZYEAR                           S01464
     C                     END                                            S01464
     C**                                                                  S01464
     C**   CHECK FOR AND DECREMENT FOR CODE Q-QUARTERLY.                  S01464
     C           ZFREQ     IFEQ 'Q'                                       S01464
     C                     Z-ADDZMDAY     ZDAY                            S01464
     C           ZMTH      SUB  3         ZMTH         9090               S01464
     C   90      12        ADD  ZMTH      ZMTH                            S01464
     C   90      ZYEAR     SUB  1         ZYEAR                           S01464
     C                     END                                            S01464
     C**                                                                  S01464
     C**   CHECK FOR AND DECREMENT FOR CODE X-SIX MONTHLY.                S01464
     C           ZFREQ     IFEQ 'X'                                       S01464
     C                     Z-ADDZMDAY     ZDAY                            S01464
     C           ZMTH      SUB  6         ZMTH         9090               S01464
     C   90      12        ADD  ZMTH      ZMTH                            S01464
     C   90      ZYEAR     SUB  1         ZYEAR                           S01464
     C                     END                                            S01464
     C**                                                                  S01464
     C**   CHECK FOR AND DECREMENT FOR CODE Y-YEARLY.                     S01464
     C           ZFREQ     IFEQ 'Y'                                       S01464
     C                     Z-ADDZMDAY     ZDAY                            S01464
     C           ZYEAR     SUB  1         ZYEAR                           S01464
     C                     END                                            S01464
     C**                                                                  S01464
     C**   REFORMAT DATE AND ENSURE VALID.                                S01464
     C**
     C**   CHECK FOR LEAP YEAR.
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10
     C**                                                                  S01464
     C**   VALIDATE DAY NUMBER.                                           S01464
     C                     MOVE ZFMD,ZMTH ZWRK2   20                      S01464
     C           ZMTH      IFEQ 2                                         S01464
     C           ZLY       ANDEQ0                                         S01464
     C           ZDAY      ANDGT29                                        S01464
     C                     Z-ADD29        ZWRK2                           S01464
     C                     END
     C**
     C           ZDAY      IFGT ZWRK2
     C                     Z-ADDZWRK2     ZDAY
     C                     END
     C**
     C**   REFORMAT DATE, DDMMYY OR MMDDYY, AND CONVERT TO DAY NUMBER.
     C                     MOVELZDAY      ZWRK4   40
     C                     MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C   98                MOVE ZDAY      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C                     EXSR ZDATE1
     C**
     C           ZLEND     ENDSR                           * ZFEND ENDSR *
      /EJECT
     C**========================================================================
     C**  ZTNLU1     :       TO LOCK THE TRANSACTION NUMBER DATA AREA,
     C**                     ACCESS THE NEXT AVAILABLE TRANSACTION NUMBER,
     C**                     THEN UPDATE AND RELEASE THE DATA AREA.
      ** CALLED FROM :       #P1005
      ** CALLS       :
     C*=========================================================================
     C           ZTNLU1    BEGSR                            ** ZTNLU1 BSR**
     C*
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN    50
     C                     MOVE FNATN     ZZWK05  50
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C*
     C                     ENDSR                            ** ZTNLU1 ESR**
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                   B05945
     C*  ZPRCI - SUBROUTINE TO OUTPUT PRICE AS %PRICE                     B05945
     C*                                                                   B05945
     C*  INPUT  - ZPRCIN (15,8) PRICE IN AS PRICE/DISC/YIELD              B05945
     C*           ZFDATE (5,0) FROM DATE                                  B05945
     C*           STBS (1) TRADE BASIS FROM SECURITY                      B05945
     C*           MATY (5,0) MATURITY DATE FROM SECURITY                  B05945
     C*           SYBS (1) YIELD BASIS FROM SECURITY                      B05945
     C*                                                                   B05945
     C*  OUTPUT - ZPRCOT (15,8) OUTPUT PRICE AS PERCENTAGE                B05945
     C*                                                                   B05945
     C*  CALLS  - ZDAYS (ZDATE2)                                          B05945
     C*           ZDYYR (ZDAYS)                                           B05945
     C*           ZYLDI                                                   B05945
     C*                                                                   B05945
     C******************************************************************  B05945
     C*                                                                   B05945
      /EJECT                                                              B05945
     C/COPY ZSRSRC,ZPRCIZ1                                                B05945
     C*****************************************************************   B05945
     C*                                                                   B05945
     C*  ZYLDI - SUBROUTINE TO OUTPUT YIELD AS PERCENTAGE PRICE           B05945
     C*                                                                   B05945
     C*  INPUT  - ZPRCIN (15,8) INPUT PRICE AS YIELD                      B05945
     C*                                                                   B05945
     C*  OUTPUT - ZYLDOT (15,8) PRICE AS PERCENTAGE                       B05945
     C*                                                                   B05945
     C*****************************************************************   B05945
     C*                                                                   B05945
      /EJECT                                                              B05945
     C/COPY ZSRSRC,ZYLDIZ1                                                B05945
     C*                                                                   B05945
     C/COPY ZSRSRC,ZYLDZ2                                                 B05945
     C*                                                                   B05945
     C********************************************************************
     C*    SUBROUTINE- ZNCD
     C*    DETERMINE NEXT COUPON DATE
     C*
     C**
     C**  INPUT - CD ARRAY - COUPON DATES - SECTYD SECURITY FILE
     C**          CR ARRAY - RATE/PAYT INDICS - SECTYD SECURITY FILE
     C**          FCPN - FIRST COUPON DATE - SECTYD SECURITY FILE
     C**          MATY - MATURITY DATE - SECTYD SECURITY FILE
     C**          ECD - EVENT CONTROL DTAE - ZEVCD PROCESS
     C**          *IN98 - DATE FORMAT - FROM TABTB10 RECORD VIA ZSYSTM
     C**
     C**  OUTPUT - NCD (5,0) - NEXT COUPON DATE
     C**
     C**  CALLS  - ZDATE2
     C*
     C********************************************************************
     C*
     C/COPY ZSRSRC,ZNCDZ3
     C*****************************************************************   E20380
     C**                                                             **   E20380
     C** ZLCD   - Subroutine to calculate the Last Coupon Date prior **   E20380
     C**          to an Event Control Date (For Example: the Value   **   E20380
     C**          Date of a Trade).                                  **   E20380
     C**                                                             **   E20380
     C** INPUT - CD ARRAY - Coupon Dates from PF/SECTYD              **   E20380
     C**         CR ARRAY - Rate/Payment indicators from PF/SECTYD   **   E20380
     C**         ITLD   (5,0) Initial Date from PF/SECTYD            **   E20380
     C**         FCPN   (5,0) First Coupon Date from PF/SECTYD       **   E20380
     C**         ZECD   (5,0) Event Control Date                     **   E20380
     C**         *IN98        Date Format from PF/TABTB10            **   E20380
     C**                                                             **   E20380
     C** OUTPUT - ZZLCD (5,0) Last Coupon Date before Control Date   **   E20380
     C**                                                             **   E20380
     C** CALLS  - ZDATE1                                             **   E20380
     C**          ZDATE2                                             **   E20380
     C********************************************************************E20380
     C/EJECT                                                              E20380
     C/COPY ZSRSRC,ZLCDZ1                                                 E20380
     C/EJECT                                                              E20380
     C/COPY ZSRSRC,ZCCYCN                                                 E20380
     C****/EJECT                                                    47719 E20380
     C****/COPY ZSRSRC,ZCCYXR                                       47719 E20380
     C**                                                                  S01158
     C*
     C/EJECT                                                              S01464
     C/COPY ZSRSRC,ZACCRZ1                                                S01464
     C/EJECT                                                              S01464
     C/COPY ZSRSRC,ZACCZZ1                                                S01464
     C/EJECT                                                              S01464
     C/COPY ZSRSRC,ZCALCD                                                 S01464
     C/EJECT                                                              S01464
     C/COPY ZSRSRC,ZCNSDZ1                                                S01464
     C/EJECT                                                              S01464
     C/COPY ZSRSRC,ZRATEZ1                                                S01464
     C/COPY WNCPYSRC,SE6240C031
     C*                                                                   S01464
     C/EJECT                                                              179044
      *****************************************************************   179044
      *                                                               *   179044
      * SRPNAR - Subroutine to determine required posting narratives  *   179044
      *                                                               *   179044
      * Called by: #P10                                               *   179044
      *                                                               *   179044
      * Calls: *PSSR                                                  *   179044
      *                                                               *   179044
      *****************************************************************   179044
      *                                                                   179044
     C           SRPNAR    BEGSR                                          179044
      *                                                                   179044
      ** Define the data structure parameter                              179044
      *                                                                   179044
     C           *LIKE     DEFN MNCRNM    ##CRNM                          179044
     C           *LIKE     DEFN CGPNAR    ##PNAR                          179044
      *                                                                   179044
     C                     CLEARCGPNAR                                    179044
     C                     CLEAR##PRM1                                    179044
      *                                                                   179044
      ** If the facility is switched off or unavailable,                  179044
      ** or UDC is not installed, exit this subroutine                    179044
      *                                                                   179044
     C           SEPNAR    IFNE 'Y'                                       179044
     C                     GOTO EXPNAR                                    179044
     C                     ENDIF                                          179044
      *                                                                   179044
      ** Determine the value for the narrative using AOPNARR0             179044
      *                                                                   179044
     C                     MOVE 'SE'      MNMODI                          179044
     C                     MOVE CNUM      MNCUST                          179044
     C                     MOVE CCY       MNCYCD                          179044
     C                     MOVE ACOD      MNACCD                          179044
     C                     MOVE ACSQ      MNACSQ                          179044
     C                     MOVE BRCA      MNBRCA                          179044
     C                     MOVE BOKC      MNBOKC                          179044
     C                     MOVE ##CRNM    MNCRNM                          179044
     C                     MOVELPNAR      MNNARR    P                     179044
     C                     MOVE ASOC      MNASOC                          179044
     C                     MOVE ACNO      MNRACN                          179044
     C                     MOVE OTRF      MNTRNO                          179044
      *                                                                   179044
     C                     CALL 'AOPNARR0'                                179044
     C                     PARM           ##RTN   7                       179044
     C                     PARM           ##MGID  7                       179044
     C                     PARM           ##PRM1                          179044
     C           CGPNAR    PARM CGPNAR    ##PNAR                          179044
     C                     PARM           ##NARR 50                       179044
      *                                                                   179044
     C           ##RTN     IFNE *BLANKS                                   179044
     C                     MOVEL'CGPNARPD'DBFILE             *************179044
     C                     Z-ADD14        DBASE              * DBERR 014 *179044
     C                     MOVELMNCUST    DBKEY              *************179044
     C                     EXSR *PSSR                                     179044
     C                     SETON                     U7U8                 179044
     C                     ENDIF                                          179044
      *                                                                   179044
     C                     MOVEL##NARR    PNAR      P                     179044
      *                                                                   179044
     C           EXPNAR    TAG                                            179044
     C*                                                                   179044
     C                     ENDSR                                          179044
     C********************************************************************
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  PNARR
CUSTODY FEE FOR
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
