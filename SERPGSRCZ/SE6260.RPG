     H
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas Safe Custody Outstanding settlements rpt')       *
     F*****************************************************************
     F**                                                              *
     F**  Midas PORTFOLIO MANAGEMENT                              *
     F**                                                              *
     F**  SE6260 - SC OUTSTANDING SETTLEMENTS REPORT                  *
     F**                                                              *
     F*  Function:  This Program produces a report of all authorised  *
     F*  (COB)      and (COB) unauthorised settlements that have been *
     F*  (I/C)      generated but not yet (I/C) posted.               *
     F*                                                               *
     F*  Called by: SEC6261 - Outstanding Custody Fee Settlements Rep.*
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F**                                                              *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CLE134             Date 01Aug12               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 092178             Date 23Aug95               *
      *                 091522             Date 14Aug95               *
     F*                 S01464             DATE 04APR94               *
     F*                 48200              DATE 04DEC92               *
     F**      AMEND NO. 47719              DATE 24NOV92               *
     F**                                                              *
     F**--------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  092178 - Detail report should start at the first page and    *
     F*           no page break should occur on change of customer    *
     F*           unless the overflow line has been reached.          *
     F*  091522 - Safe Custody Fees - Private Banking (CSE001)        *
     F*  S01464  -  Safe Custody Fees                                 *
     F*     48200   -  SUPPRESS SUBR FOR CONVERSION OF AN AMOUNT      *
     F*                IN ANOTHER CURRENCY USING THE KONVENTIONKURSE  *
     F*                 EXCHANGE RATE (SWISS)                         *
     F*     47719   -  CORRECT CONVERSION OF AMOUNTS BETWEEN CURRENCIES
     F*****************************************************************
     F** C R E A T I O N     P A R A M E T E R S                      *
     F**                                                              *
     F**                                                              *
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F**
     F**      FILE DEFINITIONS
     F**     ------------------
     F*
     F**   BANK DETAILS FILE                        - PrefiX BJ
     FSDBANKPDIF  E                    DISK         KINFSR *PSSR
     F*
     F**   CURRENCY FILE                            - Prefix A6
     F***SDCURRJ0IF  E           K        DISK         KINFSR *PSSR       48200
     F*
     FSDCURRL0IF  E           K        DISK                               48200
     F                                              KINFSR *PSSR          48200
     F*****************************************************************   S01464
     F**   SAFE CUSTODY ICD FILE                    - Prefix SA           S01464
     F***SCICDPPDIF**E                 DISK         KINFSR *PSSR
     F*                                                                   S01464
     F**   Safe Custody ICD File                    - Prefix FB           S01464
     FSDSCFEPDIF  E                    DISK         KINFSR *PSSR          S01464
     F*
     F*****PM*ICD*FILE******************************-*Prefix*P9********   S01464
     F***SDPORTPDIF**E                 DISK         KINFSR *PSSR          S01464
     F*
     F**   OUTSTANDING SAFE CUSTODY FEE SETTLEMENTS
     F***SCOCFSQ1IF**E        K        DISK         KINFSR *PSSR          S01464
     FSEOCFSQ1IF  E           K        DISK         KINFSR *PSSR      UC  S01464
     F*                                                                   S01464
     F**   OUTSTANDING SAFE CUSTODY FEE SETTLEMENTS                       S01464
     FSEOCFSQ2IF  E           K        DISK         KINFSR *PSSR      UC  S01464
     F            SEOCFSQ1                          KRENAMESEOCFSQ3       S01464
      *
      ** Account Officer Codes  (Prefix:AZ)
     FSDACOFL1IF  E           K        DISK                           UC
     F                                              KINFSR *PSSR
      *
      ***Live*Customers*by*Customer*Number**(Prefix:BB)****************   S01464
     F***SDCUSTL5IF**E        K        DISK                           UC  S01464
     F*
     F**   SAFE CUSTODY OUTSTANDING SETTLEMENTS REPORT
     FSE6260P1O   E             22     PRINTER      KINFDS ERF2DS     UC
     F                                              KINFSR *PSSR
     F*
     FSE6260AUO   E             23     PRINTER      KINFDS ERF1DS     UC  S01464
     F                                              KINFSR *PSSR          S01464
     F*
     F/COPY WNCPYSRC,SE6260F001
     F/EJECT
     F*****************************************************************
     F**                                                              *
     F** ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F**                 ------------------------                     *
     F**                                                              *
     F**    10         - Multibranch Indicator                        *   S01464
     F**    22         - OVERFLOW INDICATOR ON SE6260P1               *
     F**    23         - Overflow Indicator on SE6230AU               *   S01464
     F**                                                              *
     F**       55      - PRINT PORTFOLIO REFERENCE                    *
     F**       65      - PRINT CUSTOMER NUMBER                        *
     F**       70      - FILE ERROR                                   *
     F**                                                              *
     F*****************************************************************
     F/EJECT
     E********************************************************************
     E*
     E*****QCMDEXC*ARRAY***********************************************   S01464
     E***********         CMD     1   1 39                                S01464
     E*
     E**   ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E**   ARRAY USED IN CURRENCY AMOUNT CONVERSION
     E                    POWER   1   7  7 3
     E*
     E**   ARRAYS USED IN CONVERSION OF DECIMAL AMOUNTS TO CHARACTER
     E                    ZS1        15  1 0
     E                    ZS2        21  1
     E*
     E**   ARRAYS USED IN CONVERSION OF DATES TO DDMMMYY FORMAT
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E*
     E/COPY WNCPYSRC,SE6260E001
     E/EJECT
     E*****************************************************************
     I*                                                                   S01464
     I**   RENAME ACCOUNT OFFICER FIELD ON SEOCFSQ2                       S01464
     ISEOCFSQ3                                                            S01464
     I              BBACOC                          AZACOC                S01464
     I*
     I**   DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I**   PROGRAM STATUS DATA STRUCTURE
     IPSDS       SDS
     I                                      244 253 JOB
     I                                      254 263 USER
     I*
     IERF2DS      DS
     I                                       83  92 SFILE                 S01464
     I                                    B 123 1240SFNUM                 S01464
     I*
     I**   FOR OVERFLOW - PRINT
     I                                    B 367 3680LINE1
     IERF1DS      DS                                                      S01464
     I                                       83  92 SFILEU                S01464
     I                                    B 123 1240SFNUMU                S01464
     I**   For Overflow                                                   S01464
     I                                    B 367 3680LINEU                 S01464
     I*                                                                   S01464
     I** Rundate data area                                                S01464
     I*                                                                   S01464
     IRUNDT       DS                             13                       S01464
     I                                       13  13 MBIN                  S01464
     I*
     I**   LOCAL DATA AREA
     ILDA        UDS                            256
     I**************************************132 141 DBFILE                S01464
     I                                      134 141 DBFILE                S01464
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I**   DATE FORMATTING DATA STRUCTURE
     IUPDATE      DS
     I                                        1   2 SDDAY
     I                                        3   5 SDMTH
     I                                        6   7 SDYER
     I*
     I**   DATA STRUCTURE FOR ZSEDIT SUBROUTINE
     I            DS
     I                                        1  150WORK15
     I                                        1  150ZS1
     I*
     I**   MULTIPLE OCCURENCE DS TO STORE SETTLEMENT CURRENCY DETAILS
     IDSCCY       DS                        100
     I                                        1   3 WWCCY
     I                                        4  168WWSPOT
     I                                       17  17 WWSIGN
     I*
     I**   DATA STRUCTURE FOR FORMATTING ACCOUNT CODE
     I            DS
     I**********                              1  12 WWACCT                                    CGL029
     I                                        1  18 WWACCT                                    CGL029
     I***********                             1   60W1CNUM                                    CSD027
     I                                        1   6 W1CNUM                                    CSD027
     I**********                              7  100W1ACOD                                    CGL029
     I**********                             11  120W1ACSQ                                    CGL029
     I                                        7  160W1ACOD                                    CGL029
     I                                       17  180W1ACSQ                                    CGL029
     I*
     I**   DATA STRUCTURE FOR FORMATTING ACCOUNT CODE
     I            DS
     I**********                              1  14 WWACT1                                    CGL029
     I                                        1  20 WWACT1                                    CGL029
     I***********                             1   60W2CNUM                                    CSD027
     I                                        1   6 W2CNUM                                    CSD027
     I                                        7   7 W1DASH
     I**********                              8  110W2ACOD                                    CGL029
     I**********                             12  12 W1DAS1                                    CGL029
     I**********                             13  140W2ACSQ                                    CGL029
     I                                        8  170W2ACOD                                    CGL029
     I                                       18  18 W1DAS1                                    CGL029
     I                                       19  200W2ACSQ                                    CGL029
     I/COPY WNCPYSRC,SE6260I001
     I*                                                                   091522
     ISDMMOD    E DSSDMMODPD                                              091522
     I** Midas Modules File                                               091522
     I*                                                                   091522
     ISDPORT    E DSSDPORTPD                                              091522
     I** Portfolio Management ICD                                         091522
     I*                                                                   091522
     I** Short DS for access programs                                     091522
     IDSFDY     E DSDSFDY                                                 091522
     I*                                                                   091522
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**              START MAINLINE
     C**             ----------------
     C           *ENTRY    PLIST
     C*
     C**   ACCOUNT OFFICER CODE AND CUSTOMER NUMBER SELECTED ARE PASSED IN
     C**   FOR NULL REPORT
     C*
     C                     PARM           WWACO   4
     C                     PARM           WWCNM   6
     C                     PARM           WWASTS  1
     C                     PARM           @RSEQ   5                       S01464
     C                     PARM           @RENT   3                       S01464
     C*
     C**   INITIAL PROCESSING
     C*
     C                     EXSR #A
     C*
     C**   MAIN PROCESSING
     C*
     C                     EXSR #B
     C*                                                                   S01464
     C           WWAUFG    IFEQ 'Y'                                       S01464
     C*                                                                   S01464
     C** Ensure total spool file recorded by RCF.                         S01464
     C*                                                                   S01464
     C                     Z-ADDSFNUMU    SFNUM2  60                      S01464
     C*                                                                   S01464
     C                     CALL 'ZSFILE'                                  S01464
     C                     PARM           @RSEQ   5                       S01464
     C                     PARM *BLANK    SENTY   3                       S01464
     C                     PARM           SFILEU                          S01464
     C                     PARM           SFNUM2                          S01464
     C                     PARM           ZSERR   1                       S01464
     C*                                                                   S01464
     C           ZSERR     IFEQ 'Y'                                       S01464
     C                     MOVE '1'       *INU7                           S01464
     C                     MOVE '1'       *INU8                           S01464
     C                     MOVE '1'       *INLR                           S01464
     C                     RETRN                                          S01464
     C                     END                                            S01464
     C                     CLOSESE6260AU                                  S01464
     C                     END                                            S01464
     C*                                                                   S01464
     C**   CLOSE QUERY FILE                                            M  S01464
     C           WWACO     IFEQ '*ALL'                                    S01464
     C                     CLOSESEOCFSQ2                                  S01464
     C                     ELSE                                           S01464
     C                     CLOSESEOCFSQ1                                  S01464
     C                     END                                            S01464
     C*
     C**   END PROGRAM
     C*
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**    INDEX TO SUBROUTINES                                      *
     C**   ----------------------                                     *
     C**                                                              *
     C**                                                              *
     C**   #A      - INITIAL PROCESSING                               *
     C**   #B      - MAIN PROCESSING                                  *
     C**   #BA     - PRINT SC OUTSTANDING SETTLEMENTS REPORT          *
     C**   #ZA     - DATABASE ERRORS                                  *
     C**   #ZB     - CALCULATE SETTLEMENT AMOUNT                      *
     C**   #ZC     - SETUP OUTPUT FIELDS FOR REPORT                   *
     C**   ZCCYKK  - CONVERT AN AMOUNT FROM ONE CURRENCY TO ANOTHER   *
     C**   ZSEDIT  - FORMAT NUMERIC VALUES                            *
     C**   *PSSR   - PROGRAM ERROR HANDLING SUBROUINE                 *
     C**                                                              *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #A        - INITIAL PROCESSING                             *
     C**                                                              *
     C**   CALLS     - #ZA                                            *
     C**                                                              *
     C**   CALLED BY - MAINLINE                                       *
     C**                                                              *
     C*****************************************************************
     C*
     C           #A        BEGSR
     C*
     C** Move the copyright statement                                     S01464
     C*                                                                   S01464
     C                     MOVEACPY@      BIS@   80                       S01464
     C*                                                                   S01464
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01464
     C                     IN   RUNDT                                     S01464
     C*                                                                   S01464
     C                     Z-ADD*ZEROS    LINE1
     C                     MOVE '0'       *IN98
     C*
     C** Initialise DB error fields annd store program name for DB
     C** error field
     C*
     C           *NAMVAR   DEFN           LDA                             S01464
     C           *LOCK     IN   LDA                                       S01464
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     MOVE *BLANKS   DBPGM                           S01464
     C                     MOVEL'SE6260'  DBPGM
     C                     OUT  LDA                                       S01464
     C*
     C** INITIALISE WORK FIELDS
     C                     MOVE '1'       WWFTT   1
     C                     Z-ADD0         WWX     30
     C*                                                                   S01464
     C** Test for multibranching                                          S01464
     C*                                                                   S01464
     C           MBIN      IFEQ 'Y'                                       S01464
     C                     MOVE '1'       *IN10                           S01464
     C                     ELSE                                           S01464
     C                     MOVE '0'       *IN10                           S01464
     C                     END                                            S01464
     C*
     C***Built*command*expression*for*QCMDEXC**************************   S01464
     C***********          MOVELCMD,1     WWCMDP 43                       S01464
     C***********          MOVE ')'       WWPRTL  4                       S01464
     C***********          MOVE '-'       W1DASH  1                       S01464
     C***********          MOVE '-'       W1DAS1  1                       S01464
     C*
     C** Access Bank details file to get run date & title
     C*
     C           1         SETLLSDBANKPD
     C                     READ SDBANKPD                 70
     C*
     C** If record not found or last change type = 'D' (DELETED)
     C*
     C           *IN70     IFEQ '1'
     C           BJTYLC    OREQ 'D'
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD1         DBASE            ***************
     C                     MOVEL'SDBANKPD'DBFILE           * DBERROR 001 *
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C                     END
     C*
     C***ACCESS*PM*ICD*FILE********************************************
     C*****************************************************************
     C***********1         SETLLSDPORTPD
     C***********          READ SDPORTPD                 70
     C*****************************************************************   S01464
     C***IF*RECORD*NOT*FOUND*******************************************   S01464
     C*****************************************************************   S01464
     C************IN70     IFEQ '1'                                       S01464
     C***********P9TYLC    OREQ 'D'
     C***********P9ADST    OREQ 'D'                                       S01464
     C***********          Z-ADD2         DBASE            ***************S01464
     C***********          MOVEL'SDPORTPD'DBFILE           * DBERROR 002 *S01464
     C***********          MOVE *BLANKS   DBKEY            ***************S01464
     C***********          EXSR #ZA                                       S01464
     C***********          END                                            S01464
     C*                                                                   091522
     C** Check if Portfolio Management is ON using access object.         091522
     C*                                                                   091522
     C                     CALL 'AOMMODR0'                                091522
     C                     PARM *BLANKS   @RTCD   7                       091522
     C                     PARM '*FIRST ' @OPTN   7                       091522
     C           SDMMOD    PARM SDMMOD    DSFDY                           091522
     C*                                                                   091522
     C** Database error if no record found.                               091522
     C*                                                                   091522
     C           @RTCD     IFNE *BLANKS                                   091522
     C           *LOCK     IN   LDA                                       091522
     C                     Z-ADD5         DBASE            ***************091522
     C                     MOVEL'SDMMODPD'DBFILE           * DBERROR 005 *091522
     C                     MOVE *BLANKS   DBKEY            ***************091522
     C                     OUT  LDA                                       091522
     C                     EXSR #ZA                                       091522
     C                     END                                            091522
     C*                                                                   091522
     C** If Portfolio Management is ON, access Portfolio Management       091522
     C** ICD.                                                             091522
     C*                                                                   091522
     C           BGPFMG    IFEQ 'Y'                                       091522
     C*                                                                   091522
     C                     CALL 'AOPORTR0'                                091522
     C                     PARM *BLANKS   @RTCD                           091522
     C                     PARM '*FIRST ' @OPTN                           091522
     C           SDPORT    PARM SDPORT    DSFDY                           091522
     C*                                                                   091522
     C** Database error if no record found.                               091522
     C*                                                                   091522
     C           @RTCD     IFNE *BLANKS                                   091522
     C           *LOCK     IN   LDA                                       091522
     C                     Z-ADD2         DBASE            ***************091522
     C                     MOVEL'SDPORTPD'DBFILE           * DBERROR 002 *091522
     C                     MOVE *BLANKS   DBKEY            ***************091522
     C                     OUT  LDA                                       091522
     C                     EXSR #ZA                                       091522
     C                     END                                            091522
     C*                                                                   091522
     C                     END                                            091522
     C*
     C** Access Safe Custody ICD file
     C*
     C***********1         SETLLSCICDPPD                                  S01464
     C***********          READ SCICDPPD                 70               S01464
     C           1         SETLLSDSCFEPD                                  S01464
     C                     READ SDSCFEPD                 70               S01464
     C*
     C** IF RECORD NOT FOUND
     C*
     C           *IN70     IFEQ '1'
     C***********SACHTP    OREQ 'D'                                       S01464
     C           FBTYLC    OREQ 'D'                                       S01464
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD3         DBASE            ***************
     C***********          MOVEL'SCICDPPD'DBFILE           * DBERROR 003 *S01464
     C                     MOVEL'SDSCFEPD'DBFILE           * DBERROR 003 *S01464
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA                                       S01464
     C                     EXSR #ZA
     C                     END
     C*                                                                   S01464
     C**   OPEN APPROPRIATE QUERY FILE DEPENDING ON ACCOUNT OFFICER PARM  S01464
     C           WWACO     IFEQ '*ALL'                                    S01464
     C                     OPEN SEOCFSQ2                                  S01464
     C                     ELSE                                           S01464
     C                     OPEN SEOCFSQ1                                  S01464
     C                     END                                            S01464
     C*
     C** Check fees per customer positions indicator
     C***********SACFCP    IFEQ 'P'                                       S01464
     C           FBCFCP    IFEQ 'P'                                       S01464
     C*
     C** Set flag to output Portfolio Reference literals on report
     C                     MOVE '1'       *IN55
     C*
     C                     ELSE
     C***********SACFCP    IFEQ 'C'                                       S01464
     C           FBCFCP    IFEQ 'C'                                       S01464
     C*
     C** Setoff flag to output Portfolio Reference literals on report
     C                     MOVE '0'       *IN55
     C                     END
     C                     END
     C*
     C** DEFINE WORK FIELDS
     C           *LIKE     DEFN BBCSCY    WWCSCY
     C************LIKE     DEFN P9R999    WWPREF                          S01464
     C           *LIKE     DEFN SEPTFR    WWPREF                          S01464
     C           *LIKE     DEFN SECFAC    WWTAMA
     C           *LIKE     DEFN AZACOC    WWACOC
     C************LIKE     DEFN AZPRTL    WWPLOC                          S01464
     C           *LIKE     DEFN SEBRCA    WWBRCD                          S01464
     C*
     C/COPY WNCPYSRC,SE6260C001
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #B          MAIN - SC OUTSTANDING SETTLEMENTS REPORT       *
     C**                                                              *
     C**   CALLS     - #BA                                            *
     C**                                                              *
     C**   CALLED BY - MAINLINE                                       *
     C**                                                              *
     C*****************************************************************
     C*
     C           #B        BEGSR
     C*
     C***********          READ SCOCFSQ1                 70               S01464
     C           WWACO     IFEQ '*ALL'                                    S01464
     C                     READ SEOCFSQ2                 70               S01464
     C                     ELSE                                           S01464
     C                     READ SEOCFSQ1                 70               S01464
     C                     END                                            S01464
     C*
     C           *IN70     IFEQ '1'                        B1
     C*
     C** PRINT NULL REPORT
     C*
     C***********WWACO     IFEQ '*ALL'                     B2             S01464
     C***********          MOVE *BLANKS   RRPRTL                          S01464
     C***********          MOVELWWACO     RRACOC                          S01464
     C***********          MOVE '1'       *IN40                           S01464
     C***********          MOVE WWCNM     RRCNUM                          S01464
     C***********          MOVE '1'       *IN41                           S01464
     C***********          ELSE                            X2             S01464
     C*****************************************************************   S01464
     C***********          OPEN SDACOFL1                                  S01464
     C***********          MOVELWWACO     WWACOK  2                       S01464
     C***********WWACOK    CHAINSDACOFL1             42                   S01464
     C************IN42     IFEQ '1'                        B3             S01464
     C***********          Z-ADD6         DBASE            ***************S01464
     C***********          MOVEL'SDACOFL1'DBFILE           * DBERROR 006 *S01464
     C***********          MOVE WWACO     DBKEY            ***************S01464
     C***********          EXSR #ZA                                       S01464
     C***********          END                             E3             S01464
     C***********          MOVE AZPRTL    RRPRTL                          S01464
     C***********          MOVELWWACO     RRACOC                          S01464
     C***********          MOVE '0'       *IN40                           S01464
     C***********          MOVE AZACON    RRACON                          S01464
     C*****************************************************************   S01464
     C***********WWCNM     IFEQ '*ALL  '                   B3             S01464
     C***********          MOVE WWCNM     RRCNUM                          S01464
     C***********          MOVE '1'       *IN41                           S01464
     C***********          ELSE                            X3             S01464
     C***********          OPEN SDCUSTL5                                  S01464
     C***********WWCNM     CHAINSDCUSTL5             43                   S01464
     C************IN43     IFEQ '1'                        B4             S01464
     C***********          Z-ADD5         DBASE            ***************S01464
     C***********          MOVEL'SDCUSTL5'DBFILE           * DBERROR 005 *S01464
     C***********          MOVE WWCNM     DBKEY            ***************S01464
     C***********          EXSR #ZA                                       S01464
     C***********          END                             E4             S01464
     C***********          MOVE WWCNM     RRCNUM                          S01464
     C***********          MOVE '0'       *IN41                           S01464
     C***********          MOVE BBCRNM    RRCRNM                          S01464
     C***********          END                             E3             S01464
     C*****************************************************************   S01464
     C***********          END                             E2             S01464
     C*****************************************************************   S01464
     C***SET*UP*AUTHORISATION*STATUS*IF*NO*DETAILS*TO*REPORT***********   S01464
     C***********WWASTS    IFEQ 'Y'                                       S01464
     C***********          MOVE 'YES'     RRAUTS                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***********WWASTS    IFEQ 'N'                                       S01464
     C***********          MOVE 'NO '     RRAUTS                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***********WWASTS    IFEQ 'X'                                       S01464
     C***********          MOVE 'ANY'     RRAUTS                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***OPEN*CORRECT*SPOOL*FILE***************************************   S01464
     C***********WWACO     IFEQ '*ALL'                     B2             S01464
     C***********          MOVELAZPRTL    WWPRTL                          S01464
     C***********          MOVE WWPRTL    WWCMDP                          S01464
     C***********          ELSE                            X2             S01464
     C***********          MOVE ')   '    WWPRTL                          S01464
     C***********          MOVE WWPRTL    WWCMDP                          S01464
     C***********          END                             E2             S01464
     C*****************************************************************   S01464
     C***********          CALL 'QCMDEXC'                                 S01464
     C***********          PARM WWCMDP    QCAA   43                       S01464
     C***********          PARM 43        QCAN   155                      S01464
     C***********          OPEN SE6260P1                                  S01464
     C***********          WRITEHEADER1                                   S01464
     C***********          WRITECUST1                                     S01464
     C***********          MOVE SABCGC    RRCCY                           S01464
     C***********          WRITEHEADER2                                   S01464
     C***********          WRITENULL1                                     S01464
     C                     OPEN SE6260AU                                  S01464
     C                     MOVE 'Y'       WWAUFG  1                       S01464
     C                     WRITEHEADER                                    S01464
     C                     WRITENULL1                                     S01464
     C                     ELSE                            X1
     C*****************************************************************   S01464
     C**SET*UP*PRINTER*LOCATION****************************************   S01464
     C*****************************************************************   S01464
     C***********          MOVE '1'       *IN65
     C***********          MOVELAZPRTL    WWPRTL                          S01464
     C***********          MOVE WWPRTL    WWCMDP                          S01464
     C***********          CALL 'QCMDEXC'                                 S01464
     C***********          PARM WWCMDP    QCAA   43                       S01464
     C***********          PARM 43        QCAN   155                      S01464
     C***********          OPEN SE6260P1                                  S01464
     C*
     C***********          END                             E1             S01464
     C*
     C** INITIALISE ACCOUNT OFFICER WORKFIELDS
     C*
     C                     MOVE *BLANKS   WWACOC
     C                     MOVE *BLANKS   WWBRCD                          S01464
     C*
     C** WHILE RECORDS ON FILE
     C*
     C           *IN70     DOWEQ'0'                        B1
     C*                                                                   S01464
     C           SEBRCA    IFNE WWBRCD                     B2             S01464
     C*                                                                   S01464
     C           WWOPEN    IFEQ 'Y'                        B3             S01464
     C                     WRITEFOOTING1                                  S01464
     C                     CLOSESE6260P1                                  S01464
     C                     MOVE 'N'       WWOPEN  1                       S01464
     C                     END                             E3             S01464
     C*                                                                   S01464
     C           @RENT     IFEQ 'ALL'                      B3             S01464
     C           @RENT     OREQ SEBRCA                                    S01464
     C           *IN10     OREQ '0'                                       S01464
     C*                                                                   S01464
     C                     OPEN SE6260P1                                  S01464
     C                     Z-ADD*ZERO     PAGE                            S01464
     C                     MOVE 'Y'       WWOPEN  1                       S01464
     C*                                                                   S01464
     C** Write the headings of the report.                                S01464
     C*                                                                   S01464
     C                     MOVELSEBRCA    RRBRCD                          S01464
     C*                                                                   S01464
     C** IF ACCOUNT OFFICER PARM IS EQUAL TO *ALL                         S01464
     C           WWACO     IFEQ '*ALL'                                    S01464
     C***********          MOVE AZACOC    RRACOC                   S01464 092178
     C                     MOVELAZACOC    RRACOC                          092178
     C*                                                                   S01464
     C** OPEN ACCOUNT OFFICER DETAILS FILE                                S01464
     C                     OPEN SDACOFL1                                  S01464
     C*                                                                   S01464
     C** ACCESS LF/SDACOFL1 WITH ACCOUNT OFFICER CODE                     S01464
     C           AZACOC    CHAINSDACOFL1             42                   S01464
     C*                                                                   S01464
     C** GET ACCOUNT OFFICER NAME FOR ACCOUNT OFFICER HEADING             S01464
     C           *IN42     IFEQ '1'                                       S01464
     C                     MOVE *BLANKS   RRACON                          S01464
     C                     ELSE                                           S01464
     C                     MOVE AZACON    RRACON                          S01464
     C                     END                                            S01464
     C*                                                                   S01464
     C                     CLOSESDACOFL1                                  S01464
     C                     ELSE                                           S01464
     C                     MOVELAZACOC    RRACOC                          S01464
     C                     MOVE AZACON    RRACON                          S01464
     C                     END                                            S01464
     C                     MOVE FBBCGC    RRCCY                           S01464
     C                     WRITEHEADER1                                   S01464
     C                     WRITEHEADER2                                   S01464
     C*                                                                   S01464
     C** Ensure report spool file recorded by RCF.                        S01464
     C*                                                                   S01464
     C                     Z-ADDSFNUM     SFNUM1  60                      S01464
     C*                                                                   S01464
     C                     CALL 'ZSFILE'                                  S01464
     C                     PARM           @RSEQ                           S01464
     C                     PARM SEBRCA    SENTY   3                       S01464
     C                     PARM           SFILE                           S01464
     C                     PARM           SFNUM1                          S01464
     C                     PARM           ZSERR   1                       S01464
     C*                                                                   S01464
     C           ZSERR     IFEQ 'Y'                        B4             S01464
     C                     MOVE '1'       *INU7                           S01464
     C                     MOVE '1'       *INU8                           S01464
     C                     MOVE '1'       *INLR                           S01464
     C                     RETRN                                          S01464
     C                     END                             E4             S01464
     C*                                                                   S01464
     C                     MOVE '0'       WWHEAD  1                       S01464
     C                     MOVE SEBRCA    WWBRCD                          S01464
     C                     MOVELRRACOC    WWACOC                          S01464
     C                     END                             E3             S01464
     C*                                                                   S01464
     C                     MOVE '1'       *IN65                           S01464
     C                     END                             E2             S01464
     C*
     C***STORE*CUSTOMER*NUMBER*AS*A*NUMERIC*FIELD**********************   S01464
     C***********          MOVE BBCUST    WWCUST  60                      S01464
     C*                                                                   S01464
     C** Store customer number as a character field.                      S01464
     C                     MOVE BBCUST    WWCUST  6                       S01464
     C*
     C** ON CHANGE OF ACCOUNT OFFICER - WRITE REPORT HEADER
     C           WWACOC    IFNE AZACOC                     B2
     C*                                                                   S01464
     C** IF ACCOUNT OFFICER PARM IS EQUAL TO *ALL                         S01464
     C           WWACO     IFEQ '*ALL'                                    S01464
     C***********          MOVE AZACOC    RRACOC                   S01464 092178
     C                     MOVELAZACOC    RRACOC                          092178
     C*                                                                   S01464
     C** OPEN ACCOUNT OFFICER DETAILS FILE                                S01464
     C                     OPEN SDACOFL1                                  S01464
     C*                                                                   S01464
     C** ACCESS LF/SDACOFL1 WITH ACCOUNT OFFICER CODE                     S01464
     C           AZACOC    CHAINSDACOFL1             42                   S01464
     C*                                                                   S01464
     C** GET ACCOUNT OFFICER NAME FOR ACCOUNT OFFICER HEADING             S01464
     C           *IN42     IFEQ '1'                                       S01464
     C                     MOVE *BLANKS   RRACON                          S01464
     C                     ELSE                                           S01464
     C                     MOVE AZACON    RRACON                          S01464
     C                     END                                            S01464
     C*                                                                   S01464
     C                     CLOSESDACOFL1                                  S01464
     C                     ELSE                                           S01464
     C                     MOVELAZACOC    RRACOC
     C                     MOVE AZACON    RRACON
     C                     END                                            S01464
     C***********          MOVE AZPRTL    RRPRTL                          S01464
     C***********          MOVE SABCGC    RRCCY                           S01464
     C                     MOVELSEBRCA    RRBRCD                          S01464
     C                     MOVE FBBCGC    RRCCY                           S01464
     C*                                                                   S01464
     C                     WRITEHEADER1                                   S01464
     C                     WRITEHEADER2                                   S01464
     C*
     C** MODIFY ACCOUNT OFFICER WORKFIELD
     C*
     C                     MOVELRRACOC    WWACOC
     C                     END                             E2
     C*
     C** MODIFY PRINTER LOCATION WORKFIELD
     C***********          MOVE AZPRTL    WWPLOC                          S01464
     C*
     C** EXECUTE PORTFOLIO AND CUSTOMER POSITION PROCESSING
     C                     EXSR #BA
     C*
     C***********          READ SCOCFSQ1                 70               S01464
     C           WWACO     IFEQ '*ALL'                                    S01464
     C                     READ SEOCFSQ2                 70               S01464
     C                     ELSE                                           S01464
     C                     READ SEOCFSQ1                 70               S01464
     C                     END                                            S01464
     C*
     C** ON CHANGE OF ACCOUNT OFFICER - PRINT LIST OF SPOT RATES
     C           WWACOC    IFNE AZACOC                     B2
     C           SEBRCA    ORNE WWBRCD                                    S01464
     C           *IN70     OREQ '1'
     C                     MOVE '1'       WWACC   1
     C*
     C                     Z-ADD1         WWZ     30
     C           WWZ       DOWLEWWX                        B3
     C           WWZ       OCUR DSCCY
     C                     MOVE WWCCY     RRSCCY
     C                     Z-ADDWWSPOT    RRRATE
     C                     MOVE WWSIGN    RRSIGN
     C*
     C           LINE1     IFGT 55                         B4
     C           WWACC     OREQ '1'
     C                     WRITEHEADER1
     C                     WRITEHEADER3
     C                     MOVE '0'       WWACC
     C                     END                             E4
     C                     WRITEDETAIL2
     C*
     C** CLEAR SETTLEMENT CURRENCY DETAILS FOR ACCOUNT OFFICER
     C                     MOVE *BLANKS   WWCCY
     C                     Z-ADD0         WWSPOT
     C                     MOVE *BLANKS   WWSIGN
     C                     ADD  1         WWZ
     C                     END                             E3
     C                     Z-ADD0         WWX
     C                     END                             E2
     C*
     C***ON*CHANGE*OF*PRINTER*LOCATION*CODE****************************   S01464
     C***********WWPLOC    IFNE AZPRTL                     B2             S01464
     C***********          WRITEFOOTING1                                  S01464
     C***********          CLOSESE6260P1                                  S01464
     C***********          MOVE '1'       *IN65                           S01464
     C***********          MOVELAZPRTL    WWPRTL                          S01464
     C***********          MOVE WWPRTL    WWCMDP                          S01464
     C***********          CALL 'QCMDEXC'                                 S01464
     C***********          PARM WWCMDP    QCAA   43                       S01464
     C***********          PARM 43        QCAN   155                      S01464
     C***********          END                             E2             S01464
     C*
     C                     END                             E1
     C*
     C*****      LINE1     IFGT 55
     C*****                WRITEHEADER1
     C*****                WRITEHEADER2
     C*****                END
     C                     WRITEFOOTING1
     C*
     C** CLOSE THE PRINTER FILE
     C                     CLOSESE6260P1
     C*                                                                   S01464
     C                     END                                            S01464
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BA       - PORTFOLIO AND CUSTOMER POSITION PROCESSING     *
     C**                                                              *
     C**   CALLS     - #ZA                                            *
     C**                                                              *
     C**   CALLED BY - #B                                             *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BA       BEGSR
     C*
     C***IF*FEES*PER*CUSTOMER*POSITIONS*IS*SET*TO*'P'******************   S01464
     C*****************************************************************   S01464
     C***********SACFCP    IFEQ 'P'                                       S01464
     C*****************************************************************   S01464
     C***CHECK*PORTFOLIO*REFERENCE*************************************   S01464
     C*****************************************************************   S01464
     C***********SEPTFR    IFEQ '9997'                                    S01464
     C***********SEPTFR    OREQ '9999'                                    S01464
     C*****************************************************************   S01464
     C***SET*REPORT*PORTFOLIO*REFERENCE********************************   S01464
     C*****************************************************************   S01464
     C***********SEPTFR    IFEQ '9997'                                    S01464
     C***********          MOVE P9R997    WWPREF                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***********SEPTFR    IFEQ '9999'                                    S01464
     C***********          MOVE P9R999    WWPREF                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***********          ELSE                                           S01464
     C***********          MOVE SEPTFR    WWPREF                          S01464
     C***********          END                                            S01464
     C*****************************************************************   S01464
     C***********          END                                            S01464
     C*                                                                   091522
     C** If fees per customer positions is set to 'P'                     091522
     C*                                                                   091522
     C           FBCFCP    IFEQ 'P'                                       091522
     C*                                                                   091522
     C** Check portfolio reference                                        091522
     C*                                                                   091522
     C           SEPTFR    IFEQ '9997'                                    091522
     C           SEPTFR    OREQ '9999'                                    091522
     C*                                                                   091522
     C** Set report portfolio reference                                   091522
     C*                                                                   091522
     C           SEPTFR    IFEQ '9997'                                    091522
     C                     MOVE FCR997    WWPREF                          091522
     C                     END                                            091522
     C*                                                                   091522
     C           SEPTFR    IFEQ '9999'                                    091522
     C                     MOVE FCR999    WWPREF                          091522
     C                     END                                            091522
     C*                                                                   091522
     C                     ELSE                                           091522
     C                     MOVE SEPTFR    WWPREF                          091522
     C                     END                                            091522
     C*                                                                   091522
     C                     END                                            091522
     C*
     C** STORE CUSTOMER SETTLEMENT CURRENCY DETAILS
     C*
     C                     MOVE SECSCY    WWCSCY
     C*
     C** CALCULATE THE PROJECTED SETTLEMENT AMOUNT
     C*
     C                     EXSR #ZB
     C*
     C** SET UP OUTPUT FIELDS FOR OUTSTANDING SETTLEMENTS REPORT
     C*
     C                     EXSR #ZC
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #ZA       - Process Database Errors                        *
     C**                                                              *
     C**   CALLS     - None                                           *
     C**                                                              *
     C**   CALLED BY - #A #B #BA                                      *
     C**                                                              *
     C*****************************************************************
     C*
     C           #ZA       BEGSR
     C*
     C                     OPEN SE6260AU                                  S01464
     C                     WRITEHEADER                                    S01464
     C                     WRITEDBERROR                                   S01464
     C*                                                                   S01464
     C** Ensure total spool file recorded by RCF                          S01464
     C*                                                                   S01464
     C                     Z-ADDSFNUMU    SFNUM2  60                      S01464
     C*                                                                   S01464
     C                     CALL 'ZSFILE'                                  S01464
     C                     PARM           @RSEQ   5                       S01464
     C                     PARM *BLANK    SENTY   3                       S01464
     C                     PARM           SFILEU                          S01464
     C                     PARM           SFNUM2                          S01464
     C                     PARM           ZSERR   1                       S01464
     C*                                                                   S01464
     C           ZSERR     IFEQ 'Y'                                       S01464
     C                     MOVE '1'       *INU7                           S01464
     C                     MOVE '1'       *INU8                           S01464
     C                     MOVE '1'       *INLR                           S01464
     C                     RETRN                                          S01464
     C                     END                                            S01464
     C                     CLOSESE6260AU                                  S01464
     C*                                                                   S01464
     C**   CLOSE QUERY FILE                                            M  S01464
     C           WWACO     IFEQ '*ALL'                                    S01464
     C                     CLOSESEOCFSQ2                                  S01464
     C                     ELSE                                           S01464
     C                     CLOSESEOCFSQ1                                  S01464
     C                     END                                            S01464
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     DUMP
     C                     RETRN
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #ZB       - CALCULATE PROJECTED SETTLEMENT AMOUNT          *
     C**                                                              *
     C**   CALLS     - NONE                                           *
     C**                                                              *
     C**   CALLED BY - #BA                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           #ZB       BEGSR
     C*
     C** CONVERT PROJECTED SETTLEMENT AMOUNT TO SETTLEMENT CURRENCY
     C                     Z-ADDSEAFTS    ZAMTF  150
     C***********          MOVE SABCGC    ZCCYF                           S01464
     C                     MOVE FBBCGC    ZCCYF                           S01464
     C                     MOVE WWCSCY    ZCCYT
     C                     MOVE BJCYCD    ZCCYB
     C******************** EXSR ZCCYKK                                    48200
     C/COPY WNCPYSRC,SE6260C002
     C                     EXSR ZCCYGB                                    48200
     C/COPY WNCPYSRC,SE6260C003
     C*
     C** CHECK FOR DATABASE ERRORS
     C           *IN85     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01464
     C                     Z-ADD4         DBASE
     C***********          MOVEL'SDCURRJ0'DBFILE           ***************S01464
     C                     MOVEL'SDCURRL0'DBFILE           ***************S01464
     C                     MOVE *BLANKS   DBKEY            * DBERROR 004 *
     C                     OUT  LDA                        ***************S01464
     C                     EXSR #ZA                        ***************
     C                     ELSE
     C*
     C** STORE CURRENCY DETAILS FOR ACCOUNT OFFICER
     C                     Z-ADD1         WWY     30
     C                     MOVE 'N'       WWEQL   1
     C           WWY       DOWLEWWX
     C           WWEQL     ANDEQ'N'
     C           WWY       OCUR DSCCY
     C           WWCCY     IFEQ ZCCYT
     C                     MOVE 'Y'       WWEQL
     C                     ELSE
     C                     ADD  1         WWY
     C                     END
     C                     END
     C*
     C           WWEQL     IFEQ 'N'
     C                     ADD  1         WWX
     C           WWX       OCUR DSCCY
     C*
     C** STORE SETTLEMENT CURRENCY
     C                     MOVE ZCCYT     WWCCY
     C*
     C** STORE SPOT RATE
     C                     Z-ADDZCRSRT    WWSPOT
     C*
     C** STORE MULTIPLY/DIVIDE INDICATOR
     C                     MOVE ZCRSMD    WWSIGN
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #ZC       - SETUP OUTPUT FIELDS FOR REPORT                 *
     C**                                                              *
     C**   CALLS     - NONE                                           *
     C**                                                              *
     C**   CALLED BY - #BA                                            *
     C**                                                              *
     C*****************************************************************
     C*
     C           #ZC       BEGSR
     C*
     C** ENSURE CUST. IS ONLY OUTPUT ON CHANGE OF CUST. AND/OR PAGE
     C***********BBCUST    IFEQ RRCUST                                    S01464
     C***********LINE1     ANDLT55                                        S01464
     C           WWCUST    IFEQ RRCUST                                    S01464
     C           LINE1     ANDLE55                                        S01464
     C           SEBRCA    ANDEQWWBRCD                                    S01464
     C           AZACOC    ANDEQWWACOC                                    S01464
     C                     MOVE '0'       *IN65
     C                     ELSE
     C                     MOVE '1'       *IN65
     C                     END
     C*
     C                     MOVE BBCUST    RRCUST
     C                     MOVE WWPREF    RRPREF
     C                     MOVELSECUSB    RRCUSB                          S01464
     C*
     C** INITIALISE ZSEDIT PARAMETERS
     C***********          Z-ADDSABCGD    ZDECS                           S01464
     C                     Z-ADDA6NBDP    ZDECS                           S01464
     C                     MOVE 'L'       ZECODE
     C*
     C** EDIT CUSTODY FEE ACCRUED TO DATE
     C                     Z-ADDSECFAC    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWFL16 16
     C                     MOVELWWFL16    RRTAMA
     C                     MOVE *BLANKS   WWFL16
     C*
     C** EDIT ACTUAL FEE TO BE SETTLED
     C                     Z-ADDSEAFTS    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWFL16
     C                     MOVELWWFL16    RRACAM
     C                     MOVE *BLANKS   WWFL16
     C*
     C                     MOVE WWCSCY    RRSCCY
     C*
     C                     Z-ADDZSCYDP    ZDECS
     C*
     C** EDIT SETTLEMENT AMOUNT
     C                     Z-ADDZAMTT     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WWFL16
     C                     MOVELWWFL16    RRSEAM
     C                     MOVE *BLANKS   WWFL16
     C*
     C** SET UP CUSTOMER SETTLEMENT ACCOUNT FOR OUTPUT
     C*
     C                     MOVE SECUSA    WWCHK2  2
     C           WWCHK2    IFNE *BLANKS
     C                     MOVE SECUSA    WWACCT
     C************         Z-ADDW1CNUM    W2CNUM                                              CSD027
     C                     MOVE W1CNUM    W2CNUM                                              CSD027
     C                     Z-ADDW1ACOD    W2ACOD
     C                     Z-ADDW1ACSQ    W2ACSQ
     C                     MOVE WWACT1    RRACCT
     C                     ELSE
     C**********           MOVELSECUSA    WWRK12 12                                           CGL029
     C**********           MOVE WWRK12    RRACCT                                              CGL029
     C                     MOVELSECUSA    WCUSA  18                                           CGL029
     C                     MOVE WCUSA     RRACCT                                              CGL029
     C                     END
     C                     MOVE SECUSA    WWCHK2  2
     C*
     C                     MOVE SEAUIN    RRAUTH
     C*
     C           SECHTP    IFEQ 'I'
     C                     MOVE 'INSERT'  RRACT
     C                     END
     C*
     C           SECHTP    IFEQ 'A'
     C                     MOVE 'AMEND'   RRACT
     C                     END
     C*
     C           SECHTP    IFEQ 'P'
     C                     MOVE 'POSTED'  RRACT
     C                     END
     C*
     C           SECHTP    IFEQ 'X'
     C                     MOVEL'AUTHOR'  RRACT
     C                     MOVE 'ISE'     RRACT
     C                     END
     C*
     C** SET UP LAST ACTIVITY DATE FOR OUTPUT
     C*
     C                     MOVE SEDLUP    SDDAY
     C                     MOVE SEMLUP    SDMTH
     C                     MOVE SEYLUP    SDYER
     C                     MOVE UPDATE    RRDATE
     C*
     C** SET UP SETTLEMENT VALUE DATE
     C*
     C                     MOVE SESEVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RRSDAT
     C*
     C** SET UP LAST ACTIVITY TIME FOR OUTPUT
     C*
     C                     MOVE SETLUP    RRTIME
     C*
     C           LINE1     IFGT 55
     C           WWHEAD    OREQ '1'
     C                     WRITEHEADER1
     C                     WRITEHEADER2
     C                     MOVE '0'       WWHEAD
     C                     END
     C*
     C                     WRITEDETAIL1
     C*
     C                     MOVE '0'       *IN65
     C                     MOVE *BLANKS   RRACT
     C                     MOVE *BLANKS   RRACCT
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** ZCCYKK subroutine to convert an amount in one currency to an    *
     C** amount in another currency using the Swiss Konventionkurse      *
     C** exchange rates.                                                 *
     C**     Input fields:   ZAMTF  15/0   Amount in 'From' Currency     *
     C**                     ZCCYF  3      'From' Currency               *
     C**                     ZCCYT  3      'To' Currency                 *
     C**                     ZCCYB  3      Base Currency                 *
     C**                                                                 *
     C**     Output fields:  ZAMTT  ]5/0   Amount in 'To' Currency       *
     C**                     ZCRSRT 13/8   Cross Exchange Rate           *
     C**                     ZCRSMD 1      Cross Rate Mult/Div Ind.      *
     C**                     ZSCYDP 1/0    Settle. Ccy Dec Places        *
     C**                                                                 *
     C**     If Indicator 85 is set after calling this subroutine        *
     C**     standard Database Error processing must be performed        *
     C**                                                                 *
     C**     Also Requires:  Currency file (SDCURRJ0)                    *
     C**                                                                 *
     C**     Calls:   ZCCYCN                                             *
     C**                                                                 *
     C***        ZCCYKK    BEGSR                           **  ZCCYKK    *
     C***
     C***DEFINE WORK FIELDS
     C***                  Z-ADDZAMTF     ZAMTF  150
     C***                  MOVE ZCCYF     ZCCYF   3
     C***                  MOVE ZCCYT     ZCCYT   3
     C***                  MOVE ZCCYB     ZCCYB   3
     C***                  Z-ADDZAMTT     ZAMTT  150
     C***                  Z-ADDZCRSRT    ZCRSRT 138
     C***                  MOVE ZCRSMD    ZCRSMD  1
     C***                  MOVE ZSCYDP    ZSCYDP  10
     C***                  MOVE 'N'       ZZIND   1
     C*
     C** INITIALISE INDICATOR FOR DATABASE ERROR
     C***                  MOVE '0'       *IN85
     C***
     C***CHECK IF THE 'FROM' CURRENCY EQUALS THE 'TO' CURRENCY
     C***        ZCCYF     IFEQ ZCCYT                      B1
     C***                  Z-ADDZAMTF     ZAMTT
     C***                  Z-ADD1         ZCRSRT
     C***                  MOVE 'M'       ZCRSMD
     C***
     C***                  ELSE                            X1
     C***
     C***ACCESS THE CURRENCY FILE USING THE 'FROM' CCY
     C***        ZCCYF     CHAINSDCURRJ0             80
     C*
     C** IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C*
     C***        *IN80     IFEQ '1'                        B2
     C***                  MOVE '1'       *IN85                        ***
     C***                  ELSE                            X2
     C***
     C** CHECK THE 'FROM' CURRENCY AGAINST THE BASE CURRENCY
     C***        ZCCYF     IFEQ ZCCYB                      B3
     C***                  Z-ADDA6NBDP    ZCDPF
     C***                  MOVE 'M'       ZMDINF
     C***                  Z-ADD1         ZRATEF
     C***                  ELSE                            X3
     C***
     C***CHECK THE 'TO' CURRENCY AGAINST THE BASE CURRENCY
     C***        ZCCYT     IFEQ ZCCYB                      B4
     C***                  Z-ADDA6NBDP    ZCDPF
     C***
     C***        CYSELR    IFNE 0                          B5
     C***                  MOVE CYSELI    ZMDINF
     C***                  Z-ADDCYSELR    ZRATEF
     C***                  ELSE                            X5
     C***                  MOVE A6MDIN    ZMDINF
     C***                  Z-ADDA6SPRT    ZRATEF
     C***                  END                             E5
     C***
     C***                  ELSE                            X4
     C***
     C***        CYBUYR    IFEQ 0                          B5
     C***                  MOVE A6MDIN    CYBUYI
     C***                  Z-ADDA6SPRT    CYBUYR
     C***                  END                             E5
     C***
     C***        CYSELR    IFEQ 0                          B5
     C***                  MOVE A6MDIN    CYSELI
     C***                  Z-ADDA6SPRT    CYSELR
     C***                  END                             E5
     C***
     C***CHECK THE CONVENTION BID MULT/DIV INDICATOR
     C***        CYBUYI    IFEQ 'D'                        B5
     C***
     C***TAKE THE INVERSE OF THE BID RATE - CHECK FOR DIVIDE BY ZERO
     C***        CYBUYR    IFNE 0                          B6
     C***        1         DIV  CYBUYR    WWBMLT 138H
     C***                  ELSE                            X6
     C***                  Z-ADD0         WWBMLT
     C***                  END                             E6
     C***                  ELSE                            X5
     C***                  Z-ADDCYBUYR    WWBMLT
     C***                  END                             E5
     C***
     C***CHECK THE CONVENTION SELL MULT/DIV INDICATOR
     C***        CYSELI    IFEQ 'D'                        B5
     C***
     C***TAKE THE INVERSE OF THE SELL RATE - CHECK FOR DIVIDE BY ZERO
     C***        CYSELR    IFNE 0                          B6
     C***        1         DIV  CYSELR    WWSMLT 138H
     C***                  ELSE                            X6
     C***                  Z-ADD0         WWSMLT
     C***                  END                             E6
     C***                  ELSE                            X5
     C***                  Z-ADDCYSELR    WWSMLT
     C***                  END                             E5
     C***
     C***                  Z-ADDA6NBDP    ZCDPF
     C***                  MOVE 'M'       ZMDINF
     C***        WWBMLT    ADD  WWSMLT    WWMRAT 148
     C***        WWMRAT    DIV  2         ZRATEF
     C***                  END                             E4
     C***                  END                             E3
     C***
     C***ACCESS THE CURRENCY FILE USING THE 'TO' CCY
     C***        ZCCYT     CHAINSDCURRJ0             80
     C***
     C***IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C***
     C***        *IN80     IFEQ '1'                        B3
     C***                  MOVE '1'       *IN85                        ***
     C***                  ELSE                            X3
     C***
     C** SET ON INDICATOR STATING ZCCYT USED TO ACCESS LF/SDCURRJ0 AND
     C** SAVE DECIMAL PLACES
     C***                  MOVE 'Y'       ZZIND
     C***                  Z-ADDA6NBDP    ZSCYDP
     C***
     C***CHECK THE 'TO' CURRENCY AGAINST THE BASE CURRENCY
     C***        ZCCYT     IFEQ ZCCYB                      B4
     C***                  Z-ADDA6NBDP    ZCDPT
     C***                  MOVE 'M'       ZMDINT
     C***                  Z-ADD1         ZRATET
     C***                  ELSE                            X4
     C***
     C***                  Z-ADDA6NBDP    ZCDPT
     C***
     C***        CYBUYR    IFEQ 0                          B5
     C***                  MOVE A6MDIN    ZMDINT
     C***                  Z-ADDA6SPRT    ZRATET
     C***                  ELSE                            X5
     C***                  MOVE CYBUYI    ZMDINT
     C***                  Z-ADDCYBUYR    ZRATET
     C***                  END                             E5
     C***
     C***                  END                             E4
     C***
     C***                  EXSR ZCCYCN
     C***
     C***                  END                             E3
     C***                  END                             E2
     C***                  END                             E1
     C***
     C** IF CURRENCIES FILE NOT ACCESSED WITH ZCCYT ACCESS TO GET TO
     C** CURRENCY DECIMAL PLACES
     C***        ZZIND     IFEQ 'N'                        B1
     C***        ZCCYT     CHAINSDCURRJ0             80
     C***
     C***IF RECORD NOT FOUND OR LAST CHANGE TYPE = 'D' THEN DB ERROR
     C*
     C***        *IN80     IFEQ '1'                        B2
     C***                  MOVE '1'       *IN85                        ***
     C***                  ELSE                            X2
     C***                  Z-ADDA6NBDP    ZSCYDP
     C***                  END                             E2
     C***                  END                             E1
     C***
     C***        ZKKEND    ENDSR
     C*******************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** ZSEDIT subroutine to insert a decimal point and sign into a     *
     C** numeric field and to blank out leading zeros (optionaly         *
     C** inserting commas).                                              *
     C**     Input fields:   ZFLD15 15/0                                 *
     C**                     ZDECS  1/0                                  *
     C**                     ZECODE 1/  ('J', 'L' or blank)              *
     C**                                                                 *
     C**     Arrays:         ZS1    15/1/0                               *
     C**                     ZS2    21/1/                                *
     C**                                                                 *
     C**     Output fields:  ZOUT21 21                                   *
     C**                                                                 *
     CSR         ZSEDIT    BEGSR                           **  ZSEDIT   *
     C*
     C* Define/Clear fields
     C*
     C                     Z-ADDZFLD15    ZFLD15 150
     C                     Z-ADDZDECS     ZDECS   10
     C                     MOVE ZECODE    ZECODE  1
     C                     MOVE *BLANKS   ZOUT21 21
     C*
     C*       SET UP WORK FIELDS
     C*
     C                     Z-ADD0         ZS1
     C                     MOVE ' '       ZS2
     C*
     C                     Z-ADD15        Z1      20
     C                     Z-ADD20        Z2      20
     C*
     C           15        SUB  ZDECS     ZINTS   20
     C*
     C* Check if numeric field is negative
     C*
     C           ZFLD15    IFLT *ZEROS
     C                     MOVE '-'       ZS2,21
     C                     Z-SUBZFLD15    ZFLD15
     C                     END
     C*
     C                     Z-ADDZFLD15    WORK15
     C*
     C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES
     C*
     C           ZDECS     CABEQ0         ZS10
     C*
     C*       SET UP DECIMALS
     C*
     C                     Z-ADD*ZEROS    ZCNT    10
     C           ZCNT      DOUEQZDECS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z2
     C                     ADD  1         ZCNT
     C                     SUB  1         Z1
     C                     END
     C*
     C*       PUT IN DECIMAL PLACE
     C*
     C                     MOVE '.'       ZS2,Z2
     C                     SUB  1         Z2
     C*
     C           ZS10      TAG                             ** ZS10 TAG **
     C*
     C*       SET UP INTEGERS
     C*
     C                     Z-ADD*ZEROS    CNT3    10
     C           Z1        DOUEQ*ZEROS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z1
     C                     SUB  1         Z2
     C*
     C* If edit code is 'J', insert a ',' before each group of three
     C* digits - not if beginning of array reached.
     C*
     C           Z2        IFGT *ZEROS
     C           ZECODE    ANDEQ'J'
     C                     ADD  1         CNT3
     C           CNT3      IFEQ 3
     C                     MOVE ','       ZS2,Z2
     C                     SUB  1         Z2
     C                     Z-ADD*ZEROS    CNT3
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*       PUT IN LEADING BLANKS
     C*
     C                     Z-ADD1         Z2
     C           ZS2,Z2    DOWEQ'0'
     C           ZS2,Z2    OREQ ' '
     C           ZS2,Z2    OREQ ','
     C                     MOVE ' '       ZS2,Z2
     C                     ADD  1         Z2
     C           Z2        CABEQ22        ZS20
     C                     END
     C*
     C*       IF NO INTEGERS PUT IN LEADING ZERO
     C*
     C           ZS20      TAG                             ** ZS20 TAG **
     C*
     C           Z2        IFEQ 22
     C                     SUB  2         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     ELSE
     C*
     C           ZS2,Z2    IFEQ '.'
     C                     SUB  1         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     END
     C                     END
     C*
     C*       SET UP OUTPUT FIELD
     C*
     C                     MOVEAZS2       ZOUT21
     C*
     CSR                   ENDSR
     C*
     C*
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO ZDEND2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C*
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C/EJECT                                                              E20380
     C/COPY ZSRSRC,ZCCYCN                                                 E20380
     C/COPY ZSRSRC,ZCCYGBZ1                                               48200
     C****/EJECT                                                    47719 E20380
     C****/COPY ZSRSRC,ZCCYXR                                       47719 E20380
     C*
     C/COPY WNCPYSRC,SE6260C004
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*    *PSSR     - Program error handling routine                 *
     C*                                                               *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C                     DUMP
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
**  CPY@
(c) Finastra International Limited 2001
** ARRAY OF POWERS OF 10 FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
