     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE ER Blocked Positions')                        *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE6542 - SE Blocked Positions                                *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 25Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU017             Date 03Avr98               *
     F*                 CSE007             Date 19Dec97               *
     F*                 CPM005             Date 15Jul96               *
     F*                 085817             Date 13Mar95               *
     F*                 081239             DATE 02FEB95               *
     F*                 S01496             DATE 24OCT94               *
     F*                  62813             DATE 04NOV93               *
     F*                 S10978             DATE 02AUG93               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  CEU017 - Securities Redenomination Euro Changes              *
     F*  CSE007 - Corporate Actions                                   *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*  085817 - Recompile due to changes in PMLDAPD                 *
     F*  081239 - R10 Private Banking Rework                          *
     F*  S01496 - Incorporation of Jyske Enhancements (S10978)        *
     F*  62813  - SCREEN DOES NOT DISPLAY GENERAL BLOCK BY SECURITY   *
     F*         - SPECIFIC BLOCKS NOT APPEARING WHEN THERE ARE        *
     F*           REQUIRED BY THE TOTAL PORTFOLIO (9998) OR BY THE    *
     F*           TOTAL CUSTOMER (9999) FROM PM0670 & PM0700          *
     F*  S10978 - JYSZRH: EARLY REDEMPTIONS                           *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FSE6542DFCF  E                    WORKSTN
     F                                        RRN1  KSFILE SE6542S1
     F                                              KINFSR *PSSR
     F***SDBANKL1IF**E           K        DISK                            S01496
     F***********                                   KINFSR *PSSR          S01496
     F***SDMMODL1IF**E           K        DISK                            S01496
     F***********                                   KINFSR *PSSR          S01496
     F***SDPORTL1IF**E           K        DISK                            S01496
     F***********                                   KINFSR *PSSR          S01496
     FSEBKALL0IF  E           K        DISK
     F                                              KINFSR *PSSR
     F***SDSTRDL1IF**E           K        DISK                            S01496
     F***********                                   KINFSR *PSSR          S01496
     FSECTY   IF  E           K        DISK
     F                                              KINFSR *PSSR
     FSEBLKPL3IF  E           K        DISK                                62813
     F            SEBLKPD0                          KRENAMESEBLKPD3        62813
     F            SECOBKD0                          KRENAMESECOBKD3       CSE007
     F                                              KINFSR *PSSR           62813
     F*****************************************************************
     E*
     E** Copyright
     E                    CPY@    1   1 80
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,ZSEDITZ1
     E*****************************************************************
     I*
     ISEERALD0    01
     I              VCRECI                          VDRECI
     I              VCCNUM                          VDCNUM
     I              VCPTFR                          VDPTFR
     I              VCERTP                          VDBLTY
     I              VCSESN                          VDSESN
     I              VCNOMA                          VDNOMB
     I              VCBEDT                          VDBEDT
     I              VCBRCD                          VDBRCD
     ISEBLKPD0    02
     ISECOALD0    03                                                      CSE007
     I              MCRECI                          VDRECI                CSE007
     I              MCCNUM                          VDCNUM                CSE007
     I              MCPTFR                          VDPTFR                CSE007
     I              MCBLTY                          VDBLTY                CSE007
     I              MCBSEC                          VDSESN                CSE007
     I              MCBEDT                          VDBEDT                CSE007
     I              MCBRCD                          VDBRCD                CSE007
     I              MCBSTT                          VDBSTT                CSE007
     I              MCBEWI                          VDEWIN                CSE007
     ISECOBKD0    04                                                      CSE007
     I              MURECI                          VDRECI                CSE007
     I              MUCNUM                          VDCNUM                CSE007
     I              MUPTFR                          VDPTFR                CSE007
     I              MUBLTY                          VDBLTY                CSE007
     I              MUSESN                          VDSESN                CSE007
     I              MUNOMB                          VDNOMB                CSE007
     I              MUBEDT                          VDBEDT                CSE007
     I              MUBRCD                          VDBRCD                CSE007
     I              MUBSTT                          VDBSTT                CSE007
     I              MUBEWI                          VDEWIN                CSE007
     I              MUBNAR                          VDBNAR                CSE007
     ISECOBKD3    05                                                      CSE007
     I              MURECI                          VDRECI                CSE007
     I              MUCNUM                          VDCNUM                CSE007
     I              MUPTFR                          VDPTFR                CSE007
     I              MUBLTY                          VDBLTY                CSE007
     I              MUSESN                          VDSESN                CSE007
     I              MUNOMB                          VDNOMB                CSE007
     I              MUBEDT                          VDBEDT                CSE007
     I              MUBRCD                          VDBRCD                CSE007
     I              MUBSTT                          VDBSTT                CSE007
     I              MUBEWI                          VDEWIN                CSE007
     I*
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I***WWGDA*****E DSPMGRDAPP                                           S01496
     I***WWLDA*****E DSPMLDAPP                                            S01496
     IWWLDA     E DSPMLDAPD                                               S01496
     I*
     I** Program Status Data Structure for WS/USER ID'S
     IPSDS       SDS
     I                                      244 253 WSID
     I                                      254 263 USIDXX
     I*                                                                   S01496
     ISDBANK    E DSSDBANKPD                                              S01496
     I**  Data structure for bank details                                 S01496
     I*                                                                   S01496
     ISDMMOD    E DSSDMMODPD                                              S01496
     I**  Data structure for module details                               S01496
     I*                                                                   S01496
     ISDSTRD    E DSSDSTRDPD                                              S01496
     I**  Data structure for securities trading details                   S01496
     I*                                                                   S01496
     ISDPORT    E DSSDPORTPD                                              S01496
     I**  Data structure for portfolio management details                 S01496
     I*                                                                   S01496
     IDSSDY     E DSDSSDY                                                 S01496
     I**  Long data structure for access objects                          S01496
     I*
      /COPY ZSRSRC,ZSEDITZ2
      *****************************************************************
      ** ENTRY PLIST
      *****************************************************************
     C           *ENTRY    PLIST
     C                     PARM           DDBRCD
     C                     PARM           DDCNUM
     C                     PARM           DDPTFR
     C                     PARM           DDSESN
     C                     PARM           WWBED1  50
     C*
      *****************************************************************
      ** KEY DEFINITION
      *****************************************************************
     C           KEY1      KLIST
     C***********          KFLD           KBRCD   30                      S01496
     C                     KFLD           KBRCD   3                       S01496
     C**********           KFLD           KCNUM   60                                          CSD027
     C                     KFLD           KCNUM   6                                           CSD027
     C                     KFLD           KPTFR   4
     C*                                                                    62813
     C           KEY2      KLIST                                           62813
     C                     KFLD           @KBRCD                           62813
     C                     KFLD           @KSESN                           62813
     C                     KFLD           @KBLTY                           62813
     C                     KFLD           @KBEDT                           62813
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** MAIN PROCESSING
     C*****************************************************************
     C*
     C** Perform initial processing
     C                     EXSR P001
     C*
     C** Do while not F3
     C************INKC     DOWEQ'0'                        B*1            081239
     C************INKL     ANDEQ'0'                                       081239
     C************IN22     ANDEQ'0'                                 S01496081239
     C           QMENQT    DOUEQ'Y'                                       081239
     C           QMENQT    OREQ 'C'                                       081239
     C           QMENQT    OREQ 'P'                                       081239
     C           QMENQT    OREQ 'D'                                       081239
     C           *INKL     OREQ '1'                                       081239
     C*
     C** Read SE6542DF
     C                     READ SE6542C1                 71
     C*                                                                   081239
     C** If F3  pressed, exit program                                     081239
     C*                                                                   081239
     C           *INKC     IFEQ '1'                                       081239
     C                     MOVE 'Y'       QMENQT                          081239
     C                     CALL 'PMC1001'                                 081239
     C                     PARM           WWLDA                           081239
     C                     END                                            081239
     C**********                                                    081239CPM005
     C***If*F22*pressed, access Enquiry selection screen            081239CPM005
     C**********                                                    081239CPM005
     C********** *INKW     IFEQ '1'                                 081239CPM005
     C**********           CALL 'PMC0610'                           081239CPM005
     C**********                                                    081239CPM005
     C***Retrieve *LDA values                                       081239CPM005
     C**********                                                    081239CPM005
     C**********           CALL 'PMC1003'                           081239CPM005
     C**********           PARM           WWLDA                     081239CPM005
     C**********           END                                      081239CPM005
     C*
     C** Rollup taken
     C           *IN35     IFEQ '1'                        B*2
     C                     Z-ADDRRNMA1    RRN1
     C                     EXSR P002
     C                     END                             E*2
     C*
     C                     ENDDO                           E*1
     C***********                                                         081239
     C***If*F3*Taken******************************************************081239
     C*****or*F22*is*pressed****************************************S01496081239
     C************INKC     IFEQ '1'                                       081239
     C************IN22     OREQ '1'                                 S01496081239
     C***********                                                         081239
     C***Move*'Y'*to*Enquiries*Terminating*on*Dtaara**GDA*****************081239
     C***********          MOVEL'Y'       QMENQT                          081239
     C***********                                                         081239
     C***Update*Dtaara**GDA********************************************   S01496
     C***********          CALL 'PMC1002'                                 S01496
     C***********          PARM           WWGDA                           S01496
     C***********                                                   S01496081239
     C****Update*Dtaara**LDA****************************************S01496081239
     C***********          CALL 'PMC1001'                           S01496081239
     C***********          PARM           WWLDA                     S01496081239
     C***********                                                         081239
     C***********          END                                            081239
     C*
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C*****************************************************************
     C*  P R O G R A M     E N D
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** INDEX OF SUBROUTINES
     C**
     C** P001   INITIAL PROCESSING
     C** P002   WRITE NEXT PAGE ON SUBFILE
     C**
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C** P001 - INITIAL PROCESSING
     C** CALLED ONCE AT START OF PROGRAM FROM MAIN LINE
     C*****************************************************************
     C*
     C           P001      BEGSR                           ** P001  BSR **
     C*                                                                   S01496
     C**  Copyright statement                                             S01496
     C*                                                                   S01496
     C                     MOVEACPY@      ACT@   80                       S01496
     C*
     C** Setup Key Fields
     C                     MOVE DDBRCD    KBRCD
     C                     MOVE DDCNUM    KCNUM
     C*********************MOVE DDPTFR    KPTFR                            62813
     C*
     C** Zeroise number of records read
     C                     Z-ADD0         RRN1
     C*
     C** Get installation control data record
     C************LOVAL    SETLLSDBANKL1                                  S01496
     C***********          READ SDBANKL1                 71               S01496
     C*                                                                   S01496
     C                     CALL 'AOBANKR0'                                S01496
     C                     PARM *BLANKS   WLRTCD  7                       S01496
     C                     PARM '*FIRST'  WLOPTN  7                       S01496
     C           SDBANK    PARM SDBANK    DSSDY                           S01496
     C*                                                                   S01496
     C************IN71     IFEQ '1'                        ***************S01496
     C           WLRTCD    IFNE *BLANKS                    ***************S01496
     C                     Z-ADD1         QMERRN           **DB ERROR 01**
     C                     MOVEL'SDBANKL1'QMFILE           ***************
     C                     MOVEL*BLANKS   QMKEY
     C                     EXSR *PSSR
     C                     END
     C*
     C                     MOVELBJMRDT    DDRUNA
     C*
     C** Test date format
     C           BJDFIN    IFEQ 'M'                        B*1
     C                     MOVE '1'       *IN98
     C                     END                             E*1
     C*
     C           WWBED1    IFEQ *ZEROS
     C                     MOVE BJRDNB    WWBED1
     C                     END
     C*
     C                     MOVE WWBED1    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDBEDT
     C*
     C* Access SDMMODL1 for module details
     C************LOVAL    SETLLSDMMODL1                                  S01496
     C***********          READ SDMMODL1                 71               S01496
     C*                                                                   S01496
     C                     CALL 'AOMMODR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*FIRST'  WLOPTN                          S01496
     C           SDMMOD    PARM SDMMOD    DSSDY                           S01496
     C*                                                                   S01496
     C************IN71     IFEQ '1'                        ***************S01496
     C           WLRTCD    IFNE *BLANKS                    ***************S01496
     C                     Z-ADD2         QMERRN           **DB ERROR 02**
     C                     MOVEL'SDMMODL1'QMFILE           ***************
     C                     MOVEL*BLANKS   QMKEY
     C                     EXSR *PSSR
     C                     END
     C*                                                                   S01496
     C**  Setup multibranching indicator                                  S01496
     C*                                                                   S01496
     C           BGMBIN    IFEQ 'Y'                                       S01496
     C                     MOVE '1'       *IN45                           S01496
     C                     END                                            S01496
     C*
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE '1'       *IN44                           CPB001
     C                     MOVE DDPTFR    WWPTFR                          CPB001
     C                     MOVE DDPTFR    KPTFR                           CPB001
     C                     ENDIF                                          CPB001
     C** IF PM installed, access SDPORTL1 for PM ICD
     C           BGPFMG    IFEQ 'Y'                        B*1
     C*                                                                   S01496
     C**  Setup the portfolio management indicator                        S01496
     C*                                                                   S01496
     C                     MOVE '1'       *IN44                           S01496
     C*                                                                   S01496
     C************LOVAL    SETLLSDPORTL1                                  S01496
     C***********          READ SDPORTL1                 71               S01496
     C*                                                                   S01496
     C                     CALL 'AOPORTR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*FIRST'  WLOPTN                          S01496
     C           SDPORT    PARM SDPORT    DSSDY                           S01496
     C*                                                                   S01496
     C************IN71     IFEQ '1'                        ***************S01496
     C           WLRTCD    IFNE *BLANKS                    ***************S01496
     C                     Z-ADD3         QMERRN           **DB ERROR 03**
     C                     MOVEL'SDPORTL1'QMFILE           ***************
     C                     MOVEL*BLANKS   QMKEY
     C                     EXSR *PSSR
     C                     END
     C*                                                                    62813
     C***********DDPTFR    IFEQ P9R998                     B*2      62813 S01496
     C           DDPTFR    IFEQ FCR998                     B*2            S01496
     C                     MOVE '9998'    WWPTFR  4                        62813
     C                     ELSE                            X*2             62813
     C***********DDPTFR    IFEQ P9R999                     B*3      62813 S01496
     C           DDPTFR    IFEQ FCR999                     B*3            S01496
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE '9999'    WWPTFR                           62813
     C                     ELSE                            X*3             62813
     C                     MOVE DDPTFR    WWPTFR                           62813
     C                     END                             E*3             62813
     C                     END                             E*2             62813
     C*                                                                    62813
     C                     MOVE WWPTFR    KPTFR                            62813
     C*                                                                    62813
     C                     END                             E*1
     C*
     C* Access SDSTRDL1 for SE ICD
     C************LOVAL    SETLLSDSTRDL1                                  S01496
     C***********          READ SDSTRDL1                 71               S01496
     C*                                                                   S01496
     C                     CALL 'AOSTRDR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*FIRST'  WLOPTN                          S01496
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01496
     C*                                                                   S01496
     C************IN71     IFEQ '1'                        ***************S01496
     C           WLRTCD    IFNE *BLANKS                    ***************S01496
     C                     Z-ADD4         QMERRN           **DB ERROR 04**
     C                     MOVEL'SDSTRDL1'QMFILE           ***************
     C                     MOVEL*BLANKS   QMKEY
     C                     EXSR *PSSR
     C                     END
      *                                                                   CSE007
      ***  Call access program to access Switchable Features Details.     CSE007
      *                                                                   CSE007
     C                     MOVE 'N'       CSE007  1                       CSE007
     C                     MOVE '0'       *IN60                           CSE007
     C                     CALL 'AOSARDR0'                                CSE007
     C                     PARM '       ' @RTCD   7                       CSE007
     C                     PARM '*VERIFY' @OPTN   7                       CSE007
     C                     PARM 'CSE007'  @SARD   6                       CSE007
      *                                                                   CSE007
      ***  If feature CSE007 is switched ON.                              CSE007
      *                                                                   CSE007
     C           @RTCD     IFEQ *BLANKS                                   CSE007
     C                     MOVE 'Y'       CSE007                          CSE007
     C                     MOVE '1'       *IN60                           CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CEU017
      ***  Call access program to access Switchable Features Details.     CEU017
      *                                                                   CEU017
     C                     MOVE 'N'       CEU017  1                       CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM '       ' @RTCD   7                       CEU017
     C                     PARM '*VERIFY' @OPTN   7                       CEU017
     C                     PARM 'CEU017'  @SARD   6                       CEU017
      *                                                                   CEU017
      ***  If feature CEU017 is switched ON.                              CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANKS                                   CEU017
     C                     MOVE 'Y'       CEU017                          CEU017
     C                     MOVE '1'       *IN60                           CEU017
     C                     ENDIF                                          CEU017
     C*
     C                     EXSR P002
     C*
     C           EP001     ENDSR                           ** END P001  **
     C*
     C********************************************************************
      /EJECT
     C*****************************************************************
     C**
     C** P002   WRITE NEXT PAGE ON SUBFILE
     C** CALLED FROM
     C**
     C*****************************************************************
     C*
     C           P002      BEGSR                           ** P002 BSR **
     C*
     C** Zeroise number of records read
     C                     Z-ADD0         WWRRN   50
     C*                                                                   S01496
     C** If multibranching is on, check if user is authorised to branch   S01496
     C*                                                                   S01496
     C           BGMBIN    IFEQ 'Y'                                       S01496
     C                     CALL 'ZVBBU'                                   S01496
     C                     PARM DDBRCD    WLBRCH  3                       S01496
     C                     PARM *ZEROS    WLERR   10                      S01496
     C           WLERR     IFNE *ZEROS                                    S01496
     C                     GOTO TAGEND                                    S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*
     C********** KCNUM     IFEQ *ZEROS                     B*1                                CSD027
     C           KCNUM     IFEQ *BLANKS                    B*1                                CSD027
     C           DDSESN    OREQ *BLANKS
     C                     GOTO TAGEND
     C                     ENDIF                           E*1
     C*
     C           RRN1      IFEQ *ZEROS                     B*1
     C                     EXSR P0021                                      62813
     C*
     C** IF PORTFOLIO '9998' (TOTAL PORTFOLIO) OR '9999' (TOTAL CUSTOMER)  62813
     C*                                                                    62813
     C           WWPTFR    IFEQ '9998'                     B*2             62813
     C           WWPTFR    OREQ '9999'                                     62813
     C                     MOVE *LOVAL    KPTFR                            62813
     C                     END                             E*2             62813
     C*                                                                    62813
     C******               MOVEA'00'      *IN,01                          CSE007
     C                     MOVEA'00000'   *IN,01                          CSE007
     C           KEY1      SETLLSEBKALL0
     C***********          READ SEBKALL0                 22               S01496
     C                     READ SEBKALL0                 99               S01496
     C*
     C** IF PORTFOLIO '9998' (TOTAL PORTFOLIO) OR '9999' (TOTAL CUSTOMER)  62813
     C*                                                                    62813
     C                     MOVE VDPTFR    WPTFR   4                        62813
     C           WWPTFR    IFEQ '9998'                     B*2             62813
     C           WWPTFR    OREQ '9999'                                     62813
     C                     MOVE WWPTFR    VDPTFR                           62813
     C                     ENDIF                           E*2             62813
     C                     ENDIF                           E*1
     C*
     C************IN22     DOWEQ'0'                        B*1            S01496
     C***********WWRRN     ANDLT15                                        S01496
     C           *IN99     DOWEQ'0'                        B*1            S01496
     C           WWRRN     ANDLT14                                        S01496
     C           KBRCD     ANDEQVDBRCD
     C           KCNUM     ANDEQVDCNUM
     C***********DDPTFR    ANDEQVDPTFR                                     62813
     C           WWPTFR    ANDEQVDPTFR                                     62813
     C*
     C           VDBEDT    IFGE WWBED1                     B*2
     C           DDSESN    ANDEQVDSESN
     C           VDRECI    ANDEQ'D'
     C*
     C** Format Details for Output
     C                     MOVE VDBRCD    SSBRCD
     C*
     C********** VDCNUM    IFEQ *ZEROS                      B*3                               CSD027
     C           VDCNUM    IFEQ *BLANKS                     B*3                               CSD027
     C                     MOVE *BLANKS   SSCNUM
     C                     ELSE                             X*3
     C                     MOVE VDCNUM    SSCNUM
     C                     ENDIF                            E*3
     C*
     C***********VDPTFR    IFEQ '9997'                      B*3            62813
     C           WPTFR     IFEQ '9997'                      B*3            62813
     C***********          MOVE P9R997    SSPTFR                          S01496
     C                     MOVE FCR997    SSPTFR                          S01496
     C                     ELSE                             X*3
     C*********************MOVE VDPTFR    SSPTFR                           62813
     C                     MOVE WPTFR     SSPTFR                           62813
     C                     ENDIF                            E*3
     C*
     C                     MOVE VDBLTY    SSBLTY
     C                     MOVE VDSESN    SSSESN
      *                                                                   CSE007
      ***  If record is read from SECOALPD.                               CSE007
      *                                                                   CSE007
     C           *IN03     IFEQ '1'                                       CSE007
      *                                                                   CSE007
     C           MCEXPO    IFEQ *ZEROS                                    CSE007
     C           MCEXPO    OREQ *HIVAL                                    CSE007
     C                     MOVE *BLANKS   SSNOMB                          CSE007
     C                     ELSE                                           CSE007
     C           VDSESN    CHAINSECTY                7171                 CSE007
     C           *IN71     IFEQ '1'                        ***************CSE007
     C                     Z-ADD6         QMERRN           **DB ERROR 06**CSE007
     C                     MOVE 'SECTY'   QMFILE           ***************CSE007
     C                     MOVELVDSESN    QMKEY                           CSE007
     C                     EXSR *PSSR                                     CSE007
     C                     ELSE                                           CSE007
     C                     MOVE MCEXPO    ZFLD15                          CSE007
     C                     Z-ADDNMDP      ZDECS                           CSE007
     C                     MOVE ' '       ZECODE                          CSE007
     C                     EXSR ZSEDIT                                    CSE007
     C                     MOVE ZOUT21    SSNOMB                          CSE007
     C                     ENDIF                                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
     C                     ELSE                                           CSE007
     C*
     C           VDNOMB    IFEQ *ZEROS                      B*3
     C           VDNOMB    OREQ *HIVAL
     C                     MOVE *BLANKS   SSNOMB
     C                     ELSE                             X*3
     C           VDSESN    CHAINSECTY                7171
     C           *IN71     IFEQ '1'                        ***************
     C                     Z-ADD5         QMERRN           **DB ERROR 05**
     C                     MOVEL'SECTY'   QMFILE           ***************
     C                     MOVELVDSESN    QMKEY
     C                     EXSR *PSSR
     C                     ELSE                             X*4
     C                     MOVE VDNOMB    ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE ' '       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SSNOMB
     C                     ENDIF                            E*4
     C                     ENDIF                            E*3
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*
     C           VDBEDT    IFEQ 99999                       B*3
     C                     MOVE *BLANKS   SSBEDT
     C                     ELSE                             X*3
     C                     MOVE VDBEDT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SSBEDT
     C                     ENDIF                            E*3
      *                                                                   CSE007
      ***  If feature CSE007 is switched ON.                              CSE007
      ***  or feature CEU017 is switched ON.                              CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Format Block from Date.                                        CSE007
      *                                                                   CSE007
     C           VDBSTT    IFEQ *ZEROS                                    CSE007
     C                     MOVE *BLANKS   SSBSTT                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVE VDBSTT    ZDAYNO                          CSE007
     C                     EXSR ZDATE2                                    CSE007
     C                     MOVE ZDATE     SSBSTT                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  Format Block Error/Warning Indicator.                          CSE007
      *                                                                   CSE007
     C                     MOVE VDEWIN    SSBEWI                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*
     C           *IN01     IFEQ '1'                         B*3
     C                     MOVE *BLANKS   SSBNAR
     C                     MOVE *BLANKS   WWA9    9
     C                     MOVEL'ER'      WWA9
     C                     MOVE VCERRF    WWA9
     C                     MOVE *BLANKS   WWA11  11
     C                     MOVEL' DEP'    WWA11
     C                     MOVE VCDDPT    WWA11
     C                     MOVELWWA9      SSBNAR
     C                     MOVE WWA11     SSBNAR
     C                     ELSE                             X*3
      *                                                                   CSE007
      ***  If record is read from SECOALPD.                               CSE007
      *                                                                   CSE007
     C           *IN03     IFEQ '1'                                       CSE007
     C                     MOVE *BLANKS   SSBNAR                          CSE007
     C                     MOVE *BLANKS   WWA9    9                       CSE007
     C                     MOVELMCCOAT    WWA9                            CSE007
     C                     MOVE MCCORF    WWA9                            CSE007
     C                     MOVE *BLANKS   WWA11  11                       CSE007
     C                     MOVEL' DEP'    WWA11                           CSE007
     C                     MOVE MCDDPT    WWA11                           CSE007
     C                     MOVELWWA9      SSBNAR                          CSE007
     C                     MOVE WWA11     SSBNAR                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVELVDBNAR    SSBNAR
     C                     ENDIF                                          CSE007
     C                     ENDIF                            E*3
     C*
     C** Write formatted details to subfile
     C                     ADD  1         RRN1
     C                     ADD  1         WWRRN
     C                     Z-ADDRRN1      RRNMA1  50
     C                     WRITESE6542S1
     C*
     C                     ENDIF                            E*2
     C*
     C******               MOVEA'00'      *IN,01                          CSE007
     C                     MOVEA'00000'   *IN,01                          CSE007
     C***********          READ SEBKALL0                 22               S01496
     C                     READ SEBKALL0                 99               S01496
     C*
     C** IF PORTFOLIO '9998' (TOTAL PORTFOLIO) OR '9999' (TOTAL CUSTOMER)  62813
     C*                                                                    62813
     C                     MOVE VDPTFR    WPTFR                            62813
     C           WWPTFR    IFEQ '9998'                     B*2             62813
     C           WWPTFR    OREQ '9999'                                     62813
     C                     MOVE WWPTFR    VDPTFR                           62813
     C                     ENDIF                           E*2             62813
     C*
     C                     ENDDO                            E*1
     C*
     C                     MOVE '0'       *IN72
     C***********WWRRN     IFEQ 15                          B*1           S01496
     C           WWRRN     IFEQ 14                          B*1           S01496
     C                     MOVE '1'       *IN72
     C                     ENDIF                            E*1
     C*
     C                     MOVE '0'       *IN55
     C*
     C           TAGEND    TAG
     C*
     C** If no record read, clear subfile
     C           RRN1      IFEQ 0                           B*1
     C*
     C** Send Message 'NO BLOCKED POSITIONS'
     C                     MOVE '1'       *IN55
     C                     MOVE '1'       *IN24
     C                     MOVE '1'       *IN25
     C                     ENDIF                            E*1
     C*
     C                     WRITESE6542F0
     C                     WRITESE6542C1
     C                     MOVE '0'       *IN24
     C                     MOVE '0'       *IN25
     C*
     C           EP002     ENDSR                           ** END P002 **
     C*****************************************************************
      /EJECT                                                               62813
     C*****************************************************************    62813
     C**                                                                   62813
     C** P0021  PROCESSING FOR THE GENERAL BLOCKS (SECURITY OR CUSTOMER)   62813
     C** CALLED FROM                                                       62813
     C**                                                                   62813
     C*****************************************************************    62813
     C*                                                                    62813
     C           P0021     BEGSR                           ** P0021 BSR ** 62813
     C*                                                                    62813
     C** General Block by Security - Purchase                              62813
     C***********          MOVE DDBRCD    @KBRCD  30                62813 S01496
     C                     MOVE DDBRCD    @KBRCD  3                       S01496
     C                     MOVE DDSESN    @KSESN 10                        62813
     C                     MOVEL'P'       @KBLTY  1                        62813
     C                     Z-ADDWWBED1    @KBEDT  50                       62813
     C*                                                                    62813
     C           KEY2      SETLLSEBLKPL3                                   62813
     C                     READ SEBLKPL3                 41                62813
     C*                                                                    62813
     C           *IN41     IFEQ '0'                        *B1             62813
     C           VDBRCD    ANDEQ@KBRCD                                     62813
     C           VDSESN    ANDEQ@KSESN                                     62813
     C           VDBLTY    ANDEQ@KBLTY                                     62813
     C                     EXSR WRITED                                     62813
     C                     END                             *E1             62813
     C*                                                                    62813
     C** General Block by Security - Sale                                  62813
     C                     MOVEL'S'       @KBLTY                           62813
     C           KEY2      SETLLSEBLKPL3                                   62813
     C                     READ SEBLKPL3                 41                62813
     C*                                                                    62813
     C           *IN41     IFEQ '0'                        *B1             62813
     C           VDBRCD    ANDEQ@KBRCD                                     62813
     C           VDSESN    ANDEQ@KSESN                                     62813
     C           VDBLTY    ANDEQ@KBLTY                                     62813
     C                     EXSR WRITED                                     62813
     C                     END                             *E1             62813
     C*                                                                    62813
     C                     ENDSR                           ** END P0021 ** 62813
     C*****************************************************************    62813
      /EJECT                                                               62813
     C*****************************************************************    62813
     C**                                                                   62813
     C** WRITED - WRITE DETAILS FOR THE GENERAL BLOCK(S) BY SECURITY       62813
     C** CALLED FROM                                                       62813
     C**                                                                   62813
     C*****************************************************************    62813
     C*                                                                    62813
     C           WRITED    BEGSR                           * WRITED BSR *  62813
     C*                                                                    62813
     C** Format Details for Output                                         62813
     C                     MOVE VDBRCD    SSBRCD                           62813
     C*                                                                    62813
     C                     MOVE *BLANKS   SSCNUM                           62813
     C                     MOVE *BLANKS   SSPTFR                           62813
     C*                                                                    62813
     C                     MOVE VDBLTY    SSBLTY                           62813
     C                     MOVE VDSESN    SSSESN                           62813
     C                     MOVE *BLANKS   SSNOMB                           62813
     C*                                                                    62813
     C           VDBEDT    IFEQ 99999                       B*1            62813
     C                     MOVE *BLANKS   SSBEDT                           62813
     C                     ELSE                             X*1            62813
     C                     MOVE VDBEDT    ZDAYNO                           62813
     C                     EXSR ZDATE2                                     62813
     C                     MOVE ZDATE     SSBEDT                           62813
     C                     ENDIF                            E*1            62813
      *                                                                   CSE007
      ***  If feature CSE007 is switched ON.                              CSE007
      ***  or feature CEU017 is switched ON.                              CEU017
      *                                                                   CSE007
     C           CSE007    IFEQ 'Y'                                       CSE007
     C           CEU017    OREQ 'Y'                                       CEU017
      *                                                                   CSE007
      ***  Format Block from Date.                                        CSE007
      *                                                                   CSE007
     C           VDBSTT    IFEQ *ZEROS                                    CSE007
     C                     MOVE *BLANKS   SSBSTT                          CSE007
     C                     ELSE                                           CSE007
     C                     MOVE VDBSTT    ZDAYNO                          CSE007
     C                     EXSR ZDATE2                                    CSE007
     C                     MOVE ZDATE     SSBSTT                          CSE007
     C                     ENDIF                                          CSE007
      *                                                                   CSE007
      ***  Format Block Error/Warning Indicator.                          CSE007
      *                                                                   CSE007
     C                     MOVE VDEWIN    SSBEWI                          CSE007
      *                                                                   CSE007
     C                     ENDIF                                          CSE007
     C*                                                                    62813
     C                     MOVELVDBNAR    SSBNAR                           62813
     C*                                                                    62813
     C** Write formatted details to subfile                                62813
     C                     ADD  1         RRN1                             62813
     C                     ADD  1         WWRRN                            62813
     C                     Z-ADDRRN1      RRNMA1  50                       62813
     C                     WRITESE6542S1                                   62813
     C*                                                                    62813
     C                     ENDSR                           * END WRITED *  62813
     C******************************************************************** 62813
      /EJECT
     C********************************************************************
     C**
     C** *PSSR  S/R
     C** CALLED FROM
     C** CALLS NO OTHER S/R'S
     C**
     C********************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVEL'Y'       QMDBER
     C                     MOVEL'PM0650'  QMPGM
     C                     MOVEL'Y'       QMENQT
     C**
     C***UPDATE**GDA***************************************************   S01496
     C***********                                                         S01496
     C***********          CALL 'PMC1002'                                 S01496
     C***********          PARM           WWGDA                           S01496
     C*                                                                   S01496
     C**  Update *LDA                                                     S01496
     C                     CALL 'PMC1001'                                 S01496
     C                     PARM           WWLDA                           S01496
     C*
     C** Print Dump and Cancel Program
     C                     DUMP
     C                     CALL 'DBERRCTL'                                S01496
     C*
     C                     ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
      /COPY ZSRSRC,ZDATE1Z2
      /COPY ZSRSRC,ZDATE2Z2
      /COPY ZSRSRC,ZSEDITZ3
     C********************************************************************
      /EJECT
     C********************************************************************
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
